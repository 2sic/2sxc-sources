"use strict";(self.webpackChunkng_dialogs=self.webpackChunkng_dialogs||[]).push([["default-projects_ng-dialogs_src_app_create-file-dialog_index_ts"],{1183:function(G,$,n){n.d($,{tk:function(){return V}});var S=n(8069),b=n(8047),E=n(635),D=n(8507),v=n(8254),N=n(8598),M=n(7133),w=n(8784),A=n(2425),V=function(){var O=function(){function y(g,p,h){var C;(0,S.Z)(this,y),this.http=g,this.context=p,this.dnnContext=h,this.isShared=null!==(C=sessionStorage.getItem(v.PH))&&void 0!==C?C:(!1).toString()}return(0,b.Z)(y,[{key:"get",value:function(p,h){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(D.pJ),{params:Object.assign({appId:this.context.appId.toString(),global:this.isShared},this.templateIdOrPath(p,h))}).pipe((0,E.U)(function(C){if("auto"===C.Type.toLocaleLowerCase())switch(C.Extension.toLocaleLowerCase()){case".cs":case".cshtml":C.Type="Razor";break;case".html":case".css":case".js":C.Type="Token"}return C}))}},{key:"save",value:function(p,h,C){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(D.pJ),h,{params:Object.assign({appId:this.context.appId.toString(),global:this.isShared},this.templateIdOrPath(p,C))})}},{key:"getTemplates",value:function(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(D.nu),{params:{appId:this.context.appId.toString(),global:this.isShared,withSubfolders:"true"}})}},{key:"getPredefinedTemplates",value:function(p,h){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/appfiles/GetTemplates"),{params:Object.assign(Object.assign({},p&&{purpose:p}),h&&{type:h})})}},{key:"getPreview",value:function(p,h){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/appfiles/preview"),{params:{appId:this.context.appId.toString(),path:p,templateKey:h,global:this.isShared}})}},{key:"createTemplate",value:function(p,h){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(D.yE),{},{params:{appId:this.context.appId.toString(),global:this.isShared,purpose:"auto",path:p,templateKey:h}})}},{key:"templateIdOrPath",value:function(p,h){var C;if(/^[0-9]*$/g.test(p)){var U=null===(C=h.find(function(j){var _;return(null===(_=j.EntityId)||void 0===_?void 0:_.toString())===p}))||void 0===C?void 0:C.Path;return Object.assign({templateId:p},null!=U&&{path:U})}return{path:p}}}]),y}();return O.\u0275fac=function(g){return new(g||O)(M.LFG(w.eN),M.LFG(N._),M.LFG(A._y))},O.\u0275prov=M.Yz7({token:O,factory:O.\u0275fac}),O}()},4909:function(G,$,n){n.d($,{U:function(){return fe},q:function(){return ve}});var S=n(7797),b=n(2090),E=n(8069),D=n(8047),v=n(587),N=n(5758),M=n(7714),w=n(6317),A=n(6562),K=n(6936),J=n(745),V=n(1640),O=n(8947),y=n(4874),g=n(8977),p=n(635),h=n(9337),C=n(1944),U=n(3945),j=n(4987),_={leading:!0,trailing:!1};function H(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_,a=i.leading,t=i.trailing;return(0,C.e)(function(s,Z){var T=!1,P=null,u=null,l=!1,r=function(){null==u||u.unsubscribe(),u=null,t&&(f(),l&&Z.complete())},c=function(){u=null,l&&Z.complete()},m=function(d){return u=(0,j.Xf)(o(d)).subscribe(new U.Q(Z,r,c))},f=function(){if(T){T=!1;var d=P;P=null,Z.next(d),!l&&m(d)}};s.subscribe(new U.Q(Z,function(x){T=!0,P=x,(!u||u.closed)&&(a?f():m(x))},function(){l=!0,(!(t&&T&&u)||u.closed)&&Z.complete()}))})}var q=n(2673),ee=n(5656),R=n(1183),e=n(7133),F=n(6362),Q=n(4770),Y=n(1434),L=n(4683),te=function(){var o=function(){function i(a,t){(0,E.Z)(this,i),this.matInput=a,this.elementRef=t,this.autofocusSelectValue=!1}return(0,D.Z)(i,[{key:"ngOnInit",value:function(){var t=this;setTimeout(function(){t.matInput.focus(),t.toBoolean(t.autofocusSelectValue)&&t.elementRef.nativeElement.setSelectionRange(0,t.matInput.value.length)})}},{key:"toBoolean",value:function(t){if("boolean"==typeof t)return t;if("string"==typeof t){var s=t.toLocaleLowerCase();return"true"===s||"false"!==s&&void 0}return null==t?t:void 0}}]),i}();return o.\u0275fac=function(a){return new(a||o)(e.Y36(L.Nt),e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}}),o}(),k=n(7317),ne=n(1130),oe=n(3135),W=n(4742);function ae(o,i){if(1&o&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&o){var a=i.$implicit;e.Q6J("value",a),e.xp6(1),e.hij(" ",a," ")}}function ie(o,i){if(1&o&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&o){var a=i.$implicit;e.Q6J("value",a),e.xp6(1),e.hij(" ",a," ")}}function le(o,i){if(1&o&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&o){var a=i.$implicit;e.Q6J("value",a.Key),e.xp6(1),e.hij(" ",a.Name," ")}}function re(o,i){1&o&&(e.TgZ(0,"app-field-hint",21),e._uU(1," This field is required "),e.qZA()),2&o&&e.Q6J("isError",!0)}function se(o,i){1&o&&(e.ynx(0),e._UZ(1,"mat-spinner",22),e._UZ(2,"div",23),e.BQk())}var z=function(i){return{disabled:i}};function ue(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"div",24),e.TgZ(2,"label",25),e._uU(3,"Preview"),e.qZA(),e.qZA(),e.TgZ(4,"pre",26),e._uU(5),e.qZA(),e.BQk()),2&o){var a=e.oxw().ngIf;e.xp6(2),e.Q6J("ngClass",e.VKq(3,z,a.loadingPreview)),e.xp6(2),e.Q6J("ngClass",e.VKq(5,z,a.loadingPreview)),e.xp6(1),e.Oqu(a.preview)}}function ce(o,i){if(1&o&&(e.TgZ(0,"div",27),e._uU(1),e.qZA()),2&o){var a=e.oxw().ngIf;e.xp6(1),e.hij(" ",a.previewError," ")}}function pe(o,i){if(1&o){var a=e.EpF();e.ynx(0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"span"),e._uU(4,"Create"),e.qZA(),e.TgZ(5,"span",3),e._uU(6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"form",4),e.TgZ(8,"div",5),e.TgZ(9,"div",6),e.TgZ(10,"div",7),e.TgZ(11,"mat-form-field",8),e.TgZ(12,"mat-label"),e._uU(13,"Platform"),e.qZA(),e.TgZ(14,"mat-select",9),e.YNc(15,ae,2,2,"mat-option",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(16,"div",7),e.TgZ(17,"mat-form-field",8),e.TgZ(18,"mat-label"),e._uU(19,"Purpose"),e.qZA(),e.TgZ(20,"mat-select",11),e.YNc(21,ie,2,2,"mat-option",10),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",12),e.TgZ(23,"mat-form-field",8),e.TgZ(24,"mat-label"),e._uU(25,"Template"),e.qZA(),e.TgZ(26,"mat-select",13),e.YNc(27,le,2,2,"mat-option",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(28,"div",12),e.TgZ(29,"mat-form-field",8),e.TgZ(30,"mat-label"),e._uU(31,"Name"),e.qZA(),e._UZ(32,"input",14),e.qZA(),e.YNc(33,re,2,1,"app-field-hint",15),e.qZA(),e.qZA(),e.TgZ(34,"div",16),e.YNc(35,se,3,0,"ng-container",0),e.TgZ(36,"button",17),e.NdJ("click",function(){return e.CHM(a),e.oxw().closeDialog()}),e._uU(37,"Cancel"),e.qZA(),e.TgZ(38,"button",18),e.NdJ("click",function(){return e.CHM(a),e.oxw().confirm()}),e._uU(39," Create "),e.qZA(),e.qZA(),e.YNc(40,ue,6,7,"ng-container",0),e.YNc(41,ce,2,1,"div",19),e.qZA(),e.BQk()}if(2&o){var t=i.ngIf,s=e.oxw();e.xp6(6),e.Oqu(s.controls.finalName.value||(s.controls.folder.value?s.controls.folder.value.trim()+"/":"")),e.xp6(1),e.Q6J("formGroup",s.form),e.xp6(8),e.Q6J("ngForOf",t.platforms),e.xp6(6),e.Q6J("ngForOf",t.purposes),e.xp6(6),e.Q6J("ngForOf",t.templates),e.xp6(6),e.Q6J("ngIf",s.controls.name.touched&&(null==s.controls.name.errors?null:s.controls.name.errors.required)),e.xp6(2),e.Q6J("ngIf",t.loadingPreview),e.xp6(3),e.Q6J("disabled",!s.form.valid||t.loadingPreview||!t.previewValid),e.xp6(2),e.Q6J("ngIf",t.preview),e.xp6(1),e.Q6J("ngIf",!t.loadingPreview&&t.previewError)}}var fe=function(){var o=function(){function i(a,t,s){(0,E.Z)(this,i),this.dialogData=a,this.dialogRef=t,this.sourceService=s,this.hostClass="dialog-component",this.all="All"}return(0,D.Z)(i,[{key:"ngOnInit",value:function(){this.subscription=new M.w0,this.templates$=new w.X([]),this.loadingPreview$=new w.X(!1),this.buildForm(),this.fetchTemplates(),this.buildTemplateVars()}},{key:"ngOnDestroy",value:function(){this.templates$.complete(),this.loadingPreview$.complete(),this.subscription.unsubscribe()}},{key:"closeDialog",value:function(t){this.dialogRef.close(t)}},{key:"confirm",value:function(){var t=this.form.getRawValue();this.closeDialog({name:t.finalName,templateKey:t.templateKey})}},{key:"fetchTemplates",value:function(){var t=this;this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(function(s){t.controls.templateKey.value!==s.Default&&t.controls.templateKey.patchValue(s.Default),t.templates$.next(s.Templates)})}},{key:"buildForm",value:function(){var s,Z,t=this;this.form=new v.cw({platform:new v.NI(this.all),purpose:new v.NI({value:null!==(s=this.dialogData.purpose)&&void 0!==s?s:this.all,disabled:null!=this.dialogData.purpose}),templateKey:new v.NI(null,v.kI.required),name:new v.NI(null,v.kI.required),finalName:new v.NI({value:null,disabled:!0}),folder:new v.NI({value:null!==(Z=this.dialogData.folder)&&void 0!==Z?Z:"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,A.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,y.O)(this.controls.templateKey.value),(0,g.x)())]).subscribe(function(T){var r,P=(0,b.Z)(T,2),l=P[1],c=P[0].find(function(f){return f.Key===l}),m=null!==(r=null==c?void 0:c.SuggestedFileName)&&void 0!==r?r:null;t.controls.name.value!==m&&t.controls.name.patchValue(m)})),this.subscription.add((0,A.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,y.O)(this.controls.templateKey.value),(0,g.x)()),this.controls.name.valueChanges.pipe((0,y.O)(this.controls.name.value),(0,g.x)()),this.controls.folder.valueChanges.pipe((0,y.O)(this.controls.folder.value),(0,g.x)())]).subscribe(function(T){var m,f,x,P=(0,b.Z)(T,4),l=P[1],r=P[2],c=P[3],d=P[0].find(function(B){return B.Key===l}),I=null;r&&(c=c.trim(),r=ee.vl.sanitizePath(r.trim()),r="".concat(null!==(m=null==d?void 0:d.Prefix)&&void 0!==m?m:"").concat(r).concat(null!==(f=null==d?void 0:d.Suffix)&&void 0!==f?f:"").concat(null!==(x=null==d?void 0:d.Extension)&&void 0!==x?x:""),I="".concat(c?"".concat(c,"/"):"").concat(r).replace(/\/{2,}/g,"/")),t.controls.finalName.value!==I&&t.controls.finalName.patchValue(I)}))}},{key:"buildTemplateVars",value:function(){var t=this,s=this.templates$.pipe((0,p.U)(function(u){var l=(0,S.Z)({},t.all,t.all);return u.forEach(function(r){var c;null===(c=r.Platforms)||void 0===c||c.forEach(function(m){l[m]=m})}),Object.keys(l)})),Z=this.templates$.pipe((0,p.U)(function(u){var l=(0,S.Z)({},t.all,t.all);return u.forEach(function(r){l[r.Purpose]=r.Purpose}),Object.keys(l)})),T=(0,A.a)([this.templates$,this.controls.platform.valueChanges.pipe((0,y.O)(this.controls.platform.value),(0,g.x)()),this.controls.purpose.valueChanges.pipe((0,y.O)(this.controls.purpose.value),(0,g.x)())]).pipe((0,p.U)(function(u){var l=(0,b.Z)(u,3),c=l[1],m=l[2];return l[0].filter(function(x){var d,I;return(c===t.all||null!==(I=null===(d=x.Platforms)||void 0===d?void 0:d.includes(c))&&void 0!==I&&I)&&(m===t.all||x.Purpose===m)})}),(0,h.b)(function(u){var l,r;if(!u.some(function(m){return m.Key===t.controls.templateKey.value})){var c=null!==(r=null===(l=u[0])||void 0===l?void 0:l.Key)&&void 0!==r?r:null;t.controls.templateKey.value!==c&&t.controls.templateKey.patchValue(c)}})),P=(0,A.a)([this.controls.finalName.valueChanges.pipe((0,y.O)(this.controls.finalName.value),(0,g.x)()),this.controls.templateKey.valueChanges.pipe((0,y.O)(this.controls.templateKey.value),(0,g.x)())]).pipe(function X(o){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_,t=(0,O.H)(o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.z);return H(function(){return t},a)}(100,K.z,{leading:!0,trailing:!0}),(0,h.b)(function(){t.loadingPreview$.next(!0)}),(0,q.w)(function(u){var l=(0,b.Z)(u,2),r=l[0],c=l[1];return r&&c?(0,V.D)([t.sourceService.getPreview(r,c),(0,O.H)(500)]).pipe((0,p.U)(function(m){return(0,b.Z)(m,1)[0]})):(0,J.of)(void 0)}),(0,h.b)(function(){t.loadingPreview$.next(!1)}));this.templateVars$=(0,A.a)([s,Z,T,P,this.loadingPreview$]).pipe((0,p.U)(function(u){var d,l=(0,b.Z)(u,5),f=l[3];return{platforms:l[0],purposes:l[1],templates:l[2],loadingPreview:l[4],preview:null==f?void 0:f.Preview,previewValid:null!==(d=null==f?void 0:f.IsValid)&&void 0!==d&&d,previewError:null==f?void 0:f.Error}}))}}]),i}();return o.\u0275fac=function(a){return new(a||o)(e.Y36(N.WI),e.Y36(N.so),e.Y36(R.tk))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(a,t){2&a&&e.Ikx("className",t.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box","hide-scrollbar"],[1,"file-name"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],[1,"field-container","multiple"],[1,"multiple-field"],["appearance","standard","color","accent"],["formControlName","platform"],[3,"value",4,"ngFor","ngForOf"],["formControlName","purpose"],[1,"field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","preview-error",4,"ngIf"],[3,"value"],[3,"isError"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"preview-label-box"],[1,"preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"preview-error"]],template:function(a,t){1&a&&(e.YNc(0,pe,42,10,"ng-container",0),e.ALo(1,"async")),2&a&&e.Q6J("ngIf",e.lcZ(1,1,t.templateVars$))},directives:[F.O5,v._Y,v.JL,v.sg,Q.KE,Q.hX,Y.gD,v.JJ,v.u,F.sg,L.Nt,v.Fj,v.Q7,te,k.lW,ne.ey,oe.Y,W.$g,F.mk],pipes:[F.Ov],styles:[".dialog-title-box[_ngcontent-%COMP%]{justify-content:flex-start;align-items:baseline;line-height:normal;white-space:nowrap;overflow-x:auto}.dialog-title-box[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.field-container.multiple[_ngcontent-%COMP%]{display:flex}.field-container.multiple[_ngcontent-%COMP%]   .multiple-field[_ngcontent-%COMP%]{flex:1}.field-container.multiple[_ngcontent-%COMP%]   .multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.preview-label-box[_ngcontent-%COMP%]{position:relative}.preview-label-box[_ngcontent-%COMP%]   .preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0px;font-size:12px;color:#0009;pointer-events:none}.preview-label-box[_ngcontent-%COMP%]   .preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]}),o}(),de=n(8598),me=n(8450),ve=function(){var o=(0,D.Z)(function i(){(0,E.Z)(this,i)});return o.\u0275fac=function(a){return new(a||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[de._,R.tk],imports:[[F.ez,me.q,k.ot,Y.LD,v.UX,Q.lN,L.c,W.Cq]]}),o}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.01.00/ng-edit/default-projects_ng-dialogs_src_app_create-file-dialog_index_ts.e9375f742c84fa86.js.map