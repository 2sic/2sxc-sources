"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts"],{9976:(P,h,e)=>{e.r(h),e.d(h,{ManageContentListComponent:()=>j});var d=e(6554),u=e(6317),m=e(6562),M=e(635),f=e(9337),C=e(2225),p=e(9989),E=e(4536),c=e(60),t=e(3184),r=e(5758),l=e(2977),I=e(2528),L=e(7514),O=e(6362),T=e(9051),A=e(7317),B=e(6190),U=e(5590),Z=e(4240);function b(i,s){if(1&i){const n=t.EpF();t.ynx(0),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"button",12),t.NdJ("click",function(){return t.CHM(n),t.oxw(3).editHeader()}),t.TgZ(4,"mat-icon"),t._uU(5,"edit"),t.qZA()(),t.BQk()}if(2&i){const n=t.oxw(2).ngIf;t.xp6(2),t.Oqu(n.header.Title)}}function y(i,s){1&i&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"ManageContentList.NoHeader")))}function K(i,s){if(1&i&&(t.ynx(0),t.TgZ(1,"p",11),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"p",11),t.YNc(5,b,6,1,"ng-container",7),t.YNc(6,y,3,3,"ng-container",7),t.qZA(),t.BQk()),2&i){const n=t.oxw().ngIf;t.xp6(2),t.hij(" ",t.lcZ(3,3,"ManageContentList.Description")," "),t.xp6(3),t.Q6J("ngIf",n.header.Type),t.xp6(1),t.Q6J("ngIf",!n.header.Type)}}function R(i,s){1&i&&(t.TgZ(0,"p",13),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"ManageContentList.SortItems")," "))}function W(i,s){1&i&&(t.TgZ(0,"p",13),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"ManageContentList.SortLotsOfItems")," "))}function $(i,s){if(1&i){const n=t.EpF();t.TgZ(0,"div")(1,"button",18),t.NdJ("click",function(){t.CHM(n);const a=t.oxw().$implicit;return t.oxw(2).editItem(a.Id)}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()}}function k(i,s){if(1&i&&(t.TgZ(0,"div",14)(1,"div",15)(2,"mat-icon",16),t._uU(3,"drag_handle"),t.qZA(),t.TgZ(4,"span",17),t._uU(5),t.qZA()(),t.YNc(6,$,4,0,"div",7),t.qZA()),2&i){const n=s.$implicit;t.xp6(4),t.hYB("tippy","",n.Title," (",n.Id,")"),t.xp6(1),t.AsE(" ",n.Title," (",n.Id,") "),t.xp6(1),t.Q6J("ngIf",0!==n.Id)}}function Y(i,s){if(1&i){const n=t.EpF();t.TgZ(0,"div",6),t.YNc(1,K,7,5,"ng-container",7),t.YNc(2,R,3,3,"p",8),t.YNc(3,W,3,3,"p",8),t.TgZ(4,"div",9),t.NdJ("cdkDropListDropped",function(a){return t.CHM(n),t.oxw().drop(a)}),t.YNc(5,k,7,5,"div",10),t.qZA()()}if(2&i){const n=s.ngIf,o=t.oxw();t.xp6(1),t.Q6J("ngIf",n.header),t.xp6(1),t.Q6J("ngIf",n.items&&(null==n.items?null:n.items.length)<25),t.xp6(1),t.Q6J("ngIf",(null==n.items?null:n.items.length)>=25),t.xp6(2),t.Q6J("ngForOf",n.items)("ngForTrackBy",o.trackByFn)}}let j=(()=>{class i extends c.H{constructor(n,o,a,_,g,D,x){super(_,a),this.dialogRef=n,this.contentGroupService=o,this.snackBar=g,this.translate=D,this.appDialogConfigService=x,this.hostClass="dialog-component",this.items$=new u.X(null),this.header$=new u.X(null),this.templateVars$=(0,m.a)([this.items$,this.header$]).pipe((0,M.U)(([v,F])=>({items:v,header:F}))),this.contentGroup={id:null,guid:this.route.snapshot.paramMap.get("guid"),part:this.route.snapshot.paramMap.get("part"),index:parseInt(this.route.snapshot.paramMap.get("index"),10)},this.reordered=!1}ngOnInit(){this.fetchList(),this.fetchHeader(),this.subscription.add(this.refreshOnChildClosed().subscribe(()=>{this.fetchList(),this.fetchHeader()})),this.fetchDialogSettings()}ngOnDestroy(){this.items$.complete(),this.header$.complete(),super.ngOnDestroy()}fetchDialogSettings(){this.appDialogConfigService.getShared$().pipe((0,f.b)(n=>{this.translate.setDefaultLang(n.Context.Language.Primary.split("-")[0]),this.translate.use(n.Context.Language.Current.split("-")[0])})).subscribe()}closeDialog(){this.dialogRef.close()}saveList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(n=>{this.snackBar.open("Saved"),this.closeDialog()})}editHeader(){const o=(0,C.f)({items:[{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listcontent"},{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listpresentation"}]});this.router.navigate([`edit/${o}`],{relativeTo:this.route})}editItem(n){const a=(0,C.f)({items:[{EntityId:n}]});this.router.navigate([`edit/${a}`],{relativeTo:this.route})}drop(n){const o=[...this.items$.value];(0,d.bA)(o,n.previousIndex,n.currentIndex),this.items$.next(o),this.reordered=!0}trackByFn(n,o){return`${o.Index}+${o.Id}`}fetchList(){this.contentGroupService.getList(this.contentGroup).subscribe(n=>{if(this.reordered){const o=this.items$.value.map(_=>_.Id);if(this.items$.value.length!==n.length||n.some(_=>!o.includes(_.Id)))this.snackBar.open("List was changed from somewhere else. Order of items is reset",null,{duration:5e3});else{const _=this.items$.value.map(g=>g.Index);n.sort((g,D)=>{const x=_.indexOf(g.Index),v=_.indexOf(D.Index);return-1===x||-1===v?0:x-v})}}this.items$.next(n)})}fetchHeader(){this.contentGroupService.getHeader(this.contentGroup).subscribe(n=>{this.header$.next(n)})}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(r.so),t.Y36(p.e),t.Y36(l.gz),t.Y36(l.F0),t.Y36(I.ux),t.Y36(L.sK),t.Y36(E.Kw))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-manage-content-list"]],hostVars:1,hostBindings:function(n,o){2&n&&t.Ikx("className",o.hostClass)},features:[t.qOj],decls:14,vars:12,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["class","dialog-component-content fancy-scrollbar-light","cdkScrollable","",4,"ngIf"],[1,"dialog-component-actions"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["cdkScrollable","",1,"dialog-component-content","fancy-scrollbar-light"],[4,"ngIf"],["class","dialog-description sort-title",4,"ngIf"],["cdkDropList","",1,"dnd-list",3,"cdkDropListDropped"],["class","dnd-item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],[1,"dialog-description"],["mat-icon-button","","tippy","Edit header",3,"click"],[1,"dialog-description","sort-title"],["cdkDrag","",1,"dnd-item"],[1,"dnd-item__title"],["tippy","Drag to reorder the list",1,"dnd-item__title-icon"],[1,"dnd-item__title-text",3,"tippy"],["mat-icon-button","","tippy","Edit item","appMousedownStopPropagation","",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"translate"),t.qZA()(),t._UZ(4,"router-outlet"),t.YNc(5,Y,6,5,"div",2),t.ALo(6,"async"),t.TgZ(7,"div",3)(8,"button",4),t.NdJ("click",function(){return o.closeDialog()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",5),t.NdJ("click",function(){return o.saveList()}),t._uU(12),t.ALo(13,"translate"),t.qZA()()),2&n&&(t.xp6(2),t.Oqu(t.lcZ(3,4,"ManageContentList.Title")),t.xp6(3),t.Q6J("ngIf",t.lcZ(6,6,o.templateVars$)),t.xp6(4),t.Oqu(t.lcZ(10,8,"General.Buttons.Cancel")),t.xp6(3),t.Oqu(t.lcZ(13,10,"General.Buttons.Save")))},directives:[r.uh,l.lC,O.O5,T.PQ,A.lW,B.$,U.Hw,d.Wj,O.sg,d.Zt,Z.d],pipes:[L.X$,O.Ov],styles:[".sort-title[_ngcontent-%COMP%]{padding-top:16px}.dnd-list[_ngcontent-%COMP%]{margin:16px 0;border:1px solid #ccc;border-radius:4px;overflow:hidden}.dnd-item[_ngcontent-%COMP%]{cursor:move;height:40px;border-bottom:1px solid #ccc;padding:0 8px;display:flex;align-items:center;justify-content:space-between;background:white;box-sizing:border-box;font-size:14px}.dnd-item[_ngcontent-%COMP%]:last-child{border:none}.dnd-item__title[_ngcontent-%COMP%]{display:flex;align-items:center;overflow:hidden}.dnd-item__title-icon[_ngcontent-%COMP%]{margin-right:8px;opacity:.4}.dnd-item__title-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dnd-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dnd-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}),i})()},60:(P,h,e)=>{e.d(h,{H:()=>E});var d=e(2977),u=e(7714),m=e(116),M=e(4874),f=e(635),C=e(679),p=e(3184);let E=(()=>{class c{constructor(r,l){this.router=r,this.route=l,this.subscription=new u.w0}ngOnDestroy(){this.subscription.unsubscribe()}refreshOnChildClosed(){return this.router.events.pipe((0,m.h)(r=>r instanceof d.m2),(0,M.O)(!!this.route.snapshot.firstChild.firstChild),(0,f.U)(()=>!!this.route.snapshot.firstChild.firstChild),(0,C.G)(),(0,m.h)(([r,l])=>r&&!l))}}return c.\u0275fac=function(r){return new(r||c)(p.Y36(d.F0),p.Y36(d.gz))},c.\u0275dir=p.lG2({type:c}),c})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/15.00.00/ng-edit/projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts.4cf1179189472f94.js.map