"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_ts"],{62996(Y,K,a){a.d(K,{g:()=>ut});var O=a(79748),F=a(56884),D=a(36664),c=a(34456),U=a(84175),G=a(20762),M=a(87941),$=a(24950),S=a(93840),y=a(59791),T=a(41134),j=a(25175),R=a(75797),P=a(19999),g=a(63037),x=a(91817),i=a(70271),n=a(98764),l=a(18473),u=a(50819),h=a(91687),E=a(82645),V=a(74581);var k=a(36647),W=a(59452),Z=a(61873),H=a(12938),J=a(79996),Q=a(32760),_=a(13050),q=a(30281),tt=a(11855),et=a(37580),t=a(36124);let at=(()=>{class o{constructor(e,s){this.matInput=e,this.elementRef=s,this.autofocusSelectValue=(0,et.hFB)(!1)}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue())&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const s=e.toLocaleLowerCase();return"true"===s||"false"!==s&&void 0}return null==e?e:void 0}static{this.\u0275fac=function(s){return new(s||o)(t.rXU(y.fg),t.rXU(t.aKT))}}static{this.\u0275dir=t.FsC({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:[1,"autofocusSelectValue"]}})}}return o})();var st=a(63628),z=a(80423),ot=a(96462),it=a(55326);const L=o=>({disabled:o});function nt(o,v){if(1&o&&(t.j41(0,"mat-option",10),t.EFF(1),t.k0s()),2&o){const e=v.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function lt(o,v){if(1&o&&(t.j41(0,"mat-option",10),t.EFF(1),t.k0s()),2&o){const e=v.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function rt(o,v){if(1&o&&(t.j41(0,"mat-option",10),t.EFF(1),t.k0s()),2&o){const e=v.$implicit;t.Y8G("value",e.Key),t.R7$(),t.SpI(" ",e.Name," ")}}function pt(o,v){1&o&&(t.j41(0,"app-field-hint",14),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function dt(o,v){if(1&o&&(t.j41(0,"div",15)(1,"div",19)(2,"label",20),t.EFF(3,"Preview"),t.k0s()(),t.j41(4,"pre",21),t.EFF(5),t.k0s()()),2&o){const e=t.XpG();t.R7$(2),t.Y8G("ngClass",t.eq3(3,L,e.loadingPreview)),t.R7$(2),t.Y8G("ngClass",t.eq3(5,L,e.loadingPreview)),t.R7$(),t.JRh(e.preview)}}function ct(o,v){if(1&o&&(t.j41(0,"div",16),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.SpI(" ",e.previewError," ")}}function ht(o,v){1&o&&(t.j41(0,"div"),t.nrm(1,"mat-spinner",22)(2,"div",23),t.k0s())}function mt(o,v){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),t.EFF(4,"Create"),t.k0s(),t.j41(5,"span",3),t.EFF(6),t.k0s()(),t.j41(7,"button",4),t.bIt("click",function(){F.eBV(e);const m=t.XpG();return F.Njj(m.closeDialog())}),t.j41(8,"mat-icon"),t.EFF(9,"close"),t.k0s()()(),t.j41(10,"form",5)(11,"div",6)(12,"div",7)(13,"div")(14,"mat-form-field",8)(15,"mat-label"),t.EFF(16,"Platform"),t.k0s(),t.j41(17,"mat-select",9),t.Z7z(18,nt,2,2,"mat-option",10,t.fX1),t.k0s()()(),t.j41(20,"div")(21,"mat-form-field",8)(22,"mat-label"),t.EFF(23,"Purpose"),t.k0s(),t.j41(24,"mat-select",11),t.Z7z(25,lt,2,2,"mat-option",10,t.fX1),t.k0s()()()(),t.j41(27,"div",7)(28,"mat-form-field",8)(29,"mat-label"),t.EFF(30,"Template"),t.k0s(),t.j41(31,"mat-select",12),t.Z7z(32,rt,2,2,"mat-option",10,t.fX1),t.k0s()()(),t.j41(34,"div",7)(35,"mat-form-field",8)(36,"mat-label"),t.EFF(37,"Name"),t.k0s(),t.nrm(38,"input",13),t.k0s(),t.nVh(39,pt,2,1,"app-field-hint",14),t.k0s(),t.nVh(40,dt,6,7,"div",15),t.nVh(41,ct,2,1,"div",16),t.nVh(42,ht,3,0,"div"),t.k0s(),t.j41(43,"mat-dialog-actions",17)(44,"app-save-close-button-fab",18),t.bIt("action",function(){F.eBV(e);const m=t.XpG();return F.Njj(m.saveAndClose())}),t.k0s()()()()}if(2&o){const e=v,s=t.XpG();t.R7$(6),t.SpI(" ",s.controls.finalName.value||(s.controls.folder.value?s.controls.folder.value.trim()+"/":"")," "),t.R7$(4),t.Y8G("formGroup",s.ngForm),t.R7$(8),t.Dyx(e.platforms),t.R7$(7),t.Dyx(e.purposes),t.R7$(7),t.Dyx(e.templates),t.R7$(7),t.vxM(s.controls.name.touched&&null!=s.controls.name.errors&&s.controls.name.errors.required?39:-1),t.R7$(),t.vxM(e.preview?40:-1),t.R7$(),t.vxM(!e.loadingPreview&&e.previewError?41:-1),t.R7$(),t.vxM(e.loadingPreview?42:-1),t.R7$(2),t.Y8G("ngClass",s.canSave()?"":"disabled")("disabled",!s.canSave())("label","Form.Buttons.CreateAndClose")}}let ut=(()=>{class o extends q.${#t;#e;#a;#s;constructor(e,s){super(),this.dialogData=e,this.dialog=s,this.hostClass="dialog-component",this.#t="All",this.#s=(0,H.d)(J.F),this.formValid=(0,F.vPA)(!1),this.loadingPreview=(0,F.vPA)(!1),this.previewValid=(0,F.vPA)(!1),this.canSave=(0,D.EW)(()=>this.formValid()&&!this.loadingPreview()&&this.previewValid())}ngOnInit(){this.#l(),this.#e=new R.t([]),this.#a=new R.t(!1),this.#i(),this.#o(),this.#n(),this.subscriptions.add(this.#a.subscribe(e=>this.loadingPreview.set(e)))}ngAfterViewInit(){this.ngForm?.statusChanges.subscribe(()=>{this.formValid.set(this.ngForm?.valid??!1)})}ngOnDestroy(){this.#e.complete(),this.#a.complete(),super.ngOnDestroy()}#o(){this.#s.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).then(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.#e.next(e.Templates)})}#i(){this.ngForm=new c.J3({platform:new c.hs(this.#t),purpose:new c.hs({value:this.dialogData.purpose??this.#t,disabled:null!=this.dialogData.purpose}),templateKey:new c.hs(null,c.k0.required),name:new c.hs(this.dialogData.name??null,c.k0.required),finalName:new c.hs({value:null,disabled:!0}),folder:new c.hs({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.ngForm.controls,this.subscriptions.add((0,P.z)([this.#e,this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,x.F)())]).subscribe(([e,s])=>{const m=e.find(r=>r.Key===s),f=this.dialogData.name?this.controls.name.value||this.dialogData.name:m?.SuggestedFileName??null;this.controls.name.value!==f&&this.controls.name.patchValue(f)})),this.subscriptions.add((0,P.z)([this.#e,this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,x.F)()),this.controls.name.valueChanges.pipe((0,g.Z)(this.controls.name.value),(0,x.F)()),this.controls.folder.valueChanges.pipe((0,g.Z)(this.controls.folder.value),(0,x.F)())]).subscribe(([e,s,m,f])=>{const r=e.find(d=>d.Key===s);let p=null;m&&(f=f.trim(),m=_.SX.sanitizePath(m.trim()),p=`${f?`${f}/`:""}${m=`${r?.Prefix??""}${m}${r?.Suffix??""}${r?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==p&&this.controls.finalName.patchValue(p)}))}#n(){const e=this.#e.pipe((0,i.T)(r=>{const p={[this.#t]:this.#t};return r.forEach(d=>{d.Platforms?.forEach(C=>{p[C]=C})}),Object.keys(p)})),s=this.#e.pipe((0,i.T)(r=>{const p={[this.#t]:this.#t};return r.forEach(d=>{p[d.Purpose]=d.Purpose}),Object.keys(p)})),m=(0,P.z)([this.#e,this.controls.platform.valueChanges.pipe((0,g.Z)(this.controls.platform.value),(0,x.F)()),this.controls.purpose.valueChanges.pipe((0,g.Z)(this.controls.purpose.value),(0,x.F)())]).pipe((0,i.T)(([r,p,d])=>r.filter(I=>{const w=p===this.#t||(I.Platforms?.includes(p)??!1),N=d===this.#t||I.Purpose===d;return w&&N})),(0,n.M)(r=>{if(!r.some(p=>p.Key===this.controls.templateKey.value)){const p=r[0]?.Key??null;this.controls.templateKey.value!==p&&this.controls.templateKey.patchValue(p)}})),f=(0,P.z)([this.controls.finalName.valueChanges.pipe((0,g.Z)(this.controls.finalName.value),(0,x.F)()),this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,x.F)())]).pipe(function B(o,v=l.E,e){const s=(0,V.O)(o,v);return function A(o,v){return(0,u.N)((e,s)=>{const{leading:m=!0,trailing:f=!1}=v??{};let r=!1,p=null,d=null,C=!1;const I=()=>{d?.unsubscribe(),d=null,f&&(X(),C&&s.complete())},w=()=>{d=null,C&&s.complete()},N=b=>d=(0,E.Tg)(o(b)).subscribe((0,h._)(s,I,w)),X=()=>{if(r){r=!1;const b=p;p=null,s.next(b),!C&&N(b)}};e.subscribe((0,h._)(s,b=>{r=!0,p=b,(!d||d.closed)&&(m?X():N(b))},()=>{C=!0,(!(f&&r&&d)||d.closed)&&s.complete()}))})}(()=>s,e)}(100,l.E,{leading:!0,trailing:!0}),(0,n.M)(()=>{this.#a.next(!0)}),(0,k.n)(([r,p])=>r&&p?(0,Z.p)([this.#s.getPreview(r,this.dialogData.global,p),(0,V.O)(500)]).pipe((0,i.T)(([d])=>d)):(0,W.of)(void 0)),(0,n.M)(()=>{this.#a.next(!1)}));this.subscriptions.add(f.subscribe(r=>{this.previewValid.set(r?.IsValid??!1)})),this.viewModel$=(0,P.z)([e,s,m,f,this.#a]).pipe((0,i.T)(([r,p,d,C,I])=>({platforms:r,purposes:p,templates:d,loadingPreview:I,preview:C?.Preview,previewValid:C?.IsValid??!1,previewError:C?.Error})))}closeDialog(e){this.dialog.close(e)}saveAndClose(){const e=this.ngForm.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}#l(){this.dialog.keydownEvents().subscribe(e=>{(0,Q.YU)(e)&&this.canSave()&&(e.preventDefault(),this.saveAndClose())})}static{this.\u0275fac=function(s){return new(s||o)(t.rXU(M.Vh),t.rXU(M.CP))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(s,m){2&s&&t.Avn("className",m.hostClass)},features:[t.Vt3],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],["mat-icon-button","","tippy","Close dialog",3,"click"],[3,"formGroup"],[1,"eav-dialog-content"],[1,"eav-field-container"],["color","accent",1,"eav-mat-form-field"],["formControlName","platform"],[3,"value"],["formControlName","purpose"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"eav-preview-container"],[1,"eav-preview-error"],["align","end"],[3,"action","ngClass","disabled","label"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"]],template:function(s,m){if(1&s&&(t.nVh(0,mt,45,9,"div",0),t.nI1(1,"async")),2&s){let f;t.vxM((f=t.bMT(1,1,m.viewModel$))?0:-1,f)}},dependencies:[c.YN,c.qT,c.me,c.BC,c.cb,c.YS,c.X1,c.j4,c.JD,$.RG,z.rl,z.nJ,j.Ve,j.VO,ot.wT,G.S,y.fS,y.fg,S.m_,S.An,M.E7,T.D6,T.LG,U.Hl,it.iY,O.YU,tt.F,at,st.i,O.Jj],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{overflow-x:auto;max-width:450px;font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-preview-container[_ngcontent-%COMP%]{margin:8px 6px 6px;display:flex;flex-direction:column;align-items:stretch}.eav-preview-label-box[_ngcontent-%COMP%]{margin-bottom:4px}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto;max-height:55vh}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}"]})}}return o})()},79996(Y,K,a){a.d(K,{F:()=>P});var O=a(46443),F=a(36664),D=a(70271),c=a(96474),U=a(56884),G=a(36124);const $="admin/AppFiles/asset",T="admin/ApiExplorer/AppApiFiles";let P=(()=>{class g extends c.D{get(i,n,l){return this.getHttpApiUrl($,{params:{appId:this.appId,global:n,...this.templateIdOrPath(i,n,l)}}).pipe((0,D.T)(u=>{if("auto"===u.Type.toLocaleLowerCase())switch(u.Extension.toLocaleLowerCase()){case".cs":case".cshtml":u.Type="Razor";break;case".html":case".css":case".js":u.Type="Token"}return u}))}save(i,n,l,u){return this.http.post(this.apiUrl($),l,{params:{appId:this.appId,global:n,...this.templateIdOrPath(i,n,u)}})}getAllPromise(i){return this.fetchPromise("admin/AppFiles/AppFiles",{params:{appId:this.appId,...i&&{mask:i}}}).then(({Files:n})=>(n.forEach(l=>{l.Shared??=!1}),n))}getWebApis(){return this.getHttpApiUrl(T,{params:{appId:this.appId}}).pipe((0,D.T)(({files:i})=>(i.forEach(n=>{n.isShared??=!1,n.isCompiled??=!1}),i))).pipe((0,D.T)(i=>i.map(l=>{const u=l.path.lastIndexOf("/"),h=l.path.lastIndexOf("."),E=l.path.substring(0,u),A=l.path.substring(u+1,h);return{path:l.path,folder:E,name:A,isShared:l.isShared,endpointPath:l.endpointPath,isCompiled:l.isCompiled,edition:l.edition}})))}getWebApisLive(i){const n=(0,O.fx)(()=>(i(),{url:this.apiUrl(T),params:{appId:this.appId}}));return(0,F.EW)(()=>{const u=n.value()?.files;return u?(u.forEach(h=>{h.isShared??=!1,h.isCompiled??=!1}),u.map(h=>{const E=h.path.lastIndexOf("/"),A=h.path.lastIndexOf("."),V=h.path.substring(0,E),B=h.path.substring(E+1,A);return{path:h.path,folder:V,name:B,isShared:h.isShared,endpointPath:h.endpointPath,isCompiled:h.isCompiled,edition:h.edition}})):[]})}getWebApiDetails(i){return this.getHttpApiUrl("admin/ApiExplorer/inspect",{params:{appId:this.appId,zoneId:this.zoneId,path:i}})}getPredefinedTemplates(i,n){return this.fetchPromise("admin/AppFiles/GetTemplates",{params:{...i&&{purpose:i},...n&&{type:n}}})}getPreview(i,n,l){return this.getHttpApiUrl("admin/AppFiles/preview",{params:{appId:this.appId,path:i,templateKey:l,global:n}})}create(i,n,l){return this.http.post(this.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.appId,global:n,purpose:"auto",path:i,templateKey:l}})}templateIdOrPath(i,n,l){if(/^[0-9]*$/g.test(i)){const u=l.find(h=>h.EntityId?.toString()===i&&h.IsShared===n)?.Path;return{templateId:i,...null!=u&&{path:u}}}return{path:i}}static{this.\u0275fac=(()=>{let i;return function(l){return(i||(i=G.xGo(g)))(l||g)}})()}static{this.\u0275prov=U.jDH({token:g,factory:g.\u0275fac})}}return g})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.01.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_ts.0c72f4e5bb549bb9.js.map