{"version":3,"file":"projects_eav-ui_src_app_app-administration_app-extensions_inspect-dialog_inspect-extension-di-fe8285.3156e25fd8722832.js","mappings":"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","names":["InspectExtensionDialog","constructor","this","#extensionsSvc","transient","AppExtensionsService","dialog","inject","MatDialogRef","#route","ActivatedRoute","extensionFolder","snapshot","paramMap","get","edition","queryParamMap","preflightResult","preflightExtension","value","selectors","decls","vars","consts","template","rf","ctx","i0","close","MatButtonModule","i1","MatIconModule","i2","MatSlideToggleModule","FormsModule","MatCardModule","MatExpansionModule","InspectExtensionComponent","TippyDirective","styles","HttpServiceBase","log","classLog","getAllLive","refresh","newHttpResource","url","apiUrl","params","appId","method","getAll","http","updateConfiguration","name","config","configJson","JSON","parse","post","zoneId","downloadExtension","folder","URLSearchParams","toString","window","open","installRemoteExtension","editions","overwrite","body","installPreflightExtensionFromUrl","uploadExtensions","file","formData","FormData","append","pipe","map","success","Success","Messages","MessageType","Text","installPreflightExtension","files","forEach","deleteExtension","force","withData","delete","__ngFactoryType__","factory","Éµfac"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/app-extensions/inspect-dialog/inspect-extension-dialog.ts","./projects/eav-ui/src/app/app-administration/app-extensions/inspect-dialog/inspect-extension-dialog.html","./projects/eav-ui/src/app/app-administration/app-extensions/app-extensions.service.ts"],"sourcesContent":["import { Component, inject } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\nimport { MatExpansionModule } from '@angular/material/expansion';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { transient } from 'projects/core';\r\nimport { TippyDirective } from '../../../shared/directives/tippy.directive';\r\nimport { AppExtensionsService } from '../app-extensions.service';\r\nimport { InspectExtensionComponent } from '../inspect/inspect-extension-content';\r\n\r\n@Component({\r\n  templateUrl: './inspect-extension-dialog.html',\r\n  styleUrls: ['./inspect-extension-dialog.scss'],\r\n  imports: [\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatSlideToggleModule,\r\n    FormsModule,\r\n    MatCardModule,\r\n    MatExpansionModule,\r\n    InspectExtensionComponent,\r\n    TippyDirective,\r\n  ]\r\n})\r\nexport class InspectExtensionDialog {\r\n  #extensionsSvc = transient(AppExtensionsService);\r\n\r\n  dialog = inject(MatDialogRef<{}>);\r\n  #route = inject(ActivatedRoute);\r\n\r\n  extensionFolder = this.#route.snapshot.paramMap.get('extension');\r\n  edition = this.#route.snapshot.queryParamMap.get('edition') || '';\r\n\r\n  preflightResult = this.#extensionsSvc.preflightExtension(this.extensionFolder, this.edition).value;\r\n}\r\n","<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">\r\n      Inspect Extension:\r\n      {{ extensionFolder || 'No Extension' }}\r\n      ({{ edition || 'Default' }})\r\n    </div>\r\n    <button mat-icon-button tippy=\"Close dialog\" (click)=\"this.dialog.close()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"eav-dialog-content\">\r\n    <app-inspect-extension [data]=\"preflightResult()\" />\r\n  </div>\r\n</div>\r\n","import { Injectable, Signal } from '@angular/core';\r\nimport { map } from 'rxjs';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog/file-upload-dialog.models';\r\nimport { classLog } from '../../shared/logging';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { Extension, ExtensionInspectResult, ExtensionPreflightItem } from './extension.model';\r\n\r\n@Injectable()\r\nexport class AppExtensionsService extends HttpServiceBase {\r\n  log = classLog({ AppExtensionsService });\r\n\r\n  /** Get all extensions with live refresh capability */\r\n  getAllLive(refresh: Signal<unknown>) {\r\n    return this.newHttpResource<{ extensions: Extension[] }>(() => {\r\n      // Watch the refresh signal to trigger reloads\r\n      refresh();\r\n\r\n      return {\r\n        url: this.apiUrl('admin/appExtensions/extensions'),\r\n        params: { appId: this.appId },\r\n        method: 'GET',\r\n      };\r\n    });\r\n  }\r\n\r\n  getAll() {\r\n    return this.http.get<{ extensions: Extension[] }>(this.apiUrl('admin/appExtensions/extensions'), {\r\n      params: { appId: this.appId },\r\n    });\r\n  }\r\n\r\n  /** Update config (mutations still best done via HttpClient per Angular docs) */\r\n  updateConfiguration(name: string, config: string) {\r\n    // Parse the config to JsonElement format that the API expects\r\n    const configJson = JSON.parse(config);\r\n\r\n    return this.http.post<boolean>(this.apiUrl('admin/appExtensions/configuration'), configJson, {\r\n      params: {\r\n        zoneId: this.zoneId,\r\n        appId: this.appId,\r\n        name\r\n      },\r\n    });\r\n  }\r\n\r\n  /** Open download link for an extension */\r\n  downloadExtension(folder: string) {\r\n    const params = new URLSearchParams({\r\n      appId: this.appId,\r\n      zoneId: this.zoneId,\r\n      name: folder,\r\n    });\r\n    const url = `${this.apiUrl('admin/appExtensions/download')}?${params.toString()}`;\r\n    window.open(url, '_blank', '');\r\n  }\r\n\r\n  /** Install a remote extension by URL - v2: POST to .InstallFrom with url(s) in body */\r\n  installRemoteExtension(url: string, editions?: string, overwrite?: boolean) {\r\n    // Always use array of string (even if only one for now)\r\n    const body = [url];\r\n\r\n    const params: any = {\r\n      appId: this.appId,\r\n      zoneId: this.zoneId,\r\n      ...(editions ? { editions } : {}),\r\n      ...(overwrite ? { overwrite } : {})\r\n    };\r\n\r\n    return this.http.post<boolean>(\r\n      this.apiUrl('admin/appExtensions/InstallFrom'),\r\n      body,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  /** Preflight a remote extension by URL - v2: POST to .InstallPreflightFrom with url(s) in body */\r\n  installPreflightExtensionFromUrl(url: string, editions?: string) {\r\n    const body = [url];\r\n\r\n    const params: any = {\r\n      appId: this.appId,\r\n      ...(editions ? { editions } : {})\r\n    };\r\n\r\n    return this.http.post<{ extensions: ExtensionPreflightItem[] }>(\r\n      this.apiUrl('admin/appExtensions/InstallPreflightFrom'),\r\n      body,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  /** Uploads extension files (no change, still uses FormData) */\r\n  uploadExtensions(file: File, editions?: string, overwrite?: boolean) {\r\n    const formData = new FormData();\r\n    formData.append('files', file);\r\n\r\n    const params = {\r\n      appId: this.appId,\r\n      zoneId: this.zoneId,\r\n      ...(editions ? { editions } : {}),\r\n      ...(overwrite ? { overwrite } : {})\r\n    };\r\n\r\n    return this.http.post<boolean>(this.apiUrl('admin/appExtensions/install'), formData, {\r\n      params,\r\n    }).pipe(\r\n      map((success: boolean): FileUploadResult => ({\r\n        Success: success,\r\n        Messages: success\r\n          ? [{ MessageType: 1, Text: 'Extension uploaded successfully' }]\r\n          : [{ MessageType: 2, Text: 'Extension upload failed' }]\r\n      }))\r\n    );\r\n  }\r\n\r\n  /** Preflight file upload (no change, still uses FormData) */\r\n  installPreflightExtension(files: File[]) {\r\n    const formData = new FormData();\r\n    files.forEach(file => formData.append('files', file));\r\n\r\n    return this.http.post<{ extensions: ExtensionPreflightItem[] }>(\r\n      this.apiUrl('admin/appExtensions/installPreflight'),\r\n      formData,\r\n      {\r\n        params: {\r\n          appId: this.appId,\r\n          zoneId: this.zoneId\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  preflightExtension(name: string, edition?: string) {\r\n    const params: { appId: string, name: string, edition?: string } = {\r\n      appId: this.appId,\r\n      name,\r\n    };\r\n    if (edition) params.edition = edition;\r\n\r\n    return this.newHttpResource<ExtensionInspectResult>(() => ({\r\n      url: this.apiUrl('admin/appExtensions/inspect'),\r\n      params,\r\n      method: 'GET',\r\n    }));\r\n  }\r\n\r\n  deleteExtension(name: string, edition?: string, force = false, withData = false) {\r\n    const params = {\r\n      appId: this.appId,\r\n      name,\r\n      force,\r\n      withData,\r\n      ...(edition ? { edition: edition } : {})\r\n    };\r\n\r\n    return this.http.delete<boolean>(\r\n      this.apiUrl('admin/appExtensions/delete'),\r\n      { params }\r\n    );\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}