"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_index_ts"],{1485:(z,E,a)=>{a.d(E,{t:()=>K});var u=a(9736),D=a(2611),P=a(9039),O=a(4860),v=a(6232);const C="admin/AppFiles/asset";let K=(()=>{class I{constructor(i,s,c){this.http=i,this.context=s,this.dnnContext=c}get(i,s,c){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(C),{params:{appId:this.context.appId,global:s,...this.templateIdOrPath(i,s,c)}}).pipe((0,u.U)(h=>{if("auto"===h.Type.toLocaleLowerCase())switch(h.Extension.toLocaleLowerCase()){case".cs":case".cshtml":h.Type="Razor";break;case".html":case".css":case".js":h.Type="Token"}return h}))}save(i,s,c,h){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(C),c,{params:{appId:this.context.appId,global:s,...this.templateIdOrPath(i,s,h)}})}getAll(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.context.appId,...i&&{mask:i}}}).pipe((0,u.U)(({Files:s})=>(s.forEach(c=>{c.Shared??=!1}),s)))}getWebApis(){return this.getAll("*Controller.cs").pipe((0,u.U)(i=>i.map(c=>{const h=c.Path.lastIndexOf("/"),T=c.Path.lastIndexOf("."),_=c.Path.substring(0,h),J=c.Path.substring(h+1,T);return{path:c.Path,folder:_,name:J,isShared:c.Shared}})))}getWebApiDetails(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:i}})}getPredefinedTemplates(i,s){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:{...i&&{purpose:i},...s&&{type:s}}})}getPreview(i,s,c){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:i,templateKey:c,global:s}})}create(i,s,c){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:s,purpose:"auto",path:i,templateKey:c}})}templateIdOrPath(i,s,c){if(/^[0-9]*$/g.test(i)){const h=c.find(T=>T.EntityId?.toString()===i&&T.IsShared===s)?.Path;return{templateId:i,...null!=h&&{path:h}}}return{path:i}}static#t=this.\u0275fac=function(s){return new(s||I)(P.LFG(O.eN),P.LFG(D._),P.LFG(v._y))};static#e=this.\u0275prov=P.Yz7({token:I,factory:I.\u0275fac})}return I})()},7220:(z,E,a)=>{a.d(E,{UH:()=>at,qH:()=>rt});var u=a(8849),D=a(6861),P=a(8071),O=a(3839),v=a(5043),x=a(3317),C=a(9736),M=a(3738),Z=a(7777),N=a(4114),F=a(5678),K=a(384),Q=a(9378);var s=a(1891),c=a(4980),h=a(4300),T=a(1485),_=a(926),J=a(9097),t=a(9039),b=a(6575),R=a(9851),S=a(9674);let W=(()=>{class o{constructor(e,n){this.matInput=e,this.elementRef=n,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const n=e.toLocaleLowerCase();return"true"===n||"false"!==n&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(S.Nt),t.Y36(t.SBq))};static#e=this.\u0275dir=t.lG2({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}})}return o})();var L=a(895),U=a(1268),V=a(6355),G=a(257),B=a(3910);function H(o,m){if(1&o&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&o){const e=m.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function X(o,m){if(1&o&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&o){const e=m.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function q(o,m){if(1&o&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&o){const e=m.$implicit;t.Q6J("value",e.Key),t.xp6(1),t.hij(" ",e.Name," ")}}function k(o,m){1&o&&(t.TgZ(0,"app-field-hint",23),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}function tt(o,m){1&o&&(t.ynx(0),t._UZ(1,"mat-spinner",24)(2,"div",25),t.BQk())}const Y=o=>({disabled:o});function et(o,m){if(1&o&&(t.ynx(0),t.TgZ(1,"div",26)(2,"label",27),t._uU(3,"Preview"),t.qZA()(),t.TgZ(4,"pre",28),t._uU(5),t.qZA(),t.BQk()),2&o){const e=t.oxw().ngIf;t.xp6(2),t.Q6J("ngClass",t.VKq(3,Y,e.loadingPreview)),t.xp6(2),t.Q6J("ngClass",t.VKq(5,Y,e.loadingPreview)),t.xp6(1),t.Oqu(e.preview)}}function nt(o,m){if(1&o&&(t.TgZ(0,"div",29),t._uU(1),t.qZA()),2&o){const e=t.oxw().ngIf;t.xp6(1),t.hij(" ",e.previewError," ")}}function ot(o,m){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),t._uU(5,"Create"),t.qZA(),t.TgZ(6,"span",4),t._uU(7),t.qZA()()(),t.TgZ(8,"div",5)(9,"form",6)(10,"div",7)(11,"div",8)(12,"div",9)(13,"mat-form-field",10)(14,"mat-label"),t._uU(15,"Platform"),t.qZA(),t.TgZ(16,"mat-select",11),t.YNc(17,H,2,2,"mat-option",12),t.qZA()()(),t.TgZ(18,"div",9)(19,"mat-form-field",10)(20,"mat-label"),t._uU(21,"Purpose"),t.qZA(),t.TgZ(22,"mat-select",13),t.YNc(23,X,2,2,"mat-option",12),t.qZA()()()(),t.TgZ(24,"div",14)(25,"mat-form-field",10)(26,"mat-label"),t._uU(27,"Template"),t.qZA(),t.TgZ(28,"mat-select",15),t.YNc(29,q,2,2,"mat-option",12),t.qZA()()(),t.TgZ(30,"div",14)(31,"mat-form-field",10)(32,"mat-label"),t._uU(33,"Name"),t.qZA(),t._UZ(34,"input",16),t.qZA(),t.YNc(35,k,2,1,"app-field-hint",17),t.qZA()(),t.TgZ(36,"div",18),t.YNc(37,tt,3,0,"ng-container",0),t.TgZ(38,"button",19),t.NdJ("click",function(){t.CHM(e);const d=t.oxw();return t.KtG(d.closeDialog())}),t._uU(39,"Cancel"),t.qZA(),t.TgZ(40,"button",20),t.NdJ("click",function(){t.CHM(e);const d=t.oxw();return t.KtG(d.confirm())}),t._uU(41," Create "),t.qZA()(),t.YNc(42,et,6,7,"ng-container",0)(43,nt,2,1,"div",21),t.qZA()()(),t.BQk()}if(2&o){const e=m.ngIf,n=t.oxw();t.xp6(7),t.Oqu(n.controls.finalName.value||(n.controls.folder.value?n.controls.folder.value.trim()+"/":"")),t.xp6(2),t.Q6J("formGroup",n.form),t.xp6(8),t.Q6J("ngForOf",e.platforms),t.xp6(6),t.Q6J("ngForOf",e.purposes),t.xp6(6),t.Q6J("ngForOf",e.templates),t.xp6(6),t.Q6J("ngIf",n.controls.name.touched&&(null==n.controls.name.errors?null:n.controls.name.errors.required)),t.xp6(2),t.Q6J("ngIf",e.loadingPreview),t.xp6(3),t.Q6J("disabled",!n.form.valid||e.loadingPreview||!e.previewValid),t.xp6(2),t.Q6J("ngIf",e.preview),t.xp6(1),t.Q6J("ngIf",!e.loadingPreview&&e.previewError)}}let at=(()=>{class o extends J.f{constructor(e,n,d){super(),this.dialogData=e,this.dialogRef=n,this.sourceService=d,this.hostClass="dialog-component",this.all="All"}ngOnInit(){this.templates$=new P.X([]),this.loadingPreview$=new P.X(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new u.nJ({platform:new u.p4(this.all),purpose:new u.p4({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new u.p4(null,u.kI.required),name:new u.p4(this.dialogData.name??null,u.kI.required),finalName:new u.p4({value:null,disabled:!0}),folder:new u.p4({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,O.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,v.O)(this.controls.templateKey.value),(0,x.x)())]).subscribe(([e,n])=>{const d=e.find(r=>r.Key===n),f=this.dialogData.name?this.controls.name.value||this.dialogData.name:d?.SuggestedFileName??null;this.controls.name.value!==f&&this.controls.name.patchValue(f)})),this.subscription.add((0,O.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,v.O)(this.controls.templateKey.value),(0,x.x)()),this.controls.name.valueChanges.pipe((0,v.O)(this.controls.name.value),(0,x.x)()),this.controls.folder.valueChanges.pipe((0,v.O)(this.controls.folder.value),(0,x.x)())]).subscribe(([e,n,d,f])=>{const r=e.find(p=>p.Key===n);let l=null;d&&(f=f.trim(),d=_.vl.sanitizePath(d.trim()),l=`${f?`${f}/`:""}${d=`${r?.Prefix??""}${d}${r?.Suffix??""}${r?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==l&&this.controls.finalName.patchValue(l)}))}buildViewModel(){const e=this.templates$.pipe((0,C.U)(r=>{const l={[this.all]:this.all};return r.forEach(p=>{p.Platforms?.forEach(g=>{l[g]=g})}),Object.keys(l)})),n=this.templates$.pipe((0,C.U)(r=>{const l={[this.all]:this.all};return r.forEach(p=>{l[p.Purpose]=p.Purpose}),Object.keys(l)})),d=(0,O.a)([this.templates$,this.controls.platform.valueChanges.pipe((0,v.O)(this.controls.platform.value),(0,x.x)()),this.controls.purpose.valueChanges.pipe((0,v.O)(this.controls.purpose.value),(0,x.x)())]).pipe((0,C.U)(([r,l,p])=>r.filter(A=>(l===this.all||(A.Platforms?.includes(l)??!1))&&(p===this.all||A.Purpose===p))),(0,M.b)(r=>{if(!r.some(l=>l.Key===this.controls.templateKey.value)){const l=r[0]?.Key??null;this.controls.templateKey.value!==l&&this.controls.templateKey.patchValue(l)}})),f=(0,O.a)([this.controls.finalName.valueChanges.pipe((0,v.O)(this.controls.finalName.value),(0,x.x)()),this.controls.templateKey.valueChanges.pipe((0,v.O)(this.controls.templateKey.value),(0,x.x)())]).pipe(function i(o,m=Z.z,e){const n=(0,Q.H)(o,m);return function I(o,m){return(0,N.e)((e,n)=>{const{leading:d=!0,trailing:f=!1}=m??{};let r=!1,l=null,p=null,g=!1;const A=()=>{p?.unsubscribe(),p=null,f&&(j(),g&&n.complete())},w=()=>{p=null,g&&n.complete()},$=y=>p=(0,K.Xf)(o(y)).subscribe((0,F.x)(n,A,w)),j=()=>{if(r){r=!1;const y=l;l=null,n.next(y),!g&&$(y)}};e.subscribe((0,F.x)(n,y=>{r=!0,l=y,(!p||p.closed)&&(d?j():$(y))},()=>{g=!0,(!(f&&r&&p)||p.closed)&&n.complete()}))})}(()=>n,e)}(100,Z.z,{leading:!0,trailing:!0}),(0,M.b)(()=>{this.loadingPreview$.next(!0)}),(0,s.w)(([r,l])=>r&&l?(0,h.D)([this.sourceService.getPreview(r,this.dialogData.global,l),(0,Q.H)(500)]).pipe((0,C.U)(([p])=>p)):(0,c.of)(void 0)),(0,M.b)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,O.a)([e,n,d,f,this.loadingPreview$]).pipe((0,C.U)(([r,l,p,g,A])=>({platforms:r,purposes:l,templates:p,loadingPreview:A,preview:g?.Preview,previewValid:g?.IsValid??!1,previewError:g?.Error})))}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(D.WI),t.Y36(D.so),t.Y36(T.t))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(n,d){2&n&&t.Ikx("className",d.hostClass)},features:[t.qOj],decls:2,vars:3,consts:[[4,"ngIf"],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-form-field"],["formControlName","platform"],[3,"value",4,"ngFor","ngForOf"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","eav-preview-error",4,"ngIf"],[3,"value"],[3,"isError"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"eav-preview-error"]],template:function(n,d){1&n&&(t.YNc(0,ot,44,10,"ng-container",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,d.viewModel$))},dependencies:[b.mk,b.sg,b.O5,R.Y,W,L.lW,U.KE,U.hX,V.gD,G.ey,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.sg,u.u,S.Nt,B.Ou,b.Ov],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}return o})();var it=a(2611),lt=a(7138),st=a(8497);let rt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({providers:[it._,T.t,{provide:U.o2,useValue:{subscriptSizing:"dynamic"}},{provide:V.PG,useValue:{hideSingleSelectionIndicator:!0}}],imports:[b.ez,lt.q,L.ot,V.LD,u.UX,U.lN,S.c,B.Cq,st.QW]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.00.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_index_ts.373ae383fda4d9ac.js.map