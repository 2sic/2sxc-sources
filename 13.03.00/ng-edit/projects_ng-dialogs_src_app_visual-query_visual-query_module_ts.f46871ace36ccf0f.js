"use strict";(self.webpackChunkng_dialogs=self.webpackChunkng_dialogs||[]).push([["projects_ng-dialogs_src_app_visual-query_visual-query_module_ts"],{6150:function(Nt,z,p){p.r(z),p.d(z,{VisualQueryModule:function(){return qt}});var b=p(8047),C=p(8069),m=p(6362),T=p(587),w=p(7317),S=p(5758),$=p(4770),E=p(5590),X=p(4683),K=p(1434),R=p(6623),ee=p(2528),J=p(2379),te=p(5005),ne=p(4753),L=p(8598),ue=p(8450),q=p(5106),x=p(635),O=p(7854),Z=p(1825),e=p(7133),ce=p(8784),pe=p(2425),j=function(){var o=function(){function l(n,t,i){(0,C.Z)(this,l),this.http=n,this.context=t,this.dnnContext=i}return(0,b.Z)(l,[{key:"fetchPipeline",value:function(t,i){var a=this;return this.http.get(this.dnnContext.$2sxc.http.apiUrl(O.TB),{params:{appId:this.context.appId.toString(),id:t.toString()}}).pipe((0,x.U)(function(r){return r.DataSources.length||a.buildDefaultModel(r,i),a.fixPipelineDataSources(r.DataSources),r}))}},{key:"buildDefaultModel",value:function(t,i){var s,r=(0,q.Z)(Z.Z.pipelineDesigner.defaultPipeline.dataSources);try{var c=function(){var d=s.value,f=i.find(function(v){return v.PartAssemblyAndType===d.PartAssemblyAndType});t.DataSources.push({Description:"",EntityGuid:d.EntityGuid,EntityId:void 0,Name:f.Name,PartAssemblyAndType:d.PartAssemblyAndType,VisualDesignerData:d.VisualDesignerData})};for(r.s();!(s=r.n()).done;)c()}catch(u){r.e(u)}finally{r.f()}t.Pipeline.StreamWiring=Z.Z.pipelineDesigner.defaultPipeline.streamWiring}},{key:"fixPipelineDataSources",value:function(t){var i;if(!t.some(function(f){return f.EntityGuid===Z.Z.pipelineDesigner.outDataSource.EntityGuid})){var r=Z.Z.pipelineDesigner.outDataSource;t.push({Description:r.Description,EntityGuid:r.EntityGuid,EntityId:void 0,Name:r.Name,PartAssemblyAndType:r.PartAssemblyAndType,VisualDesignerData:r.VisualDesignerData})}var u,c=(0,q.Z)(t);try{for(c.s();!(u=c.n()).done;){var d=u.value;null!==(i=d.VisualDesignerData)&&void 0!==i||(d.VisualDesignerData={Top:50,Left:50})}}catch(f){c.e(f)}finally{c.f()}}},{key:"fetchDataSources",value:function(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(O.bf)).pipe((0,x.U)(function(t){var i=Z.Z.pipelineDesigner.outDataSource;return t.push({ContentType:void 0,Difficulty:Z.Z.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:i.In,Name:i.Name,Out:void 0,PartAssemblyAndType:i.PartAssemblyAndType,PrimaryType:i.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),t}))}},{key:"typeNameFilter",value:function(t,i){var a=t.split(", ");switch(i){case"classFullName":return a[0];case"className":var s=a[0].split(".");return s[s.length-1];default:return t}}},{key:"savePipeline",value:function(t){var i=this,a=t.Pipeline,r=t.DataSources;return this.http.post(this.dnnContext.$2sxc.http.apiUrl(O.nt),{pipeline:a,dataSources:r},{params:{appId:this.context.appId.toString(),Id:a.EntityId.toString()}}).pipe((0,x.U)(function(s){return i.fixPipelineDataSources(s.DataSources),s}))}},{key:"runPipeline",value:function(t,i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(O.cv),{params:{appId:this.context.appId.toString(),id:t.toString(),top:i.toString()}})}},{key:"debugStream",value:function(t,i,a,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(O.Az),{params:{appId:this.context.appId.toString(),id:t.toString(),from:i,out:a,top:r.toString()}})}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.LFG(ce.eN),e.LFG(L._),e.LFG(pe._y))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o}(),D=p(2977),de=p(8327),ie=p(3391),U=p(2090),M=p(6317),V=p(7714),B=p(6562),oe=p(8977),N=p(5656),fe=p(9139),A=p(2215),ge=p(253),ve=p(3280),F=p(116),ae=p(4874),me=p(679),W=p(5137),Q=p(785);function he(o,l){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){var n=e.oxw();e.xp6(1),e.AsE(' for Stream: "',n.debugStream.name,'" on Source: "',n.debugStream.sourceName,'" ')}}function ye(o,l){1&o&&(e.TgZ(0,"div",12),e.TgZ(1,"span"),e._uU(2,"Results"),e.qZA(),e.qZA())}function _e(o,l){1&o&&(e.ynx(0),e._uU(1,"Showing All results"),e.BQk())}function Ze(o,l){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){var n=e.oxw();e.xp6(1),e.hij("Showing top ",n.top," results")}}function be(o,l){1&o&&(e.ynx(0),e._uU(1,"All"),e.BQk())}function Ce(o,l){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){var n=e.oxw().$implicit;e.xp6(1),e.Oqu(n)}}function Te(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){var r=e.CHM(n).$implicit;return e.oxw().show(r)}),e._uU(1," Show "),e.YNc(2,be,2,0,"ng-container",2),e.YNc(3,Ce,2,1,"ng-container",2),e.qZA()}if(2&o){var t=l.$implicit;e.xp6(2),e.Q6J("ngIf",0===t),e.xp6(1),e.Q6J("ngIf",0!==t)}}function Se(o,l){1&o&&(e.TgZ(0,"div",15),e.TgZ(1,"span"),e._uU(2,"Parameters"),e.qZA(),e.qZA())}function xe(o,l){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){var n=l.$implicit;e.xp6(1),e.Oqu(n)}}function De(o,l){if(1&o&&(e.TgZ(0,"mat-tab"),e.YNc(1,Se,3,0,"div",14),e._UZ(2,"br"),e.TgZ(3,"ul",7),e.YNc(4,xe,2,1,"li",10),e.qZA(),e.qZA()),2&o){var n=e.oxw();e.xp6(4),e.Q6J("ngForOf",n.parameters)}}function Ae(o,l){1&o&&(e.TgZ(0,"div",16),e.TgZ(1,"span"),e._uU(2,"Sources"),e.qZA(),e.qZA())}function Ee(o,l){if(1&o&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&o){var n=e.oxw().$implicit;e.xp6(1),e.Oqu(null==n.value.Definition?null:n.value.Definition.Name)}}function ke(o,l){if(1&o&&(e.TgZ(0,"li"),e.TgZ(1,"b"),e._uU(2),e.qZA(),e._uU(3,"="),e.TgZ(4,"em"),e._uU(5),e.qZA(),e.qZA()),2&o){var n=l.$implicit;e.xp6(2),e.Oqu(n.key),e.xp6(3),e.Oqu(n.value)}}function Pe(o,l){if(1&o&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e.YNc(2,Ee,2,1,"div",2),e.TgZ(3,"pre"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e.TgZ(8,"ol"),e.YNc(9,ke,6,2,"li",10),e.ALo(10,"keyvalue"),e.qZA(),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.qZA()),2&o){var n=l.$implicit;e.xp6(2),e.Q6J("ngIf",null==n.value.Definition?null:n.value.Definition.Name),e.xp6(2),e.Oqu(n.value.Guid),e.xp6(2),e.Oqu(n.value.Type),e.xp6(3),e.Q6J("ngForOf",e.lcZ(10,5,n.value.Configuration)),e.xp6(3),e.Oqu(n.value.Error)}}function Ie(o,l){1&o&&(e.TgZ(0,"div",17),e.TgZ(1,"span"),e._uU(2,"Streams"),e.qZA(),e.qZA())}function Oe(o,l){if(1&o&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e.TgZ(2,"pre"),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"td"),e.TgZ(5,"pre"),e._uU(6),e.qZA(),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.qZA()),2&o){var n=l.$implicit;e.xp6(3),e.Oqu(n.Source+":"+n.SourceOut),e.xp6(3),e.Oqu(n.Target+":"+n.TargetIn),e.xp6(2),e.Oqu(n.Count),e.xp6(2),e.Oqu(n.Error)}}var Qe=function(){var o=function(){function l(n,t,i){(0,C.Z)(this,l),this.dialogData=n,this.dialogRef=t,this.visualQueryService=i}return(0,b.Z)(l,[{key:"ngOnInit",value:function(){var t,i,a,r,s=this.visualQueryService.pipelineModel$.value.Pipeline,c=(null!==(i=null===(t=s.Params)||void 0===t?void 0:t.split("\n"))&&void 0!==i?i:[]).filter(function(d){return!!d}),u=(null!==(r=null===(a=s.TestParameters)||void 0===a?void 0:a.split("\n"))&&void 0!==r?r:[]).filter(function(d){return!!d});this.parameters=[].concat(c,u),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}},{key:"closeDialog",value:function(){this.dialogRef.close()}},{key:"show",value:function(t){t!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,t):this.visualQueryService.runPipeline(t),this.closeDialog())}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(S.WI),e.Y36(S.so),e.Y36(P))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-query-result"]],decls:50,vars:14,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-description"],["dynamicHeight","","color","accent"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"description"],["mat-button","",3,"click",4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],[4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div"),e._uU(3," Query Results "),e.YNc(4,he,2,2,"ng-container",2),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(){return t.closeDialog()}),e.TgZ(6,"mat-icon"),e._uU(7,"close"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"p",4),e._uU(9),e.qZA(),e.TgZ(10,"mat-tab-group",5),e.TgZ(11,"mat-tab"),e.YNc(12,ye,3,0,"div",6),e.TgZ(13,"p",7),e.YNc(14,_e,2,0,"ng-container",2),e.YNc(15,Ze,2,1,"ng-container",2),e.YNc(16,Te,4,2,"button",8),e.qZA(),e.TgZ(17,"pre"),e._uU(18),e.ALo(19,"json"),e.qZA(),e.qZA(),e.YNc(20,De,5,1,"mat-tab",2),e.TgZ(21,"mat-tab"),e.YNc(22,Ae,3,0,"div",9),e._UZ(23,"br"),e.TgZ(24,"table",7),e.TgZ(25,"tr"),e.TgZ(26,"th"),e._uU(27,"Name and Guid"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Type"),e.qZA(),e.TgZ(30,"th"),e._uU(31,"Configuration"),e.qZA(),e.TgZ(32,"th"),e._uU(33,"Error"),e.qZA(),e.qZA(),e.YNc(34,Pe,13,7,"tr",10),e.ALo(35,"keyvalue"),e.qZA(),e.qZA(),e.TgZ(36,"mat-tab"),e.YNc(37,Ie,3,0,"div",11),e._UZ(38,"br"),e.TgZ(39,"table",7),e.TgZ(40,"tr"),e.TgZ(41,"th"),e._uU(42,"Source"),e.qZA(),e.TgZ(43,"th"),e._uU(44,"Target"),e.qZA(),e.TgZ(45,"th"),e._uU(46,"Items"),e.qZA(),e.TgZ(47,"th"),e._uU(48,"Error"),e.qZA(),e.qZA(),e.YNc(49,Oe,11,4,"tr",10),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(4),e.Q6J("ngIf",t.debugStream),e.xp6(5),e.AsE(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",t.timeUsed,"ms (",t.ticksUsed," ticks)\n"),e.xp6(5),e.Q6J("ngIf",0===t.top),e.xp6(1),e.Q6J("ngIf",0!==t.top),e.xp6(1),e.Q6J("ngForOf",t.optionsForTop),e.xp6(2),e.Oqu(e.lcZ(19,10,t.result)),e.xp6(2),e.Q6J("ngIf",null==t.parameters?null:t.parameters.length),e.xp6(14),e.Q6J("ngForOf",e.lcZ(35,12,t.sources)),e.xp6(15),e.Q6J("ngForOf",t.streams))},directives:[S.uh,m.O5,w.lW,Q.$,E.Hw,J.SP,J.uX,J.uD,m.sg],pipes:[m.Ts,m.Nd],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]}),o}(),we=function(){var o=function(){function l(n,t){(0,C.Z)(this,l),this.dialogData=n,this.dialogRef=t}return(0,b.Z)(l,[{key:"ngOnInit",value:function(){this.errorData=this.dialogData.errorData}},{key:"closeDialog",value:function(){this.dialogRef.close()}},{key:"openInsights",value:function(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api"),"_blank")}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(S.WI),e.Y36(S.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],["mat-button","","tippy","Open 2sxc Insights",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div"),e._uU(3,"Stream Error Results"),e.qZA(),e.TgZ(4,"button",2),e.NdJ("click",function(){return t.closeDialog()}),e.TgZ(5,"mat-icon"),e._uU(6,"close"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(7,"br"),e.TgZ(8,"pre"),e._uU(9),e.ALo(10,"json"),e.qZA(),e.TgZ(11,"div"),e.TgZ(12,"button",3),e.NdJ("click",function(){return t.openInsights()}),e.TgZ(13,"mat-icon"),e._uU(14,"speed"),e.qZA(),e.TgZ(15,"span"),e._uU(16,"Insights"),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(9),e.Oqu(e.lcZ(10,1,t.errorData)))},directives:[S.uh,w.lW,Q.$,E.Hw],pipes:[m.Ts],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]}),o}(),Re=p(318),P=function(){var o=function(){function l(n,t,i,a,r,s,c,u,d,f,g){(0,C.Z)(this,l),this.router=n,this.route=t,this.queryDefinitionService=i,this.titleService=a,this.snackBar=r,this.dialog=s,this.viewContainerRef=c,this.zone=u,this.metadataService=d,this.contentTypesService=f,this.changeDetectorRef=g,this.pipelineModel$=new M.X(null),this.dataSources$=new M.X(null),this.putEntityCountOnConnections$=new ge.x,this.dataSourceConfigs$=new M.X({}),this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1,this.subscription=new V.w0}return(0,b.Z)(l,[{key:"ngOnDestroy",value:function(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),this.subscription.unsubscribe()}},{key:"init",value:function(){var t=this;this.fetchDataSources(function(){return t.fetchPipeline(!0,!0,!1)}),this.attachKeyboardSave(),this.refreshOnChildClosed()}},{key:"editPipelineEntity",value:function(){var t=this;this.savePipeline(function(){var a=(0,W.f)({items:[{EntityId:t.pipelineModel$.value.Pipeline.EntityId}]});t.router.navigate(["edit/".concat(a)],{relativeTo:t.route}),t.refreshPipeline=!0})}},{key:"saveAndRun",value:function(t,i){var a=this;t&&i?this.savePipeline(function(){a.runPipeline()}):t?this.savePipeline():i&&this.runPipeline()}},{key:"showDataSourceDetails",value:function(t){var i,a=(0,A.Z)(this.pipelineModel$.value),r=null!==(i=N.iX.tryParse(a.Pipeline.VisualDesignerData))&&void 0!==i?i:{};r.ShowDataSourceDetails=t,a.Pipeline.VisualDesignerData=JSON.stringify(r),this.pipelineModel$.next(a)}},{key:"addDataSource",value:function(t){var i=(0,A.Z)(this.pipelineModel$.value);i.DataSources.push({Description:"",EntityGuid:"unsaved"+(i.DataSources.length+1),EntityId:void 0,Name:t.Name,PartAssemblyAndType:t.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(i),this.savePipeline()}},{key:"removeDataSource",value:function(t,i,a){var r=(0,A.Z)(this.pipelineModel$.value);r.DataSources=r.DataSources.filter(function(s){return s.EntityGuid!==t}),r.Pipeline.StreamWiring=i,r.Pipeline.StreamsOut=a,this.pipelineModel$.next(r)}},{key:"renameDataSource",value:function(t,i){var a=(0,A.Z)(this.pipelineModel$.value);a.DataSources.find(function(s){return s.EntityGuid===t}).Name=i,this.pipelineModel$.next(a)}},{key:"changeDataSourceDescription",value:function(t,i){var a=(0,A.Z)(this.pipelineModel$.value);a.DataSources.find(function(s){return s.EntityGuid===t}).Description=i,this.pipelineModel$.next(a)}},{key:"changeConnections",value:function(t,i){var a=(0,A.Z)(this.pipelineModel$.value);a.Pipeline.StreamWiring=t,a.Pipeline.StreamsOut=i,this.pipelineModel$.next(a)}},{key:"changeDataSourcePosition",value:function(t,i){var a=(0,A.Z)(this.pipelineModel$.value),r=a.DataSources.find(function(s){return s.EntityGuid===t});!r||(r.VisualDesignerData=Object.assign(Object.assign({},r.VisualDesignerData),i),this.pipelineModel$.next(a))}},{key:"calculateDataSourceConfigs",value:function(t){var i={};t.forEach(function(a){var r;null!=a.EntityId&&(i[a.EntityId]=[],null===(r=a.Metadata)||void 0===r||r.forEach(function(s){Object.entries(s).forEach(function(c){var g,v,u=(0,U.Z)(c,2),d=u[0],f=u[1];null==f||""===f||["Created","Guid","Id","Modified","Title","_Type"].includes(d)||(Array.isArray(f)&&null!=(null===(g=f[0])||void 0===g?void 0:g.Title)&&null!=(null===(v=f[0])||void 0===v?void 0:v.Id)&&(f="".concat(f[0].Title," (").concat(f[0].Id,")")),i[a.EntityId].push({name:d,value:f}))})}))}),this.dataSourceConfigs$.next(i)}},{key:"editDataSource",value:function(t){var i=this,r=this.dataSources$.value.find(function(d){return d.PartAssemblyAndType===t.PartAssemblyAndType}).ContentType,u=t.EntityGuid;this.metadataService.getMetadata(Z.Z.metadata.entity.targetType,Z.Z.metadata.entity.keyType,u,r).subscribe(function(d){if(d.Items.length){var g=(0,W.f)({items:[{EntityId:d.Items[0].Id}]});return i.router.navigate(["edit/".concat(g)],{relativeTo:i.route}),void(i.refreshDataSourceConfigs=!0)}i.contentTypesService.retrieveContentType(r).subscribe({next:function(h){if(null!=h){var I=(0,W.f)({items:[{ContentTypeName:r,For:{Target:Z.Z.metadata.entity.target,TargetType:Z.Z.metadata.entity.targetType,Guid:u}}]});i.router.navigate(["edit/".concat(I)],{relativeTo:i.route}),i.refreshDataSourceConfigs=!0}else i.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3})},error:function(h){i.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}},{key:"savePipeline",value:function(t){var i=this;this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:function(r){i.snackBar.open("Saved",null,{duration:2e3}),i.pipelineModel$.next(r),null!=t&&t()},error:function(r){i.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}},{key:"runPipeline",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,i).subscribe({next:function(r){t.snackBar.open("Query worked",null,{duration:2e3}),t.pipelineResult=r,t.showQueryResult(r,i),console.warn(r),t.pipelineModel$.next((0,A.Z)(t.pipelineModel$.value)),setTimeout(function(){t.putEntityCountOnConnections$.next(r)})},error:function(r){t.snackBar.open("Query failed",null,{duration:2e3})}})}},{key:"debugStream",value:function(t){var i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;if(t.Error)this.showStreamErrorResult(t);else if(0!==t.Count){this.snackBar.open("Running stream...");var r=this.pipelineModel$.value.Pipeline.EntityId;this.queryDefinitionService.debugStream(r,t.Source,t.SourceOut,a).subscribe({next:function(c){i.snackBar.open("Stream worked",null,{duration:2e3});var u=i.pipelineModel$.value.DataSources.find(function(f){return f.EntityGuid===t.Source});i.showQueryResult(c,a,{name:t.SourceOut,source:t.Source,sourceName:u.Name,original:t}),console.warn(c)},error:function(c){i.snackBar.open("Stream failed",null,{duration:2e3})}})}}},{key:"fetchPipeline",value:function(t,i,a){var r=this;a&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId,this.dataSources$.value).subscribe(function(s){a&&r.snackBar.open("Query reloaded",null,{duration:2e3}),r.titleService.setTitle("".concat(s.Pipeline.Name," - Visual Query")),t&&r.pipelineModel$.next(s),i&&r.calculateDataSourceConfigs(s.DataSources)})}},{key:"showQueryResult",value:function(t,i,a){this.dialog.open(Qe,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:t,debugStream:a,top:i},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}},{key:"showStreamErrorResult",value:function(t){this.dialog.open(we,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:t.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}},{key:"fetchDataSources",value:function(t){var i=this;this.queryDefinitionService.fetchDataSources().subscribe(function(a){i.dataSources$.next(a),t()})}},{key:"attachKeyboardSave",value:function(){var t=this;this.zone.runOutsideAngular(function(){t.subscription.add((0,ve.R)(window,"keydown").pipe((0,F.h)(function(){return!t.route.snapshot.firstChild}),(0,F.h)(function(i){return(navigator.platform.match("Mac")?i.metaKey:i.ctrlKey)&&83===i.keyCode})).subscribe(function(i){i.preventDefault(),t.zone.run(function(){t.savePipeline()})}))})}},{key:"refreshOnChildClosed",value:function(){var t=this;this.subscription.add(this.router.events.pipe((0,F.h)(function(i){return i instanceof D.m2}),(0,ae.O)(!!this.route.snapshot.firstChild),(0,x.U)(function(){return!!t.route.snapshot.firstChild}),(0,me.G)(),(0,F.h)(function(i){var a=(0,U.Z)(i,2);return a[0]&&!a[1]})).subscribe(function(){(t.refreshPipeline||t.refreshDataSourceConfigs)&&t.fetchPipeline(t.refreshPipeline,t.refreshDataSourceConfigs,t.refreshPipeline),t.refreshPipeline=!1,t.refreshDataSourceConfigs=!1}))}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.LFG(D.F0),e.LFG(D.gz),e.LFG(j),e.LFG(Re.Dx),e.LFG(ee.ux),e.LFG(S.uw),e.LFG(e.s_b),e.LFG(e.R0b),e.LFG(ne.D),e.LFG(te.s),e.LFG(e.sBO))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o}(),Y={Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function qe(o,l){var i,n={},t=(0,q.Z)(o);try{var a=function(){var s=i.value,c=void 0,u=l.find(function(d){return d.PartAssemblyAndType===s.PartAssemblyAndType});u&&(c=Object.assign({},u.PrimaryType?Y[u.PrimaryType]:Y.Unknown),null!=u.Icon&&(c.Icon=u.Icon),null!=u.DynamicIn&&(c.DynamicIn=u.DynamicIn),null!=u.DynamicOut&&(c.DynamicOut=u.DynamicOut),null!=u.HelpLink&&(c.HelpLink=u.HelpLink),null!=u.EnableConfig&&(c.EnableConfig=u.EnableConfig),null!=u.UiHint&&(c.UiHint=u.UiHint)),c||(c=Object.assign({},Y.Unknown)),n[s.EntityGuid]=c};for(t.s();!(i=t.n()).done;)a()}catch(r){t.e(r)}finally{t.f()}return n}var Ue=p(3135),Me=p(491),Ne=p(1130);function $e(o,l){1&o&&(e.TgZ(0,"app-field-hint"),e._uU(1," You will get suggestions for out-streams after you run query "),e.qZA())}function Je(o,l){1&o&&(e.TgZ(0,"app-field-hint",12),e._uU(1," This field is required "),e.qZA()),2&o&&e.Q6J("isError",!0)}function Le(o,l){if(1&o&&(e.ynx(0),e.TgZ(1,"mat-form-field",9),e.TgZ(2,"mat-label"),e._uU(3,"Label"),e.qZA(),e._UZ(4,"input",10),e.qZA(),e.YNc(5,$e,2,0,"app-field-hint",5),e.YNc(6,Je,2,1,"app-field-hint",11),e.BQk()),2&o){var n=e.oxw();e.xp6(5),e.Q6J("ngIf",n.isSource&&!n.pipelineResultExists),e.xp6(1),e.Q6J("ngIf",n.controls.label.touched&&(null==n.controls.label.errors?null:n.controls.label.errors.required))}}function Fe(o,l){if(1&o&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&o){var n=l.$implicit;e.Q6J("value",n.value),e.xp6(1),e.hij(" ",n.name," ")}}function Ye(o,l){if(1&o&&(e.ynx(0),e.TgZ(1,"mat-form-field",9),e.TgZ(2,"mat-label"),e._uU(3,"Scope"),e.qZA(),e.TgZ(4,"mat-select",18),e.YNc(5,Fe,2,2,"mat-option",19),e.qZA(),e.qZA(),e.TgZ(6,"app-field-hint"),e._uU(7," The scope should almost never be changed - "),e.TgZ(8,"a",20),e._uU(9,"see help"),e.qZA(),e.qZA(),e.BQk()),2&o){var n=e.oxw(2);e.xp6(4),e.Q6J("placeholder",n.scopeOptions.length?"":"No items found"),e.xp6(1),e.Q6J("ngForOf",n.scopeOptions)}}function Ge(o,l){if(1&o&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&o){var n=l.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n," ")}}function He(o,l){if(1&o&&(e.TgZ(0,"mat-select",22),e.YNc(1,Ge,2,2,"mat-option",19),e.qZA()),2&o){var n=e.oxw(2);e.Q6J("placeholder",n.labelOptions.length?"":"No items found"),e.xp6(1),e.Q6J("ngForOf",n.labelOptions)}}function je(o,l){1&o&&e._UZ(0,"input",10)}function Ve(o,l){1&o&&(e.TgZ(0,"app-field-hint",12),e._uU(1," This field is required "),e.qZA()),2&o&&e.Q6J("isError",!0)}var re=function(l){return{active:l}};function Be(o,l){if(1&o){var n=e.EpF();e.ynx(0),e.YNc(1,Ye,10,2,"ng-container",5),e.TgZ(2,"mat-form-field",9),e.TgZ(3,"mat-label"),e._uU(4,"Label"),e.qZA(),e.YNc(5,He,2,2,"mat-select",13),e.YNc(6,je,1,0,"input",14),e.TgZ(7,"div",15),e.TgZ(8,"button",16),e.NdJ("click",function(){return e.CHM(n),e.oxw().toggleGuidedLabel(!0)}),e.TgZ(9,"mat-icon"),e._uU(10,"search"),e.qZA(),e.qZA(),e.TgZ(11,"button",17),e.NdJ("click",function(){return e.CHM(n),e.oxw().toggleGuidedLabel(!1)}),e.TgZ(12,"mat-icon"),e._uU(13,"text_fields"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(14,Ve,2,1,"app-field-hint",11),e.BQk()}if(2&o){var t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.advancedMode&&t.guidedLabel),e.xp6(4),e.Q6J("ngIf",t.guidedLabel),e.xp6(1),e.Q6J("ngIf",!t.guidedLabel),e.xp6(2),e.Q6J("ngClass",e.VKq(6,re,t.guidedLabel)),e.xp6(3),e.Q6J("ngClass",e.VKq(8,re,!t.guidedLabel)),e.xp6(3),e.Q6J("ngIf",t.controls.label.touched&&(null==t.controls.label.errors?null:t.controls.label.errors.required))}}function We(o,l){if(1&o){var n=e.EpF();e.ynx(0),e.TgZ(1,"mat-slide-toggle",23),e.NdJ("change",function(a){return e.CHM(n),e.oxw().toggleAdvancedMode(a)}),e._uU(2),e.qZA(),e._UZ(3,"div",24),e.BQk()}if(2&o){var t=e.oxw();e.xp6(1),e.Q6J("checked",t.advancedMode),e.xp6(1),e.hij(" ",t.advancedMode?"Advanced":"Simple"," ")}}var ze=function(){var o=function(){function l(n,t,i,a,r){(0,C.Z)(this,l),this.dialogData=n,this.dialogRef=t,this.visualQueryService=i,this.contentTypesService=a,this.changeDetectorRef=r,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.pipelineResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1,this.subscription=new V.w0}return(0,b.Z)(l,[{key:"ngOnInit",value:function(){this.buildForm()}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"closeDialog",value:function(t){this.dialogRef.close(t)}},{key:"toggleGuidedLabel",value:function(t){this.guidedLabel=t}},{key:"toggleAdvancedMode",value:function(t){this.advancedMode=t.checked}},{key:"rename",value:function(){var t=this.form.getRawValue();this.closeDialog(t.label)}},{key:"buildForm",value:function(){var t=this;this.form=new T.cw({label:new T.NI(this.dialogData.label,T.kI.required),scope:new T.NI(Z.Z.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscription.add(this.controls.scope.valueChanges.pipe((0,ae.O)(this.controls.scope.value),(0,oe.x)()).subscribe(function(i){t.labelOptions=Object.values(t.visualQueryService.pipelineResult.Sources).find(function(a){return a.Guid===t.dialogData.pipelineDataSourceGuid}).Out.filter(function(a){return a.Scope===i}).map(function(a){return a.Name}),!t.labelOptions.includes(t.controls.label.value)&&null!=t.controls.label.value&&t.controls.label.patchValue(null)})),this.contentTypesService.getScopes().subscribe(function(i){var a=Object.values(t.visualQueryService.pipelineResult.Sources).find(function(s){return s.Guid===t.dialogData.pipelineDataSourceGuid}).Out,r=i.filter(function(s){return a.some(function(c){return c.Scope===s.value})});t.scopeOptions=r,t.changeDetectorRef.markForCheck()}))}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(S.WI),e.Y36(S.so),e.Y36(P),e.Y36(O.sF),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(n,t){2&n&&e.Ikx("className",t.hostClass)},decls:17,vars:5,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],[4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["appearance","standard","color","accent"],["matInput","","type","text","formControlName","label","required",""],[3,"isError",4,"ngIf"],[3,"isError"],["formControlName","label","required","",3,"placeholder",4,"ngIf"],["matInput","","type","text","formControlName","label","required","",4,"ngIf"],["matSuffix","",1,"selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",3,"ngClass","click"],["mat-icon-button","","type","button","tippy","Manual entry",3,"ngClass","click"],["formControlName","scope",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],[3,"value"],["formControlName","label","required","",3,"placeholder"],["color","accent",3,"checked","change"],[1,"spacer"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div"),e._uU(3,"Rename stream"),e.qZA(),e.TgZ(4,"button",2),e.NdJ("click",function(){return t.closeDialog()}),e.TgZ(5,"mat-icon"),e._uU(6,"close"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"form",3),e.TgZ(8,"div",4),e.YNc(9,Le,7,2,"ng-container",5),e.YNc(10,Be,15,10,"ng-container",5),e.qZA(),e.TgZ(11,"div",6),e.YNc(12,We,4,2,"ng-container",5),e.TgZ(13,"button",7),e.NdJ("click",function(){return t.closeDialog()}),e._uU(14,"Cancel"),e.qZA(),e.TgZ(15,"button",8),e.NdJ("click",function(){return t.rename()}),e._uU(16," Rename "),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(7),e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("ngIf",!t.isSource||!t.pipelineResultExists),e.xp6(1),e.Q6J("ngIf",t.isSource&&t.pipelineResultExists),e.xp6(2),e.Q6J("ngIf",t.isSource&&t.pipelineResultExists),e.xp6(3),e.Q6J("disabled",!t.form.valid))},directives:[S.uh,w.lW,Q.$,E.Hw,T._Y,T.JL,T.sg,m.O5,$.KE,$.hX,X.Nt,T.Fj,T.JJ,T.u,T.Q7,Ue.Y,$.R9,m.mk,K.gD,m.sg,Me.E,Ne.ey,R.Rr],styles:[""]}),o}(),_="dataSource_",Xe=function(){function o(l,n,t,i,a,r,s,c,u){var d=this;(0,C.Z)(this,o),this.jsPlumbRoot=l,this.pipelineModel=n,this.dataSources=t,this.onConnectionsChanged=i,this.onDragend=a,this.onDebugStream=r,this.dialog=s,this.viewContainerRef=c,this.changeDetectorRef=u,this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(function(){d.initDomDataSources(),d.initWirings(),d.bindEvents()}),this.instance.repaintEverything()}return(0,b.Z)(o,[{key:"destroy",value:function(){var n;null===(n=this.dialogRef)||void 0===n||n.close(),this.instance.reset(),this.instance.unbindContainer()}},{key:"removeEndpointsOnDataSource",value:function(n){var t=this,i=_+n;this.bulkDelete=!0,this.instance.batch(function(){t.instance.selectEndpoints({element:i}).delete()}),this.bulkDelete=!1}},{key:"getAllConnections",value:function(){return this.instance.getAllConnections().map(function(t){return{From:t.sourceId.replace(_,""),Out:t.endpoints[0].getOverlay("endpointLabel").label,To:t.targetId.replace(_,""),In:t.endpoints[1].getOverlay("endpointLabel").label}})}},{key:"getStreamsOut",value:function(){var n=[];return this.instance.selectEndpoints({target:_+"Out"}).each(function(i){n.push(i.getOverlay("endpointLabel").label)}),n.join(",")}},{key:"putEntityCountOnConnections",value:function(n){var i,t=this;null===(i=n.Streams)||void 0===i||i.forEach(function(a){var r,s,c=_+a.Source,g=(["00000000-0000-0000-0000-000000000000",t.pipelineModel.Pipeline.EntityGuid].includes(a.Target)?_+"Out":_+a.Target)+"_in_"+a.TargetIn,v=t.instance.getEndpoint(c+"_out_"+a.SourceOut);null===(s=null===(r=null==v?void 0:v.connections)||void 0===r?void 0:r.filter(function(h){return h.endpoints[1].getUuid()===g}))||void 0===s||s.forEach(function(h){var y=a.Error?"":a.Count.toString();h.setLabel({label:y,cssClass:"streamEntitiesCount "+(a.Error?"streamEntitiesError":""),events:{click:function(H){!t.pipelineModel.Pipeline.AllowEdit||t.onDebugStream(a)}}})})})}},{key:"nextLinePaintStyle",value:function(n){return this.uuidColorMap[n]||(this.uuidColorMap[n]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))}},{key:"getInstanceDefaults",value:function(n){return{Container:n,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}},{key:"initDomDataSources",value:function(){var t,i,r,n=this,a=(0,q.Z)(this.pipelineModel.DataSources);try{var s=function(){var d=r.value,f=n.jsPlumbRoot.querySelector("#"+_+d.EntityGuid);if(!f)return"continue";var g=n.dataSources.find(function(h){return h.PartAssemblyAndType===d.PartAssemblyAndType});if(!g)return"continue";if(n.pipelineModel.Pipeline.AllowEdit&&n.instance.draggable(f,{grid:[20,20],stop:function(y){var G=y.el.id.replace(_,""),H={Top:y.finalPos[1],Left:y.finalPos[0]};setTimeout(function(){n.onDragend(G,H)})}}),null===(t=g.Out)||void 0===t||t.forEach(function(h){n.addEndpoint(f,h,!1,d)}),null===(i=g.In)||void 0===i||i.forEach(function(h){n.addEndpoint(f,h,!0,d)}),g.In){var v=n.buildTargetEndpoint(d.EntityGuid);v.maxConnections=-1,n.instance.makeTarget(f,v)}g.DynamicOut&&n.instance.makeSource(f,n.buildSourceEndpoint(d.EntityGuid),{filter:".add-endpoint"})};for(a.s();!(r=a.n()).done;)s()}catch(u){a.e(u)}finally{a.f()}}},{key:"initWirings",value:function(){var t,n=this;null===(t=this.pipelineModel.Pipeline.StreamWiring)||void 0===t||t.forEach(function(i){var a=_+i.From,r=a+"_out_"+i.Out,s=_+i.To,c=s+"_in_"+i.In;if(!n.instance.getEndpoint(r)){var u=n.jsPlumbRoot.querySelector("#"+a);if(!u)return;var d=u.id.replace(_,""),f=n.pipelineModel.DataSources.find(function(y){return y.EntityGuid===d});n.addEndpoint(u,i.Out,!1,f)}if(!n.instance.getEndpoint(c)){var g=n.jsPlumbRoot.querySelector("#"+s);if(!g)return;var v=g.id.replace(_,""),h=n.pipelineModel.DataSources.find(function(y){return y.EntityGuid===v});n.addEndpoint(g,i.In,!0,h)}try{n.instance.connect({uuids:[r,c],paintStyle:n.nextLinePaintStyle(r)})}catch(y){console.error({message:"Connection failed",from:r,to:c})}})}},{key:"addEndpoint",value:function(n,t,i,a){var s,c,u,v,r=this,d=this.dataSources.find(function(k){return k.PartAssemblyAndType===a.PartAssemblyAndType}),f=i?!(null===(s=d.In)||void 0===s?void 0:s.some(function(k){return r.getEndpointInfo(k,!1)})):!(null===(c=d.Out)||void 0===c?void 0:c.some(function(k){return r.getEndpointInfo(k,!1)})),g=this.getEndpointInfo(t,f);v=f?"dynamic":g.required?(null===(u=this.pipelineModel.Pipeline.StreamWiring)||void 0===u?void 0:u.some(function(k){return _+k.To===n.id&&k.In===g.name}))?"":"required":"";var y=n.id+(i?"_in_":"_out_")+g.name,I=i?this.buildTargetEndpoint(a.EntityGuid,v):this.buildSourceEndpoint(a.EntityGuid,v);this.instance.addEndpoint(n,I,{uuid:y,enabled:this.pipelineModel.Pipeline.AllowEdit||a.EntityGuid===Z.Z.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel").setLabel(g.name)}},{key:"buildSourceEndpoint",value:function(n,t){var a,i=this,r=!0;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(a="sourceEndpoint "+t)&&void 0!==a?a:"",maxConnections:-1,isSource:r,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(r),events:{click:function(u){i.onChangeLabel(u,r,n)}}}}},{key:"buildTargetEndpoint",value:function(n,t){var a,i=this;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(a="targetEndpoint "+t)&&void 0!==a?a:"",maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(false),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:function(u){i.onChangeLabel(u,false,n)}}}}},{key:"getEndpointOverlays",value:function(n){return[["Label",{id:"endpointLabel",location:[.5,n?0:1],label:"Default",cssClass:n?"endpointSourceLabel":"endpointTargetLabel"}]]}},{key:"onChangeLabel",value:function(n,t,i){var a=this;if(this.pipelineModel.Pipeline.AllowEdit){var r=n.getOverlay?n.getOverlay("endpointLabel"):n;this.dialogRef=this.dialog.open(ze,{autoFocus:!1,data:{pipelineDataSourceGuid:i,isSource:t,label:r.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.dialogRef.afterClosed().subscribe(function(c){!c||(r.setLabel(c),setTimeout(function(){a.onConnectionsChanged()}))}),this.changeDetectorRef.markForCheck()}}},{key:"bindEvents",value:function(){var n=this;this.instance.bind("connectionDetached",function(t){if(!n.bulkDelete){var i=t.target,a=n.pipelineModel.DataSources.find(function(u){return u.EntityGuid===i.id.replace(_,"")}),r=n.dataSources.find(function(u){return u.PartAssemblyAndType===a.PartAssemblyAndType}),s=t.targetEndpoint.getOverlay("endpointLabel").label;r.In.some(function(u){return n.getEndpointInfo(u,!1).name===s})||n.instance.deleteEndpoint(t.targetEndpoint),setTimeout(function(){n.onConnectionsChanged()})}}),this.instance.bind("connection",function(t){if(t.sourceId!==t.targetId){var i=t.targetEndpoint.getOverlay("endpointLabel"),a=i.getLabel();n.instance.getEndpoints(t.target.id).some(function(c){return c.getOverlay("endpointLabel").getLabel()===a&&t.targetEndpoint.id!==c.id&&c.canvas.classList.contains("targetEndpoint")})&&i.setLabel("PleaseRename".concat(Math.floor(99999*Math.random()))),setTimeout(function(){n.onConnectionsChanged()})}else setTimeout(function(){n.instance.deleteConnection(t.connection,{fireEvent:!1}),setTimeout(function(){n.onConnectionsChanged()})})})}},{key:"getEndpointInfo",value:function(n,t){var i,a;if(t)i=n,a=!1;else{var r=n.trim();i=(a=r.endsWith("*"))?r.substring(0,r.length-1):r}return{name:i,required:a}}}]),o}(),Ke=p(2634),et=["domRoot"],tt=["domDataSource"];function nt(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"mat-icon",19),e.NdJ("click",function(){e.CHM(n);var i=e.oxw().$implicit;return e.oxw(3).configureDataSource(i)}),e._uU(1," settings "),e.qZA()}}function it(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"mat-icon",20),e.NdJ("click",function(){e.CHM(n);var i=e.oxw().$implicit,a=e.oxw(2).ngIf;return e.oxw().openHelp(a.typeInfos[i.EntityGuid].HelpLink)}),e._uU(1," help_outline "),e.qZA()}}function ot(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"mat-icon",21),e.NdJ("click",function(){e.CHM(n);var i=e.oxw().$implicit;return e.oxw(3).remove(i)}),e._uU(1," delete "),e.qZA()}}function at(o,l){if(1&o&&(e.TgZ(0,"tr",25),e.TgZ(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",27),e._uU(4),e.qZA(),e.qZA()),2&o){var n=l.$implicit;e.xp6(1),e.Q6J("title",n.name),e.xp6(1),e.Oqu(n.name),e.xp6(1),e.Q6J("title",n.value),e.xp6(1),e.Oqu(n.value)}}function rt(o,l){if(1&o&&(e.ynx(0),e._UZ(1,"hr",22),e.TgZ(2,"table",23),e.YNc(3,at,5,4,"tr",24),e.qZA(),e.BQk()),2&o){var n=e.oxw().$implicit,t=e.oxw(2).ngIf;e.xp6(3),e.Q6J("ngForOf",t.dataSourceConfigs[n.EntityId])}}function lt(o,l){1&o&&(e.TgZ(0,"mat-icon",28),e._uU(1," arrow_drop_up "),e.qZA())}function st(o,l){1&o&&(e.TgZ(0,"mat-icon",29),e._uU(1," arrow_drop_up "),e.qZA())}var ut=function(l,n,t){return{top:l,left:n,"min-width":t}},ct=function(l){return{"show-details":l}};function pt(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"div",5,6),e.TgZ(2,"div",7),e.TgZ(3,"mat-icon",8),e._uU(4),e.qZA(),e.YNc(5,nt,2,0,"mat-icon",9),e.YNc(6,it,2,0,"mat-icon",10),e.qZA(),e.TgZ(7,"div",11),e.YNc(8,ot,2,0,"mat-icon",12),e.qZA(),e.TgZ(9,"div",13),e.NdJ("click",function(){var c=e.CHM(n).$implicit,u=e.oxw(2).ngIf,d=e.oxw();return u.allowEdit&&d.editName(c)}),e.TgZ(10,"span"),e._uU(11),e.qZA(),e.TgZ(12,"mat-icon",14),e._uU(13,"edit"),e.qZA(),e.qZA(),e._UZ(14,"br"),e.TgZ(15,"div",15),e.NdJ("click",function(){var c=e.CHM(n).$implicit,u=e.oxw(2).ngIf,d=e.oxw();return u.allowEdit&&d.editDescription(c)}),e.TgZ(16,"span"),e._uU(17),e.qZA(),e.TgZ(18,"mat-icon",14),e._uU(19,"edit"),e.qZA(),e.qZA(),e._UZ(20,"br"),e.YNc(21,rt,4,1,"ng-container",3),e.TgZ(22,"div",16),e._uU(23),e.qZA(),e.YNc(24,lt,2,0,"mat-icon",17),e.YNc(25,st,2,0,"mat-icon",18),e.qZA()}if(2&o){var t=l.$implicit,i=e.oxw(2).ngIf,a=e.oxw();e.Q6J("id",a.dataSrcIdPrefix+t.EntityGuid)("ngStyle",e.kEZ(15,ut,t.VisualDesignerData.Top+"px",t.VisualDesignerData.Left+"px",t.VisualDesignerData.Width?t.VisualDesignerData.Width+"px":null))("ngClass",e.VKq(19,ct,i.showDataSourceDetails&&(null==i.dataSourceConfigs[t.EntityId]?null:i.dataSourceConfigs[t.EntityId].length))),e.xp6(3),e.Q6J("title",i.typeInfos[t.EntityGuid].UiHint),e.xp6(1),e.hij(" ",i.typeInfos[t.EntityGuid].Icon," "),e.xp6(1),e.Q6J("ngIf",i.allowEdit&&i.typeInfos[t.EntityGuid].EnableConfig),e.xp6(1),e.Q6J("ngIf",i.typeInfos[t.EntityGuid].HelpLink),e.xp6(2),e.Q6J("ngIf",i.allowEdit&&!a.isOutDataSource(t)),e.xp6(3),e.Oqu(t.Name||"(no name)"),e.xp6(6),e.Oqu(t.Description),e.xp6(4),e.Q6J("ngIf",i.showDataSourceDetails&&(null==i.dataSourceConfigs[t.EntityId]?null:i.dataSourceConfigs[t.EntityId].length)),e.xp6(1),e.Q6J("title",t.PartAssemblyAndType),e.xp6(1),e.hij(" Type: ",a.getTypeName(t.PartAssemblyAndType)," "),e.xp6(1),e.Q6J("ngIf",i.allowEdit&&i.typeInfos[t.EntityGuid].DynamicOut),e.xp6(1),e.Q6J("ngIf",i.allowEdit&&i.typeInfos[t.EntityGuid].DynamicIn)}}function dt(o,l){if(1&o&&(e.ynx(0),e.YNc(1,pt,26,21,"div",4),e.BQk()),2&o){var n=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",n.pipelineDataSources)}}function ft(o,l){if(1&o&&(e.TgZ(0,"div",1,2),e.YNc(2,dt,2,1,"ng-container",3),e.qZA()),2&o){var n=e.oxw();e.xp6(2),e.Q6J("ngIf",!n.hardReset)}}var le=function(){var o=function(){function l(n,t,i,a,r){(0,C.Z)(this,l),this.visualQueryService=n,this.queryDefinitionService=t,this.changeDetectorRef=i,this.dialog=a,this.viewContainerRef=r,this.dataSrcIdPrefix=_,this.hardReset=!1,this.scriptLoaded$=new M.X(!1),this.subscription=new V.w0}return(0,b.Z)(l,[{key:"ngOnInit",value:function(){var t=this;(0,fe.y)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],function(){t.scriptLoaded$.next(!0)}),this.subscription.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(function(a){t.plumber.putEntityCountOnConnections(a)}));var i=this.visualQueryService.pipelineModel$.pipe((0,x.U)(function(a){var r;return null!==(r=N.iX.tryParse(null==a?void 0:a.Pipeline.VisualDesignerData))&&void 0!==r?r:{}}),(0,oe.x)(N.iX.objectsEqual));this.templateModel$=(0,B.a)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$,i,this.visualQueryService.dataSourceConfigs$]).pipe((0,x.U)(function(a){var f,r=(0,U.Z)(a,4),s=r[0],c=r[1],u=r[2],d=r[3];if(null!=s&&null!=c)return t.hardReset=!0,t.changeDetectorRef.detectChanges(),t.hardReset=!1,{pipelineDataSources:s.DataSources,typeInfos:qe(s.DataSources,c),allowEdit:s.Pipeline.AllowEdit,showDataSourceDetails:null!==(f=u.ShowDataSourceDetails)&&void 0!==f&&f,dataSourceConfigs:d}}))}},{key:"ngAfterViewInit",value:function(){var t=this,i=this.domDataSourcesRef.changes.pipe((0,x.U)(function(){return!0}));this.subscription.add((0,B.a)([this.scriptLoaded$,i]).subscribe(function(a){var u,r=(0,U.Z)(a,2);!r[0]||!r[1]||(null===(u=t.plumber)||void 0===u||u.destroy(),t.plumber=new Xe(t.domRootRef.nativeElement,t.visualQueryService.pipelineModel$.value,t.visualQueryService.dataSources$.value,t.onConnectionsChanged.bind(t),t.onDragend.bind(t),t.onDebugStream.bind(t),t.dialog,t.viewContainerRef,t.changeDetectorRef))}))}},{key:"ngOnDestroy",value:function(){var t;null===(t=this.plumber)||void 0===t||t.destroy(),this.scriptLoaded$.complete(),this.subscription.unsubscribe()}},{key:"onConnectionsChanged",value:function(){var t=this.plumber.getAllConnections(),i=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(t,i)}},{key:"onDragend",value:function(t,i){this.visualQueryService.changeDataSourcePosition(t,i)}},{key:"onDebugStream",value:function(t){this.visualQueryService.debugStream(t)}},{key:"configureDataSource",value:function(t){t.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(t)}},{key:"getTypeName",value:function(t){var i=this.visualQueryService.dataSources$.value.find(function(a){return a.PartAssemblyAndType===t});return this.queryDefinitionService.typeNameFilter((null==i?void 0:i.TypeNameForUi)||t,"className")}},{key:"isOutDataSource",value:function(t){return t.PartAssemblyAndType===Z.Z.pipelineDesigner.outDataSource.PartAssemblyAndType}},{key:"remove",value:function(t){if(confirm("Delete ".concat(t.Name," data source?"))){this.plumber.removeEndpointsOnDataSource(t.EntityGuid);var i=this.plumber.getAllConnections(),a=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(t.EntityGuid,i,a)}}},{key:"openHelp",value:function(t){window.open(t,"_blank")}},{key:"editName",value:function(t){var i,a=null===(i=prompt("Rename data source",t.Name))||void 0===i?void 0:i.trim();null==a||""===a||this.visualQueryService.renameDataSource(t.EntityGuid,a)}},{key:"editDescription",value:function(t){var i,a=null===(i=prompt("Edit description",t.Description))||void 0===i?void 0:i.trim();null!=a&&this.visualQueryService.changeDataSourceDescription(t.EntityGuid,a)}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(P),e.Y36(j),e.Y36(e.sBO),e.Y36(S.uw),e.Y36(e.s_b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-plumb-editor"]],viewQuery:function(n,t){var i;1&n&&(e.Gf(et,5),e.Gf(tt,5)),2&n&&(e.iGM(i=e.CRH())&&(t.domRootRef=i.first),e.iGM(i=e.CRH())&&(t.domDataSourcesRef=i))},decls:2,vars:3,consts:[["id","pipeline-root",4,"ngIf"],["id","pipeline-root"],["domRoot",""],[4,"ngIf"],["class","dataSource",3,"id","ngStyle","ngClass",4,"ngFor","ngForOf"],[1,"dataSource",3,"id","ngStyle","ngClass"],["domDataSource",""],[1,"actions","left"],[1,"type-info",3,"title"],["class","configure","title","Configure data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],["class","help","title","Help for this data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],[1,"actions","right"],["class","delete","title","Delete","appMousedownStopPropagation","",3,"click",4,"ngIf"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["class","add-endpoint","title","Drag a new Out-Connection",4,"ngIf"],["class","many-in","title","This data source supports multiple In-Connections",4,"ngIf"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],["class","config",4,"ngFor","ngForOf"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint"],["title","This data source supports multiple In-Connections",1,"many-in"]],template:function(n,t){1&n&&(e.YNc(0,ft,3,1,"div",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,t.templateModel$))},directives:[m.O5,m.sg,m.PC,m.mk,E.Hw,Ke.d],pipes:[m.Ov],styles:["","[_nghost-%COMP%]{display:block;width:100%;height:100%}\n/*# sourceMappingURL=https://sources.2sxc.org/13.03.00/ng-edit/C:/Projects/2sxc/eav-ui/projects/ng-dialogs/src/app/visual-query/plumb-editor/plumb-editor.component.ts-angular-inline--1.css.map*/"]}),o}();function mt(o,l){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){var n=l.$implicit;e.xp6(1),e.hij(" ",n," ")}}function ht(o,l){if(1&o&&(e.TgZ(0,"ul",16),e.YNc(1,mt,2,1,"li",17),e.qZA()),2&o){var n=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",null==n.Pipeline.Params?null:n.Pipeline.Params.split("\n"))}}function yt(o,l){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){var n=l.$implicit;e.xp6(1),e.hij(" ",n," ")}}function _t(o,l){if(1&o&&(e.TgZ(0,"ul",16),e.YNc(1,yt,2,1,"li",17),e.qZA()),2&o){var n=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",null==n.Pipeline.TestParameters?null:n.Pipeline.TestParameters.split("\n"))}}function Zt(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"mat-slide-toggle",18),e.NdJ("change",function(a){return e.CHM(n),e.oxw(2).showDataSourceDetails(a)}),e._uU(2," Show DataSource Params "),e.qZA(),e.qZA()}if(2&o){var t=l.ngIf;e.xp6(1),e.Q6J("checked",t.ShowDataSourceDetails)}}function bt(o,l){1&o&&e._UZ(0,"li",23),2&o&&e.Q6J("innerHTML",l.$implicit,e.oJD)}function Ct(o,l){if(1&o&&(e.TgZ(0,"div",20),e.TgZ(1,"div",7),e.TgZ(2,"span"),e._uU(3,"Warnings"),e.qZA(),e.TgZ(4,"mat-icon",21),e._uU(5,"warning"),e.qZA(),e.qZA(),e.TgZ(6,"ol",16),e.YNc(7,bt,1,1,"li",22),e.qZA(),e.qZA()),2&o){var n=e.oxw().ngIf;e.xp6(7),e.Q6J("ngForOf",n)}}function Tt(o,l){if(1&o&&(e.ynx(0),e.YNc(1,Ct,8,1,"div",19),e.BQk()),2&o){var n=l.ngIf;e.xp6(1),e.Q6J("ngIf",n.length)}}function St(o,l){if(1&o&&(e.TgZ(0,"div",24),e.TgZ(1,"div",7),e._uU(2,"Query Description"),e.qZA(),e.TgZ(3,"div"),e._uU(4),e.qZA(),e.qZA()),2&o){var n=e.oxw().ngIf;e.xp6(4),e.Oqu(n.Pipeline.Description)}}function xt(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"div",2),e.TgZ(2,"div",3),e.TgZ(3,"button",4),e.NdJ("click",function(){return e.CHM(n),e.oxw().saveAndRunQuery(!0,!0)}),e._uU(4," Save and run "),e.qZA(),e.TgZ(5,"button",5),e.NdJ("click",function(){return e.CHM(n),e.oxw().saveAndRunQuery(!1,!0)}),e._uU(6," Run "),e.qZA(),e.TgZ(7,"button",5),e.NdJ("click",function(){return e.CHM(n),e.oxw().saveAndRunQuery(!0,!1)}),e._uU(8," Save "),e.qZA(),e.qZA(),e.TgZ(9,"div",6),e.TgZ(10,"div",7),e.TgZ(11,"div"),e._uU(12,"Query Parameters"),e.qZA(),e.TgZ(13,"div"),e.TgZ(14,"button",8),e.NdJ("click",function(){return e.CHM(n),e.oxw().editPipeline()}),e.TgZ(15,"mat-icon"),e._uU(16,"edit"),e.qZA(),e.qZA(),e.TgZ(17,"button",9),e.NdJ("click",function(){return e.CHM(n),e.oxw().openParamsHelp()}),e.TgZ(18,"mat-icon"),e._uU(19,"info"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(20,ht,2,1,"ul",10),e.qZA(),e.TgZ(21,"div",6),e.TgZ(22,"div",7),e._uU(23,"Test Parameters"),e.qZA(),e.YNc(24,_t,2,1,"ul",10),e.qZA(),e.YNc(25,Zt,3,1,"div",11),e.ALo(26,"async"),e.YNc(27,Tt,2,1,"ng-container",12),e.ALo(28,"async"),e.YNc(29,St,5,1,"div",13),e.TgZ(30,"div",14),e.TgZ(31,"button",5),e.NdJ("click",function(){return e.CHM(n),e.oxw().openRestApi()}),e.TgZ(32,"span"),e._uU(33,"Use in JSON / REST API"),e.qZA(),e._UZ(34,"mat-icon",15),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){var t=l.ngIf,i=e.oxw();e.xp6(20),e.Q6J("ngIf",null==t.Pipeline.Params?null:t.Pipeline.Params.length),e.xp6(4),e.Q6J("ngIf",null==t.Pipeline.TestParameters?null:t.Pipeline.TestParameters.length),e.xp6(1),e.Q6J("ngIf",e.lcZ(26,5,i.visualDesignerData$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(28,7,i.warnings$)),e.xp6(2),e.Q6J("ngIf",t.Pipeline.Description)}}var Dt=function(){var o=function(){function l(n,t,i,a){(0,C.Z)(this,l),this.router=n,this.route=t,this.context=i,this.visualQueryService=a}return(0,b.Z)(l,[{key:"ngOnInit",value:function(){var t=this;this.pipelineModel$=this.visualQueryService.pipelineModel$.asObservable(),this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,x.U)(function(i){return function vt(o,l){var n,t,i=[];try{var a=(null===(n=o.Pipeline.Params)||void 0===n?void 0:n.split(/\r?\n/))||[],r=(null===(t=o.Pipeline.TestParameters)||void 0===t?void 0:t.split(/\r?\n/))||[];a.forEach(function(s){(s=null==s?void 0:s.trim())&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(s)||i.push("\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>".concat(s,"</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        ")))}),r.forEach(function(s){if(s=null==s?void 0:s.trim()){/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(s)||i.push("\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>".concat(s,"</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        "));var f=/^\[module:id\]=([0-9]*)$/gim.exec(s);if(f){var g=f[1],v=l.moduleId.toString();g!==v&&i.push("\n            Your test ModuleId (".concat(g,") is different from the current ModuleId (").concat(v,").<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          "))}/^\[module:moduleid\]=([0-9]*)$/gim.exec(s)&&i.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")}})}catch(s){console.error("Something went wrong in calculateWarnings for params",s)}return i}(i,t.context)})),this.visualDesignerData$=this.visualQueryService.pipelineModel$.pipe((0,x.U)(function(i){var a;return null!==(a=N.iX.tryParse(i.Pipeline.VisualDesignerData))&&void 0!==a?a:{}}))}},{key:"editPipeline",value:function(){this.visualQueryService.editPipelineEntity()}},{key:"openParamsHelp",value:function(){window.open("http://r.2sxc.org/QueryParams","_blank")}},{key:"saveAndRunQuery",value:function(t,i){this.visualQueryService.saveAndRun(t,i)}},{key:"showDataSourceDetails",value:function(t){this.visualQueryService.showDataSourceDetails(t.checked)}},{key:"openRestApi",value:function(){this.router.navigate([ie.ii.getUrlQuery(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)],{relativeTo:this.route})}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(D.F0),e.Y36(D.gz),e.Y36(L._),e.Y36(P))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-run-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],["class","values",4,"ngIf"],["class","parameters",4,"ngIf"],[4,"ngIf"],["class","description",4,"ngIf"],[1,"footer-actions"],["svgIcon","code-curly"],[1,"values"],[4,"ngFor","ngForOf"],["color","primary","labelPosition","before",3,"checked","change"],["class","warnings",4,"ngIf"],[1,"warnings"],[2,"color","red"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"description"]],template:function(n,t){1&n&&(e.YNc(0,xt,35,9,"div",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,t.pipelineModel$))},directives:[m.O5,w.lW,Q.$,E.Hw,m.sg,R.Rr],pipes:[m.Ov],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}"]}),o}();function Et(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"div",8),e.NdJ("click",function(){var s=e.CHM(n).$implicit;return e.oxw(4).addDataSource(s)}),e.TgZ(1,"mat-icon"),e._uU(2),e.qZA(),e.TgZ(3,"span"),e._uU(4),e.qZA(),e.qZA()}if(2&o){var t=l.$implicit,i=e.oxw(4);e.Q6J("tippy",t.UiHint||t.Name),e.xp6(2),e.Oqu(t.Icon||i.guiTypes.Unknown.Icon),e.xp6(2),e.Oqu(t.Name)}}function kt(o,l){if(1&o&&(e.TgZ(0,"div",6),e.YNc(1,Et,5,3,"div",7),e.qZA()),2&o){var n=e.oxw().$implicit,t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",n.value)("ngForTrackBy",t.trackDataSources)}}function Pt(o,l){if(1&o){var n=e.EpF();e.ynx(0),e.TgZ(1,"div",4),e.NdJ("click",function(){var s=e.CHM(n).$implicit;return e.oxw(2).toggleItem(s.key)}),e.TgZ(2,"mat-icon"),e._uU(3),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA(),e.qZA(),e.YNc(6,kt,2,2,"div",5),e.BQk()}if(2&o){var t=l.$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("tippy",i.guiTypes[t.key].UiHint||t.key),e.xp6(2),e.Oqu(i.guiTypes[t.key].Icon||i.guiTypes.Unknown.Icon),e.xp6(2),e.Oqu(t.key),e.xp6(1),e.Q6J("ngIf",i.toggledItems.includes(t.key))}}function It(o,l){if(1&o){var n=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"mat-slide-toggle",2),e.NdJ("change",function(r){return e.CHM(n),e.oxw().toggleDifficulty(r)}),e._uU(2," Show Advanced "),e.qZA(),e.YNc(3,Pt,7,4,"ng-container",3),e.ALo(4,"keyvalue"),e.qZA()}if(2&o){var t=l.ngIf,i=e.oxw();e.xp6(3),e.Q6J("ngForOf",e.lcZ(4,2,t))("ngForTrackBy",i.trackGroups)}}var Ot=function(){var o=function(){function l(n){(0,C.Z)(this,l),this.visualQueryService=n,this.toggledItems=[],this.guiTypes=Y,this.difficulties=Z.Z.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new M.X(this.difficulties.default)}return(0,b.Z)(l,[{key:"ngOnInit",value:function(){this.sorted$=(0,B.a)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,x.U)(function(t){var i=(0,U.Z)(t,2);return function At(o,l){if(o){var t=(0,A.Z)(o).filter(function(u){return u.Difficulty<=l&&u.PartAssemblyAndType!==Z.Z.pipelineDesigner.outDataSource.PartAssemblyAndType});t.sort(function(u,d){return u.Name.toLocaleLowerCase().localeCompare(d.Name.toLocaleLowerCase())});var r,i={},a=(0,q.Z)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value,c=s.PrimaryType;i[c]?i[c].push(s):i[c]=[s]}}catch(u){a.e(u)}finally{a.f()}return i}}(i[0],i[1])}))}},{key:"ngOnDestroy",value:function(){this.difficulty$.complete()}},{key:"toggleDifficulty",value:function(t){this.difficulty$.next(t.checked?this.difficulties.advanced:this.difficulties.default)}},{key:"addDataSource",value:function(t){this.visualQueryService.addDataSource(t)}},{key:"toggleItem",value:function(t){N.iX.toggleInArray(t,this.toggledItems)}},{key:"trackGroups",value:function(t,i){return i.key}},{key:"trackDataSources",value:function(t,i){return i.PartAssemblyAndType}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(P))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],["labelPosition","before","color","primary",3,"change"],[4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"collapsible",3,"tippy","click"],["class","list",4,"ngIf"],[1,"list"],["class","list-item","tippyShowDelay","750",3,"tippy","click",4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"list-item",3,"tippy","click"]],template:function(n,t){1&n&&(e.YNc(0,It,5,4,"div",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,t.sorted$))},directives:[m.O5,R.Rr,m.sg,Q.$,E.Hw],pipes:[m.Ov,m.Nd],styles:[".mat-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}"]}),o}(),se=function(l){return{active:l}},wt=[{path:"",component:function(){var o=function(){function l(n,t,i){(0,C.Z)(this,l),this.context=n,this.route=t,this.visualQueryService=i,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}return(0,b.Z)(l,[{key:"ngOnInit",value:function(){this.visualQueryService.init()}},{key:"toggleExplorer",value:function(t){this.activeExplorer=this.activeExplorer===t?null:t}},{key:"openHelp",value:function(){window.open("http://r.2sxc.org/visual-query","_blank")}}]),l}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(L._),e.Y36(D.gz),e.Y36(P))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-visual-query"]],viewQuery:function(n,t){var i;1&n&&e.Gf(le,5),2&n&&e.iGM(i=e.CRH())&&(t.plumbEditor=i.first)},features:[e._Bn([P])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"ngClass","click"],["tippy","Add",1,"button",3,"ngClass","click"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(n,t){1&n&&(e._UZ(0,"router-outlet"),e.TgZ(1,"div",0),e.TgZ(2,"div",1),e.TgZ(3,"div",2),e.NdJ("click",function(){return t.toggleExplorer(t.explorer.run)}),e.TgZ(4,"mat-icon"),e._uU(5,"play_arrow"),e.qZA(),e.qZA(),e.TgZ(6,"div",3),e.NdJ("click",function(){return t.toggleExplorer(t.explorer.add)}),e.TgZ(7,"mat-icon"),e._uU(8,"add"),e.qZA(),e.qZA(),e._UZ(9,"div",4),e.TgZ(10,"div",5),e.NdJ("click",function(){return t.openHelp()}),e.TgZ(11,"mat-icon"),e._uU(12,"help_outline"),e.qZA(),e.qZA(),e.qZA(),e._UZ(13,"app-run-explorer",6),e._UZ(14,"app-add-explorer",6),e._UZ(15,"app-plumb-editor"),e.qZA()),2&n&&(e.xp6(3),e.Q6J("ngClass",e.VKq(4,se,t.activeExplorer===t.explorer.run)),e.xp6(3),e.Q6J("ngClass",e.VKq(6,se,t.activeExplorer===t.explorer.add)),e.xp6(7),e.Q6J("hidden",t.activeExplorer!==t.explorer.run),e.xp6(1),e.Q6J("hidden",t.activeExplorer!==t.explorer.add))},directives:[D.lC,Q.$,m.mk,E.Hw,Dt,Ot,le],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),o}(),children:[ie.ii.route,{matcher:de.eP,loadChildren:function(){return Promise.all([p.e("default-node_modules_angular_material_fesm2015_progress-spinner_mjs"),p.e("default-projects_ng-dialogs_src_app_create-file-dialog_index_ts"),p.e("default-node_modules_angular_material_fesm2015_list_mjs"),p.e("default-projects_ng-dialogs_src_app_monaco-editor_index_ts-projects_ng-dialogs_src_app_shared-7048b1"),p.e("default-projects_edit_edit_module_ts"),p.e("default-node_modules_angular_cdk_fesm2015_drag-drop_mjs"),p.e("default-node_modules_angular_material_fesm2015_menu_mjs"),p.e("default-node_modules_angular_material_fesm2015_autocomplete_mjs"),p.e("node_modules_angular_material_fesm2015_card_mjs")]).then(p.bind(p,8107)).then(function(l){return l.EditModule})},data:{history:!1}}]}],Rt=function(){var o=(0,b.Z)(function l(){(0,C.Z)(this,l)});return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[D.Bz.forChild(wt)],D.Bz]}),o}(),qt=function(){var o=(0,b.Z)(function l(){(0,C.Z)(this,l)});return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[L._,j,ne.D,te.s],imports:[[m.ez,ue.q,Rt,E.Ps,w.ot,R.rP,ee.ZX,S.Is,J.Nh,$.lN,T.UX,K.LD,X.c,R.rP]]}),o}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.03.00/ng-edit/projects_ng-dialogs_src_app_visual-query_visual-query_module_ts.f46871ace36ccf0f.js.map