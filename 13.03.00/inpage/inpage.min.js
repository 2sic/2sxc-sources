var $2sxcInpage =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "../$2sxc/src/Stats.ts":
/*!*****************************!*\
  !*** ../$2sxc/src/Stats.ts ***!
  \*****************************/
/*! exports provided: Stats */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Stats", function() { return Stats; });
var Stats = /** @class */ (function () {
    function Stats() {
        this.watchDomChanges = 0;
    }
    return Stats;
}());



/***/ }),

/***/ "../$2sxc/src/constants/index.ts":
/*!***************************************!*\
  !*** ../$2sxc/src/constants/index.ts ***!
  \***************************************/
/*! exports provided: ApiExtensionPlaceholder, MetaHeaderJsApi, DnnUiRoot, PlatformOqtane, PlatformDnn, AntiForgeryTokenHeaderNameDnn */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ApiExtensionPlaceholder", function() { return ApiExtensionPlaceholder; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MetaHeaderJsApi", function() { return MetaHeaderJsApi; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DnnUiRoot", function() { return DnnUiRoot; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PlatformOqtane", function() { return PlatformOqtane; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PlatformDnn", function() { return PlatformDnn; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AntiForgeryTokenHeaderNameDnn", function() { return AntiForgeryTokenHeaderNameDnn; });
/** This is a placeholder in the settings, which must be replaced with "2sxc" or another term for other dnn extensions */
var ApiExtensionPlaceholder = 'e.x.t';
/** The special header meta tag containing settings for 2sxc */
var MetaHeaderJsApi = '_jsApi';
/** The fallback path to the UI */
var DnnUiRoot = '/desktopmodules/tosic_sexycontent/';
var PlatformOqtane = 'oqtane';
var PlatformDnn = 'dnn';
/** The fallback AntiForgery token header name (as in Dnn) */
var AntiForgeryTokenHeaderNameDnn = 'RequestVerificationToken';


/***/ }),

/***/ "../$2sxc/src/environment/env-loader-dnn-sf.ts":
/*!*****************************************************!*\
  !*** ../$2sxc/src/environment/env-loader-dnn-sf.ts ***!
  \*****************************************************/
/*! exports provided: EnvironmentDnnSfLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "EnvironmentDnnSfLoader", function() { return EnvironmentDnnSfLoader; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");
/* harmony import */ var _constants_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants/index */ "../$2sxc/src/constants/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var helpAutoDetect = 'You must either include jQuery on the page or inject the jsApi parameters to prevent auto-detection.';
/**
 * This helps load environment information from DNN ServicesFramework - it's a fallback in case the other mechanisms fail
 */
var EnvironmentDnnSfLoader = /** @class */ (function (_super) {
    __extends(EnvironmentDnnSfLoader, _super);
    function EnvironmentDnnSfLoader(env) {
        var _this = _super.call(this, 'Env.DnnLdr', env.log) || this;
        _this.env = env;
        return _this;
    }
    /**
     * This will assume the new parameter injection failed and it will attempt to fallback
     * it's for backward compatibility, in case something is using $2sxc and doesn't provide the new
     * implementation
     */
    EnvironmentDnnSfLoader.prototype.dnnSfFallback = function () {
        var _this = this;
        var cl = this.log.call('dnnSfFallback');
        // await page-ready to then initialize the stuff
        ___WEBPACK_IMPORTED_MODULE_0__["NoJQ"].ready(function () { return _this.dnnSfLoadWhenDocumentReady(); });
        cl.done('started dom-ready watcher');
    };
    EnvironmentDnnSfLoader.prototype.dnnSfLoadWhenDocumentReady = function () {
        var cl = this.log.call('dnnSfLoadWhenDocumentReady');
        if (typeof window.$ === 'undefined') {
            cl.done('error');
            throw "Can't load pageid, moduleid, etc. and $ is not available. \n " + helpAutoDetect;
        }
        var sf = window.$.ServicesFramework;
        if (typeof sf === 'undefined') {
            cl.done('error');
            throw "Can't load pageid, moduleid etc. and DNN SF is not available. \n " + helpAutoDetect;
        }
        var dnnSf = sf(0);
        var apiRoot = dnnSf.getServiceRoot('2sxc');
        var sfJsInfo = {
            page: dnnSf.getTabId(),
            root: 'unknown',
            api: apiRoot,
            appApi: apiRoot,
            rvtHeader: _constants_index__WEBPACK_IMPORTED_MODULE_1__["AntiForgeryTokenHeaderNameDnn"],
            rvt: dnnSf.getAntiForgeryValue(),
            uiRoot: _constants_index__WEBPACK_IMPORTED_MODULE_1__["DnnUiRoot"],
            platform: _constants_index__WEBPACK_IMPORTED_MODULE_1__["PlatformDnn"],
        };
        this.env.load(sfJsInfo, 'dnn SF');
        cl.done();
    };
    return EnvironmentDnnSfLoader;
}(___WEBPACK_IMPORTED_MODULE_0__["HasLog"]));



/***/ }),

/***/ "../$2sxc/src/environment/env-loader-dynamic.ts":
/*!******************************************************!*\
  !*** ../$2sxc/src/environment/env-loader-dynamic.ts ***!
  \******************************************************/
/*! exports provided: EnvironmentLoaderDynamic */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "EnvironmentLoaderDynamic", function() { return EnvironmentLoaderDynamic; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");

var InputValue = 'value';
var SelectorInputRvt = "input[name=__RequestVerificationToken]";
/**
 * Special loader for dynamic pages like Oqtane, where content can change at runtime
 */
var EnvironmentLoaderDynamic = /** @class */ (function () {
    function EnvironmentLoaderDynamic(mainLoader) {
        this.mainLoader = mainLoader;
        this.log = new ___WEBPACK_IMPORTED_MODULE_0__["Log"]('ldr.dynmic', mainLoader.log);
    }
    /**
     * Watch for changes in our special meta header, to update the variables.
     * Important for Oqtane, which changes the page on the fly without reloading.
     */
    EnvironmentLoaderDynamic.prototype.startMetaTagObserver = function (attribute) {
        var _this = this;
        if (!!this.observer)
            return;
        this.observer = new MutationObserver(function (mutationsList) {
            for (var _i = 0, mutationsList_1 = mutationsList; _i < mutationsList_1.length; _i++) {
                var mut = mutationsList_1[_i];
                if (mut.type === 'attributes' && mut.attributeName === attribute)
                    _this.mainLoader.updateEnv(JSON.parse(_this.mainLoader.getMetaContent()));
            }
        });
        this.log.add('start observing meta tag');
        this.observer.observe(this.mainLoader.getJsApiMetaTag(), { attributes: true, childList: false, subtree: false });
    };
    /**
     * Load RequestVerificationToken from the hidden form-field in Oqtane
     */
    EnvironmentLoaderDynamic.prototype.startInputRvtObserver = function () {
        var _this = this;
        if (!!this.inputRvtObserver)
            return;
        this.inputRvtObserver = new MutationObserver(function (mutationsList) {
            for (var _i = 0, mutationsList_2 = mutationsList; _i < mutationsList_2.length; _i++) {
                var mut = mutationsList_2[_i];
                if (mut.type === 'attributes' && mut.attributeName === InputValue)
                    _this.loadRvtFromHiddenInput(mut.target);
            }
        });
        this.log.add('start observing Rvt Input');
        var hiddenField = document.querySelector(SelectorInputRvt);
        this.loadRvtFromHiddenInput(hiddenField);
        this.inputRvtObserver.observe(hiddenField, { attributes: true, childList: false, subtree: false });
    };
    EnvironmentLoaderDynamic.prototype.loadRvtFromHiddenInput = function (input) {
        this.log.add('Input Rvt updated');
        if (input && input.value)
            this.mainLoader.env.updateRvt(input.value);
    };
    return EnvironmentLoaderDynamic;
}());



/***/ }),

/***/ "../$2sxc/src/environment/env-loader-meta.ts":
/*!***************************************************!*\
  !*** ../$2sxc/src/environment/env-loader-meta.ts ***!
  \***************************************************/
/*! exports provided: EnvironmentMetaLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "EnvironmentMetaLoader", function() { return EnvironmentMetaLoader; });
/* harmony import */ var _env_loader_dnn_sf__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./env-loader-dnn-sf */ "../$2sxc/src/environment/env-loader-dnn-sf.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants */ "../$2sxc/src/constants/index.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");
/* harmony import */ var _env_loader_dynamic__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./env-loader-dynamic */ "../$2sxc/src/environment/env-loader-dynamic.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




// temp: usually 10, but because Oqtane has some delays, we'll temporarily increase to 100 till we're safe
var maxRetries = 100;
var retryMs = 10;
var MetaSourceId = 'meta header';
var MetaProperty = 'content';
function logTest() {
    console.log('test');
    return true;
}
/**
 * This loads environment information from the meta-header tag.
 * Because of timing issues, it will try multiple times
 */
var EnvironmentMetaLoader = /** @class */ (function (_super) {
    __extends(EnvironmentMetaLoader, _super);
    function EnvironmentMetaLoader(env) {
        var _this = _super.call(this, 'Env.MetaLd', logTest ? env.log : env.log) || this;
        _this.env = env;
        _this.retries = 0;
        _this.dynamicPageHelper = new _env_loader_dynamic__WEBPACK_IMPORTED_MODULE_3__["EnvironmentLoaderDynamic"](_this);
        return _this;
    }
    EnvironmentMetaLoader.prototype.loadMetaFromHeader = function (forceFallback) {
        var _this = this;
        if (forceFallback === void 0) { forceFallback = false; }
        var cl = this.log.call('loadMetaFromHeader', "" + forceFallback);
        // avoid duplicate execution
        if (this.env.ready)
            return cl.done('loadMeta - ready');
        this.log.add('loadMetaFromHeader: start, retry:' + this.retries + ', force fallback: ' + forceFallback);
        var meta = this.getMetaContent();
        if (!meta) {
            this.retries++;
            if (forceFallback || this.retries >= maxRetries) {
                new _env_loader_dnn_sf__WEBPACK_IMPORTED_MODULE_0__["EnvironmentDnnSfLoader"](this.env).dnnSfFallback();
                return cl.done();
            }
            setTimeout(function () { _this.loadMetaFromHeader(); }, retryMs);
            return cl.done('will retry');
        }
        // Load the settings
        this.updateEnv(JSON.parse(meta));
        // monitor setting changes - important for Oqtane
        this.dynamicPageHelper.startMetaTagObserver(MetaProperty);
        cl.done();
    };
    EnvironmentMetaLoader.prototype.updateEnv = function (newJsInfo) {
        this.log.add('meta env info updated');
        this.env.load(newJsInfo, MetaSourceId);
        if (newJsInfo.platform === _constants__WEBPACK_IMPORTED_MODULE_1__["PlatformOqtane"])
            this.dynamicPageHelper.startInputRvtObserver();
    };
    EnvironmentMetaLoader.prototype.getMetaContent = function () {
        var ourMeta = this.getJsApiMetaTag();
        if (!ourMeta)
            return null;
        return ourMeta.getAttribute(MetaProperty);
    };
    EnvironmentMetaLoader.prototype.getJsApiMetaTag = function () {
        return document.querySelector("meta[name=" + _constants__WEBPACK_IMPORTED_MODULE_1__["MetaHeaderJsApi"] + "]");
    };
    /**
     * Watch for changes in our special meta header, to update the variables.
     * Important for Oqtane, which changes the page on the fly without reloading.
     */
    EnvironmentMetaLoader.prototype.startMetaTagObserver = function () {
        var _this = this;
        if (!!this.observer)
            return;
        this.observer = new MutationObserver(function (mutationsList) {
            for (var _i = 0, mutationsList_1 = mutationsList; _i < mutationsList_1.length; _i++) {
                var mut = mutationsList_1[_i];
                if (mut.type === 'attributes' && mut.attributeName === MetaProperty)
                    _this.updateEnv(JSON.parse(_this.getMetaContent()));
            }
        });
        this.log.add('start observing meta tag');
        this.observer.observe(this.getJsApiMetaTag(), { attributes: true, childList: false, subtree: false });
    };
    return EnvironmentMetaLoader;
}(___WEBPACK_IMPORTED_MODULE_2__["HasLog"]));



/***/ }),

/***/ "../$2sxc/src/environment/index.ts":
/*!*****************************************!*\
  !*** ../$2sxc/src/environment/index.ts ***!
  \*****************************************/
/*! exports provided: Environment */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _root_environment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./root-environment */ "../$2sxc/src/environment/root-environment.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Environment", function() { return _root_environment__WEBPACK_IMPORTED_MODULE_0__["Environment"]; });




/***/ }),

/***/ "../$2sxc/src/environment/root-environment.ts":
/*!****************************************************!*\
  !*** ../$2sxc/src/environment/root-environment.ts ***!
  \****************************************************/
/*! exports provided: Environment */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Environment", function() { return Environment; });
/* harmony import */ var _env_loader_meta__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./env-loader-meta */ "../$2sxc/src/environment/env-loader-meta.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants */ "../$2sxc/src/constants/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



/**
 * Provides environment information to $2sxc - usually page-id, api-root and stuff like that
 */
var Environment = /** @class */ (function (_super) {
    __extends(Environment, _super);
    function Environment() {
        var _this = _super.call(this, 'Environment', null, 'starting') || this;
        _this.ready = false;
        _this.source = '';
        _this.log.keepData = true; // always keep here for clarity
        ___WEBPACK_IMPORTED_MODULE_1__["Insights"].add('system', 'environment', _this.log);
        _this.metaLoader = new _env_loader_meta__WEBPACK_IMPORTED_MODULE_0__["EnvironmentMetaLoader"](_this);
        // check if a global variable was already set which we should use
        if (typeof _jsApi !== typeof undefined) {
            _this.log.add('found _jsApi, will use');
            _this.load(_jsApi, 'global variable _jsApi');
        }
        else {
            _this.log.add('will start initializing');
            _this.metaLoader.loadMetaFromHeader();
        }
        return _this;
    }
    /**
     * Load a new jsInfo - must be public, as it's used in iframes where jquery is missing
     * @param newJsInfo new info to load
     */
    Environment.prototype.load = function (newJsInfo, source) {
        var cl = this.log.call('load');
        if (newJsInfo.root && !newJsInfo.api) {
            cl.add('root provided, api missing, will auto-complete');
            var addSlash = (newJsInfo.root.endsWith('/') ? '' : '/');
            newJsInfo.api = "" + newJsInfo.root + addSlash + ___WEBPACK_IMPORTED_MODULE_1__["SxcApiUrlRoot"];
        }
        this.header = newJsInfo;
        // in some cases the UpdateRvt may already have been called before
        // in which case it's probably more relevant
        // so we should set it again
        if (this.replacedRvt)
            this.header.rvt = this.replacedRvt;
        this.ready = true;
        this.source = source || 'external/unknown' + (this.replacedRvt ? '+rvt' : '');
        cl.return(newJsInfo, 'loaded from ' + this.source);
    };
    Environment.prototype.updateRvt = function (newRvt) {
        if (!newRvt)
            return;
        this.replacedRvt = newRvt;
        this.header.rvt = newRvt;
    };
    Environment.prototype.api = function () {
        this.ensureReadyOrThrow('api');
        return this.header.api;
    };
    // WIP - may return undefined
    Environment.prototype.appApi = function () {
        // WIP - must get it to work without 'appApi' but only 'api' to ensure ...
        this.ensureReadyOrThrow('appApi');
        return this.header.appApi;
    };
    Environment.prototype.page = function () {
        this.ensureReadyOrThrow('page');
        return this.header.page;
    };
    Environment.prototype.rvtHeader = function () {
        this.ensureReadyOrThrow('rvtHeader');
        return this.header.rvtHeader || _constants__WEBPACK_IMPORTED_MODULE_2__["AntiForgeryTokenHeaderNameDnn"];
    };
    Environment.prototype.rvt = function () {
        this.ensureReadyOrThrow('rvt');
        return this.header.rvt;
    };
    Environment.prototype.uiRoot = function () {
        this.ensureReadyOrThrow('uiRoot');
        return this.header.uiRoot || _constants__WEBPACK_IMPORTED_MODULE_2__["DnnUiRoot"];
    };
    Environment.prototype.platform = function () {
        this.ensureReadyOrThrow('platform');
        return this.header.platform || _constants__WEBPACK_IMPORTED_MODULE_2__["PlatformDnn"];
    };
    Environment.prototype.ensureReadyOrThrow = function (partRequested) {
        if (this.ready)
            return;
        // try one last time - usually it should really be ready by now
        this.log.add('ensureReady - force last attempt to load MetaHeader for ' + partRequested);
        this.metaLoader.loadMetaFromHeader(true);
        // if still not ready, throw exception to console log
        if (this.ready)
            return;
        throw "Can't find " + partRequested + " - something went wrong, pls contact 2sxc.org";
    };
    return Environment;
}(___WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "../$2sxc/src/http/sxc-http.ts":
/*!*************************************!*\
  !*** ../$2sxc/src/http/sxc-http.ts ***!
  \*************************************/
/*! exports provided: SxcHttp */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcHttp", function() { return SxcHttp; });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../constants */ "../$2sxc/src/constants/index.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



var SxcHttp = /** @class */ (function (_super) {
    __extends(SxcHttp, _super);
    function SxcHttp(env) {
        var _this = _super.call(this, 'Sxc.Http') || this;
        _this.env = env;
        return _this;
    }
    /**
     * All the headers which are needed in an ajax call for this to work reliably.
     * Use this if you need to get a list of headers in another system
     */
    SxcHttp.prototype.headers = function (id, cbid) {
        var cl = this.log.call('headers', id + ", " + cbid);
        var fHeaders = {}; // as any;
        var pageId = this.env.page().toString();
        if (id)
            fHeaders[___WEBPACK_IMPORTED_MODULE_1__["HeaderNames"].ModuleId] = id.toString();
        if (cbid)
            fHeaders[___WEBPACK_IMPORTED_MODULE_1__["HeaderNames"].ContentBlockId] = cbid.toString();
        fHeaders[___WEBPACK_IMPORTED_MODULE_1__["HeaderNames"].TabId] = pageId;
        fHeaders[___WEBPACK_IMPORTED_MODULE_1__["HeaderNames"].PageId] = pageId;
        fHeaders[this.env.rvtHeader()] = this.env.rvt();
        return cl.return(fHeaders, "headers(id:" + id + ", cbid:" + cbid + ")");
    };
    /**
     * Get the API-Root path for a specific extension/endpoint
     * @param {string} endpointName
     * @returns {string}
     * @memberof SxcHttp
     */
    SxcHttp.prototype.apiRoot = function (endpointName) {
        var cl = this.log.call('apiRoot');
        var result = this.env.api().replace(_constants__WEBPACK_IMPORTED_MODULE_0__["ApiExtensionPlaceholder"], endpointName);
        return cl.return(result, "apiRoot('" + endpointName + "')");
    };
    /**
     * Get the API-Root path for Apps
     * new in v12
     * @param {string} endpointName
     * @returns {string}
     * @memberof SxcHttp
     */
    SxcHttp.prototype.appApiRoot = function () {
        var _a;
        var cl = this.log.call('appApiRoot');
        // try to get it, or fall back to the previous / old convention
        var result = (_a = this.env.appApi()) !== null && _a !== void 0 ? _a : this.apiRoot(___WEBPACK_IMPORTED_MODULE_1__["ToSxcName"]);
        return cl.return(result, "appApiRoot()");
    };
    /**
     * Get the URL for a specific web API endpoint
     * Will ignore urls which clearly already are the full url.
     * @param {string} url
     * @param {string} [endpointName]
     * @returns
     * @memberof SxcHttp
     */
    SxcHttp.prototype.apiUrl = function (url, endpointName) {
        var cl = this.log.call('apiUrl');
        this.log.add("apiUrl(url:'" + url + "', endpointName:'" + endpointName + "')");
        // null/undefined check
        if (url == null)
            return url;
        // if starts with http: or https: then ignore
        if (!url || url.indexOf('http:') == 0 || url.indexOf('https:') == 0 || url.indexOf('//') == 0)
            return cl.return(url);
        // if no endpoint specified, then also skip absolute and relative urls
        if (!endpointName && (url.indexOf('/') == 0 || url.indexOf('.') == 0))
            return cl.return(url);
        var baseUrl = url.toLocaleLowerCase().startsWith(___WEBPACK_IMPORTED_MODULE_1__["AppApiMarker"])
            ? this.appApiRoot()
            : this.apiRoot(endpointName || ___WEBPACK_IMPORTED_MODULE_1__["ToSxcName"]);
        // ensure base ends with slash
        if (baseUrl[baseUrl.length - 1] != '/')
            baseUrl += '/';
        // ensure url doesn't start with slash
        if (url[0] == '/')
            url = url.slice(1);
        return cl.return(baseUrl + url);
    };
    return SxcHttp;
}(___WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "../$2sxc/src/index.ts":
/*!*****************************!*\
  !*** ../$2sxc/src/index.ts ***!
  \*****************************/
/*! exports provided: ToSxcName, SxcVersion, SxcApiUrlRoot, HeaderNames, ApiUrlRoots, AppApiMarker, AppApiMap, NumberNotDefinedHuge, LogEntryOptions, HasLog, Log, LogCall, Entry, Insights, Obj, urlClean, NoJQ, AssetsLoader, TotalPopup, UrlParamManager, Environment, SxcHttp, SxcInstance, SxcInstanceWithInternals, SxcWebApi, AjaxPromise, Debug, ContextIdentifier, isContextIdentifier, ensureCompleteOrThrow, getRootPartsV2, buildSxcRoot */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core */ "../core/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToSxcName", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["ToSxcName"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcVersion", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["SxcVersion"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcApiUrlRoot", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["SxcApiUrlRoot"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HeaderNames", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["HeaderNames"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ApiUrlRoots", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["ApiUrlRoots"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMarker", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["AppApiMarker"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMap", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["AppApiMap"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NumberNotDefinedHuge", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["NumberNotDefinedHuge"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogEntryOptions", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HasLog", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["HasLog"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Log", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Log"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogCall", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["LogCall"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Entry", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Entry"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Insights", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Insights"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Obj", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Obj"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "urlClean", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["urlClean"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NoJQ", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["NoJQ"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AssetsLoader", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["AssetsLoader"]; });

/* harmony import */ var _tools_total_popup__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tools/total-popup */ "../$2sxc/src/tools/total-popup.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TotalPopup", function() { return _tools_total_popup__WEBPACK_IMPORTED_MODULE_1__["TotalPopup"]; });

/* harmony import */ var _tools_url_param_manager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./tools/url-param-manager */ "../$2sxc/src/tools/url-param-manager.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "UrlParamManager", function() { return _tools_url_param_manager__WEBPACK_IMPORTED_MODULE_2__["UrlParamManager"]; });

/* harmony import */ var _environment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./environment */ "../$2sxc/src/environment/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Environment", function() { return _environment__WEBPACK_IMPORTED_MODULE_3__["Environment"]; });

/* harmony import */ var _http_sxc_http__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./http/sxc-http */ "../$2sxc/src/http/sxc-http.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcHttp", function() { return _http_sxc_http__WEBPACK_IMPORTED_MODULE_4__["SxcHttp"]; });

/* harmony import */ var _sxc_instance__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./sxc-instance */ "../$2sxc/src/sxc-instance/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcInstance", function() { return _sxc_instance__WEBPACK_IMPORTED_MODULE_5__["SxcInstance"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcInstanceWithInternals", function() { return _sxc_instance__WEBPACK_IMPORTED_MODULE_5__["SxcInstanceWithInternals"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcWebApi", function() { return _sxc_instance__WEBPACK_IMPORTED_MODULE_5__["SxcWebApi"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AjaxPromise", function() { return _sxc_instance__WEBPACK_IMPORTED_MODULE_5__["AjaxPromise"]; });

/* harmony import */ var _sxc_root_debug__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./sxc-root/debug */ "../$2sxc/src/sxc-root/debug.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Debug", function() { return _sxc_root_debug__WEBPACK_IMPORTED_MODULE_6__["Debug"]; });

/* harmony import */ var _sxc_root_context_identifier__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./sxc-root/context-identifier */ "../$2sxc/src/sxc-root/context-identifier.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextIdentifier", function() { return _sxc_root_context_identifier__WEBPACK_IMPORTED_MODULE_7__["ContextIdentifier"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isContextIdentifier", function() { return _sxc_root_context_identifier__WEBPACK_IMPORTED_MODULE_7__["isContextIdentifier"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ensureCompleteOrThrow", function() { return _sxc_root_context_identifier__WEBPACK_IMPORTED_MODULE_7__["ensureCompleteOrThrow"]; });

/* harmony import */ var _sxc_root_sxc_root__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./sxc-root/sxc-root */ "../$2sxc/src/sxc-root/sxc-root.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getRootPartsV2", function() { return _sxc_root_sxc_root__WEBPACK_IMPORTED_MODULE_8__["getRootPartsV2"]; });

/* harmony import */ var _sxc_root_sxc_root_builder__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./sxc-root/sxc-root-builder */ "../$2sxc/src/sxc-root/sxc-root-builder.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "buildSxcRoot", function() { return _sxc_root_sxc_root_builder__WEBPACK_IMPORTED_MODULE_9__["buildSxcRoot"]; });

/*
    This is just a type-index entry point.
    The purpose is that other 2sxc projects in this repo can access all the types
    in this project from here, without having to know the exact code files

    Note that the order of things in this file can cause trouble
    As webpack needs the order to be correct, meaning some depedencies need to be early
*/
// core library stuff, including Logging












/***/ }),

/***/ "../$2sxc/src/sxc-instance/data/sxc-data-query-base.ts":
/*!*************************************************************!*\
  !*** ../$2sxc/src/sxc-instance/data/sxc-data-query-base.ts ***!
  \*************************************************************/
/*! exports provided: SxcDataQueryBase */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcDataQueryBase", function() { return SxcDataQueryBase; });
/* harmony import */ var _sxc_instance_part__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../sxc-instance-part */ "../$2sxc/src/sxc-instance/sxc-instance-part.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

/**
* Base class doing common checks
*/
var SxcDataQueryBase = /** @class */ (function (_super) {
    __extends(SxcDataQueryBase, _super);
    /**
    * Creates an instance of SxcData.
    * @param {SxcInstance} sxc
    * @param {string} name the content-type name
    * @memberof SxcData
    */
    function SxcDataQueryBase(sxc, name, nameInError) {
        var _this = _super.call(this, sxc, 'data') || this;
        _this.name = name;
        _this.webApi = sxc.webApi;
        // Fail early if something is wrong
        nameInError += ' name ';
        if (name == null)
            throw nameInError + 'is empty';
        if (name.indexOf("/") != -1 || name.indexOf("\\") != -1)
            throw nameInError + 'has slashes - not allowed';
        if (name.indexOf("?") != -1)
            throw nameInError + 'has "?" - not allowed';
        return _this;
    }
    return SxcDataQueryBase;
}(_sxc_instance_part__WEBPACK_IMPORTED_MODULE_0__["SxcInstancePart"]));



/***/ }),

/***/ "../$2sxc/src/sxc-instance/data/sxc-data.ts":
/*!**************************************************!*\
  !*** ../$2sxc/src/sxc-instance/data/sxc-data.ts ***!
  \**************************************************/
/*! exports provided: SxcData */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcData", function() { return SxcData; });
/* harmony import */ var _sxc_data_query_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sxc-data-query-base */ "../$2sxc/src/sxc-instance/data/sxc-data-query-base.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var ContentApiRoot = 'app/auto/data';
var TargetTypeEntity = 4;
/**
* Instance Data accessor to get (and in future create/update) data items/entities
*/
var SxcData = /** @class */ (function (_super) {
    __extends(SxcData, _super);
    /**
    * Creates an instance of SxcData.
    * @param {SxcInstance} sxc
    * @param {string} name the content-type name
    * @memberof SxcData
    */
    function SxcData(sxc, name) {
        var _this = _super.call(this, sxc, name, 'ContentType') || this;
        _this.name = name;
        return _this;
    }
    /**
    * Get all items of this type.
    */
    SxcData.prototype.getAll = function () {
        return this.getInternal();
    };
    /**
    * Get the specific item with the ID. It will return null if not found
    */
    SxcData.prototype.getOne = function (id) {
        return this.getInternal(id);
    };
    ;
    // Future
    SxcData.prototype.getMany = function (criteria, fields) {
        throw 'not implemented - probably v13.5 or something';
    };
    /**
    * Get all or one data entity from the backend
    * @param id optional id as number or string - if not provided, will get all
    * @param params optional parameters - ATM not usefuly but we plan to support more filters etc.
    * @returns an array with 1 or n entities in the simple JSON format
    */
    SxcData.prototype.getInternal = function (id, params) {
        var path = ContentApiRoot + "/" + this.name;
        if (id && (typeof id === 'string' || typeof id === 'number'))
            path += "/" + id;
        return this.webApi.fetchJson(this.webApi.url(path, params));
    };
    SxcData.prototype.create = function (values, metadataFor) {
        var path = ContentApiRoot + "/" + this.name;
        if (metadataFor != null) {
            if (typeof (metadataFor) === 'string')
                metadataFor = { Target: TargetTypeEntity, Guid: metadataFor };
            try {
                values.For = metadataFor;
            }
            catch (_a) { }
        }
        return this.webApi.fetchJson(this.webApi.url(path), values, 'POST');
    };
    SxcData.prototype.update = function (id, values) {
        var path = ContentApiRoot + "/" + this.name + "/" + id;
        return this.webApi.fetchJson(this.webApi.url(path), values, 'POST');
    };
    SxcData.prototype.delete = function (idOrGuid) {
        var path = ContentApiRoot + "/" + this.name + "/" + idOrGuid;
        return this.webApi.fetch(this.webApi.url(path), undefined, 'DELETE').then(function (response) { return null; });
    };
    return SxcData;
}(_sxc_data_query_base__WEBPACK_IMPORTED_MODULE_0__["SxcDataQueryBase"]));



/***/ }),

/***/ "../$2sxc/src/sxc-instance/data/sxc-query.ts":
/*!***************************************************!*\
  !*** ../$2sxc/src/sxc-instance/data/sxc-query.ts ***!
  \***************************************************/
/*! exports provided: SxcQuery */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcQuery", function() { return SxcQuery; });
/* harmony import */ var _sxc_data_query_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sxc-data-query-base */ "../$2sxc/src/sxc-instance/data/sxc-data-query-base.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

/**
 * Instance Query accessor
 */
var SxcQuery = /** @class */ (function (_super) {
    __extends(SxcQuery, _super);
    function SxcQuery(sxc, name) {
        var _this = _super.call(this, sxc, name, 'Query') || this;
        _this.name = name;
        return _this;
    }
    /**
     * Retrieve the entire query with all streams
     *
     * @template T
     * @returns {Promise<T>} containing a object with stream-names and items in the streams.
     * @memberof SxcQuery
     */
    SxcQuery.prototype.getAll = function (urlParams, data) {
        return this.getInternal(undefined, urlParams, data);
    };
    SxcQuery.prototype.getStream = function (stream, urlParams, data) {
        if (stream.indexOf(',') !== -1)
            throw "parameter 'stream' can only contain one stream name for 'getStream'";
        return this.getInternal(stream, urlParams, data).then(function (data) {
            if (data == null || !data.hasOwnProperty(stream))
                return [];
            return data[stream];
        });
    };
    /**
     * Get a query but only the selected streams.
     *
     * @template T
     * @param {string} streams
     * @returns {Promise<T>} containing a object with stream-names and items in the streams.
     * @memberof SxcQuery
     */
    SxcQuery.prototype.getStreams = function (streams, urlParams, data) {
        return this.getInternal(streams, urlParams, data);
    };
    /**
     * Get all or one data entity from the backend
     * @param id optional id as number or string - if not provided, will get all
     * @param params optional parameters - ATM not usefuly but we plan to support more filters etc.
     * @returns an array with 1 or n entities in the simple JSON format
     */
    SxcQuery.prototype.getInternal = function (streams, params, data) {
        var path = "app/auto/query/" + this.name;
        if (streams && (typeof streams === 'string'))
            path += "?stream=" + streams;
        return this.webApi.fetchJson(this.webApi.url(path, params), data);
    };
    return SxcQuery;
}(_sxc_data_query_base__WEBPACK_IMPORTED_MODULE_0__["SxcDataQueryBase"]));



/***/ }),

/***/ "../$2sxc/src/sxc-instance/index.ts":
/*!******************************************!*\
  !*** ../$2sxc/src/sxc-instance/index.ts ***!
  \******************************************/
/*! exports provided: SxcInstance, SxcInstanceWithInternals, SxcWebApi, AjaxPromise */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _sxc_instance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sxc-instance */ "../$2sxc/src/sxc-instance/sxc-instance.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcInstance", function() { return _sxc_instance__WEBPACK_IMPORTED_MODULE_0__["SxcInstance"]; });

/* harmony import */ var _sxc_instance_with_internals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sxc-instance-with-internals */ "../$2sxc/src/sxc-instance/sxc-instance-with-internals.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcInstanceWithInternals", function() { return _sxc_instance_with_internals__WEBPACK_IMPORTED_MODULE_1__["SxcInstanceWithInternals"]; });

/* harmony import */ var _web_api_sxc_web_api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./web-api/sxc-web-api */ "../$2sxc/src/sxc-instance/web-api/sxc-web-api.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcWebApi", function() { return _web_api_sxc_web_api__WEBPACK_IMPORTED_MODULE_2__["SxcWebApi"]; });

/* harmony import */ var _web_api_ajax_promise__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./web-api/ajax-promise */ "../$2sxc/src/sxc-instance/web-api/ajax-promise.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AjaxPromise", function() { return _web_api_ajax_promise__WEBPACK_IMPORTED_MODULE_3__["AjaxPromise"]; });







/***/ }),

/***/ "../$2sxc/src/sxc-instance/sxc-instance-cms.ts":
/*!*****************************************************!*\
  !*** ../$2sxc/src/sxc-instance/sxc-instance-cms.ts ***!
  \*****************************************************/
/*! exports provided: SxcInstanceCms */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcInstanceCms", function() { return SxcInstanceCms; });
/* harmony import */ var _sxc_instance_part__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sxc-instance-part */ "../$2sxc/src/sxc-instance/sxc-instance-part.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

/**
 * This is in charge of sxc.cms on the instance level.
 * ATM it just has the run command.
 * In future, it may also have dedicated command like `layout` etc.
 */
var SxcInstanceCms = /** @class */ (function (_super) {
    __extends(SxcInstanceCms, _super);
    function SxcInstanceCms() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Run a command on this sxc-instance.
     * Requires the Cms parts to be loaded.
     * @param runParams - real type is actually RunParams
     */
    SxcInstanceCms.prototype.run = function (runParams) {
        throw 'sxc instance cms.run() requires cms features "2sxc.JsCms" to be enabled to work';
    };
    return SxcInstanceCms;
}(_sxc_instance_part__WEBPACK_IMPORTED_MODULE_0__["SxcInstancePart"]));



/***/ }),

/***/ "../$2sxc/src/sxc-instance/sxc-instance-part.ts":
/*!******************************************************!*\
  !*** ../$2sxc/src/sxc-instance/sxc-instance-part.ts ***!
  \******************************************************/
/*! exports provided: SxcInstancePart */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcInstancePart", function() { return SxcInstancePart; });
/**
* Base class for anything attached to an sxc-instance
*/
var SxcInstancePart = /** @class */ (function () {
    /**
    * Creates an instance of SxcData.
    * @param {SxcInstance} sxc
    * @param {string} partName name of the part
    * @memberof SxcData
    */
    function SxcInstancePart(sxc, partName) {
        this.sxc = sxc;
        this.partName = partName;
    }
    return SxcInstancePart;
}());



/***/ }),

/***/ "../$2sxc/src/sxc-instance/sxc-instance-with-internals.ts":
/*!****************************************************************!*\
  !*** ../$2sxc/src/sxc-instance/sxc-instance-with-internals.ts ***!
  \****************************************************************/
/*! exports provided: SxcInstanceWithInternals */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcInstanceWithInternals", function() { return SxcInstanceWithInternals; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "../$2sxc/src/sxc-instance/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var warning = 'Warning Obsolete Feature on 2sxc JS: the .data has been obsolete for a long time and is repurposed. \n'
    + 'If you are calling ".data.on(...)" or ".data.sourceUrl" you are running very old code. \n'
    + 'Guidance to fix this: https://r.2sxc.org/brc-13-id.';
var SxcInstanceWithInternals = /** @class */ (function (_super) {
    __extends(SxcInstanceWithInternals, _super);
    function SxcInstanceWithInternals(id, cbid, cacheKey, $2sxc, ctx) {
        var _this = _super.call(this, id, cbid, $2sxc, ctx) || this;
        _this.id = id;
        _this.cbid = cbid;
        _this.cacheKey = cacheKey;
        _this.$2sxc = $2sxc;
        _this.source = null;
        _this.isLoaded = false;
        _this.lastRefresh = null;
        // Help cach error on call of old code
        // Background: From v3 to v12 data had a unusualy system for retrieving data belonging to the module
        // We believe it's almost never used, but the TimelineJs App always used it, and we believe
        // 2-3 other examples may have as well. 
        // Now in v13 sxc.data is used to get any kind of data,
        // and we want to make sure that old code will show a warning helping people fix this
        // All the old code would have started with sxc.data.on('load', ...) so this is where we give them the error
        // We only do this if it hasn't been done already
        if (!_this.data.on) {
            _this.data.on = function () { throw warning; };
            Object.defineProperty(_this.data, 'sourceUrl', {
                get: function () { throw warning; }
            });
        }
        return _this;
    }
    SxcInstanceWithInternals.prototype.recreate = function (resetCache) {
        if (resetCache)
            delete this.$2sxc._controllers[this.cacheKey]; // clear cache
        return this.$2sxc(this.id, this.cbid); // generate new
    };
    return SxcInstanceWithInternals;
}(___WEBPACK_IMPORTED_MODULE_0__["SxcInstance"]));



/***/ }),

/***/ "../$2sxc/src/sxc-instance/sxc-instance.ts":
/*!*************************************************!*\
  !*** ../$2sxc/src/sxc-instance/sxc-instance.ts ***!
  \*************************************************/
/*! exports provided: SxcInstance */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcInstance", function() { return SxcInstance; });
/* harmony import */ var _web_api_sxc_web_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./web-api/sxc-web-api */ "../$2sxc/src/sxc-instance/web-api/sxc-web-api.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");
/* harmony import */ var _data_sxc_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./data/sxc-data */ "../$2sxc/src/sxc-instance/data/sxc-data.ts");
/* harmony import */ var _data_sxc_query__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./data/sxc-query */ "../$2sxc/src/sxc-instance/data/sxc-query.ts");
/* harmony import */ var _sxc_instance_cms__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./sxc-instance-cms */ "../$2sxc/src/sxc-instance/sxc-instance-cms.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();






// const serviceScopes = ['app', 'app-sys', 'app-api', 'app-query', 'app-content', 'eav', 'view', 'dnn'];
/**
* The typical sxc-instance object for a specific DNN module or content-block
*/
var SxcInstance = /** @class */ (function (_super) {
    __extends(SxcInstance, _super);
    function SxcInstance(
    /** the sxc-instance ID, which is usually the DNN Module Id */
    id, 
    /**
    * content-block ID, which is either the module ID, or the content-block definitiion entity ID
    * this is an advanced concept you usually don't care about, otherwise you should research it
    */
    cbid, 
    /** The environment information, important for http-calls */
    root, 
    /**
    * Custom context information provided by the constructor - will replace auto-context detection
    */
    ctx) {
        var _this = _super.call(this, 'SxcInstance', null, 'Generating for ' + id + ':' + cbid) || this;
        _this.id = id;
        _this.cbid = cbid;
        _this.root = root;
        _this.ctx = ctx;
        _this._isSxcInstance = true;
        /**
        * The manage controller for edit/cms actions
        *
        * @type {*}
        * @memberof SxcInstance
        */
        _this.manage = null; // initialize correctly later on
        /**
         * CMS operations on this sxc-instance.
         */
        _this.cms = new _sxc_instance_cms__WEBPACK_IMPORTED_MODULE_4__["SxcInstanceCms"](_this, 'cms');
        _this.webApi = new _web_api_sxc_web_api__WEBPACK_IMPORTED_MODULE_0__["SxcWebApi"](_this);
        // add manage property, but not within initializer, because inside the manage-initializer it may reference 2sxc again
        try { // sometimes the manage can't be built, like before installing
            if (root._manage)
                root._manage.initInstance(_this);
        }
        catch (e) {
            console.error('error in 2sxc - will only log but not throw', e);
        }
        // this only works when manage exists (not installing) and translator exists too
        if (root._translateInit && _this.manage)
            // ensure that we really have a manage context, otherwise we can't initialize i18n and it doesn't make sense
            if (_this.manage.context && _this.manage.context.app && _this.manage.context.app.currentLanguage)
                root._translateInit(_this.manage); // init translate, not really nice, but ok for now
        return _this;
    }
    SxcInstance.is = function (thing) {
        var maybe = thing;
        return maybe._isSxcInstance;
    };
    /**
    * TODO: DOCS
    *
    * @param {string} contentType
    * @returns
    * @memberof SxcInstance
    */
    SxcInstance.prototype.data = function (contentType) {
        return new _data_sxc_data__WEBPACK_IMPORTED_MODULE_2__["SxcData"](this, contentType);
    };
    SxcInstance.prototype.query = function (query) {
        return new _data_sxc_query__WEBPACK_IMPORTED_MODULE_3__["SxcQuery"](this, query);
    };
    /**
    * converts a short api-call path like "/app/Blog/query/xyz" to the DNN full path
    * which varies from installation to installation like "/desktopmodules/api/2sxc/app/..."
    * @deprecated use http.apiUrl instead
    * @param virtualPath
    * @returns mapped path
    */
    SxcInstance.prototype.resolveServiceUrl = function (virtualPath) {
        var scope = virtualPath.split('/')[0].toLowerCase();
        // stop if it's not one of our special paths
        if (___WEBPACK_IMPORTED_MODULE_1__["ApiUrlRoots"].indexOf(scope) === -1)
            return virtualPath;
        return this.root.http.apiRoot(___WEBPACK_IMPORTED_MODULE_1__["ToSxcName"]) + scope + '/' + virtualPath.substring(virtualPath.indexOf('/') + 1);
    };
    // Show a nice error with more infos around 2sxc
    SxcInstance.prototype.showDetailedHttpError = function (result) {
        if (window.console)
            console.log(result);
        // check if the error was just because a language file couldn't be loaded - then don't show a message
        if (result.status === 404 &&
            result.config &&
            result.config.url &&
            result.config.url.indexOf('/dist/i18n/') > -1) {
            if (window.console)
                console.log('just fyi: failed to load language resource; will have to use default');
            return result;
        }
        // if it's an unspecified 0-error, it's probably not an error but a cancelled request,
        // (happens when closing popups containing angularJS)
        if (result.status === 0 || result.status === -1)
            return result;
        // let's try to show good messages in most cases
        var infoText = 'Had an error talking to the server (status ' + result.status + ').';
        var srvResp = result.responseText
            ? JSON.parse(result.responseText) // for jquery ajax errors
            : result.data; // for angular $http
        if (srvResp) {
            var msg = srvResp.Message;
            if (msg)
                infoText += '\nMessage: ' + msg;
            var msgDet = srvResp.MessageDetail || srvResp.ExceptionMessage;
            if (msgDet)
                infoText += '\nDetail: ' + msgDet;
            if (msgDet && msgDet.indexOf('No action was found') === 0)
                if (msgDet.indexOf('that matches the name') > 0)
                    infoText += '\n\nTip from 2sxc: you probably got the action-name wrong in your JS.';
                else if (msgDet.indexOf('that matches the request.') > 0)
                    infoText += '\n\nTip from 2sxc: Seems like the parameters are the wrong amount or type.';
            if (msg && msg.indexOf('Controller') === 0 && msg.indexOf('not found') > 0)
                infoText +=
                    // tslint:disable-next-line:max-line-length
                    "\n\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word 'controller' from the call in JS. To call a controller called 'DemoController' only use 'Demo'.";
        }
        // tslint:disable-next-line:max-line-length
        infoText += '\n\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug';
        alert(infoText);
        return result;
    };
    /**
    * checks if we're currently in edit mode
    * @returns {boolean}
    */
    SxcInstance.prototype.isEditMode = function () {
        return (this.manage && this.manage._isEditMode()) === true;
    };
    return SxcInstance;
}(___WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "../$2sxc/src/sxc-instance/web-api/ajax-promise.ts":
/*!*********************************************************!*\
  !*** ../$2sxc/src/sxc-instance/web-api/ajax-promise.ts ***!
  \*********************************************************/
/*! exports provided: AjaxPromise */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AjaxPromise", function() { return AjaxPromise; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../.. */ "../$2sxc/src/index.ts");

var AjaxPromise = /** @class */ (function () {
    function AjaxPromise(api, sxc) {
        this.api = api;
        this.sxc = sxc;
    }
    /**
     * Make a jQuery style promise request
     * @param {AjaxSettings} settings
     * @returns {JQueryPromise<any>}
     * @memberof AjaxPromise
     */
    AjaxPromise.prototype.makePromise = function (settings) {
        var headers = this.api.headers();
        // debugger;
        if (window.$ == null) {
            throw new Error('JQuery is now removed from 2sxc installation. Please use newer api like fetch or include JQuery in your project');
        }
        var promise = window.$.ajax({
            async: true,
            dataType: settings.dataType || 'json',
            data: JSON.stringify(settings.data),
            contentType: 'application/json',
            type: settings.method,
            url: this.getActionUrl(settings),
            beforeSend: function (xhr) {
                for (var key in headers)
                    if (headers.hasOwnProperty(key))
                        xhr.setRequestHeader(key, headers[key]);
            },
        });
        if (!settings.preventAutoFail)
            promise.fail(this.sxc.showDetailedHttpError);
        return promise;
    };
    /**
     * Generate the correct WebApi url
     * @param settings the settings as they would be in jQuery
     */
    AjaxPromise.prototype.getActionUrl = function (settings) {
        var url = settings.url || 'app/auto/api/' + settings.controller + '/' + settings.action;
        // 2020-03-13 stop adding 2sxc endpoint-name, it's already happening in apiUrl so with this it happens 2x
        // var endpoint = settings.endpoint || ToSxcName;
        var base = this.sxc.root.http.apiUrl(url, settings.endpoint);
        // let base = (settings.url)
        //   ? this.sxc.root.http.apiUrl(settings.url) // this.sxc.resolveServiceUrl(settings.url)  // use url -> TODO: change this to use the new root.http.apiUrl
        //   : env.apiRoot('2sxc')               // use controller/action
        //     + 'app/auto/api/' + settings.controller + '/' + settings.action;
        // if(settings.endpoint)
        //     base = base.replace(env.apiRoot('2sxc'), 
        //         env.apiRoot(settings.endpoint));
        return base + (!settings.params ? '' : ('?' + ___WEBPACK_IMPORTED_MODULE_0__["NoJQ"].param(settings.params)));
    };
    return AjaxPromise;
}());



/***/ }),

/***/ "../$2sxc/src/sxc-instance/web-api/sxc-web-api.ts":
/*!********************************************************!*\
  !*** ../$2sxc/src/sxc-instance/web-api/sxc-web-api.ts ***!
  \********************************************************/
/*! exports provided: SxcWebApi */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcWebApi", function() { return SxcWebApi; });
/* harmony import */ var _ajax_promise__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ajax-promise */ "../$2sxc/src/sxc-instance/web-api/ajax-promise.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../.. */ "../$2sxc/src/index.ts");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


/**
 * helper API to run ajax / REST calls to the server
 * it will ensure that the headers etc. are set correctly
 * and that urls are rewritten
 */
var SxcWebApi = /** @class */ (function () {
    function SxcWebApi(sxc) {
        this.sxc = sxc;
        this.env = sxc.root.env;
    }
    /**
     * returns an http-get promise
     * @param settingsOrUrl the url to get
     * @param params jQuery style ajax parameters
     * @param data jQuery style data for post/put requests
     * @param preventAutoFail
     * @returns {Promise} jQuery ajax promise object
     */
    SxcWebApi.prototype.get = function (settingsOrUrl, params, data, preventAutoFail) {
        return this.request(settingsOrUrl, params, data, preventAutoFail, 'GET');
    };
    /**
     * returns an http-get promise
     * @param settingsOrUrl the url to get
     * @param params jQuery style ajax parameters
     * @param data jQuery style data for post/put requests
     * @param preventAutoFail
     * @returns {Promise} jQuery ajax promise object
     */
    SxcWebApi.prototype.post = function (settingsOrUrl, params, data, preventAutoFail) {
        return this.request(settingsOrUrl, params, data, preventAutoFail, 'POST');
    };
    /**
     * returns an http-get promise
     * @param settingsOrUrl the url to get
     * @param params jQuery style ajax parameters
     * @param data jQuery style data for post/put requests
     * @param preventAutoFail
     * @returns {Promise} jQuery ajax promise object
     */
    SxcWebApi.prototype.delete = function (settingsOrUrl, params, data, preventAutoFail) {
        return this.request(settingsOrUrl, params, data, preventAutoFail, 'DELETE');
    };
    /**
     * returns an http-get promise
     * @param settingsOrUrl the url to get
     * @param params jQuery style ajax parameters
     * @param data jQuery style data for post/put requests
     * @param preventAutoFail
     * @returns {Promise} jQuery ajax promise object
     */
    SxcWebApi.prototype.put = function (settingsOrUrl, params, data, preventAutoFail) {
        return this.request(settingsOrUrl, params, data, preventAutoFail, 'PUT');
    };
    /**
     * Generic http request
     * @param settingsOrUrl the url to get
     * @param params jQuery style ajax parameters
     * @param data jQuery style data for post/put requests
     * @param preventAutoFail
     * @param method the http verb name
     * @returns {Promise} jQuery ajax promise object
     */
    SxcWebApi.prototype.request = function (settings, params, data, preventAutoFail, method) {
        // url parameter: auto convert a single value (instead of object of values) to an id=... parameter
        // tslint:disable-next-line:curly
        if (typeof params !== 'object' && typeof params !== 'undefined')
            params = { id: params };
        // if the first parameter is a string, resolve settings
        if (typeof settings === 'string') {
            var controllerAction = settings.split('/');
            var controllerName = controllerAction[0];
            var actionName = controllerAction[1];
            if (controllerName === '' || actionName === '')
                console.warn('Error: controller or action not defined. Will continue with likely errors.');
            settings = {
                controller: controllerName,
                action: actionName,
                params: params,
                data: data,
                url: controllerAction.length > 2 ? settings : null,
                preventAutoFail: preventAutoFail,
            };
        }
        var defaults = {
            method: method === null ? 'POST' : method,
            params: null,
            preventAutoFail: false,
        };
        // new 10.25
        var http = new _ajax_promise__WEBPACK_IMPORTED_MODULE_0__["AjaxPromise"](this, this.sxc);
        settings = Object.assign({}, defaults, settings);
        var promise = http.makePromise(settings);
        return promise;
    };
    /**
     * Will retrieve data from the backend using a standard fetch.
     * @param url a full url or short-hand like `controller/method?params` `app/auto/api/controller/method?params`. Note that params would also be specified on the url.
     * @param data optional POST data
     * @param method optional method, defaults to `GET` unless it has data, in which case it defaults to `POST`
     * @returns a Promise containing a Response object, just like a normal fetch would.
     * example: webApi.fetch('Rss/Feed');
     * example: webApi.fetch(webApi.url('Rss/Feed', { id: 47 })); // url params
     * example: webApi.fetch('Rss/Feed', { id: 47 }); // post params
     * example: webApi.fetch(webApi.url('Rss/Feed', { id: 47 }), { something: 'this is a test' }); // url & post params
     * maybe: webApi.fetch({url: 'Rss/Feed', params: { id: 47 }})
     * maybe: webApi.fetch({url: ..., params: { ...}, body: { ...}, method: 'GET' })
     */
    SxcWebApi.prototype.fetch = function (url, data, method) {
        url = this.url(url);
        method = method || (data ? 'POST' : 'GET');
        var headers = this.headers(method);
        if (data) {
            // test if data is a json. If it's not, convert it to json
            try {
                JSON.parse(data);
            }
            catch (_a) {
                data = JSON.stringify(data);
            }
        }
        return fetch(url, __assign({ headers: headers,
            method: method }, (data && { body: data })));
    };
    /**
     * Will retrieve data from the backend using a standard fetch and give you an object.
     * @param url a full url or short-hand like `controller/method?params` `app/auto/api/controller/method?params`. Note that params would also be specified on the url.
     * @param data optional POST data
     * @param method optional method, defaults to `GET` unless it has data, in which case it defaults to `POST`
     * @returns a Promise containing any object.
     */
    SxcWebApi.prototype.fetchJson = function (url, data, method) {
        return this.fetch(url, data, method).then(function (response) { return response.json(); });
    };
    /**
     * All the headers which are needed in an ajax call for this to work reliably.
     * Use this if you need to get a list of headers in another system
     * @param method Optional. If set, will add Accept or Content-Type headers
     * @returns a Record / Dictionary of headers
     */
    SxcWebApi.prototype.headers = function (method) {
        var headers = this.sxc.root.http.headers(this.sxc.id, this.sxc.cbid);
        if (!method) {
            return headers;
        }
        switch (method.toLocaleUpperCase()) {
            case 'GET':
                headers['Accept'] = 'application/json';
                break;
            default:
                headers['Accept'] = 'application/json';
                headers['Content-Type'] = 'application/json';
        }
        return headers;
    };
    /**
     *
     * @param url A short, medium or long url.
     * Short like `controller/method`,
     * medium like `app/auto/api/controller/method`
     * long like `https://xyz.
     * In all cases it can also have ?params etc.
     * @param params Optional parameters as string or object, will be added to url-params.
     * @returns In the cases of a short/medium url,
     * it will auto-expand to have the full url as needed for an API call.
     */
    SxcWebApi.prototype.url = function (url, params) {
        if (url == null)
            return url;
        var urlAndParams = url.split('#')[0].split('?');
        // url fixes
        url = urlAndParams[0];
        var urlParts = url.split('/');
        if (urlParts.length === 2 && urlParts[0] && urlParts[1]) {
            var controller = urlParts[0];
            var action = urlParts[1];
            url = "app/auto/api/" + controller + "/" + action;
        }
        url = this.sxc.root.http.apiUrl(url);
        // params fixes
        params = ((urlAndParams[1] || '') + "&" + (params ? typeof params === 'string' ? params : ___WEBPACK_IMPORTED_MODULE_1__["NoJQ"].param(params) : ''))
            .split('&')
            .filter(function (p) { return !!p; })
            .join('&');
        // result
        url = [url, params].filter(function (p) { return !!p; }).join('?');
        return url;
    };
    return SxcWebApi;
}());



/***/ }),

/***/ "../$2sxc/src/sxc-root/context-identifier.ts":
/*!***************************************************!*\
  !*** ../$2sxc/src/sxc-root/context-identifier.ts ***!
  \***************************************************/
/*! exports provided: ContextIdentifier, isContextIdentifier, ensureCompleteOrThrow */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextIdentifier", function() { return ContextIdentifier; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isContextIdentifier", function() { return isContextIdentifier; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ensureCompleteOrThrow", function() { return ensureCompleteOrThrow; });
/**
 * ContextIdentifier is used to initialize a Sxc object outside of the default context.
 */
var ContextIdentifier = /** @class */ (function () {
    function ContextIdentifier() {
    }
    return ContextIdentifier;
}());

function isContextIdentifier(original) {
    var origAsContextId = original;
    return origAsContextId.zoneId !== undefined && origAsContextId.appId !== undefined;
}
function ensureCompleteOrThrow(ctx) {
    // if it's fulfills the minimum requirements
    if (ctx.zoneId && ctx.appId)
        return ctx;
    var msg = "It looks like the id given is a ContextIdentifier, but it's missing either zoneId or appId.";
    console.error(msg, ctx);
    throw msg;
}


/***/ }),

/***/ "../$2sxc/src/sxc-root/debug.ts":
/*!**************************************!*\
  !*** ../$2sxc/src/sxc-root/debug.ts ***!
  \**************************************/
/*! exports provided: Debug */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Debug", function() { return Debug; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");

var urlManager = new ___WEBPACK_IMPORTED_MODULE_0__["UrlParamManager"]();
var urlDebugState = urlManager.get('debug') === 'true';
var Debug = /** @class */ (function () {
    function Debug() {
        this.load = urlDebugState;
        this.uncache = urlManager.get('sxcver');
    }
    Debug.urlState = urlDebugState;
    return Debug;
}());



/***/ }),

/***/ "../$2sxc/src/sxc-root/sxc-root-builder.ts":
/*!*************************************************!*\
  !*** ../$2sxc/src/sxc-root/sxc-root-builder.ts ***!
  \*************************************************/
/*! exports provided: buildSxcRoot */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "buildSxcRoot", function() { return buildSxcRoot; });
/* harmony import */ var _tools_total_popup__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../tools/total-popup */ "../$2sxc/src/tools/total-popup.ts");
/* harmony import */ var _tools_url_param_manager__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../tools/url-param-manager */ "../$2sxc/src/tools/url-param-manager.ts");
/* harmony import */ var _Stats__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Stats */ "../$2sxc/src/Stats.ts");
/* harmony import */ var _sxc_instance_sxc_instance_with_internals__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../sxc-instance/sxc-instance-with-internals */ "../$2sxc/src/sxc-instance/sxc-instance-with-internals.ts");
/* harmony import */ var _sxc_root__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./sxc-root */ "../$2sxc/src/sxc-root/sxc-root.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");
/* harmony import */ var _context_identifier__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./context-identifier */ "../$2sxc/src/sxc-root/context-identifier.ts");
/* harmony import */ var _sxc_instance_sxc_instance__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../sxc-instance/sxc-instance */ "../$2sxc/src/sxc-instance/sxc-instance.ts");








/**
 * returns a 2sxc-instance of the id or html-tag passed in
 * @param id
 * @param cbid
 * @returns {}
 */
function FindSxcInstance(id, cbid) {
    var $2sxc = window.$2sxc;
    $2sxc.log.add('FindSxcInstance(' + id + ',' + cbid);
    if (!$2sxc._controllers)
        throw new Error('$2sxc not initialized yet');
    // Test if it already is such an instance, in which case we just preserve it and return it
    // Used in cases where the $2sxc(something) is just used to ensure it really is this
    if (_sxc_instance_sxc_instance__WEBPACK_IMPORTED_MODULE_7__["SxcInstance"].is(id))
        return id;
    // check if it's a context identifier (new in 11.11)
    var ctxId = null;
    if (Object(_context_identifier__WEBPACK_IMPORTED_MODULE_6__["isContextIdentifier"])(id)) {
        id = Object(_context_identifier__WEBPACK_IMPORTED_MODULE_6__["ensureCompleteOrThrow"])(id);
        ctxId = id;
        // create a fake id, based on zone and app because this is used to identify the object in the cache
        id = id.zoneId * 100000 + id.appId;
    }
    else if (typeof id === 'object') {
        // if it's a dom-element, use auto-find
        var idTuple = autoFind(id);
        id = idTuple[0];
        cbid = idTuple[1];
    }
    // if content-block is unknown, use id of module, and create an ID in the cache
    if (!cbid)
        cbid = id;
    var cacheKey = id + ':' + cbid;
    // either get the cached controller from previous calls, or create a new one
    if ($2sxc._controllers[cacheKey]) {
        $2sxc.log.add('Cache found for: ' + cacheKey);
        return $2sxc._controllers[cacheKey];
    }
    // not found, so also init the data-cache in case it's ever needed
    if (!$2sxc._data[cacheKey])
        $2sxc._data[cacheKey] = {};
    return ($2sxc._controllers[cacheKey]
        = new _sxc_instance_sxc_instance_with_internals__WEBPACK_IMPORTED_MODULE_3__["SxcInstanceWithInternals"](id, cbid, cacheKey, $2sxc, ctxId));
}
/**
 * Build a SXC Controller for the page. Should only ever be executed once
 */
function buildSxcRoot() {
    var rootApiV2 = Object(_sxc_root__WEBPACK_IMPORTED_MODULE_4__["getRootPartsV2"])();
    var urlManager = new _tools_url_param_manager__WEBPACK_IMPORTED_MODULE_1__["UrlParamManager"]();
    var debug = new ___WEBPACK_IMPORTED_MODULE_5__["Debug"]();
    //  {
    //     load: (urlManager.get('debug') === 'true'),
    //     uncache: urlManager.get('sxcver'),
    // };
    var stats = new _Stats__WEBPACK_IMPORTED_MODULE_2__["Stats"]();
    var addOn = {
        _controllers: {},
        beta: {},
        _data: {},
        // this creates a full-screen iframe-popup and provides a close-command to finish the dialog as needed
        totalPopup: new _tools_total_popup__WEBPACK_IMPORTED_MODULE_0__["TotalPopup"](),
        urlParams: urlManager,
        // note: I would like to remove this from $2sxc, but it's currently
        // used both in the inpage-edit and in the dialogs
        // debug state which is needed in various places
        debug: debug,
        stats: stats,
        insights: function (partName, index, start, length) { return ___WEBPACK_IMPORTED_MODULE_5__["Insights"].show(partName, index, start, length); },
        _insights: ___WEBPACK_IMPORTED_MODULE_5__["Insights"],
        // mini-helpers to manage 2sxc parts, a bit like a dependency loader
        // which will optimize to load min/max depending on debug state
        parts: {
            getUrl: function (url, preventUnmin) {
                // let r = url;// (preventUnmin || !debug.load) ? url : url.replace('.min', ''); // use min or not
                if (debug.uncache && url.indexOf('sxcver') === -1)
                    return url + ((url.indexOf('?') === -1) ? '?' : '&') + 'sxcver=' + debug.uncache;
                return url;
            },
        },
        // debugger;
        jq: function () { return window.$; },
    };
    var merged = Object.assign(FindSxcInstance, addOn, rootApiV2);
    merged.log.add('sxc controller built');
    console.log("$2sxc " + ___WEBPACK_IMPORTED_MODULE_5__["SxcVersion"] + " with insights-logging - see https://r.2sxc.org/insights");
    return merged;
}
function autoFind(domElement) {
    var containerTag = domElement.closest('.sc-content-block');
    if (!containerTag)
        return null;
    var iid = containerTag.getAttribute('data-cb-instance');
    var cbid = containerTag.getAttribute('data-cb-id');
    if (!iid || !cbid)
        return null;
    return [parseInt(iid, 10), parseInt(cbid, 10)];
}


/***/ }),

/***/ "../$2sxc/src/sxc-root/sxc-root.ts":
/*!*****************************************!*\
  !*** ../$2sxc/src/sxc-root/sxc-root.ts ***!
  \*****************************************/
/*! exports provided: getRootPartsV2 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getRootPartsV2", function() { return getRootPartsV2; });
/* harmony import */ var _environment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../environment */ "../$2sxc/src/environment/index.ts");
/* harmony import */ var _http_sxc_http__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../http/sxc-http */ "../$2sxc/src/http/sxc-http.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! .. */ "../$2sxc/src/index.ts");



function getRootPartsV2() {
    var log = new ___WEBPACK_IMPORTED_MODULE_2__["Log"]('$2sxc', null, 'building');
    var env = new _environment__WEBPACK_IMPORTED_MODULE_0__["Environment"]();
    return {
        sysinfo: {
            version: ___WEBPACK_IMPORTED_MODULE_2__["SxcVersion"],
            description: 'The 2sxc Controller - read more about it on docs.2sxc.org',
        },
        env: env,
        http: new _http_sxc_http__WEBPACK_IMPORTED_MODULE_1__["SxcHttp"](env),
        log: log,
    };
}


/***/ }),

/***/ "../$2sxc/src/tools/total-popup.ts":
/*!*****************************************!*\
  !*** ../$2sxc/src/tools/total-popup.ts ***!
  \*****************************************/
/*! exports provided: TotalPopup */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TotalPopup", function() { return TotalPopup; });
var TotalPopup = /** @class */ (function () {
    function TotalPopup() {
        this.frame = undefined;
        this.callback = undefined;
    }
    TotalPopup.prototype.open = function (url, callback) {
        // count parents to see how high the z-index needs to be
        var z = 10000010; // Needs at least 10000000 to be on top of the DNN9 bar
        var p = window;
        while (p !== window.top && z < 10000100) {
            z++;
            p = p.parent;
        }
        var wrapper = document.createElement('div');
        wrapper.setAttribute('style', ' top: 0;left: 0;width: 100%;height: 100%; position:fixed; z-index:' + z);
        document.body.appendChild(wrapper);
        var ifrm = document.createElement('iframe');
        ifrm.setAttribute('allowtransparency', 'true');
        ifrm.setAttribute('style', 'top: 0;left: 0;width: 100%;height: 100%;');
        ifrm.setAttribute('src', url);
        wrapper.appendChild(ifrm);
        document.body.className += ' sxc-popup-open';
        this.frame = ifrm;
        this.callback = callback;
    };
    TotalPopup.prototype.close = function () {
        if (this.frame) {
            document.body.className = document.body.className.replace('sxc-popup-open', '');
            var frm = this.frame;
            frm.parentNode.parentNode.removeChild(frm.parentNode);
            this.callback();
        }
    };
    TotalPopup.prototype.closeThis = function () {
        window.parent.$2sxc.totalPopup.close();
    };
    return TotalPopup;
}());



/***/ }),

/***/ "../$2sxc/src/tools/url-param-manager.ts":
/*!***********************************************!*\
  !*** ../$2sxc/src/tools/url-param-manager.ts ***!
  \***********************************************/
/*! exports provided: UrlParamManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "UrlParamManager", function() { return UrlParamManager; });
var UrlParamManager = /** @class */ (function () {
    function UrlParamManager() {
    }
    UrlParamManager.prototype.get = function (name) {
        // warning: this method is duplicated in 2 places - keep them in sync.
        // locations are eav and 2sxc4ng
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var searchRx = new RegExp('[\\?&]' + name + '=([^&#]*)', 'i');
        var results = searchRx.exec(location.search);
        var strResult;
        if (results === null) {
            var hashRx = new RegExp('[#&]' + name + '=([^&#]*)', 'i');
            results = hashRx.exec(location.hash);
        }
        // if nothing found, try normal URL because DNN places parameters in /key/value notation
        if (results === null) {
            // Otherwise try parts of the URL
            var matches = window.location.pathname.match(new RegExp('/' + name + '/([^/]+)', 'i'));
            // Check if we found anything, if we do find it, we must reverse the
            // results so we get the "last" one in case there are multiple hits
            if (matches && matches.length > 1)
                strResult = matches.reverse()[0];
        }
        else
            strResult = results[1];
        return strResult === null || strResult === undefined
            ? ''
            : decodeURIComponent(strResult.replace(/\+/g, ' '));
    };
    UrlParamManager.prototype.require = function (name) {
        var found = this.get(name);
        if (found === '') {
            var message = "Required parameter (" + name + ") missing from url - cannot continue";
            alert(message);
            throw message;
        }
        return found;
    };
    UrlParamManager.prototype.debug = function () {
        return this.get('debug') === 'true';
    };
    return UrlParamManager;
}());



/***/ }),

/***/ "../connect-parts/inpage-quick-dialog/index.ts":
/*!*****************************************************!*\
  !*** ../connect-parts/inpage-quick-dialog/index.ts ***!
  \*****************************************************/
/*! exports provided: urlParams */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _quick_dialog_params__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./quick-dialog-params */ "../connect-parts/inpage-quick-dialog/quick-dialog-params.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "urlParams", function() { return _quick_dialog_params__WEBPACK_IMPORTED_MODULE_0__["urlParams"]; });

/* empty/unused harmony star reexport */



/***/ }),

/***/ "../connect-parts/inpage-quick-dialog/quick-dialog-params.ts":
/*!*******************************************************************!*\
  !*** ../connect-parts/inpage-quick-dialog/quick-dialog-params.ts ***!
  \*******************************************************************/
/*! exports provided: urlParams */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "urlParams", function() { return urlParams; });
/** These are all the url params the UI needs to function */
var urlParams = {
    // These are used in UI.html, but we keep them here so we have a full list documented
    pageId: 'tid',
    /**
     *  request verification token header name
     */
    requestVerificationTokenHeader: 'rvth',
    /**
     *  request verification token value
     */
    requestVerificationToken: 'rvt',
    api: 'api',
    /**
     * Context: App we're on.
     * This is often 0 (zero) as initially it's not known.
     */
    appId: 'appId',
    /**
     * Selection of what apps should be shown by the dialog
     * this is an optional parameter
     */
    apps: 'apps',
    /** Context: Module we're on */
    moduleId: 'mid',
    /** Context: ContentBlock we're on */
    contentBlockId: 'cbid',
};


/***/ }),

/***/ "../core/constants/index.ts":
/*!**********************************!*\
  !*** ../core/constants/index.ts ***!
  \**********************************/
/*! exports provided: ToSxcName, SxcVersion, SxcApiUrlRoot, HeaderNames, ApiUrlRoots, AppApiMarker, AppApiMap, NumberNotDefinedHuge */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToSxcName", function() { return ToSxcName; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcVersion", function() { return SxcVersion; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcApiUrlRoot", function() { return SxcApiUrlRoot; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HeaderNames", function() { return HeaderNames; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ApiUrlRoots", function() { return ApiUrlRoots; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AppApiMarker", function() { return AppApiMarker; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AppApiMap", function() { return AppApiMap; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NumberNotDefinedHuge", function() { return NumberNotDefinedHuge; });
var ToSxcName = "2sxc";
var SxcVersion = "13.03.00";
var SxcApiUrlRoot = 'desktopmodules/2sxc/api/';
var HeaderNames = {
    // 2sxc specific header
    ContentBlockId: "ContentBlockId",
    // headers as defined by DNN
    ModuleId: "ModuleId",
    TabId: "TabId",
    // Header which should replace "TabId" in the long run
    PageId: "PageId",
};
var ApiUrlRoots = ['app', 'app-sys', 'app-api', 'app-query', 'app-content', 'eav', 'view', 'dnn'];
var AppApiMarker = 'app';
// TODO: this should later lead to remapping of old url calls, but it's not in use yet
// note that these were always 'auto' so `app-content` would need to be come `app/auto/content`
var AppApiMap = {
    'app-api': 'app/[name]/api',
    'app-query': 'app/[name]/query',
    'app-content': 'app/[name]/content'
};
// These are Not-Defined-IDs.
// Because
/**
 * This is a marker for an ID which is not defined
 * This is for situations where a 0 or even a negative number
 * could be real numbers, so this number is so big, it should never be a real ID
 */
var NumberNotDefinedHuge = 274200000000;


/***/ }),

/***/ "../core/index.ts":
/*!************************!*\
  !*** ../core/index.ts ***!
  \************************/
/*! exports provided: ToSxcName, SxcVersion, SxcApiUrlRoot, HeaderNames, ApiUrlRoots, AppApiMarker, AppApiMap, NumberNotDefinedHuge, LogEntryOptions, HasLog, Log, LogCall, Entry, Insights, Obj, urlClean, NoJQ, AssetsLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ "../core/constants/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToSxcName", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["ToSxcName"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcVersion", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["SxcVersion"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcApiUrlRoot", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["SxcApiUrlRoot"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HeaderNames", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["HeaderNames"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ApiUrlRoots", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["ApiUrlRoots"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMarker", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["AppApiMarker"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMap", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["AppApiMap"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NumberNotDefinedHuge", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["NumberNotDefinedHuge"]; });

/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./logging */ "../core/logging/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogEntryOptions", function() { return _logging__WEBPACK_IMPORTED_MODULE_1__["LogEntryOptions"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HasLog", function() { return _logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Log", function() { return _logging__WEBPACK_IMPORTED_MODULE_1__["Log"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogCall", function() { return _logging__WEBPACK_IMPORTED_MODULE_1__["LogCall"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Entry", function() { return _logging__WEBPACK_IMPORTED_MODULE_1__["Entry"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Insights", function() { return _logging__WEBPACK_IMPORTED_MODULE_1__["Insights"]; });

/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./plumbing */ "../core/plumbing/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Obj", function() { return _plumbing__WEBPACK_IMPORTED_MODULE_2__["Obj"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "urlClean", function() { return _plumbing__WEBPACK_IMPORTED_MODULE_2__["urlClean"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NoJQ", function() { return _plumbing__WEBPACK_IMPORTED_MODULE_2__["NoJQ"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AssetsLoader", function() { return _plumbing__WEBPACK_IMPORTED_MODULE_2__["AssetsLoader"]; });






/***/ }),

/***/ "../core/logging/Log.ts":
/*!******************************!*\
  !*** ../core/logging/Log.ts ***!
  \******************************/
/*! exports provided: Log */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Log", function() { return Log; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "../core/logging/index.ts");

var keepData = location.search.indexOf("debug=true") !== -1;
var maxScopeLen = 3;
var maxNameLen = 6;
var liveDump = false;
var maxEntriesReached = 'Maximum amount of entries added to log, will stop adding more';
var Log = /** @class */ (function () {
    /**
     * Create a logger and optionally attach it to a parent logger
     * @param string name this logger should use
     * @param Log optional parrent logger to attach to
     * @param string optional initial message to log
     */
    function Log(name, parent, initialMessage) {
        var _this = this;
        /**
         * all log-entries on this logger
         */
        this.entries = new Array();
        this.depth = 0;
        this.callDepths = [];
        /**
         * Maximum amount of entries to add - to prevent memory hoging
         */
        this.maxEntries = 1000;
        /* if we should live-dump, can be selectively activated */
        this.liveDump = liveDump;
        this._parentHasLiveDump = false;
        this.keepData = keepData; //Debug.urlState; // C.Debug.urlState;
        this._parentHasKeepData = false;
        /**
         * Full identifier of this log-object, with full hierarchy
         */
        this.fullIdentifier = function () {
            return "" + (_this.parent ? _this.parent.fullIdentifier() : '') + _this.identifier();
        };
        /**
         * link this log to a parent
         * usually happens in constructor, but in rare cases
         * this must be called manually
         */
        this.linkLog = function (parent) {
            _this.parent = parent || _this.parent; // if new parent isn't defined, don't replace
            if (_this.parent) {
                _this._parentHasLiveDump = _this.parent.liveDump || _this.parent._parentHasLiveDump;
                _this._parentHasKeepData = _this.parent.keepData || _this.parent._parentHasKeepData;
            }
        };
        /**
         * scope of this logger - to easily see which ones
         * are about the same topic
         */
        this.scope = 'tdo';
        /**
         * name of this logger
         */
        this.name = 'unknwn';
        /**
         * Unique 2-character ID of this specific log object
         */
        this.id = function () { return _this.idCache || (_this.idCache = _this.randomString(2)); };
        /**
         * Unique identifier of this log object, with name and ID
         */
        this.identifier = function () { return "" + _this.scope + _this.name + "(" + _this.id() + ")"; };
        this.rename(name);
        this.linkLog(parent);
        this.startTime = new Date().getTime();
        if (initialMessage != null)
            this.add(initialMessage);
    }
    /**
     * give this logger a new name
     * usually happens in constructor, but in rare cases
     * it's called manually
     * @param name
     */
    Log.prototype.rename = function (name) {
        try {
            var dot = name.indexOf('.');
            this.scope = dot > 0 ? name.substr(0, Math.min(dot, maxScopeLen)) + '.' : '';
            var rest = dot > 0 ? name.substr(dot + 1) : name;
            this.name = rest.substr(0, Math.min(rest.length, maxNameLen));
            this.name = this.name.substr(0, Math.min(this.name.length, maxNameLen));
        }
        catch (e) {
            /* ignore */
        }
    };
    /**
     * add a message to the log-list
     * @param message
     *
     * preferred usage is with string parameter:
     * log.add(`description ${ parameter }`);
     *
     * in case that we experience error with normal string parameter, we can use arrow function to enclose parameter like this () => parameter
     * but use it very rarely, because there is certainly a performance implication!
     * log.add(`description ${() => parameter}`);
     */
    Log.prototype.add = function (message, data) {
        // check if the log is already too big
        if (this.entries.length > this.maxEntries)
            return this._prepareMessage(message);
        // if we just reached the max, add special message
        if (this.entries.length === this.maxEntries)
            this._addEntry(this._prepareEntry(maxEntriesReached));
        var entry = this._prepareEntry(message, data);
        this._addEntry(entry);
        return entry.message;
    };
    Log.prototype.addData = function (message, data) {
        if (this.logData())
            this.add(message, data);
    };
    Log.prototype.logData = function () {
        return this.keepData || this._parentHasKeepData;
    };
    Log.prototype._prepareEntry = function (message, data) {
        var msg = this._prepareMessage(message);
        var time = new Date().getTime() - this.startTime;
        var entry = new ___WEBPACK_IMPORTED_MODULE_0__["Entry"](this, msg, this.depth, time, data);
        return entry;
    };
    Log.prototype._prepareMessage = function (message) {
        if (message instanceof Function) {
            try {
                return (message());
            }
            catch (e) {
                return 'err: message undefined';
            }
        }
        return message.toString();
    };
    Log.prototype.call = function (name, callParams, message, data) {
        return new ___WEBPACK_IMPORTED_MODULE_0__["LogCall"](this, name, callParams, message, data);
    };
    Log.prototype._callDepthAdd = function (name) {
        this.depth++;
        this.callDepths.push(name);
    };
    Log.prototype._callDepthRemove = function (name) {
        this.depth--;
        var last = this.callDepths.pop();
        if (last !== name) {
            console.warn("log: call depth reduced by '" + name + "' but last was '" + last + "'");
        }
    };
    /**
     * helper to create a text-output of the log info
     * @param separator
     * @param start
     * @param end
     */
    Log.prototype.dump = function (one, separator) {
        if (one === void 0) { one = null; }
        if (separator === void 0) { separator = ' - '; }
        if (one)
            this.dumpOne(0, one, separator);
        else
            this.dumpList();
    };
    Log.prototype.dumpList = function (start, length) {
        var _this = this;
        if (start === void 0) { start = 0; }
        var index = start;
        this.entries
            .slice(start, length ? start + length : undefined)
            .forEach(function (e) { return _this.dumpOne(index++, e); });
    };
    Log.prototype.dumpOne = function (index, e, separator) {
        if (separator === void 0) { separator = ' - '; }
        var result = (e.result) ? ' =' + e.result : '';
        var line = ('0000' + index).slice(-4) + ' ' + e.source() + separator + '..'.repeat(e.depth) + e.message + result;
        if (e.data)
            console.log(line, e.data);
        else
            console.log(line);
    };
    /**
     * add an entry-object to this logger
     * this is often called by sub-loggers to add to parent
     * @param entry
     */
    Log.prototype._addEntry = function (entry) {
        if (this.liveDump)
            this.dump(entry);
        this.entries.push(entry);
        if (this.parent)
            this.parent._addEntry(entry);
    };
    /**
     * helper to generate a random 2-char ID
     * @param stringLength
     */
    Log.prototype.randomString = function (stringLength) {
        var chars = '0123456789abcdefghiklmnopqrstuvwxyz';
        var randomstring = '';
        for (var i = 0; i < stringLength; i++) {
            var rnum = Math.floor(Math.random() * chars.length);
            randomstring += chars.substring(rnum, rnum + 1);
        }
        return randomstring;
    };
    return Log;
}());



/***/ }),

/***/ "../core/logging/entry.ts":
/*!********************************!*\
  !*** ../core/logging/entry.ts ***!
  \********************************/
/*! exports provided: Entry */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Entry", function() { return Entry; });
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../plumbing */ "../core/plumbing/index.ts");

var Entry = /** @class */ (function () {
    function Entry(log, message, depth, 
    /** A timestamp for this entry to better see sequences of things happening */
    time, data) {
        var _this = this;
        this.log = log;
        this.message = message;
        this.depth = depth;
        this.time = time;
        this.source = function () { return _this.log.fullIdentifier(); };
        if (data) {
            // #2492 - jQuery isn't used any more in 2sxc
            // if (data instanceof jQuery) {
            //     const jq = data as JQuery;
            //     this.data = {
            //         isJQuery: true,
            //         original: jq,
            //         html: jq.length && jq[0].outerHTML,
            //     };
            // } 
            // else
            this.data = data;
        }
    }
    Object.defineProperty(Entry.prototype, "data", {
        /** Data which is logged - if data-logging is enabled */
        get: function () {
            return this._data;
        },
        set: function (data) {
            if (data === undefined)
                return;
            if (this.log.logData())
                this._data = _plumbing__WEBPACK_IMPORTED_MODULE_0__["Obj"].DeepClone(data, true);
        },
        enumerable: true,
        configurable: true
    });
    return Entry;
}());



/***/ }),

/***/ "../core/logging/has-log.ts":
/*!**********************************!*\
  !*** ../core/logging/has-log.ts ***!
  \**********************************/
/*! exports provided: HasLog */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HasLog", function() { return HasLog; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "../core/logging/index.ts");

var HasLog = /** @class */ (function () {
    /**
     * initialize the logger
     * ideally it has a parent-logger to attach to
     * @param logName name to show in the logger
     * @param parentLog parent-logger to attach to
     * @param initialMessage optional start-message to log
     */
    function HasLog(logName, parentLog, initialMessage) {
        var _this = this;
        this.parentLog = parentLog;
        this.initLog = function (name, parentLog, initialMessage) { return _this.initLogInternal(name, parentLog, initialMessage); };
        this.initLogInternal(logName, parentLog, initialMessage);
    }
    HasLog.prototype.initLogInternal = function (name, parentLog, initialMessage) {
        if (this.log == null)
            // standard & most common case: just create log
            this.log = new ___WEBPACK_IMPORTED_MODULE_0__["Log"](name, parentLog, initialMessage);
        else {
            // late-init case, where the log was already created - just reconfig keeping what was in it
            this.log.rename(name);
            this.log.linkLog(parentLog);
            if (initialMessage != null)
                this.log.add(initialMessage);
        }
    };
    return HasLog;
}());



/***/ }),

/***/ "../core/logging/index.ts":
/*!********************************!*\
  !*** ../core/logging/index.ts ***!
  \********************************/
/*! exports provided: LogEntryOptions, HasLog, Log, LogCall, Entry, Insights */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _log_entry_options__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./log-entry-options */ "../core/logging/log-entry-options.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogEntryOptions", function() { return _log_entry_options__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"]; });

/* harmony import */ var _has_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./has-log */ "../core/logging/has-log.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HasLog", function() { return _has_log__WEBPACK_IMPORTED_MODULE_1__["HasLog"]; });

/* harmony import */ var _Log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Log */ "../core/logging/Log.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Log", function() { return _Log__WEBPACK_IMPORTED_MODULE_2__["Log"]; });

/* harmony import */ var _log_call__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./log-call */ "../core/logging/log-call.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogCall", function() { return _log_call__WEBPACK_IMPORTED_MODULE_3__["LogCall"]; });

/* harmony import */ var _entry__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./entry */ "../core/logging/entry.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Entry", function() { return _entry__WEBPACK_IMPORTED_MODULE_4__["Entry"]; });

/* harmony import */ var _insights__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./insights */ "../core/logging/insights.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Insights", function() { return _insights__WEBPACK_IMPORTED_MODULE_5__["Insights"]; });









/***/ }),

/***/ "../core/logging/insights.ts":
/*!***********************************!*\
  !*** ../core/logging/insights.ts ***!
  \***********************************/
/*! exports provided: Insights */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Insights", function() { return Insights; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "../core/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var msgIntro = 'This is the $2sxc JS Insights - see https://r.2sxc.org/insights \n'
    + 'Add ?debug=true to the url to log more data. \n'
    + 'Copy/paste code lines below to see details. \n'
    + '----------------------------------------------------------------------\n';
var InsightsSingleton = /** @class */ (function (_super) {
    __extends(InsightsSingleton, _super);
    function InsightsSingleton() {
        var _this = _super.call(this, 'Sys.Insght') || this;
        _this.history = {};
        _this.add('system', 'insights', _this.log);
        _this.log.add("this log is usually empty, as it's just a helper tool");
        return _this;
    }
    InsightsSingleton.prototype.add = function (setName, logName, log) {
        if (!(setName in this.history))
            this.history[setName] = new InsightsLogSet(setName);
        this.history[setName].logs.push({ key: logName, log: log });
    };
    InsightsSingleton.prototype.show = function (partName, index, start, length) {
        // if nothing specified, list what to do to see inner parts
        if (!partName) {
            var keys = Object.keys(this.history);
            console.log("" + msgIntro + keys.length + " insights-sections found: \n" + keys.map(function (p) { return "$2sxc.insights('" + p + "');"; }).join('\n'));
            return;
        }
        // partName found, check if it exists
        var part = this.history[partName];
        if (!part) {
            console.error("part '" + partName + "' not found");
            return;
        }
        // We have a partName, but no index - show list and how to get details
        if (index === undefined) {
            var count_1 = 0;
            var logNames = part.logs
                .map(function (s) { return "$2sxc.insights('" + partName + "', " + count_1++ + "); - will show for '" + s.key + "'"; })
                .join('\n');
            console.log("'" + partName + "' contains " + part.logs.length + " entries. Copy/paste the code to to see the logs: \n" + logNames);
            return;
        }
        // verify the entry exists
        var logSet = part.logs.length >= index && part.logs[index];
        if (!logSet) {
            console.error("index " + index + " not found in part '" + partName + "'");
            return;
        }
        if (!logSet.log) {
            console.error("found index " + index + " on part '" + partName + "' but it has no logs");
            return;
        }
        console.log("Will dump the log for " + partName + "[" + index + "] '" + logSet.key + "'");
        var autoLimit = false;
        if (start === undefined) {
            autoLimit = true;
            start = 0;
            length = 25;
        }
        logSet.log.dumpList(start || 0, length);
        if (autoLimit && logSet.log.entries.length > length)
            console.warn("Only showing " + length + " of " + logSet.log.entries.length + " logs. To show all, add start param '..., 0)' or start/length '..., 0, 100)'");
    };
    return InsightsSingleton;
}(___WEBPACK_IMPORTED_MODULE_0__["HasLog"]));
// tslint:disable-next-line: max-classes-per-file
var InsightsLogSet = /** @class */ (function () {
    function InsightsLogSet(name) {
        this.name = name;
        this.logs = [];
    }
    return InsightsLogSet;
}());
// ensure it's only created once
// this is important, because the inpage code also uses this class
// and would otherwise create the object separately
var singleton = window.$2sxc && window.$2sxc._insights // try to load existing
    || new InsightsSingleton(); // otherwise create new
var Insights = singleton;


/***/ }),

/***/ "../core/logging/log-call.ts":
/*!***********************************!*\
  !*** ../core/logging/log-call.ts ***!
  \***********************************/
/*! exports provided: LogCall */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "LogCall", function() { return LogCall; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "../core/logging/index.ts");

var LogCall = /** @class */ (function () {
    function LogCall(log, name, callParams, message, data) {
        this.log = log;
        this.name = name;
        this.initialEntry = this.log._prepareEntry(name + '(' + (callParams || '') + ')');
        this.log._callDepthAdd(name);
        this.log._addEntry(this.initialEntry);
        if (typeof message === 'string')
            this.add(message);
        if (data)
            for (var key in data)
                this.data('initial:' + key, data[key]);
    }
    LogCall.prototype.add = function (message, data, behavior) {
        this.lastMessage = message;
        this.log.add(message, data);
        if (behavior)
            this.processExtraBehavior(behavior, message, data);
    };
    LogCall.prototype.onlyAddIfNew = function (message, behavior) {
        if (this.lastMessage !== message)
            this.add(message);
        if (behavior)
            this.processExtraBehavior(behavior, message, undefined);
    };
    /** Add data - but only if data logging is enabled */
    LogCall.prototype.data = function (message, data) {
        this.log.addData(message, data);
    };
    LogCall.prototype.done = function (message, behavior) {
        this.return(null, message || '', behavior);
    };
    LogCall.prototype.return = function (result, message, behavior) {
        message = message || '';
        this.initialEntry.result = message;
        this.log._callDepthRemove(this.name);
        // if we're in keep-data / debug mode, keep that
        this.initialEntry.data = result;
        // if we're in live-dump mode, then the entry was already dumped, show again
        if (this.log.liveDump || this.log._parentHasLiveDump)
            this.add(this.name + ' = ' + message, result);
        if (behavior)
            this.processExtraBehavior(behavior, message, result);
        return result;
    };
    /*
     * treat all extra output or errors
     * to allow setting a debug stop point when needed
     * then you can trace the stack-call to see where the error originated
     */
    LogCall.prototype.processExtraBehavior = function (behavior, message, data) {
        if (behavior === ___WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].log)
            console.log(message, data);
        if (behavior === ___WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].warn)
            console.warn(message, data);
        if (behavior === ___WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].error || behavior === ___WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].throw)
            console.error(message, data);
        if (behavior === ___WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].throw)
            throw message;
    };
    return LogCall;
}());



/***/ }),

/***/ "../core/logging/log-entry-options.ts":
/*!********************************************!*\
  !*** ../core/logging/log-entry-options.ts ***!
  \********************************************/
/*! exports provided: LogEntryOptions */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "LogEntryOptions", function() { return LogEntryOptions; });
var LogEntryOptions;
(function (LogEntryOptions) {
    LogEntryOptions["log"] = "log";
    LogEntryOptions["warn"] = "warn";
    LogEntryOptions["error"] = "error";
    LogEntryOptions["throw"] = "throw";
})(LogEntryOptions || (LogEntryOptions = {}));


/***/ }),

/***/ "../core/plumbing/index.ts":
/*!*********************************!*\
  !*** ../core/plumbing/index.ts ***!
  \*********************************/
/*! exports provided: Obj, urlClean, NoJQ, AssetsLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _obj__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./obj */ "../core/plumbing/obj.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Obj", function() { return _obj__WEBPACK_IMPORTED_MODULE_0__["Obj"]; });

/* harmony import */ var _url__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./url */ "../core/plumbing/url.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "urlClean", function() { return _url__WEBPACK_IMPORTED_MODULE_1__["urlClean"]; });

/* harmony import */ var _no_jquery__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./no-jquery */ "../core/plumbing/no-jquery.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NoJQ", function() { return _no_jquery__WEBPACK_IMPORTED_MODULE_2__["NoJQ"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AssetsLoader", function() { return _no_jquery__WEBPACK_IMPORTED_MODULE_2__["AssetsLoader"]; });

//
// Plumbing contains some object manipulation helpers and similarly
// re-used bits of code
//





/***/ }),

/***/ "../core/plumbing/no-jquery.ts":
/*!*************************************!*\
  !*** ../core/plumbing/no-jquery.ts ***!
  \*************************************/
/*! exports provided: NoJQ, AssetsLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NoJQ", function() { return NoJQ; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AssetsLoader", function() { return AssetsLoader; });
var NoJQ = /** @class */ (function () {
    function NoJQ() {
    }
    /** https://api.jquery.com/ready/ */
    NoJQ.ready = function (callback) {
        if (document.readyState === 'complete') {
            callback();
        }
        else {
            document.addEventListener('DOMContentLoaded', function () { return callback(); }, { once: true });
        }
    };
    /** https://api.jquery.com/jquery.param/ */
    NoJQ.param = function (obj) {
        var param = Object.entries(obj)
            .map(function (_a) {
            var k = _a[0], v = _a[1];
            return encodeURIComponent(k) + "=" + (v == null ? '' : typeof v === 'string' ? encodeURIComponent(v) : encodeURIComponent(JSON.stringify(v)));
        })
            .join('&');
        return param;
    };
    /** Build DOM elements from string */
    NoJQ.domFromString = function (string) {
        // build elements from string into dummy parent
        var dummyParent = document.createElement('div');
        dummyParent.insertAdjacentHTML('afterbegin', string);
        // scripts created from string are not executable and have to recreated manually to be executable
        Array.from(dummyParent.querySelectorAll('script')).forEach(function (brokenScript) {
            var workingScript = document.createElement('script');
            // copy attributes
            Array.from(brokenScript.attributes).forEach(function (attribute) {
                workingScript.setAttribute(attribute.nodeName, attribute.nodeValue);
            });
            // copy inline part
            workingScript.textContent = brokenScript.textContent;
            // replace a non executable script with executable one
            NoJQ.replaceWith(brokenScript, workingScript, false);
        });
        // remove created elements from dummy parent so it can be garbage collected
        var elements = Array.from(dummyParent.children);
        elements.forEach(function (element) {
            dummyParent.removeChild(element);
        });
        return elements;
    };
    /** https://api.jquery.com/offset/ */
    NoJQ.offset = function (element) {
        var clientRect = element.getBoundingClientRect();
        var offset = {
            top: clientRect.top + window.scrollY,
            left: clientRect.left + window.scrollX,
        };
        return offset;
    };
    /** https://api.jquery.com/width/ */
    NoJQ.width = function (element) {
        // jquery width === offsetWidth - borders - padding
        var computedStyle = getComputedStyle(element);
        var width = element.offsetWidth === 0
            ? 0
            : element.offsetWidth
                - (parseInt(computedStyle.getPropertyValue('border-left-width'), 10) + parseInt(computedStyle.getPropertyValue('border-right-width'), 10))
                - (parseInt(computedStyle.getPropertyValue('padding-left'), 10) + parseInt(computedStyle.getPropertyValue('padding-right'), 10));
        return width;
    };
    /** https://api.jquery.com/height/ */
    NoJQ.height = function (element) {
        // jquery height === offsetHeight - borders - padding
        var computedStyle = getComputedStyle(element);
        var height = element.offsetHeight === 0
            ? 0
            : element.offsetHeight
                - (parseInt(computedStyle.getPropertyValue('border-top-width'), 10) + parseInt(computedStyle.getPropertyValue('border-bottom-width'), 10))
                - (parseInt(computedStyle.getPropertyValue('padding-top'), 10) + parseInt(computedStyle.getPropertyValue('padding-bottom'), 10));
        return height;
    };
    /** https://api.jquery.com/outerWidth/ */
    NoJQ.outerWidth = function (element) {
        var outerWidth = element.offsetWidth;
        return outerWidth;
    };
    /** https://api.jquery.com/empty/ */
    NoJQ.empty = function (element) {
        Array.from(element.childNodes).forEach(function (n) {
            element.removeChild(n);
        });
    };
    /** https://api.jquery.com/replacewith/ */
    NoJQ.replaceWith = function (toBeReplaced, newElement, runScripts) {
        var parent = toBeReplaced.parentElement;
        // disable scripts before replacing dom
        var scripts = Array.from(newElement.querySelectorAll('script'));
        var restores = [];
        scripts.forEach(function (script) {
            restores.push({ script: script, type: script.type });
            script.type = null;
        });
        // replace dom
        parent.replaceChild(newElement, toBeReplaced);
        // enable scripts
        restores.forEach(function (restore) {
            restore.script.type = restore.type;
        });
        if (runScripts) {
            // run scripts manually to ensure proper timing
            AssetsLoader.runScripts(scripts, undefined);
        }
    };
    /** https://api.jquery.com/append/ */
    NoJQ.append = function (parent, newElements, runScripts) {
        var scripts = [];
        newElements.forEach(function (element) {
            if (element.tagName.toLocaleLowerCase() === 'script') {
                var script = element;
                // disable script before inserting to the dom
                var restoreType = script.type;
                script.type = null;
                // insert to dom
                parent.appendChild(script);
                // enable script
                script.type = restoreType;
                scripts.push(script);
            }
            else {
                parent.appendChild(element);
            }
        });
        if (runScripts && scripts.length > 0) {
            // run scripts manually to ensure proper timing
            AssetsLoader.runScripts(scripts, undefined);
        }
    };
    return NoJQ;
}());

var AssetsLoader = /** @class */ (function () {
    function AssetsLoader() {
    }
    /** Asynchronously runs external and inline scripts in series */
    AssetsLoader.runScripts = function (scripts, callback) {
        var _this = this;
        var script = scripts[0];
        var others = scripts.slice(1);
        if (script == null) {
            callback === null || callback === void 0 ? void 0 : callback();
            return;
        }
        // create copy
        var copy = document.createElement('script');
        // attributes
        Array.from(script.attributes).forEach(function (attribute) {
            copy.setAttribute(attribute.nodeName, attribute.nodeValue);
        });
        // inline part
        copy.textContent = script.textContent;
        // if src then insert in head, wait for onload or onerror, remove from head and move to next one
        if (copy.type && copy.src) {
            var listener = function () {
                copy.onload = null;
                copy.onerror = null;
                document.head.removeChild(copy);
                _this.runScripts(others, callback);
            };
            copy.onload = listener;
            copy.onerror = listener;
            document.head.appendChild(copy);
            return;
        }
        // if no src then inline, insert to head and remove instantly and move to next one
        setTimeout(function () {
            document.head.appendChild(copy);
            document.head.removeChild(copy);
            _this.runScripts(others, callback);
        });
    };
    return AssetsLoader;
}());



/***/ }),

/***/ "../core/plumbing/obj.ts":
/*!*******************************!*\
  !*** ../core/plumbing/obj.ts ***!
  \*******************************/
/*! exports provided: Obj */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Obj", function() { return Obj; });
/**
 * Object manipulator helpers
 */
var Obj = /** @class */ (function () {
    function Obj() {
    }
    /**
     * This is the same as Object.assign, but type-safe.
     * Use it as a replacetment for Object.Assign(this, ... ) in constructors
     */
    Obj.TypeSafeAssign = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        args.reduce(function (result, current) {
            return Object.keys(current).reduce(function (target, key) {
                target[key] = current[key];
                return target;
            }, result);
        }, args[0]);
    };
    Obj.DeepClone = function (original, ignoreCircular) {
        if (ignoreCircular === void 0) { ignoreCircular = false; }
        if (original === undefined || original === null)
            return original;
        var str = ignoreCircular ? JSON.stringify(original, getCircularReplacer) : JSON.stringify(original);
        if (str === undefined || str === null)
            return original;
        return JSON.parse(str);
    };
    return Obj;
}());

var getCircularReplacer = function () {
    var seen = new WeakSet();
    return function (_, value) {
        if (typeof value === "object" && value !== null) {
            if (seen.has(value)) {
                return;
            }
            seen.add(value);
        }
        return value;
    };
};


/***/ }),

/***/ "../core/plumbing/url.ts":
/*!*******************************!*\
  !*** ../core/plumbing/url.ts ***!
  \*******************************/
/*! exports provided: urlClean */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "urlClean", function() { return urlClean; });
function urlClean(original) {
    return original.replace(/(\/+)/g, '/');
}


/***/ }),

/***/ "./icons/inpage-icons-codes.css":
/*!**************************************!*\
  !*** ./icons/inpage-icons-codes.css ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js":
/*!*********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js ***!
  \*********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _arrayLikeToArray; });
function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) {
    arr2[i] = arr[i];
  }

  return arr2;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js":
/*!*******************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js ***!
  \*******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _arrayWithHoles; });
function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js ***!
  \**********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _arrayWithoutHoles; });
/* harmony import */ var _arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arrayLikeToArray */ "./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js");

function _arrayWithoutHoles(arr) {
  if (Array.isArray(arr)) return Object(_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__["default"])(arr);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js ***!
  \**************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _assertThisInitialized; });
function _assertThisInitialized(self) {
  if (self === void 0) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return self;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/classCallCheck.js":
/*!*******************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/classCallCheck.js ***!
  \*******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _classCallCheck; });
function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/createClass.js":
/*!****************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/createClass.js ***!
  \****************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _createClass; });
function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  return Constructor;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/defineProperty.js":
/*!*******************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/defineProperty.js ***!
  \*******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _defineProperty; });
function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js":
/*!*******************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js ***!
  \*******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _getPrototypeOf; });
function _getPrototypeOf(o) {
  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {
    return o.__proto__ || Object.getPrototypeOf(o);
  };
  return _getPrototypeOf(o);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/inherits.js":
/*!*************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/inherits.js ***!
  \*************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _inherits; });
/* harmony import */ var _setPrototypeOf__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./setPrototypeOf */ "./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js");

function _inherits(subClass, superClass) {
  if (typeof superClass !== "function" && superClass !== null) {
    throw new TypeError("Super expression must either be null or a function");
  }

  subClass.prototype = Object.create(superClass && superClass.prototype, {
    constructor: {
      value: subClass,
      writable: true,
      configurable: true
    }
  });
  if (superClass) Object(_setPrototypeOf__WEBPACK_IMPORTED_MODULE_0__["default"])(subClass, superClass);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/iterableToArray.js":
/*!********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/iterableToArray.js ***!
  \********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _iterableToArray; });
function _iterableToArray(iter) {
  if (typeof Symbol !== "undefined" && Symbol.iterator in Object(iter)) return Array.from(iter);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js":
/*!*************************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js ***!
  \*************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _iterableToArrayLimit; });
function _iterableToArrayLimit(arr, i) {
  if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return;
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;

  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js":
/*!********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js ***!
  \********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _nonIterableRest; });
function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js ***!
  \**********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _nonIterableSpread; });
function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/objectSpread.js":
/*!*****************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/objectSpread.js ***!
  \*****************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _objectSpread; });
/* harmony import */ var _defineProperty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./defineProperty */ "./node_modules/@babel/runtime/helpers/esm/defineProperty.js");

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? Object(arguments[i]) : {};
    var ownKeys = Object.keys(source);

    if (typeof Object.getOwnPropertySymbols === 'function') {
      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {
        return Object.getOwnPropertyDescriptor(source, sym).enumerable;
      }));
    }

    ownKeys.forEach(function (key) {
      Object(_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(target, key, source[key]);
    });
  }

  return target;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js":
/*!******************************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js ***!
  \******************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _possibleConstructorReturn; });
/* harmony import */ var _helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../helpers/esm/typeof */ "./node_modules/@babel/runtime/helpers/esm/typeof.js");
/* harmony import */ var _assertThisInitialized__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./assertThisInitialized */ "./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js");


function _possibleConstructorReturn(self, call) {
  if (call && (Object(_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["default"])(call) === "object" || typeof call === "function")) {
    return call;
  }

  return Object(_assertThisInitialized__WEBPACK_IMPORTED_MODULE_1__["default"])(self);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js":
/*!*******************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js ***!
  \*******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _setPrototypeOf; });
function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  return _setPrototypeOf(o, p);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/slicedToArray.js":
/*!******************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/slicedToArray.js ***!
  \******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _slicedToArray; });
/* harmony import */ var _arrayWithHoles__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arrayWithHoles */ "./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js");
/* harmony import */ var _iterableToArrayLimit__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./iterableToArrayLimit */ "./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js");
/* harmony import */ var _unsupportedIterableToArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./unsupportedIterableToArray */ "./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js");
/* harmony import */ var _nonIterableRest__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./nonIterableRest */ "./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js");




function _slicedToArray(arr, i) {
  return Object(_arrayWithHoles__WEBPACK_IMPORTED_MODULE_0__["default"])(arr) || Object(_iterableToArrayLimit__WEBPACK_IMPORTED_MODULE_1__["default"])(arr, i) || Object(_unsupportedIterableToArray__WEBPACK_IMPORTED_MODULE_2__["default"])(arr, i) || Object(_nonIterableRest__WEBPACK_IMPORTED_MODULE_3__["default"])();
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js ***!
  \**********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _toConsumableArray; });
/* harmony import */ var _arrayWithoutHoles__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arrayWithoutHoles */ "./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js");
/* harmony import */ var _iterableToArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./iterableToArray */ "./node_modules/@babel/runtime/helpers/esm/iterableToArray.js");
/* harmony import */ var _unsupportedIterableToArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./unsupportedIterableToArray */ "./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js");
/* harmony import */ var _nonIterableSpread__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./nonIterableSpread */ "./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js");




function _toConsumableArray(arr) {
  return Object(_arrayWithoutHoles__WEBPACK_IMPORTED_MODULE_0__["default"])(arr) || Object(_iterableToArray__WEBPACK_IMPORTED_MODULE_1__["default"])(arr) || Object(_unsupportedIterableToArray__WEBPACK_IMPORTED_MODULE_2__["default"])(arr) || Object(_nonIterableSpread__WEBPACK_IMPORTED_MODULE_3__["default"])();
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/typeof.js":
/*!***********************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/typeof.js ***!
  \***********************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _typeof; });
function _typeof(obj) {
  "@babel/helpers - typeof";

  if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
    _typeof = function _typeof(obj) {
      return typeof obj;
    };
  } else {
    _typeof = function _typeof(obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
    };
  }

  return _typeof(obj);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js ***!
  \*******************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return _unsupportedIterableToArray; });
/* harmony import */ var _arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arrayLikeToArray */ "./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js");

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return Object(_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__["default"])(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(n);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Object(_arrayLikeToArray__WEBPACK_IMPORTED_MODULE_0__["default"])(o, minLen);
}

/***/ }),

/***/ "./node_modules/i18next-xhr-backend/dist/esm/i18nextXHRBackend.js":
/*!************************************************************************!*\
  !*** ./node_modules/i18next-xhr-backend/dist/esm/i18nextXHRBackend.js ***!
  \************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/esm/classCallCheck */ "./node_modules/@babel/runtime/helpers/esm/classCallCheck.js");
/* harmony import */ var _babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/esm/createClass */ "./node_modules/@babel/runtime/helpers/esm/createClass.js");
/* harmony import */ var _babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/esm/defineProperty */ "./node_modules/@babel/runtime/helpers/esm/defineProperty.js");
/* harmony import */ var _babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @babel/runtime/helpers/esm/typeof */ "./node_modules/@babel/runtime/helpers/esm/typeof.js");





var arr = [];
var each = arr.forEach;
var slice = arr.slice;
function defaults(obj) {
  each.call(slice.call(arguments, 1), function (source) {
    if (source) {
      for (var prop in source) {
        if (obj[prop] === undefined) obj[prop] = source[prop];
      }
    }
  });
  return obj;
}

function addQueryString(url, params) {
  if (params && Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_3__["default"])(params) === 'object') {
    var queryString = '',
        e = encodeURIComponent; // Must encode data

    for (var paramName in params) {
      queryString += '&' + e(paramName) + '=' + e(params[paramName]);
    }

    if (!queryString) {
      return url;
    }

    url = url + (url.indexOf('?') !== -1 ? '&' : '?') + queryString.slice(1);
  }

  return url;
} // https://gist.github.com/Xeoncross/7663273


function ajax(url, options, callback, data, cache) {
  if (data && Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_3__["default"])(data) === 'object') {
    if (!cache) {
      data['_t'] = new Date();
    } // URL encoded form data must be in querystring format


    data = addQueryString('', data).slice(1);
  }

  if (options.queryStringParams) {
    url = addQueryString(url, options.queryStringParams);
  }

  try {
    var x;

    if (XMLHttpRequest) {
      x = new XMLHttpRequest();
    } else {
      x = new ActiveXObject('MSXML2.XMLHTTP.3.0');
    }

    x.open(data ? 'POST' : 'GET', url, 1);

    if (!options.crossDomain) {
      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
    }

    x.withCredentials = !!options.withCredentials;

    if (data) {
      x.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    }

    if (x.overrideMimeType) {
      x.overrideMimeType("application/json");
    }

    var h = options.customHeaders;
    h = typeof h === 'function' ? h() : h;

    if (h) {
      for (var i in h) {
        x.setRequestHeader(i, h[i]);
      }
    }

    x.onreadystatechange = function () {
      x.readyState > 3 && callback && callback(x.responseText, x);
    };

    x.send(data);
  } catch (e) {
    console && console.log(e);
  }
}

function getDefaults() {
  return {
    loadPath: '/locales/{{lng}}/{{ns}}.json',
    addPath: '/locales/add/{{lng}}/{{ns}}',
    allowMultiLoading: false,
    parse: JSON.parse,
    parsePayload: function parsePayload(namespace, key, fallbackValue) {
      return Object(_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["default"])({}, key, fallbackValue || '');
    },
    crossDomain: false,
    ajax: ajax
  };
}

var Backend =
/*#__PURE__*/
function () {
  function Backend(services) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__["default"])(this, Backend);

    this.init(services, options);
    this.type = 'backend';
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__["default"])(Backend, [{
    key: "init",
    value: function init(services) {
      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      this.services = services;
      this.options = defaults(options, this.options || {}, getDefaults());
    }
  }, {
    key: "readMulti",
    value: function readMulti(languages, namespaces, callback) {
      var loadPath = this.options.loadPath;

      if (typeof this.options.loadPath === 'function') {
        loadPath = this.options.loadPath(languages, namespaces);
      }

      var url = this.services.interpolator.interpolate(loadPath, {
        lng: languages.join('+'),
        ns: namespaces.join('+')
      });
      this.loadUrl(url, callback);
    }
  }, {
    key: "read",
    value: function read(language, namespace, callback) {
      var loadPath = this.options.loadPath;

      if (typeof this.options.loadPath === 'function') {
        loadPath = this.options.loadPath([language], [namespace]);
      }

      var url = this.services.interpolator.interpolate(loadPath, {
        lng: language,
        ns: namespace
      });
      this.loadUrl(url, callback);
    }
  }, {
    key: "loadUrl",
    value: function loadUrl(url, callback) {
      var _this = this;

      this.options.ajax(url, this.options, function (data, xhr) {
        if (xhr.status >= 500 && xhr.status < 600) return callback('failed loading ' + url, true
        /* retry */
        );
        if (xhr.status >= 400 && xhr.status < 500) return callback('failed loading ' + url, false
        /* no retry */
        );
        var ret, err;

        try {
          ret = _this.options.parse(data, url);
        } catch (e) {
          err = 'failed parsing ' + url + ' to json';
        }

        if (err) return callback(err, false);
        callback(null, ret);
      });
    }
  }, {
    key: "create",
    value: function create(languages, namespace, key, fallbackValue) {
      var _this2 = this;

      if (typeof languages === 'string') languages = [languages];
      var payload = this.options.parsePayload(namespace, key, fallbackValue);
      languages.forEach(function (lng) {
        var url = _this2.services.interpolator.interpolate(_this2.options.addPath, {
          lng: lng,
          ns: namespace
        });

        _this2.options.ajax(url, _this2.options, function (data, xhr) {//const statusCode = xhr.status.toString();
          // TODO: if statusCode === 4xx do log
        }, payload);
      });
    }
  }]);

  return Backend;
}();

Backend.type = 'backend';

/* harmony default export */ __webpack_exports__["default"] = (Backend);


/***/ }),

/***/ "./node_modules/i18next/dist/esm/i18next.js":
/*!**************************************************!*\
  !*** ./node_modules/i18next/dist/esm/i18next.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/esm/typeof */ "./node_modules/@babel/runtime/helpers/esm/typeof.js");
/* harmony import */ var _babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/esm/objectSpread */ "./node_modules/@babel/runtime/helpers/esm/objectSpread.js");
/* harmony import */ var _babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/esm/classCallCheck */ "./node_modules/@babel/runtime/helpers/esm/classCallCheck.js");
/* harmony import */ var _babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @babel/runtime/helpers/esm/createClass */ "./node_modules/@babel/runtime/helpers/esm/createClass.js");
/* harmony import */ var _babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @babel/runtime/helpers/esm/possibleConstructorReturn */ "./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js");
/* harmony import */ var _babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @babel/runtime/helpers/esm/getPrototypeOf */ "./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js");
/* harmony import */ var _babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @babel/runtime/helpers/esm/assertThisInitialized */ "./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js");
/* harmony import */ var _babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @babel/runtime/helpers/esm/inherits */ "./node_modules/@babel/runtime/helpers/esm/inherits.js");
/* harmony import */ var _babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @babel/runtime/helpers/esm/toConsumableArray */ "./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js");
/* harmony import */ var _babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @babel/runtime/helpers/esm/slicedToArray */ "./node_modules/@babel/runtime/helpers/esm/slicedToArray.js");











var consoleLogger = {
  type: 'logger',
  log: function log(args) {
    this.output('log', args);
  },
  warn: function warn(args) {
    this.output('warn', args);
  },
  error: function error(args) {
    this.output('error', args);
  },
  output: function output(type, args) {
    var _console;

    /* eslint no-console: 0 */
    if (console && console[type]) (_console = console)[type].apply(_console, Object(_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_8__["default"])(args));
  }
};

var Logger =
/*#__PURE__*/
function () {
  function Logger(concreteLogger) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, Logger);

    this.init(concreteLogger, options);
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(Logger, [{
    key: "init",
    value: function init(concreteLogger) {
      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      this.prefix = options.prefix || 'i18next:';
      this.logger = concreteLogger || consoleLogger;
      this.options = options;
      this.debug = options.debug;
    }
  }, {
    key: "setDebug",
    value: function setDebug(bool) {
      this.debug = bool;
    }
  }, {
    key: "log",
    value: function log() {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return this.forward(args, 'log', '', true);
    }
  }, {
    key: "warn",
    value: function warn() {
      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        args[_key2] = arguments[_key2];
      }

      return this.forward(args, 'warn', '', true);
    }
  }, {
    key: "error",
    value: function error() {
      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
        args[_key3] = arguments[_key3];
      }

      return this.forward(args, 'error', '');
    }
  }, {
    key: "deprecate",
    value: function deprecate() {
      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
        args[_key4] = arguments[_key4];
      }

      return this.forward(args, 'warn', 'WARNING DEPRECATED: ', true);
    }
  }, {
    key: "forward",
    value: function forward(args, lvl, prefix, debugOnly) {
      if (debugOnly && !this.debug) return null;
      if (typeof args[0] === 'string') args[0] = "".concat(prefix).concat(this.prefix, " ").concat(args[0]);
      return this.logger[lvl](args);
    }
  }, {
    key: "create",
    value: function create(moduleName) {
      return new Logger(this.logger, Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, {
        prefix: "".concat(this.prefix, ":").concat(moduleName, ":")
      }, this.options));
    }
  }]);

  return Logger;
}();

var baseLogger = new Logger();

var EventEmitter =
/*#__PURE__*/
function () {
  function EventEmitter() {
    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, EventEmitter);

    this.observers = {};
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(EventEmitter, [{
    key: "on",
    value: function on(events, listener) {
      var _this = this;

      events.split(' ').forEach(function (event) {
        _this.observers[event] = _this.observers[event] || [];

        _this.observers[event].push(listener);
      });
      return this;
    }
  }, {
    key: "off",
    value: function off(event, listener) {
      if (!this.observers[event]) return;

      if (!listener) {
        delete this.observers[event];
        return;
      }

      this.observers[event] = this.observers[event].filter(function (l) {
        return l !== listener;
      });
    }
  }, {
    key: "emit",
    value: function emit(event) {
      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      if (this.observers[event]) {
        var cloned = [].concat(this.observers[event]);
        cloned.forEach(function (observer) {
          observer.apply(void 0, args);
        });
      }

      if (this.observers['*']) {
        var _cloned = [].concat(this.observers['*']);

        _cloned.forEach(function (observer) {
          observer.apply(observer, [event].concat(args));
        });
      }
    }
  }]);

  return EventEmitter;
}();

// http://lea.verou.me/2016/12/resolve-promises-externally-with-this-one-weird-trick/
function defer() {
  var res;
  var rej;
  var promise = new Promise(function (resolve, reject) {
    res = resolve;
    rej = reject;
  });
  promise.resolve = res;
  promise.reject = rej;
  return promise;
}
function makeString(object) {
  if (object == null) return '';
  /* eslint prefer-template: 0 */

  return '' + object;
}
function copy(a, s, t) {
  a.forEach(function (m) {
    if (s[m]) t[m] = s[m];
  });
}

function getLastOfPath(object, path, Empty) {
  function cleanKey(key) {
    return key && key.indexOf('###') > -1 ? key.replace(/###/g, '.') : key;
  }

  function canNotTraverseDeeper() {
    return !object || typeof object === 'string';
  }

  var stack = typeof path !== 'string' ? [].concat(path) : path.split('.');

  while (stack.length > 1) {
    if (canNotTraverseDeeper()) return {};
    var key = cleanKey(stack.shift());
    if (!object[key] && Empty) object[key] = new Empty();
    object = object[key];
  }

  if (canNotTraverseDeeper()) return {};
  return {
    obj: object,
    k: cleanKey(stack.shift())
  };
}

function setPath(object, path, newValue) {
  var _getLastOfPath = getLastOfPath(object, path, Object),
      obj = _getLastOfPath.obj,
      k = _getLastOfPath.k;

  obj[k] = newValue;
}
function pushPath(object, path, newValue, concat) {
  var _getLastOfPath2 = getLastOfPath(object, path, Object),
      obj = _getLastOfPath2.obj,
      k = _getLastOfPath2.k;

  obj[k] = obj[k] || [];
  if (concat) obj[k] = obj[k].concat(newValue);
  if (!concat) obj[k].push(newValue);
}
function getPath(object, path) {
  var _getLastOfPath3 = getLastOfPath(object, path),
      obj = _getLastOfPath3.obj,
      k = _getLastOfPath3.k;

  if (!obj) return undefined;
  return obj[k];
}
function getPathWithDefaults(data, defaultData, key) {
  var value = getPath(data, key);

  if (value !== undefined) {
    return value;
  } // Fallback to default values


  return getPath(defaultData, key);
}
function deepExtend(target, source, overwrite) {
  /* eslint no-restricted-syntax: 0 */
  for (var prop in source) {
    if (prop in target) {
      // If we reached a leaf string in target or source then replace with source or skip depending on the 'overwrite' switch
      if (typeof target[prop] === 'string' || target[prop] instanceof String || typeof source[prop] === 'string' || source[prop] instanceof String) {
        if (overwrite) target[prop] = source[prop];
      } else {
        deepExtend(target[prop], source[prop], overwrite);
      }
    } else {
      target[prop] = source[prop];
    }
  }

  return target;
}
function regexEscape(str) {
  /* eslint no-useless-escape: 0 */
  return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
}
/* eslint-disable */

var _entityMap = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#39;',
  '/': '&#x2F;'
};
/* eslint-enable */

function escape(data) {
  if (typeof data === 'string') {
    return data.replace(/[&<>"'\/]/g, function (s) {
      return _entityMap[s];
    });
  }

  return data;
}

var ResourceStore =
/*#__PURE__*/
function (_EventEmitter) {
  Object(_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_7__["default"])(ResourceStore, _EventEmitter);

  function ResourceStore(data) {
    var _this;

    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
      ns: ['translation'],
      defaultNS: 'translation'
    };

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, ResourceStore);

    _this = Object(_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__["default"])(this, Object(_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__["default"])(ResourceStore).call(this));
    EventEmitter.call(Object(_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__["default"])(_this)); // <=IE10 fix (unable to call parent constructor)

    _this.data = data || {};
    _this.options = options;

    if (_this.options.keySeparator === undefined) {
      _this.options.keySeparator = '.';
    }

    return _this;
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(ResourceStore, [{
    key: "addNamespaces",
    value: function addNamespaces(ns) {
      if (this.options.ns.indexOf(ns) < 0) {
        this.options.ns.push(ns);
      }
    }
  }, {
    key: "removeNamespaces",
    value: function removeNamespaces(ns) {
      var index = this.options.ns.indexOf(ns);

      if (index > -1) {
        this.options.ns.splice(index, 1);
      }
    }
  }, {
    key: "getResource",
    value: function getResource(lng, ns, key) {
      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;
      var path = [lng, ns];
      if (key && typeof key !== 'string') path = path.concat(key);
      if (key && typeof key === 'string') path = path.concat(keySeparator ? key.split(keySeparator) : key);

      if (lng.indexOf('.') > -1) {
        path = lng.split('.');
      }

      return getPath(this.data, path);
    }
  }, {
    key: "addResource",
    value: function addResource(lng, ns, key, value) {
      var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {
        silent: false
      };
      var keySeparator = this.options.keySeparator;
      if (keySeparator === undefined) keySeparator = '.';
      var path = [lng, ns];
      if (key) path = path.concat(keySeparator ? key.split(keySeparator) : key);

      if (lng.indexOf('.') > -1) {
        path = lng.split('.');
        value = ns;
        ns = path[1];
      }

      this.addNamespaces(ns);
      setPath(this.data, path, value);
      if (!options.silent) this.emit('added', lng, ns, key, value);
    }
  }, {
    key: "addResources",
    value: function addResources(lng, ns, resources) {
      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {
        silent: false
      };

      /* eslint no-restricted-syntax: 0 */
      for (var m in resources) {
        if (typeof resources[m] === 'string' || Object.prototype.toString.apply(resources[m]) === '[object Array]') this.addResource(lng, ns, m, resources[m], {
          silent: true
        });
      }

      if (!options.silent) this.emit('added', lng, ns, resources);
    }
  }, {
    key: "addResourceBundle",
    value: function addResourceBundle(lng, ns, resources, deep, overwrite) {
      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {
        silent: false
      };
      var path = [lng, ns];

      if (lng.indexOf('.') > -1) {
        path = lng.split('.');
        deep = resources;
        resources = ns;
        ns = path[1];
      }

      this.addNamespaces(ns);
      var pack = getPath(this.data, path) || {};

      if (deep) {
        deepExtend(pack, resources, overwrite);
      } else {
        pack = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, pack, resources);
      }

      setPath(this.data, path, pack);
      if (!options.silent) this.emit('added', lng, ns, resources);
    }
  }, {
    key: "removeResourceBundle",
    value: function removeResourceBundle(lng, ns) {
      if (this.hasResourceBundle(lng, ns)) {
        delete this.data[lng][ns];
      }

      this.removeNamespaces(ns);
      this.emit('removed', lng, ns);
    }
  }, {
    key: "hasResourceBundle",
    value: function hasResourceBundle(lng, ns) {
      return this.getResource(lng, ns) !== undefined;
    }
  }, {
    key: "getResourceBundle",
    value: function getResourceBundle(lng, ns) {
      if (!ns) ns = this.options.defaultNS; // COMPATIBILITY: remove extend in v2.1.0

      if (this.options.compatibilityAPI === 'v1') return Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, {}, this.getResource(lng, ns));
      return this.getResource(lng, ns);
    }
  }, {
    key: "getDataByLanguage",
    value: function getDataByLanguage(lng) {
      return this.data[lng];
    }
  }, {
    key: "toJSON",
    value: function toJSON() {
      return this.data;
    }
  }]);

  return ResourceStore;
}(EventEmitter);

var postProcessor = {
  processors: {},
  addPostProcessor: function addPostProcessor(module) {
    this.processors[module.name] = module;
  },
  handle: function handle(processors, value, key, options, translator) {
    var _this = this;

    processors.forEach(function (processor) {
      if (_this.processors[processor]) value = _this.processors[processor].process(value, key, options, translator);
    });
    return value;
  }
};

var checkedLoadedFor = {};

var Translator =
/*#__PURE__*/
function (_EventEmitter) {
  Object(_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_7__["default"])(Translator, _EventEmitter);

  function Translator(services) {
    var _this;

    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, Translator);

    _this = Object(_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__["default"])(this, Object(_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__["default"])(Translator).call(this));
    EventEmitter.call(Object(_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__["default"])(_this)); // <=IE10 fix (unable to call parent constructor)

    copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector', 'i18nFormat', 'utils'], services, Object(_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__["default"])(_this));
    _this.options = options;

    if (_this.options.keySeparator === undefined) {
      _this.options.keySeparator = '.';
    }

    _this.logger = baseLogger.create('translator');
    return _this;
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(Translator, [{
    key: "changeLanguage",
    value: function changeLanguage(lng) {
      if (lng) this.language = lng;
    }
  }, {
    key: "exists",
    value: function exists(key) {
      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
        interpolation: {}
      };
      var resolved = this.resolve(key, options);
      return resolved && resolved.res !== undefined;
    }
  }, {
    key: "extractFromKey",
    value: function extractFromKey(key, options) {
      var nsSeparator = options.nsSeparator || this.options.nsSeparator;
      if (nsSeparator === undefined) nsSeparator = ':';
      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;
      var namespaces = options.ns || this.options.defaultNS;

      if (nsSeparator && key.indexOf(nsSeparator) > -1) {
        var parts = key.split(nsSeparator);
        if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();
        key = parts.join(keySeparator);
      }

      if (typeof namespaces === 'string') namespaces = [namespaces];
      return {
        key: key,
        namespaces: namespaces
      };
    }
  }, {
    key: "translate",
    value: function translate(keys, options) {
      var _this2 = this;

      if (Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["default"])(options) !== 'object' && this.options.overloadTranslationOptionHandler) {
        /* eslint prefer-rest-params: 0 */
        options = this.options.overloadTranslationOptionHandler(arguments);
      }

      if (!options) options = {}; // non valid keys handling

      if (keys === undefined || keys === null
      /* || keys === ''*/
      ) return '';
      if (!Array.isArray(keys)) keys = [String(keys)]; // separators

      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator; // get namespace(s)

      var _this$extractFromKey = this.extractFromKey(keys[keys.length - 1], options),
          key = _this$extractFromKey.key,
          namespaces = _this$extractFromKey.namespaces;

      var namespace = namespaces[namespaces.length - 1]; // return key on CIMode

      var lng = options.lng || this.language;
      var appendNamespaceToCIMode = options.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;

      if (lng && lng.toLowerCase() === 'cimode') {
        if (appendNamespaceToCIMode) {
          var nsSeparator = options.nsSeparator || this.options.nsSeparator;
          return namespace + nsSeparator + key;
        }

        return key;
      } // resolve from store


      var resolved = this.resolve(keys, options);
      var res = resolved && resolved.res;
      var resUsedKey = resolved && resolved.usedKey || key;
      var resExactUsedKey = resolved && resolved.exactUsedKey || key;
      var resType = Object.prototype.toString.apply(res);
      var noObject = ['[object Number]', '[object Function]', '[object RegExp]'];
      var joinArrays = options.joinArrays !== undefined ? options.joinArrays : this.options.joinArrays; // object

      var handleAsObjectInI18nFormat = !this.i18nFormat || this.i18nFormat.handleAsObject;
      var handleAsObject = typeof res !== 'string' && typeof res !== 'boolean' && typeof res !== 'number';

      if (handleAsObjectInI18nFormat && res && handleAsObject && noObject.indexOf(resType) < 0 && !(typeof joinArrays === 'string' && resType === '[object Array]')) {
        if (!options.returnObjects && !this.options.returnObjects) {
          this.logger.warn('accessing an object - but returnObjects options is not enabled!');
          return this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, res, options) : "key '".concat(key, " (").concat(this.language, ")' returned an object instead of string.");
        } // if we got a separator we loop over children - else we just return object as is
        // as having it set to false means no hierarchy so no lookup for nested values


        if (keySeparator) {
          var resTypeIsArray = resType === '[object Array]';
          var copy$$1 = resTypeIsArray ? [] : {}; // apply child translation on a copy

          /* eslint no-restricted-syntax: 0 */

          var newKeyToUse = resTypeIsArray ? resExactUsedKey : resUsedKey;

          for (var m in res) {
            if (Object.prototype.hasOwnProperty.call(res, m)) {
              var deepKey = "".concat(newKeyToUse).concat(keySeparator).concat(m);
              copy$$1[m] = this.translate(deepKey, Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, options, {
                joinArrays: false,
                ns: namespaces
              }));
              if (copy$$1[m] === deepKey) copy$$1[m] = res[m]; // if nothing found use orginal value as fallback
            }
          }

          res = copy$$1;
        }
      } else if (handleAsObjectInI18nFormat && typeof joinArrays === 'string' && resType === '[object Array]') {
        // array special treatment
        res = res.join(joinArrays);
        if (res) res = this.extendTranslation(res, keys, options);
      } else {
        // string, empty or null
        var usedDefault = false;
        var usedKey = false; // fallback value

        if (!this.isValidLookup(res) && options.defaultValue !== undefined) {
          usedDefault = true;

          if (options.count !== undefined) {
            var suffix = this.pluralResolver.getSuffix(lng, options.count);
            res = options["defaultValue".concat(suffix)];
          }

          if (!res) res = options.defaultValue;
        }

        if (!this.isValidLookup(res)) {
          usedKey = true;
          res = key;
        } // save missing


        var updateMissing = options.defaultValue && options.defaultValue !== res && this.options.updateMissing;

        if (usedKey || usedDefault || updateMissing) {
          this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? options.defaultValue : res);
          var lngs = [];
          var fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, options.lng || this.language);

          if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {
            for (var i = 0; i < fallbackLngs.length; i++) {
              lngs.push(fallbackLngs[i]);
            }
          } else if (this.options.saveMissingTo === 'all') {
            lngs = this.languageUtils.toResolveHierarchy(options.lng || this.language);
          } else {
            lngs.push(options.lng || this.language);
          }

          var send = function send(l, k) {
            if (_this2.options.missingKeyHandler) {
              _this2.options.missingKeyHandler(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);
            } else if (_this2.backendConnector && _this2.backendConnector.saveMissing) {
              _this2.backendConnector.saveMissing(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);
            }

            _this2.emit('missingKey', l, namespace, k, res);
          };

          if (this.options.saveMissing) {
            var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';

            if (this.options.saveMissingPlurals && needsPluralHandling) {
              lngs.forEach(function (l) {
                var plurals = _this2.pluralResolver.getPluralFormsOfKey(l, key);

                plurals.forEach(function (p) {
                  return send([l], p);
                });
              });
            } else {
              send(lngs, key);
            }
          }
        } // extend


        res = this.extendTranslation(res, keys, options, resolved); // append namespace if still key

        if (usedKey && res === key && this.options.appendNamespaceToMissingKey) res = "".concat(namespace, ":").concat(key); // parseMissingKeyHandler

        if (usedKey && this.options.parseMissingKeyHandler) res = this.options.parseMissingKeyHandler(res);
      } // return


      return res;
    }
  }, {
    key: "extendTranslation",
    value: function extendTranslation(res, key, options, resolved) {
      var _this3 = this;

      if (this.i18nFormat && this.i18nFormat.parse) {
        res = this.i18nFormat.parse(res, options, resolved.usedLng, resolved.usedNS, resolved.usedKey, {
          resolved: resolved
        });
      } else if (!options.skipInterpolation) {
        // i18next.parsing
        if (options.interpolation) this.interpolator.init(Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, options, {
          interpolation: Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, this.options.interpolation, options.interpolation)
        })); // interpolate

        var data = options.replace && typeof options.replace !== 'string' ? options.replace : options;
        if (this.options.interpolation.defaultVariables) data = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, this.options.interpolation.defaultVariables, data);
        res = this.interpolator.interpolate(res, data, options.lng || this.language, options); // nesting

        if (options.nest !== false) res = this.interpolator.nest(res, function () {
          return _this3.translate.apply(_this3, arguments);
        }, options);
        if (options.interpolation) this.interpolator.reset();
      } // post process


      var postProcess = options.postProcess || this.options.postProcess;
      var postProcessorNames = typeof postProcess === 'string' ? [postProcess] : postProcess;

      if (res !== undefined && res !== null && postProcessorNames && postProcessorNames.length && options.applyPostProcessor !== false) {
        res = postProcessor.handle(postProcessorNames, res, key, this.options && this.options.postProcessPassResolved ? Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({
          i18nResolved: resolved
        }, options) : options, this);
      }

      return res;
    }
  }, {
    key: "resolve",
    value: function resolve(keys) {
      var _this4 = this;

      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var found;
      var usedKey; // plain key

      var exactUsedKey; // key with context / plural

      var usedLng;
      var usedNS;
      if (typeof keys === 'string') keys = [keys]; // forEach possible key

      keys.forEach(function (k) {
        if (_this4.isValidLookup(found)) return;

        var extracted = _this4.extractFromKey(k, options);

        var key = extracted.key;
        usedKey = key;
        var namespaces = extracted.namespaces;
        if (_this4.options.fallbackNS) namespaces = namespaces.concat(_this4.options.fallbackNS);
        var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';
        var needsContextHandling = options.context !== undefined && typeof options.context === 'string' && options.context !== '';
        var codes = options.lngs ? options.lngs : _this4.languageUtils.toResolveHierarchy(options.lng || _this4.language, options.fallbackLng);
        namespaces.forEach(function (ns) {
          if (_this4.isValidLookup(found)) return;
          usedNS = ns;

          if (!checkedLoadedFor["".concat(codes[0], "-").concat(ns)] && _this4.utils && _this4.utils.hasLoadedNamespace && !_this4.utils.hasLoadedNamespace(usedNS)) {
            checkedLoadedFor["".concat(codes[0], "-").concat(ns)] = true;

            _this4.logger.warn("key \"".concat(usedKey, "\" for namespace \"").concat(usedNS, "\" for languages \"").concat(codes.join(', '), "\" won't get resolved as namespace was not yet loaded"), 'This means something IS WRONG in your application setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');
          }

          codes.forEach(function (code) {
            if (_this4.isValidLookup(found)) return;
            usedLng = code;
            var finalKey = key;
            var finalKeys = [finalKey];

            if (_this4.i18nFormat && _this4.i18nFormat.addLookupKeys) {
              _this4.i18nFormat.addLookupKeys(finalKeys, key, code, ns, options);
            } else {
              var pluralSuffix;
              if (needsPluralHandling) pluralSuffix = _this4.pluralResolver.getSuffix(code, options.count); // fallback for plural if context not found

              if (needsPluralHandling && needsContextHandling) finalKeys.push(finalKey + pluralSuffix); // get key for context if needed

              if (needsContextHandling) finalKeys.push(finalKey += "".concat(_this4.options.contextSeparator).concat(options.context)); // get key for plural if needed

              if (needsPluralHandling) finalKeys.push(finalKey += pluralSuffix);
            } // iterate over finalKeys starting with most specific pluralkey (-> contextkey only) -> singularkey only


            var possibleKey;
            /* eslint no-cond-assign: 0 */

            while (possibleKey = finalKeys.pop()) {
              if (!_this4.isValidLookup(found)) {
                exactUsedKey = possibleKey;
                found = _this4.getResource(code, ns, possibleKey, options);
              }
            }
          });
        });
      });
      return {
        res: found,
        usedKey: usedKey,
        exactUsedKey: exactUsedKey,
        usedLng: usedLng,
        usedNS: usedNS
      };
    }
  }, {
    key: "isValidLookup",
    value: function isValidLookup(res) {
      return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');
    }
  }, {
    key: "getResource",
    value: function getResource(code, ns, key) {
      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
      if (this.i18nFormat && this.i18nFormat.getResource) return this.i18nFormat.getResource(code, ns, key, options);
      return this.resourceStore.getResource(code, ns, key, options);
    }
  }]);

  return Translator;
}(EventEmitter);

function capitalize(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

var LanguageUtil =
/*#__PURE__*/
function () {
  function LanguageUtil(options) {
    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, LanguageUtil);

    this.options = options;
    this.whitelist = this.options.whitelist || false;
    this.logger = baseLogger.create('languageUtils');
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(LanguageUtil, [{
    key: "getScriptPartFromCode",
    value: function getScriptPartFromCode(code) {
      if (!code || code.indexOf('-') < 0) return null;
      var p = code.split('-');
      if (p.length === 2) return null;
      p.pop();
      return this.formatLanguageCode(p.join('-'));
    }
  }, {
    key: "getLanguagePartFromCode",
    value: function getLanguagePartFromCode(code) {
      if (!code || code.indexOf('-') < 0) return code;
      var p = code.split('-');
      return this.formatLanguageCode(p[0]);
    }
  }, {
    key: "formatLanguageCode",
    value: function formatLanguageCode(code) {
      // http://www.iana.org/assignments/language-tags/language-tags.xhtml
      if (typeof code === 'string' && code.indexOf('-') > -1) {
        var specialCases = ['hans', 'hant', 'latn', 'cyrl', 'cans', 'mong', 'arab'];
        var p = code.split('-');

        if (this.options.lowerCaseLng) {
          p = p.map(function (part) {
            return part.toLowerCase();
          });
        } else if (p.length === 2) {
          p[0] = p[0].toLowerCase();
          p[1] = p[1].toUpperCase();
          if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());
        } else if (p.length === 3) {
          p[0] = p[0].toLowerCase(); // if lenght 2 guess it's a country

          if (p[1].length === 2) p[1] = p[1].toUpperCase();
          if (p[0] !== 'sgn' && p[2].length === 2) p[2] = p[2].toUpperCase();
          if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());
          if (specialCases.indexOf(p[2].toLowerCase()) > -1) p[2] = capitalize(p[2].toLowerCase());
        }

        return p.join('-');
      }

      return this.options.cleanCode || this.options.lowerCaseLng ? code.toLowerCase() : code;
    }
  }, {
    key: "isWhitelisted",
    value: function isWhitelisted(code) {
      if (this.options.load === 'languageOnly' || this.options.nonExplicitWhitelist) {
        code = this.getLanguagePartFromCode(code);
      }

      return !this.whitelist || !this.whitelist.length || this.whitelist.indexOf(code) > -1;
    }
  }, {
    key: "getFallbackCodes",
    value: function getFallbackCodes(fallbacks, code) {
      if (!fallbacks) return [];
      if (typeof fallbacks === 'string') fallbacks = [fallbacks];
      if (Object.prototype.toString.apply(fallbacks) === '[object Array]') return fallbacks;
      if (!code) return fallbacks["default"] || []; // asume we have an object defining fallbacks

      var found = fallbacks[code];
      if (!found) found = fallbacks[this.getScriptPartFromCode(code)];
      if (!found) found = fallbacks[this.formatLanguageCode(code)];
      if (!found) found = fallbacks["default"];
      return found || [];
    }
  }, {
    key: "toResolveHierarchy",
    value: function toResolveHierarchy(code, fallbackCode) {
      var _this = this;

      var fallbackCodes = this.getFallbackCodes(fallbackCode || this.options.fallbackLng || [], code);
      var codes = [];

      var addCode = function addCode(c) {
        if (!c) return;

        if (_this.isWhitelisted(c)) {
          codes.push(c);
        } else {
          _this.logger.warn("rejecting non-whitelisted language code: ".concat(c));
        }
      };

      if (typeof code === 'string' && code.indexOf('-') > -1) {
        if (this.options.load !== 'languageOnly') addCode(this.formatLanguageCode(code));
        if (this.options.load !== 'languageOnly' && this.options.load !== 'currentOnly') addCode(this.getScriptPartFromCode(code));
        if (this.options.load !== 'currentOnly') addCode(this.getLanguagePartFromCode(code));
      } else if (typeof code === 'string') {
        addCode(this.formatLanguageCode(code));
      }

      fallbackCodes.forEach(function (fc) {
        if (codes.indexOf(fc) < 0) addCode(_this.formatLanguageCode(fc));
      });
      return codes;
    }
  }]);

  return LanguageUtil;
}();

/* eslint-disable */

var sets = [{
  lngs: ['ach', 'ak', 'am', 'arn', 'br', 'fil', 'gun', 'ln', 'mfe', 'mg', 'mi', 'oc', 'pt', 'pt-BR', 'tg', 'ti', 'tr', 'uz', 'wa'],
  nr: [1, 2],
  fc: 1
}, {
  lngs: ['af', 'an', 'ast', 'az', 'bg', 'bn', 'ca', 'da', 'de', 'dev', 'el', 'en', 'eo', 'es', 'et', 'eu', 'fi', 'fo', 'fur', 'fy', 'gl', 'gu', 'ha', 'hi', 'hu', 'hy', 'ia', 'it', 'kn', 'ku', 'lb', 'mai', 'ml', 'mn', 'mr', 'nah', 'nap', 'nb', 'ne', 'nl', 'nn', 'no', 'nso', 'pa', 'pap', 'pms', 'ps', 'pt-PT', 'rm', 'sco', 'se', 'si', 'so', 'son', 'sq', 'sv', 'sw', 'ta', 'te', 'tk', 'ur', 'yo'],
  nr: [1, 2],
  fc: 2
}, {
  lngs: ['ay', 'bo', 'cgg', 'fa', 'id', 'ja', 'jbo', 'ka', 'kk', 'km', 'ko', 'ky', 'lo', 'ms', 'sah', 'su', 'th', 'tt', 'ug', 'vi', 'wo', 'zh'],
  nr: [1],
  fc: 3
}, {
  lngs: ['be', 'bs', 'cnr', 'dz', 'hr', 'ru', 'sr', 'uk'],
  nr: [1, 2, 5],
  fc: 4
}, {
  lngs: ['ar'],
  nr: [0, 1, 2, 3, 11, 100],
  fc: 5
}, {
  lngs: ['cs', 'sk'],
  nr: [1, 2, 5],
  fc: 6
}, {
  lngs: ['csb', 'pl'],
  nr: [1, 2, 5],
  fc: 7
}, {
  lngs: ['cy'],
  nr: [1, 2, 3, 8],
  fc: 8
}, {
  lngs: ['fr'],
  nr: [1, 2],
  fc: 9
}, {
  lngs: ['ga'],
  nr: [1, 2, 3, 7, 11],
  fc: 10
}, {
  lngs: ['gd'],
  nr: [1, 2, 3, 20],
  fc: 11
}, {
  lngs: ['is'],
  nr: [1, 2],
  fc: 12
}, {
  lngs: ['jv'],
  nr: [0, 1],
  fc: 13
}, {
  lngs: ['kw'],
  nr: [1, 2, 3, 4],
  fc: 14
}, {
  lngs: ['lt'],
  nr: [1, 2, 10],
  fc: 15
}, {
  lngs: ['lv'],
  nr: [1, 2, 0],
  fc: 16
}, {
  lngs: ['mk'],
  nr: [1, 2],
  fc: 17
}, {
  lngs: ['mnk'],
  nr: [0, 1, 2],
  fc: 18
}, {
  lngs: ['mt'],
  nr: [1, 2, 11, 20],
  fc: 19
}, {
  lngs: ['or'],
  nr: [2, 1],
  fc: 2
}, {
  lngs: ['ro'],
  nr: [1, 2, 20],
  fc: 20
}, {
  lngs: ['sl'],
  nr: [5, 1, 2, 3],
  fc: 21
}, {
  lngs: ['he'],
  nr: [1, 2, 20, 21],
  fc: 22
}];
var _rulesPluralsTypes = {
  1: function _(n) {
    return Number(n > 1);
  },
  2: function _(n) {
    return Number(n != 1);
  },
  3: function _(n) {
    return 0;
  },
  4: function _(n) {
    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);
  },
  5: function _(n) {
    return Number(n === 0 ? 0 : n == 1 ? 1 : n == 2 ? 2 : n % 100 >= 3 && n % 100 <= 10 ? 3 : n % 100 >= 11 ? 4 : 5);
  },
  6: function _(n) {
    return Number(n == 1 ? 0 : n >= 2 && n <= 4 ? 1 : 2);
  },
  7: function _(n) {
    return Number(n == 1 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);
  },
  8: function _(n) {
    return Number(n == 1 ? 0 : n == 2 ? 1 : n != 8 && n != 11 ? 2 : 3);
  },
  9: function _(n) {
    return Number(n >= 2);
  },
  10: function _(n) {
    return Number(n == 1 ? 0 : n == 2 ? 1 : n < 7 ? 2 : n < 11 ? 3 : 4);
  },
  11: function _(n) {
    return Number(n == 1 || n == 11 ? 0 : n == 2 || n == 12 ? 1 : n > 2 && n < 20 ? 2 : 3);
  },
  12: function _(n) {
    return Number(n % 10 != 1 || n % 100 == 11);
  },
  13: function _(n) {
    return Number(n !== 0);
  },
  14: function _(n) {
    return Number(n == 1 ? 0 : n == 2 ? 1 : n == 3 ? 2 : 3);
  },
  15: function _(n) {
    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);
  },
  16: function _(n) {
    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n !== 0 ? 1 : 2);
  },
  17: function _(n) {
    return Number(n == 1 || n % 10 == 1 ? 0 : 1);
  },
  18: function _(n) {
    return Number(n == 0 ? 0 : n == 1 ? 1 : 2);
  },
  19: function _(n) {
    return Number(n == 1 ? 0 : n === 0 || n % 100 > 1 && n % 100 < 11 ? 1 : n % 100 > 10 && n % 100 < 20 ? 2 : 3);
  },
  20: function _(n) {
    return Number(n == 1 ? 0 : n === 0 || n % 100 > 0 && n % 100 < 20 ? 1 : 2);
  },
  21: function _(n) {
    return Number(n % 100 == 1 ? 1 : n % 100 == 2 ? 2 : n % 100 == 3 || n % 100 == 4 ? 3 : 0);
  },
  22: function _(n) {
    return Number(n === 1 ? 0 : n === 2 ? 1 : (n < 0 || n > 10) && n % 10 == 0 ? 2 : 3);
  }
};
/* eslint-enable */

function createRules() {
  var rules = {};
  sets.forEach(function (set) {
    set.lngs.forEach(function (l) {
      rules[l] = {
        numbers: set.nr,
        plurals: _rulesPluralsTypes[set.fc]
      };
    });
  });
  return rules;
}

var PluralResolver =
/*#__PURE__*/
function () {
  function PluralResolver(languageUtils) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, PluralResolver);

    this.languageUtils = languageUtils;
    this.options = options;
    this.logger = baseLogger.create('pluralResolver');
    this.rules = createRules();
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(PluralResolver, [{
    key: "addRule",
    value: function addRule(lng, obj) {
      this.rules[lng] = obj;
    }
  }, {
    key: "getRule",
    value: function getRule(code) {
      return this.rules[code] || this.rules[this.languageUtils.getLanguagePartFromCode(code)];
    }
  }, {
    key: "needsPlural",
    value: function needsPlural(code) {
      var rule = this.getRule(code);
      return rule && rule.numbers.length > 1;
    }
  }, {
    key: "getPluralFormsOfKey",
    value: function getPluralFormsOfKey(code, key) {
      var _this = this;

      var ret = [];
      var rule = this.getRule(code);
      if (!rule) return ret;
      rule.numbers.forEach(function (n) {
        var suffix = _this.getSuffix(code, n);

        ret.push("".concat(key).concat(suffix));
      });
      return ret;
    }
  }, {
    key: "getSuffix",
    value: function getSuffix(code, count) {
      var _this2 = this;

      var rule = this.getRule(code);

      if (rule) {
        // if (rule.numbers.length === 1) return ''; // only singular
        var idx = rule.noAbs ? rule.plurals(count) : rule.plurals(Math.abs(count));
        var suffix = rule.numbers[idx]; // special treatment for lngs only having singular and plural

        if (this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {
          if (suffix === 2) {
            suffix = 'plural';
          } else if (suffix === 1) {
            suffix = '';
          }
        }

        var returnSuffix = function returnSuffix() {
          return _this2.options.prepend && suffix.toString() ? _this2.options.prepend + suffix.toString() : suffix.toString();
        }; // COMPATIBILITY JSON
        // v1


        if (this.options.compatibilityJSON === 'v1') {
          if (suffix === 1) return '';
          if (typeof suffix === 'number') return "_plural_".concat(suffix.toString());
          return returnSuffix();
        } else if (
        /* v2 */
        this.options.compatibilityJSON === 'v2') {
          return returnSuffix();
        } else if (
        /* v3 - gettext index */
        this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {
          return returnSuffix();
        }

        return this.options.prepend && idx.toString() ? this.options.prepend + idx.toString() : idx.toString();
      }

      this.logger.warn("no plural rule found for: ".concat(code));
      return '';
    }
  }]);

  return PluralResolver;
}();

var Interpolator =
/*#__PURE__*/
function () {
  function Interpolator() {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, Interpolator);

    this.logger = baseLogger.create('interpolator');
    this.options = options;

    this.format = options.interpolation && options.interpolation.format || function (value) {
      return value;
    };

    this.init(options);
  }
  /* eslint no-param-reassign: 0 */


  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(Interpolator, [{
    key: "init",
    value: function init() {
      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      if (!options.interpolation) options.interpolation = {
        escapeValue: true
      };
      var iOpts = options.interpolation;
      this.escape = iOpts.escape !== undefined ? iOpts.escape : escape;
      this.escapeValue = iOpts.escapeValue !== undefined ? iOpts.escapeValue : true;
      this.useRawValueToEscape = iOpts.useRawValueToEscape !== undefined ? iOpts.useRawValueToEscape : false;
      this.prefix = iOpts.prefix ? regexEscape(iOpts.prefix) : iOpts.prefixEscaped || '{{';
      this.suffix = iOpts.suffix ? regexEscape(iOpts.suffix) : iOpts.suffixEscaped || '}}';
      this.formatSeparator = iOpts.formatSeparator ? iOpts.formatSeparator : iOpts.formatSeparator || ',';
      this.unescapePrefix = iOpts.unescapeSuffix ? '' : iOpts.unescapePrefix || '-';
      this.unescapeSuffix = this.unescapePrefix ? '' : iOpts.unescapeSuffix || '';
      this.nestingPrefix = iOpts.nestingPrefix ? regexEscape(iOpts.nestingPrefix) : iOpts.nestingPrefixEscaped || regexEscape('$t(');
      this.nestingSuffix = iOpts.nestingSuffix ? regexEscape(iOpts.nestingSuffix) : iOpts.nestingSuffixEscaped || regexEscape(')');
      this.nestingOptionsSeparator = iOpts.nestingOptionsSeparator ? iOpts.nestingOptionsSeparator : iOpts.nestingOptionsSeparator || ',';
      this.maxReplaces = iOpts.maxReplaces ? iOpts.maxReplaces : 1000;
      this.alwaysFormat = iOpts.alwaysFormat !== undefined ? iOpts.alwaysFormat : false; // the regexp

      this.resetRegExp();
    }
  }, {
    key: "reset",
    value: function reset() {
      if (this.options) this.init(this.options);
    }
  }, {
    key: "resetRegExp",
    value: function resetRegExp() {
      // the regexp
      var regexpStr = "".concat(this.prefix, "(.+?)").concat(this.suffix);
      this.regexp = new RegExp(regexpStr, 'g');
      var regexpUnescapeStr = "".concat(this.prefix).concat(this.unescapePrefix, "(.+?)").concat(this.unescapeSuffix).concat(this.suffix);
      this.regexpUnescape = new RegExp(regexpUnescapeStr, 'g');
      var nestingRegexpStr = "".concat(this.nestingPrefix, "(.+?)").concat(this.nestingSuffix);
      this.nestingRegexp = new RegExp(nestingRegexpStr, 'g');
    }
  }, {
    key: "interpolate",
    value: function interpolate(str, data, lng, options) {
      var _this = this;

      var match;
      var value;
      var replaces;
      var defaultData = this.options && this.options.interpolation && this.options.interpolation.defaultVariables || {};

      function regexSafe(val) {
        return val.replace(/\$/g, '$$$$');
      }

      var handleFormat = function handleFormat(key) {
        if (key.indexOf(_this.formatSeparator) < 0) {
          var path = getPathWithDefaults(data, defaultData, key);
          return _this.alwaysFormat ? _this.format(path, undefined, lng) : path;
        }

        var p = key.split(_this.formatSeparator);
        var k = p.shift().trim();
        var f = p.join(_this.formatSeparator).trim();
        return _this.format(getPathWithDefaults(data, defaultData, k), f, lng, options);
      };

      this.resetRegExp();
      var missingInterpolationHandler = options && options.missingInterpolationHandler || this.options.missingInterpolationHandler;
      replaces = 0; // unescape if has unescapePrefix/Suffix

      /* eslint no-cond-assign: 0 */

      while (match = this.regexpUnescape.exec(str)) {
        value = handleFormat(match[1].trim());

        if (value === undefined) {
          if (typeof missingInterpolationHandler === 'function') {
            var temp = missingInterpolationHandler(str, match, options);
            value = typeof temp === 'string' ? temp : '';
          } else {
            this.logger.warn("missed to pass in variable ".concat(match[1], " for interpolating ").concat(str));
            value = '';
          }
        } else if (typeof value !== 'string' && !this.useRawValueToEscape) {
          value = makeString(value);
        }

        str = str.replace(match[0], regexSafe(value));
        this.regexpUnescape.lastIndex = 0;
        replaces++;

        if (replaces >= this.maxReplaces) {
          break;
        }
      }

      replaces = 0; // regular escape on demand

      while (match = this.regexp.exec(str)) {
        value = handleFormat(match[1].trim());

        if (value === undefined) {
          if (typeof missingInterpolationHandler === 'function') {
            var _temp = missingInterpolationHandler(str, match, options);

            value = typeof _temp === 'string' ? _temp : '';
          } else {
            this.logger.warn("missed to pass in variable ".concat(match[1], " for interpolating ").concat(str));
            value = '';
          }
        } else if (typeof value !== 'string' && !this.useRawValueToEscape) {
          value = makeString(value);
        }

        value = this.escapeValue ? regexSafe(this.escape(value)) : regexSafe(value);
        str = str.replace(match[0], value);
        this.regexp.lastIndex = 0;
        replaces++;

        if (replaces >= this.maxReplaces) {
          break;
        }
      }

      return str;
    }
  }, {
    key: "nest",
    value: function nest(str, fc) {
      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      var match;
      var value;

      var clonedOptions = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, options);

      clonedOptions.applyPostProcessor = false; // avoid post processing on nested lookup

      delete clonedOptions.defaultValue; // assert we do not get a endless loop on interpolating defaultValue again and again
      // if value is something like "myKey": "lorem $(anotherKey, { "count": {{aValueInOptions}} })"

      function handleHasOptions(key, inheritedOptions) {
        var sep = this.nestingOptionsSeparator;
        if (key.indexOf(sep) < 0) return key;
        var c = key.split(new RegExp("".concat(sep, "[ ]*{")));
        var optionsString = "{".concat(c[1]);
        key = c[0];
        optionsString = this.interpolate(optionsString, clonedOptions);
        optionsString = optionsString.replace(/'/g, '"');

        try {
          clonedOptions = JSON.parse(optionsString);
          if (inheritedOptions) clonedOptions = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, inheritedOptions, clonedOptions);
        } catch (e) {
          this.logger.warn("failed parsing options string in nesting for key ".concat(key), e);
          return "".concat(key).concat(sep).concat(optionsString);
        } // assert we do not get a endless loop on interpolating defaultValue again and again


        delete clonedOptions.defaultValue;
        return key;
      } // regular escape on demand


      while (match = this.nestingRegexp.exec(str)) {
        value = fc(handleHasOptions.call(this, match[1].trim(), clonedOptions), clonedOptions); // is only the nesting key (key1 = '$(key2)') return the value without stringify

        if (value && match[0] === str && typeof value !== 'string') return value; // no string to include or empty

        if (typeof value !== 'string') value = makeString(value);

        if (!value) {
          this.logger.warn("missed to resolve ".concat(match[1], " for nesting ").concat(str));
          value = '';
        } // Nested keys should not be escaped by default #854
        // value = this.escapeValue ? regexSafe(utils.escape(value)) : regexSafe(value);


        str = str.replace(match[0], value);
        this.regexp.lastIndex = 0;
      }

      return str;
    }
  }]);

  return Interpolator;
}();

function remove(arr, what) {
  var found = arr.indexOf(what);

  while (found !== -1) {
    arr.splice(found, 1);
    found = arr.indexOf(what);
  }
}

var Connector =
/*#__PURE__*/
function (_EventEmitter) {
  Object(_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_7__["default"])(Connector, _EventEmitter);

  function Connector(backend, store, services) {
    var _this;

    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, Connector);

    _this = Object(_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__["default"])(this, Object(_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__["default"])(Connector).call(this));
    EventEmitter.call(Object(_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__["default"])(_this)); // <=IE10 fix (unable to call parent constructor)

    _this.backend = backend;
    _this.store = store;
    _this.services = services;
    _this.languageUtils = services.languageUtils;
    _this.options = options;
    _this.logger = baseLogger.create('backendConnector');
    _this.state = {};
    _this.queue = [];

    if (_this.backend && _this.backend.init) {
      _this.backend.init(services, options.backend, options);
    }

    return _this;
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(Connector, [{
    key: "queueLoad",
    value: function queueLoad(languages, namespaces, options, callback) {
      var _this2 = this;

      // find what needs to be loaded
      var toLoad = [];
      var pending = [];
      var toLoadLanguages = [];
      var toLoadNamespaces = [];
      languages.forEach(function (lng) {
        var hasAllNamespaces = true;
        namespaces.forEach(function (ns) {
          var name = "".concat(lng, "|").concat(ns);

          if (!options.reload && _this2.store.hasResourceBundle(lng, ns)) {
            _this2.state[name] = 2; // loaded
          } else if (_this2.state[name] < 0) ; else if (_this2.state[name] === 1) {
            if (pending.indexOf(name) < 0) pending.push(name);
          } else {
            _this2.state[name] = 1; // pending

            hasAllNamespaces = false;
            if (pending.indexOf(name) < 0) pending.push(name);
            if (toLoad.indexOf(name) < 0) toLoad.push(name);
            if (toLoadNamespaces.indexOf(ns) < 0) toLoadNamespaces.push(ns);
          }
        });
        if (!hasAllNamespaces) toLoadLanguages.push(lng);
      });

      if (toLoad.length || pending.length) {
        this.queue.push({
          pending: pending,
          loaded: {},
          errors: [],
          callback: callback
        });
      }

      return {
        toLoad: toLoad,
        pending: pending,
        toLoadLanguages: toLoadLanguages,
        toLoadNamespaces: toLoadNamespaces
      };
    }
  }, {
    key: "loaded",
    value: function loaded(name, err, data) {
      var _name$split = name.split('|'),
          _name$split2 = Object(_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_9__["default"])(_name$split, 2),
          lng = _name$split2[0],
          ns = _name$split2[1];

      if (err) this.emit('failedLoading', lng, ns, err);

      if (data) {
        this.store.addResourceBundle(lng, ns, data);
      } // set loaded


      this.state[name] = err ? -1 : 2; // consolidated loading done in this run - only emit once for a loaded namespace

      var loaded = {}; // callback if ready

      this.queue.forEach(function (q) {
        pushPath(q.loaded, [lng], ns);
        remove(q.pending, name);
        if (err) q.errors.push(err);

        if (q.pending.length === 0 && !q.done) {
          // only do once per loaded -> this.emit('loaded', q.loaded);
          Object.keys(q.loaded).forEach(function (l) {
            if (!loaded[l]) loaded[l] = [];

            if (q.loaded[l].length) {
              q.loaded[l].forEach(function (ns) {
                if (loaded[l].indexOf(ns) < 0) loaded[l].push(ns);
              });
            }
          });
          /* eslint no-param-reassign: 0 */

          q.done = true;

          if (q.errors.length) {
            q.callback(q.errors);
          } else {
            q.callback();
          }
        }
      }); // emit consolidated loaded event

      this.emit('loaded', loaded); // remove done load requests

      this.queue = this.queue.filter(function (q) {
        return !q.done;
      });
    }
  }, {
    key: "read",
    value: function read(lng, ns, fcName) {
      var _this3 = this;

      var tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
      var wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 350;
      var callback = arguments.length > 5 ? arguments[5] : undefined;
      if (!lng.length) return callback(null, {}); // noting to load

      return this.backend[fcName](lng, ns, function (err, data) {
        if (err && data
        /* = retryFlag */
        && tried < 5) {
          setTimeout(function () {
            _this3.read.call(_this3, lng, ns, fcName, tried + 1, wait * 2, callback);
          }, wait);
          return;
        }

        callback(err, data);
      });
    }
    /* eslint consistent-return: 0 */

  }, {
    key: "prepareLoading",
    value: function prepareLoading(languages, namespaces) {
      var _this4 = this;

      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      var callback = arguments.length > 3 ? arguments[3] : undefined;

      if (!this.backend) {
        this.logger.warn('No backend was added via i18next.use. Will not load resources.');
        return callback && callback();
      }

      if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);
      if (typeof namespaces === 'string') namespaces = [namespaces];
      var toLoad = this.queueLoad(languages, namespaces, options, callback);

      if (!toLoad.toLoad.length) {
        if (!toLoad.pending.length) callback(); // nothing to load and no pendings...callback now

        return null; // pendings will trigger callback
      }

      toLoad.toLoad.forEach(function (name) {
        _this4.loadOne(name);
      });
    }
  }, {
    key: "load",
    value: function load(languages, namespaces, callback) {
      this.prepareLoading(languages, namespaces, {}, callback);
    }
  }, {
    key: "reload",
    value: function reload(languages, namespaces, callback) {
      this.prepareLoading(languages, namespaces, {
        reload: true
      }, callback);
    }
  }, {
    key: "loadOne",
    value: function loadOne(name) {
      var _this5 = this;

      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

      var _name$split3 = name.split('|'),
          _name$split4 = Object(_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_9__["default"])(_name$split3, 2),
          lng = _name$split4[0],
          ns = _name$split4[1];

      this.read(lng, ns, 'read', undefined, undefined, function (err, data) {
        if (err) _this5.logger.warn("".concat(prefix, "loading namespace ").concat(ns, " for language ").concat(lng, " failed"), err);
        if (!err && data) _this5.logger.log("".concat(prefix, "loaded namespace ").concat(ns, " for language ").concat(lng), data);

        _this5.loaded(name, err, data);
      });
    }
  }, {
    key: "saveMissing",
    value: function saveMissing(languages, namespace, key, fallbackValue, isUpdate) {
      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};

      if (this.services.utils && this.services.utils.hasLoadedNamespace && !this.services.utils.hasLoadedNamespace(namespace)) {
        this.logger.warn("did not save key \"".concat(key, "\" for namespace \"").concat(namespace, "\" as the namespace was not yet loaded"), 'This means something IS WRONG in your application setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');
        return;
      } // ignore non valid keys


      if (key === undefined || key === null || key === '') return;

      if (this.backend && this.backend.create) {
        this.backend.create(languages, namespace, key, fallbackValue, null
        /* unused callback */
        , Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, options, {
          isUpdate: isUpdate
        }));
      } // write to store to avoid resending


      if (!languages || !languages[0]) return;
      this.store.addResource(languages[0], namespace, key, fallbackValue);
    }
  }]);

  return Connector;
}(EventEmitter);

function get() {
  return {
    debug: false,
    initImmediate: true,
    ns: ['translation'],
    defaultNS: ['translation'],
    fallbackLng: ['dev'],
    fallbackNS: false,
    // string or array of namespaces
    whitelist: false,
    // array with whitelisted languages
    nonExplicitWhitelist: false,
    load: 'all',
    // | currentOnly | languageOnly
    preload: false,
    // array with preload languages
    simplifyPluralSuffix: true,
    keySeparator: '.',
    nsSeparator: ':',
    pluralSeparator: '_',
    contextSeparator: '_',
    partialBundledLanguages: false,
    // allow bundling certain languages that are not remotely fetched
    saveMissing: false,
    // enable to send missing values
    updateMissing: false,
    // enable to update default values if different from translated value (only useful on initial development, or when keeping code as source of truth)
    saveMissingTo: 'fallback',
    // 'current' || 'all'
    saveMissingPlurals: true,
    // will save all forms not only singular key
    missingKeyHandler: false,
    // function(lng, ns, key, fallbackValue) -> override if prefer on handling
    missingInterpolationHandler: false,
    // function(str, match)
    postProcess: false,
    // string or array of postProcessor names
    postProcessPassResolved: false,
    // pass resolved object into 'options.i18nResolved' for postprocessor
    returnNull: true,
    // allows null value as valid translation
    returnEmptyString: true,
    // allows empty string value as valid translation
    returnObjects: false,
    joinArrays: false,
    // or string to join array
    returnedObjectHandler: false,
    // function(key, value, options) triggered if key returns object but returnObjects is set to false
    parseMissingKeyHandler: false,
    // function(key) parsed a key that was not found in t() before returning
    appendNamespaceToMissingKey: false,
    appendNamespaceToCIMode: false,
    overloadTranslationOptionHandler: function handle(args) {
      var ret = {};
      if (Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["default"])(args[1]) === 'object') ret = args[1];
      if (typeof args[1] === 'string') ret.defaultValue = args[1];
      if (typeof args[2] === 'string') ret.tDescription = args[2];

      if (Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["default"])(args[2]) === 'object' || Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["default"])(args[3]) === 'object') {
        var options = args[3] || args[2];
        Object.keys(options).forEach(function (key) {
          ret[key] = options[key];
        });
      }

      return ret;
    },
    interpolation: {
      escapeValue: true,
      format: function format(value, _format, lng, options) {
        return value;
      },
      prefix: '{{',
      suffix: '}}',
      formatSeparator: ',',
      // prefixEscaped: '{{',
      // suffixEscaped: '}}',
      // unescapeSuffix: '',
      unescapePrefix: '-',
      nestingPrefix: '$t(',
      nestingSuffix: ')',
      nestingOptionsSeparator: ',',
      // nestingPrefixEscaped: '$t(',
      // nestingSuffixEscaped: ')',
      // defaultVariables: undefined // object that can have values to interpolate on - extends passed in interpolation data
      maxReplaces: 1000 // max replaces to prevent endless loop

    }
  };
}
/* eslint no-param-reassign: 0 */

function transformOptions(options) {
  // create namespace object if namespace is passed in as string
  if (typeof options.ns === 'string') options.ns = [options.ns];
  if (typeof options.fallbackLng === 'string') options.fallbackLng = [options.fallbackLng];
  if (typeof options.fallbackNS === 'string') options.fallbackNS = [options.fallbackNS]; // extend whitelist with cimode

  if (options.whitelist && options.whitelist.indexOf('cimode') < 0) {
    options.whitelist = options.whitelist.concat(['cimode']);
  }

  return options;
}

function noop() {}

var I18n =
/*#__PURE__*/
function (_EventEmitter) {
  Object(_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_7__["default"])(I18n, _EventEmitter);

  function I18n() {
    var _this;

    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var callback = arguments.length > 1 ? arguments[1] : undefined;

    Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__["default"])(this, I18n);

    _this = Object(_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__["default"])(this, Object(_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__["default"])(I18n).call(this));
    EventEmitter.call(Object(_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__["default"])(_this)); // <=IE10 fix (unable to call parent constructor)

    _this.options = transformOptions(options);
    _this.services = {};
    _this.logger = baseLogger;
    _this.modules = {
      external: []
    };

    if (callback && !_this.isInitialized && !options.isClone) {
      // https://github.com/i18next/i18next/issues/879
      if (!_this.options.initImmediate) {
        _this.init(options, callback);

        return Object(_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__["default"])(_this, Object(_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__["default"])(_this));
      }

      setTimeout(function () {
        _this.init(options, callback);
      }, 0);
    }

    return _this;
  }

  Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__["default"])(I18n, [{
    key: "init",
    value: function init() {
      var _this2 = this;

      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var callback = arguments.length > 1 ? arguments[1] : undefined;

      if (typeof options === 'function') {
        callback = options;
        options = {};
      }

      this.options = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, get(), this.options, transformOptions(options));
      this.format = this.options.interpolation.format;
      if (!callback) callback = noop;

      function createClassOnDemand(ClassOrObject) {
        if (!ClassOrObject) return null;
        if (typeof ClassOrObject === 'function') return new ClassOrObject();
        return ClassOrObject;
      } // init services


      if (!this.options.isClone) {
        if (this.modules.logger) {
          baseLogger.init(createClassOnDemand(this.modules.logger), this.options);
        } else {
          baseLogger.init(null, this.options);
        }

        var lu = new LanguageUtil(this.options);
        this.store = new ResourceStore(this.options.resources, this.options);
        var s = this.services;
        s.logger = baseLogger;
        s.resourceStore = this.store;
        s.languageUtils = lu;
        s.pluralResolver = new PluralResolver(lu, {
          prepend: this.options.pluralSeparator,
          compatibilityJSON: this.options.compatibilityJSON,
          simplifyPluralSuffix: this.options.simplifyPluralSuffix
        });
        s.interpolator = new Interpolator(this.options);
        s.utils = {
          hasLoadedNamespace: this.hasLoadedNamespace.bind(this)
        };
        s.backendConnector = new Connector(createClassOnDemand(this.modules.backend), s.resourceStore, s, this.options); // pipe events from backendConnector

        s.backendConnector.on('*', function (event) {
          for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            args[_key - 1] = arguments[_key];
          }

          _this2.emit.apply(_this2, [event].concat(args));
        });

        if (this.modules.languageDetector) {
          s.languageDetector = createClassOnDemand(this.modules.languageDetector);
          s.languageDetector.init(s, this.options.detection, this.options);
        }

        if (this.modules.i18nFormat) {
          s.i18nFormat = createClassOnDemand(this.modules.i18nFormat);
          if (s.i18nFormat.init) s.i18nFormat.init(this);
        }

        this.translator = new Translator(this.services, this.options); // pipe events from translator

        this.translator.on('*', function (event) {
          for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
            args[_key2 - 1] = arguments[_key2];
          }

          _this2.emit.apply(_this2, [event].concat(args));
        });
        this.modules.external.forEach(function (m) {
          if (m.init) m.init(_this2);
        });
      }

      if (!this.modules.languageDetector && !this.options.lng) {
        this.logger.warn('init: no languageDetector is used and no lng is defined');
      } // append api


      var storeApi = ['getResource', 'addResource', 'addResources', 'addResourceBundle', 'removeResourceBundle', 'hasResourceBundle', 'getResourceBundle', 'getDataByLanguage'];
      storeApi.forEach(function (fcName) {
        _this2[fcName] = function () {
          var _this2$store;

          return (_this2$store = _this2.store)[fcName].apply(_this2$store, arguments);
        };
      });
      var deferred = defer();

      var load = function load() {
        _this2.changeLanguage(_this2.options.lng, function (err, t) {
          _this2.isInitialized = true;

          _this2.logger.log('initialized', _this2.options);

          _this2.emit('initialized', _this2.options);

          deferred.resolve(t); // not rejecting on err (as err is only a loading translation failed warning)

          callback(err, t);
        });
      };

      if (this.options.resources || !this.options.initImmediate) {
        load();
      } else {
        setTimeout(load, 0);
      }

      return deferred;
    }
    /* eslint consistent-return: 0 */

  }, {
    key: "loadResources",
    value: function loadResources(language) {
      var _this3 = this;

      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;
      var usedCallback = callback;
      var usedLng = typeof language === 'string' ? language : this.language;
      if (typeof language === 'function') usedCallback = language;

      if (!this.options.resources || this.options.partialBundledLanguages) {
        if (usedLng && usedLng.toLowerCase() === 'cimode') return usedCallback(); // avoid loading resources for cimode

        var toLoad = [];

        var append = function append(lng) {
          if (!lng) return;

          var lngs = _this3.services.languageUtils.toResolveHierarchy(lng);

          lngs.forEach(function (l) {
            if (toLoad.indexOf(l) < 0) toLoad.push(l);
          });
        };

        if (!usedLng) {
          // at least load fallbacks in this case
          var fallbacks = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);
          fallbacks.forEach(function (l) {
            return append(l);
          });
        } else {
          append(usedLng);
        }

        if (this.options.preload) {
          this.options.preload.forEach(function (l) {
            return append(l);
          });
        }

        this.services.backendConnector.load(toLoad, this.options.ns, usedCallback);
      } else {
        usedCallback(null);
      }
    }
  }, {
    key: "reloadResources",
    value: function reloadResources(lngs, ns, callback) {
      var deferred = defer();
      if (!lngs) lngs = this.languages;
      if (!ns) ns = this.options.ns;
      if (!callback) callback = noop;
      this.services.backendConnector.reload(lngs, ns, function (err) {
        deferred.resolve(); // not rejecting on err (as err is only a loading translation failed warning)

        callback(err);
      });
      return deferred;
    }
  }, {
    key: "use",
    value: function use(module) {
      if (module.type === 'backend') {
        this.modules.backend = module;
      }

      if (module.type === 'logger' || module.log && module.warn && module.error) {
        this.modules.logger = module;
      }

      if (module.type === 'languageDetector') {
        this.modules.languageDetector = module;
      }

      if (module.type === 'i18nFormat') {
        this.modules.i18nFormat = module;
      }

      if (module.type === 'postProcessor') {
        postProcessor.addPostProcessor(module);
      }

      if (module.type === '3rdParty') {
        this.modules.external.push(module);
      }

      return this;
    }
  }, {
    key: "changeLanguage",
    value: function changeLanguage(lng, callback) {
      var _this4 = this;

      this.isLanguageChangingTo = lng;
      var deferred = defer();
      this.emit('languageChanging', lng);

      var done = function done(err, l) {
        if (l) {
          _this4.language = l;
          _this4.languages = _this4.services.languageUtils.toResolveHierarchy(l);

          _this4.translator.changeLanguage(l);

          _this4.isLanguageChangingTo = undefined;

          _this4.emit('languageChanged', l);

          _this4.logger.log('languageChanged', l);
        } else {
          _this4.isLanguageChangingTo = undefined;
        }

        deferred.resolve(function () {
          return _this4.t.apply(_this4, arguments);
        });
        if (callback) callback(err, function () {
          return _this4.t.apply(_this4, arguments);
        });
      };

      var setLng = function setLng(l) {
        if (l) {
          if (!_this4.language) {
            _this4.language = l;
            _this4.languages = _this4.services.languageUtils.toResolveHierarchy(l);
          }

          if (!_this4.translator.language) _this4.translator.changeLanguage(l);
          if (_this4.services.languageDetector) _this4.services.languageDetector.cacheUserLanguage(l);
        }

        _this4.loadResources(l, function (err) {
          done(err, l);
        });
      };

      if (!lng && this.services.languageDetector && !this.services.languageDetector.async) {
        setLng(this.services.languageDetector.detect());
      } else if (!lng && this.services.languageDetector && this.services.languageDetector.async) {
        this.services.languageDetector.detect(setLng);
      } else {
        setLng(lng);
      }

      return deferred;
    }
  }, {
    key: "getFixedT",
    value: function getFixedT(lng, ns) {
      var _this5 = this;

      var fixedT = function fixedT(key, opts) {
        var options;

        if (Object(_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["default"])(opts) !== 'object') {
          for (var _len3 = arguments.length, rest = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {
            rest[_key3 - 2] = arguments[_key3];
          }

          options = _this5.options.overloadTranslationOptionHandler([key, opts].concat(rest));
        } else {
          options = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, opts);
        }

        options.lng = options.lng || fixedT.lng;
        options.lngs = options.lngs || fixedT.lngs;
        options.ns = options.ns || fixedT.ns;
        return _this5.t(key, options);
      };

      if (typeof lng === 'string') {
        fixedT.lng = lng;
      } else {
        fixedT.lngs = lng;
      }

      fixedT.ns = ns;
      return fixedT;
    }
  }, {
    key: "t",
    value: function t() {
      var _this$translator;

      return this.translator && (_this$translator = this.translator).translate.apply(_this$translator, arguments);
    }
  }, {
    key: "exists",
    value: function exists() {
      var _this$translator2;

      return this.translator && (_this$translator2 = this.translator).exists.apply(_this$translator2, arguments);
    }
  }, {
    key: "setDefaultNamespace",
    value: function setDefaultNamespace(ns) {
      this.options.defaultNS = ns;
    }
  }, {
    key: "hasLoadedNamespace",
    value: function hasLoadedNamespace(ns) {
      var _this6 = this;

      if (!this.isInitialized) {
        this.logger.warn('hasLoadedNamespace: i18next was not initialized', this.languages);
        return false;
      }

      if (!this.languages || !this.languages.length) {
        this.logger.warn('hasLoadedNamespace: i18n.languages were undefined or empty', this.languages);
        return false;
      }

      var lng = this.languages[0];
      var fallbackLng = this.options ? this.options.fallbackLng : false;
      var lastLng = this.languages[this.languages.length - 1]; // we're in cimode so this shall pass

      if (lng.toLowerCase() === 'cimode') return true;

      var loadNotPending = function loadNotPending(l, n) {
        var loadState = _this6.services.backendConnector.state["".concat(l, "|").concat(n)];

        return loadState === -1 || loadState === 2;
      }; // loaded -> SUCCESS


      if (this.hasResourceBundle(lng, ns)) return true; // were not loading at all -> SEMI SUCCESS

      if (!this.services.backendConnector.backend) return true; // failed loading ns - but at least fallback is not pending -> SEMI SUCCESS

      if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;
      return false;
    }
  }, {
    key: "loadNamespaces",
    value: function loadNamespaces(ns, callback) {
      var _this7 = this;

      var deferred = defer();

      if (!this.options.ns) {
        callback && callback();
        return Promise.resolve();
      }

      if (typeof ns === 'string') ns = [ns];
      ns.forEach(function (n) {
        if (_this7.options.ns.indexOf(n) < 0) _this7.options.ns.push(n);
      });
      this.loadResources(function (err) {
        deferred.resolve();
        if (callback) callback(err);
      });
      return deferred;
    }
  }, {
    key: "loadLanguages",
    value: function loadLanguages(lngs, callback) {
      var deferred = defer();
      if (typeof lngs === 'string') lngs = [lngs];
      var preloaded = this.options.preload || [];
      var newLngs = lngs.filter(function (lng) {
        return preloaded.indexOf(lng) < 0;
      }); // Exit early if all given languages are already preloaded

      if (!newLngs.length) {
        if (callback) callback();
        return Promise.resolve();
      }

      this.options.preload = preloaded.concat(newLngs);
      this.loadResources(function (err) {
        deferred.resolve();
        if (callback) callback(err);
      });
      return deferred;
    }
  }, {
    key: "dir",
    value: function dir(lng) {
      if (!lng) lng = this.languages && this.languages.length > 0 ? this.languages[0] : this.language;
      if (!lng) return 'rtl';
      var rtlLngs = ['ar', 'shu', 'sqr', 'ssh', 'xaa', 'yhd', 'yud', 'aao', 'abh', 'abv', 'acm', 'acq', 'acw', 'acx', 'acy', 'adf', 'ads', 'aeb', 'aec', 'afb', 'ajp', 'apc', 'apd', 'arb', 'arq', 'ars', 'ary', 'arz', 'auz', 'avl', 'ayh', 'ayl', 'ayn', 'ayp', 'bbz', 'pga', 'he', 'iw', 'ps', 'pbt', 'pbu', 'pst', 'prp', 'prd', 'ur', 'ydd', 'yds', 'yih', 'ji', 'yi', 'hbo', 'men', 'xmn', 'fa', 'jpr', 'peo', 'pes', 'prs', 'dv', 'sam'];
      return rtlLngs.indexOf(this.services.languageUtils.getLanguagePartFromCode(lng)) >= 0 ? 'rtl' : 'ltr';
    }
    /* eslint class-methods-use-this: 0 */

  }, {
    key: "createInstance",
    value: function createInstance() {
      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var callback = arguments.length > 1 ? arguments[1] : undefined;
      return new I18n(options, callback);
    }
  }, {
    key: "cloneInstance",
    value: function cloneInstance() {
      var _this8 = this;

      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;

      var mergedOptions = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, this.options, options, {
        isClone: true
      });

      var clone = new I18n(mergedOptions);
      var membersToCopy = ['store', 'services', 'language'];
      membersToCopy.forEach(function (m) {
        clone[m] = _this8[m];
      });
      clone.services = Object(_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__["default"])({}, this.services);
      clone.services.utils = {
        hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)
      };
      clone.translator = new Translator(clone.services, clone.options);
      clone.translator.on('*', function (event) {
        for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
          args[_key4 - 1] = arguments[_key4];
        }

        clone.emit.apply(clone, [event].concat(args));
      });
      clone.init(mergedOptions, callback);
      clone.translator.options = clone.options; // sync options

      clone.translator.backendConnector.services.utils = {
        hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)
      };
      return clone;
    }
  }]);

  return I18n;
}(EventEmitter);

var i18next = new I18n();

/* harmony default export */ __webpack_exports__["default"] = (i18next);


/***/ }),

/***/ "./node_modules/loc-i18next/dist/commonjs/main.js":
/*!********************************************************!*\
  !*** ./node_modules/loc-i18next/dist/commonjs/main.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var defaults = {
    selectorAttr: 'data-i18n',
    targetAttr: 'i18n-target',
    optionsAttr: 'i18n-options',
    useOptionsAttr: false,
    parseDefaultValueFromContent: true,
    document: document
};

function init(i18next) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    options = _extends({}, defaults, options);
    var extendDefault = function extendDefault(o, val) {
        return options.parseDefaultValueFromContent ? _extends({}, o, { defaultValue: val }) : o;
    };
    function parse(elem, key, opts) {
        var attr = 'text';

        if (key.indexOf('[') == 0) {
            var parts = key.split(']');
            key = parts[1];
            attr = parts[0].substr(1, parts[0].length - 1);
        }

        key = key.indexOf(';') == key.length - 1 ? key.substr(0, key.length - 2) : key;

        if (attr === 'html') {
            elem.innerHTML = i18next.t(key, extendDefault(opts, elem.innerHTML));
        } else if (attr === 'text') {
            elem.textContent = i18next.t(key, extendDefault(opts, elem.textContent));
        } else if (attr === 'prepend') {
            var startIdx = elem.innerHTML.indexOf('<loc-i18n>');
            var endIdx = elem.innerHTML.indexOf('</loc-i18n>') + 11;
            if (startIdx > -1 && endIdx > 6) {
                elem.innerHTML = [elem.innerHTML.substring(0, startIdx), elem.innerHTML.slice(endIdx)].join('');
            }
            elem.innerHTML = ['<loc-i18n>', i18next.t(key, extendDefault(opts, elem.innerHTML)), '</loc-i18n>', elem.innerHTML].join('');
        } else if (attr === 'append') {
            var _startIdx = elem.innerHTML.indexOf('<loc-i18n>');
            var _endIdx = elem.innerHTML.indexOf('</loc-i18n>') + 11;
            if (_startIdx > -1 && _endIdx > 6) {
                elem.innerHTML = [elem.innerHTML.substring(0, _startIdx), elem.innerHTML.slice(_endIdx)].join('');
            }
            elem.innerHTML = [elem.innerHTML, '<loc-i18n>', i18next.t(key, extendDefault(opts, elem.innerHTML), '</loc-i18n>')].join('');
        } else if (attr.indexOf('data-') === 0) {
            var dataAttr = attr.substr('data-'.length);
            var translated = i18next.t(key, extendDefault(opts, elem.getAttribute(dataAttr)));
            // we change into the data cache
            elem.setAttribute(dataAttr, translated);
            // we change into the dom
            elem.setAttribute(attr, translated);
        } else {
            elem.setAttribute(attr, i18next.t(key, extendDefault(opts, elem.getAttribute(attr))));
        }
    };

    function relaxedJsonParse(badJSON) {
        return JSON.parse(badJSON.replace(/:\s*"([^"]*)"/g, function (match, p1) {
            return ': "' + p1.replace(/:/g, '@colon@') + '"';
        }).replace(/:\s*'([^']*)'/g, function (match, p1) {
            return ': "' + p1.replace(/:/g, '@colon@') + '"';
        }).replace(/(['"])?([a-z0-9A-Z_]+)(['"])?\s*:/g, '"$2": ').replace(/@colon@/g, ':'));
    }

    function _loc(elem, opts) {
        var key = elem.getAttribute(options.selectorAttr);
        //        if (!key && typeof key !== 'undefined' && key !== false)
        //            key = elem.textContent || elem.innerHTML;
        if (!key) return;

        var target = elem,
            targetSelector = elem.getAttribute(options.targetAttr);

        if (targetSelector != null) target = elem.querySelector(targetSelector) || elem;

        if (!opts && options.useOptionsAttr === true) opts = relaxedJsonParse(elem.getAttribute(options.optionsAttr) || '{}');

        opts = opts || {};

        if (key.indexOf(';') >= 0) {
            var keys = key.split(';');
            for (var ix = 0, l_ix = keys.length; ix < l_ix; ix++) {
                if (keys[ix] != '') parse(target, keys[ix], opts);
            }
        } else {
            parse(target, key, opts);
        }

        if (options.useOptionsAttr === true) {
            var clone = {};
            clone = _extends({ clone: clone }, opts);
            delete clone.lng;
            elem.setAttribute(options.optionsAttr, JSON.stringify(clone));
        }
    }

    function handle(selector, opts) {
        var elems = options.document.querySelectorAll(selector);
        for (var i = 0; i < elems.length; i++) {
            var elem = elems[i];
            var childs = elem.querySelectorAll('[' + options.selectorAttr + ']');
            for (var j = childs.length - 1; j > -1; j--) {
                _loc(childs[j], opts);
            }
            _loc(elem, opts);
        }
    };
    return handle;
}

exports.default = {
    init: init
};

/***/ }),

/***/ "./node_modules/loc-i18next/index.js":
/*!*******************************************!*\
  !*** ./node_modules/loc-i18next/index.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! ./dist/commonjs/main.js */ "./node_modules/loc-i18next/dist/commonjs/main.js").default;


/***/ }),

/***/ "./node_modules/shake.js/shake.js":
/*!****************************************!*\
  !*** ./node_modules/shake.js/shake.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_RESULT__;/*
 * Author: Alex Gibson
 * https://github.com/alexgibson/shake.js
 * License: MIT license
 */

(function(global, factory) {
    if (true) {
        !(__WEBPACK_AMD_DEFINE_RESULT__ = (function() {
            return factory(global, global.document);
        }).call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
    } else {}
} (typeof window !== 'undefined' ? window : this, function (window, document) {

    'use strict';

    function Shake(options) {
        //feature detect
        this.hasDeviceMotion = 'ondevicemotion' in window;

        this.options = {
            threshold: 15, //default velocity threshold for shake to register
            timeout: 1000 //default interval between events
        };

        if (typeof options === 'object') {
            for (var i in options) {
                if (options.hasOwnProperty(i)) {
                    this.options[i] = options[i];
                }
            }
        }

        //use date to prevent multiple shakes firing
        this.lastTime = new Date();

        //accelerometer values
        this.lastX = null;
        this.lastY = null;
        this.lastZ = null;

        //create custom event
        if (typeof document.CustomEvent === 'function') {
            this.event = new document.CustomEvent('shake', {
                bubbles: true,
                cancelable: true
            });
        } else if (typeof document.createEvent === 'function') {
            this.event = document.createEvent('Event');
            this.event.initEvent('shake', true, true);
        } else {
            return false;
        }
    }

    //reset timer values
    Shake.prototype.reset = function () {
        this.lastTime = new Date();
        this.lastX = null;
        this.lastY = null;
        this.lastZ = null;
    };

    //start listening for devicemotion
    Shake.prototype.start = function () {
        this.reset();
        if (this.hasDeviceMotion) {
            window.addEventListener('devicemotion', this, false);
        }
    };

    //stop listening for devicemotion
    Shake.prototype.stop = function () {
        if (this.hasDeviceMotion) {
            window.removeEventListener('devicemotion', this, false);
        }
        this.reset();
    };

    //calculates if shake did occur
    Shake.prototype.devicemotion = function (e) {
        var current = e.accelerationIncludingGravity;
        var currentTime;
        var timeDifference;
        var deltaX = 0;
        var deltaY = 0;
        var deltaZ = 0;

        if ((this.lastX === null) && (this.lastY === null) && (this.lastZ === null)) {
            this.lastX = current.x;
            this.lastY = current.y;
            this.lastZ = current.z;
            return;
        }

        deltaX = Math.abs(this.lastX - current.x);
        deltaY = Math.abs(this.lastY - current.y);
        deltaZ = Math.abs(this.lastZ - current.z);

        if (((deltaX > this.options.threshold) && (deltaY > this.options.threshold)) || ((deltaX > this.options.threshold) && (deltaZ > this.options.threshold)) || ((deltaY > this.options.threshold) && (deltaZ > this.options.threshold))) {
            //calculate time in milliseconds since last shake registered
            currentTime = new Date();
            timeDifference = currentTime.getTime() - this.lastTime.getTime();

            if (timeDifference > this.options.timeout) {
                window.dispatchEvent(this.event);
                this.lastTime = new Date();
            }
        }

        this.lastX = current.x;
        this.lastY = current.y;
        this.lastZ = current.z;

    };

    //event handler
    Shake.prototype.handleEvent = function (e) {
        if (typeof (this[e.type]) === 'function') {
            return this[e.type](e);
        }
    };

    return Shake;
}));


/***/ }),

/***/ "./src/bootstrap/bootstrap.ts":
/*!************************************!*\
  !*** ./src/bootstrap/bootstrap.ts ***!
  \************************************/
/*! exports provided: BootstrapInPage */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BootstrapInPage", function() { return BootstrapInPage; });
/* harmony import */ var _commands_command_layout__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../commands/command/layout */ "./src/commands/command/layout.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../interfaces/window-in-page */ "./src/interfaces/window-in-page.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../plumbing */ "./src/plumbing/index.ts");
/* harmony import */ var _quick_dialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../quick-dialog */ "./src/quick-dialog/index.ts");
/* harmony import */ var _quick_dialog_state__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../quick-dialog/state */ "./src/quick-dialog/state.ts");
/* harmony import */ var _toolbar_tag_toolbars_tag_toolbar_manager__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../toolbar/tag-toolbars/tag-toolbar-manager */ "./src/toolbar/tag-toolbars/tag-toolbar-manager.ts");
/* harmony import */ var _toolbar_toolbar_manager__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../toolbar/toolbar-manager */ "./src/toolbar/toolbar-manager.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();










/**
 * This contains everything necessary to bootstrap the edit mode.
 * It must be initialized and started at the end in the x-bootstrap code,
 * to ensure everything is already ready and loaded
 */
var BootstrapInPage = /** @class */ (function (_super) {
    __extends(BootstrapInPage, _super);
    function BootstrapInPage() {
        var _this = _super.call(this, 'Sys.Bootst', null, 'Building Bootstrapper') || this;
        _this.initializedInstances = [];
        _this.openedTemplatePickerOnce = false;
        _this.diagCancelStateOnStart = _quick_dialog_state__WEBPACK_IMPORTED_MODULE_7__["cancelled"].get();
        _logging__WEBPACK_IMPORTED_MODULE_4__["Insights"].add('system', 'bootstrap', _this.log);
        return _this;
    }
    BootstrapInPage.prototype.initialize = function () {
        var callLog = this.log.call('initialize');
        // reset cancelled state after one reload
        if (this.diagCancelStateOnStart)
            _quick_dialog_state__WEBPACK_IMPORTED_MODULE_7__["cancelled"].remove();
        // initialize all modules
        this.initAllInstances(true);
        // start observing the body for configured mutations
        this.watchDomChanges();
        callLog.return('done');
    };
    /**
     * Scan all instances and initialize them
     * @param isFirstRun should be true only on the very initial call
     */
    BootstrapInPage.prototype.initAllInstances = function (isFirstRun) {
        var _this = this;
        var callLog = this.log.call('initAllInstances');
        document.querySelectorAll(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].Sel.SxcDivs).forEach(function (e) {
            _this.initInstance(e, isFirstRun);
        });
        if (isFirstRun)
            this.tryShowTemplatePicker();
        callLog.return('initAllInstances done');
    };
    /**
     * create an observer instance and start observing
     */
    BootstrapInPage.prototype.watchDomChanges = function () {
        var _this = this;
        var callLog = this.log.call('watchDomChanges');
        var observer = new MutationObserver(function (m) {
            // Watch statistics how changes were processed
            _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_3__["windowInPage"].$2sxc.stats.watchDomChanges++;
            var processed = 0;
            // Loop through each changed item, check if it's something we want to initialize
            m.forEach(function (v) {
                v.addedNodes.forEach(function (n) {
                    // remove #comment and text nodes
                    if (n.matches == null)
                        return;
                    var node = n;
                    // Menus which appear also cause DOM changes, but we want to ignore these for performance reasons
                    if (node.matches(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].IDs.cls.scMenu))
                        return;
                    processed++;
                    // If the added node is a [data-edit-context], it is either a module or a content block which was replaced
                    // re-initialize the module
                    if (node.matches(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].Sel.SxcDivs)) {
                        _this.initInstance(node, false);
                        // in case it has inner content, try to open the picker-dialog
                        if (!_quick_dialog__WEBPACK_IMPORTED_MODULE_6__["QuickDialog"].singleton().isVisible())
                            _this.tryShowTemplatePicker();
                    }
                    // If the added node contains [data-edit-context] nodes, it is likely the DNN module drag manager which added
                    // the node. To prevent multiple initialization while dragging modules, we additionally check for the
                    // .active-module class which seems to be applied while dragging the module.
                    else if (node.matches(':not(.active-module)') && node.querySelectorAll(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].Sel.SxcDivs).length > 0) {
                        node.querySelectorAll(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].Sel.SxcDivs).forEach(function (e) {
                            _this.initInstance(e, false);
                        });
                    }
                    else
                        _toolbar_toolbar_manager__WEBPACK_IMPORTED_MODULE_9__["ToolbarManager"].singleton().build(node);
                });
            });
            // Clean up orphan tags if nodes have been added
            if (processed)
                _toolbar_tag_toolbars_tag_toolbar_manager__WEBPACK_IMPORTED_MODULE_8__["TagToolbarManager"].CleanupOrphanedToolbars();
        });
        observer.observe(document.body, {
            attributes: false,
            childList: true,
            subtree: true,
        });
        callLog.return('watchDomChanges done');
    };
    /**
     * Show the template picker if
     * - template picker has not yet been opened
     * - dialog has not been cancelled
     * - only one uninitialized module on page
     * @returns
     */
    BootstrapInPage.prototype.tryShowTemplatePicker = function () {
        var _a;
        var cl = this.log.call('tryShowTemplatePicker');
        var sxc;
        // first check if we should show one according to the state-settings
        var openDialogId = _quick_dialog_state__WEBPACK_IMPORTED_MODULE_7__["cbId"].get();
        if (openDialogId) {
            // must check if it's on this page, as it could be from another page
            var found = document.querySelectorAll("[" + _constants__WEBPACK_IMPORTED_MODULE_1__["C"].AttrNames.ContentBlockId + "=\"" + openDialogId + "\"]");
            if (found.length) {
                // since the CB-ID could also be an inner content (marked as a negative "-" number)
                // we must be sure that we use the right id a.nyhow
                if (openDialogId < 0) {
                    var instanceId = Number(found[0].attributes.getNamedItem(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].AttrNames.InstanceId).value);
                    sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_2__["SxcEdit"].get(instanceId, openDialogId);
                }
                else
                    sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_2__["SxcEdit"].get(openDialogId);
            }
        }
        if (!sxc) {
            var uninitializedModules = document.querySelectorAll("." + _constants__WEBPACK_IMPORTED_MODULE_1__["C"].ClsNames.UnInitialized);
            if (this.diagCancelStateOnStart || this.openedTemplatePickerOnce)
                return cl.return(false, 'cancelled');
            // already showing a dialog
            if (_quick_dialog__WEBPACK_IMPORTED_MODULE_6__["QuickDialog"].singleton().isVisible())
                return cl.return(false, 'should be invisible');
            // not exactly one uninitialized module
            if (uninitializedModules.length !== 1)
                return cl.return(false, 'has un-init modules');
            // show the template picker of this module
            var module_1 = (_a = Array.from(uninitializedModules).find(function (e) { return e.parentElement.matches(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].Sel.SxcDivs); })) === null || _a === void 0 ? void 0 : _a.parentElement;
            sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_2__["SxcEdit"].get(module_1);
        }
        if (sxc) {
            sxc.manage.run(_commands_command_layout__WEBPACK_IMPORTED_MODULE_0__["CmdLayout"]);
            this.openedTemplatePickerOnce = true;
        }
        return cl.return(true, 'tryShowTemplatePicker() done');
    };
    BootstrapInPage.prototype.initInstance = function (module, isFirstRun) {
        var cl = this.log.call('initInstance', "module: obj, isFirstRun: " + isFirstRun + ") initialized: " + this.initializedInstances);
        // if instance is already in the list of initialized modules, skip
        // otherwise add for next time to prevent recursions
        if (this.initializedInstances.find(function (m) { return m === module; }))
            return;
        this.initializedInstances.push(module);
        var sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_2__["SxcEdit"].get(module);
        // check if the sxc must be re-created. This is necessary when modules are dynamically changed
        // because the configuration may change, and that is cached otherwise, resulting in toolbars with wrong config
        if (!isFirstRun)
            sxc = sxc.recreate(true);
        // check if we must show the glasses
        // this must always run because it can be added ajax-style
        var wasEmpty = this.showGlassesButtonIfUninitialized(sxc);
        if (isFirstRun || !wasEmpty) {
            // use a logger for each iteration
            var log = new _logging__WEBPACK_IMPORTED_MODULE_4__["Log"]('Bts.Module');
            _toolbar_toolbar_manager__WEBPACK_IMPORTED_MODULE_9__["ToolbarManager"].singleton().buildModule(module);
        }
        cl.done();
    };
    BootstrapInPage.prototype.showGlassesButtonIfUninitialized = function (sxci) {
        var callLog = this.log.call('showGlassesButtonIfUninitialized');
        // already initialized
        if (this.isInitialized(sxci))
            return callLog.return(false, 'is initialized');
        // already has a glasses button
        var tag = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_2__["SxcEdit"].getTag(sxci);
        if (tag.querySelectorAll("." + _constants__WEBPACK_IMPORTED_MODULE_1__["C"].ClsNames.UnInitialized).length !== 0)
            return callLog.return(false, 'already has button');
        // note: title is added on mouseover, as the translation isn't ready at page-load
        var btn = _plumbing__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].domFromString("<div class=\"" + _constants__WEBPACK_IMPORTED_MODULE_1__["C"].ClsNames.UnInitialized + "\" onmouseover=\"this.title = $2sxc.translate(this.title)\" title=\"InPage.NewElement\">" +
            '<div class="icon-sxc-glasses"></div>' +
            '</div>')[0];
        btn.addEventListener('click', function () { return sxci.manage.run(_commands_command_layout__WEBPACK_IMPORTED_MODULE_0__["CmdLayout"]); });
        tag.append(btn);
        return callLog.return(true, 'ok');
    };
    BootstrapInPage.prototype.isInitialized = function (sxci) {
        var cg = sxci &&
            sxci.manage &&
            sxci.manage._editContext &&
            sxci.manage._editContext.contentBlock;
        return cg && cg.TemplateId !== 0;
    };
    return BootstrapInPage;
}(_logging__WEBPACK_IMPORTED_MODULE_4__["HasLog"]));



/***/ }),

/***/ "./src/cms/Cms.ts":
/*!************************!*\
  !*** ./src/cms/Cms.ts ***!
  \************************/
/*! exports provided: Cms */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Cms", function() { return Cms; });
/* harmony import */ var _$2sxc_src__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../$2sxc/src */ "../$2sxc/src/index.ts");
/* harmony import */ var _commands___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../commands/ */ "./src/commands/index.ts");
/* harmony import */ var _commands_engine_run_params__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../commands/engine/run-params */ "./src/commands/engine/run-params.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../context/bundles/context-bundle-button */ "./src/context/bundles/context-bundle-button.ts");
/* harmony import */ var _context_bundles_context_bundle_instance__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../context/bundles/context-bundle-instance */ "./src/context/bundles/context-bundle-instance.ts");
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};








var logId = 'Cms.Api';
var Cms = /** @class */ (function (_super) {
    __extends(Cms, _super);
    function Cms() {
        var _this = _super.call(this, logId, null) || this;
        /**
         * if true (default) will reset the log everytime something is done
         * if false, will preserve the log over multiple calls
         */
        // autoReset = true;
        _this.autoDump = _constants__WEBPACK_IMPORTED_MODULE_3__["C"].Debug.cms.autoDump;
        return _this;
    }
    /**
     * reset / clear the log
     */
    Cms.prototype.resetLog = function () {
        this.log = new _logging__WEBPACK_IMPORTED_MODULE_7__["Log"](logId, null, 'log was reset');
        _logging__WEBPACK_IMPORTED_MODULE_7__["Insights"].add('cms', 'run', this.log);
    };
    Cms.prototype.run = function (context, nameOrSettings, eventOrSettings, event) {
        var cl = this.log.call('run<T>');
        var cmsEngine = new _commands___WEBPACK_IMPORTED_MODULE_1__["CmsEngine"](this.log);
        // Figure out inner-call based on if context is new RunParams or not (in that case it should be a tag or a full context)
        var innerCall;
        if (Object(_commands_engine_run_params__WEBPACK_IMPORTED_MODULE_2__["is$sxcRunParams"])(context)) {
            // V1 with Context
            var contextGiver = (Object(_$2sxc_src__WEBPACK_IMPORTED_MODULE_0__["isContextIdentifier"])(context.context) || _$2sxc_src__WEBPACK_IMPORTED_MODULE_0__["SxcInstance"].is(context.context))
                ? Object(_interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_6__["$2sxcInPage"])(context.context)
                : context.tag;
            var realCtx_1 = _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_4__["ContextComplete"].findContext(contextGiver);
            context.params = __assign({ action: context.action }, context.params);
            innerCall = function () { return cmsEngine.run(realCtx_1, context.params, context.event, context); };
        }
        else {
            var realCtx_2 = _context_bundles_context_bundle_instance__WEBPACK_IMPORTED_MODULE_5__["ContextBundleInstance"].is(context)
                ? context
                : _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_4__["ContextComplete"].findContext(context);
            innerCall = function () { return cmsEngine.detectParamsAndRun(realCtx_2, nameOrSettings, eventOrSettings, event); };
        }
        var result = this.do(innerCall);
        return cl.return(result, 'ok');
    };
    /**
     * reset/clear the log if alwaysResetLog is true
     */
    Cms.prototype.do = function (innerCall) {
        var cl = this.log.call('do');
        this.resetLog();
        var result = innerCall();
        if (this.autoDump)
            this.log.dump();
        return cl.return(result);
    };
    return Cms;
}(_logging__WEBPACK_IMPORTED_MODULE_7__["HasLog"]));



/***/ }),

/***/ "./src/commands/command-link-generator.ts":
/*!************************************************!*\
  !*** ./src/commands/command-link-generator.ts ***!
  \************************************************/
/*! exports provided: CommandLinkGenerator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CommandLinkGenerator", function() { return CommandLinkGenerator; });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../i18n */ "./src/i18n/index.ts");
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _manage_ng_dialog_params__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../manage/ng-dialog-params */ "./src/manage/ng-dialog-params.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../plumbing */ "./src/plumbing/index.ts");
/* harmony import */ var _toolbar_config__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../toolbar/config */ "./src/toolbar/config/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};







/**
 * This is responsible for taking a context with command and everything
 * then building the link for opening the correct dialogs
 */
var CommandLinkGenerator = /** @class */ (function (_super) {
    __extends(CommandLinkGenerator, _super);
    function CommandLinkGenerator(context, parentLog) {
        var _this = _super.call(this, 'Cmd.LnkGen', parentLog) || this;
        _this.context = context;
        var cl = _this.log.call('constructor');
        var button = new _toolbar_config__WEBPACK_IMPORTED_MODULE_6__["ButtonSafe"](context.button, context);
        var command = button.action();
        // Initialize Items - use predefined or create empty array
        _this.items = command.params.items || [];
        cl.data('items', _this.items);
        // initialize params
        _this.urlParams = button.addParamsToLink();
        var dialog = button.dialog();
        // note: this corrects how the variable to name the dialog changed in the history of 2sxc from action to dialog
        _this.urlParams = __assign({ dialog: dialog || command.name }, _this.urlParams);
        cl.data('urlParmas', _this.urlParams);
        // initialize root url to dialog
        _this.rootUrl = _this.getDialogUrl(dialog);
        // get isDebug url Parameter
        _this.debugUrlParam = window.$2sxc.urlParams.get('debug') ? '&debug=true' : '';
        _this.buildItemsList(button);
        // if the command has own configuration stuff, do that now
        if (context.button.configureLinkGenerator)
            context.button.configureLinkGenerator(context, _this);
        cl.done();
        return _this;
    }
    /**
     * Generate items for editing/changing or simple item depending on the scenario.
     */
    CommandLinkGenerator.prototype.buildItemsList = function (button) {
        if (button.action().params.useModuleList)
            this.addContentGroupItems(true);
        else if (button.action().params.parent)
            this.addItemInList();
        else
            this.addItem();
    };
    /**
     * build the link, combining specific params with global ones and put all in the url
     */
    CommandLinkGenerator.prototype.getLink = function () {
        var context = this.context;
        var button = new _toolbar_config__WEBPACK_IMPORTED_MODULE_6__["ButtonSafe"](context.button, context);
        var params = button.action().params;
        var urlItems = this.urlParams;
        // steps for all actions: prefill, serialize, open-dialog
        // when doing new, there may be a prefill in the link to initialize the new item
        if (params.prefill)
            for (var i = 0; i < this.items.length; i++)
                this.items[i].Prefill = params.prefill;
        delete urlItems.prefill; // added 2020-03-11, seemed strange that it's not removed
        urlItems.items = JSON.stringify(this.items); // Serialize/json-ify the complex items-list
        // clone the params and adjust parts based on partOfPage settings...
        var partOfPage = button.partOfPage();
        var ngDialogParams = new _manage_ng_dialog_params__WEBPACK_IMPORTED_MODULE_4__["NgUrlValuesWithoutParams"](context, partOfPage);
        return this.rootUrl + "#" + _plumbing__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].param(ngDialogParams).replace(/%2F/g, '/') + "&" + _plumbing__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].param(urlItems) + this.debugUrlParam;
    };
    /**
     * Determine the url to open a dialog, based on the settings which UI version to use
     */
    CommandLinkGenerator.prototype.getDialogUrl = function (dialogName) {
        var context = this.context;
        // const path = (context.ui.form === 'ng8') // v11 applies to all forms, not just edit: //  && dialogName === 'edit')
        //     ? C.DialogPaths.ng8
        //     : C.DialogPaths.ng1;
        return Object(_plumbing__WEBPACK_IMPORTED_MODULE_5__["urlClean"])("" + _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_2__["$2sxcInPage"].env.uiRoot() + _constants__WEBPACK_IMPORTED_MODULE_0__["C"].DialogPaths.ng8) + ("?sxcver=" + context.instance.sxcVersion);
        // old till 11.11.02 return urlClean(`${context.instance.sxcRootUrl}${$2sxcInPage.env.uiRoot()}${C.DialogPaths.ng8}`) + `?sxcver=${context.instance.sxcVersion}`;
    };
    CommandLinkGenerator.prototype.addItem = function () {
        var item = {};
        var params = this.context.button.command.params;
        // two ways to name the content-type-name this, v 7.2+ and older
        var ct = params.contentType || params.attributeSetName;
        if (params.entityId)
            item.EntityId = params.entityId;
        if (ct)
            item.ContentTypeName = ct;
        // v12.11 - also support cases where the template includes an edition
        if (params)
            // only add if there was stuff to add
            if (item.EntityId || item.ContentTypeName) {
                console.warn('used the simple item header - test if dialog still works!');
                // this.items.push(item);
                this.items.push(__assign(__assign({}, item), { Title: Object(_i18n__WEBPACK_IMPORTED_MODULE_1__["translate"])(this.findTranslationKey(this.findPartName(true))) }));
            }
    };
    /**
     * this will tell the command to edit a item from the sorted list in the group,
     * optionally together with the presentation item
     */
    CommandLinkGenerator.prototype.addContentGroupItems = function (withPresentation) {
        var _this = this;
        var cl = this.log.call('addContentGroupItems', "" + withPresentation);
        var params = this.context.button.command.params;
        var isContentAndNotHeader = (params.sortOrder !== -1);
        var index = isContentAndNotHeader ? params.sortOrder : 0;
        var isAdd = this.context.button.command.name === 'new';
        var groupId = this.context.contentBlock.contentGroupId;
        var fields = [this.findPartName(true)];
        if (withPresentation)
            fields.push(this.findPartName(false));
        fields.map(function (f) { return _this.addContentGroupItem(groupId, index, f, isAdd); });
        cl.done();
    };
    /**
     * this adds an item of the content-group, based on the group GUID and the sequence number
     */
    CommandLinkGenerator.prototype.addContentGroupItem = function (guid, index, part, isAdd) {
        var cl = this.log.call('addContentGroupItem', guid + ", " + index + ", " + part + ", " + isAdd);
        this.items.push({
            Group: {
                Guid: guid,
                Index: index,
                Part: part.toLocaleLowerCase(),
                Add: isAdd,
            },
            Title: Object(_i18n__WEBPACK_IMPORTED_MODULE_1__["translate"])(this.findTranslationKey(part)),
        });
        cl.done();
    };
    /**
     * EXPERIMENTAL in 10.27, if a parent is specified, use that
     * this will tell the command to edit a item which also belongs to a list
     * this is relevant when adding new items
     */
    CommandLinkGenerator.prototype.addItemInList = function () {
        var _this = this;
        var params = this.context.button.command.params;
        var index = params.sortOrder;
        var isAdd = this.context.button.command.name === 'new';
        var groupId = params.parent;
        // New in 10.27 - if params has a field, use that
        if (params.fields)
            params.fields.split(',').map(function (f) { return _this.items.push({
                EntityId: isAdd ? 0 : params.entityId,
                Field: f,
                Parent: groupId,
                Add: isAdd,
                Index: index,
            }); });
    };
    /**
     * find the part name for both the API to give the right item (when using groups) and for i18n
     */
    CommandLinkGenerator.prototype.findPartName = function (content) {
        var isContentAndNotHeader = (this.context.button.command.params.sortOrder !== -1);
        return (isContentAndNotHeader ? '' : 'List') + (content ? 'Content' : 'Presentation');
    };
    /**
     * find the correct i18n key for this part
     */
    CommandLinkGenerator.prototype.findTranslationKey = function (partName) {
        return "EditFormTitle." + partName;
    };
    return CommandLinkGenerator;
}(_logging__WEBPACK_IMPORTED_MODULE_3__["HasLog"]));



/***/ }),

/***/ "./src/commands/command.ts":
/*!*********************************!*\
  !*** ./src/commands/command.ts ***!
  \*********************************/
/*! exports provided: Command */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Command", function() { return Command; });
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var Command = /** @class */ (function () {
    function Command(name) {
        this.name = name;
    }
    Command.prototype.merge = function (icon, translateKey, uiOnly, partOfPage, more) {
        this.buttonDefaults = __assign({ icon: function (_) { return "icon-sxc-" + icon; }, title: function (_) { return "Toolbar." + translateKey; }, uiActionOnly: function (_) { return uiOnly; }, partOfPage: function (_) { return partOfPage; } }, more);
    };
    Command.build = function (name, translateKey, icon, uiOnly, partOfPage, more) {
        if (typeof (partOfPage) !== 'boolean')
            throw 'partOfPage in commands not provided, order will be wrong!';
        var commandDefinition = new Command(name);
        // Toolbar API v2
        commandDefinition.merge(icon, translateKey, uiOnly, partOfPage, more);
        return commandDefinition;
    };
    return Command;
}());



/***/ }),

/***/ "./src/commands/command/add-existing.ts":
/*!**********************************************!*\
  !*** ./src/commands/command/add-existing.ts ***!
  \**********************************************/
/*! exports provided: CmdAddExisting */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdAddExisting", function() { return CmdAddExisting; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _shared_logic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./shared-logic */ "./src/commands/command/shared-logic.ts");


var CmdAddExisting = 'add-existing';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdAddExisting, 'AddExisting', 'add-existing', false, true, {
    dialog: function (_) { return 'replace'; },
    showCondition: function (context) {
        return _shared_logic__WEBPACK_IMPORTED_MODULE_1__["SharedLogic"].isList(context);
    },
    configureLinkGenerator: function (context, linkGenerator) {
        if (_shared_logic__WEBPACK_IMPORTED_MODULE_1__["SharedLogic"].isFieldList(context)) {
            var params = context.button.command.params;
            linkGenerator.items = [{ Group: {
                        Guid: params.parent,
                        Part: params.fields,
                        Index: params.sortOrder + 1,
                        Add: true,
                    } }];
        }
        else if (_shared_logic__WEBPACK_IMPORTED_MODULE_1__["SharedLogic"].isPartOfBlockList(context)) {
            var topItem = linkGenerator.items[0];
            topItem.Group.Add = true;
            topItem.Group.Index++;
            linkGenerator.items = [topItem];
        }
    },
});


/***/ }),

/***/ "./src/commands/command/add.ts":
/*!*************************************!*\
  !*** ./src/commands/command/add.ts ***!
  \*************************************/
/*! exports provided: CmdAdd */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdAdd", function() { return CmdAdd; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _content_list_actions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./content-list-actions */ "./src/commands/command/content-list-actions.ts");
/* harmony import */ var _shared_logic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./shared-logic */ "./src/commands/command/shared-logic.ts");



var CmdAdd = 'add';
/**
 * add brings no dialog, just add an empty item
 *
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdAdd, 'AddDemo', 'plus-circled', false, true, {
    showCondition: function (context) { return _shared_logic__WEBPACK_IMPORTED_MODULE_2__["SharedLogic"].isList(context); },
    code: function (context) {
        return _content_list_actions__WEBPACK_IMPORTED_MODULE_1__["Actions"].addItem(context, context.button.command.params.sortOrder + 1);
    },
});


/***/ }),

/***/ "./src/commands/command/app-import.ts":
/*!********************************************!*\
  !*** ./src/commands/command/app-import.ts ***!
  \********************************************/
/*! exports provided: CmdAppImport */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdAppImport", function() { return CmdAppImport; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdAppImport = 'app-import';
/**
 * open the import dialog
 *
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdAppImport, 'Dashboard', '', true, false, {});


/***/ }),

/***/ "./src/commands/command/app-resources.ts":
/*!***********************************************!*\
  !*** ./src/commands/command/app-resources.ts ***!
  \***********************************************/
/*! exports provided: CmdAppResources */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdAppResources", function() { return CmdAppResources; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _edit__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./edit */ "./src/commands/command/edit.ts");


var CmdAppResources = 'app-resources';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdAppResources, 'AppResources', 'translate', true, false, {
    dialog: function (_) { return _edit__WEBPACK_IMPORTED_MODULE_1__["CmdEditDialog"]; },
    disabled: function (context) { return context.app.resourcesId === null; },
    title: function (context) { return "Toolbar.AppResources" + (context.app.resourcesId === null ? 'Disabled' : ''); },
    // only if resources exist or are 0 (to be created)...
    showCondition: function (context) { return !!context.user.CanAdmin; },
    configureLinkGenerator: function (context, linkGenerator) {
        linkGenerator.items = [{ EntityId: context.app.resourcesId }];
    },
    // if it doesn't have a query, make the button faded
    dynamicClasses: function (context) { return context.app.resourcesId !== null ? '' : 'empty'; },
});


/***/ }),

/***/ "./src/commands/command/app-settings.ts":
/*!**********************************************!*\
  !*** ./src/commands/command/app-settings.ts ***!
  \**********************************************/
/*! exports provided: CmdAppSettings */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdAppSettings", function() { return CmdAppSettings; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _edit__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./edit */ "./src/commands/command/edit.ts");


var CmdAppSettings = 'app-settings';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdAppSettings, 'AppSettings', 'sliders', true, false, {
    dialog: function () { return _edit__WEBPACK_IMPORTED_MODULE_1__["CmdEditDialog"]; },
    disabled: function (context) { return context.app.settingsId === null; },
    title: function (context) {
        return "Toolbar.AppSettings" + (context.app.settingsId === null ? 'Disabled' : '');
    },
    // only if settings exist, or are 0 (to be created)
    showCondition: function (context) { return context.user.CanAdmin; },
    configureLinkGenerator: function (context, linkGenerator) {
        linkGenerator.items = [{ EntityId: context.app.settingsId }];
    },
    // if it doesn't have a settings, make it less strong
    dynamicClasses: function (context) { return context.app.settingsId !== null ? '' : 'empty'; },
});


/***/ }),

/***/ "./src/commands/command/app.ts":
/*!*************************************!*\
  !*** ./src/commands/command/app.ts ***!
  \*************************************/
/*! exports provided: CmdApp */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdApp", function() { return CmdApp; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdApp = 'app';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdApp, 'App', 'settings', true, false, {
    showCondition: function (context) {
        return context.user.CanAdmin;
    },
});


/***/ }),

/***/ "./src/commands/command/content-items.ts":
/*!***********************************************!*\
  !*** ./src/commands/command/content-items.ts ***!
  \***********************************************/
/*! exports provided: CmdContentItems */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdContentItems", function() { return CmdContentItems; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdContentItems = 'contentitems';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdContentItems, 'ContentItems', 'table', true, false, {
    addParamsToLink: function (context) {
        var typeName = context.button.command.params.contentType
            || context.contentBlock.contentTypeId;
        return {
            // old name for the previous UI
            // 2021-11-29 2dm - believe this is obsolete, will turn off and see if everything works
            // #cleanUp EOY 2021
            // contentTypeName: typeName,
            // new name for the new UI
            contentType: typeName,
        };
    },
    // only show to admin-users and in cases where we know the content-type
    showCondition: function (context) {
        return !!context.user.CanAdmin &&
            (!!context.button.command.params.contentType ||
                !!context.contentBlock.contentTypeId);
    },
    configureLinkGenerator: function (context, linkGenerator) {
        if (context.button.command.params.filters) {
            var enc = JSON.stringify(context.button.command.params.filters);
            // special case - if it contains a "+" character, this won't survive
            // encoding through the hash as it's always replaced with a space, even if it would be pre converted to %2b
            // so we're base64 encoding it - see https://github.com/2sic/2sxc/issues/1061
            if (enc.indexOf('+') > -1)
                enc = btoa(enc);
            linkGenerator.urlParams.filters = enc;
        }
    },
});


/***/ }),

/***/ "./src/commands/command/content-list-action-params.ts":
/*!************************************************************!*\
  !*** ./src/commands/command/content-list-action-params.ts ***!
  \************************************************************/
/*! exports provided: ContentListActionParams */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContentListActionParams", function() { return ContentListActionParams; });
/**
 * params for getAndReload WebAPI
 */
var ContentListActionParams = /** @class */ (function () {
    function ContentListActionParams() {
    }
    return ContentListActionParams;
}());



/***/ }),

/***/ "./src/commands/command/content-list-actions.ts":
/*!******************************************************!*\
  !*** ./src/commands/command/content-list-actions.ts ***!
  \******************************************************/
/*! exports provided: Actions */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Actions", function() { return Actions; });
/* harmony import */ var _contentBlock_render__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../contentBlock/render */ "./src/contentBlock/render.ts");

//#region WebApi Endpoints used: 2sxc
var webApiAdd = 'cms/block/item';
var webApiRemoveFromList = 'cms/list/delete';
var webApiReorder = 'cms/list/move';
var webApiItemPublish = 'cms/edit/publish';
var webApiBlockPublish = 'cms/block/publish';
//#endregion
/**
 * These actions make changes to a content-block - like adding, removing or publishing items in the block
 * @class ActionsCatalog
 */
var ContentListActions = /** @class */ (function () {
    function ContentListActions() {
    }
    /**
     * add an item to the list at this position
     * @param {ContextComplete} context
     * @param {number} index
     */
    ContentListActions.prototype.addItem = function (context, index) {
        return doAndReload(context, webApiAdd, { index: index }, 'post');
    };
    /**
     * remove an item from a list, then reload
     * @param {ContextComplete} context
     * @param {number} sortOrder
     */
    ContentListActions.prototype.removeFromList = function (context) {
        var params = context.button.command.params;
        return doAndReload(context, webApiRemoveFromList, {
            index: params.sortOrder,
            parent: params.parent,
            fields: params.fields,
        }, 'delete');
    };
    /**
     * change the order of an item in a list, then reload
     * @param {ContextComplete} context
     * @param {number} index
     * @param {number} toIndex
     */
    ContentListActions.prototype.changeOrder = function (context, index, toIndex) {
        var params = context.button.command.params;
        return doAndReload(context, webApiReorder, {
            parent: params.parent,
            fields: params.fields,
            index: index,
            toIndex: toIndex,
        }, 'post');
    };
    /**
     * set a content-item in this block to published, then reload
     * @param {ContextComplete} context
     * @param {string} part
     * @param {number} index
     */
    ContentListActions.prototype.publish = function (context, part, index) {
        return doAndReload(context, webApiBlockPublish, {
            part: part,
            index: index,
        }, 'post');
    };
    /**
     * publish an item using it's ID
     * @param {ContextComplete} context
     * @param {number} entityId
     */
    ContentListActions.prototype.publishId = function (context, entityId) {
        return doAndReload(context, webApiItemPublish, { id: entityId }, 'post');
    };
    return ContentListActions;
}());
var Actions = new ContentListActions();
/*
 * this is a content block in the browser
 *
 * A Content Block is a stand alone unit of content, with it's own definition of
 * 1. content items
 * 2. template
 * + some other stuff
 *
 * it should be able to render itself
 */
/**
 * internal helper, to do something and reload the content block
 * @param {ContextComplete} context
 * @param {string} url
 * @param {ContentListActionParams} params
 * @returns {void | T}
 */
function doAndReload(context, url, params, verb, postData) {
    if (verb === void 0) { verb = 'get'; }
    if (postData === void 0) { postData = {}; }
    return (verb === 'post'
        ? context.sxc.webApi.fetch(context.sxc.webApi.url(url, params), postData, 'POST')
        : verb === 'delete'
            ? context.sxc.webApi.fetch(context.sxc.webApi.url(url, params), undefined, 'DELETE')
            : context.sxc.webApi.fetchJson(context.sxc.webApi.url(url, params)))
        .then(function () {
        _contentBlock_render__WEBPACK_IMPORTED_MODULE_0__["renderer"].reloadAndReInitialize(context);
    });
}


/***/ }),

/***/ "./src/commands/command/content-type.ts":
/*!**********************************************!*\
  !*** ./src/commands/command/content-type.ts ***!
  \**********************************************/
/*! exports provided: CmdContentType */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdContentType", function() { return CmdContentType; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdContentType = 'contenttype';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdContentType, 'ContentType', 'fields', true, false, {
    addParamsToLink: function (context) { return ({
        // added in 10.27 to help with the new edit ui
        contentType: context.button.command.params.contentType
            || context.contentBlock.contentTypeId,
    }); },
    // only show to admin-users and in cases where we know the content-type
    showCondition: function (context) {
        return !!context.user.CanDevelop &&
            (!!context.button.command.params.contentType ||
                !!context.contentBlock.contentTypeId);
    },
});


/***/ }),

/***/ "./src/commands/command/custom.ts":
/*!****************************************!*\
  !*** ./src/commands/command/custom.ts ***!
  \****************************************/
/*! exports provided: CmdCustom */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdCustom", function() { return CmdCustom; });
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../commands */ "./src/commands/commands.ts");

var CmdCustom = 'custom';
var ctxName = 'context';
var evtName = 'event';
var errNoCode = "Trying to run Custom-Code action, but no 'customCode' (v9) or 'call' (v10) found to run - see console for debug info.";
/**
 * import this module to commands.ts
 */
_commands__WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdCustom, 'Custom', 'bomb', true, false, {
    code: function (context, event) {
        return new Promise(function (resolve, reject) {
            var actPar = context.button.command.params;
            // the old V9 name
            var code = actPar.customCode;
            // also try the V10 edition
            if (!code) {
                code = actPar.call;
                if (typeof code === 'string' && code.indexOf(' ') === -1 && code.indexOf('(') === -1)
                    code += "(" + ctxName + ", " + evtName + ")";
            }
            if (!code) {
                console.warn(errNoCode, actPar);
                alert(errNoCode);
                resolve();
            }
            try {
                var fn = new Function(ctxName, evtName, code);
                resolve(fn(context, event));
            }
            catch (err) {
                console.error('error in custom button-code: ', actPar);
                reject(err);
            }
        });
    },
});


/***/ }),

/***/ "./src/commands/command/delete.ts":
/*!****************************************!*\
  !*** ./src/commands/command/delete.ts ***!
  \****************************************/
/*! exports provided: CmdDelete */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdDelete", function() { return CmdDelete; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _entity_manipulation_item_commands__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../entity-manipulation/item-commands */ "./src/entity-manipulation/item-commands.ts");


var CmdDelete = 'delete';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdDelete, 'Delete', 'cancel', true, false, {
    // disabled: true,
    showCondition: function (context) {
        var p = context.button.command.params;
        // can never be used for a modulelist item, as it is always in use somewhere
        if (p.useModuleList)
            return false;
        // check if all data exists required for deleting
        // before 10.27, it was entityId, entityGuid and entityTitle
        // since 10.27, there will always be a guid (if it has an ID)
        // and enabling it requires an action-modifier "+delete",
        // so the automatic detection only applies
        // to the pre-10.27 custom toolbars case
        return (!!p.entityId && !!p.entityGuid && !!p.entityTitle);
    },
    code: function (context) {
        var p = context.button.command.params;
        var title = p.title || p.entityTitle; // prefer new title, and fallback to old for pre 10.27 configs
        return _entity_manipulation_item_commands__WEBPACK_IMPORTED_MODULE_1__["contentItems"].delete(context, p.entityId, p.entityGuid, title);
    },
});


/***/ }),

/***/ "./src/commands/command/edit.ts":
/*!**************************************!*\
  !*** ./src/commands/command/edit.ts ***!
  \**************************************/
/*! exports provided: CmdEdit, CmdEditDialog */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdEdit", function() { return CmdEdit; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdEditDialog", function() { return CmdEditDialog; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdEdit = 'edit';
var CmdEditDialog = 'edit';
/**
 * open an edit-item dialog
 *
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdEdit, 'Edit', 'pencil', false, true, {
    addParamsToLink: function (ctx) { return ({ mode: 'edit' }); },
    showCondition: function (ctx) {
        // need ID or a "slot", otherwise edit won't work
        var result = !!ctx.button.command.params.entityId ||
            !!ctx.button.command.params.useModuleList;
        return result;
    },
});


/***/ }),

/***/ "./src/commands/command/index.ts":
/*!***************************************!*\
  !*** ./src/commands/command/index.ts ***!
  \***************************************/
/*! exports provided: SharedLogic, CmdAdd, CmdAddExisting, CmdAppImport, CmdAppResources, CmdAppSettings, CmdApp, CmdContentItems, ContentListActionParams, Actions, CmdContentType, CmdCustom, CmdDelete, CmdEdit, CmdEditDialog, CmdInsightsServer, CmdInstanceList, CmdLayout, CmdMetadata, CmdMore, CmdMoveDown, CmdMoveUp, CmdNew, CmdNewMode, CmdPublish, CmdRemove, CmdReplace, CmdTemplateDevelop, CmdTemplateQuery, CmdTemplateSettings, CmdZone, SpecialCommands */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _shared_logic__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./shared-logic */ "./src/commands/command/shared-logic.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SharedLogic", function() { return _shared_logic__WEBPACK_IMPORTED_MODULE_0__["SharedLogic"]; });

/* harmony import */ var _add__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./add */ "./src/commands/command/add.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAdd", function() { return _add__WEBPACK_IMPORTED_MODULE_1__["CmdAdd"]; });

/* harmony import */ var _add_existing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./add-existing */ "./src/commands/command/add-existing.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAddExisting", function() { return _add_existing__WEBPACK_IMPORTED_MODULE_2__["CmdAddExisting"]; });

/* harmony import */ var _app_import__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app-import */ "./src/commands/command/app-import.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAppImport", function() { return _app_import__WEBPACK_IMPORTED_MODULE_3__["CmdAppImport"]; });

/* harmony import */ var _app_resources__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./app-resources */ "./src/commands/command/app-resources.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAppResources", function() { return _app_resources__WEBPACK_IMPORTED_MODULE_4__["CmdAppResources"]; });

/* harmony import */ var _app_settings__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./app-settings */ "./src/commands/command/app-settings.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAppSettings", function() { return _app_settings__WEBPACK_IMPORTED_MODULE_5__["CmdAppSettings"]; });

/* harmony import */ var _app__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./app */ "./src/commands/command/app.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdApp", function() { return _app__WEBPACK_IMPORTED_MODULE_6__["CmdApp"]; });

/* harmony import */ var _content_items__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./content-items */ "./src/commands/command/content-items.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdContentItems", function() { return _content_items__WEBPACK_IMPORTED_MODULE_7__["CmdContentItems"]; });

/* harmony import */ var _content_list_action_params__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./content-list-action-params */ "./src/commands/command/content-list-action-params.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContentListActionParams", function() { return _content_list_action_params__WEBPACK_IMPORTED_MODULE_8__["ContentListActionParams"]; });

/* harmony import */ var _content_list_actions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./content-list-actions */ "./src/commands/command/content-list-actions.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Actions", function() { return _content_list_actions__WEBPACK_IMPORTED_MODULE_9__["Actions"]; });

/* harmony import */ var _content_type__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./content-type */ "./src/commands/command/content-type.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdContentType", function() { return _content_type__WEBPACK_IMPORTED_MODULE_10__["CmdContentType"]; });

/* harmony import */ var _custom__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./custom */ "./src/commands/command/custom.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdCustom", function() { return _custom__WEBPACK_IMPORTED_MODULE_11__["CmdCustom"]; });

/* harmony import */ var _delete__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./delete */ "./src/commands/command/delete.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdDelete", function() { return _delete__WEBPACK_IMPORTED_MODULE_12__["CmdDelete"]; });

/* harmony import */ var _edit__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./edit */ "./src/commands/command/edit.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdEdit", function() { return _edit__WEBPACK_IMPORTED_MODULE_13__["CmdEdit"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdEditDialog", function() { return _edit__WEBPACK_IMPORTED_MODULE_13__["CmdEditDialog"]; });

/* harmony import */ var _insights_server__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./insights-server */ "./src/commands/command/insights-server.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdInsightsServer", function() { return _insights_server__WEBPACK_IMPORTED_MODULE_14__["CmdInsightsServer"]; });

/* harmony import */ var _instance_list__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./instance-list */ "./src/commands/command/instance-list.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdInstanceList", function() { return _instance_list__WEBPACK_IMPORTED_MODULE_15__["CmdInstanceList"]; });

/* harmony import */ var _layout__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./layout */ "./src/commands/command/layout.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdLayout", function() { return _layout__WEBPACK_IMPORTED_MODULE_16__["CmdLayout"]; });

/* harmony import */ var _metadata__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./metadata */ "./src/commands/command/metadata.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMetadata", function() { return _metadata__WEBPACK_IMPORTED_MODULE_17__["CmdMetadata"]; });

/* harmony import */ var _more__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./more */ "./src/commands/command/more.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMore", function() { return _more__WEBPACK_IMPORTED_MODULE_18__["CmdMore"]; });

/* harmony import */ var _movedown__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./movedown */ "./src/commands/command/movedown.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMoveDown", function() { return _movedown__WEBPACK_IMPORTED_MODULE_19__["CmdMoveDown"]; });

/* harmony import */ var _moveup__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./moveup */ "./src/commands/command/moveup.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMoveUp", function() { return _moveup__WEBPACK_IMPORTED_MODULE_20__["CmdMoveUp"]; });

/* harmony import */ var _new__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./new */ "./src/commands/command/new.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdNew", function() { return _new__WEBPACK_IMPORTED_MODULE_21__["CmdNew"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdNewMode", function() { return _new__WEBPACK_IMPORTED_MODULE_21__["CmdNewMode"]; });

/* harmony import */ var _publish__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./publish */ "./src/commands/command/publish.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdPublish", function() { return _publish__WEBPACK_IMPORTED_MODULE_22__["CmdPublish"]; });

/* harmony import */ var _remove__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./remove */ "./src/commands/command/remove.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdRemove", function() { return _remove__WEBPACK_IMPORTED_MODULE_23__["CmdRemove"]; });

/* harmony import */ var _replace__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./replace */ "./src/commands/command/replace.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdReplace", function() { return _replace__WEBPACK_IMPORTED_MODULE_24__["CmdReplace"]; });

/* harmony import */ var _template_develop__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./template-develop */ "./src/commands/command/template-develop.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateDevelop", function() { return _template_develop__WEBPACK_IMPORTED_MODULE_25__["CmdTemplateDevelop"]; });

/* harmony import */ var _template_query__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./template-query */ "./src/commands/command/template-query.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateQuery", function() { return _template_query__WEBPACK_IMPORTED_MODULE_26__["CmdTemplateQuery"]; });

/* harmony import */ var _template_settings__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./template-settings */ "./src/commands/command/template-settings.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateSettings", function() { return _template_settings__WEBPACK_IMPORTED_MODULE_27__["CmdTemplateSettings"]; });

/* harmony import */ var _zone__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./zone */ "./src/commands/command/zone.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdZone", function() { return _zone__WEBPACK_IMPORTED_MODULE_28__["CmdZone"]; });

/* harmony import */ var _special_commands__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./special-commands */ "./src/commands/command/special-commands.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SpecialCommands", function() { return _special_commands__WEBPACK_IMPORTED_MODULE_29__["SpecialCommands"]; });






























// Workflow



/***/ }),

/***/ "./src/commands/command/insights-server.ts":
/*!*************************************************!*\
  !*** ./src/commands/command/insights-server.ts ***!
  \*************************************************/
/*! exports provided: CmdInsightsServer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdInsightsServer", function() { return CmdInsightsServer; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");


var CmdInsightsServer = 'insights-server';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdInsightsServer, 'Insights', 'speed', true, false, {
    showCondition: function (context) { return context.user.CanDevelop; },
    code: function (context, event) {
        return new Promise(function (resolve, reject) {
            console.log('context', context);
            var path = _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_1__["$2sxcInPage"].http.apiUrl('sys/insights/logs');
            window.open(path, '_blank');
            return resolve();
        });
    },
});


/***/ }),

/***/ "./src/commands/command/instance-list.ts":
/*!***********************************************!*\
  !*** ./src/commands/command/instance-list.ts ***!
  \***********************************************/
/*! exports provided: CmdInstanceList */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdInstanceList", function() { return CmdInstanceList; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdInstanceList = 'instance-list';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdInstanceList, 'Sort', 'list-numbered', false, true, {
    showCondition: function (context) { return ___WEBPACK_IMPORTED_MODULE_0__["SharedLogic"].isList(context); },
    configureLinkGenerator: function (context, linkGenerator) {
        if (!___WEBPACK_IMPORTED_MODULE_0__["SharedLogic"].isFieldList(context))
            return;
        var params = context.button.command.params;
        linkGenerator.items = [{ Group: {
                    Guid: params.parent,
                    Part: params.fields,
                    Index: params.sortOrder,
                    Add: false,
                } }];
    },
});


/***/ }),

/***/ "./src/commands/command/layout.ts":
/*!****************************************!*\
  !*** ./src/commands/command/layout.ts ***!
  \****************************************/
/*! exports provided: CmdLayout */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdLayout", function() { return CmdLayout; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _quick_edit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../quick-edit */ "./src/quick-edit/index.ts");
/* harmony import */ var _quick_edit_context_for_lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../quick-edit/context-for-lists */ "./src/quick-edit/context-for-lists.ts");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../commands */ "./src/commands/commands.ts");





var CmdLayout = 'layout';
/**
 * import this module to commands.ts
 */
_commands__WEBPACK_IMPORTED_MODULE_4__["Commands"].add(CmdLayout, 'ChangeLayout', 'glasses', true, true, {
    inlineWindow: function (_) { return true; },
    code: function (context, event) {
        // console.log('layout');
        // Try to find the closest tag based on the click
        // if this fails, try to find it based on the sxc-instance
        var attrSel = '[' + _quick_edit__WEBPACK_IMPORTED_MODULE_2__["QeSelectors"].blocks.cb.context + ']';
        // note: sometimes when the page loads, this can be auto-triggered and not have an event
        var listSpecs = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__["SxcEdit"].getTag(context.sxc).closest(attrSel);
        // Now check if we have apps-parameters to pass on
        if (listSpecs) {
            var specs = _quick_edit_context_for_lists__WEBPACK_IMPORTED_MODULE_3__["ContextForLists"].getFromDom(listSpecs);
            context.button.command.params.apps = specs.apps;
        }
        return ___WEBPACK_IMPORTED_MODULE_0__["CmsEngine"].openDialog(context, event);
    },
});


/***/ }),

/***/ "./src/commands/command/metadata.ts":
/*!******************************************!*\
  !*** ./src/commands/command/metadata.ts ***!
  \******************************************/
/*! exports provided: CmdMetadata */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdMetadata", function() { return CmdMetadata; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _edit__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./edit */ "./src/commands/command/edit.ts");
/* harmony import */ var _new__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./new */ "./src/commands/command/new.ts");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};



var CmdMetadata = 'metadata';
var MetadataDefaultKeyType = 'string';
var MetadataDefaultTargetType = 10; // cms-item
/**
 * create a metadata toolbar
 *
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdMetadata, 'Metadata', 'tag', false, false, {
    addParamsToLink: function (_) { return ({ mode: _new__WEBPACK_IMPORTED_MODULE_2__["CmdNewMode"] }); },
    dialog: function (_) { return _edit__WEBPACK_IMPORTED_MODULE_1__["CmdEditDialog"]; },
    // if it doesn't have data yet, make it less strong
    dynamicClasses: function (ctx) { return ctx.button.command.params.entityId ? '' : 'empty'; },
    // only add a metadata-button if it has metadata-infos
    showCondition: function (ctx) { return !!ctx.button.command.params.metadata; },
    configureLinkGenerator: function (_, linkGenerator) {
        var itm = {
            Title: 'EditFormTitle.Metadata',
            Metadata: __assign({ keyType: MetadataDefaultKeyType, targetType: MetadataDefaultTargetType }, linkGenerator.context.button.command.params.metadata),
        };
        linkGenerator.items[0] = __assign(__assign({}, linkGenerator.items[0]), itm);
    },
});


/***/ }),

/***/ "./src/commands/command/more.ts":
/*!**************************************!*\
  !*** ./src/commands/command/more.ts ***!
  \**************************************/
/*! exports provided: CmdMore */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdMore", function() { return CmdMore; });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../constants */ "./src/constants/index.ts");
/* harmony import */ var _constants_ids__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../constants/ids */ "./src/constants/ids.ts");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../commands */ "./src/commands/commands.ts");



var CmdMore = 'more';
/**
 * import this module to commands.ts
 */
_commands__WEBPACK_IMPORTED_MODULE_2__["Commands"].add(CmdMore, 'MoreActions', 'options btn-mode', true, false, {
    code: function (context, event) {
        return new Promise(function (resolve, reject) {
            var btn2 = event.target;
            var fullMenu2 = btn2.closest(_constants_ids__WEBPACK_IMPORTED_MODULE_1__["IDs"].sel.tagScMenu);
            var oldState2 = Number(fullMenu2.getAttribute('data-state') || 0);
            var max2 = Number(fullMenu2.getAttribute('group-count'));
            var newState2 = (oldState2 + 1) % max2;
            fullMenu2.classList.remove("group-" + oldState2);
            fullMenu2.classList.add("group-" + newState2);
            fullMenu2.setAttribute('data-state', String(newState2));
            event.preventDefault();
            function mouseenterHandler(e) {
                fullMenu2.style.opacity = '1';
            }
            function mouseleaveHandler(e) {
                if (e.screenX !== 0 && e.screenY !== 0) {
                    // hide toolbar on mouseleave
                    fullMenu2.style.opacity = '0';
                }
                else {
                    // this is fix for Chrome issue
                    // ensure to show toolbar because X=0 and Y=0
                    fullMenu2.style.opacity = '1';
                    console.warn('workaround for toolbar hide onmouseleave issue', e.screenX, e.screenY, e.target);
                }
            }
            // because of issue in Chrome we need to override CSS rules in edit.css for toolbar toggle on mouse hover
            var scElement = fullMenu2.closest('.' + _constants__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.classes.oldHover);
            // add mouseenter and mouseleave events to parent sc-element if not already added
            if (scElement && fullMenu2.getAttribute('listener') !== 'true') {
                scElement.addEventListener('mouseenter', mouseenterHandler);
                scElement.addEventListener('mouseleave', mouseleaveHandler);
                fullMenu2.setAttribute('listener', 'true'); // flag that events are added
            }
            resolve();
        });
    },
});


/***/ }),

/***/ "./src/commands/command/movedown.ts":
/*!******************************************!*\
  !*** ./src/commands/command/movedown.ts ***!
  \******************************************/
/*! exports provided: CmdMoveDown */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdMoveDown", function() { return CmdMoveDown; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _content_list_actions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./content-list-actions */ "./src/commands/command/content-list-actions.ts");


var CmdMoveDown = 'movedown';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdMoveDown, 'MoveDown', 'move-down', false, true, {
    // TODO: do not display if is last item in list
    showCondition: function (context) { return ___WEBPACK_IMPORTED_MODULE_0__["SharedLogic"].isList(context); },
    code: function (context) {
        // TODO: make sure index is never greater than the amount of items
        return _content_list_actions__WEBPACK_IMPORTED_MODULE_1__["Actions"].changeOrder(context, context.button.command.params.sortOrder, context.button.command.params.sortOrder + 1);
    },
});


/***/ }),

/***/ "./src/commands/command/moveup.ts":
/*!****************************************!*\
  !*** ./src/commands/command/moveup.ts ***!
  \****************************************/
/*! exports provided: CmdMoveUp */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdMoveUp", function() { return CmdMoveUp; });
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../commands */ "./src/commands/commands.ts");
/* harmony import */ var _content_list_actions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./content-list-actions */ "./src/commands/command/content-list-actions.ts");
/* harmony import */ var _shared_logic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./shared-logic */ "./src/commands/command/shared-logic.ts");



var CmdMoveUp = 'moveup';
/**
 * import this module to commands.ts
 */
_commands__WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdMoveUp, 'MoveUp', 'move-up', false, true, {
    showCondition: function (context) {
        return !!(_shared_logic__WEBPACK_IMPORTED_MODULE_2__["SharedLogic"].isList(context) &&
            context.button.command.params.sortOrder !== 0);
    },
    code: function (context) {
        return _content_list_actions__WEBPACK_IMPORTED_MODULE_1__["Actions"].changeOrder(context, context.button.command.params.sortOrder, Math.max(context.button.command.params.sortOrder - 1, 0));
    },
});


/***/ }),

/***/ "./src/commands/command/new.ts":
/*!*************************************!*\
  !*** ./src/commands/command/new.ts ***!
  \*************************************/
/*! exports provided: CmdNew, CmdNewMode */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdNew", function() { return CmdNew; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdNewMode", function() { return CmdNewMode; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _shared_logic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./shared-logic */ "./src/commands/command/shared-logic.ts");


var CmdNew = 'new';
var CmdNewMode = 'new';
/**
 * 'new' is a dialog to add something, and will not add if cancelled
 * new can also be used for mini-toolbars which just add an entity not attached to a module
 * in that case it's essential to add a contentType like
 * <ul class="sc-menu" data-toolbar='{"action":"new", "contentType": "Category"}'></ul>
 *
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdNew, 'New', 'plus', false, true, {
    addParamsToLink: function (_) { return ({ mode: CmdNewMode }); },
    dialog: function (_) { return ___WEBPACK_IMPORTED_MODULE_0__["CmdEditDialog"]; },
    showCondition: function (context) {
        // don't provide new if type unknown or on the header-item
        return !!context.button.command.params.contentType || _shared_logic__WEBPACK_IMPORTED_MODULE_1__["SharedLogic"].isList(context);
    },
    code: function (context, event) {
        var params = context.button.command.params;
        // todo - should refactor this to be a toolbarManager.contentBlock command
        params.sortOrder = params.sortOrder + 1;
        // if we have an EntityId, this means that it picked up id/guid from the current item,
        // so we must reset both EntityId and EntityGuid
        // note that we don't reset this if entityId = 0, because that usually means the guid was preset on purpose
        if (params.entityId && params.entityId !== 0) {
            delete params.entityId;
            delete params.entityGuid;
        }
        // if we have useModuleList AND contentType then something is inconsistent
        // since useModuleList doesn't need to specify the contentType
        // this means that it's a custom new button, and useModuleList is wrong.
        if (params.useModuleList && params.contentType)
            delete params.useModuleList;
        // done
        return ___WEBPACK_IMPORTED_MODULE_0__["CmsEngine"].openDialog(context, event);
    },
});


/***/ }),

/***/ "./src/commands/command/publish.ts":
/*!*****************************************!*\
  !*** ./src/commands/command/publish.ts ***!
  \*****************************************/
/*! exports provided: CmdPublish */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdPublish", function() { return CmdPublish; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../i18n */ "./src/i18n/index.ts");
/* harmony import */ var _content_list_actions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./content-list-actions */ "./src/commands/command/content-list-actions.ts");



var CmdPublish = 'publish';
/**
 * todo: shouldn't be available if changes are not allowed
 *
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdPublish, 'Unpublished', 'eye-off', false, false, {
    showCondition: function (context) {
        return context.button.command.params.isPublished === false;
    },
    disabled: function (context) {
        return !context.instance.allowPublish;
    },
    code: function (context, event) {
        return new Promise(function (resolve, reject) {
            if (context.button.command.params.isPublished) {
                alert(Object(_i18n__WEBPACK_IMPORTED_MODULE_1__["translate"])('Toolbar.AlreadyPublished'));
                return resolve();
            }
            // if we have an entity-id, publish based on that
            if (context.button.command.params.entityId) {
                return _content_list_actions__WEBPACK_IMPORTED_MODULE_2__["Actions"].publishId(context, context.button.command.params.entityId);
            }
            var part = context.button.command.params.sortOrder === -1
                ? 'listcontent'
                : 'content';
            var index = context.button.command.params.sortOrder === -1
                ? 0
                : context.button.command.params.sortOrder;
            return _content_list_actions__WEBPACK_IMPORTED_MODULE_2__["Actions"].publish(context, part, index);
        });
    },
});


/***/ }),

/***/ "./src/commands/command/remove.ts":
/*!****************************************!*\
  !*** ./src/commands/command/remove.ts ***!
  \****************************************/
/*! exports provided: CmdRemove */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdRemove", function() { return CmdRemove; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../i18n */ "./src/i18n/index.ts");
/* harmony import */ var _content_list_actions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./content-list-actions */ "./src/commands/command/content-list-actions.ts");



var CmdRemove = 'remove';
/**
 * remove an item from the placeholder (usually for lists)
 *
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdRemove, 'Remove', 'minus-circled', false, true, {
    showCondition: function (context) { return ___WEBPACK_IMPORTED_MODULE_0__["SharedLogic"].isList(context); },
    code: function (context) {
        return new Promise(function (resolve, reject) {
            if (confirm(Object(_i18n__WEBPACK_IMPORTED_MODULE_1__["translate"])('Toolbar.ConfirmRemove')))
                return _content_list_actions__WEBPACK_IMPORTED_MODULE_2__["Actions"].removeFromList(context);
            return resolve();
        });
    },
});


/***/ }),

/***/ "./src/commands/command/replace.ts":
/*!*****************************************!*\
  !*** ./src/commands/command/replace.ts ***!
  \*****************************************/
/*! exports provided: CmdReplace */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdReplace", function() { return CmdReplace; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _shared_logic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./shared-logic */ "./src/commands/command/shared-logic.ts");


var CmdReplace = 'replace';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdReplace, 'Replace', 'replace', false, true, {
    showCondition: function (context) {
        return _shared_logic__WEBPACK_IMPORTED_MODULE_1__["SharedLogic"].isReferencedItem(context);
    },
    configureLinkGenerator: function (context, linkGenerator) {
        // default case is ContentBlock - in which case it doesn't need to redefine the items
        if (!_shared_logic__WEBPACK_IMPORTED_MODULE_1__["SharedLogic"].isFieldList(context))
            return;
        // fieldList - redefine the items
        var params = context.button.command.params;
        linkGenerator.items = [{ Group: {
                    Guid: params.parent,
                    Part: params.fields,
                    Index: params.sortOrder,
                    Add: false,
                } }];
    },
});


/***/ }),

/***/ "./src/commands/command/shared-logic.ts":
/*!**********************************************!*\
  !*** ./src/commands/command/shared-logic.ts ***!
  \**********************************************/
/*! exports provided: SharedLogic */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharedLogic", function() { return SharedLogic; });
/**
 * Shared logic like for deciding if we show list buttons
 * here
 */
var SharedLogic = /** @class */ (function () {
    function SharedLogic() {
    }
    SharedLogic.isPartOfBlockList = function (context) {
        return !!(context.contentBlock.isList &&
            context.button.command.params.useModuleList &&
            context.button.command.params.sortOrder !== -1); // -1 is the header item
    };
    /**
     * This will tell us, if the item is being referenced (like in a list)
     * It's similar to isBlockList, but will return true even if it's
     * a non-list (single item only)
     */
    SharedLogic.isBlockReference = function (context) {
        return !!context.button.command.params.useModuleList; // -1 is the header item
    };
    SharedLogic.isFieldList = function (context) {
        var _a;
        var params = (_a = context.button) === null || _a === void 0 ? void 0 : _a.command.params;
        return !!((params === null || params === void 0 ? void 0 : params.fields) && (params === null || params === void 0 ? void 0 : params.parent));
    };
    SharedLogic.isList = function (context) {
        return this.isPartOfBlockList(context) || this.isFieldList(context);
    };
    SharedLogic.isReferencedItem = function (context) {
        return this.isBlockReference(context) || this.isFieldList(context);
    };
    return SharedLogic;
}());



/***/ }),

/***/ "./src/commands/command/special-commands.ts":
/*!**************************************************!*\
  !*** ./src/commands/command/special-commands.ts ***!
  \**************************************************/
/*! exports provided: SpecialCommands */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SpecialCommands", function() { return SpecialCommands; });
var SpecialCommands = {
    /** Special command: 'all' is a catch-all for workflows that should run on every command */
    all: 'all',
    /** Special Command: 'refresh' is usually run inside other commands after execution */
    refresh: 'refresh',
};


/***/ }),

/***/ "./src/commands/command/template-develop.ts":
/*!**************************************************!*\
  !*** ./src/commands/command/template-develop.ts ***!
  \**************************************************/
/*! exports provided: CmdTemplateDevelop */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateDevelop", function() { return CmdTemplateDevelop; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdTemplateDevelop = 'template-develop';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdTemplateDevelop, 'Develop', 'code', true, false, {
    newWindow: function (_) { return true; },
    dialog: function (_) { return 'develop'; },
    showCondition: function (context) { return !!context.user.CanDevelop; },
    configureLinkGenerator: function (context, linkGenerator) {
        var cb = context.contentBlock;
        var identifier = { EntityId: cb.templateId };
        if (cb.templatePath)
            identifier.Path = cb.templatePath;
        if (cb.edition)
            identifier.Edition = cb.edition;
        linkGenerator.items = [identifier];
    },
    addParamsToLink: function (ctx) { return ({ isshared: ctx.contentBlock.TemplateIsShared }); },
});


/***/ }),

/***/ "./src/commands/command/template-query.ts":
/*!************************************************!*\
  !*** ./src/commands/command/template-query.ts ***!
  \************************************************/
/*! exports provided: CmdTemplateQuery */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateQuery", function() { return CmdTemplateQuery; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdTemplateQuery = 'template-query';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdTemplateQuery, 'QueryEdit', 'filter', true, false, {
    dialog: function (_) { return 'pipeline-designer'; },
    addParamsToLink: function (ctx) { return ({ pipelineId: ctx.contentBlock.queryId }); },
    newWindow: function (_) { return true; },
    disabled: function (ctx) { return ctx.app.settingsId === null || !ctx.contentBlock.queryId; },
    title: function (ctx) { return "Toolbar.QueryEdit" + (ctx.contentBlock.queryId === null ? 'Disabled' : ''); },
    showCondition: function (ctx) { return !!ctx.user.CanDevelop && !ctx.app.isContent; },
    // if it doesn't have a query, make it less strong
    dynamicClasses: function (ctx) { return ctx.contentBlock.queryId ? '' : 'empty'; },
});


/***/ }),

/***/ "./src/commands/command/template-settings.ts":
/*!***************************************************!*\
  !*** ./src/commands/command/template-settings.ts ***!
  \***************************************************/
/*! exports provided: CmdTemplateSettings */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateSettings", function() { return CmdTemplateSettings; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdTemplateSettings = 'template-settings';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdTemplateSettings, 'TemplateSettings', 'sliders', true, false, {
    dialog: function (_) { return 'edit'; },
    showCondition: function (ctx) { return !!ctx.user.CanDevelop && !ctx.app.isContent; },
    configureLinkGenerator: function (ctx, linkGen) {
        linkGen.items = [{ EntityId: ctx.contentBlock.templateId }];
    },
});


/***/ }),

/***/ "./src/commands/command/zone.ts":
/*!**************************************!*\
  !*** ./src/commands/command/zone.ts ***!
  \**************************************/
/*! exports provided: CmdZone */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmdZone", function() { return CmdZone; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");

var CmdZone = 'zone';
/**
 * import this module to commands.ts
 */
___WEBPACK_IMPORTED_MODULE_0__["Commands"].add(CmdZone, 'Zone', 'manage', true, false, {
    showCondition: function (context) {
        return !!context.user.CanAdmin;
    },
});


/***/ }),

/***/ "./src/commands/commands.ts":
/*!**********************************!*\
  !*** ./src/commands/commands.ts ***!
  \**********************************/
/*! exports provided: Commands */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Commands", function() { return Commands; });
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _command__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./command */ "./src/commands/command.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


/** Singleton Catalog of all commands */
var Commands = /** @class */ (function (_super) {
    __extends(Commands, _super);
    function Commands() {
        var _this = _super.call(this, 'Cmd.Catlog') || this;
        _this.commandList = [];
        _this.list = {}; // hash - table of action definitions, to be used a list()["action - name"]
        _this.get = function (name) { return _this.list[name]; }; // a specific action definition
        _logging__WEBPACK_IMPORTED_MODULE_0__["Insights"].add('system', 'command-catalog', _this.log);
        return _this;
    }
    /** Singleton */
    Commands.singleton = function () {
        var _a;
        return (_a = this._singleton) !== null && _a !== void 0 ? _a : (this._singleton = new Commands());
    };
    Commands.add = function (name, translateKey, icon, uiOnly, partOfPage, more) {
        return this.singleton().add(name, translateKey, icon, uiOnly, partOfPage, more);
    };
    Commands.prototype.add = function (name, translateKey, icon, uiOnly, partOfPage, more) {
        var cmd = this.addDef(_command__WEBPACK_IMPORTED_MODULE_1__["Command"].build(name, translateKey, icon, uiOnly, partOfPage, more));
        this.log.add("add command '" + name + "'", cmd);
        return cmd;
    };
    Commands.prototype.addDef = function (def) {
        if (!this.list[def.name]) {
            // add
            this.commandList.push(def);
            this.list[def.name] = def;
        }
        else if (this.list[def.name] !== def) {
            // update
            this.list[def.name] = def;
        }
        return def;
    };
    return Commands;
}(_logging__WEBPACK_IMPORTED_MODULE_0__["HasLog"]));



/***/ }),

/***/ "./src/commands/engine/cms-engine.ts":
/*!*******************************************!*\
  !*** ./src/commands/engine/cms-engine.ts ***!
  \*******************************************/
/*! exports provided: CmsEngine */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CmsEngine", function() { return CmsEngine; });
/* harmony import */ var _contentBlock_content_block_editor__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../contentBlock/content-block-editor */ "./src/contentBlock/content-block-editor.ts");
/* harmony import */ var _contentBlock_render__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../contentBlock/render */ "./src/contentBlock/render.ts");
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _quick_dialog_quick_dialog__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../quick-dialog/quick-dialog */ "./src/quick-dialog/quick-dialog.ts");
/* harmony import */ var _toolbar_config__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../toolbar/config */ "./src/toolbar/config/index.ts");
/* harmony import */ var _toolbar_config_loaders_config_formats_in_page_button__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../toolbar/config-loaders/config-formats/in-page-button */ "./src/toolbar/config-loaders/config-formats/in-page-button.ts");
/* harmony import */ var _workflow__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../workflow */ "./src/workflow/index.ts");
/* harmony import */ var _workflow_workflow_manager__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../workflow/workflow-manager */ "./src/workflow/workflow-manager.ts");
/* harmony import */ var _command_link_generator__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../command-link-generator */ "./src/commands/command-link-generator.ts");
/* harmony import */ var _run_parameters__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./run-parameters */ "./src/commands/engine/run-parameters.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};












/**
 * The CMS engine is global, and needs the context to work.
 */
var CmsEngine = /** @class */ (function (_super) {
    __extends(CmsEngine, _super);
    function CmsEngine(parentLog) {
        var _this = _super.call(this, 'Cmd.Exec', parentLog, 'start') || this;
        _this.runParamsHelper = new _run_parameters__WEBPACK_IMPORTED_MODULE_10__["RunParametersHelper"](_this.log);
        return _this;
    }
    CmsEngine.prototype.detectParamsAndRun = function (context, nameOrParams, eventOrParams, event) {
        var cl = this.log.call('detectParamsAndRun', arguments.length + " params");
        var cmdParams;
        var thirdParamIsEvent = !event && eventOrParams && typeof eventOrParams.altKey !== 'undefined';
        cl.add("might cycle parameters. third is event=" + thirdParamIsEvent);
        if (thirdParamIsEvent) {
            // no event param, but settings contains the event-object
            cl.add('cycling params; event missing & eventOrSettings seems to be an event; settings assumed empty');
            event = eventOrParams; // move it to the correct variable
            cmdParams = this.runParamsHelper.getParamsFromNameOrParams(nameOrParams);
        }
        else {
            cmdParams = __assign(__assign({}, (eventOrParams || {})), this.runParamsHelper.getParamsFromNameOrParams(nameOrParams));
        }
        // ensure we have the right event despite browser differences
        event = event || window.event;
        var result = this.run(context, cmdParams, event);
        return cl.return(result);
    };
    /**
     * run a command
     * this method expects a clear order of parameters
     * @param context
     * @param settings
     * @param event
     */
    CmsEngine.prototype.run = function (context, nameOrParams, event, wipParamsWithWorkflow) {
        var cl = this.log.call('run<T>');
        var cmdParams = this.runParamsHelper.getParamsFromNameOrParams(nameOrParams);
        cmdParams = this.runParamsHelper.expandParamsWithDefaults(cmdParams);
        var origEvent = event;
        var name = cmdParams.action;
        var contentType = cmdParams.contentType;
        cl.add("run command '" + name + "' for type " + contentType);
        // Toolbar API v2
        var command = new _toolbar_config__WEBPACK_IMPORTED_MODULE_5__["ButtonCommand"](name, contentType, cmdParams);
        var newButtonConfig = new _toolbar_config__WEBPACK_IMPORTED_MODULE_5__["Button"](command, command.name);
        // merge conf & settings, but settings has higher priority
        var button = __assign(__assign({}, newButtonConfig), _toolbar_config_loaders_config_formats_in_page_button__WEBPACK_IMPORTED_MODULE_6__["InPageButtonJson"].toButton(cmdParams));
        // attach to context for inner calls which might access it
        context.button = button;
        cl.data('button', context.button);
        // New in 11.12 - find commandWorkflow of toolbar or use a dummy so the remaining code will always work
        // note: in cases where the click comes from elsewhere (like from the quick-dialog) there is no event
        // New in 12.10 - Workflow can be provided by run-call
        var wf;
        if (wipParamsWithWorkflow === null || wipParamsWithWorkflow === void 0 ? void 0 : wipParamsWithWorkflow.workflows) {
            wf = new _workflow_workflow_manager__WEBPACK_IMPORTED_MODULE_8__["WorkflowManager"](this.log);
            wf.add(wipParamsWithWorkflow.workflows);
        }
        else
            wf = _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowHelper"].getWorkflow(origEvent === null || origEvent === void 0 ? void 0 : origEvent.target);
        // Attach to context, so it's available after running the command
        context.commandWorkflow = wf;
        var wrapperPromise = wf.run(new _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowArguments"](name, _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowPhases"].before, context));
        // In case we don't have special code, use generic code
        var commandPromise = button.code;
        if (!commandPromise) {
            cl.add('button, no code - generating code to open standard dialog');
            commandPromise = CmsEngine.openDialog;
        }
        // get button configuration to detect if it's only a UI action (like the more-button)
        var finalPromise;
        if (new _toolbar_config__WEBPACK_IMPORTED_MODULE_5__["ButtonSafe"](button, context).uiActionOnly()) {
            cl.add('UI command, no pre-flight to ensure content-block');
            finalPromise = wrapperPromise.then(function (wfArgs) { return _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowHelper"].isCancelled(wfArgs)
                ? Promise.resolve(null)
                : commandPromise(context, origEvent); });
        }
        else {
            // if more than just a UI-action, then it needs to be sure the content-group is created first
            cl.add('command might change data, wrap in pre-flight to ensure content-block');
            finalPromise = wrapperPromise.then(function (wfArgs) { return _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowHelper"].isCancelled(wfArgs)
                ? Promise.resolve(null)
                : _contentBlock_content_block_editor__WEBPACK_IMPORTED_MODULE_0__["ContentBlockEditor"].singleton()
                    .prepareToAddContent(context, cmdParams.useModuleList)
                    .then(function () { return commandPromise(context, origEvent); }); });
        }
        // Attach post-command workflow
        var promiseWithAfterEffects = finalPromise.then(function (result) {
            return wf.run(new _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowArguments"](name, _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowPhases"].after, null, result))
                .then(function () { return result; });
        });
        return cl.return(promiseWithAfterEffects);
    };
    /**
     * Open a new dialog of the angular-ui
     */
    CmsEngine.openDialog = function (context, event) {
        var log = new _logging__WEBPACK_IMPORTED_MODULE_3__["Log"]('Cms.OpnDlg');
        _logging__WEBPACK_IMPORTED_MODULE_3__["Insights"].add('cms', 'open-dialog', log);
        // the link contains everything to open a full dialog (lots of params added)
        var link = new _command_link_generator__WEBPACK_IMPORTED_MODULE_9__["CommandLinkGenerator"](context, log).getLink();
        var btn = new _toolbar_config__WEBPACK_IMPORTED_MODULE_5__["ButtonSafe"](context.button, context);
        var origEvent = event || window.event;
        return new Promise(function (resolve) {
            // prepare promise for callback when the dialog closes
            // to reload the in-page view w/ajax or page reload
            var completePromise = function () {
                // call the normal promise-resolve so the `.then` will be continued
                resolve(context);
                // reload the UI as specified
                _contentBlock_render__WEBPACK_IMPORTED_MODULE_1__["renderer"].reloadAndReInitialize(context);
            };
            // check if inline window (quick-dialog)
            if (btn.inlineWindow()) {
                // test if it should be full screen (value or resolve-function)
                _quick_dialog_quick_dialog__WEBPACK_IMPORTED_MODULE_4__["QuickDialog"].singleton()
                    .showOrToggleFromToolbar(context, link, btn.fullScreen(), btn.dialog())
                    .then(function (isChanged) { if (isChanged)
                    completePromise(); });
            }
            else {
                // else it's a normal pop-up dialog
                var isNewWindow = btn.newWindow();
                // check if new-window
                if (isNewWindow || (origEvent === null || origEvent === void 0 ? void 0 : origEvent.shiftKey)) {
                    // resolve promise, as the window won't report when closed
                    resolve(context);
                    window.open(link);
                }
                else {
                    _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_2__["$2sxcInPage"].totalPopup.open(link, completePromise);
                }
            }
        });
    };
    return CmsEngine;
}(_logging__WEBPACK_IMPORTED_MODULE_3__["HasLog"]));



/***/ }),

/***/ "./src/commands/engine/run-parameters.ts":
/*!***********************************************!*\
  !*** ./src/commands/engine/run-parameters.ts ***!
  \***********************************************/
/*! exports provided: RunParametersHelper */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RunParametersHelper", function() { return RunParametersHelper; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/commands/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


/**
 * Helper class to process parameters given to the Cms.Run statement
 * Important because certain params may sometimes be full objects, and sometimes just a name.
 * In addition, even if we have more than the name, we must ensure that defaults are also included
 *
 * @export
 * @class RunParameters
 */
var RunParametersHelper = /** @class */ (function (_super) {
    __extends(RunParametersHelper, _super);
    function RunParametersHelper(parentLog) {
        return _super.call(this, 'Cmd.RunPrm', parentLog, 'start') || this;
    }
    /**
     * name or settings adapter to settings
     * @param nameOrSettings
     * @returns settings
     */
    RunParametersHelper.prototype.getParamsFromNameOrParams = function (nameOrSettings) {
        var cl = this.log.call('getParamsFromNameOrParams', "" + nameOrSettings);
        // check if nameOrString is name (string) or object (settings)
        var nameIsString = typeof nameOrSettings === 'string';
        cl.add("adapting settings; name string: " + nameIsString + "; name = " + nameOrSettings);
        var result = (nameIsString
            ? { action: nameOrSettings }
            : nameOrSettings);
        return cl.return(result);
    };
    /**
     * Take a settings-name or partial settings object,
     * and return a full settings object with all defaults from
     * the command definition
     * @param params
     */
    RunParametersHelper.prototype.expandParamsWithDefaults = function (params) {
        var cl = this.log.call('expandParamsWithDefaults');
        var name = params.action;
        cl.add("will add defaults for " + name + " from buttonConfig");
        var defaults = ___WEBPACK_IMPORTED_MODULE_0__["Commands"].singleton().get(name).buttonDefaults;
        cl.data('defaults to merge', defaults);
        // TODO: 2dm - suspicious cast
        // merge conf & settings, but...?
        return cl.return(__assign(__assign({}, defaults), params));
    };
    return RunParametersHelper;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/commands/engine/run-params.ts":
/*!*******************************************!*\
  !*** ./src/commands/engine/run-params.ts ***!
  \*******************************************/
/*! exports provided: is$sxcRunParams, isRunParamsInstance, ensureRunParamsInstanceOrError */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "is$sxcRunParams", function() { return is$sxcRunParams; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isRunParamsInstance", function() { return isRunParamsInstance; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ensureRunParamsInstanceOrError", function() { return ensureRunParamsInstanceOrError; });
/* harmony import */ var _$2sxc_src__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../$2sxc/src */ "../$2sxc/src/index.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");


/**
 * Checks if the run params are complete, as would be used in the $2sxc.cms.run
 */
function is$sxcRunParams(o) {
    var t = o;
    return (t.tag != null || (t.context != null && (Object(_$2sxc_src__WEBPACK_IMPORTED_MODULE_0__["isContextIdentifier"])(t.context) || _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__["SxcEdit"].is(t.context)))) &&
        isRunParamsInstance(t);
}
/**
 * Checks if it's at least an instance run param - having at least `action` or `params`
 */
function isRunParamsInstance(maybeRunParams) {
    var typed = maybeRunParams;
    return (typed.action != null || typed.params != null);
}
var runContextInstanceMinimalRequirements = "'action' and/or 'params'";
var errPrefix = 'sxc instance run() expects runParams';
function ensureRunParamsInstanceOrError(runParams) {
    if (!isRunParamsInstance(runParams))
        throw errPrefix + " with at least " + runContextInstanceMinimalRequirements;
    if (runParams.context)
        throw errPrefix + " without 'context' since it already provides the context";
}


/***/ }),

/***/ "./src/commands/engine/sxc-instance-engine.ts":
/*!****************************************************!*\
  !*** ./src/commands/engine/sxc-instance-engine.ts ***!
  \****************************************************/
/*! exports provided: SxcInstanceEngine */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcInstanceEngine", function() { return SxcInstanceEngine; });
/* harmony import */ var _cms_Cms__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../cms/Cms */ "./src/cms/Cms.ts");
/* harmony import */ var _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../context/bundles/context-bundle-button */ "./src/context/bundles/context-bundle-button.ts");


/**
 * This is an engine on the sxc object.
 * It provides a .run(...) for when the sxc is already known.
 */
var SxcInstanceEngine = /** @class */ (function () {
    function SxcInstanceEngine(sxc) {
        this.sxc = sxc;
    }
    SxcInstanceEngine.prototype.run = function (nameOrSettings, eventOrSettings, event) {
        // Capture cases where this is called using the new/modern params, which is a mistake
        if (nameOrSettings.context || nameOrSettings.workflows)
            throw "You are calling '.manage.run(...)' with a parameter 'context'. You should probably be calling the new '.cms.run(...)' instead.";
        var cntx = _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_1__["ContextComplete"].findContext(this.sxc);
        return new _cms_Cms__WEBPACK_IMPORTED_MODULE_0__["Cms"]().run(cntx, nameOrSettings, eventOrSettings, event);
    };
    return SxcInstanceEngine;
}());



/***/ }),

/***/ "./src/commands/index.ts":
/*!*******************************!*\
  !*** ./src/commands/index.ts ***!
  \*******************************/
/*! exports provided: Command, Commands, SharedLogic, CmdAdd, CmdAddExisting, CmdAppImport, CmdAppResources, CmdAppSettings, CmdApp, CmdContentItems, ContentListActionParams, Actions, CmdContentType, CmdCustom, CmdDelete, CmdEdit, CmdEditDialog, CmdInsightsServer, CmdInstanceList, CmdLayout, CmdMetadata, CmdMore, CmdMoveDown, CmdMoveUp, CmdNew, CmdNewMode, CmdPublish, CmdRemove, CmdReplace, CmdTemplateDevelop, CmdTemplateQuery, CmdTemplateSettings, CmdZone, SpecialCommands, CmsEngine, SxcInstanceEngine */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _command__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./command */ "./src/commands/command.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Command", function() { return _command__WEBPACK_IMPORTED_MODULE_0__["Command"]; });

/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commands */ "./src/commands/commands.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Commands", function() { return _commands__WEBPACK_IMPORTED_MODULE_1__["Commands"]; });

/* harmony import */ var _command_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./command/index */ "./src/commands/command/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SharedLogic", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["SharedLogic"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAdd", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdAdd"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAddExisting", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdAddExisting"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAppImport", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdAppImport"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAppResources", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdAppResources"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdAppSettings", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdAppSettings"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdApp", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdApp"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdContentItems", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdContentItems"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContentListActionParams", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["ContentListActionParams"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Actions", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["Actions"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdContentType", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdContentType"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdCustom", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdCustom"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdDelete", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdDelete"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdEdit", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdEdit"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdEditDialog", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdEditDialog"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdInsightsServer", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdInsightsServer"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdInstanceList", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdInstanceList"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdLayout", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdLayout"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMetadata", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdMetadata"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMore", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdMore"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMoveDown", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdMoveDown"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdMoveUp", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdMoveUp"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdNew", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdNew"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdNewMode", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdNewMode"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdPublish", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdPublish"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdRemove", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdRemove"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdReplace", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdReplace"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateDevelop", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdTemplateDevelop"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateQuery", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdTemplateQuery"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdTemplateSettings", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdTemplateSettings"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmdZone", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["CmdZone"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SpecialCommands", function() { return _command_index__WEBPACK_IMPORTED_MODULE_2__["SpecialCommands"]; });

/* harmony import */ var _engine_cms_engine__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./engine/cms-engine */ "./src/commands/engine/cms-engine.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CmsEngine", function() { return _engine_cms_engine__WEBPACK_IMPORTED_MODULE_3__["CmsEngine"]; });

/* harmony import */ var _engine_sxc_instance_engine__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./engine/sxc-instance-engine */ "./src/commands/engine/sxc-instance-engine.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcInstanceEngine", function() { return _engine_sxc_instance_engine__WEBPACK_IMPORTED_MODULE_4__["SxcInstanceEngine"]; });








/***/ }),

/***/ "./src/constants/content-block.ts":
/*!****************************************!*\
  !*** ./src/constants/content-block.ts ***!
  \****************************************/
/*! exports provided: ContentBlock, ContentBlockIds */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContentBlock", function() { return ContentBlock; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContentBlockIds", function() { return ContentBlockIds; });
/*
* This just holds some constants, but it looks like _LayoutElement is unused - but I think it should be!
*/
var ContentBlock = /** @class */ (function () {
    function ContentBlock() {
    }
    // constants
    ContentBlock.cViewWithoutContent = '_LayoutElement'; // needed to differentiate the "select item" from the "empty-is-selected" which are both empty
    ContentBlock.UseExistingTemplate = -1;
    return ContentBlock;
}());

/** ContentBlock constants  */
var ContentBlockIds = {
    classes: {
        name: 'sc-content-block',
    },
    selectors: {
        ofName: '.sc-content-block',
    },
};


/***/ }),

/***/ "./src/constants/debug.ts":
/*!********************************!*\
  !*** ./src/constants/debug.ts ***!
  \********************************/
/*! exports provided: Debug */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Debug", function() { return Debug; });
var Debug = {
    cms: {
        autoDump: false,
        run: true,
    },
};


/***/ }),

/***/ "./src/constants/dialog-paths.ts":
/*!***************************************!*\
  !*** ./src/constants/dialog-paths.ts ***!
  \***************************************/
/*! exports provided: DialogPaths */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DialogPaths", function() { return DialogPaths; });
var DialogPaths;
(function (DialogPaths) {
    DialogPaths["quickDialog"] = "dist/ng/ui.html";
    DialogPaths["ng8"] = "dist/ng-edit/index.html";
})(DialogPaths || (DialogPaths = {}));


/***/ }),

/***/ "./src/constants/ids.ts":
/*!******************************!*\
  !*** ./src/constants/ids.ts ***!
  \******************************/
/*! exports provided: IDs */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "IDs", function() { return IDs; });
var IDs = {
    // classes
    cls: {
        scMenu: 'sc-menu',
    },
    attr: {
        toolbar: 'toolbar',
        toolbarData: 'data-toolbar',
        settings: 'settings',
        settingsData: 'data-settings',
    },
    publishAllowed: 'DraftOptional',
    sel: {
        scMenu: '.sc-menu',
        tagScMenu: 'ul.sc-menu',
    },
};


/***/ }),

/***/ "./src/constants/index.ts":
/*!********************************!*\
  !*** ./src/constants/index.ts ***!
  \********************************/
/*! exports provided: C */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "C", function() { return C; });
/* harmony import */ var _content_block__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./content-block */ "./src/constants/content-block.ts");
/* harmony import */ var _debug__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./debug */ "./src/constants/debug.ts");
/* harmony import */ var _dialog_paths__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dialog-paths */ "./src/constants/dialog-paths.ts");
/* harmony import */ var _ids__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ids */ "./src/constants/ids.ts");
/* harmony import */ var _toolbar__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./toolbar */ "./src/constants/toolbar.ts");





/**
 * Attribute Names used in the HTML
 */
var Attributes = {
    InstanceId: 'data-cb-instance',
    Context: 'data-edit-context',
    ContentBlockId: 'data-cb-id',
};
var C = {
    ContentBlock: _content_block__WEBPACK_IMPORTED_MODULE_0__["ContentBlock"],
    DialogPaths: _dialog_paths__WEBPACK_IMPORTED_MODULE_2__["DialogPaths"],
    IDs: _ids__WEBPACK_IMPORTED_MODULE_3__["IDs"],
    AttrNames: Attributes,
    ClsNames: {
        UnInitialized: 'sc-uninitialized',
        UnAvailable: 'sc-unavailable',
    },
    Toolbar: _toolbar__WEBPACK_IMPORTED_MODULE_4__["ToolbarConstants"],
    Cb: _content_block__WEBPACK_IMPORTED_MODULE_0__["ContentBlockIds"],
    Debug: _debug__WEBPACK_IMPORTED_MODULE_1__["Debug"],
    Sel: {
        SxcDivs: "div[" + Attributes.Context + "]",
    },
};


/***/ }),

/***/ "./src/constants/toolbar.ts":
/*!**********************************!*\
  !*** ./src/constants/toolbar.ts ***!
  \**********************************/
/*! exports provided: ToolbarConstants */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarConstants", function() { return ToolbarConstants; });
// The parts themselves must also be constants
var ToolbarConstants = {
    attrToMarkInitalized: '2sxc-tagtoolbar',
    attr: {
        full: 'sxc-toolbar',
        hover: 'sxc-toolbar-hover',
        disable: 'data-disable-toolbar',
    },
    classes: {
        oldHover: 'sc-element',
    },
    selectors: {
        ofOldHover: '.sc-element',
    },
    eventNames: {
        onInit: 'toolbar-init',
    },
};


/***/ }),

/***/ "./src/contentBlock/content-block-editor.ts":
/*!**************************************************!*\
  !*** ./src/contentBlock/content-block-editor.ts ***!
  \**************************************************/
/*! exports provided: ContentBlockEditor */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContentBlockEditor", function() { return ContentBlockEditor; });
/* harmony import */ var _constants_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../constants/index */ "./src/constants/index.ts");
/* harmony import */ var _html_dom_tools__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../html/dom-tools */ "./src/html/dom-tools.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _render__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./render */ "./src/contentBlock/render.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




//#region WebApi Endpoints used: 2sxc
var webApiRender = 'cms/block/render';
var webApiSave = 'cms/block/template';
//#endregion
var ContentBlockEditor = /** @class */ (function (_super) {
    __extends(ContentBlockEditor, _super);
    function ContentBlockEditor() {
        var _this = _super.call(this, 'Sys.CbEdit') || this;
        _logging__WEBPACK_IMPORTED_MODULE_2__["Insights"].add('system', 'cb-editor-api', _this.log);
        return _this;
    }
    /** Singleton */
    ContentBlockEditor.singleton = function () {
        var _a;
        return (_a = this._singleton) !== null && _a !== void 0 ? _a : (this._singleton = new ContentBlockEditor());
    };
    /**
     * prepare the instance so content can be added
     * this ensure the content-group has been created, which is required to add content
     * @param {ContextComplete} context
     */
    ContentBlockEditor.prototype.prepareToAddContent = function (context, useModuleList) {
        var cl = this.log.call('prepareToAddContent');
        var isCreated = context.contentBlock.isCreated;
        if (isCreated || !useModuleList)
            return cl.return(Promise.resolve());
        // persist the template
        var promise = this.updateTemplate(context, context.contentBlock.templateId, true);
        return cl.return(promise, 'ok');
    };
    /**
     * Update the template and adjust UI accordingly.
     * @param {ContextComplete} context
     * @param {number} templateId
     * @param {boolean} forceCreate
     */
    ContentBlockEditor.prototype.updateTemplateFromDia = function (context, templateId) {
        var cl = this.log.call('updateTemplateFromDia', "..., " + templateId);
        var wasShowingPreview = _html_dom_tools__WEBPACK_IMPORTED_MODULE_1__["HtmlTools"].isDisabled(context.sxc);
        cl.add("wasShowingPreview: " + wasShowingPreview);
        var promise = this.updateTemplate(context, templateId, false)
            .then(function () {
            // only reload on ajax, not on app as that was already re-loaded on the preview
            // necessary to show the original template again
            if (wasShowingPreview)
                _render__WEBPACK_IMPORTED_MODULE_3__["renderer"].reloadAndReInitialize(context);
        });
        return cl.return(promise);
    };
    /**
     * Retrieve the preview from the web-api
     * @param {ContextComplete} context
     * @param {number} templateId
     * @returns {promise} promise with the html in the result
     */
    ContentBlockEditor.prototype.getPreviewWithTemplate = function (context, templateId) {
        var cl = this.log.call('getPreviewWithTemplate', "..., " + templateId);
        templateId = templateId || _constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].ContentBlock.UseExistingTemplate; // fallback, meaning use saved ID
        var params = {
            templateId: templateId,
            lang: context.app.currentLanguage,
            cbid: context.contentBlockReference.id,
            originalparameters: JSON.stringify(context.instance.parameters),
        };
        cl.data('params', params);
        var promise = context.sxc.webApi.fetch(context.sxc.webApi.url(webApiRender, params))
            .then(function (response) { return response.text(); });
        return cl.return(promise);
    };
    /**
     * Update the template.
     */
    ContentBlockEditor.prototype.updateTemplate = function (context, templateId, forceCreate) {
        var cl = this.log.call('updateTemplate');
        var promise = this.saveTemplate(context, templateId, forceCreate)
            .then(function (data) {
            if (!data)
                return null;
            // fixes a special case where the guid is given with quotes (depends on version of angularjs) issue #532
            var newGuid = data.replace(/[\",\']/g, '');
            if (console)
                console.log("created content group {" + newGuid + "}");
            return context.contentBlock.contentGroupId = newGuid;
        }).catch(function () {
            // error handling
            return alert('error - result not ok, was not able to create ContentGroup');
        });
        return cl.return(promise);
    };
    /**
     * Save the template configuration for this instance
     * @param {ContextComplete} context
     * @param {number} templateId
     * @param {boolean} [forceCreateContentGroup]
     * @returns {promise}
     */
    ContentBlockEditor.prototype.saveTemplate = function (context, templateId, forceCreateContentGroup) {
        var cl = this.log.call('saveTemplate');
        var params = {
            templateId: templateId,
            forceCreateContentGroup: forceCreateContentGroup,
            newTemplateChooserState: false,
        };
        cl.data('params', params);
        var promise = context.sxc.webApi.fetchJson(context.sxc.webApi.url(webApiSave, params), undefined, 'POST');
        return cl.return(promise);
    };
    return ContentBlockEditor;
}(_logging__WEBPACK_IMPORTED_MODULE_2__["HasLog"]));



/***/ }),

/***/ "./src/contentBlock/render.ts":
/*!************************************!*\
  !*** ./src/contentBlock/render.ts ***!
  \************************************/
/*! exports provided: renderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "renderer", function() { return renderer; });
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../commands */ "./src/commands/index.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _html_dom_tools__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../html/dom-tools */ "./src/html/dom-tools.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../interfaces/window-in-page */ "./src/interfaces/window-in-page.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _quick_edit_quick_e__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../quick-edit/quick-e */ "./src/quick-edit/quick-e.ts");
/* harmony import */ var _workflow__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../workflow */ "./src/workflow/index.ts");
/* harmony import */ var _content_block_editor__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./content-block-editor */ "./src/contentBlock/content-block-editor.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __spreadArrays = (undefined && undefined.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};









/**
 * This is the rendering compontent, responsible to update the page when something changes.
 * Depending on the feature-set it will use ajax or not
 */
var RendererGlobal = /** @class */ (function (_super) {
    __extends(RendererGlobal, _super);
    function RendererGlobal() {
        var _this = _super.call(this, 'Rnd.Rndrer') || this;
        _logging__WEBPACK_IMPORTED_MODULE_5__["Insights"].add('system', 'renderer', _this.log);
        return _this;
    }
    /**
     * Show a message where the content of a module should be - usually as placeholder till something else happens
     * @param {ContextComplete} context
     * @param {string} newContent
     * @returns {} nothing
     */
    RendererGlobal.prototype.showMessage = function (context, newContent) {
        _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_3__["SxcEdit"].getTag(context.sxc).innerHTML = newContent;
    };
    /**
     * this one assumes a replace / change has already happened, but now must be finalized...
     * @param {ContextComplete} context
     * @param {boolean} forceAjax
     * @param {boolean} preview
     */
    RendererGlobal.prototype.reloadAndReInitialize = function (context, forceAjax, preview) {
        var _this = this;
        var _a;
        var cl = this.log.call('reloadAndReInitialize', "..., forceAjax: " + forceAjax + ", preview: " + preview, null, { context: context });
        // get workflow engine or a dummy engine
        var wf = (_a = context.commandWorkflow) !== null && _a !== void 0 ? _a : _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowHelper"].getDummyManager();
        var promiseChain = wf.run(new _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowArguments"](_commands__WEBPACK_IMPORTED_MODULE_0__["SpecialCommands"].refresh, _workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowPhases"].before, context));
        // 2021-02-21 2dm New in 11.12 enable toolbar to not reload in a SPA scenario
        var finalPromise = promiseChain.then(function (wfArgs) {
            if (_workflow__WEBPACK_IMPORTED_MODULE_7__["WorkflowHelper"].isCancelled(wfArgs)) {
                cl.add('Workflow return false, will cancel and not refresh.');
                return Promise.resolve();
            }
            // if ajax is not supported, we must reload the whole page
            if (!forceAjax && !context.app.supportsAjax) {
                cl.done('not ajax - reloading page');
                _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_4__["windowInPage"].location.reload();
                return Promise.resolve();
            }
            cl.add('is ajax, calling ajaxReload');
            return _this.ajaxLoad(context, _constants__WEBPACK_IMPORTED_MODULE_1__["C"].ContentBlock.UseExistingTemplate, preview)
                .then(function (result) {
                // If Evoq, tell Evoq that page has changed if it has changed (Ajax call)
                if (_interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_4__["windowInPage"].dnn_tabVersioningEnabled) { // this only exists in evoq or on new DNNs with tabVersioning
                    cl.add('system is using tabVersioning - will inform DNN');
                    try {
                        _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_4__["windowInPage"].dnn.ContentEditorManager.triggerChangeOnPageContentEvent();
                    }
                    catch (e) { /* ignore */ }
                }
                return cl.return(result);
            })
                .catch(function (error) { return console.log('Error in reloadAndReInitialize', error); });
        });
        return finalPromise;
    };
    /**
     * ajax-call, then replace
     * @param {ContextComplete} context
     * @param {number} alternateTemplateId
     * @param {boolean} justPreview
     */
    RendererGlobal.prototype.ajaxLoad = function (context, alternateTemplateId, justPreview) {
        var _this = this;
        var cl = this.log.call('ajaxLoad');
        cl.add('starting promise chain');
        return _content_block_editor__WEBPACK_IMPORTED_MODULE_8__["ContentBlockEditor"].singleton().getPreviewWithTemplate(context, alternateTemplateId)
            .then(function (result) {
            cl.add("get preview done, let's replace the content");
            _this.replaceContentBlock(context, result, justPreview);
        })
            .then(function () {
            cl.add('replace done, resetting quickE');
            _quick_edit_quick_e__WEBPACK_IMPORTED_MODULE_6__["QuickE"].singleton().reset(); // reset quick-edit, because the config could have changed
            cl.done();
        });
    };
    /**
     * ajax update/replace the content of the content-block
     * optionally also initialize the toolbar (if not just preview)
     * @param {ContextComplete} context
     * @param {string} newContent
     * @param {boolean} justPreview
     */
    RendererGlobal.prototype.replaceContentBlock = function (context, newContent, justPreview) {
        var cl = this.log.call('replaceContentBlock');
        try {
            try {
                var newContentObj = JSON.parse(newContent);
                var newHeadHtml = newContentObj.Resources
                    .map(function (resource) {
                    if (resource.Type === 'js') {
                        return "<script type=\"text/javascript\" src=\"" + resource.Url + "\"></script>";
                    }
                    if (resource.Type === 'css') {
                        return "<link rel=\"stylesheet\" href=\"" + resource.Url + "\">";
                    }
                })
                    .filter(function (resource) { return resource != null; })
                    .join('\n');
                var newHead = _logging__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].domFromString(newHeadHtml);
                var newDom = _logging__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].domFromString(newContentObj.Html)[0];
                _logging__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].append(document.head, newHead, false);
                // Must disable toolbar before we attach to DOM
                if (justPreview)
                    _html_dom_tools__WEBPACK_IMPORTED_MODULE_2__["HtmlTools"].disable(newDom);
                _logging__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].replaceWith(_interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_3__["SxcEdit"].getTag(context.sxc), newDom, false);
                // run scripts manually to ensure proper timing
                var scripts = __spreadArrays(newHead.filter(function (asset) { return asset.tagName.toLocaleLowerCase() === 'script'; }), Array.from(newDom.querySelectorAll('script')));
                _logging__WEBPACK_IMPORTED_MODULE_5__["AssetsLoader"].runScripts(scripts, undefined);
            }
            catch (_a) {
                var newDom = _logging__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].domFromString(newContent)[0];
                // Must disable toolbar before we attach to DOM
                if (justPreview)
                    _html_dom_tools__WEBPACK_IMPORTED_MODULE_2__["HtmlTools"].disable(newDom);
                _logging__WEBPACK_IMPORTED_MODULE_5__["NoJQ"].replaceWith(_interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_3__["SxcEdit"].getTag(context.sxc), newDom, true);
            }
            // reset the cache, so the sxc-object is refreshed
            context.sxc.recreate(true);
        }
        catch (e) {
            console.log('Error while rendering template:', e);
        }
        cl.done();
    };
    return RendererGlobal;
}(_logging__WEBPACK_IMPORTED_MODULE_5__["HasLog"]));
var renderer = new RendererGlobal();


/***/ }),

/***/ "./src/context/bundles/context-bundle-button.ts":
/*!******************************************************!*\
  !*** ./src/context/bundles/context-bundle-button.ts ***!
  \******************************************************/
/*! exports provided: ContextComplete */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextComplete", function() { return ContextComplete; });
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../plumbing */ "./src/plumbing/index.ts");
/* harmony import */ var _context_bundle_toolbar__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./context-bundle-toolbar */ "./src/context/bundles/context-bundle-toolbar.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



var ContextComplete = /** @class */ (function (_super) {
    __extends(ContextComplete, _super);
    function ContextComplete(editCtx, sxc) {
        return _super.call(this, editCtx, sxc) || this;
        // note that the button will not be filled here, as it will be filled somewhere else
    }
    /**
     * Primary API to get the context (context is cached)
     * @param htmlElement or Id (moduleId)
     * @param cbid
     */
    ContextComplete.findContext = function (tagOrSxc, cbid) {
        // 2021-09-17 spm assume this function doesn't use jquery
        var sxc;
        var containerTag = null;
        if (_interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].is(tagOrSxc)) { // it is SxcInstance
            sxc = tagOrSxc;
        }
        else if (typeof tagOrSxc === 'number') { // it is number
            sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].get(tagOrSxc, cbid);
        }
        else { // it is HTMLElement
            sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].get(tagOrSxc);
            containerTag = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].getContainerTag(tagOrSxc);
        }
        var contextOfButton = ContextComplete.getContextInstance(sxc, containerTag);
        contextOfButton.sxc = sxc;
        return contextOfButton;
    };
    /**
     * Create copy of context, so it can be modified before use
     * @param htmlElement or Id (moduleId)
     * @param cbid
     */
    ContextComplete.contextCopy = function (htmlElementOrId, cbid) {
        var contextOfButton = ContextComplete.findContext(htmlElementOrId, cbid);
        // set sxc to null because of cyclic reference, so we can serialize it
        contextOfButton.sxc = null;
        // make a copy
        var copyOfContext = _plumbing__WEBPACK_IMPORTED_MODULE_1__["Obj"].DeepClone(contextOfButton); // JSON.parse(JSON.stringify(contextOfButton));
        // bring sxc back to context
        contextOfButton.sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].get(htmlElementOrId);
        return copyOfContext;
    };
    /**
     * Create new context
     * @param sxc
     * @param htmlElement
     */
    ContextComplete.getContextInstance = function (sxc, htmlElement) {
        var editContext = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].getEditContext(sxc, htmlElement);
        return new ContextComplete(editContext, sxc);
    };
    return ContextComplete;
}(_context_bundle_toolbar__WEBPACK_IMPORTED_MODULE_2__["ContextBundleToolbar"]));



/***/ }),

/***/ "./src/context/bundles/context-bundle-content.ts":
/*!*******************************************************!*\
  !*** ./src/context/bundles/context-bundle-content.ts ***!
  \*******************************************************/
/*! exports provided: ContextBundleContent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextBundleContent", function() { return ContextBundleContent; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/context/index.ts");
/* harmony import */ var _html_attribute_parts_content_block__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../html-attribute/parts/content-block */ "./src/context/html-attribute/parts/content-block.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var ContextBundleContent = /** @class */ (function (_super) {
    __extends(ContextBundleContent, _super);
    function ContextBundleContent(editCtx, sxc) {
        var _this = _super.call(this, editCtx, sxc) || this;
        // information about the current item
        _this.item = new ___WEBPACK_IMPORTED_MODULE_0__["ContextOfItem"](editCtx);
        _this.contentBlockReference = new _html_attribute_parts_content_block__WEBPACK_IMPORTED_MODULE_1__["ContentBlockReference"](editCtx.contentBlockReference);
        // information related to the current contentBlock
        _this.contentBlock = new ___WEBPACK_IMPORTED_MODULE_0__["ContextOfContentBlock"](editCtx);
        return _this;
    }
    return ContextBundleContent;
}(___WEBPACK_IMPORTED_MODULE_0__["ContextBundleInstance"]));



/***/ }),

/***/ "./src/context/bundles/context-bundle-instance.ts":
/*!********************************************************!*\
  !*** ./src/context/bundles/context-bundle-instance.ts ***!
  \********************************************************/
/*! exports provided: ContextBundleInstance */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextBundleInstance", function() { return ContextBundleInstance; });
/* harmony import */ var _parts__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../parts */ "./src/context/parts/index.ts");
/* harmony import */ var _parts_context_app__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../parts/context-app */ "./src/context/parts/context-app.ts");
/* harmony import */ var _parts_context_ui__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../parts/context-ui */ "./src/context/parts/context-ui.ts");



var ContextBundleInstance = /** @class */ (function () {
    function ContextBundleInstance(editCtx, sxc) {
        this._isContext = true;
        // this will be about the current app, settings of the app, app - paths, etc.
        this.app = new _parts_context_app__WEBPACK_IMPORTED_MODULE_1__["ContextOfApp"](editCtx, sxc);
        // information related to the current DNN module, incl.instanceId, etc.
        this.instance = new _parts__WEBPACK_IMPORTED_MODULE_0__["ContextOfInstance"](editCtx, sxc);
        // things about the user
        this.user = new _parts__WEBPACK_IMPORTED_MODULE_0__["ContextOfUser"](editCtx);
        // this will be information related to the current page
        this.page = new _parts__WEBPACK_IMPORTED_MODULE_0__["ContextOfPage"](editCtx, sxc);
        // this will be everything about the current system, like system / api -paths etc.
        this.system = new _parts__WEBPACK_IMPORTED_MODULE_0__["ContextOfSystem"](editCtx);
        // this will be something about the current tenant(the dnn portal)
        this.tenant = new _parts__WEBPACK_IMPORTED_MODULE_0__["ContextOfTenant"](editCtx);
        // ensure that the UI will load the correct assets to enable editing
        this.ui = new _parts_context_ui__WEBPACK_IMPORTED_MODULE_2__["ContextOfUi"](editCtx);
    }
    ContextBundleInstance.is = function (thing) {
        var maybeButton = thing;
        return maybeButton.sxc !== undefined && maybeButton.instance !== undefined;
    };
    return ContextBundleInstance;
}());



/***/ }),

/***/ "./src/context/bundles/context-bundle-toolbar.ts":
/*!*******************************************************!*\
  !*** ./src/context/bundles/context-bundle-toolbar.ts ***!
  \*******************************************************/
/*! exports provided: ContextBundleToolbar */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextBundleToolbar", function() { return ContextBundleToolbar; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/context/bundles/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};

var ContextBundleToolbar = /** @class */ (function (_super) {
    __extends(ContextBundleToolbar, _super);
    function ContextBundleToolbar(editCtx, sxc) {
        return _super.call(this, editCtx, sxc) || this;
        // note that the toolbar will not be filled here, as it will be filled somewhere else
    }
    ContextBundleToolbar.prototype.forButton = function (button) {
        // the ContextBundleButton is the same as toolbar, just with .button
        var clone = __assign({}, this);
        clone.button = button;
        return clone;
    };
    return ContextBundleToolbar;
}(___WEBPACK_IMPORTED_MODULE_0__["ContextBundleContent"]));



/***/ }),

/***/ "./src/context/bundles/index.ts":
/*!**************************************!*\
  !*** ./src/context/bundles/index.ts ***!
  \**************************************/
/*! exports provided: ContextComplete, ContextBundleInstance, ContextBundleContent, ContextBundleToolbar */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _context_bundle_button__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./context-bundle-button */ "./src/context/bundles/context-bundle-button.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextComplete", function() { return _context_bundle_button__WEBPACK_IMPORTED_MODULE_0__["ContextComplete"]; });

/* harmony import */ var _context_bundle_instance__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./context-bundle-instance */ "./src/context/bundles/context-bundle-instance.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextBundleInstance", function() { return _context_bundle_instance__WEBPACK_IMPORTED_MODULE_1__["ContextBundleInstance"]; });

/* harmony import */ var _context_bundle_content__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./context-bundle-content */ "./src/context/bundles/context-bundle-content.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextBundleContent", function() { return _context_bundle_content__WEBPACK_IMPORTED_MODULE_2__["ContextBundleContent"]; });

/* harmony import */ var _context_bundle_toolbar__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./context-bundle-toolbar */ "./src/context/bundles/context-bundle-toolbar.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextBundleToolbar", function() { return _context_bundle_toolbar__WEBPACK_IMPORTED_MODULE_3__["ContextBundleToolbar"]; });







/***/ }),

/***/ "./src/context/html-attribute/edit-context-root.ts":
/*!*********************************************************!*\
  !*** ./src/context/html-attribute/edit-context-root.ts ***!
  \*********************************************************/
/*! exports provided: AttrJsonEditContext */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonEditContext", function() { return AttrJsonEditContext; });
var AttrJsonEditContext = /** @class */ (function () {
    function AttrJsonEditContext() {
    }
    return AttrJsonEditContext;
}());



/***/ }),

/***/ "./src/context/html-attribute/index.ts":
/*!*********************************************!*\
  !*** ./src/context/html-attribute/index.ts ***!
  \*********************************************/
/*! exports provided: ContentBlockReference, AttrJsonContentGroup, AttrJsonEditContext, AttrJsonEnvironment, AttrJsonError, AttrJsonLanguage, AttrJsonEntity, AttrJsonUi, AttrJsonUser */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _parts_content_block__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./parts/content-block */ "./src/context/html-attribute/parts/content-block.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContentBlockReference", function() { return _parts_content_block__WEBPACK_IMPORTED_MODULE_0__["ContentBlockReference"]; });

/* harmony import */ var _parts_content_group__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./parts/content-group */ "./src/context/html-attribute/parts/content-group.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonContentGroup", function() { return _parts_content_group__WEBPACK_IMPORTED_MODULE_1__["AttrJsonContentGroup"]; });

/* harmony import */ var _edit_context_root__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./edit-context-root */ "./src/context/html-attribute/edit-context-root.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonEditContext", function() { return _edit_context_root__WEBPACK_IMPORTED_MODULE_2__["AttrJsonEditContext"]; });

/* harmony import */ var _parts_environment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./parts/environment */ "./src/context/html-attribute/parts/environment.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonEnvironment", function() { return _parts_environment__WEBPACK_IMPORTED_MODULE_3__["AttrJsonEnvironment"]; });

/* harmony import */ var _parts_error__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./parts/error */ "./src/context/html-attribute/parts/error.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonError", function() { return _parts_error__WEBPACK_IMPORTED_MODULE_4__["AttrJsonError"]; });

/* harmony import */ var _parts_language__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./parts/language */ "./src/context/html-attribute/parts/language.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonLanguage", function() { return _parts_language__WEBPACK_IMPORTED_MODULE_5__["AttrJsonLanguage"]; });

/* harmony import */ var _parts_parameters_entity__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./parts/parameters-entity */ "./src/context/html-attribute/parts/parameters-entity.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonEntity", function() { return _parts_parameters_entity__WEBPACK_IMPORTED_MODULE_6__["AttrJsonEntity"]; });

/* harmony import */ var _parts_ui__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./parts/ui */ "./src/context/html-attribute/parts/ui.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonUi", function() { return _parts_ui__WEBPACK_IMPORTED_MODULE_7__["AttrJsonUi"]; });

/* harmony import */ var _parts_user__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./parts/user */ "./src/context/html-attribute/parts/user.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AttrJsonUser", function() { return _parts_user__WEBPACK_IMPORTED_MODULE_8__["AttrJsonUser"]; });












/***/ }),

/***/ "./src/context/html-attribute/parts/content-block.ts":
/*!***********************************************************!*\
  !*** ./src/context/html-attribute/parts/content-block.ts ***!
  \***********************************************************/
/*! exports provided: ContentBlockReference */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContentBlockReference", function() { return ContentBlockReference; });
/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../core */ "../core/index.ts");
/* harmony import */ var _constants_ids__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../constants/ids */ "./src/constants/ids.ts");


/**
 * This contains a pointer to a content-block. The data is always provided by the server,
 * so this class is never really instantiated.
 */
var ContentBlockReference = /** @class */ (function () {
    function ContentBlockReference(original) {
        /** How changes are published - draft required/optional */
        this.publishingMode = _constants_ids__WEBPACK_IMPORTED_MODULE_1__["IDs"].publishAllowed;
        /** ID of the reference item - very rarely used */
        this.id = _core__WEBPACK_IMPORTED_MODULE_0__["NumberNotDefinedHuge"];
        /** GUID of the parent item referencing this Content Block */
        this.parentGuid = null;
        /** Field in which this content block is references */
        this.parentField = null;
        /** Index of the reference - what position it's in in the list of that field */
        this.parentIndex = 0;
        /** If this content is part of the page */
        this.partOfPage = false;
        Object.assign(this, original);
    }
    return ContentBlockReference;
}());



/***/ }),

/***/ "./src/context/html-attribute/parts/content-group.ts":
/*!***********************************************************!*\
  !*** ./src/context/html-attribute/parts/content-group.ts ***!
  \***********************************************************/
/*! exports provided: AttrJsonContentGroup */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonContentGroup", function() { return AttrJsonContentGroup; });
var AttrJsonContentGroup = /** @class */ (function () {
    function AttrJsonContentGroup() {
    }
    return AttrJsonContentGroup;
}());



/***/ }),

/***/ "./src/context/html-attribute/parts/environment.ts":
/*!*********************************************************!*\
  !*** ./src/context/html-attribute/parts/environment.ts ***!
  \*********************************************************/
/*! exports provided: AttrJsonEnvironment */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonEnvironment", function() { return AttrJsonEnvironment; });
var AttrJsonEnvironment = /** @class */ (function () {
    function AttrJsonEnvironment() {
    }
    return AttrJsonEnvironment;
}());



/***/ }),

/***/ "./src/context/html-attribute/parts/error.ts":
/*!***************************************************!*\
  !*** ./src/context/html-attribute/parts/error.ts ***!
  \***************************************************/
/*! exports provided: AttrJsonError */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonError", function() { return AttrJsonError; });
var AttrJsonError = /** @class */ (function () {
    function AttrJsonError() {
    }
    return AttrJsonError;
}());



/***/ }),

/***/ "./src/context/html-attribute/parts/language.ts":
/*!******************************************************!*\
  !*** ./src/context/html-attribute/parts/language.ts ***!
  \******************************************************/
/*! exports provided: AttrJsonLanguage */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonLanguage", function() { return AttrJsonLanguage; });
var AttrJsonLanguage = /** @class */ (function () {
    function AttrJsonLanguage() {
    }
    return AttrJsonLanguage;
}());



/***/ }),

/***/ "./src/context/html-attribute/parts/parameters-entity.ts":
/*!***************************************************************!*\
  !*** ./src/context/html-attribute/parts/parameters-entity.ts ***!
  \***************************************************************/
/*! exports provided: AttrJsonEntity */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonEntity", function() { return AttrJsonEntity; });
var AttrJsonEntity = /** @class */ (function () {
    function AttrJsonEntity() {
    }
    return AttrJsonEntity;
}());



/***/ }),

/***/ "./src/context/html-attribute/parts/ui.ts":
/*!************************************************!*\
  !*** ./src/context/html-attribute/parts/ui.ts ***!
  \************************************************/
/*! exports provided: AttrJsonUi */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonUi", function() { return AttrJsonUi; });
var AttrJsonUi = /** @class */ (function () {
    function AttrJsonUi() {
    }
    return AttrJsonUi;
}());



/***/ }),

/***/ "./src/context/html-attribute/parts/user.ts":
/*!**************************************************!*\
  !*** ./src/context/html-attribute/parts/user.ts ***!
  \**************************************************/
/*! exports provided: AttrJsonUser */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AttrJsonUser", function() { return AttrJsonUser; });
var AttrJsonUser = /** @class */ (function () {
    function AttrJsonUser() {
    }
    return AttrJsonUser;
}());



/***/ }),

/***/ "./src/context/index.ts":
/*!******************************!*\
  !*** ./src/context/index.ts ***!
  \******************************/
/*! exports provided: ContextOfApp, ContextComplete, ContextOfContentBlock, ContextOfInstance, ContextOfItem, ContextOfPage, ContextOfSystem, ContextOfTenant, ContextBundleToolbar, ContextOfUi, ContextOfUser, ContextBundleInstance, ContextBundleContent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _parts_context_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./parts/context-app */ "./src/context/parts/context-app.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfApp", function() { return _parts_context_app__WEBPACK_IMPORTED_MODULE_0__["ContextOfApp"]; });

/* harmony import */ var _bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./bundles/context-bundle-button */ "./src/context/bundles/context-bundle-button.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextComplete", function() { return _bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_1__["ContextComplete"]; });

/* harmony import */ var _parts_context_content_block__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./parts/context-content-block */ "./src/context/parts/context-content-block.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfContentBlock", function() { return _parts_context_content_block__WEBPACK_IMPORTED_MODULE_2__["ContextOfContentBlock"]; });

/* harmony import */ var _parts_context_instance__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./parts/context-instance */ "./src/context/parts/context-instance.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfInstance", function() { return _parts_context_instance__WEBPACK_IMPORTED_MODULE_3__["ContextOfInstance"]; });

/* harmony import */ var _parts_context_item__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./parts/context-item */ "./src/context/parts/context-item.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfItem", function() { return _parts_context_item__WEBPACK_IMPORTED_MODULE_4__["ContextOfItem"]; });

/* harmony import */ var _parts_context_page__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./parts/context-page */ "./src/context/parts/context-page.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfPage", function() { return _parts_context_page__WEBPACK_IMPORTED_MODULE_5__["ContextOfPage"]; });

/* harmony import */ var _parts_context_system__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./parts/context-system */ "./src/context/parts/context-system.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfSystem", function() { return _parts_context_system__WEBPACK_IMPORTED_MODULE_6__["ContextOfSystem"]; });

/* harmony import */ var _parts_context_tenant__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./parts/context-tenant */ "./src/context/parts/context-tenant.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfTenant", function() { return _parts_context_tenant__WEBPACK_IMPORTED_MODULE_7__["ContextOfTenant"]; });

/* harmony import */ var _bundles_context_bundle_toolbar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./bundles/context-bundle-toolbar */ "./src/context/bundles/context-bundle-toolbar.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextBundleToolbar", function() { return _bundles_context_bundle_toolbar__WEBPACK_IMPORTED_MODULE_8__["ContextBundleToolbar"]; });

/* harmony import */ var _parts_context_ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./parts/context-ui */ "./src/context/parts/context-ui.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfUi", function() { return _parts_context_ui__WEBPACK_IMPORTED_MODULE_9__["ContextOfUi"]; });

/* harmony import */ var _parts_context_user__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./parts/context-user */ "./src/context/parts/context-user.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfUser", function() { return _parts_context_user__WEBPACK_IMPORTED_MODULE_10__["ContextOfUser"]; });

/* harmony import */ var _bundles_context_bundle_instance__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./bundles/context-bundle-instance */ "./src/context/bundles/context-bundle-instance.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextBundleInstance", function() { return _bundles_context_bundle_instance__WEBPACK_IMPORTED_MODULE_11__["ContextBundleInstance"]; });

/* harmony import */ var _bundles_context_bundle_content__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./bundles/context-bundle-content */ "./src/context/bundles/context-bundle-content.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextBundleContent", function() { return _bundles_context_bundle_content__WEBPACK_IMPORTED_MODULE_12__["ContextBundleContent"]; });
















/***/ }),

/***/ "./src/context/parts/context-app.ts":
/*!******************************************!*\
  !*** ./src/context/parts/context-app.ts ***!
  \******************************************/
/*! exports provided: ContextOfApp */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfApp", function() { return ContextOfApp; });
/**
 * this will be about the current app, settings of the app, app - paths, etc.
 */
var ContextOfApp = /** @class */ (function () {
    function ContextOfApp(editCtx, sxc) {
        var _a, _b, _c, _d, _e, _f;
        // ContentGroup
        /**
         * IsContent is used for 2 things
         * 1. Determine if certain buttons should be enabled in the toolbar
         * 2. To forward to the quick-dialog, which changes behavior based on this
         * Should default to true, because that's the more basic/restricted mode
         */
        this.isContent = true;
        this.settingsId = null;
        this.resourcesId = null;
        this.supportsAjax = false;
        // Initialize Content-Group App information
        if (editCtx.contentBlock) {
            this.id = editCtx.contentBlock.AppId;
            this.isContent = (_a = editCtx.contentBlock.IsContent) !== null && _a !== void 0 ? _a : true;
            this.resourcesId = (_b = editCtx.contentBlock.AppResourcesId) !== null && _b !== void 0 ? _b : null;
            this.settingsId = (_c = editCtx.contentBlock.AppSettingsId) !== null && _c !== void 0 ? _c : null;
            this.appPath = editCtx.contentBlock.AppUrl; // this is the only value which doesn't have a slash by default. note that the app-root doesn't exist when opening "manage-app"
            this.hasContent = editCtx.contentBlock.HasContent;
            this.supportsAjax = (_d = editCtx.contentBlock.SupportsAjax) !== null && _d !== void 0 ? _d : false;
            this.zoneId = editCtx.contentBlock.ZoneId;
        }
        // if we have more context information, use this to provide possibly missing data
        if (sxc && sxc.ctx) {
            this.id = (_e = this.id) !== null && _e !== void 0 ? _e : sxc.ctx.appId;
            this.zoneId = (_f = this.id) !== null && _f !== void 0 ? _f : sxc.ctx.zoneId;
        }
        // Initialize language information
        if (editCtx.Language) {
            this.currentLanguage = editCtx.Language.Current;
            this.primaryLanguage = editCtx.Language.Primary;
            this.allLanguages = editCtx.Language.All;
        }
    }
    return ContextOfApp;
}());



/***/ }),

/***/ "./src/context/parts/context-content-block.ts":
/*!****************************************************!*\
  !*** ./src/context/parts/context-content-block.ts ***!
  \****************************************************/
/*! exports provided: ContextOfContentBlock */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfContentBlock", function() { return ContextOfContentBlock; });
/**
 * information related to the current contentBlock, incl
 */
var ContextOfContentBlock = /** @class */ (function () {
    function ContextOfContentBlock(editCtx) {
        // Initialize Content-Group Values
        var cb = editCtx.contentBlock;
        if (!cb)
            return;
        this.isCreated = cb.IsCreated;
        this.isList = cb.IsList;
        this.queryId = cb.QueryId;
        this.templateId = cb.TemplateId;
        this.templatePath = cb.TemplatePath;
        this.TemplateIsShared = cb.TemplateIsShared;
        this.edition = cb.Edition;
        this.contentTypeId = cb.ContentTypeName;
        this.contentGroupId = cb.Guid;
    }
    return ContextOfContentBlock;
}());



/***/ }),

/***/ "./src/context/parts/context-instance.ts":
/*!***********************************************!*\
  !*** ./src/context/parts/context-instance.ts ***!
  \***********************************************/
/*! exports provided: ContextOfInstance */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfInstance", function() { return ContextOfInstance; });
/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../core */ "../core/index.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../constants */ "./src/constants/index.ts");


/**
 * information related to the current DNN module, incl.instanceId,
 */
var ContextOfInstance = /** @class */ (function () {
    function ContextOfInstance(editCtx, sxc) {
        var _a, _b, _c, _d, _e;
        this.isEditable = false;
        this.allowPublish = true;
        // sxc
        this.sxcVersion = _core__WEBPACK_IMPORTED_MODULE_0__["SxcVersion"];
        this.parameters = null;
        this.sxcRootUrl = '';
        if (editCtx.Environment) {
            this.id = editCtx.Environment.InstanceId;
            this.isEditable = (_a = editCtx.Environment.IsEditable) !== null && _a !== void 0 ? _a : false;
            // sxc
            this.sxcVersion = (_b = editCtx.Environment.SxcVersion) !== null && _b !== void 0 ? _b : _core__WEBPACK_IMPORTED_MODULE_0__["SxcVersion"];
            this.parameters = editCtx.Environment.parameters;
            this.sxcRootUrl = (_c = editCtx.Environment.SxcRootUrl) !== null && _c !== void 0 ? _c : '';
        }
        if (!this.id)
            // if the module isn't known, check the additional context.
            // Otherwise give it a real number but an obvious fallback
            // This is for integration into other systems which don't need a module-id
            this.id = (_e = (_d = sxc === null || sxc === void 0 ? void 0 : sxc.ctx) === null || _d === void 0 ? void 0 : _d.moduleId) !== null && _e !== void 0 ? _e : -2742;
        if (editCtx.contentBlockReference)
            this.allowPublish = editCtx.contentBlockReference.publishingMode === _constants__WEBPACK_IMPORTED_MODULE_1__["C"].IDs.publishAllowed;
    }
    return ContextOfInstance;
}());



/***/ }),

/***/ "./src/context/parts/context-item.ts":
/*!*******************************************!*\
  !*** ./src/context/parts/context-item.ts ***!
  \*******************************************/
/*! exports provided: ContextOfItem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfItem", function() { return ContextOfItem; });
/**
 * information about the current item
 * ATM empty, not sure if it serves a purpose...
 */
var ContextOfItem = /** @class */ (function () {
    // tslint:disable-next-line: no-empty
    function ContextOfItem(editCtx) {
    }
    return ContextOfItem;
}());



/***/ }),

/***/ "./src/context/parts/context-page.ts":
/*!*******************************************!*\
  !*** ./src/context/parts/context-page.ts ***!
  \*******************************************/
/*! exports provided: ContextOfPage */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfPage", function() { return ContextOfPage; });
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");

/**
 * this will be information related to the current page
 */
var ContextOfPage = /** @class */ (function () {
    // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments
    // url: string;
    function ContextOfPage(editCtx, sxc) {
        var _a, _b, _c, _d;
        if (editCtx.Environment) {
            this.id = editCtx.Environment.PageId;
            // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments
            // this.url = editCtx.Environment.PageUrl;
        }
        // catch cases where it wasn't provided
        this.id = (_d = (_c = (_a = this.id) !== null && _a !== void 0 ? _a : (_b = sxc === null || sxc === void 0 ? void 0 : sxc.ctx) === null || _b === void 0 ? void 0 : _b.pageId) !== null && _c !== void 0 ? _c : _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_0__["$2sxcInPage"].env.page()) !== null && _d !== void 0 ? _d : -2742;
    }
    return ContextOfPage;
}());



/***/ }),

/***/ "./src/context/parts/context-system.ts":
/*!*********************************************!*\
  !*** ./src/context/parts/context-system.ts ***!
  \*********************************************/
/*! exports provided: ContextOfSystem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfSystem", function() { return ContextOfSystem; });
/**
 * this will be everything about the current system, like system / api -paths etc.
 */
var ContextOfSystem = /** @class */ (function () {
    function ContextOfSystem(editCtx) {
        if (editCtx.error) {
            this.error = editCtx.error.type;
        }
    }
    return ContextOfSystem;
}());



/***/ }),

/***/ "./src/context/parts/context-tenant.ts":
/*!*********************************************!*\
  !*** ./src/context/parts/context-tenant.ts ***!
  \*********************************************/
/*! exports provided: ContextOfTenant */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfTenant", function() { return ContextOfTenant; });
/**
 * this will be something about the current tenant(the dnn portal)
 */
var ContextOfTenant = /** @class */ (function () {
    // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments
    // id: number;
    // url: string;
    function ContextOfTenant(editCtx) {
        if (editCtx.Environment) {
            // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments
            // this.id = editCtx.Environment.WebsiteId;
            // this.url = editCtx.Environment.WebsiteUrl;
        }
    }
    return ContextOfTenant;
}());



/***/ }),

/***/ "./src/context/parts/context-ui.ts":
/*!*****************************************!*\
  !*** ./src/context/parts/context-ui.ts ***!
  \*****************************************/
/*! exports provided: ContextOfUi */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfUi", function() { return ContextOfUi; });
/**
 * ensure that the UI will load the correct assets to enable editing
 */
var ContextOfUi = /** @class */ (function () {
    function ContextOfUi(editCtx) {
        if (editCtx.Ui) {
            this.autoToolbar = editCtx.Ui.AutoToolbar; // toolbar auto-show
            if (editCtx.Ui.Form)
                this.form = editCtx.Ui.Form; // decide which dialog opens, eg ng8
        }
    }
    return ContextOfUi;
}());



/***/ }),

/***/ "./src/context/parts/context-user.ts":
/*!*******************************************!*\
  !*** ./src/context/parts/context-user.ts ***!
  \*******************************************/
/*! exports provided: ContextOfUser */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextOfUser", function() { return ContextOfUser; });
/* harmony import */ var _html_attribute__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../html-attribute */ "./src/context/html-attribute/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

/**
 * things about the user
 * ~~note that the properties are also used in url-params and ajax calls, so don't rename~~
 * 2022-02-23 2dm - renamed to upper case now, assume it shouldn't have a side effect because
 * it shouldn't be used in ajax calls, since the dialogs get the settings from the backend
 */
var ContextOfUser = /** @class */ (function (_super) {
    __extends(ContextOfUser, _super);
    function ContextOfUser(editCtx) {
        var _this = _super.call(this) || this;
        if (!editCtx || !editCtx.User)
            return _this;
        _this.CanDevelop = editCtx.User.CanDevelop;
        _this.CanAdmin = editCtx.User.CanAdmin;
        return _this;
    }
    ContextOfUser.fromContext = function (context) {
        var user = new ContextOfUser();
        user.CanDevelop = context.user.CanDevelop;
        user.CanAdmin = context.user.CanAdmin;
        return user;
    };
    return ContextOfUser;
}(_html_attribute__WEBPACK_IMPORTED_MODULE_0__["AttrJsonUser"]));



/***/ }),

/***/ "./src/context/parts/index.ts":
/*!************************************!*\
  !*** ./src/context/parts/index.ts ***!
  \************************************/
/*! exports provided: ContextOfApp, ContextOfContentBlock, ContextOfInstance, ContextOfItem, ContextOfPage, ContextOfSystem, ContextOfTenant, ContextOfUi, ContextOfUser */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _context_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./context-app */ "./src/context/parts/context-app.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfApp", function() { return _context_app__WEBPACK_IMPORTED_MODULE_0__["ContextOfApp"]; });

/* harmony import */ var _context_content_block__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./context-content-block */ "./src/context/parts/context-content-block.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfContentBlock", function() { return _context_content_block__WEBPACK_IMPORTED_MODULE_1__["ContextOfContentBlock"]; });

/* harmony import */ var _context_instance__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./context-instance */ "./src/context/parts/context-instance.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfInstance", function() { return _context_instance__WEBPACK_IMPORTED_MODULE_2__["ContextOfInstance"]; });

/* harmony import */ var _context_item__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./context-item */ "./src/context/parts/context-item.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfItem", function() { return _context_item__WEBPACK_IMPORTED_MODULE_3__["ContextOfItem"]; });

/* harmony import */ var _context_page__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./context-page */ "./src/context/parts/context-page.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfPage", function() { return _context_page__WEBPACK_IMPORTED_MODULE_4__["ContextOfPage"]; });

/* harmony import */ var _context_system__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./context-system */ "./src/context/parts/context-system.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfSystem", function() { return _context_system__WEBPACK_IMPORTED_MODULE_5__["ContextOfSystem"]; });

/* harmony import */ var _context_tenant__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./context-tenant */ "./src/context/parts/context-tenant.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfTenant", function() { return _context_tenant__WEBPACK_IMPORTED_MODULE_6__["ContextOfTenant"]; });

/* harmony import */ var _context_ui__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./context-ui */ "./src/context/parts/context-ui.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfUi", function() { return _context_ui__WEBPACK_IMPORTED_MODULE_7__["ContextOfUi"]; });

/* harmony import */ var _context_user__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./context-user */ "./src/context/parts/context-user.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ContextOfUser", function() { return _context_user__WEBPACK_IMPORTED_MODULE_8__["ContextOfUser"]; });












/***/ }),

/***/ "./src/dnn/dnn-menu-helper/dnn-inpage-edit.ts":
/*!****************************************************!*\
  !*** ./src/dnn/dnn-menu-helper/dnn-inpage-edit.ts ***!
  \****************************************************/
/*! exports provided: DnnActionMenu */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DnnActionMenu", function() { return DnnActionMenu; });
/* harmony import */ var _commands_command_layout__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../commands/command/layout */ "./src/commands/command/layout.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



/**
 * Maps actions of the module menu to JS actions - needed because onclick event can't be set (actually, a bug in DNN)
 */
var DnnActionMenu = /** @class */ (function (_super) {
    __extends(DnnActionMenu, _super);
    function DnnActionMenu(moduleId) {
        var _this = _super.call(this, 'Dnn.Menu', null, "modId: " + moduleId) || this;
        _this.changeLayoutOrContent = function () { _this.run(_commands_command_layout__WEBPACK_IMPORTED_MODULE_0__["CmdLayout"]); };
        // 2020-04-21 2dm disabled this, as it doesn't make sense to have this in the DNN menu - since add can be used in each position
        // addItem = () => { this.run('new', { useModuleList: true, sortOrder: 0 }); };
        _this.edit = function () { _this.run('edit', { useModuleList: true, sortOrder: 0 }); };
        _this.adminApp = function () { _this.run('app'); };
        _this.adminZone = function () { _this.run('zone'); };
        _this.develop = function () { _this.run('template-develop'); };
        _logging__WEBPACK_IMPORTED_MODULE_2__["Insights"].add('dnn-menu', "mod: " + moduleId, _this.log);
        _this.sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__["SxcEdit"].get(moduleId);
        _this.run = _this.sxc.manage.run;
        return _this;
    }
    return DnnActionMenu;
}(_logging__WEBPACK_IMPORTED_MODULE_2__["HasLog"]));



/***/ }),

/***/ "./src/dnn/dnn-workarounds/dnn-08.00.04.ts":
/*!*************************************************!*\
  !*** ./src/dnn/dnn-workarounds/dnn-08.00.04.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
// The following script fixes a bug in DNN 08.00.04
// the bug tries to detect a module-ID based on classes in a tag,
// but uses a bad regex and captures the number 2 on all 2sxc-modules
// instead of the real id
// this patch changes the order of the className of 2sxc modules when
// they are accessed through '$.fn.attr'
// 'DnnModule-2sxc DnnModule-xxx' -> DNN thinks the mod id is 2 (false)
// 'DnnModule-xxx DnnModule-2sxc' -> DNN thinks the mod id is xxx (correct)
// documented here https://github.com/2sic/2sxc/issues/986
/**
 * Fix drag-drop functionality in dnn 08.00.04 - it has an incorrect regex
 */

(function () {
    if (window.$ == null)
        return;
    var fn = $.fn.attr;
    $.fn.attr = function () {
        var val = fn.apply(this, arguments);
        if (arguments[0] !== 'class' || typeof val !== 'string' || val.search('DnnModule-2sxc ') === -1)
            return val;
        return val.replace('DnnModule-2sxc ', '') + ' DnnModule-2sxc';
    };
})();


/***/ }),

/***/ "./src/dnn/index.ts":
/*!**************************!*\
  !*** ./src/dnn/index.ts ***!
  \**************************/
/*! exports provided: DnnActionMenu */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _dnn_menu_helper_dnn_inpage_edit__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dnn-menu-helper/dnn-inpage-edit */ "./src/dnn/dnn-menu-helper/dnn-inpage-edit.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "DnnActionMenu", function() { return _dnn_menu_helper_dnn_inpage_edit__WEBPACK_IMPORTED_MODULE_0__["DnnActionMenu"]; });


// tslint:disable-next-line: no-var-requires
var autorun = __webpack_require__(/*! ./dnn-workarounds/dnn-08.00.04 */ "./src/dnn/dnn-workarounds/dnn-08.00.04.ts");


/***/ }),

/***/ "./src/entity-manipulation/item-commands.ts":
/*!**************************************************!*\
  !*** ./src/entity-manipulation/item-commands.ts ***!
  \**************************************************/
/*! exports provided: contentItems */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "contentItems", function() { return contentItems; });
/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../i18n */ "./src/i18n/index.ts");

/**
 * this enhances the $2sxc client controller with stuff only needed when logged in
 */
// #region contentItem Commands
var contentItems = {
    // delete command - try to really delete a content-item
    delete: function (context, itemId, itemGuid, itemTitle) {
        // first show main warning / get ok
        var ok = confirm(Object(_i18n__WEBPACK_IMPORTED_MODULE_0__["translate"])('Delete.Confirm')
            .replace('{id}', String(itemId))
            .replace('{title}', itemTitle));
        if (!ok)
            return Promise.resolve();
        /**
         * ZoneId and AppId are sent becase of rare, special case that is not default
         * (default is that 2sxc is finding ZoneId and AppId on server side from ModuleId)
         * when we need to delete entity from other app or zone, than current one.
         * TODO: send this params, only when is necesary (value change detection for ZoneId, AppId)
         */
        var params = {
            zoneId: context.app.zoneId,
            appId: context.app.id,
        };
        return context.sxc.webApi.fetch(context.sxc.webApi.url("app/auto/content/any/" + itemGuid, params), undefined, 'DELETE')
            .then(function (response) {
            if (response.status >= 200 && response.status < 300) {
                location.reload();
            }
            else if (response.status >= 400 && response.status < 500) {
                // check if it's a permission config problem
                var msgJs = Object(_i18n__WEBPACK_IMPORTED_MODULE_0__["translate"])('Delete.ErrCheckConsole');
                if (response.status === 401)
                    alert(Object(_i18n__WEBPACK_IMPORTED_MODULE_0__["translate"])('Delete.ErrPermission') + msgJs);
                if (response.status === 400)
                    alert(Object(_i18n__WEBPACK_IMPORTED_MODULE_0__["translate"])('Delete.ErrInUse') + msgJs);
            }
        }).catch(function (error) {
            console.log(error);
        });
    },
};


/***/ }),

/***/ "./src/html/dom-tools.ts":
/*!*******************************!*\
  !*** ./src/html/dom-tools.ts ***!
  \*******************************/
/*! exports provided: HtmlTools */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HtmlTools", function() { return HtmlTools; });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");


var HtmlTools = /** @class */ (function () {
    function HtmlTools() {
    }
    HtmlTools.disable = function (tag) {
        tag.setAttribute(_constants__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.disable, 'true');
    };
    HtmlTools.isDisabled = function (sxc) {
        var tag = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__["SxcEdit"].getTag(sxc);
        return !!tag.getAttribute(_constants__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.disable);
    };
    /**
     * Find the text of one or more attributes in fallback order, till we found one
     */
    HtmlTools.getFirstAttribute = function (toolbar, name1, name2) {
        return HtmlTools.tryGetAttrText(toolbar, name1) || HtmlTools.tryGetAttrText(toolbar, name2) || '{}';
    };
    /**
     * Get text-content of an attribute (or return null)
     */
    HtmlTools.tryGetAttrText = function (tag, name) {
        var item1 = tag.attributes.getNamedItem(name);
        return item1 && item1.textContent;
    };
    /**
     * Add html classes to a DOM element
     */
    HtmlTools.addClasses = function (element, classes) {
        if (!classes)
            return;
        if (classes.indexOf(','))
            classes = classes.replace(',', ' ');
        var classessArray = classes.split(' ');
        for (var c = 0; c < classessArray.length; c++)
            if (classessArray[c])
                element.classList.add(classessArray[c]);
    };
    return HtmlTools;
}());



/***/ }),

/***/ "./src/i18n/2sxc.translate.ts":
/*!************************************!*\
  !*** ./src/i18n/2sxc.translate.ts ***!
  \************************************/
/*! exports provided: translate */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "translate", function() { return translate; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/i18n/index.ts");

/**
 * provide an official translate API for 2sxc
 * @param key
 */
function translate(key) { return ___WEBPACK_IMPORTED_MODULE_0__["Translator"].translate(key); }


/***/ }),

/***/ "./src/i18n/index.ts":
/*!***************************!*\
  !*** ./src/i18n/index.ts ***!
  \***************************/
/*! exports provided: primaryLanguage, translations, translationsPath, Translator, translate */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "primaryLanguage", function() { return primaryLanguage; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "translations", function() { return translations; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "translationsPath", function() { return translationsPath; });
/* harmony import */ var _translator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./translator */ "./src/i18n/translator.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Translator", function() { return _translator__WEBPACK_IMPORTED_MODULE_0__["Translator"]; });

/* harmony import */ var _2sxc_translate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./2sxc.translate */ "./src/i18n/2sxc.translate.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "translate", function() { return _2sxc_translate__WEBPACK_IMPORTED_MODULE_1__["translate"]; });

var primaryLanguage = 'en';
var translations = ['en', 'de', 'fr', 'it', 'uk', 'nl'];
var translationsPath = 'dist/inpage/i18n/{{lng}}.js';




/***/ }),

/***/ "./src/i18n/translator.ts":
/*!********************************!*\
  !*** ./src/i18n/translator.ts ***!
  \********************************/
/*! exports provided: Translator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Translator", function() { return Translator; });
/* harmony import */ var i18next__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! i18next */ "./node_modules/i18next/dist/esm/i18next.js");
/* harmony import */ var i18next_xhr_backend__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! i18next-xhr-backend */ "./node_modules/i18next-xhr-backend/dist/esm/i18nextXHRBackend.js");
/* harmony import */ var loc_i18next__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! loc-i18next */ "./node_modules/loc-i18next/index.js");
/* harmony import */ var loc_i18next__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(loc_i18next__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! . */ "./src/i18n/index.ts");
/* harmony import */ var _constants_ids__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../constants/ids */ "./src/constants/ids.ts");
/* harmony import */ var _context_bundles__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../context/bundles */ "./src/context/bundles/index.ts");
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


// @ts-ignore







var localize;
// let initialized: boolean = false;
var TranslatorGlobal = /** @class */ (function (_super) {
    __extends(TranslatorGlobal, _super);
    function TranslatorGlobal() {
        var _this = _super.call(this, 'Sys.Trnslt') || this;
        _this.locReady = false;
        _this.initialized = false;
        _logging__WEBPACK_IMPORTED_MODULE_8__["Insights"].add('system', 'translator', _this.log);
        _this.i18n = i18next__WEBPACK_IMPORTED_MODULE_0__["default"];
        return _this;
    }
    TranslatorGlobal.prototype.translate = function (key) {
        if (!this.initialized)
            return key;
        if (!this.i18n.isInitialized)
            return key;
        return this.i18n.t(key) || key;
    };
    /**
     * Initialize a manager-object on a 2sxc-instance
     */
    TranslatorGlobal.prototype.initManager = function (manage) {
        var _this = this;
        var cl = this.log.call('initManager');
        if (this.initialized)
            return cl.done('already initialized');
        var context = manage._context || this.tryToFindAContext();
        cl.add('will initialize');
        var realRootPath = _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_6__["$2sxcInPage"].env.uiRoot();
        this.i18n
            .use(i18next_xhr_backend__WEBPACK_IMPORTED_MODULE_1__["default"])
            .init({
            lng: context.app.currentLanguage.substr(0, 2),
            fallbackLng: ___WEBPACK_IMPORTED_MODULE_3__["primaryLanguage"],
            whitelist: ___WEBPACK_IMPORTED_MODULE_3__["translations"],
            preload: [___WEBPACK_IMPORTED_MODULE_3__["primaryLanguage"]],
            backend: {
                loadPath: Object(_logging__WEBPACK_IMPORTED_MODULE_8__["urlClean"])(realRootPath + ___WEBPACK_IMPORTED_MODULE_3__["translationsPath"]),
            },
        }, function () { return _this.initLoc(); });
        this.initialized = true;
        cl.done();
    };
    TranslatorGlobal.prototype.tryToFindAContext = function () {
        var cl = this.log.call('tryToFindAContext');
        cl.add('no context found, will seek');
        // trying to get context...
        var htmlElementOrId = document.querySelector('div[data-cb-id]');
        this.initialized = true; // the next SxcEdit.get will call _translate so we must set true to prevent loops
        var sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_7__["SxcEdit"].get(htmlElementOrId);
        this.initialized = false; // for real, it is not initialized...
        var editContext = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_7__["SxcEdit"].getEditContext(sxc);
        var context = new _context_bundles__WEBPACK_IMPORTED_MODULE_5__["ContextComplete"](editContext, sxc);
        context.sxc = sxc;
        return cl.return(context);
    };
    /**
     * Initialize loc and auto-translate menu nodes in the DOM
     * This is called when the initialize-promise resolves
     */
    TranslatorGlobal.prototype.initLoc = function () {
        var cl = this.log.call('initLoc');
        // for options see https://github.com/mthh/loc-i18next#initialize-the-plugin
        localize = loc_i18next__WEBPACK_IMPORTED_MODULE_2___default.a.init(i18next__WEBPACK_IMPORTED_MODULE_0__["default"]);
        this.locReady = true;
        this.autoTranslateMenus();
        cl.done();
    };
    /**
     * Tell loc to translate all the translatable menu nodes
     * Do this on initial load, and every time dynamic content gets re-created
     */
    TranslatorGlobal.prototype.autoTranslateMenus = function () {
        var cl = this.log.call('autoTranslateMenus');
        if (!this.locReady)
            return cl.done('loc not ready');
        // start localizing, details: https://github.com/mthh/loc-i18next#usage-of-selector-function
        var menus = document.querySelectorAll(_constants_ids__WEBPACK_IMPORTED_MODULE_4__["IDs"].sel.tagScMenu);
        localize(_constants_ids__WEBPACK_IMPORTED_MODULE_4__["IDs"].sel.tagScMenu); // inline toolbars
        var quickEButtons = document.querySelectorAll('.sc-i18n');
        localize('.sc-i18n'); // quick-insert menus
        cl.add("found " + menus.length + " menus and " + quickEButtons.length + " buttons");
        cl.done();
    };
    return TranslatorGlobal;
}(_logging__WEBPACK_IMPORTED_MODULE_8__["HasLog"]));
var Translator = new TranslatorGlobal();


/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _bootstrap_bootstrap__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./bootstrap/bootstrap */ "./src/bootstrap/bootstrap.ts");
/* harmony import */ var _cms_Cms__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cms/Cms */ "./src/cms/Cms.ts");
/* harmony import */ var _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./context/bundles/context-bundle-button */ "./src/context/bundles/context-bundle-button.ts");
/* harmony import */ var _dnn__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dnn */ "./src/dnn/index.ts");
/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./i18n */ "./src/i18n/index.ts");
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");
/* harmony import */ var _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./interfaces/window-in-page */ "./src/interfaces/window-in-page.ts");
/* harmony import */ var _manage_manage__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./manage/manage */ "./src/manage/manage.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./plumbing */ "./src/plumbing/index.ts");
/* harmony import */ var _quick_edit_quick_e__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./quick-edit/quick-e */ "./src/quick-edit/quick-e.ts");
/* harmony import */ var _system__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./system */ "./src/system/index.ts");
/* harmony import */ var _toolbar_toolbar_global_enable_shake__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./toolbar/toolbar-global-enable-shake */ "./src/toolbar/toolbar-global-enable-shake.ts");












// #1 Note that $2sxc must always exist, the server ensures the load order
// #2 Now attach initialization helpers and global objects, so that $2sxc always has these
_interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_5__["$2sxcInPage"].context = _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_2__["ContextComplete"].findContext; // primary API to get the context
_interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_5__["$2sxcInPage"]._translateInit = function (manage) { return _i18n__WEBPACK_IMPORTED_MODULE_4__["Translator"].initManager(manage); }; // reference in ./2sxc-api/js/ToSic.Sxc.Instance.ts
_interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_5__["$2sxcInPage"].translate = _i18n__WEBPACK_IMPORTED_MODULE_4__["translate"]; // provide an official translate API for 2sxc
_interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_5__["$2sxcInPage"]._manage = new _manage_manage__WEBPACK_IMPORTED_MODULE_7__["Manage"](); // used out of this project in ToSic.Sxc.Instance and 2sxc.api.js
_interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_6__["windowInPage"].$quickE = _quick_edit_quick_e__WEBPACK_IMPORTED_MODULE_9__["QuickE"].singleton(); // note: not sure if this is needed as a global object...
_interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_5__["$2sxcInPage"].cms = new _cms_Cms__WEBPACK_IMPORTED_MODULE_1__["Cms"]();
// #3 Initialize all objects as needed
function loadInpage() {
    // check if already initialized - just in case these scripts were loaded multiple times
    var bootstrapper = new _bootstrap_bootstrap__WEBPACK_IMPORTED_MODULE_0__["BootstrapInPage"]();
    bootstrapper.initialize();
    _quick_edit_quick_e__WEBPACK_IMPORTED_MODULE_9__["QuickE"].singleton().start();
    /** this enhances the $2sxc client controller with stuff only needed when logged in */
    if (!_interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_6__["windowInPage"].$2sxc.system)
        _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_6__["windowInPage"].$2sxc.system = new _system__WEBPACK_IMPORTED_MODULE_10__["SystemUpgrader"]();
    /** Connect DNN action mapper to this module instance */
    _interfaces_window_in_page__WEBPACK_IMPORTED_MODULE_6__["windowInPage"].$2sxcActionMenuMapper = function (moduleId) {
        return new _dnn__WEBPACK_IMPORTED_MODULE_3__["DnnActionMenu"](moduleId);
    };
}
_plumbing__WEBPACK_IMPORTED_MODULE_8__["NoJQ"].ready(loadInpage);
// Tell Webpack to load CSS
var cssEdit = __webpack_require__(/*! ./inpage.css */ "./src/inpage.css");
var cssIcons = __webpack_require__(/*! ../icons/inpage-icons-codes.css */ "./icons/inpage-icons-codes.css");


/***/ }),

/***/ "./src/inpage.css":
/*!************************!*\
  !*** ./src/inpage.css ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),

/***/ "./src/interfaces/sxc-controller-in-page.ts":
/*!**************************************************!*\
  !*** ./src/interfaces/sxc-controller-in-page.ts ***!
  \**************************************************/
/*! exports provided: $2sxcInPage */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "$2sxcInPage", function() { return $2sxcInPage; });
/* harmony import */ var _window_in_page__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./window-in-page */ "./src/interfaces/window-in-page.ts");

// ReSharper restore InconsistentNaming
var $2sxcInPage = _window_in_page__WEBPACK_IMPORTED_MODULE_0__["windowInPage"].$2sxc;


/***/ }),

/***/ "./src/interfaces/sxc-instance-editable.ts":
/*!*************************************************!*\
  !*** ./src/interfaces/sxc-instance-editable.ts ***!
  \*************************************************/
/*! exports provided: SxcEdit */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SxcEdit", function() { return SxcEdit; });
/* harmony import */ var _$2sxc_src__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../$2sxc/src */ "../$2sxc/src/index.ts");
/* harmony import */ var _cms_Cms__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../cms/Cms */ "./src/cms/Cms.ts");
/* harmony import */ var _commands_engine_run_params__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../commands/engine/run-params */ "./src/commands/engine/run-params.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};




var SxcEdit = /** @class */ (function (_super) {
    __extends(SxcEdit, _super);
    function SxcEdit() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /// TODO: CONTINUE HERE, TRY TO GET THE RUN TO USE THE CURRENT 2SXC
    SxcEdit.prototype.run = function (runParams) {
        Object(_commands_engine_run_params__WEBPACK_IMPORTED_MODULE_2__["ensureRunParamsInstanceOrError"])(runParams);
        return new _cms_Cms__WEBPACK_IMPORTED_MODULE_1__["Cms"]().run(__assign(__assign({}, runParams), { context: this }));
    };
    SxcEdit.is = function (thing) {
        return thing.showDetailedHttpError !== undefined;
    };
    SxcEdit.get = function (module, cbid) {
        // 2021-09-17 spm assume this function doesn't use jquery
        var sxc = window.$2sxc(module, cbid);
        return sxc;
    };
    /**
     * get edit-context info of html element or sxc-object
     * @param {SxcEdit} sxc
     * @param {HTMLElement} htmlElement
     * @return {AttrJsonEditContext} edit context info
     */
    SxcEdit.getEditContext = function (sxc, htmlElement) {
        var editContextTag;
        if (htmlElement) {
            editContextTag = SxcEdit.getContainerTag(htmlElement);
        }
        else {
            editContextTag = SxcEdit.getTag(sxc);
        }
        return SxcEdit.getEditContextOfTag(editContextTag);
    };
    /**
     * get the edit-context object (a json object) of the current tag/sxc-instance
     * @return {AttrJsonEditContext} edit-context object
     */
    SxcEdit.getEditContextOfTag = function (htmlTag) {
        var attr = htmlTag === null || htmlTag === void 0 ? void 0 : htmlTag.getAttribute(_constants__WEBPACK_IMPORTED_MODULE_3__["C"].AttrNames.Context);
        return JSON.parse(attr || '{ }');
    };
    /**
     * get nearest html tag of the sxc instance with data-edit-context
     * @param htmlTag
     */
    SxcEdit.getContainerTag = function (htmlTag) {
        return htmlTag.closest(_constants__WEBPACK_IMPORTED_MODULE_3__["C"].Sel.SxcDivs);
    };
    /**
     * get a html tag of the sxc instance
     * @param {SxcEdit} sxci
     * @return {HTMLElement} - resulting html
     */
    SxcEdit.getTag = function (sxci) {
        return document.querySelector("div[" + _constants__WEBPACK_IMPORTED_MODULE_3__["C"].AttrNames.ContentBlockId + "='" + sxci.cbid + "']");
    };
    return SxcEdit;
}(_$2sxc_src__WEBPACK_IMPORTED_MODULE_0__["SxcInstanceWithInternals"]));



/***/ }),

/***/ "./src/interfaces/window-in-page.ts":
/*!******************************************!*\
  !*** ./src/interfaces/window-in-page.ts ***!
  \******************************************/
/*! exports provided: windowInPage */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "windowInPage", function() { return windowInPage; });
// ReSharper restore InconsistentNaming
var windowInPage = window;


/***/ }),

/***/ "./src/logging/index.ts":
/*!******************************!*\
  !*** ./src/logging/index.ts ***!
  \******************************/
/*! exports provided: ToSxcName, SxcVersion, SxcApiUrlRoot, HeaderNames, ApiUrlRoots, AppApiMarker, AppApiMap, NumberNotDefinedHuge, LogEntryOptions, HasLog, Log, LogCall, Entry, Insights, Obj, urlClean, NoJQ, AssetsLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core */ "../core/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToSxcName", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["ToSxcName"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcVersion", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["SxcVersion"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcApiUrlRoot", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["SxcApiUrlRoot"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HeaderNames", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["HeaderNames"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ApiUrlRoots", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["ApiUrlRoots"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMarker", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["AppApiMarker"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMap", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["AppApiMap"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NumberNotDefinedHuge", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["NumberNotDefinedHuge"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogEntryOptions", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HasLog", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["HasLog"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Log", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Log"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogCall", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["LogCall"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Entry", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Entry"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Insights", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Insights"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Obj", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["Obj"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "urlClean", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["urlClean"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NoJQ", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["NoJQ"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AssetsLoader", function() { return _core__WEBPACK_IMPORTED_MODULE_0__["AssetsLoader"]; });

// Logging system is used from $2sxc API



/***/ }),

/***/ "./src/manage/edit-manager.ts":
/*!************************************!*\
  !*** ./src/manage/edit-manager.ts ***!
  \************************************/
/*! exports provided: EditManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "EditManager", function() { return EditManager; });
/* harmony import */ var _$2sxc_src__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../$2sxc/src */ "../$2sxc/src/index.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _toolbar__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../toolbar */ "./src/toolbar/index.ts");
/* harmony import */ var _toolbar_render_toolbar_renderer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../toolbar/render/toolbar-renderer */ "./src/toolbar/render/toolbar-renderer.ts");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};




/**
 * Instance specific edit manager
 */
var EditManager = /** @class */ (function () {
    function EditManager(sxc, editContext, userInfo, cmdEngine, context) {
        var _this = this;
        this.sxc = sxc;
        this.editContext = editContext;
        this.userInfo = userInfo;
        this.cmdEngine = cmdEngine;
        this.context = context;
        //#region Official, public properties and commands, which are stable for use from the outside
        /**
         * run a command - command used in toolbars and custom buttons
         * it is publicly used out of inpage, so take a care to preserve function signature
         */
        this.run = this.cmdEngine.run;
        //#endregion official, public properties - everything below this can change
        this._context = this.context;
        /**
         * internal method to find out if it's in edit-mode
         */
        this._isEditMode = function () { var _a; return (_a = _this.editContext.Environment.IsEditable) !== null && _a !== void 0 ? _a : false; };
        /**
         * used for various dialogues
         */
        this._reloadWithAjax = this.context.app.supportsAjax;
        /** metadata necessary to know what/how to edit */
        this._editContext = this.editContext;
        /** used to handle the commands for this content-block */
        this._commands = this.cmdEngine;
        this._user = this.userInfo;
    }
    /**
     * Generate a button (an <a>-tag) for one specific toolbar-action.
     * @param {InPageButtonJson} actDef - settings, an object containing the spec for the expected button
     * @param {int} groupIndex - number what button-group it's in'
     * @returns {string} html of a button
     * it is publicly used out of inpage, so take a care to preserve function signature
     */
    EditManager.prototype.getButton = function (actDef, groupIndex) {
        this.context.button = _toolbar__WEBPACK_IMPORTED_MODULE_2__["ToolbarManager"].singleton().getLoader('getButton')
            .groups.convertToButton(actDef, {}, {}, {});
        var button = new _toolbar_render_toolbar_renderer__WEBPACK_IMPORTED_MODULE_3__["ToolbarRenderer"](this.context).button.render(this.context, groupIndex);
        return button.outerHTML;
    };
    /**
     * Builds the toolbar and returns it as HTML
     * @param {Object} tbConfig - general toolbar config
     * @param {ToolbarSettings} moreSettings - additional / override settings
     * @returns {string} html of the current toolbar
     *
     * it is publicly used in Razor scripts of inpage, so take a care to preserve function signature
     */
    EditManager.prototype.getToolbar = function (tbConfig, moreSettings) {
        // if toolbar is an array, use as-is, otherwise assume properties are params
        var toolbar = Array.isArray(tbConfig) ? tbConfig : __assign({}, tbConfig);
        tbConfig = { settings: __assign(__assign({}, tbConfig.settings), moreSettings), toolbar: toolbar };
        var toolbarConfig = _toolbar__WEBPACK_IMPORTED_MODULE_2__["ToolbarManager"].singleton().loadConfig(this.context, tbConfig);
        this.context.toolbar = toolbarConfig;
        return new _toolbar_render_toolbar_renderer__WEBPACK_IMPORTED_MODULE_3__["ToolbarRenderer"](this.context).render();
    };
    /**
     * change config by replacing the guid, and refreshing dependent sub-objects
     */
    EditManager.prototype._updateContentGroupGuid = function (context, newGuid) {
        context.contentBlock.contentGroupId = newGuid;
        this.editContext.contentBlock.Guid = newGuid;
    };
    /**
     * init this object
     */
    EditManager.prototype.init = function () {
        var tag = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__["SxcEdit"].getTag(this.sxc);
        // enhance UI in case there are known errors / issues
        var isErrorState = this.editContext && this.editContext.error && this.editContext.error.type;
        if (isErrorState)
            handleErrors(this.editContext.error.type, tag);
    };
    return EditManager;
}());

/**
 * private: show error when the app-data hasn't been installed yet for this imported-module
 */
function handleErrors(errType, cbTag) {
    var errWrapper = _$2sxc_src__WEBPACK_IMPORTED_MODULE_0__["NoJQ"].domFromString('<div class="dnnFormMessage dnnFormWarning sc-element"></div>')[0];
    var msg = '';
    var toolbar = _$2sxc_src__WEBPACK_IMPORTED_MODULE_0__["NoJQ"].domFromString('<ul class="sc-menu"></ul>')[0];
    if (errType === 'DataIsMissing') {
        msg =
            'Error: System.Exception: Data is missing - usually when a site is copied but the content / apps have not been imported yet - check 2sxc.org/help?tag=export-import';
        toolbar.setAttribute('data-toolbar', '[{\"action\": \"zone\"}, {\"action\": \"more\"}]');
    }
    errWrapper.append(msg);
    errWrapper.append(toolbar);
    cbTag.append(errWrapper);
}


/***/ }),

/***/ "./src/manage/manage.ts":
/*!******************************!*\
  !*** ./src/manage/manage.ts ***!
  \******************************/
/*! exports provided: Manage */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Manage", function() { return Manage; });
/* harmony import */ var _cms_Cms__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../cms/Cms */ "./src/cms/Cms.ts");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../commands */ "./src/commands/index.ts");
/* harmony import */ var _commands_engine_run_params__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../commands/engine/run-params */ "./src/commands/engine/run-params.ts");
/* harmony import */ var _context__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../context */ "./src/context/index.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _toolbar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../toolbar */ "./src/toolbar/index.ts");
/* harmony import */ var _edit_manager__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./edit-manager */ "./src/manage/edit-manager.ts");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};








/**
 * A helper-controller in charge of opening edit-dialogues + creating the toolbars for it
 * all in-page toolbars etc.
 * if loaded, it's found under the $2sxc(module).manage
 * it has commands to
 * - getButton
 * - getToolbar
 * - run(...)
 * - isEditMode
 */
var Manage = /** @class */ (function () {
    function Manage() {
        /** Internal - ATM only used in dnn-sxc-angular to enable toolbar initialization */
        this._toolbarManager = _toolbar__WEBPACK_IMPORTED_MODULE_5__["ToolbarManager"].singleton();
    }
    /**
     * Init the manager object
     * we must keep signature of initInstance in sync with the 2sxc.api.js
     * @param sxc
     */
    Manage.prototype.initInstance = function (sxc) {
        try {
            var myContext = _context__WEBPACK_IMPORTED_MODULE_3__["ContextComplete"].findContext(sxc);
            var editContext = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_4__["SxcEdit"].getEditContext(myContext.sxc);
            var userInfo = _context__WEBPACK_IMPORTED_MODULE_3__["ContextOfUser"].fromContext(myContext);
            var cmdEngine = new _commands__WEBPACK_IMPORTED_MODULE_1__["SxcInstanceEngine"](myContext.sxc);
            var editManager = new _edit_manager__WEBPACK_IMPORTED_MODULE_6__["EditManager"](myContext.sxc, editContext, userInfo, cmdEngine, myContext);
            sxc.manage = editManager;
            sxc.cms.run = function (runParams) {
                Object(_commands_engine_run_params__WEBPACK_IMPORTED_MODULE_2__["ensureRunParamsInstanceOrError"])(runParams);
                return new _cms_Cms__WEBPACK_IMPORTED_MODULE_0__["Cms"]().run(__assign(__assign({}, runParams), { context: sxc }));
            };
            editManager.init();
            return editManager;
        }
        catch (e) {
            console.error('error in 2sxc - will log but not throw', e);
        }
    };
    return Manage;
}());



/***/ }),

/***/ "./src/manage/ng-dialog-params.ts":
/*!****************************************!*\
  !*** ./src/manage/ng-dialog-params.ts ***!
  \****************************************/
/*! exports provided: NgUrlValuesWithoutParams */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NgUrlValuesWithoutParams", function() { return NgUrlValuesWithoutParams; });
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");

/**
 * This is for building/serializing the main url params when opening a dialog.
 * It does not contain the "params" / "items" part
 * @export
 * @class NgUrlValuesWithoutParams
 */
var NgUrlValuesWithoutParams = /** @class */ (function () {
    function NgUrlValuesWithoutParams(context, partOfPage) {
        var _a, _b, _c;
        this.zoneId = context.app.zoneId;
        this.appId = context.app.id;
        this.tid = context.page.id;
        this.mid = context.instance.id;
        this.cbid = context.contentBlockReference.id;
        // 2021-01-19
        // this.lang = context.app.currentLanguage;
        // this.langpri = context.app.primaryLanguage;
        // this.langs = JSON.stringify(context.app.allLanguages);
        // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments
        // this.portalroot = context.tenant.url;
        // 2020-12-11 #cleanup11.11 2dm - doesn't seem used, disabled
        // this.websiteroot = context.instance.sxcRootUrl;
        // New in 11.05.01
        this.api = _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_0__["$2sxcInPage"].env.api();
        // 2021-01-19
        // this.uiRoot = $2sxc.env.uiRoot();
        this.partOfPage = partOfPage;
        if (partOfPage)
            this.publishing = context.contentBlockReference.publishingMode;
        // todo= probably move the user into the dashboard info
        // 2021-01-19 2dm - should now not be used any more
        // this.user = ContextOfUser.fromContext(context);
        this.approot = context.app.appPath || null; // this is the only value which doesn't have a slash by default. note that the app-root doesn't exist when opening "manage-app"
        if ((_c = (_b = (_a = context === null || context === void 0 ? void 0 : context.button) === null || _a === void 0 ? void 0 : _a.command) === null || _b === void 0 ? void 0 : _b.params) === null || _c === void 0 ? void 0 : _c.apps)
            this.apps = context.button.command.params.apps;
        this.fa = !context.app.isContent;
        this.rvth = _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_0__["$2sxcInPage"].env.rvtHeader();
        this.rvt = _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_0__["$2sxcInPage"].env.rvt();
    }
    return NgUrlValuesWithoutParams;
}());



/***/ }),

/***/ "./src/manage/session-state-handler.ts":
/*!*********************************************!*\
  !*** ./src/manage/session-state-handler.ts ***!
  \*********************************************/
/*! exports provided: SessionStateHandler */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SessionStateHandler", function() { return SessionStateHandler; });
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

/**
 * This object helps persist / load / reset
 * a setting in the session-state
 */
// General notes
// - must always use try-catch because in certain environments like iFrame prohibit access to sessionStorage
var SessionStateHandler = /** @class */ (function (_super) {
    __extends(SessionStateHandler, _super);
    function SessionStateHandler(key) {
        var _this = _super.call(this, 'Ses.State') || this;
        _this.key = key;
        _logging__WEBPACK_IMPORTED_MODULE_0__["Insights"].add('system', 'session-state ' + key, _this.log);
        return _this;
    }
    SessionStateHandler.prototype.set = function (value) {
        this.log.add("state '" + this.key + "' set(" + value + ")");
        try {
            sessionStorage.setItem(this.key, value);
        }
        catch ( /* ignore */_a) { /* ignore */ }
    };
    SessionStateHandler.prototype.remove = function () {
        this.log.add("state '" + this.key + "' remove()");
        try {
            sessionStorage.removeItem(this.key);
        }
        catch ( /* ignore */_a) { /* ignore */ }
    };
    SessionStateHandler.prototype.get = function () {
        var result = getItemValue(this.key);
        this.log.add("state '" + this.key + "' get() = '" + result + "'");
        try {
            return result;
        }
        catch ( /* ignore */_a) { /* ignore */ }
    };
    return SessionStateHandler;
}(_logging__WEBPACK_IMPORTED_MODULE_0__["HasLog"]));

function getItemValue(key) {
    try {
        var value = sessionStorage.getItem(key);
        return JSON.parse(value);
    }
    catch (_a) {
        return null;
    }
}


/***/ }),

/***/ "./src/plumbing/TypeTbD.ts":
/*!*********************************!*\
  !*** ./src/plumbing/TypeTbD.ts ***!
  \*********************************/
/*! exports provided: isNothing */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isNothing", function() { return isNothing; });
// These types here are alias-types used for conversions and casting
// We created aliases, so we can specifically see where/why we are doing this
function isNothing(thing) {
    return thing === undefined || thing === null;
}


/***/ }),

/***/ "./src/plumbing/index.ts":
/*!*******************************!*\
  !*** ./src/plumbing/index.ts ***!
  \*******************************/
/*! exports provided: isNothing, ToSxcName, SxcVersion, SxcApiUrlRoot, HeaderNames, ApiUrlRoots, AppApiMarker, AppApiMap, NumberNotDefinedHuge, LogEntryOptions, HasLog, Log, LogCall, Entry, Insights, Obj, urlClean, NoJQ, AssetsLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _TypeTbD__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./TypeTbD */ "./src/plumbing/TypeTbD.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isNothing", function() { return _TypeTbD__WEBPACK_IMPORTED_MODULE_0__["isNothing"]; });

/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../core */ "../core/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToSxcName", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["ToSxcName"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcVersion", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["SxcVersion"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SxcApiUrlRoot", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["SxcApiUrlRoot"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HeaderNames", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["HeaderNames"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ApiUrlRoots", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["ApiUrlRoots"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMarker", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["AppApiMarker"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AppApiMap", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["AppApiMap"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NumberNotDefinedHuge", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["NumberNotDefinedHuge"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogEntryOptions", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["LogEntryOptions"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HasLog", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["HasLog"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Log", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["Log"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "LogCall", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["LogCall"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Entry", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["Entry"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Insights", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["Insights"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Obj", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["Obj"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "urlClean", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["urlClean"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NoJQ", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["NoJQ"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AssetsLoader", function() { return _core__WEBPACK_IMPORTED_MODULE_1__["AssetsLoader"]; });





/***/ }),

/***/ "./src/quick-dialog/iframe-bridge.ts":
/*!*******************************************!*\
  !*** ./src/quick-dialog/iframe-bridge.ts ***!
  \*******************************************/
/*! exports provided: IFrameBridge */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "IFrameBridge", function() { return IFrameBridge; });
/* harmony import */ var _contentBlock_content_block_editor__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../contentBlock/content-block-editor */ "./src/contentBlock/content-block-editor.ts");
/* harmony import */ var _contentBlock_render__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../contentBlock/render */ "./src/contentBlock/render.ts");
/* harmony import */ var _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../context/bundles/context-bundle-button */ "./src/context/bundles/context-bundle-button.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _quick_dialog__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./quick-dialog */ "./src/quick-dialog/quick-dialog.ts");
/* harmony import */ var _quick_dialog_config__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./quick-dialog-config */ "./src/quick-dialog/quick-dialog-config.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();







var scrollTopOffset = 80;
var animationTime = 400;
/**
 *
 */
// ReSharper disable once InconsistentNaming
var IFrameBridge = /** @class */ (function (_super) {
    __extends(IFrameBridge, _super);
    function IFrameBridge(parent) {
        var _this = _super.call(this, 'QDl.IfBrig', parent.log) || this;
        _this.changed = false;
        return _this;
    }
    /**
     * get the sxc-object of this iframe
     */
    IFrameBridge.prototype.uncachedSxc = function () {
        if (!this.instanceSxc)
            throw "can't find sxc-instance of IFrame, probably it wasn't initialized yet";
        return this.instanceSxc.recreate(true);
    };
    IFrameBridge.prototype.getContext = function () {
        var cl = this.log.call('getContext');
        return cl.return(_context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_2__["ContextComplete"].findContext(this.uncachedSxc()));
    };
    IFrameBridge.prototype.getAdditionalDashboardConfig = function () {
        var cl = this.log.call('getAdditionalDashboardConfig');
        return cl.return(_quick_dialog_config__WEBPACK_IMPORTED_MODULE_6__["QuickDialogConfig"].fromContext(this.getContext()));
    };
    IFrameBridge.prototype.hide = function () {
        _quick_dialog__WEBPACK_IMPORTED_MODULE_5__["QuickDialog"].singleton().setVisible(false);
    };
    IFrameBridge.prototype.run = function (verb) {
        this.uncachedSxc().manage.run(verb);
    };
    IFrameBridge.prototype.cancel = function () { _quick_dialog__WEBPACK_IMPORTED_MODULE_5__["QuickDialog"].singleton().cancel(this); };
    IFrameBridge.prototype.showMessage = function (message) {
        var cl = this.log.call('showMessage');
        _contentBlock_render__WEBPACK_IMPORTED_MODULE_1__["renderer"].showMessage(this.getContext(), "<p class=\"no-live-preview-available\">" + message + "</p>");
        this.scrollToTarget(this.tagModule);
        cl.done();
    };
    IFrameBridge.prototype.reloadAndReInit = function () {
        var _this = this;
        this.changed = false;
        return _contentBlock_render__WEBPACK_IMPORTED_MODULE_1__["renderer"].reloadAndReInitialize(this.getContext(), true, true)
            .then(function () { return _this.scrollToTarget(_this.tagModule); })
            .then(function () { return Promise.resolve(_this.getAdditionalDashboardConfig()); });
    };
    IFrameBridge.prototype.setTemplate = function (templateId, templateName, final) {
        var _this = this;
        var cl = this.log.call('setTemplate', "tid: " + templateId + ", tname: " + templateName + ", final: " + final);
        this.changed = true;
        var config = this.getAdditionalDashboardConfig();
        var context = this.getContext();
        var ajax = config.isContent || config.supportsAjax;
        // add msg on full-reload, as it takes longer
        // don't add this on ajax, as it will have side-effects because sometimes
        // in ajax the content won't be replaced
        if (!ajax)
            this.showMessage("refreshing <b>" + templateName + "</b>...");
        var reallySave = final || !ajax;
        var promise = reallySave
            ? _contentBlock_content_block_editor__WEBPACK_IMPORTED_MODULE_0__["ContentBlockEditor"].singleton().updateTemplateFromDia(context, templateId)
            : _contentBlock_render__WEBPACK_IMPORTED_MODULE_1__["renderer"].ajaxLoad(context, templateId, true);
        if (final)
            promise = promise.then(function () { return _quick_dialog__WEBPACK_IMPORTED_MODULE_5__["QuickDialog"].singleton().setVisible(false); });
        promise = ajax
            ? promise.then(function () { return _this.scrollToTarget(_this.tagModule); })
            : promise.then(function () { return window.parent.location.reload(); });
        // return true if ajax, so upstream can update UIs
        return cl.return(promise.then(function () { return ajax; }));
    };
    /**
     * prepare the bridge with the info of the current instance
     */
    IFrameBridge.prototype.setup = function (sxc, dialogName) {
        var cl = this.log.call('setup');
        cl.data('rewire with sxc: ', sxc);
        this.changed = false;
        this.instanceSxc = sxc;
        this.tagModule = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_3__["SxcEdit"].getTag(sxc).parentElement;
        this.sxcCacheKey = sxc.cacheKey;
        if (dialogName)
            this.dialogName = dialogName;
        cl.done();
    };
    /**
     * check if the dialog is showing for the current sxc-instance
     * @param {string} dialogName - name of dialog
     * @returns {boolean} true if it's currently showing for this sxc-instance
     */
    IFrameBridge.prototype.isConfiguredFor = function (instanceId, dialogName) {
        var cl = this.log.call('isConfiguredFor', "id:" + instanceId + ", dialog:" + dialogName);
        var result = this.sxcCacheKey === instanceId // the iframe is showing for the current sxc
            && this.dialogName === dialogName; // the view is the same as previously
        return cl.return(result);
    };
    IFrameBridge.prototype.scrollToTarget = function (target) {
        var cl = this.log.call('scrollToTarget');
        var specs = {
            top: _logging__WEBPACK_IMPORTED_MODULE_4__["NoJQ"].offset(target).top - scrollTopOffset,
            left: 0,
            behavior: 'smooth',
        };
        // debugger; // scrolls to wrong location. Target is wrong
        // window.scrollTo(specs);
        cl.done();
    };
    return IFrameBridge;
}(_logging__WEBPACK_IMPORTED_MODULE_4__["HasLog"]));



/***/ }),

/***/ "./src/quick-dialog/index.ts":
/*!***********************************!*\
  !*** ./src/quick-dialog/index.ts ***!
  \***********************************/
/*! exports provided: urlParams, IFrameBridge, QuickDialog, QuickDialogConfig, QuickDialogContainer, cbId, cancelled */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _connect_parts_inpage_quick_dialog__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../connect-parts/inpage-quick-dialog */ "../connect-parts/inpage-quick-dialog/index.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "urlParams", function() { return _connect_parts_inpage_quick_dialog__WEBPACK_IMPORTED_MODULE_0__["urlParams"]; });

/* harmony import */ var _iframe_bridge__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./iframe-bridge */ "./src/quick-dialog/iframe-bridge.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "IFrameBridge", function() { return _iframe_bridge__WEBPACK_IMPORTED_MODULE_1__["IFrameBridge"]; });

/* harmony import */ var _quick_dialog__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./quick-dialog */ "./src/quick-dialog/quick-dialog.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QuickDialog", function() { return _quick_dialog__WEBPACK_IMPORTED_MODULE_2__["QuickDialog"]; });

/* harmony import */ var _quick_dialog_config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./quick-dialog-config */ "./src/quick-dialog/quick-dialog-config.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QuickDialogConfig", function() { return _quick_dialog_config__WEBPACK_IMPORTED_MODULE_3__["QuickDialogConfig"]; });

/* harmony import */ var _quick_dialog_container__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./quick-dialog-container */ "./src/quick-dialog/quick-dialog-container.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QuickDialogContainer", function() { return _quick_dialog_container__WEBPACK_IMPORTED_MODULE_4__["QuickDialogContainer"]; });

/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./state */ "./src/quick-dialog/state.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "cbId", function() { return _state__WEBPACK_IMPORTED_MODULE_5__["cbId"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "cancelled", function() { return _state__WEBPACK_IMPORTED_MODULE_5__["cancelled"]; });







var css = __webpack_require__(/*! ./quick-dialog.css */ "./src/quick-dialog/quick-dialog.css");


/***/ }),

/***/ "./src/quick-dialog/quick-dialog-config.ts":
/*!*************************************************!*\
  !*** ./src/quick-dialog/quick-dialog-config.ts ***!
  \*************************************************/
/*! exports provided: QuickDialogConfig */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QuickDialogConfig", function() { return QuickDialogConfig; });
var QuickDialogConfig = /** @class */ (function () {
    function QuickDialogConfig() {
    }
    QuickDialogConfig.fromContext = function (context) {
        var config = new QuickDialogConfig();
        config.appId = context.app.id;
        config.isContent = context.app.isContent;
        config.isInnerContent = context.instance.id !== context.contentBlockReference.id; // if it differs, it's inner
        config.hasContent = context.app.hasContent;
        config.isList = context.contentBlock.isList;
        config.templateId = context.contentBlock.templateId;
        config.contentTypeId = context.contentBlock.contentTypeId;
        // config.user = ContextOfUser.fromContext(context);
        config.supportsAjax = context.app.supportsAjax;
        config.debug = window.$2sxc.debug.load;
        return config;
    };
    return QuickDialogConfig;
}());



/***/ }),

/***/ "./src/quick-dialog/quick-dialog-container.ts":
/*!****************************************************!*\
  !*** ./src/quick-dialog/quick-dialog-container.ts ***!
  \****************************************************/
/*! exports provided: QuickDialogContainer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QuickDialogContainer", function() { return QuickDialogContainer; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-dialog/index.ts");
/* harmony import */ var _logging___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../logging/ */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


/**
 * this is a dialog manager which is in charge of all quick-dialoges
 * it always has a reference to the latest dialog created by a.ny module instance
 */
var containerClass = 'inpage-frame-wrapper';
var iframeClass = 'inpage-frame';
var iframeTag = 'iframe';
var containerTemplate = "<div class=\"" + containerClass + "\"><div class=\"" + iframeClass + "\"></div></div>";
var resizeInterval = 200;
var QuickDialogContainer = /** @class */ (function (_super) {
    __extends(QuickDialogContainer, _super);
    function QuickDialogContainer(quickDialog) {
        var _this = _super.call(this, 'QDl.Contnr', quickDialog.log) || this;
        _this.isFullscreen = false;
        _this.resizeWatcher = null;
        return _this;
    }
    /**
     * get the current container
     * @returns {element} html element of the div
     */
    QuickDialogContainer.prototype.getOrCreate = function () {
        var container = document.querySelector("." + containerClass);
        return container !== null && container !== void 0 ? container : this.buildContainerAndIFrame();
    };
    /**
     * build the container in the dom w/iframe for re-use
     * @return {HTMLElement} dom-object
     */
    QuickDialogContainer.prototype.buildContainerAndIFrame = function () {
        var callLog = this.log.call('buildContainerAndIFrame');
        var container = _logging___WEBPACK_IMPORTED_MODULE_1__["NoJQ"].domFromString(containerTemplate)[0];
        if (document.querySelectorAll('#personaBar-iframe').length > 0)
            container.classList.add('persona-bar-visible');
        var newIFrame = document.createElement(iframeTag);
        var extendedIFrame = convertIFrameToQuickDialog(newIFrame, this);
        container.querySelector("." + iframeClass).append(extendedIFrame);
        document.body.append(container);
        this.watchForResize(container);
        return callLog.return(container, 'ok');
    };
    /**
     * find the iframe which hosts the dialog
     * @param {html} [container] - html-container
     * @returns {html} iframe object
     */
    QuickDialogContainer.prototype.getIFrame = function (container) {
        if (!container)
            container = this.getOrCreate();
        return container.querySelector(iframeTag);
    };
    /**
     * set container css for size
     * @param {boolean} fullScreen
     */
    QuickDialogContainer.prototype.setSize = function (fullScreen) {
        var cl = this.log.call('setSize');
        var container = this.getOrCreate();
        // set container height
        container.style.minHeight = fullScreen ? '100%' : '225px';
        this.isFullscreen = fullScreen;
        cl.done();
    };
    /**
     * create watcher which monitors the iframe size and adjusts the container as needed
     */
    QuickDialogContainer.prototype.watchForResize = function (container) {
        var _this = this;
        // only add a timer if not already running
        if (this.resizeWatcher)
            return;
        var callLog = this.log.call('watchForResize');
        // if (!resizeWatcher)
        this.resizeWatcher = window.setInterval(function () {
            try {
                var frm = _this.getIFrame(container);
                if (!frm) {
                    callLog.onlyAddIfNew('no iframe');
                    return;
                }
                var height = frm.contentDocument.body.offsetHeight;
                if (frm.previousHeight === height) {
                    callLog.onlyAddIfNew('no height change');
                    return;
                }
                frm.style.minHeight = container.style.minHeight;
                frm.style.height = height + 'px';
                frm.previousHeight = height;
                if (_this.isFullscreen) {
                    frm.style.height = '100%';
                    frm.style.position = 'absolute';
                }
                callLog.onlyAddIfNew('changed to ' + height);
            }
            catch (e) {
                callLog.add('error', e);
            }
        }, resizeInterval);
        callLog.return(null, 'watcher added');
    };
    return QuickDialogContainer;
}(_logging___WEBPACK_IMPORTED_MODULE_1__["HasLog"]));

function convertIFrameToQuickDialog(iFrame, parent) {
    var callLog = parent.log.call('build');
    callLog.data('prototype', ___WEBPACK_IMPORTED_MODULE_0__["IFrameBridge"].prototype);
    var iFrameExtended = iFrame;
    iFrameExtended.bridge = new ___WEBPACK_IMPORTED_MODULE_0__["IFrameBridge"](parent);
    callLog.data('extensions', iFrameExtended.bridge);
    return callLog.return(iFrameExtended);
}


/***/ }),

/***/ "./src/quick-dialog/quick-dialog.css":
/*!*******************************************!*\
  !*** ./src/quick-dialog/quick-dialog.css ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),

/***/ "./src/quick-dialog/quick-dialog.ts":
/*!******************************************!*\
  !*** ./src/quick-dialog/quick-dialog.ts ***!
  \******************************************/
/*! exports provided: QuickDialog */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QuickDialog", function() { return QuickDialog; });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../interfaces/sxc-controller-in-page */ "./src/interfaces/sxc-controller-in-page.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _quick_dialog_container__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./quick-dialog-container */ "./src/quick-dialog/quick-dialog-container.ts");
/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./state */ "./src/quick-dialog/state.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();





var diagShowClass = 'dia-select';
/** dialog manager - the currently active dialog object */
var current = null;
/**
 * this is a dialog manager which is in charge of all quick-dialogues
 * it always has a reference to the latest dialog created by a.ny module instance
 */
var QuickDialog = /** @class */ (function (_super) {
    __extends(QuickDialog, _super);
    function QuickDialog() {
        var _this = _super.call(this, 'Qdl.Managr') || this;
        _logging__WEBPACK_IMPORTED_MODULE_2__["Insights"].add('quick-dialog', 'manager', _this.log);
        _this.container = new _quick_dialog_container__WEBPACK_IMPORTED_MODULE_3__["QuickDialogContainer"](_this);
        return _this;
    }
    /** Singleton */
    QuickDialog.singleton = function () {
        var _a;
        return (_a = this._singleton) !== null && _a !== void 0 ? _a : (this._singleton = new QuickDialog());
    };
    /**
     * Determines if a.ny dialog is currently showing
     */
    QuickDialog.prototype.isVisible = function () {
        return current != null;
    };
    /**
     * toggle visibility
     * @param {boolean} [show] true/false optional
     */
    QuickDialog.prototype.setVisible = function (show) {
        var cl = this.log.call('setVisible');
        var cont = this.container.getOrCreate();
        cont.classList.toggle(diagShowClass, show);
        this.rememberDialogState(this.container.getIFrame(cont), show);
        current = show ? this.container.getIFrame() : null;
        cl.done();
    };
    /**
     * show / reset the current iframe to use new url and callback
     * @param {ContextComplete} context object
     * @param {string} url - url to show
     * @param {function()} closeCallback - callback event
     * @param {boolean} isFullscreen - if it should open full screen
     * @param {string} [dialogName] - optional name of dialog, to check if it's already open
     * @returns {Promise<boolean>}
     */
    QuickDialog.prototype.showOrToggleFromToolbar = function (context, url, isFullscreen, dialogName) {
        var cl = this.log.call('showOrToggleFromToolbar', "ctx, url: '" + url + "', isFullScreen:" + isFullscreen + ", name:'" + dialogName + "'");
        this.container.setSize(isFullscreen);
        var iFrame = this.container.getIFrame();
        // in case it's a toggle
        if (this.isVisible()) {
            cl.add('is already visible');
            // check if we're just toggling the current, or will show a new one afterwards
            var isForSame = dialogName && current
                && current.bridge.isConfiguredFor(context.sxc.cacheKey, dialogName);
            var togglePromise = isForSame ? this.promise : null;
            this.cancel(current.bridge);
            // just a hide this, return the old promise
            if (togglePromise)
                return cl.return(togglePromise, 'just toggle off');
        }
        var dialogUrl = this.setUrlToQuickDialog(url);
        iFrame.bridge.setup(context.sxc, dialogName);
        iFrame.setAttribute('src', dialogUrl);
        // if the window had already been loaded, re-init
        if (iFrame.contentWindow && iFrame.contentWindow.reboot)
            iFrame.contentWindow.reboot();
        // make sure it's visible'
        this.setVisible(true);
        return cl.return(this.promiseRestart(), 'restart');
    };
    QuickDialog.prototype.cancel = function (bridge) {
        var callLog = this.log.call('cancel');
        this.setVisible(false);
        _state__WEBPACK_IMPORTED_MODULE_4__["cancelled"].set('true');
        this.resolvePromise(bridge.changed);
        callLog.done();
    };
    QuickDialog.prototype.rememberDialogState = function (iframe, state) {
        var callLog = this.log.call('rememberDialogState');
        callLog.add("qDialog persistDia(..., " + state + ")");
        if (state) {
            var cbId = iframe.bridge
                .getContext()
                .contentBlockReference.id.toString();
            callLog.add("contentBlockId: " + cbId + ")");
            return callLog.return(_state__WEBPACK_IMPORTED_MODULE_4__["cbId"].set(cbId));
        }
        return callLog.return(_state__WEBPACK_IMPORTED_MODULE_4__["cbId"].remove(), 'remove');
    };
    QuickDialog.prototype.promiseRestart = function () {
        var _this = this;
        this.promise = new Promise(function (resolve) { return (_this.resolvePromise = resolve); });
        return this.promise;
    };
    //#endregion
    /**
     * rewrite the url to fit the quick-dialog situation
     * optionally with a live-compiled version from ng-serve
     * @param {string} url - original url pointing to the default dialog
     * @returns {string} new url pointing to quick dialog
     */
    QuickDialog.prototype.setUrlToQuickDialog = function (url) {
        var cl = this.log.call('setUrlToQuickDialog', url);
        // change default url-schema from the primary angular-app to the quick-dialog
        url = url
            .replace(_constants__WEBPACK_IMPORTED_MODULE_0__["C"].DialogPaths.ng8, _constants__WEBPACK_IMPORTED_MODULE_0__["C"].DialogPaths.quickDialog);
        url = this.changePathToLocalhostForDev(url);
        return cl.return(url);
    };
    /**
     * special debug-code when running on local ng-serve
     * this is only activated if the developer manually sets a value in the localStorage
     * @param url
     */
    QuickDialog.prototype.changePathToLocalhostForDev = function (url) {
        var cl = this.log.call('changePathToLocalhostForDev', url);
        try {
            var devMode = localStorage.getItem('devMode');
            if (devMode && !!devMode)
                return url.replace(_interfaces_sxc_controller_in_page__WEBPACK_IMPORTED_MODULE_1__["$2sxcInPage"].env.uiRoot() + 'dist/ng/ui.html', 'http://localhost:4200');
        }
        catch (e) {
            // ignore
        }
        return cl.return(url);
    };
    return QuickDialog;
}(_logging__WEBPACK_IMPORTED_MODULE_2__["HasLog"]));



/***/ }),

/***/ "./src/quick-dialog/state.ts":
/*!***********************************!*\
  !*** ./src/quick-dialog/state.ts ***!
  \***********************************/
/*! exports provided: cbId, cancelled */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "cbId", function() { return cbId; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "cancelled", function() { return cancelled; });
/* harmony import */ var _manage_session_state_handler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../manage/session-state-handler */ "./src/manage/session-state-handler.ts");

var cbId = new _manage_session_state_handler__WEBPACK_IMPORTED_MODULE_0__["SessionStateHandler"]('dia-cbid');
var cancelled = new _manage_session_state_handler__WEBPACK_IMPORTED_MODULE_0__["SessionStateHandler"]('cancelled-dialog');


/***/ }),

/***/ "./src/quick-edit/context-for-lists.ts":
/*!*********************************************!*\
  !*** ./src/quick-edit/context-for-lists.ts ***!
  \*********************************************/
/*! exports provided: ContextForLists */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContextForLists", function() { return ContextForLists; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");

var ContextForLists = /** @class */ (function () {
    function ContextForLists() {
    }
    ContextForLists.getFromDom = function (tag) {
        var result = JSON.parse(tag.getAttribute(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.context) || null) || {};
        result.appList = []; // empty by default
        if (result != null && typeof (result.apps) === 'string' && result.apps.length > 1)
            result.appList = result.apps
                .split(',')
                .map(function (s) { return s.trim(); }) // trim
                .filter(function (s) { return !!s; }); // drop empty ones
        return result;
    };
    return ContextForLists;
}());



/***/ }),

/***/ "./src/quick-edit/index.ts":
/*!*********************************!*\
  !*** ./src/quick-edit/index.ts ***!
  \*********************************/
/*! exports provided: Selection, ModifierBase, QuickEditOverlay, QuickEditConfig, ModifierContentBlock, PositionCoordinates, ModifierDnnModule, ModifierDnnModuleInternal, Positioning, QuickE, QuickEClipboard, QeSelectors */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _selection__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./selection */ "./src/quick-edit/selection.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Selection", function() { return _selection__WEBPACK_IMPORTED_MODULE_0__["Selection"]; });

/* harmony import */ var _modifier_base__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./modifier-base */ "./src/quick-edit/modifier-base.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ModifierBase", function() { return _modifier_base__WEBPACK_IMPORTED_MODULE_1__["ModifierBase"]; });

/* harmony import */ var _quick_e_overlays__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./quick-e-overlays */ "./src/quick-edit/quick-e-overlays.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QuickEditOverlay", function() { return _quick_e_overlays__WEBPACK_IMPORTED_MODULE_2__["QuickEditOverlay"]; });

/* harmony import */ var _quick_e_configuration__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./quick-e-configuration */ "./src/quick-edit/quick-e-configuration.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QuickEditConfig", function() { return _quick_e_configuration__WEBPACK_IMPORTED_MODULE_3__["QuickEditConfig"]; });

/* harmony import */ var _modifier_content_block__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./modifier-content-block */ "./src/quick-edit/modifier-content-block.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ModifierContentBlock", function() { return _modifier_content_block__WEBPACK_IMPORTED_MODULE_4__["ModifierContentBlock"]; });

/* harmony import */ var _position_coordinates__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./position-coordinates */ "./src/quick-edit/position-coordinates.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "PositionCoordinates", function() { return _position_coordinates__WEBPACK_IMPORTED_MODULE_5__["PositionCoordinates"]; });

/* harmony import */ var _modifier_dnn_module__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./modifier-dnn-module */ "./src/quick-edit/modifier-dnn-module.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ModifierDnnModule", function() { return _modifier_dnn_module__WEBPACK_IMPORTED_MODULE_6__["ModifierDnnModule"]; });

/* harmony import */ var _modifier_dnn_module_internal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./modifier-dnn-module-internal */ "./src/quick-edit/modifier-dnn-module-internal.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ModifierDnnModuleInternal", function() { return _modifier_dnn_module_internal__WEBPACK_IMPORTED_MODULE_7__["ModifierDnnModuleInternal"]; });

/* harmony import */ var _positioning__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./positioning */ "./src/quick-edit/positioning.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Positioning", function() { return _positioning__WEBPACK_IMPORTED_MODULE_8__["Positioning"]; });

/* harmony import */ var _quick_e__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./quick-e */ "./src/quick-edit/quick-e.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QuickE", function() { return _quick_e__WEBPACK_IMPORTED_MODULE_9__["QuickE"]; });

/* harmony import */ var _quick_e_clipboard__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./quick-e-clipboard */ "./src/quick-edit/quick-e-clipboard.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QuickEClipboard", function() { return _quick_e_clipboard__WEBPACK_IMPORTED_MODULE_10__["QuickEClipboard"]; });

/* harmony import */ var _selectors_instance__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./selectors-instance */ "./src/quick-edit/selectors-instance.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QeSelectors", function() { return _selectors_instance__WEBPACK_IMPORTED_MODULE_11__["QeSelectors"]; });

// must come first because we're still relying on build order












var css = __webpack_require__(/*! ./quickE.css */ "./src/quick-edit/quickE.css");


/***/ }),

/***/ "./src/quick-edit/modifier-base.ts":
/*!*****************************************!*\
  !*** ./src/quick-edit/modifier-base.ts ***!
  \*****************************************/
/*! exports provided: ModifierBase */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ModifierBase", function() { return ModifierBase; });
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

/**
 * Base class for module / content-block editors
 */
var ModifierBase = /** @class */ (function (_super) {
    __extends(ModifierBase, _super);
    function ModifierBase(name) {
        return _super.call(this, name) || this;
    }
    return ModifierBase;
}(_logging__WEBPACK_IMPORTED_MODULE_0__["HasLog"]));



/***/ }),

/***/ "./src/quick-edit/modifier-content-block-internal.ts":
/*!***********************************************************!*\
  !*** ./src/quick-edit/modifier-content-block-internal.ts ***!
  \***********************************************************/
/*! exports provided: ModifierContentBlockInstance */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ModifierContentBlockInstance", function() { return ModifierContentBlockInstance; });
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _toolbar_toolbar_manager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../toolbar/toolbar-manager */ "./src/toolbar/toolbar-manager.ts");
/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../i18n */ "./src/i18n/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



// note: this import must be at the end of the list, for reasons unknown
// otherwise you get an error at runtime, something about constructors
// Object prototype may only be an Object or null: undefined
// not sure why though
// tslint:disable-next-line: ordered-imports

//#region WebApi Endpoints used: 2sxc
var webApiNew = 'cms/block/block';
var webApiMove = 'cms/list/move';
var webApiRemove = 'cms/list/Delete';
//#endregion
/** contains commands to create/move/delete a content-block in an inner-content */
var ModifierContentBlockInstance = /** @class */ (function (_super) {
    __extends(ModifierContentBlockInstance, _super);
    function ModifierContentBlockInstance(parent, sxcInstance) {
        var _this = _super.call(this, 'QE.MdCbIn', parent.log) || this;
        _this.sxcInstance = sxcInstance;
        return _this;
    }
    /**
     * create content block
     * @param parentId
     * @param fieldName
     * @param index
     * @param appName
     * @param container
     * @param newGuid
     */
    ModifierContentBlockInstance.prototype.create = function (parentId, fieldName, index, appName, container, newGuid) {
        // the wrapper, into which this will be placed and the list of pre-existing blocks
        if (!container) {
            alert('can\'t add content-block as we couldn\'t find the list');
            return Promise.resolve();
        }
        var cblockList = container.querySelectorAll('div.sc-content-block');
        if (index > cblockList.length)
            index = cblockList.length; // make sure index is never greater than the amount of items
        var params = {
            parentId: parentId,
            field: fieldName,
            sortOrder: index,
            app: appName,
            guid: newGuid,
        };
        var promise = this.sxcInstance.webApi
            .fetchJson(this.sxcInstance.webApi.url(webApiNew, params), undefined, 'POST')
            .then(function (result) {
            var newTag = _logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].domFromString(result)[0]; // prepare tag for inserting
            // should I add it to a specific position...
            if (cblockList.length > 0 && index > 0)
                cblockList[cblockList.length > index - 1 ? index - 1 : cblockList.length - 1].after(newTag);
            else // ...or just at the beginning?
                container.prepend(newTag);
            // ReSharper disable once UnusedLocals
            var sxcNew = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].get(newTag);
            _toolbar_toolbar_manager__WEBPACK_IMPORTED_MODULE_2__["ToolbarManager"].singleton().buildModule(newTag);
        });
        return Promise.resolve(promise);
    };
    /**
     * move content block
     * @param parentId
     * @param field
     * @param indexFrom
     * @param indexTo
     */
    ModifierContentBlockInstance.prototype.move = function (parent, field, indexFrom, indexTo) {
        var params = {
            parent: parent,
            fields: field,
            index: indexFrom,
            toIndex: indexTo,
        };
        var promise = this.sxcInstance.webApi
            .fetch(this.sxcInstance.webApi.url(webApiMove, params), undefined, 'POST')
            .then(function () {
            console.log('done moving!');
            window.location.reload();
        });
        return Promise.resolve(promise);
    };
    /**
     * delete a content-block inside a list of content-blocks
     * @param parent
     * @param field
     * @param index
     */
    ModifierContentBlockInstance.prototype.delete = function (parent, field, index) {
        if (!confirm(Object(_i18n__WEBPACK_IMPORTED_MODULE_3__["translate"])('QuickInsertMenu.ConfirmDelete')))
            return null;
        var params = {
            parent: parent,
            fields: field,
            index: index,
        };
        var promise = this.sxcInstance.webApi
            .fetch(this.sxcInstance.webApi.url(webApiRemove, params), undefined, 'DELETE')
            .then(function () {
            console.log('done deleting!');
            window.location.reload();
        });
        return Promise.resolve(promise);
    };
    return ModifierContentBlockInstance;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/quick-edit/modifier-content-block.ts":
/*!**************************************************!*\
  !*** ./src/quick-edit/modifier-content-block.ts ***!
  \**************************************************/
/*! exports provided: ModifierContentBlock */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ModifierContentBlock", function() { return ModifierContentBlock; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");
/* harmony import */ var _context_for_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./context-for-lists */ "./src/quick-edit/context-for-lists.ts");
/* harmony import */ var _modifier_content_block_internal__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./modifier-content-block-internal */ "./src/quick-edit/modifier-content-block-internal.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




/**
 * extend the quick edit with the core commands
 */
var ModifierContentBlock = /** @class */ (function (_super) {
    __extends(ModifierContentBlock, _super);
    function ModifierContentBlock() {
        return _super.call(this, 'QE.CntBlk') || this;
    }
    ModifierContentBlock.prototype.getInstanceModifier = function (tag) {
        var sxc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__["SxcEdit"].get(tag);
        return new _modifier_content_block_internal__WEBPACK_IMPORTED_MODULE_3__["ModifierContentBlockInstance"](this, sxc);
    };
    ModifierContentBlock.prototype.delete = function (clip) {
        return this.getInstanceModifier(clip.list).delete(clip.parentGuid, clip.field, this.findClipListIndex(clip));
    };
    ModifierContentBlock.prototype.create = function (parent, field, listIndex, appOrContent, list, newGuid) {
        return this.getInstanceModifier(list).create(parent, field, listIndex, appOrContent, list, newGuid);
    };
    ModifierContentBlock.prototype.move = function (oldClip, newClip) {
        var from = this.findClipListIndex(oldClip);
        var to = this.findClipListIndex(newClip);
        this.getInstanceModifier(oldClip.list).move(newClip.parentGuid, newClip.field, from, to);
    };
    // cb-numbering is a bit different, because the selector is at the bottom
    // only there we should also skip on +1;
    ModifierContentBlock.prototype.isRealMove = function (oldClip, newClip) {
        return this.findClipListIndex(oldClip) + 1 !== this.findClipListIndex(newClip);
    };
    /**
     * find the real index of this block in the list - may not match the DOM index
     */
    ModifierContentBlock.prototype.findClipListIndex = function (clip) {
        return this.findListIndex(clip.item, clip.index);
    };
    /**
     * find the real index of a block tag as it may not match the DOM index
     */
    ModifierContentBlock.prototype.findListIndex = function (tag, fallback) {
        var _a, _b;
        var editContext = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_1__["SxcEdit"].getEditContextOfTag(tag);
        var listIndex = (_b = (_a = editContext === null || editContext === void 0 ? void 0 : editContext.contentBlockReference) === null || _a === void 0 ? void 0 : _a.parentIndex) !== null && _b !== void 0 ? _b : fallback;
        return listIndex;
    };
    /**
     * The button click handler. Must be static, as it will be attached to the buttons
     * So the 'this' is not a ContentBlockModifier, but the html-tag which was clicked
     */
    ModifierContentBlock.onCbButtonClick = function () {
        var blockTag = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton().main.activeContentBlock;
        var button = this;
        var list = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.findClosestList(blockTag);
        var listItems = list.querySelectorAll(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.selector);
        var actionConfig = _context_for_lists__WEBPACK_IMPORTED_MODULE_2__["ContextForLists"].getFromDom(list);
        var newGuid = actionConfig.guid || null;
        // if the target is a content-block, then the list already has items
        // so the domIndex must be based on that. Otherwise use 0
        var domIndex = blockTag.classList.contains(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.class)
            ? Array.from(listItems).indexOf(blockTag) + 1
            : 0;
        // Check if it's a cut/paste action
        var cbAction = button.getAttribute('data-action');
        if (cbAction)
            return ___WEBPACK_IMPORTED_MODULE_0__["QuickEClipboard"].singleton().do(cbAction, list, domIndex, ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.id);
        // this is a create-additional block action
        // in this case the clipboard doesn't exist
        // so we'll have to find the dom object and get the list index
        var listIndex = ___WEBPACK_IMPORTED_MODULE_0__["QuickEClipboard"].singleton().modCb.findListIndex(blockTag, domIndex - 1) + 1;
        var appOrContent = button.getAttribute('data-type');
        return ___WEBPACK_IMPORTED_MODULE_0__["QuickEClipboard"].singleton().modCb.create(actionConfig.parent, actionConfig.field, listIndex, appOrContent, list, newGuid);
    };
    return ModifierContentBlock;
}(___WEBPACK_IMPORTED_MODULE_0__["ModifierBase"]));



/***/ }),

/***/ "./src/quick-edit/modifier-dnn-module-internal.ts":
/*!********************************************************!*\
  !*** ./src/quick-edit/modifier-dnn-module-internal.ts ***!
  \********************************************************/
/*! exports provided: ModifierDnnModuleInternal */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ModifierDnnModuleInternal", function() { return ModifierDnnModuleInternal; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


// Important - for DNN it still uses #jquery
var dnnSF = function (id) { return $.dnnSF(id); };
/**
 * module specific stuff
 */
var ModifierDnnModuleInternal = /** @class */ (function (_super) {
    __extends(ModifierDnnModuleInternal, _super);
    function ModifierDnnModuleInternal(parent) {
        return _super.call(this, 'QE.ModMng', parent.log) || this;
    }
    /**
     * Delete a module
     */
    ModifierDnnModuleInternal.prototype.delete = function (modId) {
        var service = dnnSF(modId);
        var tabId = service.getTabId();
        return sendDnnAjax({
            modId: modId,
            url: dnnSF().getServiceRoot('2sxc') + 'dnn/module/delete',
            method: 'GET',
            data: {
                tabId: tabId,
                modId: modId,
            },
            // ReSharper disable once UnusedParameter
            success: function () { return window.location.reload(); },
        });
    };
    /**
     * Create a new module
     */
    ModifierDnnModuleInternal.prototype.create = function (paneName, index, type) {
        return sendDnnAjax({
            modId: null,
            url: dnnSF().getServiceRoot('internalservices') + 'controlbar/GetPortalDesktopModules',
            method: 'GET',
            data: 'category=All&loadingStartIndex=0&loadingPageSize=100&searchTerm=',
            success: function (desktopModules) {
                var moduleToFind = type === 'Default' ? ' Content' : ' App';
                var module = null;
                // ReSharper disable once UnusedParameter
                desktopModules.forEach(function (e, i) {
                    if (e.ModuleName === moduleToFind)
                        module = e;
                });
                return (!module)
                    ? alert(moduleToFind + ' module not found.')
                    : createMod(paneName, index, module.ModuleID);
            },
        });
    };
    /**
     * Move a DNN Module
     */
    ModifierDnnModuleInternal.prototype.move = function (modId, pane, order) {
        var service = dnnSF(modId);
        var tabId = service.getTabId();
        var dataVar = {
            TabId: tabId,
            ModuleId: modId,
            Pane: pane,
            ModuleOrder: (2 * order + 0),
        };
        sendDnnAjax({
            modId: modId,
            url: dnnSF(modId).getServiceRoot('internalservices') + 'ModuleService/MoveModule',
            method: 'POST',
            data: dataVar,
            success: function () { return window.location.reload(); },
        });
    };
    ModifierDnnModuleInternal.prototype.getPaneName = function (pane) {
        return pane.getAttribute('id').replace('dnn_', '');
    };
    /**
     * find the correct module id from a list of classes - used on the module-wrapper
     */
    ModifierDnnModuleInternal.prototype.getModuleId = function (classes) {
        var result = classes.match(/DnnModule-([0-9]+)(?:\W|$)/);
        return (result && result.length === 2) ? Number(result[1]) : null;
    };
    ModifierDnnModuleInternal.prototype.getMoveButtons = function (current) {
        var pns = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton().cachedPanes;
        // generate list of panes as links
        var targets = _logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].domFromString('<div></div>')[0];
        for (var p = 0; p < pns.length; p++) {
            var pName = this.getPaneName(pns[p]);
            var selected = (current === pName) ? ' selected ' : '';
            if (selected === '') {
                var target = _logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].domFromString("<a data='" + pName + "'>" + pName + "</a>")[0];
                targets.append(target);
            }
        }
        // attach click event...
        var _this = this;
        targets.querySelectorAll('a').forEach(function (e) {
            e.addEventListener('click', function () {
                var link = this;
                var clip = ___WEBPACK_IMPORTED_MODULE_0__["QuickEClipboard"].singleton().clipboard;
                var modId = _this.getModuleId(clip.item.className);
                var newPane = link.getAttribute('data');
                _this.move(modId, newPane, 0);
            });
        });
        return targets;
    };
    return ModifierDnnModuleInternal;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));

// call an api on dnn
function sendDnnAjax(req) {
    // set DNN headers
    var dnnHeaders = {};
    var fakeXhr = {
        setRequestHeader: function (name, value) {
            dnnHeaders[name] = value;
        },
    };
    dnnSF(req.modId).setModuleHeaders(fakeXhr);
    var settings = {
        headers: __assign({ 'X-Requested-With': 'XMLHttpRequest' }, dnnHeaders),
        method: req.method,
    };
    var url = req.url;
    if (req.data) {
        switch (req.method) {
            case 'GET':
                url += typeof req.data === 'string' ? "?" + req.data : "?" + _logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].param(req.data);
                break;
            case 'POST':
                settings.body = new URLSearchParams(_logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].param(req.data));
                settings.headers['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
                break;
        }
    }
    var success = req.success;
    return fetch(url, settings)
        .then(function (response) {
        if (response.status >= 200 && response.status < 300) {
            return response.text();
        }
        throw new Error(response.statusText);
    })
        .then(function (resText) {
        var resData;
        try {
            resData = JSON.parse(resText);
        }
        catch (_a) {
            resData = resText;
        }
        success === null || success === void 0 ? void 0 : success(resData);
        return resData;
    })
        .catch(function (err) {
        alert("Error while talking to server: " + err.message);
        return undefined;
    });
}
// create / insert a new module
function createMod(paneName, position, modId) {
    var postData = {
        Module: modId,
        Page: '',
        Pane: paneName,
        Position: -1,
        Sort: position,
        Visibility: 0,
        AddExistingModule: false,
        CopyModule: false,
    };
    return sendDnnAjax({
        modId: null,
        url: dnnSF().getServiceRoot('internalservices') + 'controlbar/AddModule',
        method: 'POST',
        data: postData,
        success: function () { return window.location.reload(); },
    });
}


/***/ }),

/***/ "./src/quick-edit/modifier-dnn-module.ts":
/*!***********************************************!*\
  !*** ./src/quick-edit/modifier-dnn-module.ts ***!
  \***********************************************/
/*! exports provided: ModifierDnnModule */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ModifierDnnModule", function() { return ModifierDnnModule; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../plumbing */ "./src/plumbing/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var ModifierDnnModule = /** @class */ (function (_super) {
    __extends(ModifierDnnModule, _super);
    function ModifierDnnModule() {
        var _this_1 = _super.call(this, 'QE.DnnMod') || this;
        _this_1.modInternal = new ___WEBPACK_IMPORTED_MODULE_0__["ModifierDnnModuleInternal"](_this_1);
        return _this_1;
    }
    ModifierDnnModule.prototype.delete = function (clip) {
        if (!confirm('are you sure?'))
            return;
        var modId = this.modInternal.getModuleId(clip.item.className);
        this.modInternal.delete(modId);
    };
    // todo: unsure if this is a good place for this bit of code...
    ModifierDnnModule.prototype.move = function (oldClip, newClip /*, from: number, to: number*/) {
        var from = oldClip.index;
        var to = newClip.index;
        var modId = this.modInternal.getModuleId(oldClip.item.className);
        var pane = this.modInternal.getPaneName(newClip.list);
        this.modInternal.move(modId, pane, to);
    };
    ModifierDnnModule.prototype.isRealMove = function (oldClip, newClip) {
        var oldPane = this.modInternal.getPaneName(oldClip.list);
        var newPane = this.modInternal.getPaneName(newClip.list);
        return oldPane !== newPane || oldClip.index !== newClip.index;
    };
    ModifierDnnModule.prototype.showSendToPane = function () {
        // debugger; // there is a bug where pane options are not updated when user clicks send to pane once, until that button is clicked again
        // to reproduce: select module in header pane, click sendToPane. Now select module in content pane and notice panes list is showing panes for previous module
        var quickE = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton();
        var pane = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.mod.findClosestList(quickE.main.activeModule);
        // debugger; // breaks in inner content buttons, like Accordion App. Check if I can hide this button in inner content
        if (!pane)
            return;
        // show the pane-options
        var pl = quickE.selected.querySelector('#paneList');
        if (!pl.matches(':empty'))
            _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].empty(pl);
        pl.append(this.modInternal.getMoveButtons(this.modInternal.getPaneName(pane)));
    };
    ModifierDnnModule.onModuleButtonClick = function () {
        var _this = this;
        var type = _this.getAttribute('data-type');
        var dnnMod = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton().main.activeModule;
        var pane = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.mod.findClosestList(dnnMod);
        var index = 0;
        if (dnnMod.classList.contains('DnnModule'))
            index = Array.from(pane.querySelectorAll('.DnnModule')).indexOf(dnnMod) + 1;
        var cbAction = _this.getAttribute('data-action');
        if (cbAction)
            return ___WEBPACK_IMPORTED_MODULE_0__["QuickEClipboard"].singleton().do(cbAction, pane, index, ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.mod.id); // copy/paste
        var modManage = ___WEBPACK_IMPORTED_MODULE_0__["QuickEClipboard"].singleton().modDnn.modInternal;
        return modManage.create(modManage.getPaneName(pane), index, type);
    };
    return ModifierDnnModule;
}(___WEBPACK_IMPORTED_MODULE_0__["ModifierBase"]));



/***/ }),

/***/ "./src/quick-edit/position-coordinates.ts":
/*!************************************************!*\
  !*** ./src/quick-edit/position-coordinates.ts ***!
  \************************************************/
/*! exports provided: PositionCoordinates */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PositionCoordinates", function() { return PositionCoordinates; });
var PositionCoordinates = /** @class */ (function () {
    function PositionCoordinates(x, y) {
        this.x = x;
        this.y = y;
    }
    return PositionCoordinates;
}());



/***/ }),

/***/ "./src/quick-edit/positioning.ts":
/*!***************************************!*\
  !*** ./src/quick-edit/positioning.ts ***!
  \***************************************/
/*! exports provided: Positioning */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Positioning", function() { return Positioning; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../plumbing */ "./src/plumbing/index.ts");
/* harmony import */ var _context_for_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./context-for-lists */ "./src/quick-edit/context-for-lists.ts");
var __spreadArrays = (undefined && undefined.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};



/**
 * Module with everything related to positioning the quick-edit in-page editing
 */
var Positioning = /** @class */ (function () {
    function Positioning() {
    }
    /**
     * Find the position of an element
     */
    Positioning.get = function (element) {
        var coords = {
            element: element,
            x: _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].offset(element).left,
            w: _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].width(element),
            y: _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].offset(element).top,
            // For content-block ITEMS, the menu must be visible at the end
            // For content-block-LISTS, the menu must be at top
            yh: _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].offset(element).top + (element.matches(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].eitherCbOrMod) ? _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].height(element) : 0),
        };
        return coords;
    };
    /**
     * Prepare offset calculation based on body positioning
     */
    Positioning.getBodyPosition = function () {
        var posNoJq = document.body.style.position;
        var bodyPos = posNoJq; // QuickE.body.css('position');
        var quickE = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton();
        return bodyPos === 'relative' || bodyPos === 'absolute'
            ? new ___WEBPACK_IMPORTED_MODULE_0__["PositionCoordinates"](_plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].offset(quickE.body).left, _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].offset(quickE.body).top)
            : new ___WEBPACK_IMPORTED_MODULE_0__["PositionCoordinates"](0, 0);
    };
    Positioning.positionAndAlign = positionAndAlign;
    Positioning.refresh = refresh;
    return Positioning;
}());

/**
 * Refresh content block and modules elements
 */
function refreshDomObjects() {
    // must update this, as sometimes after finishing page load the position changes, like when dnn adds the toolbar
    var quickE = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton();
    quickE.bodyOffset = Positioning.getBodyPosition();
    if (quickE.config.innerBlocks.enable) {
        // get all content-block lists which are empty, or which allow multiple child-items
        var lists = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.findAllLists().filter(function (e) { return e.matches(":not(." + ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.singleItem + "), :empty"); });
        var children_1 = [];
        lists.forEach(function (l) {
            children_1.push.apply(children_1, Array.from(l.querySelectorAll(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.selector)));
        });
        quickE.contentBlocks = __spreadArrays(lists, children_1);
    }
    if (quickE.config.modules.enable) {
        var panes = quickE.cachedPanes;
        var children_2 = [];
        panes.forEach(function (p) {
            children_2.push.apply(children_2, Array.from(p.querySelectorAll(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.mod.selector)));
        });
        quickE.modules = __spreadArrays(panes, children_2);
    }
}
/**
 * Last time when contentblock and modules are refreshed.
 * Helps to skip unnecessary calls to refresh(e).
 */
var lastCall;
/**
 * position, align and show a menu linked to another item
 */
function positionAndAlign(element, coords) {
    var quickE = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton();
    element.style.left = coords.x - quickE.bodyOffset.x + "px";
    element.style.top = coords.yh - quickE.bodyOffset.y + "px";
    element.style.width = _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].width(coords.element) + "px";
    element.style.display = 'block';
    return element;
}
/**
 * Refresh positioning / visibility of the quick-insert bar
 * @param e
 */
function refresh(e) {
    var highlightClass = 'sc-cb-highlight-for-insert';
    var newDate = new Date();
    if ((!lastCall) || (newDate.getTime() - lastCall.getTime() > 1000)) {
        // console.log('refreshed contentblock and modules');
        lastCall = newDate;
        refreshDomObjects();
    }
    // find the closest content-blocks and modules
    var currentCoords = new ___WEBPACK_IMPORTED_MODULE_0__["PositionCoordinates"](e.clientX, e.clientY);
    var quickE = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton();
    if (quickE.config.innerBlocks.enable && quickE.contentBlocks)
        quickE.nearestCb = findNearest(quickE.contentBlocks, currentCoords);
    if (quickE.config.modules.enable && quickE.modules)
        quickE.nearestMod = findNearest(quickE.modules, currentCoords);
    // hide the buttons for content-block or module, if they are not affected
    quickE.modActions.forEach(function (a) {
        a.classList.toggle('sc-invisible', quickE.nearestMod === null);
    });
    quickE.cbActions.forEach(function (a) {
        a.classList.toggle('sc-invisible', quickE.nearestCb === null);
    });
    var oldParent = quickE.main._parentNode;
    if (quickE.nearestCb !== null || quickE.nearestMod !== null) {
        var alignTo = quickE.nearestCb || quickE.nearestMod;
        // find parent pane to highlight
        var parentPane = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.mod.findClosestList(alignTo.element);
        var parentCbList = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.findClosestList(alignTo.element);
        var parentContainer = parentCbList !== null && parentCbList !== void 0 ? parentCbList : parentPane;
        provideCorrectAddButtons(parentContainer);
        // put part of the pane-name into the button-labels
        if (parentPane) {
            var paneName_1 = parentPane.getAttribute('id') || '';
            if (paneName_1.length > 4)
                paneName_1 = paneName_1.substr(4);
            quickE.modActions.filter(function (a) { return a.matches('[titleTemplate]'); }).forEach(function (a) {
                a.setAttribute('title', a.getAttribute('titleTemplate').replace('{0}', paneName_1));
            });
        }
        positionAndAlign(quickE.main, alignTo);
        // Keep current block as current on menu
        quickE.main.activeContentBlock = quickE.nearestCb ? quickE.nearestCb.element : null;
        quickE.main.activeModule = quickE.nearestMod ? quickE.nearestMod.element : null;
        quickE.main._parentNode = parentContainer;
        parentContainer.classList.add(highlightClass);
    }
    else {
        quickE.main._parentNode = null;
        quickE.main.style.display = 'none';
    }
    // if previously a parent-pane was highlighted, un-highlight it now
    if (oldParent && oldParent !== quickE.main._parentNode)
        oldParent.classList.remove(highlightClass);
}
function provideCorrectAddButtons(tag) {
    var listSettings = _context_for_lists__WEBPACK_IMPORTED_MODULE_2__["ContextForLists"].getFromDom(tag);
    var showContent = true;
    var showApps = true;
    if (listSettings.appList.length > 0) {
        showContent = listSettings.appList.indexOf('Content') > -1;
        // only show apps if the list is longer than 'Content' if it contains that
        showApps = listSettings.appList.length - (showContent ? 1 : 0) > 0;
    }
    ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton().cbActions.forEach(function (a) {
        a.classList.toggle('hide-content', !showContent);
        a.classList.toggle('hide-app', !showApps);
    });
}
/**
 * Return the nearest element to the mouse cursor from elements
 * @param elements
 * @param position
 */
function findNearest(elements, position) {
    var maxDistance = 30; // Defines the maximal distance of the cursor when the menu is displayed
    var nearestItem = null;
    var nearestDistance = maxDistance;
    var posX = position.x + window.scrollX;
    var posY = position.y + window.scrollY;
    // Find nearest element
    elements.forEach(function (element) {
        var e = Positioning.get(element);
        // First check x coordinates - must be within container
        if (posX < e.x || posX > e.x + e.w)
            return;
        // Check if y coordinates are within boundaries
        var distance = Math.abs(posY - e.yh);
        if (distance < maxDistance && distance < nearestDistance) {
            nearestItem = e;
            nearestDistance = distance;
        }
    });
    return nearestItem;
}


/***/ }),

/***/ "./src/quick-edit/quick-e-clipboard.ts":
/*!*********************************************!*\
  !*** ./src/quick-edit/quick-e-clipboard.ts ***!
  \*********************************************/
/*! exports provided: QuickEClipboard */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QuickEClipboard", function() { return QuickEClipboard; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _context_for_lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./context-for-lists */ "./src/quick-edit/context-for-lists.ts");
/* harmony import */ var _modifier_content_block__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./modifier-content-block */ "./src/quick-edit/modifier-content-block.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();





/**
 * add a clipboard to the quick edit
 */
var QuickEClipboard = /** @class */ (function (_super) {
    __extends(QuickEClipboard, _super);
    function QuickEClipboard() {
        var _this = _super.call(this, 'Q-E.Clpbrd') || this;
        /**
         * clipboard object - remembers what module (or content-block) was previously copied / needs to be pasted
         */
        _this.clipboard = new ___WEBPACK_IMPORTED_MODULE_0__["Selection"]();
        _this.mods = {};
        _logging__WEBPACK_IMPORTED_MODULE_2__["Insights"].add('Q-E', 'clipboard', _this.log);
        _this.mods.cb = _this.modCb = new _modifier_content_block__WEBPACK_IMPORTED_MODULE_4__["ModifierContentBlock"]();
        _this.mods.mod = _this.modDnn = new ___WEBPACK_IMPORTED_MODULE_0__["ModifierDnnModule"]();
        // initialize once the DOM is ready
        _logging__WEBPACK_IMPORTED_MODULE_2__["NoJQ"].ready(function () { return _this.initializeSecondaryButtons(); });
        return _this;
    }
    /** Singleton */
    QuickEClipboard.singleton = function () {
        var _a;
        return (_a = this._singleton) !== null && _a !== void 0 ? _a : (this._singleton = new QuickEClipboard());
    };
    /**
     * bind clipboard actions to DOM buttons
     */
    QuickEClipboard.prototype.initializeSecondaryButtons = function () {
        var cl = this.log.call('initializeSecondaryButtons');
        var qem = this;
        ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton().selected.querySelectorAll('a').forEach(function (e) {
            e.addEventListener('click', function () {
                var action = this.getAttribute('data-action');
                switch (action) {
                    case 'delete': return qem.mods[qem.clipboard.type].delete(qem.clipboard);
                    case 'sendToPane': return qem.modDnn.showSendToPane();
                    default: throw new Error("unexpected action: " + action);
                }
            });
        });
        cl.done();
    };
    /**
     * perform copy and paste commands - needs the clipboard
     * @param cbAction
     * @param list
     * @param domIndex
     * @param type
     */
    QuickEClipboard.prototype.do = function (cbAction, list, domIndex, type) {
        var cl = this.log.call('do', cbAction + ", ..., " + domIndex);
        var newClip = this.createSpecs(type, list, domIndex);
        // action!
        switch (cbAction) {
            case 'select':
                this.mark(newClip);
                break;
            case 'paste':
                var from = this.clipboard.index;
                var to = newClip.index;
                // check that we only move block-to-block or module to module
                if (this.clipboard.type !== newClip.type)
                    return alert("can't move module-to-block; move only works from module-to-module or block-to-block");
                if (isNaN(from) || isNaN(to))
                    return this.clearUi(); // skip, nothing real
                var operator = newClip.type === ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.id ? this.modCb : this.modDnn;
                if (!operator.isRealMove(this.clipboard, newClip))
                    return this.clearUi(); // skip, no change
                operator.move(this.clipboard, newClip);
                this.clearUi();
                break;
            default:
        }
        return cl.return(null);
    };
    QuickEClipboard.prototype.mark = function (newData) {
        var _a, _b;
        var cl = this.log.call('mark');
        cl.data('specs', newData);
        if (newData) {
            // if it was already selected with the same thing, then release it
            if (this.clipboard && this.clipboard.item === newData.item)
                return cl.return(this.clearUi());
            this.clipboard = newData;
        }
        this.removeSelectionMarker(); // clear previous markings
        // sometimes missing data.item
        if (!this.clipboard.item)
            return cl.done();
        var selectedItem = this.clipboard.item;
        selectedItem.classList.add(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].selected);
        if ((_a = selectedItem.previousElementSibling) === null || _a === void 0 ? void 0 : _a.matches('iframe'))
            selectedItem.previousElementSibling.classList.add(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].selected);
        this.setSecondaryActionsState(true);
        var quickE = ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton();
        var btnConfig = ((_b = this.clipboard) === null || _b === void 0 ? void 0 : _b.type) === ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.id
            ? quickE.config.innerBlocks.buttons
            : quickE.config.modules.buttons;
        quickE.selected.toggleOverlay(selectedItem, btnConfig);
        cl.done();
    };
    /** Clear the UI so nothing is selected any more */
    QuickEClipboard.prototype.clearUi = function () {
        var cl = this.log.call('clearUi');
        this.removeSelectionMarker();
        this.clipboard = null;
        this.setSecondaryActionsState(false);
        ___WEBPACK_IMPORTED_MODULE_0__["QuickE"].singleton().selected.toggleOverlay(false);
        cl.done();
    };
    QuickEClipboard.prototype.removeSelectionMarker = function () {
        document.querySelectorAll("." + ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].selected).forEach(function (s) { return s.classList.remove(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].selected); });
    };
    QuickEClipboard.prototype.setSecondaryActionsState = function (state) {
        var cl = this.log.call('setSecondaryActionsState');
        var btns = Array.from(document.querySelectorAll('a.sc-content-block-menu-btn'));
        btns = btns.filter(function (btn) { return btn.classList.contains('icon-sxc-paste'); });
        btns.forEach(function (btn) { return btn.classList.toggle(_constants__WEBPACK_IMPORTED_MODULE_1__["C"].ClsNames.UnAvailable, !state); });
        cl.done();
    };
    QuickEClipboard.prototype.createSpecs = function (type, list, domIndex) {
        var cl = this.log.call('createSpecs', type + ", ..., " + domIndex);
        var listItems = list.querySelectorAll(___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks[type].selector);
        // when paste module below the last module in pane
        // index is 1 larger than the length, then select last
        var currentItem = (domIndex >= listItems.length)
            ? listItems[listItems.length - 1]
            : listItems[domIndex];
        // get info what item/block is being edited
        var contextInfo = _context_for_lists__WEBPACK_IMPORTED_MODULE_3__["ContextForLists"].getFromDom(list) || {
            parent: 'dnn',
            field: list.id,
            parentGuid: null,
        };
        return cl.return({
            parent: contextInfo.parent,
            parentGuid: contextInfo.parentGuid,
            field: contextInfo.field,
            list: list,
            item: currentItem,
            index: domIndex,
            type: type,
        });
    };
    return QuickEClipboard;
}(_logging__WEBPACK_IMPORTED_MODULE_2__["HasLog"]));



/***/ }),

/***/ "./src/quick-edit/quick-e-configuration.ts":
/*!*************************************************!*\
  !*** ./src/quick-edit/quick-e-configuration.ts ***!
  \*************************************************/
/*! exports provided: QuickEditConfig */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QuickEditConfig", function() { return QuickEditConfig; });
/**
 * Configuration of QuickE
 * see also https://docs.2sxc.org/specs/js/quicke.html
 */
var QuickEditConfig;
(function (QuickEditConfig) {
    QuickEditConfig.DefaultButtons = {
        addApp: true,
        addContent: true,
        select: true,
        paste: true,
        delete: true,
        move: true,
    };
    function getNewDefaultConfig() {
        return {
            enable: true,
            buttons: QuickEditConfig.DefaultButtons,
            innerBlocks: {
                enable: null,
            },
            modules: {
                enable: null,
            },
        };
    }
    QuickEditConfig.getNewDefaultConfig = getNewDefaultConfig;
})(QuickEditConfig || (QuickEditConfig = {}));


/***/ }),

/***/ "./src/quick-edit/quick-e-overlays.ts":
/*!********************************************!*\
  !*** ./src/quick-edit/quick-e-overlays.ts ***!
  \********************************************/
/*! exports provided: QuickEditOverlay */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QuickEditOverlay", function() { return QuickEditOverlay; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../plumbing */ "./src/plumbing/index.ts");



var QuickEditOverlay;
(function (QuickEditOverlay) {
    function setButtonActivationClasses(buttons, linkTags) {
        var _loop_1 = function (k, v) {
            linkTags.forEach(function (l) {
                l.classList.remove("enable-" + k, "disable-" + k);
            });
        };
        // remove any previously set classes for these
        for (var _i = 0, _a = Object.entries(___WEBPACK_IMPORTED_MODULE_0__["QuickEditConfig"].DefaultButtons); _i < _a.length; _i++) {
            var _b = _a[_i], k = _b[0], v = _b[1];
            _loop_1(k, v);
        }
        var _loop_2 = function (k, v) {
            linkTags.forEach(function (l) {
                l.classList.add((v ? 'enable' : 'disable') + "-" + k);
            });
        };
        // set classes from config
        for (var _c = 0, _d = Object.entries(buttons); _c < _d.length; _c++) {
            var _e = _d[_c], k = _e[0], v = _e[1];
            _loop_2(k, v);
        }
    }
    QuickEditOverlay.setButtonActivationClasses = setButtonActivationClasses;
    function btn(action, icon, i18N, invisible, unavailable, classes) {
        return "<a class='sc-content-block-menu-btn sc-cb-action icon-sxc-" + icon + " " + (invisible ? ' sc-invisible ' : '') + (unavailable ? " " + _constants__WEBPACK_IMPORTED_MODULE_1__["C"].ClsNames.UnAvailable + " " : '') + classes + "' data-action='" + action + "' data-i18n='[title]QuickInsertMenu." + i18N + "'></a>";
    }
    QuickEditOverlay.btn = btn;
    QuickEditOverlay.selectedOverlay = _plumbing__WEBPACK_IMPORTED_MODULE_2__["NoJQ"].domFromString('<div class="sc-content-block-menu sc-content-block-selected-menu sc-i18n"></div>').map(function (o) {
        o.append(_plumbing__WEBPACK_IMPORTED_MODULE_2__["NoJQ"].domFromString(QuickEditOverlay.btn('delete', 'trash-empty', 'Delete'))[0], _plumbing__WEBPACK_IMPORTED_MODULE_2__["NoJQ"].domFromString(QuickEditOverlay.btn('sendToPane', 'move', 'Move', null, null, 'sc-cb-mod-only'))[0], _plumbing__WEBPACK_IMPORTED_MODULE_2__["NoJQ"].domFromString('<div id="paneList"></div>')[0]);
        return o;
    })[0];
})(QuickEditOverlay || (QuickEditOverlay = {}));
/** Expand the selectedOverlay with the necessary toggle function */
QuickEditOverlay.selectedOverlay.toggleOverlay = function (target, buttons) {
    if (!target) {
        QuickEditOverlay.selectedOverlay.style.display = 'none';
    }
    else {
        // 1. set overlay at the right coordinates
        var coords = ___WEBPACK_IMPORTED_MODULE_0__["Positioning"].get(target);
        coords.yh = coords.y + 20;
        ___WEBPACK_IMPORTED_MODULE_0__["Positioning"].positionAndAlign(QuickEditOverlay.selectedOverlay, coords);
        QuickEditOverlay.selectedOverlay.target = target;
        // 2. Activate / deactivate correct buttons
        QuickEditOverlay.setButtonActivationClasses(buttons, Array.from(QuickEditOverlay.selectedOverlay.querySelectorAll('a')));
    }
};


/***/ }),

/***/ "./src/quick-edit/quick-e.ts":
/*!***********************************!*\
  !*** ./src/quick-edit/quick-e.ts ***!
  \***********************************/
/*! exports provided: QuickE */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QuickE", function() { return QuickE; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/quick-edit/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


var configAttr = 'quick-edit-config';
var classForAddContent = 'sc-content-block-menu-addcontent';
var classForAddApp = 'sc-content-block-menu-addapp';
/**
 * the quick-edit object
 * the quick-insert object
 */
var QuickE = /** @class */ (function (_super) {
    __extends(QuickE, _super);
    function QuickE() {
        var _this = _super.call(this, 'Q-E.Main') || this;
        _this.body = document.body;
        _this.main = _logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].domFromString('<div class="sc-content-block-menu sc-content-block-quick-insert sc-i18n"></div>')[0];
        _this.template = "<a class='" + classForAddContent + " sc-invisible' data-type='Default' data-i18n='[titleTemplate]QuickInsertMenu.AddBlockContent'>&nbsp;</a>"
            + ("<a class='" + classForAddApp + " sc-invisible' data-type='' data-i18n='[titleTemplate]QuickInsertMenu.AddBlockApp'>&nbsp;</a>")
            + ("" + ___WEBPACK_IMPORTED_MODULE_0__["QuickEditOverlay"].btn('select', 'ok', 'Select', true) + ___WEBPACK_IMPORTED_MODULE_0__["QuickEditOverlay"].btn('paste', 'paste', 'Paste', true, true));
        _this.selected = ___WEBPACK_IMPORTED_MODULE_0__["QuickEditOverlay"].selectedOverlay;
        // will be populated later in the module section
        _this.contentBlocks = null;
        _this.cachedPanes = null;
        _this.modules = null;
        _this.nearestCb = null;
        _this.nearestMod = null;
        // add stuff which depends on other values to create
        _this.cbActions = _logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].domFromString(_this.template);
        _this.modActions = _logging__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].domFromString(_this.template.replace(/QuickInsertMenu.AddBlock/g, 'QuickInsertMenu.AddModule')).map(function (a) {
            a.setAttribute('data-context', 'module');
            a.classList.add('sc-content-block-menu-module');
            return a;
        });
        //
        _this.config = ___WEBPACK_IMPORTED_MODULE_0__["QuickEditConfig"].getNewDefaultConfig();
        _logging__WEBPACK_IMPORTED_MODULE_1__["Insights"].add('Q-E', 'manager', _this.log);
        _this.modActions.forEach(function (a) {
            a.addEventListener('click', ___WEBPACK_IMPORTED_MODULE_0__["ModifierDnnModule"].onModuleButtonClick);
        });
        _this.cbActions.forEach(function (a) {
            a.addEventListener('click', ___WEBPACK_IMPORTED_MODULE_0__["ModifierContentBlock"].onCbButtonClick);
        });
        return _this;
    }
    /** Singleton */
    QuickE.singleton = function () {
        var _a;
        return (_a = this._singleton) !== null && _a !== void 0 ? _a : (this._singleton = new QuickE());
    };
    QuickE.prototype.start = function () {
        try {
            this.loadPageConfig();
            if (this.config.enable) {
                // initialize first body-offset
                this.bodyOffset = ___WEBPACK_IMPORTED_MODULE_0__["Positioning"].getBodyPosition();
                this.enable();
                this.initWatchMouse();
            }
        }
        catch (e) {
            console.error("couldn't start quick-edit", e);
        }
    };
    /**
     * reset the quick-edit
     * for example after ajax-loading a content-block, which may cause changed configurations
     */
    QuickE.prototype.reset = function () {
        var cl = this.log.call('reset');
        this.loadPageConfig();
        cl.done();
    };
    /**
     * This checks if the page has any alternate configuration
     * Note that it's also used after ajax refreshes, which can change the config
     * So if it does reconfigure itself, it will start with the default config again
     */
    QuickE.prototype.loadPageConfig = function () {
        var _a, _b, _c, _d, _e, _f;
        var cl = this.log.call('loadPageConfig', null, null, { config: this.config });
        this.logConfig();
        var configs = document.querySelectorAll("[" + configAttr + "]");
        var confJ;
        if (configs.length > 0) {
            cl.add('found configs', configs);
            // go through reverse list, as the last is the most important...
            var finalConfig = {};
            for (var c = configs.length; c >= 0; c--) {
                // 2021-09-17 spm either the loop is wrong and we should only get configs[0] or we should be gettings configs[c]
                confJ = configs[0].getAttribute(configAttr);
                try {
                    var confO = JSON.parse(confJ);
                    cl.data('additional config', confO);
                    finalConfig = __assign(__assign({}, finalConfig), confO);
                    cl.data('merged config', finalConfig);
                }
                catch (e) {
                    cl.add('had trouble with json');
                    console.warn('had trouble with json', e);
                }
            }
            var defConfig = ___WEBPACK_IMPORTED_MODULE_0__["QuickEditConfig"].getNewDefaultConfig();
            this.config = __assign(__assign(__assign({}, defConfig), finalConfig), { buttons: __assign(__assign({}, defConfig.buttons), finalConfig.buttons) });
        }
        else
            cl.add('no configs found, will use exiting');
        // expand/merge configs on the sub-nodes module/block
        this.config.innerBlocks.buttons = __assign(__assign({}, (_a = this.config) === null || _a === void 0 ? void 0 : _a.buttons), (_c = (_b = this.config) === null || _b === void 0 ? void 0 : _b.innerBlocks) === null || _c === void 0 ? void 0 : _c.buttons);
        this.config.modules.buttons = __assign(__assign({}, (_d = this.config) === null || _d === void 0 ? void 0 : _d.buttons), (_f = (_e = this.config) === null || _e === void 0 ? void 0 : _e.modules) === null || _f === void 0 ? void 0 : _f.buttons);
        this.logConfig();
        this.detectWhichMenusToActivate();
        cl.done();
    };
    /**
     * existing inner blocks found? Will affect if modules can be quick-inserted...
     */
    QuickE.prototype.detectWhichMenusToActivate = function () {
        var conf = this.config;
        var cl = this.log.call('detectWhichMenusToActivate');
        var innerCBs = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.cb.findAllLists();
        var hasInnerCBs = (innerCBs.length > 0);
        cl.add("has Content Blocks: " + hasInnerCBs, innerCBs);
        // if it has inner-content, then it's probably a details page, where quickly adding modules would be a problem, so for now, disable modules in this case
        if (conf.modules.enable === null || conf.modules.enable === 'auto')
            conf.modules.enable = !hasInnerCBs;
        // for now, ContentBlocks are only enabled if they exist on the page
        if (conf.innerBlocks.enable === null || conf.innerBlocks.enable === 'auto')
            conf.innerBlocks.enable = hasInnerCBs;
        cl.add("module.enable: " + conf.modules.enable);
        cl.add("innerBlocks.enable: " + conf.innerBlocks.enable);
        cl.done();
    };
    QuickE.prototype.enable = function () {
        var cl = this.log.call('enable');
        // build all toolbar html-elements
        this.prepareToolbarInDom();
        // Cache the panes (because panes can't change dynamically)
        this.initPanes();
        cl.done();
    };
    QuickE.prototype.prepareToolbarInDom = function () {
        var _this = this;
        var cl = this.log.call('prepareToolbarInDom');
        this.body.append(this.main);
        this.body.append(this.selected);
        this.cbActions.forEach(function (a) { return _this.main.append(a); });
        this.modActions.forEach(function (a) { return _this.main.append(a); });
        // use config to enable/disable some buttons
        ___WEBPACK_IMPORTED_MODULE_0__["QuickEditOverlay"].setButtonActivationClasses(this.config.innerBlocks.buttons, this.cbActions);
        ___WEBPACK_IMPORTED_MODULE_0__["QuickEditOverlay"].setButtonActivationClasses(this.config.modules.buttons, this.modActions);
        cl.done();
    };
    /**
     * cache the panes which can contain modules
     */
    QuickE.prototype.initPanes = function () {
        var cl = this.log.call('initPanes');
        this.cachedPanes = ___WEBPACK_IMPORTED_MODULE_0__["QeSelectors"].blocks.mod.findAllLists();
        this.cachedPanes.forEach(function (pane) {
            pane.classList.add('sc-cb-pane-glow');
        });
        cl.done();
    };
    /**
     * start watching for mouse-move
     */
    QuickE.prototype.initWatchMouse = function () {
        var cl = this.log.call('initWatchMouse');
        var refreshTimeout = null;
        document.body.addEventListener('mousemove', function (e) {
            if (refreshTimeout === null)
                refreshTimeout = window.setTimeout(function () {
                    requestAnimationFrame(function () {
                        ___WEBPACK_IMPORTED_MODULE_0__["Positioning"].refresh(e);
                        refreshTimeout = null;
                    });
                }, 20);
        });
        cl.done();
    };
    QuickE.prototype.logConfig = function () {
        this.log.add("config enabled: " + this.config.enable + ", mod: " + this.config.modules.enable + ", cb: " + this.config.innerBlocks.enable + ". " + JSON.stringify(this.config) + ")");
    };
    return QuickE;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/quick-edit/quickE.css":
/*!***********************************!*\
  !*** ./src/quick-edit/quickE.css ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),

/***/ "./src/quick-edit/selection.ts":
/*!*************************************!*\
  !*** ./src/quick-edit/selection.ts ***!
  \*************************************/
/*! exports provided: Selection */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Selection", function() { return Selection; });
var Selection = /** @class */ (function () {
    function Selection() {
    }
    return Selection;
}());



/***/ }),

/***/ "./src/quick-edit/selectors-instance.ts":
/*!**********************************************!*\
  !*** ./src/quick-edit/selectors-instance.ts ***!
  \**********************************************/
/*! exports provided: QeSelectors */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QeSelectors", function() { return QeSelectors; });
/**
 * selectors used all over the in-page-editing, centralized to ensure consistency
 */
var contentBlockAndModuleSelectors = {
    cb: {
        id: 'cb',
        class: 'sc-content-block',
        selector: '.sc-content-block',
        findAllLists: function () { return Array.from(document.querySelectorAll('.sc-content-block-list')); },
        findClosestList: function (element) { return element.closest('.sc-content-block-list'); },
        context: 'data-list-context',
        singleItem: 'single-item',
    },
    mod: {
        id: 'mod',
        class: 'DnnModule',
        selector: '.DnnModule',
        // Found no better way to get all panes - the hidden variable does not exist when not in edit page mode
        findAllLists: function () {
            // jquery :has selector (https://api.jquery.com/has-selector/) is not a compatible with css selector
            // and doesn't work without jquery (https://developer.mozilla.org/en-US/docs/Web/CSS/:has)
            // and has absolutely terrible performance (380-560 ms)
            // $('.DNNEmptyPane, .dnnDropEmptyPanes, :has(>.DnnModule)')
            // compact javascript solution is still very slow (10-15 ms)
            // Array.from(document.querySelectorAll('*')).filter((e) => e.matches('.DNNEmptyPane, .dnnDropEmptyPanes') || Array.from(e.children).some((c) => c.matches('.DnnModule')))
            // as fast as can be (3-5 ms)
            var found = [];
            var all = document.querySelectorAll('*');
            for (var i = 0; i < all.length; i++) {
                var el = all[i];
                if (el.matches('.DNNEmptyPane, .dnnDropEmptyPanes')) {
                    found.push(el);
                    continue;
                }
                var children = el.children;
                for (var j = 0; j < children.length; j++) {
                    var child = children[j];
                    if (child.matches('.DnnModule')) {
                        found.push(el);
                        break;
                    }
                }
            }
            return found;
        },
        findClosestList: function (element) {
            if (!element)
                return null;
            if (element.matches('.DNNEmptyPane, .dnnDropEmptyPanes')) {
                return element;
            }
            for (var i = 0; i < element.children.length; i++) {
                var child = element.children[i];
                if (child.matches('.DnnModule')) {
                    return element;
                }
            }
            return contentBlockAndModuleSelectors.mod.findClosestList(element.parentElement);
        },
        context: null,
    },
};
var QeSelectors = {
    blocks: contentBlockAndModuleSelectors,
    eitherCbOrMod: '.DnnModule, .sc-content-block',
    selected: 'sc-cb-is-selected',
};


/***/ }),

/***/ "./src/system/2sxc.system.ts":
/*!***********************************!*\
  !*** ./src/system/2sxc.system.ts ***!
  \***********************************/
/*! exports provided: SystemUpgrader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SystemUpgrader", function() { return SystemUpgrader; });
/* harmony import */ var _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../interfaces/sxc-instance-editable */ "./src/interfaces/sxc-instance-editable.ts");

//#region WebApi Endpoints used: 2sxc
var webApiInstallComplete = 'sys/install/resume';
//#endregion
var SystemUpgrader = /** @class */ (function () {
    function SystemUpgrader() {
    }
    // upgrade command - started when an error contains a link to start this
    SystemUpgrader.prototype.finishUpgrade = function (domElement) {
        var mc = _interfaces_sxc_instance_editable__WEBPACK_IMPORTED_MODULE_0__["SxcEdit"].get(domElement);
        mc.webApi.fetch(webApiInstallComplete)
            .then(function () {
            alert('Upgrade ok, restarting the CMS and reloading...');
            location.reload();
        });
        alert('starting upgrade. This could take a few minutes. You\'ll see an \'ok\' when it\'s done. Please wait...');
    };
    return SystemUpgrader;
}());



/***/ }),

/***/ "./src/system/index.ts":
/*!*****************************!*\
  !*** ./src/system/index.ts ***!
  \*****************************/
/*! exports provided: SystemUpgrader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _2sxc_system__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./2sxc.system */ "./src/system/2sxc.system.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "SystemUpgrader", function() { return _2sxc_system__WEBPACK_IMPORTED_MODULE_0__["SystemUpgrader"]; });




/***/ }),

/***/ "./src/toolbar/config-loaders/button-config-loader.ts":
/*!************************************************************!*\
  !*** ./src/toolbar/config-loaders/button-config-loader.ts ***!
  \************************************************************/
/*! exports provided: ButtonConfigLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ButtonConfigLoader", function() { return ButtonConfigLoader; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/config-loaders/index.ts");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../commands */ "./src/commands/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _config_button_safe__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../config/button-safe */ "./src/toolbar/config/button-safe.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




/**
 * This is a system to build button configurations
 */
var ButtonConfigLoader = /** @class */ (function (_super) {
    __extends(ButtonConfigLoader, _super);
    function ButtonConfigLoader(toolbar) {
        var _this = _super.call(this, 'Tlb.BtCfBl', toolbar.log) || this;
        _this.toolbar = toolbar;
        return _this;
    }
    /**
     * takes an object like "actionname" or { action: "actionname", ... }
     * and changes it to a { command: { action: "actionname" }, ... }
     */
    ButtonConfigLoader.prototype.normalize = function (original) {
        var cl = this.log.call('normalize');
        cl.data('initial', original);
        // prevent multiple inits
        var asBtnConfig = original;
        if (asBtnConfig._expanded || asBtnConfig.command)
            return cl.return(asBtnConfig, "already expanded, won't modify");
        // if just a name, turn into a command
        // use the deep version with command.action, because of more clean-up later on
        if (typeof original === 'string')
            return cl.return(this.btnConfigStructure(original, {}), 'found name, use that');
        // if it's a command w/action, wrap into command + trim
        if (___WEBPACK_IMPORTED_MODULE_0__["InPageCommandJson"].hasActions(original)) {
            cl.add('action found, will move down to .command', original);
            if (original.action)
                original.action = original.action.trim();
            return cl.return({
                command: original,
                _expanded: true,
            }, 'had actions, convert to commands');
        }
        throw 'can\'t expand InPageButtonConfiguration - unexpected type signature encountered';
    };
    ButtonConfigLoader.prototype.btnConfigStructure = function (name, params) {
        var wrapLog = this.log.call('getFromName', name);
        return wrapLog.return({
            command: {
                action: name.trim(),
                params: params,
            },
            _expanded: true,
        }, "name \"" + name + "\" found, will re-map to .command.action");
    };
    /**
     * remove buttons which are not valid based on add condition
     * @param {ContextComplete} context
     * @param {Toolbar} full
     * @param {InstanceConfig} config
     * @memberof ButtonConfigurationBuilder
     */
    ButtonConfigLoader.prototype.removeDisableButtons = function (context, full) {
        var wrapLog = this.log.call('removeDisableButtons', "length of groups: " + full.groups.length);
        var btnGroups = full.groups;
        for (var g = 0; g < btnGroups.length; g++) {
            var btns = btnGroups[g].buttons;
            // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June
            // const config = InstanceConfig.fromContext(context);
            this.removeUnfitButtons(context, /* full,*/ btns /* config, */);
            wrapLog.add('will disable appropriate buttons');
            // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June
            // disableButtons(context, btns/*, config */);
            // remove the group, if no buttons left, or only "more"
            if (btns.length === 0 || (btns.length === 1 && btns[0].command.name === _commands__WEBPACK_IMPORTED_MODULE_1__["CmdMore"])) {
                wrapLog.add('found no more buttons except for the "more" - will remove that group');
                btnGroups.splice(g--, 1); // remove, and decrement counter
            }
        }
        wrapLog.return(null);
    };
    /**
     * enhance button-object with default icons, etc.
     * @param btn
     * @param group
     * @param fullToolbarConfig
     * @param actions
     */
    ButtonConfigLoader.prototype.addDefaultBtnSettings = function (btn, groupDefaults, tlbDefaults, actions) {
        var cl = this.log.call('addDefaultBtnSettings', '', "for " + function () { return btn.command.name; });
        for (var d = 0; d < btnProperties.length; d++)
            fallbackBtnSetting(btn, groupDefaults, tlbDefaults, actions, btnProperties[d]);
        cl.return(null);
    };
    ButtonConfigLoader.prototype.removeUnfitButtons = function (context, btns) {
        // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June
        // config: InstanceConfig,
        var cl = this.log.call('removeUnfitButtons');
        var removals = '';
        for (var i = 0; i < btns.length; i++) {
            var btn = btns[i];
            if (btn.command) {
                context.button = btn; // add to context for calls
                var rule = this.toolbar.toolbarV10.rules.find(btn.id || btn.command.name);
                var show = rule === null || rule === void 0 ? void 0 : rule.overrideShow();
                if (show === undefined) {
                    show = new _config_button_safe__WEBPACK_IMPORTED_MODULE_3__["ButtonSafe"](btn, context).showCondition();
                }
                if (show === false) {
                    removals += "#" + i + " \"" + btn.command.name + "\"; ";
                    btns.splice(i--, 1);
                }
                cl.add("btn '" + btn.command.name + "' show " + show);
            }
        }
        if (removals)
            cl.add("removed buttons: " + removals);
        cl.return(null);
    };
    return ButtonConfigLoader;
}(_logging__WEBPACK_IMPORTED_MODULE_2__["HasLog"]));

var btnProperties = [
    'classes',
    'icon',
    'title',
    'dynamicClasses',
    'showCondition',
    'disabled',
];
/**
 * configure missing button properties with various fallback options
 * @param btn
 * @param group
 * @param fullToolbarConfig
 * @param actions
 * @param propName
 */
function fallbackBtnSetting(btn, groupDefaults, toolbarDefaults, actions, propName) {
    var target = btn;
    // skip it property is already set
    if (target[propName])
        return;
    if (groupDefaults && groupDefaults[propName])
        return target[propName] = groupDefaults[propName];
    // if the toolbar has defaults, try use that property
    if (toolbarDefaults && toolbarDefaults[propName])
        return target[propName] = toolbarDefaults[propName];
    // if there is an action, try to use that property name
    if (btn.command && btn.command.name) {
        var a = actions.get(btn.command.name);
        if (a && a.buttonDefaults) {
            var c = a.buttonDefaults;
            if (c[propName])
                return target[propName] = c[propName];
        }
    }
}


/***/ }),

/***/ "./src/toolbar/config-loaders/command-config-loader.ts":
/*!*************************************************************!*\
  !*** ./src/toolbar/config-loaders/command-config-loader.ts ***!
  \*************************************************************/
/*! exports provided: CommandConfigLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CommandConfigLoader", function() { return CommandConfigLoader; });
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var CommandConfigLoader = /** @class */ (function (_super) {
    __extends(CommandConfigLoader, _super);
    function CommandConfigLoader(toolbar) {
        var _this = _super.call(this, 'Tlb.CmdLdr', toolbar.log) || this;
        _this.toolbar = toolbar;
        return _this;
    }
    /**
     * entity support (compatibility for pre 2sxc v9.x)
     * does some clean-up work on a button-definition object
     * because the target item could be specified directly, or in a complex internal object called entity
     * @param actDef
     */
    CommandConfigLoader.prototype.updateToV9 = function (actDef) {
        // doesn't have the pre-V9 properties, so we're fine
        if (!actDef.entity || !actDef.entity._2sxcEditInformation)
            return actDef;
        var editInfo = actDef.entity._2sxcEditInformation;
        // move up sortOrder property and set useModuleList
        actDef.useModuleList = (editInfo.sortOrder !== undefined); // has sort-order, so use list
        if (editInfo.sortOrder !== undefined)
            actDef.sortOrder = editInfo.sortOrder;
        // move up entityId and clean-up the old 'entity' property
        if (actDef.entity.EntityId !== undefined)
            actDef.entityId = actDef.entity.EntityId;
        delete actDef.entity;
        return actDef;
    };
    return CommandConfigLoader;
}(_logging__WEBPACK_IMPORTED_MODULE_0__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/config-loaders/config-formats/in-page-button-group.ts":
/*!***************************************************************************!*\
  !*** ./src/toolbar/config-loaders/config-formats/in-page-button-group.ts ***!
  \***************************************************************************/
/*! exports provided: InPageButtonGroupJson */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "InPageButtonGroupJson", function() { return InPageButtonGroupJson; });
var InPageButtonGroupJson = /** @class */ (function () {
    function InPageButtonGroupJson() {
    }
    return InPageButtonGroupJson;
}());



/***/ }),

/***/ "./src/toolbar/config-loaders/config-formats/in-page-button.ts":
/*!*********************************************************************!*\
  !*** ./src/toolbar/config-loaders/config-formats/in-page-button.ts ***!
  \*********************************************************************/
/*! exports provided: InPageButtonJson */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "InPageButtonJson", function() { return InPageButtonJson; });
/**
 * Button Definition v1. from old API
 * it is publicly used out of inpage, so take a care to preserve its signature
 */
var InPageButtonJson = /** @class */ (function () {
    function InPageButtonJson() {
    }
    // check two common signatures - command and action
    InPageButtonJson.is = function (thing) {
        return thing.command !== undefined || thing.action !== undefined;
    };
    InPageButtonJson.isArray = function (thing) {
        return thing.length > 0 && InPageButtonJson.is(thing[0]);
    };
    InPageButtonJson.toButton = function (oldFormat) {
        var config = {};
        // simple value properties
        if (oldFormat.classes)
            config.classes = oldFormat.classes;
        if (oldFormat.dialog)
            config.dialog = oldFormat.dialog;
        if (oldFormat.disabled)
            config.disabled = oldFormat.disabled;
        if (oldFormat.icon)
            config.icon = oldFormat.icon;
        // Method Properties
        if (oldFormat.fullScreen)
            config.fullScreen = evalPropOrFun(oldFormat.fullScreen);
        if (oldFormat.icon)
            config.icon = evalPropOrFun(oldFormat.icon);
        if (oldFormat.inlineWindow)
            config.inlineWindow = evalPropOrFun(oldFormat.inlineWindow);
        if (oldFormat.newWindow)
            config.newWindow = evalPropOrFun(oldFormat.newWindow);
        if (oldFormat.partOfPage)
            config.partOfPage = evalPropOrFun(oldFormat.partOfPage);
        if (oldFormat.title)
            config.title = evalPropOrFun(oldFormat.title);
        // if (oldFormat.dynamicClasses) config.dynamicClasses = evalPropOrFun(oldFormat.dynamicClasses);
        // if (oldFormat.showCondition) config.showCondition = evalPropOrFun(oldFormat.showCondition);
        return config;
    };
    return InPageButtonJson;
}());

function evalPropOrFun(propOrFunction) {
    if (propOrFunction === undefined || propOrFunction === null)
        return false;
    if (typeof (propOrFunction) === 'function')
        return propOrFunction;
    return function () { return propOrFunction; };
}


/***/ }),

/***/ "./src/toolbar/config-loaders/config-formats/in-page-command.ts":
/*!**********************************************************************!*\
  !*** ./src/toolbar/config-loaders/config-formats/in-page-command.ts ***!
  \**********************************************************************/
/*! exports provided: InPageCommandJson */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "InPageCommandJson", function() { return InPageCommandJson; });
var InPageCommandJson = /** @class */ (function () {
    function InPageCommandJson() {
    }
    InPageCommandJson.hasActions = function (thing) {
        // check two common signatures - command and action
        return typeof thing.action === 'string';
    };
    InPageCommandJson.hasModify = function (thing) {
        // check two common signatures - command and action
        return !!thing.modify;
    };
    /** Important for object merging - because otherwise action will be preserved */
    InPageCommandJson.noAction = function (thing) {
        // some clean-up
        delete thing.action; // remove the action property
        return thing;
    };
    return InPageCommandJson;
}());



/***/ }),

/***/ "./src/toolbar/config-loaders/group-config-loader.ts":
/*!***********************************************************!*\
  !*** ./src/toolbar/config-loaders/group-config-loader.ts ***!
  \***********************************************************/
/*! exports provided: ButtonGroupConfigLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ButtonGroupConfigLoader", function() { return ButtonGroupConfigLoader; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/config-loaders/index.ts");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../commands */ "./src/commands/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../config */ "./src/toolbar/config/index.ts");
/* harmony import */ var _templates_constants__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/constants */ "./src/toolbar/templates/constants.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};





var ButtonGroupConfigLoader = /** @class */ (function (_super) {
    __extends(ButtonGroupConfigLoader, _super);
    function ButtonGroupConfigLoader(toolbar) {
        var _this = _super.call(this, 'Tlb.GrpCnf', toolbar.log) || this;
        _this.toolbar = toolbar;
        return _this;
    }
    /**
     * this will traverse a groups-tree and expand each group
     * so if groups were just strings like "edit,new" or compact buttons, they will be expanded afterwards
     * @param fullToolbar
     */
    ButtonGroupConfigLoader.prototype.expandButtonGroups = function (fullToolbar) {
        var cl = this.log.call('expandButtonGroups');
        // by now we should have a structure, let's check/fix the buttons
        cl.add("will expand groups - found " + fullToolbar.groups.length + " items");
        for (var g = 0; g < fullToolbar.groups.length; g++) {
            // expand a verb-list like "edit,new" into objects like [{ action: "edit" }, {action: "new"}]
            var group = fullToolbar.groups[g];
            var groupDefaults = group.defaults;
            var btns = this.expandButtonList(group, fullToolbar.settings);
            var buttonConfigs = [];
            if (Array.isArray(btns)) {
                cl.add("will process " + btns.length + " buttons");
                for (var b = 0; b < btns.length; b++)
                    buttonConfigs.push(this.convertToButton(btns[b], fullToolbar.params, fullToolbar.defaults, groupDefaults));
            }
            else
                cl.add("no button array found, won't do a.nything");
            // Toolbar API v2 overwrite V1
            group.buttons = buttonConfigs;
        }
        var toolbar = fullToolbar;
        this.dropMoreIfOnlyOneGroup(toolbar);
        return cl.return(toolbar);
    };
    /**
     * Converts the InPageButtonJson to a Button
     * WARNING: Note that this does the same task as convertToButton in the ButtonConfigLoader - but very differently
     *          I'm not sure why though.
     */
    ButtonGroupConfigLoader.prototype.convertToButton = function (btn, sharedParams, sharedDefaults, 
    // fullToolbar: ToolbarWip,
    // group: ButtonGroupWip
    groupDefaults) {
        var btnCommand = btn.command;
        var identifier = btnCommand.action;
        var name = _config__WEBPACK_IMPORTED_MODULE_3__["Button"].splitName(identifier).name;
        if (!(_commands__WEBPACK_IMPORTED_MODULE_1__["Commands"].singleton().get(name))) {
            this.log.add("couldn't find action " + name + " - show warning");
            console.warn('warning: toolbar-button with unknown action-name:', name);
        }
        // first check if we already got params in the object - then we will use those, otherwise the main object
        var realParams = btnCommand.params
            || ___WEBPACK_IMPORTED_MODULE_0__["InPageCommandJson"].noAction(btnCommand);
        var contentType = realParams.contentType;
        // if the button belongs to a content-item, move the specs up to the item into the settings-object
        btnCommand = this.toolbar.command.updateToV9(btnCommand);
        // parameters adapter from v1 to v2
        var params = __assign(__assign({}, realParams), sharedParams);
        // Toolbar API v2
        var command = new _config__WEBPACK_IMPORTED_MODULE_3__["ButtonCommand"](name, contentType, params);
        var newButtonConfig = new _config__WEBPACK_IMPORTED_MODULE_3__["Button"](command, identifier);
        // settings adapter from v1 to v2
        newButtonConfig = __assign(__assign({}, newButtonConfig), ___WEBPACK_IMPORTED_MODULE_0__["InPageButtonJson"].toButton(btn));
        // ensure all buttons have either own settings, or the fallback
        this.toolbar.button.addDefaultBtnSettings(newButtonConfig, groupDefaults, sharedDefaults, _commands__WEBPACK_IMPORTED_MODULE_1__["Commands"].singleton());
        return newButtonConfig;
    };
    /**
     * take a list of buttons (objects OR strings)
     * and convert to proper array of buttons with actions
     * on the in is a object with buttons, which are either:
     * - a string like "edit" or multi-value "layout,more"
     * - an array of such strings incl. optional complex objects which are
     */
    ButtonGroupConfigLoader.prototype.expandButtonList = function (root, settings) {
        var _this = this;
        var wrapLog = this.log.call('expandButtonList'); // new Log('Tlb.ExpBts', this.log, 'start');
        wrapLog.add('initial', root);
        var buttonsWip = root.buttons;
        var newButtons = [];
        // convert compact buttons (with multi-verb action objects) into own button-objects
        // important because an older syntax allowed {action: "new,edit", entityId: 17}
        if (Array.isArray(buttonsWip)) {
            wrapLog.add("detected array of btns (" + buttonsWip.length + "), will ensure it's an object");
            for (var b = 0; b < buttonsWip.length; b++) {
                var btn = buttonsWip[b];
                var actionNames = btn.action;
                wrapLog.add("will process actions: '" + actionNames + "' for ", btn);
                if (typeof actionNames === 'string' && actionNames.indexOf(',') > -1) {
                    wrapLog.add("actionNames has mult values: '" + actionNames + "'");
                    this.expandButtonAndAddToList(newButtons, btn, actionNames);
                }
                else {
                    wrapLog.add('actionNames has 1 value', btn);
                    newButtons.push(btn);
                }
            }
        }
        else if (typeof buttonsWip === 'string') {
            wrapLog.add("detected that it is a string \"" + buttonsWip + "\", will split by \",\" and ...");
            this.expandButtonAndAddToList(newButtons, {}, buttonsWip);
        }
        else {
            wrapLog.add('no special case detected, will use the buttons-object as is');
            newButtons = buttonsWip;
        }
        wrapLog.add("after check, found " + newButtons.length + " buttons", newButtons);
        // optionally add a more-button in each group
        this.addMoreButton(settings, newButtons);
        var result = newButtons.map(function (x) { return _this.toolbar.button.normalize(x); }); // ensure the internal def is also an array now
        return wrapLog.return(result, 'done');
    };
    ButtonGroupConfigLoader.prototype.expandButtonAndAddToList = function (list, btn, names) {
        var cl = this.log.call('expandButtonAndAddToList', "..., ..., '" + names + "'", "button def \"" + btn + " is string of mult names, will expand into array with action-properties\"");
        var actions = names.length ? names.split(_templates_constants__WEBPACK_IMPORTED_MODULE_4__["TemplateConstants"].ButtonSeparator) : [];
        var params = __assign({}, btn);
        delete params.action;
        for (var a = 0; a < actions.length; a++) {
            var commandPart = this.toolbar.button.btnConfigStructure(actions[a], params);
            cl.data('commandPart', commandPart);
            list.push(commandPart); // {...btn, ...commandPart });
        }
        cl.return(list);
    };
    /** Add the "more" button at the end or beginning */
    ButtonGroupConfigLoader.prototype.addMoreButton = function (settings, list) {
        var cl = this.log.call('addMoreButtons');
        var addMore = settings.autoAddMore;
        if (addMore) {
            var moreButton = this.toolbar.button.btnConfigStructure(_commands__WEBPACK_IMPORTED_MODULE_1__["CmdMore"], {});
            if ((addMore === 'end') || (addMore.toString() === 'right')) { // fallback for older v1 setting
                this.log.add('will add a more "..." button to end');
                list.push(moreButton);
            }
            else {
                this.log.add('will add a more "..." button to start');
                list.unshift(moreButton);
            }
        }
        else
            this.log.add('will not add more "..." button');
        cl.return(list);
    };
    /**
     * If there is only one group, then remove the More button.
     * Note that this has to happen almost at the end, because groups will be removed if empty
     */
    ButtonGroupConfigLoader.prototype.dropMoreIfOnlyOneGroup = function (toolbar) {
        var cl = this.log.call('dropMoreIfOnlyOneGroup');
        if (toolbar.groups.length !== 1)
            return cl.done('not just 1 group');
        cl.add('exactly one group found, will remove more');
        var buttons = toolbar.groups[0].buttons;
        var index = buttons.findIndex(function (b) { var _a; return ((_a = b.command) === null || _a === void 0 ? void 0 : _a.name) === _commands__WEBPACK_IMPORTED_MODULE_1__["CmdMore"]; });
        if (index === -1)
            return cl.done("no 'more' button found");
        buttons.splice(index, 1);
        cl.done('more removed');
    };
    return ButtonGroupConfigLoader;
}(_logging__WEBPACK_IMPORTED_MODULE_2__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/config-loaders/index.ts":
/*!*********************************************!*\
  !*** ./src/toolbar/config-loaders/index.ts ***!
  \*********************************************/
/*! exports provided: InPageButtonJson, InPageCommandJson, InPageButtonGroupJson, ButtonConfigLoader, CommandConfigLoader, ButtonGroupConfigLoader, ToolbarConfigLoaderV09, ToolbarConfigLoaderV10, ToolbarConfigLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config_formats_in_page_button__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config-formats/in-page-button */ "./src/toolbar/config-loaders/config-formats/in-page-button.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "InPageButtonJson", function() { return _config_formats_in_page_button__WEBPACK_IMPORTED_MODULE_0__["InPageButtonJson"]; });

/* harmony import */ var _config_formats_in_page_command__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config-formats/in-page-command */ "./src/toolbar/config-loaders/config-formats/in-page-command.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "InPageCommandJson", function() { return _config_formats_in_page_command__WEBPACK_IMPORTED_MODULE_1__["InPageCommandJson"]; });

/* harmony import */ var _config_formats_in_page_button_group__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-formats/in-page-button-group */ "./src/toolbar/config-loaders/config-formats/in-page-button-group.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "InPageButtonGroupJson", function() { return _config_formats_in_page_button_group__WEBPACK_IMPORTED_MODULE_2__["InPageButtonGroupJson"]; });

/* harmony import */ var _button_config_loader__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./button-config-loader */ "./src/toolbar/config-loaders/button-config-loader.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ButtonConfigLoader", function() { return _button_config_loader__WEBPACK_IMPORTED_MODULE_3__["ButtonConfigLoader"]; });

/* harmony import */ var _command_config_loader__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./command-config-loader */ "./src/toolbar/config-loaders/command-config-loader.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "CommandConfigLoader", function() { return _command_config_loader__WEBPACK_IMPORTED_MODULE_4__["CommandConfigLoader"]; });

/* harmony import */ var _group_config_loader__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./group-config-loader */ "./src/toolbar/config-loaders/group-config-loader.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ButtonGroupConfigLoader", function() { return _group_config_loader__WEBPACK_IMPORTED_MODULE_5__["ButtonGroupConfigLoader"]; });

/* harmony import */ var _toolbar_config_loader_v09__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./toolbar-config-loader-v09 */ "./src/toolbar/config-loaders/toolbar-config-loader-v09.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigLoaderV09", function() { return _toolbar_config_loader_v09__WEBPACK_IMPORTED_MODULE_6__["ToolbarConfigLoaderV09"]; });

/* harmony import */ var _toolbar_config_loader_v10__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./toolbar-config-loader-v10 */ "./src/toolbar/config-loaders/toolbar-config-loader-v10.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigLoaderV10", function() { return _toolbar_config_loader_v10__WEBPACK_IMPORTED_MODULE_7__["ToolbarConfigLoaderV10"]; });

/* harmony import */ var _toolbar_config_loader__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./toolbar-config-loader */ "./src/toolbar/config-loaders/toolbar-config-loader.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigLoader", function() { return _toolbar_config_loader__WEBPACK_IMPORTED_MODULE_8__["ToolbarConfigLoader"]; });












/***/ }),

/***/ "./src/toolbar/config-loaders/toolbar-config-loader-v09.ts":
/*!*****************************************************************!*\
  !*** ./src/toolbar/config-loaders/toolbar-config-loader-v09.ts ***!
  \*****************************************************************/
/*! exports provided: ToolbarConfigLoaderV09 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigLoaderV09", function() { return ToolbarConfigLoaderV09; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/config-loaders/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../config */ "./src/toolbar/config/index.ts");
/* harmony import */ var _templates__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates */ "./src/toolbar/templates/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};




var ToolbarConfigLoaderV09 = /** @class */ (function (_super) {
    __extends(ToolbarConfigLoaderV09, _super);
    function ToolbarConfigLoaderV09(toolbar) {
        var _this = _super.call(this, 'Tlb.TlbV09', toolbar.log) || this;
        _this.toolbar = toolbar;
        return _this;
    }
    ToolbarConfigLoaderV09.prototype.loadV9 = function (context, config) {
        var cl = this.log.call('loadV9');
        var toolbarSettings = config.settings;
        // Default to empty toolbar settings if we don't have a toolbar or settings
        // important: the checks look a bit strange, but there are cases where {} settings are handed in
        // and we can't count the keys because that would result in other checks
        if (Object.keys(config.toolbar).length > 0 && toolbarSettings === {}) {
            cl.add('no data or settings, will use default settings for empty');
            toolbarSettings = _config__WEBPACK_IMPORTED_MODULE_2__["ToolbarSettings"].getForEmpty();
        }
        // if it has an action or is an array, keep that. Otherwise get standard buttons
        var draftToolbar = this.getTemplateIfNoButtonsSpecified(config.toolbar);
        cl.data('after template check', draftToolbar);
        var toolbar = this.buildFullDefinition(context, draftToolbar, toolbarSettings);
        return cl.return(toolbar, 'ok');
    };
    /**
     * If the raw data has specs for what buttons, use that
     * Otherwise load the button list from the template
     */
    ToolbarConfigLoaderV09.prototype.getTemplateIfNoButtonsSpecified = function (raw) {
        var cl = this.log.call('getTemplateIfNoButtonsSpecified');
        cl.add('initial', raw);
        if (___WEBPACK_IMPORTED_MODULE_0__["InPageCommandJson"].hasActions(raw))
            return cl.return(raw, 'has actions, keep raw');
        if (_templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplate"].hasGroups(raw))
            return cl.return(raw, 'has groups, keep raw');
        if (_templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplateGroup"].is(raw))
            return cl.return(raw, 'is group, keep raw');
        if (Array.isArray(raw))
            return cl.return(raw, 'is array, keep raw');
        // final: nothing defined, use template
        cl.add('no toolbar structure specified, will use standard toolbar template');
        // If it's a sub-list toolbar, use the special template for it
        var defToolbarname = raw.fields ? _templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplateSublist"].name : _templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplateDefault"].name;
        var template = this.toolbar.templates.copy(defToolbarname);
        template.params = (Array.isArray(raw) && raw[0]) || raw; // attach parameters
        return cl.return(template, 'use template');
    };
    /**
     * take various common input format and convert it to a full toolbar-structure definition
     * can handle the following input formats (the param unstructuredConfig):
     * complete tree (detected by "groups): { groups: [ {}, {}], name: ..., defaults: {...} }
     * group of buttons (detected by "buttons): { buttons: "..." | [], name: ..., ... }
     * list of buttons (detected by IsArray with action): [ { action: "..." | []}, { action: ""|[]} ]
     * button (detected by "command"): { command: ""|[], icon: "..", ... }
     * just a command (detected by "action"): { entityId: 17, action: "edit" }
     * array of commands: [{entityId: 17, action: "edit"}, {contentType: "blog", action: "new"}]
     */
    ToolbarConfigLoaderV09.prototype.buildFullDefinition = function (toolbarContext, unstructuredConfig, 
    // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June
    // instanceConfig: InstanceConfig,
    toolbarSettings) {
        var cl = this.log.call('buildFullDefinition');
        var configWip = this.ensureDefinitionTree(unstructuredConfig, toolbarSettings); // as unknown as Toolbar;
        if (_templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplate"].is(unstructuredConfig) && unstructuredConfig.debug)
            console.log('toolbar: detailed debug on; start build full Def');
        var result = this.toolbar.buildTreeAndModifyAccordingToRules(toolbarContext, configWip);
        return cl.return(result);
    };
    //#region build initial toolbar object
    /**
     * this will take an input which could already be a tree, but it could also be a
     * button-definition, or just a string, and make sure that afterwards it's a tree with groups
     * the groups could still be in compact form, or already expanded, depending on the input
     * output is object with:
     * - groups containing buttons[], but buttons could still be very flat
     * - defaults, already officially formatted
     * - params, officially formatted
     * @param unstructuredConfig
     * @param toolbarSettings
     */
    ToolbarConfigLoaderV09.prototype.ensureDefinitionTree = function (unstructuredConfig, toolbarSettings) {
        var wrapLog = this.log.call('ensureDefinitionTree');
        // original is null/undefined, just return empty set
        if (!unstructuredConfig)
            throw ("preparing toolbar, with nothing to work on: " + unstructuredConfig);
        var newToolbar = new _config__WEBPACK_IMPORTED_MODULE_2__["Toolbar"]();
        newToolbar.groups = this.findGroups(unstructuredConfig);
        var probablyTemplate = unstructuredConfig;
        newToolbar.params = probablyTemplate.params || {}; // these are the default command parameters
        newToolbar.settings = __assign(__assign(__assign({}, _config__WEBPACK_IMPORTED_MODULE_2__["ToolbarSettings"].getDefaults()), probablyTemplate.settings), _config__WEBPACK_IMPORTED_MODULE_2__["ToolbarSettings"].dropEmptyProperties(toolbarSettings));
        newToolbar.debug = probablyTemplate.debug || false; // show more debug info
        newToolbar.defaults = probablyTemplate.defaults || {}; // the button defaults like icon, etc.
        return wrapLog.return(newToolbar);
    };
    ToolbarConfigLoaderV09.prototype.findGroups = function (unstructuredConfig) {
        var cl = this.log.call('findGroups');
        cl.data('initial', unstructuredConfig);
        // case 0: nothing in the config
        if (!unstructuredConfig || unstructuredConfig === {})
            return cl.return([], 'case 0: empty object, use []');
        var arrGroups = []; // Array<InPageButtonJson | ButtonGroup>;
        // ensure that the groups are all correct
        cl.add('will detect what initial structure was given');
        // Case 2: Array
        if (Array.isArray(unstructuredConfig)) {
            cl.add('Case 2: is array');
            if (unstructuredConfig.length === 0)
                return cl.return([], '2a: empty array');
            if (_config__WEBPACK_IMPORTED_MODULE_2__["Button"].isArray(unstructuredConfig))
                return cl.return([{ buttons: unstructuredConfig }], '2b: array of groups');
            if (___WEBPACK_IMPORTED_MODULE_0__["InPageButtonJson"].is(unstructuredConfig[0]))
                return cl.return([{ buttons: unstructuredConfig }], // Array<InPageButtonJson | ButtonGroup>;
                '2b: is list of buttons, return 1 group');
            console.warn('error detecting groups in this toolbar');
            return cl.return([], "2x: error, it's array but can't detect type, use []");
        }
        // Case 3: not an array
        cl.add('Case 3: not array');
        if (___WEBPACK_IMPORTED_MODULE_0__["InPageButtonJson"].is(unstructuredConfig)) {
            return cl.return([{ buttons: [unstructuredConfig] }], 'Case 3a: not array, but has action/buttons properties, will wrap config into array');
        }
        cl.add('Case 3: not array and no "action", will return it or blank');
        // we either have groups already, or we'll return blank
        if (_templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplate"].hasGroups(unstructuredConfig))
            return cl.return(unstructuredConfig.groups, '4: found groups');
        // else
        //     return cl.return([], 'no groups, return []');
        // ensure that arrays of actions or buttons are re-mapped to the right structure node
        // if (!arrGroups || !(arrGroups as any).length) {
        //     return cl.return([], 'not array or has no items, return empty array');
        // } else
        //     cl.add('its an object or array, use that');
        // if (ButtonGroup.isArray(arrGroups)) {
        //     return cl.return(arrGroups, 'detected buttons on first item, assume button-group, moving into .groups');
        // } else if (InPageButtonJson.isArray(arrGroups)) {
        //     return cl.return([{ buttons:  arrGroups } as InPageButtonGroupJson],
        //         'detected command or action on first item, assume buttons, move into .groups[buttons] ');
        // }
        cl.add('can\'t detect what this is - show warning');
        console.warn("toolbar tried to build toolbar but couldn't detect type of this:", arrGroups);
        return cl.return([], 'warning');
    };
    return ToolbarConfigLoaderV09;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/config-loaders/toolbar-config-loader-v10.ts":
/*!*****************************************************************!*\
  !*** ./src/toolbar/config-loaders/toolbar-config-loader-v10.ts ***!
  \*****************************************************************/
/*! exports provided: ToolbarConfigLoaderV10 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigLoaderV10", function() { return ToolbarConfigLoaderV10; });
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../config */ "./src/toolbar/config/index.ts");
/* harmony import */ var _rules__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../rules */ "./src/toolbar/rules/index.ts");
/* harmony import */ var _templates__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates */ "./src/toolbar/templates/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




var ToolbarConfigLoaderV10 = /** @class */ (function (_super) {
    __extends(ToolbarConfigLoaderV10, _super);
    function ToolbarConfigLoaderV10(toolbar) {
        var _this = _super.call(this, 'Tlb.TlbV10', toolbar.log, 'constructor') || this;
        _this.toolbar = toolbar;
        _this.rules = new _rules__WEBPACK_IMPORTED_MODULE_2__["RuleManager"](toolbar);
        return _this;
    }
    ToolbarConfigLoaderV10.prototype.loadV10 = function (context, config, raw) {
        var _this = this;
        var _a;
        var cl = this.log.call('loadV10');
        this.rules.load(raw);
        var template;
        // #1 prepare settings - get rules and mix with defaults
        // We should use the `ui` parameter, as it's UI rules, but because previously
        // it used the `params` - we must support both :(
        var settingRule = this.rules.getSettings();
        var settingsUiRule = settingRule === null || settingRule === void 0 ? void 0 : settingRule.ui;
        if (Object.keys(settingsUiRule || {}).length === 0)
            settingsUiRule = settingRule === null || settingRule === void 0 ? void 0 : settingRule.params;
        // settingsUiRule = { ...settingRule?.params, ...settingRule?.ui } as unknown as Partial<ToolbarSettings>;
        var settings = new _config__WEBPACK_IMPORTED_MODULE_1__["ToolbarSettings"](settingsUiRule);
        // #2 load either the default toolbar or the one specified
        var toolbarRule = this.rules.getToolbar();
        // #3 find params
        var params = this.rules.getParams();
        // If it's a sub-list toolbar, use the special template for it
        var isSublist = config.toolbar.fields || ((_a = params === null || params === void 0 ? void 0 : params.params) === null || _a === void 0 ? void 0 : _a.fields);
        var defToolbarname = isSublist ? _templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplateSublist"].name : _templates__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplateDefault"].name;
        var toolbarTemplateName = toolbarRule
            ? toolbarRule.name
            : defToolbarname;
        template = this.toolbar.templates.copy(toolbarTemplateName);
        template.settings = settings;
        if (params)
            template.params = params.params;
        // #4 Remove unwanted groups
        var removeGroups = this.rules.getRemoveGroups();
        removeGroups.forEach(function (rg) { return _this.toolbar.templateEditor.removeGroup(template, rg.name); });
        // Add additional buttons
        var add = this.rules.getAdd();
        add.forEach(function (a) {
            if (a.step === _rules__WEBPACK_IMPORTED_MODULE_2__["BuildSteps"].group)
                _this.toolbar.templateEditor.addGroup(template, a.name, a.pos);
            else
                _this.toolbar.templateEditor.addButton(template, a.group, a.id, a.name, a.pos);
        });
        var toolbar = this.toolbar.buildTreeAndModifyAccordingToRules(context, template);
        if (!toolbar.identifier)
            toolbar.identifier = _config__WEBPACK_IMPORTED_MODULE_1__["Toolbar"].createIdentifier();
        toolbar.settings._rules = this.rules;
        // process the rules one by one
        return cl.return(toolbar, 'ok');
    };
    return ToolbarConfigLoaderV10;
}(_logging__WEBPACK_IMPORTED_MODULE_0__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/config-loaders/toolbar-config-loader.ts":
/*!*************************************************************!*\
  !*** ./src/toolbar/config-loaders/toolbar-config-loader.ts ***!
  \*************************************************************/
/*! exports provided: ToolbarConfigLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigLoader", function() { return ToolbarConfigLoader; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/config-loaders/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _templates__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates */ "./src/toolbar/templates/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



// Enable when debugging toolbar creation - will dump all logs to the console
var liveDumpThis = false;
var ToolbarConfigLoader = /** @class */ (function (_super) {
    __extends(ToolbarConfigLoader, _super);
    /** Special constructor that can only be called from the ToolbarManager */
    function ToolbarConfigLoader(_owner) {
        var _this = 
        // important: always create a new log as it will be stored in insights
        _super.call(this, 'Tlb.TlbCnf') || this;
        _this.templates = _templates__WEBPACK_IMPORTED_MODULE_2__["ToolbarTemplateManager"].singleton();
        return _this;
    }
    ToolbarConfigLoader.prototype.setLoggingAndCreateHelpers = function (toolbarData) {
        // note: could be true, false or 'live'
        var debugLog = toolbarData && toolbarData.debug;
        if (debugLog === undefined && Array.isArray(toolbarData) && toolbarData.length)
            debugLog = toolbarData[0].debug;
        debugLog = debugLog || false;
        if (liveDumpThis || debugLog) {
            this.log.keepData = true;
            if (liveDumpThis || debugLog.toString() === 'live')
                this.log.liveDump = true;
            this.log.add("found debug=" + debugLog + ", will enable intense logging");
        }
        this.toolbarV09 = new ___WEBPACK_IMPORTED_MODULE_0__["ToolbarConfigLoaderV09"](this);
        this.toolbarV10 = new ___WEBPACK_IMPORTED_MODULE_0__["ToolbarConfigLoaderV10"](this);
        this.groups = new ___WEBPACK_IMPORTED_MODULE_0__["ButtonGroupConfigLoader"](this);
        this.button = new ___WEBPACK_IMPORTED_MODULE_0__["ButtonConfigLoader"](this);
        this.command = new ___WEBPACK_IMPORTED_MODULE_0__["CommandConfigLoader"](this);
        this.templateEditor = new _templates__WEBPACK_IMPORTED_MODULE_2__["TemplateEditor"](this);
    };
    ToolbarConfigLoader.prototype.load = function (context, config) {
        var cl = this.log.call('load', '', 'expand start', { context: context, config: config });
        // cl.data('initial context', context);
        // cl.data('initial config', config);
        // if null/undefined, use empty object
        var raw = config.toolbar = config.toolbar || {};
        this.setLoggingAndCreateHelpers(raw);
        // check if it's a V10 tolbar
        if (Array.isArray(raw) && raw.length >= 0 && typeof raw[0] === 'string')
            return cl.return(this.toolbarV10.loadV10(context, config, raw), 'v10 done');
        // do standard V3 procedures
        return cl.return(this.toolbarV09.loadV9(context, config), 'V9 done');
    };
    ToolbarConfigLoader.prototype.buildTreeAndModifyAccordingToRules = function (toolbarContext, configWip) {
        var wrapLog = this.log.call('buildFullDefinition');
        var tlbConfig = this.groups.expandButtonGroups(configWip);
        // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June
        this.button.removeDisableButtons(toolbarContext, tlbConfig /*, instanceConfig */);
        return wrapLog.return(tlbConfig);
    };
    return ToolbarConfigLoader;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/config/button-command.ts":
/*!**********************************************!*\
  !*** ./src/toolbar/config/button-command.ts ***!
  \**********************************************/
/*! exports provided: ButtonCommand */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ButtonCommand", function() { return ButtonCommand; });
/* harmony import */ var _commands_commands__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../commands/commands */ "./src/commands/commands.ts");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};

var ButtonCommand = /** @class */ (function () {
    // customCode: string;
    function ButtonCommand(name, contentType, params) {
        this.name = name;
        this.params = params;
        if (!params)
            this.params = {};
        if (contentType)
            this.params.contentType = contentType;
        this.command = _commands_commands__WEBPACK_IMPORTED_MODULE_0__["Commands"].singleton().get(name); // activate command for this
    }
    /** make static, as many ButtonCommand signatures are actually not objects */
    ButtonCommand.mergeAdditionalParams = function (command, additionalParams) {
        var params = {};
        if (command) {
            if (command.name)
                params.action = command.name;
            if (command.params)
                params = __assign(__assign(__assign({}, params), command.params), additionalParams);
        }
        command.params = params;
        return params;
    };
    return ButtonCommand;
}());



/***/ }),

/***/ "./src/toolbar/config/button-group.ts":
/*!********************************************!*\
  !*** ./src/toolbar/config/button-group.ts ***!
  \********************************************/
/*! exports provided: ButtonGroup */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ButtonGroup", function() { return ButtonGroup; });
var ButtonGroup = /** @class */ (function () {
    function ButtonGroup(buttons) {
        this.buttons = buttons;
        this.defaults = {};
        // adds these to the items
        this.buttons = buttons || [];
    }
    /** Detect if this is a ButtonGroup */
    ButtonGroup.is = function (thing) {
        return thing.buttons !== undefined;
    };
    /** Detect if this is a ButtonGroup */
    ButtonGroup.isArray = function (thing) {
        return thing.length && thing[0].buttons !== undefined;
    };
    return ButtonGroup;
}());



/***/ }),

/***/ "./src/toolbar/config/button-safe.ts":
/*!*******************************************!*\
  !*** ./src/toolbar/config/button-safe.ts ***!
  \*******************************************/
/*! exports provided: ButtonSafe */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ButtonSafe", function() { return ButtonSafe; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/config/index.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../plumbing */ "./src/plumbing/index.ts");


/**
 * Special helper to read a button configuration
 * and make sure that all properties have the correct fallback values
 */
var ButtonSafe = /** @class */ (function () {
    function ButtonSafe(button, context) {
        var _this = this;
        this.button = button;
        this.context = context;
        this.action = function () { return _this.button.command; };
        this.classes = function () { return _this.button.classes || ''; };
        /** The dialog name - should default to the name */
        this.dialog = function () { return getVal(_this.button.dialog, _this.context, _this.button.command.name); };
        /** Determines if the button should be disabled */
        this.disabled = function () { return getVal(_this.button.disabled, _this.context, false); };
        /** Dynamicaly determine classes - must always be a function */
        this.dynamicClasses = function () { return getVal(_this.button.dynamicClasses, _this.context, ''); };
        /** Check if full-screen, always a function */
        this.fullScreen = function () { return getVal(_this.button.fullScreen, _this.context, false); };
        /** The icon to show in the button */
        this.icon = function () { return getVal(_this.button.icon, _this.context, ''); };
        /** Determine if it should use the inline window, always a function */
        this.inlineWindow = function () { return getVal(_this.button.inlineWindow, _this.context, false); };
        /** Check if we should open a new window, always an FN */
        this.newWindow = function () { return getVal(_this.button.newWindow, _this.context, false); };
        /** The parameters which are used to run the command */
        this.addParamsToLink = function () { return getVal(_this.button.addParamsToLink, _this.context, {}); };
        /** Determines if this button runs in the page - affecting publishing */
        this.partOfPage = function () { return getVal(_this.button.partOfPage, _this.context, false); };
        /** Method which determines if it should be shown or not */
        this.showCondition = function () { return getVal(_this.button.showCondition, _this.context, true); };
        /** The title of this button which will usually be i18n keys */
        this.title = function () { return getVal(_this.button.title, _this.context, 'unknown-title'); };
        /** this is just a UI interaction, won't create data so won't need pre-flight */
        this.uiActionOnly = function () { return getVal(_this.button.uiActionOnly, _this.context, true); };
    }
    return ButtonSafe;
}());

/** Evaluate a property or generator and return the property */
function getVal(propOrGen, ctx, fallback) {
    if (Object(_plumbing__WEBPACK_IMPORTED_MODULE_1__["isNothing"])(propOrGen))
        return fallback;
    var result = (___WEBPACK_IMPORTED_MODULE_0__["Button"].isPropGen(propOrGen) ? propOrGen(ctx) : propOrGen);
    return result === undefined ? fallback : result;
}


/***/ }),

/***/ "./src/toolbar/config/button.ts":
/*!**************************************!*\
  !*** ./src/toolbar/config/button.ts ***!
  \**************************************/
/*! exports provided: Button */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Button", function() { return Button; });
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../plumbing */ "./src/plumbing/index.ts");

/**
 * The real button configuration as it's used at runtime
 */
var Button = /** @class */ (function () {
    function Button(command, name) {
        var _a;
        /** classes which will be applied to this button */
        this.classes = '';
        /** Determine if it should use the inline window, always a function */
        this.inlineWindow = function () { return false; };
        this.command = command;
        // if the name is an identifier, split it
        var parts = Button.splitName(name);
        this.id = parts.id;
        // this.name = parts.name;
        // get defaults from action commandDefinition
        if ((_a = command === null || command === void 0 ? void 0 : command.command) === null || _a === void 0 ? void 0 : _a.buttonDefaults)
            _plumbing__WEBPACK_IMPORTED_MODULE_0__["Obj"].TypeSafeAssign(this, command.command.buttonDefaults);
    }
    Button.splitName = function (identifier) {
        var parts = identifier.split('=');
        return { id: parts[0], name: parts[1] || identifier };
    };
    /** Detect if this is a Button */
    Button.is = function (thing) {
        return thing.command !== undefined;
    };
    Button.isArray = function (thing) {
        return thing.length && Button.is(thing[0]);
    };
    Button.isPropGen = function (thing) {
        return typeof thing === 'function';
    };
    return Button;
}());



/***/ }),

/***/ "./src/toolbar/config/index.ts":
/*!*************************************!*\
  !*** ./src/toolbar/config/index.ts ***!
  \*************************************/
/*! exports provided: ButtonCommand, Button, ButtonSafe, ButtonGroup, Toolbar, TOOLBAR_SHOW_ALWAYS, TOOLBAR_SHOW_HOVER, TOOLBAR_FOLLOW_INITIAL, TOOLBAR_FOLLOW_ALWAYS, TOOLBAR_FOLLOW_SCROLL, ToolbarSettings, ToolbarWhenNoToolbarProvided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _button_command__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./button-command */ "./src/toolbar/config/button-command.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ButtonCommand", function() { return _button_command__WEBPACK_IMPORTED_MODULE_0__["ButtonCommand"]; });

/* harmony import */ var _button__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./button */ "./src/toolbar/config/button.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Button", function() { return _button__WEBPACK_IMPORTED_MODULE_1__["Button"]; });

/* harmony import */ var _button_safe__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./button-safe */ "./src/toolbar/config/button-safe.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ButtonSafe", function() { return _button_safe__WEBPACK_IMPORTED_MODULE_2__["ButtonSafe"]; });

/* harmony import */ var _button_group__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./button-group */ "./src/toolbar/config/button-group.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ButtonGroup", function() { return _button_group__WEBPACK_IMPORTED_MODULE_3__["ButtonGroup"]; });

/* harmony import */ var _toolbar__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./toolbar */ "./src/toolbar/config/toolbar.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Toolbar", function() { return _toolbar__WEBPACK_IMPORTED_MODULE_4__["Toolbar"]; });

/* harmony import */ var _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./toolbar-settings */ "./src/toolbar/config/toolbar-settings.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_SHOW_ALWAYS", function() { return _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__["TOOLBAR_SHOW_ALWAYS"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_SHOW_HOVER", function() { return _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__["TOOLBAR_SHOW_HOVER"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_FOLLOW_INITIAL", function() { return _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__["TOOLBAR_FOLLOW_INITIAL"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_FOLLOW_ALWAYS", function() { return _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__["TOOLBAR_FOLLOW_ALWAYS"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_FOLLOW_SCROLL", function() { return _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__["TOOLBAR_FOLLOW_SCROLL"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarSettings", function() { return _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__["ToolbarSettings"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarWhenNoToolbarProvided", function() { return _toolbar_settings__WEBPACK_IMPORTED_MODULE_5__["ToolbarWhenNoToolbarProvided"]; });









/***/ }),

/***/ "./src/toolbar/config/toolbar-settings.ts":
/*!************************************************!*\
  !*** ./src/toolbar/config/toolbar-settings.ts ***!
  \************************************************/
/*! exports provided: TOOLBAR_SHOW_ALWAYS, TOOLBAR_SHOW_HOVER, TOOLBAR_FOLLOW_INITIAL, TOOLBAR_FOLLOW_ALWAYS, TOOLBAR_FOLLOW_SCROLL, ToolbarSettings, ToolbarWhenNoToolbarProvided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_SHOW_ALWAYS", function() { return TOOLBAR_SHOW_ALWAYS; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_SHOW_HOVER", function() { return TOOLBAR_SHOW_HOVER; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_FOLLOW_INITIAL", function() { return TOOLBAR_FOLLOW_INITIAL; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_FOLLOW_ALWAYS", function() { return TOOLBAR_FOLLOW_ALWAYS; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TOOLBAR_FOLLOW_SCROLL", function() { return TOOLBAR_FOLLOW_SCROLL; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarSettings", function() { return ToolbarSettings; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarWhenNoToolbarProvided", function() { return ToolbarWhenNoToolbarProvided; });
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var autoAddMoreDefault = 'end';
var hoverDefault = 'right';
var TOOLBAR_SHOW_ALWAYS = 'always';
var TOOLBAR_SHOW_HOVER = 'hover';
var followDefault = 'default';
var TOOLBAR_FOLLOW_INITIAL = 'initial';
var TOOLBAR_FOLLOW_ALWAYS = 'always';
var TOOLBAR_FOLLOW_SCROLL = 'scroll';
/**
 * Toolbar behavior settings like float, etc.
 */
var ToolbarSettings = /** @class */ (function () {
    function ToolbarSettings(defaults) {
        /** Automatically add the '...' more button to the toolbar */
        this.autoAddMore = autoAddMoreDefault;
        /** Hover placement of the toolbar */
        this.hover = hoverDefault;
        /** Show behavior (always, hover, ...) */
        this.show = TOOLBAR_SHOW_HOVER;
        /** Follow behavior - if the toolbar should scroll with the page or remain where it was hovered */
        this.follow = followDefault;
        /**
         * Old term, keep for compatibility. Please use `.class` instead
         * @obsolete
         */
        this.classes = '';
        /**
         * Term for the class for simplicity and consistency with button styling
         * New 10.27
         */
        this.class = '';
        /**
         * color configuration which applies to all buttons
         * use "colorname", "#xxyyzz" or "color1,color2" to specify the colors
         * New in 10.27
         */
        this.color = '';
        if (defaults != null) {
            if (defaults.autoAddMore)
                this.autoAddMore = defaults.autoAddMore;
            if (defaults.hover)
                this.hover = defaults.hover;
            if (defaults.show)
                this.show = defaults.show;
            if (defaults.follow)
                this.follow = defaults.follow;
        }
        // Swap the real follow-default to be "none"
        if (this.follow === followDefault)
            this.follow = 'none';
    }
    /**
     * removes autoAddMore and classes if are null or empty, to keep same behaviour like in v1
     *
     * Note 2dm: not sure why we're doing this, but it seems like we only need this to merge
     * various objects, so we probably want to make sure the in-html-toolbar doesn't accidentally
     * contain null-items we don't want passed on
     * @param toolbarSettings
     */
    ToolbarSettings.dropEmptyProperties = function (toolbarSettings) {
        var partialSettings = __assign({}, toolbarSettings);
        if (!partialSettings.autoAddMore)
            delete partialSettings.autoAddMore;
        if (!partialSettings.classes)
            delete partialSettings.classes;
        return partialSettings;
    };
    ToolbarSettings.getDefaults = function () { return new ToolbarSettings({ autoAddMore: 'end', hover: 'right', show: 'hover', follow: 'default' }); };
    /** Setup for situations where an empty toolbar is needed, without any data or configuration */
    ToolbarSettings.getForEmpty = function () { return new ToolbarSettings({ autoAddMore: 'start', hover: 'left', show: 'hover', follow: 'default' }); };
    return ToolbarSettings;
}());

// TODO: this is in the wrong place, shouldn't be in settings
var ToolbarWhenNoToolbarProvided = {
    toolbar: {},
    settings: ToolbarSettings.getForEmpty(),
};


/***/ }),

/***/ "./src/toolbar/config/toolbar.ts":
/*!***************************************!*\
  !*** ./src/toolbar/config/toolbar.ts ***!
  \***************************************/
/*! exports provided: Toolbar */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Toolbar", function() { return Toolbar; });
/**
 * Runtime configuration of the toolbar.
 * contains a toolbar config + settings + mny groups
 */
var Toolbar = /** @class */ (function () {
    function Toolbar() {
        /** The groups of buttons in this toolbar */
        this.groups = [];
        /** show more debug info */
        this.debug = false;
        this.identifier = Toolbar.createIdentifier();
    }
    Toolbar.createIdentifier = function () {
        return 'Toolbar' + Math.floor(Math.random() * 99999);
    };
    return Toolbar;
}());



/***/ }),

/***/ "./src/toolbar/index.ts":
/*!******************************!*\
  !*** ./src/toolbar/index.ts ***!
  \******************************/
/*! exports provided: ToolbarManager, TagToolbar, TagToolbarManager, ToolbarRenderer, ToolbarInitConfig, ToolbarConfigFinderAndInitializer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _toolbar_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./toolbar-manager */ "./src/toolbar/toolbar-manager.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarManager", function() { return _toolbar_manager__WEBPACK_IMPORTED_MODULE_0__["ToolbarManager"]; });

/* harmony import */ var _tag_toolbars_tag_toolbar__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tag-toolbars/tag-toolbar */ "./src/toolbar/tag-toolbars/tag-toolbar.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TagToolbar", function() { return _tag_toolbars_tag_toolbar__WEBPACK_IMPORTED_MODULE_1__["TagToolbar"]; });

/* harmony import */ var _tag_toolbars_tag_toolbar_manager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./tag-toolbars/tag-toolbar-manager */ "./src/toolbar/tag-toolbars/tag-toolbar-manager.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TagToolbarManager", function() { return _tag_toolbars_tag_toolbar_manager__WEBPACK_IMPORTED_MODULE_2__["TagToolbarManager"]; });

/* harmony import */ var _render_toolbar_renderer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./render/toolbar-renderer */ "./src/toolbar/render/toolbar-renderer.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarRenderer", function() { return _render_toolbar_renderer__WEBPACK_IMPORTED_MODULE_3__["ToolbarRenderer"]; });

/* harmony import */ var _initialize_toolbar_init_config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./initialize/toolbar-init-config */ "./src/toolbar/initialize/toolbar-init-config.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarInitConfig", function() { return _initialize_toolbar_init_config__WEBPACK_IMPORTED_MODULE_4__["ToolbarInitConfig"]; });

/* harmony import */ var _initialize_toolbar_finder_and_initializer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./initialize/toolbar-finder-and-initializer */ "./src/toolbar/initialize/toolbar-finder-and-initializer.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigFinderAndInitializer", function() { return _initialize_toolbar_finder_and_initializer__WEBPACK_IMPORTED_MODULE_5__["ToolbarConfigFinderAndInitializer"]; });









/***/ }),

/***/ "./src/toolbar/initialize/toolbar-finder-and-initializer.ts":
/*!******************************************************************!*\
  !*** ./src/toolbar/initialize/toolbar-finder-and-initializer.ts ***!
  \******************************************************************/
/*! exports provided: ToolbarConfigFinderAndInitializer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarConfigFinderAndInitializer", function() { return ToolbarConfigFinderAndInitializer; });
/* harmony import */ var _constants_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../constants/index */ "./src/constants/index.ts");
/* harmony import */ var _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../context/bundles/context-bundle-button */ "./src/context/bundles/context-bundle-button.ts");
/* harmony import */ var _i18n_translator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../i18n/translator */ "./src/i18n/translator.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../config */ "./src/toolbar/config/index.ts");
/* harmony import */ var _render_toolbar_renderer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../render/toolbar-renderer */ "./src/toolbar/render/toolbar-renderer.ts");
/* harmony import */ var _tag_toolbars_tag_toolbar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../tag-toolbars/tag-toolbar */ "./src/toolbar/tag-toolbars/tag-toolbar.ts");
/* harmony import */ var _toolbar_lifecycle__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../toolbar-lifecycle */ "./src/toolbar/toolbar-lifecycle.ts");
/* harmony import */ var _toolbar_init_config__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./toolbar-init-config */ "./src/toolbar/initialize/toolbar-init-config.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();









// quick debug - set to false if not needed for production
var dbg = false;
var toolbarSelector = ".sc-menu[toolbar],.sc-menu[data-toolbar],[" + _constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.full + "]";
/**
 * This class is responsible for finding toolbar configurations in the doom
 * and then initializing them.
 */
var ToolbarConfigFinderAndInitializer = /** @class */ (function (_super) {
    __extends(ToolbarConfigFinderAndInitializer, _super);
    /**
     * Special constructor which only allows this builder to be instatiated from the TagManager
     * This is to simplify program control flow
     */
    function ToolbarConfigFinderAndInitializer(tlbManager) {
        var _this = _super.call(this, 'Tlb.Buildr', tlbManager.log) || this;
        _this.tlbManager = tlbManager;
        return _this;
    }
    /**
     * Generate toolbars inside a MODULE tag (usually a div with class sc-edit-context)
     * @param parentTag
     * @param optionalId
     */
    ToolbarConfigFinderAndInitializer.prototype.buildDnnModule = function (parentTag /*, optionalId?: number*/) {
        var _this = this;
        var cl = this.log.call('buildDnnModule');
        // 2021-09-17 optionalId is probably never used
        // parentTag = parentTag ?? document.querySelector<HTMLElement>('.DnnModule-' + optionalId);
        // if something says the toolbars are disabled, then skip
        if (parentTag.getAttribute(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.disable))
            return cl.done('disabled');
        var toolbars = this.findChildTagsWithConfig(parentTag);
        // no toolbars found, must help a bit because otherwise editing is hard
        if (toolbars.length === 0) {
            toolbars = addDefaultToolbarConfigToTag(parentTag);
            if (toolbars == null)
                return cl.done('toolbars=null');
        }
        toolbars.forEach(function (e) { return _this.loadConfigAndInitialize(e); });
        // ensure translations are rebuilt
        _i18n_translator__WEBPACK_IMPORTED_MODULE_2__["Translator"].autoTranslateMenus();
        cl.done();
    };
    /**
     * Build toolbar, but allow an html node as target
     * Will automatically find a wrapping sc-edit-context and all containing toolbars
     * @param node
     */
    ToolbarConfigFinderAndInitializer.prototype.build = function (node) {
        var _this = this;
        // go up the DOM to find the parent which has context-information
        // if we have no contextNode (a parent content block), we can
        // assume the node is outside of a 2sxc module so not interesting
        var contextNode = node.closest(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Cb.selectors.ofName);
        if (contextNode == null)
            return;
        // check if the current node needs a toolbar
        if (node.matches(toolbarSelector))
            this.loadConfigAndInitialize(node);
        // activate all child-nodes with toolbars
        var toolbars = node.querySelectorAll(toolbarSelector);
        toolbars.forEach(function (e) { return _this.loadConfigAndInitialize(e); });
    };
    //////////////////////////////// Private Functions ////////////////////////////////////
    /**
     * find current toolbars inside this wrapper-tag
     */
    ToolbarConfigFinderAndInitializer.prototype.findChildTagsWithConfig = function (parentTag) {
        var allInner = Array.from(parentTag.querySelectorAll(toolbarSelector));
        // return only those, which don't belong to a sub-item
        var onlyDirectDescendents = allInner.filter(function (e) { return e.closest(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Cb.selectors.ofName) === parentTag; });
        if (dbg)
            console.log('found toolbars for parent', parentTag, onlyDirectDescendents);
        return onlyDirectDescendents;
    };
    /**
     * Setup a toolbar for a specific tag/node by loading its self-contained configuration
     * and replacing / preparing the toolbar as needed.
     * @param node
     */
    ToolbarConfigFinderAndInitializer.prototype.loadConfigAndInitialize = function (tag) {
        var cl = this.log.call('loadConfigAndInitialize');
        // Do not process tag if a toolbar has already been attached
        if (tag.getAttribute("data-" + _constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attrToMarkInitalized))
            return cl.done('already initialized');
        var config = _toolbar_init_config__WEBPACK_IMPORTED_MODULE_8__["ToolbarInitConfig"].loadFromTag(tag);
        if (config != null) { // is null if load failed
            // catch errors, as this is very common - make sure the others are still rendered
            try {
                this.convertConfigToToolbars(tag, config);
            }
            catch (err2) {
                console.error('error creating toolbar - will skip this one', err2);
            }
        }
        cl.done();
    };
    /**
     * Take a configuration and convert into a toolbar-menu; also attach the hover-attribute
     * @param tag
     * @param config
     */
    ToolbarConfigFinderAndInitializer.prototype.convertConfigToToolbars = function (tag, config) {
        var cl = this.log.call('convertConfigToToolbars');
        cl.data('tag', tag);
        cl.data('config', config);
        var context = _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_1__["ContextComplete"].findContext(tag);
        context.toolbar = this.tlbManager.loadConfig(context, config);
        // V2 where the full toolbar is included in one setting
        if (tag.getAttribute(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.full)) {
            cl.add('V2 TagToolbar detected');
            var tagToolbar = new _tag_toolbars_tag_toolbar__WEBPACK_IMPORTED_MODULE_6__["TagToolbar"](tag, context, _i18n_translator__WEBPACK_IMPORTED_MODULE_2__["Translator"]);
            tag.setAttribute("data-" + _constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attrToMarkInitalized, "" + (tagToolbar != null));
            this.addHoverAttributeToTag(tag);
            return cl.done();
        }
        // default case, tag is the old <ul> tag, so find the sc-element parent before replacing
        var toolbar = new _render_toolbar_renderer__WEBPACK_IMPORTED_MODULE_5__["ToolbarRenderer"](context).generate();
        var hoverParent = tag.closest(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.selectors.ofOldHover);
        cl.data('parentTag', hoverParent);
        tag.replaceWith(toolbar);
        if (hoverParent) {
            cl.add('V1 hover-toolbar and parents found - will add attribute');
            this.addHoverAttributeToTag(hoverParent);
        }
        // Also run toolbar-init on the new toolbar.
        // Must use var 'toolbar' and not 'tag', as that is kind of reset/not existing at this
        // So the event would get lost
        // Added in 12.10
        _toolbar_lifecycle__WEBPACK_IMPORTED_MODULE_7__["ToolbarLifecycle"].raiseToolbarInitEvent(toolbar, toolbar, context);
        cl.done();
    };
    /**
     * add hover-attribute to tag which is responsible for the menu to appear/disappear
     */
    ToolbarConfigFinderAndInitializer.prototype.addHoverAttributeToTag = function (tag) {
        var cl = this.log.call('addHoverAttributeToTag');
        if (!tag)
            return cl.done('no tag found'); // skip in case nothing was given
        if (!tag.hasAttribute(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.hover)) {
            cl.add('will add attribute ' + _constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.hover);
            tag.setAttribute(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.hover, '');
        }
        cl.done();
    };
    return ToolbarConfigFinderAndInitializer;
}(_logging__WEBPACK_IMPORTED_MODULE_3__["HasLog"]));

//////////////////////////////// Private Functions ////////////////////////////////////
/**
 * Create a default/fallback toolbar and return it
 */
function addDefaultToolbarConfigToTag(parentTag) {
    if (dbg)
        console.log("didn't find toolbar, so will auto-create", parentTag);
    var outsideCb = !parentTag.classList.contains(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Cb.classes.name);
    var contentTag = outsideCb ? parentTag.querySelector("div" + _constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Cb.selectors.ofName) : parentTag;
    // auto toolbar
    var ctx = _context_bundles_context_bundle_button__WEBPACK_IMPORTED_MODULE_1__["ContextComplete"].findContext(contentTag);
    if (ctx.ui.autoToolbar === false)
        return null;
    contentTag.setAttribute(_constants_index__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.full, JSON.stringify(_config__WEBPACK_IMPORTED_MODULE_4__["ToolbarWhenNoToolbarProvided"]));
    return [contentTag];
}


/***/ }),

/***/ "./src/toolbar/initialize/toolbar-init-config.ts":
/*!*******************************************************!*\
  !*** ./src/toolbar/initialize/toolbar-init-config.ts ***!
  \*******************************************************/
/*! exports provided: ToolbarInitConfig */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarInitConfig", function() { return ToolbarInitConfig; });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../constants */ "./src/constants/index.ts");
/* harmony import */ var _html_dom_tools__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../html/dom-tools */ "./src/html/dom-tools.ts");


/**
 * The configuration / settings of a toolbar as loaded from the DOM
 */
var ToolbarInitConfig = /** @class */ (function () {
    function ToolbarInitConfig() {
    }
    /**
     * Load the toolbar configuration from the sxc-toolbar attribute OR the old schema
     * @param tag
     * @return a configuration object or null in case of an error
     */
    ToolbarInitConfig.loadFromTag = function (tag) {
        try {
            var newConfigFormat = _html_dom_tools__WEBPACK_IMPORTED_MODULE_1__["HtmlTools"].tryGetAttrText(tag, _constants__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.attr.full);
            if (newConfigFormat) {
                var result = JSON.parse(newConfigFormat);
                // check for new V10.27 format, which is just an array!
                if (Array.isArray(result))
                    return { toolbar: result };
                return result;
            }
            else {
                var at = _constants__WEBPACK_IMPORTED_MODULE_0__["C"].IDs.attr;
                var data = _html_dom_tools__WEBPACK_IMPORTED_MODULE_1__["HtmlTools"].getFirstAttribute(tag, at.toolbar, at.toolbarData);
                var settings = _html_dom_tools__WEBPACK_IMPORTED_MODULE_1__["HtmlTools"].getFirstAttribute(tag, at.settings, at.settingsData);
                return {
                    toolbar: JSON.parse(data),
                    settings: JSON.parse(settings),
                };
            }
        }
        catch (err) {
            console.error('error in settings JSON - probably invalid - make sure you quote properties like "name": ...', tag, err);
            return null;
        }
    };
    return ToolbarInitConfig;
}());



/***/ }),

/***/ "./src/toolbar/render/render-button.ts":
/*!*********************************************!*\
  !*** ./src/toolbar/render/render-button.ts ***!
  \*********************************************/
/*! exports provided: RenderButton */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RenderButton", function() { return RenderButton; });
/* harmony import */ var _html_dom_tools__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../html/dom-tools */ "./src/html/dom-tools.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../config */ "./src/toolbar/config/index.ts");
/* harmony import */ var _render_part_base__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./render-part-base */ "./src/toolbar/render/render-part-base.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



var RenderButton = /** @class */ (function (_super) {
    __extends(RenderButton, _super);
    function RenderButton(parent) {
        return _super.call(this, parent, 'Rnd.Button') || this;
    }
    RenderButton.prototype.render = function (ctx, groupIndex) {
        var _a, _b, _c, _d, _e, _f;
        var cl = this.log.call('render', "contex: obj, group: " + groupIndex + ", btn: " + ctx.button.id + "/" + ((_a = ctx.button.command) === null || _a === void 0 ? void 0 : _a.name));
        var btn = new _config__WEBPACK_IMPORTED_MODULE_1__["ButtonSafe"](ctx.button, ctx);
        // check if we have rules and merge params into the button
        var rule = (_d = (_c = (_b = ctx.toolbar) === null || _b === void 0 ? void 0 : _b.settings) === null || _c === void 0 ? void 0 : _c._rules) === null || _d === void 0 ? void 0 : _d.find(ctx.button.id);
        if (rule)
            cl.data('rule found, will try to merge params', rule);
        var params = _config__WEBPACK_IMPORTED_MODULE_1__["ButtonCommand"].mergeAdditionalParams(btn.action(), rule === null || rule === void 0 ? void 0 : rule.params);
        var group = (_f = (_e = ctx.toolbar) === null || _e === void 0 ? void 0 : _e.groups) === null || _f === void 0 ? void 0 : _f[groupIndex];
        var groupName = group === null || group === void 0 ? void 0 : group.name;
        var btnLink = document.createElement('a');
        var disabled = btn.disabled();
        // put call as plain JavaScript to preserve even if DOM is serialized
        if (!disabled)
            btnLink.setAttribute('onclick', this.generateRunJs(ctx, params));
        // Add various classes
        var classes = (disabled ? ' disabled' : '')
            + (btn.action() ? " sc-" + btn.action().name : '')
            + (" in-group-" + groupIndex)
            + (groupName ? " in-group-" + groupName : '')
            + ' ' + (rule === null || rule === void 0 ? void 0 : rule.ui.class)
            + ' ' + btn.classes()
            + ' ' + btn.dynamicClasses();
        cl.add('classes: ' + classes);
        _html_dom_tools__WEBPACK_IMPORTED_MODULE_0__["HtmlTools"].addClasses(btnLink, classes);
        // set title for button, optionally with i18n
        this.setTitle(rule, btnLink, btn);
        var divTag = document.createElement('div');
        divTag.appendChild(this.iconTag(btn, rule));
        btnLink.appendChild(divTag);
        // set color - new in 10.27
        this.processColorRules(rule, ctx, divTag);
        return cl.return(btnLink);
    };
    RenderButton.prototype.setTitle = function (rule, btnLink, btn) {
        var _a;
        var callLog = this.log.call('setTitles');
        var uiTitle = (_a = rule === null || rule === void 0 ? void 0 : rule.ui) === null || _a === void 0 ? void 0 : _a.title;
        if (uiTitle) {
            callLog.add("uiTitle: " + uiTitle);
            btnLink.setAttribute('title', uiTitle);
        }
        else {
            var i18nTitle = btn.title();
            callLog.add("i18nTitle: " + i18nTitle);
            if (i18nTitle)
                btnLink.setAttribute('data-i18n', "[title]" + i18nTitle);
        }
        callLog.done();
    };
    RenderButton.prototype.processColorRules = function (rule, ctx, divTag) {
        var _a;
        var callLog = this.log.call('processColorRules');
        var color = ((_a = rule === null || rule === void 0 ? void 0 : rule.ui) === null || _a === void 0 ? void 0 : _a.color) || ctx.toolbar.settings.color;
        // catch edge case where the color is something like 808080 - which is treated as a number
        if (color && typeof color === 'number')
            color = color.toString();
        if (color && typeof color === 'string') {
            var parts = color.split(',');
            if (parts[0])
                divTag.style.backgroundColor = correctColorCodes(parts[0]);
            if (parts[1])
                divTag.style.color = correctColorCodes(parts[1]);
        }
        return callLog.done(color !== null && color !== void 0 ? color : 'no color');
    };
    RenderButton.prototype.generateRunJs = function (ctx, params) {
        return "$2sxc(" + ctx.instance.id + ", " + ctx.contentBlockReference.id + ").manage.run(" + JSON.stringify(params) + ", event);";
    };
    RenderButton.prototype.iconTag = function (btn, rule) {
        var _a;
        var callLog = this.log.call('iconTag');
        var symbol = document.createElement('i');
        var icon = ((_a = rule === null || rule === void 0 ? void 0 : rule.ui) === null || _a === void 0 ? void 0 : _a.icon) || btn.icon();
        _html_dom_tools__WEBPACK_IMPORTED_MODULE_0__["HtmlTools"].addClasses(symbol, icon);
        symbol.setAttribute('aria-hidden', 'true');
        return callLog.return(symbol, icon);
    };
    return RenderButton;
}(_render_part_base__WEBPACK_IMPORTED_MODULE_2__["RenderPart"]));

// detect Hex-colors 6-digits or 8 in case transparent
var colorDetect = '^([A-Fa-f0-9]{6,8})$';
function correctColorCodes(color) {
    if (color && color.match(colorDetect))
        return '#' + color;
    return color;
}


/***/ }),

/***/ "./src/toolbar/render/render-groups.ts":
/*!*********************************************!*\
  !*** ./src/toolbar/render/render-groups.ts ***!
  \*********************************************/
/*! exports provided: RenderButtonGroups */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RenderButtonGroups", function() { return RenderButtonGroups; });
/* harmony import */ var _render_part_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./render-part-base */ "./src/toolbar/render/render-part-base.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var RenderButtonGroups = /** @class */ (function (_super) {
    __extends(RenderButtonGroups, _super);
    function RenderButtonGroups(parent) {
        return _super.call(this, parent, 'Rnd.Groups') || this;
    }
    RenderButtonGroups.prototype.generate = function (context) {
        var cl = this.log.call('generate');
        var tags = []; // temporary storage for detached HTML DOM objects
        var btnGroups = context.toolbar.groups;
        for (var i = 0; i < btnGroups.length; i++)
            tags = tags.concat(this.generateGroup(btnGroups[i], context, i));
        return cl.return(tags, "total tags: " + tags.length);
    };
    RenderButtonGroups.prototype.generateGroup = function (group, context, groupNumber) {
        var cl = this.log.call('generateGroup', "group #" + groupNumber);
        var tags = []; // temporary storage for detached HTML DOM objects
        var btns = group.buttons;
        for (var h = 0; h < btns.length; h++) {
            var btnContext = context.forButton(btns[h]);
            var tag = this.parent.button.render(btnContext, groupNumber);
            // add button to group of buttons
            var item = document.createElement('li');
            item.appendChild(tag);
            tags.push(item);
        }
        return cl.return(tags, "tags: " + tags.length);
    };
    return RenderButtonGroups;
}(_render_part_base__WEBPACK_IMPORTED_MODULE_0__["RenderPart"]));



/***/ }),

/***/ "./src/toolbar/render/render-part-base.ts":
/*!************************************************!*\
  !*** ./src/toolbar/render/render-part-base.ts ***!
  \************************************************/
/*! exports provided: RenderPart */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RenderPart", function() { return RenderPart; });
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

/**
 * Base class for inner part renderers.
 * The goal is that we have the code in own objects, but that these can only be used
 * from the primary parent object of the type ToolbarRenderer
 *
 * @export
 * @class RenderPart
 */
var RenderPart = /** @class */ (function (_super) {
    __extends(RenderPart, _super);
    function RenderPart(parent, logName) {
        var _this = _super.call(this, logName, parent.log) || this;
        _this.parent = parent;
        return _this;
    }
    return RenderPart;
}(_logging__WEBPACK_IMPORTED_MODULE_0__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/render/toolbar-renderer.ts":
/*!************************************************!*\
  !*** ./src/toolbar/render/toolbar-renderer.ts ***!
  \************************************************/
/*! exports provided: ToolbarRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarRenderer", function() { return ToolbarRenderer; });
/* harmony import */ var _html_dom_tools__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../html/dom-tools */ "./src/html/dom-tools.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _render_button__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./render-button */ "./src/toolbar/render/render-button.ts");
/* harmony import */ var _render_groups__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./render-groups */ "./src/toolbar/render/render-groups.ts");
/* harmony import */ var _constants_ids__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../constants/ids */ "./src/constants/ids.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();





var attrIdentifier = 'toolbar-identifier';
var ToolbarRenderer = /** @class */ (function (_super) {
    __extends(ToolbarRenderer, _super);
    function ToolbarRenderer(context) {
        var _a;
        var _this = _super.call(this, 'Rnd.Toolbr') || this;
        _this.context = context;
        _logging__WEBPACK_IMPORTED_MODULE_1__["Insights"].add('toolbar-render', ((_a = context.toolbar) === null || _a === void 0 ? void 0 : _a.identifier) || '', _this.log);
        _this.groups = new _render_groups__WEBPACK_IMPORTED_MODULE_3__["RenderButtonGroups"](_this);
        _this.button = new _render_button__WEBPACK_IMPORTED_MODULE_2__["RenderButton"](_this);
        return _this;
    }
    /**
     * Convert a generated Toolbar into an HTML-string.
     * AFAIK it's only used in external scripts through older APIs, and never called directly.
     */
    ToolbarRenderer.prototype.render = function () {
        var cl = this.log.call('generate');
        return cl.return(this.generate().outerHTML);
    };
    /**
     * Generate an HTML toolbar tag for adding to the page
     */
    ToolbarRenderer.prototype.generate = function () {
        var _a;
        var cl = this.log.call('generate');
        // render groups of buttons
        var context = this.context;
        cl.data('toolbar config', context.toolbar);
        var groups = this.groups.generate(context);
        // render toolbar
        var tlbTag = document.createElement('ul');
        tlbTag.setAttribute(attrIdentifier, (_a = context.toolbar) === null || _a === void 0 ? void 0 : _a.identifier);
        tlbTag.classList.add(_constants_ids__WEBPACK_IMPORTED_MODULE_4__["IDs"].cls.scMenu);
        tlbTag.classList.add('group-0'); // IE11 fix, add each class separately
        // add behaviour classes
        var settings = context.toolbar.settings;
        tlbTag.classList.add("sc-tb-hover-" + settings.hover);
        tlbTag.classList.add("sc-tb-show-" + settings.show);
        if (context.toolbar.params.sortOrder === -1)
            tlbTag.classList.add('listContent');
        if (context.toolbar.params.fields)
            tlbTag.classList.add('sc-sublist');
        _html_dom_tools__WEBPACK_IMPORTED_MODULE_0__["HtmlTools"].addClasses(tlbTag, settings.class || settings.classes);
        // add button groups to toolbar
        tlbTag.setAttribute('group-count', context.toolbar.groups.length.toString());
        for (var g = 0; g < groups.length; g++)
            tlbTag.appendChild(groups[g]);
        return cl.return(tlbTag, 'done');
    };
    return ToolbarRenderer;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/rules/build-steps.ts":
/*!******************************************!*\
  !*** ./src/toolbar/rules/build-steps.ts ***!
  \******************************************/
/*! exports provided: BuildSteps */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BuildSteps", function() { return BuildSteps; });
var BuildSteps;
(function (BuildSteps) {
    BuildSteps["toolbar"] = "toolbar";
    BuildSteps["group"] = "group";
    BuildSteps["button"] = "button";
    BuildSteps["params"] = "params";
    BuildSteps["settings"] = "settings";
})(BuildSteps || (BuildSteps = {}));


/***/ }),

/***/ "./src/toolbar/rules/index.ts":
/*!************************************!*\
  !*** ./src/toolbar/rules/index.ts ***!
  \************************************/
/*! exports provided: RuleConstants, Operations, BuildSteps, RuleParamsHelper, BuildRule, RuleManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _rule_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rule-constants */ "./src/toolbar/rules/rule-constants.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "RuleConstants", function() { return _rule_constants__WEBPACK_IMPORTED_MODULE_0__["RuleConstants"]; });

/* harmony import */ var _operators__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./operators */ "./src/toolbar/rules/operators.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Operations", function() { return _operators__WEBPACK_IMPORTED_MODULE_1__["Operations"]; });

/* harmony import */ var _build_steps__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./build-steps */ "./src/toolbar/rules/build-steps.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "BuildSteps", function() { return _build_steps__WEBPACK_IMPORTED_MODULE_2__["BuildSteps"]; });

/* harmony import */ var _rule_params_helper__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./rule-params-helper */ "./src/toolbar/rules/rule-params-helper.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "RuleParamsHelper", function() { return _rule_params_helper__WEBPACK_IMPORTED_MODULE_3__["RuleParamsHelper"]; });

/* harmony import */ var _rule__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./rule */ "./src/toolbar/rules/rule.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "BuildRule", function() { return _rule__WEBPACK_IMPORTED_MODULE_4__["BuildRule"]; });

/* harmony import */ var _rule_manager__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./rule-manager */ "./src/toolbar/rules/rule-manager.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "RuleManager", function() { return _rule_manager__WEBPACK_IMPORTED_MODULE_5__["RuleManager"]; });









/***/ }),

/***/ "./src/toolbar/rules/operators.ts":
/*!****************************************!*\
  !*** ./src/toolbar/rules/operators.ts ***!
  \****************************************/
/*! exports provided: Operations */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Operations", function() { return Operations; });
var Operations;
(function (Operations) {
    Operations["add"] = "+";
    Operations["remove"] = "-";
    Operations["system"] = "$";
    Operations["modify"] = "%";
    Operations["comment"] = "/";
})(Operations || (Operations = {}));


/***/ }),

/***/ "./src/toolbar/rules/rule-constants.ts":
/*!*********************************************!*\
  !*** ./src/toolbar/rules/rule-constants.ts ***!
  \*********************************************/
/*! exports provided: RuleConstants */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RuleConstants", function() { return RuleConstants; });
var RuleConstants = {
    Keys: {
        None: 'none',
    },
};


/***/ }),

/***/ "./src/toolbar/rules/rule-manager.ts":
/*!*******************************************!*\
  !*** ./src/toolbar/rules/rule-manager.ts ***!
  \*******************************************/
/*! exports provided: RuleManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RuleManager", function() { return RuleManager; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/rules/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _build_steps__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./build-steps */ "./src/toolbar/rules/build-steps.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




var throwOnError = true;
var RuleManager = /** @class */ (function (_super) {
    __extends(RuleManager, _super);
    /** Basic constructor, must be called from a ToolbarConfigLoader */
    function RuleManager(parent) {
        var _this = _super.call(this, 'Tlb.RlMngr', parent.log, 'constructor') || this;
        /** List of rules which were picked up and will be applied */
        _this.rules = [];
        _this.ruleManagerId = Math.floor(Math.random() * 99999);
        /** the settings are usually retrieved on settings, but you can also put them behind the toolbar */
        _this.getSettings = function () { return _this.getSystemRule(_build_steps__WEBPACK_IMPORTED_MODULE_2__["BuildSteps"].settings) || _this.getToolbar(); };
        /** the params for the command - if not found, will use the toolbar params */
        _this.getParams = function () { return _this.getSystemRule(_build_steps__WEBPACK_IMPORTED_MODULE_2__["BuildSteps"].params) || _this.getToolbar(); };
        _this.getToolbar = function () { return _this.getSystemRule(_build_steps__WEBPACK_IMPORTED_MODULE_2__["BuildSteps"].toolbar); };
        _this.getAdd = function () { return _this.filter(function (br) { return br.operator === ___WEBPACK_IMPORTED_MODULE_0__["Operations"].add; }); };
        _this.getRemoveGroups = function () { return _this.filter(function (br) { return br.operator === ___WEBPACK_IMPORTED_MODULE_0__["Operations"].remove && br.step === _build_steps__WEBPACK_IMPORTED_MODULE_2__["BuildSteps"].group; }); };
        _this.log.add('tempId:' + _this.ruleManagerId);
        return _this;
    }
    /** Load/initialize the rules which were found */
    RuleManager.prototype.load = function (rawList) {
        var _this = this;
        var cl = this.log.call('load', "" + function () { return rawList.length; });
        if (!Array.isArray(rawList))
            return cl.return([], 'raw is empty');
        rawList.forEach(function (raw) {
            if (typeof raw === 'string') {
                try {
                    _this.rules.push(new ___WEBPACK_IMPORTED_MODULE_0__["BuildRule"](raw, _this.log));
                }
                catch (e) {
                    if (throwOnError)
                        throw e;
                    cl.add("error adding string-rule '" + raw + "'", e);
                }
            }
            else {
                console.error('tried to parse a toolbar rule and expected a string, but got something else');
            }
        });
        return cl.return(this.rules, 'final rules');
    };
    /** Find a single rule matching an ID */
    RuleManager.prototype.find = function (id) { return this.rules.find(function (r) { return r.id === id; }); };
    /** find all rules matching a criteria */
    RuleManager.prototype.filter = function (criteria) { return this.rules.filter(criteria); };
    /** Find a system rule (marked with '$') */
    RuleManager.prototype.getSystemRule = function (name) {
        return this.rules.find(function (r) { return r.operator === ___WEBPACK_IMPORTED_MODULE_0__["Operations"].system && r.step === name; });
    };
    return RuleManager;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/rules/rule-params-helper.ts":
/*!*************************************************!*\
  !*** ./src/toolbar/rules/rule-params-helper.ts ***!
  \*************************************************/
/*! exports provided: RuleParamsHelper */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RuleParamsHelper", function() { return RuleParamsHelper; });
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");

var prefillPrefix = 'prefill:';
var filterPrefix = 'filter:';
var RuleParamsHelper = /** @class */ (function () {
    function RuleParamsHelper() {
    }
    RuleParamsHelper.processParams = function (params, log) {
        var cl = log.call('processParams');
        var prefill = RuleParamsHelper.processSubMultiKeys(params, prefillPrefix, log);
        if (prefill)
            params.prefill = prefill;
        var filters = RuleParamsHelper.processSubMultiKeys(params, filterPrefix, log);
        if (filters)
            params.filters = filters;
        // catch a very common mistake in metadata
        if (params.metadata) {
            delete params.metadata;
            cl.add('params had additional metadata - invalid, will remove', null, _logging__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].error);
        }
        // process metadata
        if (params.for)
            params.metadata = RuleParamsHelper.processMetadata(params, log);
        return cl.return(params);
    };
    RuleParamsHelper.processMetadata = function (params, log) {
        var cl = log.call('processMetadata');
        // get the for-target and if exists, delete from params
        var mdFor = params.for;
        if (!mdFor)
            return cl.return(undefined, 'no metadata');
        delete params.for;
        // just one part, use it as key
        if (mdFor.indexOf(',') === -1)
            return cl.return({ key: mdFor }, 'only has key');
        var parts = mdFor.split(',').map(function (p) { return p.trim(); });
        if (parts.length !== 3)
            return cl.return(undefined, "error: metadata-for parts count expected 3: " + parts.length, _logging__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].error);
        // part 1 must be a number
        var targetType = +parts[0];
        if (isNaN(targetType))
            return cl.return(undefined, "error: first key part is not number - got " + targetType, _logging__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].error);
        // part 2 must be a string with 'string', 'guid' or 'number'
        var keyType = parts[1];
        if (keyType !== 'string' && keyType !== 'guid' && keyType !== 'number')
            return cl.return(undefined, "error: key is not known type, should be string, guid or number, but got " + keyType, _logging__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].error);
        // part 3 is the key
        var key = parts[2];
        if (key === null || key === undefined || key === '')
            return cl.return(undefined, "error: key strange value: '" + key + "'", _logging__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].error);
        // todo: warn if no metadata or id!
        if (!params.contentType || params.entityId == null)
            return cl.return(undefined, 'error: contentType and entityId missing', _logging__WEBPACK_IMPORTED_MODULE_0__["LogEntryOptions"].error);
        return cl.return({
            key: key,
            targetType: targetType,
            keyType: keyType,
        });
    };
    /** Do special processing on all prefill:Field=Value rules */
    RuleParamsHelper.processSubMultiKeys = function (params, prefix, log) {
        var cl = log.call('processSubMultiKeys');
        // only load special prefills if we don't already have a prefill
        if (!params)
            return cl.return(undefined, 'no params');
        var keys = Object.keys(params).filter(function (k) { return k.indexOf(prefix) === 0; });
        if (!keys || keys.length === 0)
            return cl.return(undefined, "no speciall '" + prefix + "' keys");
        var prefixLen = prefix.length;
        var list = {};
        keys.forEach(function (k) {
            var value = params[k];
            // 2020-04-02 prefill is a bit flaky - this should fix the common issues
            // fix boolean true must be "true"
            if (value === true || value === false)
                value = value.toString();
            else {
                // try to detect list of guids
                if (prefix === prefillPrefix)
                    value = RuleParamsHelper.convertGuidListToArrayOrKeepOriginal(value);
            }
            list[k.substring(prefixLen)] = value;
            delete params[k];
        });
        return cl.return(list, 'got list of multi-keys');
    };
    RuleParamsHelper.convertGuidListToArrayOrKeepOriginal = function (value) {
        // must be string
        if (!value || typeof value !== 'string')
            return value;
        // must have a comma to become an array
        if (value.indexOf(',') === -1)
            return value;
        // shouldn't have any quotes
        if (value.indexOf('"') >= 0 || value.indexOf("'") >= 0)
            return value;
        var probablyArray = value.split(',').map(function (g) { return g.trim(); });
        // guid check regex from https://stackoverflow.com/questions/7905929/how-to-test-valid-uuid-guid
        var guidCount = probablyArray
            .filter(function (g) { return g.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i) !== null; });
        // .filter((m) => m === true);
        if (guidCount && guidCount.length === probablyArray.length)
            return probablyArray;
        return value;
    };
    return RuleParamsHelper;
}());



/***/ }),

/***/ "./src/toolbar/rules/rule.ts":
/*!***********************************!*\
  !*** ./src/toolbar/rules/rule.ts ***!
  \***********************************/
/*! exports provided: BuildRule */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BuildRule", function() { return BuildRule; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/rules/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _templates__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates */ "./src/toolbar/templates/index.ts");
/* harmony import */ var _build_steps__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./build-steps */ "./src/toolbar/rules/build-steps.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




/**
 * Contains a rule how to add/modify a toolbar.
 */
var BuildRule = /** @class */ (function (_super) {
    __extends(BuildRule, _super);
    //#endregion
    function BuildRule(ruleString, parentLog) {
        var _this = _super.call(this, 'Tlb.BdRule', parentLog) || this;
        _this.ruleString = ruleString;
        /** Group name - when adding more buttons */
        _this.group = _templates__WEBPACK_IMPORTED_MODULE_2__["TemplateConstants"].NameDefault;
        /**
         * position where something is added - the group or the button
         * Note that JS preserves -0
         */
        _this.pos = 0;
        //#endregion
        //#region command parts
        _this.params = {};
        /**
         * Button Rules - determines what a button should do / not do
         * Note: can also be Partial<ToolbarSettings>
         */
        _this.ui = {};
        /** ATM unused url-part after the hash - will probably be needed in future */
        _this.hash = {};
        if (!ruleString) {
            _this.log.add('rule is empty');
            return _this;
        }
        _this.load();
        return _this;
    }
    /** Tells if this rule will override the show settings  */
    BuildRule.prototype.overrideShow = function () {
        var _a;
        if (this.operator === ___WEBPACK_IMPORTED_MODULE_0__["Operations"].remove)
            return false;
        if (this.operator === ___WEBPACK_IMPORTED_MODULE_0__["Operations"].add)
            return true;
        if (this.operator === ___WEBPACK_IMPORTED_MODULE_0__["Operations"].modify && ((_a = this === null || this === void 0 ? void 0 : this.ui) === null || _a === void 0 ? void 0 : _a.show) !== undefined)
            return this.ui.show;
        return undefined;
    };
    BuildRule.prototype.load = function () {
        var cl = this.log.call('load', this.ruleString);
        var parts = splitUrlSections(this.ruleString);
        if (!parts.key)
            return cl.done("no key, won't load");
        this.loadHeader(parts.key);
        if (parts.params)
            this.loadParamsAndPrefill(parts.params);
        if (parts.button)
            this.loadHash(parts.button);
        return cl.done();
    };
    BuildRule.prototype.loadHeader = function (rule) {
        var _a, _b;
        var cl = this.log.call('loadHeader', rule);
        var parts = this.splitParamsArray(rule);
        var key = ((_a = parts === null || parts === void 0 ? void 0 : parts[0]) === null || _a === void 0 ? void 0 : _a[0]) || ___WEBPACK_IMPORTED_MODULE_0__["RuleConstants"].Keys.None;
        // Pick up the operation from header, but if it's not a known operator, auto-detect
        var operator = key[0];
        var knownOperatorFound = Object.values(___WEBPACK_IMPORTED_MODULE_0__["Operations"]).includes(operator);
        if (!knownOperatorFound)
            operator = (key === _build_steps__WEBPACK_IMPORTED_MODULE_3__["BuildSteps"].params || key === _build_steps__WEBPACK_IMPORTED_MODULE_3__["BuildSteps"].settings || key === _build_steps__WEBPACK_IMPORTED_MODULE_3__["BuildSteps"].toolbar)
                ? ___WEBPACK_IMPORTED_MODULE_0__["Operations"].system
                : ___WEBPACK_IMPORTED_MODULE_0__["Operations"].add;
        this.operator = operator;
        cl.add("name part '" + key + "', firstChar '" + operator + "'");
        // remember the primary keyword because this determines what we're doing
        // but truncate the first char if it had an operator
        key = knownOperatorFound ? key.substring(1) : key;
        var knowStepFound = Object.values(_build_steps__WEBPACK_IMPORTED_MODULE_3__["BuildSteps"]).includes(key);
        this.step = knowStepFound ? key : _build_steps__WEBPACK_IMPORTED_MODULE_3__["BuildSteps"].button;
        // for system and %-change operations the id should be the name of the standard button
        // ...but if it's an add-operation, we must keep the IDs appart because various
        // properties are set at a much later time
        this.id = (this.operator === ___WEBPACK_IMPORTED_MODULE_0__["Operations"].add)
            ? 'rndId' + Math.floor(Math.random() * 99999)
            : key;
        // command name defaults to name, can be reset by load-headers
        // assumes key is something like "group=myGroup" or just "edit"
        this.name = ((_b = parts === null || parts === void 0 ? void 0 : parts[0]) === null || _b === void 0 ? void 0 : _b[1]) || key;
        if (parts.length > 1)
            this.loadHeaderParts(parts.slice(1));
        return cl.done();
    };
    BuildRule.prototype.loadHeaderParts = function (rest) {
        var cl = this.log.call('loadHeaderParts');
        if (!rest.length)
            return cl.done('nothing to load');
        var parts = this.dicToArray(rest);
        // #1 pick up id & name
        if (parts.id)
            this.id = parts.id;
        if (parts.name)
            this.name = parts.name;
        // #2 pick up group
        if (typeof parts.group === 'string') {
            this.group = parts.group;
            delete parts.group;
        }
        // #3 position can be number or -number to indicate from other side
        // Note that JS preserves -0, which is kind of unique
        if (parts.pos != null)
            this.pos = Number(parts.pos);
        // #4 icon is automatically kept
        // #5 show override
        if (typeof parts.show === 'string')
            parts.show = parts.show === 'true';
        this.ui = parts;
        return cl.return(this.ui, 'button rules');
    };
    BuildRule.prototype.loadParamsAndPrefill = function (rule) {
        var cl = this.log.call('loadParams', rule);
        this.params = this.splitParamsDic(rule);
        cl.data('params', this.params);
        this.params = ___WEBPACK_IMPORTED_MODULE_0__["RuleParamsHelper"].processParams(this.params, this.log);
        return cl.done();
    };
    BuildRule.prototype.loadHash = function (rule) {
        var cl = this.log.call('loadButton', rule);
        this.hash = this.splitParamsDic(rule);
        cl.data('button', this.hash);
        return cl.done();
    };
    //#region string manipulation helpers
    BuildRule.prototype.dicToArray = function (original) {
        return original.reduce(function (map, obj) {
            map[obj[0]] = obj[1];
            return map;
        }, {});
    };
    BuildRule.prototype.splitParamsDic = function (original) {
        return this.dicToArray(this.splitParamsArray(original));
    };
    BuildRule.prototype.splitParamsArray = function (original) {
        if (!original)
            return [];
        var split1 = original.split('&');
        var split2 = split1.map(function (p) {
            var keyValues = p.split('=');
            var key = keyValues[0];
            var val = keyValues[1];
            // disabled, don't see a use case for this
            // check if the value had '=' - then re-join
            // if (keyValues.length > 1)
            //     val = keyValues.slice(1).join('=');
            // fix url encoding
            if ((val === null || val === void 0 ? void 0 : val.indexOf('%')) > -1)
                val = decodeURIComponent(val);
            // fix C# typed true/false or string representations
            if (val === 'True' || val === 'true')
                return [key, true]; // val = true;
            if (val === 'False' || val === 'false')
                return [key, false]; // val = false;
            // cast numbers to numbers
            val = isNaN(+val) ? val : Number(val);
            return [key, val];
        });
        return split2;
    };
    return BuildRule;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));

function splitUrlSections(str) {
    // dev link: https://regex101.com/r/vK4rV7/519
    // inpsired by https://stackoverflow.com/questions/27745/getting-parts-of-a-url-regex
    var regex = /^([^\/?#]*)?([^?#]*)(\?([^#]*))?(#(.*))?/i;
    // const str = `+edit&something=other&els=ok?aoeuaoeu=5&aoeuaou=aoeu#but=thi&aouoaeu`;
    var m = regex.exec(str);
    if (m && m !== null)
        return { key: m[1], params: m[4], button: m[6] };
    return undefined;
}


/***/ }),

/***/ "./src/toolbar/tag-toolbars/tag-toolbar-manager.ts":
/*!*********************************************************!*\
  !*** ./src/toolbar/tag-toolbars/tag-toolbar-manager.ts ***!
  \*********************************************************/
/*! exports provided: TagToolbarManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TagToolbarManager", function() { return TagToolbarManager; });
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../plumbing */ "./src/plumbing/index.ts");

/**
 * The global Tag Toolbar Manager is responsible for the new TagToolbars
 * These have certain shared aspects, like:
 * - a numbering scheme to keep them apart
 * - a mouse tracker to keep track of the position as the toolbar follows the scroll
 */
var TagToolbarManager = /** @class */ (function () {
    function TagToolbarManager() {
    }
    /** The next free ID to mark a TagToolbar */
    TagToolbarManager.getNextToolbarId = function () {
        return TagToolbarManager.lastMenuId++;
    };
    /**
     * Returns the body offset if positioning is relative or absolute
     */
    TagToolbarManager.getBodyScrollOffset = function () {
        var posNoJq = document.body.style.position;
        var body = document.body;
        var bodyPos = posNoJq; // body.css('position');
        if (bodyPos === 'relative' || bodyPos === 'absolute') {
            var offset = _plumbing__WEBPACK_IMPORTED_MODULE_0__["NoJQ"].offset(body);
            return {
                top: offset.top,
                left: offset.left,
            };
        }
        return {
            top: 0,
            left: 0,
        };
    };
    /**
     * Remove orphan tag-toolbars from DOM
     * This can be necessary if the module was replaced by ajax,
     * leaving behind un-attached TagToolbars.
     */
    TagToolbarManager.CleanupOrphanedToolbars = function () {
        var tagToolbars = document.querySelectorAll("[" + TagToolbarManager.TagToolbarForAttr + "]");
        tagToolbars.forEach(function (e) {
            var id = e.getAttribute(TagToolbarManager.TagToolbarForAttr);
            if (!document.querySelectorAll("[" + TagToolbarManager.TagToolbarAttr + "=\"" + id + "\"]").length) {
                e.remove();
            }
        });
    };
    /** Mark Dom-Notes with the ID which Tag-Toolbar they want on mouse-over */
    TagToolbarManager.TagToolbarAttr = 'data-tagtoolbar';
    /** Mark TagToolbar Html-Nodes with the ID of the Dom-Tag they belong to */
    TagToolbarManager.TagToolbarForAttr = 'data-tagtoolbar-for';
    /** The current mouseposition, always updated when the mouse changes */
    TagToolbarManager.mousePosition = {
        x: 0,
        y: 0,
    };
    TagToolbarManager.lastMenuId = 0;
    return TagToolbarManager;
}());

/**
 * Keep the mouse-position update for future use
 */
window.addEventListener('mousemove', function (e) {
    TagToolbarManager.mousePosition.x = e.clientX;
    TagToolbarManager.mousePosition.y = e.clientY;
});


/***/ }),

/***/ "./src/toolbar/tag-toolbars/tag-toolbar.ts":
/*!*************************************************!*\
  !*** ./src/toolbar/tag-toolbars/tag-toolbar.ts ***!
  \*************************************************/
/*! exports provided: TagToolbar */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TagToolbar", function() { return TagToolbar; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! .. */ "./src/toolbar/index.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../plumbing */ "./src/plumbing/index.ts");
/* harmony import */ var _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../config/toolbar-settings */ "./src/toolbar/config/toolbar-settings.ts");
/* harmony import */ var _toolbar_lifecycle__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../toolbar-lifecycle */ "./src/toolbar/toolbar-lifecycle.ts");




/**
 * This is the modern toolbar which is attached to a tag from whic it hovers.
 * Internally the toolbar Dom-Elements are hidden at the bottom of the page.
 * This object is responsible for creating them,
 * and making sure that hover-events etc. cause the right toolbar to show up.
 */
var TagToolbar = /** @class */ (function () {
    /**
     * A Tag-Toolbar which is outside of the module DOM and floating freely
     * @param {HTMLElement} hoverTag
     * @param {ContextComplete} context
     * @param {typeof Translator} [translator] special translator, only included because otherwise WebPack causes circular references
     * @memberof TagToolbar
     */
    function TagToolbar(hoverTag, context, translator) {
        var _this = this;
        this.hoverTag = hoverTag;
        this.context = context;
        this.translator = translator;
        this.toolbarElement = null;
        this.initialized = false;
        this.alwaysShow = false;
        /** Remember if scrollwatcher has been enabled */
        this.watcherActive = false;
        /** The update function as a prebuild function, so it can be reused in on/off */
        this.updateFn = function () { return _this.updatePosition(false); };
        this.follow = context.toolbar.settings.follow;
        this.alwaysShow = context.toolbar.settings.show === _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__["TOOLBAR_SHOW_ALWAYS"];
        // Ensure toolbar gets visible when hovering
        this.addMouseEvents(hoverTag);
        if (this.alwaysShow)
            this.showPermanently();
    }
    /**
     * Attach Mouse-Enter and Mouse-Leave events to ensure show/hide of the toolbar
     */
    TagToolbar.prototype.addMouseEvents = function (hoverTag) {
        var _this = this;
        hoverTag.addEventListener('mouseenter', function () { _this.show(); });
        if (!this.alwaysShow)
            hoverTag.addEventListener('mouseleave', function (e) {
                _this.initializeIfNecessary();
                // if we hover the menu itself now, don't hide it
                var relatedTarget = e.relatedTarget;
                if (!_this.toolbarElement.contains(relatedTarget) && _this.toolbarElement !== relatedTarget)
                    _this.hide();
            });
    };
    TagToolbar.prototype.initializeIfNecessary = function () {
        var _this = this;
        var _a;
        if (this.initialized)
            return;
        var nextFreeId = ___WEBPACK_IMPORTED_MODULE_0__["TagToolbarManager"].getNextToolbarId();
        var toolbarId = this.context.instance.id + "-" + this.context.contentBlockReference.id + "-" + nextFreeId;
        // render toolbar and append tag to body
        this.toolbarElement = new ___WEBPACK_IMPORTED_MODULE_0__["ToolbarRenderer"](this.context).generate();
        // 2021-11-15 2dm disabled this, seems like a duplicate to the attach-mouse-enter which always runs
        if (!this.alwaysShow)
            this.toolbarElement.addEventListener('mouseleave', function (e) {
                // if we do not hover the tag now, hide it
                var relatedTarget = e.relatedTarget;
                if (!_this.hoverTag.contains(relatedTarget) && _this.hoverTag !== relatedTarget)
                    _this.hide();
            });
        document.body.append(this.toolbarElement);
        this.toolbarElement.setAttribute(___WEBPACK_IMPORTED_MODULE_0__["TagToolbarManager"].TagToolbarForAttr, toolbarId);
        this.hoverTag.setAttribute(___WEBPACK_IMPORTED_MODULE_0__["TagToolbarManager"].TagToolbarAttr, toolbarId);
        var toolbarStyle = this.toolbarElement.style;
        toolbarStyle.position = 'absolute';
        // Do the following things on toolbars which are invisible (show != always)
        if (!this.alwaysShow) {
            toolbarStyle.display = 'none';
            toolbarStyle.transition = 'top 0.5s ease-out';
        }
        // ensure it's translated
        (_a = this.translator) === null || _a === void 0 ? void 0 : _a.autoTranslateMenus();
        this.initialized = true;
        // new in v11.12 - toolbar Workflow
        _toolbar_lifecycle__WEBPACK_IMPORTED_MODULE_3__["ToolbarLifecycle"].raiseToolbarInitEvent(this.toolbarElement, this.hoverTag, this.context);
    };
    TagToolbar.prototype.updatePosition = function (initial) {
        var position = {
            top: 'auto',
            left: 'auto',
            right: 'auto',
            viewportOffset: this.hoverTag.getBoundingClientRect().top,
            bodyOffset: ___WEBPACK_IMPORTED_MODULE_0__["TagToolbarManager"].getBodyScrollOffset(),
            tagScrollOffset: 0,
            tagOffset: _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].offset(this.hoverTag),
            tagWidth: _plumbing__WEBPACK_IMPORTED_MODULE_1__["NoJQ"].outerWidth(this.hoverTag),
            mousePos: ___WEBPACK_IMPORTED_MODULE_0__["TagToolbarManager"].mousePosition,
            win: {
                scrollY: window.scrollY,
                width: document.documentElement.clientWidth,
            },
            padding: tagToolbarPadding,
        };
        // If we scrolled down, the toolbar might not be visible - calculate offset
        position.tagScrollOffset = Math.min(position.viewportOffset - position.bodyOffset.top, 0);
        // Update top coordinates
        // new: only do this on initial=true && follow != 'none' or not-initial
        // start by setting default-top
        position.top = position.tagOffset.top + tagToolbarPadding - position.bodyOffset.top;
        var trackMouse = (this.follow === _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__["TOOLBAR_FOLLOW_ALWAYS"])
            || (this.follow === _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__["TOOLBAR_FOLLOW_INITIAL"] && initial)
            || (this.follow === _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__["TOOLBAR_FOLLOW_SCROLL"] && position.tagScrollOffset !== 0);
        if (trackMouse)
            position.top = position.mousePos.y + position.win.scrollY - position.bodyOffset.top - toolbarHeight / 2;
        // Update left / right coordinates
        if (this.toolbarElement.classList.contains('sc-tb-hover-right'))
            position.right = position.win.width - position.tagOffset.left - position.tagWidth + tagToolbarPaddingRight - position.bodyOffset.left;
        else
            position.left = position.tagOffset.left + tagToolbarPadding + position.bodyOffset.left;
        this.toolbarElement.style.top = typeof position.top === 'number' ? position.top + "px" : position.top;
        this.toolbarElement.style.left = typeof position.left === 'number' ? position.left + "px" : position.left;
        this.toolbarElement.style.right = typeof position.right === 'number' ? position.right + "px" : position.right;
    };
    /**
     * Hide the toolbar and detach scrolling-watcher
     */
    TagToolbar.prototype.hide = function () {
        if (this.alwaysShow)
            return;
        this.toolbarElement.style.display = 'none';
        this.disableScrollWatcher();
    };
    /**
     * Show the toolbar
     */
    TagToolbar.prototype.show = function () {
        // console.log('show');
        this.initializeIfNecessary();
        this.toolbarElement.style.display = 'block';
        this.updatePosition(true);
        this.activateScrollWatcher();
    };
    /**
     * Always show the toolbar.
     */
    TagToolbar.prototype.showPermanently = function () {
        // console.log('show permanently');
        this.show();
        // after a moment, adjust position because often initial position is a bit off
        window.addEventListener('load', this.updateFn);
        document.addEventListener('readystatechange', this.updateFn);
        // Also watch resizing, as the position would be wrong otherwise
        window.addEventListener('resize', this.updateFn);
    };
    /** Enable scroll watcher & remember */
    TagToolbar.prototype.activateScrollWatcher = function () {
        if (this.watcherActive)
            return;
        var trackOngoing = this.follow === _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__["TOOLBAR_FOLLOW_SCROLL"] || this.follow === _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__["TOOLBAR_FOLLOW_ALWAYS"];
        if (!trackOngoing)
            return;
        window.addEventListener('scroll', this.updateFn);
        if (this.follow === _config_toolbar_settings__WEBPACK_IMPORTED_MODULE_2__["TOOLBAR_FOLLOW_ALWAYS"])
            window.addEventListener('mousemove', this.updateFn);
        this.watcherActive = true;
    };
    /** Disable scroll watcher - if it is active */
    TagToolbar.prototype.disableScrollWatcher = function () {
        if (!this.watcherActive)
            return;
        window.removeEventListener('scroll', this.updateFn);
        window.removeEventListener('mousemove', this.updateFn);
        this.watcherActive = false;
    };
    return TagToolbar;
}());

var tagToolbarPadding = 4;
var tagToolbarPaddingRight = 0;
var toolbarHeight = 20;


/***/ }),

/***/ "./src/toolbar/templates/constants.ts":
/*!********************************************!*\
  !*** ./src/toolbar/templates/constants.ts ***!
  \********************************************/
/*! exports provided: TemplateConstants */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TemplateConstants", function() { return TemplateConstants; });
var TemplateConstants = {
    NameDefault: 'default',
    NameEmpty: 'empty',
    GroupDefault: 'default',
    GroupList: 'list',
    GroupEditAdvanced: 'edit-advanced',
    GroupView: 'view',
    GroupApp: 'app',
    GroupUnknown: 'unknown',
    ButtonSeparator: ',',
};


/***/ }),

/***/ "./src/toolbar/templates/index.ts":
/*!****************************************!*\
  !*** ./src/toolbar/templates/index.ts ***!
  \****************************************/
/*! exports provided: TemplateConstants, ToolbarTemplateEmpty, ToolbarTemplateDefault, ToolbarTemplateSublist, ToolbarTemplateManager, ToolbarTemplate, ToolbarTemplateGroup, TemplateEditor */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ "./src/toolbar/templates/constants.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TemplateConstants", function() { return _constants__WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"]; });

/* harmony import */ var _template_empty__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./template-empty */ "./src/toolbar/templates/template-empty.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateEmpty", function() { return _template_empty__WEBPACK_IMPORTED_MODULE_1__["ToolbarTemplateEmpty"]; });

/* harmony import */ var _template_default__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./template-default */ "./src/toolbar/templates/template-default.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateDefault", function() { return _template_default__WEBPACK_IMPORTED_MODULE_2__["ToolbarTemplateDefault"]; });

/* harmony import */ var _template_sublist__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./template-sublist */ "./src/toolbar/templates/template-sublist.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateSublist", function() { return _template_sublist__WEBPACK_IMPORTED_MODULE_3__["ToolbarTemplateSublist"]; });

/* harmony import */ var _toolbar_template_manager__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./toolbar-template-manager */ "./src/toolbar/templates/toolbar-template-manager.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateManager", function() { return _toolbar_template_manager__WEBPACK_IMPORTED_MODULE_4__["ToolbarTemplateManager"]; });

/* harmony import */ var _toolbar_template__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./toolbar-template */ "./src/toolbar/templates/toolbar-template.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplate", function() { return _toolbar_template__WEBPACK_IMPORTED_MODULE_5__["ToolbarTemplate"]; });

/* harmony import */ var _toolbar_template_group__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./toolbar-template-group */ "./src/toolbar/templates/toolbar-template-group.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateGroup", function() { return _toolbar_template_group__WEBPACK_IMPORTED_MODULE_6__["ToolbarTemplateGroup"]; });

/* harmony import */ var _template_editor__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./template-editor */ "./src/toolbar/templates/template-editor.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TemplateEditor", function() { return _template_editor__WEBPACK_IMPORTED_MODULE_7__["TemplateEditor"]; });











/***/ }),

/***/ "./src/toolbar/templates/template-default.ts":
/*!***************************************************!*\
  !*** ./src/toolbar/templates/template-default.ts ***!
  \***************************************************/
/*! exports provided: ToolbarTemplateDefault */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateDefault", function() { return ToolbarTemplateDefault; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/templates/index.ts");

// the default / initial buttons in a standard toolbar
var ToolbarTemplateDefault = {
    name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].NameDefault,
    groups: [
        {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupDefault,
            buttons: 'edit,new,metadata,publish,layout',
        }, {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupList,
            buttons: 'add,add-existing,replace,remove,moveup,movedown,instance-list',
        }, {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupEditAdvanced,
            buttons: 'delete',
        }, {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupView,
            buttons: 'template-develop,template-settings,contentitems,template-query,contenttype',
            defaults: {
                classes: 'group-pro',
            },
        }, {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupApp,
            buttons: 'app,app-settings,app-resources,zone,insights-server',
            defaults: {
                classes: 'group-pro',
            },
        },
    ],
    defaults: {},
    params: {},
    settings: {
        autoAddMore: 'end',
    },
    _isToolbarTemplate: true,
};


/***/ }),

/***/ "./src/toolbar/templates/template-editor.ts":
/*!**************************************************!*\
  !*** ./src/toolbar/templates/template-editor.ts ***!
  \**************************************************/
/*! exports provided: TemplateEditor */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TemplateEditor", function() { return TemplateEditor; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/templates/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants */ "./src/toolbar/templates/constants.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



/**
 * This object is used to change the structure of a toolbar template.
 * It's only purpose is to assist in the new V10 format for quickly making toolbars.
 */
var TemplateEditor = /** @class */ (function (_super) {
    __extends(TemplateEditor, _super);
    function TemplateEditor(toolbar) {
        var _this = _super.call(this, 'Tlb.TplEdt', toolbar.log) || this;
        _this.toolbar = toolbar;
        _this.ensureGroups = function (template) { if (!template.groups)
            template.groups = []; };
        _this.findGroup = function (template, name) {
            return template.groups.find(function (t) { return t.name === name; });
        };
        return _this;
    }
    TemplateEditor.prototype.addButton = function (template, groupName, id, name, pos) {
        var _a, _b;
        // fromStart
        var fromStart = !(Object.is(pos, -0) || pos < 0);
        pos = Math.abs(pos);
        // console.log('addbutton - pos', `${fromStart ? '+' : '-'}${pos}`);
        var cl = this.log.call('addButton', "..., " + groupName + ", " + id + ", " + name + ", " + (fromStart ? '+' : '-') + pos + ", " + fromStart);
        if (!template)
            return cl.done('no template');
        var group = this.findGroupOrDefault(template, groupName);
        if (!group)
            group = this.addGroup(template, groupName, 1000); // create group at end
        var buttons = (_b = (_a = group.buttons) === null || _a === void 0 ? void 0 : _a.split(_constants__WEBPACK_IMPORTED_MODULE_2__["TemplateConstants"].ButtonSeparator)) !== null && _b !== void 0 ? _b : [];
        var buttonId = id === name ? name : id + "=" + name;
        var posStartEnd = this.correctPosStartEnd(buttons, pos, fromStart);
        var posInsert = fromStart ? this.findInsertPosition(group, posStartEnd) : posStartEnd;
        cl.add("pos: " + pos + ", startEnd: " + posStartEnd + ", insert:" + posInsert);
        buttons.splice(posInsert, 0, buttonId);
        group.buttons = buttons
            .filter(function (b) { return b.length; }) // drop empty items
            .join(_constants__WEBPACK_IMPORTED_MODULE_2__["TemplateConstants"].ButtonSeparator);
        cl.done();
    };
    TemplateEditor.prototype.findInsertPosition = function (group, pos) {
        group._insertCursor = group._insertCursor || 0;
        if (pos === 0)
            pos = group._insertCursor++;
        return pos;
    };
    TemplateEditor.prototype.correctPosStartEnd = function (target, pos, fromStart) {
        if (fromStart)
            return pos;
        pos = target.length - pos;
        return pos >= 0 ? pos : target.length;
    };
    TemplateEditor.prototype.addGroup = function (template, groupName, pos) {
        var fromStart = !(Object.is(pos, -0) || pos < 0);
        pos = Math.abs(pos);
        var cl = this.log.call('addGroup', "..., " + groupName + ", " + (fromStart ? '+' : '-') + pos);
        this.ensureGroups(template);
        var alreadyExists = this.findGroup(template, groupName);
        if (alreadyExists)
            return cl.return(alreadyExists, 'already exists');
        var newGroup = new ___WEBPACK_IMPORTED_MODULE_0__["ToolbarTemplateGroup"]();
        newGroup.name = groupName;
        var posStartEnd = this.correctPosStartEnd(template.groups, pos, fromStart);
        var posInsert = fromStart ? this.findInsertPosition(template, posStartEnd) : posStartEnd;
        template.groups.splice(posInsert, 0, newGroup);
        return cl.return(newGroup, 'created');
    };
    TemplateEditor.prototype.removeGroup = function (template, groupName) {
        var group = this.findGroup(template, groupName);
        if (!group)
            return;
        var index = template.groups.indexOf(group);
        if (index < 0)
            return;
        template.groups.splice(index, 1);
    };
    TemplateEditor.prototype.findGroupOrDefault = function (template, name) {
        var cl = this.log.call('findGroup', name);
        this.ensureGroups(template);
        if (template.groups.length === 0)
            return cl.return(null, 'no groups');
        var found = this.findGroup(template, name);
        if (found)
            return cl.return(found, 'found');
        return cl.return(template.groups[0], 'not found, return first)');
    };
    return TemplateEditor;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/templates/template-empty.ts":
/*!*************************************************!*\
  !*** ./src/toolbar/templates/template-empty.ts ***!
  \*************************************************/
/*! exports provided: ToolbarTemplateEmpty */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateEmpty", function() { return ToolbarTemplateEmpty; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/templates/index.ts");

// the default / initial buttons in a standard toolbar
var ToolbarTemplateEmpty = {
    name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].NameEmpty,
    groups: [
        {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupDefault,
            buttons: '',
        },
    ],
    defaults: {},
    params: {},
    settings: {
        autoAddMore: 'end',
    },
    _isToolbarTemplate: true,
};


/***/ }),

/***/ "./src/toolbar/templates/template-sublist.ts":
/*!***************************************************!*\
  !*** ./src/toolbar/templates/template-sublist.ts ***!
  \***************************************************/
/*! exports provided: ToolbarTemplateSublist */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateSublist", function() { return ToolbarTemplateSublist; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/templates/index.ts");

// the default / initial buttons in a standard toolbar
var ToolbarTemplateSublist = {
    name: 'sublist',
    groups: [
        {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupDefault,
            buttons: 'edit,new,publish',
            defaults: {
                classes: 'group-inlist',
            },
        }, {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupList,
            buttons: 'add-existing,replace,remove,moveup,movedown,instance-list',
            defaults: {
                classes: 'group-inlist',
            },
        }, {
            name: ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupEditAdvanced,
            buttons: 'delete',
            defaults: {
                classes: 'group-inlist',
            },
        },
    ],
    defaults: {},
    params: {},
    settings: {
        autoAddMore: 'end',
    },
    _isToolbarTemplate: true,
};


/***/ }),

/***/ "./src/toolbar/templates/toolbar-template-group.ts":
/*!*********************************************************!*\
  !*** ./src/toolbar/templates/toolbar-template-group.ts ***!
  \*********************************************************/
/*! exports provided: ToolbarTemplateGroup */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateGroup", function() { return ToolbarTemplateGroup; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/templates/index.ts");

/**
 * This describes a button group in a toolbar template.
 * It should only be used for that
 */
var ToolbarTemplateGroup = /** @class */ (function () {
    function ToolbarTemplateGroup() {
        this.name = ___WEBPACK_IMPORTED_MODULE_0__["TemplateConstants"].GroupUnknown;
        this.buttons = '';
        this.defaults = {};
    }
    ToolbarTemplateGroup.is = function (thing) {
        return thing.buttons !== undefined;
    };
    return ToolbarTemplateGroup;
}());



/***/ }),

/***/ "./src/toolbar/templates/toolbar-template-manager.ts":
/*!***********************************************************!*\
  !*** ./src/toolbar/templates/toolbar-template-manager.ts ***!
  \***********************************************************/
/*! exports provided: ToolbarTemplateManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplateManager", function() { return ToolbarTemplateManager; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/templates/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../logging */ "./src/logging/index.ts");
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../plumbing */ "./src/plumbing/index.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



/**
 * The template manager provides toolbar templates to the entire system.
 * It basically keeps a list of predefined templates, and returns the ones needed
 */
var ToolbarTemplateManager = /** @class */ (function (_super) {
    __extends(ToolbarTemplateManager, _super);
    function ToolbarTemplateManager() {
        var _this = _super.call(this, 'Tlb.TmpMan', null, 'build') || this;
        _this.configTemplateList = [];
        /** hash - table of templates, to be used a list()['template - name'] */
        _this.list = {};
        _logging__WEBPACK_IMPORTED_MODULE_1__["Insights"].add('system', 'toolbar-template-manager', _this.log);
        _this.add(___WEBPACK_IMPORTED_MODULE_0__["ToolbarTemplateEmpty"]);
        _this.add(___WEBPACK_IMPORTED_MODULE_0__["ToolbarTemplateDefault"]);
        // CodeChange #2020-03-20#TemplateToolbarLeftUnused - if no side-effects, delete in June
        // this.add('left', ToolbarTemplateLeft);
        _this.add(___WEBPACK_IMPORTED_MODULE_0__["ToolbarTemplateSublist"]);
        return _this;
    }
    /** Singleton */
    ToolbarTemplateManager.singleton = function () {
        var _a;
        return (_a = this._singleton) !== null && _a !== void 0 ? _a : (this._singleton = new ToolbarTemplateManager());
    };
    /**
     * Deep copy toolbar template, so it can be modified without changing the next use
     */
    ToolbarTemplateManager.prototype.copy = function (name) {
        return _plumbing__WEBPACK_IMPORTED_MODULE_2__["Obj"].DeepClone(this.findOrShowError(name));
    };
    ToolbarTemplateManager.prototype.findOrShowError = function (name) {
        var found = this.list[name];
        if (found)
            return found;
        throw "try to find toolbar template '" + name + "' but not found";
    };
    /**
     * adds a template to the list, if it doesn't exist
     */
    ToolbarTemplateManager.prototype.add = function (template) {
        this.list[template.name] = template;
    };
    return ToolbarTemplateManager;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));



/***/ }),

/***/ "./src/toolbar/templates/toolbar-template.ts":
/*!***************************************************!*\
  !*** ./src/toolbar/templates/toolbar-template.ts ***!
  \***************************************************/
/*! exports provided: ToolbarTemplate */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarTemplate", function() { return ToolbarTemplate; });
/**
 * This describes a template configuration of a toolbar
 * It's meant to provide type-save templates for what buttons are used where
 */
var ToolbarTemplate = /** @class */ (function () {
    function ToolbarTemplate() {
        this.groups = [];
        this.defaults = {};
        this.params = {};
        this.settings = {};
    }
    ToolbarTemplate.is = function (thing) {
        return thing._isToolbarTemplate;
    };
    ToolbarTemplate.hasGroups = function (thing) {
        return Array.isArray(thing.groups);
    };
    return ToolbarTemplate;
}());



/***/ }),

/***/ "./src/toolbar/toolbar-global-enable-shake.ts":
/*!****************************************************!*\
  !*** ./src/toolbar/toolbar-global-enable-shake.ts ***!
  \****************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _plumbing__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../plumbing */ "./src/plumbing/index.ts");

// tslint:disable-next-line: no-var-requires
var Shake = __webpack_require__(/*! shake.js */ "./node_modules/shake.js/shake.js");
// ReSharper disable once InconsistentNaming
// enable shake detection on all toolbars
_plumbing__WEBPACK_IMPORTED_MODULE_0__["NoJQ"].ready(function () {
    // this will add a css-class to auto-show all toolbars (or remove it again)
    function toggleAllToolbars() {
        document.body.classList.toggle('sc-tb-show-all');
    }
    // debugger; // shake is not working, neither on ios nor android. Might be because of http and might work with https
    var shake = new Shake({ callback: toggleAllToolbars });
    // start shake-event monitoring, which will then generate a window-event
    shake.start();
});


/***/ }),

/***/ "./src/toolbar/toolbar-lifecycle.ts":
/*!******************************************!*\
  !*** ./src/toolbar/toolbar-lifecycle.ts ***!
  \******************************************/
/*! exports provided: ToolbarLifecycle */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarLifecycle", function() { return ToolbarLifecycle; });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../constants */ "./src/constants/index.ts");
/* harmony import */ var _workflow__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../workflow */ "./src/workflow/index.ts");


var ToolbarLifecycle = /** @class */ (function () {
    function ToolbarLifecycle() {
    }
    /**
     * This will be triggered when a hover toolbar has been built,
     * so that on-page JS can register workflows for this toolbar.
     * @static
     * @param {HTMLElement} toolbarElement The toolbar HTML DOM passed into the event
     * @param {HTMLElement} anchoredElement The DOM element which had the @Edit.TagToolbar(...) - on which the event will be raised
     * @param {ContextComplete} context The toolbar context
     * @memberof ToolbarLifecycle
     */
    ToolbarLifecycle.raiseToolbarInitEvent = function (toolbarElement, anchoredElement, context) {
        var _a;
        var commandWorkflow = new _workflow__WEBPACK_IMPORTED_MODULE_1__["WorkflowManager"](null);
        commandWorkflow.attach(toolbarElement, context);
        var event = new CustomEvent(_constants__WEBPACK_IMPORTED_MODULE_0__["C"].Toolbar.eventNames.onInit, {
            bubbles: true,
            detail: {
                // type: ToolbarTypes.tag,
                element: toolbarElement,
                identifier: (_a = context.toolbar) === null || _a === void 0 ? void 0 : _a.identifier,
                workflow: commandWorkflow,
            },
        });
        anchoredElement === null || anchoredElement === void 0 ? void 0 : anchoredElement.dispatchEvent(event);
    };
    return ToolbarLifecycle;
}());



/***/ }),

/***/ "./src/toolbar/toolbar-manager.ts":
/*!****************************************!*\
  !*** ./src/toolbar/toolbar-manager.ts ***!
  \****************************************/
/*! exports provided: ToolbarManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ToolbarManager", function() { return ToolbarManager; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/toolbar/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _config_loaders_toolbar_config_loader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config-loaders/toolbar-config-loader */ "./src/toolbar/config-loaders/toolbar-config-loader.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



/**
 * Toolbar manager for the whole page - basically a set of APIs
 * the toolbar manager is an internal helper taking care of toolbars, buttons etc.
 */
var ToolbarManager = /** @class */ (function (_super) {
    __extends(ToolbarManager, _super);
    function ToolbarManager() {
        var _this = _super.call(this, 'Tlb.Mngr', null, 'init') || this;
        _logging__WEBPACK_IMPORTED_MODULE_1__["Insights"].add('system', 'toolbar-manager', _this.log);
        _this.toolbarFinder = new ___WEBPACK_IMPORTED_MODULE_0__["ToolbarConfigFinderAndInitializer"](_this);
        return _this;
    }
    /** Singleton */
    ToolbarManager.singleton = function () {
        var _a;
        return (_a = this._singleton) !== null && _a !== void 0 ? _a : (this._singleton = new ToolbarManager());
    };
    ToolbarManager.prototype.buildModule = function (parentTag) {
        this.toolbarFinder.buildDnnModule(parentTag);
    };
    ToolbarManager.prototype.build = function (node) {
        this.toolbarFinder.build(node);
    };
    ToolbarManager.prototype.loadConfig = function (context, config) {
        var loader = this.getLoader(JSON.stringify(config.toolbar || ''));
        return loader.load(context, config);
    };
    /** Generate a single-use loader. It must be single use so the logs work */
    ToolbarManager.prototype.getLoader = function (instanceName) {
        var loader = new _config_loaders_toolbar_config_loader__WEBPACK_IMPORTED_MODULE_2__["ToolbarConfigLoader"](this);
        _logging__WEBPACK_IMPORTED_MODULE_1__["Insights"].add('toolbar', instanceName, loader.log);
        return loader;
    };
    return ToolbarManager;
}(_logging__WEBPACK_IMPORTED_MODULE_1__["HasLog"]));

// export const ToolbarManager = new ToolbarManagerGlobal();


/***/ }),

/***/ "./src/workflow/index.ts":
/*!*******************************!*\
  !*** ./src/workflow/index.ts ***!
  \*******************************/
/*! exports provided: WorkflowManager, WorkflowArguments, WorkflowPhases, WorkflowStepHelper, WorkflowHelper */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _workflow_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./workflow-manager */ "./src/workflow/workflow-manager.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "WorkflowManager", function() { return _workflow_manager__WEBPACK_IMPORTED_MODULE_0__["WorkflowManager"]; });

/* harmony import */ var _workflow_arguments__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./workflow-arguments */ "./src/workflow/workflow-arguments.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "WorkflowArguments", function() { return _workflow_arguments__WEBPACK_IMPORTED_MODULE_1__["WorkflowArguments"]; });

/* harmony import */ var _workflow_phases__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./workflow-phases */ "./src/workflow/workflow-phases.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "WorkflowPhases", function() { return _workflow_phases__WEBPACK_IMPORTED_MODULE_2__["WorkflowPhases"]; });

/* harmony import */ var _workflow__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./workflow */ "./src/workflow/workflow.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "WorkflowStepHelper", function() { return _workflow__WEBPACK_IMPORTED_MODULE_3__["WorkflowStepHelper"]; });

/* harmony import */ var _workflow_helper__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./workflow-helper */ "./src/workflow/workflow-helper.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "WorkflowHelper", function() { return _workflow_helper__WEBPACK_IMPORTED_MODULE_4__["WorkflowHelper"]; });








/***/ }),

/***/ "./src/workflow/workflow-arguments.ts":
/*!********************************************!*\
  !*** ./src/workflow/workflow-arguments.ts ***!
  \********************************************/
/*! exports provided: WorkflowArguments */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WorkflowArguments", function() { return WorkflowArguments; });
/**
 * Arguments for a workflow. Used when starting it and to determine result / cancelled.
 *
 * @export
 * @class WorkflowArguments
 */
var WorkflowArguments = /** @class */ (function () {
    function WorkflowArguments(
    /** Name this workflow is running for */
    command, 
    /** The phase it's in (before, after, etc.) */
    phase, 
    /** Context of the current command / step being run */
    context, 
    /**
     * Result in after-phases of the workflow
     * BETA - never really tested this
     */
    result) {
        if (result === void 0) { result = null; }
        this.command = command;
        this.phase = phase;
        this.context = context;
        this.result = result;
        /** If the workflow should be cancelled. Can be set by any workflow step. */
        this.cancel = false;
    }
    return WorkflowArguments;
}());



/***/ }),

/***/ "./src/workflow/workflow-helper.ts":
/*!*****************************************!*\
  !*** ./src/workflow/workflow-helper.ts ***!
  \*****************************************/
/*! exports provided: WorkflowHelper */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WorkflowHelper", function() { return WorkflowHelper; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/workflow/index.ts");

var dummyWorkflowManager;
var debug = false;
/**
 * Various helpers to get a workflow or determine result state
 *
 * @export
 * @class WorkflowHelper
 */
var WorkflowHelper = /** @class */ (function () {
    function WorkflowHelper() {
    }
    /**
     * Find the command workflow on a toolbar (or return null).
     * Will go upwards in the DOM to find the toolbar node which has the configuration stored
     */
    WorkflowHelper.getWorkflow = function (node) {
        if (!node)
            return WorkflowHelper.getDummyManager();
        if (debug)
            console.log('try to find command workflow on ', node);
        var maxParents = 100;
        var parentCount = 0;
        var current = node;
        while (current && parentCount++ < maxParents) {
            var cmdWf = current.commandWorkflow;
            if (cmdWf)
                return cmdWf;
            current = current.parentElement;
        }
        if (debug)
            console.log('not found, will return dummy');
        return WorkflowHelper.getDummyManager();
    };
    /**
     * Get a dummy workflow manager
     *
     * @static
     * @returns {WorkflowManager}
     * @memberof WorkflowHelper
     */
    WorkflowHelper.getDummyManager = function () {
        if (!dummyWorkflowManager)
            dummyWorkflowManager = new ___WEBPACK_IMPORTED_MODULE_0__["WorkflowManager"](null, true);
        return dummyWorkflowManager;
    };
    /**
     * Determine if a workflow has been cancelled
     *
     * @static
     * @param {(WorkflowArguments | boolean)} currentArgs
     * @returns {boolean}
     * @memberof WorkflowHelper
     */
    WorkflowHelper.isCancelled = function (currentArgs) {
        var cancel = this._isCancelled(currentArgs);
        if (debug)
            console.log('is cancelled: ' + cancel, currentArgs);
        return cancel;
    };
    WorkflowHelper._isCancelled = function (currentArgs) {
        // promise forgot to return anything, no cancel
        if (currentArgs == null)
            return false;
        // promise returned simple false, cancel
        if (currentArgs === false)
            return true;
        // determine cancel based on either a boolean result or a real WorkflowArguments with cancel.
        return currentArgs.cancel === true;
    };
    return WorkflowHelper;
}());



/***/ }),

/***/ "./src/workflow/workflow-manager.ts":
/*!******************************************!*\
  !*** ./src/workflow/workflow-manager.ts ***!
  \******************************************/
/*! exports provided: WorkflowManager */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WorkflowManager", function() { return WorkflowManager; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/workflow/index.ts");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../commands */ "./src/commands/index.ts");
/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../logging */ "./src/logging/index.ts");
/* harmony import */ var _workflow_helper__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./workflow-helper */ "./src/workflow/workflow-helper.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};




/**
 * A workflow manager which will run stuff before / after commands.
 * As of now, it must be attached to a toolbar to take effect.
 * Normally the toolbar with raise a `toolbar-init` event where you can then add steps
 */
var WorkflowManager = /** @class */ (function (_super) {
    __extends(WorkflowManager, _super);
    function WorkflowManager(parentLog, isDummy) {
        if (isDummy === void 0) { isDummy = false; }
        var _this = _super.call(this, 'Cmd.Wrkflw', parentLog, 'constructor') || this;
        _this.isDummy = isDummy;
        /** The workflow steps registered here */
        _this.steps = [];
        return _this;
    }
    /**
     * Add one or many steps to the workflow
     */
    // @publicApi("Used publicly on the Workflow-object in toolbar-init")
    WorkflowManager.prototype.add = function (steps) {
        var _this = this;
        if (!steps)
            return;
        if (Array.isArray(steps)) {
            steps.forEach(function (s) { return _this.addOne(s); });
        }
        else
            this.addOne(steps);
    };
    /**
     * Add a single workflow step to this manager
     */
    WorkflowManager.prototype.addOne = function (step) {
        step = ___WEBPACK_IMPORTED_MODULE_0__["WorkflowStepHelper"].initDefaults(step);
        var cl = this.log.call('add', "'" + step.name + "' for '" + step.command + "'-'" + step.phase + "'");
        if (!step) {
            var errorMsg = "Trying to add workflow step but didn't get anything";
            cl.add(errorMsg);
            throw errorMsg;
        }
        this.steps.push(step);
        cl.done();
    };
    /**
     * Run a workflow.
     * @returns {Promise<WorkflowArguments>} This will let you chain what happens. The arguments contain a status if it should be cancelled.
     */
    WorkflowManager.prototype.run = function (wfArgs) {
        var _this = this;
        var cl = this.log.call('run', "'" + wfArgs.command + "' for '" + wfArgs.phase + "'");
        // if this is just a temporary / dummy workflow manager, just return a success-promise
        if (this.isDummy) {
            cl.done('Dummy workflow, nothing to run, will return a resolved promise');
            return emptyWorkflow(wfArgs);
        }
        // Find all steps to run
        var stepsForCommand = this.steps
            // only those of this command or all
            .filter(function (s) { return s.command === wfArgs.command || s.command === _commands__WEBPACK_IMPORTED_MODULE_1__["SpecialCommands"].all; })
            .filter(function (s) { return s.phase === wfArgs.phase || s.phase === ___WEBPACK_IMPORTED_MODULE_0__["WorkflowPhases"].all; })
            // only those having real code
            .filter(function (s) { return s.code; })
            .sort(function (s) { return s.priority; });
        if (stepsForCommand.length === 0) {
            cl.done('no steps found for this command / phase, will return a resolved promise');
            return emptyWorkflow(wfArgs);
        }
        // run in sequence but cancel at any time if necessary
        var promise = new Promise(function (resolve, reject) {
            var promiseChain = Promise.resolve(wfArgs);
            var _loop_1 = function (stepCount) {
                var nextStep = stepsForCommand[stepCount];
                promiseChain = promiseChain.then(function (resultingArgs) {
                    return _this.runNextPromiseIfNotCancelled(resultingArgs, wfArgs, nextStep.code);
                });
            };
            // let previousArgs = wfArgs;
            // let interruptChain = false;
            for (var stepCount = 0; stepCount < stepsForCommand.length; stepCount++) {
                _loop_1(stepCount);
            }
            promiseChain.then(function (finalArgs) { resolve(finalArgs); });
            promiseChain.catch(reject);
        });
        return promise;
    };
    /** Attach a workflow to a toolbar */
    WorkflowManager.prototype.attach = function (node, context) {
        var _a;
        var cl = this.log.call('attach');
        if (!node)
            return;
        node.commandWorkflow = this;
        _logging__WEBPACK_IMPORTED_MODULE_2__["Insights"].add('workflow', (_a = context.toolbar) === null || _a === void 0 ? void 0 : _a.identifier, this.log);
        cl.done();
    };
    WorkflowManager.prototype.runNextPromiseIfNotCancelled = function (currentArgs, prevArgs, nextFactory) {
        // determine cancel based on either a boolean result or a real WorkflowArguments with cancel.
        var cancel = _workflow_helper__WEBPACK_IMPORTED_MODULE_3__["WorkflowHelper"].isCancelled(currentArgs);
        // make sure we have real arguments no matter what came in - assuming we have prevArgs
        currentArgs = (currentArgs && typeof (currentArgs) !== 'boolean') ? currentArgs : __assign({}, prevArgs);
        // in case the cancel came as boolean, we must now set it on the currentArgs
        currentArgs.cancel = cancel;
        return cancel ? emptyWorkflow(currentArgs) : nextFactory(currentArgs);
    };
    return WorkflowManager;
}(_logging__WEBPACK_IMPORTED_MODULE_2__["HasLog"]));

function emptyWorkflow(wfArgs) {
    return Promise.resolve(wfArgs);
}


/***/ }),

/***/ "./src/workflow/workflow-phases.ts":
/*!*****************************************!*\
  !*** ./src/workflow/workflow-phases.ts ***!
  \*****************************************/
/*! exports provided: WorkflowPhases */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WorkflowPhases", function() { return WorkflowPhases; });
/**
 * Phases / events of a specific workflow.
 * @export
 * @enum {number}
 */
var WorkflowPhases;
(function (WorkflowPhases) {
    WorkflowPhases["all"] = "all";
    WorkflowPhases["before"] = "before";
    WorkflowPhases["after"] = "after";
})(WorkflowPhases || (WorkflowPhases = {}));


/***/ }),

/***/ "./src/workflow/workflow.ts":
/*!**********************************!*\
  !*** ./src/workflow/workflow.ts ***!
  \**********************************/
/*! exports provided: WorkflowStepHelper */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WorkflowStepHelper", function() { return WorkflowStepHelper; });
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! . */ "./src/workflow/index.ts");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../commands */ "./src/commands/index.ts");


var WorkflowStepHelper = /** @class */ (function () {
    function WorkflowStepHelper() {
    }
    WorkflowStepHelper.initDefaults = function (step) {
        var _a, _b, _c, _d;
        step.name = (_a = step.name) !== null && _a !== void 0 ? _a : '';
        step.command = (_b = step.command) !== null && _b !== void 0 ? _b : _commands__WEBPACK_IMPORTED_MODULE_1__["SpecialCommands"].all;
        step.phase = (_c = step.phase) !== null && _c !== void 0 ? _c : ___WEBPACK_IMPORTED_MODULE_0__["WorkflowPhases"].before;
        step.priority = (_d = step.priority) !== null && _d !== void 0 ? _d : 1;
        if (!step.code || typeof (step.code) !== 'function')
            throw "Tried preparing a workflow step, but the promise either doesn't exist or is not a promise factory";
        return step;
    };
    return WorkflowStepHelper;
}());



/***/ })

/******/ });
//# sourceMappingURL=inpage.min.js.map