{"version":3,"mappings":"oHAAO,MAAMA,EAAoB,CAC/BC,QAAS,UACTC,OAAQ,SACRC,SAAU,WACVC,MAAO,QACPC,OAAQ,SACRC,UAAW,YACXC,OAAQ,SACRC,OAAQ,4CCRH,MAAMC,EAAqB,CAChCC,eAAgB,kBAChBC,gBAAiB,mBACjBC,cAAe,iBACfC,UAAW,aACXC,iBAAkB,qBAClBC,gBAAiB,mBACjBC,cAAe,WACfC,aAAc,gBACdC,SAAU,YACVC,aAAc,gBACdC,oBAAqB,wBACrBC,cAAe,iBACfC,YAAa,eACbC,qBAAsB,yBACtBC,iBAAkB,oBAClBC,iBAAkB,oBAClBC,cAAe,iBACfC,eAAgB,kBAChBC,cAAe,iBACfC,eAAgB,kBAChBC,oBAAqB,wBACrBC,qBAAsB,0BACtBC,WAAY,cACZC,qBAAsB,yBACtBC,cAAe,kBACfC,cAAe,mCClBX,WAAmBC,GAEvB,GADIA,EAAIC,OAAS,GACG,SAAhBD,EAAI,GAAGE,KAAmB,OAAO,KACrC,MAAMC,EAAuB,MAAVH,EAAI,IAA8B,YAAhBA,EAAI,GAAGE,MAAgC,MAAVF,EAAI,IAAwB,MAAVA,EAAI,GAClFI,EAAsB,MAAVJ,EAAI,IAA8B,WAAhBA,EAAI,GAAGE,MAA+B,MAAVF,EAAI,IAAwB,MAAVA,EAAI,GAChFK,EAASC,6BACbC,OAAQP,EAAI,GACZQ,MAAOR,EAAI,GACXS,MAAOT,EAAI,IACPG,GAAc,CAAEO,kBAAmBV,EAAI,GAAIW,eAAgBX,EAAI,KAC/DI,GAAa,CAAEQ,iBAAkBZ,EAAI,GAAIa,cAAeb,EAAI,KAMlE,MAJ8B,CAC5Bc,SAAUd,EAAIe,MAAM,EAAIZ,GAAcC,EAAa,EAAI,GACvDC,UAAWA,GAMT,WAA0BL,GAE9B,GADIA,EAAIC,OAAS,GACG,SAAhBD,EAAI,GAAGE,MAAmC,YAAhBF,EAAI,GAAGE,KAAsB,OAAO,KAClE,MAAMG,EAA2B,CAC/BE,OAAQP,EAAI,GACZQ,MAAOR,EAAI,GACXS,MAAOT,EAAI,IAMb,MAJ8B,CAC5Bc,SAAUd,EAAIe,MAAM,EAAG,GACvBV,UAAWA,GAUT,WAAeL,GAEnB,GADIA,EAAIC,OAAS,GACG,SAAhBD,EAAI,GAAGE,KAAmB,OAAO,KACrC,MAAMC,EAAuB,MAAVH,EAAI,IAA8B,YAAhBA,EAAI,GAAGE,MAAgC,MAAVF,EAAI,IAAwB,MAAVA,EAAI,GAClFI,EAAsB,MAAVJ,EAAI,IAA8B,WAAhBA,EAAI,GAAGE,MAA+B,MAAVF,EAAI,IAAwB,MAAVA,EAAI,GAChFK,EAASC,6BACbG,MAAOT,EAAI,IACPG,GAAc,CAAEO,kBAAmBV,EAAI,GAAIW,eAAgBX,EAAI,KAC/DI,GAAa,CAAEQ,iBAAkBZ,EAAI,GAAIa,cAAeb,EAAI,KAMlE,MAJ8B,CAC5Bc,SAAUd,EAAIe,MAAM,EAAIZ,GAAcC,EAAa,EAAI,GACvDC,UAAWA,GAMT,WAAsBL,GAE1B,GADIA,EAAIC,OAAS,GACG,SAAhBD,EAAI,GAAGE,MAAmC,YAAhBF,EAAI,GAAGE,KAAsB,OAAO,KAClE,MAAMG,EAA2B,CAC/BI,MAAOT,EAAI,IAMb,MAJ8B,CAC5Bc,SAAUd,EAAIe,MAAM,EAAG,GACvBV,UAAWA,gGCvET,QAAwBW,oBACRC,GAClB,MAAMC,EAASD,EAAUA,UACzB,OAAOC,IAAW7C,kBAAmC6C,IAAW7C,cAA+B6C,IAAW7C,gCAG7F4C,GACb,MAAMC,EAASD,EAAUA,UACzB,OAAOC,IAAW7C,kBAAmC6C,IAAW7C,iCAG9C4C,GAClB,OAAOA,EAAUA,YAAc5C,mCAEf4C,GAChB,OAAOA,EAAUA,YAAc5C,gDCb7B,QAGJ8C,cAFQC,YAAyC,sBAK/C,OAAmC,MAA/BC,OAAOC,uBACTD,OAAOC,qBAAuB,IAAIC,GAE7BF,OAAOC,qBAIhBE,IAAIC,GACFL,KAAKM,OAAOD,EAAME,MAAQF,EAI5BG,IAAIC,SACF,OAAiC,QAA1BC,OAAKJ,OAAOG,UAAcE,QAAI,uDCtBnC,QAA2Bf,gCAECgB,GAC9B,OAAQA,QACDC,6BACH,MAAO,+CACJA,oBACAA,kBACH,MAAO,8BACJA,mBACH,MAAO,QACJA,kBACH,MAAO,mCACJA,mBACH,MAAO,uCAEP,MAAO,sCAIqBC,EAAsBC,GACtDD,EAAaE,EAAqBC,yBAAyBH,EAAYC,GACvE,MAAMG,EAASF,EAAqBG,+BAA+BL,GAC7DM,EAAqBF,EAAOE,mBAC5BC,EAAqBH,EAAOG,mBAClC,IAAIC,EAAc,GAElB,MAAMC,EAAgBH,EAAmBvC,OAAS,EAC5C2C,EAAgBH,EAAmBxC,OAAS,EAClD,OAAI0C,GAAiBC,EACnBF,EAAc,GAAGF,EAAmBK,KAAK,WAAWJ,EAAmBI,KAAK,SACnEF,EACTD,EAAcF,EAAmBK,KAAK,MAC7BD,IACTF,EAAc,IAAID,EAAmBI,KAAK,UAGrCH,kCAG+BR,EAAsBC,GAC5D,MAAMW,EAA0C,GAC1CC,EAAuBZ,EAAgBpB,MAAM,EAAGoB,EAAgBa,QAAQ,MAE9EF,SAAcC,GAAwB,GACtCD,EAAcC,GAAsBE,KAAKF,GAEzCb,EAAWgB,QAAQC,IAEjB,MAAMC,EADiBD,EAAUpC,MAAM,EAAGoC,EAAUH,QAAQ,MACrBK,QAAQ,IAAK,IAE/CP,EAAcM,KACjBN,EAAcM,GAAmB,IACjCN,EAAcM,GAAiBH,KAAKE,KAM3BjB,EAAWoB,IAAIH,IAC1B,MAAMI,EAAiBJ,EAAUpC,MAAM,EAAGoC,EAAUH,QAAQ,MACtDI,EAAkBG,EAAeF,QAAQ,IAAK,IAEpD,OAAIP,EAAcM,GAAiBnD,OAAS,EACnCkD,EAEAI,IAIJrB,sCAGqCA,GAC5C,MAAMM,EAA+B,GAC/BC,EAA+B,GAErCP,SAAWgB,QAAQC,IACZA,EAAUK,SAAS,KAGtBf,EAAmBQ,KAAKE,EAAUE,QAAQ,IAAK,KAF/Cb,EAAmBS,KAAKE,KAMrB,CACLX,qBACAC,kFC7EC,IAAMgB,EAAb,MAAM,QADNtC,cAEUC,iBAA2B,KAEnCA,yBAAsB,EACtBA,2BAAwB,EAExBsC,KAAKC,GACHvC,KAAKuC,YAAcA,EAerBC,8BACEC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,YACA,MAAMC,GAA2B,GACjC,UAAWC,KAAaR,EAAYS,WAAY,CAC9C,MAAMC,GAAoCN,EAAsBO,OAAO3C,GAAKA,EAAEH,OAAS2C,EAAUI,MAE3FC,EAAmBV,EAAqBK,EAAUI,MAGlDE,GAD2E,QAA/EC,KAAkCL,GAAkCvE,OAAS,UAAE8B,eAAE+C,QAC1BH,EACrDvD,KAAK2D,aALWhB,EAAWO,EAAUI,MAKNE,EAAUT,EAAwC,QAA3Ba,KAAYV,EAAUI,aAAKO,iBAAEC,SAASC,iCAC9Fd,GAAaC,EAAUI,MAAQE,GAInC,OAAItE,OAAO8E,KAAKf,IAAcpE,OAAS,GACjCmB,KAAKiE,sBAAwBjE,KAAKkE,sBACpClE,KAAKkE,sBACLlE,KAAKuC,YAAY4B,2BACf1B,EAAYQ,GAAcD,EAAajC,gBAAiBiC,EAAaoB,kBAGhE,GAiBLT,aACNU,EACAd,EACAR,EACAuB,GAGA,GAAIvB,GAAeuB,QAA+CC,IAAhBF,QAAkDE,IAArBhB,EAC7E,OAAO,EAET,IAAIiB,EAAiBH,IAAgBd,EAErC,OAAIiB,GAAkBC,MAAMC,QAAQL,IAAgBI,MAAMC,QAAQnB,KAChEiB,GAAkBG,iBAA2BN,EAAyBd,IAEjEiB,gDAnFEnC,gCAAsBuC,QAAtBvC,EAAsB,YAAtBA,GAAb,+LCSO,IAAMwC,GAAb,MAAM,QAMJ9E,YACU+E,EACAvC,EACAwC,EACAC,EACAC,EACAC,EACAC,GANAnF,kBACAA,mBACAA,0BACAA,+BACAA,8BACAA,sBACAA,iBATFA,kBAAe,IAAIoF,KAY3BC,wBACoB,QAAlBC,OAAKC,qBAAa5E,SAAE6E,WACA,QAApBC,OAAKC,uBAAe7B,SAAE2B,WACH,QAAnBG,OAAKC,sBAAcC,SAAEL,WACrBxF,KAAK8F,aAAaC,cAGpBzD,OACEtC,KAAK0F,gBAAkB,IAAIM,IAAgB,IAQ3ChG,KAAK4F,eAAiB,IAAII,IAPkB,CAC1CC,UAAU,EACVxD,gBAAY8B,EACZ2B,eAAW3B,EACX4B,QAAQ,EACRC,YAAQ7B,IAGV,MAAM8B,EAAerG,KAAKsG,oBAC1BtG,KAAKuF,cAAgB,IAAIS,IAAgBK,GAW3CE,WAAW9D,EAAoByD,EAAmBE,EAAuBI,GACvE,OAAOxG,KAAKuF,cAAc7B,MAAM+C,KAC9B/F,KACEA,EAAE+B,aAAeA,GACd/B,EAAEwF,YAAcA,GAChBxF,EAAE0F,SAAWA,IACZI,GAAqB9F,EAAEgG,UAYjCC,YAAYlE,EAAoByD,EAAmBE,EAAuBI,GACxE,MAAME,EAAUF,EAAa,EAAC,GAAM,GAAS,EAAC,GAC9C,OAAOxG,KAAKuF,cAAcqB,QACxB1E,KAAI2E,GAAYA,EAASJ,KACvB/F,GAAKA,EAAE+B,aAAeA,GAAc/B,EAAEwF,YAAcA,GAAaxF,EAAE0F,SAAWA,GAAUM,EAAQtE,SAAS1B,EAAEgG,YAE7GI,OAAqBnC,oBAYzBoC,YAAYtE,EAAqByD,EAAoBE,EAAwBI,GAC3E,OAAOxG,KAAKuF,cAAc7B,MAAML,OAC9B3C,KACG+B,GAAa/B,EAAE+B,aAAeA,GAC3ByD,GAAYxF,EAAEwF,YAAcA,GAC5BE,GAAS1F,EAAE0F,SAAWA,IACtBI,GAAqB9F,EAAEgG,UAQjCM,eACE,OAAOhH,KAAKuF,cAAc0B,eAW5BC,wBAAwBzE,EAAoByD,EAAmBE,EAAuBe,EAAiBC,sBACrG,IAAIC,GACJ,GAAID,EACF,IACEC,GAAkBC,yBAAoCH,SAC/CI,IACPvH,KAAKwH,sBAAsB/E,EAAYyD,EAAWE,OAAQ7B,GAAW,GAAM,GAC3E,MAAMkD,GAAOzH,KAAKuC,YAAYmF,QAAQjF,GAChCkF,GAAgBC,sBAAmCH,IACnD/E,GAAc1C,KAAK+E,mBAAmB8C,eAAeF,IACrD5G,GAAkBf,KAAKgF,wBAAwB8C,mBAAmB9H,KAAK8E,WAAWiD,UAAUC,QAC5F5D,GAAkBpE,KAAKgF,wBAAwBiD,mBAAmBjI,KAAK8E,WAAWiD,UAAUC,QAE5FE,GAAa,uCADDC,yBAA0CzF,GAAa3B,GAAiBqD,iBACT8B,gBAAwBE,KACzGpG,KAAKkF,eAAekD,OAAOC,WAAqBH,GAAYX,IAC5D,MAAMe,EAAgBtI,KAAKuI,mBAKvBC,EAJmCrC,QAClCmC,EAAc7F,aAAeA,GAC7B6F,EAAcpC,YAAcA,GAC5BoC,EAAclC,SAAWA,GAE5BqC,QAAQlB,MAAMW,GAAYX,IAKhC,MAAMmB,GAAkB1I,KAAKuF,cAAc7B,MACrCiF,GAAkBD,GAAgBE,UAAUlI,IAAKA,GAAE+B,aAAeA,GAAc/B,GAAEwF,YAAcA,GAAaxF,GAAE0F,SAAWA,GAC1HyC,EAAiBH,GAAgBC,IAGjCG,GAAS9I,KAAK+I,iCAAiC,KAAMtG,GAGrDuG,IAAyB,MAAdC,OAAc,EAAdA,EAAgBC,aAA2B,MAAdL,OAAc,EAAdI,EAAgBE,iBAC1D,CAAED,UAAWL,EAAeK,UAAWE,UAAWP,EAAeM,iBACjEnJ,KAAKqJ,sBAEHC,GAAmC,CACvCC,MAA4B,QAArBC,EAAc,MAAdP,OAAc,EAAdA,EAAgBM,aAAK5I,QAAI,GAChC8B,aACAyD,YACAuD,GAAmB,MAAfpC,QAAe,EAAfqC,GAAiBC,KAAK,IAC1BjD,SAASU,GAAyB,MAAnBC,GACfuC,OAAQzC,EACR0C,mBAAkC,MAAdhB,OAAc,EAAdI,EAAgBY,mBACpCC,WAA0B,MAAdjB,OAAc,EAAdI,EAAgBa,WAC5BC,SAAwB,MAAdlB,OAAc,EAAdI,EAAgBc,SAC1B3D,SACA4D,QAAS1C,uBAAkCH,GAC3C8C,aAA0C,QAA5BC,EAAc,MAAdjB,OAAc,EAAdA,EAAgBgB,oBAAYpG,QAAIiF,GAAOmB,aACrDE,KAA0B,QAApBC,EAAc,MAAdnB,OAAc,EAAdA,EAAgBkB,YAAItE,QAAIiD,GAAOqB,KACrCE,IAAwB,QAAnBC,EAAc,MAAdrB,OAAc,EAAdA,EAAgBoB,WAAGE,QAAIzB,GAAOuB,IACnCG,IAAwB,QAAnBC,EAAc,MAAdxB,OAAc,EAAdA,EAAgBuB,WAAGE,QAAI5B,GAAO0B,IACnCG,aAAa,EACbzB,UAAoC,QAAzB0B,EAAc,MAAd3B,OAAc,EAAdA,EAAgBC,iBAAS2B,QAAI7B,GAAQE,UAChDC,gBAAgD,QAA/B2B,GAAc,MAAd7B,OAAc,EAAdA,EAAgBE,uBAAe4B,UAAI/B,GAAQI,WAGxD4B,GAAWrC,IAAmB,EAChC,IAAID,GAAgB/I,MAAM,EAAGgJ,IAAkBW,MAAmBZ,GAAgB/I,MAAMgJ,GAAkB,IAC1G,CAACW,MAAmBZ,IACxB1I,KAAKuF,cAAc0F,KAAKD,IAa1BE,YAAYzI,EAAoByD,EAAmBE,EAAuBe,EAAiB2C,EAAoBC,GAC7G,MAAMrB,EAAkB1I,KAAKuF,cAAc7B,MACrCiF,EAAkBD,EAAgBE,UAAUlI,IAAKA,GAAE+B,aAAeA,GAAc/B,GAAEwF,YAAcA,GAAaxF,GAAE0F,SAAWA,GAC1HyC,EAAiBH,EAAgBC,GACvC,GAAsB,MAAlBE,EAA0B,OAE9B,MAAMS,EAAcpK,+BACf2J,GAAc,CACjBgB,mBAAoB1C,EACpB2C,aACAC,aAGIiB,EAAW,IAAItC,EAAgB/I,MAAM,EAAGgJ,GAAkBW,KAAmBZ,EAAgB/I,MAAMgJ,EAAkB,IAC3H3I,KAAKuF,cAAc0F,KAAKD,GAS1BG,OAAO1I,EAAoByD,EAAmBE,GAC5C,MAAMsC,EAAkB1I,KAAKuF,cAAc7B,MACrCiF,EAAkBD,EAAgBE,UAAUlI,GAAKA,EAAE+B,aAAeA,GAAc/B,EAAEwF,YAAcA,GAAaxF,EAAE0F,SAAWA,GAE1H4E,EAAW,IAAItC,EAAgB/I,MAAM,EAAGgJ,MAAqBD,EAAgB/I,MAAMgJ,EAAkB,IAC3G3I,KAAKuF,cAAc0F,KAAKD,GAS1BI,aAAa3I,EAAoByD,EAAmBE,GAClD,MAAMiF,EAAarL,KAAK0F,gBAAgBhC,MAClC4H,EAAiBD,EAAWzC,UAAU2C,GAAKA,EAAE9I,aAAeA,GAAc8I,EAAErF,YAAcA,GAAaqF,EAAEnF,SAAWA,GAC1H,GAAIkF,GAAkB,EAAG,CACvB,MAAME,EAAa,IAAIH,EAAW1L,MAAM,EAAG2L,MAAoBD,EAAW1L,MAAM2L,EAAiB,IACjGtL,KAAK0F,gBAAgBuF,KAAKO,GAG5B,MAAM9C,EAAkB1I,KAAKuF,cAAc7B,MACrCiF,EAAkBD,EAAgBE,UAAUlI,GAAKA,EAAE+B,aAAeA,GAAc/B,EAAEwF,YAAcA,GAAaxF,EAAE0F,SAAWA,GAC1HyC,EAAiBH,EAAgBC,GAEvC,GAA0C,OAAxB,MAAdyB,OAAc,EAAdA,EAAgBP,oBAClB7J,KAAKkH,wBAAwBzE,EAAYyD,EAAWE,EAAQyC,EAAegB,oBAAoB,WACtFlB,GAAmB,EAAG,CAC/B,MAAMqC,EAAW,IAAItC,EAAgB/I,MAAM,EAAGgJ,MAAqBD,EAAgB/I,MAAMgJ,EAAkB,IAC3G3I,KAAKuF,cAAc0F,KAAKD,IAa5BxD,sBACE/E,EAAoByD,EAAmBE,EAAuB1C,EAAmB+H,EAAkBC,GAEnG,MAAMC,EAA2B,CAC/BlJ,aACAyD,YACAE,SACA1C,QACA+H,UACAC,iBAGIL,EAAarL,KAAK0F,gBAAgBhC,MAClC4H,EAAiBD,EAAWzC,UAAU2C,GAAKA,EAAE9I,aAAeA,GAAc8I,EAAErF,YAAcA,GAAaqF,EAAEnF,SAAWA,GACpHoF,EAAaF,GAAkB,EACjC,IAAID,EAAW1L,MAAM,EAAG2L,GAAiBK,KAAcN,EAAW1L,MAAM2L,EAAiB,IACzF,CAACK,KAAcN,GACnBrL,KAAK0F,gBAAgBuF,KAAKO,GAU5BI,kBAAkBnJ,EAAoByD,EAAmBE,GACvD,OAAOpG,KAAK0F,gBAAgBkB,QAC1B1E,KAAI2J,GAAWA,EAAQpF,KAAK8E,GAAKA,EAAE9I,aAAeA,GAAc8I,EAAErF,YAAcA,GAAaqF,EAAEnF,SAAWA,KAC1GU,OAAqBnC,oBAQzBmH,gBAAgB3F,GACd,MAAM4F,EAAQ7M,+BACTc,KAAKuI,oBAAkB,CAC1BpC,WAEFnG,KAAKgM,iBAAiBD,GAOxBC,iBAAiBC,GACfjM,KAAK4F,eAAeqF,KAAKgB,GAO3B1D,mBACE,OAAOvI,KAAK4F,eAAelC,MAO7BwI,oBACE,OAAOlM,KAAK4F,eAAegB,MAAKE,OAAqBnC,oBAS/CoE,iCAAiCtB,EAAehF,SAEtD,MAAM0J,GADN1E,EAAW,MAAJA,IAAQzH,KAAKuC,YAAYmF,QAAQjF,IACpB5F,OACduP,EAAQD,EAAOE,IACfpC,EAAyC,CAC7CqC,KAAMH,EAAOI,KACbC,GAAIL,EAAOM,GACXC,KAAM,CACJJ,KAAMH,EAAOQ,KAAKF,GAClBlM,KAAM4L,EAAOQ,KAAKrJ,MAIpBsJ,IAAK,CACHC,WAA6B,QAAjBlH,EAAK,MAALmH,OAAK,EAALA,EAAOC,kBAAUpM,QAAI,EACjC2L,KAAW,MAALF,OAAK,EAALU,EAAOP,KACbS,OAAa,MAALZ,OAAK,EAALU,EAAO/P,OACfkQ,OAAa,MAALb,OAAK,EAALU,EAAO9P,SAGb8H,EAAa9E,KAAK8E,WAClBqF,EAAOrF,EAAWiD,UAAUmF,cAAcC,KAC1CpF,EAAYjD,EAAWiD,UAC7B,MAAO,CACLkC,eACAE,KAAM,CACJiD,MAAW,MAAJjD,OAAI,EAAJC,EAAMiD,MACbf,KAAU,MAAJnC,OAAI,EAAJC,EAAMmC,KACZC,GAAQ,MAAJrC,OAAI,EAAJC,EAAMqC,GACVa,YAAiB,MAAJnD,OAAI,EAAJC,EAAMmD,YACnBC,YAAiB,MAAJrD,OAAI,EAAJC,EAAMqD,YACnBC,eAAoB,MAAJvD,OAAI,EAAJC,EAAMuD,eACtBC,cAAmB,MAAJzD,OAAI,EAAJC,EAAMyD,cACrBtN,KAAU,MAAJ4J,OAAI,EAAJC,EAAM9G,KACZwK,SAAc,MAAJ3D,OAAI,EAAJC,EAAM2D,UAElB1D,IAAK,CACHjL,MAAO4O,SAASjG,EAAU3I,MAAO,IACjCD,OAAQ6O,SAASjG,EAAU5I,OAAQ,IACnC8O,SAAUlG,EAAUmF,cAAcgB,IAAIC,YACtCC,OAAQrG,EAAUmF,cAAcgB,IAAIG,UACpCC,UAAWvG,EAAUmF,cAAcgB,IAAIK,aACvCC,WAAaC,OAEfjE,IAAKvK,OAAOyO,MAAM,CAChBvP,OAAQ4I,EAAU5I,OAClBC,MAAO2I,EAAU3I,MACjBuP,OAAQ5G,EAAU6G,MAClBC,SAAU9G,EAAU8G,SACpBC,yBAAyB,EACzBC,kBAAkB,KAShBzI,oBACN,MAAMD,EAAmC,GACnCtF,EAAkBf,KAAKgF,wBAAwB8C,mBAAmB9H,KAAK8E,WAAWiD,UAAUC,QAC5F5D,EAAkBpE,KAAKgF,wBAAwBiD,mBAAmBjI,KAAK8E,WAAWiD,UAAUC,QAC5FhF,EAAe,IAAIgM,KAAajO,EAAiBqD,GAEvD,UAAW3B,KAAczC,KAAK8E,WAAWiD,UAAUkH,UAAW,CAC5D,MAAMxH,EAAOzH,KAAKuC,YAAYmF,QAAQjF,GAEhCyM,EAAclP,KAAK+I,iCAAiCtB,EAAMhF,GAE1DkF,EAAgBC,sBAAmCH,GACnD/E,EAAc1C,KAAK+E,mBAAmB8C,eAAeF,GAC3D,UAAWzE,KAAaR,EAAYS,WAAY,CAC9C,MAAMW,EAAWqE,6BACfnF,EAAamM,WAA0BjM,EAAUkM,WAG7CC,GAAerP,KAAKiF,uBAAuBqK,oBAAoBxL,EAASyL,UAAUlM,OAAOmM,IACpEC,eAA8B1O,EAAiBqD,EAAiBoL,GAAYrM,WAAWuM,QAAS,OAG3H,UAAWF,MAAeH,GAAc,CACtC,MAAMlI,GAAkBsI,eAA8B1O,EAAiBqD,EAAiBoL,GAAYrM,WAAWwM,QAAS,MACxH,GAAe,MAAXxI,GAAmB,SAEvB,MAAMf,GAAwBqJ,eAC5B1O,EAAiBqD,EAAiBoL,GAAYrM,WAAWyM,OAAQ,MAGnE,IAAIvI,EACJ,IACEA,EAAkBC,yBAAoCH,UAC/CI,IACPvH,KAAKwH,sBAAsB/E,EAAYS,EAAUI,KAAM8C,QAAQ7B,GAAW,GAAM,GAChF,MAAMsL,GAAY1H,yBAA0CzF,EAAa3B,EAAiBqD,GAC1FpE,KAAKkF,eAAekD,OAAOC,WAAqB,uCAAuCwH,gBAAuB3M,EAAUI,mBAAmB8C,MAAWmB,IACtJvH,KAAKkF,eAAe4K,YAAY9P,KAAKmF,UAAU4K,QAAQ,+BAAgC,KAGzF,MAAM/G,GAAUhJ,KAAKqJ,sBAEf2G,GAAqC,CACzCzG,MAAO,GACP9G,aACAyD,UAAWhD,EAAUI,KACrBmG,GAAmB,MAAfpC,OAAe,EAAf4B,EAAiBU,KAAK,IAC1BjD,QAA4B,MAAnBW,EACTuC,OAAQzC,GACR0C,mBAAoB1C,GACpB2C,WAAY0F,GAAYjD,KACxBxC,SAAUyF,GAAY/C,GACtBrG,UACA4D,QAAS1C,uBAAkCH,IAC3C8C,aAAciF,EAAYjF,aAC1BE,KAAM+E,EAAY/E,KAClBE,IAAK6E,EAAY7E,IACjBG,IAAK0E,EAAY1E,IACjBG,aAAa,EACbzB,UAAWF,GAAQE,UACnBC,gBAAiBH,GAAQI,WAG3B/C,EAAaxE,KAAKmO,MAKxB,OAAO3J,EAODgD,sBACN,MAAMH,EAAY,IAAIlD,IAAwD,MACxEoD,EAAY,IAAIpD,IAAiE,MACjFiK,EAAc/G,EAAUtC,MAC5BvD,OAAO6M,KAAOA,MACdC,KAAUC,MAAWC,KAAKD,KAG5B,YAAKtK,aAAa1F,OAAIkQ,KAAc,CAACL,EAAa7G,EAAUxC,MAAKvD,OAAO6M,KAAOA,MAAMK,UACnF,EAAErP,EAAQsP,MACRA,EAAStP,MAIN,CAAEgI,YAAWE,2DAxdXvE,GAAsB4L,iHAAtB5L,EAAsBD,QAAtBC,EAAsB,YAAtBA,GAAb,2KCOO,IAAM6L,EAAb,MAAM,SAOJ3Q,YACUiF,EACAF,GACAvC,EACAoO,EACAC,EACA1L,EACAC,EACA0L,EACAC,EACAC,GATA/Q,+BACAA,mBACAA,mBACAA,uBACAA,8BACAA,sBACAA,iBACAA,2BACAA,8BACAA,uBAhBFA,kBAA6B,IAAIoF,KACjCpF,oBAAiB,IAAIgG,IAAkC,IAEvDhG,2BAA+C,KAC/CA,2BAA+C,KAevDqF,cACErF,KAAK8F,aAAaC,cAGpBzD,KACE0O,EACAC,GACAC,GACAlR,KAAKgR,sBAAwBA,EAC7BhR,KAAKiR,sBAAwBA,GAC7BjR,KAAKkR,qBAAuBA,EAC5BlR,KAAK8F,aAAa1F,IAAIJ,KAAK+Q,gBAAgBI,UAAUZ,UAAUvQ,KAAKoR,iBAuBtEC,eACE5O,EACA6O,GACApO,EACAP,EACA9C,EACAQ,EACAkR,EACAC,EACAC,EACAC,EACAC,EACA3O,EACAD,EACA6O,GACAvN,GACAwN,aAEA,MAAMhL,GAAW7G,KAAK4Q,uBAAuB7J,YAAYtE,EAAYS,EAAUI,KAAM,MAAM,GACxFD,OAAO3C,KAAMA,GAAEiK,aAClB,IAAImH,GACAC,GACJ,MAAMC,GAAkC,GAClCC,GAAmC,GAEzC,UAAW9K,MAAWN,GAAU,CAC9B,MAAMqL,GAAgBlS,KAAKmS,WAAWhL,GAASmK,GAAU3O,EAAY9C,EAAW0R,EAAiBC,EAAiBC,GAWlH,IAViB,MAAbW,QAAa,EAAbA,GAAehC,mBAAmBiC,SACpCrS,KAAKiR,sBAAsBqB,qBAAqB7P,EAAYyP,GAAe/K,GAAStH,GACpFsH,GAAQwD,YAAgC,QAAlB4H,MAAcC,YAAI7R,YAExCwG,GAAQwD,YAAgC,QAAlB1B,KAAcuJ,YAAI3O,QAAIsD,GAAQwD,YAGlDuH,GAAcO,QAChBT,GAAcnQ,QAAQqQ,GAAcO,aAEVlO,IAAxB2N,GAAcxO,MAElB,IAAIyD,GAAQf,SAAWsM,WAAsB,CAC3CZ,GAAeI,GAAcxO,MAC7B,SAGF,GAAIyD,GAAQf,SAAWsM,gBAA2B,CAChDX,GAAoBG,GAAcxO,MAClC,SAGFiP,8BAAgDxL,GAAQf,OAAQoL,EAAiBU,GAAcxO,MAAOuO,KA2BxG,MAN4C,CAC1CnO,SAnBsB6O,uCACtBpB,EAAerS,+BAEVsS,GACAS,IAEL/O,EACAwO,EACA7R,EACAQ,EACAsR,EACA3O,EACAD,EACA6O,GACAvN,GACAwN,IAKAe,WAAYb,GACZrO,MAAOoO,GACPW,OAAQT,IAYJa,sBAAsB3M,EAAmBnF,GAAyBqD,GACxE,MAAO,aAAa8B,qBAA6BnF,sBAAmCqD,IAc9E+N,WACNhL,EACAmK,GACA3O,EACA9C,EACA0R,EACAC,EACAC,GAEA,MAAM1Q,EAAkBf,KAAKgF,wBAAwB8C,mBAAmB9H,KAAK8E,WAAWiD,UAAUC,QAC5F5D,EAAkBpE,KAAKgF,wBAAwBiD,mBAAmBjI,KAAK8E,WAAWiD,UAAUC,QAC5F8K,EAAY9S,KAAK2Q,gBAAgBoC,eACjCC,EAAehT,KAAK6Q,oBAAoBoC,kBACxCC,EAAoBlT,KAAK8Q,uBAAuBqC,iBAAiBhM,EAAQ1E,WAAY1B,GACrFqS,EAAe9L,sBACnBH,EACAmK,GACAzR,EACA0R,EACAC,EACA7O,EACAuQ,EACAnS,EACAqD,EACA0O,EACArB,EACAuB,EACAhT,KAAKuC,YACLvC,KAAK8E,WACL9E,KAAKgR,sBACLhR,KAAKoR,eAAe1N,OAEhB8E,GAAmBxI,KAAKqT,eAAelM,GACvCmM,GAAatT,KAAKkR,qBAAqBxN,MAC7C,IACE,OAAQyD,EAAQ6C,cACTuJ,QACC/K,IACFC,QAAQ+K,IAAI,kBAAkBrM,EAAQ6C,QAAQyJ,oCAAoCH,GAAWI,wBAAwBvM,EAAQjB,wBAAwBiB,EAAQf,oCAAqCgN,GAEpM,MAAMO,GAAmBxM,EAAQsC,GAAyB2J,EAAaQ,KAAMR,EAAaS,QAAST,EAAaU,cAC1GpP,GAAUiP,IAAmBlP,MAAMC,QAAQiP,KAAqBA,GAAwBI,MAAOxI,IAAwB,iBAANA,IACvH,GAA+B,iBAApBoI,IACqB,iBAApBA,IACoB,kBAApBA,IACPA,cAA2BK,MAC3BtP,KACCiP,GAAiB,CACrB,GAAIxM,EAAQf,SAAWsM,WAAsB,CAC3C,MAAMuB,GAAU,CACdvQ,MAAOwQ,oBAAwCP,GAA+B9T,GAC9E4S,OAAQ,GAAID,KAAM,KAAM2B,eAAgB3L,IAE1C,YAAKoI,uBAAuBpJ,sBAC1BL,EAAQ1E,WAAY0E,EAAQjB,UAAWiB,EAAQf,OAAQ6N,GAAQvQ,OAAO,GAAO,GAC3E8E,IACFC,QAAQ+K,IAAI,kBAAmBS,IAE1BA,GAET,MAAO,CACLvQ,MAAOiQ,GAAiBlB,OAAQ,GAChCD,KAAM,KAAM2B,eAAgB3L,IAGhCC,eAAQlB,MAAM,yHACP,CAAE7D,WAAOa,EAAWkO,OAAQ,GAAID,KAAM,KAAM2B,eAAgB3L,SAChE+K,QACC/K,IACFC,QAAQ+K,IAAI,kBAAkBrM,EAAQ6C,QAAQyJ,oCAAoCH,GAAWI,wBAAwBvM,EAAQjB,wBAAwBiB,EAAQf,oCAAqCgN,GAEpM,MAAMgB,EAAmBjN,EAAQsC,GAAyB2J,EAAaQ,KAAMR,EAAaS,QAAST,EAAaU,cAC1GO,GAAUH,qBAAyC/M,EAAQf,OAAQgO,EAAiBvU,GAC1FwU,UAAQF,eAAiB3L,QACHjE,IAAtB+P,GAAY5Q,OAAuB2Q,GAAQjE,QACzCpQ,KAAK4Q,uBAAuBpJ,sBAC1BL,EAAQ1E,WAAY0E,EAAQjB,UAAWiB,EAAQf,YAAQ7B,GAAW,GAAO,GAE3EvE,KAAK4Q,uBAAuBpJ,sBAC1BL,EAAQ1E,WAAY0E,EAAQjB,UAAWiB,EAAQf,OAAQiO,GAAQ3Q,OAAO,GAAO,GAC7E8E,IACFC,QAAQ+K,IAAI,kBAAmBa,GAAQ3Q,OAElC2Q,WAEH7L,IACFC,QAAQ+K,IAAI,gCAAgCF,GAAWI,wBAAwBvM,EAAQjB,wBAAwBiB,EAAQf,yCAAqC7B,GAE9J,MAAMgQ,GAAwBpN,EAAQsC,KAChC+K,GAAeN,qBAAyC/M,EAAQf,OAAQmO,GAAsB1U,GACpG2U,UAAaL,eAAiB3L,GAC9BxI,KAAK4Q,uBAAuBpJ,sBAC1BL,EAAQ1E,WAAY0E,EAAQjB,UAAWiB,EAAQf,OAAQoO,GAAa9Q,OAAO,GAAO,GAChF8E,IACFC,QAAQ+K,IAAI,kBAAmBgB,IAE1BA,UAEJjN,IACP,MAAMW,GAAa,6CAA6CoL,GAAWI,wBAAwBvM,EAAQjB,wBAAwBiB,EAAQf,UAC3I,YAAKwK,uBAAuBpJ,sBAAsBL,EAAQ1E,WAAY0E,EAAQjB,UAAWiB,EAAQf,YAAQ7B,GAAW,GAAM,GAC1HvE,KAAKkF,eAAekD,OAAOC,WAAqBH,GAAYX,IAC5DuD,GACErC,QAAQlB,MAAMW,GAAYX,IAE1BvH,KAAKkF,eAAe4K,YAAY9P,KAAKmF,UAAU4K,QAAQ,6BAA8B,KAEhF,CAAErM,WAAOa,EAAWkO,OAAQ,GAAID,KAAM,KAAM2B,eAAgB3L,KAS/D6K,eAAelM,GACrB,MAAMmB,GAAgBtI,KAAK4Q,uBAAuBrI,mBAKlD,OAJyBD,GAAcnC,QAClCmC,GAAc7F,aAAe0E,EAAQ1E,YACrC6F,GAAcpC,YAAciB,EAAQjB,WACpCoC,GAAclC,SAAWe,EAAQf,sDApR7BsK,IAAaD,mJAAbC,GAAa9L,QAAb8L,GAAa,YAAbA,IAAb,mDCzBM,QACJ3Q,YACEkD,EACAwR,EACAC,GAEA1U,KAAKiD,aAAeA,EACpBjD,KAAKyU,aAAeA,EACpBzU,KAAK0U,eAAiBA,+CCUnB,IAAMC,EAAb,MAAM,QAGJ5U,cAFQC,2BAA+C,KAIvDsC,KAAK0O,GACHhR,KAAKgR,sBAAwBA,EAU/BsB,qBACE7P,EACAmS,EACAvO,EACAxG,MAEAgV,KAAkB,kBAAmBxO,EAAaD,OAAQwO,GACtDA,EAAkBT,gBAA6C,OAA3BS,EAAkBpC,MACxD/J,QAAQ+K,IAAI,qJAEdnN,EAAa6C,UAAU+B,KAAK2J,EAAkBxE,SAC9CpQ,KAAK8U,+BAA+BzO,EAAcxG,EAAW4C,GASvDqS,+BACNzO,EACAxG,EACA4C,GAEA,IAAK4D,EAAa8C,gBAAgBzF,MAAO,CACvC,MAAMqR,EAAQ/U,KAAKgR,sBAAsBgE,iBACzC3O,EAAa8C,gBAAgB8B,KAAM/J,qBACjC,MAAM+T,EAAYf,qBAAyC7N,EAAaD,OAAQlF,EAAQrB,GAElFqV,EAA6B,QAAjBtR,KAAMnB,UAAW9B,UAAI,IAAIwU,EAAqB,GAAI,GAAI,IACxE,IAAIlS,EAA2B,GAC3BmS,EAAoC,GAExC,GAAI/O,EAAaD,SAAWsM,WAC1BzP,EAAqC,QAAtBoS,KAAUpS,oBAAYY,UAAI,GACzCZ,EAAaoD,EAAaH,WAAa+O,EAAUvR,cAExC2C,EAAaD,OAAOkP,WAAWC,MAAwB,IAChEV,KAAkB,4BAClB,MAAMW,EAAcnP,EAAaD,OAAOqP,UAAUF,aAClDH,EAAwC,QAAxBM,IAAUhB,sBAAc7O,QAAI,GAC5C,MAAM8P,EAAa,CAAEpV,KAAM8F,EAAaH,UAAWpC,SAAU,CAAC,CAAE0R,cAAa9R,MAAOxC,KACpFkU,EAAgBA,EAAc/R,OAAO+G,GAAKA,EAAE7J,OAAS8F,EAAaH,YAAckE,EAAEtG,SAAS2C,KAAKmP,GAAMA,EAAGJ,cAAgBA,IACzHJ,EAAcvT,KAAK8T,GAGrB,MAAME,EAAsC,QAAtBC,KAAUrB,oBAAYlK,UAAI,GAC5C0K,EAAUxC,QACZoD,EAAchU,QAAQoT,EAAUxC,QAClCsC,EAAMtS,GAAc,IAAI0S,EAAqBlS,EAAc4S,EAAeT,GAC1E/O,EAAasE,YAA4B,QAAdrF,IAAUkN,YAAI9H,QAAIrE,EAAasE,YAC1D3K,KAAKgR,sBAAsB+E,uBAwBjCC,sBACEvT,EACAsS,EACArS,EACAC,EACAC,EACAG,GACAC,GACAiT,EACAC,GACAxE,EACAyE,EACAC,EACAxE,EACAC,EACAwE,GAEA,GAAyB,MAArBtB,EAAMtS,GAAqB,MAAO,CAAE6T,eAAe,EAAOC,cAAe,MAC7E,MAAMC,EAAYzB,EAAMtS,GACxBsS,EAAMtS,GAAc,CAAEQ,aAAc,GAAIwR,aAAc,GAAIC,eAAgB,IAE1E,MAAM+B,EAASD,EAAUvT,aACnBwP,EAAS+D,EAAU/B,aACnBiC,EAAcF,EAAU9B,eAE9B,IAAI4B,GAAgB,GACe,IAA/BpX,OAAO8E,KAAKyS,GAAQ5X,QAAkC,IAAlB4T,EAAO5T,UAC7CwX,EAAuB7T,8BACrBC,EAAYC,EAAaC,EAAYC,EAAa6T,EAAQhE,EAAQ1P,GAAaC,IAEjFsT,GAAgB,GAGlB,IAAIC,GAA6B,KACjC,OAAIG,EAAY7X,SACd0X,GAAarX,iBAAQ0D,GACrB8T,EAAY5U,QAAQ6U,YAClB,MAAM1E,GAAmC,GACnCT,EAAiD,QAA/BoF,KAAiBD,GAASpW,aAAKI,iBAAEmD,SACnD+S,GAAoBV,EAAmB1P,KAAK/F,IAAKA,GAAEoW,UAAU5Q,YAAcyQ,GAASpW,MAC1FoW,GAAS7S,SAAShC,QAAQiV,KACxBpE,8BAAgD4C,KAAwBwB,GAAQvB,YAAahE,EAAiBuF,GAAQrT,MAAOuO,MAG/H,MAAM+E,GAAkBrE,uCACtBkE,GAAkBtF,gBAAerS,+BAE5BsS,GACAS,IAELiE,GAAWzP,KAAKwQ,IAAKA,GAAE3T,OAASqT,GAASpW,MACzCmR,EACAmF,GAAkBhX,UAClBgX,GAAkBxW,MAClB+V,EAAeO,GAASpW,MACxByC,GACAD,GACA6O,EACAjP,EAAWgU,GAASpW,MACpBsR,GAGF0E,GAAcI,GAASpW,MAAKrB,+BAAQqX,GAAcI,GAASpW,OAAK,CAAEuD,SAAUkT,QAIzE,CAAEV,gBAAeC,gEA9Jf5B,gCAAqB/P,QAArB+P,EAAqB,YAArBA,GAAb,wDCrBO,MAAMuC,EAAwB,YAGxBC,EAAe,KAafC,EALY,kLCEnB,QAA4BxX,0CAmB9B2R,EACAC,EACAtO,EACAwO,EACA2F,EACAC,EACA3F,EACAmB,EACA/P,EACA6O,GACAvN,GACAwN,UAEAL,EAAgBlO,KAAOkO,EAAgBlO,MAAQJ,EAAUI,KACzDkO,EAAgB+F,SAAWC,gBAA6BhG,GACxD,MAAMiG,EAAqBtP,4BACzBuJ,EAAqB2F,EAAgB1F,EAAiBmB,EAAU1O,gBAAiBlB,EAAUkM,UAE7FoC,EAAgBkG,mBAAqB3U,GAAe0U,EACpDjG,EAAgBzN,8BAAgCoE,oCAC9CwJ,EAAiBH,EAAgBkG,mBAAoB5E,EAAU/R,gBAAiB+R,EAAU1O,iBAE5FoN,EAAgBmG,eAAiB5U,GAAeyO,EAAgBzN,+BAAiC6N,GAEjGJ,EAAgBoG,uBAAyBrG,EAAgBqG,wBAA0BpG,EAAgBkG,mBAGnG,MAAMG,EAAoE,QAA5D/B,GAAU,MAAVgC,OAAU,EAAVA,EAAYC,OAAOvG,EAAiBnN,GAAawN,UAAWlR,UAAI6Q,EAC9EqD,cAAkB,QAASmD,KAAKC,MAAMD,KAAKE,UAAUL,KAE9CA,mCAYPzR,EACAtC,EACAoO,EACAD,GAEA,GAAI7L,EAAOkP,WAAWC,MAAwB,CAC5C,MAAMC,EAAcpP,EAAOqP,UAAUF,aAC/B4C,EAAerU,EAAiC0R,GAMtD,GAJuC,MAAf2C,GAAwC,MAAjBjG,GACzCzN,MAAMC,QAAQyT,IAAgB1T,MAAMC,QAAQwN,WACrCiG,UAAuBjG,EAGlCD,SAAYuD,GAAetD,GACpB,EAGX,OAAO,wEClFL,QAA8BtS,wBASVwG,EAAuBlF,EAAuCrB,WACpF,MAAM2S,EAAyC,QAAlCtC,EAA4B,MAA3BhP,OAAM,EAANqK,EAA6BiH,YAAI7R,QAAI,KACnD,GAAe,MAAXO,EACF,MAAO,CAAEwC,MAAOxC,EAAsBuR,OAAQ,GAAID,QACpD,GAAsB,iBAAXtR,EAAqB,CAC9B,GAAIA,aAAkB8S,MAAQ5N,IAAWsM,WACvC,MAAO,CAAEhP,MAAO1D,KAAKoY,gBAAgBlX,EAAsBrB,GAAY4S,OAAQ,GAAID,QACrF,GAAItR,aAAkBmR,QACpB,MAAO,CAAE3O,WAAOa,EAAW6L,QAASlP,EAAqCuR,OAAQ,GAAID,QACvF,MAAMyC,EAA+B/T,EAKrC,OAJA+T,EAAUzC,KAAOA,EACZtR,EAA4BwC,OAAS0C,IAAWsM,aACnDuC,EAAUvR,MAAQ1D,KAAKoY,gBAAiBlX,EAA4BwC,MAAO7D,IAExEqB,EAA4BuR,SAC/BwC,EAAUxC,OAA4C,QAAnC4F,EAACnX,EAA4BuR,cAAM5O,eAAE3B,IAAKuQ,IAC3DA,EAAO/O,MAAQ1D,KAAKoY,gBAAgB3F,EAAO/O,MAAO7D,GAC3C4S,KAEFwC,EAIX,MAAMvR,EAA0B,CAAEA,MAAOxC,GAGzC,OAAIkF,IAAWsM,WACN,CAAEhP,MAAO1D,KAAKoY,gBAAgB1U,EAAMA,MAAO7D,GAAY4S,OAAQ,GAAID,QAErE9O,yBAScA,EAAmB7D,WACxC,GAAa,MAAT6D,EACF,OAAOA,EACF,IAAa,MAAT6H,OAAS,EAATA,EAAWoB,QAAS1P,oBAAoC,CACjE,MAAMqb,EAAO,IAAItE,KAAKtQ,GAGtB,QAAuB,iBAAVA,GAAsBA,EAAM6U,SAAS,OAASD,EAAKE,YAAc9U,GAC5E4U,EAAKG,QAAQH,EAAKE,UAAuC,IAA3BF,EAAKI,qBAGrCJ,EAAKK,gBAAgB,GACdL,EAAKM,eACgB,iBAAXlV,KAAuC,QAAfmV,EAAS,MAATtN,OAAS,EAATA,EAAWoB,YAAIhM,eAAE2U,WAAW9Y,mCACnD,QAAf0T,EAAS,MAAT3E,OAAS,EAATA,EAAWoB,YAAI9I,eAAEyR,WAAW9Y,qCACxBkH,EAAMoV,WAERpV,4ECvDL,QAAqB9D,oBAOGuH,GAC1B,IAAKA,EAAW,OAAOA,EAGvB,IAAI4R,EAAe5R,EAAQ6R,OAC3B,OAAID,EAAazD,WAAW,QAC1ByD,EAAeA,EAAa9W,QAAQ,cAAe,IAAI+W,QAezDH,EAAiBvD,WAAW6B,MAC1B4B,EAAe,GAAG7B,OAAwB6B,IACrCF,EAAiBvD,WAAW,GAAG4B,OAAwBC,QAC5D4B,EAAeA,EACNA,EAAazD,WAAW,SACjCyD,EAAeA,EAAatD,UAAU,EAAGsD,EAAaE,YAAY,KAAO,GACzEF,EAAeA,EAAa9W,QAAQ,KAAM,IAC1C8W,EAAe,GAAG7B,UAA2B6B,KAExCA,4BAQiB5R,GACxB,MAAM4R,EAAe/Y,KAAK+Y,aAAa5R,GACjC+R,EAAcH,EAAatD,UAAUyB,YAA8B6B,EAAanX,QAAQ,MAAMoX,OAGpG,OAAQG,OAFqB1C,OAAOlD,MAEbnR,SAAS8W,GAC5BA,OACA3U,8BAQsB4C,GAC1B,MAAM4R,EAAe/Y,KAAK+Y,aAAa5R,GAEvC,OAD4B,IAAIiS,SAAS,UAAUL,IAAvB,GAAuBA,yBAyBnD5R,EACAmK,EACAzR,EACA0R,EACAC,EACA7O,EACAuQ,EACAnS,EACAqD,GACA0O,GACAuG,EACArG,GACAzQ,EACAuC,EACAkM,EACAsI,SAGA,OAAQnS,EAAQ6C,cACTuJ,aACAA,QACH,MAAMK,EAAI1U,+BACLyD,GAAU,CACT4W,gBACAC,gBACAC,mBACAC,gBACAhW,cACAI,mBAEN5E,cAAOya,iBAAiB/F,EAAM,CAC5B2F,QAAS,CACP/Y,MACE,GAAI2G,EAAQf,SAAWsM,WACrB,OAAO9K,uBAAoCT,EAAQjB,UAAWrG,EAAW0R,GAE3E,GAAIpK,EAAQf,OAAOkP,WAAWC,MAAwB,CACpD,MAAMC,EAAcrO,EAAQf,OAAOqP,UAAUF,aAC7C,OAAQhE,EAAwCiE,MAItDgE,QAAS,CACPhZ,MACE,GAAI2G,EAAQf,SAAWsM,WACvB,OAAOQ,EAAkB/L,EAAQjB,aAGrCuT,WAAY,CACVjZ,QACS8G,EAAesS,4BAA4BP,EAAWQ,UAGjEH,QAAS,CACPlZ,MACE,GAAI2G,EAAQf,SAAWsM,WACvB,OAAO9K,uBAAoCT,EAAQjB,UAAWrG,EAAW0R,EAAiB8H,GAAY,KAG1G3V,MAAO,CACLlD,MACE,GAAI2G,EAAQf,SAAWsM,WACrB,OAAO/P,EAAWwE,EAAQjB,WAE5B,GAAIiB,EAAQf,SAAWsM,gBAKrB,MAJkD,CAChDoH,SAAU,GACVC,QAAS,IAIb,GAAI5S,EAAQf,OAAOkP,WAAWC,MAAwB,CACpD,MAAMC,EAAcrO,EAAQf,OAAOqP,UAAUF,aAC7C,OAAQ/D,EAAwCgE,QAMxB,CAC9B5B,OACAC,QAAS,CACPxJ,IAAGnL,+BACEiI,EAAQkD,KAAG,CACdmE,WAAawL,IACX,GAAI7S,EAAQ6C,UAAYuJ,QACtB9K,eAAQwR,KAAK,oEACN,mCAET,MAAM/Y,EAAS4D,EAAWiD,UAAUjE,SAASoW,OAAOF,GACpD,OAAc,MAAV9Y,EAAuBA,GAC3BuH,QAAQwR,KAAK,mBAAmBD,yGAEzB,uCAGXzQ,MAAOpC,EAAQoC,MACf4Q,QAAS,CACPC,KAAMrZ,EACNR,KAAuD,QAAjDuM,KAAUrG,KAAK4T,GAAKA,EAAEC,SAAWvZ,UAAgBJ,eAAE4Z,SAE3DC,MAAOxH,GACPsG,SAAU,CACRmB,UAAUla,WACR,OAAqD,QAA9CkK,EAAqC,QAArCH,IAAS7D,KAAK/F,GAAKA,EAAE4Z,SAAW/Z,UAAKI,eAAE+O,eAAO7L,WAGzD6W,KAAM,CACJC,cACMxT,EAAQ6C,UAAYuJ,SACtB9K,QAAQwR,KAAK,6HACbjJ,EAAsB+E,qBACb5O,EAAQ6C,UAAYuJ,SAC7B9K,QAAQlB,MAAM,4HAKpBiD,IAAKrD,EAAQqD,IACbpE,OAAQ,CACN+F,OAAQhF,EAAQ8C,aAChB1J,KAAM4G,EAAQf,SAAWsM,YAAwBvL,EAAQf,SAAWsM,gBAChEvL,EAAQjB,UACRiB,EAAQf,OAAOqP,UAAUtO,EAAQf,OAAO6S,YAAY,KAAO,GAC/DvM,KAAMvF,EAAQf,SAAWsM,YAAwBvL,EAAQf,SAAWsM,gBAChEvL,EAAQf,OACRe,EAAQf,OAAOqP,UAAU,EAAGtO,EAAQf,OAAO6S,YAAY,OAE7D9O,KAAMhD,EAAQgD,MAEhB2J,aAAc,CACZ8G,gBACqBrY,EAAYsY,SAAS/V,EAAWiD,UAAUkH,WAAW/M,IAAIuF,IAC5B,CAC5C6E,KAAM7E,EAAK5K,OAAO0P,KAClBC,GAAI/E,EAAK5K,OAAO4P,GAChBC,KAAM,CACJF,GAAI/E,EAAK5K,OAAO8P,KAAKF,GACrBH,KAAM7E,EAAK5K,OAAO8P,KAAKF,GACvBlM,KAAMkH,EAAK5K,OAAO8P,KAAKrJ,SAO/BwX,YAAY5U,GACH8K,EAAsB+J,iBAAiB7U,GAEhD8U,UAAUvY,GACR,MAAMgF,EAAOlF,EAAYmF,QAAQjF,GAC3BgU,EAAqB,GAC3B,UAAYvQ,EAAW+U,MAAgB/b,OAAOgc,QAAQzT,EAAK5K,OAAOsG,YAChEsT,EAAOvQ,GAAauJ,eAA8B1O,EAAiBqD,GAAiB6W,GAAa,MAEnG,OAAOxE,aAMb,2CAS6B0E,GACjC,OAAOA,EAAsBnD,KAAKC,MAAMD,KAAKE,UAAUiD,IAAwB,oCAUhDhU,EAA2BiU,EAA6BD,GACvF,GAAQhU,EAAQ6C,UACTuJ,QADSvJ,CAEZ,MAAMqR,EAAyBrb,KAAK4Z,4BAA4BuB,GAiBhE,MAhBiB,CACf,QACA,UACA,UACA,aACGC,EAAalZ,IAAIxB,GAAKA,EAAEwF,WAC3B,2BACGhH,OAAO8E,KAAKqX,GAAwBnZ,IAAIuM,GAAO,cAAcA,MAChEvM,IAAI3B,IACJ,MAAM6Z,EAAO,QAAQ7Z,IAKrB,MAJsC,CACpC6Z,OACAkB,MAAOlB,MAMXxa,oCAS8BuH,GAClC,GAAQA,EAAQ6C,UACTuJ,QA8BH,MA7BiB,CACf,YACA,aACA,eACA,aACA,gBACA,mBACA,eACA,eACA,QACA,+BACA,qBACA,iBACA,mBACA,qBACA,cACA,cACA,UACA,mBACA,mBACA,sBACArR,IAAI3B,IACJ,MAAM6Z,EAAO,WAAW7Z,IAKxB,MAJsC,CACpC6Z,OACAkB,MAAOlB,KAMXxa,2BAWqBuH,EAA2BiU,EAA6BD,GACjF,GAAQhU,EAAQ6C,UACTuJ,QAAoB,CACvB,MAAM8H,EAAyBrb,KAAK4Z,4BAA4BuB,GAE1DI,EAAYH,EAAalZ,IAAIxB,GAAK,GAAGA,EAAEwF,mBAAmBzE,KAAK,MAC/D+Z,EAAgBtc,OAAO8E,KAAKqX,GAAwBnZ,IAAIuM,GAAO,GAAGA,WAAahN,KAAK,MAM1F,MCvXO,wkQDkXOga,QACH,2BAA4BF,GACpCtZ,QAAQ,+BAAgCuZ,2DErU5C,MAAMjI,EAAkB,CAC7BmI,GAAI,KACJC,GAAI,MAKOpG,EAAwB,kBAExB7C,EAAiB,CAC5BkJ,SAAU,GAAGrG,YACbjS,KAAM,GAAGiS,QACTsG,MAAO,GAAGtG,SACVgC,SAAU,GAAGhC,YACbuG,MAAO,cACPC,QAAS,GAAGxG,WACZyG,WAAY,6FC/DP,MAAMC,EAAmB,gBCAnBC,EAAiB,CAC5BC,QAAS,UACTC,OAAQ,UCFGC,EAAqB,CAChCC,mBAAoB,qBACpBC,mBAAoB,sBCFT1b,EAAmB,CAC9B2b,UAAW,YACXC,cAAe,gBACfC,wBAAyB,0BACzBC,aAAc,eACdC,cAAe,gBACfC,aAAc,gECNT,MAAMC,EAAoB,CAC/BC,YAAa,mBACbC,mBAAoB,0BACpBC,gBAAiB,uBACjBC,wBAAyB,gCACzBC,kBAAmB,yBACnBC,cAAe,qBACfC,kCAAmC,2CACnCC,kCAAmC,2CACnCC,oBAAqB,mLCHjB,QAGJxd,YAAoByd,eAFZxd,oBAAyC,GAKjDyd,OAAOC,GACL1d,KAAKwd,KAAKG,kBAAkB,KAS1B,cAOA,WAAuBC,GACrB,UAAWC,KAAWD,EACpBE,aAAaD,GAEfD,EAAcG,OAAO,EAAGH,EAAc/e,SAVtCmf,CAAc/d,OAAOge,oBACrBC,SAASC,KAAKC,UAAUhe,IAAIH,OAAOoe,eAErC,aACEH,SAASC,KAAKC,UAAUE,OAAOre,OAAOoe,eAbxCX,EAAOa,iBAAiB,WAAYC,EAAkB,CAAEC,SAAS,IACjEf,EAAOa,iBAAiB,OAAQG,EAAc,CAAED,SAAS,IAEzDze,KAAK2e,eAAe9c,KAClB,CAAE+c,QAASlB,EAAQhR,KAAM,WAAYmS,SAAUL,GAC/C,CAAEI,QAASlB,EAAQhR,KAAM,OAAQmS,SAAUH,MAoBjDI,SACE9e,KAAKwd,KAAKG,kBAAkB,KAC1B3d,KAAK2e,eAAe7c,QAAQ,EAAG8c,UAASlS,OAAMmS,eAC5CD,EAAQG,oBAAoBrS,EAAMmS,QC5BpC,QASJ9e,YACEif,EACAC,EACQC,EACRC,EACQpX,GAFA/H,mBAEAA,iBAXFA,YAAmB,GAEnBA,gBAAa,YACbA,iBAAc,WACdA,mBAAgC,GAStCA,KAAKgf,KAAOA,EACZhf,KAAKif,MAAQA,EACbjf,KAAKyS,OAASzS,KAAKof,YAEfD,IACFnf,KAAKqf,SAAWF,GAIdF,GAASC,GACXlf,KAAKsf,iBAKTC,UACE,IAAI7b,EAAQ1D,KAAKgf,KACjB,OAAsB,MAAlBhf,KAAK+H,WAA8B,MAATrE,IAC5BA,EAAQA,EAAMzB,QAAQ,cAAejC,KAAK+H,UAAU3I,OACpDsE,EAAQA,EAAMzB,QAAQ,eAAgBjC,KAAK+H,UAAU5I,SAEvDa,KAAKyS,OAAO3Q,QAAQ,CAAC0d,EAAGC,KACtB,MAAMC,EAAe1f,KAAKif,MAAMU,eAAeH,IAAMxf,KAAKif,MAAMO,IAAMxf,KAAKif,MAAMO,GAAG9b,MAAQ1D,KAAKif,MAAMO,GAAG9b,MAAQ,GAC5Gkc,EAAU5f,KAAKqf,SAASG,EAAGE,GACjChc,EAAQA,EAAMzB,QAAQ,IAAMud,EAAI,IAAKI,KAGhClc,EAIT0b,YACE,MAAMle,EAAmB,GACzB,IAAKlB,KAAKgf,KAAQ,OAAO9d,EACzB,MAAM2e,EAAU7f,KAAKgf,KAAKc,MAAM9f,KAAK+f,YACrC,OAAIF,EACFA,EAAQ/d,QAAQ,CAAC0d,EAAGC,KAClB,MAAMO,EAAaR,EAAEvd,QAAQjC,KAAKigB,YAAa,IAC/C/e,EAAOW,KAAKme,KAGd9e,EAAOW,KAAK7B,KAAKgf,MAEZ9d,EAIDme,SAAS5Q,EAAa/K,GAC5B,OAAOA,EAIDwc,WACN,MAAMC,EAAWngB,KAAKuf,UAClBvf,KAAK0D,QAAUyc,GACjBngB,KAAKkf,YAAYiB,GAEnBngB,KAAK0D,MAAQyc,EAIPb,iBAENtf,KAAKyS,OAAO3Q,QAAQse,IAClB,IAAKpgB,KAAKif,MAAMmB,GAAU,OAC1B,MAAMC,EAAWrgB,KAAKif,MAAMmB,GAAOE,aAAa/P,UAAU7M,GAAS1D,KAAKkgB,YACxElgB,KAAKugB,cAAc1e,KAAKwe,KAI5BG,UACExgB,KAAKugB,cAAcze,QAAQgE,IAAkBA,EAAaC,4DCzFxD,QAA4BnG,qCAG9BkE,EACApB,EACA3B,EACAqD,EACAiV,iCAEA,MAAMoH,GAAevhB,iBAAQ4E,GAC7B,OAA2B,QAA3B4c,KAAgBC,mBAAWhgB,QAA3BigB,GAAgBD,YAAgB,IACA,QAAhCE,KAAgBC,wBAAgBjd,QAAhC+c,GAAgBE,iBAAqB,IACb,QAAxBC,KAAgBC,gBAAQnb,QAAxB+a,GAAgBI,SAAa,IACR,QAArBC,KAAgBC,aAAK3W,QAArBqW,GAAgBM,MAAU,IACM,QAAhCC,MAAgBC,wBAAgB1W,SAAhCkW,GAAgBQ,iBAAqB,IAChB,QAArBC,MAAgBxF,aAAKhR,SAArB+V,GAAgB/E,MAAU,IACN,QAApByF,MAAgBC,YAAIxW,SAApB6V,GAAgBW,KAAS,IACL,QAApBC,MAAgBC,YAAIC,SAApBd,GAAgBa,KAAS,IACzBhB,GAAgB/M,WAAavL,EAAsBwZ,oBAAoBjf,EAAa3B,EAAiBqD,GACrGqc,GAAgBmB,gBAA2C,QAAzBC,KAAWC,sBAAcC,WAC3DtB,GAAgBuB,aAAiC,QAAlBC,KAAWC,eAAOC,WAC1C1B,kCAGsB3c,0BAC7B,MAAM2c,GAyLV,QAAmB7gB,8BAIakE,GAC5B,IAAIse,EAAete,EACnB,OAAoC,MAAhCse,EAAaC,kBACjBve,EAASiY,QAAUqG,EAAaC,uBACzBD,EAAaC,iBACbve,IAlM+Bwe,uBAAsBpjB,iBAAM4E,IAE9C,QAApBye,KAAgBjf,YAAI3C,QAApB0gB,GAAgB/d,KAAS,IACE,QAA3B2T,KAAgBuL,mBAAW3e,QAA3Bwd,GAAgBmB,YAAgB,IACX,QAArBnI,KAAgBwB,aAAKhW,QAArBwb,GAAgBxF,MAAU,IAEF,QAAxB4G,KAAgBlL,gBAAQhN,QAAxB8W,GAAgB9J,UAAa,GACL,QAAxBmJ,KAAgB9E,gBAAQlR,QAAxB2W,GAAgBzF,UAAa,GACK,QAAlCiF,KAAgBnJ,0BAAkB7M,QAAlCwW,GAAgB3J,oBAAuB,GAChB,QAAvBqJ,KAAgBhF,eAAOhR,QAAvBsW,GAAgBtF,SAAY,GAEY,MAApC0E,GAAgBiC,mBAClBjC,GAAgBkC,UAAYlC,GAAgBiC,wBACrCjC,GAAgBiC,kBAED,QAAxBzB,KAAgB1R,gBAAQmS,QAAxBL,GAAgB9R,SAAa,IAC7B,IAAIlP,GAAQF,gBAA8BK,IAAIsD,EAAS8e,WACvD,OAAsC,QAAtCzB,MAAgBvJ,8BAAsBmK,SAAtCV,GAAgBzJ,yBAAiC,MAALvX,QAAK,EAALihB,GAAOuB,mBAC5CpC,iCAKP/O,EACA7R,EACA8R,EACAvN,EACA0e,WAGA,MAAMC,EAAqBrR,EAAoBjL,KAAKuc,GAAKA,EAAErW,KAAKrJ,OAAS+Y,yBAIzE,IAH0C,QAAtCqE,EAAkB,MAAlBK,OAAkB,EAAlBA,EAAoB5d,WAAWuM,eAAO/O,eAAEuZ,OAAO+I,KAAKC,IAA+B,IAAnBA,EAASpH,UAEhE,MAATjc,OAAS,EAAT0iB,EAAWY,eACV1T,6BAA+CkC,EAAiBvN,GAAoB,OAAO,EAGhG,UAAWgf,KAAiC,MAAjBN,IAAqB,GAC9C,GAA8C,QAA1CjC,IAAa1d,WAAWuU,0BAAkB7T,eAAEqW,OAAO+I,KAAKC,KAA+B,IAAnBA,GAASpH,OAAmB,OAAO,EAG7G,OAAO,6BAGkBpZ,EAA6B3B,EAAyBqD,SAC/E,IAAIkX,EACJ,IAEE,MAAM5O,EAAOhK,EAAY0M,SAAS3I,KAAK4c,GAAmC,gBAAvBA,EAAS1W,KAAKrJ,MAAiD,mBAAvB+f,EAAS1W,KAAKrJ,MACrGoJ,IACF4O,EAAsG,QAA9FjB,sBAAsC3N,EAAKvJ,WAAW+d,MAAOngB,EAAiBqD,UAAgBzD,eAAEmb,OAE1GR,EAAQA,GAAS5Y,EAAYY,WACtBiE,GACP+T,EAAQ5Y,EAAYY,KAEtB,OAAOgY,2BAGgB5Y,EAA6BQ,GACpD,MAAMogB,EAAQ5gB,EAAYS,WAAWvB,QAAQsB,GAC7C,OAAyC,MAArCR,EAAYS,WAAWmgB,EAAQ,MAG/BA,EADsB5gB,EAAYS,WAAWyF,UAAUqO,GAAKA,EAAE2L,YAAc3lB,mBAG5EiG,EAAU0f,YAAc3lB,eAGxBsmB,CADuBtmB,iBAAiCA,cAChDmF,SAASM,EAAYS,WAAWmgB,EAAQ,GAAGV,kDAMvDjR,EACA8F,EACA1W,EACAqD,GAEA,QAAIrD,IAAoBqD,GACnBqL,6BAA+CkC,EAAiBvN,KACjEqT,IACAhI,6BAA+CkC,EAAiB5Q,EAAiBqD,KACjFqL,6BAA+CkC,EAAiB5Q,GAA2B,gCAK/F4Q,EACA8F,EACA1W,EACAqD,GAEA,IAAIof,EACAliB,EAEJ,GAAImW,EACF+L,EAAY,0BACZliB,EAAc,WACJmO,6BAA+CkC,EAAiBvN,GAGrE,CACL,MAAMqf,EAA4BhU,6BAA+CkC,EAAiB5Q,EAAiBqD,GAC7Gsf,GAA4BjU,6BAA+CkC,EAAiB5Q,GAElG,GAAI0iB,GAA6BC,GAA2B,CAC1D,MAAM5iB,GAAa2O,sBAAwCkC,EAAiB5Q,EAAiBqD,GAC1Fuf,WAAWzhB,IAAIH,IAAaA,GAAU+Z,OACtCzY,OAAOtB,KAAcA,GAAUK,SAASrB,IAE1BD,GAAWjC,OAAS,GAE/B4kB,EACFD,EAAY,cACHE,KACTF,EAAY,iBAEdliB,EAAcN,+BAAgDF,GAAYC,KAE1EyiB,EAAY,GACZliB,EAAc,SAGhBkiB,EAAY,sBACZliB,EAAc,QAzBhBkiB,EAAY,mCACZliB,EAAc8C,EA2BhB,MAAMwf,EAAQ5jB,KAAK6jB,wBAAwBlS,EAAiB8F,EAAoB1W,EAAiBqD,GAOjG,MAN2C,CACzCof,YACAliB,cACAwiB,SAAUF,EAAME,SAChBljB,SAAUgjB,EAAMhjB,yCAMlB+Q,EACA8F,EACA1W,EACAqD,GAEA,IAAI0f,EACAljB,EAGJ,GAAK6O,6BAA+CkC,EAAiBvN,GAExDvD,GACF4W,EACTqM,EAAW,GACXljB,EAAWC,2BACF4O,6BAA+CkC,EAAiB5Q,EAAiBqD,GAAkB,CAC5G,MAAM2f,EAAmBtU,sBAAwCkC,EAAiB5Q,EAAiBqD,GAChGuf,WAAWtgB,OAAOtB,GAAaA,EAAU+Z,QAAU/a,GAElDgjB,EAAiBllB,OAAS,GAC5BilB,EAAWC,EAAiB,GAAGjI,MAC/Blb,EAAWC,qBAEXijB,EAAW,GACXljB,EAAWC,qBAEJ4O,6BAA+CkC,EAAiB5Q,IAIzE+iB,EAHyBrU,sBAAwCkC,EAAiB5Q,EAAiBqD,GAChGuf,WAAWtgB,OAAOtB,GAAaA,EAAU+Z,QAAU/a,GAE1B,GAAG+a,MAC/Blb,EAAWC,oBAEXijB,EAAW,GACXljB,EAAWC,yBAxBXijB,EAAW,GACXljB,EAAWC,6BA8Bb,MAJ+C,CAC7CijB,WACAljB,+CClNA,QAA0BhB,iBAMbmB,EAAyBqD,EAAyBuN,EAAiCqS,WAClG,IAAKrS,EAAmB,OAAOqS,EAE/B,MAAMC,EAA6BjkB,KAAKkkB,oBAAoBvS,EAAiB5Q,EAAiBqD,GAC9F,GAAI6f,EAAe,OAAOA,EAAYnI,MAEtC,MAAMqI,EAAoCnkB,KAAKkkB,oBAAoBvS,EAAiBvN,EAAiBA,GACrG,OAAI+f,EAA6BA,EAAmBrI,MAGb,QAAhC4E,EAAyB,QAAzB+B,IAAgBvI,OAAO,UAAEvZ,eAAEmb,aAAKjY,QAAI,8BAGpBugB,EAAqCC,EAAqBjgB,GACjF,IAAI6f,EAAcxU,EAAoByU,oBAAoBE,EAAqBC,EAAajgB,GAC5F,OAAmB,MAAf6f,IACFA,EAAcxU,EAAoByU,oBAAoBE,EAAqBhgB,EAAiBA,IAEvF6f,6BAGkBG,EAAqCC,EAAqBjgB,GACnF,OAAOggB,EAAoBlK,OAAOzT,KAAKyc,QAG0B3e,IAF/D2e,EAASS,WAAWld,KAAK6d,GAAKA,EAAExI,QAAUuI,GACrCC,EAAExI,QAAU,IAAIuI,KACfA,IAAgBjgB,GAA+B,MAAZkgB,EAAExI,QAAoBvX,4CAGvB6f,EAAqCC,EAAqBjgB,GACpG,QAAOggB,GAAsBA,EAAoBlK,OAAO7W,OAAOkhB,GAC7DA,EAAEZ,WAAWld,KAAK6d,GAChBA,EAAExI,QAAUuI,GACTC,EAAExI,QAAU,IAAIuI,KACfA,IAAgBjgB,GAA+B,MAAZkgB,EAAExI,QAAiBjd,OAAS,EAAIe,kCAI3CwkB,EAAqCC,EAAqBjgB,GAC1F,QAAOggB,GAAsBA,EAAoBlK,OAAO7W,OAAO6f,GAC7DA,EAASS,WAAWld,KAAK6d,GAAMA,EAAExI,QAAUuI,GACrCA,IAAgBjgB,GAA+B,MAAZkgB,EAAExI,QAAiBjd,OAAS,EAAIe,mCAI1CwkB,EAAqCC,EAAqBjgB,GAC3F,OAAOggB,EAAsBA,EAAoBlK,OAAO7W,OAAO6f,GAC7DA,EAASS,WAAWld,KAAK6d,GAAMA,EAAExI,QAAUuI,GACrCA,IAAgBjgB,GAA+B,MAAZkgB,EAAExI,QAAiBjd,OAAS,iDAI1BulB,EAAqCC,EAAqBjgB,SACvG,OAAOggB,EAGiE,QAH3C/J,IAAoBH,OAAO7W,OAAO6f,GAC7DA,EAASS,WAAWld,KAAK6d,GAAMA,EAAExI,QAAUuI,GACrCA,IAAgBjgB,GAA+B,MAAZkgB,EAAExI,QAC1CzY,OAAOmhB,GAAgB,IAAXA,EAAE1I,OAA0B,MAAX0I,EAAE1I,OAA4BvX,MAAXigB,EAAE1I,cAAmBnb,eAAE9B,OAAS,oCAGnDulB,EAAqCC,GACrE,QAAOD,GAAsBA,EAAoBlK,OAAO7W,OAAO6f,GAC7DA,EAASS,WAAWld,KAAK6d,GAAKA,EAAExI,QAAU,IAAIuI,MAAgBxlB,OAAS,EAAIe,kCAG7CwkB,EAAqChgB,GACrE,QAAOggB,GAAsBA,EAAoBlK,OAAO7W,OAAO6f,GAC7DA,EAASS,WAAWld,KAAK6d,GAAKA,EAAExI,QAAU1X,GAA+B,MAAZkgB,EAAExI,QAAgBjd,OAAS,EAAIe,uBAK9F6kB,EACAC,EACAxhB,GAEA,MAAMyhB,EAAqC,GAC3C,GAA0C,IAAtCzlB,OAAO8E,KAAKygB,GAAe5lB,OAAc,CAC3C,MAAM+lB,EAAa1lB,iBAAwBgE,GAC3CyhB,SAAcD,GAAgBE,EACvBD,EAGT,UAAWlW,KAAOvP,OAAO8E,KAAKygB,GAC5B,GAAIhW,IAAQiW,EAAc,CACxB,MAAME,EAAa1lB,iBAAwBgE,GAC3CyhB,EAAclW,GAAOmW,MAChB,CACL,MAAMA,EAAa1lB,iBAAwBulB,EAAchW,IACzDkW,EAAclW,GAAOmW,EAIzB,GAAmC,MAA/BH,EAAcC,GAAuB,CACvC,MAAME,EAAa1lB,iBAAwBgE,GAC3CyhB,EAAcD,GAAgBE,EAEhC,OAAOD,gCAKPE,EACAC,EACAT,EACAjgB,GAGA,MAAM2gB,EAAqC,GAC3C7lB,cAAO8E,KAAK6gB,GAAe/iB,QAAQ4iB,IACjC,MAAMM,EAAeF,EAAaJ,GAGlC,QAAqBngB,IAAjBygB,EAKF,GAJ+BhlB,KAAKilB,qCAClCJ,EAAcH,GAAeL,EAAajgB,GAGhB,CAC1B,MAAM8gB,EAAShmB,+BACV2lB,EAAcH,IAAa,CAAExK,OAAQ2K,EAAcH,GAAcxK,OAAOhY,IAAIghB,IAC7CA,GAASS,WAAWld,KAAK6d,IAAKA,GAAExI,QAAUuI,GACrEC,GAAExI,QAAU,IAAIuI,KACfA,IAAgBjgB,GAA+B,MAAZkgB,GAAExI,OAExC5c,+BACIgkB,IAAQ,CACXpH,MAAOkJ,IAEP9B,MAIR6B,EAAcL,GAAgBQ,MACzB,EACLrQ,OAAkB,kCAAmCmQ,GACrD,MAAMG,EAAcC,WAAgBJ,EAAc,CAACK,WAAoBhB,KACjEiB,GAAYpmB,+BACb2lB,EAAcH,IAAa,CAC9BxK,OAAQ,IAAI2K,EAAcH,GAAcxK,OAAQiL,KAElDJ,EAAcL,GAAgBY,OAE3B,CACL,MAAMV,EAAa1lB,iBAAwB2lB,EAAcH,IACzDK,EAAcL,GAAgBE,KAG3BG,8BAKPF,EACAH,EACAa,EACAC,EACAphB,EACAqhB,GAGA,IAAIV,EAAqC,GACrCW,EAAmBF,EAEnBC,IACFC,EAAmB,IAAIF,KAGzB,MAAMtiB,EAAShE,+BACV2lB,EAAcH,IAAa,CAAExK,OAAQ2K,EAAcH,GAAcxK,OAAOhY,IAAIghB,IAC7CA,GAASS,WAAWld,KAAK6d,IAAKA,GAAExI,QAAU0J,GACrElB,GAAExI,QAAU,IAAI0J,KACfA,IAAwBphB,GAA+B,MAAZkgB,GAAExI,OAGhD5c,+BACIgkB,IAAQ,CAEXpH,MAAOyJ,EAEP5B,WAAYT,GAASS,WAAWzhB,IAAIH,IACGA,GAAU+Z,QAAU0J,GACpDzjB,GAAU+Z,QAAU,IAAI0J,KACvBA,IAAwBphB,GAAuC,MAApBrC,GAAU+Z,MACvD,CAAEA,MAAO4J,GACT3jB,MAINmhB,MAIR6B,SAAgB/kB,KAAK2lB,gBAAgBd,EAAeH,EAAcxhB,GAC3D6hB,2BAIPF,EACAe,EACAlB,EACAmB,GAGA,IAAId,EAAqC,GACzC,MAAM7hB,EACkC,IAAtChE,OAAO8E,KAAK6gB,GAAehmB,QACrBgmB,EAAcH,GAKjBxlB,+BAEI2lB,EAAcH,IAAa,CAAExK,OAAQ,IAAI2K,EAAcH,GAAcxK,OAAQ0L,GAAiBjZ,KAAMkZ,IAPxE3mB,+BAG5B2lB,EAAcH,IAAa,CAAExK,OAAQ,CAAC0L,GAAiBjZ,KAAMkZ,IAMtEd,SAAgB/kB,KAAK2lB,gBAAgBd,EAAeH,EAAcxhB,GAC3D6hB,+BAKPF,EACAH,EACAoB,EACAC,EACA3hB,EACAqhB,GAGA,IAAIV,EAAqC,GACrCW,EAAmBI,EAEnBL,IACFC,EAAmB,IAAII,KAGzB,MAAM5iB,EAAShE,+BACV2lB,EAAcH,IAAa,CAAExK,OAAQ2K,EAAcH,GAAcxK,OAAOhY,IAAIghB,IAC7CA,GAASS,WAAWld,KAAK6d,IAAKA,GAAExI,QAAUiK,GACpEA,IAA2B3hB,GAA+B,MAAZkgB,GAAExI,OAEnD5c,+BACIgkB,IAAQ,CAEXS,WAAYT,GAASS,WAAWqC,OAAO,CAAElK,MAAO4J,MAEhDxC,MAIR6B,SAAgB/kB,KAAK2lB,gBAAgBd,EAAeH,EAAcxhB,GAC3D6hB,kCAIuB7O,EAAiCwO,EAAsBZ,GACrF,MAAMW,EAAgBvO,EAChB+P,EAAkB,CAACnC,EAAU,IAAIA,KAEjCpgB,EAAQ+gB,EAAcC,GAAcxK,OAAOzT,KAAKyc,GAC5BA,EAASS,WAAWV,KAAKlhB,IAAakkB,EAAgB7jB,SAASL,GAAU+Z,SAKnG,IAAKpY,EAEH,OADoBxE,iBAA6BulB,GAInD,IAAIa,EACJ,OAAI5hB,EAAMigB,WAAW9kB,OAAS,EAE5BymB,EAAYpmB,+BACPulB,EAAcC,IAAa,CAC9BxK,OAAQuK,EAAcC,GAAcxK,OAAOhY,IAAIghB,GACrBA,EAASS,WAAWV,KAAKlhB,IAAakkB,EAAgB7jB,SAASL,GAAU+Z,QAGnF5c,+BACTgkB,GAAQ,CACXS,WAAYT,EAASS,WAAWtgB,OAAOtB,KAAckkB,EAAgB7jB,SAASL,GAAU+Z,UAJ3DoH,KASE,IAA5Bxf,EAAMigB,WAAW9kB,SAE1BymB,EAAYpmB,+BACPulB,EAAcC,IAAa,CAC9BxK,OAAQuK,EAAcC,GAAcxK,OAAO7W,OAAO6f,IACxBA,EAASS,WAAWV,KAAKlhB,IAAakkB,EAAgB7jB,SAASL,GAAU+Z,YAMjF9b,KAAK2lB,gBAAgBlB,EAAeC,EAAcY,uBAoBtDY,EAA2BnlB,EAAyBqD,EAAyB+hB,SAC/F,GAAiB,MAAbD,EAAqB,OAEzB,IAAIE,EAAiB,CAACrlB,EAAiB,IAAIA,KACvCslB,EAAYrmB,KAAKsmB,uBAAuBJ,EAAWE,GAKvD,YAJkB7hB,IAAd8hB,IAEJD,EAAiB,CAAC,KAClBC,EAAYrmB,KAAKsmB,uBAAuBJ,EAAWE,QACjC7hB,IAAd8hB,GAAkCA,EAElCF,IAASjK,aAEbkK,EAAiB,CAAChiB,EAAiB,IAAIA,KACvCiiB,EAAYrmB,KAAKsmB,uBAAuBJ,EAAWE,QACjC7hB,IAAd8hB,IAEJA,EAA+B,QAAnB5D,IAAUvI,OAAO,UAAEvZ,eAAEmb,OAC1BuK,QAPP,EAOOA,8BAG6BH,EAA2BplB,SAI/D,OADC,QAFamW,IAAUiD,OAAOzT,KAC7Byc,KAAcA,EAASS,WAAWld,KAAK1E,GAAajB,EAAWsB,SAASL,EAAU+Z,gBACnFnb,eAAEmb,OC5VD,QACJ/b,YAAmBgB,EAAgCqD,GAAhCpE,uBAAgCA,uBAKnDumB,aAAgB5U,EAAqCqS,GACnD,OAAOvU,YAA8BzP,KAAKe,gBAAiBf,KAAKoE,gBAAiBuN,EAAiBqS,GAG7FwC,QAAWpD,GAChB,OAAOpjB,KAAKmP,WAAc,CAACiU,IAG7BjU,WAAcsX,GACZ,GAAqB,MAAjBA,EAAyB,MAAO,GAEpC,MAAMC,EAA8B,GAEpC,UAAWjf,KAAQgf,EACjB,GAAqB,SAAjBhf,EAAKkF,KAAKF,GAEd,UAAYlM,EAAMkW,KAAWvX,OAAOgc,QAAQzT,EAAKtE,YAAa,CAC5D,MAAMO,EAAQ1D,KAAKumB,aAAa9P,EAAQ,MACxCiQ,EAAOnmB,GAAQmD,EAKnB,UAAW+D,KAAQgf,EACjB,GAAqB,SAAjBhf,EAAKkF,KAAKF,GAEd,UAAYlM,EAAMkW,KAAWvX,OAAOgc,QAAQzT,EAAKtE,YAAa,CAC5D,MAAMO,EAAQ1D,KAAKumB,aAAa9P,EAAQ,MAGlCkQ,EAAoB,MAATjjB,GAA2B,KAAVA,EADH,MAAhBgjB,EAAOnmB,IAERomB,IAEdD,EAAOnmB,GAAQmD,GAInB,OAAOgjB,GC/CJ,IAAME,EAAb,MAAM,QAAsBhnB,oBA4BNinB,GAClB,OAAOA,EAASpR,UAAUoR,EAAS5N,YAAY,KAAO,GAAG6N,wCAGvCD,GAClB,MAAME,EAAM/mB,KAAKgnB,aAAaH,GAC9B,OAAO7mB,KAAKinB,cAAcF,IAAQ/mB,KAAKknB,iBAAiBH,IAAQ/mB,KAAKmnB,+BAGpDN,GACjB,OAA0D,MAAnD7mB,KAAKinB,cAAcjnB,KAAKgnB,aAAaH,IAAcjnB,eAG7CinB,GACb,OAAO7mB,KAAKonB,aAAaC,KAAKR,uBAI9B,MAAO,oGA7CMD,qBAAc,OACdA,mBAA2C,CACxDU,IAAK,YACLC,KAAM,YACNC,IAAK,aACLC,KAAM,aACNC,IAAK,kBACLC,KAAM,kBACNC,IAAK,WACLC,IAAK,aACLC,IAAK,aACLC,IAAK,aACLC,KAAM,aACNC,IAAK,aACLC,IAAK,aACLC,IAAK,eACLC,IAAK,eACLC,IAAK,YACLC,KAAM,YACNC,IAAK,YACLC,IAAK,YACLC,IAAK,aAEQ7B,gBAAwC,CACrD8B,IAAK,UAzBI9B,GAAb,GCIM,SAAqBhnB,oBAEFsQ,EAAMyY,GAC3B,GAAS,MAALzY,GAAkB,MAALyY,EAAa,OAAOzY,IAAMyY,EAE3C,MAAMC,EAAO1Y,EACP2Y,EAAOF,EAEPG,EAAQ5pB,OAAO8E,KAAK4kB,GACpBG,EAAQ7pB,OAAO8E,KAAK6kB,GAC1B,OAAIC,EAAMjqB,SAAWkqB,EAAMlqB,QAEbiqB,EAAM/U,MAAMiV,KACnBH,EAAKlJ,eAAeqJ,IAElBJ,EAAKI,KAAUH,EAAKG,IAFcppB,mBAQvBsQ,EAAQyY,GAC5B,OAAS,MAALzY,GAAkB,MAALyY,EAAoBzY,IAAMyY,EAEvCzY,EAAErR,SAAW8pB,EAAE9pB,QAELqR,EAAE6D,MAAM,CAACtM,EAAM6b,IACpBpT,EAAEoT,KAAWqF,EAAErF,0BAOJ2F,EAAuB/D,GAC3C,MAAMgE,EAAsB,GAC5B,UAAWza,KAAOvP,OAAO8E,KAAKkhB,GAAY,CACxC,MAAM1hB,EAAW0hB,EAAUzW,GAEvBzO,KAAKmpB,mBAAmB3lB,EADXylB,EAAUxa,MAG3Bya,EAAQza,GAAOjL,GAEjB,OAAuC,IAAhCtE,OAAO8E,KAAKklB,GAASrqB,YAAe0F,EAAY2kB,uBAGjCzhB,EAAS2hB,GAC/B,MAAM9F,EAAQ8F,EAAMxnB,QAAQ6F,IACd,IAAV6b,EACF8F,EAAMvnB,KAAK4F,GAEX2hB,EAAMrL,OAAOuF,EAAO,6BAKE+F,GACpBA,EAAQC,UAEZD,EAAQE,gBACRF,EAAQG,mDAIeH,EAA0B7lB,GAC5C6lB,EAAQC,SACXD,EAAQE,iBAELF,EAAQI,QAAUzpB,KAAKmpB,mBAAmBE,EAAQ3lB,MAAOF,IAC5D6lB,EAAQK,cAEVL,EAAQM,WAAWnmB,6BAGa0M,EAAeyY,GAG/C,SAFIzY,IAAMyY,GACO,iBAANzY,GAA+B,iBAANyY,GAAkBiB,MAAM1Z,IAAM0Z,MAAMjB,IACpElkB,MAAMC,QAAQwL,IAAMzL,MAAMC,QAAQikB,IAAM3oB,KAAK6pB,YAAY3Z,EAAGyY,0BAK5CU,EAA0BS,GAC1CT,EAAQU,WAAaD,IAErBA,EACFT,EAAQS,UAERT,EAAQW,0BAKIC,GACd,IACE,OAAOjS,KAAKC,MAAMgS,SAClB1H,qBC3FA,QAAwB3iB,wBAEJ6H,WACtB,OAA2B,QAApBwP,EAAgB,QAAhBsL,IAAK1lB,OAAO8P,YAAIhM,eAAE8L,UAAE5I,QAAK4D,EAAKyiB,OAA6BC,yCAG3CjU,EAAuCkU,GAC9D,OAAOlU,EAAWhU,IAAIgB,IACpB,MAAMmnB,EAAsBrqB,KAAKsqB,mBAAmBpnB,EAAWknB,GAK/D,MAJqC,CACnC7pB,KAAM2C,EAAUI,KAChBzD,UAAWwqB,EAAoBxqB,uCAMXqD,EAAoCknB,GAC5D,MAAMvqB,EAAYuqB,EAAW3jB,KAAKgZ,GAAKA,EAAE9S,OAASzJ,EAAU0f,WAK5D,MAJwC,CACtC/iB,UAAWqD,EAAU0f,UACrB2H,aAAY1qB,KAAcA,EAAU2qB,eAAgB5qB,mBAKrCkE,EAAyBumB,SAC1C,MAAMxqB,EAAYwqB,EAAoBxqB,UAChC0qB,EAAaF,EAAoBE,WAEvC,GAAI1qB,IAAc5C,iBAAmC,MAAO,GAG5D,GAAI4C,IAAc5C,iBAAmC,MAAO,CAAC6f,yBAG7D,MAAM2N,EAA+B,CAAC3N,oBAQtC,OALsBjd,IAAc5C,mBAC9B4C,IAAc5C,yBACd4C,IAAc5C,iBACd4C,IAAc5C,2BAGlBwtB,EAAS5oB,KAAKib,2BACkC,QAAxB7F,IAASyT,uBAAe/pB,UACzBd,IAAc5C,0BACnCwtB,EAAS5oB,KAAKib,+BAIdyN,GACFE,EAAS5oB,KACPib,qBACAA,yBACAA,uBACAA,kBAIG2N,2BAKP/F,EACA7kB,EACAiE,EACAuV,EACAsR,WAEA,GAAIA,QAAuDpmB,KAArB,QAAnBmc,EAAU,MAAVrG,OAAU,EAAVA,EAAYR,eAAOlZ,eAAG+jB,IAA+B,OAExE,IAAIV,EAAelgB,EAAS8mB,aAM5B,QAJuB,QAAnB/J,EAAU,MAAVxG,OAAU,EAAVA,EAAYR,eAAOhW,eAAG6gB,MACxBV,EAAe3K,EAAWQ,QAAQ6K,IAGnB,MAAT7kB,OAAS,EAAT0iB,EAAW5V,WACZ1P,mBACH,OAAuB,MAAhB+mB,GAC4B,SAA/BA,EAAa6G,cACb,KACD5tB,oBACH,OAAuB,MAAhB+mB,GAAyC,KAAjBA,EACI,SAA/BA,EAAa6G,cACb,UACD5tB,oBACH,OAAuB,MAAhB+mB,GAAyC,KAAjBA,EAC3B,IAAIhQ,KAAKgQ,GAAcpL,SACvB,UACD3b,uBACAA,mBACH,OAAuB,MAAhB+mB,GAAyC,KAAjBA,EAC3B4F,MAAO7sB,OAAOinB,IAAwC,KAAvBjnB,OAAOinB,GACtC,UACD/mB,uBACAA,qBACAA,wBACH,GAAoB,MAAhB+mB,GAAyC,KAAjBA,EAAuB,MAAO,GAM1D,GAJIA,EAAa5hB,SAAS,OACxB4hB,EAAeA,EAAa/hB,QAAQ,UAAW,MAG7C+hB,EAAa5hB,SAAS,OAAS4hB,EAAa5hB,SAAS,KAAM,CAC7D,MAAM0oB,EAAQ9G,EAAa+G,MAAM,KAAK7oB,IAAIoK,IAAQA,GAAK0M,QACvDgL,EAAehM,KAAKE,UAAU4S,GAEhC,OAAO9G,EAAa1O,WAAW,KAC3B0C,KAAKC,MAAM+L,GACX,CAACA,EAAa/hB,QAAQ,KAAM,aAEhC,OAAmB,MAAZ+hB,IAAgB,wBAQTtgB,EAAmBoB,GACrC,MAAMkmB,EAAmBvmB,MAAMC,QAAQhB,IAA2B,IAAjBA,EAAM7E,QAAgBiG,EAAWiD,UAAUkjB,WAC5F,YAAiB1mB,IAAVb,GAAuBsnB,sLCtH1Bva,wEADFA,SACEA,iCACFA,6DADiBA,qCAAmC,oEAFtDA,cACEA,iCAGFA,mCAHiCA,yDAM/BA,cAA6C,WAEzCA,kBACAA,eAAKA,sBAAUA,uCASXA,mBAA8DA,SAA4BA,wCAAlEA,sBAAsCA,8DAI9DA,uBAAsEA,0BAAcA,gCACpFA,uBAAwEA,kBAAMA,kDAXtFA,cAA6C,WAEzCA,kBACAA,kBAA2EA,2DAASya,EAATC,OAASD,YAClFza,kBACEA,uBACAA,0BACAA,mBAA4CA,SAAeA,UAE7DA,kBACEA,+BACAA,+BACFA,qDATsBA,0DAGyBA,8BACrBA,+BAAoBA,uBAGGA,oCACAA,iEAlBzDA,cACEA,uBAMAA,wBAgBFA,mCAtBOA,mDAMgBA,iEAsBnBA,2DACAA,uBAA+DA,8DAAS2a,EAATD,OAASC,eACtE3a,SACFA,gDADEA,qHAQEA,uBAAsEA,0BAAcA,+BACpFA,uBAAwEA,kBAAMA,8BAOhFA,kCADFA,SACEA,gCACFA,6DADiBA,qCAAmC,mEAFtDA,cACEA,gCAGFA,mCAHkCA,8EAnBpCA,cAAI,WAEAA,wBACAA,8BAGAA,kBAA2EA,sDAAS4a,EAATF,OAASE,YAClF5a,kBACEA,uBACAA,gBAAMA,SAAeA,UAEvBA,kBACEA,8BACAA,8BACFA,YAIJA,uBAKFA,0CArB4BA,6CACOA,2CAGPA,0DAGdA,uBAGyCA,oCACAA,sCAKhDA,+GAjEXA,SAEEA,gBACEA,8BACFA,QAEAA,iBAA6B,qBAA7BA,CAA6B,eAEdA,kBAAMA,QACjBA,mBAA4CA,0DAAiB6a,eAA7D7a,YAIJA,iBACEA,wBAMAA,wBAwBFA,QAEAA,4CA0BFA,+BArEIA,uEAMkBA,uCAKbA,qCAMAA,qCCLF,IAAM8a,GAAb,MAAM,QASJxrB,YACmCyrB,EACzBC,EACAC,EACAvmB,GAHyBnF,kBACzBA,iBACAA,oBACAA,iBAGV2rB,WACE3rB,KAAK4rB,SAAW5rB,KAAK6rB,sBACrB7rB,KAAK8rB,QAAU,GACf9rB,KAAK+rB,YAAc,IAAI/lB,IAAgB,IACvChG,KAAKgsB,aAAe,IAAIhmB,IAAgB,IACxChG,KAAKisB,MAAQ,IAAIjmB,IAAgB,IAEjC,MAAMkmB,KAAkB5b,KAAc,CAACtQ,KAAK+rB,YAAa/rB,KAAKgsB,eAAeplB,MAC3E1E,OAAI,EAAEiqB,EAAYC,KAChBA,EAAY/oB,OAAOoE,GAAQA,EAAKlH,KAAKumB,oBAAoB1kB,SAAS+pB,EAAWrF,wBAGjF9mB,KAAKqsB,eAAgB/b,OAAc,CAACtQ,KAAK+rB,YAAaG,EAAiBlsB,KAAKisB,QAAQrlB,QAClF1E,KAAI,EAAEiqB,EAAYG,EAAgBC,MACa,CAC3CJ,aACAG,iBACAC,WAMNvsB,KAAKwsB,aAGPnnB,cACErF,KAAK+rB,YAAYvmB,WACjBxF,KAAKgsB,aAAaxmB,WAClBxF,KAAKisB,MAAMzmB,WAGbinB,UAAUN,GACRnsB,KAAK+rB,YAAY9gB,KAAKkhB,GAGxBO,OAAOC,GAEU,MAAXA,EAAKngB,OACJmgB,EAAKC,cAAgBD,EAAKE,aAClB5sB,OAAO6sB,QAAQ9sB,KAAKmF,UAAU4K,QAAQ,2DAGnD/P,KAAK+sB,YAAYJ,EAAKngB,KAGxBwgB,OAAOre,GACLhK,iBAA6BgK,EAAQ3O,KAAK8rB,SAGpCiB,YAAYpe,GAClB,GAAc,MAAVA,EAEF,YADA3O,KAAKyrB,UAAUwB,QAIjB,MAAMN,EAAO3sB,KAAKgsB,aAAatoB,MAAM+C,KAAKgZ,GAAKA,EAAEjT,KAAOmC,GAClDzN,EAA2B,CAC/BsL,GAAImgB,EAAKngB,GAAGsM,WACZvY,KAAMosB,EAAKpsB,MAEbP,KAAKyrB,UAAUwB,MAAM/rB,GAGfsrB,aACN,MACMU,EAAS,UAEfltB,KAAK0rB,aAAayB,qBAAqB,gBAAYD,KAAU,EAD9C,qBAC4D,MAAM3c,UAAU,CACzFtF,KAAO2I,IACL,IAAKA,EAEH,YADAnL,QAAQlB,MAAMvH,KAAKmF,UAAU4K,QAAQ,kCAGvC,IAAK6D,EAAKsZ,GAER,YADAzkB,QAAQlB,MAAMvH,KAAKmF,UAAU4K,QAAQ,0CAA4C,IAAMmd,GAGzF,MAAME,EAAQxZ,EAAKsZ,GACbd,EC5GR,WAA0BgB,GAC9B,OAAKA,EAESA,EAAMlrB,IAAIyqB,IACtB,IAAI7tB,EAAO6tB,EAAKU,KAAKrU,OAAO/W,QAAQ,MAAO,KAAKA,QAAQ,QAAS,KACjE,OAAInD,EAAKwW,WAAW,OAClBxW,EAAOA,EAAK2W,UAAU,IAExB3W,EAAOA,EAAKisB,MAAM,KAAKprB,MAAM,GAAG,GAAI8B,KAAK,OAEZ,CAC3B+K,GAAImgB,EAAKlgB,GACTlM,KAAMosB,EAAKrpB,KACXxE,OACA+tB,UAAWF,EAAK5Q,QAChB6Q,YAAaD,EAAKW,aAdD,GD2GKC,CAAgBH,GACpCptB,KAAKgsB,aAAa/gB,KAAKmhB,GACvB,MAAMG,ECvFR,WAAwBa,GAC5B,IAAKA,EAAS,MAAO,GAErB,MAAM/tB,EAAQ+tB,EAAMlrB,IAAIyqB,IACK,CACzBa,SAAU,GACVhhB,GAAImgB,EAAKlgB,GACTlM,KAAMosB,EAAKrpB,KACXmqB,SAAUd,EAAKe,SACfb,UAAWF,EAAK5Q,QAChB6Q,YAAaD,EAAKW,aAKhBf,EAAuB,GAC7B,UAAW9kB,KAAQpI,EAAO,CACxB,IAAsB,IAAlBoI,EAAKgmB,SAAiB,CACxBlB,EAAK1qB,KAAK4F,GACV,SAGF,MAAMkmB,EAAStuB,EAAMoH,KAAKgZ,GAAKA,EAAEjT,KAAO/E,EAAKgmB,UACxCE,EAGHA,EAAOH,SAAS3rB,KAAK4F,GAFrB8kB,EAAK1qB,KAAK4F,GAMd,OAAO8kB,EDyDYqB,CAAcR,GAC3BptB,KAAKisB,MAAMhhB,KAAKshB,IAElBhlB,MAAQA,IACNkB,QAAQlB,MAAMA,GACdkB,QAAQlB,MAAM,GAAGvH,KAAKmF,UAAU4K,QAAQ,sCAAsCxI,EAAMqM,WAKlFiY,sBACN,MAAMgC,EAAS,QACf,IAAIC,EAAyB9tB,KAAKwrB,WAAWuC,MAAMC,SAAShuB,KAAKwrB,WAAWyC,OAAO/nB,WAAWxC,MAC9F,GAA0B,iBAAfoqB,IAEXA,EAAaA,EAAW9U,OAAO8N,oBAC1BgH,EAAWxY,WAAWuY,IAE3B,IAEE,OADW7f,SAAS8f,EAAW/C,MAAM8C,GAAQ,GAAI,UAEjDxT,GACA,sDAvHOkR,GAAmB9a,MAUpByd,MAAezd,8DAVd8a,EAAmB4C,4vBDfhC1d,yDAAeA,s+DCeF8a,GAAb,GENM,SAAiB3rB,YAEnBquB,EACAF,EACAK,EACAC,EACAC,EACA9d,GAMkB4d,EAAOG,KAAKhD,GAAqB,CACjDiD,WAAW,EACX5a,KANuC,CACvCqa,SACAF,SAKAM,mBACAI,OAAQ,MACRC,MAAO,UAGCC,cAAc/nB,MAAKgoB,QAAK,IAAIre,UAAW7M,IAC/C8M,EAAS9M,KAGX4qB,EAAkBO,gBClChB,SAAqBjvB,uBAEMkvB,EAAmBC,GAEhD,IAAKD,EAAa,OAAOA,EAEzB,KAAOA,EAAUrZ,UAAU,EAAG,KAAOsZ,GACnCD,EAAYA,EAAUrZ,UAAU,GAElC,OAAOqZ,uBAGoBA,EAAmBC,GAE9C,IAAKD,EAAa,OAAOA,EAEzB,KAAOA,EAAUrZ,UAAUqZ,EAAUjwB,OAAS,EAAGiwB,EAAUjwB,UAAYkwB,GACrED,EAAYA,EAAUrZ,UAAU,EAAGqZ,EAAUjwB,OAAS,GAExD,OAAOiwB,sBAGmBA,GAE1B,IAAKA,EAAa,OAAOA,EAEzB,MAAME,EAAW,IAMjB,OAAOF,EACJ7sB,QANe,mBAMI+sB,GACnB/sB,QANe,wBAMI+sB,GACnB/sB,QANgB,QAMI+sB,GACpB/sB,QANuB,gDAMI+sB,GAC3B/sB,QANuB,UAMI+sB,uBAIZF,GAElB,OAAKA,IAGLA,EAAY9uB,KAAKivB,gBAAgBH,EAAW,KAG5CA,EAAY9uB,KAAKkvB,cAAcJ,EAAW,KAG1CA,EAAY9uB,KAAKivB,gBAAgBH,EAAW,MAG5CA,EAAY9uB,KAAKkvB,cAAcJ,EAAW,MAG9B9uB,KAAKmvB,aAAaL,IAEvBA,oBAIWA,GAElB,OAAKA,EAME9uB,KAAKovB,aAAaN,GAAW7sB,QADlB,MADE,KAJK6sB,kBC7DtB,IAAMO,GAAb,MAAM,QAAgCzvB,oBAgChB8a,WAClB,MAAM4U,EAAiC,GACvC,UAAYC,EAAYlG,KAAYnqB,OAAOgc,QAAQR,EAAKsT,UAGtD,GAFArpB,sBAAkC0kB,GAE7BA,EAAQmG,QAEb,UAAWC,KAAYvwB,OAAO8E,KAAKqlB,EAAQiG,QAEzC,GADAA,EAAOC,GAA+C,QAAjClV,UAAKqV,oBAAmBD,UAAS5rB,2BAAGU,GACrD+qB,EAAOC,GAAe,MAG9B,OAAOD,yBAIcjG,EAA0B4E,iBAC/C,IAAI1mB,EAAQ,GAEZ,IADK8hB,EAAQmG,UACRnG,EAAQI,QAAUJ,EAAQC,QAAW,OAAO/hB,EAEjD,UAAWkoB,MAAYvwB,OAAO8E,KAAKqlB,EAAQiG,QAMzC,GAJE/nB,EADe,iBAAjB4Z,GAC0C,QAAhC9G,IAAQiV,OAAOK,sBAAiBhvB,QAAqC,QAAjC+f,UAAKgP,oBAAmBD,WAAS5pB,sBAAGooB,GAEvC,QAAjClN,UAAK2O,oBAAmBD,WAAS/kB,sBAAGujB,GAE1C1mB,EAAS,MAGf,OAAOA,2BAGgB8hB,SACvB,IAAIuG,EAAU,GAEd,GAD+B,MAA3BvG,EAAQwG,UAAUnsB,QACjB2lB,EAAQI,QAAUJ,EAAQC,QAAW,OAAOsG,EAEjD,UAAWE,KAAc5wB,OAAO8E,KAAKqlB,EAAQwG,UAAUnsB,OAMrD,GAJEksB,EADiB,mBAAnBnN,GACqD,QAAzCxL,IAAQ4Y,UAAUnsB,MAAMisB,sBAAiBhvB,QAEzCX,KAAK+vB,gBAAgBD,GAE7BF,EAAW,MAEjB,OAAOA,GA5EMP,4BAAyE,CACtFW,SAAW/B,GACFA,EAAS,6BAA+B,kCAEjDgC,IAAMhC,GACGA,EAAS,wBAA0B,6BAE5CiC,IAAMjC,GACGA,EAAS,wBAA0B,6BAE5CkC,QAAUlC,GACDA,EAAS,4BAA8B,6BAEhDmC,SAAWnC,GACFA,EAAS,6BAA+B,6BAEjDoC,UAAYpC,GACHA,EAAS,8BAAgC,6BAElDqC,aAAerC,GACG,8BAILoB,kBAA0C,CACvDkB,YAAa,gCACbC,eAAgB,8BA5BPnB,GAAb,kBCKM,SAAwBzvB,kBAEVkE,GAEhB,OAAO9D,KAAKywB,iBAAiB3sB,IAAoBA,EAASyT,8BAGvCrR,EAAmBrG,EAAmBmR,GAEzD,MAAM0f,EAA4B,CAChC7wB,IAAc5C,qBACV+C,KAAKgwB,SAAS9pB,EAAW8K,GACzBhR,KAAK2wB,aAAazqB,EAAW8K,GACjChR,KAAKmwB,QAAQjqB,EAAW8K,GACxBhR,KAAKowB,SAASlqB,EAAW8K,GACzBhR,KAAKkwB,IAAIhqB,EAAW8K,GACpBhR,KAAKiwB,IAAI/pB,EAAW8K,GACpBhR,KAAK4wB,gBAAgB1qB,EAAW8K,IAElC,OAAInR,IAAc5C,sBAChByzB,EAAW7uB,KAAK7B,KAAK6wB,UAAU3qB,EAAW8K,IAErC0f,uBAOYrH,GACM,MAArBA,EAAQwG,YACVxG,EAAQwG,UAAY,IAAI7pB,IAAkC,uBAItCE,EAAmB8K,GACzC,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMvlB,EAAWkN,EAAsB+J,iBAAiB7U,GAExD,OADIlG,KAAKywB,iBAAiB3sB,KACrBA,EAASyT,SAAmB,KAE1BwZ,eAAoB1H,wBAIHnjB,EAAmB8K,GAC7C,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMvlB,EAAWkN,EAAsB+J,iBAAiB7U,GAExD,OADIlG,KAAKywB,iBAAiB3sB,KACrBA,EAASyT,SAAmB,KAEa,IAAtC8R,EAAwB2H,UAAkB,CAAEhB,UAAU,GAAS,qBAIpD9pB,EAAmB8K,GACxC,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMvlB,EAAWkN,EAAsB+J,iBAAiB7U,GAExD,OADIlG,KAAKywB,iBAAiB3sB,KACrBA,EAASmtB,0BAAoC,KAE3CF,cAAmBjtB,EAASmtB,0BAA5BF,CAAuD1H,oBAI1CnjB,EAAmB8K,GACzC,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMvlB,EAAWkN,EAAsB+J,iBAAiB7U,GAGxD,GAFIlG,KAAKywB,iBAAiB3sB,IACD,MAArBA,EAASotB,UAAoBptB,EAASotB,SAAW,GAChC,MAAjB7H,EAAQ3lB,MAAiB,OAAO,KAEpC,MAAMytB,EAAoC,IAAtBrtB,EAASotB,SAAiB,aAAe,sBAAuBptB,EAASotB,eAE7F,OAAOja,EADkBvT,MAAiBoV,WAAWgH,MAAMqR,GACpB,KAArB,CAAEf,UAAU,eAIflqB,EAAmB8K,GACpC,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMvlB,EAAWkN,EAAsB+J,iBAAiB7U,GAExD,OADIlG,KAAKywB,iBAAiB3sB,IACN,MAAhBA,EAASstB,IAAsB,KAE5BL,UAAejtB,EAASstB,IAAxBL,CAA6B1H,eAIrBnjB,EAAmB8K,GACpC,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMvlB,EAAWkN,EAAsB+J,iBAAiB7U,GAExD,OADIlG,KAAKywB,iBAAiB3sB,IACN,MAAhBA,EAASutB,IAAsB,KAE5BN,UAAejtB,EAASutB,IAAxBN,CAA6B1H,qBAIfnjB,EAAmB8K,GAC1C,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMvlB,EAAWkN,EAAsB+J,iBAAiB7U,GACxD,IAAIqB,EACAqoB,EAEJ,GAAI5vB,KAAKywB,iBAAiB3sB,IAAyC,SAA5BA,EAASwtB,iBAA8BjI,EAAQ3lB,MACpF6D,GAAQ,EACRqoB,GAAU,OAEV,IACE5X,KAAKC,MAAMoR,EAAQ3lB,OACnB6D,GAAQ,EACRqoB,GAAU,QACV/O,GACgC,WAA5B/c,EAASwtB,gBACX/pB,GAAQ,EACRqoB,GAAU,GAC2B,UAA5B9rB,EAASwtB,iBAClB/pB,GAAQ,EACRqoB,GAAU,GAKhBvG,SAAQwG,UAAU5kB,KAAK2kB,EAAU,CAAEW,aAAa,GAAS,MAClDhpB,EAAQ,CAAE8oB,WAAW,GAAS,6BAIVnqB,EAAmB8K,GAChD,OAAQqY,IACNrpB,KAAK8wB,cAAczH,GACnB,MAAMkI,EAAavgB,EAAsBwgB,iBAAiBtrB,GAEpD6L,EAAoBwf,EAAWxf,kBACrC,IAAIxK,EACAqoB,EAEJ,OAAI5vB,KAAKywB,iBALQc,EAAWztB,WAKgC,MAArBiO,GACrCxK,GAAQ,EACRqoB,GAAU,GAEyB,UAAnClP,EAAsB5G,UACpBvS,GAAQ,EACRqoB,GAAU,GAC8B,YAA/B7d,EAAkB+H,UAC3BvS,GAAQ,EACRqoB,GAAU,IAEVroB,GAAQ,EACRqoB,GAAU,GAIdvG,EAAQwG,UAAU5kB,KAAK2kB,EAAU,CAAEY,gBAAgB,EAAMb,eAAgB5d,EAAkBgI,SAAY,MAChGxS,EAAQ,CAAE+oB,cAAc,EAAMX,eAAgB5d,EAAkBgI,SAAY,8BAKvDjW,GAC9B,OAAQ2tB,mBAAkC3tB,uCC9KxC,QAAiBlE,6BAEQ8xB,EAAsBC,EAAoBC,GACrE,IAAKF,EAAgB,MAAO,GAE5B,MAAMG,EAAgBF,EAAY,kBAAoB,iBAUtD,OATkB3xB,KAAK8xB,aAAaJ,EAAa7G,eAE9C5oB,QAAQ,MAAO,MACfA,QAAQ,KAAM,KACdA,QAAQ4vB,EAAe,KACvB5vB,QAAQ,OAAQ,KAChBA,QAAQ,QAAS,KACjBA,QAAQ,WAAY,KACpBA,QAAQ2vB,EAAU,WAAa,OAAQ,wBAIxB3H,GAClB,MAAM8H,EAAmC,CACvCC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IACnFC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KACtFC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAChFC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IACnFC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,KACpFC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,QAAI,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,KAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC7FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,KAAMC,OAAG,IAAKC,OAAG,KAC7FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC7FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IACnBC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAAMC,OAAG,KAC1FC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,KAAMC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC7FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,KAAMC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC9FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC7FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC7FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAC7FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,KAAMC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC5FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAC3FC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,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","names":["DataTypeConstants","Boolean","Custom","DateTime","Empty","Entity","Hyperlink","Number","String","InputTypeConstants","BooleanDefault","BooleanTristate","CustomDefault","CustomGps","CustomJsonEditor","DatetimeDefault","DefaultSuffix","EmptyDefault","EmptyEnd","EmptyMessage","EntityContentBlocks","EntityDefault","EntityQuery","ExternalWebComponent","HyperlinkDefault","HyperlinkLibrary","NumberDefault","NumberDropdown","StringDefault","StringDropdown","StringDropdownQuery","StringFontIconPicker","StringJson","StringTemplatePicker","StringUrlPath","StringWysiwyg","url","length","path","hasDetails","hasUpdate","posParams","Object","zoneId","appId","items","detailsEntityGuid","detailsFieldId","updateEntityGuid","updateFieldId","consumed","slice","static","inputType","itName","constructor","this","window","eavFieldLogicManager","FieldLogicManager","add","logic","logics","name","get","inputTypeName","f","_a","linkType","TranslationLinks","dimensions","currentLanguage","TranslateMenuHelpers","calculateShortDimensions","result","calculateEditAndReadDimensions","editableDimensions","readOnlyDimensions","infoMessage","editableExist","readOnlyExist","join","dimensionsMap","shortCurrentLanguage","indexOf","push","forEach","dimension","shortNoReadOnly","replace","map","shortDimension","includes","FormItemFormulaService","init","itemService","applyValueChangesFromFormulas","entityGuid","contentType","formValues","fieldsProps","possibleValueUpdates","possibleFieldsUpdates","slotIsEmpty","entityReader","valueUpdates","attribute","Attributes","possibleFieldsUpdatesForAttribute","filter","Name","valueFromFormula","newValue","Q","value","shouldUpdate","pe","_b","settings","_disabledBecauseOfTranslation","keys","maxValueFormulaCycles","valueFormulaCounter","updateItemAttributesValues","defaultLanguage","valueBefore","disabledBecauseTranslations","undefined","valuesNotEqual","Array","isArray","GeneralHelpers","factory","FormulaDesignerService","eavService","contentTypeService","languageInstanceService","contentTypeItemService","loggingService","translate","Subscription","ngOnDestroy","A","formulaCache$","complete","E","formulaResults$","O","designerState$","_c","subscription","unsubscribe","BehaviorSubject","editMode","fieldName","isOpen","target","formulaCache","buildFormulaCache","getFormula","allowDraft","find","isDraft","getFormula$","pipe","formulas","distinctUntilChanged","getFormulas","getFormulas$","asObservable","updateFormulaFromEditor","formula","run","formulaFunction","FormulaHelpers","error","sendFormulaResultToUi","item","getItem","contentTypeId","InputFieldHelpers","getContentType","getCurrentLanguage","eavConfig","formId","getDefaultLanguage","errorLabel","FieldsSettingsHelpers","addLog","LogSeverities","designerState","getDesignerState","isOpenInDesigner","console","oldFormulaCache","oldFormulaIndex","findIndex","oldFormulaItem","shared","buildItemFormulaCacheSharedParts","streams","Z","promises$","updateCallback$","callback$","createPromisedParts","newFormulaItem","cache","H","fn","se","bind","source","sourceFromSettings","sourceGuid","sourceId","version","targetEntity","W","user","s","app","D","_d","sxc","X","_e","stopFormula","q","_f","ie","_g","newCache","next","updateSaved","delete","resetFormula","oldResults","oldResultIndex","r","newResults","isError","isOnlyPromise","newResult","getFormulaResult$","results","setDesignerOpen","newState","setDesignerState","activeDesigner","getDesignerState$","entity","mdFor","For","guid","Guid","id","Id","type","Type","for","targetType","F","TargetType","number","string","dialogContext","User","email","Email","isAnonymous","IsAnonymous","isSiteAdmin","IsSiteAdmin","isContentAdmin","IsContentAdmin","isSystemAdmin","IsSystemAdmin","username","Username","parseInt","isGlobal","App","IsGlobalApp","isSite","IsSiteApp","isContent","IsContentApp","getSetting","key","$2sxc","pageId","tabId","moduleId","_noContextInHttpHeaders","_autoAppIdsInUrl","EntityReader","itemGuids","sharedParts","flattenAll","Metadata","formulaItems","getContentTypeItems","Formulas","formulaItem","LocalizationHelpers","Enabled","Formula","Target","itemTitle","showMessage","instant","formulaCacheItem","lastPromise","x","switchMap","promise","from","combineLatest","subscribe","callback","i0","FormulaEngine","languageService","formulaDesignerService","globalConfigService","editInitializerService","featuresService","fieldsSettingsService","formulaPromiseHandler","contentTypeSettings$","getAll$","featuresCache$","runAllFormulas","entityId","settingsInitial","settingsCurrent","itemIdWithPrefill","contentTypeMetadata","attributeValues","formReadOnly","logicTools","formulaValue","formulaValidation","formulaFields","settingsNew","formulaResult","runFormula","Fe","Promise","handleFormulaPromise","Se","stop","fields","FormulaTargets","FormulaSettingsHelper","validation","getFormulaSettingsKey","languages","getLanguages","debugEnabled","getDebugEnabled","initialFormValues","getInitialValues","formulaProps","isDesignerOpen","ctSettings","FormulaVersions","log","toLocaleUpperCase","_itemTitle","formulaV1Result","data","context","experimental","every","Date","valueV1","FormulaValueCorrections","openInDesigner","formulaV2Result","valueV2","Ee","formulaDefaultResult","valueDefault","fieldUpdates","settingUpdates","FormulaPromiseHandler","resultWithPromise","consoleLogAngular","DefineCallbackHandlerIfMissing","queue","updateValueQueue","corrected","queueItem","FormulaPromiseResult","settingUpdate","he","startsWith","SettingsFormulaPrefix","settingName","substring","L","newSetting","ss","fieldsUpdates","ne","retriggerFormulas","updateValuesFromQueue","latestFieldProps","attributes","constantFieldParts","itemAttributes","formItemFormulaService","valuesUpdated","newFieldProps","toProcess","values","allSettings","valueSet","ae","constantFieldPart","constants","setting","updatedSettings","a","requiredFormulaPrefix","formV1Prefix","defaultFormulaNow","fieldInputType","fieldLogic","Required","ValidationHelpers","disableTranslation","DisableTranslation","ForcedDisabled","DisableAutoTranslation","fixed","R","update","JSON","parse","stringify","prevSetting","valueCorrection","_","date","endsWith","getTime","setTime","getTimezoneOffset","setMilliseconds","toJSON","S","toString","cleanFormula","trim","lastIndexOf","versionPart","validVersions","Function","itemHeader","features","default","initial","parameters","prefill","defineProperties","buildFormulaPropsParameters","Prefill","severity","message","settingPath","warn","Values","culture","code","l","NameId","Culture","debug","isEnabled","form","runFormulas","getEntities","getItems","getSettings","getFieldSettings","getValues","fieldValues","entries","prefillAsParameters","fieldOptions","formulaPropsParameters","label","allFields","allParameters","editorTypesForIntellisense","V1","V2","Disabled","Notes","Value","Visible","Validation","FieldMetadataKey","BestValueModes","Default","Strict","MetadataDecorators","LanguagesDecorator","SaveEmptyDecorator","Translate","DontTranslate","MissingDefaultLangValue","LinkReadOnly","LinkReadWrite","LinkCopyFrom","WrappersConstants","AdamWrapper","CollapsibleWrapper","DropzoneWrapper","EntityExpandableWrapper","ExpandableWrapper","HiddenWrapper","HyperlinkDefaultExpandableWrapper","HyperlinkLibraryExpandableWrapper","LocalizationWrapper","zone","attach","htmlEl","runOutsideAngular","timeoutsArray","timeout","clearTimeout","splice","clearTimeouts","windowBodyTimeouts","document","body","classList","draggingClass","remove","addEventListener","dragoverListener","passive","dropListener","eventListeners","element","listener","detach","removeEventListener","mask","model","changeEvent","overloadPreCleanValues","fieldList","preClean","watchAllFields","resolve","e","i","replaceValue","hasOwnProperty","cleaned","matches","match","findFields","staticName","unwrapField","onChange","maybeNew","field","valueSub","valueChanges","subscriptions","destroy","defaultSettings","T","Description","xe","B","EditInstructions","j","Features","K","Label","oe","ListInstructions","re","ve","Icon","Be","Link","_h","getContentTypeTitle","_slotCanBeEmpty","et","IsEmptyAllowed","_j","_slotIsEmpty","ze","IsEmpty","_k","asDeprecated","VisibleInEditUI","moveDeprecatedSettings","n","Placeholder","h","DefaultCollapsed","Collapsed","InputType","canAutoTranslate","attributeMetadata","languagesDecorator","m","some","eavValue","DisableI18n","metadataItem","metadata","index","empties","infoLabel","editableTranslationExists","readonlyTranslationExists","Dimensions","state","getTranslationStateCore","language","editableElements","defaultValue","translation","getValueTranslation","translationDefault","allAttributesValues","languageKey","d","c","v","oldAttributes","attributeKey","newAttributes","attributeCopy","allAttributes","updateValues","eavAttributes","newItemValue","isEditableOrReadonlyTranslationExist","newValues","newEavValue","EavValue","EavDimension","newAttribute","updateValue","existingLanguageKey","isReadOnly","newLanguageValue","updateAttribute","attributeValue","attributeType","newDimensionValue","existingDimensionValue","concat","validDimensions","eavValues","mode","bestDimensions","bestValue","findValueForDimensions","getBestValue","flatten","metadataItems","merged","emptyAll","FileTypeHelpers","filename","toLocaleLowerCase","ext","getExtension","matExtensions","customExtensions","defaultIcon","isImgRegex","test","doc","docx","xls","xlsx","ppt","pptx","pdf","mp3","avi","mpg","mpeg","mov","mp4","zip","rar","txt","html","css","xml","xsl","vcf","y","obj1","obj2","keys1","keys2","key1","oldValues","changes","controlValuesEqual","array","control","touched","markAsTouched","updateValueAndValidity","dirty","markAsDirty","patchValue","isNaN","arraysEqual","disable","disabled","enable","input","Header","ContentTypeName","inputTypes","calculatedInputType","calculateInputType","isExternal","AngularAssets","wrappers","AllowMultiValue","onlyPrefill","DefaultValue","toLowerCase","guids","split","emptyEntityField","createMode","ctx_r17","oxw","ctx_r26","ctx_r34","ctx_r36","PagePickerComponent","dialogData","dialogRef","queryService","ngOnInit","selected","parseSelectedPageId","toggled","filterText$","searchItems$","tree$","filteredSearch$","filterText","searchItems","templateVars$","filteredSearch","tree","fetchPages","setFilter","select","page","isClickable","isVisible","confirm","closeDialog","toggle","close","stream","getAvailableEntities","pages","Path","Clickable","buildPageSearch","children","parentId","ParentId","parent","buildPageTree","prefix","fieldValue","group","controls","config","MAT_DIALOG_DATA","selectors","dialog","viewContainerRef","changeDetectorRef","open","autoFocus","height","width","afterClosed","take","markForCheck","sanitized","charToRemove","goodChar","removeFromStart","removeFromEnd","cleanBadPath","sanitizePath","ValidationMessagesHelpers","errors","controlKey","invalid","errorKey","validationMessages","formulaMessage","warning","_warning$","warningKey","warningMessages","required","min","max","pattern","decimals","jsonError","formulaError","jsonWarning","formulaWarning","ignoreValidators","validators","requiredAdam","formulaValidate","validJson","ensureWarning","Validators","adamItems","ValidationRegExJavaScript","Decimals","matchString","Max","Min","JsonValidation","fieldProps","getFieldsProps","ItemFieldVisibility","controlValue","allowPath","trimEnd","rexSeparators","latinizeText","latinMap","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","e","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","queryParams","decodeURIComponent","qs","params","tokens","exec","paramName","paramValue","RegExp","search","area","systemRoot","portalRoot","appRoot","appSharedRoot","route","lastChild","firstChild","pathFromRoot","snapshot","urlSegment","valueDto","attributesDto","typeName","attributeDto","attributeName","EavValues","copy","entityDto","EavEntityAttributes","convertMany","Owner","Version","entitiesDto","EavEntity","convertOne","entityBundleDto","valuesDto","langs","lang","create","Error","Log","Warn","PublishModes","Show","Hide","Branch","AdamService","http","dnnContext","getAll","subfolder","usePortalRoot","addFolder","newfolder","post","newFolder","SanitizeHelper","rename","newName","isFolder","IsFolder","deleteItem","getLinkInfo","link","apiUrl","appid","webApiEditRoot","webApiEntityPicker","EavService","setEavConfig","isParentDialog","isCopy","enableHistory","Url","SharedUrl","Language","Current","langPri","Primary","List","ue","partOfPage","de","keyPartOfPage","partOfPageDefault","Site","be","location","pathname","versioningOptions","getVersioningOptions","sessionStorage","keyPublishing","enableFormulaSave","Pe","Enable","FormulaSave","overrideEditRestrictions","OverrideEditRestrictions","fetchFormData","formData","Context","IsEnabled","tap","allowDebug","DebugMode","saveFormData","publishing","allowAll","show","hide","branch","publish","EditInitializerService","inputTypeService","publishStatusService","snackBar","entityCacheService","adamCacheService","linkCacheService","loaded$","convertUrlToForm","editItems","load","UpdateEnvVarsFromDialogSettings","importLoadedData","keepInitialValues","setMissingValues","loadDto","Math","floor","random","editDialogCount","calculateIsParentDialog","Items","loadItems","addInputTypes","InputTypes","addContentTypeItems","ContentTypeItems","addContentTypes","ContentTypes","loadPrefetch","u","Prefetch","Adam","loadEntities","Entities","I","Links","P","DuplicateEntity","history","settingsAsEav","Settings","isoLangCode","use","sortedLanguages","primaryLangKey","primaryLang","sameLangs","otherLangs","sort","b","localeCompare","sortLanguages","loadLanguages","addLanguageInstance","publishMode","asPublishMode","IsPublished","DraftShouldBranch","setPublishMode","getInitialValuesKey","getInputTypes","switchToDefault","ctAttribute","fieldSettings","firstValue","setDefaultValue","noLanguageValue","transactionItem","removeItemAttributeDimension","addItemAttributeValue","defaultLanguageValue","IsEphemeral","setCurrentLanguage","duration","EditRoutingService","BaseSubsinkComponent","router","super","childFormResult$","Subject","initHideHeader","initChildFormResult","refreshOnChildVersionsClosed","isExpanded","fieldId","fieldIndex","isExpanded$","childFormResult","childResult","childFormClosed","expand","componentTag","oldEditUrl","newEditUrl","currentUrl","UrlHelpers","lastIndex","newUrl","navigate","formUrl","convertFormToUrl","relativeTo","updateHideHeader","events","event","NavigationEnd","startWith","pairwise","hadChild","hasChild","editResult","getCurrentNavigation","extras","formResult","versionsResult","refreshEdit","navRes","navigateUrl","webApiEntityRoot","webApiEntityList","EntityService","contentTypeName","entitiesFilter","reactiveEntities","p","share","force","parentField","FormsStateService","saveForm$","readOnly$","formsValid$","formsDirty$","reason","saveButtonDisabled$","readOnly","formsValid","formsDirty","getItemHeader$","itemHeaders","EditInfo","ReadOnly","getCurrentLanguage$","getLanguages$","IsAllowed","itemsReadOnly","languageAllowed","getFormValid","setFormValid","isValid","allValid","valid","setFormDirty","isDirty","anyDirty","FieldsSettingsService","formsStateService","formulaEngine","fieldsProps$","forceRefreshSettings$","itemFieldVisibility","contentType$","getContentType$","itemHeader$","entityReader$","getEntityReader$","inputTypes$","getInputTypes$","constantFieldParts$","mdMerger","allConstFieldParts","initialDisabled","He","angularAssets","Qe","dropzonePreviewsClass","isLastInGroup","mergeRaw","VisibleDisabled","isVisibleDisabled","hasRules","groupField","EmptyFieldHelpers","innerField","itemAttributes$","getItemAttributes$","formReadOnly$","debugEnabled$","getDebugEnabled$","status","latestSettings","tt","Je","fieldTranslation","translationState","getContentTypeSettings","getContentTypeSettings$","getFieldsProps$","getFieldSettings$","fieldsSettings","getTranslationState$","FieldsTranslateService","isTransaction","isTranslationDisabled","getItemAttributes","doesFieldHaveExistingDimension","addItemAttributeValueHelper","dontTranslate","autoTranslate","fieldNames","autoTranslateLanguageKey","isMany","areAllChecksKnown","apiKeyInfo","EditApiKeyPaths","IsDemo","alert","textsForTranslation","doFieldsHaveExistingDimension","isAutoTranslationEnabledButWasDisabledByDefault","ApiKey","response","translations","elem","createElement","innerHTML","translatedText","updateItemAttributeValue","copyFrom","copyFromLanguageKey","attributeValueTranslation","linkReadOnly","linkWithLanguageKey","addItemAttributeDimension","linkReadWrite","translateMany","translatable","findTranslatableFields","dontTranslateMany","autoTranslateMany","canTranslate","cantTranslateAndEmpty","findAutoTranslatableFieldsThatWereNotAutoTranslatableByDefault","findAutoTranslatableFields","ge","isAutoTranslationDisabled","LoggingService","logs$","newLogs","time","now","logLimit","nowTime","lastSnackBarTime","snackBarDebounce","getLogs$","LoadIconsService","matIconRegistry","domSanitizer","file","folder","sitemap","icons","svg","addSvgIconLiteral","bypassSecurityTrustHtml","QueryService","queryUrl","includeGuid","hasParams","paramsLower","hasAppId","Y","urlParams","J","Guids","ScriptsLoaderService","scripts","sortedFiles","sortByType","insertToDom","cssFiles","jsFiles","script","resolveSpecialPaths","loaded","domEl","files","increment","sxcVersion","existing","loadedFiles","loadedFile","_listener","rel","href","src","querySelector","appendChild","identifier","ClientData","defaultIsShow","ruleIsShow","reduce","prev","override","EntityCollectionServiceBase","cacheName","serviceElementsFactory","cache$","entities$","GlobalConfigService","BaseDataService","keyDebug","allowDebugMode","addOneToCache","allow","oldConfig","newConfig","updateOneInCache","configs","toggleDebugEnabled","AdamCacheService","prefetchAdams","snapshots","upsertManyInCache","getAdamSnapshot","C","adamSnapshot","ContentTypeItemService","contentTypeItems1","contentTypeItems","getContentTypeItem","contentTypeItem","ctAttributeDto","IsTitle","ctAttributesDto","attribute1","EavContentTypeAttribute","ContentTypeService","contentTypes1","contentTypes","contentType1","contentTypeDto","Scope","EavContentType","addManyToCache","EntityCacheService","entities","getEntities$","getEntity","entityConfig","entityMetadata","GlobalConfig","Item","selectId","$","g","Feature","feature","LanguageInstance","languageInstance","ContentType","ContentTypeItem","PublishStatus","publishStatus","_guid","EntityCache","AdamCache","LinkCache","StringQueryCache","cacheItem","selector","pluralNames","InputTypeService","getInputType","ItemService","items1","item1","EavItem","updateItemId","itemData","oldItem","EntityId","newItem","updateItemMetadata","shareWithLanguage","updateItemHeader","header","getItem$","getItemFor$","getItemNote","eavConstants","getItemNote$","G","entityGuids","getItems$","ee","LanguageInstanceService","uiLanguage","hideHeader","removeLanguageInstance","removeOneFromCache","newLanguage","getDefaultLanguage$","shareReplay","languageInstances","getHideHeader$","LanguageService","addAllToCache","LinkCacheService","prefetchLinks","prefetchAdam","links","linkInfo","prefetchFields","adamLinks","adamToLinks","loadAdam","loadLink","upsertOneInCache","linkCache","ReferenceId","PublishStatusService","setPublishStatus","removePublishStatus","getPublishStatus","getPublishStatus$","publishStatuses","isPublished","draftShouldBranch","getPublishMode$","StringQueryCacheService","buildSelector","DialogTypeConstants","Zone","Apps","AppImport","ContentItems","Edit","ItemHistory","Develop","PipelineDesigner","Replace","InstanceList","SystemSettingsScopes","GoogleTranslate","GoogleMaps","keyType","cmsObject","hint","appMetadata","LightSpeed","keyTypes","scopes","configuration","appConfiguration","template","permissions","query","resources","systemSettings","systemResources","customSettings","customResources","notes","imageDecorator","pipelineDesigner","dataSourceDifficulties","advanced","outDataSource","EntityGuid","In","PartAssemblyAndType","PrimaryType","VisualDesignerData","Top","Left","Width","defaultPipeline","dataSources","streamWiring","From","Out","To","testParameters","keyZoneId","keyContentBlockId","keyModuleId","keyAppId","keyDialog","keyContentType","keyItems","keyFilters","keyPipelineId","keyUrl","keyIsShared","keyExtras","TippyDirective","elementRef","ngOnChanges","tooltip","tippy","nativeElement","animation","arrow","placement","theme","setContent","tippyDisabled","tippyPlacement","setProps","tippyShowDelay","showDelay","delay","optionalParams","environment","groupCollapsed","trace","groupEnd","appContext","includedApiRoot","Api","old2sxcHeader","env","new2sxcHeader","appApi","PREFILL_PREFIX","GROUP_PREFIX","FIELDS_PREFIX","VAL_SEPARATOR","LIST_SEPARATOR","asGroup","asItem","asInboundParams","Fields","Parent","toOrderedParams","Field","Index","Add","prefill2UrlParams","fields2UrlParams","addItem","getParamForMetadata","buildForSuffix","itemFor","Singleton","paramEncode","V","getParamForOldMetadata","addTo","prefillParams","paramDecode","maybeNumber","innerItem","options","option","parms","isNumber","addParamToItemIdentifier","parts","editItem","part","newParams","forParams","forKeyType","forKey","forTarget","forTargetType","forSingleton","copyParams","prefillFromUrlParams","text","parentContext","contextId","_zoneId","routeNum","_appId","contentBlockId","_contentBlockId","_moduleId","routeSnapshot","clearCachedValues","ready","initRoot","sessionNumber","num","paramMap","FeaturesService","ReplaySubject","loadFromService","configService","getShared$","ds","dialogContext$","dc","get$","featureNameId","isEnabled$","nameId","production","iconsFontAwesome","AppIconsService","setDefaultFontSetClass","appRoutes","loadChildren","then","AppsManagementModule","title","ImportAppModule","AppAdministrationModule","CodeEditorModule","VisualQueryModule","ReplaceContentModule","ManageContentListModule","ContentItemsModule","ContentTypeFieldsModule","ItemHistoryModule","matcher","editRoot","EditModule","refreshEditRoot","RefreshEditModule","AppRoutingModule","RouterModule","relativeLinkResolution","AppComponent","DnnAppComponent","el","titleService","activatedRoute","appIconsService","preConfigure","appTitle","getTitle","child","setTitle","metaReducers","reducer","action","reducers","injector","eavKeys","hash","removeItem","setItem","urlHash","queryParametersFromUrl","paramKey","Router","extrasZone","Ce","tab","extrasApp","Te","scope","historyItems","pipelineId","repItem","grpItem","totalPopup","HandleErrorsInterceptor","intercept","req","handle","catchError","checkIfExcluded","showDetailedHttpError","throwError","excludedUrl","excludedUrls","infoText","srvResp","msg","Message","msgDet","MessageDetail","ExceptionMessage","SetHeadersInterceptor","modified","FormData","clone","setHeaders","AppModule","bootstrap","provide","APP_INITIALIZER","useFactory","paramsInitFactory","deps","Injector","multi","LocationStrategy","useClass","HashLocationStrategy","DnnInterceptor","HTTP_INTERCEPTORS","Title","imports","BrowserModule","HttpClientModule","BrowserAnimationsModule","StoreModule","runtimeChecks","strictStateImmutability","strictActionImmutability","EffectsModule","StoreDevtoolsModule","maxAge","EntityDataModule","TranslateModule","MatSnackBarModule","enableProdMode","__NgCli_bootstrap_1","bootstrapModule","catch","err"],"sources":["./projects/eav-ui/src/app/content-type-fields/constants/data-type.constants.ts","./projects/eav-ui/src/app/content-type-fields/constants/input-type.constants.ts","./projects/eav-ui/src/app/edit/edit.matcher.ts","./projects/eav-ui/src/app/edit/form/fields/empty/empty-field-helpers.ts","./projects/eav-ui/src/app/edit/form/shared/field-logic/field-logic-manager.ts","./projects/eav-ui/src/app/edit/form/wrappers/localization-wrapper/translate-menu/translate-menu.helpers.ts","./projects/eav-ui/src/app/edit/formulas/form-item-formula.service.ts","./projects/eav-ui/src/app/edit/formulas/formula-designer.service.ts","./projects/eav-ui/src/app/edit/formulas/formula-engine.ts","./projects/eav-ui/src/app/edit/formulas/models/formula-promise-result.model.ts","./projects/eav-ui/src/app/edit/formulas/formula-promise-handler.ts","./projects/eav-ui/src/app/edit/formulas/formula.constants.ts","./projects/eav-ui/src/app/edit/formulas/helpers/formula-settings.helper.ts","./projects/eav-ui/src/app/edit/formulas/helpers/formula-value-corrections.helper.ts","./projects/eav-ui/src/app/edit/formulas/helpers/formula.helpers.ts","./projects/eav-ui/src/app/edit/formulas/editor-intellisense-function-v2.rawts","./projects/eav-ui/src/app/edit/formulas/models/formula.models.ts","./projects/eav-ui/src/app/edit/shared/constants/field-metadata.constants.ts","./projects/eav-ui/src/app/edit/shared/constants/localization.constants.ts","./projects/eav-ui/src/app/edit/shared/constants/metadata-decorators.constants.ts","./projects/eav-ui/src/app/edit/shared/constants/translation-link.constants.ts","./projects/eav-ui/src/app/edit/shared/constants/wrappers.constants.ts","./projects/eav-ui/src/app/edit/shared/helpers/dropzone-dragging.helper.ts","./projects/eav-ui/src/app/edit/shared/helpers/field-mask.helper.ts","./projects/eav-ui/src/app/edit/shared/helpers/fields-settings.helpers.ts","./projects/eav-ui/src/app/edit/shared/helpers/localization.helpers.ts","./projects/eav-ui/src/app/edit/shared/helpers/entity-reader.ts","./projects/eav-ui/src/app/edit/shared/helpers/file-type.helpers.ts","./projects/eav-ui/src/app/edit/shared/helpers/general.helpers.ts","./projects/eav-ui/src/app/edit/shared/helpers/input-field.helpers.ts","./projects/eav-ui/src/app/edit/form/shared/page-picker/page-picker.component.html","./projects/eav-ui/src/app/edit/form/shared/page-picker/page-picker.component.ts","./projects/eav-ui/src/app/edit/form/shared/page-picker/page-picker.helpers.ts","./projects/eav-ui/src/app/edit/shared/helpers/page-picker.helper.ts","./projects/eav-ui/src/app/edit/shared/helpers/sanitize.helper.ts","./projects/eav-ui/src/app/edit/shared/helpers/validation-messages.helpers.ts","./projects/eav-ui/src/app/edit/shared/helpers/validation.helpers.ts","./projects/eav-ui/src/app/edit/shared/helpers/url.helpers.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-dimension.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-values.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-entity-attributes.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-entity.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-item.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-value.ts","./projects/eav-ui/src/app/edit/shared/models/log-entry.model.ts","./projects/eav-ui/src/app/edit/shared/models/publish-mode.models.ts","./projects/eav-ui/src/app/edit/shared/services/adam.service.ts","./projects/eav-ui/src/app/edit/shared/services/eav.service.ts","./projects/eav-ui/src/app/edit/shared/services/edit-initializer.service.ts","./projects/eav-ui/src/app/edit/dialog/main/edit-dialog-main.helpers.ts","./projects/eav-ui/src/app/edit/shared/services/edit-routing.service.ts","./projects/eav-ui/src/app/edit/shared/services/entity.service.ts","./projects/eav-ui/src/app/edit/shared/services/forms-state.service.ts","./projects/eav-ui/src/app/edit/shared/services/fields-settings.service.ts","./projects/eav-ui/src/app/edit/shared/services/fields-translate.service.ts","./projects/eav-ui/src/app/edit/shared/services/logging.service.ts","./projects/eav-ui/src/app/edit/shared/services/load-icons.service.ts","./projects/eav-ui/src/app/edit/assets/icons/2sxc/Material-Icon-Adam-48-filled.svg","./projects/eav-ui/src/app/edit/assets/icons/2sxc/Material-Icon-Adam-48-outlined.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/draft-branch.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-archive.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-audio.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-code.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-excel.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-image.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-pdf.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-powerpoint.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-text.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-video.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/file-word.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/folder.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/folder-plus.svg","./projects/eav-ui/src/app/edit/assets/icons/font-awesome/sitemap.svg","./projects/eav-ui/src/app/edit/shared/services/query.service.ts","./projects/eav-ui/src/app/edit/shared/services/scripts-loader.service.ts","./projects/eav-ui/src/app/edit/shared/services/item-field-visibility.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/base-data.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/global-config.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/adam-cache.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/content-type-item.service.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-content-type-attribute.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/content-type.service.ts","./projects/eav-ui/src/app/edit/shared/models/eav/eav-content-type.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/entity-cache.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/entity-metadata.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/input-type.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/item.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/language-instance.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/language.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/link-cache.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/publish-status.service.ts","./projects/eav-ui/src/app/edit/shared/store/ngrx-data/string-query-cache.service.ts","./projects/eav-ui/src/app/shared/components/base-subsink-component/base-subsink.component.ts","./projects/eav-ui/src/app/shared/constants/dialog-type.constants.ts","./projects/eav-ui/src/app/shared/constants/eav.constants.ts","./projects/eav-ui/src/app/shared/constants/session.constants.ts","./projects/eav-ui/src/app/shared/directives/tippy.directive.ts","./projects/eav-ui/src/app/shared/helpers/console-log-angular.helper.ts","./projects/eav-ui/src/app/shared/helpers/update-env-vars-from-dialog-settings.helper.ts","./projects/eav-ui/src/app/shared/helpers/url-prep.helper.ts","./projects/eav-ui/src/app/shared/services/context.ts","./projects/eav-ui/src/app/shared/services/features.service.ts","./projects/eav-ui/src/environments/environment.prod.ts","./projects/eav-ui/src/app/shared/icons/index.ts","./projects/eav-ui/src/app/assets/icons/code-curly.svg","./projects/eav-ui/src/app/shared/icons/app-icons.service.ts","./projects/eav-ui/src/app/app-routing.module.ts","./projects/eav-ui/src/app/app.component.ts","./projects/eav-ui/src/app/app.component.html","./projects/eav-ui/src/app/edit/shared/store/reducers/index.ts","./projects/eav-ui/src/app/params-init.factory.ts","./projects/eav-ui/src/app/shared/interceptors/handle-errors.interceptor.ts","./projects/eav-ui/src/app/shared/interceptors/set-headers.interceptor.ts","./projects/eav-ui/src/app/app.module.ts","./projects/eav-ui/src/main.ts"],"sourcesContent":["export const DataTypeConstants = {\r\n  Boolean: 'Boolean',\r\n  Custom: 'Custom',\r\n  DateTime: 'DateTime',\r\n  Empty: 'Empty',\r\n  Entity: 'Entity',\r\n  Hyperlink: 'Hyperlink',\r\n  Number: 'Number',\r\n  String: 'String',\r\n} as const;\r\n\r\nexport type DataTypeConstant = typeof DataTypeConstants[keyof typeof DataTypeConstants];\r\n","export const InputTypeConstants = {\r\n  BooleanDefault: 'boolean-default',\r\n  BooleanTristate: 'boolean-tristate',\r\n  CustomDefault: 'custom-default',\r\n  CustomGps: 'custom-gps',\r\n  CustomJsonEditor: 'custom-json-editor',\r\n  DatetimeDefault: 'datetime-default',\r\n  DefaultSuffix: '-default',\r\n  EmptyDefault: 'empty-default',\r\n  EmptyEnd: 'empty-end',\r\n  EmptyMessage: 'empty-message',\r\n  EntityContentBlocks: 'entity-content-blocks',\r\n  EntityDefault: 'entity-default',\r\n  EntityQuery: 'entity-query',\r\n  ExternalWebComponent: 'external-web-component',\r\n  HyperlinkDefault: 'hyperlink-default',\r\n  HyperlinkLibrary: 'hyperlink-library',\r\n  NumberDefault: 'number-default',\r\n  NumberDropdown: 'number-dropdown',\r\n  StringDefault: 'string-default',\r\n  StringDropdown: 'string-dropdown',\r\n  StringDropdownQuery: 'string-dropdown-query',\r\n  StringFontIconPicker: 'string-font-icon-picker',\r\n  StringJson: 'string-json',\r\n  StringTemplatePicker: 'string-template-picker',\r\n  StringUrlPath: 'string-url-path',\r\n  StringWysiwyg: 'string-wysiwyg',\r\n} as const;\r\n\r\nexport type InputTypeConstant = typeof InputTypeConstants[keyof typeof InputTypeConstants];\r\n","import { UrlMatchResult, UrlSegment } from '@angular/router';\r\nimport { EditPosParams } from './edit-matcher.models';\r\n\r\n/**\r\n * ':zoneId/:appId/edit/:items'\r\n * ':zoneId/:appId/edit/:items/details/:detailsEntityGuid/:detailsFieldId'\r\n * ':zoneId/:appId/edit/:items/update/:updateEntityGuid/:updateFieldId'\r\n */\r\nexport function editRoot(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 4) { return null; }\r\n  if (url[2].path !== 'edit') { return null; }\r\n  const hasDetails = url[4] != null && url[4].path === 'details' && url[5] != null && url[6] != null;\r\n  const hasUpdate = url[4] != null && url[4].path === 'update' && url[5] != null && url[6] != null;\r\n  const posParams: EditPosParams = {\r\n    zoneId: url[0],\r\n    appId: url[1],\r\n    items: url[3],\r\n    ...(hasDetails && { detailsEntityGuid: url[5], detailsFieldId: url[6] }),\r\n    ...(hasUpdate && { updateEntityGuid: url[5], updateFieldId: url[6] }),\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, (hasDetails || hasUpdate) ? 7 : 4),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n\r\n/** ':zoneId/:appId/edit/refresh/:items' */\r\nexport function refreshEditRoot(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 5) { return null; }\r\n  if (url[2].path !== 'edit' || url[3].path !== 'refresh') { return null; }\r\n  const posParams: EditPosParams = {\r\n    zoneId: url[0],\r\n    appId: url[1],\r\n    items: url[4],\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, 5),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n\r\n/**\r\n * 'edit/:items'\r\n * 'edit/:items/details/:detailsEntityGuid/:detailsFieldId'\r\n * 'edit/:items/update/:updateEntityGuid/:updateFieldId'\r\n */\r\nexport function edit(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 2) { return null; }\r\n  if (url[0].path !== 'edit') { return null; }\r\n  const hasDetails = url[2] != null && url[2].path === 'details' && url[3] != null && url[4] != null;\r\n  const hasUpdate = url[2] != null && url[2].path === 'update' && url[3] != null && url[4] != null;\r\n  const posParams: EditPosParams = {\r\n    items: url[1],\r\n    ...(hasDetails && { detailsEntityGuid: url[3], detailsFieldId: url[4] }),\r\n    ...(hasUpdate && { updateEntityGuid: url[3], updateFieldId: url[4] }),\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, (hasDetails || hasUpdate) ? 5 : 2),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n\r\n/** 'edit/refresh/:items' */\r\nexport function refreshEdit(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 3) { return null; }\r\n  if (url[0].path !== 'edit' || url[1].path !== 'refresh') { return null; }\r\n  const posParams: EditPosParams = {\r\n    items: url[2],\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, 3),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n","import { InputTypeConstants } from 'projects/eav-ui/src/app/content-type-fields/constants/input-type.constants';\r\nimport { CalculatedInputType } from '../../../shared/models/calculated-input-type.model';\r\n\r\nexport class EmptyFieldHelpers {\r\n  static isEmptyField(inputType: CalculatedInputType): boolean {\r\n    const itName = inputType.inputType;\r\n    return itName === InputTypeConstants.EmptyDefault || itName === InputTypeConstants.EmptyEnd || itName === InputTypeConstants.EmptyMessage;\r\n  }\r\n\r\n  static isGroup(inputType: CalculatedInputType): boolean {\r\n    const itName = inputType.inputType;\r\n    return itName === InputTypeConstants.EmptyDefault || itName === InputTypeConstants.EmptyEnd;\r\n  }  \r\n\r\n  static isGroupStart(inputType: CalculatedInputType): boolean {\r\n    return inputType.inputType === InputTypeConstants.EmptyDefault;\r\n  }\r\n  static isGroupEnd(inputType: CalculatedInputType): boolean {\r\n    return inputType.inputType === InputTypeConstants.EmptyEnd;\r\n  }\r\n}","import { EavWindow } from '../../../../shared/models/eav-window.model';\r\nimport { FieldLogicBase } from './field-logic-base';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport class FieldLogicManager {\r\n  private logics: Record<string, FieldLogicBase> = {};\r\n\r\n  private constructor() { }\r\n\r\n  static singleton(): FieldLogicManager {\r\n    if (window.eavFieldLogicManager == null) {\r\n      window.eavFieldLogicManager = new FieldLogicManager();\r\n    }\r\n    return window.eavFieldLogicManager;\r\n  }\r\n\r\n  /** Add settings logic */\r\n  add(logic: FieldLogicBase): void {\r\n    this.logics[logic.name] = logic;\r\n  }\r\n\r\n  /** Get settings logic for input type */\r\n  get(inputTypeName: string): FieldLogicBase {\r\n    return this.logics[inputTypeName] ?? null;\r\n  }\r\n}\r\n","import { TranslationLink, TranslationLinks } from '../../../../shared/constants';\r\n\r\nexport class TranslateMenuHelpers {\r\n\r\n  static getTranslationStateClass(linkType: TranslationLink) {\r\n    switch (linkType) {\r\n      case TranslationLinks.MissingDefaultLangValue:\r\n        return 'localization-missing-default-lang-value';\r\n      case TranslationLinks.Translate:\r\n      case TranslationLinks.LinkCopyFrom:\r\n        return 'localization-translate';\r\n      case TranslationLinks.DontTranslate:\r\n        return '';\r\n      case TranslationLinks.LinkReadOnly:\r\n        return 'localization-link-read-only';\r\n      case TranslationLinks.LinkReadWrite:\r\n        return 'localization-link-read-write';\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  static calculateSharedInfoMessage(dimensions: string[], currentLanguage: string): string {\r\n    dimensions = TranslateMenuHelpers.calculateShortDimensions(dimensions, currentLanguage);\r\n    const result = TranslateMenuHelpers.calculateEditAndReadDimensions(dimensions);\r\n    const editableDimensions = result.editableDimensions;\r\n    const readOnlyDimensions = result.readOnlyDimensions;\r\n    let infoMessage = '';\r\n\r\n    const editableExist = editableDimensions.length > 0;\r\n    const readOnlyExist = readOnlyDimensions.length > 0;\r\n    if (editableExist && readOnlyExist) {\r\n      infoMessage = `${editableDimensions.join(', ')}, (${readOnlyDimensions.join(', ')})`;\r\n    } else if (editableExist) {\r\n      infoMessage = editableDimensions.join(', ');\r\n    } else if (readOnlyExist) {\r\n      infoMessage = `(${readOnlyDimensions.join(', ')})`;\r\n    }\r\n\r\n    return infoMessage;\r\n  }\r\n\r\n  private static calculateShortDimensions(dimensions: string[], currentLanguage: string): string[] {\r\n    const dimensionsMap: Record<string, string[]> = {};\r\n    const shortCurrentLanguage = currentLanguage.slice(0, currentLanguage.indexOf('-'));\r\n\r\n    dimensionsMap[shortCurrentLanguage] = [];\r\n    dimensionsMap[shortCurrentLanguage].push(shortCurrentLanguage);\r\n\r\n    dimensions.forEach(dimension => {\r\n      const shortDimension = dimension.slice(0, dimension.indexOf('-'));\r\n      const shortNoReadOnly = shortDimension.replace('~', '');\r\n\r\n      if (!dimensionsMap[shortNoReadOnly]) {\r\n        dimensionsMap[shortNoReadOnly] = [];\r\n        dimensionsMap[shortNoReadOnly].push(dimension);\r\n      } else {\r\n        dimensionsMap[shortNoReadOnly].push(dimension);\r\n      }\r\n    });\r\n\r\n    dimensions = dimensions.map(dimension => {\r\n      const shortDimension = dimension.slice(0, dimension.indexOf('-'));\r\n      const shortNoReadOnly = shortDimension.replace('~', '');\r\n\r\n      if (dimensionsMap[shortNoReadOnly].length > 1) {\r\n        return dimension;\r\n      } else {\r\n        return shortDimension;\r\n      }\r\n    });\r\n\r\n    return dimensions;\r\n  }\r\n\r\n  private static calculateEditAndReadDimensions(dimensions: string[]) {\r\n    const editableDimensions: string[] = [];\r\n    const readOnlyDimensions: string[] = [];\r\n\r\n    dimensions.forEach(dimension => {\r\n      if (!dimension.includes('~')) {\r\n        editableDimensions.push(dimension);\r\n      } else {\r\n        readOnlyDimensions.push(dimension.replace('~', ''));\r\n      }\r\n    });\r\n\r\n    return {\r\n      editableDimensions,\r\n      readOnlyDimensions\r\n    };\r\n  }\r\n}\r\n","import { Injectable } from \"@angular/core\";\r\nimport { FieldValue } from \"projects/edit-types\";\r\nimport { EntityReader, GeneralHelpers } from \"../shared/helpers\";\r\nimport { FormValues, FieldsProps } from \"../shared/models\";\r\nimport { EavContentType } from \"../shared/models/eav\";\r\nimport { FieldValuePair } from \"./models/formula-results.models\";\r\nimport { ItemService } from \"../shared/store/ngrx-data\";\r\n\r\n/**\r\n * Contains methods for updating value changes from formulas.\r\n */\r\n@Injectable()\r\nexport class FormItemFormulaService {\r\n  private itemService: ItemService = null;\r\n\r\n  valueFormulaCounter = 0;\r\n  maxValueFormulaCycles = 5;\r\n\r\n  init(itemService: ItemService) {\r\n    this.itemService = itemService;\r\n  }\r\n\r\n  /**\r\n   * Used to check if the value of a field should be updated with the value from a formula and if so, updates it.\r\n   * @param entityGuid \r\n   * @param contentType \r\n   * @param formValues \r\n   * @param fieldsProps \r\n   * @param possibleValueUpdates \r\n   * @param possibleFieldsUpdates \r\n   * @param slotIsEmpty \r\n   * @param entityReader \r\n   * @returns true if values are updated, false otherwise\r\n   */\r\n  applyValueChangesFromFormulas(\r\n    entityGuid: string,\r\n    contentType: EavContentType,\r\n    formValues: FormValues,\r\n    fieldsProps: FieldsProps,\r\n    possibleValueUpdates: FormValues,\r\n    possibleFieldsUpdates: FieldValuePair[],\r\n    slotIsEmpty: boolean,\r\n    entityReader: EntityReader): boolean {\r\n    const valueUpdates: FormValues = {};\r\n    for (const attribute of contentType.Attributes) {\r\n      const possibleFieldsUpdatesForAttribute = possibleFieldsUpdates.filter(f => f.name === attribute.Name);\r\n      const valueBefore = formValues[attribute.Name];\r\n      const valueFromFormula = possibleValueUpdates[attribute.Name];\r\n      const fieldsFromFormula =\r\n        possibleFieldsUpdatesForAttribute[possibleFieldsUpdatesForAttribute.length - 1]?.value;\r\n      const newValue = fieldsFromFormula ? fieldsFromFormula : valueFromFormula;\r\n      if (this.shouldUpdate(valueBefore, newValue, slotIsEmpty, fieldsProps[attribute.Name]?.settings._disabledBecauseOfTranslation)) {\r\n        valueUpdates[attribute.Name] = newValue;\r\n      }\r\n    }\r\n\r\n    if (Object.keys(valueUpdates).length > 0) {\r\n      if (this.maxValueFormulaCycles > this.valueFormulaCounter) {\r\n        this.valueFormulaCounter++;\r\n        this.itemService.updateItemAttributesValues(\r\n          entityGuid, valueUpdates, entityReader.currentLanguage, entityReader.defaultLanguage\r\n        );\r\n        // return true to make sure fieldProps are not updated yet\r\n        return true;\r\n      } else {\r\n        // consoleLogWebpack('Max value formula cycles reached');\r\n        return false;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Used to check if the value of a field should be updated with the value from a formula.\r\n   * @param valueBefore \r\n   * @param valueFromFormula \r\n   * @param slotIsEmpty \r\n   * @param disabledBecauseTranslations \r\n   * @returns true if value should be updated, false otherwise\r\n   */\r\n  private shouldUpdate(\r\n    valueBefore: FieldValue,\r\n    valueFromFormula: FieldValue,\r\n    slotIsEmpty: boolean,\r\n    disabledBecauseTranslations: boolean\r\n  ): boolean {\r\n    // important to compare with undefined because null is allowed value\r\n    if (slotIsEmpty || disabledBecauseTranslations || valueBefore === undefined || valueFromFormula === undefined)\r\n      return false;\r\n\r\n    let valuesNotEqual = valueBefore !== valueFromFormula;\r\n    // do a more in depth comparison in case of calculated entity fields\r\n    if (valuesNotEqual && Array.isArray(valueBefore) && Array.isArray(valueFromFormula)) {\r\n      valuesNotEqual = !GeneralHelpers.arraysEqual(valueBefore as string[], valueFromFormula as string[]);\r\n    }\r\n    return valuesNotEqual;\r\n  }\r\n}\r\n\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BehaviorSubject, combineLatest, distinctUntilChanged, filter, from, map, Observable, Subscription, switchMap } from 'rxjs';\r\nimport { FieldSettings, FieldValue } from '../../../../../edit-types';\r\nimport { EavWindow } from '../../shared/models/eav-window.model';\r\nimport { EntityReader, FieldsSettingsHelpers, GeneralHelpers, InputFieldHelpers, LocalizationHelpers } from '../shared/helpers';\r\nimport { LogSeverities } from '../shared/models';\r\nimport { EavItem } from '../shared/models/eav/eav-item';\r\nimport { EavService, LoggingService } from '../shared/services';\r\nimport { ContentTypeItemService, ContentTypeService, ItemService, LanguageInstanceService } from '../shared/store/ngrx-data';\r\nimport { FormulaHelpers } from './helpers/formula.helpers';\r\n// tslint:disable-next-line: max-line-length\r\nimport { FormulaCacheItem, FormulaCacheItemShared, FormulaFunction, FormulaTarget, FormulaV1CtxTargetEntity, FormulaV1CtxUser } from './models/formula.models';\r\nimport { FormulaResult, DesignerState, FormulaResultRaw } from './models/formula-results.models';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n/**\r\n * Contains methods for extended CRUD operations for formulas.\r\n */\r\n@Injectable()\r\nexport class FormulaDesignerService implements OnDestroy {\r\n  private formulaCache$: BehaviorSubject<FormulaCacheItem[]>;\r\n  private formulaResults$: BehaviorSubject<FormulaResult[]>;\r\n  private designerState$: BehaviorSubject<DesignerState>;\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private eavService: EavService,\r\n    private itemService: ItemService,\r\n    private contentTypeService: ContentTypeService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private contentTypeItemService: ContentTypeItemService,\r\n    private loggingService: LoggingService,\r\n    private translate: TranslateService,\r\n  ) { }\r\n\r\n  ngOnDestroy(): void {\r\n    this.formulaCache$?.complete();\r\n    this.formulaResults$?.complete();\r\n    this.designerState$?.complete();\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  init(): void {\r\n    this.formulaResults$ = new BehaviorSubject([]);\r\n    const initialDesignerState: DesignerState = {\r\n      editMode: false,\r\n      entityGuid: undefined,\r\n      fieldName: undefined,\r\n      isOpen: false,\r\n      target: undefined,\r\n    };\r\n    this.designerState$ = new BehaviorSubject(initialDesignerState);\r\n    const formulaCache = this.buildFormulaCache();\r\n    this.formulaCache$ = new BehaviorSubject(formulaCache);\r\n  }\r\n\r\n  /**\r\n   * Used for returning formula with specific target on specific field of specific entity.\r\n   * @param entityGuid Specific entity guid\r\n   * @param fieldName Specific field\r\n   * @param target Specific target\r\n   * @param allowDraft \r\n   * @returns Formula\r\n   */\r\n  getFormula(entityGuid: string, fieldName: string, target: FormulaTarget, allowDraft: boolean): FormulaCacheItem {\r\n    return this.formulaCache$.value.find(\r\n      f =>\r\n        f.entityGuid === entityGuid\r\n        && f.fieldName === fieldName\r\n        && f.target === target\r\n        && (allowDraft ? true : !f.isDraft)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Used for returning formula stream with specific target on specific field of specific entity.\r\n   * @param entityGuid Specific entity guid\r\n   * @param fieldName Specific field\r\n   * @param target Specific target\r\n   * @param allowDraft \r\n   * @returns Formula stream\r\n   */\r\n  getFormula$(entityGuid: string, fieldName: string, target: FormulaTarget, allowDraft: boolean): Observable<FormulaCacheItem> {\r\n    const isDraft = allowDraft ? [true, false] : [false];\r\n    return this.formulaCache$.pipe(\r\n      map(formulas => formulas.find(\r\n        f => f.entityGuid === entityGuid && f.fieldName === fieldName && f.target === target && isDraft.includes(f.isDraft))\r\n      ),\r\n      distinctUntilChanged(GeneralHelpers.objectsEqual),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Used for returning formulas filtered by optional entity, field or target.\r\n   * @param entityGuid Optional entity guid\r\n   * @param fieldName Optional field\r\n   * @param target Optional target\r\n   * @param allowDraft \r\n   * @returns Filtered formula array\r\n   */\r\n  getFormulas(entityGuid?: string, fieldName?: string, target?: FormulaTarget, allowDraft?: boolean): FormulaCacheItem[] {\r\n    return this.formulaCache$.value.filter(\r\n      f =>\r\n        (entityGuid ? f.entityGuid === entityGuid : true)\r\n        && (fieldName ? f.fieldName === fieldName : true)\r\n        && (target ? f.target === target : true)\r\n        && (allowDraft ? true : !f.isDraft)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Used for returning all formulas stream from formulaCache$.\r\n   * @returns Formula cache array stream\r\n   */\r\n  getFormulas$(): Observable<FormulaCacheItem[]> {\r\n    return this.formulaCache$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Used for updating formula from editor.\r\n   * @param entityGuid \r\n   * @param fieldName \r\n   * @param target \r\n   * @param formula \r\n   * @param run \r\n   */\r\n  updateFormulaFromEditor(entityGuid: string, fieldName: string, target: FormulaTarget, formula: string, run: boolean): void {\r\n    let formulaFunction: FormulaFunction;\r\n    if (run) {\r\n      try {\r\n        formulaFunction = FormulaHelpers.buildFormulaFunction(formula);\r\n      } catch (error) {\r\n        this.sendFormulaResultToUi(entityGuid, fieldName, target, undefined, true, false);\r\n        const item = this.itemService.getItem(entityGuid);\r\n        const contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n        const contentType = this.contentTypeService.getContentType(contentTypeId);\r\n        const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n        const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n        const itemTitle = FieldsSettingsHelpers.getContentTypeTitle(contentType, currentLanguage, defaultLanguage);\r\n        const errorLabel = `Error building formula for Entity: \"${itemTitle}\", Field: \"${fieldName}\", Target: \"${target}\"`;\r\n        this.loggingService.addLog(LogSeverities.Error, errorLabel, error);\r\n        const designerState = this.getDesignerState();\r\n        const isOpenInDesigner = designerState.isOpen\r\n          && designerState.entityGuid === entityGuid\r\n          && designerState.fieldName === fieldName\r\n          && designerState.target === target;\r\n        if (isOpenInDesigner) {\r\n          console.error(errorLabel, error);\r\n        }\r\n      }\r\n    }\r\n\r\n    const oldFormulaCache = this.formulaCache$.value;\r\n    const oldFormulaIndex = oldFormulaCache.findIndex(f => f.entityGuid === entityGuid && f.fieldName === fieldName && f.target === target);\r\n    const oldFormulaItem = oldFormulaCache[oldFormulaIndex];\r\n\r\n    // Get shared calculated properties, which we need in case the old-formula doesn't have them yet\r\n    const shared = this.buildItemFormulaCacheSharedParts(null, entityGuid);\r\n\r\n\r\n    const streams = (oldFormulaItem?.promises$ && oldFormulaItem?.updateCallback$)\r\n      ? { promises$: oldFormulaItem.promises$, callback$: oldFormulaItem.updateCallback$ }\r\n      : this.createPromisedParts();\r\n\r\n    const newFormulaItem: FormulaCacheItem = {\r\n      cache: oldFormulaItem?.cache ?? {},\r\n      entityGuid,\r\n      fieldName,\r\n      fn: formulaFunction?.bind({}),\r\n      isDraft: run ? formulaFunction == null : true,\r\n      source: formula,\r\n      sourceFromSettings: oldFormulaItem?.sourceFromSettings,\r\n      sourceGuid: oldFormulaItem?.sourceGuid,\r\n      sourceId: oldFormulaItem?.sourceId,\r\n      target,\r\n      version: FormulaHelpers.findFormulaVersion(formula),\r\n      targetEntity: oldFormulaItem?.targetEntity ?? shared.targetEntity, // new 14.07.05\r\n      user: oldFormulaItem?.user ?? shared.user, // new 14.07.05\r\n      app: oldFormulaItem?.app ?? shared.app,    // new in v14.07.05\r\n      sxc: oldFormulaItem?.sxc ?? shared.sxc,    // new in 14.11\r\n      stopFormula: false,\r\n      promises$: oldFormulaItem?.promises$ ?? streams.promises$,\r\n      updateCallback$: oldFormulaItem?.updateCallback$ ?? streams.callback$,\r\n    };\r\n\r\n    const newCache = oldFormulaIndex >= 0\r\n      ? [...oldFormulaCache.slice(0, oldFormulaIndex), newFormulaItem, ...oldFormulaCache.slice(oldFormulaIndex + 1)]\r\n      : [newFormulaItem, ...oldFormulaCache];\r\n    this.formulaCache$.next(newCache);\r\n  }\r\n\r\n  /**\r\n   * Used for saving updated formula from editor.\r\n   * @param entityGuid \r\n   * @param fieldName \r\n   * @param target \r\n   * @param formula \r\n   * @param sourceGuid \r\n   * @param sourceId \r\n   * @returns \r\n   */\r\n  updateSaved(entityGuid: string, fieldName: string, target: FormulaTarget, formula: string, sourceGuid: string, sourceId: number): void {\r\n    const oldFormulaCache = this.formulaCache$.value;\r\n    const oldFormulaIndex = oldFormulaCache.findIndex(f => f.entityGuid === entityGuid && f.fieldName === fieldName && f.target === target);\r\n    const oldFormulaItem = oldFormulaCache[oldFormulaIndex];\r\n    if (oldFormulaItem == null) { return; }\r\n\r\n    const newFormulaItem: FormulaCacheItem = {\r\n      ...oldFormulaItem,\r\n      sourceFromSettings: formula,\r\n      sourceGuid,\r\n      sourceId,\r\n    };\r\n\r\n    const newCache = [...oldFormulaCache.slice(0, oldFormulaIndex), newFormulaItem, ...oldFormulaCache.slice(oldFormulaIndex + 1)];\r\n    this.formulaCache$.next(newCache);\r\n  }\r\n\r\n  /**\r\n   * Used for deleting formula.\r\n   * @param entityGuid \r\n   * @param fieldName \r\n   * @param target \r\n   */\r\n  delete(entityGuid: string, fieldName: string, target: FormulaTarget): void {\r\n    const oldFormulaCache = this.formulaCache$.value;\r\n    const oldFormulaIndex = oldFormulaCache.findIndex(f => f.entityGuid === entityGuid && f.fieldName === fieldName && f.target === target);\r\n\r\n    const newCache = [...oldFormulaCache.slice(0, oldFormulaIndex), ...oldFormulaCache.slice(oldFormulaIndex + 1)];\r\n    this.formulaCache$.next(newCache);\r\n  }\r\n\r\n  /**\r\n   * Used for resetting formula.\r\n   * @param entityGuid \r\n   * @param fieldName \r\n   * @param target \r\n   */\r\n  resetFormula(entityGuid: string, fieldName: string, target: FormulaTarget): void {\r\n    const oldResults = this.formulaResults$.value;\r\n    const oldResultIndex = oldResults.findIndex(r => r.entityGuid === entityGuid && r.fieldName === fieldName && r.target === target);\r\n    if (oldResultIndex >= 0) {\r\n      const newResults = [...oldResults.slice(0, oldResultIndex), ...oldResults.slice(oldResultIndex + 1)];\r\n      this.formulaResults$.next(newResults);\r\n    }\r\n\r\n    const oldFormulaCache = this.formulaCache$.value;\r\n    const oldFormulaIndex = oldFormulaCache.findIndex(f => f.entityGuid === entityGuid && f.fieldName === fieldName && f.target === target);\r\n    const oldFormulaItem = oldFormulaCache[oldFormulaIndex];\r\n\r\n    if (oldFormulaItem?.sourceFromSettings != null) {\r\n      this.updateFormulaFromEditor(entityGuid, fieldName, target, oldFormulaItem.sourceFromSettings, true);\r\n    } else if (oldFormulaIndex >= 0) {\r\n      const newCache = [...oldFormulaCache.slice(0, oldFormulaIndex), ...oldFormulaCache.slice(oldFormulaIndex + 1)];\r\n      this.formulaCache$.next(newCache);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used for showing formula result in editor.\r\n   * @param entityGuid \r\n   * @param fieldName \r\n   * @param target \r\n   * @param value \r\n   * @param isError \r\n   * @param isOnlyPromise \r\n   */\r\n  sendFormulaResultToUi(\r\n    entityGuid: string, fieldName: string, target: FormulaTarget, value: FieldValue, isError: boolean, isOnlyPromise: boolean\r\n  ): void {\r\n    const newResult: FormulaResult = {\r\n      entityGuid,\r\n      fieldName,\r\n      target,\r\n      value,\r\n      isError,\r\n      isOnlyPromise,\r\n    };\r\n\r\n    const oldResults = this.formulaResults$.value;\r\n    const oldResultIndex = oldResults.findIndex(r => r.entityGuid === entityGuid && r.fieldName === fieldName && r.target === target);\r\n    const newResults = oldResultIndex >= 0\r\n      ? [...oldResults.slice(0, oldResultIndex), newResult, ...oldResults.slice(oldResultIndex + 1)]\r\n      : [newResult, ...oldResults];\r\n    this.formulaResults$.next(newResults);\r\n  }\r\n\r\n  /**\r\n   * Used for getting formula result stream.\r\n   * @param entityGuid \r\n   * @param fieldName \r\n   * @param target \r\n   * @returns Formula result stream\r\n   */\r\n  getFormulaResult$(entityGuid: string, fieldName: string, target: FormulaTarget): Observable<FormulaResult> {\r\n    return this.formulaResults$.pipe(\r\n      map(results => results.find(r => r.entityGuid === entityGuid && r.fieldName === fieldName && r.target === target)),\r\n      distinctUntilChanged(GeneralHelpers.objectsEqual),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Used for opening or closing designer\r\n   * @param isOpen \r\n   */\r\n  setDesignerOpen(isOpen: boolean): void {\r\n    const newState: DesignerState = {\r\n      ...this.getDesignerState(),\r\n      isOpen,\r\n    };\r\n    this.setDesignerState(newState);\r\n  }\r\n\r\n  /**\r\n   * Used for setting designer state.\r\n   * @param activeDesigner \r\n   */\r\n  setDesignerState(activeDesigner: DesignerState): void {\r\n    this.designerState$.next(activeDesigner);\r\n  }\r\n\r\n  /**\r\n   * Used for getting designer state.\r\n   * @returns Designer state\r\n   */\r\n  getDesignerState(): DesignerState {\r\n    return this.designerState$.value;\r\n  }\r\n\r\n  /**\r\n   * Used for getting designer state stream.\r\n   * @returns Designer state stream\r\n   */\r\n  getDesignerState$(): Observable<DesignerState> {\r\n    return this.designerState$.pipe(distinctUntilChanged(GeneralHelpers.objectsEqual));\r\n  }\r\n\r\n  /**\r\n   * Used for building shared parts of formula cache item.\r\n   * @param item \r\n   * @param entityGuid \r\n   * @returns \r\n   */\r\n  private buildItemFormulaCacheSharedParts(item: EavItem, entityGuid: string): FormulaCacheItemShared {\r\n    item = item ?? this.itemService.getItem(entityGuid);\r\n    const entity = item.Entity;\r\n    const mdFor = entity.For;\r\n    const targetEntity: FormulaV1CtxTargetEntity = {\r\n      guid: entity.Guid,\r\n      id: entity.Id,\r\n      type: {\r\n        guid: entity.Type.Id,\r\n        name: entity.Type.Name,\r\n        // id: -999,\r\n      },\r\n      // New v15.04\r\n      for: {\r\n        targetType: mdFor?.TargetType ?? 0,\r\n        guid: mdFor?.Guid,\r\n        number: mdFor?.Number,\r\n        string: mdFor?.String,\r\n      },\r\n    };\r\n    const eavService = this.eavService;\r\n    const user = eavService.eavConfig.dialogContext.User;\r\n    const eavConfig = eavService.eavConfig;\r\n    return {\r\n      targetEntity,\r\n      user: {\r\n        email: user?.Email,\r\n        guid: user?.Guid,\r\n        id: user?.Id,\r\n        isAnonymous: user?.IsAnonymous,\r\n        isSiteAdmin: user?.IsSiteAdmin,\r\n        isContentAdmin: user?.IsContentAdmin,\r\n        isSystemAdmin: user?.IsSystemAdmin,\r\n        name: user?.Name,\r\n        username: user?.Username,\r\n      } as FormulaV1CtxUser,\r\n      app: {\r\n        appId: parseInt(eavConfig.appId, 10),\r\n        zoneId: parseInt(eavConfig.zoneId, 10),\r\n        isGlobal: eavConfig.dialogContext.App.IsGlobalApp,\r\n        isSite: eavConfig.dialogContext.App.IsSiteApp,\r\n        isContent: eavConfig.dialogContext.App.IsContentApp,\r\n        getSetting: (key: string) => undefined,\r\n      },\r\n      sxc: window.$2sxc({\r\n        zoneId: eavConfig.zoneId,\r\n        appId: eavConfig.appId,\r\n        pageId: eavConfig.tabId,\r\n        moduleId: eavConfig.moduleId,\r\n        _noContextInHttpHeaders: true,  // disable pageid etc. headers in http headers, because it would make debugging very hard\r\n        _autoAppIdsInUrl: true,         // auto-add appid and zoneid to url so formula developer can see what's happening\r\n      } as any),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Used for building formula cache.\r\n   * @returns \r\n   */\r\n  private buildFormulaCache(): FormulaCacheItem[] {\r\n    const formulaCache: FormulaCacheItem[] = [];\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const entityReader = new EntityReader(currentLanguage, defaultLanguage);\r\n\r\n    for (const entityGuid of this.eavService.eavConfig.itemGuids) {\r\n      const item = this.itemService.getItem(entityGuid);\r\n\r\n      const sharedParts = this.buildItemFormulaCacheSharedParts(item, entityGuid);\r\n\r\n      const contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n      const contentType = this.contentTypeService.getContentType(contentTypeId);\r\n      for (const attribute of contentType.Attributes) {\r\n        const settings = FieldsSettingsHelpers.setDefaultFieldSettings(\r\n          entityReader.flattenAll<FieldSettings>(attribute.Metadata),\r\n          // FieldsSettingsHelpers.mergeSettings<FieldSettings>(attribute.Metadata, defaultLanguage, defaultLanguage),\r\n        );\r\n        const formulaItems = this.contentTypeItemService.getContentTypeItems(settings.Formulas).filter(formulaItem => {\r\n          const enabled: boolean = LocalizationHelpers.translate(currentLanguage, defaultLanguage, formulaItem.Attributes.Enabled, null);\r\n          return enabled;\r\n        });\r\n        for (const formulaItem of formulaItems) {\r\n          const formula: string = LocalizationHelpers.translate(currentLanguage, defaultLanguage, formulaItem.Attributes.Formula, null);\r\n          if (formula == null) { continue; }\r\n\r\n          const target: FormulaTarget = LocalizationHelpers.translate(\r\n            currentLanguage, defaultLanguage, formulaItem.Attributes.Target, null\r\n          );\r\n\r\n          let formulaFunction: FormulaFunction;\r\n          try {\r\n            formulaFunction = FormulaHelpers.buildFormulaFunction(formula);\r\n          } catch (error) {\r\n            this.sendFormulaResultToUi(entityGuid, attribute.Name, target, undefined, true, false);\r\n            const itemTitle = FieldsSettingsHelpers.getContentTypeTitle(contentType, currentLanguage, defaultLanguage);\r\n            this.loggingService.addLog(LogSeverities.Error, `Error building formula for Entity: \"${itemTitle}\", Field: \"${attribute.Name}\", Target: \"${target}\"`, error);\r\n            this.loggingService.showMessage(this.translate.instant('Errors.FormulaConfiguration'), 2000);\r\n          }\r\n\r\n          const streams = this.createPromisedParts();\r\n\r\n          const formulaCacheItem: FormulaCacheItem = {\r\n            cache: {},\r\n            entityGuid,\r\n            fieldName: attribute.Name,\r\n            fn: formulaFunction?.bind({}),\r\n            isDraft: formulaFunction == null,\r\n            source: formula,\r\n            sourceFromSettings: formula,\r\n            sourceGuid: formulaItem.Guid,\r\n            sourceId: formulaItem.Id,\r\n            target,\r\n            version: FormulaHelpers.findFormulaVersion(formula),\r\n            targetEntity: sharedParts.targetEntity, // new v14.07.05\r\n            user: sharedParts.user,   // new in v14.07.05\r\n            app: sharedParts.app,   // new in v14.07.05\r\n            sxc: sharedParts.sxc,   // put in shared in 14.11\r\n            stopFormula: false,\r\n            promises$: streams.promises$,\r\n            updateCallback$: streams.callback$,\r\n          };\r\n\r\n          formulaCache.push(formulaCacheItem);\r\n        }\r\n      }\r\n    }\r\n\r\n    return formulaCache;\r\n  }\r\n\r\n  /**\r\n   * Used for pacing promises$ and callback$ triggers. Callback$ triggers for the first time when the last promise is resolved.\r\n   * @returns \r\n   */\r\n  private createPromisedParts() {\r\n    const promises$ = new BehaviorSubject<Promise<FieldValue | FormulaResultRaw>>(null);\r\n    const callback$ = new BehaviorSubject<(result: FieldValue | FormulaResultRaw) => void>(null);\r\n    const lastPromise = promises$.pipe(\r\n      filter(x => !!x),\r\n      switchMap(promise => from(promise)),\r\n    );\r\n    // This combineLatest triggers the callback for the first time when the last promise is resolved\r\n    this.subscription.add(combineLatest([lastPromise, callback$.pipe(filter(x => !!x))]).subscribe(\r\n      ([result, callback]) => {\r\n        callback(result);\r\n      },\r\n    ));\r\n\r\n    return { promises$, callback$ };\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { FieldSettings, FieldValue } from 'projects/edit-types';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { InputType } from '../../content-type-fields/models/input-type.model';\r\nimport { FeatureSummary } from '../../features/models';\r\nimport { FeaturesService } from '../../shared/services/features.service';\r\nimport { EntityReader } from '../shared/helpers';\r\nimport { ContentTypeSettings, FormValues, LogSeverities } from '../shared/models';\r\nimport { EavContentTypeAttribute, EavEntity, EavValues } from '../shared/models/eav';\r\nimport { EavService, EditInitializerService, FieldsSettingsService, LoggingService } from '../shared/services';\r\nimport { GlobalConfigService, ItemService, LanguageInstanceService, LanguageService } from '../shared/store/ngrx-data';\r\nimport { FormulaDesignerService } from './formula-designer.service';\r\nimport { FormulaHelpers } from './helpers/formula.helpers';\r\n// tslint:disable-next-line: max-line-length\r\nimport { FormulaCacheItem, FormulaFieldValidation, FormulaFunctionDefault, FormulaFunctionV1, FormulaTargets, FormulaVersions } from './models/formula.models';\r\nimport { FormulaSettingsHelper } from './helpers/formula-settings.helper';\r\nimport { FieldLogicBase } from '../form/shared/field-logic/field-logic-base';\r\nimport { FieldLogicTools } from '../form/shared/field-logic/field-logic-tools';\r\nimport { FormulaValueCorrections } from './helpers/formula-value-corrections.helper';\r\nimport { FormulaPromiseHandler } from './formula-promise-handler';\r\nimport { RunFormulasResult, FormulaResultRaw, FieldValuePair } from './models/formula-results.models';\r\nimport { ItemIdentifierShared } from '../../shared/models/edit-form.model';\r\n\r\n/**\r\n * Formula engine is responsible for running formulas and returning the result.\r\n */\r\n@Injectable()\r\nexport class FormulaEngine implements OnDestroy {\r\n  private subscription: Subscription = new Subscription();\r\n  private featuresCache$ = new BehaviorSubject<FeatureSummary[]>([]);\r\n  private contentTypeSettings$: BehaviorSubject<ContentTypeSettings>;\r\n  private fieldsSettingsService: FieldsSettingsService = null;\r\n  private formulaPromiseHandler: FormulaPromiseHandler = null;\r\n\r\n  constructor(\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private eavService: EavService,\r\n    private itemService: ItemService,\r\n    private languageService: LanguageService,\r\n    private formulaDesignerService: FormulaDesignerService,\r\n    private loggingService: LoggingService,\r\n    private translate: TranslateService,\r\n    private globalConfigService: GlobalConfigService,\r\n    private editInitializerService: EditInitializerService,\r\n    private featuresService: FeaturesService,\r\n  ) { }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  init(\r\n    fieldsSettingsService: FieldsSettingsService,\r\n    formulaPromiseHandler: FormulaPromiseHandler,\r\n    contentTypeSettings$: BehaviorSubject<ContentTypeSettings>) {\r\n    this.fieldsSettingsService = fieldsSettingsService;\r\n    this.formulaPromiseHandler = formulaPromiseHandler;\r\n    this.contentTypeSettings$ = contentTypeSettings$;\r\n    this.subscription.add(this.featuresService.getAll$().subscribe(this.featuresCache$));\r\n  }\r\n\r\n  /**\r\n   * Used for running all formulas for a given attribute/field.\r\n   * @param entityGuid \r\n   * @param entityId \r\n   * @param attribute \r\n   * @param formValues \r\n   * @param inputType \r\n   * @param logic \r\n   * @param settingsInitial \r\n   * @param settingsCurrent \r\n   * @param itemIdWithPrefill \r\n   * @param contentTypeMetadata \r\n   * @param attributeValues \r\n   * @param entityReader \r\n   * @param slotIsEmpty \r\n   * @param formReadOnly \r\n   * @param valueBefore \r\n   * @param logicTools \r\n   * @returns Object with all changes that formulas should make\r\n   */\r\n  runAllFormulas(\r\n    entityGuid: string,\r\n    entityId: number,\r\n    attribute: EavContentTypeAttribute,\r\n    formValues: FormValues,\r\n    inputType: InputType,\r\n    logic: FieldLogicBase,\r\n    settingsInitial: FieldSettings,\r\n    settingsCurrent: FieldSettings,\r\n    itemIdWithPrefill: ItemIdentifierShared,\r\n    contentTypeMetadata: EavEntity[],\r\n    attributeValues: EavValues<any>,\r\n    entityReader: EntityReader,\r\n    slotIsEmpty: boolean,\r\n    formReadOnly: boolean,\r\n    valueBefore: FieldValue,\r\n    logicTools: FieldLogicTools,\r\n  ): RunFormulasResult {\r\n    const formulas = this.formulaDesignerService.getFormulas(entityGuid, attribute.Name, null, false)\r\n      .filter(f => !f.stopFormula);\r\n    let formulaValue: FieldValue;\r\n    let formulaValidation: FormulaFieldValidation;\r\n    const formulaFields: FieldValuePair[] = [];\r\n    const settingsNew: Record<string, any> = {};\r\n\r\n    for (const formula of formulas) {\r\n      const formulaResult = this.runFormula(formula, entityId, formValues, inputType, settingsInitial, settingsCurrent, itemIdWithPrefill);\r\n      if (formulaResult?.promise instanceof Promise) {\r\n        this.formulaPromiseHandler.handleFormulaPromise(entityGuid, formulaResult, formula, inputType);\r\n        formula.stopFormula = formulaResult.stop ?? true;\r\n      } else {\r\n        formula.stopFormula = formulaResult.stop ?? formula.stopFormula;\r\n      }\r\n\r\n      if (formulaResult.fields)\r\n        formulaFields.push(...formulaResult.fields);\r\n\r\n      if (formulaResult.value === undefined) { continue; }\r\n\r\n      if (formula.target === FormulaTargets.Value) {\r\n        formulaValue = formulaResult.value;\r\n        continue;\r\n      }\r\n\r\n      if (formula.target === FormulaTargets.Validation) {\r\n        formulaValidation = formulaResult.value as unknown as FormulaFieldValidation;\r\n        continue;\r\n      }\r\n\r\n      FormulaSettingsHelper.keepSettingsIfTypeMatches(formula.target, settingsCurrent, formulaResult.value, settingsNew);\r\n    }\r\n\r\n    const updatedSettings = FormulaSettingsHelper.ensureNewSettingsMatchRequirements(\r\n      settingsInitial,\r\n      {\r\n        ...settingsCurrent,\r\n        ...settingsNew,\r\n      },\r\n      attribute,\r\n      contentTypeMetadata,\r\n      inputType,\r\n      logic,\r\n      attributeValues,\r\n      entityReader,\r\n      slotIsEmpty,\r\n      formReadOnly,\r\n      valueBefore,\r\n      logicTools,\r\n    );\r\n\r\n    const runFormulaResult: RunFormulasResult = {\r\n      settings: updatedSettings,\r\n      validation: formulaValidation,\r\n      value: formulaValue,\r\n      fields: formulaFields,\r\n    };\r\n    return runFormulaResult;\r\n  }\r\n\r\n  /**\r\n   * Used for getting formula setting key.\r\n   * @param fieldName \r\n   * @param currentLanguage \r\n   * @param defaultLanguage \r\n   * @returns formula setting key\r\n   */\r\n  private getFormulaSettingsKey(fieldName: string, currentLanguage: string, defaultLanguage: string): string {\r\n    return `fieldName:${fieldName}:currentLanguage:${currentLanguage}:defaultLanguage:${defaultLanguage}`;\r\n  }\r\n\r\n  /**\r\n   * Used for running a single formula and returning the result.\r\n   * @param formula \r\n   * @param entityId \r\n   * @param formValues \r\n   * @param inputType \r\n   * @param settingsInitial \r\n   * @param settingsCurrent \r\n   * @param itemIdWithPrefill \r\n   * @returns Result of a single formula.\r\n   */\r\n  private runFormula(\r\n    formula: FormulaCacheItem,\r\n    entityId: number,\r\n    formValues: FormValues,\r\n    inputType: InputType,\r\n    settingsInitial: FieldSettings,\r\n    settingsCurrent: FieldSettings,\r\n    itemIdWithPrefill: ItemIdentifierShared,\r\n  ): FormulaResultRaw {\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const languages = this.languageService.getLanguages();\r\n    const debugEnabled = this.globalConfigService.getDebugEnabled();\r\n    const initialFormValues = this.editInitializerService.getInitialValues(formula.entityGuid, currentLanguage);\r\n    const formulaProps = FormulaHelpers.buildFormulaProps(\r\n      formula,\r\n      entityId,\r\n      inputType,\r\n      settingsInitial,\r\n      settingsCurrent,\r\n      formValues,\r\n      initialFormValues,\r\n      currentLanguage,\r\n      defaultLanguage,\r\n      languages,\r\n      itemIdWithPrefill,\r\n      debugEnabled,\r\n      this.itemService,\r\n      this.eavService,\r\n      this.fieldsSettingsService,\r\n      this.featuresCache$.value,\r\n    );\r\n    const isOpenInDesigner = this.isDesignerOpen(formula);\r\n    const ctSettings = this.contentTypeSettings$.value;\r\n    try {\r\n      switch (formula.version) {\r\n        case FormulaVersions.V1:\r\n          if (isOpenInDesigner) {\r\n            console.log(`Running formula${formula.version.toLocaleUpperCase()} for Entity: \"${ctSettings._itemTitle}\", Field: \"${formula.fieldName}\", Target: \"${formula.target}\" with following arguments:`, formulaProps);\r\n          }\r\n          const formulaV1Result = (formula.fn as FormulaFunctionV1)(formulaProps.data, formulaProps.context, formulaProps.experimental);\r\n          const isArray = formulaV1Result && Array.isArray(formulaV1Result) && (formulaV1Result as any).every((r: any) => typeof r === 'string');\r\n          if (typeof formulaV1Result === 'string'\r\n            || typeof formulaV1Result === 'number'\r\n            || typeof formulaV1Result === 'boolean'\r\n            || formulaV1Result instanceof Date\r\n            || isArray\r\n            || !formulaV1Result) {\r\n            if (formula.target === FormulaTargets.Value) {\r\n              const valueV1 = {\r\n                value: FormulaValueCorrections.valueCorrection(formulaV1Result as FieldValue, inputType),\r\n                fields: [], stop: null, openInDesigner: isOpenInDesigner\r\n              } as FormulaResultRaw;\r\n              this.formulaDesignerService.sendFormulaResultToUi(\r\n                formula.entityGuid, formula.fieldName, formula.target, valueV1.value, false, false);\r\n              if (isOpenInDesigner) {\r\n                console.log('Formula result:', valueV1);\r\n              }\r\n              return valueV1;\r\n            }\r\n            return {\r\n              value: formulaV1Result, fields: [],\r\n              stop: null, openInDesigner: isOpenInDesigner\r\n            } as FormulaResultRaw;\r\n          }\r\n          console.error('V1 formulas accept only simple values in return statements. If you need to return an complex object, use V2 formulas.');\r\n          return { value: undefined, fields: [], stop: null, openInDesigner: isOpenInDesigner } as FormulaResultRaw;\r\n        case FormulaVersions.V2:\r\n          if (isOpenInDesigner) {\r\n            console.log(`Running formula${formula.version.toLocaleUpperCase()} for Entity: \"${ctSettings._itemTitle}\", Field: \"${formula.fieldName}\", Target: \"${formula.target}\" with following arguments:`, formulaProps);\r\n          }\r\n          const formulaV2Result = (formula.fn as FormulaFunctionV1)(formulaProps.data, formulaProps.context, formulaProps.experimental);\r\n          const valueV2 = FormulaValueCorrections.correctAllValues(formula.target, formulaV2Result, inputType);\r\n          valueV2.openInDesigner = isOpenInDesigner;\r\n          if (valueV2.value === undefined && valueV2.promise)\r\n            this.formulaDesignerService.sendFormulaResultToUi(\r\n              formula.entityGuid, formula.fieldName, formula.target, undefined, false, true);\r\n          else\r\n            this.formulaDesignerService.sendFormulaResultToUi(\r\n              formula.entityGuid, formula.fieldName, formula.target, valueV2.value, false, false);\r\n          if (isOpenInDesigner) {\r\n            console.log('Formula result:', valueV2.value);\r\n          }\r\n          return valueV2;\r\n        default:\r\n          if (isOpenInDesigner) {\r\n            console.log(`Running formula for Entity: \"${ctSettings._itemTitle}\", Field: \"${formula.fieldName}\", Target: \"${formula.target}\" with following arguments:`, undefined);\r\n          }\r\n          const formulaDefaultResult = (formula.fn as FormulaFunctionDefault)();\r\n          const valueDefault = FormulaValueCorrections.correctAllValues(formula.target, formulaDefaultResult, inputType);\r\n          valueDefault.openInDesigner = isOpenInDesigner;\r\n          this.formulaDesignerService.sendFormulaResultToUi(\r\n            formula.entityGuid, formula.fieldName, formula.target, valueDefault.value, false, false);\r\n          if (isOpenInDesigner) {\r\n            console.log('Formula result:', valueDefault);\r\n          }\r\n          return valueDefault;\r\n      }\r\n    } catch (error) {\r\n      const errorLabel = `Error in formula calculation for Entity: \"${ctSettings._itemTitle}\", Field: \"${formula.fieldName}\", Target: \"${formula.target}\"`;\r\n      this.formulaDesignerService.sendFormulaResultToUi(formula.entityGuid, formula.fieldName, formula.target, undefined, true, false);\r\n      this.loggingService.addLog(LogSeverities.Error, errorLabel, error);\r\n      if (isOpenInDesigner) {\r\n        console.error(errorLabel, error);\r\n      } else {\r\n        this.loggingService.showMessage(this.translate.instant('Errors.FormulaCalculation'), 2000);\r\n      }\r\n      return { value: undefined, fields: [], stop: null, openInDesigner: isOpenInDesigner } as FormulaResultRaw;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used for checking if formula is open in designer.\r\n   * @param formula \r\n   * @returns True if formula is open in designer, otherwise false\r\n   */\r\n  private isDesignerOpen(formula: FormulaCacheItem): boolean {\r\n    const designerState = this.formulaDesignerService.getDesignerState();\r\n    const isOpenInDesigner = designerState.isOpen\r\n      && designerState.entityGuid === formula.entityGuid\r\n      && designerState.fieldName === formula.fieldName\r\n      && designerState.target === formula.target;\r\n    return isOpenInDesigner;\r\n  }\r\n}\r\n","import { FormValues } from \"../../shared/models\";\r\nimport { FieldValuePair, FieldSettingPair } from \"./formula-results.models\";\r\n\r\nexport class FormulaPromiseResult {\r\n  constructor(\r\n    valueUpdates: FormValues,\r\n    fieldUpdates: FieldValuePair[],\r\n    settingUpdates: FieldSettingPair[]\r\n  ) {\r\n    this.valueUpdates = valueUpdates;\r\n    this.fieldUpdates = fieldUpdates;\r\n    this.settingUpdates = settingUpdates;\r\n  }\r\n\r\n  valueUpdates: FormValues;\r\n  fieldUpdates: FieldValuePair[];\r\n  settingUpdates: FieldSettingPair[];\r\n}\r\n","import { FieldValue } from \"projects/edit-types\";\r\nimport { InputType } from \"../../content-type-fields/models/input-type.model\";\r\nimport { consoleLogAngular } from \"../../shared/helpers/console-log-angular.helper\";\r\nimport { FieldLogicTools } from \"../form/shared/field-logic/field-logic-tools\";\r\nimport { EntityReader } from \"../shared/helpers\";\r\nimport { FormValues, FieldsProps } from \"../shared/models\";\r\nimport { EavContentType, EavContentTypeAttribute, EavEntity, EavEntityAttributes } from \"../shared/models/eav\";\r\nimport { ConstantFieldParts } from \"./models/constant-field-parts.model\";\r\nimport { FormulaPromiseResult } from \"./models/formula-promise-result.model\";\r\nimport { FormulaSettingsHelper } from \"./helpers/formula-settings.helper\";\r\nimport { FormulaValueCorrections } from \"./helpers/formula-value-corrections.helper\";\r\nimport { FormulaCacheItem, FormulaTargets, SettingsFormulaPrefix } from \"./models/formula.models\";\r\nimport { Injectable } from \"@angular/core\";\r\nimport { FieldsSettingsService } from \"../shared/services\";\r\nimport { FormulaResultRaw, FieldSettingPair } from \"./models/formula-results.models\";\r\nimport { FormItemFormulaService } from \"./form-item-formula.service\";\r\n\r\n/**\r\n * FormulaPromiseHandler is responsible for handling the promise parts of formula results.\r\n */\r\n@Injectable()\r\nexport class FormulaPromiseHandler {\r\n  private fieldsSettingsService: FieldsSettingsService = null;\r\n\r\n  constructor() { }\r\n\r\n  init(fieldsSettingsService: FieldsSettingsService) {\r\n    this.fieldsSettingsService = fieldsSettingsService;\r\n  }\r\n\r\n  /**\r\n   * Used for filling queue and triggering next run.\r\n   * @param entityGuid \r\n   * @param resultWithPromise \r\n   * @param formulaCache \r\n   * @param inputType \r\n   */\r\n  handleFormulaPromise(\r\n    entityGuid: string,\r\n    resultWithPromise: FormulaResultRaw,\r\n    formulaCache: FormulaCacheItem,\r\n    inputType: InputType,\r\n  ) {\r\n    consoleLogAngular(\"formula promise\", formulaCache.target, resultWithPromise);\r\n    if (resultWithPromise.openInDesigner && resultWithPromise.stop === null) {\r\n      console.log(`FYI: formula returned a promise. This automatically stops this formula from running again. If you want it to continue running, return stop: false`);\r\n    }\r\n    formulaCache.promises$.next(resultWithPromise.promise);\r\n    this.DefineCallbackHandlerIfMissing(formulaCache, inputType, entityGuid);\r\n  }\r\n\r\n  /**\r\n   * Used for defining the callback handler for the promise if it doesn't already exist and filling queue for the next run.\r\n   * @param formulaCache \r\n   * @param inputType \r\n   * @param entityGuid \r\n   */\r\n  private DefineCallbackHandlerIfMissing(\r\n    formulaCache: FormulaCacheItem,\r\n    inputType: InputType,\r\n    entityGuid: string,\r\n  ) {\r\n    if (!formulaCache.updateCallback$.value) {\r\n      const queue = this.fieldsSettingsService.updateValueQueue;\r\n      formulaCache.updateCallback$.next((result: FieldValue | FormulaResultRaw) => {\r\n        const corrected = FormulaValueCorrections.correctAllValues(formulaCache.target, result, inputType);\r\n\r\n        const queueItem = queue[entityGuid] ?? new FormulaPromiseResult({}, [], []);\r\n        let valueUpdates: FormValues = {};\r\n        let settingUpdate: FieldSettingPair[] = [];\r\n\r\n        if (formulaCache.target === FormulaTargets.Value) {\r\n          valueUpdates = queueItem.valueUpdates ?? {};\r\n          valueUpdates[formulaCache.fieldName] = corrected.value;\r\n\r\n        } else if (formulaCache.target.startsWith(SettingsFormulaPrefix)) {\r\n          consoleLogAngular(\"formula promise settings\");\r\n          const settingName = formulaCache.target.substring(SettingsFormulaPrefix.length);\r\n          settingUpdate = queueItem.settingUpdates ?? [];\r\n          const newSetting = { name: formulaCache.fieldName, settings: [{ settingName, value: result as FieldValue }] };\r\n          settingUpdate = settingUpdate.filter(s => s.name !== formulaCache.fieldName && !s.settings.find(ss => ss.settingName === settingName));\r\n          settingUpdate.push(newSetting);\r\n        }\r\n\r\n        const fieldsUpdates = queueItem.fieldUpdates ?? [];\r\n        if (corrected.fields)\r\n          fieldsUpdates.push(...corrected.fields);\r\n        queue[entityGuid] = new FormulaPromiseResult(valueUpdates, fieldsUpdates, settingUpdate);\r\n        formulaCache.stopFormula = corrected.stop ?? formulaCache.stopFormula;\r\n        this.fieldsSettingsService.retriggerFormulas();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used for updating values and cleaning settings from queue.\r\n   * @param entityGuid \r\n   * @param queue \r\n   * @param contentType \r\n   * @param formValues \r\n   * @param fieldsProps \r\n   * @param slotIsEmpty \r\n   * @param entityReader \r\n   * @param latestFieldProps \r\n   * @param attributes \r\n   * @param contentTypeMetadata \r\n   * @param constantFieldParts \r\n   * @param itemAttributes \r\n   * @param formReadOnly \r\n   * @param logicTools \r\n   * @param formItemFormulaService \r\n   * @returns true if values were updated, false otherwise and new field props\r\n   */\r\n  updateValuesFromQueue(\r\n    entityGuid: string,\r\n    queue: Record<string, FormulaPromiseResult>,\r\n    contentType: EavContentType,\r\n    formValues: FormValues,\r\n    fieldsProps: FieldsProps,\r\n    slotIsEmpty: boolean,\r\n    entityReader: EntityReader,\r\n    latestFieldProps: FieldsProps,\r\n    attributes: EavContentTypeAttribute[],\r\n    contentTypeMetadata: EavEntity[],\r\n    constantFieldParts: ConstantFieldParts[],\r\n    itemAttributes: EavEntityAttributes,\r\n    formReadOnly: boolean,\r\n    logicTools: FieldLogicTools,\r\n    formItemFormulaService: FormItemFormulaService,\r\n  ): { valuesUpdated: boolean, newFieldProps: FieldsProps } {\r\n    if (queue[entityGuid] == null) return { valuesUpdated: false, newFieldProps: null };\r\n    const toProcess = queue[entityGuid];\r\n    queue[entityGuid] = { valueUpdates: {}, fieldUpdates: [], settingUpdates: [] };\r\n    // extract updates and flush queue\r\n    const values = toProcess.valueUpdates;\r\n    const fields = toProcess.fieldUpdates;\r\n    const allSettings = toProcess.settingUpdates;\r\n\r\n    let valuesUpdated = false;\r\n    if (Object.keys(values).length !== 0 || fields.length !== 0) {\r\n      formItemFormulaService.applyValueChangesFromFormulas(\r\n        entityGuid, contentType, formValues, fieldsProps, values, fields, slotIsEmpty, entityReader\r\n      );\r\n      valuesUpdated = true;\r\n    }\r\n\r\n    let newFieldProps: FieldsProps = null;\r\n    if (allSettings.length) {\r\n      newFieldProps = { ...fieldsProps };\r\n      allSettings.forEach(valueSet => {\r\n        const settingsNew: Record<string, any> = {};\r\n        const settingsCurrent = latestFieldProps[valueSet.name]?.settings;\r\n        const constantFieldPart = constantFieldParts.find(f => f.constants.fieldName === valueSet.name);\r\n        valueSet.settings.forEach(setting => {\r\n          FormulaSettingsHelper.keepSettingsIfTypeMatches(SettingsFormulaPrefix + setting.settingName, settingsCurrent, setting.value, settingsNew);\r\n        });\r\n\r\n        const updatedSettings = FormulaSettingsHelper.ensureNewSettingsMatchRequirements(\r\n          constantFieldPart.settingsInitial,\r\n          {\r\n            ...settingsCurrent,\r\n            ...settingsNew,\r\n          },\r\n          attributes.find(a => a.Name === valueSet.name),\r\n          contentTypeMetadata,\r\n          constantFieldPart.inputType,\r\n          constantFieldPart.logic,\r\n          itemAttributes[valueSet.name],\r\n          entityReader,\r\n          slotIsEmpty,\r\n          formReadOnly,\r\n          formValues[valueSet.name],\r\n          logicTools,\r\n        );\r\n\r\n        newFieldProps[valueSet.name] = { ...newFieldProps[valueSet.name], settings: updatedSettings };\r\n      });\r\n    }\r\n\r\n    return { valuesUpdated, newFieldProps };\r\n  }\r\n}","export const requiredFormulaPrefix = 'function ';\r\n\r\n// 2022-07-05 2dm had to fix 'v1' because somehow a 'v1 ' was expected\r\nexport const formV1Prefix = 'v1';\r\n\r\nconst defaultFormulaV1 = `${requiredFormulaPrefix}v1 (data, context) {\r\n  return data.value;\r\n}`;\r\n\r\nexport const formV2Prefix = 'v2';\r\n\r\nconst defaultFormulaV2 = `// new formula syntax - see https://r.2sxc.org/formulas\r\nv2((data, context) => {\r\n  return data.value;\r\n});`;\r\n\r\nexport const defaultFormulaNow = defaultFormulaV2;\r\n","import { FieldSettings, FieldValue } from \"projects/edit-types\";\r\nimport { InputType } from \"../../../content-type-fields/models/input-type.model\";\r\nimport { consoleLogAngular } from \"../../../shared/helpers/console-log-angular.helper\";\r\nimport { LanguageState } from \"../../../shared/models/language-state\";\r\nimport { FieldLogicBase } from \"../../form/shared/field-logic/field-logic-base\";\r\nimport { FieldLogicTools } from \"../../form/shared/field-logic/field-logic-tools\";\r\nimport { ValidationHelpers, FieldsSettingsHelpers } from \"../../shared/helpers\";\r\nimport { EavContentTypeAttribute, EavEntity, EavValues } from \"../../shared/models/eav\";\r\nimport { SettingsFormulaPrefix } from \"../models/formula.models\";\r\n\r\n/**\r\n * Contains methods for updating settings from formulas.\r\n */\r\nexport class FormulaSettingsHelper {\r\n\r\n  /**\r\n   * Used for calculating new settings.\r\n   * @param settingsInitial Default settings\r\n   * @param settingsCurrent Last settings\r\n   * @param attribute \r\n   * @param contentTypeMetadata \r\n   * @param fieldInputType \r\n   * @param fieldLogic \r\n   * @param attributeValues \r\n   * @param languages \r\n   * @param slotIsEmpty If slot is empty\r\n   * @param formReadOnly Is form read only\r\n   * @param valueBefore \r\n   * @param logicTools \r\n   * @returns Calculated settings\r\n   */\r\n  static ensureNewSettingsMatchRequirements(\r\n    settingsInitial: FieldSettings,\r\n    settingsCurrent: FieldSettings,\r\n    attribute: EavContentTypeAttribute,\r\n    contentTypeMetadata: EavEntity[],\r\n    fieldInputType: InputType,\r\n    fieldLogic: FieldLogicBase,\r\n    attributeValues: EavValues<any>,\r\n    languages: LanguageState,\r\n    slotIsEmpty: boolean,\r\n    formReadOnly: boolean,\r\n    valueBefore: FieldValue,\r\n    logicTools: FieldLogicTools,\r\n  ): FieldSettings {\r\n    settingsCurrent.Name = settingsCurrent.Name || attribute.Name;\r\n    settingsCurrent.Required = ValidationHelpers.isRequired(settingsCurrent);\r\n    const disableTranslation = FieldsSettingsHelpers.findDisableTranslation(\r\n      contentTypeMetadata, fieldInputType, attributeValues, languages.defaultLanguage, attribute.Metadata,\r\n    );\r\n    settingsCurrent.DisableTranslation = slotIsEmpty || disableTranslation;\r\n    settingsCurrent._disabledBecauseOfTranslation = FieldsSettingsHelpers.getDisabledBecauseTranslations(\r\n      attributeValues, settingsCurrent.DisableTranslation, languages.currentLanguage, languages.defaultLanguage,\r\n    );\r\n    settingsCurrent.ForcedDisabled = slotIsEmpty || settingsCurrent._disabledBecauseOfTranslation || formReadOnly;\r\n    // newSettings.Disabled = newSettings.Disabled || slotIsEmpty || newSettings._disabledBecauseOfTranslation || formReadOnly;\r\n    settingsCurrent.DisableAutoTranslation = settingsInitial.DisableAutoTranslation || settingsCurrent.DisableTranslation;\r\n\r\n    // update settings with respective FieldLogics\r\n    const fixed = fieldLogic?.update(settingsCurrent, valueBefore, logicTools) ?? settingsCurrent;\r\n    consoleLogAngular('fixed', JSON.parse(JSON.stringify(fixed)));\r\n\r\n    return fixed;\r\n  }\r\n\r\n  /**\r\n   * Possibly updates setting with formula result if target and type matches.\r\n   * @param target Formula target\r\n   * @param settings Last/Current settings\r\n   * @param formulaResult Formula result needed for type checking\r\n   * @param settingsNew Settings that are possibly updated\r\n   * @returns True if setting is updated, false if it is not\r\n   */\r\n  static keepSettingsIfTypeMatches(\r\n    target: string,\r\n    settings: FieldSettings,\r\n    formulaResult: FieldValue,\r\n    settingsNew: Record<string, any>\r\n  ): boolean {\r\n    if (target.startsWith(SettingsFormulaPrefix)) {\r\n      const settingName = target.substring(SettingsFormulaPrefix.length);\r\n      const prevSetting = (settings as Record<string, any>)[settingName];\r\n\r\n      const keepNewSetting = (prevSetting == null || formulaResult == null) // can't check types, hope for the best\r\n        || (Array.isArray(prevSetting) && Array.isArray(formulaResult)) // can't check types of items in array, hope for the best\r\n        || (typeof prevSetting === typeof formulaResult); // maybe typesafe\r\n\r\n      if (keepNewSetting) {\r\n        settingsNew[settingName] = formulaResult;\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}","import { FieldValue } from \"projects/edit-types\";\r\nimport { DataTypeConstants } from \"../../../content-type-fields/constants/data-type.constants\";\r\nimport { InputTypeConstants } from \"../../../content-type-fields/constants/input-type.constants\";\r\nimport { InputType } from \"../../../content-type-fields/models/input-type.model\";\r\nimport { FormulaTarget, FormulaTargets } from \"../models/formula.models\";\r\nimport { FormulaResultRaw } from \"../models/formula-results.models\";\r\n\r\n/**\r\n * Contains methods for correcting formula results.\r\n */\r\nexport class FormulaValueCorrections {\r\n\r\n  /**\r\n   * This method is used to support ducktyping in the formula result and from it to fill FormulaResultRaw object with corrected values.\r\n   * @param target Formula target\r\n   * @param result Formula result\r\n   * @param inputType InputType is needed to check if the result is a date which needs to be corrected\r\n   * @returns Strongly typed FormulaResultRaw object\r\n   */\r\n  static correctAllValues(target: FormulaTarget, result: FieldValue | FormulaResultRaw, inputType: InputType): FormulaResultRaw {\r\n    const stop = (result as FormulaResultRaw)?.stop ?? null;\r\n    if (result === null || result === undefined)\r\n      return { value: result as FieldValue, fields: [], stop };\r\n    if (typeof result === 'object') {\r\n      if (result instanceof Date && target === FormulaTargets.Value)\r\n        return { value: this.valueCorrection(result as FieldValue, inputType), fields: [], stop };\r\n      if (result instanceof Promise)\r\n        return { value: undefined, promise: result as Promise<FormulaResultRaw>, fields: [], stop };\r\n      const corrected: FormulaResultRaw = (result as FormulaResultRaw);\r\n      corrected.stop = stop;\r\n      if ((result as FormulaResultRaw).value && target === FormulaTargets.Value) {\r\n        corrected.value = this.valueCorrection((result as FormulaResultRaw).value, inputType);\r\n      }\r\n      if ((result as FormulaResultRaw).fields) {\r\n        corrected.fields = (result as FormulaResultRaw).fields?.map((fields) => {\r\n          fields.value = this.valueCorrection(fields.value, inputType);\r\n          return fields;\r\n        });\r\n        return corrected;\r\n      }\r\n      return corrected;\r\n    }\r\n    const value: FormulaResultRaw = { value: result as FieldValue };\r\n\r\n    // atm we are only correcting Value formulas\r\n    if (target === FormulaTargets.Value) {\r\n      return { value: this.valueCorrection(value.value, inputType), fields: [], stop };\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Used to correct datetime field value from formula result.\r\n   * @param value Field value from formula result\r\n   * @param inputType InputType is needed to check if the result is a date which needs to be corrected\r\n   * @returns Corrected field value\r\n   */\r\n  static valueCorrection(value: FieldValue, inputType: InputType): FieldValue {\r\n    if (value == null) {\r\n      return value;\r\n    } else if (inputType?.Type === InputTypeConstants.DatetimeDefault) {\r\n      const date = new Date(value as string | number | Date);\r\n\r\n      // if value is not ISO string, nor milliseconds, correct timezone\r\n      if (!(typeof value === 'string' && value.endsWith('Z')) && date.getTime() !== value) {\r\n        date.setTime(date.getTime() - date.getTimezoneOffset() * 60000);\r\n      }\r\n\r\n      date.setMilliseconds(0);\r\n      return date.toJSON();\r\n    } else if (typeof (value) !== 'string' && (inputType?.Type?.startsWith(DataTypeConstants.String.toLocaleLowerCase())\r\n      || inputType?.Type?.startsWith(DataTypeConstants.Hyperlink.toLocaleLowerCase()))) {\r\n      return value.toString();\r\n    }\r\n    return value;\r\n  }\r\n}","import { FieldSettings, FieldValue } from '../../../../../../edit-types';\r\nimport { InputType } from '../../../content-type-fields/models/input-type.model';\r\nimport { FeatureSummary } from '../../../features/models';\r\nimport { DesignerSnippet, FieldOption } from '../../dialog/footer/formula-designer/formula-designer.models';\r\nimport { InputFieldHelpers, LocalizationHelpers } from '../../shared/helpers';\r\nimport { FormValues, Language } from '../../shared/models';\r\nimport { EavService, FieldsSettingsService } from '../../shared/services';\r\nimport { ItemService } from '../../shared/store/ngrx-data';\r\n\r\n// Import the type definitions for intellisense\r\nimport editorTypesForIntellisense from '!raw-loader!../editor-intellisense-function-v2.rawts';\r\nimport { formV1Prefix, requiredFormulaPrefix } from '../formula.constants';\r\n// tslint:disable-next-line: max-line-length\r\nimport { FormulaCacheItem, FormulaFieldValidation, FormulaFunction, FormulaProps, FormulaPropsV1, FormulaTargets, FormulaV1Data, FormulaV1ExperimentalEntity, FormulaVersion, FormulaVersions, SettingsFormulaPrefix } from '../models/formula.models';\r\nimport { ItemIdentifierShared } from '../../../shared/models/edit-form.model';\r\n\r\n/**\r\n * Contains methods for building formulas.\r\n */\r\nexport class FormulaHelpers {\r\n\r\n  /**\r\n   * Used to clean formula text.\r\n   * @param formula Formula text to clean\r\n   * @returns Cleaned formula text\r\n   */\r\n  private static cleanFormula(formula: string): string {\r\n    if (!formula) { return formula; }\r\n\r\n    // Clean and remove any leading single-line comments\r\n    let cleanFormula = formula.trim();\r\n    if (cleanFormula.startsWith('//')) {\r\n      cleanFormula = cleanFormula.replace(/^\\/\\/.*\\n/gm, '').trim();\r\n    }\r\n    /*\r\n      Valid function string:\r\n      function NAME (...ARGS) { BODY }\r\n\r\n      Must build function string for these inputs:\r\n      v1 (...ARGS) { BODY }\r\n      function v1 (...ARGS) { BODY }\r\n      v2((...ARGS) => { BODY });\r\n\r\n      Everything else is ignored.\r\n      TODO: do this properly with regex if it's not too slow\r\n    */\r\n\r\n    if (cleanFormula.startsWith(formV1Prefix)) {\r\n      cleanFormula = `${requiredFormulaPrefix}${cleanFormula}`;\r\n    } else if (cleanFormula.startsWith(`${requiredFormulaPrefix}${formV1Prefix}`)) {\r\n      cleanFormula = cleanFormula;\r\n    } else if (cleanFormula.startsWith('v2(')) {\r\n      cleanFormula = cleanFormula.substring(3, cleanFormula.lastIndexOf('}') + 1);\r\n      cleanFormula = cleanFormula.replace('=>', '');\r\n      cleanFormula = `${requiredFormulaPrefix}v2 ${cleanFormula}`;\r\n    }\r\n    return cleanFormula;\r\n  }\r\n\r\n  /**\r\n   * Used to find formula version.\r\n   * @param formula Formula text\r\n   * @returns If formula is V1 or V2\r\n   */\r\n  static findFormulaVersion(formula: string): FormulaVersion {\r\n    const cleanFormula = this.cleanFormula(formula);\r\n    const versionPart = cleanFormula.substring(requiredFormulaPrefix.length, cleanFormula.indexOf('(')).trim();\r\n    const validVersions = Object.values(FormulaVersions);\r\n\r\n    return (validVersions).includes(versionPart as FormulaVersion)\r\n      ? versionPart as FormulaVersion\r\n      : undefined;\r\n  }\r\n\r\n  /**\r\n   * Used to build executable formula function from formula text.\r\n   * @param formula Formula text\r\n   * @returns Executable formula function\r\n   */\r\n  static buildFormulaFunction(formula: string): FormulaFunction {\r\n    const cleanFormula = this.cleanFormula(formula);\r\n    const fn: FormulaFunction = new Function(`return ${cleanFormula}`)();\r\n    return fn;\r\n  }\r\n\r\n  /**\r\n   * Used to build formula props parameters.\r\n   * @param formula \r\n   * @param entityId \r\n   * @param inputType \r\n   * @param settingsInitial \r\n   * @param settingsCurrent \r\n   * @param formValues \r\n   * @param initialFormValues \r\n   * @param currentLanguage \r\n   * @param defaultLanguage \r\n   * @param languages \r\n   * @param itemHeader \r\n   * @param debugEnabled \r\n   * @param itemService \r\n   * @param eavService \r\n   * @param fieldsSettingsService \r\n   * @param features \r\n   * @returns Formula properties\r\n   */\r\n  static buildFormulaProps(\r\n    formula: FormulaCacheItem,\r\n    entityId: number,\r\n    inputType: InputType,\r\n    settingsInitial: FieldSettings,\r\n    settingsCurrent: FieldSettings,\r\n    formValues: FormValues,\r\n    initialFormValues: FormValues,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n    languages: Language[],\r\n    itemHeader: ItemIdentifierShared,\r\n    debugEnabled: boolean,\r\n    itemService: ItemService,\r\n    eavService: EavService,\r\n    fieldsSettingsService: FieldsSettingsService,\r\n    features: FeatureSummary[],\r\n  ): FormulaProps {\r\n    // console.log('2dm - buildFormulaProps()');\r\n    switch (formula.version) {\r\n      case FormulaVersions.V1:\r\n      case FormulaVersions.V2:\r\n        const data: FormulaV1Data = {\r\n          ...formValues,\r\n          get default() { return undefined as FieldValue; },\r\n          get initial() { return undefined as FieldValue; },\r\n          get parameters() { return undefined as Record<string, any>; },\r\n          get prefill() { return undefined as FieldValue; },\r\n          get value() { return undefined as FieldValue; },\r\n          get settings() { return undefined as unknown; },\r\n        };\r\n        Object.defineProperties(data, {\r\n          default: {\r\n            get(): FieldValue {\r\n              if (formula.target === FormulaTargets.Value) {\r\n                return InputFieldHelpers.parseDefaultValue(formula.fieldName, inputType, settingsInitial);\r\n              }\r\n              if (formula.target.startsWith(SettingsFormulaPrefix)) {\r\n                const settingName = formula.target.substring(SettingsFormulaPrefix.length);\r\n                return (settingsInitial as Record<string, any>)[settingName];\r\n              }\r\n            },\r\n          },\r\n          initial: {\r\n            get(): FieldValue {\r\n              if (formula.target !== FormulaTargets.Value) { return; }\r\n              return initialFormValues[formula.fieldName];\r\n            },\r\n          },\r\n          parameters: {\r\n            get(): Record<string, any> {\r\n              return FormulaHelpers.buildFormulaPropsParameters(itemHeader.Prefill);\r\n            },\r\n          },\r\n          prefill: {\r\n            get(): FieldValue {\r\n              if (formula.target !== FormulaTargets.Value) { return; }\r\n              return InputFieldHelpers.parseDefaultValue(formula.fieldName, inputType, settingsInitial, itemHeader, true);\r\n            },\r\n          },\r\n          value: {\r\n            get(): FieldValue {\r\n              if (formula.target === FormulaTargets.Value) {\r\n                return formValues[formula.fieldName];\r\n              }\r\n              if (formula.target === FormulaTargets.Validation) {\r\n                const formulaValidation: FormulaFieldValidation = {\r\n                  severity: '',\r\n                  message: '',\r\n                };\r\n                return formulaValidation as unknown as FieldValue;\r\n              }\r\n              if (formula.target.startsWith(SettingsFormulaPrefix)) {\r\n                const settingName = formula.target.substring(SettingsFormulaPrefix.length);\r\n                return (settingsCurrent as Record<string, any>)[settingName];\r\n              }\r\n            },\r\n          },\r\n        });\r\n\r\n        const propsV1: FormulaPropsV1 = {\r\n          data,\r\n          context: {\r\n            app: {\r\n              ...formula.app,\r\n              getSetting: (settingPath: string) => {\r\n                if (formula.version === FormulaVersions.V1) {\r\n                  console.warn('app.getSetting() is not available in v1 formulas, please use v2.');\r\n                  return ' error - see console';\r\n                }\r\n                const result = eavService.eavConfig.settings.Values[settingPath];\r\n                if (result != null) return result;\r\n                console.warn(`Error: Setting '${settingPath}' not found. Did you configure it in the ContentType to be included? ` +\r\n                  `See https://r.2sxc.org/formulas`);\r\n                return ' error - see console';\r\n              },\r\n            },\r\n            cache: formula.cache,\r\n            culture: {\r\n              code: currentLanguage,\r\n              name: languages.find(l => l.NameId === currentLanguage)?.Culture,\r\n            },\r\n            debug: debugEnabled,\r\n            features: {\r\n              isEnabled(name: string): boolean {\r\n                return features.find(f => f.NameId === name)?.Enabled ?? false;\r\n              },\r\n            },\r\n            form: {\r\n              runFormulas(): void {\r\n                if (formula.version === FormulaVersions.V1) {\r\n                  console.warn('form.runFormulas() is being deprecated. Use V2 formulas and return the promise. Formulas will auto-run when it completes.');\r\n                  fieldsSettingsService.retriggerFormulas();\r\n                } else if (formula.version === FormulaVersions.V2) {\r\n                  console.error('form.runFormulas() is not supported in V2 formulas. Just return the promise. Formulas will auto-run when it completes.');\r\n                }\r\n              },\r\n            },\r\n            // WIP v14.11 move sxc to cache like app - must watch a bit till ca. Dec 2022 to ensure caching is ok for this\r\n            sxc: formula.sxc,\r\n            target: {\r\n              entity: formula.targetEntity,\r\n              name: formula.target === FormulaTargets.Value || formula.target === FormulaTargets.Validation\r\n                ? formula.fieldName\r\n                : formula.target.substring(formula.target.lastIndexOf('.') + 1),\r\n              type: formula.target === FormulaTargets.Value || formula.target === FormulaTargets.Validation\r\n                ? formula.target\r\n                : formula.target.substring(0, formula.target.lastIndexOf('.')),\r\n            },\r\n            user: formula.user,\r\n          },\r\n          experimental: {\r\n            getEntities(): FormulaV1ExperimentalEntity[] {\r\n              const v1Entities = itemService.getItems(eavService.eavConfig.itemGuids).map(item => {\r\n                const v1Entity: FormulaV1ExperimentalEntity = {\r\n                  guid: item.Entity.Guid,\r\n                  id: item.Entity.Id,\r\n                  type: {\r\n                    id: item.Entity.Type.Id,  // TODO: deprecate again, once we know it's not in use #cleanFormulaType\r\n                    guid: item.Entity.Type.Id,\r\n                    name: item.Entity.Type.Name,\r\n                  }\r\n                };\r\n                return v1Entity;\r\n              });\r\n              return v1Entities;\r\n            },\r\n            getSettings(fieldName: string): FieldSettings {\r\n              return fieldsSettingsService.getFieldSettings(fieldName);\r\n            },\r\n            getValues(entityGuid: string): FormValues {\r\n              const item = itemService.getItem(entityGuid);\r\n              const values: FormValues = {};\r\n              for (const [fieldName, fieldValues] of Object.entries(item.Entity.Attributes)) {\r\n                values[fieldName] = LocalizationHelpers.translate(currentLanguage, defaultLanguage, fieldValues, null);\r\n              }\r\n              return values;\r\n            }\r\n          }\r\n        };\r\n        return propsV1;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used to build the formula props parameters as a record of key-value pairs.\r\n   * @param prefillAsParameters \r\n   * @returns \r\n   */\r\n  static buildFormulaPropsParameters(prefillAsParameters: Record<string, unknown>): Record<string, any> {\r\n    return prefillAsParameters ? JSON.parse(JSON.stringify(prefillAsParameters)) : {};\r\n  }\r\n\r\n  /**\r\n   * Used to build the designer snippets for use in formulas.\r\n   * @param formula \r\n   * @param fieldOptions \r\n   * @param itemHeader \r\n   * @returns Designer snippets for use in formulas\r\n   */\r\n  static buildDesignerSnippetsData(formula: FormulaCacheItem, fieldOptions: FieldOption[], prefillAsParameters: Record<string, unknown>): DesignerSnippet[] {\r\n    switch (formula.version) {\r\n      case FormulaVersions.V1:\r\n        const formulaPropsParameters = this.buildFormulaPropsParameters(prefillAsParameters);\r\n        const snippets = [\r\n          'value',\r\n          'default',\r\n          'prefill',\r\n          'initial',\r\n          ...fieldOptions.map(f => f.fieldName),\r\n          'parameters.ChangeThis',\r\n          ...Object.keys(formulaPropsParameters).map(key => `parameters.${key}`),\r\n        ].map(name => {\r\n          const code = `data.${name}`;\r\n          const fieldSnippet: DesignerSnippet = {\r\n            code,\r\n            label: code,\r\n          };\r\n          return fieldSnippet;\r\n        });\r\n        return snippets;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used to build the designer snippets context for use in formulas.\r\n   * @param formula \r\n   * @returns Designer snippets context for use in formulas\r\n   */\r\n  static buildDesignerSnippetsContext(formula: FormulaCacheItem): DesignerSnippet[] {\r\n    switch (formula.version) {\r\n      case FormulaVersions.V1:\r\n        const snippets = [\r\n          'app.appId',\r\n          'app.zoneId',\r\n          'app.isGlobal',\r\n          'app.isSite',\r\n          'app.isContent',\r\n          'cache.ChangeThis',\r\n          'culture.code',\r\n          'culture.name',\r\n          'debug',\r\n          'features.isEnabled(\\'NameId\\')',\r\n          'form.runFormulas()',\r\n          'sxc.ChangeThis',\r\n          'target.entity.id',\r\n          'target.entity.guid',\r\n          'target.name',\r\n          'target.type',\r\n          'user.id',\r\n          'user.isAnonymous',\r\n          'user.isSiteAdmin',\r\n          'user.isSystemAdmin',\r\n        ].map(name => {\r\n          const code = `context.${name}`;\r\n          const fieldSnippet: DesignerSnippet = {\r\n            code,\r\n            label: code,\r\n          };\r\n          return fieldSnippet;\r\n        });\r\n        return snippets;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used to build the formula typings for use in intellisense.\r\n   * @param formula \r\n   * @param fieldOptions \r\n   * @param itemHeader \r\n   * @returns Formula typings for use in intellisense\r\n   */\r\n  static buildFormulaTypings(formula: FormulaCacheItem, fieldOptions: FieldOption[], prefillAsParameters: Record<string, unknown>): string {\r\n    switch (formula.version) {\r\n      case FormulaVersions.V2: {\r\n        const formulaPropsParameters = this.buildFormulaPropsParameters(prefillAsParameters);\r\n\r\n        const allFields = fieldOptions.map(f => `${f.fieldName}: any;`).join('\\n');\r\n        const allParameters = Object.keys(formulaPropsParameters).map(key => `${key}: any;`).join('\\n');\r\n        const final = editorTypesForIntellisense\r\n          .replace('/* [inject:AllFields] */', allFields)\r\n          .replace('/* [inject:AllParameters] */', allParameters);\r\n\r\n        // console.error('test 2dm', final);\r\n        return final;\r\n\r\n        // TODO: probably update the entity-type info which was added in v14.07.05\r\n      }\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n}\r\n","export default \"/*\\r\\n  This is a special file which is not compiled as a normal TypeScript.\\r\\n  Instead it's loaded as raw text, to hand over to Monaco.\\r\\n  It ensures that v2 functions have intellisense.\\r\\n\\r\\n  TIP: To edit this file, briefly rename it to ...raw.ts, then back to ...rawts\\r\\n       This will make VSCode load it as a normal TypeScript file, so you can edit it.\\r\\n\\r\\n  - Try to keep in sync with the real code in the 2sxc project.\\r\\n  - The comments are _documentation_ for the user, so they can see what's available\\r\\n  - If you need any \\\"internal\\\" comments, use // instead\\r\\n  - Note that the [inject:...] comments are replaced by the build process\\r\\n*/\\r\\n\\r\\n/**\\r\\n * The data object is the main object for figuring out what the field or setting contained and what other fields currently store.\\r\\n * It has properties such as `.value` etc.\\r\\n * Just start typing to see the intellisense.\\r\\n */\\r\\n// Note that the type must be explicitly like `string | boolean | number | string[]`\\r\\n// Otherwise it won't show the details to the user\\r\\ndeclare interface FormulaData {\\r\\n  /**\\r\\n   * The value of the current field/setting when the formula runs.\\r\\n   *\\r\\n   * _It's exact type depends on the underlying type._\\r\\n   */\\r\\n  value: string | boolean | number | string[];\\r\\n  /**\\r\\n   * The _default_ value of the current field/setting as defined in the field settings.\\r\\n   *\\r\\n   * _It's exact type depends on the underlying type._\\r\\n   */\\r\\n  default: string | boolean | number | string[];\\r\\n  /**\\r\\n   * A prefill value that was passed into the form when it was loaded.\\r\\n   *\\r\\n   * _It's exact type depends on the underlying type._\\r\\n   */\\r\\n  prefill: string | boolean | number | string[];\\r\\n  /**\\r\\n   * The value of the current field/setting when the form initially loaded.\\r\\n   *\\r\\n   * _It's exact type depends on the underlying type._\\r\\n   */\\r\\n  initial: string | boolean | number | string[];\\r\\n  /* [inject:AllFields] */\\r\\n  /**\\r\\n   * All parameters which were passed to the form when it was loaded\\r\\n   *\\r\\n   * _It's exact type depends on the parameter, but it's usually a string._\\r\\n   */\\r\\n  parameters: {\\r\\n    /* [inject:AllParameters] */\\r\\n  };\\r\\n}\\r\\n\\r\\ndeclare interface FormulaContext {\\r\\n  /**\\r\\n   * Information about the current App\\r\\n   */\\r\\n  app: {\\r\\n    /** The current App ID */\\r\\n    appId: number;\\r\\n    /** The current Zone ID */\\r\\n    zoneId: number;\\r\\n    /** Determines if the current App is the global App */\\r\\n    isGlobal: boolean;\\r\\n    /** Determines if the current App is the primary (main) App on the site */\\r\\n    isSite: boolean;\\r\\n    /** Determines if the current App is a content App */\\r\\n    isContent: boolean;\\r\\n    /**\\r\\n     * Retrieve a setting like an App setting.\\r\\n     * You need the full path like `Settings.ShowCategories`.\\r\\n     * \\r\\n     * Important: For security reasons formulas will only get settings which where configured in the ContentType for use in Formulas.\\r\\n     */\\r\\n    getSetting(settingPath: string): string;\\r\\n  };\\r\\n  /**\\r\\n   * Cache for this formula. You can store any data here and it will be available in the next run.\\r\\n   */\\r\\n  cache: Record<string, any>;\\r\\n  /**\\r\\n   * Information about the current language\\r\\n   */\\r\\n  culture: {\\r\\n    code: string;\\r\\n    name: string;\\r\\n  };\\r\\n  debug: boolean;\\r\\n  /**\\r\\n   * API to detect what features are currently enabled/available\\r\\n   */\\r\\n  features: {\\r\\n    // /**\\r\\n    //  * Get internal information about a feature if it's available. This is rarely used.\\r\\n    //  * @param nameId The name of the feature, eg. `PasteImageFromClipboard`\\r\\n    //  */\\r\\n    // get(nameId: string): Record<string, any>;\\r\\n    /** Find out if the feature is enabled. Eg. `...isEnabled('PasteImageFromClipboard')` */\\r\\n    isEnabled(nameId: string): boolean;\\r\\n  };\\r\\n  /**\\r\\n   * Work with the current form\\r\\n   */\\r\\n  form: {\\r\\n    // v16 Deprecated for v2\\r\\n    // /** Re-trigger all formulas. Usually used inside promises when they complete. */\\r\\n    // runFormulas(): void;\\r\\n  };\\r\\n  /**\\r\\n   * The standard sxc object for the current App.\\r\\n   * It's the same as the sxc-instance in the page.\\r\\n   *\\r\\n   * You can use it to make API calls to the server.\\r\\n   */\\r\\n  sxc: {\\r\\n    /** The module ID */\\r\\n    id: number;\\r\\n    /** The Content-Block ID - matches the module ID unless it's an inner-content block inside another module */\\r\\n    cbid: number;\\r\\n    /** The sxc WebAPI object. Check the docs: https://docs.2sxc.org/api/js/SxcWebApi.html */\\r\\n    webApi: {\\r\\n      /**\\r\\n       * Get data from a url and return the json-object\\r\\n       * @param url Url to call. It's usually a virtual url such as `app/auto/api/basic/hello`\\r\\n       * @param data Optional data. If provided, it will use a POST\\r\\n       * @param method Optional method, default is `GET` unless you specify data, then it's `POST`\\r\\n       */\\r\\n      fetchJson<TData>(url: string, data?: string | Record<string, any>, method?: string): Promise<TData>;\\r\\n      /**\\r\\n       * Get data from a url and return the response (not a nice object)\\r\\n       * @param url Url to call. It's usually a virtual url such as `app/auto/api/basic/hello`\\r\\n       * @param data Optional data. If provided, it will use a POST\\r\\n       * @param method Optional method, default is `GET` unless you specify data, then it's `POST`\\r\\n       */\\r\\n      fetchRaw<TData>(url: string, data?: string | Record<string, any>, method?: string): Promise<TData>;\\r\\n    };\\r\\n    // turn off for now v16.00 - confusing\\r\\n    // [key: string]: any;\\r\\n  };\\r\\n  /**\\r\\n   * Information about the item this formula targets.\\r\\n   */\\r\\n  target: {\\r\\n    /** The entity the current formula affects */\\r\\n    entity: {\\r\\n      /** The entity ID */\\r\\n      id: number;\\r\\n      /** The entity GUID */\\r\\n      guid: string;\\r\\n      /** Metadata For information */\\r\\n      for: {\\r\\n        /** The target type like `4` (Entity). `0` if it's not metadata  */\\r\\n        targetType: number;\\r\\n        /** The int-key if it uses number keys, otherwise null */\\r\\n        number?: number;\\r\\n        /** The string-key if it uses string keys, otherwise null */\\r\\n        string?: string;\\r\\n        /** The GUID-key if it uses GUIDs, otherwise null */\\r\\n        guid?: string;\\r\\n      }\\r\\n    };\\r\\n    name: string;\\r\\n    /** The entity type name */\\r\\n    type: string;\\r\\n  };\\r\\n  /**\\r\\n   * Information about the current user\\r\\n   */\\r\\n  user: {\\r\\n    /** The current user ID */\\r\\n    id: number;\\r\\n    /** Check if the current user is anonymous eg. not logged in */\\r\\n    isAnonymous: boolean;\\r\\n    /** Check if the current user is a content admin */\\r\\n    isContentAdmin: boolean;\\r\\n    /** Check if the current user is a site admin */\\r\\n    isSiteAdmin: boolean;\\r\\n    /** Check if the current user is a system admin */\\r\\n    isSystemAdmin: boolean;\\r\\n    /** current user e-mail */\\r\\n    email: string;\\r\\n    /** The user GUID */\\r\\n    guid: string;\\r\\n    /** the name usually shown in greetings */\\r\\n    name: string;\\r\\n    /** The user name used for login */\\r\\n    username: string;\\r\\n  };\\r\\n}\\r\\n\\r\\n// /**\\r\\n//  * Test docs\\r\\n//  * @param data The data object\\r\\n//  */\\r\\n// declare function callbackV2(data: FormulaData): string | string[];\\r\\n\\r\\n// /**\\r\\n//  * test docs 3\\r\\n//  * @param callback The real code of the formula\\r\\n//  */\\r\\n// declare function v3(callback: typeof callbackV2);\\r\\n\\r\\n/**\\r\\n * This `v2` wrapper is required for the intellisense to work.\\r\\n * @param callback The real code of the formula\\r\\n * @returns A string, boolean, number, date or an advanced object\\r\\n */\\r\\ndeclare function v2(\\r\\n  // The main function - adding comments here does not show up, so we don't have them ATM\\r\\n  callback: (\\r\\n    data: FormulaData,\\r\\n    context: FormulaContext,\\r\\n  ) => string | boolean | number | Date | {\\r\\n    value?: string | boolean | number | Date | { severity: 'warning' | 'error', message: string },\\r\\n    fields?: {\\r\\n      name: string,\\r\\n      value: string | boolean | number | Date\\r\\n    }[],\\r\\n    promise?: Promise<any>,\\r\\n    stop?: boolean,\\r\\n  },\\r\\n): void;\\r\\n\";","import { SxcInstance } from '@2sic.com/2sxc-typings';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { FieldSettings, FieldValue } from '../../../../../../edit-types';\r\nimport { FormValues } from '../../shared/models';\r\nimport { FormulaResultRaw } from './formula-results.models';\r\n\r\n/**\r\n * Formula Cached Values which are re-used across formulas of the same entity\r\n */\r\nexport interface FormulaCacheItemShared {\r\n  /** Target information which stays the same across cycles, new cached in 14.07.05 */\r\n  targetEntity: FormulaV1CtxTargetEntity;\r\n  /** User which stays the same across cycles, new cached in 14.07.05 */\r\n  user: FormulaV1CtxUser;\r\n  /** App which stays the same across cycles, new cached in 14.07.05 */\r\n  app: FormulaV1CtxApp;\r\n  sxc: SxcInstance;\r\n}\r\n\r\nexport interface FormulaCacheItem extends FormulaCacheItemShared {\r\n  cache: Record<string, any>;\r\n  entityGuid: string;\r\n  fieldName: string;\r\n  /** Function built when formula is saved */\r\n  fn: FormulaFunction;\r\n  /** Is formula currently being edited (not yet saved) */\r\n  isDraft: boolean;\r\n  /** Current formula string */\r\n  source: string;\r\n  /** Formula string in field settings */\r\n  sourceFromSettings: string;\r\n  sourceGuid: string;\r\n  sourceId: number;\r\n  target: FormulaTarget;\r\n  version: FormulaVersion;\r\n  stopFormula: boolean;\r\n  promises$: BehaviorSubject<Promise<FieldValue | FormulaResultRaw>>;\r\n  updateCallback$: BehaviorSubject<(result: FieldValue | FormulaResultRaw) => void>;\r\n}\r\n\r\nexport type FormulaFunction = FormulaFunctionDefault | FormulaFunctionV1;\r\n\r\nexport type FormulaFunctionDefault = () => FieldValue | FormulaResultRaw;\r\n\r\nexport type FormulaFunctionV1 = (data: FormulaV1Data, context: FormulaV1Context, experimental: FormulaV1Experimental)\r\n  => FieldValue | FormulaResultRaw;\r\n\r\nexport const FormulaVersions = {\r\n  V1: 'v1',\r\n  V2: 'v2',\r\n} as const;\r\n\r\nexport type FormulaVersion = typeof FormulaVersions[keyof typeof FormulaVersions];\r\n\r\nexport const SettingsFormulaPrefix = 'Field.Settings.';\r\n\r\nexport const FormulaTargets = {\r\n  Disabled: `${SettingsFormulaPrefix}Disabled`,\r\n  Name: `${SettingsFormulaPrefix}Name`,\r\n  Notes: `${SettingsFormulaPrefix}Notes`,\r\n  Required: `${SettingsFormulaPrefix}Required`,\r\n  Value: 'Field.Value',\r\n  Visible: `${SettingsFormulaPrefix}Visible`,\r\n  Validation: 'Field.Validation',\r\n} as const;\r\n\r\nexport interface FormulaFieldValidation {\r\n  severity: '' | 'error' | 'warning';\r\n  message?: string;\r\n}\r\n\r\nexport type FormulaTarget = typeof FormulaTargets[keyof typeof FormulaTargets];\r\n\r\nexport type FormulaProps = FormulaPropsV1;\r\n\r\nexport interface FormulaPropsV1 {\r\n  data: FormulaV1Data;\r\n  context: FormulaV1Context;\r\n  experimental: FormulaV1Experimental;\r\n}\r\n\r\nexport interface FormulaV1Data {\r\n  default: FieldValue;\r\n  initial: FieldValue;\r\n  parameters: Record<string, any>;\r\n  prefill: FieldValue;\r\n  value: FieldValue;\r\n  [fieldName: string]: any;\r\n}\r\n\r\nexport interface FormulaV1Context {\r\n  app: FormulaV1CtxApp;\r\n  cache: Record<string, any>;\r\n  culture: FormulaV1CtxCulture;\r\n  debug: boolean;\r\n  features: FormulaV1CtxFeatures;\r\n  form: FormulaV1CtxForm;\r\n  sxc: SxcInstance;\r\n  target: FormulaV1CtxTarget;\r\n  user: FormulaV1CtxUser;\r\n}\r\n\r\nexport interface FormulaV1CtxApp {\r\n  appId: number;\r\n  zoneId: number;\r\n  isGlobal: boolean;\r\n  isSite: boolean;\r\n  isContent: boolean;\r\n\r\n  /**\r\n   * WIP new v15.01\r\n   * @param settingPath eg \"Settings.GoogleMaps.DefaultCoordinates\"\r\n   */\r\n  getSetting: (settingPath: string) => unknown;\r\n}\r\n\r\nexport interface FormulaV1CtxCulture {\r\n  code: string;\r\n  name: string;\r\n}\r\n\r\nexport interface FormulaV1CtxFeatures {\r\n  isEnabled(name: string): boolean;\r\n}\r\n\r\nexport interface FormulaV1CtxForm {\r\n  runFormulas(): void;\r\n}\r\n\r\nexport interface FormulaV1CtxTarget {\r\n  entity: FormulaV1CtxTargetEntity;\r\n  name: string;\r\n  type: string;\r\n}\r\n\r\nexport interface FormulaV1CtxTargetEntity {\r\n  guid: string;\r\n  id: number;\r\n  type?: FormulaV1CtxTargetEntityType;\r\n  /**\r\n   * New 15.04 - metadata for information\r\n   */\r\n  for: FormulaV1CtxMetadataFor;\r\n}\r\n\r\nexport interface FormulaV1CtxMetadataFor {\r\n  targetType: number;\r\n  number?: number;\r\n  string?: string;\r\n  guid?: string;\r\n}\r\n\r\n// WIP\r\ninterface FormulaV1CtxTargetEntityType {\r\n  guid: string;\r\n  name: string;\r\n  // Future: the int-id; ATM not available\r\n  id?: number;\r\n}\r\nexport interface FormulaV1CtxUser {\r\n  email: string;\r\n  guid: string;\r\n  id: number;\r\n  isAnonymous: boolean;\r\n  isSiteAdmin: boolean;\r\n  isSystemAdmin: boolean;\r\n  isContentAdmin: boolean;\r\n  name: string;\r\n  username: string;\r\n}\r\n\r\nexport interface FormulaV1Experimental {\r\n  getEntities(): FormulaV1ExperimentalEntity[];\r\n  /**\r\n   * This gets FIELD settings.\r\n   * TODO: @2dm Must find out if it's used anywhere, and probably rename to getFieldSettings\r\n   */\r\n  getSettings(fieldName: string): FieldSettings;\r\n  getValues(entityGuid: string): FormValues;\r\n}\r\n\r\n// TODO: once the id is gone, merge with the type FormulaV1CtxTargetEntityType\r\nexport interface FormulaV1ExperimentalEntity {\r\n  guid: string;\r\n  id: number;\r\n  type: {\r\n    id: string, // TODO: deprecate again, once we know it's not in use #cleanFormulaType\r\n    name: string,\r\n    guid: string,\r\n  };\r\n}\r\n","export const FieldMetadataKey = 'FieldMetadata' as const;\r\n","export const BestValueModes = {\r\n  Default: 'Default',\r\n  Strict: 'Strict',\r\n} as const;\r\n\r\nexport type BestValueMode = typeof BestValueModes[keyof typeof BestValueModes];\r\n","export const MetadataDecorators = {\r\n  LanguagesDecorator: 'LanguagesDecorator',\r\n  SaveEmptyDecorator: 'SaveEmptyDecorator',\r\n} as const;\r\n\r\nexport type MetadataDecorator = typeof MetadataDecorators[keyof typeof MetadataDecorators];\r\n","export const TranslationLinks = {\r\n  Translate: 'Translate',\r\n  DontTranslate: 'DontTranslate',\r\n  MissingDefaultLangValue: 'MissingDefaultLangValue',\r\n  LinkReadOnly: 'LinkReadOnly',\r\n  LinkReadWrite: 'LinkReadWrite',\r\n  LinkCopyFrom: 'LinkCopyFrom',\r\n} as const;\r\n\r\nexport type TranslationLink = typeof TranslationLinks[keyof typeof TranslationLinks];\r\n","export const WrappersConstants = {\r\n  AdamWrapper: 'app-adam-wrapper', // default\r\n  CollapsibleWrapper: 'app-collapsible-wrapper', // empty specific\r\n  DropzoneWrapper: 'app-dropzone-wrapper', // default\r\n  EntityExpandableWrapper: 'app-entity-expandable-wrapper', // entity specific\r\n  ExpandableWrapper: 'app-expandable-wrapper', // default\r\n  HiddenWrapper: 'app-hidden-wrapper', // default\r\n  HyperlinkDefaultExpandableWrapper: 'app-hyperlink-default-expandable-wrapper', // hyperlink specific\r\n  HyperlinkLibraryExpandableWrapper: 'app-hyperlink-library-expandable-wrapper', // hyperlink specific\r\n  LocalizationWrapper: 'app-localization-wrapper', // default\r\n} as const;\r\n\r\nexport type WrappersConstant = typeof WrappersConstants[keyof typeof WrappersConstants];\r\n","import { NgZone } from '@angular/core';\r\nimport { EavWindow } from '../../../shared/models/eav-window.model';\r\nimport { ElementEventListener } from '../models';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport class DropzoneDraggingHelper {\r\n  private eventListeners: ElementEventListener[] = [];\r\n\r\n  constructor(private zone: NgZone) { }\r\n\r\n  /** Starts listening for dragover and drop events on a given element */\r\n  attach(htmlEl: HTMLElement) {\r\n    this.zone.runOutsideAngular(() => {\r\n      htmlEl.addEventListener('dragover', dragoverListener, { passive: true });\r\n      htmlEl.addEventListener('drop', dropListener, { passive: true });\r\n\r\n      this.eventListeners.push(\r\n        { element: htmlEl, type: 'dragover', listener: dragoverListener },\r\n        { element: htmlEl, type: 'drop', listener: dropListener },\r\n      );\r\n\r\n      function dragoverListener() {\r\n        clearTimeouts(window.windowBodyTimeouts); // clear timeouts from global array of timeouts which clear draggingClass from body\r\n        document.body.classList.add(window.draggingClass);\r\n      }\r\n      function dropListener() {\r\n        document.body.classList.remove(window.draggingClass);\r\n      }\r\n      function clearTimeouts(timeoutsArray: number[]) {\r\n        for (const timeout of timeoutsArray) {\r\n          clearTimeout(timeout);\r\n        }\r\n        timeoutsArray.splice(0, timeoutsArray.length);\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Removes event listeners from registered elements */\r\n  detach() {\r\n    this.zone.runOutsideAngular(() => {\r\n      this.eventListeners.forEach(({ element, type, listener }) => {\r\n        element.removeEventListener(type, listener);\r\n      });\r\n    });\r\n  }\r\n}\r\n","import { AbstractControl } from '@angular/forms';\r\nimport { Subscription } from 'rxjs';\r\nimport { EavConfig } from '../models';\r\n\r\n/**\r\n * Create a new FieldMask instance and access result with resolve\r\n * @example\r\n * const mask = new FieldMask(\"[FirstName]\", formGroup.controls);\r\n * const maskValue = mask.resolve();\r\n *\r\n * @param mask a string like \"[FirstName] [LastName]\"\r\n * @param model usually FormGroup controls, passed into here\r\n * @param overloadPreCleanValues a function which will \"scrub\" the found field-values\r\n */\r\nexport class FieldMask {\r\n  private mask: string;\r\n  private model: Record<string, AbstractControl>;\r\n  private fields: string[] = [];\r\n  private value: string;\r\n  private findFields = /\\[.*?\\]/ig;\r\n  private unwrapField = /[\\[\\]]/ig;\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  constructor(\r\n    mask: string,\r\n    model: Record<string, AbstractControl>,\r\n    private changeEvent: (newValue: string) => void,\r\n    overloadPreCleanValues: (key: string, value: string) => string,\r\n    private eavConfig?: EavConfig,\r\n  ) {\r\n    this.mask = mask;\r\n    this.model = model;\r\n    this.fields = this.fieldList();\r\n\r\n    if (overloadPreCleanValues) {\r\n      this.preClean = overloadPreCleanValues;\r\n    }\r\n\r\n    // bind auto-watch only if needed...\r\n    if (model && changeEvent) {\r\n      this.watchAllFields();\r\n    }\r\n  }\r\n\r\n  /** Resolves a mask to the final value */\r\n  resolve(): string {\r\n    let value = this.mask;\r\n    if (this.eavConfig != null && value != null) {\r\n      value = value.replace('[App:AppId]', this.eavConfig.appId);\r\n      value = value.replace('[App:ZoneId]', this.eavConfig.zoneId);\r\n    }\r\n    this.fields.forEach((e, i) => {\r\n      const replaceValue = this.model.hasOwnProperty(e) && this.model[e] && this.model[e].value ? this.model[e].value : '';\r\n      const cleaned = this.preClean(e, replaceValue);\r\n      value = value.replace('[' + e + ']', cleaned);\r\n    });\r\n\r\n    return value;\r\n  }\r\n\r\n  /** Retrieves a list of all fields used in the mask */\r\n  fieldList(): string[] {\r\n    const result: string[] = [];\r\n    if (!this.mask) { return result; }\r\n    const matches = this.mask.match(this.findFields);\r\n    if (matches) {\r\n      matches.forEach((e, i) => {\r\n        const staticName = e.replace(this.unwrapField, '');\r\n        result.push(staticName);\r\n      });\r\n    } else { // TODO: ask is this good\r\n      result.push(this.mask);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /** Default preClean function */\r\n  private preClean(key: string, value: string): string {\r\n    return value;\r\n  }\r\n\r\n  /** Change-event - will only fire if it really changes */\r\n  private onChange() {\r\n    const maybeNew = this.resolve();\r\n    if (this.value !== maybeNew) {\r\n      this.changeEvent(maybeNew);\r\n    }\r\n    this.value = maybeNew;\r\n  }\r\n\r\n  /** Add watcher and execute onChange */\r\n  private watchAllFields() {\r\n    // add a watch for each field in the field-mask\r\n    this.fields.forEach(field => {\r\n      if (!this.model[field]) { return; }\r\n      const valueSub = this.model[field].valueChanges.subscribe(value => this.onChange());\r\n      this.subscriptions.push(valueSub);\r\n    });\r\n  }\r\n\r\n  destroy() {\r\n    this.subscriptions.forEach(subscription => { subscription.unsubscribe(); });\r\n  }\r\n}\r\n","import { LocalizationHelpers } from '.';\r\nimport { FieldSettings } from '../../../../../../edit-types';\r\nimport { InputTypeConstants } from '../../../content-type-fields/constants/input-type.constants';\r\nimport { InputType } from '../../../content-type-fields/models/input-type.model';\r\nimport { ItemIdentifierEditConfig } from '../../../shared/models/edit-form.model';\r\nimport { FieldLogicManager } from '../../form/shared/field-logic/field-logic-manager';\r\nimport { TranslateMenuHelpers } from '../../form/wrappers/localization-wrapper/translate-menu/translate-menu.helpers';\r\nimport { TranslationStateCore } from '../../form/wrappers/localization-wrapper/translate-menu/translate-menu.models';\r\nimport { MetadataDecorators, TranslationLink, TranslationLinks } from '../constants';\r\nimport { ContentTypeSettings, TranslationState } from '../models';\r\nimport { EavContentType, EavContentTypeAttribute, EavEntity, EavValues } from '../models/eav';\r\n\r\nexport class FieldsSettingsHelpers {\r\n\r\n  static setDefaultContentTypeSettings(\r\n    settings: ContentTypeSettings,\r\n    contentType: EavContentType,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n    itemHeader: ItemIdentifierEditConfig,\r\n  ): ContentTypeSettings {\r\n    const defaultSettings = { ...settings };\r\n    defaultSettings.Description ??= '';\r\n    defaultSettings.EditInstructions ??= '';\r\n    defaultSettings.Features ??= '';\r\n    defaultSettings.Label ??= '';\r\n    defaultSettings.ListInstructions ??= '';\r\n    defaultSettings.Notes ??= '';\r\n    defaultSettings.Icon ??= '';\r\n    defaultSettings.Link ??= '';\r\n    defaultSettings._itemTitle = FieldsSettingsHelpers.getContentTypeTitle(contentType, currentLanguage, defaultLanguage);\r\n    defaultSettings._slotCanBeEmpty = itemHeader.IsEmptyAllowed ?? false;\r\n    defaultSettings._slotIsEmpty = itemHeader.IsEmpty ?? false;\r\n    return defaultSettings;\r\n  }\r\n\r\n  static setDefaultFieldSettings(settings: FieldSettings): FieldSettings {\r\n    const defaultSettings = AllDeprecated.moveDeprecatedSettings({ ...settings });\r\n    // update @All settings\r\n    defaultSettings.Name ??= '';\r\n    defaultSettings.Placeholder ??= '';\r\n    defaultSettings.Notes ??= '';\r\n    // defaultSettings.VisibleInEditUI ??= true;\r\n    defaultSettings.Required ??= false;\r\n    defaultSettings.Disabled ??= false;\r\n    defaultSettings.DisableTranslation ??= false;\r\n    defaultSettings.Visible ??= true; // defaultSettings.VisibleInEditUI;\r\n    // delete defaultSettings.VisibleInEditUI;\r\n    if (defaultSettings.DefaultCollapsed != null) {\r\n      defaultSettings.Collapsed = defaultSettings.DefaultCollapsed;\r\n      delete defaultSettings.DefaultCollapsed;\r\n    }\r\n    defaultSettings.Formulas ??= [];\r\n    let logic = FieldLogicManager.singleton().get(settings.InputType);\r\n    defaultSettings.DisableAutoTranslation ??= !logic?.canAutoTranslate;\r\n    return defaultSettings;\r\n  }\r\n\r\n  /** Find if DisableTranslation is true in any setting and in any language */\r\n  static findDisableTranslation(\r\n    contentTypeMetadata: EavEntity[],\r\n    inputType: InputType,\r\n    attributeValues: EavValues<any>,\r\n    defaultLanguage: string,\r\n    attributeMetadata: EavEntity[],\r\n  ): boolean {\r\n    // disable translation if LanguagesDecorator in ContentType is false in any language\r\n    const languagesDecorator = contentTypeMetadata.find(m => m.Type.Name === MetadataDecorators.LanguagesDecorator);\r\n    if (languagesDecorator?.Attributes.Enabled?.Values.some(eavValue => eavValue.Value === false)) { return true; }\r\n\r\n    if (inputType?.DisableI18n) { return true; }\r\n    if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) { return true; }\r\n\r\n    // disable translation if DisableTranslation is true in any language in @All, @String, @string-default, etc...\r\n    for (const metadataItem of attributeMetadata ?? []) {\r\n      if (metadataItem.Attributes.DisableTranslation?.Values.some(eavValue => eavValue.Value === true)) { return true; }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  static getContentTypeTitle(contentType: EavContentType, currentLanguage: string, defaultLanguage: string): string {\r\n    let label: string;\r\n    try {\r\n      // xx ContentType is a historic bug and should be fixed when JSONs are rechecked\r\n      const type = contentType.Metadata.find(metadata => metadata.Type.Name === 'ContentType' || metadata.Type.Name === 'xx ContentType');\r\n      if (type) {\r\n        label = LocalizationHelpers.getValueOrDefault(type.Attributes.Label, currentLanguage, defaultLanguage)?.Value;\r\n      }\r\n      label = label || contentType.Name;\r\n    } catch (error) {\r\n      label = contentType.Name;\r\n    }\r\n    return label;\r\n  }\r\n\r\n  static findIsLastInGroup(contentType: EavContentType, attribute: EavContentTypeAttribute): boolean {\r\n    const index = contentType.Attributes.indexOf(attribute);\r\n    if (contentType.Attributes[index + 1] == null) { return true; }\r\n\r\n    const indexOfFirstEmpty = contentType.Attributes.findIndex(a => a.InputType === InputTypeConstants.EmptyDefault);\r\n    if (index < indexOfFirstEmpty) { return false; }\r\n\r\n    if (attribute.InputType === InputTypeConstants.EmptyEnd) { return true; }\r\n\r\n    const empties: string[] = [InputTypeConstants.EmptyDefault, InputTypeConstants.EmptyEnd];\r\n    if (empties.includes(contentType.Attributes[index + 1].InputType)) { return true; }\r\n\r\n    return false;\r\n  }\r\n\r\n  static getDisabledBecauseTranslations(\r\n    attributeValues: EavValues<any>,\r\n    disableTranslation: boolean,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n  ): boolean {\r\n    if (currentLanguage === defaultLanguage) { return false; }\r\n    if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) { return true; }\r\n    if (disableTranslation) { return true; }\r\n    if (LocalizationHelpers.isEditableTranslationExist(attributeValues, currentLanguage, defaultLanguage)) { return false; }\r\n    if (LocalizationHelpers.isReadonlyTranslationExist(attributeValues, currentLanguage)) { return true; }\r\n    return true;\r\n  }\r\n\r\n  static getTranslationState(\r\n    attributeValues: EavValues<any>,\r\n    disableTranslation: boolean,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n  ): TranslationState {\r\n    let infoLabel: string;\r\n    let infoMessage: string;\r\n\r\n    if (disableTranslation) {\r\n      infoLabel = 'LangMenu.InAllLanguages';\r\n      infoMessage = '';\r\n    } else if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) {\r\n      infoLabel = 'LangMenu.MissingDefaultLangValue';\r\n      infoMessage = defaultLanguage;\r\n    } else {\r\n      const editableTranslationExists = LocalizationHelpers.isEditableTranslationExist(attributeValues, currentLanguage, defaultLanguage);\r\n      const readonlyTranslationExists = LocalizationHelpers.isReadonlyTranslationExist(attributeValues, currentLanguage);\r\n\r\n      if (editableTranslationExists || readonlyTranslationExists) {\r\n        const dimensions = LocalizationHelpers.getValueTranslation(attributeValues, currentLanguage, defaultLanguage)\r\n          .Dimensions.map(dimension => dimension.Value)\r\n          .filter(dimension => !dimension.includes(currentLanguage));\r\n\r\n        const isShared = dimensions.length > 0;\r\n        if (isShared) {\r\n          if (editableTranslationExists) {\r\n            infoLabel = 'LangMenu.In';\r\n          } else if (readonlyTranslationExists) {\r\n            infoLabel = 'LangMenu.From';\r\n          }\r\n          infoMessage = TranslateMenuHelpers.calculateSharedInfoMessage(dimensions, currentLanguage);\r\n        } else {\r\n          infoLabel = '';\r\n          infoMessage = '';\r\n        }\r\n      } else {\r\n        infoLabel = 'LangMenu.UseDefault';\r\n        infoMessage = '';\r\n      }\r\n    }\r\n    const state = this.getTranslationStateCore(attributeValues, disableTranslation, currentLanguage, defaultLanguage);\r\n    const translationState: TranslationState = {\r\n      infoLabel,\r\n      infoMessage,\r\n      language: state.language,\r\n      linkType: state.linkType,\r\n    };\r\n    return translationState;\r\n  }\r\n\r\n  private static getTranslationStateCore(\r\n    attributeValues: EavValues<any>,\r\n    disableTranslation: boolean,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n  ): TranslationStateCore {\r\n    let language: string;\r\n    let linkType: TranslationLink;\r\n\r\n    // Determine is control disabled or enabled and info message\r\n    if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) {\r\n      language = '';\r\n      linkType = TranslationLinks.MissingDefaultLangValue;\r\n    } else if (disableTranslation) {\r\n      language = '';\r\n      linkType = TranslationLinks.DontTranslate;\r\n    } else if (LocalizationHelpers.isEditableTranslationExist(attributeValues, currentLanguage, defaultLanguage)) {\r\n      const editableElements = LocalizationHelpers.getValueTranslation(attributeValues, currentLanguage, defaultLanguage)\r\n        .Dimensions.filter(dimension => dimension.Value !== currentLanguage);\r\n\r\n      if (editableElements.length > 0) {\r\n        language = editableElements[0].Value;\r\n        linkType = TranslationLinks.LinkReadWrite;\r\n      } else {\r\n        language = '';\r\n        linkType = TranslationLinks.Translate;\r\n      }\r\n    } else if (LocalizationHelpers.isReadonlyTranslationExist(attributeValues, currentLanguage)) {\r\n      const readOnlyElements = LocalizationHelpers.getValueTranslation(attributeValues, currentLanguage, defaultLanguage)\r\n        .Dimensions.filter(dimension => dimension.Value !== currentLanguage);\r\n\r\n      language = readOnlyElements[0].Value;\r\n      linkType = TranslationLinks.LinkReadOnly;\r\n    } else {\r\n      language = '';\r\n      linkType = TranslationLinks.DontTranslate;\r\n    }\r\n\r\n    const translationState: TranslationStateCore = {\r\n      language,\r\n      linkType,\r\n    };\r\n    return translationState;\r\n  }\r\n}\r\n\r\nclass AllDeprecated {\r\n  /** @deprecated */\r\n  VisibleInEditUI: boolean;\r\n  /** VisibleInEditUi is copied Visible and then deleted */\r\n  static moveDeprecatedSettings(settings: FieldSettings): FieldSettings {\r\n    var asDeprecated = settings as unknown as AllDeprecated;\r\n    if (asDeprecated.VisibleInEditUI == null) return settings;\r\n    settings.Visible = asDeprecated.VisibleInEditUI;\r\n    delete asDeprecated.VisibleInEditUI;\r\n    return settings;\r\n  }\r\n}\r\n","import { FieldValue } from '../../../../../../edit-types';\r\nimport { consoleLogAngular } from '../../../shared/helpers/console-log-angular.helper';\r\nimport { BestValueMode, BestValueModes } from '../constants';\r\nimport { FormValues } from '../models';\r\nimport { EavDimension, EavEntityAttributes, EavValue, EavValues } from '../models/eav';\r\n\r\nexport class LocalizationHelpers {\r\n  /**\r\n   * Get translated value for currentLanguage,\r\n   * if not exist return default language translation,\r\n   * if default language also not exist return first value\r\n   */\r\n  static translate(currentLanguage: string, defaultLanguage: string, attributeValues: EavValues<any>, defaultValue: any): any {\r\n    if (!attributeValues) { return defaultValue; }\r\n\r\n    const translation: EavValue<any> = this.getValueTranslation(attributeValues, currentLanguage, defaultLanguage);\r\n    if (translation) { return translation.Value; }\r\n\r\n    const translationDefault: EavValue<any> = this.getValueTranslation(attributeValues, defaultLanguage, defaultLanguage);\r\n    if (translationDefault) { return translationDefault.Value; }\r\n\r\n    // TODO: maybe return value with *\r\n    return attributeValues.Values[0]?.Value ?? null;\r\n  }\r\n\r\n  static getValueOrDefault(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): EavValue<any> {\r\n    let translation = LocalizationHelpers.getValueTranslation(allAttributesValues, languageKey, defaultLanguage);\r\n    if (translation == null) {\r\n      translation = LocalizationHelpers.getValueTranslation(allAttributesValues, defaultLanguage, defaultLanguage);\r\n    }\r\n    return translation;\r\n  }\r\n\r\n  static getValueTranslation(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): EavValue<any> {\r\n    return allAttributesValues.Values.find(eavValue =>\r\n      eavValue.Dimensions.find(d => d.Value === languageKey\r\n        || d.Value === `~${languageKey}`\r\n        || (languageKey === defaultLanguage && d.Value === '*')) !== undefined);\r\n  }\r\n\r\n  static isEditableOrReadonlyTranslationExist(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(c =>\r\n      c.Dimensions.find(d =>\r\n        d.Value === languageKey\r\n        || d.Value === `~${languageKey}`\r\n        || (languageKey === defaultLanguage && d.Value === '*'))).length > 0 : false;\r\n  }\r\n\r\n  /** Language is editable if languageKey exist or on default language * exist */\r\n  static isEditableTranslationExist(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => (d.Value === languageKey)\r\n        || (languageKey === defaultLanguage && d.Value === '*'))).length > 0 : false;\r\n  }\r\n\r\n  // Number of editable translatable fields that\r\n  static noEditableTranslationFields(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): number {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => (d.Value === languageKey)\r\n        || (languageKey === defaultLanguage && d.Value === '*'))).length : 0;\r\n  }\r\n\r\n  // Number of editable translatable fields that have some content\r\n  static noEditableTranslatableFieldsWithContent(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): number {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => (d.Value === languageKey)\r\n        || (languageKey === defaultLanguage && d.Value === '*')))\r\n      .filter(v => v.Value != \"\" && v.Value != null && v.Value != undefined)?.length : 0;\r\n  }\r\n\r\n  static isReadonlyTranslationExist(allAttributesValues: EavValues<any>, languageKey: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => d.Value === `~${languageKey}`)).length > 0 : false;\r\n  }\r\n\r\n  static translationExistsInDefault(allAttributesValues: EavValues<any>, defaultLanguage: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => d.Value === defaultLanguage || d.Value === '*')).length > 0 : false;\r\n  }\r\n\r\n  /** Copy attributes from item */\r\n  private static updateAttribute(\r\n    oldAttributes: EavEntityAttributes,\r\n    attributeKey: string,\r\n    attribute: EavValues<any>,\r\n  ): EavEntityAttributes {\r\n    const newAttributes: EavEntityAttributes = {};\r\n    if (Object.keys(oldAttributes).length === 0) {\r\n      const attributeCopy: EavValues<any> = { ...attribute };\r\n      newAttributes[attributeKey] = attributeCopy;\r\n      return newAttributes;\r\n    }\r\n\r\n    for (const key of Object.keys(oldAttributes)) {\r\n      if (key === attributeKey) {\r\n        const attributeCopy: EavValues<any> = { ...attribute };\r\n        newAttributes[key] = attributeCopy;\r\n      } else {\r\n        const attributeCopy: EavValues<any> = { ...oldAttributes[key] };\r\n        newAttributes[key] = attributeCopy;\r\n      }\r\n    }\r\n\r\n    if (oldAttributes[attributeKey] == null) {\r\n      const attributeCopy: EavValues<any> = { ...attribute };\r\n      newAttributes[attributeKey] = attributeCopy;\r\n    }\r\n    return newAttributes;\r\n  }\r\n\r\n  /** Update values for languageKey */\r\n  static updateAttributesValues(\r\n    allAttributes: EavEntityAttributes,\r\n    updateValues: FormValues,\r\n    languageKey: string,\r\n    defaultLanguage: string,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    const eavAttributes: EavEntityAttributes = {};\r\n    Object.keys(allAttributes).forEach(attributeKey => {\r\n      const newItemValue = updateValues[attributeKey];\r\n      // if new value exist update attribute for languageKey\r\n      // if (newItemValue !== null && newItemValue !== undefined) {\r\n      if (newItemValue !== undefined) {\r\n        const valueWithLanguageExist = this.isEditableOrReadonlyTranslationExist(\r\n          allAttributes[attributeKey], languageKey, defaultLanguage);\r\n\r\n        // if valueWithLanguageExist update value for languageKey\r\n        if (valueWithLanguageExist) {\r\n          const newValues: EavValues<any> = {\r\n            ...allAttributes[attributeKey], Values: allAttributes[attributeKey].Values.map(eavValue => {\r\n              const newValue: EavValue<any> = eavValue.Dimensions.find(d => d.Value === languageKey\r\n                || d.Value === `~${languageKey}`\r\n                || (languageKey === defaultLanguage && d.Value === '*'))\r\n                // Update value for languageKey\r\n                ? {\r\n                  ...eavValue,\r\n                  Value: newItemValue,\r\n                }\r\n                : eavValue;\r\n              return newValue;\r\n            })\r\n          };\r\n          eavAttributes[attributeKey] = newValues;\r\n        } else { // else add new value with dimension languageKey\r\n          consoleLogAngular('saveAttributeValues add values ', newItemValue);\r\n          const newEavValue = EavValue.create(newItemValue, [EavDimension.create(languageKey)]);\r\n          const newAttribute: EavValues<any> = {\r\n            ...allAttributes[attributeKey],\r\n            Values: [...allAttributes[attributeKey].Values, newEavValue]\r\n          };\r\n          eavAttributes[attributeKey] = newAttribute;\r\n        }\r\n      } else { // else copy item attributes\r\n        const attributeCopy: EavValues<any> = { ...allAttributes[attributeKey] };\r\n        eavAttributes[attributeKey] = attributeCopy;\r\n      }\r\n    });\r\n    return eavAttributes;\r\n  }\r\n\r\n  /** update attribute value, and change language readonly state if needed */\r\n  static updateAttributeValue(\r\n    allAttributes: EavEntityAttributes,\r\n    attributeKey: string,\r\n    updateValue: FieldValue,\r\n    existingLanguageKey: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    let eavAttributes: EavEntityAttributes = {};\r\n    let newLanguageValue = existingLanguageKey;\r\n\r\n    if (isReadOnly) {\r\n      newLanguageValue = `~${existingLanguageKey}`;\r\n    }\r\n\r\n    const attribute: EavValues<any> = {\r\n      ...allAttributes[attributeKey], Values: allAttributes[attributeKey].Values.map(eavValue => {\r\n        const newValue: EavValue<any> = eavValue.Dimensions.find(d => d.Value === existingLanguageKey\r\n          || d.Value === `~${existingLanguageKey}`\r\n          || (existingLanguageKey === defaultLanguage && d.Value === '*')\r\n        )\r\n          // Update value and dimension\r\n          ? {\r\n            ...eavValue,\r\n            // update value\r\n            Value: updateValue,\r\n            // update languageKey with newLanguageValue\r\n            Dimensions: eavValue.Dimensions.map(dimension => {\r\n              const newDimensions: EavDimension = (dimension.Value === existingLanguageKey\r\n                || dimension.Value === `~${existingLanguageKey}`\r\n                || (existingLanguageKey === defaultLanguage && dimension.Value === '*'))\r\n                ? { Value: newLanguageValue }\r\n                : dimension;\r\n              return newDimensions;\r\n            })\r\n          }\r\n          : eavValue;\r\n        return newValue;\r\n      })\r\n    };\r\n    eavAttributes = this.updateAttribute(allAttributes, attributeKey, attribute);\r\n    return eavAttributes;\r\n  }\r\n\r\n  static addAttributeValue(\r\n    allAttributes: EavEntityAttributes,\r\n    attributeValue: EavValue<any>,\r\n    attributeKey: string,\r\n    attributeType: string,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    let eavAttributes: EavEntityAttributes = {};\r\n    const attribute: EavValues<any> =\r\n      Object.keys(allAttributes).length === 0\r\n        || !allAttributes[attributeKey] ?\r\n        {\r\n          // Add attribute\r\n          ...allAttributes[attributeKey], Values: [attributeValue], Type: attributeType\r\n        }\r\n        : {\r\n          // Add attribute\r\n          ...allAttributes[attributeKey], Values: [...allAttributes[attributeKey].Values, attributeValue], Type: attributeType\r\n        };\r\n    eavAttributes = this.updateAttribute(allAttributes, attributeKey, attribute);\r\n    return eavAttributes;\r\n  }\r\n\r\n  /** Add dimension to value with existing dimension */\r\n  static addAttributeDimension(\r\n    allAttributes: EavEntityAttributes,\r\n    attributeKey: string,\r\n    newDimensionValue: string,\r\n    existingDimensionValue: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    let eavAttributes: EavEntityAttributes = {};\r\n    let newLanguageValue = newDimensionValue;\r\n\r\n    if (isReadOnly) {\r\n      newLanguageValue = `~${newDimensionValue}`;\r\n    }\r\n\r\n    const attribute: EavValues<any> = {\r\n      ...allAttributes[attributeKey], Values: allAttributes[attributeKey].Values.map(eavValue => {\r\n        const newValue: EavValue<any> = eavValue.Dimensions.find(d => d.Value === existingDimensionValue\r\n          || (existingDimensionValue === defaultLanguage && d.Value === '*'))\r\n          // Update dimension for current language\r\n          ? {\r\n            ...eavValue,\r\n            // if languageKey already exist\r\n            Dimensions: eavValue.Dimensions.concat({ Value: newLanguageValue })\r\n          }\r\n          : eavValue;\r\n        return newValue;\r\n      })\r\n    };\r\n    eavAttributes = this.updateAttribute(allAttributes, attributeKey, attribute);\r\n    return eavAttributes;\r\n  }\r\n\r\n  /** Removes dimension (language) from attribute. If multiple dimensions exist, delete only dimension, else delete value and dimension */\r\n  static removeAttributeDimension(attributes: EavEntityAttributes, attributeKey: string, language: string): EavEntityAttributes {\r\n    const oldAttributes = attributes;\r\n    const validDimensions = [language, `~${language}`];\r\n\r\n    const value = oldAttributes[attributeKey].Values.find(eavValue => {\r\n      const dimensionExists = eavValue.Dimensions.some(dimension => validDimensions.includes(dimension.Value));\r\n      return dimensionExists;\r\n    });\r\n\r\n    // given dimension doesn't exist for this attribute so no change is needed\r\n    if (!value) {\r\n      const attributesCopy: EavEntityAttributes = { ...oldAttributes };\r\n      return attributesCopy;\r\n    }\r\n\r\n    let newAttribute: EavValues<any>;\r\n    if (value.Dimensions.length > 1) {\r\n      // if multiple dimensions exist delete only dimension\r\n      newAttribute = {\r\n        ...oldAttributes[attributeKey],\r\n        Values: oldAttributes[attributeKey].Values.map(eavValue => {\r\n          const dimensionExists = eavValue.Dimensions.some(dimension => validDimensions.includes(dimension.Value));\r\n          if (!dimensionExists) { return eavValue; }\r\n\r\n          const newValue: EavValue<any> = {\r\n            ...eavValue,\r\n            Dimensions: eavValue.Dimensions.filter(dimension => !validDimensions.includes(dimension.Value)),\r\n          };\r\n          return newValue;\r\n        })\r\n      };\r\n    } else if (value.Dimensions.length === 1) {\r\n      // if only one dimension exists delete value and dimension\r\n      newAttribute = {\r\n        ...oldAttributes[attributeKey],\r\n        Values: oldAttributes[attributeKey].Values.filter(eavValue => {\r\n          const dimensionExists = eavValue.Dimensions.some(dimension => validDimensions.includes(dimension.Value));\r\n          return !dimensionExists;\r\n        })\r\n      };\r\n    }\r\n\r\n    const newAttributes = this.updateAttribute(oldAttributes, attributeKey, newAttribute);\r\n    return newAttributes;\r\n  }\r\n\r\n  /**\r\n   * Default mode priority:\r\n   * 1. value for current language\r\n   * 2. value for all languages\r\n   * 3. value for default language\r\n   * 4. first value\r\n   *\r\n   * Strict mode priority:\r\n   * 1. value for current language\r\n   * 2. value for all languages\r\n   * 3. value for default language\r\n   *\r\n   * Very strict mode priority:\r\n   * 1. value for current language\r\n   * 2. value for all languages\r\n   */\r\n  static getBestValue(eavValues: EavValues<any>, currentLanguage: string, defaultLanguage: string, mode: BestValueMode): FieldValue {\r\n    if (eavValues == null) { return; }\r\n\r\n    let bestDimensions = [currentLanguage, `~${currentLanguage}`];\r\n    let bestValue = this.findValueForDimensions(eavValues, bestDimensions);\r\n    if (bestValue !== undefined) { return bestValue; }\r\n\r\n    bestDimensions = ['*'];\r\n    bestValue = this.findValueForDimensions(eavValues, bestDimensions);\r\n    if (bestValue !== undefined) { return bestValue; }\r\n\r\n    if (mode === BestValueModes.Strict) { return; }\r\n\r\n    bestDimensions = [defaultLanguage, `~${defaultLanguage}`];\r\n    bestValue = this.findValueForDimensions(eavValues, bestDimensions);\r\n    if (bestValue !== undefined) { return bestValue; }\r\n\r\n    bestValue = eavValues.Values[0]?.Value;\r\n    return bestValue;\r\n  }\r\n\r\n  private static findValueForDimensions(eavValues: EavValues<any>, dimensions: string[]): FieldValue {\r\n    const value = eavValues.Values.find(\r\n      eavValue => !!eavValue.Dimensions.find(dimension => dimensions.includes(dimension.Value)),\r\n    )?.Value;\r\n    return value;\r\n  }\r\n}\r\n","import { LanguageState } from '../../../shared/models/language-state';\r\nimport { EavEntity, EavValues } from '../models/eav';\r\nimport { LocalizationHelpers } from './localization.helpers';\r\n\r\nexport class EntityReader implements LanguageState {\r\n  constructor(public currentLanguage: string, public defaultLanguage: string) {\r\n  }\r\n\r\n    // WIP - to make code clearer, this is what should be used from now on\r\n  // But we'll probably end up calling this from the EntityReader only, so it should be straight forward\r\n  getBestValue<T>(attributeValues: EavValues<unknown>, defaultValue: T): T {\r\n    return LocalizationHelpers.translate(this.currentLanguage, this.defaultLanguage, attributeValues, defaultValue);\r\n  }\r\n\r\n  public flatten<T>(metadataItem: EavEntity): T {\r\n    return this.flattenAll<T>([metadataItem]);\r\n  }\r\n\r\n  flattenAll<T>(metadataItems: EavEntity[]): T {\r\n    if (metadataItems == null) { return {} as T; }\r\n\r\n    const merged: Record<string, any> = {};\r\n    // copy metadata settings which are not @All\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id === '@All') { continue; }\r\n\r\n      for (const [name, values] of Object.entries(item.Attributes)) {\r\n        const value = this.getBestValue(values, null);\r\n        merged[name] = value;\r\n      }\r\n    }\r\n\r\n    // copy @All metadata settings, overwriting previous settings\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id !== '@All') { continue; }\r\n\r\n      for (const [name, values] of Object.entries(item.Attributes)) {\r\n        const value = this.getBestValue(values, null);\r\n        // do not overwrite previous settings if @All is empty\r\n        const exists = merged[name] != null;\r\n        const emptyAll = value == null || value === '';\r\n        if (exists && emptyAll) { continue; }\r\n\r\n        merged[name] = value;\r\n      }\r\n    }\r\n\r\n    return merged as T;\r\n  }\r\n\r\n}\r\n","export class FileTypeHelpers {\r\n  private static defaultIcon = 'file';\r\n  private static customExtensions: Record<string, string> = {\r\n    doc: 'file-word',\r\n    docx: 'file-word',\r\n    xls: 'file-excel',\r\n    xlsx: 'file-excel',\r\n    ppt: 'file-powerpoint',\r\n    pptx: 'file-powerpoint',\r\n    pdf: 'file-pdf',\r\n    mp3: 'file-audio',\r\n    avi: 'file-video',\r\n    mpg: 'file-video',\r\n    mpeg: 'file-video',\r\n    mov: 'file-video',\r\n    mp4: 'file-video',\r\n    zip: 'file-archive',\r\n    rar: 'file-archive',\r\n    txt: 'file-text',\r\n    html: 'file-code',\r\n    css: 'file-code',\r\n    xml: 'file-code',\r\n    xsl: 'file-code',\r\n  };\r\n  private static matExtensions: Record<string, string> = {\r\n    vcf: 'person',\r\n  };\r\n\r\n  static getExtension(filename: string) {\r\n    return filename.substring(filename.lastIndexOf('.') + 1).toLocaleLowerCase();\r\n  }\r\n\r\n  static getIconClass(filename: string) {\r\n    const ext = this.getExtension(filename);\r\n    return this.matExtensions[ext] || this.customExtensions[ext] || this.defaultIcon;\r\n  }\r\n\r\n  static isKnownType(filename: string) {\r\n    return this.matExtensions[this.getExtension(filename)] != null;\r\n  }\r\n\r\n  static isImage(filename: string) {\r\n    return this.isImgRegex().test(filename);\r\n  }\r\n\r\n  private static isImgRegex() {\r\n    return /(?:([^:\\/?#]+):)?(?:\\/\\/([^\\/?#]*))?([^?#]*\\.(?:jpg|jpeg|gif|png|webp))(?:\\?([^#]*))?(?:#(.*))?/i;\r\n  }\r\n}\r\n","import { AbstractControl } from '@angular/forms';\r\nimport { FieldValue } from '../../../../../../edit-types';\r\nimport { FormValues } from '../models';\r\n\r\nexport class GeneralHelpers {\r\n\r\n  static objectsEqual<T>(x: T, y: T): boolean {\r\n    if (x == null || y == null) { return x === y; }\r\n\r\n    const obj1 = x as Record<string, any>;\r\n    const obj2 = y as Record<string, any>;\r\n\r\n    const keys1 = Object.keys(obj1);\r\n    const keys2 = Object.keys(obj2);\r\n    if (keys1.length !== keys2.length) { return false; }\r\n\r\n    const equal = keys1.every(key1 => {\r\n      if (!obj2.hasOwnProperty(key1)) { return false; }\r\n\r\n      return obj1[key1] === obj2[key1];\r\n    });\r\n\r\n    return equal;\r\n  }\r\n\r\n  static arraysEqual<T>(x: T[], y: T[]): boolean {\r\n    if (x == null || y == null) { return x === y; }\r\n\r\n    if (x.length !== y.length) { return false; }\r\n\r\n    const equal = x.every((item, index) => {\r\n      return x[index] === y[index];\r\n    });\r\n\r\n    return equal;\r\n  }\r\n\r\n  /** Searches where newValues has values different from oldValues */\r\n  static getFormChanges(oldValues: FormValues, newValues: FormValues): FormValues {\r\n    const changes: FormValues = {};\r\n    for (const key of Object.keys(newValues)) {\r\n      const newValue = newValues[key];\r\n      const oldValue = oldValues[key];\r\n      if (this.controlValuesEqual(newValue, oldValue)) { continue; }\r\n\r\n      changes[key] = newValue;\r\n    }\r\n    return Object.keys(changes).length === 0 ? undefined : changes;\r\n  }\r\n\r\n  static toggleInArray<T>(item: T, array: T[]): void {\r\n    const index = array.indexOf(item);\r\n    if (index === -1) {\r\n      array.push(item);\r\n    } else {\r\n      array.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  /** TODO: Try to remove this by assigning controls [formControlName] in [formGroup] */\r\n  static markControlTouched(control: AbstractControl): void {\r\n    if (control.touched) { return; }\r\n\r\n    control.markAsTouched();\r\n    control.updateValueAndValidity();\r\n  }\r\n\r\n  /** Use to update form controls value */\r\n  static patchControlValue(control: AbstractControl, newValue: FieldValue): void {\r\n    if (!control.touched) {\r\n      control.markAsTouched();\r\n    }\r\n    if (!control.dirty && !this.controlValuesEqual(control.value, newValue)) {\r\n      control.markAsDirty();\r\n    }\r\n    control.patchValue(newValue);\r\n  }\r\n\r\n  private static controlValuesEqual(x: FieldValue, y: FieldValue): boolean {\r\n    if (x === y) { return true; }\r\n    if (typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y)) { return true; }\r\n    if (Array.isArray(x) && Array.isArray(y) && this.arraysEqual(x, y)) { return true; }\r\n    return false;\r\n  }\r\n\r\n  /** Disables/enables control if not already disabled/enabled. Use this helper to trigger fewer events on the form */\r\n  static disableControl(control: AbstractControl, disable: boolean) {\r\n    if (control.disabled === disable) { return; }\r\n\r\n    if (disable) {\r\n      control.disable();\r\n    } else {\r\n      control.enable();\r\n    }\r\n  }\r\n\r\n  /** Tries to parse string as JSON */\r\n  static tryParse(input: string): any {\r\n    try {\r\n      return JSON.parse(input);\r\n    } catch { }\r\n  }\r\n}\r\n","import { FieldSettings, FieldValue, InputTypeName } from '../../../../../../edit-types';\r\nimport { InputTypeConstants } from '../../../content-type-fields/constants/input-type.constants';\r\nimport { InputType } from '../../../content-type-fields/models/input-type.model';\r\nimport { ItemAddIdentifier, ItemIdentifierShared } from '../../../shared/models/edit-form.model';\r\nimport { WrappersConstant, WrappersConstants } from '../constants/wrappers.constants';\r\nimport { CalculatedInputType } from '../models';\r\nimport { EavContentTypeAttribute, EavItem } from '../models/eav';\r\nimport { EavService } from '../services';\r\n\r\nexport class InputFieldHelpers {\r\n\r\n  static getContentTypeId(item: EavItem): string {\r\n    return item.Entity.Type?.Id ?? (item.Header as ItemAddIdentifier).ContentTypeName;\r\n  }\r\n\r\n  static getInputTypeNames(attributes: EavContentTypeAttribute[], inputTypes: InputType[]): InputTypeName[] {\r\n    return attributes.map(attribute => {\r\n      const calculatedInputType = this.calculateInputType(attribute, inputTypes);\r\n      const inputTypeName: InputTypeName = {\r\n        name: attribute.Name,\r\n        inputType: calculatedInputType.inputType,\r\n      };\r\n      return inputTypeName;\r\n    });\r\n  }\r\n\r\n  static calculateInputType(attribute: EavContentTypeAttribute, inputTypes: InputType[]): CalculatedInputType {\r\n    const inputType = inputTypes.find(i => i.Type === attribute.InputType);\r\n    const calculated: CalculatedInputType = {\r\n      inputType: attribute.InputType,\r\n      isExternal: inputType ? !!inputType.AngularAssets : false,\r\n    };\r\n    return calculated;\r\n  }\r\n\r\n  static getWrappers(settings: FieldSettings, calculatedInputType: CalculatedInputType) {\r\n    const inputType = calculatedInputType.inputType;\r\n    const isExternal = calculatedInputType.isExternal;\r\n\r\n    if (inputType === InputTypeConstants.EmptyMessage) { return []; }\r\n\r\n    // empty inputtype wrappers\r\n    if (inputType === InputTypeConstants.EmptyDefault) { return [WrappersConstants.CollapsibleWrapper]; }\r\n\r\n    // default wrappers\r\n    const wrappers: WrappersConstant[] = [WrappersConstants.HiddenWrapper];\r\n\r\n    // entity-default wrappers\r\n    const isEntityType = (inputType === InputTypeConstants.EntityDefault)\r\n      || (inputType === InputTypeConstants.StringDropdownQuery)\r\n      || (inputType === InputTypeConstants.EntityQuery)\r\n      || (inputType === InputTypeConstants.EntityContentBlocks);\r\n\r\n    if (isEntityType) {\r\n      wrappers.push(WrappersConstants.LocalizationWrapper);\r\n      const allowMultiValue = settings.AllowMultiValue ?? false;\r\n      if (allowMultiValue || inputType === InputTypeConstants.EntityContentBlocks) {\r\n        wrappers.push(WrappersConstants.EntityExpandableWrapper);\r\n      }\r\n    }\r\n\r\n    if (isExternal) {\r\n      wrappers.push(\r\n        WrappersConstants.DropzoneWrapper,\r\n        WrappersConstants.LocalizationWrapper,\r\n        WrappersConstants.ExpandableWrapper,\r\n        WrappersConstants.AdamWrapper,\r\n      );\r\n    }\r\n\r\n    return wrappers;\r\n  }\r\n\r\n  /** Include itemHeader if you need data from prefill, and set onlyPrefill if you only need parsed prefill */\r\n  static parseDefaultValue(\r\n    attributeKey: string,\r\n    inputType: InputType,\r\n    settings: FieldSettings,\r\n    itemHeader?: ItemIdentifierShared,\r\n    onlyPrefill?: boolean,\r\n  ): FieldValue {\r\n    if (onlyPrefill && itemHeader?.Prefill?.[attributeKey] === undefined) { return; }\r\n\r\n    let defaultValue = settings.DefaultValue;\r\n\r\n    if (itemHeader?.Prefill?.[attributeKey]) {\r\n      defaultValue = itemHeader.Prefill[attributeKey];\r\n    }\r\n\r\n    switch (inputType?.Type) {\r\n      case InputTypeConstants.BooleanDefault:\r\n        return defaultValue != null\r\n          ? defaultValue.toLowerCase() === 'true'\r\n          : false;\r\n      case InputTypeConstants.BooleanTristate:\r\n        return defaultValue != null && defaultValue !== ''\r\n          ? defaultValue.toLowerCase() === 'true'\r\n          : null;\r\n      case InputTypeConstants.DatetimeDefault:\r\n        return defaultValue != null && defaultValue !== ''\r\n          ? new Date(defaultValue).toJSON()\r\n          : null;\r\n      case InputTypeConstants.NumberDefault:\r\n      case InputTypeConstants.NumberDropdown:\r\n        return defaultValue != null && defaultValue !== ''\r\n          ? !isNaN(Number(defaultValue)) ? Number(defaultValue) : null\r\n          : null;\r\n      case InputTypeConstants.EntityDefault:\r\n      case InputTypeConstants.EntityQuery:\r\n      case InputTypeConstants.EntityContentBlocks:\r\n        if (defaultValue == null || defaultValue === '') { return []; }\r\n        // string has { } characters, we must switch them to quotes\r\n        if (defaultValue.includes('{')) {\r\n          defaultValue = defaultValue.replace(/[\\{\\}]/g, '\\\"');\r\n        }\r\n        // list but no array, add brackets\r\n        if (defaultValue.includes(',') && !defaultValue.includes('[')) {\r\n          const guids = defaultValue.split(',').map(guid => guid.trim());\r\n          defaultValue = JSON.stringify(guids);\r\n        }\r\n        return defaultValue.startsWith('[') // an array with guid strings\r\n          ? JSON.parse(defaultValue) // if it's a string containing an array\r\n          : [defaultValue.replace(/\"/g, '')]; // just a guid string, but might have quotes\r\n      default:\r\n        return defaultValue ?? '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Entity fields for empty items are prefilled on the backend with []\r\n   * so I can never know if entity field is brand new, or just emptied out by the user\r\n   */\r\n  static isValueEmpty(value: FieldValue, eavService: EavService) {\r\n    const emptyEntityField = Array.isArray(value) && value.length === 0 && eavService.eavConfig.createMode;\r\n    return value === undefined || emptyEntityField;\r\n  }\r\n}\r\n","<ng-container *ngIf=\"templateVars$ | async as data\">\r\n\r\n  <h3 class=\"page-picker-title\">\r\n    {{ 'Fields.Hyperlink.PagePicker.Title' | translate }}\r\n  </h3>\r\n\r\n  <div class=\"page-search-box\">\r\n    <mat-form-field appearance=\"standard\" color=\"accent\">\r\n      <mat-label>Search</mat-label>\r\n      <input matInput [ngModel]=\"data.filterText\" (ngModelChange)=\"setFilter($event)\">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"page-tree-box\">\r\n    <ul *ngIf=\"!data.filterText\">\r\n      <ng-container *ngFor=\"let page of data.tree\">\r\n        <ng-container *ngTemplateOutlet=\"pageAndChildren; context: {page: page}\"></ng-container>\r\n      </ng-container>\r\n    </ul>\r\n\r\n    <ul *ngIf=\"data.filterText\">\r\n      <li *ngIf=\"data.filteredSearch.length === 0\">\r\n        <div class=\"page-row\">\r\n          <div class=\"no-toggle\"></div>\r\n          <div>No results</div>\r\n        </div>\r\n      </li>\r\n      <li *ngFor=\"let page of data.filteredSearch\">\r\n        <div class=\"page-row\">\r\n          <div class=\"no-toggle\"></div>\r\n          <div class=\"page-label\" [ngClass]=\"page.id === selected ? 'selected' : ''\" (click)=\"select(page)\">\r\n            <div class=\"page-icon-and-text\">\r\n              <mat-icon class=\"page-icon\" svgIcon=\"file\"></mat-icon>\r\n              <span class=\"page-path\" [tippy]=\"page.path\" *ngIf=\"page.path\">{{ page.path }}&nbsp;>&nbsp;</span>\r\n              <span class=\"page-name\" [tippy]=\"page.name\">{{ page.name }}</span>\r\n            </div>\r\n            <div class=\"page-icons\">\r\n              <mat-icon class=\"page-visible-clickable-icon\" *ngIf=\"!page.isVisible\">visibility_off</mat-icon>\r\n              <mat-icon class=\"page-visible-clickable-icon\" *ngIf=\"!page.isClickable\">cancel</mat-icon>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n\r\n  <ng-template #pageAndChildren let-page=\"page\">\r\n    <li>\r\n      <div class=\"page-row\">\r\n        <div class=\"no-toggle\" *ngIf=\"page.children.length === 0\"></div>\r\n        <mat-icon class=\"page-toggle\" *ngIf=\"page.children.length > 0\" (click)=\"toggle(page.id)\">\r\n          {{ toggled.includes(page.id) ? 'keyboard_arrow_down' : 'keyboard_arrow_right' }}\r\n        </mat-icon>\r\n        <div class=\"page-label\" [ngClass]=\"page.id === selected ? 'selected' : ''\" (click)=\"select(page)\">\r\n          <div class=\"page-icon-and-text\">\r\n            <mat-icon class=\"page-icon\" svgIcon=\"file\"></mat-icon>\r\n            <span>{{ page.name }}</span>\r\n          </div>\r\n          <div class=\"page-icons\">\r\n            <mat-icon class=\"page-visible-clickable-icon\" *ngIf=\"!page.isVisible\">visibility_off</mat-icon>\r\n            <mat-icon class=\"page-visible-clickable-icon\" *ngIf=\"!page.isClickable\">cancel</mat-icon>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <ul *ngIf=\"page.children.length > 0 && toggled.includes(page.id)\">\r\n        <ng-container *ngFor=\"let child of page.children\">\r\n          <ng-container *ngTemplateOutlet=\"pageAndChildren; context: {page: child}\"></ng-container>\r\n        </ng-container>\r\n      </ul>\r\n    </li>\r\n  </ng-template>\r\n</ng-container>\r\n","import { Component, Inject, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BehaviorSubject, combineLatest, map, Observable } from 'rxjs';\r\nimport { FieldValue, PagePickerResult } from '../../../../../../../edit-types';\r\nimport { GeneralHelpers } from '../../../shared/helpers';\r\nimport { QueryService } from '../../../shared/services';\r\nimport { buildPageSearch, buildPageTree } from './page-picker.helpers';\r\nimport { PageEntity, PagePickerDialogData, PagePickerTemplateVars, PageSearchItem, PageTreeItem } from './page-picker.models';\r\n\r\n@Component({\r\n  selector: 'app-page-picker',\r\n  templateUrl: './page-picker.component.html',\r\n  styleUrls: ['./page-picker.component.scss'],\r\n})\r\nexport class PagePickerComponent implements OnInit, OnDestroy {\r\n  selected: number;\r\n  toggled: number[];\r\n  templateVars$: Observable<PagePickerTemplateVars>;\r\n\r\n  private filterText$: BehaviorSubject<string>;\r\n  private searchItems$: BehaviorSubject<PageSearchItem[]>;\r\n  private tree$: BehaviorSubject<PageTreeItem[]>;\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) private dialogData: PagePickerDialogData,\r\n    private dialogRef: MatDialogRef<PagePickerComponent>,\r\n    private queryService: QueryService,\r\n    private translate: TranslateService,\r\n  ) { }\r\n\r\n  ngOnInit(): void {\r\n    this.selected = this.parseSelectedPageId();\r\n    this.toggled = [];\r\n    this.filterText$ = new BehaviorSubject('');\r\n    this.searchItems$ = new BehaviorSubject([]);\r\n    this.tree$ = new BehaviorSubject([]);\r\n\r\n    const filteredSearch$ = combineLatest([this.filterText$, this.searchItems$]).pipe(\r\n      map(([filterText, searchItems]) =>\r\n        searchItems.filter(item => item.name.toLocaleLowerCase().includes(filterText.toLocaleLowerCase()))\r\n      ),\r\n    );\r\n    this.templateVars$ = combineLatest([this.filterText$, filteredSearch$, this.tree$]).pipe(\r\n      map(([filterText, filteredSearch, tree]) => {\r\n        const templateVars: PagePickerTemplateVars = {\r\n          filterText,\r\n          filteredSearch,\r\n          tree,\r\n        };\r\n        return templateVars;\r\n      }),\r\n    );\r\n\r\n    this.fetchPages();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.filterText$.complete();\r\n    this.searchItems$.complete();\r\n    this.tree$.complete();\r\n  }\r\n\r\n  setFilter(filterText: string): void {\r\n    this.filterText$.next(filterText);\r\n  }\r\n\r\n  select(page: PageTreeItem | PageSearchItem): void {\r\n    // filters out pages without parent (broken)\r\n    if (page.id == null) { return; }\r\n    if (!page.isClickable || !page.isVisible) {\r\n      const ok = window.confirm(this.translate.instant('Fields.Hyperlink.PagePicker.HiddenOrSystemPageWarning'));\r\n      if (!ok) { return; }\r\n    }\r\n    this.closeDialog(page.id);\r\n  }\r\n\r\n  toggle(pageId: number): void {\r\n    GeneralHelpers.toggleInArray(pageId, this.toggled);\r\n  }\r\n\r\n  private closeDialog(pageId?: number): void {\r\n    if (pageId == null) {\r\n      this.dialogRef.close();\r\n      return;\r\n    }\r\n\r\n    const page = this.searchItems$.value.find(i => i.id === pageId);\r\n    const result: PagePickerResult = {\r\n      id: page.id.toString(),\r\n      name: page.name,\r\n    };\r\n    this.dialogRef.close(result);\r\n  }\r\n\r\n  private fetchPages(): void {\r\n    const query = 'System.Pages';\r\n    const stream = 'Default';\r\n    const params = 'includehidden=true';\r\n    this.queryService.getAvailableEntities(`${query}/${stream}`, true, params, null).subscribe({\r\n      next: (data) => {\r\n        if (!data) {\r\n          console.error(this.translate.instant('Fields.EntityQuery.QueryError'));\r\n          return;\r\n        }\r\n        if (!data[stream]) {\r\n          console.error(this.translate.instant('Fields.EntityQuery.QueryStreamNotFound') + ' ' + stream);\r\n          return;\r\n        }\r\n        const pages = data[stream] as PageEntity[];\r\n        const searchItems = buildPageSearch(pages);\r\n        this.searchItems$.next(searchItems);\r\n        const tree = buildPageTree(pages);\r\n        this.tree$.next(tree);\r\n      },\r\n      error: (error) => {\r\n        console.error(error);\r\n        console.error(`${this.translate.instant('Fields.EntityQuery.QueryError')} - ${error.data}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  private parseSelectedPageId(): number {\r\n    const prefix = 'page:';\r\n    let fieldValue: FieldValue = this.dialogData.group.controls[this.dialogData.config.fieldName].value;\r\n    if (typeof fieldValue !== 'string') { return; }\r\n\r\n    fieldValue = fieldValue.trim().toLocaleLowerCase();\r\n    if (!fieldValue.startsWith(prefix)) { return; }\r\n\r\n    try {\r\n      const id = parseInt(fieldValue.split(prefix)[1], 10);\r\n      return id;\r\n    } catch {\r\n      return;\r\n    }\r\n  }\r\n}\r\n","import { PageEntity, PageSearchItem, PageTreeItem } from './page-picker.models';\r\n\r\nexport function buildPageSearch(pages: PageEntity[]): PageSearchItem[] {\r\n  if (!pages) { return []; }\r\n\r\n  const items = pages.map(page => {\r\n    let path = page.Path.trim().replace(/\\\\/g, '/').replace(/\\/\\//g, '/');\r\n    if (path.startsWith('/')) {\r\n      path = path.substring(1);\r\n    }\r\n    path = path.split('/').slice(0, -1).join(' > ');\r\n\r\n    const item: PageSearchItem = {\r\n      id: page.Id,\r\n      name: page.Name,\r\n      path,\r\n      isVisible: page.Visible,\r\n      isClickable: page.Clickable,\r\n    };\r\n    return item;\r\n  });\r\n\r\n  return items;\r\n}\r\n\r\nexport function buildPageTree(pages: PageEntity[]): PageTreeItem[] {\r\n  if (!pages) { return []; }\r\n\r\n  const items = pages.map(page => {\r\n    const item: PageTreeItem = {\r\n      children: [],\r\n      id: page.Id,\r\n      name: page.Name,\r\n      parentId: page.ParentId,\r\n      isVisible: page.Visible,\r\n      isClickable: page.Clickable,\r\n    };\r\n    return item;\r\n  });\r\n\r\n  const tree: PageTreeItem[] = [];\r\n  for (const item of items) {\r\n    if (item.parentId === -1) {\r\n      tree.push(item);\r\n      continue;\r\n    }\r\n\r\n    const parent = items.find(i => i.id === item.parentId);\r\n    if (!parent) {\r\n      tree.push(item);\r\n    } else {\r\n      parent.children.push(item);\r\n    }\r\n  }\r\n\r\n  return tree;\r\n}\r\n","import { ChangeDetectorRef, ViewContainerRef } from '@angular/core';\r\nimport { FormGroup } from '@angular/forms';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { take } from 'rxjs';\r\nimport { PagePickerResult } from '../../../../../../edit-types';\r\nimport { FieldConfigSet } from '../../form/builder/fields-builder/field-config-set.model';\r\nimport { PagePickerComponent } from '../../form/shared/page-picker/page-picker.component';\r\nimport { PagePickerDialogData } from '../../form/shared/page-picker/page-picker.models';\r\n\r\nexport class PagePicker {\r\n  static open(\r\n    config: FieldConfigSet,\r\n    group: FormGroup,\r\n    dialog: MatDialog,\r\n    viewContainerRef: ViewContainerRef,\r\n    changeDetectorRef: ChangeDetectorRef,\r\n    callback: (value: PagePickerResult) => void,\r\n  ): void {\r\n    const dialogData: PagePickerDialogData = {\r\n      config,\r\n      group,\r\n    };\r\n    const dialogRef = dialog.open(PagePickerComponent, {\r\n      autoFocus: false,\r\n      data: dialogData,\r\n      viewContainerRef,\r\n      height: '80%',\r\n      width: '650px',\r\n    });\r\n\r\n    dialogRef.afterClosed().pipe(take(1)).subscribe((value: PagePickerResult) => {\r\n      callback(value);\r\n    });\r\n\r\n    changeDetectorRef.markForCheck();\r\n  }\r\n}\r\n","export class SanitizeHelper {\r\n\r\n  private static removeFromStart(sanitized: string, charToRemove: string): string {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    while (sanitized.substring(0, 1) === charToRemove) {\r\n      sanitized = sanitized.substring(1);\r\n    }\r\n    return sanitized;\r\n  }\r\n\r\n  private static removeFromEnd(sanitized: string, charToRemove: string): string {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    while (sanitized.substring(sanitized.length - 1, sanitized.length) === charToRemove) {\r\n      sanitized = sanitized.substring(0, sanitized.length - 1);\r\n    }\r\n    return sanitized;\r\n  }\r\n\r\n  private static cleanBadPath(sanitized: string): string {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    const goodChar = '_';\r\n    const illegalRe = /[\\?<>\\\\:\\*\\|\":]/g;\r\n    const controlRe = /[\\x00-\\x1f\\x80-\\x9f]/g;\r\n    const reservedRe = /^\\.+$/;\r\n    const windowsReservedRe = /^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\\..*)?$/i;\r\n    const windowsTrailingRe = /[\\. ]+$/;\r\n    return sanitized\r\n      .replace(illegalRe, goodChar)\r\n      .replace(controlRe, goodChar)\r\n      .replace(reservedRe, goodChar)\r\n      .replace(windowsReservedRe, goodChar)\r\n      .replace(windowsTrailingRe, goodChar);\r\n  }\r\n\r\n  // sanitize path\r\n  static sanitizePath(sanitized: string): string {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    // remove slashes form start of path\r\n    sanitized = this.removeFromStart(sanitized, '\\/');\r\n\r\n    // remove slashed form end of path\r\n    sanitized = this.removeFromEnd(sanitized, '\\/');\r\n\r\n    // remove backslashes form start of path\r\n    sanitized = this.removeFromStart(sanitized, '\\\\');\r\n\r\n    // remove backslashes form end of path\r\n    sanitized = this.removeFromEnd(sanitized, '\\\\');\r\n\r\n    // replace bad\r\n    sanitized = this.cleanBadPath(sanitized);\r\n\r\n    return sanitized;\r\n  }\r\n\r\n  // sanitize file or folder name\r\n  static sanitizeName(sanitized: string): string {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    // in addition to all path validation rules\r\n    // slashes are not valid in file or folder name\r\n    const replacement = '_';\r\n    const illegalRe = /\\//g;\r\n    return this.sanitizePath(sanitized).replace(illegalRe, replacement);\r\n  }\r\n}\r\n","import { AbstractControl, FormGroup } from '@angular/forms';\r\nimport { GeneralHelpers } from '.';\r\nimport { FieldConfigSet } from '../../form/builder/fields-builder/field-config-set.model';\r\nimport { SxcAbstractControl } from '../models';\r\n\r\nexport class ValidationMessagesHelpers {\r\n\r\n  private static validationMessages: Record<string, (config: FieldConfigSet) => string> = {\r\n    required: (config: FieldConfigSet) => {\r\n      return config ? 'ValidationMessage.Required' : `ValidationMessage.RequiredShort`; // short version in snackbar\r\n    },\r\n    min: (config: FieldConfigSet) => {\r\n      return config ? `ValidationMessage.Min` : `ValidationMessage.NotValid`;\r\n    },\r\n    max: (config: FieldConfigSet) => {\r\n      return config ? `ValidationMessage.Max` : `ValidationMessage.NotValid`;\r\n    },\r\n    pattern: (config: FieldConfigSet) => {\r\n      return config ? `ValidationMessage.Pattern` : `ValidationMessage.NotValid`;\r\n    },\r\n    decimals: (config: FieldConfigSet) => {\r\n      return config ? `ValidationMessage.Decimals` : `ValidationMessage.NotValid`;\r\n    },\r\n    jsonError: (config: FieldConfigSet) => {\r\n      return config ? `ValidationMessage.JsonError` : `ValidationMessage.NotValid`;\r\n    },\r\n    formulaError: (config: FieldConfigSet) => {\r\n      return config ? `ValidationMessage.NotValid` : `ValidationMessage.NotValid`;\r\n    },\r\n  };\r\n\r\n  private static warningMessages: Record<string, string> = {\r\n    jsonWarning: 'ValidationMessage.JsonWarning',\r\n    formulaWarning: 'ValidationMessage.NotValid',\r\n  };\r\n\r\n  /** Marks controls as touched to show errors beneath controls and collects error messages */\r\n  static validateForm(form: FormGroup): Record<string, string> {\r\n    const errors: Record<string, string> = {};\r\n    for (const [controlKey, control] of Object.entries(form.controls)) {\r\n      GeneralHelpers.markControlTouched(control);\r\n\r\n      if (!control.invalid) { continue; }\r\n\r\n      for (const errorKey of Object.keys(control.errors)) {\r\n        errors[controlKey] = this.validationMessages[errorKey]?.(undefined);\r\n        if (errors[controlKey]) { break; }\r\n      }\r\n    }\r\n    return errors;\r\n  }\r\n\r\n  /** Calculates error message */\r\n  static getErrorMessage(control: AbstractControl, config: FieldConfigSet): string {\r\n    let error = '';\r\n    if (!control.invalid) { return error; }\r\n    if (!control.dirty && !control.touched) { return error; }\r\n\r\n    for (const errorKey of Object.keys(control.errors)) {\r\n      if (errorKey === 'formulaError') {\r\n        error = control.errors['formulaMessage'] ?? this.validationMessages[errorKey]?.(config);\r\n      } else {\r\n        error = this.validationMessages[errorKey]?.(config);\r\n      }\r\n      if (error) { break; }\r\n    }\r\n\r\n    return error;\r\n  }\r\n\r\n  static getWarningMessage(control: SxcAbstractControl): string {\r\n    let warning = '';\r\n    if (control._warning$.value == null) { return warning; }\r\n    if (!control.dirty && !control.touched) { return warning; }\r\n\r\n    for (const warningKey of Object.keys(control._warning$.value)) {\r\n      if (warningKey === 'formulaWarning') {\r\n        warning = control._warning$.value['formulaMessage'] ?? this.warningMessages[warningKey];\r\n      } else {\r\n        warning = this.warningMessages[warningKey];\r\n      }\r\n      if (warning) { break; }\r\n    }\r\n    return warning;\r\n  }\r\n}\r\n","import { AbstractControl, ValidationErrors, ValidatorFn, Validators } from '@angular/forms';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { FieldSettings } from '../../../../../../edit-types';\r\nimport { InputTypeConstants } from '../../../content-type-fields/constants/input-type.constants';\r\nimport { AdamControl } from '../../form/fields/hyperlink/hyperlink-library/hyperlink-library.models';\r\nimport { SxcAbstractControl } from '../models';\r\nimport { FieldsSettingsService } from '../services';\r\nimport { ItemFieldVisibility } from '../services/item-field-visibility';\r\n\r\n/** Validators here are copied from https://github.com/angular/angular/blob/master/packages/forms/src/validators.ts */\r\nexport class ValidationHelpers {\r\n\r\n  static isRequired(settings: FieldSettings): boolean {\r\n    // hidden field can't be required\r\n    return this.ignoreValidators(settings) ? false : settings.Required;\r\n  }\r\n\r\n  static getValidators(fieldName: string, inputType: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn[] {\r\n    // TODO: merge all validators in a single function? Should be faster\r\n    const validators: ValidatorFn[] = [\r\n      inputType !== InputTypeConstants.HyperlinkLibrary\r\n        ? this.required(fieldName, fieldsSettingsService)\r\n        : this.requiredAdam(fieldName, fieldsSettingsService),\r\n      this.pattern(fieldName, fieldsSettingsService),\r\n      this.decimals(fieldName, fieldsSettingsService),\r\n      this.max(fieldName, fieldsSettingsService),\r\n      this.min(fieldName, fieldsSettingsService),\r\n      this.formulaValidate(fieldName, fieldsSettingsService),\r\n    ];\r\n    if (inputType === InputTypeConstants.CustomJsonEditor) {\r\n      validators.push(this.validJson(fieldName, fieldsSettingsService));\r\n    }\r\n    return validators;\r\n  }\r\n\r\n  /**\r\n   * Validations run when controls are created, but only for fields which are not disabled,\r\n   * and it can be too late to attach warning after field creation\r\n   */\r\n  static ensureWarning(control: SxcAbstractControl): void {\r\n    if (control._warning$ == null) {\r\n      control._warning$ = new BehaviorSubject<ValidationErrors>(null);\r\n    }\r\n  }\r\n\r\n  private static required(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: AbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const settings = fieldsSettingsService.getFieldSettings(fieldName);\r\n      if (this.ignoreValidators(settings)) { return null; }\r\n      if (!settings.Required) { return null; }\r\n\r\n      return Validators.required(control);\r\n    };\r\n  }\r\n\r\n  private static requiredAdam(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: AbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const settings = fieldsSettingsService.getFieldSettings(fieldName);\r\n      if (this.ignoreValidators(settings)) { return null; }\r\n      if (!settings.Required) { return null; }\r\n\r\n      return (control as AdamControl).adamItems === 0 ? { required: true } : null;\r\n    };\r\n  }\r\n\r\n  private static pattern(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: AbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const settings = fieldsSettingsService.getFieldSettings(fieldName);\r\n      if (this.ignoreValidators(settings)) { return null; }\r\n      if (!settings.ValidationRegExJavaScript) { return null; }\r\n\r\n      return Validators.pattern(settings.ValidationRegExJavaScript)(control);\r\n    };\r\n  }\r\n\r\n  private static decimals(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: AbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const settings = fieldsSettingsService.getFieldSettings(fieldName);\r\n      if (this.ignoreValidators(settings)) { return null; }\r\n      if (settings.Decimals == null || settings.Decimals < 0) { return null; }\r\n      if (control.value == null) { return null; }\r\n\r\n      const matchString = settings.Decimals === 0 ? `^-?[0-9]+$` : `^-?[0-9]+(\\.[0-9]{1,${settings.Decimals}})?$`;\r\n      const matches = (control.value as number).toString().match(matchString);\r\n      return !matches ? { decimals: true } : null;\r\n    };\r\n  }\r\n\r\n  private static max(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: AbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const settings = fieldsSettingsService.getFieldSettings(fieldName);\r\n      if (this.ignoreValidators(settings)) { return null; }\r\n      if (settings.Max == null) { return null; }\r\n\r\n      return Validators.max(settings.Max)(control);\r\n    };\r\n  }\r\n\r\n  private static min(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: AbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const settings = fieldsSettingsService.getFieldSettings(fieldName);\r\n      if (this.ignoreValidators(settings)) { return null; }\r\n      if (settings.Min == null) { return null; }\r\n\r\n      return Validators.min(settings.Min)(control);\r\n    };\r\n  }\r\n\r\n  private static validJson(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: SxcAbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const settings = fieldsSettingsService.getFieldSettings(fieldName);\r\n      let error: boolean;\r\n      let warning: boolean;\r\n\r\n      if (this.ignoreValidators(settings) || settings.JsonValidation === 'none' || !control.value) {\r\n        error = false;\r\n        warning = false;\r\n      } else {\r\n        try {\r\n          JSON.parse(control.value);\r\n          error = false;\r\n          warning = false;\r\n        } catch {\r\n          if (settings.JsonValidation === 'strict') {\r\n            error = true;\r\n            warning = false;\r\n          } else if (settings.JsonValidation === 'light') {\r\n            error = false;\r\n            warning = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      control._warning$.next(warning ? { jsonWarning: true } : null);\r\n      return error ? { jsonError: true } : null;\r\n    };\r\n  }\r\n\r\n  private static formulaValidate(fieldName: string, fieldsSettingsService: FieldsSettingsService): ValidatorFn {\r\n    return (control: SxcAbstractControl): ValidationErrors | null => {\r\n      this.ensureWarning(control);\r\n      const fieldProps = fieldsSettingsService.getFieldsProps()[fieldName];\r\n      const settings = fieldProps.settings;\r\n      const formulaValidation = fieldProps.formulaValidation;\r\n      let error: boolean;\r\n      let warning: boolean;\r\n\r\n      if (this.ignoreValidators(settings) || formulaValidation == null) {\r\n        error = false;\r\n        warning = false;\r\n      } else {\r\n        if (formulaValidation.severity === 'error') {\r\n          error = true;\r\n          warning = false;\r\n        } else if (formulaValidation.severity === 'warning') {\r\n          error = false;\r\n          warning = true;\r\n        } else {\r\n          error = false;\r\n          warning = false;\r\n        }\r\n      }\r\n\r\n      control._warning$.next(warning ? { formulaWarning: true, formulaMessage: formulaValidation.message } : null);\r\n      return error ? { formulaError: true, formulaMessage: formulaValidation.message } : null;\r\n    };\r\n  }\r\n\r\n  /** Hidden fields can't have validators */\r\n  private static ignoreValidators(settings: FieldSettings): boolean {\r\n    return !ItemFieldVisibility.mergedVisible(settings);\r\n  }\r\n}\r\n","import { ActivatedRoute } from '@angular/router';\r\nimport { EavConfig } from '../models';\r\n\r\nexport class UrlHelpers {\r\n\r\n  static stripNonUrlCharacters(controlValue: string, allowPath: boolean, trimEnd: boolean) {\r\n    if (!controlValue) { return ''; }\r\n\r\n    const rexSeparators = allowPath ? /[^a-z0-9-_/]+/gi : /[^a-z0-9-_]+/gi;\r\n    const latinized = this.latinizeText(controlValue.toLowerCase());\r\n    const cleanInputValue = latinized\r\n      .replace(`'s `, 's ') // neutralize it's, daniel's etc. but only if followed by a space, to ensure we don't kill quotes\r\n      .replace('\\\\', '/') // neutralize slash representation\r\n      .replace(rexSeparators, '-') // replace everything we don't want with a -\r\n      .replace(/-+/gi, '-') // reduce multiple '-'\r\n      .replace(/\\/+/gi, '/') // reduce multiple slashes\r\n      .replace(/-*\\/-*/gi, '/') // reduce '-/' or '/-' combinations to a simple '/'\r\n      .replace(trimEnd ? /^-|-+$/gi : /^-/gi, ''); // trim front and maybe end '-'\r\n    return cleanInputValue;\r\n  }\r\n\r\n  static latinizeText(input: string) {\r\n    const latinMap: Record<string, string> = {\r\n      : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A',\r\n      : 'A', : 'A', : 'A', : 'Ae', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A',\r\n      : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'A', : 'AA', : 'AE', : 'AE', : 'AE',\r\n      : 'AO', : 'AU', : 'AV', : 'AV', : 'AY', : 'B', : 'B', : 'B', : 'B', : 'B',\r\n      : 'B', : 'C', : 'C', : 'C', : 'C', : 'C', : 'C', : 'C', : 'C', : 'D', : 'D',\r\n      : 'D', : 'D', : 'D', : 'D', : 'D', : 'D', : 'D', : 'D', : 'D', : 'DZ', : 'DZ',\r\n      : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E',\r\n      : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E', : 'E',\r\n      : 'E', : 'E', : 'ET', : 'F', : 'F', : 'G', : 'G', : 'G', : 'G', : 'G', : 'G', : 'G',\r\n      : 'G', : 'G', : 'H', : 'H', : 'H', : 'H', : 'H', : 'H', : 'H', : 'H', : 'H', : 'I',\r\n      : 'I', : 'I', : 'I', : 'I', : 'I', : 'I', : 'I', : 'I', : 'I', : 'I', : 'I', : 'I',\r\n      : 'I', : 'I', : 'I', : 'I', : 'D', : 'F', : 'G', : 'R', : 'S', : 'T', : 'IS', : 'J',\r\n      : 'J', : 'K', : 'K', : 'K', : 'K', : 'K', : 'K', : 'K', : 'K', : 'K', : 'K', : 'L',\r\n      : 'L', : 'L', : 'L', : 'L', : 'L', : 'L', : 'L', : 'L', : 'L', : 'L', : 'L', : 'L',\r\n      : 'L', : 'LJ', : 'M', : 'M', : 'M', : 'M', : 'N', : 'N', : 'N', : 'N', : 'N', : 'N',\r\n      : 'N', : 'N', : 'N', : 'N', : 'N', : 'N', : 'NJ', : 'O', : 'O', : 'O', : 'O', : 'O',\r\n      : 'O', : 'O', : 'O', : 'O', e: 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O',\r\n      : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O',\r\n      : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'O', : 'OI', : 'OO',\r\n      : 'E', : 'O', : 'OU', : 'P', : 'P', : 'P', : 'P', : 'P', : 'P', : 'P', : 'Q', : 'Q',\r\n      : 'R', : 'R', : 'R', : 'R', : 'R', : 'R', : 'R', : 'R', : 'R', : 'R', : 'R', : 'C',\r\n      : 'E', : 'S', : 'S', : 'S', : 'S', : 'S', : 'S', : 'S', : 'S', : 'S', : 'S', : 'T',\r\n      : 'T', : 'T', : 'T', : 'T', : 'T', : 'T', : 'T', : 'T', : 'T', : 'T', : 'A', : 'L',\r\n      : 'M', : 'V', : 'TZ', : 'U', : 'U', : 'U', : 'U', : 'U', : 'Ue', : 'U', : 'U', : 'U',\r\n      : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U',\r\n      : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'U', : 'V', : 'V', : 'V',\r\n      : 'V', : 'VY', : 'W', : 'W', : 'W', : 'W', : 'W', : 'W', : 'W', : 'X', : 'X', : 'Y',\r\n      : 'Y', : 'Y', : 'Y', : 'Y', : 'Y', : 'Y', : 'Y', : 'Y', : 'Y', : 'Y', : 'Y', : 'Z',\r\n      : 'Z', : 'Z', : 'Z', : 'Z', : 'Z', : 'Z', : 'Z', : 'Z', : 'IJ', : 'OE', : 'A', : 'AE',\r\n      : 'B', : 'B', : 'C', : 'D', : 'E', : 'F', : 'G', : 'G', : 'H', : 'I', : 'R', : 'J',\r\n      : 'K', : 'L', : 'L', : 'M', : 'N', : 'O', : 'OE', : 'O', : 'OU', : 'P', : 'R', : 'N',\r\n      : 'R', : 'S', : 'T', : 'E', : 'R', : 'U', : 'V', : 'W', : 'Y', : 'Z', : 'a', : 'a',\r\n      : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a',\r\n      : 'ae', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a', : 'a',\r\n      : 'a', : 'a', : 'a',\r\n      : 'a', : 'a', : 'a', : 'aa', : 'ae', : 'ae', : 'ae', : 'ao', : 'au', : 'av', : 'av',\r\n      : 'ay', : 'b', : 'b', : 'b', : 'b', : 'b', : 'b', : 'b', : 'b', : 'o', : 'c', : 'c',\r\n      : 'c', : 'c', : 'c', : 'c', : 'c', : 'c', : 'c', : 'd', : 'd', : 'd', : 'd', : 'd',\r\n      : 'd', : 'd', : 'd', : 'd', : 'd', : 'd', : 'd', : 'd', : 'd', : 'i', : 'j', : 'j',\r\n      : 'j', : 'dz', : 'dz', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e',\r\n      : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e',\r\n      : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'e', : 'et', : 'f', : 'f', : 'f', : 'f',\r\n      : 'g', : 'g', : 'g', : 'g', : 'g', : 'g', : 'g', : 'g', : 'g', : 'g', : 'h', : 'h',\r\n      : 'h', : 'h', : 'h', : 'h', : 'h', : 'h', : 'h', : 'h', : 'h', : 'hv', : 'i', : 'i',\r\n      : 'i', : 'i', : 'i', : 'i', : 'i', : 'i', : 'i', : 'i', : 'i', : 'i', : 'i', : 'i',\r\n      : 'i', : 'i', : 'i', : 'd', : 'f', : 'g', : 'r', : 's', : 't', : 'is', : 'j', : 'j',\r\n      : 'j', : 'j', : 'k', : 'k', : 'k', : 'k', : 'k', : 'k', : 'k', : 'k', : 'k', : 'k',\r\n      : 'k', : 'l', : 'l', : 'l', : 'l', : 'l', : 'l', : 'l', : 'l', : 'l', : 'l', : 'l',\r\n      : 'l', : 'l', : 'l', : 'l', : 'l', : 'l', : 'lj', : 's', : 's', : 's', : 's', : 'm',\r\n      : 'm', : 'm', : 'm', : 'm', : 'm', : 'n', : 'n', : 'n', : 'n', : 'n', : 'n', : 'n',\r\n      : 'n', : 'n', : 'n', : 'n', : 'n', : 'n', : 'n', : 'n', : 'nj', : 'o', : 'o', : 'o',\r\n      : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'oe', : 'o', : 'o', : 'o', : 'o', : 'o',\r\n      : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o',\r\n      : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o', : 'o',\r\n      : 'oi', : 'oo', : 'e', : 'e', : 'o', : 'o', : 'ou', : 'p', : 'p', : 'p', : 'p', : 'p',\r\n      : 'p', : 'p', : 'p', : 'p', : 'q', : 'q', : 'q', : 'q', : 'r', : 'r', : 'r', : 'r',\r\n      : 'r', : 'r', : 'r', : 'r', : 'r', : 'r', : 'r', : 'r', : 'r', : 'r', : 'r', : 'r',\r\n      : 'c', : 'c', : 'e', : 'r', : 'ss', : 's', : 's', : 's', : 's', : 's', : 's', : 's',\r\n      : 's', : 's', : 's', : 's', : 's', : 's', : 's', : 'g', : 'o', : 'o', : 'u', : 't',\r\n      : 't', : 't', : 't', : 't', : 't', : 't', : 't', : 't', : 't', : 't', : 't', : 't',\r\n      : 't', : 't', : 'th', : 'a', : 'ae', : 'e', : 'g', : 'h', : 'h', : 'h', : 'i', : 'k',\r\n      : 'l', : 'm', : 'm', : 'oe', : 'r', : 'r', : 'r', : 'r', : 't', : 'v', : 'w', : 'y',\r\n      : 'tz', : 'u', : 'u', : 'u', : 'u', : 'u', : 'ue', : 'u', : 'u', : 'u', : 'u', : 'u',\r\n      : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u',\r\n      : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'u', : 'ue', : 'um', : 'v', : 'v',\r\n      : 'v', : 'v', : 'v', : 'v', : 'v', : 'vy', : 'w', : 'w', : 'w', : 'w', : 'w', : 'w',\r\n      : 'w', : 'w', : 'x', : 'x', : 'x', : 'y', : 'y', : 'y', : 'y', : 'y', : 'y', : 'y',\r\n      : 'y', : 'y', : 'y', : 'y', : 'y', : 'y', : 'z', : 'z', : 'z', : 'z', : 'z', : 'z',\r\n      : 'z', : 'z', : 'z', : 'z', : 'z', : 'z', : 'z', : 'z', : 'ff', : 'ffi', : 'ffl', : 'fi',\r\n      : 'fl', : 'ij', : 'oe', : 'st', : 'a', : 'e', : 'i', : 'j', : 'o', : 'r', : 'u', : 'v',\r\n      : 'x',\r\n    };\r\n    return input.replace(/[^A-Za-z0-9\\[\\] ]/g, (a) => (latinMap[a] || a));\r\n  }\r\n\r\n  static readQueryStringParameters(url: string): Record<string, string> {\r\n    const queryParams: Record<string, string> = {};\r\n    url.split('&').forEach(f => {\r\n      if (f.split('=').length === 2) {\r\n        queryParams[f.split('=')[0]] = decodeURIComponent(f.split('=')[1].replace(/\\+/g, ' '));\r\n      }\r\n    });\r\n    return queryParams;\r\n  }\r\n\r\n  /** https://stackoverflow.com/questions/979975/how-to-get-the-value-from-the-get-parameters/1099670#1099670 */\r\n  static getUrlParams(qs: string) {\r\n    qs = qs.split('+').join(' ');\r\n\r\n    const params: Record<string, string> = {};\r\n    let tokens;\r\n    const re = /[?&]?([^=]+)=([^&]*)/g;\r\n\r\n    // tslint:disable-next-line:no-conditional-assignment\r\n    while (tokens = re.exec(qs)) {\r\n      params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\r\n    }\r\n\r\n    return params;\r\n  }\r\n\r\n  static replaceUrlParam(url: string, paramName: string, paramValue: string) {\r\n    if (paramValue === null) { paramValue = ''; }\r\n\r\n    const pattern = new RegExp('\\\\b(' + paramName + '=).*?(&|#|$)');\r\n    if (url.search(pattern) >= 0) { return url.replace(pattern, '$1' + paramValue + '$2'); }\r\n\r\n    url = url.replace(/[?#]$/, '');\r\n    return url + (url.indexOf('?') > 0 ? '&' : '?') + paramName + '=' + paramValue;\r\n  }\r\n\r\n  static getUrlPrefix(area: 'system' | 'zone' | 'app' | 'appShared', eavConfig: EavConfig) {\r\n    let result = '';\r\n\r\n    if (area === 'system') { result = eavConfig.systemRoot; } // used to link to JS-stuff and similar\r\n    if (area === 'zone') { result = eavConfig.portalRoot; } // used to link to the site-root (like an image)\r\n    if (area === 'app') { result = eavConfig.appRoot; } // used to find the app-root of something inside an app\r\n    if (area === 'appShared') { result = eavConfig.appSharedRoot; } // used to find the app-root of something inside an app\r\n    if (result.endsWith('/')) { result = result.substring(0, result.length - 1); }\r\n\r\n    return result;\r\n  }\r\n\r\n  static calculatePathFromRoot(route: ActivatedRoute) {\r\n    let lastChild = route;\r\n    while (lastChild.firstChild) {\r\n      lastChild = lastChild.firstChild;\r\n    }\r\n    let pathFromRoot = '';\r\n    for (const path of lastChild.snapshot.pathFromRoot) {\r\n      if (path.url.length <= 0) { continue; }\r\n      for (const urlSegment of path.url) {\r\n        if (!urlSegment.path) { continue; }\r\n        pathFromRoot += '/' + urlSegment.path;\r\n      }\r\n    }\r\n    return pathFromRoot;\r\n  }\r\n}\r\n","export class EavDimension {\r\n  Value: string;\r\n\r\n  static create(value: string): EavDimension {\r\n    const dimension: EavDimension = {\r\n      Value: value,\r\n    };\r\n    return dimension;\r\n  }\r\n}\r\n","import { EavValue } from '.';\r\nimport { EavValuesDto } from '../json-format-v1';\r\n\r\nexport class EavValues<T> {\r\n  Values: EavValue<T>[];\r\n  Type: string;\r\n\r\n  static convert<T>(valueDto: EavValuesDto<T>, type: string): EavValues<T> {\r\n    const values = EavValue.convert(valueDto);\r\n\r\n    const eavValues: EavValues<T> = {\r\n      Values: values,\r\n      Type: type,\r\n    };\r\n    return eavValues;\r\n  }\r\n}\r\n","import { EavEntity, EavValues } from '.';\r\nimport { EavAttributesDto } from '../json-format-v1';\r\n\r\nexport class EavEntityAttributes {\r\n  [attributeName: string]: EavValues<any>;\r\n\r\n  static convert(attributesDto: EavAttributesDto): EavEntityAttributes {\r\n    const attributes: EavEntityAttributes = {};\r\n\r\n    // loop attribute types - String, Boolean, ...\r\n    for (const [typeName, attributeDto] of Object.entries(attributesDto)) {\r\n      // loop attribute names - Description, Name, ...\r\n      for (const [attributeName, valueDto] of Object.entries(attributeDto)) {\r\n        attributes[attributeName] = EavValues.convert(valueDto, typeName);\r\n      }\r\n    }\r\n    return attributes;\r\n  }\r\n\r\n  static mergeSettings(metadataItems: EavEntity[]): EavEntityAttributes {\r\n    if (metadataItems == null) { return {}; }\r\n\r\n    const merged: EavEntityAttributes = {};\r\n    // copy metadata settings which are not @All\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id === '@All') { continue; }\r\n\r\n      for (const [name, value] of Object.entries(item.Attributes)) {\r\n        const copy: EavValues<any> = { ...value };\r\n        merged[name] = copy;\r\n      }\r\n    }\r\n\r\n    // copy @All metadata settings, overwriting previous settings\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id !== '@All') { continue; }\r\n\r\n      for (const [name, value] of Object.entries(item.Attributes)) {\r\n        // do not overwrite previous settings if @All is empty\r\n        const exists = merged[name] != null;\r\n        const emptyAll = value.Values[0].Value === '';\r\n        if (exists && emptyAll) { continue; }\r\n\r\n        const copy: EavValues<any> = { ...value };\r\n        merged[name] = copy;\r\n      }\r\n    }\r\n    return merged;\r\n  }\r\n}\r\n","import { EavEntityAttributes, EavFor, EavType } from '.';\r\nimport { EavEntityDto } from '../json-format-v1';\r\n\r\nexport class EavEntity {\r\n  Attributes: EavEntityAttributes;\r\n  Guid: string;\r\n  Id: number;\r\n  Owner: string;\r\n  Type: EavType;\r\n  Version: number;\r\n  For?: EavFor;\r\n  Metadata?: EavEntity[];\r\n\r\n  static convertOne(entityDto: EavEntityDto): EavEntity {\r\n    const attributes = EavEntityAttributes.convert(entityDto.Attributes);\r\n    const metadata = this.convertMany(entityDto.Metadata);\r\n\r\n    const entity: EavEntity = {\r\n      Attributes: attributes,\r\n      Guid: entityDto.Guid,\r\n      Id: entityDto.Id,\r\n      Owner: entityDto.Owner,\r\n      Type: entityDto.Type,\r\n      Version: entityDto.Version,\r\n      For: entityDto.For,\r\n      Metadata: metadata,\r\n    };\r\n    return entity;\r\n  }\r\n\r\n  static convertMany(entitiesDto: EavEntityDto[]): EavEntity[] {\r\n    if (entitiesDto == null) { return null; }\r\n\r\n    const entities = entitiesDto.map(entityDto => EavEntity.convertOne(entityDto));\r\n    return entities;\r\n  }\r\n}\r\n","import { ItemIdentifierHeader } from 'projects/eav-ui/src/app/shared/models/edit-form.model';\r\nimport { EavEntity } from '.';\r\nimport { EavEntityBundleDto } from '../json-format-v1';\r\n\r\nexport class EavItem {\r\n  Entity: EavEntity;\r\n  Header: ItemIdentifierHeader;\r\n\r\n  static convert(entityBundleDto: EavEntityBundleDto): EavItem {\r\n    const entity = EavEntity.convertOne(entityBundleDto.Entity);\r\n\r\n    const item: EavItem = {\r\n      Entity: entity,\r\n      Header: entityBundleDto.Header,\r\n    };\r\n    return item;\r\n  }\r\n}\r\n","import { EavDimension } from '.';\r\nimport { EavValuesDto } from '../json-format-v1';\r\n\r\nexport class EavValue<T> {\r\n  Value: T;\r\n  Dimensions: EavDimension[];\r\n\r\n  static create<T>(value: T, dimensions: EavDimension[]): EavValue<T> {\r\n    const eavValue: EavValue<T> = {\r\n      Value: value,\r\n      Dimensions: dimensions,\r\n    };\r\n    return eavValue;\r\n  }\r\n\r\n  static convert<T>(valuesDto: EavValuesDto<T>): EavValue<T>[] {\r\n    const values = Object.entries(valuesDto).map(([langs, value]) => {\r\n      const dimensions = langs.split(',').map(lang => EavDimension.create(lang));\r\n      return this.create(value, dimensions);\r\n    });\r\n    return values;\r\n  }\r\n}\r\n","export interface LogEntry {\r\n  error: any;\r\n  label: string;\r\n  severity: LogSeverity;\r\n  time: number;\r\n}\r\n\r\nexport const LogSeverities = {\r\n  Error: 'error',\r\n  Log: 'log',\r\n  Warn: 'warn',\r\n} as const;\r\n\r\nexport type LogSeverity = typeof LogSeverities[keyof typeof LogSeverities];\r\n","/** PublishMode is short version of PublishStatus */\r\nexport const PublishModes = {\r\n  Show: 'show',\r\n  Hide: 'hide',\r\n  Branch: 'branch',\r\n} as const;\r\n\r\nexport type PublishMode = typeof PublishModes[keyof typeof PublishModes];\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { EavService } from '.';\r\nimport { AdamConfig, AdamItem } from '../../../../../../edit-types';\r\nimport { SanitizeHelper } from '../helpers';\r\nimport { LinkInfo } from '../models';\r\n\r\n@Injectable()\r\nexport class AdamService {\r\n  constructor(private http: HttpClient, private dnnContext: DnnContext, private eavService: EavService) { }\r\n\r\n  getAll(url: string, config: AdamConfig) {\r\n    return this.http.get<AdamItem[]>(url + '/items', {\r\n      params: {\r\n        subfolder: config.subfolder,\r\n        usePortalRoot: config.usePortalRoot.toString(),\r\n        appId: this.eavService.eavConfig.appId,\r\n      }\r\n    });\r\n  }\r\n\r\n  addFolder(newfolder: string, url: string, config: AdamConfig) {\r\n    return this.http.post<AdamItem[]>(url + '/folder', {}, {\r\n      params: {\r\n        subfolder: config.subfolder,\r\n        newFolder: SanitizeHelper.sanitizeName(newfolder),\r\n        usePortalRoot: config.usePortalRoot.toString(),\r\n        appId: this.eavService.eavConfig.appId,\r\n      }\r\n    });\r\n  }\r\n\r\n  rename(item: AdamItem, newName: string, url: string, config: AdamConfig) {\r\n    return this.http.get<boolean>(url + '/rename', {\r\n      params: {\r\n        subfolder: config.subfolder,\r\n        isFolder: item.IsFolder.toString(),\r\n        id: item.Id.toString(),\r\n        usePortalRoot: config.usePortalRoot.toString(),\r\n        newName: SanitizeHelper.sanitizeName(newName),\r\n        appId: this.eavService.eavConfig.appId,\r\n      }\r\n    });\r\n  }\r\n\r\n  deleteItem(item: AdamItem, url: string, config: AdamConfig) {\r\n    return this.http.get<boolean>(url + '/delete', {\r\n      params: {\r\n        subfolder: config.subfolder,\r\n        isFolder: item.IsFolder.toString(),\r\n        id: item.Id.toString(),\r\n        usePortalRoot: config.usePortalRoot.toString(),\r\n        appId: this.eavService.eavConfig.appId,\r\n      }\r\n    });\r\n  }\r\n\r\n  getLinkInfo(link: string, contentType: string, guid: string, field: string): Observable<LinkInfo> {\r\n    return this.http.get<LinkInfo>(this.dnnContext.$2sxc.http.apiUrl('cms/edit/linkInfo'), {\r\n      params: {\r\n        link,\r\n        ...(guid && { guid }),\r\n        ...(contentType && { contentType }),\r\n        ...(field && { field }),\r\n        appid: this.eavService.eavConfig.appId,\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { map, tap } from 'rxjs';\r\nimport { DialogContext } from '../../../app-administration/models';\r\nimport { keyPartOfPage, keyPublishing, partOfPageDefault } from '../../../shared/constants/session.constants';\r\nimport { Context } from '../../../shared/services/context';\r\nimport { EavEditLoadDto, EditSettings, SaveEavFormData } from '../../dialog/main/edit-dialog-main.models';\r\nimport { EavConfig, SaveResult, VersioningOptions } from '../models';\r\nimport { GlobalConfigService } from '../store/ngrx-data';\r\n\r\nexport const webApiEditRoot = 'cms/edit/';\r\nexport const webApiEntityPicker = 'cms/edit/EntityPicker';\r\n\r\n@Injectable()\r\nexport class EavService {\r\n  /** WARNING! These are constants that form was loaded with. They do not change while form is running */\r\n  eavConfig: EavConfig;\r\n\r\n  settings: EditSettings;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private dnnContext: DnnContext,\r\n    /** Used to fetch form data and fill up eavConfig. Do not use anywhere else */\r\n    private context: Context,\r\n    private globalConfigService: GlobalConfigService,\r\n  ) { }\r\n\r\n  /** Create EavConfiguration from sessionStorage */\r\n  setEavConfig(\r\n    dialogContext: DialogContext,\r\n    formId: number,\r\n    isParentDialog: boolean,\r\n    itemGuids: string[],\r\n    createMode: boolean,\r\n    isCopy: boolean,\r\n    enableHistory: boolean,\r\n    settings: EditSettings,\r\n  ) {\r\n    this.settings = settings;\r\n    this.eavConfig = {\r\n      zoneId: this.context.zoneId.toString(),\r\n      appId: this.context.appId.toString(),\r\n      appRoot: dialogContext.App.Url,\r\n      appSharedRoot: dialogContext.App.SharedUrl,\r\n      lang: dialogContext.Language.Current,\r\n      langPri: dialogContext.Language.Primary,\r\n      langs: dialogContext.Language.List,\r\n      moduleId: this.context.moduleId?.toString(),\r\n      partOfPage: sessionStorage.getItem(keyPartOfPage) ?? partOfPageDefault,\r\n      portalRoot: dialogContext.Site.Url,\r\n      tabId: this.context.tabId?.toString(),\r\n      systemRoot: window.location.pathname.split('/dist/')[0] + '/',\r\n      versioningOptions: this.getVersioningOptions(\r\n        sessionStorage.getItem(keyPartOfPage) === 'true',\r\n        sessionStorage.getItem(keyPublishing),\r\n      ),\r\n      formId,\r\n      isParentDialog,\r\n      itemGuids,\r\n      createMode,\r\n      isCopy,\r\n      enableHistory,\r\n      enableFormulaSave: dialogContext.Enable.FormulaSave ?? false,\r\n      overrideEditRestrictions: dialogContext.Enable.OverrideEditRestrictions ?? false,\r\n      dialogContext,\r\n      settings\r\n    };\r\n  }\r\n\r\n  fetchFormData(items: string) {\r\n    return this.http.post<EavEditLoadDto>(this.dnnContext.$2sxc.http.apiUrl(webApiEditRoot + 'load'), items, {\r\n      params: { appId: this.context.appId.toString() }\r\n    }).pipe(\r\n      map(formData => {\r\n        formData.Context.Language.List = formData.Context.Language.List.filter(language => language.IsEnabled);\r\n        return formData;\r\n      }),\r\n      tap(formData => {\r\n        this.globalConfigService.allowDebug(formData.Context.Enable.DebugMode);\r\n      }),\r\n    );\r\n  }\r\n\r\n  saveFormData(result: SaveEavFormData, partOfPage: string) {\r\n    return this.http.post<SaveResult>(this.dnnContext.$2sxc.http.apiUrl(webApiEditRoot + 'save'), result, {\r\n      params: { appId: this.eavConfig.appId, partOfPage }\r\n    });\r\n  }\r\n\r\n  private getVersioningOptions(partOfPage: boolean, publishing: string): VersioningOptions {\r\n    const allowAll: VersioningOptions = { show: true, hide: true, branch: true };\r\n    if (!partOfPage) {\r\n      return allowAll;\r\n    }\r\n\r\n    const publish = publishing || '';\r\n    switch (publish) {\r\n      case '':\r\n      case 'DraftOptional':\r\n        return allowAll;\r\n      case 'DraftRequired':\r\n        // Note: the key 'show' should not be added, as the code later picks the first property to set the default\r\n        // Branch should also be first, as it's the preferred option\r\n        return { branch: true, hide: true };\r\n      case 'DraftForbidden':\r\n        return { show: true };\r\n      default: {\r\n        console.error(`Invalid versioning requirements: ${publish}`);\r\n        return {};\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { EavService } from '.';\r\nimport { FieldSettings } from '../../../../../../edit-types';\r\nimport { InputTypeConstants } from '../../../content-type-fields/constants/input-type.constants';\r\nimport { UpdateEnvVarsFromDialogSettings } from '../../../shared/helpers/update-env-vars-from-dialog-settings.helper';\r\nimport { convertUrlToForm } from '../../../shared/helpers/url-prep.helper';\r\nimport { FeaturesService } from '../../../shared/services/features.service';\r\nimport { calculateIsParentDialog, sortLanguages } from '../../dialog/main/edit-dialog-main.helpers';\r\nimport { EavEditLoadDto } from '../../dialog/main/edit-dialog-main.models';\r\nimport { EditParams } from '../../edit-matcher.models';\r\nimport { BestValueModes } from '../constants';\r\nimport { EntityReader, FieldsSettingsHelpers, InputFieldHelpers, LocalizationHelpers } from '../helpers';\r\nimport { FormValues } from '../models';\r\nimport { EavEntity } from '../models/eav/eav-entity';\r\n// tslint:disable-next-line:max-line-length\r\nimport { AdamCacheService, ContentTypeItemService, ContentTypeService, EntityCacheService, InputTypeService, ItemService, LanguageInstanceService, LanguageService, LinkCacheService, PublishStatusService } from '../store/ngrx-data';\r\nimport { ItemAddIdentifier } from '../../../shared/models/edit-form.model';\r\n\r\n@Injectable()\r\nexport class EditInitializerService implements OnDestroy {\r\n  loaded$ = new BehaviorSubject(false);\r\n\r\n  private initialFormValues: Record<string, FormValues> = {};\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private eavService: EavService,\r\n    private itemService: ItemService,\r\n    private inputTypeService: InputTypeService,\r\n    private contentTypeItemService: ContentTypeItemService,\r\n    private contentTypeService: ContentTypeService,\r\n    private publishStatusService: PublishStatusService,\r\n    private translate: TranslateService,\r\n    private languageService: LanguageService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private snackBar: MatSnackBar,\r\n    private entityCacheService: EntityCacheService,\r\n    private adamCacheService: AdamCacheService,\r\n    private linkCacheService: LinkCacheService,\r\n    private featuresService: FeaturesService,\r\n  ) { }\r\n\r\n  ngOnDestroy(): void {\r\n    this.loaded$.complete();\r\n  }\r\n\r\n  fetchFormData(): void {\r\n    const form = convertUrlToForm((this.route.snapshot.params as EditParams).items);\r\n    const editItems = JSON.stringify(form.items);\r\n    this.eavService.fetchFormData(editItems).subscribe(formData => {\r\n      // SDV: comment it\r\n      this.featuresService.load(formData.Context);\r\n      UpdateEnvVarsFromDialogSettings(formData.Context.App);\r\n      this.importLoadedData(formData);\r\n      this.keepInitialValues();\r\n      this.setMissingValues();\r\n\r\n      this.loaded$.next(true);\r\n    });\r\n  }\r\n\r\n  private importLoadedData(loadDto: EavEditLoadDto): void {\r\n    const formId = Math.floor(Math.random() * 99999);\r\n    const isParentDialog = calculateIsParentDialog(this.route);\r\n    const itemGuids = loadDto.Items.map(item => item.Entity.Guid);\r\n\r\n    this.itemService.loadItems(loadDto.Items);\r\n    // we assume that input type and content type data won't change between loading parent and child forms\r\n    this.inputTypeService.addInputTypes(loadDto.InputTypes);\r\n    this.contentTypeItemService.addContentTypeItems(loadDto.ContentTypeItems);\r\n    this.contentTypeService.addContentTypes(loadDto.ContentTypes);\r\n    this.adamCacheService.loadPrefetch(loadDto.Prefetch?.Adam);\r\n    this.entityCacheService.loadEntities(loadDto.Prefetch?.Entities);\r\n    this.linkCacheService.loadPrefetch(loadDto.Prefetch?.Links, loadDto.Prefetch?.Adam);\r\n\r\n    const items = this.itemService.getItems(itemGuids);\r\n    const createMode = items[0].Entity.Id === 0;\r\n    const isCopy = (items[0].Header as ItemAddIdentifier).DuplicateEntity != null;\r\n    const enableHistory = !createMode && this.route.snapshot.data.history !== false;\r\n    const settingsAsEav = {\r\n      ...loadDto.Settings,\r\n      Entities: EavEntity.convertMany(loadDto.Settings.Entities)\r\n    };\r\n    this.eavService.setEavConfig(loadDto.Context, formId, isParentDialog, itemGuids, createMode, isCopy, enableHistory, settingsAsEav);\r\n\r\n    const currentLanguage = this.eavService.eavConfig.lang;\r\n    const defaultLanguage = this.eavService.eavConfig.langPri;\r\n    const languages = this.eavService.eavConfig.langs;\r\n    // WARNING! TranslateService is a new instance for every form and language must be set for every one of them\r\n    const isoLangCode = currentLanguage.split('-')[0];\r\n    this.translate.use(isoLangCode);\r\n\r\n    // load language data only for parent dialog to not overwrite languages when opening child dialogs\r\n    if (isParentDialog) {\r\n      const sortedLanguages = sortLanguages(defaultLanguage, languages);\r\n      this.languageService.loadLanguages(sortedLanguages);\r\n    }\r\n    this.languageInstanceService.addLanguageInstance(formId, currentLanguage, defaultLanguage, currentLanguage, false);\r\n\r\n    // First convert to publish mode, because then it will run checks if this is allowed\r\n    const publishMode = this.publishStatusService.asPublishMode(loadDto.IsPublished, loadDto.DraftShouldBranch);\r\n    this.publishStatusService.setPublishMode(publishMode, formId, this.eavService);\r\n  }\r\n\r\n  private keepInitialValues(): void {\r\n    const items = this.itemService.getItems(this.eavService.eavConfig.itemGuids);\r\n    const languages = this.languageService.getLanguages().map(language => language.NameId);\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    if (!languages.includes(currentLanguage)) {\r\n      languages.push(currentLanguage);\r\n    }\r\n    if (!languages.includes(defaultLanguage)) {\r\n      languages.push(defaultLanguage);\r\n    }\r\n\r\n    for (const item of items) {\r\n      for (const language of languages) {\r\n        const formValues: FormValues = {};\r\n        for (const [fieldName, fieldValues] of Object.entries(item.Entity.Attributes)) {\r\n          formValues[fieldName] = LocalizationHelpers.translate(language, defaultLanguage, fieldValues, null);\r\n        }\r\n        this.initialFormValues[this.getInitialValuesKey(item.Entity.Guid, language)] = formValues;\r\n      }\r\n    }\r\n  }\r\n\r\n  private getInitialValuesKey(entityGuid: string, language: string): string {\r\n    return `entityGuid:${entityGuid}:language:${language}`;\r\n  }\r\n\r\n  getInitialValues(entityGuid: string, language: string): FormValues {\r\n    return this.initialFormValues[this.getInitialValuesKey(entityGuid, language)];\r\n  }\r\n\r\n  private setMissingValues(): void {\r\n    const items = this.itemService.getItems(this.eavService.eavConfig.itemGuids);\r\n    const inputTypes = this.inputTypeService.getInputTypes();\r\n    const languages = this.languageService.getLanguages();\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    let switchToDefault = false;\r\n\r\n    for (const item of items) {\r\n      const contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n      const contentType = this.contentTypeService.getContentType(contentTypeId);\r\n\r\n      for (const ctAttribute of contentType.Attributes) {\r\n        const inputType = inputTypes.find(i => i.Type === ctAttribute.InputType);\r\n        // 'custom-default' doesn't have inputType and 'empty-default' and 'empty-end' and 'empty-message' don't save value\r\n        const empties: string[] = [InputTypeConstants.EmptyDefault, InputTypeConstants.EmptyEnd, InputTypeConstants.EmptyMessage];\r\n        if (empties.includes(inputType?.Type)) { continue; }\r\n\r\n        const attributeValues = item.Entity.Attributes[ctAttribute.Name];\r\n        const fieldSettings = FieldsSettingsHelpers.setDefaultFieldSettings(\r\n          new EntityReader(defaultLanguage, defaultLanguage).flattenAll(ctAttribute.Metadata)\r\n          // FieldsSettingsHelpers.mergeSettings<FieldSettings>(ctAttribute.Metadata, defaultLanguage, defaultLanguage),\r\n        );\r\n\r\n        if (languages.length === 0) {\r\n          const firstValue = LocalizationHelpers.getBestValue(attributeValues, '*', '*', BestValueModes.Default);\r\n          if (InputFieldHelpers.isValueEmpty(firstValue, this.eavService)) {\r\n            this.itemService.setDefaultValue(item, ctAttribute, inputType, fieldSettings, languages, defaultLanguage);\r\n          }\r\n        } else {\r\n          const noLanguageValue = LocalizationHelpers.getBestValue(attributeValues, '*', '*', BestValueModes.Strict);\r\n          if (!inputType?.DisableI18n && noLanguageValue !== undefined) {\r\n            // move * value to defaultLanguage\r\n            const transactionItem = this.itemService.removeItemAttributeDimension(item.Entity.Guid, ctAttribute.Name, '*', true);\r\n            this.itemService.addItemAttributeValue(\r\n              item.Entity.Guid,\r\n              ctAttribute.Name,\r\n              noLanguageValue,\r\n              defaultLanguage,\r\n              false,\r\n              ctAttribute.Type,\r\n              false,\r\n              transactionItem,\r\n            );\r\n            continue;\r\n          }\r\n\r\n          const defaultLanguageValue = LocalizationHelpers.getBestValue(\r\n            attributeValues,\r\n            defaultLanguage,\r\n            defaultLanguage,\r\n            BestValueModes.Strict,\r\n          );\r\n\r\n          if (InputFieldHelpers.isValueEmpty(defaultLanguageValue, this.eavService)) {\r\n            const valUsed = this.itemService.setDefaultValue(item, ctAttribute, inputType, fieldSettings, languages, defaultLanguage);\r\n\r\n            // 2022-08-15 2dm added this\r\n            // If we run into more problems (like required date-fields which result in null)\r\n            // we may have to update the logic to use FieldLogicBase and add rules for each type what would be valid\r\n            // or test for IsRequired as well\r\n\r\n            // If the primary language isn't ready, enforce switch-to-default\r\n            // Skif this for ephemeral fields as they never load with content\r\n            // Also switch for fields which use null as default (like boolean-tristate) as this kind of \"empty\" is valid\r\n            if (valUsed != null && !fieldSettings.IsEphemeral) {\r\n              switchToDefault = true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    if (switchToDefault && currentLanguage !== defaultLanguage) {\r\n      this.languageInstanceService.setCurrentLanguage(this.eavService.eavConfig.formId, defaultLanguage);\r\n      const message = this.translate.instant('Message.SwitchedLanguageToDefault', { language: defaultLanguage });\r\n      this.snackBar.open(message, null, { duration: 5000 });\r\n    }\r\n  }\r\n}\r\n","import { ActivatedRoute } from '@angular/router';\r\nimport { Language } from '../../shared/models';\r\n\r\nexport function calculateIsParentDialog(route: ActivatedRoute) {\r\n  let editDialogCount = 0;\r\n  for (const path of route.snapshot.pathFromRoot) {\r\n    if (path.url.length <= 0) { continue; }\r\n    for (const urlSegment of path.url) {\r\n      if (urlSegment.path !== 'edit') { continue; }\r\n      editDialogCount++;\r\n    }\r\n  }\r\n  return editDialogCount === 1;\r\n}\r\n\r\nexport function sortLanguages(primaryLangKey: string, languages: Language[]) {\r\n  if (languages.length === 0) { return languages; }\r\n\r\n  let primaryLang: Language;\r\n  const sameLangs: Language[] = [];\r\n  const otherLangs: Language[] = [];\r\n  for (const language of languages) {\r\n    if (language.NameId === primaryLangKey) {\r\n      primaryLang = language;\r\n    } else if (language.NameId.startsWith(primaryLangKey.split('-')[0])) {\r\n      sameLangs.push(language);\r\n    } else {\r\n      otherLangs.push(language);\r\n    }\r\n  }\r\n  sameLangs.sort((a, b) => a.NameId.localeCompare(b.NameId));\r\n  otherLangs.sort((a, b) => a.NameId.localeCompare(b.NameId));\r\n\r\n  const allLangsSorted: Language[] = !primaryLang ? [...sameLangs, ...otherLangs] : [primaryLang, ...sameLangs, ...otherLangs];\r\n  return allLangsSorted;\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport { distinctUntilChanged, filter, map, pairwise, startWith, Subject, Subscription } from 'rxjs';\r\nimport { EavService } from '.';\r\nimport { ItemHistoryResult } from '../../../item-history/models/item-history-result.model';\r\nimport { BaseSubsinkComponent } from '../../../shared/components/base-subsink-component/base-subsink.component';\r\nimport { convertFormToUrl } from '../../../shared/helpers/url-prep.helper';\r\nimport { EditForm } from '../../../shared/models/edit-form.model';\r\nimport { EditEntryComponent } from '../../dialog/entry/edit-entry.component';\r\nimport { EditParams } from '../../edit-matcher.models';\r\nimport { UrlHelpers } from '../helpers';\r\nimport { ChildFormResult, NavigateFormResult } from '../models';\r\nimport { LanguageInstanceService } from '../store/ngrx-data';\r\n\r\n@Injectable()\r\nexport class EditRoutingService extends BaseSubsinkComponent implements OnDestroy {\r\n  private childFormResult$: Subject<ChildFormResult>;\r\n\r\n  constructor(\r\n    private dialogRef: MatDialogRef<EditEntryComponent>,\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private eavService: EavService,\r\n  ) { \r\n    super();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.childFormResult$.complete();\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  init() {\r\n    this.childFormResult$ = new Subject<ChildFormResult>();\r\n    this.initHideHeader();\r\n    this.initChildFormResult();\r\n    this.refreshOnChildVersionsClosed();\r\n  }\r\n\r\n  /** Tells if field with this index should be expanded */\r\n  isExpanded(fieldId: number, entityGuid: string) {\r\n    const fieldIndex = fieldId.toString();\r\n    const params = this.route.snapshot.params as EditParams;\r\n    const isExpanded = params.detailsEntityGuid === entityGuid && params.detailsFieldId === fieldIndex;\r\n    return isExpanded;\r\n  }\r\n\r\n  /** Tells if field with this index should be expanded */\r\n  isExpanded$(fieldId: number, entityGuid: string) {\r\n    const fieldIndex = fieldId.toString();\r\n    return this.route.params.pipe(\r\n      map((params: EditParams) => params.detailsEntityGuid === entityGuid && params.detailsFieldId === fieldIndex),\r\n      distinctUntilChanged()\r\n    );\r\n  }\r\n\r\n  /** Fires when child form is closed and has a result, new entity was added */\r\n  childFormResult(fieldId: number, entityGuid: string) {\r\n    return this.childFormResult$.pipe(\r\n      filter(\r\n        childResult => childResult.updateEntityGuid === entityGuid && childResult.updateFieldId === fieldId && childResult.result != null\r\n      ),\r\n      map(childResult => childResult.result)\r\n    );\r\n  }\r\n\r\n  /** Fires when child form is closed */\r\n  childFormClosed() {\r\n    return this.childFormResult$.pipe(map(childResult => null));\r\n  }\r\n\r\n  expand(expand: boolean, fieldId: number, entityGuid: string, componentTag?: string) {\r\n    const params = this.route.snapshot.params as EditParams;\r\n    const oldHasDetails = params.detailsEntityGuid != null && params.detailsFieldId != null;\r\n    const oldEditUrl = `edit/${params.items}` + (oldHasDetails ? `/details/${params.detailsEntityGuid}/${params.detailsFieldId}` : '');\r\n    const newEditUrl = `edit/${params.items}` + (expand ? `/details/${entityGuid}/${fieldId}` : '');\r\n\r\n    const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n    const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n    if (lastIndex <= 0) { return; }\r\n    const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n    this.router.navigate([newUrl], { state: componentTag && { componentTag } });\r\n  }\r\n\r\n  /** Opens child dialog and stores update entityGuid and fieldId in the url, if field is not expanded already */\r\n  open(fieldId: number, entityGuid: string, form: EditForm) {\r\n    const formUrl = convertFormToUrl(form);\r\n    const params = this.route.snapshot.params as EditParams;\r\n    const hasDetails = params.detailsEntityGuid != null && params.detailsFieldId != null;\r\n    // if field is expanded, just open child because that info will be used for field update\r\n    if (hasDetails) {\r\n      this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n      return;\r\n    }\r\n\r\n    // otherwise add /update/:entityGuid/:fieldId to the url\r\n    const oldEditUrl = `edit/${params.items}`;\r\n    const newEditUrl = `edit/${params.items}/update/${entityGuid}/${fieldId}/edit/${formUrl}`;\r\n\r\n    const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n    const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n    if (lastIndex <= 0) { return; }\r\n    const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n    this.router.navigate([newUrl]);\r\n  }\r\n\r\n  /** Update hideHeader for the form. Fix for safari and mobile browsers */\r\n  private initHideHeader() {\r\n    this.subscription.add(\r\n      this.route.params\r\n        .pipe(\r\n          map((params: EditParams) => params.detailsEntityGuid != null && params.detailsFieldId != null),\r\n          distinctUntilChanged(),\r\n        )\r\n        .subscribe(hasDetails => {\r\n          this.languageInstanceService.updateHideHeader(this.eavService.eavConfig.formId, hasDetails);\r\n        })\r\n    );\r\n  }\r\n\r\n  private initChildFormResult() {\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        startWith(!!this.route.snapshot.firstChild),\r\n        map(() => !!this.route.snapshot.firstChild),\r\n        pairwise(),\r\n        filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n        map(() => {\r\n          const params = this.route.snapshot.params as EditParams;\r\n          const hasDetails = params.detailsEntityGuid != null && params.detailsFieldId != null;\r\n          const updateEntityGuid = hasDetails ? params.detailsEntityGuid : params.updateEntityGuid;\r\n          const updateFieldId = hasDetails ? params.detailsFieldId : params.updateFieldId;\r\n          const navigation = this.router.getCurrentNavigation();\r\n          const editResult = navigation.extras?.state;\r\n          const formResult: ChildFormResult = {\r\n            updateEntityGuid,\r\n            updateFieldId: parseInt(updateFieldId, 10),\r\n            result: editResult,\r\n          };\r\n          return formResult;\r\n        }),\r\n      ).subscribe(formResult => {\r\n        // alert subscribers that child form closed\r\n        this.childFormResult$.next(formResult);\r\n\r\n        // clear update ids from url (leave expanded/details)\r\n        const params = this.route.snapshot.params as EditParams;\r\n        const hasUpdate = params.updateEntityGuid != null && params.updateFieldId != null;\r\n        if (!hasUpdate) { return; }\r\n\r\n        const oldEditUrl = `edit/${params.items}/update/${params.updateEntityGuid}/${params.updateFieldId}`;\r\n        const newEditUrl = `edit/${params.items}`;\r\n\r\n        const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n        const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n        if (lastIndex <= 0) { return; }\r\n        const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n        this.router.navigate([newUrl]);\r\n      })\r\n    );\r\n  }\r\n\r\n  private refreshOnChildVersionsClosed() {\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        startWith(!!this.route.snapshot.firstChild),\r\n        map(() => !!this.route.snapshot.firstChild),\r\n        pairwise(),\r\n        filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n        map(() => {\r\n          const navigation = this.router.getCurrentNavigation();\r\n          const versionsResult = navigation.extras?.state as ItemHistoryResult;\r\n          return versionsResult;\r\n        }),\r\n        filter(versionsResult => versionsResult?.refreshEdit != null),\r\n      ).subscribe(result => {\r\n        if (!result.refreshEdit) { return; }\r\n        const params = this.route.snapshot.params as EditParams;\r\n        const oldEditUrl = `edit/${params.items}`;\r\n        const newEditUrl = `edit/refresh/${params.items}`;\r\n\r\n        const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n        const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n        if (lastIndex <= 0) { return; }\r\n        const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n        const navRes: NavigateFormResult = {\r\n          navigateUrl: newUrl,\r\n        };\r\n        this.dialogRef.close(navRes);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Context } from 'projects/eav-ui/src/app/shared/services/context';\r\nimport { filter, Observable, share, switchMap } from 'rxjs';\r\nimport { EavService, webApiEntityPicker } from '.';\r\nimport { EntityInfo } from '../../../../../../edit-types';\r\n\r\nexport const webApiEntityRoot = 'admin/entity/';\r\nexport const webApiEntityList = 'admin/entity/list';\r\n\r\n@Injectable()\r\nexport class EntityService {\r\n  constructor(private http: HttpClient, private eavService: EavService, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  // 2dm 2023-01-22 #maybeSupportIncludeParentApps\r\n  getAvailableEntities(contentTypeName: string, entitiesFilter?: string[]/*, includeParentApps: boolean = null*/): Observable<EntityInfo[]> {\r\n    // eavConfig for edit ui and context for other calls\r\n    const context = this.eavService.eavConfig ?? this.context;\r\n    return this.http.post<EntityInfo[]>(this.dnnContext.$2sxc.http.apiUrl(webApiEntityPicker), entitiesFilter, {\r\n      params: {\r\n        contentTypeName,\r\n        appId: context.appId.toString(),\r\n        // 2dm 2023-01-22 #maybeSupportIncludeParentApps\r\n        // ...(includeParentApps ? { includeParentApps: includeParentApps } : {}),\r\n      },\r\n    });\r\n  }\r\n\r\n  // Experimental 2dm\r\n  reactiveEntities(params: Observable<{ contentTypeName: string }>): Observable<EntityInfo[]> {\r\n    return params.pipe(\r\n      filter(p => p != null),\r\n      switchMap(p => this.getAvailableEntities(p.contentTypeName).pipe(share())),\r\n    );\r\n  }\r\n\r\n  delete(contentType: string, entityId: number, force: boolean, parentId?: number, parentField?: string): Observable<null> {\r\n    return this.http.delete<null>(this.dnnContext.$2sxc.http.apiUrl(webApiEntityRoot + 'delete'), {\r\n      params: {\r\n        contentType,\r\n        id: entityId.toString(),\r\n        appId: this.eavService.eavConfig.appId,\r\n        force: force.toString(),\r\n        ...(parentId && { parentId: parentId.toString() }),\r\n        ...(parentId && parentField && { parentField }),\r\n      },\r\n    });\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, combineLatest, distinctUntilChanged, map, Observable, Subject, Subscription } from 'rxjs';\r\nimport { EavService } from '.';\r\nimport { GeneralHelpers } from '../helpers';\r\nimport { FormReadOnly } from '../models';\r\nimport { ItemService, LanguageInstanceService, LanguageService } from '../store/ngrx-data';\r\n\r\n@Injectable()\r\nexport class FormsStateService implements OnDestroy {\r\n  saveForm$: Subject<boolean>;\r\n  readOnly$: BehaviorSubject<FormReadOnly>;\r\n  formsValid$: BehaviorSubject<boolean>;\r\n  formsDirty$: BehaviorSubject<boolean>;\r\n  saveButtonDisabled$: Observable<boolean>;\r\n\r\n  private formsValid: Record<string, boolean>;\r\n  private formsDirty: Record<string, boolean>;\r\n  private subscription: Subscription;\r\n\r\n  constructor(\r\n    private eavService: EavService,\r\n    private itemService: ItemService,\r\n    private languageService: LanguageService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n  ) { }\r\n\r\n  ngOnDestroy() {\r\n    this.saveForm$.complete();\r\n    this.readOnly$?.complete();\r\n    this.formsValid$?.complete();\r\n    this.formsDirty$?.complete();\r\n    this.subscription?.unsubscribe();\r\n  }\r\n\r\n  init() {\r\n    this.subscription = new Subscription();\r\n    this.saveForm$ = new Subject();\r\n    const initialReadOnly: FormReadOnly = { isReadOnly: true, reason: undefined };\r\n    this.readOnly$ = new BehaviorSubject(initialReadOnly);\r\n    this.formsValid$ = new BehaviorSubject(false);\r\n    this.formsDirty$ = new BehaviorSubject(false);\r\n    this.saveButtonDisabled$ = combineLatest([this.readOnly$, this.formsValid$]).pipe(\r\n      map(([readOnly, formsValid]) => readOnly.isReadOnly || !formsValid),\r\n      distinctUntilChanged(),\r\n    );\r\n    this.formsValid = {};\r\n    this.formsDirty = {};\r\n    for (const entityGuid of this.eavService.eavConfig.itemGuids) {\r\n      this.formsValid[entityGuid] = false;\r\n      this.formsDirty[entityGuid] = false;\r\n    }\r\n\r\n    this.subscription.add(\r\n      combineLatest([\r\n        combineLatest(this.eavService.eavConfig.itemGuids.map(entityGuid => this.itemService.getItemHeader$(entityGuid))).pipe(\r\n          map(itemHeaders => itemHeaders.some(itemHeader => itemHeader?.EditInfo?.ReadOnly ?? false)),\r\n        ),\r\n        combineLatest([\r\n          this.languageInstanceService.getCurrentLanguage$(this.eavService.eavConfig.formId),\r\n          this.languageService.getLanguages$(),\r\n        ]).pipe(\r\n          map(([currentLanguage, languages]) => languages.find(l => l.NameId === currentLanguage)?.IsAllowed ?? true),\r\n        ),\r\n      ]).subscribe(([itemsReadOnly, languageAllowed]) => {\r\n        const readOnly: FormReadOnly = {\r\n          isReadOnly: itemsReadOnly || !languageAllowed,\r\n          reason: itemsReadOnly ? 'Form' : !languageAllowed ? 'Language' : undefined,\r\n        };\r\n        if (!GeneralHelpers.objectsEqual(readOnly, this.readOnly$.value)) {\r\n          this.readOnly$.next(readOnly);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  getFormValid(entityGuid: string) {\r\n    return this.formsValid[entityGuid];\r\n  }\r\n\r\n  setFormValid(entityGuid: string, isValid: boolean) {\r\n    this.formsValid[entityGuid] = isValid;\r\n\r\n    const allValid = !Object.values(this.formsValid).some(valid => valid === false);\r\n    if (allValid !== this.formsValid$.value) {\r\n      this.formsValid$.next(allValid);\r\n    }\r\n  }\r\n\r\n  setFormDirty(entityGuid: string, isDirty: boolean) {\r\n    this.formsDirty[entityGuid] = isDirty;\r\n\r\n    const anyDirty = Object.values(this.formsDirty).some(dirty => dirty === true);\r\n    if (anyDirty !== this.formsDirty$.value) {\r\n      this.formsDirty$.next(anyDirty);\r\n    }\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, combineLatest, distinctUntilChanged, filter, map, Observable, Subscription } from 'rxjs';\r\nimport { EavService } from '.';\r\nimport { FieldSettings } from '../../../../../../edit-types';\r\nimport { consoleLogAngular } from '../../../shared/helpers/console-log-angular.helper';\r\nimport { FieldLogicManager } from '../../form/shared/field-logic/field-logic-manager';\r\nimport { FieldLogicTools } from '../../form/shared/field-logic/field-logic-tools';\r\nimport { FormulaEngine } from '../../formulas/formula-engine';\r\n// tslint:disable-next-line:max-line-length\r\nimport { EntityReader, FieldsSettingsHelpers, GeneralHelpers, InputFieldHelpers } from '../helpers';\r\n// tslint:disable-next-line:max-line-length\r\nimport { ContentTypeSettings, FieldConstants, FieldsProps, FormValues, TranslationState } from '../models';\r\n// tslint:disable-next-line:max-line-length\r\nimport { ContentTypeService, GlobalConfigService, InputTypeService, ItemService, LanguageInstanceService } from '../store/ngrx-data';\r\nimport { FormsStateService } from './forms-state.service';\r\nimport { ConstantFieldParts } from '../../formulas/models/constant-field-parts.model';\r\nimport { FormulaPromiseResult } from '../../formulas/models/formula-promise-result.model';\r\nimport { FieldValuePair } from '../../formulas/models/formula-results.models';\r\nimport { FormItemFormulaService } from '../../formulas/form-item-formula.service';\r\nimport { FormulaPromiseHandler } from '../../formulas/formula-promise-handler';\r\nimport { ItemFieldVisibility } from './item-field-visibility';\r\nimport { EmptyFieldHelpers } from '../../form/fields/empty/empty-field-helpers';\r\n\r\n\r\n/**\r\n * FieldsSettingsService is responsible for handling the settings, values and validations of fields.\r\n */\r\n@Injectable()\r\nexport class FieldsSettingsService implements OnDestroy {\r\n  private contentTypeSettings$ = new BehaviorSubject<ContentTypeSettings>(null);\r\n  private fieldsProps$ = new BehaviorSubject<FieldsProps>(null);\r\n  private forceRefreshSettings$ = new BehaviorSubject<void>(null);\r\n  private subscription: Subscription;\r\n  public updateValueQueue: Record<string, FormulaPromiseResult> = {};\r\n  private latestFieldProps: FieldsProps = {};\r\n  private itemFieldVisibility: ItemFieldVisibility;\r\n\r\n  constructor(\r\n    private contentTypeService: ContentTypeService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private eavService: EavService,\r\n    private itemService: ItemService,\r\n    private inputTypeService: InputTypeService,\r\n    private globalConfigService: GlobalConfigService,\r\n    private formsStateService: FormsStateService,\r\n    private formulaEngine: FormulaEngine,\r\n    private formItemFormulaService: FormItemFormulaService,\r\n    private formulaPromiseHandler: FormulaPromiseHandler,\r\n  ) {\r\n    formulaPromiseHandler.init(this);\r\n    formItemFormulaService.init(this.itemService);\r\n    formulaEngine.init(this, this.formulaPromiseHandler, this.contentTypeSettings$);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.contentTypeSettings$?.complete();\r\n    this.fieldsProps$?.complete();\r\n    this.forceRefreshSettings$?.complete();\r\n    this.subscription?.unsubscribe();\r\n  }\r\n\r\n  init(entityGuid: string): void {\r\n    this.subscription = new Subscription();\r\n\r\n    const item = this.itemService.getItem(entityGuid);\r\n    this.itemFieldVisibility = new ItemFieldVisibility(item.Header);\r\n    const contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n    const contentType$ = this.contentTypeService.getContentType$(contentTypeId);\r\n    // todo: @STV unsure why we have a stream for the header, isn't it the same as item.Header?\r\n    // pls find out and either clarify or fix\r\n    const itemHeader$ = this.itemService.getItemHeader$(entityGuid);\r\n    const entityReader$ = this.languageInstanceService.getEntityReader$(this.eavService.eavConfig.formId);\r\n\r\n    this.subscription.add(\r\n      combineLatest([contentType$, itemHeader$, entityReader$]).pipe(\r\n        map(([contentType, itemHeader, entityReader]) => {\r\n          const ctSettings = FieldsSettingsHelpers.setDefaultContentTypeSettings(\r\n            entityReader.flattenAll<ContentTypeSettings>(contentType.Metadata),\r\n            contentType,\r\n            entityReader.currentLanguage,\r\n            entityReader.defaultLanguage,\r\n            itemHeader,\r\n          );\r\n          return ctSettings;\r\n        }),\r\n      ).subscribe(ctSettings => {\r\n        this.contentTypeSettings$.next(ctSettings);\r\n      })\r\n    );\r\n\r\n    const inputTypes$ = this.inputTypeService.getInputTypes$();\r\n    const entityId = item.Entity.Id;\r\n\r\n    const eavConfig = this.eavService.eavConfig;\r\n    const constantFieldParts$ = combineLatest([inputTypes$, contentType$, entityReader$]).pipe(\r\n      map(([inputTypes, contentType, entityReader]) => {\r\n        // When merging metadata, the primary language must be the real primary, not the current\r\n        const mdMerger = new EntityReader(eavConfig.lang, entityReader.defaultLanguage);\r\n\r\n        const allConstFieldParts = contentType.Attributes.map((attribute, index) => {\r\n          const initialSettings = FieldsSettingsHelpers.setDefaultFieldSettings(mdMerger.flattenAll<FieldSettings>(attribute.Metadata));\r\n          const initialDisabled = initialSettings.Disabled ?? false;\r\n          const calculatedInputType = InputFieldHelpers.calculateInputType(attribute, inputTypes);\r\n          const inputType = inputTypes.find(i => i.Type === attribute.InputType);\r\n\r\n          // Construct the constants / unchanging aspects of the field\r\n          const constants: FieldConstants = {\r\n            angularAssets: inputType?.AngularAssets,\r\n            contentTypeId,\r\n            dropzonePreviewsClass: `dropzone-previews-${eavConfig.formId}-${index}`,\r\n            entityGuid,\r\n            entityId,\r\n            fieldName: attribute.Name,\r\n            index,\r\n            initialDisabled,\r\n            inputType: calculatedInputType.inputType,\r\n            isExternal: calculatedInputType.isExternal,\r\n            isLastInGroup: FieldsSettingsHelpers.findIsLastInGroup(contentType, attribute),\r\n            type: attribute.Type,\r\n          };\r\n\r\n          // Construct the constants with settings and everything\r\n          // TODO: unclear why we're doing this again (see `initialSettings`) - with different languages in the flattening\r\n          const mergeRaw = entityReader.flattenAll<FieldSettings>(attribute.Metadata);\r\n          // Sometimes the metadata doesn't have the input type (empty string), so we'll add the attribute.InputType just in case...\r\n          mergeRaw.InputType = attribute.InputType;\r\n          mergeRaw.VisibleDisabled = this.itemFieldVisibility.isVisibleDisabled(attribute.Name);\r\n          const settingsInitial = FieldsSettingsHelpers.setDefaultFieldSettings(mergeRaw);\r\n          consoleLogAngular('merged', JSON.parse(JSON.stringify(settingsInitial)));\r\n          const logic = FieldLogicManager.singleton().get(attribute.InputType);\r\n          const constantFieldParts: ConstantFieldParts = {\r\n            logic,\r\n            settingsInitial,\r\n            inputType,\r\n            calculatedInputType,\r\n            constants\r\n          };\r\n\r\n          return constantFieldParts;\r\n        });\r\n\r\n        // Make sure that groups, which have a forced-visible-field are also visible\r\n        try { // ATM in try-catch, to ensure we don't break anything\r\n          if (this.itemFieldVisibility.hasRules())\r\n            allConstFieldParts.forEach((groupField, index) => {\r\n              // Only work on group-starts\r\n              if (!EmptyFieldHelpers.isGroupStart(groupField.calculatedInputType)) return;\r\n              // Ignore if visible-disabled is already ok\r\n              if (groupField.settingsInitial.VisibleDisabled == false) return;\r\n              // Check if any of the following fields is forced visible - before another group-start/end\r\n              for (let i = index + 1; i < allConstFieldParts.length; i++) {\r\n                const innerField = allConstFieldParts[i];\r\n                // Stop checking the current group if we found another group start/end\r\n                if (EmptyFieldHelpers.isGroup(innerField.calculatedInputType)) return;\r\n                if (innerField.settingsInitial.VisibleDisabled == false) {\r\n                  consoleLogAngular('Forced visible', groupField.constants.fieldName, 'because of', innerField.constants.fieldName)\r\n                  groupField.settingsInitial.VisibleDisabled = false;\r\n                  return;\r\n                }\r\n              }\r\n            });\r\n        } catch (e) {\r\n          console.error('Error trying to set item field visibility', e);\r\n        }\r\n\r\n        return allConstFieldParts;\r\n      })\r\n    );\r\n    \r\n    const itemAttributes$ = this.itemService.getItemAttributes$(entityGuid);\r\n    const formReadOnly$ = this.formsStateService.readOnly$;\r\n    const debugEnabled$ = this.globalConfigService.getDebugEnabled$();\r\n\r\n    this.subscription.add(\r\n      combineLatest([\r\n        contentType$, itemAttributes$, itemHeader$, entityReader$,\r\n        formReadOnly$, this.forceRefreshSettings$, debugEnabled$, constantFieldParts$\r\n      ]).pipe(\r\n        map(([\r\n          contentType, itemAttributes, itemHeader, entityReader,\r\n          formReadOnly, _, debugEnabled, constantFieldParts\r\n        ]) => {\r\n          const formValues: FormValues = {};\r\n          for (const [fieldName, fieldValues] of Object.entries(itemAttributes)) {\r\n            formValues[fieldName] = entityReader.getBestValue(fieldValues, null);\r\n          }\r\n\r\n          const slotIsEmpty = itemHeader.IsEmptyAllowed && itemHeader.IsEmpty;\r\n          const logicTools: FieldLogicTools = {\r\n            eavConfig: this.eavService.eavConfig,\r\n            entityReader,\r\n            debug: debugEnabled,\r\n          };\r\n\r\n          if (Object.keys(this.latestFieldProps).length) {\r\n            const status = this.formulaPromiseHandler.updateValuesFromQueue(\r\n              entityGuid, this.updateValueQueue, contentType, formValues, this.latestFieldProps, slotIsEmpty, entityReader,\r\n              this.latestFieldProps, contentType.Attributes, contentType.Metadata, constantFieldParts,\r\n              itemAttributes, formReadOnly.isReadOnly, logicTools, this.formItemFormulaService);\r\n            // we only updated values from promise (queue), don't trigger property regular updates\r\n            // NOTE: if any value changes then the entire cycle will automatically retrigger\r\n            if (status.newFieldProps)\r\n              this.latestFieldProps = status.newFieldProps;\r\n            if (status.valuesUpdated) return null;\r\n          }\r\n\r\n          const fieldsProps: FieldsProps = {};\r\n          const possibleValueUpdates: FormValues = {};\r\n          const possibleFieldsUpdates: FieldValuePair[] = [];\r\n\r\n          for (const attribute of contentType.Attributes) {\r\n            const attributeValues = itemAttributes[attribute.Name];\r\n            // empty-default and empty-message have no value\r\n            const valueBefore = formValues[attribute.Name];\r\n\r\n            const constantFieldPart = constantFieldParts.find(f => f.constants.fieldName === attribute.Name);\r\n\r\n            const latestSettings = this.latestFieldProps[attribute.Name]?.settings\r\n              ?? { ...constantFieldPart.settingsInitial };\r\n\r\n            // run formulas\r\n            const formulaResult = this.formulaEngine.runAllFormulas(\r\n              entityGuid, entityId, attribute, formValues,\r\n              constantFieldPart.inputType, constantFieldPart.logic, constantFieldPart.settingsInitial, latestSettings,\r\n              itemHeader, contentType.Metadata, attributeValues, entityReader, slotIsEmpty,\r\n              formReadOnly.isReadOnly, valueBefore, logicTools\r\n            );\r\n\r\n            const fixed = formulaResult.settings;\r\n\r\n            possibleValueUpdates[attribute.Name] = formulaResult.value;\r\n            if (formulaResult.fields)\r\n              possibleFieldsUpdates.push(...formulaResult.fields);\r\n\r\n            const fieldTranslation = FieldsSettingsHelpers.getTranslationState(\r\n              attributeValues, fixed.DisableTranslation, entityReader.currentLanguage, entityReader.defaultLanguage,\r\n            );\r\n            const wrappers = InputFieldHelpers.getWrappers(fixed, constantFieldPart.calculatedInputType);\r\n\r\n            fieldsProps[attribute.Name] = {\r\n              calculatedInputType: constantFieldPart.calculatedInputType,\r\n              constants: constantFieldPart.constants,\r\n              settings: fixed,\r\n              translationState: fieldTranslation,\r\n              value: valueBefore,\r\n              wrappers,\r\n              formulaValidation: formulaResult.validation,\r\n            };\r\n          }\r\n          this.latestFieldProps = fieldsProps;\r\n\r\n          const changesWereApplied = this.formItemFormulaService.applyValueChangesFromFormulas(\r\n            entityGuid, contentType, formValues, fieldsProps,\r\n            possibleValueUpdates, possibleFieldsUpdates,\r\n            slotIsEmpty, entityReader);\r\n          // if changes were applied do not trigger field property updates\r\n          if (changesWereApplied) return null;\r\n          // if no changes were applied then we trigger field property updates and reset the loop counter\r\n          this.formItemFormulaService.valueFormulaCounter = 0;\r\n          return fieldsProps;\r\n        }),\r\n        filter(fieldsProps => !!fieldsProps),\r\n      ).subscribe(fieldsProps => {\r\n        consoleLogAngular('fieldsProps', JSON.parse(JSON.stringify(fieldsProps)));\r\n        this.fieldsProps$.next(fieldsProps);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Used to get content type settings.\r\n   * @returns Content type settings\r\n   */\r\n  getContentTypeSettings(): ContentTypeSettings {\r\n    return this.contentTypeSettings$.value;\r\n  }\r\n\r\n  /**\r\n   * Used to get content type settings stream.\r\n   * @returns Stream of content type settings\r\n   */\r\n  getContentTypeSettings$(): Observable<ContentTypeSettings> {\r\n    return this.contentTypeSettings$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Used to get field properties for all fields.\r\n   * @returns Object that has attribute name as a key and all of its field properties as a value\r\n   */\r\n  getFieldsProps(): FieldsProps {\r\n    return this.fieldsProps$.value;\r\n  }\r\n\r\n  /**\r\n   * Used to get field properties stream for all fields.\r\n   * @returns Stream of objects that has attribute name as a key and all of its field properties as a value\r\n   */\r\n  getFieldsProps$(): Observable<FieldsProps> {\r\n    return this.fieldsProps$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Used for getting field settings for a specific field.\r\n   * @param fieldName \r\n   * @returns Field settings\r\n   */\r\n  getFieldSettings(fieldName: string): FieldSettings {\r\n    return this.fieldsProps$.value[fieldName].settings;\r\n  }\r\n\r\n  /**\r\n   * Used for getting field settings stream for a specific field.\r\n   * @param fieldName \r\n   * @returns Field settings stream\r\n   */\r\n  getFieldSettings$(fieldName: string): Observable<FieldSettings> {\r\n    return this.fieldsProps$.pipe(\r\n      map(fieldsSettings => fieldsSettings[fieldName].settings),\r\n      distinctUntilChanged(GeneralHelpers.objectsEqual),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Used for translation state stream for a specific field.\r\n   * @param fieldName \r\n   * @returns Translation state stream\r\n   */\r\n  getTranslationState$(fieldName: string): Observable<TranslationState> {\r\n    return this.fieldsProps$.pipe(\r\n      map(fieldsSettings => fieldsSettings[fieldName].translationState),\r\n      distinctUntilChanged(GeneralHelpers.objectsEqual),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Triggers a reevaluation of all formulas.\r\n   */\r\n  retriggerFormulas(): void {\r\n    this.forceRefreshSettings$.next();\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { tap } from 'rxjs';\r\nimport { EavService, FieldsSettingsService } from '.';\r\nimport { EditApiKeyPaths } from '../../../shared/constants/eav.constants';\r\nimport { consoleLogAngular } from '../../../shared/helpers/console-log-angular.helper';\r\nimport { ApiKeySpecs } from '../../../shared/models/dialog-context.models';\r\nimport { FieldLogicManager } from '../../form/shared/field-logic/field-logic-manager';\r\nimport { InputFieldHelpers, LocalizationHelpers } from '../helpers';\r\nimport { EavItem } from '../models/eav';\r\nimport { ContentTypeService, ItemService, LanguageInstanceService } from '../store/ngrx-data';\r\n\r\nconst apiKeyInDemoModeAlert = `This translation is a demo. Please provide your own Google Translate API key in the EAV configuration.`;\r\n\r\n@Injectable()\r\nexport class FieldsTranslateService {\r\n  private entityGuid: string;\r\n  private contentTypeId: string;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private itemService: ItemService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private eavService: EavService,\r\n    private contentTypeService: ContentTypeService,\r\n    private fieldsSettingsService: FieldsSettingsService,\r\n  ) { }\r\n\r\n  init(entityGuid: string): void {\r\n    this.entityGuid = entityGuid;\r\n    const item = this.itemService.getItem(entityGuid);\r\n    this.contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n  }\r\n\r\n  translate(fieldName: string, isTransaction = false, transactionItem?: EavItem): EavItem {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n\r\n    transactionItem = this.itemService.removeItemAttributeDimension(this.entityGuid, fieldName, currentLanguage, true, transactionItem);\r\n\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    const values = attributes[fieldName];\r\n    const doesFieldHaveExistingDimension = values.Values.find(v => v.Dimensions.find(x => x.Value === currentLanguage)) !== undefined;\r\n    const defaultValue = LocalizationHelpers.getValueTranslation(values, defaultLanguage, defaultLanguage);\r\n    if (!doesFieldHaveExistingDimension) \r\n      return this.addItemAttributeValueHelper(fieldName, defaultValue.Value, currentLanguage, false);\r\n    else\r\n      return null;\r\n  }\r\n\r\n  dontTranslate(fieldName: string, isTransaction = false, transactionItem?: EavItem): EavItem {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    transactionItem = this.itemService.removeItemAttributeDimension(\r\n      this.entityGuid, fieldName, currentLanguage, isTransaction, transactionItem,\r\n    );\r\n    return transactionItem;\r\n  }\r\n\r\n  /**\r\n   * Auto-translate the field value to the current language.\r\n   * @param areAllChecksKnown If true, the function will not check if the field value is empty, or if the field auto-translate was disabled by default.\r\n   */\r\n  autoTranslate(fieldNames: string[], autoTranslateLanguageKey: string, isMany: boolean = false, areAllChecksKnown: boolean = false): void {\r\n    // Get API key and optionally show warning\r\n    const apiKeyInfo = this.eavService.settings.Values[EditApiKeyPaths.GoogleTranslate] as ApiKeySpecs;\r\n    if (apiKeyInfo.IsDemo)\r\n      alert(apiKeyInDemoModeAlert);\r\n\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n\r\n    fieldNames = fieldNames.filter(field => !this.isTranslationDisabled(field));\r\n    const textsForTranslation = fieldNames.map(field => attributes[field].Values.find(v => v.Dimensions.find(x => x.Value === autoTranslateLanguageKey)).Value);\r\n    const doFieldsHaveExistingDimension = fieldNames.map(field => attributes[field].Values.find(v => v.Dimensions.find(x => x.Value === currentLanguage)) !== undefined);\r\n\r\n    if (!areAllChecksKnown) {\r\n      fieldNames.forEach((field, i) => {\r\n        const isAutoTranslationEnabledButWasDisabledByDefault = this.isAutoTranslationEnabledButWasDisabledByDefault(field);\r\n        if (textsForTranslation[i] == null || textsForTranslation[i] === '' || isAutoTranslationEnabledButWasDisabledByDefault) {\r\n          this.translate(field);\r\n        }\r\n      });\r\n    }\r\n\r\n    const translationData = {\r\n      q: textsForTranslation,\r\n      target: currentLanguage,\r\n      source: autoTranslateLanguageKey\r\n    };\r\n    this.http.post(`https://translation.googleapis.com/language/translate/v2?key=${apiKeyInfo.ApiKey}`, translationData)\r\n      .pipe(tap(\r\n        (response: any) => {\r\n          response.data.translations.forEach((translation: any, i: number) => {\r\n            const elem = document.createElement('textarea');\r\n            elem.innerHTML = translation.translatedText;\r\n            if (!isMany && doFieldsHaveExistingDimension[i]) {\r\n              this.itemService.updateItemAttributeValue(\r\n                this.entityGuid, fieldNames[i], elem.value, currentLanguage, defaultLanguage, false\r\n              );\r\n            } else if (!doFieldsHaveExistingDimension[i]) {\r\n              this.addItemAttributeValueHelper(fieldNames[i], elem.value, currentLanguage, false);\r\n            }\r\n          });\r\n        }\r\n      )).subscribe();\r\n  }\r\n\r\n  copyFrom(fieldName: string, copyFromLanguageKey: string): void {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    const values = attributes[fieldName];\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const attributeValueTranslation = LocalizationHelpers.getValueTranslation(values, copyFromLanguageKey, defaultLanguage);\r\n    if (attributeValueTranslation) {\r\n      const valueAlreadyExists = values\r\n        ? LocalizationHelpers.isEditableOrReadonlyTranslationExist(values, currentLanguage, defaultLanguage)\r\n        : false;\r\n\r\n      if (valueAlreadyExists) {\r\n        // Copy attribute value where language is languageKey to value where language is current language\r\n        this.itemService.updateItemAttributeValue(\r\n          this.entityGuid, fieldName, attributeValueTranslation.Value, currentLanguage, defaultLanguage, false,\r\n        );\r\n      } else {\r\n        // Copy attribute value where language is languageKey to new attribute with current language\r\n        this.addItemAttributeValueHelper(fieldName, attributeValueTranslation.Value, currentLanguage, false);\r\n      }\r\n    } else {\r\n      consoleLogAngular(`${currentLanguage}: Cant copy value from ${copyFromLanguageKey} because that value does not exist.`);\r\n    }\r\n  }\r\n\r\n  linkReadOnly(fieldName: string, linkWithLanguageKey: string): void {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const transactionItem = this.itemService.removeItemAttributeDimension(this.entityGuid, fieldName, currentLanguage, true);\r\n    this.itemService.addItemAttributeDimension(\r\n      this.entityGuid, fieldName, currentLanguage, linkWithLanguageKey, defaultLanguage, true, transactionItem,\r\n    );\r\n  }\r\n\r\n  linkReadWrite(fieldName: string, linkWithLanguageKey: string): void {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const transactionItem = this.itemService.removeItemAttributeDimension(this.entityGuid, fieldName, currentLanguage, true);\r\n    this.itemService.addItemAttributeDimension(\r\n      this.entityGuid, fieldName, currentLanguage, linkWithLanguageKey, defaultLanguage, false, transactionItem,\r\n    );\r\n  }\r\n\r\n  translateMany(): void {\r\n    const translatable = this.findTranslatableFields();\r\n\r\n    let transactionItem: EavItem;\r\n    for (const fieldName of translatable) {\r\n      // will finish the transaction when last field is being translated\r\n      const isTransaction = fieldName !== translatable[translatable.length - 1];\r\n      transactionItem = this.translate(fieldName, isTransaction, transactionItem);\r\n    }\r\n  }\r\n\r\n  dontTranslateMany(): void {\r\n    const translatable = this.findTranslatableFields();\r\n\r\n    let transactionItem: EavItem;\r\n    for (const fieldName of translatable) {\r\n      // will finish the transaction when last field is being translated\r\n      const isTransaction = fieldName !== translatable[translatable.length - 1];\r\n      transactionItem = this.dontTranslate(fieldName, isTransaction, transactionItem);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Auto-translates all field that have auto-translate enabled and are not empty, empty ones are unlocked.\r\n   */\r\n  autoTranslateMany(autoTranslateLanguageKey: string): void {\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    // fields that have auto-translate enabled and are not empty\r\n    const canTranslate: string[] = [];\r\n    // fields that have auto-translate enabled but didn't have it by default or are empty\r\n    const cantTranslateAndEmpty: string[] = this.findAutoTranslatableFieldsThatWereNotAutoTranslatableByDefault();\r\n    // fields that have auto-translate enabled and can be empty\r\n    const canTranslateWithEmpty = this.findAutoTranslatableFields().filter(x => !cantTranslateAndEmpty.includes(x));\r\n    // separate fields that have auto-translate enabled and are empty\r\n    canTranslateWithEmpty.forEach(fieldName => {\r\n      const value = attributes[fieldName].Values.find(v => v.Dimensions.find(x => x.Value === autoTranslateLanguageKey))?.Value;\r\n      if (value !== '' && value != null && value !== undefined)\r\n        canTranslate.push(fieldName);\r\n      // this is commented out because future edits on fields should automatically be passed to the other languages\r\n      // else\r\n      //   cantTranslateAndEmpty.push(fieldName);\r\n    });\r\n    // translate fields that have auto-translate enabled and are not empty\r\n    this.autoTranslate(canTranslate, autoTranslateLanguageKey, true, true);\r\n    let transactionItem: EavItem;\r\n    // unlock fields that have auto-translate enabled but didn't have it by default or are empty\r\n    cantTranslateAndEmpty.forEach(fieldName => {\r\n      this.translate(fieldName, false, transactionItem);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns all fields that can be translated.\r\n   */\r\n  findTranslatableFields(): string[] {\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    return Object.keys(attributes).filter(fieldName => !this.isTranslationDisabled(fieldName));\r\n  }\r\n\r\n  /**\r\n   * Returns all fields that can be translated and autoTranslated.\r\n   */\r\n  findAutoTranslatableFields(): string[] {\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    return Object.keys(attributes).filter(fieldName => !this.isTranslationDisabled(fieldName) && !this.isAutoTranslationDisabled(fieldName));\r\n  }\r\n\r\n  /**\r\n   * Returns all fields that can be translated and autoTranslated, but were not autoTranslatable by default.\r\n   */\r\n  findAutoTranslatableFieldsThatWereNotAutoTranslatableByDefault(): string[] {\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    return Object.keys(attributes).filter(fieldName => !this.isTranslationDisabled(fieldName) && this.isAutoTranslationEnabledButWasDisabledByDefault(fieldName));\r\n  }\r\n\r\n  /**\r\n   * Returns true if translation is disabled for the field.\r\n   */\r\n  private isTranslationDisabled(fieldName: string) {\r\n    const fieldsProps = this.fieldsSettingsService.getFieldsProps();\r\n    return fieldsProps[fieldName].settings.DisableTranslation;\r\n  }\r\n\r\n  /**\r\n   * Returns true if auto translation is disabled for the field.\r\n   */\r\n  private isAutoTranslationDisabled(fieldName: string) {\r\n    const fieldsProps = this.fieldsSettingsService.getFieldsProps();\r\n    return fieldsProps[fieldName].settings.DisableAutoTranslation;\r\n  }\r\n\r\n  /**\r\n   * Returns true if auto translation is enabled for the field, but was disabled by default.\r\n   */\r\n  private isAutoTranslationEnabledButWasDisabledByDefault(fieldName: string) {\r\n    const fieldsProps = this.fieldsSettingsService.getFieldsProps();\r\n    const logic = FieldLogicManager.singleton().get(fieldsProps[fieldName].calculatedInputType.inputType);\r\n    return !fieldsProps[fieldName].settings.DisableAutoTranslation && !logic.canAutoTranslate;\r\n  }\r\n\r\n  private addItemAttributeValueHelper(fieldName: string, value: any, currentLanguage: string, isReadOnly: boolean): EavItem {\r\n    const contentType = this.contentTypeService.getContentType(this.contentTypeId);\r\n    const ctAttribute = contentType.Attributes.find(a => a.Name === fieldName);\r\n    return this.itemService.addItemAttributeValue(\r\n      this.entityGuid, fieldName, value, currentLanguage, isReadOnly, ctAttribute.Type\r\n    );\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { LogEntry, LogSeverity } from '../models';\r\n\r\n@Injectable()\r\nexport class LoggingService implements OnDestroy {\r\n  private logs$ = new BehaviorSubject<LogEntry[]>([]);\r\n  private logLimit = 50;\r\n  private lastSnackBarTime = 0;\r\n  private snackBarDebounce = 10000;\r\n\r\n  constructor(private snackBar: MatSnackBar) { }\r\n\r\n  ngOnDestroy(): void {\r\n    this.logs$.complete();\r\n  }\r\n\r\n  addLog(severity: LogSeverity, label: string, error: any): void {\r\n    const newLogEntry: LogEntry = {\r\n      error,\r\n      label,\r\n      severity,\r\n      time: Date.now(),\r\n    };\r\n    const oldLogs = this.logs$.value;\r\n    const newLogs = [newLogEntry, ...oldLogs.slice(0, this.logLimit - 2)];\r\n    this.logs$.next(newLogs);\r\n  }\r\n\r\n  /** Show snackBar to the user. By default snackBars have debounce timer, but you can force snackBar to show instantly */\r\n  showMessage(message: string, duration: number, force?: boolean): void {\r\n    const nowTime = Date.now();\r\n    if (!force && (nowTime - this.lastSnackBarTime) <= this.snackBarDebounce) {\r\n      return;\r\n    }\r\n\r\n    if (duration != null && duration > 0) {\r\n      this.snackBar.open(message, null, { duration });\r\n    } else {\r\n      this.snackBar.open(message);\r\n    }\r\n    this.lastSnackBarTime = nowTime;\r\n  }\r\n\r\n  getLogs$(): Observable<LogEntry[]> {\r\n    return this.logs$.asObservable();\r\n  }\r\n}\r\n","import appleFilled from '!raw-loader!../../assets/icons/2sxc/Material-Icon-Adam-48-filled.svg';\r\nimport appleOutlined from '!raw-loader!../../assets/icons/2sxc/Material-Icon-Adam-48-outlined.svg';\r\nimport draftBranch from '!raw-loader!../../assets/icons/font-awesome/draft-branch.svg';\r\nimport fileArchive from '!raw-loader!../../assets/icons/font-awesome/file-archive.svg';\r\nimport fileAudio from '!raw-loader!../../assets/icons/font-awesome/file-audio.svg';\r\nimport fileCode from '!raw-loader!../../assets/icons/font-awesome/file-code.svg';\r\nimport fileExcel from '!raw-loader!../../assets/icons/font-awesome/file-excel.svg';\r\nimport fileImage from '!raw-loader!../../assets/icons/font-awesome/file-image.svg';\r\nimport filePdf from '!raw-loader!../../assets/icons/font-awesome/file-pdf.svg';\r\nimport filePowerpoint from '!raw-loader!../../assets/icons/font-awesome/file-powerpoint.svg';\r\nimport fileText from '!raw-loader!../../assets/icons/font-awesome/file-text.svg';\r\nimport fileVideo from '!raw-loader!../../assets/icons/font-awesome/file-video.svg';\r\nimport fileWord from '!raw-loader!../../assets/icons/font-awesome/file-word.svg';\r\nimport file from '!raw-loader!../../assets/icons/font-awesome/file.svg';\r\nimport folderPlus from '!raw-loader!../../assets/icons/font-awesome/folder-plus.svg';\r\nimport folder from '!raw-loader!../../assets/icons/font-awesome/folder.svg';\r\nimport sitemap from '!raw-loader!../../assets/icons/font-awesome/sitemap.svg';\r\nimport { Injectable } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\n\r\n@Injectable()\r\nexport class LoadIconsService {\r\n  private icons: Record<string, string> = {\r\n    'apple-filled': appleFilled,\r\n    'apple-outlined': appleOutlined,\r\n    'draft-branch': draftBranch,\r\n    file,\r\n    'file-archive': fileArchive,\r\n    'file-audio': fileAudio,\r\n    'file-code': fileCode,\r\n    'file-excel': fileExcel,\r\n    'file-image': fileImage,\r\n    'file-pdf': filePdf,\r\n    'file-powerpoint': filePowerpoint,\r\n    'file-text': fileText,\r\n    'file-video': fileVideo,\r\n    'file-word': fileWord,\r\n    folder,\r\n    'folder-plus': folderPlus,\r\n    sitemap,\r\n  };\r\n\r\n  constructor(private matIconRegistry: MatIconRegistry, private domSanitizer: DomSanitizer) { }\r\n\r\n  load() {\r\n    Object.entries(this.icons).forEach(([name, svg]) => {\r\n      this.matIconRegistry.addSvgIconLiteral(name, this.domSanitizer.bypassSecurityTrustHtml(svg));\r\n    });\r\n  }\r\n}\r\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 48 48\\\">\\r\\n<style type=\\\"text/css\\\">\\r\\n\\t.st0{display:none;}\\r\\n\\t.st1{display:inline;}\\r\\n</style>\\r\\n<g id=\\\"Layer_1\\\">\\r\\n\\t<path d=\\\"M32,4c-6,0-10,4-10,10C28,14,32,10,32,4z\\\"/>\\r\\n</g>\\r\\n<g id=\\\"Layer_3\\\" class=\\\"st0\\\">\\r\\n</g>\\r\\n<g id=\\\"Icon\\\">\\r\\n\\t<path d=\\\"M32,16c-4,0-8,2.06-8,2.06S20,16,16,16c-6,0-10,4.01-10,9.47C6,34.74,12,44,18,44c2,0,4-1.85,6-1.85S28,44,30,44\\r\\n\\t\\tc6,0,12-9.26,12-18.53C42,20.01,38,16,32,16L32,16z\\\"/>\\r\\n</g>\\r\\n</svg>\\r\\n\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 48 48\\\">\\r\\n<style type=\\\"text/css\\\">\\r\\n\\t.st0{display:none;}\\r\\n\\t.st1{display:inline;}\\r\\n</style>\\r\\n<g id=\\\"Layer_1\\\">\\r\\n\\t<path d=\\\"M32,4c-6,0-10,4-10,10C28,14,32,10,32,4z\\\"/>\\r\\n</g>\\r\\n<g id=\\\"Layer_3\\\" class=\\\"st0\\\">\\r\\n</g>\\r\\n<g id=\\\"Icon\\\">\\r\\n\\t<path d=\\\"M32,20c3.7,0,6,2.1,6,5.47C38,33.21,33.01,40,30.06,40c-0.25-0.04-0.93-0.35-1.38-0.56c-1.25-0.58-2.8-1.3-4.68-1.3\\r\\n\\t\\ts-3.43,0.72-4.68,1.3C18.87,39.65,18.19,39.97,18,40c-3.01,0-8-6.79-8-14.53C10,22.1,12.3,20,16,20c2.44,0,5.29,1.17,6.17,1.62\\r\\n\\t\\tL24,22.56l1.83-0.94C26.64,21.2,29.53,20,32,20 M32,16c-4,0-8,2.06-8,2.06S20,16,16,16c-6,0-10,4.01-10,9.47C6,34.74,12,44,18,44\\r\\n\\t\\tc2,0,4-1.85,6-1.85S28,44,30,44c6,0,12-9.26,12-18.53C42,20.01,38,16,32,16L32,16z\\\"/>\\r\\n</g>\\r\\n</svg>\\r\\n\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 39.2 28.2 71.8 65.5 78.7-.8 17.2-5 30.4-12.7 40-17.5 21.8-53.1 25.2-90.7 28.7-28.2 2.6-57.4 5.4-80.4 16.9-3.4 1.7-6.7 3.6-9.7 5.7V158.4c36.5-7.4 64-39.7 64-78.4 0-44.2-35.8-80-80-80S0 35.8 0 80c0 38.7 27.5 71 64 78.4v195.2C27.5 361 0 393.3 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-36.9-24.9-67.9-58.9-77.2 5-9.6 12.3-14.6 19-18 17.5-8.8 42.5-11.2 68.9-13.7 42.6-4 86.7-8.1 112.7-40.5 12.4-15.5 19-35.5 19.8-60.7C357.3 214 384 182.1 384 144zM32 80c0-26.5 21.5-48 48-48s48 21.5 48 48-21.5 48-48 48-48-21.5-48-48zm96 352c0 26.5-21.5 48-48 48s-48-21.5-48-48c0-26.4 21.4-47.9 47.8-48h.6c26.3.2 47.6 21.7 47.6 48zm187.8-241.5L304 192c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48c0 22.4-15.4 41.2-36.2 46.5z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M128 96v32h32V96zm65.9 169.6c-1.1-5.6-6-9.6-11.8-9.6H160v-32h-32v32l-19.4 97.2c-6.5 32.5 18.3 62.8 51.4 62.8s57.9-30.3 51.4-62.8zm-33.6 124.5c-17.9 0-32.4-12.1-32.4-27s14.5-27 32.4-27 32.4 12.1 32.4 27-14.5 27-32.4 27zM128 160v32h32v-32zm64-96h-32v32h32zm177.9 33.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM256 32.5c2.8.7 5.4 2.1 7.4 4.2l83.9 83.9c2 2 3.5 4.6 4.2 7.4H256zM352 464c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h79.7v32h32V32H224v104c0 13.3 10.7 24 24 24h104zM192 192h-32v32h32zm0-64h-32v32h32z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-77.6-66.6c38.5-26 61.6-69.3 61.6-115.7 0-24.7-6.5-48.9-18.9-70.1-12-20.6-29.1-37.8-49.6-50-7.1-4.2-16.3-1.9-20.6 5.2-4.2 7.1-1.9 16.3 5.2 20.6 33.1 19.7 53.7 55.8 53.7 94.3 0 36.5-18.1 70.4-48.3 90.9-6.9 4.6-8.7 14-4 20.8 2.9 4.3 7.6 6.6 12.4 6.6 3.1 0 6-.8 8.5-2.6zm-26.6-38.3c26-17.3 41.5-46.2 41.5-77.4 0-32.9-17.7-63.7-46.2-80.3-7.2-4.2-16.3-1.7-20.5 5.4-4.2 7.2-1.7 16.3 5.4 20.5 19.3 11.2 31.3 32 31.3 54.3 0 21.1-10.5 40.7-28.1 52.4-6.9 4.6-8.8 13.9-4.2 20.8 2.9 4.4 7.7 6.7 12.5 6.7 2.8.1 5.7-.7 8.3-2.4zm-27-38.2c13.7-8.5 21.8-23.1 21.8-39.2 0-17-9.3-32.5-24.2-40.6-7.3-3.9-16.4-1.2-20.3 6.1-3.9 7.3-1.2 16.4 6.1 20.3 5.2 2.8 8.5 8.3 8.5 14.2 0 5.6-2.9 10.8-7.6 13.7-7 4.4-9.2 13.6-4.8 20.7 2.8 4.6 7.7 7.1 12.8 7.1 2.5 0 5.2-.7 7.7-2.3zM138 266.7v74.7L112 322H94v-36h18l26-19.3m17.9-50.7c-2.9 0-6 1.1-8.4 3.5L104 256H76c-6.6 0-12 5.4-12 12v72c0 6.6 5.4 12 12 12h28l43.5 36.5c2.4 2.4 5.4 3.5 8.4 3.5 6.2 0 12.1-4.8 12.1-12V228c0-7.2-5.9-12-12.1-12z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.941 97.941l-83.882-83.882A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v416c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48V131.882a48 48 0 0 0-14.059-33.941zm-22.627 22.628a15.89 15.89 0 0 1 4.195 7.431H256V32.491a15.88 15.88 0 0 1 7.431 4.195l83.883 83.883zM336 480H48c-8.837 0-16-7.163-16-16V48c0-8.837 7.163-16 16-16h176v104c0 13.255 10.745 24 24 24h104v304c0 8.837-7.163 16-16 16zm-161.471-67.404l-25.928-7.527a5.1 5.1 0 0 1-3.476-6.32l58.027-199.869a5.1 5.1 0 0 1 6.32-3.476l25.927 7.527a5.1 5.1 0 0 1 3.476 6.32L180.849 409.12a5.1 5.1 0 0 1-6.32 3.476zm-48.446-47.674l18.492-19.724a5.101 5.101 0 0 0-.351-7.317L105.725 304l38.498-33.881a5.1 5.1 0 0 0 .351-7.317l-18.492-19.724a5.1 5.1 0 0 0-7.209-.233L57.61 300.279a5.1 5.1 0 0 0 0 7.441l61.263 57.434a5.1 5.1 0 0 0 7.21-.232zm139.043.232l61.262-57.434a5.1 5.1 0 0 0 0-7.441l-61.262-57.434a5.1 5.1 0 0 0-7.209.233l-18.492 19.724a5.101 5.101 0 0 0 .351 7.317L278.275 304l-38.499 33.881a5.1 5.1 0 0 0-.351 7.317l18.492 19.724a5.1 5.1 0 0 0 7.209.232z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zM211.7 308l50.5-81.8c4.8-8-.9-18.2-10.3-18.2h-4.1c-4.1 0-7.9 2.1-10.1 5.5-31 48.5-36.4 53.5-45.7 74.5-17.2-32.2-8.4-16-45.8-74.5-2.2-3.4-6-5.5-10.1-5.5H132c-9.4 0-15.1 10.3-10.2 18.2L173 308l-59.1 89.5c-5.1 8 .6 18.5 10.1 18.5h3.5c4.1 0 7.9-2.1 10.1-5.5 37.2-58 45.3-62.5 54.4-82.5 31.5 56.7 44.3 67.2 54.4 82.6 2.2 3.4 6 5.4 10 5.4h3.6c9.5 0 15.2-10.4 10.1-18.4L211.7 308z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M159 336l-39.5-39.5c-4.7-4.7-12.3-4.7-17 0l-39 39L63 448h256V304l-55.5-55.5c-4.7-4.7-12.3-4.7-17 0L159 336zm96-50.7l32 32V416H95.1l.3-67.2 15.6-15.6 48 48c20.3-20.3 77.7-77.6 96-95.9zM127 256c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm0-96c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm242.9-62.1L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM256 32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5zM352 464c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-22-171.2c-13.5-13.3-55-9.2-73.7-6.7-21.2-12.8-35.2-30.4-45.1-56.6 4.3-18 12-47.2 6.4-64.9-4.4-28.1-39.7-24.7-44.6-6.8-5 18.3-.3 44.4 8.4 77.8-11.9 28.4-29.7 66.9-42.1 88.6-20.8 10.7-54.1 29.3-58.8 52.4-3.5 16.8 22.9 39.4 53.1 6.4 9.1-9.9 19.3-24.8 31.3-45.5 26.7-8.8 56.1-19.8 82-24 21.9 12 47.6 19.9 64.6 19.9 27.7.1 28.9-30.2 18.5-40.6zm-229.2 89c5.9-15.9 28.6-34.4 35.5-40.8-22.1 35.3-35.5 41.5-35.5 40.8zM180 175.5c8.7 0 7.8 37.5 2.1 47.6-5.2-16.3-5-47.6-2.1-47.6zm-28.4 159.3c11.3-19.8 21-43.2 28.8-63.7 9.7 17.7 22.1 31.7 35.1 41.5-24.3 4.7-45.4 15.1-63.9 22.2zm153.4-5.9s-5.8 7-43.5-9.1c41-3 47.7 6.4 43.5 9.1z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zM204.3 208H140c-6.6 0-12 5.4-12 12v184c0 6.6 5.4 12 12 12h8c6.6 0 12-5.4 12-12v-60.4h44.3c38.7 0 67.7-27.3 67.7-69 0-38.6-23.8-66.6-67.7-66.6zm26 97.7c-7.5 7.6-17.8 11.4-31 11.4H160V233h39.7c12.9 0 23.1 3.7 30.6 11.1 15.3 15.1 15 46.5 0 61.6z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-48-244v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm0 64v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm0 64v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M224 280.593C224 267.01 212.989 256 199.407 256H88.593C75.011 256 64 267.01 64 280.593v110.815C64 404.99 75.011 416 88.593 416h110.814C212.989 416 224 404.99 224 391.407V381l27.971 27.971a23.998 23.998 0 0 0 16.97 7.029H296c13.255 0 24-10.745 24-24V280c0-13.255-10.745-24-24-24h-27.059a24.003 24.003 0 0 0-16.97 7.029L224 291v-10.407zM192 384H96v-96h96v96zm80.255-96H288v96h-15.745L224 342.826v-13.652L272.255 288zm97.686-190.059l-83.883-83.882A47.996 47.996 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v416c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48V131.882a48 48 0 0 0-14.059-33.941zM256 32.491a15.888 15.888 0 0 1 7.432 4.195l83.882 83.882a15.882 15.882 0 0 1 4.195 7.431H256V32.491zM352 464c0 8.837-7.164 16-16 16H48c-8.836 0-16-7.163-16-16V48c0-8.837 7.164-16 16-16h176v104c0 13.255 10.745 24 24 24h104v304z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-53.6-246.5c-6.8 32.8-32.5 139.7-33.4 150.3-5.8-29.1-.7 1.6-41.8-150.9-1.4-5.2-6.2-8.9-11.6-8.9h-6.4c-5.4 0-10.2 3.6-11.6 8.9-38.3 142.3-37.4 140.6-39.4 154.7-4.1-23.9 2.1-2.9-34.4-154.4-1.3-5.4-6.1-9.2-11.7-9.2h-7.2c-7.8 0-13.5 7.3-11.6 14.9 9.5 38 34.5 137.4 42.2 168 1.3 5.3 6.1 9.1 11.6 9.1h17c5.4 0 10.2-3.7 11.6-8.9 34.2-127.7 33.5-123.4 36.7-142.9 6.5 31.1.2 7 36.7 142.9 1.4 5.2 6.2 8.9 11.6 8.9h14c5.5 0 13.7-3.7 15.1-9l42.8-168c1.9-7.6-3.8-15-11.6-15h-6.8c-5.7 0-10.6 4-11.8 9.5z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path d=\\\"M194.74 96l54.63 54.63c6 6 14.14 9.37 22.63 9.37h192c8.84 0 16 7.16 16 16v224c0 8.84-7.16 16-16 16H48c-8.84 0-16-7.16-16-16V112c0-8.84 7.16-16 16-16h146.74M48 64C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path d=\\\"M344 272h-72v-72c0-4.42-3.58-8-8-8h-16c-4.42 0-8 3.58-8 8v72h-72c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8h72v72c0 4.42 3.58 8 8 8h16c4.42 0 8-3.58 8-8v-72h72c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zM194.74 96l54.63 54.63c6 6 14.14 9.37 22.63 9.37h192c8.84 0 16 7.16 16 16v224c0 8.84-7.16 16-16 16H48c-8.84 0-16-7.16-16-16V112c0-8.84 7.16-16 16-16h146.74M48 64C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 640 512\\\"><path d=\\\"M608 352h-32v-97.59c0-16.77-13.62-30.41-30.41-30.41H336v-64h48c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H256c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h48v64H94.41C77.62 224 64 237.64 64 254.41V352H32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32H96v-96h208v96h-32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32h-32v-96h208v96h-32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zm-480 32v96H32v-96h96zm240 0v96h-96v-96h96zM256 128V32h128v96H256zm352 352h-96v-96h96v96z\\\"/></svg>\";","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { Context } from '../../../shared/services/context';\r\nimport { QueryStreams } from '../../form/fields/entity/entity-query/entity-query.models';\r\n\r\n@Injectable()\r\nexport class QueryService {\r\n  constructor(private http: HttpClient, private dnnContext: DnnContext, private context: Context) { }\r\n\r\n  getAvailableEntities(queryUrl: string, includeGuid: boolean, params: string, entitiesFilter?: string[]): Observable<QueryStreams> {\r\n    // Check if any params we should auto-add are already set (like in a query which has these params set in the configuration)\r\n    const hasParams = !!params;\r\n    const paramsLower = params?.toLocaleLowerCase() ?? '';\r\n    const hasAppId = paramsLower.includes('appid=') ?? false;\r\n    const hasGuid = paramsLower.includes('includeguid=') ?? false;\r\n    const allParams =\r\n      (hasGuid ? '' : `&includeGuid=${includeGuid}`)\r\n      + (hasAppId ? '' : `&appId=${this.context.appId}`)\r\n      + (hasParams ? `&${params}` : '');\r\n    // trim initial & because it will always start with an & and it should't\r\n    const urlParams = allParams.substring(1);\r\n    return this.http.post<QueryStreams>(\r\n      this.dnnContext.$2sxc.http.apiUrl(`app/auto/query/${queryUrl}?${urlParams}`),\r\n      { Guids: entitiesFilter },\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EavService } from '.';\r\nimport { EavWindow } from '../../../shared/models/eav-window.model';\r\nimport { UrlHelpers } from '../helpers';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport const FileTypeConstants = {\r\n  CSS: '.css',\r\n  JS: '.js',\r\n} as const;\r\n\r\nexport interface LoadFile {\r\n  path: string;\r\n  type: string;\r\n  loaded: boolean;\r\n  domEl: HTMLLinkElement | HTMLScriptElement;\r\n}\r\n\r\n@Injectable()\r\nexport class ScriptsLoaderService {\r\n  private loadedFiles: LoadFile[] = [];\r\n\r\n  constructor(private eavService: EavService) { }\r\n\r\n  /** Loads CSS and JS files in order (CSS first) and calls callback function when finished */\r\n  load(scripts: string[], callback: () => void) {\r\n    const sortedFiles = this.sortByType(scripts);\r\n    this.insertToDom(sortedFiles, callback, 0); // async, called again and again after each script is loaded\r\n  }\r\n\r\n  private sortByType(scripts: string[]): LoadFile[] {\r\n    const cssFiles: LoadFile[] = [];\r\n    const jsFiles: LoadFile[] = [];\r\n    scripts.forEach(script => {\r\n      const file: LoadFile = {\r\n        path: this.resolveSpecialPaths(script),\r\n        type: null,\r\n        loaded: false,\r\n        domEl: null\r\n      };\r\n      if (file.path.endsWith(FileTypeConstants.CSS)) {\r\n        file.type = FileTypeConstants.CSS;\r\n        cssFiles.push(file);\r\n      } else if (file.path.endsWith(FileTypeConstants.JS)) {\r\n        file.type = FileTypeConstants.JS;\r\n        jsFiles.push(file);\r\n      }\r\n    });\r\n    return cssFiles.concat(jsFiles);\r\n  }\r\n\r\n  private insertToDom(files: LoadFile[], callback: () => void, increment: number) {\r\n    const file = files[increment];\r\n    increment++;\r\n    if (!file) {\r\n      callback();\r\n      return;\r\n    }\r\n    file.path = file.path + '?sxcver=' + window.sxcVersion; // break cache\r\n\r\n    const existing = this.loadedFiles.find(loadedFile => loadedFile.path === file.path);\r\n    if (existing) {\r\n      if (existing.loaded) {\r\n        this.insertToDom(files, callback, increment);\r\n      } else {\r\n        const _listener = () => {\r\n          file.loaded = true;\r\n          this.insertToDom(files, callback, increment);\r\n          existing.domEl.removeEventListener('load', _listener);\r\n          existing.domEl.removeEventListener('error', _listener);\r\n        };\r\n        existing.domEl.addEventListener('load', _listener);\r\n        existing.domEl.addEventListener('error', _listener);\r\n      }\r\n    } else {\r\n      if (file.type === FileTypeConstants.CSS) {\r\n        file.domEl = document.createElement('link');\r\n        file.domEl.rel = 'stylesheet';\r\n        file.domEl.href = file.path;\r\n      } else if (file.type === FileTypeConstants.JS) {\r\n        file.domEl = document.createElement('script');\r\n        file.domEl.type = 'module';\r\n        file.domEl.src = file.path;\r\n      }\r\n\r\n      const _listener = () => {\r\n        file.loaded = true;\r\n        this.insertToDom(files, callback, increment);\r\n        file.domEl.removeEventListener('load', _listener);\r\n        file.domEl.removeEventListener('error', _listener);\r\n      };\r\n      file.domEl.addEventListener('load', _listener);\r\n      file.domEl.addEventListener('error', _listener);\r\n\r\n      document.querySelector('head').appendChild(file.domEl);\r\n      this.loadedFiles.push(file);\r\n    }\r\n  }\r\n\r\n  private resolveSpecialPaths(url: string) {\r\n    return url.replace(/\\[System:Path\\]/i, UrlHelpers.getUrlPrefix('system', this.eavService.eavConfig))\r\n      .replace(/\\[Zone:Path\\]/i, UrlHelpers.getUrlPrefix('zone', this.eavService.eavConfig))\r\n      .replace(/\\[App:Path\\]/i, UrlHelpers.getUrlPrefix('app', this.eavService.eavConfig))\r\n      .replace(/\\[App:PathShared\\]/i, UrlHelpers.getUrlPrefix('appShared', this.eavService.eavConfig));\r\n  }\r\n}\r\n","import { FieldSettings } from 'projects/edit-types';\r\nimport { consoleLogAngular } from '../../../shared/helpers/console-log-angular.helper';\r\nimport { ItemIdentifierShared } from '../../../shared/models/edit-form.model';\r\n\r\nexport class ItemFieldVisibility {\r\n  private defaultIsShow = true;\r\n  private fields: Record<string, boolean> = null;\r\n  constructor(identifier: ItemIdentifierShared) {\r\n    var fields = identifier.ClientData?.fields as string;\r\n    if (fields == null || fields == '') return;\r\n    \r\n    // If the first character is a minus, then default is show all and just hide mentions\r\n    this.defaultIsShow = (fields[0] == '-');\r\n    if (this.defaultIsShow) fields = fields.substring(1);\r\n    const ruleIsShow = !this.defaultIsShow;\r\n\r\n    this.fields = fields.toLowerCase().split(',')\r\n      .reduce((prev, f) => {\r\n        prev[f] = ruleIsShow;\r\n        return prev;\r\n      }, {} as Record<string, boolean>);\r\n    consoleLogAngular('ItemFieldVisibility', this.fields, 'default', this.defaultIsShow);\r\n  }\r\n\r\n  hasRules(): boolean {\r\n    return this.fields != null;\r\n  }\r\n\r\n  isVisibleDisabled(fieldName: string): boolean {\r\n    // check if we have no rules at all - in which case never override\r\n    if (this.fields == null) return false;\r\n    const override = this.fields[fieldName.toLowerCase()];\r\n    return !(override ?? this.defaultIsShow);\r\n  }\r\n\r\n  static mergedVisible(settings: FieldSettings): boolean {\r\n    return settings.Visible && !settings.VisibleDisabled;\r\n  }\r\n}","import { EntityCollectionServiceBase, EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * Creates BehaviorSubject for cached data to be accessible in both synchronous and asynchronous manner with cache$.\r\n * WARNING! Do not use entities$\r\n */\r\nexport class BaseDataService<T> extends EntityCollectionServiceBase<T> {\r\n  cache$: BehaviorSubject<T[]>;\r\n\r\n  constructor(cacheName: string, serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super(cacheName, serviceElementsFactory);\r\n\r\n    this.cache$ = new BehaviorSubject<T[]>([]);\r\n    // doesn't need to be completed because store services are singletons that live as long as the browser tab is open\r\n    this.entities$.subscribe(items => {\r\n      this.cache$.next(items);\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { distinctUntilChanged, map, Observable } from 'rxjs';\r\nimport { keyDebug } from '../../../../shared/constants/session.constants';\r\nimport { GlobalConfig } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class GlobalConfigService extends BaseDataService<GlobalConfig> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory, private snackBar: MatSnackBar) {\r\n    super('GlobalConfig', serviceElementsFactory);\r\n\r\n    const initial: GlobalConfig = {\r\n      id: 0,\r\n      debugEnabled: sessionStorage.getItem(keyDebug) === 'true',\r\n      allowDebugMode: false,\r\n    };\r\n    this.addOneToCache(initial);\r\n  }\r\n\r\n  allowDebug(allow: boolean): void {\r\n    const oldConfig = this.cache$.value[0];\r\n    if (oldConfig.allowDebugMode === allow) { return; }\r\n\r\n    const newConfig: GlobalConfig = {\r\n      ...oldConfig,\r\n      allowDebugMode: allow,\r\n    };\r\n    this.updateOneInCache(newConfig);\r\n  }\r\n\r\n  getDebugEnabled(): boolean {\r\n    return this.cache$.value[0].allowDebugMode && this.cache$.value[0].debugEnabled;\r\n  }\r\n\r\n  getDebugEnabled$(): Observable<boolean> {\r\n    return this.cache$.pipe(\r\n      map(configs => configs[0].allowDebugMode && configs[0].debugEnabled),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  toggleDebugEnabled(): void {\r\n    const oldConfig = this.cache$.value[0];\r\n    if (!oldConfig.allowDebugMode) {\r\n      this.snackBar.open('You do not have permissions to enter developer mode', null, { duration: 3000 });\r\n      return;\r\n    }\r\n\r\n    const newConfig: GlobalConfig = {\r\n      ...oldConfig,\r\n      debugEnabled: !oldConfig.debugEnabled,\r\n    };\r\n    this.updateOneInCache(newConfig);\r\n    this.snackBar.open(newConfig.debugEnabled ? 'developer mode on' : 'developer mode off', null, { duration: 3000 });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { AdamItem } from '../../../../../../../edit-types';\r\nimport { PrefetchAdams } from '../../../dialog/main/edit-dialog-main.models';\r\nimport { AdamSnapshot } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AdamCacheService extends BaseDataService<AdamSnapshot> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('AdamCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadPrefetch(prefetchAdams: PrefetchAdams): void {\r\n    if (prefetchAdams == null) { return; }\r\n\r\n    const snapshots = Object.entries(prefetchAdams).map(([entityGuid, attributes]) => {\r\n      const snapshot: AdamSnapshot = {\r\n        Guid: entityGuid,\r\n        Attributes: attributes,\r\n      };\r\n      return snapshot;\r\n    });\r\n    this.upsertManyInCache(snapshots);\r\n  }\r\n\r\n  getAdamSnapshot(entityGuid: string, fieldName: string): AdamItem[] {\r\n    return this.cache$.value.find(adamSnapshot => adamSnapshot.Guid === entityGuid)?.Attributes[fieldName];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { EavEntity } from '../../models/eav';\r\nimport { EavEntityDto } from '../../models/json-format-v1';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ContentTypeItemService extends BaseDataService<EavEntity> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('ContentTypeItem', serviceElementsFactory);\r\n  }\r\n\r\n  addContentTypeItems(contentTypeItems1: EavEntityDto[]): void {\r\n    const contentTypeItems = EavEntity.convertMany(contentTypeItems1);\r\n    this.upsertManyInCache(contentTypeItems);\r\n  }\r\n\r\n  getContentTypeItem(guid: string): EavEntity {\r\n    return this.cache$.value.find(contentTypeItem => contentTypeItem.Guid === guid);\r\n  }\r\n\r\n  getContentTypeItems(guids: string[]): EavEntity[] {\r\n    return this.cache$.value.filter(contentTypeItem => guids.includes(contentTypeItem.Guid));\r\n  }\r\n}\r\n","import { EavEntity, EavEntityAttributes } from '.';\r\nimport { EavContentTypeAttributesDto } from '../json-format-v1';\r\n\r\nexport class EavContentTypeAttribute {\r\n  InputType: string;\r\n  IsTitle: boolean;\r\n  Metadata: EavEntity[];\r\n  Name: string;\r\n  Settings: EavEntityAttributes;\r\n  Type: string;\r\n\r\n  private static convertOne(ctAttributeDto: EavContentTypeAttributesDto): EavContentTypeAttribute {\r\n    const metadata = EavEntity.convertMany(ctAttributeDto.Metadata);\r\n    const settings = EavEntityAttributes.mergeSettings(metadata);\r\n\r\n    const attribute: EavContentTypeAttribute = {\r\n      InputType: ctAttributeDto.InputType,\r\n      IsTitle: ctAttributeDto.IsTitle,\r\n      Metadata: metadata,\r\n      Name: ctAttributeDto.Name,\r\n      Settings: settings,\r\n      Type: ctAttributeDto.Type,\r\n    };\r\n    return attribute;\r\n  }\r\n\r\n  static convertMany(ctAttributesDto: EavContentTypeAttributesDto[]): EavContentTypeAttribute[] {\r\n    if (ctAttributesDto == null) { return []; }\r\n\r\n    const attributes = ctAttributesDto.map(attribute1 => EavContentTypeAttribute.convertOne(attribute1));\r\n    return attributes;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { distinctUntilChanged, map, Observable } from 'rxjs';\r\nimport { EavContentType } from '../../models/eav';\r\nimport { EavContentTypeDto } from '../../models/json-format-v1';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ContentTypeService extends BaseDataService<EavContentType> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('ContentType', serviceElementsFactory);\r\n  }\r\n\r\n  addContentTypes(contentTypes1: EavContentTypeDto[]): void {\r\n    const contentTypes = contentTypes1.map(contentType1 => EavContentType.convert(contentType1));\r\n    this.addManyToCache(contentTypes);\r\n  }\r\n\r\n  getContentType(id: string): EavContentType {\r\n    return this.cache$.value.find(contentType => contentType.Id === id);\r\n  }\r\n\r\n  getContentType$(id: string): Observable<EavContentType> {\r\n    return this.cache$.pipe(\r\n      map(contentTypes => contentTypes.find(contentType => contentType.Id === id)),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n}\r\n","import { EavContentTypeAttribute, EavEntity, EavEntityAttributes } from '.';\r\nimport { EavContentTypeDto } from '../json-format-v1';\r\n\r\nexport class EavContentType {\r\n  Attributes: EavContentTypeAttribute[];\r\n  Description: string;\r\n  Id: string;\r\n  Metadata: EavEntity[];\r\n  Name: string;\r\n  Scope: string;\r\n  Settings: EavEntityAttributes;\r\n\r\n  static convert(contentTypeDto: EavContentTypeDto): EavContentType {\r\n    const attributes = EavContentTypeAttribute.convertMany(contentTypeDto.Attributes);\r\n    const metadata = EavEntity.convertMany(contentTypeDto.Metadata);\r\n    const settings = EavEntityAttributes.mergeSettings(metadata);\r\n\r\n    const contentType: EavContentType = {\r\n      Attributes: attributes,\r\n      Description: contentTypeDto.Description,\r\n      Id: contentTypeDto.Id,\r\n      Metadata: metadata,\r\n      Name: contentTypeDto.Name,\r\n      Scope: contentTypeDto.Scope,\r\n      Settings: settings,\r\n    };\r\n    return contentType;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { distinctUntilChanged, map, Observable } from 'rxjs';\r\nimport { EntityInfo } from '../../../../../../../edit-types';\r\nimport { GeneralHelpers } from '../../helpers';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class EntityCacheService extends BaseDataService<EntityInfo> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('EntityCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadEntities(entities: EntityInfo[]): void {\r\n    if (entities == null) { return; }\r\n    this.upsertManyInCache(entities);\r\n  }\r\n\r\n  getEntities$(guids?: string[]): Observable<EntityInfo[]> {\r\n    if (guids == null) {\r\n      return this.cache$.asObservable();\r\n    }\r\n\r\n    return this.cache$.pipe(\r\n      map(entities => entities.filter(entity => guids.includes(entity.Value))),\r\n      distinctUntilChanged(GeneralHelpers.arraysEqual),\r\n    );\r\n  }\r\n\r\n  getEntities(guids?: string[]): EntityInfo[] {\r\n    if (guids == null) {\r\n      return this.cache$.value;\r\n    }\r\n\r\n    return this.cache$.value.filter(entity => guids.includes(entity.Value));\r\n  }\r\n\r\n  getEntity(guid: string): EntityInfo {\r\n    return this.cache$.value.find(entity => entity.Value === guid);\r\n  }\r\n}\r\n","import { EntityMetadataMap } from '@ngrx/data';\r\nimport { Feature } from 'projects/eav-ui/src/app/features/models/feature.model';\r\nimport { EntityInfo } from '../../../../../../../edit-types';\r\nimport { InputType } from '../../../../content-type-fields/models/input-type.model';\r\nimport { Prefetch } from '../../../dialog/main/edit-dialog-main.models';\r\nimport { AdamSnapshot, Language, LanguageInstance, LinkCache, PublishStatus, StringQueryCacheItem } from '../../models';\r\nimport { EavContentType, EavEntity, EavItem } from '../../models/eav';\r\n\r\nexport const entityMetadata: EntityMetadataMap = {\r\n  GlobalConfig: {},\r\n  Item: {\r\n    selectId: itemSelectId,\r\n  },\r\n  Feature: {\r\n    selectId: featureSelectId,\r\n  },\r\n  Language: {\r\n    selectId: languageSelectId,\r\n  },\r\n  LanguageInstance: {\r\n    selectId: languageInstanceSelectId,\r\n  },\r\n  ContentType: {\r\n    selectId: contentTypeSelectId,\r\n  },\r\n  ContentTypeItem: {\r\n    selectId: contentTypeItemSelectId,\r\n  },\r\n  InputType: {\r\n    selectId: inputTypeSelectId,\r\n  },\r\n  PublishStatus: {\r\n    selectId: publishStatusSelectId,\r\n  },\r\n  Prefetch: {\r\n    selectId: prefetchSelectId,\r\n  },\r\n  EntityCache: {\r\n    selectId: entityCacheSelectId,\r\n  },\r\n  AdamCache: {\r\n    selectId: adamCacheSelectId,\r\n  },\r\n  LinkCache: {\r\n    selectId: linkCacheSelectId,\r\n  },\r\n  StringQueryCache: {\r\n    selectId: stringQueryCacheSelectId,\r\n  },\r\n};\r\n\r\nexport const pluralNames = {\r\n  Feature: 'Features', // example\r\n  PublishStatus: 'PublishStatuses',\r\n};\r\n\r\nexport const entityConfig = {\r\n  entityMetadata,\r\n  pluralNames,\r\n};\r\n\r\nexport function itemSelectId(item: EavItem): string {\r\n  return item?.Entity?.Guid;\r\n}\r\n\r\nexport function featureSelectId(feature: Feature): string {\r\n  return feature?.Guid;\r\n}\r\n\r\nexport function languageSelectId(language: Language): string {\r\n  return language?.NameId;\r\n}\r\n\r\nexport function languageInstanceSelectId(languageInstance: LanguageInstance): number {\r\n  return languageInstance?.formId;\r\n}\r\n\r\nexport function contentTypeSelectId(contentType: EavContentType): string {\r\n  return contentType?.Id;\r\n}\r\n\r\nexport function contentTypeItemSelectId(contentTypeItem: EavEntity): string {\r\n  return contentTypeItem?.Guid;\r\n}\r\n\r\nexport function inputTypeSelectId(inputType: InputType): string {\r\n  return inputType?.Type;\r\n}\r\n\r\nexport function publishStatusSelectId(publishStatus: PublishStatus): number {\r\n  return publishStatus?.formId;\r\n}\r\n\r\nexport function prefetchSelectId(entity: Prefetch): string {\r\n  return entity?._guid;\r\n}\r\n\r\nexport function entityCacheSelectId(entity: EntityInfo): number {\r\n  return entity?.Id;\r\n}\r\n\r\nexport function adamCacheSelectId(adamSnapshot: AdamSnapshot): string {\r\n  return adamSnapshot?.Guid;\r\n}\r\n\r\nexport function linkCacheSelectId(link: LinkCache): string {\r\n  return link?.key;\r\n}\r\n\r\nexport function stringQueryCacheSelectId(cacheItem: StringQueryCacheItem): string {\r\n  return cacheItem?.selector;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { InputType } from '../../../../content-type-fields/models/input-type.model';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class InputTypeService extends BaseDataService<InputType> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('InputType', serviceElementsFactory);\r\n  }\r\n\r\n  addInputTypes(inputTypes: InputType[]): void {\r\n    this.addManyToCache(inputTypes);\r\n  }\r\n\r\n  getInputType(type: string): InputType {\r\n    return this.cache$.value.find(inputType => inputType.Type === type);\r\n  }\r\n\r\n  getInputTypes(): InputType[] {\r\n    return this.cache$.value;\r\n  }\r\n\r\n  getInputTypes$(): Observable<InputType[]> {\r\n    return this.cache$.asObservable();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { distinctUntilChanged, map, Observable } from 'rxjs';\r\nimport { FieldSettings, FieldValue } from '../../../../../../../edit-types';\r\nimport { InputType } from '../../../../content-type-fields/models/input-type.model';\r\nimport { eavConstants } from '../../../../shared/constants/eav.constants';\r\nimport { BestValueModes } from '../../constants';\r\nimport { GeneralHelpers, InputFieldHelpers, LocalizationHelpers } from '../../helpers';\r\nimport { FormValues, Language, SaveResult } from '../../models';\r\nimport { EavContentTypeAttribute, EavDimension, EavEntity, EavEntityAttributes, EavFor, EavItem, EavValue } from '../../models/eav';\r\nimport { EavEntityBundleDto } from '../../models/json-format-v1';\r\nimport { BaseDataService } from './base-data.service';\r\nimport { ItemEditIdentifier, ItemIdentifierHeader } from 'projects/eav-ui/src/app/shared/models/edit-form.model';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ItemService extends BaseDataService<EavItem> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('Item', serviceElementsFactory);\r\n  }\r\n\r\n  loadItems(items1: EavEntityBundleDto[]): void {\r\n    const items = items1.map(item1 => EavItem.convert(item1));\r\n    this.upsertManyInCache(items);\r\n  }\r\n\r\n  updateItemId(itemData: SaveResult): void {\r\n    const entityGuid = Object.keys(itemData)[0];\r\n    const entityId = itemData[entityGuid];\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem || ((oldItem.Header as ItemEditIdentifier).EntityId !== 0 && oldItem.Entity.Id !== 0)) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Header: {\r\n        ...oldItem.Header,\r\n        EntityId: entityId,\r\n      },\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Id: entityId,\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  updateItemMetadata(entityGuid: string, metadata: EavEntity[]): void {\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Metadata: metadata,\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  addItemAttributeValue(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    newValue: FieldValue,\r\n    currentLanguage: string,\r\n    isReadOnly: boolean,\r\n    attributeType: string,\r\n    isTransaction = false,\r\n    transactionItem?: EavItem,\r\n  ): EavItem {\r\n    const newValueDimension = isReadOnly ? `~${currentLanguage}` : currentLanguage;\r\n    const newEavValue = EavValue.create(newValue, [EavDimension.create(newValueDimension)]);\r\n    const oldItem = transactionItem ?? this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.addAttributeValue(oldItem.Entity.Attributes, newEavValue, attributeKey, attributeType),\r\n      }\r\n    };\r\n\r\n    if (!isTransaction) { this.updateOneInCache(newItem); }\r\n    return newItem;\r\n  }\r\n\r\n  updateItemAttributeValue(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    newValue: FieldValue,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n  ): void {\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.updateAttributeValue(\r\n          oldItem.Entity.Attributes, attributeKey, newValue, currentLanguage, defaultLanguage, isReadOnly,\r\n        ),\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  updateItemAttributesValues(entityGuid: string, newValues: FormValues, currentLanguage: string, defaultLanguage: string): void {\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem) { return; }\r\n\r\n    const oldValues: FormValues = {};\r\n    for (const [name, values] of Object.entries(oldItem.Entity.Attributes)) {\r\n      if (!newValues.hasOwnProperty(name)) { continue; }\r\n      oldValues[name] = LocalizationHelpers.translate(currentLanguage, defaultLanguage, values, null);\r\n    }\r\n    const changes = GeneralHelpers.getFormChanges(oldValues, newValues);\r\n    if (changes == null) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.updateAttributesValues(oldItem.Entity.Attributes, changes, currentLanguage, defaultLanguage),\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  /**\r\n   * Update entity attribute dimension. Add readonly languageKey to existing useFromLanguageKey.\r\n   * Example to useFrom en-us add fr-fr = \"en-us,-fr-fr\"\r\n   */\r\n  addItemAttributeDimension(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    currentLanguage: string,\r\n    shareWithLanguage: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n    transactionItem?: EavItem,\r\n  ): void {\r\n    const oldItem = transactionItem ?? this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.addAttributeDimension(\r\n          oldItem.Entity.Attributes, attributeKey, currentLanguage, shareWithLanguage, defaultLanguage, isReadOnly,\r\n        ),\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  removeItemAttributeDimension(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    currentLanguage: string,\r\n    isTransaction = false,\r\n    transactionItem?: EavItem,\r\n  ): EavItem {\r\n    const oldItem = transactionItem ?? this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.removeAttributeDimension(oldItem.Entity.Attributes, attributeKey, currentLanguage),\r\n      }\r\n    };\r\n\r\n    if (!isTransaction) { this.updateOneInCache(newItem); }\r\n    return newItem;\r\n  }\r\n\r\n  updateItemHeader(entityGuid: string, header: ItemIdentifierHeader): void {\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Header: {\r\n        ...header\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  getItemAttributes(entityGuid: string): EavEntityAttributes {\r\n    return this.cache$.value.find(item => item.Entity.Guid === entityGuid)?.Entity.Attributes;\r\n  }\r\n\r\n  getItemAttributes$(entityGuid: string): Observable<EavEntityAttributes> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.Entity.Guid === entityGuid)?.Entity.Attributes),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItem(entityGuid: string): EavItem {\r\n    return this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n  }\r\n\r\n  getItem$(entityGuid: string): Observable<EavItem> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.Entity.Guid === entityGuid)),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItemFor$(entityGuid: string): Observable<EavFor> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.Entity.Guid === entityGuid)?.Entity.For),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItemNote(entityGuid: string): EavEntity {\r\n    return this.cache$.value\r\n      .find(item => item.Entity.Guid === entityGuid)?.Entity.Metadata\r\n      ?.find(metadata => metadata.Type.Name === eavConstants.contentTypes.notes);\r\n  }\r\n\r\n  getItemNote$(entityGuid: string): Observable<EavEntity> {\r\n    return this.cache$.pipe(\r\n      map(items =>\r\n        items.find(item => item.Entity.Guid === entityGuid)?.Entity.Metadata\r\n          ?.find(metadata => metadata.Type.Name === eavConstants.contentTypes.notes)\r\n      ),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItemHeader$(entityGuid: string): Observable<ItemIdentifierHeader> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.Entity.Guid === entityGuid)?.Header),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItems(entityGuids?: string[]): EavItem[] {\r\n    if (entityGuids == null) { return this.cache$.value; }\r\n\r\n    return this.cache$.value.filter(item => entityGuids.includes(item.Entity.Guid));\r\n  }\r\n\r\n  getItems$(entityGuids?: string[]): Observable<EavItem[]> {\r\n    if (entityGuids == null) { return this.cache$.asObservable(); }\r\n\r\n    return this.cache$.pipe(\r\n      map(items => items.filter(item => entityGuids.includes(item.Entity.Guid))),\r\n      distinctUntilChanged(GeneralHelpers.arraysEqual),\r\n    );\r\n  }\r\n\r\n  setDefaultValue(\r\n    item: EavItem,\r\n    ctAttribute: EavContentTypeAttribute,\r\n    inputType: InputType,\r\n    settings: FieldSettings,\r\n    languages: Language[],\r\n    defaultLanguage: string,\r\n  ): FieldValue {\r\n    const defaultValue = InputFieldHelpers.parseDefaultValue(ctAttribute.Name, inputType, settings, item.Header);\r\n\r\n    const defaultLanguageValue = LocalizationHelpers.getBestValue(\r\n      item.Entity.Attributes[ctAttribute.Name],\r\n      defaultLanguage,\r\n      defaultLanguage,\r\n      BestValueModes.Strict,\r\n    );\r\n    if (defaultLanguageValue === undefined) {\r\n      if (languages.length === 0 || inputType?.DisableI18n) {\r\n        this.addItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, '*', false, ctAttribute.Type);\r\n      } else {\r\n        this.addItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, defaultLanguage, false, ctAttribute.Type);\r\n      }\r\n    } else {\r\n      // most likely used only for entity fields because we can never know if they were cleaned out or brand new\r\n      if (languages.length === 0 || inputType?.DisableI18n) {\r\n        this.updateItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, '*', defaultLanguage, false);\r\n      } else {\r\n        this.updateItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, defaultLanguage, defaultLanguage, false);\r\n      }\r\n    }\r\n\r\n    // return what was used, so it can be checked on form-init\r\n    return defaultValue;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { combineLatest, distinctUntilChanged, map, Observable, shareReplay } from 'rxjs';\r\nimport { EntityReader } from '../../helpers';\r\nimport { LanguageInstance } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LanguageInstanceService extends BaseDataService<LanguageInstance> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('LanguageInstance', serviceElementsFactory);\r\n  }\r\n\r\n  addLanguageInstance(formId: number, currentLanguage: string, defaultLanguage: string, uiLanguage: string, hideHeader: boolean): void {\r\n    const languageInstance: LanguageInstance = { formId, currentLanguage, defaultLanguage, uiLanguage, hideHeader };\r\n    this.addOneToCache(languageInstance);\r\n  }\r\n\r\n  removeLanguageInstance(formId: number): void {\r\n    this.removeOneFromCache(formId);\r\n  }\r\n\r\n  setCurrentLanguage(formId: number, newLanguage: string): void {\r\n    const languageInstance: Partial<LanguageInstance> = { formId, currentLanguage: newLanguage };\r\n    this.updateOneInCache(languageInstance);\r\n  }\r\n\r\n  getCurrentLanguage(formId: number): string {\r\n    return this.cache$.value.find(languageInstance => languageInstance.formId === formId)?.currentLanguage;\r\n  }\r\n\r\n  /**\r\n   * Get an EntityReader for the current form\r\n   */\r\n  getEntityReader$(formId: number) {\r\n    return combineLatest([\r\n      this.getCurrentLanguage$(formId),\r\n      this.getDefaultLanguage$(formId),\r\n    ]).pipe(\r\n      map(([currentLanguage, defaultLanguage]) => {\r\n        return new EntityReader(currentLanguage, defaultLanguage);\r\n      }),\r\n      // Ensure we don't fire too often\r\n      distinctUntilChanged(),\r\n      // Ensure the EntityReader is reused and not recreated every time\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  getCurrentLanguage$(formId: number): Observable<string> {\r\n    return this.cache$.pipe(\r\n      map(languageInstances => languageInstances.find(languageInstance => languageInstance.formId === formId)?.currentLanguage),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getDefaultLanguage(formId: number): string {\r\n    return this.cache$.value.find(languageInstance => languageInstance.formId === formId)?.defaultLanguage;\r\n  }\r\n\r\n  getDefaultLanguage$(formId: number): Observable<string> {\r\n    return this.cache$.pipe(\r\n      map(languageInstances => languageInstances.find(languageInstance => languageInstance.formId === formId)?.defaultLanguage),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  /** Get hideHeader for the form. Fix for safari and mobile browsers */\r\n  getHideHeader$(formId: number): Observable<boolean> {\r\n    return this.cache$.pipe(\r\n      map(languageInstances => languageInstances.find(languageInstance => languageInstance.formId === formId)?.hideHeader),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  /** Update hideHeader for the form. Fix for safari and mobile browsers */\r\n  updateHideHeader(formId: number, hideHeader: boolean): void {\r\n    const languageInstance: Partial<LanguageInstance> = { formId, hideHeader };\r\n    this.updateOneInCache(languageInstance);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { BaseDataService } from '.';\r\nimport { Language } from '../../models';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LanguageService extends BaseDataService<Language> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('Language', serviceElementsFactory);\r\n  }\r\n\r\n  loadLanguages(languages: Language[]): void {\r\n    this.addAllToCache(languages);\r\n  }\r\n\r\n  getLanguages(): Language[] {\r\n    return this.cache$.value;\r\n  }\r\n\r\n  getLanguages$(): Observable<Language[]> {\r\n    return this.cache$.asObservable();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { AdamItem } from '../../../../../../../edit-types';\r\nimport { PrefetchAdams, PrefetchLinks } from '../../../dialog/main/edit-dialog-main.models';\r\nimport { LinkCache, LinkInfo } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LinkCacheService extends BaseDataService<LinkCache> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('LinkCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadPrefetch(prefetchLinks: PrefetchLinks, prefetchAdam: PrefetchAdams): void {\r\n    const links: LinkCache[] = [];\r\n\r\n    if (prefetchLinks != null) {\r\n      for (const [key, linkInfo] of Object.entries(prefetchLinks)) {\r\n        const link: LinkCache = {\r\n          key,\r\n          linkInfo,\r\n        };\r\n        links.push(link);\r\n      }\r\n    }\r\n\r\n    if (prefetchAdam != null) {\r\n      for (const [entityGuid, prefetchFields] of Object.entries(prefetchAdam)) {\r\n        for (const [fieldName, items] of Object.entries(prefetchFields)) {\r\n          const adamLinks = this.adamToLinks(items);\r\n          links.push(...adamLinks);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.upsertManyInCache(links);\r\n  }\r\n\r\n  loadAdam(items: AdamItem[]): void {\r\n    const adamLinks = this.adamToLinks(items);\r\n    this.upsertManyInCache(adamLinks);\r\n  }\r\n\r\n  loadLink(key: string, linkInfo: LinkInfo): void {\r\n    key = key.trim().toLocaleLowerCase();\r\n    const link: LinkCache = {\r\n      key,\r\n      linkInfo: {\r\n        ...linkInfo,\r\n        Adam: {\r\n          ...linkInfo.Adam,\r\n        },\r\n      },\r\n    };\r\n    this.upsertOneInCache(link);\r\n  }\r\n\r\n  getLinkInfo(key: string): LinkInfo {\r\n    key = key.trim().toLocaleLowerCase();\r\n    return this.cache$.value.find(linkCache => linkCache.key.trim().toLocaleLowerCase() === key)?.linkInfo;\r\n  }\r\n\r\n  private adamToLinks(items: AdamItem[]): LinkCache[] {\r\n    const links: LinkCache[] = [];\r\n\r\n    for (const item of items) {\r\n      if (item.IsFolder) { continue; }\r\n\r\n      const link: LinkCache = {\r\n        key: item.ReferenceId,\r\n        linkInfo: {\r\n          Adam: { ...item },\r\n          Value: item.Url,\r\n        },\r\n      };\r\n      links.push(link);\r\n    }\r\n\r\n    return links;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { distinctUntilChanged, map, Observable } from 'rxjs';\r\nimport { PublishMode, PublishModes, PublishStatus } from '../../models';\r\nimport { EavService } from '../../services';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class PublishStatusService extends BaseDataService<PublishStatus> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('PublishStatus', serviceElementsFactory);\r\n  }\r\n\r\n  private setPublishStatus(publishStatus: PublishStatus): void {\r\n    this.upsertOneInCache(publishStatus);\r\n  }\r\n\r\n  removePublishStatus(formId: number): void {\r\n    this.removeOneFromCache(formId);\r\n  }\r\n\r\n  getPublishStatus(formId: number): PublishStatus {\r\n    return this.cache$.value.find(publishStatus => publishStatus.formId === formId);\r\n  }\r\n\r\n  private getPublishStatus$(formId: number): Observable<PublishStatus> {\r\n    return this.cache$.pipe(\r\n      map(publishStatuses => publishStatuses.find(publishStatus => publishStatus.formId === formId)),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  /** Convert the booleans to the appropriate \"verb\" */\r\n  asPublishMode(isPublished: boolean, draftShouldBranch: boolean): PublishMode {\r\n    return draftShouldBranch ? PublishModes.Branch : isPublished ? PublishModes.Show : PublishModes.Hide;\r\n  }\r\n\r\n  setPublishMode(publishMode: PublishMode, formId: number, eavService: EavService): void {\r\n    // if publish mode is prohibited, set default\r\n    if (eavService.eavConfig.versioningOptions[publishMode] == null) {\r\n      publishMode = Object.keys(eavService.eavConfig.versioningOptions)[0] as PublishMode;\r\n    }\r\n    const publishStatus: PublishStatus = {\r\n      formId,\r\n      DraftShouldBranch: publishMode === PublishModes.Branch,\r\n      IsPublished: publishMode === PublishModes.Show,\r\n    };\r\n    this.setPublishStatus(publishStatus);\r\n  }\r\n\r\n  getPublishMode$(formId: number): Observable<PublishMode> {\r\n    return this.getPublishStatus$(formId).pipe(\r\n      map(publishStatus => {\r\n        const publishMode: PublishMode = publishStatus.DraftShouldBranch\r\n          ? PublishModes.Branch\r\n          : publishStatus.IsPublished ? PublishModes.Show : PublishModes.Hide;\r\n        return publishMode;\r\n      }),\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { distinctUntilChanged, map, Observable } from 'rxjs';\r\nimport { QueryEntity } from '../../../form/fields/entity/entity-query/entity-query.models';\r\nimport { GeneralHelpers } from '../../helpers';\r\nimport { StringQueryCacheItem } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class StringQueryCacheService extends BaseDataService<StringQueryCacheItem> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('StringQueryCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadEntities(entityGuid: string, fieldName: string, entities: QueryEntity[]): void {\r\n    if (entities == null) { return; }\r\n    const cacheItem: StringQueryCacheItem = {\r\n      selector: this.buildSelector(entityGuid, fieldName),\r\n      entities,\r\n    };\r\n    this.upsertOneInCache(cacheItem);\r\n  }\r\n\r\n  getEntities$(entityGuid: string, fieldName: string): Observable<QueryEntity[]> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.selector === this.buildSelector(entityGuid, fieldName))?.entities ?? []),\r\n      distinctUntilChanged(GeneralHelpers.arraysEqual),\r\n    );\r\n  }\r\n\r\n  private buildSelector(entityGuid: string, fieldName: string): string {\r\n    return `${entityGuid}|${fieldName}`;\r\n  }\r\n}\r\n","import { Directive, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\n@Directive()\r\n// tslint:disable-next-line:directive-class-suffix\r\nexport class BaseSubsinkComponent implements OnDestroy {\r\n  protected subscription: Subscription;\r\n\r\n  constructor() {\r\n    this.subscription = new Subscription();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscription.unsubscribe();\r\n  }\r\n}\r\n","export const DialogTypeConstants = {\r\n  Zone: 'zone',\r\n  Apps: 'apps',\r\n  AppImport: 'app-import',\r\n  App: 'app',\r\n  ContentType: 'contenttype',\r\n  ContentItems: 'contentitems',\r\n  Edit: 'edit',\r\n  ItemHistory: 'item-history',\r\n  Develop: 'develop',\r\n  PipelineDesigner: 'pipeline-designer',\r\n  Replace: 'replace',\r\n  InstanceList: 'instance-list',\r\n} as const;\r\n\r\nexport type DialogTypeConstant = typeof DialogTypeConstants[keyof typeof DialogTypeConstants];\r\n","const MetadataKeyTypes = {\r\n  Guid: 'guid',\r\n  String: 'string',\r\n  Number: 'number',\r\n} as const;\r\nexport type MetadataKeyType = typeof MetadataKeyTypes[keyof typeof MetadataKeyTypes];\r\n\r\nexport interface ScopeOption {\r\n  name: string;\r\n  value: string;\r\n}\r\n\r\nexport const SystemSettingsScopes = {\r\n  App: 'app',\r\n  Site: 'site',\r\n} as const;\r\nexport type SystemSettingsScope = typeof SystemSettingsScopes[keyof typeof SystemSettingsScopes];\r\n\r\nexport const EditApiKeyPaths = {\r\n  GoogleTranslate: 'Settings.GoogleTranslate.ApiKey',\r\n  GoogleMaps: 'Settings.GoogleMaps.ApiKey',\r\n} as const;\r\n\r\n\r\nexport const eavConstants = {\r\n  metadata: {\r\n    /** Metadata of Attribute */\r\n    // tslint:disable-next-line:max-line-length\r\n    attribute: { targetType: 2, target: 'EAV Field Properties', label: 'Content-Type Field/Attribute (2)', keyType: MetadataKeyTypes.Number },\r\n    /** Metadata of App */\r\n    app: { targetType: 3, target: 'App', label: 'App (3)', keyType: MetadataKeyTypes.Number },\r\n    /** Metadata of Entity */\r\n    entity: { targetType: 4, target: 'Entity', label: 'Entity (4)', keyType: MetadataKeyTypes.Guid },\r\n    /** Metadata of ContentType */\r\n    contentType: { targetType: 5, target: 'ContentType', label: 'Content-Type (5)', keyType: MetadataKeyTypes.String },\r\n    /** Metadata of Zone */\r\n    zone: { targetType: 6, target: 'Zone', label: 'Zone (6) - not used as of now', keyType: MetadataKeyTypes.Number },\r\n    /** Metadata of Language (a Dimension) */\r\n    language: { targetType: 8, target: 'Dimension', label: 'Language (8)', keyType: MetadataKeyTypes.String },\r\n    /** Metadata of CmsObject */\r\n    cmsObject: { targetType: 10, target: 'CmsObject', label: 'Cms Object (10)', keyType: MetadataKeyTypes.String, hint: 'Usually this is \"file:400\" or \"folder:4030\"' },\r\n  },\r\n\r\n  appMetadata: {\r\n    LightSpeed: { ContentTypeName: 'LightSpeedOutputDecorator' }\r\n  },\r\n\r\n  /** Lookup type for the metadata, e.g. key=80adb152-efad-4aa4-855e-74c5ef230e1f is keyType=guid */\r\n  keyTypes: {\r\n    guid: MetadataKeyTypes.Guid,\r\n    string: MetadataKeyTypes.String,\r\n    number: MetadataKeyTypes.Number,\r\n  },\r\n\r\n  /** Scopes */\r\n  scopes: {\r\n    /** This is the main schema and the data you usually see is from here */\r\n    default: { name: 'Default', value: 'Default' },\r\n    configuration: { name: 'Configuration (Views etc.)', value: 'System.Configuration' },\r\n  },\r\n\r\n  /** Content types where templates, permissions, etc. are stored */\r\n  contentTypes: {\r\n    /** Content type containing app's specifications */\r\n    appConfiguration: '2SexyContent-App',\r\n    /** Content type containing app's views */\r\n    template: '2SexyContent-Template',\r\n    /** Content type containing permissions */\r\n    permissions: 'PermissionConfiguration',\r\n    /** Content type containing queries */\r\n    query: 'DataPipeline',\r\n    /** Content type containing content type metadata */\r\n    contentType: 'ContentType',\r\n    /** Content type containing app's custom settings */\r\n    settings: 'App-Settings',\r\n    /** Content type containing app's custom resources */\r\n    resources: 'App-Resources',\r\n    /** Content type containing app's system settings */\r\n    systemSettings: 'SettingsSystem',\r\n    /** Content type containing app's system resources */\r\n    systemResources: 'ResourcesSystem',\r\n    /** Content type containing Primary and Global App custom settings */\r\n    customSettings: 'SettingsCustom',\r\n    /** Content type containing Primary and Global App custom resources */\r\n    customResources: 'ResourcesCustom',\r\n    /** Content type containing formulas */\r\n    formulas: 'UiFormula',\r\n    /** Content type containing notes */\r\n    notes: 'NoteDecorator',\r\n    /** Content type containing settings for image scaling */\r\n    imageDecorator: 'ImageDecorator',\r\n  },\r\n\r\n  pipelineDesigner: {\r\n    dataSourceDifficulties: {\r\n      default: 100,\r\n      advanced: 200,\r\n    },\r\n    outDataSource: {\r\n      Description: 'The template/script which will show this data',\r\n      EntityGuid: 'Out',\r\n      In: ['Default', 'Header'],\r\n      Name: '2sxc Target (View or API)',\r\n      PartAssemblyAndType: 'SexyContentTemplate',\r\n      PrimaryType: 'Target',\r\n      VisualDesignerData: { Top: 20, Left: 200, Width: 700 },\r\n    },\r\n    defaultPipeline: {\r\n      dataSources: [\r\n        {\r\n          EntityGuid: 'unsaved1',\r\n          PartAssemblyAndType: 'ToSic.Sxc.DataSources.CmsBlock, ToSic.Sxc',\r\n          VisualDesignerData: { Top: 170, Left: 440 },\r\n        }\r\n      ],\r\n      streamWiring: [\r\n        { From: 'unsaved1', Out: 'Header', To: 'Out', In: 'Header' },\r\n        { From: 'unsaved1', Out: 'Default', To: 'Out', In: 'Default' },\r\n      ],\r\n    },\r\n    testParameters: '[Demo:Demo]=true',\r\n  },\r\n};\r\n","export const prefix = 'eav-';\r\nexport const keyZoneId = prefix + 'zoneId';\r\nexport const keyContentBlockId = prefix + 'cbid';\r\nexport const keyModuleId = prefix + 'mid';\r\nexport const keyAppId = prefix + 'appId';\r\nexport const keyDebug = prefix + 'debug';\r\nexport const keyDialog = prefix + 'dialog';\r\nexport const keyContentType = prefix + 'contentType';\r\nexport const keyItems = prefix + 'items';\r\nexport const keyPartOfPage = prefix + 'partOfPage';\r\nexport const keyPublishing = prefix + 'publishing';\r\nexport const keyFilters = prefix + 'filters';\r\nexport const keyPipelineId = prefix + 'pipelineId';\r\n\r\n/** WIP v16.01 */\r\nexport const keyEditFields = prefix + 'fields';\r\n\r\n/** Url which opened the dialog. Used for debugging */\r\nexport const keyUrl = prefix + 'url';\r\n\r\n/** This is used by file editor to determine if it's editing shared files or of that portal only */\r\nexport const keyIsShared = prefix + 'isshared';\r\n\r\n/** Contains extra options for dialogs */\r\nexport const keyExtras = prefix + 'extras';\r\n\r\n/** Fallback value in case it is missing in url */\r\nexport const partOfPageDefault = 'false';\r\n","import { Directive, ElementRef, Input, OnChanges, OnDestroy, SimpleChanges } from '@angular/core';\r\nimport tippy, { Instance, Placement, Props } from 'tippy.js';\r\n\r\n// tslint:disable-next-line:directive-selector\r\n@Directive({ selector: '[tippy]' })\r\nexport class TippyDirective implements OnChanges, OnDestroy {\r\n  @Input() tippy: string | null | undefined;\r\n  @Input() tippyDisabled: string | boolean | null | undefined;\r\n  /**\r\n   * 'top' | 'top-start' | 'top-end' |\r\n   * 'right' | 'right-start' | 'right-end' |\r\n   * 'bottom' | 'bottom-start' | 'bottom-end' |\r\n   * 'left' | 'left-start' | 'left-end' |\r\n   * 'auto' | 'auto-start' | 'auto-end'\r\n   */\r\n  @Input() tippyPlacement: string | null | undefined;\r\n  @Input() tippyShowDelay: string | number | null | undefined;\r\n\r\n  private tooltip: Instance<Props>;\r\n\r\n  constructor(private elementRef: ElementRef<HTMLElement>) { }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    if (this.tooltip == null) {\r\n      this.tooltip = tippy(this.elementRef.nativeElement, {\r\n        animation: 'scale-subtle',\r\n        arrow: false,\r\n        duration: [100, 50],\r\n        placement: 'bottom',\r\n        theme: '2sxc',\r\n      });\r\n    }\r\n\r\n    if (changes['tippy'] != null) {\r\n      this.tooltip.setContent(this.tippy);\r\n    }\r\n\r\n    if (changes['tippyDisabled'] != null) {\r\n      if (this.tippyDisabled) {\r\n        this.tooltip.disable();\r\n      } else {\r\n        this.tooltip.enable();\r\n      }\r\n    }\r\n\r\n    if (changes['tippyPlacement'] != null) {\r\n      this.tooltip.setProps({ placement: this.tippyPlacement as Placement });\r\n    }\r\n\r\n    if (changes['tippyShowDelay'] != null) {\r\n      const showDelay = typeof this.tippyShowDelay === 'number' ? this.tippyShowDelay : parseInt(this.tippyShowDelay, 10);\r\n      this.tooltip.setProps({ delay: [showDelay, null] });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.tooltip?.destroy();\r\n  }\r\n}\r\n","import { environment } from '../../../environments/environment';\r\n\r\n/** Console log that doesn't show in Angular production mode */\r\nexport function consoleLogAngular(message?: any, ...optionalParams: any[]) {\r\n  if (environment.production) { return; }\r\n\r\n  console.groupCollapsed(message, ...optionalParams);\r\n  // tslint:disable-next-line:no-console\r\n  console.trace();\r\n  console.groupEnd();\r\n}\r\n","import { JsInfo } from '@2sic.com/2sxc-typings';\r\nimport { DialogContextApp } from '../models/dialog-context.models';\r\nimport { EavWindow } from '../models/eav-window.model';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n/**\r\n * This ensures that $2sxc is fully initialized with parameters which are provided later on\r\n * The appApi is being added in v12\r\n * It's important because in Oqtane the app-api root is different in from the normal admin-apis\r\n */\r\nexport function UpdateEnvVarsFromDialogSettings(appContext: DialogContextApp): void {\r\n  try {\r\n    const includedApiRoot = appContext?.Api;\r\n    if (!includedApiRoot) { return; }\r\n\r\n    const old2sxcHeader = (window.$2sxc.env as any).header as JsInfo;\r\n    const new2sxcHeader = { ...old2sxcHeader, appApi: includedApiRoot } as JsInfo;\r\n    window.$2sxc.env.load(new2sxcHeader);\r\n  } catch { /* ignore */ }\r\n}\r\n","import { EavFor } from '../../edit/shared/models/eav';\r\nimport { eavConstants } from '../constants/eav.constants';\r\nimport { EditForm, ItemAddIdentifier, ItemEditIdentifier, ItemIdentifierInbound, ItemIdentifierShared, ItemInListIdentifier } from '../models/edit-form.model';\r\n\r\nconst PREFILL_PREFIX = 'prefill:';\r\nconst GROUP_PREFIX = 'group:';\r\nconst FIELDS_PREFIX = 'fields:';\r\nconst ITEM_SEPARATOR = ',';\r\nconst VAL_SEPARATOR = '&';\r\nconst LIST_SEPARATOR = ':';\r\n\r\nfunction toOrderedParams(values: unknown[]): string {\r\n  return values.join(LIST_SEPARATOR);\r\n}\r\n\r\nexport function convertFormToUrl(form: EditForm) {\r\n  let formUrl = '';\r\n\r\n  for (const item of form.items) {\r\n    // If we already have one, the next must be separated\r\n    if (formUrl) formUrl += ITEM_SEPARATOR;\r\n\r\n    const asGroup = item as ItemInListIdentifier;\r\n    const asItem = item as ItemEditIdentifier;\r\n    const asInboundParams = item as ItemIdentifierInbound;\r\n    const fields = asInboundParams.Fields;\r\n    // Group- or Inner-Item\r\n    if (asGroup.Parent) {\r\n      formUrl += GROUP_PREFIX + toOrderedParams([\r\n        asGroup.Parent,\r\n        asGroup.Field,\r\n        asGroup.Index,\r\n        asGroup.Add,\r\n        asGroup.EntityId\r\n      ]);\r\n      formUrl += prefill2UrlParams(asGroup.Prefill);\r\n      formUrl += fields2UrlParams(fields);\r\n\r\n    } else if (asItem.EntityId) {\r\n      // Edit Item\r\n      formUrl += asItem.EntityId;\r\n\r\n      // New: fields\r\n      formUrl += fields2UrlParams(fields);\r\n\r\n      // 2023-05-11 in edit-id mode, prefill isn't supported, but we want the fields\r\n      // I actually think that prefill should be supported, because it can also transport more parameters\r\n      // formUrl += prefill2UrlParams(groupItem.Prefill, fields);\r\n\r\n    } else if ((item as ItemAddIdentifier).ContentTypeName) {\r\n      // Add Item\r\n      const addItem = item as ItemAddIdentifier;\r\n      formUrl += 'new:' + addItem.ContentTypeName;\r\n\r\n      formUrl += getParamForMetadata(addItem);\r\n      formUrl += prefill2UrlParams(addItem.Prefill);\r\n      formUrl += fields2UrlParams(fields);\r\n\r\n      if (addItem.DuplicateEntity) formUrl += `${VAL_SEPARATOR}copy:` + addItem.DuplicateEntity;\r\n    }\r\n  }\r\n\r\n  return formUrl;\r\n}\r\n\r\nfunction getParamForMetadata(addItem: ItemAddIdentifier) {\r\n  const buildForSuffix = (itemFor: EavFor) => toOrderedParams([\r\n    '', // empty string to ensure it will start with a \":\"\r\n    itemFor.Target,\r\n    itemFor.TargetType,\r\n    (itemFor.Singleton ? itemFor.Singleton.toString() : '')\r\n  ]);\r\n\r\n  if (addItem.For?.String) return `${VAL_SEPARATOR}for:s~` + paramEncode(addItem.For.String) + buildForSuffix(addItem.For);\r\n  if (addItem.For?.Number) return `${VAL_SEPARATOR}for:n~` + addItem.For.Number + buildForSuffix(addItem.For);\r\n  if (addItem.For?.Guid) return `${VAL_SEPARATOR}for:g~` + addItem.For.Guid + buildForSuffix(addItem.For);\r\n  if (addItem.Metadata) return getParamForOldMetadata(addItem);\r\n  return '';\r\n}\r\n\r\nfunction getParamForOldMetadata(addItem: ItemAddIdentifier) {\r\n  let keyType: string;\r\n  switch (addItem.Metadata.keyType.toLocaleLowerCase()) {\r\n    case eavConstants.keyTypes.string:\r\n      keyType = 's';\r\n      break;\r\n    case eavConstants.keyTypes.number:\r\n      keyType = 'n';\r\n      break;\r\n    case eavConstants.keyTypes.guid:\r\n      keyType = 'g';\r\n      break;\r\n  }\r\n  const target = Object.values(eavConstants.metadata)\r\n    .find(m => m.targetType === addItem.Metadata.targetType)?.target;\r\n  return `${VAL_SEPARATOR}for:` + keyType + '~' + toOrderedParams([\r\n    paramEncode(addItem.Metadata.key),\r\n    target,\r\n    addItem.Metadata.targetType\r\n  ]);\r\n}\r\n\r\nfunction prefill2UrlParams(prefill: Record<string, string>) {\r\n  let result = '';\r\n  if (!prefill) return result;\r\n  for (const [key, value] of Object.entries(prefill)) {\r\n    if (value == null) continue;\r\n    result += `${VAL_SEPARATOR}${PREFILL_PREFIX}${key}~${paramEncode(value.toString())}`;\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction prefillFromUrlParams(url: string, addTo: Record<string, string>): Record<string, string> {\r\n  const result = addTo ?? {} as Record<string, string>;\r\n  if (url == null) return result;\r\n  const prefillParams = url.split(LIST_SEPARATOR);\r\n  const key = prefillParams[1].split('~')[0];\r\n  const value = paramDecode(prefillParams[1].split('~')[1]);\r\n  result[key] = value;\r\n  return result;\r\n}\r\n\r\nfunction fields2UrlParams(fields: string) {\r\n  return fields ? `${VAL_SEPARATOR}${FIELDS_PREFIX}${paramEncode(fields)}` : '';\r\n}\r\n\r\nfunction isNumber(maybeNumber: string): boolean {\r\n  // The regex must be re-created for each test\r\n  return /^[0-9]*$/g.test(maybeNumber);\r\n}\r\n\r\nexport function convertUrlToForm(formUrl: string) {\r\n  const form: EditForm = { items: [] };\r\n  const items = formUrl.split(ITEM_SEPARATOR);\r\n\r\n  for (const item of items) {\r\n    if (item.startsWith(GROUP_PREFIX)) {\r\n      // Inner Item / Group Item\r\n      const innerItem = {} as ItemInListIdentifier;\r\n      const options = item.split(VAL_SEPARATOR);\r\n\r\n      for (const option of options) {\r\n        if (option.startsWith(GROUP_PREFIX)) {\r\n          const parms = option.split(LIST_SEPARATOR);\r\n          innerItem.Parent = parms[1];\r\n          innerItem.Field = parms[2];\r\n          innerItem.Index = parseInt(parms[3], 10);\r\n          innerItem.Add = parms[4] === 'true';\r\n          if (parms.length > 4 && parms[5] && isNumber(parms[5]))\r\n            innerItem.EntityId = parseInt(parms[5], 10);\r\n        } else { \r\n          addParamToItemIdentifier(innerItem, option);\r\n        }\r\n      }\r\n      form.items.push(innerItem);\r\n    } else if (isNumber((item ?? '').split(VAL_SEPARATOR)[0])) {\r\n      // Edit Item\r\n      const parts = item.split(VAL_SEPARATOR);\r\n      const editItem: ItemEditIdentifier = { EntityId: parseInt(parts[0], 10) };\r\n      for (const part of parts) {\r\n        addParamToItemIdentifier(editItem, part);\r\n      }\r\n      form.items.push(editItem);\r\n    } else if (item.startsWith('new:')) {\r\n      // Add Item\r\n      const addItem = {} as ItemAddIdentifier;\r\n      const options = item.split(VAL_SEPARATOR);\r\n\r\n      for (const option of options) {\r\n        if (option.startsWith('new:')) {\r\n          // Add Item ContentType\r\n          const newParams = option.split(LIST_SEPARATOR);\r\n          addItem.ContentTypeName = newParams[1];\r\n        } else if (option.startsWith('for:')) {\r\n          // Add Item For\r\n          const forParams = option.split(LIST_SEPARATOR);\r\n          const forKeyType = forParams[1].split('~')[0];\r\n          const forKey = forParams[1].split('~')[1];\r\n          const forTarget = forParams[2];\r\n          const forTargetType = parseInt(forParams[3], 10);\r\n          const forSingleton = forParams[4] != null ? forParams[4] === 'true' : undefined;\r\n          addItem.For = {\r\n            Target: forTarget,\r\n            TargetType: forTargetType,\r\n            ...(forKeyType === 'g' && { Guid: forKey }),\r\n            ...(forKeyType === 'n' && { Number: parseInt(forKey, 10) }),\r\n            ...(forKeyType === 's' && { String: paramDecode(forKey) }),\r\n            ...(forSingleton != null && { Singleton: forSingleton }),\r\n          };\r\n        } else if (option.startsWith('copy:')) {\r\n          // Add Item Copy\r\n          const copyParams = option.split(LIST_SEPARATOR);\r\n          addItem.DuplicateEntity = parseInt(copyParams[1], 10);\r\n        } else {\r\n          addParamToItemIdentifier(addItem, option);\r\n        }\r\n      }\r\n      form.items.push(addItem);\r\n    }\r\n  }\r\n  return form;\r\n}\r\n\r\n/** add prefill and filter to url parameters */\r\nfunction addParamToItemIdentifier(item: ItemIdentifierShared, part: string) {\r\n  if (part.startsWith(FIELDS_PREFIX)) {\r\n    const fields = paramDecode(part.split(':')[1]);\r\n    // temp hacky workaround - put it prefill so it's still there after round-trip\r\n    // should later be on the re-added after the round-trip on the Fields property\r\n    item.Prefill = prefillFromUrlParams(part, { fields });\r\n    item.ClientData = { ...item.ClientData, fields };\r\n  } if (part.startsWith(PREFILL_PREFIX)) {\r\n    // Add Item Prefill\r\n    item.Prefill = prefillFromUrlParams(part, item.Prefill);\r\n  }\r\n}\r\n\r\n/** Encodes characters in URL parameter to not mess up routing. Don't forget to decode it! :) */\r\nfunction paramEncode(text: string) {\r\n  return (text ?? '')\r\n    .replace(/\\//g, '%2F')\r\n    .replace(/\\:/g, '%3A')\r\n    .replace(/\\&/g, '%26')\r\n    .replace(/\\~/g, '%7E')\r\n    .replace(/\\,/g, '%2C');\r\n}\r\n\r\n/** Decodes characters in URL parameter */\r\nfunction paramDecode(text: string) {\r\n  return (text ?? '')\r\n    .replace(/%2F/g, '/')\r\n    .replace(/%3A/g, ':')\r\n    .replace(/%26/g, '&')\r\n    .replace(/%7E/g, '~')\r\n    .replace(/%2C/g, ',');\r\n}\r\n","import { Injectable, Optional, SkipSelf } from '@angular/core';\r\nimport { ActivatedRoute, ActivatedRouteSnapshot } from '@angular/router';\r\nimport { keyAppId, keyContentBlockId, keyModuleId, keyZoneId, prefix } from '../constants/session.constants';\r\nimport { consoleLogAngular } from '../helpers/console-log-angular.helper';\r\nimport { EavWindow } from '../models/eav-window.model';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n/** The context provides information */\r\n@Injectable()\r\nexport class Context {\r\n\r\n  /** Id of current context */\r\n  public id: number;\r\n\r\n  /** Determines if the context is ready to use, and everything is initialized */\r\n  public ready = false;\r\n\r\n  /** The parent, for hierarchical lookup */\r\n  private parent: Context;\r\n\r\n  private routeSnapshot: ActivatedRouteSnapshot;\r\n\r\n  /** The current Zone ID */\r\n  get zoneId(): number {\r\n    return this._zoneId || (this._zoneId = this.routeNum(keyZoneId) || this.parent?.zoneId);\r\n  }\r\n  private _zoneId: number;\r\n\r\n  /** The current App ID */\r\n  get appId(): number {\r\n    return (this._appId != null) ? this._appId : (this._appId = this.routeNum(keyAppId) || this.parent?.appId);\r\n  }\r\n  private _appId: number;\r\n\r\n\r\n  /** Tab Id is global */\r\n  get tabId(): number {\r\n    return window.$2sxc.env.page();\r\n  }\r\n\r\n  /** Content Block Id is global */\r\n  get contentBlockId(): number {\r\n    return this._contentBlockId || (this._contentBlockId = this.routeNum(keyContentBlockId) || this.parent?.contentBlockId);\r\n  }\r\n  private _contentBlockId: number;\r\n\r\n  /** Module Id is global */\r\n  get moduleId(): number {\r\n    return this._moduleId || (this._moduleId = this.routeNum(keyModuleId) || this.parent?.moduleId);\r\n  }\r\n  private _moduleId: number;\r\n\r\n  constructor(@Optional() @SkipSelf() parentContext: Context) {\r\n    this.parent = parentContext;\r\n\r\n    // spm NOTE: I've given id to every context to make it easier to follow how things work\r\n    if (!window.contextId) { window.contextId = 0; }\r\n    this.id = window.contextId++;\r\n    consoleLogAngular('Context.constructor', this);\r\n  }\r\n\r\n  /**\r\n   * This is the initializer at entry-componets of modules.\r\n   * It ensures that within that module, the context has the values given by the route\r\n   */\r\n  init(route: ActivatedRoute) {\r\n    this.routeSnapshot = route && route.snapshot;\r\n    this.clearCachedValues();\r\n    this.ready = route != null;\r\n    consoleLogAngular('Context.init', this, route);\r\n  }\r\n\r\n  initRoot() {\r\n    this._zoneId = this.sessionNumber(keyZoneId);\r\n    this._contentBlockId = this.sessionNumber(keyContentBlockId);\r\n    this._moduleId = this.sessionNumber(keyModuleId);\r\n    this._appId = this.sessionNumber(keyAppId);\r\n\r\n    if (!this._zoneId) {\r\n      throw new Error('Context is missing some of the required parameters');\r\n    }\r\n\r\n    this.ready = true;\r\n    consoleLogAngular('Context.initRoot', this);\r\n  }\r\n\r\n  private sessionNumber(name: string): number {\r\n    const result = sessionStorage.getItem(name);\r\n    if (result !== null) {\r\n      const num = parseInt(result, 10);\r\n      return isNaN(num) ? null : num;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get a number from the route, or optionally its parents.\r\n   * Returns value in route or null\r\n   */\r\n  private routeNum(name: string): number {\r\n    // catch case where state is null, like when the recursive parent is in use\r\n    if (this.routeSnapshot == null) { return null; }\r\n\r\n    const paramName = name.substring(prefix.length);\r\n    const result = this.routeSnapshot.paramMap.get(paramName);\r\n    if (result !== null) {\r\n      const num = parseInt(result, 10);\r\n      return isNaN(num) ? null : num;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears cached values. Required when one module instance is opened multiple times,\r\n   * e.g. Apps Management -> App Admin for appId 2 -> back -> App Admin for appId 17.\r\n   * Module is reused, and so is context and it contains values for previous appId.\r\n   */\r\n  private clearCachedValues() {\r\n    this._zoneId = null;\r\n    this._appId = null;\r\n    this._contentBlockId = null;\r\n    this._moduleId = null;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { map, ReplaySubject } from 'rxjs';\r\nimport { AppDialogConfigService } from '../../app-administration/services';\r\nimport { FeatureSummary } from '../../features/models/feature-summary.model';\r\nimport { DialogContext } from '../models/dialog-settings.model';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class FeaturesService {\r\n  // new 2dm WIP\r\n  // Provide context information and ensure that previously added data is always available\r\n  private dialogContext$ = new ReplaySubject<DialogContext>(1);\r\n\r\n  constructor() { }\r\n\r\n  loadFromService(configService: AppDialogConfigService) {\r\n    configService.getShared$().subscribe(ds => this.load(ds.Context));\r\n  }\r\n\r\n  load(dialogContext: DialogContext) {\r\n    // new 2dm WIP\r\n    this.dialogContext$.next(dialogContext);\r\n  }\r\n\r\n  // new 2dm WIP\r\n  getAll$() {\r\n    return this.dialogContext$.pipe(map(dc => dc?.Features));\r\n  }\r\n\r\n  // new 2dm WIP\r\n  get$(featureNameId: string) {\r\n    return this.dialogContext$.pipe(\r\n      // tap(f => console.log('2dm', f, featureNameId)),\r\n      map(dc => dc?.Features.find(f => f.NameId === featureNameId))\r\n    );\r\n  }\r\n\r\n  isEnabled$(nameId: string) {\r\n    return this.get$(nameId).pipe(map(f => f?.Enabled ?? false));\r\n  }\r\n}\r\n","export const environment = {\r\n  production: true\r\n};\r\n","// Font-Awesome\r\nimport codeCurly from '!raw-loader!../../assets/icons/code-curly.svg';\r\n\r\n// Material Icons\r\n// import accountCircle from '!raw-loader!@material-design-icons/svg/outlined/account_circle.svg';\r\n// import add from '!raw-loader!@material-design-icons/svg/outlined/add.svg';\r\n// import addCircleOutline from '!raw-loader!@material-design-icons/svg/outlined/add_circle_outline.svg';\r\n// import adjust from '!raw-loader!@material-design-icons/svg/outlined/adjust.svg';\r\n// import appRegistration from '!raw-loader!@material-design-icons/svg/outlined/app_registration.svg';\r\n// import arrowBack from '!raw-loader!@material-design-icons/svg/outlined/arrow_back.svg';\r\n// import arrowDropDown from '!raw-loader!@material-design-icons/svg/outlined/arrow_drop_down.svg';\r\n// import arrowDropUp from '!raw-loader!@material-design-icons/svg/outlined/arrow_drop_up.svg';\r\n// import bolt from '!raw-loader!@material-design-icons/svg/outlined/bolt.svg';\r\n// import bugReport from '!raw-loader!@material-design-icons/svg/outlined/bug_report.svg';\r\n// import cached from '!raw-loader!@material-design-icons/svg/outlined/cached.svg';\r\n// import cancel from '!raw-loader!@material-design-icons/svg/outlined/cancel.svg';\r\n// import check from '!raw-loader!@material-design-icons/svg/outlined/check.svg';\r\n// import checkBox from '!raw-loader!@material-design-icons/svg/outlined/check_box.svg';\r\n// import checkBoxOutlineBlank from '!raw-loader!@material-design-icons/svg/outlined/check_box_outline_blank.svg';\r\n// import checkCircle from '!raw-loader!@material-design-icons/svg/outlined/check_circle.svg';\r\n// import checkCircleOutline from '!raw-loader!@material-design-icons/svg/outlined/check_circle_outline.svg';\r\n// import circle from '!raw-loader!@material-design-icons/svg/outlined/circle.svg';\r\n// import clear from '!raw-loader!@material-design-icons/svg/outlined/clear.svg';\r\n// import close from '!raw-loader!@material-design-icons/svg/outlined/close.svg';\r\n// import cloudDownload from '!raw-loader!@material-design-icons/svg/outlined/cloud_download.svg';\r\n// import cloudUpload from '!raw-loader!@material-design-icons/svg/outlined/cloud_upload.svg';\r\n// import code from '!raw-loader!@material-design-icons/svg/outlined/code.svg';\r\n// import copy from '!raw-loader!@material-design-icons/svg/outlined/content_copy.svg';\r\n// import cropFree from '!raw-loader!@material-design-icons/svg/outlined/crop_free.svg';\r\n// import deleteIcon from '!raw-loader!@material-design-icons/svg/outlined/delete.svg';\r\n// import deviceUnknown from '!raw-loader!@material-design-icons/svg/outlined/device_unknown.svg';\r\n// import dialpad from '!raw-loader!@material-design-icons/svg/outlined/dialpad.svg';\r\n// import dns from '!raw-loader!@material-design-icons/svg/outlined/dns.svg';\r\n// import done from '!raw-loader!@material-design-icons/svg/outlined/done.svg';\r\n// import doneAll from '!raw-loader!@material-design-icons/svg/outlined/done_all.svg';\r\n// import downloadForOffline from '!raw-loader!@material-design-icons/svg/outlined/download_for_offline.svg';\r\n// import dragHandle from '!raw-loader!@material-design-icons/svg/outlined/drag_handle.svg';\r\n// import edit from '!raw-loader!@material-design-icons/svg/outlined/edit.svg';\r\n// import editAttributes from '!raw-loader!@material-design-icons/svg/outlined/edit_attributes.svg';\r\n// import emojiObjects from '!raw-loader!@material-design-icons/svg/outlined/emoji_objects.svg';\r\n// import extension from '!raw-loader!@material-design-icons/svg/outlined/extension.svg';\r\n// import fiberManualRecord from '!raw-loader!@material-design-icons/svg/outlined/fiber_manual_record.svg';\r\n// import fileCopy from '!raw-loader!@material-design-icons/svg/outlined/file_copy.svg';\r\n// import filterIcon from '!raw-loader!@material-design-icons/svg/outlined/filter.svg';\r\n// import filterCenterFocus from '!raw-loader!@material-design-icons/svg/outlined/filter_center_focus.svg';\r\n// import filterList from '!raw-loader!@material-design-icons/svg/outlined/filter_list.svg';\r\n// import findInPage from '!raw-loader!@material-design-icons/svg/outlined/find_in_page.svg';\r\n// import formatListNumbered from '!raw-loader!@material-design-icons/svg/outlined/format_list_numbered.svg';\r\n// import foundation from '!raw-loader!@material-design-icons/svg/outlined/foundation.svg';\r\n// import functions from '!raw-loader!@material-design-icons/svg/outlined/functions.svg';\r\n// import help from '!raw-loader!@material-design-icons/svg/outlined/help.svg';\r\n// import helpOutline from '!raw-loader!@material-design-icons/svg/outlined/help_outline.svg';\r\n// import history from '!raw-loader!@material-design-icons/svg/outlined/history.svg';\r\n// import historyToggleOff from '!raw-loader!@material-design-icons/svg/outlined/history_toggle_off.svg';\r\n// import holidayVillage from '!raw-loader!@material-design-icons/svg/outlined/holiday_village.svg';\r\n// import importExport from '!raw-loader!@material-design-icons/svg/outlined/import_export.svg';\r\n// import info from '!raw-loader!@material-design-icons/svg/outlined/info.svg';\r\n// import keyboardArrowDown from '!raw-loader!@material-design-icons/svg/outlined/keyboard_arrow_down.svg';\r\n// import keyboardArrowRight from '!raw-loader!@material-design-icons/svg/outlined/keyboard_arrow_right.svg';\r\n// import keyboardArrowUp from '!raw-loader!@material-design-icons/svg/outlined/keyboard_arrow_up.svg';\r\n// import language from '!raw-loader!@material-design-icons/svg/outlined/language.svg';\r\n// import layers from '!raw-loader!@material-design-icons/svg/outlined/layers.svg';\r\n// import link from '!raw-loader!@material-design-icons/svg/outlined/link.svg';\r\n// import localOffer from '!raw-loader!@material-design-icons/svg/outlined/local_offer.svg';\r\n// import lock from '!raw-loader!@material-design-icons/svg/outlined/lock.svg';\r\n// import lockOpen from '!raw-loader!@material-design-icons/svg/outlined/lock_open.svg';\r\n// import looksOne from '!raw-loader!@material-design-icons/svg/outlined/looks_one.svg';\r\n// import loyalty from '!raw-loader!@material-design-icons/svg/outlined/loyalty.svg';\r\n// import manageSearch from '!raw-loader!@material-design-icons/svg/outlined/manage_search.svg';\r\n// import menu from '!raw-loader!@material-design-icons/svg/outlined/menu.svg';\r\n// import menuBook from '!raw-loader!@material-design-icons/svg/outlined/menu_book.svg';\r\n// import militaryTech from '!raw-loader!@material-design-icons/svg/outlined/military_tech.svg';\r\n// import mobiledataOff from '!raw-loader!@material-design-icons/svg/outlined/mobiledata_off.svg';\r\n// import moreHoriz from '!raw-loader!@material-design-icons/svg/outlined/more_horiz.svg';\r\n// import moreTime from '!raw-loader!@material-design-icons/svg/outlined/more_time.svg';\r\n// import moreVert from '!raw-loader!@material-design-icons/svg/outlined/more_vert.svg';\r\n// import offlineBolt from '!raw-loader!@material-design-icons/svg/outlined/offline_bolt.svg';\r\n// import openInNew from '!raw-loader!@material-design-icons/svg/outlined/open_in_new.svg';\r\n// import permDeviceInformation from '!raw-loader!@material-design-icons/svg/outlined/perm_device_information.svg';\r\n// import person from '!raw-loader!@material-design-icons/svg/outlined/person.svg';\r\n// import playArrow from '!raw-loader!@material-design-icons/svg/outlined/play_arrow.svg';\r\n// import publicIcon from '!raw-loader!@material-design-icons/svg/outlined/public.svg';\r\n// import redeem from '!raw-loader!@material-design-icons/svg/outlined/redeem.svg';\r\n// import restore from '!raw-loader!@material-design-icons/svg/outlined/restore.svg';\r\n// import save from '!raw-loader!@material-design-icons/svg/outlined/save.svg';\r\n// import search from '!raw-loader!@material-design-icons/svg/outlined/search.svg';\r\n// import settings from '!raw-loader!@material-design-icons/svg/outlined/settings.svg';\r\n// import settingsApplications from '!raw-loader!@material-design-icons/svg/outlined/settings_applications.svg';\r\n// import share from '!raw-loader!@material-design-icons/svg/outlined/share.svg';\r\n// import sort from '!raw-loader!@material-design-icons/svg/outlined/sort.svg';\r\n// import speed from '!raw-loader!@material-design-icons/svg/outlined/speed.svg';\r\n// import star from '!raw-loader!@material-design-icons/svg/outlined/star.svg';\r\n// import starBorder from '!raw-loader!@material-design-icons/svg/outlined/star_border.svg';\r\n// import starOutline from '!raw-loader!@material-design-icons/svg/outlined/star_outline.svg';\r\n// import stickyNote2 from '!raw-loader!@material-design-icons/svg/outlined/sticky_note_2.svg';\r\n// import textFields from '!raw-loader!@material-design-icons/svg/outlined/text_fields.svg';\r\n// import today from '!raw-loader!@material-design-icons/svg/outlined/today.svg';\r\n// import toggleOn from '!raw-loader!@material-design-icons/svg/outlined/toggle_on.svg';\r\n// import translate from '!raw-loader!@material-design-icons/svg/outlined/translate.svg';\r\n// import tune from '!raw-loader!@material-design-icons/svg/outlined/tune.svg';\r\n// import visibility from '!raw-loader!@material-design-icons/svg/outlined/visibility.svg';\r\n// import visibilityOff from '!raw-loader!@material-design-icons/svg/outlined/visibility_off.svg';\r\n// import warning from '!raw-loader!@material-design-icons/svg/outlined/warning.svg';\r\n// import warningOutline from '!raw-loader!@material-design-icons/svg/outlined/warning_amber.svg';\r\n// import wavingHand from '!raw-loader!@material-design-icons/svg/outlined/waving_hand.svg';\r\n\r\n// TODO: @SDV\r\n// This isn't quite done yet\r\n// Problem: it's easy to\r\n// - mis-type the icon name in code\r\n// - easy to miss when an icon isn't actually used any more, because all references are strings\r\n//\r\n// Solution\r\n// - Create an object with all the icon names - see export `icons`\r\n// - always use that to reference the names\r\n// - it's ok if the names are then not kebab-case, we can use warningOutline for example, because we always use the constant to reference it\r\n//\r\n// TODO: to finish\r\n// 1. Move all icons to the icons-lib\r\n// 2. change all references to use that constant\r\n\r\nexport const iconsMaterial: Record<string, string> = {\r\n  // 'account-circle': accountCircle,\r\n  // add,\r\n  // 'add-circle-outline': addCircleOutline,\r\n  // adjust,\r\n  // // warning: was app-regostration before!\r\n  // 'app-registration': appRegistration,\r\n  // 'arrow-back': arrowBack,\r\n  // 'arrow-drop-down': arrowDropDown,\r\n  // 'arrow-drop-up': arrowDropUp,\r\n  // bolt,\r\n  // 'bug-report': bugReport,\r\n  // cached,\r\n  // cancel,\r\n  // check,\r\n  // 'check-box': checkBox,\r\n  // 'check-box-outline-blank': checkBoxOutlineBlank,\r\n  // 'check-circle': checkCircle,\r\n  // 'check-circle-outline': checkCircleOutline,\r\n  // circle,\r\n  // clear,\r\n  // close,\r\n  // 'cloud-download': cloudDownload,\r\n  // 'cloud-upload': cloudUpload,\r\n  // code,\r\n  // 'crop-free': cropFree,\r\n  // // tslint:disable-next-line: object-literal-key-quotes\r\n  // 'delete': deleteIcon,\r\n  // 'device-unknown': deviceUnknown,\r\n  // dialpad,\r\n  // dns,\r\n  // 'done-all': doneAll,\r\n  // done,\r\n  // 'download-for-offline': downloadForOffline,\r\n  // 'drag-handle': dragHandle,\r\n  // edit,\r\n  // 'edit-attributes': editAttributes,\r\n  // 'emoji-objects': emojiObjects,\r\n  // extension,\r\n  // 'fiber-manual-record': fiberManualRecord,\r\n  // 'file-copy': fileCopy,\r\n  // filter: filterIcon,\r\n  // 'filter-center-focus': filterCenterFocus,\r\n  // 'filter-list': filterList,\r\n  // 'find-in-page': findInPage,\r\n  // 'format-list-numbered': formatListNumbered,\r\n  // foundation,\r\n  // functions,\r\n  // help,\r\n  // 'help-outline': helpOutline,\r\n  // history,\r\n  // 'history-toggle-off': historyToggleOff,\r\n  // 'holiday-village': holidayVillage,\r\n  // 'import-export': importExport,\r\n  // info,\r\n  // 'keyboard-arrow-down': keyboardArrowDown,\r\n  // 'keyboard-arrow-right': keyboardArrowRight,\r\n  // 'keyboard-arrow-up': keyboardArrowUp,\r\n  // language,\r\n  // layers,\r\n  // link,\r\n  // 'local-offer': localOffer,\r\n  // 'looks-one': looksOne,\r\n  // lock,\r\n  // 'lock-open': lockOpen,\r\n  // loyalty,\r\n  // 'manage-search': manageSearch,\r\n  // 'menu-book': menuBook,\r\n  // menu,\r\n  // 'military-tech': militaryTech,\r\n  // 'mobiledata-off': mobiledataOff,\r\n  // 'more-horiz': moreHoriz,\r\n  // 'more-time': moreTime,\r\n  // 'more-vert': moreVert,\r\n  // 'offline-bolt': offlineBolt,\r\n  // 'open-in-new': openInNew,\r\n  // 'perm-device-information': permDeviceInformation,\r\n  // person,\r\n  // 'play-arrow': playArrow,\r\n  // // tslint:disable-next-line: object-literal-key-quotes\r\n  // 'public': publicIcon,\r\n  // redeem,\r\n  // restore,\r\n  // save,\r\n  // search,\r\n  // settings,\r\n  // 'settings-applications': settingsApplications,\r\n  // share,\r\n  // sort,\r\n  // speed,\r\n  // star,\r\n  // 'star-border': starBorder,\r\n  // 'star-outline': starOutline,\r\n  // 'sticky-note-2': stickyNote2,\r\n  // 'visibility-off': visibilityOff,\r\n  // 'text-fields': textFields,\r\n  // today,\r\n  // 'toggle-on': toggleOn,\r\n  // translate,\r\n  // tune,\r\n  // visibility,\r\n  // warning,\r\n  // 'waving-hand': wavingHand,\r\n};\r\n\r\n// 2dm: New object based icon-library\r\n// to improve constant use of icon names\r\nexport const iconLib = {\r\n  // copy,\r\n  // note: stickyNote2,\r\n  // starBorder,\r\n  // warning,\r\n  // warningOutline,\r\n};\r\n\r\n/**\r\n * Icon names object - to use icon-names as constants across code\r\n * and therefore ensure that we don't mistype the icon names\r\n */\r\nexport const icons = Object.keys(iconLib).reduce((a, v) => ({ ...a, [v]: v}), {}) as unknown as typeof iconLib;\r\n\r\nexport const iconsFontAwesome: Record<string, string> = {\r\n  'code-curly': codeCurly,\r\n};\r\n\r\n// console.warn('test 2dm');\r\n// console.log('icon:', icons.note, icons.warning, icons.warningOutline);\r\n","export default \"<svg width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\r\\n<path d=\\\"M2.98187 13.2188C3.38292 13.2083 3.70844 13.1016 3.95844 12.8984C4.21365 12.6901 4.38292 12.4062 4.46625 12.0469C4.54958 11.6875 4.59385 11.0729 4.59906 10.2031C4.60427 9.33333 4.6199 8.76042 4.64594 8.48438C4.69281 8.04688 4.77875 7.69531 4.90375 7.42969C5.03396 7.16406 5.19281 6.95312 5.38031 6.79688C5.56781 6.63542 5.8074 6.51302 6.09906 6.42969C6.29698 6.3776 6.6199 6.35156 7.06781 6.35156H7.50531V7.57812H7.26312C6.72146 7.57812 6.36208 7.67708 6.185 7.875C6.00792 8.06771 5.91937 8.5026 5.91937 9.17969C5.91937 10.5443 5.89073 11.4062 5.83344 11.7656C5.73969 12.3229 5.57823 12.7526 5.34906 13.0547C5.1251 13.3568 4.77094 13.625 4.28656 13.8594C4.85948 14.099 5.27354 14.4661 5.52875 14.9609C5.78917 15.4505 5.91937 16.2552 5.91937 17.375C5.91937 18.3906 5.92979 18.9948 5.95062 19.1875C5.99229 19.5417 6.09646 19.7891 6.26312 19.9297C6.435 20.0703 6.76833 20.1406 7.26312 20.1406H7.50531V21.3672H7.06781C6.5574 21.3672 6.1876 21.3255 5.95844 21.2422C5.6251 21.1224 5.34906 20.9271 5.13031 20.6562C4.91156 20.3906 4.76833 20.0521 4.70062 19.6406C4.63812 19.2292 4.60427 18.5547 4.59906 17.6172C4.59385 16.6797 4.54958 16.0312 4.46625 15.6719C4.38292 15.3125 4.21365 15.0286 3.95844 14.8203C3.70844 14.612 3.38292 14.5026 2.98187 14.4922V13.2188ZM8.05344 18V16.3984H9.655V18H8.05344ZM11.2266 18V16.3984H12.8281V18H11.2266ZM14.3997 18V16.3984H16.0012V18H14.3997ZM21.0103 13.2188V14.4922C20.6093 14.5026 20.2811 14.612 20.0259 14.8203C19.7759 15.0286 19.6093 15.3125 19.5259 15.6719C19.4426 16.026 19.3983 16.638 19.3931 17.5078C19.3879 18.3776 19.3723 18.9505 19.3462 19.2266C19.2994 19.6693 19.2108 20.0208 19.0806 20.2812C18.9556 20.5469 18.7994 20.7578 18.6119 20.9141C18.4244 21.0755 18.1848 21.1979 17.8931 21.2812C17.6952 21.3385 17.3723 21.3672 16.9244 21.3672H16.4869V20.1406H16.7291C17.2707 20.1406 17.6301 20.0417 17.8072 19.8438C17.9843 19.651 18.0728 19.2135 18.0728 18.5312C18.0728 17.2292 18.0962 16.4036 18.1431 16.0547C18.2265 15.4766 18.3931 15.0156 18.6431 14.6719C18.8931 14.3229 19.2473 14.0521 19.7056 13.8594C19.1067 13.5729 18.6848 13.1953 18.44 12.7266C18.1952 12.2526 18.0728 11.4557 18.0728 10.3359C18.0728 9.32031 18.0598 8.71354 18.0337 8.51562C17.9973 8.16667 17.8931 7.92448 17.7212 7.78906C17.5546 7.64844 17.2239 7.57812 16.7291 7.57812H16.4869V6.35156H16.9244C17.4348 6.35156 17.8046 6.39323 18.0337 6.47656C18.3671 6.59115 18.6431 6.78385 18.8619 7.05469C19.0806 7.32552 19.2212 7.66667 19.2837 8.07812C19.3515 8.48958 19.3879 9.16406 19.3931 10.1016C19.3983 11.0391 19.4426 11.6875 19.5259 12.0469C19.6093 12.401 19.7759 12.6823 20.0259 12.8906C20.2811 13.099 20.6093 13.2083 21.0103 13.2188Z\\\"/>\\r\\n</svg>\\r\\n\";","import { Injectable } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { iconLib, iconsFontAwesome, iconsMaterial } from '.';\r\n\r\n\r\n@Injectable()\r\nexport class AppIconsService {\r\n  constructor(private matIconRegistry: MatIconRegistry, private domSanitizer: DomSanitizer) { }\r\n\r\n  load() {\r\n    this.matIconRegistry.setDefaultFontSetClass('material-icons-outlined');\r\n\r\n    Object.entries(iconsFontAwesome).forEach(([name, svg]) => {\r\n      this.matIconRegistry.addSvgIconLiteral(name, this.domSanitizer.bypassSecurityTrustHtml(svg));\r\n    });\r\n    // Object.entries(iconsMaterial).forEach(([name, svg]) => {\r\n    //   this.matIconRegistry.addSvgIconLiteral(name, this.domSanitizer.bypassSecurityTrustHtml(svg));\r\n    // });\r\n\r\n    // 2dm: New api with object syntax\r\n    // Object.entries(iconLib).forEach(([name, svg]) => {\r\n    //   this.matIconRegistry.addSvgIconLiteral(name, this.domSanitizer.bypassSecurityTrustHtml(svg));\r\n    // });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { editRoot, refreshEditRoot } from './edit/edit.matcher';\r\n\r\nconst appRoutes: Routes = [\r\n  {\r\n    path: ':zoneId/apps',\r\n    loadChildren: () => import('./apps-management/apps-management.module').then(m => m.AppsManagementModule),\r\n    data: { title: 'Apps' },\r\n  },\r\n  {\r\n    path: ':zoneId/import',\r\n    loadChildren: () => import('./import-app/import-app.module').then(m => m.ImportAppModule),\r\n    data: { title: 'Import App' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/app',\r\n    loadChildren: () => import('./app-administration/app-administration.module').then(m => m.AppAdministrationModule),\r\n    data: { title: 'App' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/code',\r\n    loadChildren: () => import('./code-editor/code-editor.module').then(m => m.CodeEditorModule),\r\n    data: { title: 'Code Editor' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/query/:pipelineId',\r\n    loadChildren: () => import('./visual-query/visual-query.module').then(m => m.VisualQueryModule),\r\n    data: { title: 'Visual Query' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/:guid/:part/:index/replace',\r\n    loadChildren: () => import('./replace-content/replace-content.module').then(m => m.ReplaceContentModule),\r\n    data: { title: 'Apps' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/:guid/:part/:index/reorder',\r\n    loadChildren: () => import('./manage-content-list/manage-content-list.module').then(m => m.ManageContentListModule),\r\n    data: { title: 'Reorder Items' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/items/:contentTypeStaticName',\r\n    loadChildren: () => import('./content-items/content-items.module').then(m => m.ContentItemsModule),\r\n    data: { title: 'Items' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/fields/:contentTypeStaticName',\r\n    loadChildren: () => import('./content-type-fields/content-type-fields.module').then(m => m.ContentTypeFieldsModule),\r\n    data: { title: 'Fields' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/versions/:itemId',\r\n    loadChildren: () => import('./item-history/item-history.module').then(m => m.ItemHistoryModule),\r\n  },\r\n  {\r\n    matcher: editRoot,\r\n    loadChildren: () => import('./edit/edit.module').then(m => m.EditModule),\r\n    data: { title: 'Edit Item' },\r\n  },\r\n  {\r\n    matcher: refreshEditRoot,\r\n    loadChildren: () => import('./edit/refresh-edit.module').then(m => m.RefreshEditModule)\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(appRoutes, { relativeLinkResolution: 'legacy' })],\r\n  exports: [RouterModule]\r\n})\r\nexport class AppRoutingModule { }\r\n","import { Context as DnnContext, DnnAppComponent } from '@2sic.com/dnn-sxc-angular';\r\nimport { ChangeDetectionStrategy, Component, ElementRef, OnDestroy, OnInit } from '@angular/core';\r\nimport { Title } from '@angular/platform-browser';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport { filter, map, Subscription } from 'rxjs';\r\nimport { AppIconsService } from './shared/icons/app-icons.service';\r\nimport { keyContentBlockId, keyModuleId } from './shared/constants/session.constants';\r\nimport { Context } from './shared/services/context';\r\n\r\n\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class AppComponent extends DnnAppComponent implements OnInit, OnDestroy {\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    el: ElementRef,\r\n    dnnContext: DnnContext,\r\n    private context: Context,\r\n    private titleService: Title,\r\n    private router: Router,\r\n    private activatedRoute: ActivatedRoute,\r\n    private appIconsService: AppIconsService,\r\n  ) {\r\n    super(\r\n      el,\r\n      dnnContext.preConfigure({\r\n        moduleId: parseInt(sessionStorage.getItem(keyModuleId) || '-1234', 10),\r\n        contentBlockId: parseInt(sessionStorage.getItem(keyContentBlockId) || '-1234', 10),\r\n      }),\r\n    );\r\n    this.context.initRoot();\r\n    this.appIconsService.load();\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Mostly copied from https://blog.bitsrc.io/dynamic-page-titles-in-angular-98ce20b5c334\r\n    // Routes need a data: { title: '...' } for this to work\r\n    const appTitle = this.titleService.getTitle(); // initial title when loading the page\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        map(() => {\r\n          let child = this.activatedRoute.firstChild;\r\n          while (child?.firstChild) {\r\n            child = child.firstChild;\r\n          }\r\n          if (child?.snapshot.data['title']) {\r\n            return child.snapshot.data['title'];\r\n          }\r\n          return appTitle;\r\n        }),\r\n      ).subscribe((title: string) => {\r\n        this.titleService.setTitle(title);\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscription.unsubscribe();\r\n  }\r\n}\r\n","<router-outlet></router-outlet>\r\n","import { Action, ActionReducer, ActionReducerMap, MetaReducer, } from '@ngrx/store';\r\nimport { environment } from '../../../../../environments/environment';\r\nimport { consoleLogAngular } from '../../../../shared/helpers/console-log-angular.helper';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface EavState {\r\n}\r\n\r\n/** Console log all actions */\r\nexport function logger(reducer: ActionReducer<EavState>): ActionReducer<EavState> {\r\n  return (state: EavState, action: Action): EavState => {\r\n    consoleLogAngular('[STORE] state:', state, 'action:', action);\r\n    return reducer(state, action);\r\n  };\r\n}\r\n\r\n/**\r\n * By default, @ngrx/store uses combineReducers with the reducer map to compose\r\n * the root meta-reducer. To add more meta-reducers, provide an array of meta-reducers\r\n * that will be composed to form the root meta-reducer.\r\n */\r\nexport const metaReducers: MetaReducer[] = !environment.production\r\n  ? [logger]\r\n  : [];\r\n\r\nexport const reducers: ActionReducerMap<EavState> = {\r\n};\r\n","import { Injector } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { UrlHelpers } from './edit/shared/helpers/url.helpers';\r\nimport { DialogTypeConstant, DialogTypeConstants } from './shared/constants/dialog-type.constants';\r\n// tslint:disable-next-line:max-line-length\r\nimport { keyAppId, keyContentType, keyDialog, keyEditFields, keyExtras, keyItems, keyPipelineId, keyUrl, keyZoneId, prefix } from './shared/constants/session.constants';\r\nimport { convertFormToUrl } from './shared/helpers/url-prep.helper';\r\nimport { ExtrasParam } from './shared/models/dialog-url-params.model';\r\nimport { EavWindow } from './shared/models/eav-window.model';\r\nimport { EditForm, ItemEditIdentifier, ItemInListIdentifier } from './shared/models/edit-form.model';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport function paramsInitFactory(injector: Injector): () => void {\r\n  return () => {\r\n    console.log('Setting parameters config and clearing route');\r\n    const eavKeys = Object.keys(sessionStorage).filter(key => key.startsWith(prefix));\r\n    const isParamsRoute = !window.location.hash.startsWith('#/');\r\n    if (isParamsRoute) {\r\n      console.log('Initial route:', window.location.href);\r\n      // clear our part of the session\r\n      for (const key of eavKeys) {\r\n        sessionStorage.removeItem(key);\r\n      }\r\n      sessionStorage.setItem(keyUrl, window.location.href); // save url which opened the dialog\r\n      sessionStorage.setItem(keyDialog, DialogTypeConstants.Edit); // set edit dialog as the default\r\n\r\n      // save params\r\n      const urlHash = window.location.hash.substring(1); // substring removes first # char\r\n      const queryParametersFromUrl = UrlHelpers.readQueryStringParameters(urlHash);\r\n\r\n      for (const [paramKey, paramValue] of Object.entries(queryParametersFromUrl)) {\r\n        if (paramValue == null) { continue; }\r\n        sessionStorage.setItem(prefix + paramKey, paramValue);\r\n      }\r\n\r\n      // redirect\r\n      const router = injector.get(Router);\r\n      const zoneId = sessionStorage.getItem(keyZoneId);\r\n      const appId = sessionStorage.getItem(keyAppId);\r\n      const dialog = sessionStorage.getItem(keyDialog) as DialogTypeConstant;\r\n      const contentType = sessionStorage.getItem(keyContentType);\r\n      const items = sessionStorage.getItem(keyItems);\r\n      switch (dialog) {\r\n        case DialogTypeConstants.Zone:\r\n          const extrasZone: ExtrasParam = JSON.parse(sessionStorage.getItem(keyExtras));\r\n          router.navigate([`${zoneId}/apps${extrasZone?.tab ? `/${extrasZone.tab}` : ''}`]);\r\n          break;\r\n        case DialogTypeConstants.Apps:\r\n          router.navigate([`${zoneId}/apps/list`]);\r\n          break;\r\n        case DialogTypeConstants.AppImport:\r\n          router.navigate([`${zoneId}/import`]);\r\n          break;\r\n        case DialogTypeConstants.App:\r\n          const extrasApp: ExtrasParam = JSON.parse(sessionStorage.getItem(keyExtras));\r\n          router.navigate([`${zoneId}/${appId}/app${extrasApp?.tab ? `/${extrasApp.tab}` : ''}${extrasApp?.scope ? `/${extrasApp.scope}` : ''}`]);\r\n          break;\r\n        case DialogTypeConstants.ContentType:\r\n          router.navigate([`${zoneId}/${appId}/fields/${contentType}`]);\r\n          break;\r\n        case DialogTypeConstants.ContentItems:\r\n          router.navigate([`${zoneId}/${appId}/items/${contentType}`]);\r\n          break;\r\n        case DialogTypeConstants.Edit:\r\n          const editItems: ItemEditIdentifier[] = JSON.parse(items);\r\n          const form: EditForm = { items: editItems };\r\n          // const fields = sessionStorage.getItem(keyEditFields);\r\n          const formUrl = convertFormToUrl(form);\r\n          router.navigate([`${zoneId}/${appId}/edit/${formUrl}`]);\r\n          break;\r\n        case DialogTypeConstants.ItemHistory:\r\n          const historyItems: ItemEditIdentifier[] = JSON.parse(items);\r\n          router.navigate([`${zoneId}/${appId}/versions/${historyItems[0].EntityId}`]);\r\n          break;\r\n        case DialogTypeConstants.Develop:\r\n          router.navigate([`${zoneId}/${appId}/code`]);\r\n          break;\r\n        case DialogTypeConstants.PipelineDesigner:\r\n          const pipelineId = sessionStorage.getItem(keyPipelineId);\r\n          router.navigate([`${zoneId}/${appId}/query/${pipelineId}`]);\r\n          break;\r\n        case DialogTypeConstants.Replace:\r\n          const repItem = (JSON.parse(items) as ItemInListIdentifier[])[0];\r\n          const rGuid = repItem.Parent;\r\n          const rPart = repItem.Field;\r\n          const rIndex = repItem.Index;\r\n          const add = repItem.Add;\r\n          const queryParams = add ? { add: true } : {};\r\n          router.navigate([`${zoneId}/${appId}/${rGuid}/${rPart}/${rIndex}/replace`], { queryParams });\r\n          break;\r\n        case DialogTypeConstants.InstanceList:\r\n          const grpItem = (JSON.parse(items) as ItemInListIdentifier[])[0];\r\n          const gGuid = grpItem.Parent;\r\n          const gPart = grpItem.Field;\r\n          const gIndex = grpItem.Index;\r\n          router.navigate([`${zoneId}/${appId}/${gGuid}/${gPart}/${gIndex}/reorder`]);\r\n          break;\r\n        default:\r\n          alert(`Cannot open unknown dialog \"${dialog}\"`);\r\n          try {\r\n            window.parent.$2sxc.totalPopup.close();\r\n          } catch (error) { }\r\n      }\r\n    } else if (eavKeys.length === 0) {\r\n      // if not params route and no params are saved, e.g. browser was reopened, throw error\r\n      alert('Missing required url parameters. Please reopen dialog.');\r\n      throw new Error('Missing required url parameters. Please reopen dialog.');\r\n    } else {\r\n      console.log('Initial route:', sessionStorage.getItem(keyUrl));\r\n    }\r\n  };\r\n}\r\n","import { HttpErrorResponse, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { catchError, Observable, throwError } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class HandleErrorsInterceptor implements HttpInterceptor {\r\n  /** URLs excluded from detailed error alert  */\r\n  private excludedUrls = [\r\n    'dist/ng-edit/i18n',\r\n  ];\r\n\r\n  constructor() { }\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    return next.handle(req).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        if (!this.checkIfExcluded(error.url)) {\r\n          this.showDetailedHttpError(error);\r\n        }\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n\r\n  private checkIfExcluded(url: string) {\r\n    for (const excludedUrl of this.excludedUrls) {\r\n      if (url.includes(excludedUrl)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private showDetailedHttpError(error: HttpErrorResponse) {\r\n    let infoText = 'Had an error talking to the server (status ' + error.status + ').';\r\n    const srvResp = error.error;\r\n    if (srvResp) {\r\n      const msg = srvResp.Message;\r\n      if (msg) { infoText += '\\nMessage: ' + msg; }\r\n      const msgDet = srvResp.MessageDetail || srvResp.ExceptionMessage;\r\n      if (msgDet) { infoText += '\\nDetail: ' + msgDet; }\r\n\r\n      if (msgDet && msgDet.indexOf('No action was found') === 0) {\r\n        if (msgDet.indexOf('that matches the name') > 0) {\r\n          infoText += '\\n\\nTip from 2sxc: you probably got the action-name wrong in your JS.';\r\n        } else if (msgDet.indexOf('that matches the request.') > 0) {\r\n          infoText += '\\n\\nTip from 2sxc: Seems like the parameters are the wrong amount or type.';\r\n        }\r\n      }\r\n\r\n      if (msg && msg.indexOf('Controller') === 0 && msg.indexOf('not found') > 0) {\r\n        infoText += '\\n\\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word \\'controller\\' from the call in JS. To call a controller called \\'DemoController\\' only use \\'Demo\\'.';\r\n      }\r\n      infoText += '\\n\\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug';\r\n    }\r\n\r\n    alert(infoText);\r\n  }\r\n}\r\n","import { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class SetHeadersInterceptor implements HttpInterceptor {\r\n\r\n  constructor() { }\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    let modified: HttpRequest<any>;\r\n    if (req.body instanceof FormData) {\r\n      // sending files. Do not set content type so browser can add delimiter boundary automatically\r\n      return next.handle(req);\r\n    } else {\r\n      modified = req.clone({\r\n        setHeaders: {\r\n          'Content-Type': 'application/json;charset=UTF-8',\r\n        }\r\n      });\r\n      return next.handle(modified);\r\n    }\r\n  }\r\n}\r\n","import { DnnInterceptor } from '@2sic.com/dnn-sxc-angular';\r\nimport { HashLocationStrategy, LocationStrategy } from '@angular/common';\r\nimport { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { APP_INITIALIZER, Injector, NgModule } from '@angular/core';\r\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\r\nimport { BrowserModule, Title } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { EntityDataModule } from '@ngrx/data';\r\nimport { EffectsModule } from '@ngrx/effects';\r\nimport { StoreModule } from '@ngrx/store';\r\nimport { StoreDevtoolsModule } from '@ngrx/store-devtools';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { AppIconsService } from './shared/icons/app-icons.service';\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\nimport { metaReducers, reducers } from './edit/shared/store';\r\nimport { entityConfig } from './edit/shared/store/ngrx-data';\r\nimport { paramsInitFactory } from './params-init.factory';\r\nimport { HandleErrorsInterceptor } from './shared/interceptors/handle-errors.interceptor';\r\nimport { SetHeadersInterceptor } from './shared/interceptors/set-headers.interceptor';\r\nimport { Context } from './shared/services/context';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppComponent,\r\n  ],\r\n  imports: [\r\n    AppRoutingModule,\r\n    BrowserModule,\r\n    HttpClientModule,\r\n    BrowserAnimationsModule,\r\n    StoreModule.forRoot(reducers, { metaReducers, runtimeChecks: { strictStateImmutability: true, strictActionImmutability: true } }),\r\n    EffectsModule.forRoot([]),\r\n    StoreDevtoolsModule.instrument({ maxAge: 25 }),\r\n    EntityDataModule.forRoot(entityConfig),\r\n    TranslateModule.forRoot(),\r\n    MatSnackBarModule,\r\n  ],\r\n  providers: [\r\n    { provide: APP_INITIALIZER, useFactory: paramsInitFactory, deps: [Injector], multi: true },\r\n    { provide: LocationStrategy, useClass: HashLocationStrategy },\r\n    DnnInterceptor,\r\n    { provide: HTTP_INTERCEPTORS, useClass: SetHeadersInterceptor, multi: true },\r\n    { provide: HTTP_INTERCEPTORS, useClass: HandleErrorsInterceptor, multi: true },\r\n    Context,\r\n    Title,\r\n    AppIconsService,\r\n  ],\r\n  bootstrap: [AppComponent],\r\n})\r\nexport class AppModule { }\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic().bootstrapModule(AppModule)\r\n  .catch(err => console.error(err));\r\n"],"sourceRoot":"webpack:///","file":"main.cc40329fa94802f2.js"}