"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_metadata_metadata_component_ts","projects_eav-ui_src_app_shared_directives_click-stop-propagation_directive_ts"],{533:(P,v,e)=>{e.d(v,{m:()=>O});var r=e(604),u=e(7488),d=e(8600),y=e(6698),p=e(6028),o=e(9244),_=e(316),I=e(6936),C=e(4896),h=e(1332);let O=(()=>{class t extends _.o{constructor(l,T,G,$){super(new I.W("AppDialogConfigService",!1)),this.http=l,this.context=T,this.globalConfigService=G,this.dialogSettings$={},this.log.add("using context #",this.context.log.svcId),$.loadFromService(this)}ngOnDestroy(){super.destroy()}getCurrent$(){const l=this.context.appId;return this.log.add("getCurrent$","appId",l),this.getShared$(l)}getSitePrimaryApp$(){return this.getCurrent$().pipe((0,r.k)(l=>l?.Context.Site.PrimaryApp))}getGlobalPrimaryApp$(){return this.getCurrent$().pipe((0,r.k)(l=>l?.Context.System.PrimaryApp))}getShared$(l){return this.log.add("getShared$","appId",l),this.dialogSettings$[l]??=this.getDialogSettings(l,"getShared$").pipe((0,u.C)({refCount:!1})),this.dialogSettings$[l]}getDialogSettings(l,T){return this.log.add("getDialogSettings","appId",l,"reqBy",T),this.http.get("admin/dialog/settings",{params:{appId:l??this.context.appId.toString()}}).pipe((0,r.k)(G=>(G.Context.Language.List=G.Context.Language.List.filter($=>$.IsEnabled),G)),(0,d.y)(G=>{this.globalConfigService.allowDebug(G.Context.Enable.DebugMode)}))}static#t=this.\u0275fac=function(T){return new(T||t)(C.CoB(h.KK),C.CoB(p.e),C.CoB(y.Sq),C.CoB(o.E))};static#e=this.\u0275prov=C.wxM({token:t,factory:t.\u0275fac})}return t})()},6964:(P,v,e)=>{e.d(v,{M:()=>o});var r=e(6028),u=e(9644),d=e(4896),y=e(1332),p=e(3392);let o=(()=>{class _{constructor(C,h,f){this.http=C,this.context=h,this.dnnContext=f}getContentInfo(C){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(u._+"Get"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),scope:C}})}exportParts(C,h,f){const c=this.dnnContext.$2sxc.http.apiUrl(u._+"Export")+"?appId="+this.context.appId.toString()+"&zoneId="+this.context.zoneId.toString()+"&contentTypeIdsString="+C.join(";")+"&entityIdsString="+h.join(";")+"&templateIdsString="+f.join(";");window.open(c,"_blank","")}static#t=this.\u0275fac=function(h){return new(h||_)(d.CoB(y.KK),d.CoB(r.e),d.CoB(p.es))};static#e=this.\u0275prov=d.wxM({token:_,factory:_.\u0275fac})}return _})()},6503:(P,v,e)=>{e.d(v,{S:()=>o});var r=e(5343),u=e(6028),d=e(4896),y=e(1332),p=e(3392);let o=(()=>{class _{constructor(C,h,f){this.http=C,this.context=h,this.dnnContext=f}getAppInfo(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(r.i+"Statistics"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}exportApp(C,h){const f=this.dnnContext.$2sxc.http.apiUrl(r.i+"Export")+"?appId="+this.context.appId+"&zoneId="+this.context.zoneId+"&includeContentGroups="+C+"&resetAppGuid="+h;window.open(f,"_blank","")}exportForVersionControl({includeContentGroups:C,resetAppGuid:h,withFiles:f}){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(r.i+"SaveData"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),includeContentGroups:C.toString(),resetAppGuid:h.toString(),withPortalFiles:f.toString()}})}static#t=this.\u0275fac=function(h){return new(h||_)(d.CoB(y.KK),d.CoB(u.e),d.CoB(p.es))};static#e=this.\u0275prov=d.wxM({token:_,factory:_.\u0275fac})}return _})()},9644:(P,v,e)=>{e.d(v,{M:()=>_,_:()=>o});var r=e(5343),u=e(6028),d=e(4896),y=e(1332),p=e(3392);const o="admin/appParts/";let _=(()=>{class I{constructor(h,f,c){this.http=h,this.context=f,this.dnnContext=c}importAppParts(h){const f=new FormData;return f.append("File",h),this.http.post(this.dnnContext.$2sxc.http.apiUrl(o+"Import"),f,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}resetApp(h){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(r.i+"Reset"),{},{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),withPortalFiles:h.toString()}})}static#t=this.\u0275fac=function(f){return new(f||I)(d.CoB(y.KK),d.CoB(u.e),d.CoB(p.es))};static#e=this.\u0275prov=d.wxM({token:I,factory:I.\u0275fac})}return I})()},8112:(P,v,e)=>{e.d(v,{K0:()=>o.K0,Xi:()=>u.X,cV:()=>o.cV,fn:()=>o.fn,kN:()=>o.kN,kX:()=>o.kX,mK:()=>r.m,ot:()=>o.ot,sj:()=>_.s});var r=e(533),u=e(692),o=(e(6964),e(6503),e(9644),e(900)),_=e(7184)},900:(P,v,e)=>{e.d(v,{K0:()=>T,cV:()=>t,fn:()=>g,kN:()=>l,kX:()=>G,ot:()=>O});var r=e(9616),u=e(9432),d=e(604),y=e(4172),p=e(616),o=e(6028),_=e(4896),I=e(1332),C=e(3392);const O="admin/query/Run",t="admin/query/DebugStream",g="admin/query/Save",l="admin/query/Get",T="admin/query/DataSources";let G=(()=>{class ${constructor(R,B,M){this.http=R,this.context=B,this.dnnContext=M}getAll(R){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y.U1),{params:{appId:this.context.appId.toString(),contentType:R}})}importQuery(R){return(0,r.Q)((0,p.S)(R)).pipe((0,u.G)(B=>this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/query/import"),{AppId:this.context.appId.toString(),ContentBase64:B})),(0,d.k)(B=>({Success:B,Messages:[]})))}clonePipeline(R){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/query/Clone"),{params:{Id:R.toString(),appId:this.context.appId.toString()}})}delete(R){return this.http.delete(this.dnnContext.$2sxc.http.apiUrl("admin/query/Delete"),{params:{appId:this.context.appId.toString(),Id:R.toString()}})}static#t=this.\u0275fac=function(B){return new(B||$)(_.CoB(I.KK),_.CoB(o.e),_.CoB(C.es))};static#e=this.\u0275prov=_.wxM({token:$,factory:$.\u0275fac})}return $})()},7184:(P,v,e)=>{e.d(v,{s:()=>f});var r=e(6028),u=e(4896),d=e(1332),y=e(3392);const p="admin/view/",o=p+"all",_=p+"delete",I=p+"import",C=p+"polymorphism",h=p+"usage";let f=(()=>{class c{constructor(t,g,l){this.http=t,this.context=g,this.dnnContext=l}getAll(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(o),{params:{appId:this.context.appId.toString()}})}delete(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(_),{params:{appId:this.context.appId.toString(),Id:t.toString()}})}import(t){const g=new FormData;return g.append("File",t),this.http.post(this.dnnContext.$2sxc.http.apiUrl(I),g,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}export(t){const g=this.dnnContext.$2sxc.http.apiUrl(p+"json")+"?appId="+this.context.appId+"&viewId="+t;window.open(g,"_blank","")}getPolymorphism(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(C),{params:{appId:this.context.appId.toString()}})}getUsage(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(h),{params:{appId:this.context.appId.toString(),guid:t}})}static#t=this.\u0275fac=function(g){return new(g||c)(u.CoB(d.KK),u.CoB(r.e),u.CoB(y.es))};static#e=this.\u0275prov=u.wxM({token:c,factory:c.\u0275fac})}return c})()},6036:(P,v,e)=>{e.d(v,{q:()=>f});var r=e(9616),u=e(9432),d=e(604),y=e(3764),p=e(4172),o=e(616),_=e(6028),I=e(4896),C=e(1332),h=e(3392);let f=(()=>{class c{constructor(t,g,l){this.http=t,this.context=g,this.dnnContext=l}getAll(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(p.U1),{params:{appId:this.context.appId.toString(),contentType:t}})}getColumns(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y.yK),{params:{appId:this.context.appId.toString(),staticName:t}})}importItem(t){return(0,r.Q)((0,o.S)(t)).pipe((0,u.G)(g=>this.http.post(this.dnnContext.$2sxc.http.apiUrl(p.ue+"upload"),{AppId:this.context.appId.toString(),ContentBase64:g})),(0,d.k)(g=>({Success:g,Messages:[]})))}static#t=this.\u0275fac=function(g){return new(g||c)(I.CoB(C.KK),I.CoB(_.e),I.CoB(h.es))};static#e=this.\u0275prov=I.wxM({token:c,factory:c.\u0275fac})}return c})()},3572:(P,v,e)=>{e.d(v,{I:()=>p});var r=e(4896),u=e(1332),d=e(3392);let p=(()=>{class o{constructor(I,C){this.http=I,this.dnnContext=C}getFeatureDetails(I){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/feature/details"),{params:{nameId:I}})}static#t=this.\u0275fac=function(C){return new(C||o)(r.CoB(u.KK),r.CoB(d.es))};static#e=this.\u0275prov=r.wxM({token:o,factory:o.\u0275fac})}return o})()},7008:(P,v,e)=>{e.d(v,{C:()=>B});var r=e(9244),u=e(600),d=e(5876),y=e(604),p=e(2556),o=e(4896),_=e(4648),I=e(3572),C=e(4672),h=e(2328),f=e(8512),c=e(8200),O=e(5056),t=e(48),g=e(8752);function l(M,F){if(1&M){const m=o.KQA();o.I0R(0,"div",1)(1,"div",2),o.OEk(2,"ID:"),o.C$Y(),o.I0R(3,"div",8)(4,"span",9),o.qCj("click",function(){const S=o.usT(m),U=o.GaO(2);return o.CGJ(U.copyToClipboard(S))}),o.OEk(5),o.C$Y()()()}2&M&&(o.yG2(4),o.E7m("tippy",F),o.yG2(1),o.cNF(F))}function T(M,F){if(1&M){const m=o.KQA();o.I0R(0,"button",10),o.qCj("click",function(){const S=o.usT(m),U=o.GaO(2);return o.CGJ(U.findOutMore(S))}),o.I0R(1,"mat-icon"),o.OEk(2,"open_in_new"),o.C$Y(),o.OEk(3),o.wVc(4,"translate"),o.C$Y()}2&M&&(o.yG2(3),o.oRS(" ",o.kDX(4,1,"Features.FindOutMore")," "))}function G(M,F){if(1&M){const m=o.KQA();o.I0R(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),o.OEk(3),o.C$Y()(),o.I0R(4,"mat-card-content"),o.wR5(5,"p",0),o.wVc(6,"safeHtml"),o.I0R(7,"div",1)(8,"div",2),o.OEk(9),o.wVc(10,"translate"),o.C$Y(),o.I0R(11,"div",3)(12,"span"),o.OEk(13),o.wVc(14,"translate"),o.C$Y()()(),o.yuY(15,l,6,2,"div",4),o.C$Y(),o.I0R(16,"mat-card-actions",5),o.yuY(17,T,5,3,"button",6),o.I0R(18,"button",7),o.qCj("click",function(){o.usT(m);const A=o.GaO();return o.CGJ(A.closeDialog())}),o.OEk(19),o.wVc(20,"translate"),o.C$Y()()()}if(2&M){let m;o.yG2(3),o.cNF(F.feature.Name),o.yG2(2),o.E7m("innerHtml",o.kDX(6,7,F.feature.Description),o.E3n),o.yG2(4),o.oRS("",o.kDX(10,9,"Features.Status"),":"),o.yG2(4),o.cNF(o.kDX(14,11,F.feature.IsEnabled?"Features.Active":"Features.NotActive")),o.yG2(2),o.C0Y(15,(m=F.feature.NameId)?15:-1,m),o.yG2(2),o.C0Y(17,(m=F.feature.Link)?17:-1,m),o.yG2(2),o.oRS(" ",o.kDX(20,13,"Features.Close")," ")}}let $=(()=>{class M{constructor(m,x,A,S){this.dialogData=m,this.dialogRef=x,this.snackBar=A,this.featureDetailService=S}ngOnInit(){this.viewModel$=(0,d.E)([this.featureDetailService.getFeatureDetails(this.dialogData)]).pipe((0,y.k)(([m])=>({feature:m})))}copyToClipboard(m){(0,p.y)(m),this.snackBar.open("Copied to clipboard",null,{duration:2e3})}findOutMore(m){window.open(m,"_blank")}closeDialog(){this.dialogRef.close()}static#t=this.\u0275fac=function(x){return new(x||M)(o.GI1(u.sR),o.GI1(u.yI),o.GI1(_.yS),o.GI1(I.I))};static#e=this.\u0275cmp=o.In1({type:M,selectors:[["app-feature-info-dialog"]],decls:2,vars:3,consts:[[3,"innerHtml"],[1,"eav-info-row"],[1,"eav-info-row__label"],[1,"eav-info-row__value"],["class","eav-info-row"],["align","end"],["mat-raised-button","","color","accent","class","eav-card-action-button"],["mat-raised-button","",1,"eav-card-action-button",3,"click"],[1,"eav-info-row__value","eav_click"],[3,"tippy","click"],["mat-raised-button","","color","accent",1,"eav-card-action-button",3,"click"]],template:function(x,A){if(1&x&&(o.yuY(0,G,21,15,"mat-card"),o.wVc(1,"async")),2&x){let S;o.C0Y(0,(S=o.kDX(1,1,A.viewModel$))?0:-1,S)}},dependencies:[C.Gw,h.qL,f.SM,f.W0,f.WK,f.Uc,f.gp,c.Y,O.a,t.K,g.sD]})}return M})();var b=e(4844),R=e(9432);let B=(()=>{class M{set featureNameId(m){this.featureNameId$.next(m)}set showIf(m){this.showIf$.next(1==m)}constructor(m,x,A,S){this.dialog=m,this.viewContainerRef=x,this.changeDetectorRef=A,this.featuresService=S,this.featureNameId$=new b.g(null),this.showIf$=new b.g(!1),this.feature$=this.featureNameId$.pipe((0,R.G)(U=>this.featuresService.get$(U))),this.show$=(0,d.E)([this.feature$,this.showIf$]).pipe((0,y.k)(([U,W])=>W==(U?.IsEnabled??!1)))}openDialog(){M.openDialog(this.dialog,this.featureNameId$.value,this.viewContainerRef,this.changeDetectorRef)}static openDialog(m,x,A,S){m.open($,{autoFocus:!1,data:x,viewContainerRef:A,width:"400px"}),S.markForCheck()}static#t=this.\u0275fac=function(x){return new(x||M)(o.GI1(u.qW),o.GI1(o.y8U),o.GI1(o.kD9),o.GI1(r.E))};static#e=this.\u0275dir=o.Sc5({type:M,inputs:{featureNameId:"featureNameId",showIf:"showIf"}})}return M})()},5343:(P,v,e)=>{e.d(v,{i:()=>I,t:()=>C});var r=e(9432),u=e(8916),d=e(8288),y=e(6028),p=e(4896),o=e(1332),_=e(3392);const I="admin/app/";let C=(()=>{class h{constructor(c,O,t){this.http=c,this.context=O,this.dnnContext=t}importApp(c,O,t=!1){const g=new FormData;return g.append("File",c),g.append("Name",O??""),this.http.post(this.dnnContext.$2sxc.http.apiUrl(I+"Import"),g,{params:{zoneId:this.context.zoneId.toString()}}).pipe((0,r.G)(l=>{if(t&&l.Messages[0]?.MessageType===d.cB.Warning){const T=prompt(l.Messages[0].Text+" Would you like to install it using another folder name?");if(T)return this.importApp(c,T,!0)}return(0,u.of)(l)}))}static#t=this.\u0275fac=function(O){return new(O||h)(p.CoB(o.KK),p.CoB(y.e),p.CoB(_.es))};static#e=this.\u0275prov=p.wxM({token:h,factory:h.\u0275fac})}return h})()},1114:(P,v,e)=>{e.r(v),e.d(v,{MetadataComponent:()=>Tt});var r=e(4844),u=e(604),d=e(5876),y=e(7496),p=e(6036),o=e(4328),_=e(2876),I=e(2816),C=e(5760),h=e(1743),f=e(9224),c=e(5396),O=e(600),t=e(4896),g=e(4672),l=e(8512),T=e(48);function G(a,E){if(1&a&&(t.wR5(0,"mat-card-subtitle",0),t.wVc(1,"safeHtml")),2&a){const n=t.GaO();t.E7m("innerHtml",t.kDX(1,1,n.dialogData.message),t.E3n)}}let $=(()=>{class a{constructor(n,i){this.dialogData=n,this.dialogRef=i,this.hostClass="dialog-component"}closeDialog(n){this.dialogRef.close(n)}static#t=this.\u0275fac=function(i){return new(i||a)(t.GI1(O.sR),t.GI1(O.yI))};static#e=this.\u0275cmp=t.In1({type:a,selectors:[["app-confirm-delete-dialog"]],hostVars:1,hostBindings:function(i,s){2&i&&t.SoX("className",s.hostClass)},decls:10,vars:3,consts:[[3,"innerHtml"],["align","end"],["mat-raised-button","",1,"eav-card-action-button",3,"click"]],template:function(i,s){1&i&&(t.I0R(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.OEk(3),t.C$Y(),t.yuY(4,G,2,3,"mat-card-subtitle",0),t.C$Y(),t.I0R(5,"mat-card-actions",1)(6,"button",2),t.qCj("click",function(){return s.closeDialog()}),t.OEk(7,"Cancel"),t.C$Y(),t.I0R(8,"button",2),t.qCj("click",function(){return s.closeDialog(!0)}),t.OEk(9,"Delete"),t.C$Y()()()),2&i&&(t.yG2(3),t.CAO("Delete ",s.dialogData.entityTitle," (",s.dialogData.entityId,")?"),t.yG2(1),t.C0Y(4,s.dialogData.message?4:-1))},dependencies:[g.Gw,l.SM,l.W0,l.Uc,l.uK,l.gp,T.K],styles:[".eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}return a})();var b=e(8200),R=e(2328),B=e(6176);let M=(()=>{class a{agInit(n){this.params=n}refresh(n){return!0}deleteMetadata(){this.params.onDelete(this.params.data)}static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275cmp=t.In1({type:a,selectors:[["app-metadata-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(i,s){1&i&&(t.I0R(0,"div",0)(1,"div",1),t.qCj("click",function(){return s.deleteMetadata()}),t.I0R(2,"mat-icon"),t.OEk(3,"delete"),t.C$Y()()())},dependencies:[b.Y,R.qL,B.UZ]})}return a})(),F=(()=>{class a{agInit(n){this.value=n.value,this.metadata=n.data}refresh(n){return!0}static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275cmp=t.In1({type:a,selectors:[["app-metadata-content-type"]],decls:2,vars:3,consts:[[1,"container",3,"tippy","tippyDisabled"]],template:function(i,s){1&i&&(t.I0R(0,"div",0),t.OEk(1),t.C$Y()),2&i&&(t.E7m("tippy",s.metadata._Type.Description)("tippyDisabled",!s.metadata._Type.Description),t.yG2(1),t.oRS(" ",s.value,"\n"))},dependencies:[b.Y],styles:[".container[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}"]})}return a})();var m=e(1904),x=e(1792),A=e(1484),S=e(8112),U=e(420),W=e(5056),z=e(9084),Q=e(504),k=e(244),X=e(7872),J=e(2536),Z=e(3424);function q(a,E){if(1&a&&(t.I0R(0,"mat-option",14),t.OEk(1),t.C$Y()),2&a){const n=E.$implicit;t.E7m("value",n.value),t.yG2(1),t.oRS(" ",n.name," ")}}function tt(a,E){if(1&a&&(t.I0R(0,"mat-form-field",2)(1,"mat-label"),t.OEk(2,"Scope"),t.C$Y(),t.I0R(3,"mat-select",13),t.c53(4,q,2,2,"mat-option",14,t.oxv),t.I0R(6,"mat-option",14),t.OEk(7,"Other..."),t.C$Y()()(),t.I0R(8,"app-field-hint"),t.OEk(9," The scope should almost never be changed - "),t.I0R(10,"a",15),t.OEk(11,"see help"),t.C$Y()()),2&a){const n=t.GaO(),i=t.GaO();t.yG2(3),t.E7m("placeholder",n.scopeOptions.length?"":"No items found"),t.yG2(1),t.oho(n.scopeOptions),t.yG2(2),t.E7m("value",i.dropdownInsertValue)}}function et(a,E){if(1&a&&(t.I0R(0,"mat-option",14),t.OEk(1),t.C$Y()),2&a){const n=E.$implicit;t.E7m("value",n.StaticName),t.yG2(1),t.oRS(" ",n.Label," ")}}function nt(a,E){if(1&a&&(t.I0R(0,"mat-select",3),t.c53(1,et,2,2,"mat-option",14,t.oxv),t.C$Y()),2&a){const n=t.GaO();t.E7m("placeholder",n.contentTypes.length?"":"No items found"),t.yG2(1),t.oho(n.contentTypes)}}function ot(a,E){1&a&&t.wR5(0,"input",4)}function at(a,E){1&a&&(t.I0R(0,"app-field-hint",8),t.OEk(1," This field is required "),t.C$Y()),2&a&&t.E7m("isError",!0)}const V=a=>({active:a});function it(a,E){if(1&a){const n=t.KQA();t.I0R(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.OEk(3,"Create Metadata"),t.C$Y(),t.I0R(4,"mat-card-subtitle"),t.OEk(5," This is a special operation to add an item which is metadata for another item, see "),t.I0R(6,"a",0),t.OEk(7,"docs"),t.C$Y(),t.OEk(8,". "),t.C$Y()(),t.I0R(9,"mat-card-content")(10,"form",1),t.yuY(11,tt,12,2),t.I0R(12,"mat-form-field",2)(13,"mat-label"),t.OEk(14,"Content Type"),t.C$Y(),t.yuY(15,nt,3,1,"mat-select",3)(16,ot,1,0,"input",4),t.I0R(17,"div",5)(18,"button",6),t.qCj("click",function(){t.usT(n);const s=t.GaO();return t.CGJ(s.toggleGuidedContentType(!0))}),t.I0R(19,"mat-icon"),t.OEk(20,"search"),t.C$Y()(),t.I0R(21,"button",7),t.qCj("click",function(){t.usT(n);const s=t.GaO();return t.CGJ(s.toggleGuidedContentType(!1))}),t.I0R(22,"mat-icon"),t.OEk(23,"text_fields"),t.C$Y()()()(),t.yuY(24,at,2,1,"app-field-hint",8),t.C$Y()(),t.I0R(25,"mat-card-actions",9)(26,"mat-slide-toggle",10),t.qCj("change",function(s){t.usT(n);const D=t.GaO();return t.CGJ(D.toggleAdvancedMode(s))}),t.OEk(27),t.C$Y(),t.I0R(28,"div")(29,"button",11),t.qCj("click",function(){t.usT(n);const s=t.GaO();return t.CGJ(s.closeDialog())}),t.OEk(30,"Cancel"),t.C$Y(),t.I0R(31,"button",12),t.qCj("click",function(){t.usT(n);const s=t.GaO();return t.CGJ(s.confirm())}),t.OEk(32," Confirm "),t.C$Y()()()()}if(2&a){const n=t.GaO();t.yG2(10),t.E7m("formGroup",n.form),t.yG2(1),t.C0Y(11,n.advancedMode&&n.guidedContentType?11:-1),t.yG2(4),t.C0Y(15,n.guidedContentType?15:-1),t.yG2(1),t.C0Y(16,n.guidedContentType?-1:16),t.yG2(2),t.E7m("ngClass",t.S45(10,V,n.guidedContentType)),t.yG2(3),t.E7m("ngClass",t.S45(12,V,!n.guidedContentType)),t.yG2(3),t.C0Y(24,n.form.controls.contentType.touched&&null!=n.form.controls.contentType.errors&&n.form.controls.contentType.errors.required?24:-1),t.yG2(2),t.E7m("checked",n.advancedMode),t.yG2(1),t.oRS(" ",n.advancedMode?"Advanced":"Simple"," "),t.yG2(4),t.E7m("disabled",!n.form.valid)}}let st=(()=>{class a{constructor(n,i){this.dialogRef=n,this.contentTypesService=i,this.hostClass="dialog-component",this.dropdownInsertValue=U.M,this.guidedContentType=!0,this.advancedMode=!1}ngOnInit(){this.contentTypes$=new r.g([]),this.scopeOptions$=new r.g([]),this.buildForm(),this.fetchScopes(),this.viewModel$=(0,d.E)([this.contentTypes$,this.scopeOptions$]).pipe((0,u.k)(([n,i])=>({contentTypes:n,scopeOptions:i})))}ngOnDestroy(){this.contentTypes$.complete(),this.scopeOptions$.complete()}closeDialog(n){this.dialogRef.close(n)}toggleGuidedContentType(n){this.guidedContentType=n}toggleAdvancedMode(n){this.advancedMode=n.checked}confirm(){const n=this.form.getRawValue();this.closeDialog(n.contentType)}buildForm(){this.form=new m.k1({}),this.form.addControl("contentType",new m.yM(null,[m.AQ.required])),this.form.addControl("scope",new m.yM(f._K.scopes.default.value)),this.form.controls.scope.valueChanges.pipe((0,x.W)(this.form.controls.scope.value),(0,A.a)()).subscribe(n=>{null!=this.form.controls.contentType.value&&this.form.controls.contentType.patchValue(null),n===U.M?(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||f._K.scopes.default.value,this.scopeOptions$.value.some(i=>i.value===n)||this.scopeOptions$.next([{name:n,value:n},...this.scopeOptions$.value]),this.form.controls.scope.patchValue(n)):this.fetchContentTypes(n)})}fetchContentTypes(n){this.contentTypesService.retrieveContentTypes(n).subscribe(i=>{this.contentTypes$.next(i)})}fetchScopes(){this.contentTypesService.getScopes().subscribe(n=>{this.scopeOptions$.next(n)})}static#t=this.\u0275fac=function(i){return new(i||a)(t.GI1(O.yI),t.GI1(S.Xi))};static#e=this.\u0275cmp=t.In1({type:a,selectors:[["app-metadata-save-dialog"]],hostVars:1,hostBindings:function(i,s){2&i&&t.SoX("className",s.hostClass)},decls:2,vars:3,consts:[["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",1,"eav-form-field"],["formControlName","contentType","required","",3,"placeholder"],["matInput","","type","text","formControlName","contentType","required",""],["matTextSuffix",""],["mat-icon-button","","type","button","tippy","Pick existing value",3,"ngClass","click"],["mat-icon-button","","type","button","tippy","Manual entry",3,"ngClass","click"],[3,"isError"],[1,"eav-card-actions"],["color","accent",3,"checked","change"],["mat-raised-button","",1,"eav-card-action-button",3,"click"],["mat-raised-button","","color","accent",1,"eav-card-action-button",3,"disabled","click"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""]],template:function(i,s){if(1&i&&(t.yuY(0,it,33,14,"mat-card"),t.wVc(1,"async")),2&i){let D;t.C0Y(0,(D=t.kDX(1,1,s.viewModel$))?0:-1,D)}},dependencies:[W.QF,z.o,Q.c,b.Y,g.Gw,g.um,R.qL,m.sz,m.ot,m.ue,m.u,m.eJ,m.uW,m.Wo,k.Up,k.w5,k.Gm,X.kX,B.I5,J.yi,Z.cP,l.SM,l.W0,l.WK,l.Uc,l.uK,l.gp,W.a],styles:[".eav-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}return a})();var rt=e(7008),ct=e(6936),L=e(9972),w=e(5204),lt=e(4648),dt=e(4072),N=e(4716),pt=e(32);function mt(a,E){1&a&&t.OEk(0," This item is not metadata for anything else. ")}function _t(a,E){if(1&a&&(t.wR5(0,"br"),t.OEk(1)),2&a){const n=t.GaO(2);t.yG2(1),t.oRS("Key Number: ",n.itemFor.KeyNumber," ")}}function ht(a,E){if(1&a&&(t.wR5(0,"br"),t.OEk(1)),2&a){const n=t.GaO(2);t.yG2(1),t.oRS("Key Guid: ",n.itemFor.KeyGuid," ")}}function ut(a,E){if(1&a&&(t.wR5(0,"br"),t.OEk(1)),2&a){const n=t.GaO(2);t.yG2(1),t.oRS("Key String: ",n.itemFor.KeyString," ")}}function Ct(a,E){if(1&a&&(t.wR5(0,"br"),t.OEk(1)),2&a){const n=t.GaO(2);t.yG2(1),t.oRS("Title: ",n.itemFor.Title," ")}}function ft(a,E){if(1&a&&(t.OEk(0," This item is metadata for: "),t.wR5(1,"br"),t.OEk(2),t.wR5(3,"br"),t.OEk(4),t.yuY(5,_t,2,1)(6,ht,2,1)(7,ut,2,1)(8,Ct,2,1)),2&a){const n=t.GaO();t.yG2(2),t.oRS("Target: ",n.itemFor.Target," "),t.yG2(2),t.oRS("TargetType: ",n.itemFor.TargetType," "),t.yG2(1),t.C0Y(5,n.itemFor.KeyNumber?5:-1),t.yG2(1),t.C0Y(6,n.itemFor.KeyGuid?6:-1),t.yG2(1),t.C0Y(7,n.itemFor.KeyString?7:-1),t.yG2(1),t.C0Y(8,n.itemFor.Title?8:-1)}}function gt(a,E){if(1&a){const n=t.KQA();t.I0R(0,"button",11),t.qCj("click",function(){t.usT(n);const s=t.GaO(2);return t.CGJ(s.createMetadata())}),t.I0R(1,"mat-icon"),t.OEk(2,"add"),t.C$Y()()}}function vt(a,E){if(1&a&&(t.wR5(0,"div",20),t.wVc(1,"safeHtml")),2&a){const n=t.GaO().$implicit;t.E7m("innerHTML",t.kDX(1,2,n.Icon),t.E3n)("matBadgeHidden",n.Enabled)}}function It(a,E){1&a&&(t.I0R(0,"mat-icon"),t.OEk(1,"add"),t.C$Y())}function yt(a,E){if(1&a){const n=t.KQA();t.I0R(0,"button",18),t.qCj("click",function(){const D=t.usT(n).$implicit,K=t.GaO(3);return t.CGJ(K.createMetadata(D))}),t.yuY(1,vt,2,4,"div",19)(2,It,2,0),t.C$Y()}if(2&a){const n=E.$implicit;t.e48("label",n.Title),t.yG2(1),t.C0Y(1,n.Icon?1:2)}}const Et=a=>({"fab-opened":a});function Mt(a,E){if(1&a){const n=t.KQA();t.I0R(0,"eco-fab-speed-dial",12),t.qCj("openChange",function(s){t.usT(n);const D=t.GaO(2);return t.CGJ(D.openChange(s))}),t.I0R(1,"eco-fab-speed-dial-trigger",13)(2,"button",14)(3,"mat-icon",15),t.OEk(4),t.C$Y()()(),t.I0R(5,"eco-fab-speed-dial-actions",16)(6,"button",17),t.qCj("click",function(){t.usT(n);const s=t.GaO(2);return t.CGJ(s.createMetadata())}),t.I0R(7,"mat-icon"),t.OEk(8,"search"),t.C$Y()(),t.c53(9,yt,3,2,"button",21,t.oxv),t.C$Y()()}if(2&a){const n=t.GaO();t.E7m("ngClass",t.S45(3,Et,n.fabOpen)),t.yG2(1),t.E7m("spin",!0),t.yG2(3),t.cNF(n.fabOpen?"close":"add"),t.yG2(5),t.oho(n.recommendations)}}function Dt(a,E){if(1&a){const n=t.KQA();t.I0R(0,"div",1)(1,"div",2)(2,"div",3),t.OEk(3),t.C$Y(),t.I0R(4,"button",4),t.qCj("click",function(){t.usT(n);const s=t.GaO();return t.CGJ(s.closeDialog())}),t.I0R(5,"mat-icon"),t.OEk(6,"close"),t.C$Y()()(),t.I0R(7,"div",5)(8,"p"),t.yuY(9,mt,1,0)(10,ft,9,6),t.C$Y(),t.wR5(11,"router-outlet"),t.I0R(12,"div",6),t.wR5(13,"ag-grid-angular",7),t.C$Y()(),t.I0R(14,"mat-dialog-actions",8),t.yuY(15,gt,3,0,"button",9)(16,Mt,11,5,"eco-fab-speed-dial",10),t.C$Y()()}if(2&a){const n=t.GaO();t.yG2(3),t.oRS(" ",n.title||"Metadata"," "),t.yG2(6),t.C0Y(9,E.itemFor?10:9),t.yG2(4),t.E7m("rowData",E.metadata)("gridOptions",n.gridOptions),t.yG2(2),t.C0Y(15,0===E.recommendations.length?15:-1),t.yG2(1),t.C0Y(16,E.recommendations.length>0?16:-1)}}let Tt=(()=>{class a extends I.K{constructor(n,i,s,D,K,Y,j,H,xt,Rt){super(n,i,new ct.W("MetadataComponent",!1)),this.router=n,this.route=i,this.dialogRef=s,this.metadataService=D,this.snackBar=K,this.entitiesService=Y,this.contentItemsService=j,this.dialog=H,this.viewContainerRef=xt,this.changeDetectorRef=Rt,this.gridOptions=this.buildGridOptions(),this.metadataSet$=new r.g({Items:[],Recommendations:[]}),this.itemFor$=new r.g(void 0),this.fabOpen$=new r.g(!1),this.targetType=parseInt(this.route.snapshot.paramMap.get("targetType"),10),this.keyType=this.route.snapshot.paramMap.get("keyType"),this.key=this.route.snapshot.paramMap.get("key"),this.title=decodeURIComponent(this.route.snapshot.paramMap.get("title")??""),this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName")}ngOnInit(){this.fetchFor(),this.fetchMetadata(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{this.fetchMetadata()}));const n=this.log.rxTap("filteredRecs$");this.metadataSet$.subscribe(D=>{this.log.add("test 2dm",D)});const i=this.metadataSet$.pipe(n.pipe(),(0,u.k)(D=>D.Recommendations.filter(K=>D.Items.filter(Y=>Y._Type.Id===K.Id).length<K.Count)),n.map()),s=this.log.rxTap("viewModel$");this.viewModel$=(0,d.E)([this.metadataSet$,i,this.itemFor$,this.fabOpen$]).pipe(s.pipe(),(0,u.k)(([D,K,Y,j])=>({metadata:D.Items,recommendations:K,itemFor:Y,fabOpen:j})),s.map())}ngOnDestroy(){this.log.add("destroying"),this.metadataSet$.complete(),this.itemFor$.complete(),this.fabOpen$.complete(),super.ngOnDestroy()}closeDialog(){this.dialogRef.close()}openChange(n){this.fabOpen$.next(n)}createMetadata(n){if(n)return n.Enabled?void(n.CreateEmpty?(this.snackBar.open(`Creating ${n.Name}...`),this.entitiesService.create(n.Id,{For:this.calculateItemFor()}).subscribe({error:()=>{this.snackBar.open(`Creating ${n.Name} failed. Please check console for more info`,void 0,{duration:3e3}),this.fetchMetadata()},next:()=>{this.snackBar.open(`Created ${n.Name}`,void 0,{duration:3e3}),this.fetchMetadata()}})):this.createMetadataForm(n.Id)):void rt.C.openDialog(this.dialog,n.MissingFeature,this.viewContainerRef,this.changeDetectorRef);this.dialog.open(st,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(s=>{null!=s&&this.createMetadataForm(s)})}createMetadataForm(n){const i={items:[{ContentTypeName:n,For:this.calculateItemFor()}]},s=(0,c.K)(i);this.router.navigate([`edit/${s}`],{relativeTo:this.route}),this.changeDetectorRef.markForCheck()}calculateItemFor(){return{Target:Object.values(f._K.metadata).find(i=>i.targetType===this.targetType)?.target??this.targetType.toString(),TargetType:this.targetType,...this.keyType===f._K.keyTypes.guid&&{Guid:this.key},...this.keyType===f._K.keyTypes.number&&{Number:parseInt(this.key,10)},...this.keyType===f._K.keyTypes.string&&{String:this.key}}}fetchFor(){this.contentTypeStaticName&&this.contentItemsService.getAll(this.contentTypeStaticName).subscribe(n=>{const i=n.find(s=>s.Guid===this.key);i?.For&&this.itemFor$.next(i.For)})}fetchMetadata(){const n=this.log.rxTap("getMetadata");this.metadataService.getMetadata(this.targetType,this.keyType,this.key).pipe(n.pipe(),(0,y.U)(1),(0,u.k)(i=>(i.Recommendations.forEach(s=>{s.Icon?.startsWith("base64:")&&(s.Icon=s.Icon.replace("base64:",""),s.Icon=window.atob(s.Icon),s.Icon=s.Icon.replace('fill="#000000"','fill="#ffffff"'))}),i)),n.map()).subscribe(i=>this.metadataSet$.next(i))}editMetadata(n){const s=(0,c.K)({items:[{EntityId:n.Id}]});this.router.navigate([`edit/${s}`],{relativeTo:this.route})}deleteMetadata(n,i=!1){if(i)this.snackBar.open("Deleting..."),this.entitiesService.delete(n._Type.Id,n.Id,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchMetadata()},error:()=>{this.snackBar.open("Delete failed. Please check console for more information",null,{duration:3e3})}});else{const s={entityId:n.Id,entityTitle:n.Title,message:this.metadataSet$.value.Recommendations.find(K=>K.Id===n._Type.Id)?.DeleteWarning};this.dialog.open($,{autoFocus:!1,data:s,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(K=>{K&&this.deleteMetadata(n,!0)})}}buildGridOptions(){return{...h.A,columnDefs:[{...L.y.Id,cellRenderer:C.q,cellRendererParams:{tooltipGetter:s=>`ID: ${s.Id}\nGUID: ${s.Guid}`}},{...L.y.TextWide,field:"Title",onCellClicked:i=>{this.editMetadata(i.data)}},{...L.y.TextWide,headerName:"Content Type",field:"ContentType",valueGetter:i=>{const s=i.data;return`${s._Type.Name}${s._Type.Title!==s._Type.Name?` (${s._Type.Title})`:""}`},cellRenderer:F},{...L.y.ActionsPinnedRight1,cellRenderer:M,cellRendererParams:{onDelete:s=>this.deleteMetadata(s)}}]}}static#t=this.\u0275fac=function(i){return new(i||a)(t.GI1(w.E5),t.GI1(w.gV),t.GI1(O.yI),t.GI1(_.yM),t.GI1(lt.yS),t.GI1(o.q),t.GI1(p.q),t.GI1(O.qW),t.GI1(t.y8U),t.GI1(t.kD9))};static#e=this.\u0275cmp=t.In1({type:a,selectors:[["app-metadata"]],features:[t.eg9],decls:2,vars:3,consts:[["class","eav-dialog nav-component-wrapper"],[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","class","grid-fab","tippy","Create a new metadata for this item"],["class","eav-eco-fab-speed-dial",3,"ngClass"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab",3,"click"],[1,"eav-eco-fab-speed-dial",3,"ngClass","openChange"],[3,"spin"],["mat-fab",""],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Other Content Type",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["style","color: white; fill: white;","matBadgeColor","accent","matBadgeSize","small","matBadge","\u{1f48e}","matBadgePosition","below after","aria-hidden","false",3,"innerHTML","matBadgeHidden"],["matBadgeColor","accent","matBadgeSize","small","matBadge","\u{1f48e}","matBadgePosition","below after","aria-hidden","false",2,"color","white","fill","white",3,"innerHTML","matBadgeHidden"],["mat-mini-fab","","class","eav-eco-fab-speed-dial-action-button"]],template:function(i,s){if(1&i&&(t.yuY(0,Dt,17,6,"div",0),t.wVc(1,"async")),2&i){let D;t.C0Y(0,(D=t.kDX(1,1,s.viewModel$))?0:-1,D)}},dependencies:[W.QF,w.cP,b.Y,O.Yp,g.um,g.CI,g.uw,R.qL,dt.U5,N.Ap,N.eC,N.q_,pt.S,W.a,T.K],styles:["[_nghost-%COMP%]     .mat-button-wrapper div svg *:not([fill]){fill:#fff}"]})}return a})()},9084:(P,v,e)=>{e.d(v,{o:()=>f});var r=e(4896),u=e(5056),d=e(244);function y(c,O){1&c&&r.C_f(0)}function p(c,O){if(1&c&&(r.I0R(0,"mat-hint"),r.yuY(1,y,1,0,"ng-container",2),r.C$Y()),2&c){r.GaO();const t=r.Gew(4);r.yG2(1),r.E7m("ngTemplateOutlet",t)}}function o(c,O){1&c&&r.C_f(0)}function _(c,O){if(1&c&&(r.I0R(0,"mat-error"),r.yuY(1,o,1,0,"ng-container",2),r.C$Y()),2&c){r.GaO();const t=r.Gew(4);r.yG2(1),r.E7m("ngTemplateOutlet",t)}}function I(c,O){1&c&&r._Xx(0)}const C=c=>({"hint-box__short":c}),h=["*"];let f=(()=>{class c{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(g){return new(g||c)};static#e=this.\u0275cmp=r.In1({type:c,selectors:[["app-field-hint"]],inputs:{isError:"isError"},ngContentSelectors:h,decls:5,vars:4,consts:[[1,"hint-box",3,"ngClass","click"],["content",""],[4,"ngTemplateOutlet"]],template:function(g,l){if(1&g&&(r.kPM(),r.I0R(0,"div",0),r.qCj("click",function(){return l.toggleIsShort()}),r.yuY(1,p,2,1)(2,_,2,1),r.C$Y(),r.yuY(3,I,1,0,"ng-template",null,1,r.gJz)),2&g){let T;r.E7m("ngClass",r.S45(2,C,l.isShort)),r.yG2(1),r.C0Y(1,!1===(T=l.isError)?1:!0===T?2:-1)}},dependencies:[u.QF,u.XV,d.MX,d.wJ],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return c})()},420:(P,v,e)=>{e.d(v,{M:()=>r});const r="DROPDOWN_INSERT_VALUE"},504:(P,v,e)=>{e.d(v,{c:()=>u});var r=e(4896);let u=(()=>{class d{onClick(p){p.stopPropagation()}static#t=this.\u0275fac=function(o){return new(o||d)};static#e=this.\u0275dir=r.Sc5({type:d,selectors:[["","appClickStopPropagation",""]],hostBindings:function(o,_){1&o&&r.qCj("click",function(C){return _.onClick(C)})}})}return d})()},616:(P,v,e)=>{function r(d){return new Promise((y,p)=>{const o=new FileReader;o.readAsDataURL(d),o.onload=()=>{y(o.result.split(",")[1])},o.onerror=_=>{p(_)}})}function u(d){return new Promise((y,p)=>{const o=new FileReader;o.readAsText(d),o.onload=()=>{y(o.result)},o.onerror=_=>{p(_)}})}e.d(v,{M:()=>u,S:()=>r})}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.10.00/dist/ng-edit/projects_eav-ui_src_app_metadata_metadata_component_ts.665a71a3c2425eee.js.map