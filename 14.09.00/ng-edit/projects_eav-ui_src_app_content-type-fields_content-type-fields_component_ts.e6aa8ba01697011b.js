"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-type-fields_content-type-fields_component_ts"],{8785:(_,g,a)=>{a.r(g),a.d(g,{ContentTypeFieldsComponent:()=>ae});var c=a(2977),v=a(6317),x=a(7714),A=a(745),Z=a(1640),C=a(116),b=a(4874),w=a(635),R=a(679),S=a(7066),D=a(2409),N=a(325),O=a(4153),I=a(941),E=a(2225),d=a(3789),M=a(6386),e=a(3184),p=a(6362),T=a(1130),m=a(6190),u=a(5590),B=a(178),f=a(2796);function $(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().openMetadata()}),e._UZ(1,"mat-icon",10),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.metadataCount)("matBadgeHidden",!t.metadataCount)}}function J(i,l){if(1&i&&(e.TgZ(0,"div",11),e._UZ(1,"mat-icon",12),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.metadataCount)("matBadgeHidden",!t.metadataCount)}}function U(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",13),e.NdJ("click",function(){return e.CHM(t),e.oxw().openPermissions()}),e._UZ(1,"mat-icon",14),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.field.Permissions.Count)("matBadgeHidden",!t.field.Permissions.Count)}}function k(i,l){if(1&i&&(e.TgZ(0,"div",11),e._UZ(1,"mat-icon",15),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.field.Permissions.Count)("matBadgeHidden",!t.field.Permissions.Count)}}function H(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().rename()}),e._UZ(1,"mat-icon",17),e.TgZ(2,"span"),e._uU(3,"Rename"),e.qZA()(),e.TgZ(4,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().deleteField()}),e._UZ(5,"mat-icon",18),e.TgZ(6,"span"),e._uU(7,"Delete"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.field.EditInfo.ReadOnly),e.xp6(4),e.Q6J("disabled",t.field.EditInfo.ReadOnly||t.field.IsTitle)}}let Q=(()=>{class i{constructor(){}agInit(t){this.params=t,this.field=this.params.data,this.metadataCount=this.field.Metadata?Object.keys(this.field.Metadata).filter(n=>"merged"!==n).length:0,this.enablePermissions=this.field.InputType===d.v.StringWysiwyg||this.field.Type===M.Q.Hyperlink}refresh(t){return!0}openMetadata(){this.params.onOpenMetadata(this.field)}rename(){this.params.onRename(this.field)}openPermissions(){this.params.onOpenPermissions(this.field)}deleteField(){this.params.onDelete(this.field)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-actions"]],decls:10,vars:5,consts:[[1,"actions-component"],["class","like-button highlight","matRipple","","tippy","Metadata",3,"click",4,"ngIf"],["class","like-button disabled",4,"ngIf"],["class","like-button highlight","matRipple","","tippy","Permissions",3,"click",4,"ngIf"],["matRipple","","tippy","More",1,"like-button","highlight",3,"matMenuTriggerFor"],["svgIcon","more-horiz"],[1,"grid-more-menu"],["menu","matMenu"],["matMenuContent",""],["matRipple","","tippy","Metadata",1,"like-button","highlight",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","svgIcon","local-offer",3,"matBadge","matBadgeHidden"],[1,"like-button","disabled"],["matBadgeColor","accent","matBadgeSize","small","matBadgeDisabled","true","matBadgePosition","below after","svgIcon","local-offer",3,"matBadge","matBadgeHidden"],["matRipple","","tippy","Permissions",1,"like-button","highlight",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","svgIcon","person",3,"matBadge","matBadgeHidden"],["matBadgeColor","accent","matBadgeSize","small","matBadgeDisabled","true","matBadgePosition","below after","svgIcon","person",3,"matBadge","matBadgeHidden"],["mat-menu-item","",3,"disabled","click"],["svgIcon","text-fields"],["svgIcon","delete"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,$,2,2,"div",1),e.YNc(2,J,2,2,"div",2),e.YNc(3,U,2,2,"div",3),e.YNc(4,k,2,2,"div",2),e.TgZ(5,"div",4),e._UZ(6,"mat-icon",5),e.qZA()(),e.TgZ(7,"mat-menu",6,7),e.YNc(9,H,8,2,"ng-template",8),e.qZA()),2&t){const o=e.MAs(8);e.xp6(1),e.Q6J("ngIf",!n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",!n.field.EditInfo.ReadOnly&&n.enablePermissions),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly||!n.enablePermissions),e.xp6(1),e.Q6J("matMenuTriggerFor",o)}},directives:[p.O5,T.wG,m.$,u.Hw,B.k,f.p6,f.VK,f.KA,f.OP],styles:[""]}),i})();function P(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().changeInputType()}),e.TgZ(1,"div",3),e._uU(2),e.qZA(),e.TgZ(3,"div",4),e._UZ(4,"mat-icon",5),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.value)}}function Y(i,l){if(1&i&&(e.TgZ(0,"div",6)(1,"div",7),e._uU(2),e.qZA(),e.TgZ(3,"div",8),e._UZ(4,"mat-icon",5),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.value)}}let G=(()=>{class i{agInit(t){this.params=t,this.value=t.value,this.field=t.data}refresh(t){return!0}changeInputType(){this.params.onChangeInputType(this.field)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-input-type"]],decls:2,vars:2,consts:[["matRipple","","class","input-component highlight",3,"click",4,"ngIf"],["class","input-component disabled",4,"ngIf"],["matRipple","",1,"input-component","highlight",3,"click"],[1,"text"],[1,"like-button"],["svgIcon","arrow-drop-down"],[1,"input-component","disabled"],[1,"text","disabled"],[1,"like-button","disabled"]],template:function(t,n){1&t&&(e.YNc(0,P,5,1,"div",0),e.YNc(1,Y,5,1,"div",1)),2&t&&(e.Q6J("ngIf",!n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly))},directives:[p.O5,T.wG,u.Hw],styles:[""]}),i})();function X(i,l){1&i&&e._UZ(0,"mat-icon",3)}function j(i,l){1&i&&e._UZ(0,"mat-icon",4)}let z=(()=>{class i{agInit(t){const n=t.data;this.hasFormulas=n.HasFormulas,this.isEphemeral=n.IsEphemeral}refresh(t){return!0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-special"]],decls:3,vars:2,consts:[[1,"icon-container"],["tippy","Has Formulas","svgIcon","functions",4,"ngIf"],["tippy","Ephemeral / Temporary, won't save","svgIcon","mobiledata-off",4,"ngIf"],["tippy","Has Formulas","svgIcon","functions"],["tippy","Ephemeral / Temporary, won't save","svgIcon","mobiledata-off"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,X,1,0,"mat-icon",1),e.YNc(2,j,1,0,"mat-icon",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.hasFormulas),e.xp6(1),e.Q6J("ngIf",n.isEphemeral))},directives:[p.O5,u.Hw,m.$],styles:[""]}),i})();function L(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",3),e.NdJ("click",function(){return e.CHM(t),e.oxw().setTitle()}),e._UZ(1,"mat-icon",4),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("svgIcon",t.isTitle?"star":"star-outline")}}function W(i,l){if(1&i&&(e.TgZ(0,"div",5),e._UZ(1,"mat-icon",4),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("svgIcon",t.isTitle?"star":"star-outline")}}let K=(()=>{class i{agInit(t){this.params=t,this.isTitle=t.value,this.field=t.data}refresh(t){return!0}setTitle(){this.params.onSetTitle(this.field)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-title"]],decls:3,vars:2,consts:[[1,"actions-component"],["class","like-button highlight","matRipple","","tippy","Use as title field",3,"click",4,"ngIf"],["class","like-button disabled",4,"ngIf"],["matRipple","","tippy","Use as title field",1,"like-button","highlight",3,"click"],[3,"svgIcon"],[1,"like-button","disabled"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,L,2,1,"div",1),e.YNc(2,W,2,1,"div",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",!n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly))},directives:[p.O5,T.wG,m.$,u.Hw],styles:[""]}),i})();var V=a(1282);let q=(()=>{class i{agInit(t){this.value=t.value,this.icon=(0,V.x)(this.value)}refresh(t){return!0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-type"]],decls:2,vars:2,consts:[[1,"icon-container",3,"tippy"],[3,"svgIcon"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"mat-icon",1),e.qZA()),2&t&&(e.Q6J("tippy",n.value),e.xp6(1),e.Q6J("svgIcon",n.icon))},directives:[m.$,u.Hw],styles:[""]}),i})();var ee=a(898),F=a(5758),te=a(2528),ne=a(7317),ie=a(1350);function oe(i,l){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=l.ngIf;e.xp6(1),e.hij(" ",t.Label||t.Name," ")}}const se=function(i,l){return{"grid-sorted":i,"grid-filtered":l}};let ae=(()=>{class i{constructor(t,n,o,s,r,y){this.dialogRef=t,this.route=n,this.router=o,this.contentTypesService=s,this.contentTypesFieldsService=r,this.snackBar=y,this.contentType$=new v.X(void 0),this.fields$=new v.X(void 0),this.gridOptions=this.buildGridOptions(),this.sortApplied=!1,this.filterApplied=!1,this.rowDragSuppressed=!1,this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName"),this.subscription=new x.w0}ngOnInit(){this.fetchFields(),this.refreshOnChildClosed()}ngOnDestroy(){this.contentType$.complete(),this.fields$.complete(),this.subscription.unsubscribe()}closeDialog(){this.dialogRef.close()}onGridReady(t){this.gridApi=t.api,this.columnApi=t.columnApi}onRowDragEnter(t){this.gridApi.setEnableCellTextSelection(!1)}onRowDragEnd(t){this.gridApi.setSuppressRowDrag(!0);const n=this.fields$.value.map(o=>o.Id);this.contentTypesFieldsService.reOrder(n,this.contentType$.value).subscribe(()=>{this.fetchFields(()=>{this.gridApi.setEnableCellTextSelection(!0),this.gridApi.setSuppressRowDrag(!1)})})}onRowDragMove(t){const n=t.node,o=t.overNode;if(o&&n!==o){const y=o.data,h=[...this.fields$.value],le=h.indexOf(n.data),re=h.indexOf(y);this.moveInArray(h,le,re),this.fields$.next(h),this.gridApi.clearFocusedCell()}}moveInArray(t,n,o){const s=t[n];t.splice(n,1),t.splice(o,0,s)}onSortChanged(t){const n=this.columnApi.getColumnState();this.sortApplied=n.some(o=>null!=o.sort),this.suppressRowDrag()}onFilterChanged(t){const n=this.gridApi.getFilterModel(),o=Object.keys(n);this.filterApplied=o.length>0,this.suppressRowDrag()}suppressRowDrag(){const t=this.sortApplied||this.filterApplied;t&&!this.rowDragSuppressed?(this.rowDragSuppressed=!0,this.gridApi.setSuppressRowDrag(!0)):!t&&this.rowDragSuppressed&&(this.rowDragSuppressed=!1,this.gridApi.setSuppressRowDrag(!1))}add(){this.router.navigate([`add/${this.contentTypeStaticName}`],{relativeTo:this.route})}nameCellRenderer(t){const n=t.data;if([d.v.EmptyDefault,d.v.EmptyEnd].includes(n.InputType))return t.value;let s=!1;for(const r of this.fields$.value)if(r.InputType!==d.v.EmptyDefault)if(r.InputType!==d.v.EmptyEnd){if(r.StaticName===n.StaticName)break}else s=!1;else s=!0;return s?`<span class="is-in-group">${t.value}</span>`:t.value}fetchFields(t){const n=null==this.contentType$.value?this.contentTypesService.retrieveContentType(this.contentTypeStaticName):(0,A.of)(this.contentType$.value),o=this.contentTypesFieldsService.getFields(this.contentTypeStaticName);(0,Z.D)([n,o]).subscribe(([s,r])=>{this.contentType$.next(s),this.fields$.next(r),null!=t&&t()})}editFieldMetadata(t){const n={items:[this.createItemDefinition(t,"All"),this.createItemDefinition(t,t.Type),this.createItemDefinition(t,t.InputType)]},o=(0,E.f)(n);this.router.navigate([`edit/${o}`],{relativeTo:this.route})}createItemDefinition(t,n){return null!=t.Metadata[n]?{EntityId:t.Metadata[n].Id}:{ContentTypeName:"@"+n,For:{Target:I.Z.metadata.attribute.target,TargetType:I.Z.metadata.attribute.targetType,Number:t.Id},Prefill:{Name:t.StaticName}}}setTitle(t){this.snackBar.open("Setting title..."),this.contentTypesFieldsService.setTitle(t,this.contentType$.value).subscribe(()=>{this.snackBar.open("Title set",null,{duration:2e3}),this.fetchFields()})}changeInputType(t){this.router.navigate([`update/${this.contentTypeStaticName}/${t.Id}/inputType`],{relativeTo:this.route})}rename(t){this.router.navigate([`update/${this.contentTypeStaticName}/${t.Id}/name`],{relativeTo:this.route})}delete(t){!confirm(`Are you sure you want to delete '${t.StaticName}' (${t.Id})?`)||(this.snackBar.open("Deleting..."),this.contentTypesFieldsService.delete(t,this.contentType$.value).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchFields()}))}openPermissions(t){this.router.navigate([N.i.getUrlAttribute(t.Id)],{relativeTo:this.route})}openMetadata(t){const n=D.U.getUrlAttribute(t.Id,`Metadata for Field: ${t.StaticName} (${t.Id})`);this.router.navigate([n],{relativeTo:this.route})}refreshOnChildClosed(){this.subscription.add(this.router.events.pipe((0,C.h)(t=>t instanceof c.m2),(0,b.O)(!!this.route.snapshot.firstChild),(0,w.U)(()=>!!this.route.snapshot.firstChild),(0,R.G)(),(0,C.h)(([t,n])=>t&&!n)).subscribe(()=>{this.fetchFields()}))}buildGridOptions(){return Object.assign(Object.assign({},O.f),{getRowClass(n){const o=n.data,s=[];return o.EditInfo.ReadOnly&&s.push("disable-row-drag"),o.InputType===d.v.EmptyDefault&&s.push("group-start-row"),o.InputType===d.v.EmptyEnd&&s.push("group-end-row"),s},columnDefs:[{rowDrag:!0,width:18,cellClass:"no-select no-padding no-outline".split(" ")},{field:"Title",width:42,cellClass:"secondary-action no-padding no-outline".split(" "),valueGetter:n=>n.data.IsTitle,cellRenderer:K,cellRendererParams:(()=>({onSetTitle:o=>this.setTitle(o)}))()},{field:"Name",flex:2,minWidth:250,cellClass:"primary-action highlight".split(" "),sortable:!0,filter:"agTextColumnFilter",onCellClicked:n=>{this.editFieldMetadata(n.data)},cellRenderer:n=>this.nameCellRenderer(n),valueGetter:n=>n.data.StaticName},{field:"Type",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:n=>n.data.Type,cellRenderer:q},{headerName:"Input",field:"InputType",width:160,cellClass:n=>(n.data.EditInfo.ReadOnly?"no-outline no-padding":"secondary-action no-padding").split(" "),sortable:!0,filter:"agTextColumnFilter",valueGetter:n=>{const o=n.data;return o.InputType.substring(o.InputType.indexOf("-")+1)},cellRenderer:G,cellRendererParams:(()=>({onChangeInputType:o=>this.changeInputType(o)}))()},{field:"Label",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:n=>{var o,s;return null===(s=null===(o=n.data.Metadata)||void 0===o?void 0:o.All)||void 0===s?void 0:s.Name}},{field:"Special",width:66,headerClass:"dense",cellClass:"no-outline",cellRenderer:z},{field:"Notes",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:n=>{var o,s;return null===(s=null===(o=n.data.Metadata)||void 0===o?void 0:o.All)||void 0===s?void 0:s.Notes}},{width:122,cellClass:"secondary-action no-padding".split(" "),pinned:"right",cellRenderer:Q,cellRendererParams:(()=>({onRename:o=>this.rename(o),onDelete:o=>this.delete(o),onOpenPermissions:o=>this.openPermissions(o),onOpenMetadata:o=>this.openMetadata(o)}))()}]})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(F.so),e.Y36(c.gz),e.Y36(c.F0),e.Y36(S.s),e.Y36(ee.Mr),e.Y36(te.ux))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields"]],decls:18,vars:16,consts:[[1,"nav-component-wrapper"],["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["mat-icon-button","","tippy","Close dialog",3,"click"],["svgIcon","close"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions","ngClass","rowDragEnter","rowDragEnd","rowDragMove","gridReady","sortChanged","filterChanged"],[1,"grid-more-actions-box"],["mat-fab","","mat-elevation-z24","","tippy","Add fields",1,"grid-fab",3,"disabled","click"],["svgIcon","add"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),e.YNc(4,oe,2,1,"ng-container",3),e.ALo(5,"async"),e._uU(6," Fields "),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return n.closeDialog()}),e._UZ(8,"mat-icon",5),e.qZA()()(),e._UZ(9,"router-outlet"),e.TgZ(10,"div",6)(11,"ag-grid-angular",7),e.NdJ("rowDragEnter",function(s){return n.onRowDragEnter(s)})("rowDragEnd",function(s){return n.onRowDragEnd(s)})("rowDragMove",function(s){return n.onRowDragMove(s)})("gridReady",function(s){return n.onGridReady(s)})("sortChanged",function(s){return n.onSortChanged(s)})("filterChanged",function(s){return n.onFilterChanged(s)}),e.ALo(12,"async"),e.qZA(),e._UZ(13,"div",8),e.TgZ(14,"button",9),e.NdJ("click",function(){return n.add()}),e.ALo(15,"async"),e.ALo(16,"async"),e._UZ(17,"mat-icon",10),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("ngIf",e.lcZ(5,5,n.contentType$)),e.xp6(7),e.Q6J("rowData",e.lcZ(12,7,n.fields$))("gridOptions",n.gridOptions)("ngClass",e.WLB(13,se,n.sortApplied,n.filterApplied)),e.xp6(3),e.Q6J("disabled",null==e.lcZ(15,9,n.contentType$)||e.lcZ(16,11,n.contentType$).EditInfo.ReadOnly))},directives:[F.uh,p.O5,ne.lW,m.$,u.Hw,c.lC,ie.N8,p.mk],pipes:[p.Ov],styles:[""]}),i})()},4153:(_,g,a)=>{a.d(g,{f:()=>c});const c={accentedSort:!0,animateRows:!0,enableCellTextSelection:!0,headerHeight:32,suppressScrollOnNewData:!0,valueCache:!0,defaultColDef:{filterParams:{newRowsAction:"keep"}},tooltipShowDelay:0,tooltipHideDelay:1e5,suppressMovableColumns:!0}}}]);
//# sourceMappingURL=https://sources.2sxc.org/14.09.00/ng-edit/projects_eav-ui_src_app_content-type-fields_content-type-fields_component_ts.e6aa8ba01697011b.js.map