"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_visual-query_visual-query_component_ts-node_modules_lodash-es__arrayE-ac6327"],{7693:(F,_,r)=>{r.d(_,{X:()=>f,g:()=>P});var m=r(9148),u=r(271),d=r(6474);const f="admin/type/",t="admin/type/get",c="admin/type/list",h="admin/type/scopes";let P=(()=>{class E extends d.D{retrieveContentType(g){return this.getHttpApiUrl(t,{params:{appId:this.appId,contentTypeId:g}})}retrieveContentTypeSig(g,I){return this.getSignal(t,{params:{appId:this.appId,contentTypeId:g}},I)}retrieveContentTypes(g){return this.getHttpApiUrl(c,{params:{appId:this.appId,scope:g}})}retrieveContentTypesSig(g,I){return this.getSignal(c,{params:{appId:this.appId,scope:g}},I)}getScopes(){return this.getHttpApiUrl(h,{params:{appId:this.appId}}).pipe((0,u.T)(g=>{const I=g.old;return Object.keys(I).map(N=>({name:I[N],value:N}))}))}getScopesSig(g){const I=this.getSignal(h,{params:{appId:this.appId}},g);return(0,m.EWP)(()=>{const N=I();if(!N||!N.old)return[];const R=N.old;return Object.keys(R).map(O=>({name:R[O],value:O}))})}getScopesV2(){return this.getHttpApiUrl(h,{params:{appId:this.appId}}).pipe((0,u.T)(g=>g.scopes))}save(g){return this.http.post(this.apiUrl("admin/type/save"),g,{params:{appid:this.appId}})}delete(g){return this.http.delete(this.apiUrl("admin/type/delete"),{params:{appid:this.appId,staticName:g.NameId}})}import(g){const I=new FormData;for(const M of g)I.append("File",M);return this.http.post(this.apiUrl("admin/type/import"),I,{params:{appId:this.appId,zoneId:this.zoneId}})}createGhost(g){return this.http.post(this.apiUrl("admin/type/addghost"),null,{params:{appid:this.appId,sourceNameId:g}})}static{this.\u0275fac=(()=>{let g;return function(M){return(g||(g=m.xGo(E)))(M||E)}})()}static{this.\u0275prov=m.jDH({token:E,factory:E.\u0275fac})}}return E})()},1475:(F,_,r)=>{r.d(_,{j:()=>t});var m=r(6474),u=r(8624),d=r(9148);let t=(()=>{class c extends m.D{getContentInfo(y,C){return this.getSignal("admin/appParts/get",{params:{appid:this.appId,zoneId:this.zoneId,scope:y}},C)}exportParts(y,C,v){const T=this.apiUrl(u.Q+"Export")+"?appId="+this.appId+"&zoneId="+this.zoneId+"&contentTypeIdsString="+y.join(";")+"&entityIdsString="+C.join(";")+"&templateIdsString="+v.join(";");window.open(T,"_blank","")}static{this.\u0275fac=(()=>{let y;return function(v){return(y||(y=d.xGo(c)))(v||c)}})()}static{this.\u0275prov=d.jDH({token:c,factory:c.\u0275fac})}}return c})()},320:(F,_,r)=>{r.d(_,{t:()=>c});var m=r(1772),u=r(6474),d=r(9148);let c=(()=>{class h extends u.D{getAppInfo(C){return this.getSignal("admin/app/Statistics",{params:{appid:this.appId,zoneId:this.zoneId}},C)}exportAppUrl(){return`${this.apiUrl(`${m.u}Export`)}?appId=${this.appId}&zoneId=${this.zoneId}`}exportForVersionControl({includeContentGroups:C,resetAppGuid:v,withFiles:T}){return this.getHttpApiUrl("admin/app/SaveData",{params:{appid:this.appId,zoneId:this.zoneId,includeContentGroups:C.toString(),resetAppGuid:v.toString(),withPortalFiles:T.toString()}})}static{this.\u0275fac=(()=>{let C;return function(T){return(C||(C=d.xGo(h)))(T||h)}})()}static{this.\u0275prov=d.jDH({token:h,factory:h.\u0275fac})}}return h})()},8624:(F,_,r)=>{r.d(_,{Q:()=>f,S:()=>t});var m=r(1772),u=r(6474),d=r(9148);const f="admin/appParts/";let t=(()=>{class c extends u.D{importAppParts(y){const C=new FormData;return C.append("File",y),this.http.post(this.apiUrl(f+"Import"),C,{params:{appId:this.appId,zoneId:this.zoneId}})}resetApp(y){return this.http.post(this.apiUrl(m.u+"Reset"),{},{params:{appId:this.appId,zoneId:this.zoneId,withPortalFiles:y.toString()}})}static{this.\u0275fac=(()=>{let y;return function(v){return(y||(y=d.xGo(c)))(v||c)}})()}static{this.\u0275prov=d.jDH({token:c,factory:c.\u0275fac})}}return c})()},5445:(F,_,r)=>{r.d(_,{Cu:()=>c.Cu,JL:()=>c.JL,Mk:()=>c.Mk,X6:()=>u.X,ei:()=>c.ei,gs:()=>u.g,tr:()=>m.t,vN:()=>c.vN,xR:()=>c.xR,y0:()=>h.y});var m=r(1479),u=r(7693),c=(r(1475),r(320),r(8624),r(6460)),h=r(2570)},6460:(F,_,r)=>{r.d(_,{Cu:()=>E,JL:()=>G,Mk:()=>T,ei:()=>P,vN:()=>g,xR:()=>I});var m=r(4600),u=r(6647),d=r(271),f=r(693),t=r(9234),c=r(6474),h=r(9148);const T="admin/query/Run",P="admin/query/DebugStream",E="admin/query/Save",G="admin/query/Get",g="admin/query/DataSources";let I=(()=>{class M extends c.D{getAll(R){return this.getHttpApiUrl(t.Gg,{params:{appId:this.appId,contentType:R}})}getAllSig(R,O){return this.getSignal(t.Gg,{params:{appId:this.appId,contentType:R}},O)}importQuery(R){return(0,m.H)((0,f.n)(R)).pipe((0,u.n)(O=>this.http.post(this.apiUrl("admin/query/import"),{AppId:this.appId,ContentBase64:O})),(0,d.T)(O=>({Success:O,Messages:[]})))}clonePipeline(R){return this.getHttpApiUrl("admin/query/Clone",{params:{Id:R.toString(),appId:this.appId}})}delete(R){return this.http.delete(this.apiUrl("admin/query/Delete"),{params:{appId:this.appId,Id:R.toString()}})}static{this.\u0275fac=(()=>{let R;return function(B){return(R||(R=h.xGo(M)))(B||M)}})()}static{this.\u0275prov=h.jDH({token:M,factory:M.\u0275fac})}}return M})()},2570:(F,_,r)=>{r.d(_,{y:()=>C});var m=r(6474),u=r(9148);let C=(()=>{class v extends m.D{getAll(){return this.getSignal("admin/view/all",{params:{appId:this.appId}})}delete(P){return this.getHttpApiUrl("admin/view/delete",{params:{appId:this.appId,Id:P.toString()}})}import(P){const E=new FormData;return E.append("File",P),this.http.post(this.apiUrl("admin/view/import"),E,{params:{appId:this.appId,zoneId:this.zoneId}})}export(P){const E=this.apiUrl("admin/view/json")+"?appId="+this.appId+"&viewId="+P;window.open(E,"_blank","")}getPolymorphism(){return this.getSignal("admin/view/polymorphism",{params:{appId:this.appId}})}getUsage(P){return this.getSignal("admin/view/usage",{params:{appId:this.appId,guid:P}})}static{this.\u0275fac=(()=>{let P;return function(G){return(P||(P=u.xGo(v)))(G||v)}})()}static{this.\u0275prov=u.jDH({token:v,factory:v.\u0275fac})}}return v})()},2760:(F,_,r)=>{function m(d){return"Escape"===d.key}function u(d){return("s"===d.key||"S"===d.key)&&(d.ctrlKey||d.metaKey)}r.d(_,{J:()=>u,K:()=>m})},1772:(F,_,r)=>{r.d(_,{I:()=>h,u:()=>c});var m=r(6647),u=r(9452),d=r(3550),f=r(6474),t=r(9148);const c="admin/app/";let h=(()=>{class y extends f.D{importApp(v,T,P=!1){const E=new FormData;return E.append("File",v),E.append("Name",T??""),this.http.post(this.apiUrl(c+"Import"),E,{params:{zoneId:this.zoneId}}).pipe((0,m.n)(G=>{if(P&&G.Messages[0]?.MessageType===d.G1.Warning){const g=prompt(G.Messages[0].Text+" Would you like to install it using another folder name?");if(g)return this.importApp(v,g,!0)}return(0,u.of)(G)}))}static{this.\u0275fac=(()=>{let v;return function(P){return(v||(v=t.xGo(y)))(P||y)}})()}static{this.\u0275prov=t.jDH({token:y,factory:y.\u0275fac})}}return y})()},1459:(F,_,r)=>{r.d(_,{z:()=>u});var m=r(9148);let u=(()=>{class d{onMousedown(t){t.stopPropagation()}static{this.\u0275fac=function(c){return new(c||d)}}static{this.\u0275dir=m.FsC({type:d,selectors:[["","appMousedownStopPropagation",""]],hostBindings:function(c,h){1&c&&m.bIt("mousedown",function(C){return h.onMousedown(C)})},standalone:!0})}}return d})()},4981:(F,_,r)=>{r.d(_,{f:()=>m});class m{static toggleInArray(d,f){const t=f.indexOf(d);-1===t?f.push(d):f.splice(t,1)}}},693:(F,_,r)=>{function m(d){return new Promise((f,t)=>{const c=new FileReader;c.readAsDataURL(d),c.onload=()=>{f(c.result.split(",")[1])},c.onerror=h=>{t(h)}})}function u(d){return new Promise((f,t)=>{const c=new FileReader;c.readAsText(d),c.onload=()=>{f(c.result)},c.onerror=h=>{t(h)}})}r.d(_,{d:()=>u,n:()=>m})},3717:(F,_,r)=>{r.r(_),r.d(_,{VisualQueryComponent:()=>we});var m=r(316),u=r(3840),d=r(2159),f=r(8873),t=r(9148),c=r(8827),h=r(52),y=r(4601),C=r(4981);const v={App:{Name:"App",Label:"App DataSources",Icon:"star",UiHint:"DataSources from the current App"},Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};var P=r(436),E=r(9686),G=r(4205),g=r(8537),I=r(1567),M=r(7693),N=r(401),R=r(3216),O=r(334),B=r(271),V=r(5445),pt=r(6474);let q=(()=>{class o extends pt.D{fetchPipeline(e,i){return this.getHttp(V.JL,{params:{appId:this.appId,id:e.toString()}}).pipe((0,B.T)(n=>(n.DataSources.length||this.buildDefaultModel(n,i),this.fixPipelineDataSources(n.DataSources),n)))}buildDefaultModel(e,i){const n=h.YX.pipelineDesigner.defaultPipeline.dataSources;for(const s of n){const l=i.find(D=>D.PartAssemblyAndType===s.PartAssemblyAndType);e.DataSources.push({Description:"",EntityGuid:s.EntityGuid,EntityId:void 0,Name:l.Name,PartAssemblyAndType:s.PartAssemblyAndType,VisualDesignerData:s.VisualDesignerData})}e.Pipeline.StreamWiring=h.YX.pipelineDesigner.defaultPipeline.streamWiring}fixPipelineDataSources(e){if(!e.some(n=>n.EntityGuid===h.YX.pipelineDesigner.outDataSource.EntityGuid)){const n=h.YX.pipelineDesigner.outDataSource;e.push({Description:n.Description,EntityGuid:n.EntityGuid,EntityId:void 0,Name:n.Name,PartAssemblyAndType:n.PartAssemblyAndType,VisualDesignerData:n.VisualDesignerData})}for(const n of e)n.VisualDesignerData??={Top:50,Left:50}}fetchDataSources(){return this.getHttp(V.vN,{params:{appid:this.appId,zoneId:this.zoneId}}).pipe((0,B.T)(e=>{const i=h.YX.pipelineDesigner.outDataSource;return e.push({ContentType:void 0,Difficulty:h.YX.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:i.In,Name:i.Name,Out:void 0,PartAssemblyAndType:i.PartAssemblyAndType,PrimaryType:i.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),e}))}typeNameFilter(e,i){const n=e.split(", ");switch(i){case"classFullName":return n[0];case"className":const l=n[0].split(".");return l[l.length-1];default:return e}}savePipeline(e){const i=e.Pipeline;return this.http.post(V.Cu,{pipeline:i,dataSources:e.DataSources},{params:{appId:this.appId,Id:i.EntityId.toString()}}).pipe((0,B.T)(s=>(this.fixPipelineDataSources(s.DataSources),s)))}runPipeline(e,i){return this.getHttp(V.Mk,{params:{appId:this.appId,id:e.toString(),top:i.toString()}})}debugStream(e,i,n,s){return this.getHttp(V.ei,{params:{appId:this.appId,id:e.toString(),from:i,out:n,top:s.toString()}})}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=t.xGo(o)))(n||o)}})()}static{this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac})}}return o})();var L=r(2938),dt=r(2760),z=r(4038),tt=r(8471),ut=r(4979),j=r(4175),w=r(7941),Q=r(8223);function mt(o,a){if(1&o&&t.EFF(0),2&o){const e=t.XpG();t.Lme(' for Stream: "',e.debugStream.name,'" on Source: "',e.debugStream.sourceName,'" ')}}function ht(o,a){1&o&&(t.j41(0,"div",13)(1,"span"),t.EFF(2,"Results"),t.k0s()())}function _t(o,a){1&o&&t.EFF(0," Showing All results ")}function gt(o,a){if(1&o&&t.EFF(0),2&o){const e=t.XpG();t.SpI(" Showing top ",e.top," results ")}}function ft(o,a){1&o&&t.EFF(0," All ")}function vt(o,a){if(1&o&&t.EFF(0),2&o){const e=t.XpG().$implicit;t.SpI(" ",e," ")}}function yt(o,a){if(1&o){const e=t.RV6();t.j41(0,"button",14),t.bIt("click",function(){const n=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.show(n))}),t.EFF(1," Show "),t.DNE(2,ft,1,0)(3,vt,1,1),t.k0s()}if(2&o){const e=a.$implicit;t.R7$(2),t.vxM(0===e?2:-1),t.R7$(),t.vxM(0!==e?3:-1)}}function Et(o,a){1&o&&(t.j41(0,"div",16)(1,"span"),t.EFF(2,"Parameters"),t.k0s()())}function Ct(o,a){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.R7$(),t.JRh(e)}}function St(o,a){if(1&o&&(t.j41(0,"mat-tab"),t.DNE(1,Et,3,0,"div",15),t.j41(2,"div",11)(3,"ul"),t.Z7z(4,Ct,2,1,"li",null,t.fX1),t.k0s()()()),2&o){const e=t.XpG();t.R7$(4),t.Dyx(e.parameters)}}function bt(o,a){1&o&&(t.j41(0,"div",17)(1,"span"),t.EFF(2,"Sources"),t.k0s()())}function Dt(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(null==e.value.Definition?null:e.value.Definition.Name)}}function Pt(o,a){if(1&o&&(t.j41(0,"li")(1,"b"),t.EFF(2),t.k0s(),t.EFF(3,"="),t.j41(4,"em"),t.EFF(5),t.k0s()()),2&o){const e=a.$implicit;t.R7$(2),t.JRh(e.key),t.R7$(3),t.JRh(e.value)}}function Rt(o,a){if(1&o&&(t.j41(0,"tr")(1,"td"),t.DNE(2,Dt,2,1,"div"),t.j41(3,"pre"),t.EFF(4),t.k0s()(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td")(8,"ol"),t.Z7z(9,Pt,6,2,"li",null,t.fX1),t.nI1(11,"keyvalue"),t.k0s()(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&o){const e=a.$implicit;t.R7$(2),t.vxM(null!=e.value.Definition&&e.value.Definition.Name?2:-1),t.R7$(2),t.JRh(e.value.Guid),t.R7$(2),t.JRh(e.value.Type),t.R7$(3),t.Dyx(t.bMT(11,4,e.value.Configuration)),t.R7$(4),t.JRh(e.value.Error)}}function It(o,a){1&o&&(t.j41(0,"div",18)(1,"span"),t.EFF(2,"Streams"),t.k0s()())}function xt(o,a){if(1&o&&(t.j41(0,"tr")(1,"td")(2,"pre"),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"pre"),t.EFF(6),t.k0s()(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s()()),2&o){const e=a.$implicit;t.R7$(3),t.JRh(e.Source+":"+e.SourceOut),t.R7$(3),t.JRh(e.Target+":"+e.TargetIn),t.R7$(2),t.JRh(e.Count),t.R7$(2),t.JRh(e.Error)}}let Ft=(()=>{class o{constructor(e,i,n){this.dialogData=e,this.dialog=i,this.visualQueryService=n}ngOnInit(){const e=this.visualQueryService.pipelineModel().Pipeline,i=(e.Params?.split("\n")??[]).filter(s=>!!s),n=(e.TestParameters?.split("\n")??[]).filter(s=>!!s);this.parameters=[].concat(i,n),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialog.close()}show(e){e!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,e):this.visualQueryService.runPipeline(e),this.closeDialog())}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(w.Vh),t.rXU(w.CP),t.rXU(X))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-query-result"]],standalone:!0,features:[t.aNF],decls:56,vars:11,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["dynamicHeight","","color","accent",1,"eav-tab-group"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"eav-tab-description"],["mat-button",""],[1,"eav-pre-scroll"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],[1,"eav-tab-content"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3," Query Results "),t.DNE(4,mt,1,2),t.k0s(),t.j41(5,"button",3),t.bIt("click",function(){return n.closeDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",4)(9,"p"),t.EFF(10),t.k0s(),t.j41(11,"mat-tab-group",5)(12,"mat-tab"),t.DNE(13,ht,3,0,"div",6),t.j41(14,"div",7)(15,"div"),t.DNE(16,_t,1,0)(17,gt,1,1),t.k0s(),t.j41(18,"div"),t.Z7z(19,yt,4,2,"button",8,t.fX1),t.k0s()(),t.j41(21,"pre",9),t.EFF(22),t.nI1(23,"json"),t.k0s()(),t.DNE(24,St,6,0,"mat-tab"),t.j41(25,"mat-tab"),t.DNE(26,bt,3,0,"div",10),t.j41(27,"div",11)(28,"table")(29,"tr")(30,"th"),t.EFF(31,"Name and Guid"),t.k0s(),t.j41(32,"th"),t.EFF(33,"Type"),t.k0s(),t.j41(34,"th"),t.EFF(35,"Configuration"),t.k0s(),t.j41(36,"th"),t.EFF(37,"Error"),t.k0s()(),t.Z7z(38,Rt,14,6,"tr",null,t.fX1),t.nI1(40,"keyvalue"),t.k0s()()(),t.j41(41,"mat-tab"),t.DNE(42,It,3,0,"div",12),t.j41(43,"div",11)(44,"table")(45,"tr")(46,"th"),t.EFF(47,"Source"),t.k0s(),t.j41(48,"th"),t.EFF(49,"Target"),t.k0s(),t.j41(50,"th"),t.EFF(51,"Items"),t.k0s(),t.j41(52,"th"),t.EFF(53,"Error"),t.k0s()(),t.Z7z(54,xt,11,4,"tr",null,t.fX1),t.k0s()()()()()()),2&i&&(t.R7$(4),t.vxM(n.debugStream?4:-1),t.R7$(6),t.Lme(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",n.timeUsed,"ms (",n.ticksUsed," ticks) "),t.R7$(6),t.vxM(0===n.top?16:-1),t.R7$(),t.vxM(0!==n.top?17:-1),t.R7$(2),t.Dyx(n.optionsForTop),t.R7$(3),t.JRh(t.bMT(23,7,n.result)),t.R7$(2),t.vxM(null!=n.parameters&&n.parameters.length?24:-1),t.R7$(14),t.Dyx(t.bMT(40,9,n.sources)),t.R7$(16),t.Dyx(n.streams))},dependencies:[j.Hl,j.$z,j.iY,u.m_,u.An,Q.RI,Q.ES,Q.mq,Q.T8,m.TG,m.lG],styles:[".eav-dialog[_ngcontent-%COMP%]{overflow:hidden}.eav-tab-group[_ngcontent-%COMP%]{padding:0}.eav-tab-content[_ngcontent-%COMP%]{height:calc(100vh - 268px);overflow-y:auto}.eav-tab-description[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-right:1rem;padding:1rem;font-size:16px;line-height:1.5}.eav-pre-scroll[_ngcontent-%COMP%]{height:calc(100vh - 348px);overflow-y:auto}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 10px 0 0;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]})}}return o})(),Tt=(()=>{class o{constructor(e,i){this.dialogData=e,this.dialog=i}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialog.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api-query"),"_blank")}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(w.Vh),t.rXU(w.CP))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-stream-error-result"]],standalone:!0,features:[t.aNF],decls:17,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["align","end"],["mat-button","","tippy","Open 2sxc Insights",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Stream Error Results"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return n.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"pre"),t.EFF(9),t.nI1(10,"json"),t.k0s()(),t.j41(11,"mat-dialog-actions",5)(12,"button",6),t.bIt("click",function(){return n.openInsights()}),t.j41(13,"mat-icon",7),t.EFF(14,"speed"),t.k0s(),t.j41(15,"span"),t.EFF(16,"Insights"),t.k0s()()()()),2&i&&(t.R7$(9),t.JRh(t.bMT(10,1,n.errorData)))},dependencies:[j.Hl,j.$z,j.iY,u.m_,u.An,w.E7,m.TG],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]})}}return o})();var Mt=r(3347);let X=(()=>{class o extends ut.V{#t;#e;#n;#i;#p;#l;#o;#s;constructor(e,i,n,s,l){super(),this.snackBar=e,this.matDialog=i,this.viewContainerRef=n,this.zone=s,this.changeDetectorRef=l,this.#t=(0,L.d)(M.g),this.#e=(0,L.d)(N.T),this.#n=(0,L.d)(q),this.#i=(0,L.d)(tt.c),this.#p=(0,L.d)(P.hE),this.pipelineModel=(0,t.vPA)(null),this.dataSources=(0,t.vPA)(null),this.dataSourceConfigs=(0,t.vPA)({}),this.putEntityCountOnConnections$=new G.B,this.#l=parseInt(this.#i.getParam("pipelineId"),10),this.#o=!1,this.#s=!1}ngOnDestroy(){this.putEntityCountOnConnections$.complete(),super.ngOnDestroy()}init(){this.#c(()=>this.#d(!0,!0,!1)),this.#h(),this.#i.doOnDialogClosed(()=>{(this.#o||this.#s)&&this.#d(this.#o,this.#s,this.#o),this.#o=!1,this.#s=!1})}editPipelineEntity(){this.#r(()=>{const e={items:[O.c.editId(this.pipelineModel().Pipeline.EntityId)]},i=(0,R.s)(e);this.#i.navRelative([`edit/${i}`]),this.#o=!0})}saveAndRun(e,i){return e&&i?this.#r(()=>this.runPipeline()):e?this.#r():i?this.runPipeline():void 0}showDataSourceDetails(e){const i=(0,E.A)(this.pipelineModel()),n=z.i.tryParse(i.Pipeline.VisualDesignerData)??{};n.ShowDataSourceDetails=e,i.Pipeline.VisualDesignerData=JSON.stringify(n),this.pipelineModel.set(i)}addDataSource(e){const i=(0,E.A)(this.pipelineModel());i.DataSources.push({Description:"",EntityGuid:"unsaved"+(i.DataSources.length+1),EntityId:void 0,Name:e.Name,PartAssemblyAndType:e.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel.set(i),this.#r()}removeDataSource(e,i,n){const s=(0,E.A)(this.pipelineModel());s.DataSources=s.DataSources.filter(l=>l.EntityGuid!==e),s.Pipeline.StreamWiring=i,s.Pipeline.StreamsOut=n,this.pipelineModel.set(s)}renameDataSource(e,i){const n=(0,E.A)(this.pipelineModel());n.DataSources.find(l=>l.EntityGuid===e).Name=i,this.pipelineModel.set(n)}changeDataSourceDescription(e,i){const n=(0,E.A)(this.pipelineModel());n.DataSources.find(l=>l.EntityGuid===e).Description=i,this.pipelineModel.set(n)}changeConnections(e,i){const n=(0,E.A)(this.pipelineModel());n.Pipeline.StreamWiring=e,n.Pipeline.StreamsOut=i,this.pipelineModel.set(n)}changeDataSourcePosition(e,i){const n=(0,E.A)(this.pipelineModel()),s=n.DataSources.find(l=>l.EntityGuid===e);s&&(s.VisualDesignerData={...s.VisualDesignerData,...i},this.pipelineModel.set(n))}#a(e){const i={};e.forEach(n=>{null!=n.EntityId&&(i[n.EntityId]=[],n.Metadata?.forEach(s=>{Object.entries(s).forEach(([l,p])=>{null==p||""===p||["Created","Guid","Id","Modified","Title","_Type"].includes(l)||(Array.isArray(p)&&null!==p[0]?.Title&&null!==p[0]?.Id&&(p=`${p[0].Title} (${p[0].Id})`),i[n.EntityId].push({name:l,value:p}))})}))}),this.dataSourceConfigs.set(i)}editDataSource(e){const n=this.dataSources().find(D=>D.PartAssemblyAndType===e.PartAssemblyAndType).ContentType,{targetType:s,keyType:l}=h.YX.metadata.entity,p=e.EntityGuid;this.#e.getMetadata(s,l,p,n).subscribe(D=>{if(D.Items.length){const b={items:[O.c.editId(D.Items[0].Id)]},S=(0,R.s)(b);return this.#i.navRelative([`edit/${S}`]),void(this.#s=!0)}this.#t.retrieveContentType(n).subscribe({next:b=>{if(null==b)return void this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});const S={items:[O.c.newMetadata(p,n,h.YX.metadata.entity)]},k=(0,R.s)(S);this.#i.navRelative([`edit/${k}`]),this.#s=!0},error:b=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}#r(e){this.snackBar.open("Saving..."),this.#n.savePipeline(this.pipelineModel()).subscribe({next:i=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel.set(i),e?.()},error:i=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(e=25){this.snackBar.open("Running query..."),this.#n.runPipeline(this.pipelineModel().Pipeline.EntityId,e).subscribe({next:i=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.queryResult=i,this.#u(i,e),console.warn(i),this.pipelineModel.set((0,E.A)(this.pipelineModel())),setTimeout(()=>{this.putEntityCountOnConnections$.next(i)})},error:i=>{this.snackBar.open("Query failed",null,{duration:2e3})}})}debugStream(e,i=25){if(e.Error)return this.#m(e);if(0===e.Count)return;this.snackBar.open("Running stream...");const n=this.pipelineModel().Pipeline.EntityId;this.#n.debugStream(n,e.Source,e.SourceOut,i).subscribe({next:s=>{this.snackBar.open("Stream worked",null,{duration:2e3});const l=this.pipelineModel().DataSources.find(D=>D.EntityGuid===e.Source);this.#u(s,i,{name:e.SourceOut,source:e.Source,sourceName:l.Name,original:e}),console.warn(s)},error:s=>{this.snackBar.open("Stream failed",null,{duration:2e3})}})}#d(e,i,n){n&&this.snackBar.open("Reloading query, please wait..."),this.#n.fetchPipeline(this.#l,this.dataSources()).subscribe(s=>{n&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.#p.setTitle(`${s.Pipeline.Name} - Visual Query`),e&&this.pipelineModel.set(s),i&&this.#a(s.DataSources)})}#u(e,i,n){this.matDialog.open(Ft,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:e,debugStream:n,top:i},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}#m(e){this.matDialog.open(Tt,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:e.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}#c(e){this.#n.fetchDataSources().subscribe(i=>{this.dataSources.set(i),e()})}#h(){this.zone.runOutsideAngular(()=>{this.subscriptions.add((0,g.R)(window,"keydown").pipe((0,I.p)(()=>!this.#i.snapshot.firstChild),(0,I.p)(e=>(0,dt.J)(e))).subscribe(e=>{e.preventDefault(),this.zone.run(()=>{this.#r()})}))})}static{this.\u0275fac=function(i){return new(i||o)(t.KVO(Mt.UG),t.KVO(w.bZ),t.KVO(t.c1b),t.KVO(t.SKi),t.KVO(t.gRc))}}static{this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac})}}return o})();function Ot(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",7),t.bIt("click",function(){const n=t.eBV(e).$implicit,s=t.XpG(4);return t.Njj(s.addDataSource(n))}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()}if(2&o){const e=a.$implicit,i=t.XpG(4);t.Y8G("tippy",e.UiHint||e.Name),t.R7$(2),t.JRh(e.Icon||i.guiTypes.Unknown.Icon),t.R7$(2),t.JRh(e.Name)}}function At(o,a){if(1&o&&(t.j41(0,"div",5),t.Z7z(1,Ot,5,3,"div",6,t.BUC().trackDataSources,!0),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.Dyx(e.value)}}function jt(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",4),t.bIt("click",function(){const n=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.toggleItem(n.key))}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()(),t.DNE(5,At,3,0,"div",5)}if(2&o){let e;const i=a.$implicit,n=t.XpG(2);t.Y8G("tippy",n.guiTypes[i.key].UiHint||i.key),t.R7$(2),t.JRh(n.guiTypes[i.key].Icon||n.guiTypes.Unknown.Icon),t.R7$(2),t.JRh(null!==(e=null!==(e=n.guiTypes[i.key].Label)&&void 0!==e?e:n.guiTypes[i.key].Name)&&void 0!==e?e:i.key),t.R7$(),t.vxM(n.toggledItems.includes(i.key)?5:-1)}}function wt(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"span",2),t.EFF(3,"Show Advanced"),t.k0s(),t.j41(4,"mat-slide-toggle",3),t.bIt("change",function(n){t.eBV(e);const s=t.XpG();return t.Njj(s.toggleDifficulty(n))}),t.k0s()(),t.Z7z(5,jt,6,4,null,null,t.BUC().trackGroups,!0),t.nI1(7,"keyvalue"),t.k0s()}if(2&o){const e=t.XpG();t.R7$(5),t.Dyx(t.bMT(7,0,e.sorted()))}}let Gt=(()=>{class o{#t;#e;constructor(e){this.visualQueryService=e,this.toggledItems=[],this.guiTypes=v,this.#t=h.YX.pipelineDesigner.dataSourceDifficulties,this.#e=(0,t.vPA)(this.#t.default),this.sorted=(0,t.EWP)(()=>function kt(o,a){if(!o)return;const i=(0,E.A)(o).filter(s=>s.Difficulty<=a&&s.PartAssemblyAndType!==h.YX.pipelineDesigner.outDataSource.PartAssemblyAndType);i.sort((s,l)=>s.Name.toLocaleLowerCase().localeCompare(l.Name.toLocaleLowerCase()));const n={};for(const s of i){const l=s.PrimaryType;n[l]?n[l].push(s):n[l]=[s]}return n}(this.visualQueryService.dataSources(),this.#e()))}toggleDifficulty(e){const i=e.checked?this.#t.advanced:this.#t.default;this.#e.set(i)}addDataSource(e){this.visualQueryService.addDataSource(e)}toggleItem(e){C.f.toggleInArray(e,this.toggledItems)}trackGroups(e,i){return i.key}trackDataSources(e,i){return i.PartAssemblyAndType}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(X))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-add-explorer"]],standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"eav-show-advanced"],[1,"eav-slide-toggle-label"],["color","primary",3,"change"],["tippyShowDelay","750",1,"collapsible",3,"click","tippy"],[1,"list"],["tippyShowDelay","750",1,"list-item",3,"tippy"],["tippyShowDelay","750",1,"list-item",3,"click","tippy"]],template:function(i,n){1&i&&t.DNE(0,wt,8,2,"div",0),2&i&&t.vxM(n.sorted()?0:-1)},dependencies:[c.mV,c.sG,u.m_,u.An,m.lG,y.e],styles:[".mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}.eav-show-advanced[_ngcontent-%COMP%]{margin-left:8px}"]})}}return o})();var $t=r(5797),Ut=r(9999),et=r(3176),Nt=r(1459),Lt=r(3518),K=r(4435);const Bt={all:!0,getEndpointOverlays:!0,getEndpointInfo:!0,buildSourceEndpoint:!0,buildTargetEndpoint:!0};class Y{constructor(a){this.plumb=a,this.log=(0,K.T)({EndpointsHelper:Y},Bt)}getEndpointOverlays(a){return this.log.fnIf("getEndpointOverlays",{isSource:a}).r([["Label",{id:"endpointLabel",location:[.5,a?0:1],label:"Default",cssClass:a?"endpointSourceLabel":"endpointTargetLabel"}]])}getEndpointInfo(a,e){const i=this.log.fnIf("getEndpointInfo",{endpointName:a,isDynamic:e});let n,s;const l=a.trim();return s=l.endsWith("*"),n=s?l.substring(0,l.length-1):l,e?i.r({name:n,required:!1},"isDynamic"):i.r({name:n,required:s},"notDynamic")}buildSourceEndpoint(a,e){const i=this.log.fnIf("buildSourceEndpoint",{pipelineDataSourceGuid:a,style:e}),n=!0,s={paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint "+(e??""),maxConnections:-1,isSource:n,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(n),events:{click:l=>this.plumb.onChangeLabel(l,n,a)}};return i.r(s)}buildTargetEndpoint(a,e){const i=this.log.fnIf("buildTargetEndpoint",{pipelineDataSourceGuid:a,style:e}),n=!1,s={paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint "+(e??" "),maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(n),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:l=>this.plumb.onChangeLabel(l,n,a)}};return i.r(s)}}var A=r(4456),nt=r(5060),H=r(4950),it=r(7984),ot=r(5175),Xt=r(3037),Vt=r(1817),Qt=r(3758),Ht=r(9333);const st=o=>({active:o});function Wt(o,a){1&o&&(t.j41(0,"app-field-hint"),t.EFF(1," You will get suggestions for out-streams after you run query "),t.k0s())}function zt(o,a){1&o&&(t.j41(0,"app-field-hint",12),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function Kt(o,a){if(1&o&&(t.j41(0,"mat-form-field",10)(1,"mat-label"),t.EFF(2,"Label"),t.k0s(),t.nrm(3,"input",11),t.k0s(),t.DNE(4,Wt,2,0,"app-field-hint")(5,zt,2,1,"app-field-hint",12)),2&o){const e=t.XpG();t.R7$(4),t.vxM(e.isSource&&!e.pipelineResultExists?4:-1),t.R7$(),t.vxM(e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?5:-1)}}function Yt(o,a){if(1&o&&(t.j41(0,"mat-option",19),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",e.name," ")}}function Jt(o,a){if(1&o&&(t.j41(0,"mat-form-field",10)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",18),t.Z7z(4,Yt,2,2,"mat-option",19,t.fX1),t.k0s()(),t.j41(6,"app-field-hint"),t.EFF(7," The scope should almost never be changed - "),t.j41(8,"a",20),t.EFF(9,"see help"),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(3),t.Y8G("placeholder",e.scopeOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.scopeOptions)}}function Zt(o,a){if(1&o&&(t.j41(0,"mat-option",19),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function qt(o,a){if(1&o&&(t.j41(0,"mat-select",13),t.Z7z(1,Zt,2,2,"mat-option",19,t.fX1),t.k0s()),2&o){const e=t.XpG(2);t.Y8G("placeholder",e.labelOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.labelOptions)}}function te(o,a){1&o&&t.nrm(0,"input",11)}function ee(o,a){1&o&&(t.j41(0,"app-field-hint",12),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function ne(o,a){if(1&o){const e=t.RV6();t.DNE(0,Jt,10,1),t.j41(1,"mat-form-field",10)(2,"mat-label"),t.EFF(3,"Label"),t.k0s(),t.DNE(4,qt,3,1,"mat-select",13)(5,te,1,0,"input",11),t.j41(6,"div",14)(7,"button",15),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.toggleGuidedLabel(!0))}),t.j41(8,"mat-icon",16),t.EFF(9,"search"),t.k0s()(),t.j41(10,"button",17),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.toggleGuidedLabel(!1))}),t.j41(11,"mat-icon",16),t.EFF(12,"text_fields"),t.k0s()()()(),t.DNE(13,ee,2,1,"app-field-hint",12)}if(2&o){const e=t.XpG();t.vxM(e.advancedMode&&e.guidedLabel?0:-1),t.R7$(4),t.vxM(e.guidedLabel?4:-1),t.R7$(),t.vxM(e.guidedLabel?-1:5),t.R7$(2),t.Y8G("ngClass",t.eq3(6,st,e.guidedLabel)),t.R7$(3),t.Y8G("ngClass",t.eq3(8,st,!e.guidedLabel)),t.R7$(3),t.vxM(e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?13:-1)}}function ie(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-slide-toggle",21),t.bIt("change",function(n){t.eBV(e);const s=t.XpG();return t.Njj(s.toggleAdvancedMode(n))}),t.EFF(1),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("checked",e.advancedMode),t.R7$(),t.SpI(" ",e.advancedMode?"Advanced":"Simple"," ")}}let oe=(()=>{class o extends et.${#t;constructor(e,i,n,s){super(),this.dialogData=e,this.dialog=i,this.visualQueryService=n,this.changeDetectorRef=s,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.queryResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1,this.#t=(0,L.d)(V.gs)}ngOnInit(){this.#e()}closeDialog(e){this.dialog.close(e)}toggleGuidedLabel(e){this.guidedLabel=e}toggleAdvancedMode(e){this.advancedMode=e.checked}rename(){const e=this.form.getRawValue();this.closeDialog(e.label)}#e(){this.form=new A.J3({label:new A.hs(this.dialogData.label,A.k0.required),scope:new A.hs(h.YX.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscriptions.add(this.controls.scope.valueChanges.pipe((0,Xt.Z)(this.controls.scope.value),(0,Vt.F)()).subscribe(e=>{this.labelOptions=Object.values(this.visualQueryService.queryResult.Sources).find(i=>i.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(i=>i.Scope===e).map(i=>i.Name),!this.labelOptions.includes(this.controls.label.value)&&null!=this.controls.label.value&&this.controls.label.patchValue(null)})),this.#t.getScopes().subscribe(e=>{const i=Object.values(this.visualQueryService.queryResult.Sources).find(s=>s.Guid===this.dialogData.pipelineDataSourceGuid).Out,n=e.filter(s=>i.some(l=>l.Scope===s.value));this.scopeOptions=n,this.changeDetectorRef.markForCheck()}))}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(w.Vh),t.rXU(w.CP),t.rXU(X),t.rXU(t.gRc))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(i,n){2&i&&t.Mr5("className",n.hostClass)},standalone:!0,features:[t.Vt3,t.aNF],decls:19,vars:5,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"formGroup"],[1,"eav-dialog-actions"],["color","accent",3,"checked"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","formControlName","label","required",""],[3,"isError"],["formControlName","label","required","",3,"placeholder"],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"click","ngClass"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"click","ngClass"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["color","accent",3,"change","checked"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Rename stream"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return n.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"form",5),t.DNE(9,Kt,6,2)(10,ne,14,10),t.k0s()(),t.j41(11,"mat-dialog-actions",6)(12,"div"),t.DNE(13,ie,2,2,"mat-slide-toggle",7),t.k0s(),t.j41(14,"div")(15,"button",8),t.bIt("click",function(){return n.closeDialog()}),t.EFF(16,"Cancel"),t.k0s(),t.j41(17,"button",9),t.bIt("click",function(){return n.rename()}),t.EFF(18," Rename "),t.k0s()()()()),2&i&&(t.R7$(8),t.Y8G("formGroup",n.form),t.R7$(),t.vxM(n.isSource&&n.pipelineResultExists?-1:9),t.R7$(),t.vxM(n.isSource&&n.pipelineResultExists?10:-1),t.R7$(3),t.vxM(n.isSource&&n.pipelineResultExists?13:-1),t.R7$(4),t.Y8G("disabled",!n.form.valid))},dependencies:[j.Hl,j.$z,j.iY,u.m_,u.An,A.YN,A.qT,A.me,A.BC,A.cb,A.YS,A.X1,A.j4,A.JD,H.RG,H.rl,H.nJ,H.yw,it.fS,it.fg,ot.Ve,ot.VO,nt.wT,nt.Sy,m.YU,w.E7,c.mV,c.sG,Qt.F,Ht.c],encapsulation:2})}}return o})();const se={all:!0,addEndpoint:!0},x="dataSource_";class J{#t;#e;#n;#i;#p;#l;#o;#s;#a;constructor(a,e,i,n,s,l,p,D,b){this.jsPlumbRoot=a,this.pipelineModel=e,this.dataSources=i,this.onConnectionsChanged=n,this.onDragend=s,this.onDebugStream=l,this.matDialog=p,this.viewContainerRef=D,this.changeDetectorRef=b,this.log=(0,K.T)({Plumber:J},se),this.#e=0,this.#n={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.#i=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.#p=this.#i.length-1,this.#l={},this.#o=!1,this.#a=new Y(this),this.#t=window.jsPlumb.getInstance(this.#d(this.jsPlumbRoot)),this.#t.batch(()=>{this.#u(),this.#m(),this.#h()}),this.#t.repaintEverything()}destroy(){this.#s?.close(),this.#t.reset(),this.#t.unbindContainer()}removeEndpointsOnDataSource(a){const e=x+a;this.#o=!0,this.#t.batch(()=>{this.#t.selectEndpoints({element:e}).delete()}),this.#o=!1}getAllConnections(){return this.#t.getAllConnections().map(e=>({From:e.sourceId.replace(x,""),Out:e.endpoints[0].getOverlay("endpointLabel").label,To:e.targetId.replace(x,""),In:e.endpoints[1].getOverlay("endpointLabel").label}))}getStreamsOut(){const a=[];return this.#t.selectEndpoints({target:x+"Out"}).each(i=>{a.push(i.getOverlay("endpointLabel").label)}),a.join(",")}putEntityCountOnConnections(a){a.Streams?.forEach(e=>{const i=x+e.Source,s=["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(e.Target)?x+"Out":x+e.Target,l=i+"_out_"+e.SourceOut,p=s+"_in_"+e.TargetIn;this.#t.getEndpoint(l)?.connections?.filter(b=>b.endpoints[1].getUuid()===p)?.forEach(b=>{const S=e.Error?"":e.Count.toString();b.setLabel({label:S,cssClass:"streamEntitiesCount "+(e.Error?"streamEntitiesError":""),events:{click:$=>{this.pipelineModel.Pipeline.AllowEdit&&this.onDebugStream(e)}}})})})}#r(a){return this.#l[a]||(this.#l[a]=Object.assign({},this.#n,{stroke:this.#i[this.#e++%this.#p]}))}#d(a){return{Container:a,Connector:["Bezier",{curviness:70}],PaintStyle:this.#r("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}#u(){const a=this.log.fnCond(!1,"initDomDataSources");for(const e of this.pipelineModel.DataSources){const i=this.jsPlumbRoot.querySelector("#"+x+e.EntityGuid);if(!i)continue;const n=this.dataSources.find(p=>p.PartAssemblyAndType===e.PartAssemblyAndType);if(!n)continue;this.pipelineModel.Pipeline.AllowEdit&&this.#t.draggable(i,{grid:[20,20],stop:p=>{const b=p.el.id.replace(x,""),S={Top:p.finalPos[1],Left:p.finalPos[0]};setTimeout(()=>{this.onDragend(b,S)})}});const s=n.Out?.length??0;a.a("dataSource.Out",{outCount:s,out:n.Out}),n.Out?.forEach(p=>{this.#c(i,p,!1,e,s)});const l=n.In?.length??0;if(a.a("dataSource.In",{inCount:l,in:n.In}),n.In?.forEach(p=>{this.#c(i,p,!0,e,l)}),n.In){const p=this.#a.buildTargetEndpoint(e.EntityGuid);p.maxConnections=-1,this.#t.makeTarget(i,p)}n.DynamicOut&&this.#t.makeSource(i,this.#a.buildSourceEndpoint(e.EntityGuid),{filter:".add-endpoint"})}a.end()}#m(){const a=this.log.fn("initWirings"),e=this.pipelineModel.Pipeline.StreamWiring;if(!e)return a.end("no wirings");const i=at(e,s=>s.To),n=at(e,s=>s.From);a.values({inGroups:i,outGroups:n}),e.forEach(s=>{const l=x+s.From,p=l+"_out_"+s.Out,D=x+s.To,b=D+"_in_"+s.In;if(!this.#t.getEndpoint(p)){const S=this.jsPlumbRoot.querySelector("#"+l);if(!S)return;const k=S.id.replace(x,""),$=this.pipelineModel.DataSources.find(U=>U.EntityGuid===k);this.#c(S,s.Out,!1,$,n[s.From].length)}if(!this.#t.getEndpoint(b)){const S=this.jsPlumbRoot.querySelector("#"+D);if(!S)return;const k=S.id.replace(x,""),$=this.pipelineModel.DataSources.find(U=>U.EntityGuid===k);this.#c(S,s.In,!0,$,i[s.To].length)}try{this.#t.connect({uuids:[p,b],paintStyle:this.#r(p)})}catch{console.error({message:"Connection failed",from:p,to:b})}}),a.end()}#c(a,e,i,n,s=0){const l=this.log.fnIf("addEndpoint",{endpointName:e,isIn:i,queryDs:n}),p=this.dataSources.find(W=>W.PartAssemblyAndType===n.PartAssemblyAndType),D=i?p.In:p.Out,b=D?.some(W=>this.#a.getEndpointInfo(W,!1)),S=this.#a.getEndpointInfo(e,b);let k;l.a(`endpointInfo ${s}`,{dataSource:p,connectionList:D,isDynamic:b,count:s,endpointInfo:S}),k=b?"dynamic":S.required?this.pipelineModel.Pipeline.StreamWiring?.some(ct=>x+ct.To===a.id&&ct.In===S.name)?"":"required":"";const $=a.id+(i?"_in_":"_out_")+S.name,U=s>3,Ge=i?this.#a.buildTargetEndpoint(n.EntityGuid,k):this.#a.buildSourceEndpoint(n.EntityGuid,k),Z=this.#t.addEndpoint(a,Ge,{uuid:$,enabled:this.pipelineModel.Pipeline.AllowEdit||n.EntityGuid===h.YX.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel");Z.setLabel(S.name),U&&Z.addClass("angled"),l.end("end",{count:s,angled:U,overlay:Z})}onChangeLabel(a,e,i){if(!this.pipelineModel.Pipeline.AllowEdit)return;const n=a.getOverlay?a.getOverlay("endpointLabel"):a;this.#s=this.matDialog.open(oe,{autoFocus:!1,data:{pipelineDataSourceGuid:i,isSource:e,label:n.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.#s.afterClosed().subscribe(l=>{l&&(n.setLabel(l),setTimeout(()=>this.onConnectionsChanged()))}),this.changeDetectorRef.markForCheck()}#h(){this.#t.bind("connectionDetached",a=>{if(this.#o)return;const e=a.target,i=this.pipelineModel.DataSources.find(p=>p.EntityGuid===e.id.replace(x,"")),n=this.dataSources.find(p=>p.PartAssemblyAndType===i.PartAssemblyAndType),s=a.targetEndpoint.getOverlay("endpointLabel").label;!n.In.some(p=>this.#a.getEndpointInfo(p,!1).name===s)&&this.#t.deleteEndpoint(a.targetEndpoint),setTimeout(()=>{this.onConnectionsChanged()})}),this.#t.bind("connection",a=>{if(a.sourceId===a.targetId)return void setTimeout(()=>{this.#t.deleteConnection(a.connection,{fireEvent:!1}),setTimeout(()=>this.onConnectionsChanged())});const e=a.targetEndpoint.getOverlay("endpointLabel"),i=e.getLabel();this.#t.getEndpoints(a.target.id).some(l=>l.getOverlay("endpointLabel").getLabel()===i&&a.targetEndpoint.id!==l.id&&l.canvas.classList.contains("targetEndpoint"))&&e.setLabel(`PleaseRename${Math.floor(99999*Math.random())}`),setTimeout(()=>{this.onConnectionsChanged()})})}}const at=(o,a)=>o.reduce((e,i)=>((e[a(i)]||=[]).push(i),e),{}),re=["domRoot"],le=["domDataSource"],ce=(o,a,e)=>({top:o,left:a,"min-width":e}),pe=o=>({"show-details":o});function de(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",16),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG(3);return t.Njj(s.configureDataSource(n))}),t.EFF(1," settings "),t.k0s()}}function ue(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",17),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG(3);return t.Njj(s.openHelp(s.typeInfos()[n.EntityGuid].HelpLink))}),t.EFF(1," help_outline "),t.k0s()}}function me(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",18),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG(3);return t.Njj(s.remove(n))}),t.EFF(1," delete "),t.k0s()}}function he(o,a){if(1&o&&(t.j41(0,"tr",21)(1,"td",22),t.EFF(2),t.k0s(),t.j41(3,"td",23),t.EFF(4),t.k0s()()),2&o){const e=a.$implicit;t.R7$(),t.Y8G("title",e.name),t.R7$(),t.JRh(e.name),t.R7$(),t.Y8G("title",e.value),t.R7$(),t.JRh(e.value)}}function _e(o,a){if(1&o&&(t.nrm(0,"hr",19),t.j41(1,"table",20),t.Z7z(2,he,5,4,"tr",21,t.fX1),t.k0s()),2&o){const e=t.XpG().$implicit,i=t.XpG(3);t.R7$(2),t.Dyx(i.vsSvc.dataSourceConfigs()[e.EntityId])}}function ge(o,a){1&o&&t.nrm(0,"div",14)}function fe(o,a){1&o&&t.nrm(0,"div",15)}function ve(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",3,1)(2,"div",4)(3,"mat-icon",5),t.EFF(4),t.k0s(),t.DNE(5,de,2,0,"mat-icon",6)(6,ue,2,0,"mat-icon",7),t.k0s(),t.j41(7,"div",8),t.DNE(8,me,2,0,"mat-icon",9),t.k0s(),t.j41(9,"div",10),t.bIt("click",function(){const n=t.eBV(e).$implicit,s=t.XpG(3);return t.Njj(s.vsSvc.pipelineModel().Pipeline.AllowEdit&&s.editName(n))}),t.j41(10,"span"),t.EFF(11),t.k0s(),t.j41(12,"mat-icon",11),t.EFF(13,"edit"),t.k0s()(),t.nrm(14,"br"),t.j41(15,"div",12),t.bIt("click",function(){const n=t.eBV(e).$implicit,s=t.XpG(3);return t.Njj(s.vsSvc.pipelineModel().Pipeline.AllowEdit&&s.editDescription(n))}),t.j41(16,"span"),t.EFF(17),t.k0s(),t.j41(18,"mat-icon",11),t.EFF(19,"edit"),t.k0s()(),t.nrm(20,"br"),t.DNE(21,_e,4,0),t.j41(22,"div",13),t.EFF(23),t.k0s(),t.DNE(24,ge,1,0,"div",14)(25,fe,1,0,"div",15),t.k0s()}if(2&o){let e,i;const n=a.$implicit,s=t.XpG(3);t.Y8G("id",s.dataSrcIdPrefix+n.EntityGuid)("ngStyle",t.sMw(15,ce,n.VisualDesignerData.Top+"px",n.VisualDesignerData.Left+"px",n.VisualDesignerData.Width?n.VisualDesignerData.Width+"px":null))("ngClass",t.eq3(19,pe,s.showDataSourceDetails()&&(null==(e=s.vsSvc.dataSourceConfigs()[n.EntityId])?null:e.length))),t.R7$(3),t.Y8G("title",s.typeInfos()[n.EntityGuid].UiHint),t.R7$(),t.SpI(" ",s.typeInfos()[n.EntityGuid].Icon," "),t.R7$(),t.vxM(s.vsSvc.pipelineModel().Pipeline.AllowEdit&&s.typeInfos()[n.EntityGuid].EnableConfig?5:-1),t.R7$(),t.vxM(s.typeInfos()[n.EntityGuid].HelpLink?6:-1),t.R7$(2),t.vxM(s.vsSvc.pipelineModel().Pipeline.AllowEdit&&!s.isOutDataSource(n)?8:-1),t.R7$(3),t.JRh(n.Name||"(no name)"),t.R7$(6),t.JRh(n.Description),t.R7$(4),t.vxM(s.showDataSourceDetails()&&null!=(i=s.vsSvc.dataSourceConfigs()[n.EntityId])&&i.length?21:-1),t.R7$(),t.Y8G("title",n.PartAssemblyAndType),t.R7$(),t.SpI("Type: ",s.getTypeName(n.PartAssemblyAndType),""),t.R7$(),t.vxM(s.vsSvc.pipelineModel().Pipeline.AllowEdit&&s.typeInfos()[n.EntityGuid].DynamicOut?24:-1),t.R7$(),t.vxM(s.vsSvc.pipelineModel().Pipeline.AllowEdit&&s.typeInfos()[n.EntityGuid].DynamicIn?25:-1)}}function ye(o,a){if(1&o&&t.Z7z(0,ve,26,21,"div",3,t.fX1),2&o){const e=t.XpG(2);t.Dyx(e.vsSvc.pipelineModel().DataSources)}}function Ee(o,a){if(1&o&&(t.j41(0,"div",2,0),t.DNE(2,ye,2,0),t.k0s()),2&o){const e=t.XpG();t.R7$(2),t.vxM(e.hardReset?-1:2)}}const Ce={all:!1,ngAfterViewInit:!1};let rt=(()=>{class o extends et.${#t;#e;#n;constructor(e,i,n,s){super(),this.vsSvc=e,this.changeDetectorRef=i,this.matDialog=n,this.viewContainerRef=s,this.log=(0,K.T)({PlumbEditorComponent:o},Ce),this.dataSrcIdPrefix=x,this.hardReset=!1,this.#e=new $t.t(!1),this.#n=(0,L.d)(q),this.showDataSourceDetails=(0,t.EWP)(()=>(z.i.tryParse(this.vsSvc.pipelineModel()?.Pipeline.VisualDesignerData)??{}).ShowDataSourceDetails??!1),this.typeInfos=(0,t.EWP)(()=>function T(o,a){const e={};for(const i of o){let n;const s=a.find(l=>l.PartAssemblyAndType===i.PartAssemblyAndType);s&&(n={...s.PrimaryType?v[s.PrimaryType]:v.Unknown},null!=s.Icon&&(n.Icon=s.Icon),null!=s.DynamicIn&&(n.DynamicIn=s.DynamicIn),null!=s.DynamicOut&&(n.DynamicOut=s.DynamicOut),null!=s.HelpLink&&(n.HelpLink=s.HelpLink),null!=s.EnableConfig&&(n.EnableConfig=s.EnableConfig),null!=s.UiHint&&(n.UiHint=s.UiHint)),n||(n={...v.Unknown}),e[i.EntityGuid]=n}return e}(this.vsSvc.pipelineModel()?.DataSources??[],this.vsSvc.dataSources()))}ngOnInit(){(0,Lt.P)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],()=>{this.#e.next(!0)}),this.subscriptions.add(this.vsSvc.putEntityCountOnConnections$.subscribe(e=>{this.#t.putEntityCountOnConnections(e)}))}ngAfterViewInit(){const e=this.log.fnIf("ngAfterViewInit"),i=this.domDataSourcesRef.changes.pipe((0,B.T)(()=>!0));this.subscriptions.add((0,Ut.z)([this.#e,i]).subscribe(([n,s])=>{!n||!s||(e.a("scriptLoaded and domDataSourcesLoaded",{scriptLoaded:n,domDataSourcesLoaded:s}),this.#t?.destroy(),this.#t=new J(this.domRootRef.nativeElement,this.vsSvc.pipelineModel(),this.vsSvc.dataSources(),this.onConnectionsChanged.bind(this),this.onDragend.bind(this),this.onDebugStream.bind(this),this.matDialog,this.viewContainerRef,this.changeDetectorRef))})),e.end()}ngOnDestroy(){this.#t?.destroy(),this.#e.complete(),super.ngOnDestroy()}onConnectionsChanged(){const e=this.#t.getAllConnections(),i=this.#t.getStreamsOut();this.vsSvc.changeConnections(e,i)}onDragend(e,i){this.vsSvc.changeDataSourcePosition(e,i)}onDebugStream(e){this.vsSvc.debugStream(e)}configureDataSource(e){if(e.EntityGuid.includes("unsaved"))return this.vsSvc.saveAndRun(!0,!1);this.vsSvc.editDataSource(e)}getTypeName(e){const i=this.vsSvc.dataSources().find(n=>n.PartAssemblyAndType===e);return this.#n.typeNameFilter(i?.TypeNameForUi||e,"className")}isOutDataSource(e){return e.PartAssemblyAndType===h.YX.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(e){if(!confirm(`Delete ${e.Name} data source?`))return;this.#t.removeEndpointsOnDataSource(e.EntityGuid);const i=this.#t.getAllConnections(),n=this.#t.getStreamsOut();this.vsSvc.removeDataSource(e.EntityGuid,i,n)}openHelp(e){window.open(e,"_blank")}editName(e){const i=prompt("Rename data source",e.Name)?.trim();null==i||""===i||this.vsSvc.renameDataSource(e.EntityGuid,i)}editDescription(e){const i=prompt("Edit description",e.Description)?.trim();null!=i&&this.vsSvc.changeDataSourceDescription(e.EntityGuid,i)}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(X),t.rXU(t.gRc),t.rXU(w.bZ),t.rXU(t.c1b))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-plumb-editor"]],viewQuery:function(i,n){if(1&i&&(t.GBs(re,5),t.GBs(le,5)),2&i){let s;t.mGM(s=t.lsd())&&(n.domRootRef=s.first),t.mGM(s=t.lsd())&&(n.domDataSourcesRef=s)}},standalone:!0,features:[t.Vt3,t.aNF],decls:1,vars:1,consts:[["domRoot",""],["domDataSource",""],["id","pipeline-root"],[1,"dataSource",3,"id","ngStyle","ngClass"],[1,"actions","left"],[1,"type-info",3,"title"],["title","Configure data source","appMousedownStopPropagation","",1,"configure"],["title","Help for this data source","appMousedownStopPropagation","",1,"help"],[1,"actions","right"],["title","Delete","appMousedownStopPropagation","",1,"delete"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"]],template:function(i,n){1&i&&t.DNE(0,Ee,3,1,"div",2),2&i&&t.vxM(n.vsSvc.pipelineModel()?0:-1)},dependencies:[m.B3,m.YU,u.m_,u.An,Nt.z],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}\n\n/*# sourceMappingURL=https://sources.2sxc.org/18.06.01/dist/ng-edit/C:/Projects/2sxc/eav-ui/projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.component.ts-angular-inline--1.css.map*/"]})}}return o})();var be=r(4079);function Pe(o,a){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.R7$(),t.SpI(" ",e," ")}}function Re(o,a){if(1&o&&(t.j41(0,"ul",9),t.Z7z(1,Pe,2,1,"li",null,t.fX1),t.k0s()),2&o){let e;const i=t.XpG(2);t.R7$(),t.Dyx(null==(e=i.vsSvc.pipelineModel().Pipeline.Params)?null:e.split("\n"))}}function Ie(o,a){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.R7$(),t.SpI(" ",e," ")}}function xe(o,a){if(1&o&&(t.j41(0,"ul",9),t.Z7z(1,Ie,2,1,"li",null,t.fX1),t.k0s()),2&o){let e;const i=t.XpG(2);t.R7$(),t.Dyx(null==(e=i.vsSvc.pipelineModel().Pipeline.TestParameters)?null:e.split("\n"))}}function Fe(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",5)(1,"span",12),t.EFF(2,"Show DataSource Params"),t.k0s(),t.j41(3,"mat-slide-toggle",13),t.bIt("change",function(n){t.eBV(e);const s=t.XpG(2);return t.Njj(s.showDataSourceDetails(n))}),t.k0s()()}if(2&o){const e=t.XpG(2);t.R7$(3),t.Y8G("checked",e.visualDesignerDataSig().ShowDataSourceDetails)}}function Te(o,a){1&o&&t.nrm(0,"li",16),2&o&&t.Y8G("innerHTML",a.$implicit,t.npT)}function Me(o,a){if(1&o&&(t.j41(0,"div",14)(1,"div",6)(2,"span"),t.EFF(3,"Warnings"),t.k0s(),t.j41(4,"mat-icon",15),t.EFF(5,"warning"),t.k0s()(),t.j41(6,"ol",9),t.Z7z(7,Te,1,1,"li",16,t.fX1),t.k0s()()),2&o){const e=t.XpG(3);t.R7$(7),t.Dyx(e.warningSig())}}function ke(o,a){if(1&o&&t.DNE(0,Me,9,0,"div",14),2&o){const e=t.XpG(2);t.vxM(e.warningSig().length?0:-1)}}function Oe(o,a){if(1&o&&(t.j41(0,"div",10)(1,"div",6),t.EFF(2,"Query Description"),t.k0s(),t.j41(3,"div"),t.EFF(4),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(4),t.JRh(e.vsSvc.pipelineModel().Pipeline.Description)}}function Ae(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.saveAndRunQuery(!0,!0))}),t.EFF(4,"Save and run"),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.saveAndRunQuery(!1,!0))}),t.EFF(6,"Run"),t.k0s(),t.j41(7,"button",4),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.saveAndRunQuery(!0,!1))}),t.EFF(8,"Save"),t.k0s()(),t.j41(9,"div",5)(10,"div",6)(11,"div"),t.EFF(12,"Query Parameters"),t.k0s(),t.j41(13,"div")(14,"button",7),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.editPipeline())}),t.j41(15,"mat-icon"),t.EFF(16,"edit"),t.k0s()(),t.j41(17,"button",8),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.openParamsHelp())}),t.j41(18,"mat-icon"),t.EFF(19,"info"),t.k0s()()()(),t.DNE(20,Re,3,0,"ul",9),t.k0s(),t.j41(21,"div",5)(22,"div",6),t.EFF(23,"Test Parameters"),t.k0s(),t.DNE(24,xe,3,0,"ul",9),t.k0s(),t.DNE(25,Fe,4,1,"div",5)(26,ke,1,1)(27,Oe,5,1,"div",10),t.j41(28,"div",11)(29,"button",4),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.openRestApi())}),t.j41(30,"span"),t.EFF(31,"Use in JSON / REST API"),t.k0s(),t.j41(32,"mat-icon"),t.EFF(33,"code_curly"),t.k0s()()()()()}if(2&o){let e,i;const n=t.XpG();t.R7$(20),t.vxM(null!=(e=n.vsSvc.pipelineModel().Pipeline.Params)&&e.length?20:-1),t.R7$(4),t.vxM(null!=(i=n.vsSvc.pipelineModel().Pipeline.TestParameters)&&i.length?24:-1),t.R7$(),t.vxM(n.visualDesignerDataSig()?25:-1),t.R7$(),t.vxM(n.warningSig()?26:-1),t.R7$(),t.vxM(n.vsSvc.pipelineModel().Pipeline.Description?27:-1)}}let je=(()=>{class o{#t;constructor(e,i){this.context=e,this.vsSvc=i,this.warningSig=(0,t.vPA)(function De(o,a){if(!o)return[];const e=[];try{const i=o.Pipeline.Params?.split(/\r?\n/)||[],n=o.Pipeline.TestParameters?.split(/\r?\n/)||[];i.forEach(s=>{s=s?.trim(),s&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(s)||e.push(`\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        `))}),n.forEach(s=>{if(s=s?.trim(),!s)return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(s)||e.push(`\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        `);const b=/^\[module:id\]=([0-9]*)$/gim.exec(s);if(b){const $=b[1],U=a.moduleId?.toString();$!==U&&e.push(`\n            Your test ModuleId (${$}) is different from the current ModuleId (${U}).<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          `)}/^\[module:moduleid\]=([0-9]*)$/gim.exec(s)&&e.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")})}catch(i){console.error("Something went wrong in calculateWarnings for params",i)}return e}(this.vsSvc?.pipelineModel()??null,this.context)),this.visualDesignerDataSig=(0,t.vPA)(z.i.tryParse(this.vsSvc?.pipelineModel()?.Pipeline.VisualDesignerData)??{}),this.#t=(0,L.d)(tt.c)}editPipeline(){this.vsSvc.editPipelineEntity()}openParamsHelp(){window.open("https://go.2sxc.org/QueryParams","_blank")}saveAndRunQuery(e,i){this.vsSvc.saveAndRun(e,i)}showDataSourceDetails(e){this.vsSvc.showDataSourceDetails(e.checked)}openRestApi(){const e=this.vsSvc.pipelineModel().Pipeline.EntityGuid;this.#t.navRelative([be.N5.getUrlQueryDialog(e)])}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(f.o),t.rXU(X))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-run-explorer"]],standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],[1,"values"],[1,"description"],[1,"footer-actions"],[1,"eav-slide-toggle-label"],["color","primary",3,"change","checked"],[1,"warnings"],[2,"color","red"],[3,"innerHTML"]],template:function(i,n){1&i&&t.DNE(0,Ae,34,5,"div",0),2&i&&t.vxM(n.vsSvc.pipelineModel()?0:-1)},dependencies:[j.Hl,j.$z,j.iY,u.m_,u.An,c.mV,c.sG],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}.eav-slide-toggle-label[_ngcontent-%COMP%]{margin-right:4px;font-size:14px}"]})}}return o})();const lt=o=>({active:o});let we=(()=>{class o{constructor(e,i,n){this.context=e,this.route=i,this.visualQueryService=n,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(e){this.activeExplorer=this.activeExplorer===e?null:e}openHelp(){window.open("https://go.2sxc.org/visual-query","_blank")}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(f.o),t.rXU(d.nX),t.rXU(X))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-visual-query"]],viewQuery:function(i,n){if(1&i&&t.GBs(rt,5),2&i){let s;t.mGM(s=t.lsd())&&(n.plumbEditor=s.first)}},standalone:!0,features:[t.Jv_([X]),t.aNF],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"click","ngClass"],["tippy","Add",1,"button",3,"click","ngClass"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(i,n){1&i&&(t.nrm(0,"router-outlet"),t.j41(1,"div",0)(2,"div",1)(3,"div",2),t.bIt("click",function(){return n.toggleExplorer(n.explorer.run)}),t.j41(4,"mat-icon"),t.EFF(5,"play_arrow"),t.k0s()(),t.j41(6,"div",3),t.bIt("click",function(){return n.toggleExplorer(n.explorer.add)}),t.j41(7,"mat-icon"),t.EFF(8,"add"),t.k0s()(),t.nrm(9,"div",4),t.j41(10,"div",5),t.bIt("click",function(){return n.openHelp()}),t.j41(11,"mat-icon"),t.EFF(12,"help_outline"),t.k0s()()(),t.nrm(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),t.k0s()),2&i&&(t.R7$(3),t.Y8G("ngClass",t.eq3(4,lt,n.activeExplorer===n.explorer.run)),t.R7$(3),t.Y8G("ngClass",t.eq3(6,lt,n.activeExplorer===n.explorer.add)),t.R7$(7),t.Y8G("hidden",n.activeExplorer!==n.explorer.run),t.R7$(),t.Y8G("hidden",n.activeExplorer!==n.explorer.add))},dependencies:[d.n3,m.YU,u.m_,u.An,je,Gt,rt],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}}return o})()},5839:(F,_,r)=>{r.d(_,{A:()=>u});const u=function m(d,f){for(var t=-1,c=null==d?0:d.length;++t<c&&!1!==f(d[t],t,d););return d}},9934:(F,_,r)=>{r.d(_,{A:()=>f});var m=r(3151),u=Object.create;const f=function(){function t(){}return function(c){if(!(0,m.A)(c))return{};if(u)return u(c);t.prototype=c;var h=new t;return t.prototype=void 0,h}}()},2549:(F,_,r)=>{r.d(_,{A:()=>d});const d=(0,r(9093).A)(Object.getPrototypeOf,Object)}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.06.01/dist/ng-edit/projects_eav-ui_src_app_visual-query_visual-query_component_ts-node_modules_lodash-es__arrayE-ac6327.d07bbcd06584ccd8.js.map