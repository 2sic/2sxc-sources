import{a as fe}from"./chunk-FIBQFWU3.js";import{a as ce}from"./chunk-PSAFKHUD.js";import{a as de}from"./chunk-WO7E65AC.js";import{a as ue}from"./chunk-SXZJT35J.js";import{f as pe}from"./chunk-VSMYOUA2.js";import"./chunk-O3YSC345.js";import{a as me}from"./chunk-AAMPB3UT.js";import{a as oe}from"./chunk-J5KNE364.js";import{e as g}from"./chunk-RAUQWANF.js";import{a as re}from"./chunk-3S44UA6M.js";import{b as ae,d as se}from"./chunk-S7Y6G6OZ.js";import{a as le}from"./chunk-JZD2T5W2.js";import{a as he}from"./chunk-M3LSK7IW.js";import{a as ie,b as ne}from"./chunk-NKT65OQW.js";import"./chunk-NIPOW2E2.js";import{a as K}from"./chunk-ORK43FFD.js";import"./chunk-56YE37V6.js";import{a as W}from"./chunk-V5UC4TMG.js";import"./chunk-U657U553.js";import"./chunk-QFYVXC4V.js";import{a as J}from"./chunk-L77E4UL2.js";import"./chunk-JNRBLGLU.js";import"./chunk-4YE3E6NH.js";import"./chunk-ZBQC6E3M.js";import"./chunk-AO43RQAG.js";import"./chunk-SCB2MVKQ.js";import"./chunk-4SMJHLGZ.js";import{a as X,b as Z,c as q,d as ee,e as te}from"./chunk-TH3YUOZ2.js";import"./chunk-JEQANFI7.js";import{a as P}from"./chunk-564RKXG7.js";import{c as w}from"./chunk-HJXR3IL7.js";import"./chunk-K5FCDENP.js";import"./chunk-R3Y7P2GW.js";import"./chunk-LPOE4446.js";import"./chunk-WAPW5AUJ.js";import"./chunk-ENHI5GWA.js";import"./chunk-IGMB27B5.js";import"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as L}from"./chunk-HCPBPEHV.js";import{c as H,g as z,h as U,i as $,l as N}from"./chunk-QVLOO535.js";import{c as I}from"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import"./chunk-UMOPET3G.js";import"./chunk-EZZQWHAZ.js";import{b as E,c as S}from"./chunk-23CS2WID.js";import{a as x}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{d as G}from"./chunk-OYQCZWOE.js";import{d as j,g as Y}from"./chunk-G33ZJSCE.js";import{aa as A,ca as F}from"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$a as Q,$b as O,Aa as R,Cb as l,Db as o,Eb as r,Fb as D,Gc as V,Nb as k,Pa as d,Pb as h,Rb as p,Sa as s,db as T,ec as a,ja as _,jb as B,oa as v,pa as M,wb as C,yb as y}from"./chunk-46QINP2S.js";import{a as c,b as f}from"./chunk-BDOJB7O2.js";var m=(function(i){return i[i.Edit=0]="Edit",i[i.Metadata=1]="Metadata",i[i.Rest=2]="Rest",i[i.Clone=3]="Clone",i[i.Permissions=4]="Permissions",i[i.Export=5]="Export",i[i.Delete=6]="Delete",i})(m||{});function xe(i,b){if(i&1&&(o(0,"a",3)(1,"mat-icon",9),a(2," local_offer "),r()()),i&2){let e=p();l("href",e.params.urlTo(e.actions.Metadata,e.item),d),s(),l("matBadge",e.item.Metadata==null?null:e.item.Metadata.length)("matBadgeHidden",!(e.item.Metadata!=null&&e.item.Metadata.length))}}function be(i,b){if(i&1&&(o(0,"div",4)(1,"mat-icon",10),a(2," local_offer "),r()()),i&2){let e=p();s(),l("matBadge",e.item.Metadata==null?null:e.item.Metadata.length)("matBadgeHidden",!(e.item.Metadata!=null&&e.item.Metadata.length))}}function ve(i,b){if(i&1&&(o(0,"a",5)(1,"mat-icon",9),a(2," person "),r()()),i&2){let e=p();l("href",e.params.urlTo(e.actions.Permissions,e.item),d),s(),l("matBadge",e.item._Permissions.Count)("matBadgeHidden",!e.item._Permissions.Count)}}function Me(i,b){if(i&1&&(o(0,"div",4)(1,"mat-icon",10),a(2," person "),r()()),i&2){let e=p();s(),l("matBadge",e.item._Permissions.Count)("matBadgeHidden",!e.item._Permissions.Count)}}function Te(i,b){if(i&1){let e=k();o(0,"a",11),D(1,"mat-icon",12),o(2,"span"),a(3,"REST API"),r()(),o(4,"button",13),h("click",function(){v(e);let t=p();return M(t.params.do(t.actions.Clone,t.item))}),o(5,"mat-icon"),a(6,"file_copy"),r(),o(7,"span"),a(8,"Copy"),r()(),o(9,"button",13),h("click",function(){v(e);let t=p();return M(t.params.do(t.actions.Export,t.item))}),o(10,"mat-icon"),a(11,"cloud_download"),r(),o(12,"span"),a(13,"Export"),r()(),o(14,"button",14),h("click",function(){v(e);let t=p();return M(t.params.do(t.actions.Delete,t.item))}),o(15,"mat-icon"),a(16,"delete"),r(),o(17,"span"),a(18,"Delete"),r()()}if(i&2){let e=p();l("href",e.params.urlTo(e.actions.Rest,e.item),d),s(14),l("disabled",e.item._EditInfo.DisableDelete)}}var ge=(()=>{class i{constructor(){this.actions=m}agInit(e){this.params=e,this.item=this.params.data,this.enablePermissions=this.params.getEnablePermissions()}refresh(e){return!0}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=T({type:i,selectors:[["app-queries-actions"]],decls:14,vars:6,consts:[["menu","matMenu"],[1,"actions-component"],["matRipple","","tippy","Edit",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","Metadata",1,"eav-grid-action-button","default-link","highlight",3,"href"],[1,"eav-grid-action-button","disabled"],["matRipple","","tippy","Permissions",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["matMenuContent",""],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"],["matBadgeColor","accent","matBadgeSize","small","matBadgeDisabled","true","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"],["mat-menu-item","",1,"default-link",3,"href"],["svgIcon","code-curly"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"]],template:function(n,t){if(n&1&&(o(0,"div",1)(1,"a",2)(2,"mat-icon"),a(3,"edit"),r()(),C(4,xe,3,3,"a",3),C(5,be,3,2,"div",4),C(6,ve,3,3,"a",5),C(7,Me,3,2,"div",4),o(8,"div",6)(9,"mat-icon"),a(10,"more_horiz"),r()()(),o(11,"mat-menu",7,0),B(13,Te,19,2,"ng-template",8),r()),n&2){let u=O(12);s(),l("href",t.params.urlTo(t.actions.Edit,t.item),d),s(3),y(t.item._EditInfo.DisableMetadata?-1:4),s(),y(t.item._EditInfo.DisableMetadata?5:-1),s(),y(!t.item._EditInfo.DisableEdit&&t.enablePermissions?6:-1),s(),y(t.item._EditInfo.DisableEdit||!t.enablePermissions?7:-1),s(),l("matMenuTriggerFor",u)}},dependencies:[z,H,S,E,ne,ie,te,q,X,Z,ee,I],encapsulation:2})}}return i})();var De={all:!1,urlToOpenVisualQueryDesigner:!0,titleCellRenderer:!0,cloneQuery:!1,deleteQuery:!1,exportQuery:!1},ht=(()=>{class i{constructor(){this.log=A({QueriesComponent:i},De),this.#t=x(pe),this.#a=x(fe),this.#i=x(K),this.#s=x(W),this.#l=_(F),this.#n=_(L),this.#m=_(j),this.#p=_(Q),this.#o={empty:{description:"<p><b>This is where you manage Visual Queries</b><br>They help you select/sort/filter and publish data.</p>",hint:"<p>Click the (+) in the bottom right corner to create your first Visual Query.</p>"},content:{description:"<p><b>This is where you manage Visual Queries</b><br>They help you select/sort/filter and publish data.</p>",hint:"<p>Click on the title to edit the Visual Query. <br>You can also configure permissions, or copy or export the queries.</p>"}},this.uxHelpText=V(()=>this.queries()?.length===0?this.#o.empty:this.#o.content),this.gridOptions=this.buildGridOptions(),this.refresh=R(0),this.queries=this.#t.getAllLive(w.contentTypes.query,this.refresh).value}#t;#a;#i;#s;#l;#n;#m;#p;#o;ngOnInit(){this.#i.doOnDialogClosed(()=>this.#r()),this.#s.getCurrent$().subscribe(e=>{this.enablePermissions=e.Context.Enable.AppPermissions})}urlToImportQuery(){return this.#e("import")}importQuery(e){this.#i.navRelative(["import"],{state:{files:e}})}urlToNewQuery(){return this.#d(null)}#r(){this.refresh.update(e=>++e)}#e(e){return`#${this.#i.urlSubRoute(e)}`}#d(e){return this.#e(`edit/${J({items:[e==null?P.newFromType(w.contentTypes.query,{TestParameters:w.pipelineDesigner.testParameters}):P.editId(e.Id)]})}`)}#u(e){return"#/"+new he().routeTo(this.#l,`query/${e.Id}`)}#c(e){return this.#e(ce.getUrlEntity(e.Guid,`Metadata for Query: ${e.Name} (${e.Id})`))}#f(e){return this.#e(le.getUrlEntity(e.Guid))}#h(e){return this.#e(de.getUrlQueryInAdmin(e.Guid))}cloneQuery(e){let n=this.log.fnIf("cloneQuery",{query:e});this.#n.open("Copying..."),this.#t.clonePipelinePromise(e.Id).then(()=>{this.#n.open("Copied",null,{duration:2e3}),this.#r()}),n.end()}exportQuery(e){let n=this.log.fnIf("exportQuery",{query:e});this.#a.exportEntity(e.Id,"Query",!0),n.end()}deleteQuery(e){let n=this.log.fnIf("deleteQuery",{query:e});this.#m.open(oe,{autoFocus:!1,data:{entityId:e.Id,entityTitle:e.Name,message:"Delete Query?",hasDeleteSnackbar:!0},viewContainerRef:this.#p,width:"400px"}).afterClosed().subscribe(t=>{t&&this.#t.delete(e.Id).subscribe(u=>{this.#n.open("Deleted",null,{duration:2e3}),this.#r()})}),n.end()}#g(e){let n=this.log.fnIf("titleCellRenderer",{query:e}),t=this.#u(e);return n.values({url:t}),`<a href="${t}" target="_blank" class="default-link" style="display: block; width: 100%; height: 100%;">
              ${e.Name}
            </a>`}buildGridOptions(){return f(c({},re),{columnDefs:[f(c({},g.IdWithDefaultRenderer),{cellClass:n=>`id-action no-padding no-outline ${n.data._EditInfo.ReadOnly?"disabled":""}`.split(" "),cellRendererParams:g.idFieldParamsTooltipGetter()}),f(c({},g.TextWide),{field:"Name",sort:"asc",cellClass:n=>`${n.data._EditInfo.DisableEdit?"no-outline":"primary-action highlight"}`.split(" "),cellRenderer:n=>this.#g(n.data)}),f(c({},g.TextWideFlex3),{field:"Description"}),f(c({},g.ActionsPinnedRight4),{cellRenderer:ge,cellRendererParams:{getEnablePermissions:()=>this.enablePermissions,do:(n,t)=>{switch(n){case m.Clone:return this.cloneQuery(t);case m.Export:return this.exportQuery(t);case m.Delete:return this.deleteQuery(t)}},urlTo:(n,t)=>{switch(n){case m.Edit:return this.#d(t);case m.Metadata:return this.#c(t);case m.Rest:return this.#h(t);case m.Permissions:return this.#f(t)}}}})]})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=T({type:i,selectors:[["app-queries"]],decls:12,vars:8,consts:[[3,"helpText","refresh","rowLength"],["appDragAndDrop","",1,"ag-theme-material",3,"filesDropped","rowData","gridOptions","allowedFileTypes"],[1,"eav-dialog-actions"],["mat-button","","tippy","Import query","tippyPlacement","top",1,"eav-button__with-icon",3,"href"],[1,"eav-icon"],["mat-fab","","mat-elevation-z24","","tippy","Create a new query","tippyPlacement","top",1,"grid-fab",3,"href"]],template:function(n,t){if(n&1&&(o(0,"app-grid-with-help",0)(1,"ag-grid-angular",1),h("filesDropped",function(_e){return t.importQuery(_e)}),r(),o(2,"mat-dialog-actions",2)(3,"a",3)(4,"mat-icon",4),a(5,"cloud_upload"),r(),o(6,"span"),a(7,"Query"),r()(),o(8,"a",5)(9,"mat-icon"),a(10,"add"),r()()()(),D(11,"router-outlet")),n&2){let u;l("helpText",t.uxHelpText())("refresh",t.refresh())("rowLength",(u=t.queries())==null?null:u.length),s(),l("rowData",t.queries())("gridOptions",t.gridOptions)("allowedFileTypes","json"),s(2),l("href",t.urlToImportQuery(),d),s(5),l("href",t.urlToNewQuery(),d)}},dependencies:[Y,N,U,$,S,E,G,se,ae,me,I,ue],encapsulation:2})}}return i})();export{ht as QueriesComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/queries-OZGWI24Q.js.map
