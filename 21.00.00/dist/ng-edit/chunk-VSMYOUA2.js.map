{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/app-administration/services/pipelines.service.ts"],
  "sourcesContent": ["import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { from, map, switchMap } from 'rxjs';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { toBase64 } from '../../shared/helpers/file-to-base64.helper';\r\nimport { classLog } from '../../shared/logging';\r\nimport { webApiEntityList } from '../../shared/services/entity.service';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { Query } from '../models/query.model';\r\n\r\nconst logSpecs = {\r\n  all: true,\r\n  getAll: false,\r\n  getAllSig: true,\r\n  getAllLive: false,\r\n  getAllRes: true,\r\n  importQuery: false,\r\n  clonePipeline: false,\r\n  delete: false,\r\n  update: false,\r\n};\r\n\r\nconst webApiQueryImport = 'admin/query/import';\r\nconst webApiQueryClone = 'admin/query/Clone';\r\nconst webApiQueryDelete = 'admin/query/Delete';\r\nexport const webApiQueryRun = 'admin/query/Run';\r\nexport const webApiQueryDebugStream = 'admin/query/DebugStream';\r\nexport const webApiQuerySave = 'admin/query/Save';\r\nexport const webApiQueryGet = 'admin/query/Get';\r\nexport const webApiQueryDataSources = 'admin/query/DataSources';\r\n\r\n@Injectable()\r\nexport class PipelinesService extends HttpServiceBase {\r\n\r\n  log = classLog({ PipelinesService }, logSpecs);\r\n  // TODO: @2dg, ask 2dm \r\n  getAll(contentType: string) {\r\n    const l = this.log.fnIf('getAll');\r\n    return l.r(this.getHttpApiUrl<Query[]>(webApiEntityList, {\r\n      params: { appId: this.appId, contentType }\r\n    }));\r\n  }\r\n\r\n  // Full Code, repated x times\r\n  getAllLive(contentType: string, refresh: Signal<unknown>) {\r\n    this.log.fnIf('getAllLive', { contentType, refresh });\r\n    return httpResource<Query[]>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiEntityList),\r\n        params: { appId: this.appId, contentType: contentType }\r\n      });\r\n    });\r\n  }\r\n\r\n  /** Experimental httpResource use! */\r\n  getAllRes(contentType: string, initial?: Query[]) {\r\n    const l = this.log.fnIf('getAllRes');\r\n    const res = httpResource<Query[]>(() => ({\r\n      url: webApiEntityList,\r\n      params: { appId: this.appId, contentType },\r\n    }), { defaultValue: initial });\r\n    return l.r(res);\r\n  }\r\n\r\n  importQuery(file: File) {\r\n    const l = this.log.fnIf('importQuery');\r\n    const obs = from(toBase64(file)).pipe(\r\n      switchMap(fileBase64 => {\r\n        return this.http.post<boolean>(this.apiUrl(webApiQueryImport), {\r\n          AppId: this.appId,\r\n          ContentBase64: fileBase64,\r\n        });\r\n      }),\r\n      map(success => {\r\n        const result: FileUploadResult = {\r\n          Success: success,\r\n          Messages: [],\r\n        };\r\n        return result;\r\n      }),\r\n    );\r\n    return l.r(obs);\r\n  }\r\n\r\n  clonePipelinePromise(id: number): Promise<null> {\r\n    const l = this.log.fnIf('clonePipeline');\r\n    const obs = this.fetchPromise<null>(webApiQueryClone, {\r\n      params: { Id: id.toString(), appId: this.appId }\r\n    });\r\n    return l.r(obs);\r\n  }\r\n\r\n  delete(id: number) {\r\n    const l = this.log.fnIf('delete');\r\n    const obs = this.http.delete<boolean>(this.apiUrl(webApiQueryDelete), {\r\n      params: { appId: this.appId, Id: id.toString() },\r\n    });\r\n    return l.r(obs);\r\n  }\r\n}\r\n"],
  "mappings": "+OAUA,IAAMA,EAAW,CACfC,IAAK,GACLC,OAAQ,GACRC,UAAW,GACXC,WAAY,GACZC,UAAW,GACXC,YAAa,GACbC,cAAe,GACfC,OAAQ,GACRC,OAAQ,IAGJC,EAAoB,qBACpBC,EAAmB,oBACnBC,EAAoB,qBACbC,EAAiB,kBACjBC,EAAyB,0BACzBC,EAAkB,mBAClBC,EAAiB,kBACjBC,EAAyB,0BAGzBC,GAAiB,IAAA,CAAxB,MAAOA,UAAyBC,CAAe,CADrDC,aAAA,qBAGE,KAAAC,IAAMC,EAAS,CAAEJ,iBAAAA,CAAgB,EAAIlB,CAAQ,EAE7CE,OAAOqB,EAAmB,CAExB,OADU,KAAKF,IAAIG,KAAK,QAAQ,EACvBC,EAAE,KAAKC,cAAuBC,EAAkB,CACvDC,OAAQ,CAAEC,MAAO,KAAKA,MAAON,YAAAA,CAAW,EACzC,CAAC,CACJ,CAGAnB,WAAWmB,EAAqBO,EAAwB,CACtD,YAAKT,IAAIG,KAAK,aAAc,CAAED,YAAAA,EAAaO,QAAAA,CAAO,CAAE,EAC7CC,EAAsB,KAC3BD,EAAO,EACC,CACNE,IAAK,KAAKC,OAAON,CAAgB,EACjCC,OAAQ,CAAEC,MAAO,KAAKA,MAAON,YAAaA,CAAW,GAExD,CACH,CAGAlB,UAAUkB,EAAqBW,EAAiB,CAC9C,IAAMC,EAAI,KAAKd,IAAIG,KAAK,WAAW,EAC7BY,EAAML,EAAsB,KAAO,CACvCC,IAAKL,EACLC,OAAQ,CAAEC,MAAO,KAAKA,MAAON,YAAAA,CAAW,IACxC,CAAIc,aAAcH,CAAO,CAAA,EAC3B,OAAOC,EAAEV,EAAEW,CAAG,CAChB,CAEA9B,YAAYgC,EAAU,CACpB,IAAMH,EAAI,KAAKd,IAAIG,KAAK,aAAa,EAC/Be,EAAMC,EAAKC,EAASH,CAAI,CAAC,EAAEI,KAC/BC,EAAUC,GACD,KAAKC,KAAKC,KAAc,KAAKb,OAAOvB,CAAiB,EAAG,CAC7DqC,MAAO,KAAKlB,MACZmB,cAAeJ,EAChB,CACF,EACDK,EAAIC,IAC+B,CAC/BC,QAASD,EACTE,SAAU,CAAA,GAGb,CAAC,EAEJ,OAAOjB,EAAEV,EAAEc,CAAG,CAChB,CAEAc,qBAAqBC,EAAU,CAC7B,IAAMnB,EAAI,KAAKd,IAAIG,KAAK,eAAe,EACjCe,EAAM,KAAKgB,aAAmB5C,EAAkB,CACpDiB,OAAQ,CAAE4B,GAAIF,EAAGG,SAAQ,EAAI5B,MAAO,KAAKA,KAAK,EAC/C,EACD,OAAOM,EAAEV,EAAEc,CAAG,CAChB,CAEA/B,OAAO8C,EAAU,CACf,IAAMnB,EAAI,KAAKd,IAAIG,KAAK,QAAQ,EAC1Be,EAAM,KAAKM,KAAKrC,OAAgB,KAAKyB,OAAOrB,CAAiB,EAAG,CACpEgB,OAAQ,CAAEC,MAAO,KAAKA,MAAO2B,GAAIF,EAAGG,SAAQ,CAAE,EAC/C,EACD,OAAOtB,EAAEV,EAAEc,CAAG,CAChB,qEAnEWrB,CAAgB,IAAAwC,GAAhBxC,CAAgB,CAAA,CAAA,GAAA,CAAA,iCAAhBA,EAAgByC,QAAhBzC,EAAgB0C,SAAA,CAAA,CAAA,SAAhB1C,CAAiB,GAAA",
  "names": ["logSpecs", "all", "getAll", "getAllSig", "getAllLive", "getAllRes", "importQuery", "clonePipeline", "delete", "update", "webApiQueryImport", "webApiQueryClone", "webApiQueryDelete", "webApiQueryRun", "webApiQueryDebugStream", "webApiQuerySave", "webApiQueryGet", "webApiQueryDataSources", "PipelinesService", "HttpServiceBase", "constructor", "log", "classLog", "contentType", "fnIf", "r", "getHttpApiUrl", "webApiEntityList", "params", "appId", "refresh", "httpResource", "url", "apiUrl", "initial", "l", "res", "defaultValue", "file", "obs", "from", "toBase64", "pipe", "switchMap", "fileBase64", "http", "post", "AppId", "ContentBase64", "map", "success", "Success", "Messages", "clonePipelinePromise", "id", "fetchPromise", "Id", "toString", "__ngFactoryType__", "factory", "\u0275fac"]
}
