import{a as We}from"./chunk-CIVTUAWE.js";import"./chunk-HW433KCS.js";import"./chunk-GLFISIX2.js";import"./chunk-MBSXBYF5.js";import"./chunk-AAMPB3UT.js";import{b as Ne,c as Ge,e as b}from"./chunk-RAUQWANF.js";import{a as He}from"./chunk-3S44UA6M.js";import{a as Ve,b as je,c as Be,d as Ue}from"./chunk-S7Y6G6OZ.js";import{a as Se,b as Re}from"./chunk-BKBBHERO.js";import{a as Pe,b as Ie}from"./chunk-NKT65OQW.js";import"./chunk-NIPOW2E2.js";import{a as Ee}from"./chunk-ORK43FFD.js";import"./chunk-56YE37V6.js";import{a as he}from"./chunk-QFYVXC4V.js";import"./chunk-T7AKPKMZ.js";import{a as be}from"./chunk-L77E4UL2.js";import{a as Le}from"./chunk-ZKDKEYV7.js";import"./chunk-4YE3E6NH.js";import"./chunk-4SMJHLGZ.js";import{a as ve}from"./chunk-564RKXG7.js";import"./chunk-HJXR3IL7.js";import"./chunk-BTK5NHS7.js";import"./chunk-K5FCDENP.js";import{b as De,c as Fe}from"./chunk-ODL7UGWI.js";import"./chunk-R3Y7P2GW.js";import"./chunk-WAPW5AUJ.js";import{a as Te,b as Oe,d as ke,e as k,f as Ae}from"./chunk-HYUOS4CI.js";import"./chunk-ENHI5GWA.js";import"./chunk-IGMB27B5.js";import"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import"./chunk-HCPBPEHV.js";import{c as me,g as ue,h as fe,l as ge}from"./chunk-QVLOO535.js";import{c as C}from"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{g as _e,i as Me,l as ye,v as we}from"./chunk-UMOPET3G.js";import{b as pe,i as ce,j as de}from"./chunk-4LV77BQU.js";import"./chunk-RGKBOUPL.js";import"./chunk-EZZQWHAZ.js";import{b as T,c as O}from"./chunk-23CS2WID.js";import{a as B}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{d as le,e as I}from"./chunk-OYQCZWOE.js";import{d as Ce,g as xe}from"./chunk-G33ZJSCE.js";import"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$a as Y,$b as ne,A as U,Aa as D,Ab as J,Ac as j,Ba as $,Bb as X,Cb as u,Da as Q,Db as a,Eb as r,Fb as G,Ga as K,Hc as re,Lc as S,Nb as Z,Pb as f,Rb as x,Sa as c,Tc as se,Vb as ee,Wb as te,Xb as ie,Za as v,db as g,ec as s,fb as q,fc as h,fd as P,gb as L,gc as H,ja as w,oa as W,pa as z,tc as oe,uc as ae,wb as F,yb as E,zc as V}from"./chunk-46QINP2S.js";import{a as p,b as m,d as R}from"./chunk-BDOJB7O2.js";var _=class n{static expandFeature(l){return p(p({},l),n.getExpiration(l?.expiration))}static expandLicense(l){try{let e=l?.Features?.map(i=>i.expiration).sort()[0];return e==null?l:p(p({},l),n.getExpiration(e))}catch{return l}}static getExpiration(l){let e=(o,d)=>({ExpMessage:(o!=null?o+" ":"")+d,ExpIcon:o,ExpWarningIcon:o!="\u2705"?o:null}),t=l?.split("T")[0];if(t==null)return e(null,null);if(t.startsWith("9999"))return e("\u2705","never");let i=new Date(t);return i<new Date?e("\u{1F6D1}","expired"):i.toDateString()===new Date().toDateString()?e("\u26A0\uFE0F","today"):i.toDateString()===new Date(new Date().setDate(new Date().getDate()+1)).toDateString()?e("\u26A0\uFE0F","tomorrow"):i<new Date(new Date().setDate(new Date().getDate()+30))?e("\u26A0\uFE0F",t):t.endsWith("12-31")?e("\u2705",`EOY ${t.split("-")[0]}`):e("\u2753",t)}};var ze=(()=>{class n{transform(e){return`${e.Features.filter(t=>t.isEnabled).length}/${e.Features.length}`}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275pipe=L({name:"activeFeaturesCount",type:n,pure:!0})}}return n})();var $e=(()=>{class n{constructor(e){this.itemsCount=S(0),this.headerHeight=S(32),this.rowHeight=S(48),this.maxRows=S(100),this.extraHeight=2,this.element=e.nativeElement}ngOnChanges(e){if(e.itemsCount!=null){let t=this.itemsCount()===0?2:this.itemsCount()>this.maxRows()?this.maxRows():this.itemsCount();this.element.style.height=`${this.headerHeight()+t*this.rowHeight()+this.extraHeight}px`}}static{this.\u0275fac=function(t){return new(t||n)(v(K))}}static{this.\u0275dir=q({type:n,selectors:[["","appAgGridHeight",""]],inputs:{itemsCount:[1,"itemsCount"],headerHeight:[1,"headerHeight"],rowHeight:[1,"rowHeight"],maxRows:[1,"maxRows"]},features:[Q]})}}return n})();var Qe=(()=>{class n{agInit(e){this.value=e.value,this.feature=e.data}refresh(e){return!0}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=g({type:n,selectors:[["app-features-list-enabled-reason"]],decls:2,vars:2,consts:[[3,"tippy"]],template:function(t,i){t&1&&(a(0,"div",0),s(1),r()),t&2&&(u("tippy",i.feature.enabledReasonDetailed),c(),h(i.value))},dependencies:[C],encapsulation:2})}}return n})();function Xe(n,l){if(n&1&&(a(0,"mat-icon",3),s(1,"settings"),r()),n&2){let e=x(2);u("matBadge",e.badgeValue)}}function Ze(n,l){n&1&&(a(0,"mat-icon"),s(1,"settings"),r())}function et(n,l){if(n&1){let e=Z();a(0,"a",2),f("click",function(){W(e);let i=x();return z(i.openSettings())}),F(1,Xe,2,1,"mat-icon",3)(2,Ze,2,0,"mat-icon"),r()}if(n&2){let e=x();c(),E(e.badgeValue>0?1:2)}}var Ke=(()=>{class n{constructor(){this.router=w(I)}agInit(e){this.params=e,this.value=e.value,this.configurationContentType=e.data.configurationContentType,this.contentType=e.data,this.configurationData=e.data?.configuration,this.badgeValue=this.configurationData&&Object.keys(this.configurationData).length>0?1:0}refresh(e){return!0}openSettings(){let e=R(this.configurationData??{},[]),t=[p({guid:this.contentType.guid,enabled:this.contentType.enabledInConfiguration},e)],i=this.params.getSettingsUrl(this.contentType),d=(i.startsWith("#")||i.startsWith("/")?i.substring(1):i).split("/");this.router.navigate(d,{state:{returnValue:!0,overrideContents:t}})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=g({type:n,selectors:[["app-features-list-settings"]],decls:4,vars:2,consts:[[1,"icon-container"],["matRipple","","tippy","Open Settings",1,"eav-grid-action-button","default-link","highlight"],["matRipple","","tippy","Open Settings",1,"eav-grid-action-button","default-link","highlight",3,"click"],["matBadgePosition","below after","matBadgeSize","small",3,"matBadge"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"mat-icon"),s(2),r(),F(3,et,3,1,"a",1),r()),t&2&&(c(2),h(i.value?"check_box":"check_box_outline_blank"),c(),E(i.configurationContentType?3:-1))},dependencies:[O,T,Ie,Pe,ue,me,C],styles:[`[_nghost-%COMP%]     .mat-badge-content{background-color:gray!important}
/*# sourceMappingURL=features-list-enabled-45TKH3AI.css.map */`]})}}return n})();var tt=(n,l)=>({"toggle-false":n,"toggle-null":l}),Ye=(()=>{class n{agInit(e){this.params=e,this.value=e.value,this.disabled=e.isDisabled(e.data),this.tooltip=e.tooltipGetter(e.data)}refresh(e){return this.disabled=this.params.isDisabled(this.params.data),!0}toggle(){let e=this.params.data,t;switch(this.value){case!1:t=null;break;case null:t=!0;break;case!0:t=!1;break}this.value=t,this.params.onToggle(e,t)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=g({type:n,selectors:[["app-features-status"]],decls:1,vars:7,consts:[[3,"change","checked","tippy","disabled","ngClass"]],template:function(t,i){t&1&&(a(0,"mat-slide-toggle",0),f("change",function(){return i.toggle()}),r()),t&2&&u("checked",i.value)("tippy",i.tooltip)("disabled",i.disabled)("ngClass",ae(4,tt,i.value===!1,i.value===null))},dependencies:[Re,Se,P,C],styles:[`[_nghost-%COMP%]{height:100%;display:flex;padding-left:12px;padding-right:12px;align-items:center}.mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding-top:0}  .toggle-false.mat-mdc-slide-toggle:not(.mat-mdc-slide-toggle-checked):not(.mat-disabled) .mdc-switch__track:before{background-color:orange!important}  .toggle-null .mdc-switch__handle{margin-left:8px}
/*# sourceMappingURL=features-status-VYFOL54K.css.map */`]})}}return n})();var qe=(()=>{class n{transform(e){return Array.isArray(e)?[...e].sort((i,o)=>i.Priority<o.Priority?-1:i.Priority>o.Priority?1:0):e}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275pipe=L({name:"licensesOrder",type:n,pure:!0})}}return n})();var it=n=>({expanded:n});function nt(n,l){if(n&1&&G(0,"ag-grid-angular",15),n&2){let e=x().$implicit,t=x();u("rowData",e.filteredFeatures)("gridOptions",t.gridOptions)("itemsCount",e.filteredFeatures==null?null:e.filteredFeatures.length)}}function ot(n,l){if(n&1&&(a(0,"mat-expansion-panel",null,0)(2,"mat-expansion-panel-header")(3,"mat-panel-title")(4,"mat-icon",11),s(5),r(),a(6,"div")(7,"div",12)(8,"span"),s(9),r(),a(10,"span",13),s(11),V(12,"activeFeaturesCount"),r(),a(13,"span"),s(14),r()(),a(15,"div",14),s(16),r()()()(),F(17,nt,1,3,"ag-grid-angular",15),r()),n&2){let e=l.$implicit,t=ne(1);c(4),u("tippy",e.IsEnabled?"License is active":"License is not active"),c(),h(e.IsEnabled?"check_circle_outline":"cancel"),c(4),h(e.Name),c(2),h(j(12,8,e)),c(3),H(" ",e.ExpWarningIcon),c(),u("ngClass",oe(10,it,t.expanded)),c(),H(" ",e.Description," "),c(),E(t.expanded?17:-1)}}var Mi=(()=>{class n{#e;#t;#i;#o;#a;constructor(e,t,i){this.matDialog=e,this.viewContainerRef=t,this.changeDetectorRef=i,this.gridOptions=this.#c(),this.#e=B(We),this.#t=B(Ee),this.isDebug=w(he).isDebug,this.router=w(I),this.#i=D(!1),this.#o=D(0),this.#a=D(""),this.licenses=re({source:this.#e.getLicensesLive(this.#o).value,computation:(o,d)=>o?o.map(A=>m(p({},_.expandLicense(A)),{Features:A.Features.map(N=>_.expandFeature(N)),filteredFeatures:A.Features.map(N=>_.expandFeature(N))})):d?.value??[]}),this.filteredLicenses=D(null),Ve.registerModules([Be]),$(()=>{this.applyFilter()})}ngOnInit(){this.#t.doOnDialogClosedWithData(e=>{if(e?.objData){let t=e.objData,{guid:i,enabled:o}=t,d=R(t,["guid","enabled"]),y={FeatureGuid:i,Enabled:o,Configuration:d};this.#e.saveFeatures([y]).subscribe(()=>{this.#n(100)})}else this.#n(0)})}#n(e){setTimeout(()=>{this.#o.update(t=>++t),this.#i.set(!1)},e)}trackLicenses(e,t){return t.Guid}openRegistration(){let e=this.#t.router;e.navigate([e.url.replace("license","")+"/registration"])}#r(e){let t={feature:e,showGuid:!0,showStatus:!0};this.matDialog.open(Le,{autoFocus:!1,data:t,viewContainerRef:this.viewContainerRef,width:"600px"}),this.changeDetectorRef.markForCheck()}#s(e,t){this.#i.set(!0);let i={FeatureGuid:e.guid,Enabled:t};U([this.#e.saveFeatures([i])]).subscribe({next:()=>this.#n(100),error:()=>this.#n(100)})}filterLicenses(e){let i=e.target.value.toLowerCase();this.#a.set(i),i||this.closeAllPanels(),this.applyFilter()}applyFilter(){let e=this.licenses(),t=this.#a();if(!t){let o=e.map(d=>m(p({},d),{filteredFeatures:d.Features}));this.filteredLicenses.set(o);return}this.openAllPanels();let i=e.map(o=>{let d=o.Features.filter(y=>y.name.toLowerCase().includes(t)||y.nameId.toLowerCase().includes(t));return m(p({},o),{filteredFeatures:d})});this.filteredLicenses.set(i.filter(o=>o.Name.toLowerCase().includes(t)||o.filteredFeatures.length>0))}openAllPanels(){this.accordion&&this.accordion.openAll()}closeAllPanels(){this.accordion&&this.accordion.closeAll()}#l(e){return"#"+this.#t.urlSubRoute(e)}#p(e){return be({items:[ve.newFromType(e.configurationContentType)]})}#c(){return m(p({},He),{columnDefs:[m(p({},b.TextWideMin100),{headerName:"ID",field:"nameId",width:200,cellClass:"no-outline",cellRenderer:Ge,cellRendererParams:{tooltipGetter:i=>i.nameId}}),m(p({},b.TextWideMin100),{headerName:"Name",field:"name",cellClass:[..."primary-action highlight".split(" "),"no-outline"],onCellClicked:t=>{this.#r(t.data)}}),{headerName:"Enabled",field:"isEnabled",width:82,cellClass:"no-outline",headerClass:"dense",sortable:!0,filter:Ne,cellRenderer:Ke,cellRendererParams:{getSettingsUrl:t=>this.#l(`edit/${this.#p(t)}`)}},m(p({},b.TextNarrow),{headerName:"Reason",field:"enabledReason",cellRenderer:Qe}),m(p({},b.ItemsText),{headerName:"Expiration",field:"ExpMessage",sortable:!1,width:80,tooltipValueGetter:t=>t.data?.expiration}),m(p({},b.ActionsPinnedRight6),{cellClass:"no-outline",headerName:"",field:"enabledInConfiguration",cellRenderer:Ye,cellRendererParams:()=>({isDisabled:i=>!i.isConfigurable||this.#i(),onToggle:(i,o)=>this.#s(i,o),tooltipGetter:i=>i.isConfigurable?"Toggle off | default | on":"This feature can't be configured"})})]})}static{this.\u0275fac=function(t){return new(t||n)(v(Ce),v(Y),v(se))}}static{this.\u0275cmp=g({type:n,selectors:[["app-license-info"]],viewQuery:function(t,i){if(t&1&&ee(k,5),t&2){let o;te(o=ie())&&(i.accordion=o.first)}},decls:26,vars:2,consts:[["panel",""],[1,"license-info-menu"],["mat-button","outlined","tippy","Open All Licenses",3,"click"],[1,"eav-icon"],["mat-button","outlined","tippy","Close All Licenses",3,"click"],[1,"search-form"],["color","accent"],["matInput","","placeholder","Lightspeed",3,"input"],["multi",""],["align","start"],["mat-button","","tippy","Registration",1,"eav-button__with-icon",3,"click"],[1,"panel-icon",3,"tippy"],[1,"panel-title"],[1,"active-features-count"],[1,"panel-description",3,"ngClass"],["appAgGridHeight","",1,"ag-theme-material",3,"rowData","gridOptions","itemsCount"]],template:function(t,i){t&1&&(a(0,"div",1)(1,"div")(2,"button",2),f("click",function(){return i.openAllPanels()}),s(3," Expand All "),a(4,"mat-icon",3),s(5,"expand_all"),r()(),a(6,"button",4),f("click",function(){return i.closeAllPanels()}),s(7," Collapse All "),a(8,"mat-icon",3),s(9,"collapse_all"),r()()(),a(10,"form",5)(11,"mat-form-field",6)(12,"mat-label"),s(13,"Search"),r(),a(14,"input",7),f("input",function(d){return i.filterLicenses(d)}),r()()()(),a(15,"mat-accordion",8),J(16,ot,18,12,"mat-expansion-panel",null,i.trackLicenses,!0),V(18,"licensesOrder"),r(),a(19,"mat-dialog-actions",9)(20,"button",10),f("click",function(){return i.openRegistration()}),a(21,"mat-icon",3),s(22,"app_registration"),r(),a(23,"span"),s(24,"Registration"),r()()(),G(25,"router-outlet")),t&2&&(c(16),X(j(18,0,i.filteredLicenses())))},dependencies:[Ae,k,Te,Oe,ke,O,T,P,Ue,je,$e,xe,ge,fe,le,C,we,ye,_e,Me,de,ce,pe,Fe,De,qe,ze],styles:[`[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;box-sizing:border-box;position:relative}.license-info-menu[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:#e5e5e5 solid 1px}.license-info-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:8px}.license-info-menu[_ngcontent-%COMP%]   .search-form[_ngcontent-%COMP%]{justify-content:end}mat-accordion[_ngcontent-%COMP%]{flex:1;overflow:auto;width:100%}mat-dialog-actions[_ngcontent-%COMP%]{border-top:#e5e5e5 solid 1px}.mat-expansion-panel-header[_ngcontent-%COMP%]{padding-top:4px;padding-bottom:4px}.mat-expansion-panel-header[_ngcontent-%COMP%]     .mat-content{max-height:100%}.panel-icon[_ngcontent-%COMP%]{margin-right:16px;min-width:22px}.panel-title[_ngcontent-%COMP%]{font-size:14px}.active-features-count[_ngcontent-%COMP%]{display:inline-block;margin-left:8px;font-size:12px;border-radius:12px;padding:2px 6px;border:1px solid rgba(29,39,61,.44);box-sizing:border-box;-webkit-user-select:none;user-select:none;white-space:nowrap}.panel-description[_ngcontent-%COMP%]{padding-top:4px;font-size:12px;color:#0000008a;overflow:hidden;text-overflow:ellipsis;max-height:1em;line-height:1em}.panel-description.expanded[_ngcontent-%COMP%]{max-height:3em}.eav-button__with-icon[_ngcontent-%COMP%]   .eav-icon[_ngcontent-%COMP%]{font-size:24px;height:24px;width:24px}
/*# sourceMappingURL=license-info-PCUT2IMQ.css.map */`]})}}return n})();export{Mi as LicenseInfoComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/license-info-YQZTTS4Y.js.map
