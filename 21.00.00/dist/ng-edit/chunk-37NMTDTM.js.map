{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/signals/computed-cache.ts"],
  "sourcesContent": ["import { Signal, CreateComputedOptions } from '@angular/core';\r\nimport { computedObj } from './signal.utilities';\r\n\r\nexport type ComputedCache<TKey extends string, TValue> = Record<TKey, Signal<TValue>>;\r\n\r\n/**\r\n * Special helper with Signals to cache computed signals.\r\n */\r\nexport class ComputedCacheHelper<TKey extends string | number, TValue> {\r\n\r\n  static proxy<TKey extends string | number, TValue>(\r\n    name: string = 'cache-name?',\r\n    factory: (name: string) => () => TValue, options: CreateComputedOptions<TValue> = null,\r\n  ) : Record<TKey, Signal<TValue>> {\r\n    const cch =  new ComputedCacheHelper<TKey, TValue>(name);\r\n    const proxy = cch.buildProxy(factory, options);\r\n    return proxy;\r\n  }\r\n\r\n  constructor(private name: string = 'cache-name?') {\r\n  }\r\n\r\n  private cache: Record<TKey, Signal<TValue>> = {} as Record<TKey, Signal<TValue>>;\r\n\r\n  get(key: TKey): Signal<TValue> {\r\n    return this.cache[key];\r\n  }\r\n\r\n  buildProxy(factory: (name: string) => () => TValue, options: CreateComputedOptions<TValue> = null) {\r\n    if (this.#proxy) throw new Error(`Proxy already built; it can't be again, as the factory could be unexpectedly different.`);\r\n    this.#proxy = new Proxy(this.cache, {\r\n      get: (_, fieldName) => {\r\n        if (typeof fieldName === 'string')\r\n          return this.getOrCreate(fieldName as TKey, factory(fieldName), options);\r\n        throw new Error(`Invalid name: '${fieldName?.toString()}'`);\r\n      }\r\n    });\r\n    return this.#proxy;\r\n  }\r\n  #proxy: Record<TKey, Signal<TValue>>;\r\n\r\n  getOrCreate(key: TKey, factory: () => TValue, options: CreateComputedOptions<TValue> = null): Signal<TValue> {\r\n    return this.getOrCreateWithInfo(key, factory, options).signal;\r\n  }\r\n\r\n  getOrCreateWithInfo(key: TKey, factory: () => TValue, options: CreateComputedOptions<TValue> = null): { signal: Signal<TValue>, isNew: boolean } {\r\n    if (this.cache[key])\r\n      return { signal: this.cache[key], isNew: false };\r\n    const sig = computedObj(`${this.name}-${key}`, () => factory());\r\n    return { signal: this.set(key, sig), isNew: true };\r\n  }\r\n\r\n\r\n  set(key: TKey, value: Signal<TValue>): Signal<TValue> {\r\n    this.cache[key] = value;\r\n    return value;\r\n  }\r\n\r\n  delete(key: TKey): void {\r\n    delete this.cache[key];\r\n  }\r\n\r\n  clear(): void {\r\n    Object.keys(this.cache).forEach((key) => {\r\n      delete this.cache[key as TKey];\r\n    });\r\n  }\r\n}"],
  "mappings": "wCAQM,IAAOA,EAAP,MAAOA,CAAmB,CAE9B,OAAOC,MACLC,EAAe,cACfC,EAAyCC,EAAyC,KAAI,CAItF,OAFa,IAAIJ,EAAkCE,CAAI,EACrCG,WAAWF,EAASC,CAAO,CAE/C,CAEAE,YAAoBJ,EAAe,cAAa,CAA5B,KAAAA,KAAAA,EAGZ,KAAAK,MAAsC,CAAA,CAF9C,CAIAC,IAAIC,EAAS,CACX,OAAO,KAAKF,MAAME,CAAG,CACvB,CAEAJ,WAAWF,EAAyCC,EAAyC,KAAI,CAC/F,GAAI,KAAKM,GAAQ,MAAM,IAAIC,MAAM,yFAAyF,EAC1H,YAAKD,GAAS,IAAIE,MAAM,KAAKL,MAAO,CAClCC,IAAKA,CAACK,EAAGC,IAAa,CACpB,GAAI,OAAOA,GAAc,SACvB,OAAO,KAAKC,YAAYD,EAAmBX,EAAQW,CAAS,EAAGV,CAAO,EACxE,MAAM,IAAIO,MAAM,kBAAkBG,GAAWE,SAAQ,CAAE,GAAG,CAC5D,EACD,EACM,KAAKN,EACd,CACAA,GAEAK,YAAYN,EAAWN,EAAuBC,EAAyC,KAAI,CACzF,OAAO,KAAKa,oBAAoBR,EAAKN,EAASC,CAAO,EAAEc,MACzD,CAEAD,oBAAoBR,EAAWN,EAAuBC,EAAyC,KAAI,CACjG,GAAI,KAAKG,MAAME,CAAG,EAChB,MAAO,CAAES,OAAQ,KAAKX,MAAME,CAAG,EAAGU,MAAO,EAAK,EAChD,IAAMC,EAAMC,EAAY,GAAG,KAAKnB,IAAI,IAAIO,CAAG,GAAI,IAAMN,EAAO,CAAE,EAC9D,MAAO,CAAEe,OAAQ,KAAKI,IAAIb,EAAKW,CAAG,EAAGD,MAAO,EAAI,CAClD,CAGAG,IAAIb,EAAWc,EAAqB,CAClC,YAAKhB,MAAME,CAAG,EAAIc,EACXA,CACT,CAEAC,OAAOf,EAAS,CACd,OAAO,KAAKF,MAAME,CAAG,CACvB,CAEAgB,OAAK,CACHC,OAAOC,KAAK,KAAKpB,KAAK,EAAEqB,QAASnB,GAAO,CACtC,OAAO,KAAKF,MAAME,CAAW,CAC/B,CAAC,CACH",
  "names": ["ComputedCacheHelper", "proxy", "name", "factory", "options", "buildProxy", "constructor", "cache", "get", "key", "#proxy", "Error", "Proxy", "_", "fieldName", "getOrCreate", "toString", "getOrCreateWithInfo", "signal", "isNew", "sig", "computedObj", "set", "value", "delete", "clear", "Object", "keys", "forEach"]
}
