{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/app-administration/sub-dialogs/delete-extension/delete-extension.ts", "projects/eav-ui/src/app/app-administration/sub-dialogs/delete-extension/delete-extension.html"],
  "sourcesContent": ["import { Component, computed, inject, Inject, OnInit } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MAT_DIALOG_DATA, MatDialogActions, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatExpansionModule } from '@angular/material/expansion';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { transient } from 'projects/core';\r\nimport { isCtrlEnter } from '../../../edit/dialog/main/keyboard-shortcuts';\r\nimport { TippyDirective } from '../../../shared/directives/tippy.directive';\r\nimport { SaveCloseButtonFabComponent } from '../../../shared/modules/save-close-button-fab/save-close-button-fab';\r\nimport { AppExtensionsService } from '../../services/app-extensions.service';\r\nimport { ConfirmDeleteDialogComponent } from '../confirm-delete-dialog/confirm-delete-dialog';\r\nimport { ConfirmDeleteDialogData } from '../confirm-delete-dialog/confirm-delete-dialog.models';\r\nimport { InspectExtensionContentComponent } from '../inspect-extension/inspect-extension-content/inspect-extension-content';\r\n\r\n@Component({\r\n  selector: 'app-delete-extension',\r\n  templateUrl: './delete-extension.html',\r\n  styleUrls: ['./delete-extension.scss'],\r\n  imports: [\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatDialogActions,\r\n    SaveCloseButtonFabComponent,\r\n    MatSlideToggleModule,\r\n    FormsModule,\r\n    MatExpansionModule,\r\n    InspectExtensionContentComponent,\r\n    TippyDirective,\r\n  ]\r\n})\r\nexport class DeleteExtensionComponent implements OnInit {\r\n  #snackBar = inject(MatSnackBar);\r\n  #extensionsSvc = transient(AppExtensionsService);\r\n\r\n  extensionFolder = this.route.snapshot.paramMap.get('extension') as 'extension';\r\n  edition = this.route.snapshot.queryParamMap.get('edition') || '';\r\n  withData = false;\r\n  forceDelete = false;\r\n\r\n  preflightResult = this.#extensionsSvc.preflightExtension(this.extensionFolder, this.edition).value;\r\n  totalLocalEntities = computed(() => {\r\n    const result = this.preflightResult();\r\n    if (!result?.data?.contentTypes) return 0;\r\n\r\n    return result.data.contentTypes\r\n      .map(ct => ct.localEntities)\r\n      .reduce((sum, n) => sum + n, 0);\r\n  });\r\n\r\n  mustForceDelete = computed((): boolean => {\r\n    const inspect = this.preflightResult()\r\n    if (!inspect) return false;\r\n\r\n    const fileSummary = inspect.summary;\r\n    const filesChanged = fileSummary.changed + fileSummary.added + fileSummary.missing;\r\n\r\n    // 1) Installed?\r\n    const isInstalled = inspect.files.some(f =>\r\n      f.path.endsWith('App_Data/extension.json') && f.status !== 'missing'\r\n    );\r\n\r\n    // If not installed → auto-force-delete\r\n    if (!isInstalled) {\r\n      return true;\r\n    }\r\n\r\n    // 2) Lock file must exist\r\n    if (!inspect.foundLock) {\r\n      this.showError('Missing extension.lock.json. Deletion not allowed.');\r\n      return true;\r\n    }\r\n\r\n    // 3) Changed / added / missing files?\r\n    if (filesChanged > 0) {\r\n      this.askForce(`The extension has file changes (${filesChanged}).`);\r\n      return true;\r\n    }\r\n\r\n    // 4) Existing local entities?\r\n    if (this.totalLocalEntities() > 0) {\r\n      this.askForce(`The extension has ${this.totalLocalEntities()} local entities.`);\r\n      return true;\r\n    }\r\n\r\n    // 5) All good → normal delete\r\n    return false;\r\n  });\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    @Inject(MAT_DIALOG_DATA) public dialogData: ConfirmDeleteDialogData,\r\n    public dialog: MatDialogRef<ConfirmDeleteDialogComponent>,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.#watchKeyboardShortcuts();\r\n  }\r\n\r\n  #watchKeyboardShortcuts(): void {\r\n    this.dialog.keydownEvents().subscribe(event => {\r\n      if (isCtrlEnter(event)) {\r\n        event.preventDefault();\r\n        this.deleteAndClose();\r\n      }\r\n    });\r\n  }\r\n\r\n  closeDialog(confirm?: boolean) {\r\n    this.#snackBar.dismiss();\r\n    confirm\r\n      ? this.dialog.close(confirm)\r\n      : this.dialog.close();\r\n  }\r\n\r\n  deleteAndClose() {\r\n    if (this.mustForceDelete() && !this.forceDelete) {\r\n      this.showError('Deletion requires force. Please enable \"Force Delete\" and try again.');\r\n      return;\r\n    }\r\n    this.executeDelete(this.forceDelete);\r\n  }\r\n\r\n  private askForce(message: string) {\r\n    this.#snackBar.open(\r\n      `${message}`,\r\n      '',\r\n      { duration: 10000 }\r\n    );\r\n  }\r\n\r\n  private executeDelete(force: boolean) {\r\n    this.#extensionsSvc\r\n      .deleteExtension(this.extensionFolder, this.edition, force, this.withData)\r\n      .subscribe({\r\n        next: () => {\r\n          this.#snackBar.open('Extension deleted successfully', 'OK', { duration: 3000 });\r\n          this.dialog.close(true);\r\n        },\r\n        error: err => {\r\n          const msg = err?.error?.exceptionMessage ?? 'Delete failed.';\r\n          this.showError(msg);\r\n        }\r\n      });\r\n  }\r\n\r\n  private showError(msg: string) {\r\n    this.#snackBar.open(msg, 'OK', { duration: 8000 });\r\n  }\r\n}\r\n", "<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">Delete {{ extensionFolder }}</div>\r\n    <button mat-icon-button tippy=\"Close dialog\" (click)=\"closeDialog()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"eav-dialog-content\">\r\n    <mat-accordion>\r\n      <mat-expansion-panel [expanded]=\"false\">\r\n        <mat-expansion-panel-header>\r\n          <mat-panel-title>Extension Details</mat-panel-title>\r\n        </mat-expansion-panel-header>\r\n        <app-inspect-extension-content [data]=\"preflightResult()\" />\r\n      </mat-expansion-panel>\r\n    </mat-accordion>\r\n    @if (totalLocalEntities() > 0) {\r\n      <p>Caution: This app has {{ totalLocalEntities() }} local entities.</p>\r\n      <p>\r\n        <mat-slide-toggle [(ngModel)]=\"withData\">\r\n          With Data\r\n        </mat-slide-toggle>\r\n      </p>\r\n    }\r\n    @if (mustForceDelete()) {\r\n      <mat-slide-toggle [(ngModel)]=\"forceDelete\">\r\n        Force Delete\r\n      </mat-slide-toggle>\r\n    }\r\n  </div>\r\n\r\n  <mat-dialog-actions align=\"end\">\r\n    <app-save-close-button-fab\r\n      icon=\"delete\"\r\n      [label]=\"'Delete and close (ctrl + enter)'\"\r\n      (action)=\"deleteAndClose()\"\r\n    />\r\n  </mat-dialog-actions>\r\n</div>\r\n"],
  "mappings": "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",
  "names": ["\u0275\u0275elementStart", "\u0275\u0275text", "\u0275\u0275elementEnd", "\u0275\u0275twoWayListener", "$event", "\u0275\u0275restoreView", "_r1", "ctx_r1", "\u0275\u0275nextContext", "i0", "\u0275\u0275twoWayBindingSet", "withData", "\u0275\u0275resetView", "\u0275\u0275advance", "\u0275\u0275textInterpolate1", "totalLocalEntities", "\u0275\u0275twoWayProperty", "_r3", "forceDelete", "DeleteExtensionComponent", "#snackBar", "#extensionsSvc", "constructor", "route", "dialogData", "dialog", "inject", "MatSnackBar", "transient", "AppExtensionsService", "extensionFolder", "snapshot", "paramMap", "get", "edition", "queryParamMap", "preflightResult", "preflightExtension", "value", "computed", "result", "data", "contentTypes", "map", "ct", "localEntities", "reduce", "sum", "n", "mustForceDelete", "inspect", "fileSummary", "summary", "filesChanged", "changed", "added", "missing", "files", "some", "f", "path", "endsWith", "status", "foundLock", "askForce", "showError", "ngOnInit", "#watchKeyboardShortcuts", "keydownEvents", "subscribe", "event", "isCtrlEnter", "preventDefault", "deleteAndClose", "closeDialog", "confirm", "dismiss", "close", "executeDelete", "message", "open", "duration", "force", "deleteExtension", "next", "error", "err", "msg", "exceptionMessage", "\u0275\u0275directiveInject", "ActivatedRoute", "MAT_DIALOG_DATA", "MatDialogRef", "selectors", "decls", "vars", "consts", "template", "rf", "ctx", "\u0275\u0275listener", "\u0275\u0275element", "\u0275\u0275conditionalCreate", "DeleteExtensionComponent_Conditional_14_Template", "DeleteExtensionComponent_Conditional_15_Template", "\u0275\u0275property", "\u0275\u0275conditional", "MatButtonModule", "MatIconButton", "MatIconModule", "MatIcon", "MatDialogActions", "SaveCloseButtonFabComponent", "MatSlideToggleModule", "MatSlideToggle", "FormsModule", "NgControlStatus", "NgModel", "MatExpansionModule", "MatAccordion", "MatExpansionPanel", "MatExpansionPanelHeader", "MatExpansionPanelTitle", "InspectExtensionContentComponent", "TippyDirective", "styles"]
}
