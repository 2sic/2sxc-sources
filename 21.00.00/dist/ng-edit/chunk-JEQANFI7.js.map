{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/services/entity.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { filter, map, Observable, shareReplay, switchMap } from 'rxjs';\r\nimport { transient } from '../../../../../core';\r\nimport { EntityLightIdentifier } from '../../../../../edit-types/src/EntityLight';\r\nimport { classLog } from '../logging';\r\nimport { HttpServiceBaseSignal } from './http-service-base-signal';\r\nimport { QueryService } from './query.service';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  getEntities: false,\r\n  getAvailableEntities: false,\r\n  delete: false,\r\n};\r\n\r\nexport const webApiEntityRoot = 'admin/entity/';\r\nexport const webApiEntityList = 'admin/entity/list';\r\n\r\n@Injectable()\r\nexport class EntityService extends HttpServiceBaseSignal {\r\n\r\n  log = classLog({ EntityService }, logSpecs);\r\n\r\n  private queryService = transient(QueryService);\r\n\r\n  /**\r\n   * Get entities based on the content type name.\r\n   * As of 2024-04-29 only used in REST API.\r\n   * @param params\r\n   * @returns\r\n   */\r\n  getEntities$(params: Observable<{ contentTypeName: string }>): Observable<EntityLightIdentifier[]> {\r\n    this.log.fnIf('getEntities');\r\n    return params.pipe(\r\n      filter(p => p != null),\r\n      switchMap(p => this.getAvailableEntities(p.contentTypeName).pipe(shareReplay(1))),\r\n    );\r\n  }\r\n\r\n  private getAvailableEntities(contentTypeName: string, entitiesFilter?: string[]): Observable<EntityLightIdentifier[]> {\r\n    var log = this.log.fnIf('getAvailableEntities');\r\n    return this.queryService.getEntities({\r\n      contentTypes: [contentTypeName],\r\n      itemIds: entitiesFilter,\r\n      fields: 'Id,Guid,Title',\r\n      log: 'getAvailableEntities'\r\n    }).pipe(\r\n      map(data => data.Default)\r\n    );\r\n  }\r\n\r\n  delete(appId: number, contentType: string, entityId: number, force: boolean, parentId?: number, parentField?: string): Observable<null> {\r\n    this.log.fnIf('delete', { appId, contentType, entityId, force, parentId, parent });\r\n    return this.http.delete<null>(this.apiUrl(webApiEntityRoot + 'delete'), {\r\n      params: {\r\n        contentType,\r\n        id: entityId.toString(),\r\n        appId,\r\n        force: force.toString(),\r\n        ...(parentId && { parentId: parentId.toString() }),\r\n        ...(parentId && parentField && { parentField }),\r\n      },\r\n    });\r\n  }\r\n}\r\n"],
  "mappings": "sRAQA,IAAMA,EAAW,CACfC,IAAK,GACLC,YAAa,GACbC,qBAAsB,GACtBC,OAAQ,IAGGC,EAAmB,gBACnBC,EAAmB,oBAGnBC,GAAc,IAAA,CAArB,MAAOA,UAAsBC,CAAqB,CADxDC,aAAA,qBAGE,KAAAC,IAAMC,EAAS,CAAEJ,cAAAA,CAAa,EAAIP,CAAQ,EAElC,KAAAY,aAAeC,EAAUC,CAAY,EAQ7CC,aAAaC,EAA+C,CAC1D,YAAKN,IAAIO,KAAK,aAAa,EACpBD,EAAOE,KACZC,EAAOC,GAAKA,GAAK,IAAI,EACrBC,EAAUD,GAAK,KAAKjB,qBAAqBiB,EAAEE,eAAe,EAAEJ,KAAKK,EAAY,CAAC,CAAC,CAAC,CAAC,CAErF,CAEQpB,qBAAqBmB,EAAyBE,EAAyB,CAC7E,IAAId,EAAM,KAAKA,IAAIO,KAAK,sBAAsB,EAC9C,OAAO,KAAKL,aAAaV,YAAY,CACnCuB,aAAc,CAACH,CAAe,EAC9BI,QAASF,EACTG,OAAQ,gBACRjB,IAAK,uBACN,EAAEQ,KACDU,EAAIC,GAAQA,EAAKC,OAAO,CAAC,CAE7B,CAEA1B,OAAO2B,EAAeC,EAAqBC,EAAkBC,EAAgBC,EAAmBC,EAAoB,CAClH,YAAK1B,IAAIO,KAAK,SAAU,CAAEc,MAAAA,EAAOC,YAAAA,EAAaC,SAAAA,EAAUC,MAAAA,EAAOC,SAAAA,EAAUE,MAAM,CAAE,EAC1E,KAAKC,KAAKlC,OAAa,KAAKmC,OAAOlC,EAAmB,QAAQ,EAAG,CACtEW,OAAQwB,IAAA,CACNR,YAAAA,EACAS,GAAIR,EAASS,SAAQ,EACrBX,MAAAA,EACAG,MAAOA,EAAMQ,SAAQ,GACjBP,GAAY,CAAEA,SAAUA,EAASO,SAAQ,CAAE,GAC3CP,GAAYC,GAAe,CAAEA,YAAAA,CAAW,GAE/C,CACH,qEA5CW7B,CAAa,IAAAoC,GAAbpC,CAAa,CAAA,CAAA,GAAA,CAAA,iCAAbA,EAAaqC,QAAbrC,EAAasC,SAAA,CAAA,CAAA,SAAbtC,CAAc,GAAA",
  "names": ["logSpecs", "all", "getEntities", "getAvailableEntities", "delete", "webApiEntityRoot", "webApiEntityList", "EntityService", "HttpServiceBaseSignal", "constructor", "log", "classLog", "queryService", "transient", "QueryService", "getEntities$", "params", "fnIf", "pipe", "filter", "p", "switchMap", "contentTypeName", "shareReplay", "entitiesFilter", "contentTypes", "itemIds", "fields", "map", "data", "Default", "appId", "contentType", "entityId", "force", "parentId", "parentField", "parent", "http", "apiUrl", "__spreadValues", "id", "toString", "__ngFactoryType__", "factory", "\u0275fac"]
}
