"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_app-administration_data_data_ts"],{41749(bt,G,o){o.d(G,{DataComponent:()=>Tt});var l=o(56884),E=o(36664),y=o(34456),T=o(84175),M=o(20762),B=o(87941),O=o(24950),p=o(93840),C=o(25175),N=o(3347),b=o(69393),k=o(14600),Y=o(64334),$=o(51567),A=o(70271),S=o(63037),u=o(12938),V=o(56360),X=o(10261),U=o(93454),L=o(72437),P=o(21183),c=o(11828),H=o(17042),W=o(30281),w=o(60251),x=o(5858),g=o(50052),z=o(34575),f=o(34601),Q=o(70693),j=o(91922),F=o(70334),J=o(67037),Z=o(60852),K=o(48021),_=o(39431),q=o(17693),tt=o(64699),et=o(25286),v=o(16256),D=o(85309),m=o(31034),nt=o(49417),at=o(40374),t=o(36124),I=o(17828);function ot(i,d){if(1&i&&(t.j41(0,"a",2)(1,"mat-icon"),t.EFF(2,"edit"),t.k0s()()),2&i){const e=t.XpG();t.Y8G("href",e.params.urlTo("createUpdateMetaData",e.contentType),t.B4B)}}function it(i,d){1&i&&(t.j41(0,"div",3)(1,"mat-icon"),t.EFF(2,"edit"),t.k0s()())}function st(i,d){if(1&i&&(t.j41(0,"a",4)(1,"mat-icon",9),t.EFF(2," local_offer "),t.k0s()()),2&i){const e=t.XpG();t.Y8G("href",e.params.urlTo("openMetadata",e.contentType),t.B4B),t.R7$(),t.Y8G("matBadge",e.contentType.Metadata.length)("matBadgeHidden",!e.contentType.Metadata.length)}}function rt(i,d){if(1&i&&(t.j41(0,"div",3)(1,"mat-icon",10),t.EFF(2," local_offer "),t.k0s()()),2&i){const e=t.XpG();t.R7$(),t.Y8G("matBadge",e.contentType.Metadata.length)("matBadgeHidden",!e.contentType.Metadata.length)}}function lt(i,d){if(1&i&&(t.j41(0,"a",5)(1,"mat-icon",9),t.EFF(2," person"),t.k0s()()),2&i){const e=t.XpG();t.Y8G("href",e.params.urlTo("openPermissions",e.contentType),t.B4B),t.R7$(),t.Y8G("matBadge",e.contentType.Permissions.Count)("matBadgeHidden",!e.contentType.Permissions.Count)}}function dt(i,d){if(1&i&&(t.j41(0,"div",3)(1,"mat-icon",10),t.EFF(2," person "),t.k0s()()),2&i){const e=t.XpG();t.R7$(),t.Y8G("matBadge",e.contentType.Permissions.Count)("matBadgeHidden",!e.contentType.Permissions.Count)}}function pt(i,d){if(1&i){const e=t.RV6();t.j41(0,"a",11)(1,"mat-icon"),t.EFF(2,"settings"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Rename"),t.k0s()(),t.j41(5,"a",12),t.nrm(6,"mat-icon",13),t.j41(7,"span"),t.EFF(8,"REST API"),t.k0s()(),t.j41(9,"button",14),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.params.do("typeExport",a.contentType))}),t.j41(10,"mat-icon"),t.EFF(11,"cloud_download"),t.k0s(),t.j41(12,"span"),t.EFF(13,"Export content type"),t.k0s()(),t.j41(14,"a",12)(15,"mat-icon"),t.EFF(16,"cloud_download"),t.k0s(),t.j41(17,"span"),t.EFF(18,"Export data"),t.k0s()(),t.j41(19,"a",12)(20,"mat-icon"),t.EFF(21,"cloud_upload"),t.k0s(),t.j41(22,"span"),t.EFF(23,"Import data"),t.k0s()(),t.j41(24,"button",15),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.params.do("deleteContentType",a.contentType))}),t.j41(25,"mat-icon"),t.EFF(26,"delete"),t.k0s(),t.j41(27,"span"),t.EFF(28,"Delete"),t.k0s()()}if(2&i){const e=t.XpG();t.Y8G("href",e.params.urlTo("editContentType",e.contentType),t.B4B)("disabled",e.contentType.EditInfo.DisableRename),t.R7$(5),t.Y8G("href",e.params.urlTo("openRestApi",e.contentType),t.B4B),t.R7$(9),t.Y8G("href",e.params.urlTo("dataExport",e.contentType),t.B4B),t.R7$(5),t.Y8G("href",e.params.urlTo("dataImport",e.contentType),t.B4B),t.R7$(5),t.Y8G("disabled",e.contentType.EditInfo.DisableDelete)}}let ct=(()=>{class i extends at.y{agInit(e){this.params=e,this.contentType=e.data;const n=this.params.enablePermissionsGetter();this.enablePermissions=n&&(0,nt.L)().test(this.contentType.NameId)}static{this.\u0275fac=(()=>{let e;return function(a){return(e||(e=t.xGo(i)))(a||i)}})()}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-data-actions"]],features:[t.Vt3],decls:13,vars:4,consts:[["menu","matMenu"],[1,"actions-component"],["matRipple","","tippy","Description and more",1,"eav-grid-action-button","default-link","highlight",3,"href"],[1,"eav-grid-action-button","disabled"],["matRipple","","tippy","Metadata",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","Permissions",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["matMenuContent",""],["matBadgePosition","below after","matBadgeSize","small","aria-hidden","false",3,"matBadge","matBadgeHidden"],["matBadgePosition","below after","matBadgeSize","small","matBadgeDisabled","true","aria-hidden","false",3,"matBadge","matBadgeHidden"],["mat-menu-item","",3,"href","disabled"],["mat-menu-item","",3,"href"],["svgIcon","code-curly"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"]],template:function(n,a){if(1&n&&(t.j41(0,"div",1),t.nVh(1,ot,3,1,"a",2)(2,it,3,0,"div",3),t.nVh(3,st,3,3,"a",4)(4,rt,3,2,"div",3),t.nVh(5,lt,3,3,"a",5)(6,dt,3,2,"div",3),t.j41(7,"div",6)(8,"mat-icon"),t.EFF(9,"more_horiz"),t.k0s()()(),t.j41(10,"mat-menu",7,0),t.DNE(12,pt,29,6,"ng-template",8),t.k0s()),2&n){const s=t.sdS(11);t.R7$(),t.vxM(!a.contentType.EditInfo.DisableEdit||a.contentType.Properties?1:2),t.R7$(2),t.vxM(a.contentType.EditInfo.DisableMetadata?4:3),t.R7$(2),t.vxM(!a.contentType.EditInfo.DisableEdit&&a.enablePermissions?5:6),t.R7$(2),t.Y8G("matMenuTriggerFor",s)}},dependencies:[D.p,I.r6,p.m_,p.An,v.Y,v.k,m.Cn,m.kk,m.fb,m.z8,m.Cp,f.e],encapsulation:2})}}return i})(),mt=(()=>{class i{agInit(e){this.params=e,this.contentType=e.data,this.value=e.value,this.tooltip=this.contentType.EditInfo.ReadOnly?`${this.contentType.EditInfo.ReadOnlyMessage?`${this.contentType.EditInfo.ReadOnlyMessage}\n\n`:""}This ContentType shares the definition of #${this.contentType.SharedDefId} so you can't edit it here. Read 2sxc.org/help?tag=shared-types`:"Edit fields",this.icon=this.contentType.EditInfo.ReadOnly?"share":"dns"}refresh(e){return!0}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-data-fields"]],decls:4,vars:5,consts:[[1,"actions-component"],["matRipple","",1,"eav-grid-action-button","default-link","highlight",3,"tippy","href"],["matBadgePosition","below after","matBadgeColor","accent","matBadgeSize","small","aria-hidden","false",3,"matBadge","matBadgeHidden"]],template:function(n,a){1&n&&(t.j41(0,"div",0)(1,"a",1)(2,"mat-icon",2),t.EFF(3),t.k0s()()()),2&n&&(t.R7$(),t.Y8G("tippy",a.tooltip)("href",a.params.fieldsUrl(a.contentType),t.B4B),t.R7$(),t.Y8G("matBadge",a.value)("matBadgeHidden",!a.value),t.R7$(),t.SpI(" ",a.icon," "))},dependencies:[D.p,I.r6,p.m_,p.An,v.Y,v.k,f.e],encapsulation:2})}}return i})(),ht=(()=>{class i{constructor(){this.router=(0,l.WQX)(b.Ix)}agInit(e){this.params=e,this.contentType=e.data,this.value=e.value}refresh(e){return!0}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-data-items"]],decls:7,vars:5,consts:[[1,"actions-component"],["matRipple","",1,"eav-grid-action-button","default-link","highlight",3,"tippy","href"],[1,"text-icon"],["matRipple","","tippy","Add item",1,"eav-grid-action-button","default-link","highlight",3,"href"]],template:function(n,a){1&n&&(t.j41(0,"div",0)(1,"a",1)(2,"div",2),t.EFF(3),t.k0s()(),t.j41(4,"a",3)(5,"mat-icon"),t.EFF(6,"add"),t.k0s()()()),2&n&&(t.R7$(),t.Y8G("tippy",t.VkB("",a.value," items"))("href",a.params.itemsUrl(a.contentType),t.B4B),t.R7$(2),t.JRh(a.value),t.R7$(),t.Y8G("href",a.params.addItemUrl(a.contentType),t.B4B))},dependencies:[D.p,I.r6,p.m_,p.An,f.e],styles:[".text-icon[_ngcontent-%COMP%]{width:24px;height:24px;font-size:12px;line-height:22px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border:1px solid rgba(29,39,61,.44);border-radius:12px;box-sizing:border-box;background-color:#002753;color:#fff;-webkit-user-select:none;user-select:none}.text-icon[_ngcontent-%COMP%]{min-width:24px;width:initial}"]})}}return i})();var ut=o(80423),gt=o(96462),ft=o(58857);function vt(i,d){if(1&i&&(t.j41(0,"mat-option",6),t.EFF(1),t.k0s()),2&i){const e=d.$implicit;t.Y8G("value",e.name),t.R7$(),t.SpI(" ",e.label," ")}}function yt(i,d){if(1&i){const e=t.RV6();t.j41(0,"button",12),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.createGhost())}),t.j41(1,"mat-icon",9),t.EFF(2,"share"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Ghost"),t.k0s()()}}let Tt=(()=>{class i extends W.${#n;#s;#a;#r;#l;#e;#i;constructor(e){super(),this.viewContainerRef=e,this.isDebug=(0,l.WQX)(_.B).isDebug,this.#n=(0,l.WQX)(N.UG),this.#s=(0,l.WQX)(B.bZ),this.#a=(0,u.d)(q.g),this.#r=(0,u.d)(V.D),this.#l=(0,u.d)(tt.L),this.#e=(0,u.d)(Z.c),this.#i={empty:{description:"<p><b>This is where you manage data</b></p>",hint:"<p>Click the (+) in the bottom right corner to create your first Content Type (think: table).</p>"},content:{description:"<p><b>Each row shows a Content Type</b> <br> They define the fields, similar to a database table.</p>",hint:"<p>Click on the title to list the Entities (think: records). <br>You can also create new Entities, configure the fields and export/import the schema or the data.</p>"}},this.uxHelpText=(0,E.EW)(()=>0===this.contentTypes()?.length?this.#i.empty:this.#i.content),this.contentTypes=(0,l.vPA)(void 0),this.scope=(0,l.vPA)(void 0),this.scopeOptions=(0,l.vPA)([]),this.scopeSelected=(0,E.EW)(()=>this.scopeOptions().find(n=>n.name===this.scope())),this.gridOptions=this.#c(),this.dropdownInsertValue=x.O,this.refresh=(0,l.vPA)(0)}ngOnInit(){this.#d(),this.#p(),this.#e.doOnDialogClosedWithData(()=>{this.#o()}),this.#l.getCurrent$().subscribe(e=>{this.enablePermissions=e.Context.Enable.AppPermissions})}filesDropped(e){const n=e[0];switch(n.name.substring(n.name.lastIndexOf(".")+1).toLocaleLowerCase()){case"xml":(0,k.H)((0,Q.d)(e[0])).pipe((0,Y.s)(1)).subscribe(s=>{const r=s.split('<Entity Type="')[1]?.split('"')[0],R=this.contentTypes().find(h=>h.Name===r);null!=R?this.#g(R,e):this.#n.open(`Cannot find Content Type named '${r}'. Please open Content Type Import dialog manually.`,null,{duration:5e3})});break;case"json":this.importType(e)}}importType(e){this.#e.navRelative(["import"],{state:{files:e}})}urlToImportType(){return this.#t("import")}editContentType(e){if(e){if(e.EditInfo.ReadOnly)return;this.#e.navRelative([`${e.NameId}/edit`])}else this.#e.navRelative(["add"])}#o(){this.#a.retrieveContentTypesPromise(this.scope()).then(e=>{for(const n of e)n._compareLabel=n.Label.replace(new RegExp("\\p{Emoji}","gu"),"\u017e");this.contentTypes.set(e),this.refresh.update(n=>++n),this.scope()!==g.YX.scopes.default.value&&this.#n.open("Warning! You are in a special scope. Changing things here could easily break functionality",null,{duration:2e3})})}#d(){this.#a.getScopesV2Promise().then(e=>{const n=this.scopeOptions().filter(s=>null==e.find(r=>r.name===s.name)),a=e.map(s=>{let r=s.typesInherited?s.typesInherited==s.typesTotal?s.typesInherited+" sys types":`${s.typesTotal} types / ${s.typesInherited} system`:`${s.typesTotal} types`;return{...s,label:s.name+` - ${r}`}});this.scopeOptions.set([...a,...n])})}createGhost(){const e=window.prompt("To create a ghost content-type enter source static name / id - this is a very advanced operation - read more about it on 2sxc.org/help?tag=ghost");e&&(this.#n.open("Saving..."),this.#a.createGhost(e).subscribe(n=>{this.#n.open("Saved",null,{duration:2e3}),this.#o()}))}changeScope(e){e===x.O&&(e=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||g.YX.scopes.default.value),this.#e.navRelative(["..",e])}#p(){this.subscriptions.add(this.#e.router.events.pipe((0,$.p)(e=>e instanceof b.wF),(0,A.T)(()=>this.#e.getParam("scope")),(0,S.Z)(this.#e.getParam("scope")),(0,$.p)(e=>!!e),(0,K.J)(e=>e)).subscribe(e=>{if(this.scope.set(e),!this.scopeOptions().map(n=>n.name).includes(e)){const n={name:e,label:e,typesTotal:0,typesInherited:0,typesOfApp:0};this.scopeOptions.set([...this.scopeOptions(),n])}this.#o()}))}#c(){return{...w.C,columnDefs:[{...c.r.IdWithDefaultRenderer,cellRendererParams:c.r.idFieldParamsTooltipGetter("StaticName")},{...c.r.TextWidePrimary,headerName:"ContentType",field:"Label",sort:"asc",comparator:(n,a,s,r,R)=>s.data._compareLabel.localeCompare(r.data._compareLabel),cellRenderer:n=>P.f.cellLink(this.#t(`items/${n.data.NameId}`),n.data.Label)},{...c.r.Items,field:"Items",cellRenderer:ht,cellRendererParams:{addItemUrl:n=>this.#t(`edit/${this.#m(n)}`),itemsUrl:n=>this.#t(`items/${n.NameId}`)}},{...c.r.Fields,field:"Fields",cellRenderer:mt,cellRendererParams:{fieldsUrl:n=>this.#t(`fields/${n.NameId}`)}},{...c.r.TextWideMin100,field:"Name",cellClass:n=>(n.data.EditInfo.DisableEdit?"no-outline":"primary-action highlight").split(" "),cellRenderer:n=>P.f.cellLink(this.#t(`${n.data.NameId}/edit`),n.data?.Name)},{...c.r.TextWideFlex3,field:"Description",valueGetter:n=>n.data?.Properties?.Description},{...c.r.ActionsPinnedRight4,cellRenderer:ct,cellRendererParams:{enablePermissionsGetter:()=>this.enablePermissions,urlTo:(n,a)=>{switch(n){case"createUpdateMetaData":return this.#t(`edit/${this.#h(a)}`);case"openPermissions":return this.#t(L.k.getUrlContentType(a.NameId));case"editContentType":return this.#t(a.EditInfo.ReadOnly?"":`${a.NameId}/edit`);case"openMetadata":return this.#t(U.H.getUrlContentType(a.NameId,`Metadata for Content Type: ${a.Name} (${a.Id})`));case"openRestApi":return this.#t(X.N.getUrlData(a));case"dataExport":return this.#t(`export/${a.NameId}`);case"dataImport":return this.#t(`${a.NameId}/import`)}},do:(n,a)=>{switch(n){case"typeExport":this.#u(a);break;case"deleteContentType":this.#f(a)}}}}]}}#t(e){return"#"+this.#e.urlSubRoute(e)}#m(e){return(0,j.s)({items:[F.c.newFromType(e.NameId)]})}urlToNewContentType(){return this.#t("add")}#h(e){const n={items:[e.Properties?F.c.editId(e.Properties.Id):{...F.c.newMetadata(e.NameId,g.YX.contentTypes.contentType,g.YX.metadata.contentType),Prefill:{Label:e.Name,Description:e.Description}}]};return(0,j.s)(n)}#u(e){this.#r.exportJson(e.NameId)}#g(e,n){this.#e.navRelative([`${e.NameId}/import`],{state:{files:n}})}#f(e){this.#s.open(et.F,{autoFocus:!1,data:{entityId:e.Id,entityTitle:e.Name,message:"Are you sure you want to delete?",hasDeleteSnackbar:!0},viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(s=>{s&&this.#a.delete(e).subscribe(r=>{this.#n.open("Deleted",null,{duration:2e3}),this.#o()})})}static{this.\u0275fac=function(n){return new(n||i)(t.rXU(t.c1b))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-data"]],features:[t.Vt3],decls:25,vars:12,consts:[[3,"helpText","refresh","rowLength"],["appDragAndDrop","",1,"ag-theme-material",3,"filesDropped","rowData","gridOptions","allowedFileTypes"],[1,"eav-dialog-actions"],[1,"eav-dialog-actions-div"],["color","accent",1,"eav-mat-form-field","eav-scope-dropdown"],["name","Scope","panelWidth","",3,"ngModelChange","ngModel"],[3,"value"],[3,"href"],["mat-button","","tippy","Import content type","tippyPlacement","top",1,"eav-button__with-icon"],[1,"eav-icon"],["mat-button","","color","accent","tippy","Create a ghost content type","tippyPlacement","top",1,"eav-button__with-icon"],["mat-fab","","mat-elevation-z24","","tippy","Create a new content type","tippyPlacement","top",1,"grid-fab"],["mat-button","","color","accent","tippy","Create a ghost content type","tippyPlacement","top",1,"eav-button__with-icon",3,"click"]],template:function(n,a){if(1&n&&(t.j41(0,"app-grid-with-help",0)(1,"ag-grid-angular",1),t.bIt("filesDropped",function(r){return a.filesDropped(r)}),t.k0s(),t.j41(2,"mat-dialog-actions",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-select",5),t.bIt("ngModelChange",function(r){return a.changeScope(r)}),t.j41(6,"mat-select-trigger")(7,"span"),t.EFF(8),t.k0s()(),t.Z7z(9,vt,2,2,"mat-option",6,t.fX1),t.j41(11,"mat-option",6),t.EFF(12," Scope: Other... "),t.k0s()()(),t.j41(13,"a",7)(14,"button",8)(15,"mat-icon",9),t.EFF(16,"cloud_upload"),t.k0s(),t.j41(17,"span"),t.EFF(18,"Content Type"),t.k0s()()(),t.nVh(19,yt,5,0,"button",10),t.k0s(),t.j41(20,"a",7)(21,"button",11)(22,"mat-icon"),t.EFF(23,"add"),t.k0s()()()()(),t.nrm(24,"router-outlet")),2&n){let s,r;t.Y8G("helpText",a.uxHelpText())("refresh",a.refresh())("rowLength",null==(s=a.contentTypes())?null:s.length),t.R7$(),t.Y8G("rowData",a.contentTypes())("gridOptions",a.gridOptions)("allowedFileTypes","xml,json"),t.R7$(4),t.Y8G("ngModel",a.scope()),t.R7$(3),t.SpI("Scope: ",null==(r=a.scopeSelected())?null:r.label),t.R7$(),t.Dyx(a.scopeOptions()),t.R7$(2),t.Y8G("value",a.dropdownInsertValue),t.R7$(2),t.Y8G("href",a.urlToImportType(),t.B4B),t.R7$(6),t.vxM(a.isDebug()?19:-1),t.R7$(),t.Y8G("href",a.urlToNewContentType(),t.B4B)}},dependencies:[B.E7,O.RG,ut.rl,C.Ve,C.VO,C.$2,gt.wT,y.YN,y.BC,y.vS,M.S,T.Hl,T.$z,T.Sr,p.m_,p.An,b.n3,J.p,ft.xs,z.S,f.e,H.v],styles:["[_nghost-%COMP%]     .ag-row-hover .ag-cell a, [_nghost-%COMP%]     .ag-row-hover .ag-cell .id-box *, [_nghost-%COMP%]     .ag-row-hover .ag-cell mat-icon, .eav-button__with-icon[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:#85283b!important}"]})}}return i})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/projects_eav-ui_src_app_app-administration_data_data_ts.64e8723da57ef218.js.map