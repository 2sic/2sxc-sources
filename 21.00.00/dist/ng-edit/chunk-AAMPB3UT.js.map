{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/directives/drag-and-drop.directive.ts"],
  "sourcesContent": ["import { Directive, ElementRef, HostListener, input, NgZone, OnDestroy, OnInit, output, signal } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { fromEvent } from 'rxjs';\r\nimport { BaseDirective } from './base.directive';\r\n\r\n@Directive({\r\n  selector: '[appDragAndDrop]',\r\n})\r\nexport class DragAndDropDirective extends BaseDirective implements OnInit, OnDestroy {\r\n  markStyle = input<'outline' | 'fill' | 'shadow'>('outline');\r\n  /** Comma separated file types, e.g. 'txt,doc,docx' */\r\n  allowedFileTypes = input<string>('');\r\n  protected filesDropped = output<File[]>();\r\n\r\n  private element: HTMLElement;\r\n  private dropAreaClass = 'eav-droparea';\r\n  private markStyleClass = signal<string>('');\r\n  private dragClass = 'eav-dragover';\r\n  private timeouts: number[] = [];\r\n\r\n  constructor(elementRef: ElementRef, private zone: NgZone, private snackBar: MatSnackBar) {\r\n    super();\r\n    this.element = elementRef.nativeElement;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.markStyleClass.set(`eav-droparea-${this.markStyle()}`);\r\n    this.element.classList.add(this.dropAreaClass, this.markStyleClass());\r\n    this.zone.runOutsideAngular(() => {\r\n      this.subscriptions.add(\r\n        fromEvent<DragEvent>(this.element, 'dragover').subscribe(event => {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          this.clearTimeouts();\r\n          this.element.classList.add(this.dragClass);\r\n        })\r\n      );\r\n      this.subscriptions.add(\r\n        fromEvent<DragEvent>(this.element, 'dragleave').subscribe(event => {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          this.timeouts.push(\r\n            window.setTimeout(() => { this.element.classList.remove(this.dragClass); }, 50)\r\n          );\r\n        })\r\n      );\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.clearTimeouts();\r\n    this.element.classList.remove(this.dropAreaClass, this.markStyleClass(), this.dragClass);\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  @HostListener('drop', ['$event'])\r\n  onDrop(event: DragEvent) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    this.clearTimeouts();\r\n    this.element.classList.remove(this.dragClass);\r\n    const fileList = event.dataTransfer.files;\r\n    let files = Array.from(fileList);\r\n    files = this.filterTypes(files, this.allowedFileTypes());\r\n    if (files.length > 0) {\r\n      this.filesDropped.emit(files);\r\n    }\r\n  }\r\n\r\n  private clearTimeouts() {\r\n    for (const timeout of this.timeouts) {\r\n      clearTimeout(timeout);\r\n    }\r\n    this.timeouts = [];\r\n  }\r\n\r\n  private filterTypes(files: File[], allowedFileTypes: string) {\r\n    if (allowedFileTypes === '') { return files; }\r\n\r\n    const allowedTypes = allowedFileTypes.split(',').map(type => type.toLocaleLowerCase());\r\n    const filtered = files.filter(file => {\r\n      const extIndex = file.name.lastIndexOf('.');\r\n      if (extIndex <= 0) { return false; }\r\n      const ext = file.name.substring(extIndex + 1).toLocaleLowerCase();\r\n      const allowed = allowedTypes.includes(ext);\r\n      return allowed;\r\n    });\r\n\r\n    if (files.length !== filtered.length) {\r\n      const allowedTypesString = this.allowedFileTypes().replace(/\\,/g, ', ');\r\n      const message = filtered.length\r\n        ? 'Some files were filtered out. This drop location only accepts file types: ' + allowedTypesString\r\n        : 'This drop location only accepts file types: ' + allowedTypesString;\r\n      this.snackBar.open(message, null, { duration: 5000 });\r\n    }\r\n    return filtered;\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["DragAndDropDirective", "BaseDirective", "constructor", "elementRef", "zone", "snackBar", "markStyle", "input", "allowedFileTypes", "filesDropped", "output", "dropAreaClass", "markStyleClass", "signal", "dragClass", "timeouts", "element", "nativeElement", "ngOnInit", "set", "classList", "add", "runOutsideAngular", "subscriptions", "fromEvent", "subscribe", "event", "preventDefault", "stopPropagation", "clearTimeouts", "push", "window", "setTimeout", "remove", "ngOnDestroy", "onDrop", "fileList", "dataTransfer", "files", "Array", "from", "filterTypes", "length", "emit", "timeout", "clearTimeout", "allowedTypes", "split", "map", "type", "toLocaleLowerCase", "filtered", "filter", "file", "extIndex", "name", "lastIndexOf", "ext", "substring", "includes", "allowedTypesString", "replace", "message", "open", "duration", "\u0275\u0275directiveInject", "ElementRef", "NgZone", "MatSnackBar", "selectors", "hostBindings", "rf", "ctx", "\u0275\u0275listener", "$event"]
}
