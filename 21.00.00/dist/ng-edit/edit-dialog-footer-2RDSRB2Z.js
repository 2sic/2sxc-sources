import{a as tt}from"./chunk-EDOMTBDN.js";import"./chunk-M6AZRTKS.js";import{A as et,f as Ae,h as me,n as pe,o as N,p as $e,r as He,t as We,u as Je,z as Ue}from"./chunk-OUDKTNXF.js";import{a as z}from"./chunk-XIWBIG4D.js";import"./chunk-WPH6VOLC.js";import"./chunk-VHSKZVJN.js";import"./chunk-JOP3FE6V.js";import{a as Ke,h as Ze}from"./chunk-MQM7DF2M.js";import{a as Ye,c as Qe,d as Xe,e as qe}from"./chunk-TH3YUOZ2.js";import"./chunk-QUYVM733.js";import"./chunk-JEQANFI7.js";import{a as Ne}from"./chunk-564RKXG7.js";import{c as le}from"./chunk-HJXR3IL7.js";import{a as fe}from"./chunk-BTK5NHS7.js";import"./chunk-K5FCDENP.js";import{h as se}from"./chunk-VT6LNH6I.js";import"./chunk-Z7VBWKZ3.js";import"./chunk-NVCP7HH3.js";import"./chunk-YHKI2L7W.js";import{b as ce,c as de}from"./chunk-ODL7UGWI.js";import"./chunk-R3Y7P2GW.js";import"./chunk-LPOE4446.js";import"./chunk-QOHQY66K.js";import"./chunk-37NMTDTM.js";import"./chunk-WAPW5AUJ.js";import"./chunk-ENHI5GWA.js";import{a as _e,c as Ce}from"./chunk-DAEXUMJT.js";import"./chunk-IGMB27B5.js";import{e as ge,h as ue}from"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as te}from"./chunk-HCPBPEHV.js";import{f as D,h as Be,l as T}from"./chunk-QVLOO535.js";import{c as F}from"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{b as ze,f as Ge,k as Re,v as I}from"./chunk-UMOPET3G.js";import{b as X,i as q,j as ee}from"./chunk-4LV77BQU.js";import"./chunk-RGKBOUPL.js";import{b as Ve}from"./chunk-EZZQWHAZ.js";import{b as y,c as S}from"./chunk-23CS2WID.js";import{a as G}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{b as ie,c as ne,d as je,e as oe,g as re,h as ae}from"./chunk-G33ZJSCE.js";import{$ as Ie,aa as Q}from"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$b as Oe,Aa as he,Ab as O,Ac as L,Bb as E,Bc as Ee,Cb as p,Db as o,Eb as r,Fb as w,Gb as Te,Gc as we,Hb as Fe,Nb as b,Ob as K,Pb as d,Rb as m,Sa as s,Za as C,db as v,eb as Se,ec as a,fa as ye,fc as P,fd as A,gb as De,gc as M,ja as U,kd as ke,lc as xe,ld as Y,mc as be,md as Pe,nc as ve,nd as Le,oa as f,pa as _,tc as j,uc as Z,wb as h,yb as x,zb as B,zc as k}from"./chunk-46QINP2S.js";import{a as W,b as J}from"./chunk-BDOJB7O2.js";var it=(()=>{class i{constructor(e,t){this.itemService=e,this.formConfig=t,this.items=this.itemService.getManySignal(this.formConfig.config.itemGuids)}static{this.\u0275fac=function(t){return new(t||i)(C(me),C(se))}}static{this.\u0275cmp=v({type:i,selectors:[["app-data-dump"]],decls:3,vars:3,consts:[["readonly","",1,"fancy-scrollbar-light"]],template:function(t,n){t&1&&(Te(0,"textarea",0),a(1),k(2,"json"),Fe()),t&2&&(s(),P(L(2,1,n.items())))},dependencies:[Y],styles:[`[_nghost-%COMP%]{width:100%;height:100%;display:flex}textarea[_ngcontent-%COMP%]{flex:1 1 auto;margin:0;padding:10px 0 10px 10px;border:0px;box-sizing:border-box;resize:none;outline:none;background-color:#1d273d0a}
/*# sourceMappingURL=data-dump-NAB4VZSU.css.map */`]})}}return i})();var nt={Data:"data",Formulas:"formulas",Logs:"logs"};var R={Entity:"entityGuid",Field:"fieldValue",Target:"formulaTarget"};var ot=(()=>{class i{constructor(){this.maxLength=24}transform(e){return e.length<=this.maxLength?e:`\u2026${e.substring(e.length-this.maxLength)}`}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275pipe=De({name:"snippetLabelSize",type:i,pure:!0})}}return i})();var xt=(i,c)=>({disabled:i,focused:c}),bt=i=>({disabled:i}),Me=i=>({"has-formula":i}),vt=(i,c)=>c.entityGuid,Mt=(i,c)=>c.fieldName,rt=(i,c)=>c.code;function yt(i,c){if(i&1&&(o(0,"mat-option",4)(1,"span",27),a(2),r()()),i&2){let e=c.$implicit;p("value",e.entityGuid),s(),p("ngClass",j(3,Me,e.hasFormula)),s(),M(" ",e.label," ")}}function St(i,c){if(i&1&&(o(0,"mat-option",4)(1,"span",27),a(2),r()()),i&2){let e=c.$implicit;p("value",e.fieldName),s(),p("ngClass",j(3,Me,e.hasFormula)),s(),M(" ",e.fieldName," ")}}function Dt(i,c){if(i&1&&(o(0,"mat-option",4)(1,"span",27),a(2),r()()),i&2){let e=c.$implicit;p("value",e.target),s(),p("ngClass",j(3,Me,e.hasFormula)),s(),M(" ",e.label," ")}}function Tt(i,c){if(i&1){let e=b();o(0,"mat-select",5),d("ngModelChange",function(n){f(e);let l=m(2);return _(l.selectedChanged(l.SelectTargets.Target,n))}),O(1,Dt,3,5,"mat-option",4,B),r()}if(i&2){let e=m(2);p("ngModel",e.state().target)("disabled",e.state().entityGuid==null||e.state().fieldName==null),s(),E(e.targetOptions())}}function Ft(i,c){if(i&1){let e=b();o(0,"input",28),d("ngModelChange",function(n){f(e);let l=m(2);return _(l.selectedChanged(l.SelectTargets.Target,n))}),r()}if(i&2){let e=m(2);p("ngModel",e.state().target)("disabled",e.state().entityGuid==null||e.state().fieldName==null)}}function Ot(i,c){if(i&1){let e=b();o(0,"div",29),d("click",function(){let n=f(e).$implicit,l=m(2);return _(l.clipboard.copyToClipboard(n.code))}),a(1),k(2,"snippetLabelSize"),r()}if(i&2){let e=c.$implicit;p("title",e.code),s(),M(" ",L(2,2,e.label)," ")}}function Et(i,c){i&1&&w(0,"div",17)}function wt(i,c){if(i&1){let e=b();o(0,"div",29),d("click",function(){let n=f(e).$implicit,l=m(2);return _(l.clipboard.copyToClipboard(n.code))}),a(1),k(2,"snippetLabelSize"),r()}if(i&2){let e=c.$implicit;p("title",e.code),s(),M(" ",L(2,2,e.label)," ")}}function kt(i,c){if(i&1&&(o(0,"span"),a(1),k(2,"json"),r()),i&2){let e=m(4);s(),P(L(2,1,e.result().value))}}function Pt(i,c){i&1&&(o(0,"span",31),a(1,"undefined"),r())}function Lt(i,c){i&1&&(o(0,"span"),a(1,"promise(\u{1F91E}\u{1F3FD})"),r())}function It(i,c){if(i&1&&h(0,kt,3,3,"span")(1,Pt,2,0,"span",31)(2,Lt,2,0,"span"),i&2){let e=m(3);x(e.result().value!==void 0?0:e.result().isOnlyPromise?2:1)}}function Vt(i,c){i&1&&(o(0,"span",30),a(1," Calculation failed. Please check console for more info "),r())}function Bt(i,c){if(i&1&&h(0,It,3,1)(1,Vt,2,0,"span",30),i&2){let e=m(2);x(e.result().isError?1:0)}}function jt(i,c){if(i&1){let e=b();o(0,"button",32),d("click",function(){f(e);let n=m(2);return _(n.save())}),o(1,"mat-icon"),a(2,"save"),r()()}if(i&2){let e,t,n=m(2);p("tippyDisabled",!n.state().editMode||!((e=n.currentFormula())!=null&&e.sourceCode))("disabled",!n.state().editMode||!((t=n.currentFormula())!=null&&t.sourceCode)||n.saving())}}function Nt(i,c){if(i&1){let e=b();o(0,"div",1)(1,"mat-form-field",2)(2,"mat-label"),a(3,"Entity"),r(),o(4,"mat-select",3),d("ngModelChange",function(n){f(e);let l=m();return _(l.selectedChanged(l.SelectTargets.Entity,n))}),O(5,yt,3,5,"mat-option",4,vt),r()(),o(7,"mat-form-field",2)(8,"mat-label"),a(9,"Attribute"),r(),o(10,"mat-select",5),d("ngModelChange",function(n){f(e);let l=m();return _(l.selectedChanged(l.SelectTargets.Field,n))}),O(11,St,3,5,"mat-option",4,Mt),r()(),o(13,"mat-form-field",2)(14,"mat-label"),a(15,"Target"),r(),h(16,Tt,3,2,"mat-select",6)(17,Ft,1,2,"input",7),r(),o(18,"button",8),d("click",function(){f(e);let n=m();return _(n.toggleFreeText())}),o(19,"mat-icon"),a(20,"text_fields"),r()(),w(21,"div",9),o(22,"a",10)(23,"mat-icon"),a(24,"help"),r()()(),o(25,"div",11)(26,"div",12)(27,"mat-label",13),a(28,"Function"),r(),o(29,"app-monaco-editor",14),d("valueChanged",function(n){f(e);let l=m();return _(l.formulaChanged(n))})("focused",function(){f(e);let n=m();return _(n.onFocused(!0))})("blurred",function(){f(e);let n=m();return _(n.onFocused(!1))}),r()(),o(30,"div",15),O(31,Ot,3,4,"div",16,rt),h(33,Et,1,0,"div",17),O(34,wt,3,4,"div",16,rt),r()(),o(36,"div",18)(37,"div",19)(38,"span",13),a(39,"Result:\xA0"),r(),h(40,Bt,2,1),r(),o(41,"div",20)(42,"button",21),d("click",function(){f(e);let n=m();return _(n.toggleEdit())}),o(43,"mat-icon"),a(44,"edit"),r()(),o(45,"button",22)(46,"mat-icon"),a(47,"more_vert"),r()(),o(48,"mat-menu",null,0)(50,"button",23),d("click",function(){f(e);let n=m();return _(n.deleteFormula())}),o(51,"mat-icon"),a(52,"delete"),r(),o(53,"span"),a(54,"Delete"),r()(),o(55,"button",24),d("click",function(){f(e);let n=m();return _(n.reset())}),o(56,"mat-icon"),a(57,"history"),r(),o(58,"span"),a(59,"Reset"),r()()(),h(60,jt,3,2,"button",25),o(61,"button",26),d("click",function(){f(e);let n=m();return _(n.run())}),o(62,"mat-icon"),a(63,"play_arrow"),r()()()()}if(i&2){let e,t,n,l,u=Oe(49),g=m();s(4),p("ngModel",g.state().entityGuid),s(),E(g.entityOptions()),s(5),p("ngModel",g.state().fieldName)("disabled",g.state().entityGuid==null),s(),E(g.fieldsOptions()),s(5),x(g.freeTextTarget?17:16),s(2),p("disabled",g.state().entityGuid==null||g.state().fieldName==null),s(8),p("ngClass",Z(17,xt,!g.state().editMode||g.state().entityGuid==null||g.state().fieldName==null||g.state().target==null,g.focused)),s(3),p("filename",g.filename)("value",((e=g.currentFormula())==null?null:e.sourceCode)??g.template())("jsTypings",g.v2JsTypings())("options",g.monacoOptions),s(),p("ngClass",j(20,bt,!g.state().editMode)),s(),E(g.v1DataSnippets()),s(2),x((t=g.v1DataSnippets())!=null&&t.length&&g.v1ContextSnippets().length?33:-1),s(),E(g.v1ContextSnippets()),s(6),x(g.result()!=null&&!g.isDeleted()?40:-1),s(5),p("matMenuTriggerFor",u),s(5),p("disabled",!((n=g.currentFormula())!=null&&n.sourceCodeId)),s(10),x(g.allowSaveFormula?60:-1),s(),p("disabled",!g.state().editMode||!((l=g.currentFormula())!=null&&l.sourceCode))}}var at=(()=>{class i{#e;#t;constructor(e,t,n,l,u){this.snackBar=e,this.formConfig=t,this.itemService=n,this.contentTypeService=l,this.translate=u,this.log=Q({FormulaDesignerComponent:i}),this.#e=U(Ue),this.#t=G(tt),this.clipboard=G(fe),this.SelectTargets=R,this.loadError=!1,this.freeTextTarget=!1,this.allowSaveFormula=this.formConfig.config.enableFormulaSave,this.isDeleted=he(!1),this.saving=he(!1),this.monacoOptions={minimap:{enabled:!1},lineHeight:19,lineNumbers:"off",lineDecorationsWidth:0,folding:!1,scrollBeyondLastLine:!1,tabSize:2,fixedOverflowWidgets:!0},this.filename=`formula${this.formConfig.config.formId}.js`,this.focused=!1,this.state=this.#e.designerState,this.result=this.#e.formulaResult,this.targetOptions=this.#e.currentTargetOptions,this.entityOptions=this.#e.entityOptions,this.fieldsOptions=this.#e.fieldsOptions,this.currentFormula=this.#e.currentFormula,this.v2JsTypings=this.#e.v2JsTypings,this.v1ContextSnippets=this.#e.v1ContextSnippets,this.v1DataSnippets=this.#e.v1DataSnippets,this.template=we(()=>Object.values(He).includes(this.state().target)?Je:We)}ngOnInit(){if(this.loadError=!1,Object.keys(this.#e.itemSettingsServices).length<1){this.loadError=!0;return}this.#e.setDesignerOpen(!0),this.#e.initAfterItemSettingsAreReady()}ngOnDestroy(){this.#e.setDesignerOpen(!1)}selectedChanged(e,t){let n=J(W({},this.#e.designerState()),{editMode:!1});switch(e){case R.Entity:n.entityGuid=t;let l=this.#e.itemSettingsServices[n.entityGuid];n.fieldName=Object.keys(l.allProps())[0];break;case R.Field:n.fieldName=t;break;case R.Target:n.target=t;break}this.#e.designerState.set(n)}toggleFreeText(){this.freeTextTarget=!this.freeTextTarget}formulaChanged(e){this.#e.cache.updateFormulaFromEditor(this.#i,e,!1)}onFocused(e){this.focused=e}toggleEdit(){let e=this.#e.designerState(),t=J(W({},e),{editMode:!e.editMode});this.#e.designerState.set(t),t.editMode&&this.#e.currentFormula()==null&&this.#e.cache.updateFormulaFromEditor(this.#i,this.template(),!1)}reset(){let e=J(W({},this.#e.designerState()),{editMode:!1}),t=this.#i;this.#e.designerState.set(e),this.#e.cache.resetFormula(t),this.#e.itemSettingsServices[t.entityGuid].retriggerFormulas("designer-reset")}run(){let e=this.#i,t=this.#e.currentFormula();this.#e.cache.updateFormulaFromEditor(e,t.sourceCode,!0),this.#e.itemSettingsServices[e.entityGuid].retriggerFormulas("designer-run"),this.isDeleted.set(!1)}get#i(){let e=this.#e.designerState();return{entityGuid:e.entityGuid,fieldName:e.fieldName,target:e.target}}save(){this.saving.set(!0);let e=this.#e.currentFormula();if(e.sourceCodeId==null){let t=this.itemService.get(e.entityGuid),l=this.contentTypeService.getAttributeOfItem(t,e.fieldName).Metadata.find(u=>u.Type.Id==="@All");if(!l){this.snackBar.open("Field configuration is missing. Please create formula in Administration",void 0,{duration:3e3}),this.saving.set(!1);return}this.#t.create(le.contentTypes.formulas,{Title:e.target,Target:e.target,Formula:e.sourceCode,Enabled:!0,ParentRelationship:Ne.relationship(l.Guid,"Formulas")}).subscribe(u=>{this.#e.cache.updateSaved(e,u.Guid,u.Id),this.snackBar.open("Formula saved",null,{duration:2e3}),this.saving.set(!1)});return}this.#t.update(le.contentTypes.formulas,e.sourceCodeId,{Formula:e.sourceCode}).subscribe(()=>{this.#e.cache.updateSaved(e,e.sourceCodeGuid,e.sourceCodeId),this.snackBar.open("Formula saved",null,{duration:2e3}),this.saving.set(!1)})}deleteFormula(){let e=this.#e.designerState(),t=this.#e.currentFormula(),n=t.sourceCodeId,l=t.fieldName+" - "+t.target;confirm(this.translate.instant("Data.Delete.Question",{title:l,id:n}))&&this.#t.delete(le.contentTypes.formulas,t.sourceCodeId,!0).subscribe({next:()=>{this.#e.cache.delete(t),this.snackBar.open(this.translate.instant("Message.Deleted"),null,{duration:2e3}),this.isDeleted.set(!0),e.editMode&&this.toggleEdit()},error:g=>{this.snackBar.open(this.translate.instant("Message.DeleteError"),null,{duration:2e3})}})}static{this.\u0275fac=function(t){return new(t||i)(C(te),C(se),C(me),C(Ae),C(Ve))}}static{this.\u0275cmp=v({type:i,selectors:[["app-formula-designer"]],decls:1,vars:1,consts:[["menu","matMenu"],[1,"formula-context-box"],["color","accent",1,"eav-mat-form-field"],[3,"ngModelChange","ngModel"],[3,"value"],[3,"ngModelChange","ngModel","disabled"],[3,"ngModel","disabled"],["matInput","",3,"ngModel","disabled"],["mat-icon-button","","tippy","FreeText Target",1,"eav-formula-button",3,"click","disabled"],[1,"spacer"],["mat-icon-button","","tippy","Help","href","https://go.2sxc.org/formulas","target","_blank",1,"eav-formula-button"],[1,"formula-box"],[1,"formula-field",3,"ngClass"],[1,"label"],[1,"editor",3,"valueChanged","focused","blurred","filename","value","jsTypings","options"],[1,"formula-snippets","fancy-scrollbar-light",3,"ngClass"],[1,"snippet",3,"title"],[1,"separator"],[1,"formula-footer-box"],[1,"formula-result-box","hide-scrollbar"],[1,"formula-actions-box"],["mat-icon-button","","tippy","Edit",3,"click"],["mat-icon-button","","tippy","Menu",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"click"],["mat-icon-button","","tippy","Save",3,"tippyDisabled","disabled"],["mat-icon-button","","tippy","Run",3,"click","disabled"],[3,"ngClass"],["matInput","",3,"ngModelChange","ngModel","disabled"],[1,"snippet",3,"click","title"],[1,"result-error"],[1,"result-undefined"],["mat-icon-button","","tippy","Save",3,"click","tippyDisabled","disabled"]],template:function(t,n){t&1&&h(0,Nt,64,22),t&2&&x(n.loadError?-1:0)},dependencies:[ee,q,X,Ce,_e,ge,I,ze,Ge,Re,ue,A,de,ce,T,D,S,y,z,qe,Qe,Ye,Xe,F,Y,ot],styles:[`[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;box-sizing:border-box;overflow:hidden;border-top:1px solid lightgray;padding-top:8px}.formula-context-box[_ngcontent-%COMP%]{display:flex;align-items:center}.formula-context-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px}.formula-context-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.has-formula[_ngcontent-%COMP%]{font-weight:700}.formula-box[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;overflow:hidden}.formula-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{flex:0 1 auto;font-size:14px;width:100%}.formula-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-family:monospace}.formula-box[_ngcontent-%COMP%]   .formula-field[_ngcontent-%COMP%]{flex:0 1 auto;width:100%;overflow:hidden;margin-bottom:6px}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]{flex:0 0 auto;max-width:200px;max-height:194px;overflow:hidden auto;padding-left:2px}.formula-box[_ngcontent-%COMP%]   .formula-snippets.disabled[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]{pointer-events:none;color:#1d273d70}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;white-space:nowrap;padding-top:1px;padding-bottom:1px}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]:first-of-type{padding-top:0}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]:last-of-type{padding-bottom:0}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:.5em;margin-bottom:.5em;border-bottom:1px solid rgba(29,39,61,.44)}.formula-footer-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;overflow:hidden;height:min-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;height:fit-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .result-undefined[_ngcontent-%COMP%], .formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .result-error[_ngcontent-%COMP%]{color:red}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;height:fit-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]   .mdc-icon-button[_ngcontent-%COMP%]{margin-left:0;width:30px;height:30px;line-height:30px;padding:0;flex-shrink:0}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]   .mdc-icon-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-top:5px;font-size:20px;width:20px;height:20px;line-height:20px!important}.formula-field[_ngcontent-%COMP%]{padding-top:28px;border-bottom:1px solid rgba(0,0,0,.2);padding-bottom:12px;position:relative}.formula-field[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;color:#0009;cursor:default;font-size:12px;transition:none;position:absolute;left:0;top:0;-webkit-user-select:none;user-select:none}.formula-field[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]     .monaco-editor .scroll-decoration{display:none}.formula-field[_ngcontent-%COMP%]:hover{border-bottom:2px solid rgba(0,0,0,.4);padding-bottom:11px}.formula-field.focused[_ngcontent-%COMP%]{border-bottom:2px solid #002753;padding-bottom:11px}.formula-field.focused[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#002753}.formula-field.error[_ngcontent-%COMP%]{border-bottom:2px solid #b00030;padding-bottom:11px}.formula-field.error[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#b00030}.formula-field.disabled[_ngcontent-%COMP%]{border-bottom:none;padding-bottom:13px;background-image:linear-gradient(to right,rgba(0,0,0,.2) 0%,rgba(0,0,0,.2) 33%,transparent 0%);background-position:bottom;background-size:4px 1px;background-repeat:repeat-x}.formula-field.disabled[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]{pointer-events:none}.formula-field.disabled[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]     *{color:#00000061}
/*# sourceMappingURL=formula-designer-YKSBBVQ5.css.map */`]})}}return i})();var lt=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=Se({type:i});static \u0275inj=ye({})}return i})();var ct=(()=>{class i{constructor(e,t){this.dialog=e,this.data=t,this.hostClass="dialog-component",this.focused=!1,this.editorOptions={theme:"vs-light",language:"json",readOnly:!0,automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1},this.filename="exported-config.json",this.clipboard=G(fe),this.selectedConfig=JSON.stringify(t.configData,null,2)}onFocused(e){this.focused=e}static{this.\u0275fac=function(t){return new(t||i)(C(ie),C(ne))}}static{this.\u0275cmp=v({type:i,selectors:[["app-monaco-editor-dialog"]],hostVars:1,hostBindings:function(t,n){t&2&&K("className",n.hostClass)},decls:13,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","mat-dialog-close","","tippy","Close dialog"],[1,"eav-dialog-content",2,"padding-bottom","0"],[2,"height","350px","width","100%",3,"focused","blurred","filename","value","options"],["mat-icon-button","","tippy","Copy Config To Clipboard",3,"click"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),a(3,"Configs Exporter"),r(),o(4,"button",3)(5,"mat-icon"),a(6,"close"),r()()(),o(7,"div",4)(8,"app-monaco-editor",5),d("focused",function(){return n.onFocused(!0)})("blurred",function(){return n.onFocused(!1)}),r()(),o(9,"mat-dialog-actions")(10,"button",6),d("click",function(){return n.clipboard.copyToClipboard(n.selectedConfig)}),o(11,"mat-icon"),a(12,"content_copy"),r()()()()),t&2&&(s(8),p("filename",n.filename)("value",n.selectedConfig)("options",n.editorOptions))},dependencies:[ae,oe,re,I,z,T,D,lt,S,y,F],encapsulation:2})}}return i})();var dt=(()=>{class i{constructor(e,t){this.dialog=e,this.data=t,this.hostClass="dialog-component",this.focused=!1,this.editorOptions={theme:"vs-light",language:"json",readOnly:!1,automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1},this.filename="log-specs.json",this.logSpecs=JSON.stringify(t.logSpecs,null,2)}onClose(){this.dialog.close()}onSave(){this.dialog.close(this.logSpecs)}onValueChanged(e){this.logSpecs=e}onFocused(e){this.focused=e}static{this.\u0275fac=function(t){return new(t||i)(C(ie),C(ne))}}static{this.\u0275cmp=v({type:i,selectors:[["app-monaco-editor-dialog"]],hostVars:1,hostBindings:function(t,n){t&2&&K("className",n.hostClass)},decls:13,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","mat-dialog-close","","tippy","Close dialog"],[1,"eav-dialog-content",2,"padding-bottom","0"],[2,"height","350px","width","100%",3,"valueChanged","focused","blurred","filename","value","options"],["mat-icon-button","","tippy","Save Specs",3,"click"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),a(3,"Log Specs Editor"),r(),o(4,"button",3)(5,"mat-icon"),a(6,"close"),r()()(),o(7,"div",4)(8,"app-monaco-editor",5),d("valueChanged",function(u){return n.onValueChanged(u)})("focused",function(){return n.onFocused(!0)})("blurred",function(){return n.onFocused(!1)}),r()(),o(9,"mat-dialog-actions")(10,"button",6),d("click",function(){return n.onSave()}),o(11,"mat-icon"),a(12,"save"),r()()()()),t&2&&(s(8),p("filename",n.filename)("value",n.logSpecs)("options",n.editorOptions))},dependencies:[ae,oe,re,I,z,T,D,S,y,F],encapsulation:2})}}return i})();function zt(i,c){if(i&1&&(o(0,"mat-option",13),a(1),r()),i&2){let e=c.$implicit;p("value",e),s(),M(" ",e," ")}}function Gt(i,c){if(i&1){let e=b();o(0,"button",16),d("click",function(){f(e);let n=m().$implicit,l=m();return _(l.openLogSpecs(n.key))}),o(1,"mat-icon",17),a(2,"data_object"),r()()}}function Rt(i,c){if(i&1){let e=b();o(0,"div")(1,"label")(2,"input",14),d("change",function(){let n=f(e).$implicit,l=m();return _(l.toggleConfig(n.key))}),r(),a(3),h(4,Gt,3,0,"button",15),r()()}if(i&2){let e=c.$implicit,t=m();s(2),p("id",e.key)("name",e.key)("checked",t.isChecked(e.key)),s(),M(" ",e.key," "),s(),x(t.hasLogSpecs(e.key)?4:-1)}}var mt=(()=>{class i{constructor(e,t,n){this.loggingService=e,this.matDialog=t,this.snackBar=n,this.LogSeverities=N,this.logManager=Ie.singleton(),this.allLogs=this.logManager.mergeAllSpecs,this.configs=[],this.sessionPrefix="logSpecs",this.selectedConfig=null,this.searchTerm="",this.logs=this.loggingService.getLogsSignal(),this.loadConfigsFromStateManager()}checkAll(){if(Object.values(this.allLogs).every(t=>t.enabled))for(let t of Object.keys(this.allLogs))this.isChecked(t)&&this.logManager.toggle(t);else for(let t of Object.keys(this.allLogs))this.isChecked(t)||this.logManager.toggle(t);this.applyFilters()}onFilterSelected(e){this.selectedFilter=e,this.applyFilters()}filterLogs(e){let t=e.target;this.searchTerm=t.value.toLowerCase(),this.applyFilters()}isChecked(e){return this.allLogs[e]?.enabled??!1}toggleConfig(e){this.logManager.toggle(e),this.applyFilters()}loadConfigsFromStateManager(){let e=Object.keys(this.logManager.state.cache).filter(t=>t.startsWith(this.sessionPrefix));this.configs=e.map(t=>t.replace(`${this.sessionPrefix}.`,""))}onConfigSelected(e){this.selectedConfig=e}applyFilters(){let e=Object.entries(this.logManager.mergeAllSpecs);this.searchTerm&&(e=e.filter(([t])=>t.toLowerCase().includes(this.searchTerm))),this.selectedFilter==="activated"?e=e.filter(([,t])=>t.enabled):this.selectedFilter==="deactivated"&&(e=e.filter(([,t])=>!t.enabled)),this.allLogs=Object.fromEntries(e)}saveConfig(){let e=prompt("Enter the config name:");if(e){let t=Object.fromEntries(Object.entries(this.logManager.mergeAllSpecs).filter(([,l])=>l.enabled)),n=`${this.sessionPrefix}.${e}`;this.logManager.state.add(n,t),this.snackBar.open(`Config "${e}" has been saved.`,null,{duration:2e3}),this.loadConfigsFromStateManager()}}exportConfig(){let e=`${this.sessionPrefix}.${this.selectedConfig}`,t=this.logManager.state.cache[e];t&&Object.keys(t).length>0?this.matDialog.open(ct,{width:"800px",data:{configData:t}}):this.snackBar.open(`No active logs to export for "${this.selectedConfig}".`,null,{duration:2e3}),this.applyFilters()}hasLogSpecs(e){let t=this.allLogs[e]?.specs;return!!t&&Object.keys(t).length>0}openLogSpecs(e){let t=this.allLogs[e].specs;this.matDialog.open(dt,{width:"800px",data:{logSpecs:t}}).afterClosed().subscribe(l=>{if(l){let u=JSON.parse(l);this.allLogs[e].specs=u,this.logManager.updateSpecs(this.allLogs)}})}static{this.\u0275fac=function(t){return new(t||i)(C(pe),C(je),C(te))}}static{this.\u0275cmp=v({type:i,selectors:[["app-logs-config"]],decls:34,vars:5,consts:[[1,"log-content","fancy-scrollbar-light"],[1,"menu"],["id","search-input","color","accent"],["matInput","","placeholder","Search",3,"input"],["id","active-filter-dropdown","color","accent"],[3,"valueChange","selectionChange","value"],["value",""],["value","activated"],["value","deactivated"],["mat-icon-button","","tippy","Toggle All Logs in View",3,"click"],["mat-icon-button","","tippy","Save Configuration with all selected Logs",3,"click"],["mat-icon-button","","tippy","Export the selected configuration from the saved Configs",3,"click","disabled"],["color","accent"],[3,"value"],["type","checkbox",3,"change","id","name","checked"],["tippy","Edit Log Specs"],["tippy","Edit Log Specs",3,"click"],[1,"specs-icon"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label"),a(4,"Search"),r(),o(5,"input",3),d("input",function(u){return n.filterLogs(u)}),r()(),o(6,"mat-form-field",4)(7,"mat-label"),a(8,"Show"),r(),o(9,"mat-select",5),ve("valueChange",function(u){return be(n.selectedFilter,u)||(n.selectedFilter=u),u}),d("selectionChange",function(u){return n.onFilterSelected(u.value)}),o(10,"mat-option",6),a(11," All "),r(),o(12,"mat-option",7),a(13," Activated "),r(),o(14,"mat-option",8),a(15," Deactivated "),r()()(),o(16,"button",9),d("click",function(){return n.checkAll()}),o(17,"mat-icon"),a(18,"check_box"),r()(),o(19,"button",10),d("click",function(){return n.saveConfig()}),o(20,"mat-icon"),a(21,"save"),r()(),o(22,"button",11),d("click",function(){return n.exportConfig()}),o(23,"mat-icon"),a(24,"ios_share"),r()(),o(25,"mat-form-field",12)(26,"mat-label"),a(27,"Configs"),r(),o(28,"mat-select",5),ve("valueChange",function(u){return be(n.selectedConfig,u)||(n.selectedConfig=u),u}),d("selectionChange",function(u){return n.onConfigSelected(u.value)}),O(29,zt,2,2,"mat-option",13,B),r()()(),O(31,Rt,5,5,"div",null,B),k(33,"keyvalue"),r()),t&2&&(s(9),xe("value",n.selectedFilter),s(13),p("disabled",n.selectedConfig===null),s(6),xe("value",n.selectedConfig),s(),E(n.configs),s(2),E(L(33,3,n.allLogs)))},dependencies:[Le,S,y,T,D,F,ee,q,X,Ce,_e,ge,ue,I,de,ce,Pe],styles:[`[_nghost-%COMP%]{height:100%;overflow:auto}.log-content[_ngcontent-%COMP%]{padding-top:8px;border-top:1px solid lightgray}.menu[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}mat-form-field[_ngcontent-%COMP%]{margin:0 1rem 1rem 0}button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:0;margin:0}.specs-icon[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;height:1rem;width:1rem;padding:0;margin:0}#search-input[_ngcontent-%COMP%], #active-filter-dropdown[_ngcontent-%COMP%]{width:120px}
/*# sourceMappingURL=logs-config-KA4OECVD.css.map */`]})}}return i})();var $t=(i,c)=>({"log-error":i,"log-warn":c});function Ht(i,c){i&1&&(o(0,"div"),a(1,"Logs are empty"),r())}function Wt(i,c){if(i&1){let e=b();o(0,"div",5)(1,"span",6),a(2),k(3,"date"),r(),o(4,"span",7),a(5),r(),o(6,"span",8),d("click",function(){let n=f(e).$implicit,l=m(2);return _(l.logToConsole(n))}),a(7," console "),r()()}if(i&2){let e=c.$implicit,t=m(2);p("ngClass",Z(6,$t,e.severity===t.LogSeverities.Error,e.severity===t.LogSeverities.Warn)),s(2),M("",Ee(3,3,e.time,"HH:mm:ss"),":"),s(3),P(e.label)}}function Jt(i,c){if(i&1&&(h(0,Ht,2,0,"div"),O(1,Wt,8,9,"div",5,B)),i&2){let e=m();x(e.logs().length===0?0:-1),s(),E(e.logs())}}function Ut(i,c){i&1&&w(0,"app-logs-config")}var pt=(()=>{class i{constructor(e){this.loggingService=e,this.LogSeverities=N,this.showSettings=!0,this.logs=this.loggingService.getLogsSignal()}logToConsole(e){switch(e.severity){case N.Log:console.log(e.label,e.error);break;case N.Warn:console.warn(e.label,e.error);break;case N.Error:console.error(e.label,e.error);break}}showLogSettings(e){this.showSettings=e}static{this.\u0275fac=function(t){return new(t||i)(C(pe))}}static{this.\u0275cmp=v({type:i,selectors:[["app-logs-dump"]],decls:11,vars:1,consts:[[1,"logs-box","fancy-scrollbar-light"],[1,"logs-content"],[1,"log-button"],["mat-icon-button","","tippy","Show Logs Settings",3,"click"],["mat-icon-button","","tippy","Show Logs Output",3,"click"],[1,"log-entry",3,"ngClass"],[1,"log-entry-part","log-entry-time"],[1,"log-entry-part","log-entry-label"],["tippy","Log to console",1,"log-entry-part","log-entry-show",3,"click"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1),h(2,Jt,3,1)(3,Ut,1,0,"app-logs-config"),r(),o(4,"div",2)(5,"button",3),d("click",function(){return n.showLogSettings(!0)}),o(6,"mat-icon"),a(7,"settings"),r()(),o(8,"button",4),d("click",function(){return n.showLogSettings(!1)}),o(9,"mat-icon"),a(10,"contract"),r()()()()),t&2&&(s(2),x(n.showSettings?3:2))},dependencies:[A,S,y,T,D,mt,F,ke],styles:[`[_nghost-%COMP%]{height:100%;width:100%}.logs-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.logs-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;overflow-x:hidden}.log-button[_ngcontent-%COMP%]{position:relative;padding-top:10px;background:#fff}.log-entry[_ngcontent-%COMP%]{display:flex;align-items:center;box-sizing:border-box;border-bottom:1px solid rgb(240,240,240);padding-top:2px;padding-bottom:2px}.log-entry[_ngcontent-%COMP%]   .log-entry-part[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.log-error[_ngcontent-%COMP%]{color:red;border-color:#ffd6d6;background-color:#fff0f0}.log-warn[_ngcontent-%COMP%]{color:#5c3c00;border-color:#fff5c2;background-color:#fffbe5}.log-entry-time[_ngcontent-%COMP%]{flex:0 0 auto}.log-entry-label[_ngcontent-%COMP%]{flex:1 1 auto}.log-entry-show[_ngcontent-%COMP%]{flex:0 0 auto;color:#06599a;font-size:12px;text-decoration:underline;cursor:pointer}
/*# sourceMappingURL=logs-dump-2GI37XHD.css.map */`]})}}return i})();var Kt=i=>({"debug-enabled":i});function Zt(i,c){if(i&1){let e=b();o(0,"button",9),d("click",function(){f(e);let n=m();return _(n.closeDialog())}),o(1,"mat-icon"),a(2,"close"),r()(),o(3,"button",10),d("click",function(){f(e);let n=m();return _(n.toggleSize())}),o(4,"mat-icon"),a(5),r()()}if(i&2){let e=m();s(3),p("tippy",e.preferences().expanded?"shrink":"expand"),s(2),P(e.preferences().expanded?"unfold_less":"expand")}}function Yt(i,c){if(i&1){let e=b();o(0,"button",10),d("click",function(){f(e);let n=m();return _(n.prefManager.toggle("pinned"))}),o(1,"mat-icon"),a(2),r()()}if(i&2){let e=m();p("tippy","Developer tools are only visible to developers. "+e.pinResource("status")),s(2),P(e.pinResource("icon"))}}function Qt(i,c){i&1&&w(0,"app-data-dump")}function Xt(i,c){i&1&&w(0,"app-formula-designer")}function qt(i,c){i&1&&w(0,"app-logs-dump")}function ei(i,c){if(i&1&&(o(0,"div",8),h(1,Qt,1,0,"app-data-dump")(2,Xt,1,0,"app-formula-designer")(3,qt,1,0,"app-logs-dump"),r()),i&2){let e,t=m();p("ngClass","size"+(t.preferences().expanded?"-xl":"")),s(),x((e=t.preferences().tab)===t.DebugTypes.Data?1:e===t.DebugTypes.Formulas?2:e===t.DebugTypes.Logs?3:-1)}}var ro=(()=>{class i{constructor(){this.log=Q({EditDialogFooterComponent:i}),this.DebugTypes=nt,this.sxcVer=window.sxcVersion.substring(0,window.sxcVersion.lastIndexOf(".")),this.prefManager=U($e).part(et),this.preferences=this.prefManager.data}toggleDialog(e){let t=this.preferences(),n=t.tab===e,l=n?null:e,u=n?!1:t.expanded,g=n?0:u?2:1;this.prefManager.setMany({tab:l,expanded:u,size:g})}closeDialog(){this.prefManager.setMany({tab:null,expanded:!1,size:0})}toggleSize(){let e=!this.preferences().expanded,t=e?2:1;this.prefManager.setMany({expanded:e,size:t})}pinResource(e){return ti[`${e}-${this.preferences().pinned}`]}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=v({type:i,selectors:[["app-edit-dialog-footer"]],decls:23,vars:6,consts:[["appearance","raised",1,"mat-elevation-z4",3,"ngClass"],[1,"debug-buttons-container"],["mat-button","","tippy","Show Data JSON",3,"click"],["mat-button","","tippy","Show Formula Designer",3,"click"],["mat-button","","tippy","Show Logs",3,"click"],[1,"spacer"],["mat-icon-button","",3,"tippy"],[1,"sxc-version"],[1,"debug-info-container",3,"ngClass"],["mat-icon-button","","tippy","close",3,"click"],["mat-icon-button","",3,"click","tippy"]],template:function(t,n){t&1&&(o(0,"mat-card",0)(1,"div",1)(2,"button",2),d("click",function(){return n.toggleDialog(n.DebugTypes.Data)}),o(3,"mat-icon"),a(4,"offline_bolt"),r(),o(5,"span"),a(6,"Data"),r()(),o(7,"button",3),d("click",function(){return n.toggleDialog(n.DebugTypes.Formulas)}),o(8,"mat-icon"),a(9,"functions"),r(),o(10,"span"),a(11,"Formulas"),r()(),o(12,"button",4),d("click",function(){return n.toggleDialog(n.DebugTypes.Logs)}),o(13,"mat-icon"),a(14,"speed"),r(),o(15,"span"),a(16,"Logs"),r()(),w(17,"div",5),h(18,Zt,6,2)(19,Yt,3,2,"button",6),o(20,"div",7),a(21),r()(),h(22,ei,4,2,"div",8),r()),t&2&&(p("ngClass",j(4,Kt,n.preferences().tab!=null)),s(18),x(n.preferences().tab!=null?18:19),s(3),M(" 2sxc ",n.sxcVer," "),s(),x(n.preferences().tab!=null?22:-1))},dependencies:[Ze,Ke,T,Be,D,S,y,A,it,at,pt,F],styles:[`.mat-mdc-card[_ngcontent-%COMP%]{padding:0;margin:0;border-top-left-radius:0;border-top-right-radius:0;height:var(--edit-footer-bar-height);z-index:1;width:100%;display:flex;flex-direction:column;box-sizing:border-box}@media(max-width:600px){.mat-mdc-card[_ngcontent-%COMP%]{border-radius:0}}.mat-mdc-card.debug-enabled[_ngcontent-%COMP%]{height:auto}.debug-buttons-container[_ngcontent-%COMP%]{padding:17px 16px 15px;height:var(--edit-footer-bar-height);width:100%;display:flex;box-sizing:border-box;align-items:center}.debug-buttons-container[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{margin-left:0}.debug-buttons-container[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:4px}.debug-buttons-container[_ngcontent-%COMP%]   .sxc-version[_ngcontent-%COMP%]{cursor:default;margin-left:1rem}.mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;line-height:20px!important}.debug-info-container[_ngcontent-%COMP%]{margin:var(--edit-footer-container-margin)!important;margin-top:0!important;width:calc(100% - 2 * var(--edit-footer-container-margin));height:var(--edit-footer-container-height);box-sizing:border-box;position:relative;overflow:auto}.debug-info-container.size-xl[_ngcontent-%COMP%]{height:calc(2 * var(--edit-footer-container-height))}
/*# sourceMappingURL=edit-dialog-footer-C6HUY3ZN.css.map */`]})}}return i})(),ti={"status-true":"pinned - will remain visible on reload","status-false":"not pinned - will hide on reload","icon-true":"keep_public","icon-false":"keep_off"};export{ro as EditDialogFooterComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/edit-dialog-footer-2RDSRB2Z.js.map
