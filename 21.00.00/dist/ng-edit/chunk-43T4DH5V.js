import{a as J}from"./chunk-J5KNE364.js";import{e as p}from"./chunk-RAUQWANF.js";import{a as K}from"./chunk-3S44UA6M.js";import{b as N,d as Q}from"./chunk-S7Y6G6OZ.js";import{a as q}from"./chunk-EDOMTBDN.js";import{a as $}from"./chunk-ORK43FFD.js";import{a as V}from"./chunk-L77E4UL2.js";import{a as L}from"./chunk-JNRBLGLU.js";import{a as D}from"./chunk-564RKXG7.js";import{c}from"./chunk-HJXR3IL7.js";import{c as G}from"./chunk-HCPBPEHV.js";import{c as x,f as F,g as B,i as j,l as E}from"./chunk-QVLOO535.js";import{c as z}from"./chunk-XREQECMQ.js";import{b as y,c as T}from"./chunk-23CS2WID.js";import{a as f,b as O}from"./chunk-OIHIMR2W.js";import{d as _}from"./chunk-OYQCZWOE.js";import{b as U,d as H,g as W}from"./chunk-G33ZJSCE.js";import{$a as R,Aa as C,Cb as w,Db as a,Ea as P,Eb as l,Fb as I,Gc as A,Pb as u,Sa as b,Za as g,db as v,ea as h,ec as d,u as k}from"./chunk-46QINP2S.js";import{a as n,b as m}from"./chunk-BDOJB7O2.js";var X=(()=>{class r{agInit(t){this.params=t}refresh(t){return!0}deletePermission(){let t=this.params.data;this.params.onDelete(t)}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275cmp=v({type:r,selectors:[["app-permissions-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1),u("click",function(){return i.deletePermission()}),a(2,"mat-icon"),d(3,"delete"),l()()())},dependencies:[B,x,T,y,z],encapsulation:2})}}return r})();var S="admin/metadata/get",Y=(()=>{class r extends L{getMetadata(t,e,i,o){return this.getHttpApiUrl(S,{params:n({appId:this.appId,targetType:t.toString(),keyType:e,key:i.toString()},o&&{contentType:o})})}getMetadataLive(t,e,i,o,s){return this.newHttpResource(()=>(t(),{url:this.apiUrl(S),params:n({appId:this.appId,targetType:e.toString(),keyType:i,key:o.toString()},s&&{contentType:s})}))}getMetadataPromise(t,e,i,o){return this.fetchPromise(S,{params:n({appId:this.appId,targetType:t.toString(),keyType:e,key:i.toString()},o&&{contentType:o})})}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=P(r)))(i||r)}})()}static{this.\u0275prov=h({token:r,factory:r.\u0275fac})}}return r})();var Z=(()=>{class r{constructor(){this.metadataService=f(Y),this.entitiesService=f(q)}getAll(t,e,i){return this.metadataService.getMetadata(t,e,i,c.contentTypes.permissions).pipe(k(o=>o.Items))}getAllLive(t,e,i,o){let s=this.metadataService.getMetadataLive(o,t,e,i,c.contentTypes.permissions).value;return A(()=>s()?.Items??[])}delete(t){return this.entitiesService.delete(c.contentTypes.permissions,t,!1)}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=h({token:r,factory:r.\u0275fac})}}return r})();var Wt=(()=>{class r{#r;#e;#t;#i;#o;constructor(t,e,i,o){this.dialog=t,this.snackBar=e,this.viewContainerRef=i,this.matDialog=o,this.gridOptions=this.buildGridOptions(),this.#r=f(Z),this.#e=f($),this.#t=O(this.#e.getParams(["targetType","keyType","key"]),s=>({targetType:parseInt(s.targetType,10),keyType:s.keyType,key:s.key})),this.#i=C(0),this.permissions=this.#r.getAllLive(this.#t.targetType,this.#t.keyType,this.#t.key,this.#i),this.#o={[c.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.#e.doOnDialogClosed(()=>this.#i.update(t=>t+1))}closeDialog(){this.dialog.close()}editPermission(t){let e;t==null?e={items:[n(n({},D.newMetadataFromInfo(c.contentTypes.permissions,D.constructMetadataInfo(this.#t.targetType,this.#t.keyType,this.#t.key))),this.#o[this.#t.targetType]&&{Prefill:this.#o[this.#t.targetType]})]}:e={items:[D.editId(t.Id)]};let i=V(e);this.#e.navRelative([`edit/${i}`])}#n(t){let e={entityId:t.Id,entityTitle:t.Title,message:"Delete this permission?",hasDeleteSnackbar:!0};this.matDialog.open(J,{autoFocus:!1,data:e,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(o=>{o&&this.#r.delete(t.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#i.update(s=>s+1)})})}buildGridOptions(){return m(n({},K),{columnDefs:[m(n({},p.Id),{cellRendererParams:p.idFieldParamsTooltipGetter()}),m(n({},p.TextWide),{headerName:"Name",field:"Title",sort:"asc",onCellClicked:e=>{let i=e.data;this.editPermission(i)}}),m(n({},p.TextWide),{field:"Identity"}),m(n({},p.TextWide),{field:"Condition"}),m(n({},p.Character),{field:"Grant"}),m(n({},p.ActionsPinnedRight1),{cellRenderer:X,cellRendererParams:{onDelete:i=>this.#n(i)}})]})}static{this.\u0275fac=function(e){return new(e||r)(g(U),g(G),g(R),g(H))}}static{this.\u0275cmp=v({type:r,selectors:[["app-permissions"]],decls:15,vars:2,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),d(3,"Permissions"),l(),a(4,"button",3),u("click",function(){return i.closeDialog()}),a(5,"mat-icon"),d(6,"close"),l()()(),a(7,"div",4),I(8,"router-outlet"),a(9,"div",5),I(10,"ag-grid-angular",6),l(),a(11,"mat-dialog-actions",7)(12,"button",8),u("click",function(){return i.editPermission(null)}),a(13,"mat-icon"),d(14,"add"),l()()()()()),e&2&&(b(10),w("rowData",i.permissions())("gridOptions",i.gridOptions))},dependencies:[E,F,j,T,y,_,W,Q,N],encapsulation:2})}}return r})();export{Y as a,Z as b,Wt as c};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/chunk-43T4DH5V.js.map
