{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/models/edit-form.model.ts"],
  "sourcesContent": ["import { Of } from '../../../../../core';\r\nimport { MetadataInfo } from '../../content-items/create-metadata-dialog/create-metadata-dialog.models';\r\nimport { EavFor } from '../../edit/shared/models/eav';\r\nimport { eavConstants, MetadataKeyDefinition, MetadataKeyTypes } from '../constants/eav.constants';\r\nimport { EditInfo } from './edit-info';\r\n\r\n// 2dm - new helper to reduce code when creating item identifiers\r\nexport class EditPrep {\r\n\r\n  static editId(id: number): ItemEditIdentifier {\r\n    return { EntityId: id } satisfies ItemEditIdentifier;\r\n  }\r\n\r\n  static newFromType(contentType: string, prefill?: Record<string, unknown>): ItemAddIdentifier {\r\n    return {\r\n      ContentTypeName: contentType,\r\n      ...(prefill && { Prefill: prefill })\r\n    } satisfies ItemAddIdentifier;\r\n  }\r\n\r\n  static newMetadataFromInfo(contentTypeName: string, itemFor: MetadataInfo): ItemAddIdentifier {\r\n    return {\r\n      ContentTypeName: contentTypeName,\r\n      For: {\r\n        Target: itemFor.target ?? itemFor.targetType.toString(),\r\n        TargetType: itemFor.targetType,\r\n        ...(itemFor.keyType === eavConstants.keyTypes.guid && { Guid: itemFor.key }),\r\n        ...(itemFor.keyType === eavConstants.keyTypes.number && { Number: parseInt(itemFor.key, 10) }),\r\n        ...(itemFor.keyType === eavConstants.keyTypes.string && { String: itemFor.key }),\r\n      },\r\n    }\r\n  }\r\n\r\n  static newMetadata<T>(key: T, typeName: string, keyDef: MetadataKeyDefinition, singleton?: boolean): ItemAddIdentifier {\r\n    return {\r\n      ContentTypeName: typeName,\r\n      For: EditPrep.createFor(keyDef, key, singleton),\r\n    } satisfies ItemAddIdentifier;\r\n  }\r\n\r\n  static createFor<T>(keyDef: MetadataKeyDefinition, key: T, singleton?: boolean): EavFor {\r\n    return {\r\n      Target: keyDef.target,\r\n      TargetType: keyDef.targetType,\r\n      ...(\r\n        typeof (key) == 'number'\r\n          ? { Number: key as number }\r\n          : keyDef.keyType == 'guid'\r\n            ? { Guid: key as string }\r\n            : { String: key as string }\r\n      ),\r\n      ...(singleton && { Singleton: true })\r\n    } satisfies EavFor;\r\n  }\r\n\r\n  static constructMetadataInfo(targetType: number, keyType: Of<typeof MetadataKeyTypes>, key: string): MetadataInfo {\r\n    const specs = Object.values(eavConstants.metadata).find(m => m.targetType === targetType);\r\n    return {\r\n      target: specs?.target ?? targetType.toString(),\r\n      targetType: targetType,\r\n      key: key,\r\n      keyType: keyType,\r\n    } satisfies MetadataInfo;\r\n  }\r\n\r\n  static relationship(parent: string, field: string, index: number = 0, add: boolean = null) :ItemInListIdentifier {\r\n    return {\r\n      Parent: parent,\r\n      Field: field,\r\n      Index: index,\r\n      Add: add,\r\n    } satisfies ItemInListIdentifier;\r\n  }\r\n\r\n  static copy(contentType: string, id: number): ItemAddIdentifier {\r\n    return {\r\n      ContentTypeName: contentType,\r\n      DuplicateEntity: id,\r\n    } satisfies ItemAddIdentifier;\r\n  }\r\n}\r\n\r\n/**\r\n * Type for edit form.\r\n * To add new item send newItem and to edit existing item send editItems\r\n */\r\nexport interface EditForm {\r\n  items: ItemIdentifier[];\r\n}\r\n\r\nexport type ItemIdentifier = ItemAddIdentifier | ItemEditIdentifier | ItemInListIdentifier;\r\n\r\nexport type ItemIdentifierHeader = ItemIdentifier & ItemIdentifierEditConfig;\r\n\r\n// TODO: leave these comments in till we've checked the backend to ensure we've removed\r\n// TODO: unused properties\r\n// export interface ItemIdentifierHeader extends ItemIdentifierShared, ItemIdentifierEditConfig {\r\n//   // 2023-05-15 seems unused - TODO: probably remove from backend as well\r\n//   // Add?: boolean;\r\n//   ContentTypeName: string;\r\n//   DuplicateEntity?: number;\r\n//   EntityId: number;\r\n//   // 2023-05-15 seems unused - TODO: probably remove from backend as well\r\n//   // For?: EavFor;\r\n//   // 2023-05-15 seems unused - TODO: probably remove from backend as well\r\n//   // Guid: string;\r\n//   // 2023-05-15 seems unused - TODO: probably remove from backend as well\r\n//   // Index?: number;\r\n\r\n//   // 2023-05-15 seems unused\r\n//   // Metadata?: EavEntity[];\r\n//   // 2023-05-15 now in base interface\r\n//   // Prefill?: Record<string, any>;\r\n\r\n//   // 2023-05-15 seems unused - TODO: probably remove from backend as well\r\n//   // Title?: string;\r\n// }\r\n\r\nexport interface ItemIdentifierInbound {\r\n  /** inbound fields, coming from the toolbar */\r\n  UiFields?: string;\r\n  Parameters?: Record<string, unknown>;\r\n}\r\n\r\nexport interface ItemIdentifierShared {\r\n\r\n  /** Prefill form with data */\r\n  Prefill?: Record<string, unknown>;\r\n\r\n  /**\r\n   * New way to transport a random amount of properties back and forth\r\n   * - IMPORTANT: this is only after conversion to funky url\r\n   * - before you must use Parameters on the main object?\r\n   */\r\n  ClientData?: {\r\n    fields?: string;\r\n    parameters?: Record<string, unknown>;\r\n    overrideContents?: Record<string, unknown>;\r\n    [key: string]: unknown;\r\n  };\r\n\r\n  /**\r\n   * An ID for this specific configuration. \r\n   * Purpose is to keep the configurations but be able to match them back to the data returned by the server.\r\n   * So the server will return the clientId and the UI can match it back to the original request.\r\n   * Added v17.10+\r\n   */\r\n  clientId?: number;\r\n}\r\n\r\nexport interface ItemEditIdentifier extends ItemIdentifierShared {\r\n  EntityId: number;\r\n}\r\n\r\nexport interface ItemAddIdentifier extends ItemIdentifierShared {\r\n  /** Content type */\r\n  ContentTypeName: string;\r\n  /** Add item as metadata to another item */\r\n  For?: EavFor;\r\n  /** @deprecated 2sxc 9 Metadata object */\r\n  Metadata?: LegacyMetadata;\r\n\r\n  /** Prefill form with data from another entity */\r\n  DuplicateEntity?: number;\r\n}\r\n\r\n/**\r\n * This is both an item in a content-group, as well as an item in a list\r\n */\r\nexport interface ItemInListIdentifier extends ItemIdentifierShared {\r\n  Add: boolean;\r\n  Index: number;\r\n  Parent: string;\r\n  Field: string;\r\n\r\n  EntityId?: number;\r\n\r\n  /** Prefill form with data from another entity - WIP 20.09 */\r\n  DuplicateEntity?: number;\r\n}\r\n\r\nexport interface ViewOrFileIdentifier {\r\n  Edition?: string;\r\n  EntityId?: number;\r\n  IsShared: boolean;\r\n  Path: string;\r\n}\r\n\r\n/** @deprecated 2sxc 9 Metadata object */\r\nexport interface LegacyMetadata {\r\n  key: string;\r\n  keyType: string;\r\n  targetType: number;\r\n}\r\n\r\n\r\nexport interface ItemIdentifierEditConfig {\r\n  /** Information if this item is read-only */\r\n  EditInfo?: EditInfo;\r\n  /** Determines if this item is currently non-existing / empty - so if this doesn't change it should also save empty */\r\n  IsEmpty: boolean;\r\n  /** Determines if this item can be empty, so it is allowed to be removed */\r\n  IsEmptyAllowed: boolean;\r\n}\r\n"],
  "mappings": "gFAOM,IAAOA,EAAP,MAAOA,CAAQ,CAEnB,OAAOC,OAAOC,EAAU,CACtB,MAAO,CAAEC,SAAUD,CAAE,CACvB,CAEA,OAAOE,YAAYC,EAAqBC,EAAiC,CACvE,OAAOC,EAAA,CACLC,gBAAiBH,GACbC,GAAW,CAAEG,QAASH,CAAO,EAErC,CAEA,OAAOI,oBAAoBC,EAAyBC,EAAqB,CACvE,MAAO,CACLJ,gBAAiBG,EACjBE,IAAKN,MAAA,CACHO,OAAQF,EAAQG,QAAUH,EAAQI,WAAWC,SAAQ,EACrDC,WAAYN,EAAQI,YAChBJ,EAAQO,UAAYC,EAAaC,SAASC,MAAQ,CAAEC,KAAMX,EAAQY,GAAG,GACrEZ,EAAQO,UAAYC,EAAaC,SAASI,QAAU,CAAEC,OAAQC,SAASf,EAAQY,IAAK,EAAE,CAAC,GACvFZ,EAAQO,UAAYC,EAAaC,SAASO,QAAU,CAAEC,OAAQjB,EAAQY,GAAG,GAGnF,CAEA,OAAOM,YAAeN,EAAQO,EAAkBC,EAA+BC,EAAmB,CAChG,MAAO,CACLzB,gBAAiBuB,EACjBlB,IAAKb,EAASkC,UAAUF,EAAQR,EAAKS,CAAS,EAElD,CAEA,OAAOC,UAAaF,EAA+BR,EAAQS,EAAmB,CAC5E,OAAO1B,IAAA,CACLO,OAAQkB,EAAOjB,OACfG,WAAYc,EAAOhB,YAEjB,OAAQQ,GAAQ,SACZ,CAAEE,OAAQF,CAAa,EACvBQ,EAAOb,SAAW,OAChB,CAAEI,KAAMC,CAAa,EACrB,CAAEK,OAAQL,CAAa,GAE3BS,GAAa,CAAEE,UAAW,EAAI,EAEtC,CAEA,OAAOC,sBAAsBpB,EAAoBG,EAAsCK,EAAW,CAEhG,MAAO,CACLT,OAFYsB,OAAOC,OAAOlB,EAAamB,QAAQ,EAAEC,KAAKC,GAAKA,EAAEzB,aAAeA,CAAU,GAEvED,QAAUC,EAAWC,SAAQ,EAC5CD,WAAYA,EACZQ,IAAKA,EACLL,QAASA,EAEb,CAEA,OAAOuB,aAAaC,EAAgBC,EAAeC,EAAgB,EAAGC,EAAe,KAAI,CACvF,MAAO,CACLC,OAAQJ,EACRK,MAAOJ,EACPK,MAAOJ,EACPK,IAAKJ,EAET,CAEA,OAAOK,KAAK9C,EAAqBH,EAAU,CACzC,MAAO,CACLM,gBAAiBH,EACjB+C,gBAAiBlD,EAErB",
  "names": ["EditPrep", "editId", "id", "EntityId", "newFromType", "contentType", "prefill", "__spreadValues", "ContentTypeName", "Prefill", "newMetadataFromInfo", "contentTypeName", "itemFor", "For", "Target", "target", "targetType", "toString", "TargetType", "keyType", "eavConstants", "keyTypes", "guid", "Guid", "key", "number", "Number", "parseInt", "string", "String", "newMetadata", "typeName", "keyDef", "singleton", "createFor", "Singleton", "constructMetadataInfo", "Object", "values", "metadata", "find", "m", "relationship", "parent", "field", "index", "add", "Parent", "Field", "Index", "Add", "copy", "DuplicateEntity"]
}
