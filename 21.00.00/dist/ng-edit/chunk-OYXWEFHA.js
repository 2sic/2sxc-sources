import{a as b}from"./chunk-V5UC4TMG.js";import{a as g}from"./chunk-MWYLUFVP.js";import{a as d}from"./chunk-37NMTDTM.js";import{a as u,b as o}from"./chunk-RGKBOUPL.js";import{a as m}from"./chunk-OIHIMR2W.js";import{aa as F}from"./chunk-DX662RXJ.js";import{Aa as f,ea as c,ia as h}from"./chunk-46QINP2S.js";import{a,b as n}from"./chunk-BDOJB7O2.js";var q={all:!1,constructor:!0,load:!1,getAll:!1,requireFeature:!0,unlicensedFeatures:!0},O=(()=>{class r{#i;constructor(t){this.log=F({FeaturesService:r},q),this.#i=m(b),this.#e=f(null),this.#s=u("reqFeaturesForm",{}),this.#t=u("reqFeaturesFields",{}),this.#r=o("requiredFeatures",()=>{let e=this.#s(),s=this.#t();return a(a({},e),s)}),this.unlicensedFeatures=o("unlicensedFeatures",()=>{let e=this.#r(),s=this.getAll()().filter(i=>i.allowUse),l=Object.keys(e).filter(i=>!s.some(p=>p.nameId===i));return this.log.aIf("unlicensedFeatures",{req:e,allowed:s,missing:l}),l}),this.hasUnlicensedFeatures=o("hasUnlicensedFeatures",()=>this.unlicensedFeatures().length>0),this.isEnabled=new d("isEnabledCache").buildProxy(e=>()=>this.#e()?.Features.find(s=>s.nameId===e)?.isEnabled??!1),this.allowUse=new d("isEnabledCache").buildProxy(e=>()=>this.#e()?.Features.find(s=>s.nameId===e)?.allowUse??!1),this.log.fnIf("constructor"),t.disableAutoLoad?this.log.a("auto-load disabled"):this.#i.getCurrent$().subscribe(e=>this.load(e.Context))}load(t,e){this.log.fnIf("load",{formData:e,dialogContext:t}),this.#e.set(t),this.#s.set(e?.RequiredFeatures??{})}#e;#s;#t;#r;requireFeature(t,e){let s=this.log.fnIf("requireFeature",{feature:t,reason:e}),l=this.#t();Object.keys(l).includes(t)?l[t].includes(e)||this.#t.update(i=>n(a({},i),{[t]:[...i[t],e]})):this.#t.update(i=>n(a({},i),{[t]:[e]})),s.end("final",this.#t())}getAll(){return this.log.fnIf("getAll"),o("all-features",()=>this.#e()?.Features??[])}getCurrent(t){return this.#e()?.Features.find(e=>e.nameId===t)}static{this.\u0275fac=function(e){return new(e||r)(h(g))}}static{this.\u0275prov=c({token:r,factory:r.\u0275fac})}}return r})();export{O as a};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/chunk-OYXWEFHA.js.map
