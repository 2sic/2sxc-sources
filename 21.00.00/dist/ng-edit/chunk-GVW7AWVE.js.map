{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/components/dialog-entry/dialog-entry.ts"],
  "sourcesContent": ["import { ChangeDetectorRef, Component, Injector, OnDestroy, OnInit, Type, ViewContainerRef } from '@angular/core';\r\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { NavigateFormResult } from '../../../edit/routing/edit-routing.service';\r\nimport { classLog } from '../../logging';\r\nimport { DialogConfig } from '../../models/dialog-config.model';\r\nimport { EavWindow } from '../../models/eav-window.model';\r\nimport { Context } from '../../services/context';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n@Component({\r\n  selector: 'app-dialog-entry',\r\n  templateUrl: './dialog-entry.html',\r\n  imports: [],\r\n  providers: [\r\n    Context, // this is used in the dialog to get the correct App\r\n  ]\r\n})\r\nexport class DialogEntryComponent implements OnInit, OnDestroy {\r\n\r\n  log = classLog({ DialogEntryComponent });\r\n\r\n  #dialogData: Record<string, any>;\r\n  #dialog: MatDialogRef<any>;\r\n\r\n  constructor(\r\n    private matDialog: MatDialog,\r\n    private viewContainerRef: ViewContainerRef,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private context: Context,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n    private injector: Injector,\r\n  ) {\r\n    const navigation = this.router.currentNavigation();\r\n    this.#dialogData = navigation?.extras?.state || {};\r\n  }\r\n\r\n  ngOnInit() {\r\n    const l = this.log.fn('ngOnInit');\r\n    const dialogConfig: DialogConfig = this.route.snapshot.data.dialog;\r\n    if (dialogConfig == null)\r\n      throw new Error(`Could not find config for dialog. Did you forget to add DialogConfig to route data?`);\r\n\r\n    l.a('Open dialog: ' + dialogConfig.name, { id: this.context.id, context: this.context });\r\n\r\n    dialogConfig.getComponent(this.injector).then(component => {\r\n      // spm Workaround for \"feature\" where you can't open new dialog while last one is still opening\r\n      // https://github.com/angular/components/commit/728cf1c8ebd49e089f4bae945511bb0918972c26\r\n      const dialog = (this.matDialog as any);\r\n      if (dialog._dialogAnimatingOpen && dialog._lastDialogRef)\r\n        (dialog._lastDialogRef as MatDialogRef<any>).afterOpened()\r\n          .subscribe(() => this.openDialogComponent(dialogConfig, component));\r\n      else\r\n        this.openDialogComponent(dialogConfig, component);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.#dialog.close();\r\n  }\r\n\r\n  private openDialogComponent(dialogConfig: DialogConfig, component: Type<any>) {\r\n    this.log.a(`Open dialog(initContext: ${dialogConfig.initContext})`, { name: dialogConfig.name, 'Contextid:': this.context.log.svcId, 'Context:': this.context });\r\n    if (dialogConfig.initContext)\r\n      this.context.init(this.route);\r\n\r\n    this.#dialog = this.matDialog.open(component, {\r\n      autoFocus: false,\r\n      backdropClass: 'dialog-backdrop',\r\n      closeOnNavigation: false,\r\n      data: this.#dialogData,\r\n      panelClass: [\r\n        'dialog-panel',\r\n        `dialog-panel-${dialogConfig.panelSize}`,\r\n        dialogConfig.showScrollbar ? 'show-scrollbar' : 'no-scrollbar',\r\n        ...(dialogConfig.panelClass ? dialogConfig.panelClass : []),\r\n      ],\r\n      // spm NOTE: position used to force align-items: flex-start; on cdk-global-overlay-wrapper.\r\n      // Real top margin is overwritten in css e.g. dialog-panel-large\r\n      position: { top: '0' },\r\n      viewContainerRef: this.viewContainerRef,\r\n    });\r\n\r\n    this.#dialog.afterClosed().subscribe((data: any) => {\r\n      this.log.a('Dialog was closed - name:' + dialogConfig.name, { data });\r\n\r\n      const navRes = data as NavigateFormResult;\r\n      if (navRes?.navigateUrl != null) {\r\n        this.router.navigate([navRes.navigateUrl]);\r\n        return;\r\n      }\r\n\r\n      if (this.route.pathFromRoot.length <= 3) {\r\n        try {\r\n          window.parent.$2sxc.totalPopup.close();\r\n        } catch (error) { }\r\n        return;\r\n      }\r\n\r\n      if (this.route.snapshot.url.length > 0)\r\n        this.router.navigate(['./'], { relativeTo: this.route.parent, state: data });\r\n      else\r\n        this.router.navigate(['./'], { relativeTo: this.route.parent.parent, state: data });\r\n    });\r\n\r\n    this.changeDetectorRef.markForCheck();\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["DialogEntryComponent", "#dialogData", "#dialog", "constructor", "matDialog", "viewContainerRef", "router", "route", "context", "changeDetectorRef", "injector", "log", "classLog", "navigation", "currentNavigation", "extras", "state", "ngOnInit", "l", "fn", "dialogConfig", "snapshot", "data", "dialog", "Error", "a", "name", "id", "getComponent", "then", "component", "_dialogAnimatingOpen", "_lastDialogRef", "afterOpened", "subscribe", "openDialogComponent", "ngOnDestroy", "close", "initContext", "svcId", "init", "open", "autoFocus", "backdropClass", "closeOnNavigation", "panelClass", "panelSize", "showScrollbar", "position", "top", "afterClosed", "navRes", "navigateUrl", "navigate", "pathFromRoot", "length", "window", "parent", "$2sxc", "totalPopup", "url", "relativeTo", "markForCheck", "\u0275\u0275directiveInject", "MatDialog", "ViewContainerRef", "Router", "ActivatedRoute", "Context", "ChangeDetectorRef", "Injector", "selectors", "features", "\u0275\u0275ProvidersFeature", "decls", "vars", "template", "rf", "ctx", "encapsulation"]
}
