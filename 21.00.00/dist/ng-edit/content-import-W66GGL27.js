import{a as M}from"./chunk-O3YSC345.js";import{a as st}from"./chunk-AAMPB3UT.js";import{b as lt}from"./chunk-DDUEZMYJ.js";import"./chunk-NIPOW2E2.js";import{a as ot,b as at,c as rt}from"./chunk-56YE37V6.js";import{a as K}from"./chunk-V5UC4TMG.js";import"./chunk-U657U553.js";import"./chunk-QFYVXC4V.js";import"./chunk-JNRBLGLU.js";import{a as R}from"./chunk-JEQANFI7.js";import"./chunk-LPOE4446.js";import"./chunk-WAPW5AUJ.js";import{d as G}from"./chunk-ENHI5GWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import"./chunk-HCPBPEHV.js";import{f as H,h as X,l as q}from"./chunk-QVLOO535.js";import{f as Q,g as Y,i as tt,k as et,l as it,v as nt}from"./chunk-UMOPET3G.js";import{b as W,c as z}from"./chunk-23CS2WID.js";import{a as S}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{c as U}from"./chunk-OYQCZWOE.js";import{b as Z,c as $,g as J}from"./chunk-G33ZJSCE.js";import"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$b as j,A as k,Aa as v,Ab as F,Bb as P,Cb as x,Db as i,Ea as L,Eb as n,Nb as h,Ob as O,Pb as f,Rb as c,Sa as l,Y as y,Za as g,db as A,ea as N,ec as o,fc as b,gc as u,hc as E,lc as w,mc as D,nc as T,o as I,oa as _,pa as C,u as V,wb as p,yb as d,zb as B}from"./chunk-46QINP2S.js";import"./chunk-BDOJB7O2.js";var ct=(()=>{class e extends G{evaluateContent(t){return I(M(t.file)).pipe(y(r=>{let a={AppId:this.appId,DefaultLanguage:t.defaultLanguage,ContentType:t.contentType,ContentBase64:r,ResourcesReferences:t.resourcesReferences,ClearEntities:t.clearEntities};return this.http.post(this.apiUrl(R+"XmlPreview"),a).pipe(V(s=>(s.Success||(s.Errors=s.Detail,delete s.Detail),s)))}))}importContent(t){return I(M(t.file)).pipe(y(r=>{let a={AppId:this.appId,DefaultLanguage:t.defaultLanguage,ContentType:t.contentType,ContentBase64:r,ResourcesReferences:t.resourcesReferences,ClearEntities:t.clearEntities};return this.http.post(this.apiUrl(R+"XmlUpload"),a)}))}static{this.\u0275fac=(()=>{let t;return function(a){return(t||(t=L(e)))(a||e)}})()}static{this.\u0275prov=N({token:e,factory:e.\u0275fac})}}return e})();function dt(e,m){if(e&1){let t=h();i(0,"form",null,0)(2,"div",8)(3,"div")(4,"button",9),f("click",function(){_(t);let a=j(8);return C(a.click())}),i(5,"span"),o(6),n()(),i(7,"input",10,1),f("change",function(a){_(t);let s=c(2);return C(s.fileChange(a))}),n()(),i(9,"div")(10,"p",11),o(11,"References to pages / files"),n(),i(12,"mat-radio-group",12),T("ngModelChange",function(a){_(t);let s=c(2);return D(s.formValues.resourcesReferences,a)||(s.formValues.resourcesReferences=a),C(a)}),i(13,"mat-radio-button",13),o(14," Import links as written in the file (for example /Portals/...) "),n(),i(15,"mat-radio-button",14),o(16," Try to resolve paths to references "),n()()(),i(17,"div")(18,"p",11),o(19,"Clear all other entities"),n(),i(20,"mat-radio-group",15),T("ngModelChange",function(a){_(t);let s=c(2);return D(s.formValues.clearEntities,a)||(s.formValues.clearEntities=a),C(a)}),i(21,"mat-radio-button",16),o(22," Keep all entities not found in import "),n(),i(23,"mat-radio-button",17),o(24," Remove all entities not found in import "),n()()(),i(25,"p",18),o(26,"Remember to backup your DNN first!"),n()(),i(27,"mat-dialog-actions",19)(28,"button",20),f("click",function(){_(t);let a=c(2);return C(a.evaluateContent())}),o(29," Preview Import "),n()()()}if(e&2){let t=c(2);l(6),b(t.formValues.file?t.formValues.file.name:"Select or drop file"),l(6),w("ngModel",t.formValues.resourcesReferences),l(8),w("ngModel",t.formValues.clearEntities),l(8),x("disabled",!t.formValues.file||!t.formValues.file.name)}}function ut(e,m){e&1&&(i(0,"div",8)(1,"p"),o(2,"Please wait while processing..."),n()())}function _t(e,m){if(e&1&&(i(0,"div",8)(1,"p",22),o(2),n(),i(3,"p",22),o(4,"File contains:"),n(),i(5,"ul",23)(6,"li"),o(7),n(),i(8,"li"),o(9),n(),i(10,"li"),o(11),n()(),i(12,"p",22),o(13,"If you press Import, it will:"),n(),i(14,"ul",23)(15,"li"),o(16),n(),i(17,"li"),o(18),n(),i(19,"li"),o(20),n(),i(21,"li"),o(22),n()(),i(23,"p",18),o(24,"Note: The import validates much data and may take several minutes."),n()()),e&2){let t=c(4);l(2),u("Try to import file '",t.formValues.file.name,"'"),l(5),u("",t.evaluationResult().Detail.DocumentElementsCount," content-items (records/entities)"),l(2),u("",t.evaluationResult().Detail.LanguagesInDocumentCount," languages"),l(2),E("",t.evaluationResult().Detail.AttributeNamesInDocument.length," columns: ",t.evaluationResult().Detail.AttributeNamesInDocument.join(", ")),l(5),u("Create ",t.evaluationResult().Detail.AmountOfEntitiesCreated," content-items"),l(2),u("Update ",t.evaluationResult().Detail.AmountOfEntitiesUpdated," content-items"),l(2),u("Delete ",t.evaluationResult().Detail.AmountOfEntitiesDeleted," content-items"),l(2),E("Ignore ",t.evaluationResult().Detail.AttributeNamesNotImported.length," columns: ",t.evaluationResult().Detail.AttributeNamesNotImported.join(", "))}}function Ct(e,m){if(e&1&&(i(0,"div")(1,"i"),o(2),n()()),e&2){let t=c().$implicit;l(2),u("Details: ",t.ErrorDetail)}}function ft(e,m){if(e&1&&(i(0,"div")(1,"i"),o(2),n()()),e&2){let t=c().$implicit;l(2),u("Line-no: ",t.LineNumber)}}function vt(e,m){if(e&1&&(i(0,"div")(1,"i"),o(2),n()()),e&2){let t=c().$implicit;l(2),u("Line-details: ",t.LineDetail)}}function gt(e,m){if(e&1&&(i(0,"li")(1,"div"),o(2),n(),p(3,Ct,3,1,"div"),p(4,ft,3,1,"div"),p(5,vt,3,1,"div"),n()),e&2){let t=m.$implicit,r=c(5);l(2),b(r.errors[t.ErrorCode]),l(),d(t.ErrorDetail?3:-1),l(),d(t.LineNumber?4:-1),l(),d(t.LineDetail?5:-1)}}function xt(e,m){if(e&1&&(i(0,"div",8)(1,"p",22),o(2),n(),i(3,"ul",23),F(4,gt,6,4,"li",null,B),n()()),e&2){let t=c(4);l(2),u("Try to import file '",t.formValues.file.name,"'"),l(2),P(t.evaluationResult().Errors)}}function ht(e,m){if(e&1){let t=h();p(0,_t,25,10,"div",8),p(1,xt,6,1,"div",8),i(2,"mat-dialog-actions",19)(3,"button",21),f("click",function(){_(t);let a=c(3);return C(a.back())}),o(4,"Back"),n(),i(5,"button",20),f("click",function(){_(t);let a=c(3);return C(a.importContent())}),o(6," Import "),n()()}if(e&2){let t=c(3);d(t.evaluationResult().Success?0:-1),l(),d(t.evaluationResult().Success?-1:1),l(4),x("disabled",!t.evaluationResult().Success)}}function St(e,m){if(e&1&&p(0,ht,7,3),e&2){let t=c(2);d(t.evaluationResult()?0:-1)}}function It(e,m){e&1&&(i(0,"p"),o(1,"Import done."),n())}function yt(e,m){e&1&&(i(0,"p"),o(1,"Import failed."),n())}function bt(e,m){if(e&1&&(i(0,"div",8),p(1,It,2,0,"p"),p(2,yt,2,0,"p"),n()),e&2){let t=c(3);l(),d(t.importResult().Success?1:-1),l(),d(t.importResult().Success?-1:2)}}function Et(e,m){if(e&1){let t=h();p(0,bt,3,2,"div",8),i(1,"mat-dialog-actions",19)(2,"button",24),f("click",function(){_(t);let a=c(2);return C(a.closeDialog())}),o(3," Close "),n()()}if(e&2){let t=c(2);d(t.importResult()?0:-1)}}function wt(e,m){if(e&1&&p(0,dt,30,4,"form")(1,ut,3,0,"div",8)(2,St,1,1)(3,Et,4,1),e&2){let t,r=c();d((t=r.viewStateSelected())===1?0:t===0?1:t===2?2:t===3?3:-1)}}var te=(()=>{class e{constructor(t,r,a){this.dialogData=t,this.dialog=r,this.route=a,this.hostClass="dialog-component",this.contentImportService=S(ct),this.contentTypesService=S(lt),this.dialogConfigSvc=S(K),this.viewStates={waiting:0,default:1,evaluated:2,imported:3},this.contentType=v(null),this.viewStateSelected=v(this.viewStates.default),this.evaluationResult=v(null),this.importResult=v(null),this.errors={0:"Unknown error occured.",1:"Selected content-type does not exist.",2:"Document is not a valid XML file.",3:"Selected content-type does not match the content-type in the XML file.",4:"The language is not supported.",5:"The document does not specify all languages for all entities.",6:"Language reference cannot be parsed, the language is not supported.",7:"Language reference cannot be parsed, the read-write protection is not supported.",8:"Value cannot be read, because of it has an invalid format."},this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName")}ngOnInit(){let t=this.contentTypesService.retrieveContentType(this.contentTypeStaticName),r=this.dialogConfigSvc.getCurrent$();k([t,r]).subscribe(([a,s])=>{this.contentType.set(a),this.formValues={defaultLanguage:s.Context.Language.Primary,contentType:this.contentTypeStaticName,file:this.dialogData.files!=null?this.dialogData.files[0]:null,resourcesReferences:"Keep",clearEntities:"None"}})}closeDialog(){this.dialog.close()}evaluateContent(){this.viewStateSelected.set(this.viewStates.waiting),this.contentImportService.evaluateContent(this.formValues).subscribe(t=>{this.evaluationResult.set(t),this.viewStateSelected.set(this.viewStates.evaluated)})}importContent(){this.viewStateSelected.set(this.viewStates.waiting),this.contentImportService.importContent(this.formValues).subscribe(t=>{this.importResult.set(t),this.viewStateSelected.set(this.viewStates.imported)})}back(){this.viewStateSelected.set(this.viewStates.default),this.evaluationResult.set(null)}fileChange(t){this.formValues.file=t.target.files[0]}filesDropped(t){let r=t[0];this.formValues.file=r}static{this.\u0275fac=function(r){return new(r||e)(g($),g(Z),g(U))}}static{this.\u0275cmp=A({type:e,selectors:[["app-content-import"]],hostVars:1,hostBindings:function(r,a){r&2&&O("className",a.hostClass)},decls:14,vars:3,consts:[["ngForm","ngForm"],["fileInput",""],["appDragAndDrop","",1,"eav-dialog",3,"filesDropped","allowedFileTypes"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-description"],["href","https://2sxc.org/help","target","_blank"],[1,"eav-dialog-content"],["mat-raised-button","","tippy","Open file browser",3,"click"],["type","file",1,"hide",3,"change"],[1,"eav-radio-group-label"],["name","ResourcesReferences",1,"eav-radio-group",3,"ngModelChange","ngModel"],["value","Keep"],["value","Resolve"],["name","ClearEntities",1,"eav-radio-group",3,"ngModelChange","ngModel"],["value","None"],["value","All"],[1,"eav-hint"],["align","end"],["mat-raised-button","",1,"eav-action-button",3,"click","disabled"],["mat-raised-button","",3,"click"],[1,"eav-evaluation__title"],[1,"eav-evaluation__content"],["mat-raised-button","",1,"eav-action-button",3,"click"]],template:function(r,a){if(r&1&&(i(0,"div",2),f("filesDropped",function(mt){return a.filesDropped(mt)}),i(1,"div",3)(2,"div",4),o(3),n(),i(4,"button",5),f("click",function(){return a.closeDialog()}),i(5,"mat-icon"),o(6,"close"),n()()(),i(7,"div",6)(8,"p"),o(9," This will import content-items into 2sxc. It requires that you already defined the content-type before you try importing, and that you created the import-file using the template provided by the Export. Please visit "),i(10,"a",7),o(11,"https://2sxc.org/help"),n(),o(12," for more instructions. "),n()(),p(13,wt,4,1),n()),r&2){let s;x("allowedFileTypes","xml"),l(3),u(" ",(s=a.contentType())==null?null:s.Name," Import Data "),l(10),d(a.formValues!=null?13:-1)}},dependencies:[nt,it,Q,Y,et,tt,q,X,H,rt,ot,at,z,W,J,st],styles:[`.eav-radio-group-label[_ngcontent-%COMP%]{font-size:18px;margin:24px 0 0}.eav-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:8px 0}.eav-hint[_ngcontent-%COMP%]{font-size:18px;margin-top:24px;margin-bottom:16px}.eav-evaluation__title[_ngcontent-%COMP%]{font-size:18px;margin:24px 0 0;font-weight:700}.eav-evaluation__content[_ngcontent-%COMP%]{font-size:14px}.eav-evaluation__content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:2px 0}
/*# sourceMappingURL=content-import-ZRLIHQZO.css.map */`]})}}return e})();export{te as ContentImportComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/content-import-W66GGL27.js.map
