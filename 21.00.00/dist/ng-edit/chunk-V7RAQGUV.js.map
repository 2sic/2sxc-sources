{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/app-administration/services/app-extensions.service.ts"],
  "sourcesContent": ["import { Injectable, Signal } from '@angular/core';\r\nimport { map } from 'rxjs';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog/file-upload-dialog.models';\r\nimport { classLog } from '../../shared/logging';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { Extension, ExtensionInspectResult, ExtensionPreflightItem } from '../models/extension.model';\r\n\r\n@Injectable()\r\nexport class AppExtensionsService extends HttpServiceBase {\r\n  log = classLog({ AppExtensionsService });\r\n\r\n  /** Get all extensions with live refresh capability */\r\n  getAllLive(refresh: Signal<unknown>) {\r\n    return this.newHttpResource<{ extensions: Extension[] }>(() => {\r\n      // Watch the refresh signal to trigger reloads\r\n      refresh();\r\n\r\n      return {\r\n        url: this.apiUrl('admin/appExtensions/extensions'),\r\n        params: { appId: this.appId },\r\n        method: 'GET',\r\n      };\r\n    });\r\n  }\r\n\r\n  getAll() {\r\n    return this.http.get<{ extensions: Extension[] }>(this.apiUrl('admin/appExtensions/extensions'), {\r\n      params: { appId: this.appId },\r\n    });\r\n  }\r\n\r\n  /** Update config (mutations still best done via HttpClient per Angular docs) */\r\n  updateConfiguration(name: string, config: string) {\r\n    // Parse the config to JsonElement format that the API expects\r\n    const configJson = JSON.parse(config);\r\n\r\n    return this.http.post<boolean>(this.apiUrl('admin/appExtensions/configuration'), configJson, {\r\n      params: {\r\n        zoneId: this.zoneId,\r\n        appId: this.appId,\r\n        name\r\n      },\r\n    });\r\n  }\r\n\r\n  /** Open download link for an extension */\r\n  downloadExtension(folder: string) {\r\n    const params = new URLSearchParams({\r\n      appId: this.appId,\r\n      zoneId: this.zoneId,\r\n      name: folder,\r\n    });\r\n    const url = `${this.apiUrl('admin/appExtensions/download')}?${params.toString()}`;\r\n    window.open(url, '_blank', '');\r\n  }\r\n\r\n  /** Install a remote extension by URL - v2: POST to .InstallFrom with url(s) in body */\r\n  installRemoteExtension(url: string, editions?: string, overwrite?: boolean) {\r\n    // Always use array of string (even if only one for now)\r\n    const body = [url];\r\n\r\n    const params: any = {\r\n      appId: this.appId,\r\n      zoneId: this.zoneId,\r\n      ...(editions ? { editions } : {}),\r\n      ...(overwrite ? { overwrite } : {})\r\n    };\r\n\r\n    return this.http.post<boolean>(\r\n      this.apiUrl('admin/appExtensions/InstallFrom'),\r\n      body,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  /** Preflight a remote extension by URL - v2: POST to .InstallPreflightFrom with url(s) in body */\r\n  installPreflightExtensionFromUrl(url: string, editions?: string) {\r\n    const body = [url];\r\n\r\n    const params: any = {\r\n      appId: this.appId,\r\n      ...(editions ? { editions } : {})\r\n    };\r\n\r\n    return this.http.post<{ extensions: ExtensionPreflightItem[] }>(\r\n      this.apiUrl('admin/appExtensions/InstallPreflightFrom'),\r\n      body,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  /** Uploads extension files (no change, still uses FormData) */\r\n  uploadExtensions(file: File, editions?: string, overwrite?: boolean) {\r\n    const formData = new FormData();\r\n    formData.append('files', file);\r\n\r\n    const params = {\r\n      appId: this.appId,\r\n      zoneId: this.zoneId,\r\n      ...(editions ? { editions } : {}),\r\n      ...(overwrite ? { overwrite } : {})\r\n    };\r\n\r\n    return this.http.post<boolean>(this.apiUrl('admin/appExtensions/install'), formData, {\r\n      params,\r\n    }).pipe(\r\n      map((success: boolean): FileUploadResult => ({\r\n        Success: success,\r\n        Messages: success\r\n          ? [{ MessageType: 1, Text: 'Extension uploaded successfully' }]\r\n          : [{ MessageType: 2, Text: 'Extension upload failed' }]\r\n      }))\r\n    );\r\n  }\r\n\r\n  /** Preflight file upload (no change, still uses FormData) */\r\n  installPreflightExtension(files: File[]) {\r\n    const formData = new FormData();\r\n    files.forEach(file => formData.append('files', file));\r\n\r\n    return this.http.post<{ extensions: ExtensionPreflightItem[] }>(\r\n      this.apiUrl('admin/appExtensions/installPreflight'),\r\n      formData,\r\n      {\r\n        params: {\r\n          appId: this.appId,\r\n          zoneId: this.zoneId\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  preflightExtension(name: string, edition?: string) {\r\n    const params: { appId: string, name: string, edition?: string } = {\r\n      appId: this.appId,\r\n      name,\r\n    };\r\n    if (edition) params.edition = edition;\r\n\r\n    return this.newHttpResource<ExtensionInspectResult>(() => ({\r\n      url: this.apiUrl('admin/appExtensions/inspect'),\r\n      params,\r\n      method: 'GET',\r\n    }));\r\n  }\r\n\r\n  deleteExtension(name: string, edition?: string, force = false, withData = false) {\r\n    const params = {\r\n      appId: this.appId,\r\n      name,\r\n      force,\r\n      withData,\r\n      ...(edition ? { edition: edition } : {})\r\n    };\r\n\r\n    return this.http.delete<boolean>(\r\n      this.apiUrl('admin/appExtensions/delete'),\r\n      { params }\r\n    );\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["AppExtensionsService", "HttpServiceBase", "constructor", "log", "classLog", "getAllLive", "refresh", "newHttpResource", "url", "apiUrl", "params", "appId", "method", "getAll", "http", "get", "updateConfiguration", "name", "config", "configJson", "JSON", "parse", "post", "zoneId", "downloadExtension", "folder", "URLSearchParams", "toString", "window", "open", "installRemoteExtension", "editions", "overwrite", "body", "__spreadValues", "installPreflightExtensionFromUrl", "uploadExtensions", "file", "formData", "FormData", "append", "pipe", "map", "success", "Success", "Messages", "MessageType", "Text", "installPreflightExtension", "files", "forEach", "preflightExtension", "edition", "deleteExtension", "force", "withData", "delete", "__ngFactoryType__", "factory", "\u0275fac"]
}
