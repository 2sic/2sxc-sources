import{a as A}from"./chunk-564RKXG7.js";import{c as m}from"./chunk-HJXR3IL7.js";import{aa as $}from"./chunk-DX662RXJ.js";import{a as c,b as g}from"./chunk-BDOJB7O2.js";var f=class{static encode(n){return(n??"").replace(/\//g,"%2F").replace(/\:/g,"%3A").replace(/\&/g,"%26").replace(/\~/g,"%7E").replace(/\,/g,"%2C")}static decode(n){return(n??"").replace(/%2F/g,"/").replace(/%3A/g,":").replace(/%26/g,"&").replace(/%7E/g,"~").replace(/%2C/g,",")}};var y=$("UrlPrepHelper"),b="prefill:",E="group:",D="uifields:",U="parameters:",M=",",u="&",d=":",I="~";function h(t){return t.join(d)}function X(t){let n=y.fn("convertFormToUrl",{form:t}),e="";for(let r of t.items){e&&(e+=M);let a=r,s=r,l=r,i=l.UiFields??r.ClientData?.fields,o=l.Parameters??r.ClientData?.parameters;if(a.Parent)n.a("asGroup having parent",{asGroup:a}),e+=E+h([a.Parent,a.Field,a.Index,a.Add,a.EntityId]),e+=T(a,i,o,{prefill:!0,fields:!0,params:!0,duplicate:!0});else if(s.EntityId)n.a("asItem having entity id",{asItem:s}),e+=s.EntityId,e+=T(s,i,o,{fields:!0,params:!0});else if(r.ContentTypeName){n.a("asItem having content type name",{item:r});let p=r;e+="new:"+p.ContentTypeName,e+=T(p,i,o,{metadata:!0,prefill:!0,fields:!0,params:!0,duplicate:!0})}}return n.r(e)}function T(t,n,e,r){let a=t;return""+(r.metadata?v(a):"")+(r.prefill?W(t.Prefill):"")+(r.fields?x(n):"")+(r.params?k(e,U):"")+(r.duplicate&&a.DuplicateEntity?`${u}copy:`+a.DuplicateEntity:"")}function v(t){let n=y.fn("getParamForMetadata",{addItem:t}),e=r=>h(["",r.Target,r.TargetType,r.Singleton?r.Singleton.toString():""]);if(t.For!=null){let r=`${u}for:`,a=e(t.For);if(t.For?.String)return n.r(`${r}s~${f.encode(t.For.String)}${a}`,"for string");if(t.For?.Number)return n.r(`${r}n~${t.For.Number}${a}`,"for number");if(t.For?.Guid)return n.r(`${r}g~${t.For.Guid}${a}`,"for guid")}return t.Metadata?n.r(O(t),"metadata"):n.r("","other")}function O(t){let n=y.fn("getParamForOldMetadata",{addItem:t}),e;switch(t.Metadata.keyType.toLocaleLowerCase()){case m.keyTypes.string:e="s";break;case m.keyTypes.number:e="n";break;case m.keyTypes.guid:e="g";break}let r=Object.values(m.metadata).find(s=>s.targetType===t.Metadata.targetType)?.target,a=`${u}for:`+e+I+h([f.encode(t.Metadata.key),r,t.Metadata.targetType]);return n.r(a,a)}function W(t){return k(t,b)}function k(t,n){let e="";if(!t)return e;for(let[r,a]of Object.entries(t))a!=null&&(e+=`${u}${n}${r}~${f.encode(a.toString())}`);return e}function R(t,n){let e=n??{};if(t==null)return e;let r=t.split(d),[a,s]=r[1].split(I),l=f.decode(s);return e[a]=l,e}function x(t){return t?`${u}${D}${f.encode(t)}`:""}function C(t){return/^-?[0-9]*$/g.test(t)}function j(t){let n=y.fn("convertUrlToForm",{formUrl:t}),e={items:[]},r=t.split(M);for(let a of r)if(n.a("item",{item:a}),a.startsWith(E)){let s={},l=a.split(u);for(let i of l)if(i.startsWith(E)){let o=i.split(d),p=o.length>4&&o[5]&&C(o[5]);s=c(g(c({},s),{Parent:o[1],Field:o[2],Index:parseInt(o[3],10),Add:o[4]==="true"}),p&&{EntityId:parseInt(o[5],10)})}else i.startsWith("copy:")?s=g(c({},s),{DuplicateEntity:parseInt(i.split(d)[1],10)}):s=F(s,i);e.items.push(s)}else if(C((a??"").split(u)[0])){let s=a.split(u),l=A.editId(parseInt(s[0],10));for(let i of s)l=F(l,i);e.items.push(l)}else if(a.startsWith("new:")){let s={},l=a.split(u);for(let i of l)if(i.startsWith("new:")){let o=i.split(d);s.ContentTypeName=o[1]}else if(i.startsWith("for:")){let o=i.split(d),[p,P]=o[1].split(I),S=o[4]!=null?o[4]==="true":void 0;s.For=c(c(c(c({Target:o[2],TargetType:parseInt(o[3],10)},p==="g"&&{Guid:P}),p==="n"&&{Number:parseInt(P,10)}),p==="s"&&{String:f.decode(P)}),S!=null&&{Singleton:S})}else i.startsWith("copy:")?s=g(c({},s),{DuplicateEntity:parseInt(i.split(d)[1],10)}):s=F(s,i);e.items.push(s)}return n.r(e)}function F(t,n){let e=y.fn("addParamToItemIdentifier",{item:t,part:n});if(n.startsWith(D)){let r=f.decode(n.split(d)[1]);return t.ClientData=g(c({},t.ClientData),{fields:r}),e.rSilent(t)}if(n.startsWith(b))return t.Prefill=R(n,t.Prefill),e.rSilent(t);if(n.startsWith(U)){let r=R(n,t.ClientData?.parameters);return t.ClientData=g(c({},t.ClientData),{parameters:r}),e.rSilent(t)}return e.rSilent(t,"no match")}export{X as a,j as b};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/chunk-L77E4UL2.js.map
