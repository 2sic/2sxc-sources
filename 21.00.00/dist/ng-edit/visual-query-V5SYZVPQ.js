import{a as G}from"./chunk-LV5G4DZL.js";import{a as le}from"./chunk-A4YWSMUY.js";import{a as $t,b as Ht,c as Wt,d as zt}from"./chunk-GKCVCYTH.js";import"./chunk-OPPDVHDF.js";import{a as ei}from"./chunk-WO7E65AC.js";import"./chunk-Z7CBEHUH.js";import"./chunk-Q5UOKVIL.js";import{a as Jt,b as Kt,c as Zt,d as Yt,e as Xt}from"./chunk-VSMYOUA2.js";import"./chunk-O3YSC345.js";import"./chunk-LTBMRGUR.js";import"./chunk-Q7SYXYTY.js";import"./chunk-HW433KCS.js";import"./chunk-GLFISIX2.js";import"./chunk-MBSXBYF5.js";import"./chunk-AAMPB3UT.js";import{b as Te}from"./chunk-DDUEZMYJ.js";import{a as Ut}from"./chunk-43T4DH5V.js";import"./chunk-J5KNE364.js";import"./chunk-RAUQWANF.js";import"./chunk-3S44UA6M.js";import"./chunk-S7Y6G6OZ.js";import"./chunk-RRABFPYC.js";import"./chunk-JZD2T5W2.js";import"./chunk-GEYEBE5H.js";import"./chunk-EDOMTBDN.js";import"./chunk-M6AZRTKS.js";import{a as Nt}from"./chunk-E7PGVCV5.js";import{a as Qt}from"./chunk-VESINTPJ.js";import"./chunk-R4Z5GU7S.js";import"./chunk-R2RL2BBG.js";import{a as re,b as se}from"./chunk-BKBBHERO.js";import{a as Lt}from"./chunk-WCNLNRUK.js";import{a as Bt}from"./chunk-LOXR3JJX.js";import"./chunk-NIPOW2E2.js";import{a as we}from"./chunk-ORK43FFD.js";import"./chunk-56YE37V6.js";import"./chunk-V5UC4TMG.js";import"./chunk-U657U553.js";import"./chunk-QFYVXC4V.js";import"./chunk-T7AKPKMZ.js";import{a as Me}from"./chunk-L77E4UL2.js";import"./chunk-JNRBLGLU.js";import"./chunk-MWYLUFVP.js";import"./chunk-4YE3E6NH.js";import{a as jt}from"./chunk-ZBQC6E3M.js";import"./chunk-AO43RQAG.js";import{b as qt,c as Gt}from"./chunk-SCB2MVKQ.js";import{a as Pe}from"./chunk-4SMJHLGZ.js";import"./chunk-JEQANFI7.js";import{a as Ie}from"./chunk-564RKXG7.js";import{c as I}from"./chunk-HJXR3IL7.js";import"./chunk-K5FCDENP.js";import{a as Rt}from"./chunk-Z7VBWKZ3.js";import{b as wt,c as Tt}from"./chunk-ODL7UGWI.js";import{a as _t}from"./chunk-R3Y7P2GW.js";import"./chunk-LPOE4446.js";import"./chunk-WAPW5AUJ.js";import"./chunk-GVW7AWVE.js";import{d as gt}from"./chunk-ENHI5GWA.js";import{a as Vt,c as Ft}from"./chunk-DAEXUMJT.js";import"./chunk-IGMB27B5.js";import{e as Ot,h as At}from"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as ht}from"./chunk-HCPBPEHV.js";import{f as K,h as ne,l as Z}from"./chunk-QVLOO535.js";import{c as kt}from"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{b as yt,d as Ct,f as vt,g as St,h as xt,j as $e,l as Dt,n as bt,o as Et,r as It,v as Mt,w as Pt}from"./chunk-UMOPET3G.js";import{b as pt,e as ut,i as mt,j as ft}from"./chunk-4LV77BQU.js";import"./chunk-EZZQWHAZ.js";import{b as Q,c as L}from"./chunk-23CS2WID.js";import{a as q}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{c as ct,d as dt}from"./chunk-OYQCZWOE.js";import{b as oe,c as ae,d as be,g as Ee}from"./chunk-G33ZJSCE.js";import{aa as P,ca as De}from"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$a as ye,Aa as H,Ab as b,Ac as J,B as Ye,Bb as E,Bd as lt,Cb as g,Db as r,Ea as it,Eb as s,F as Be,Fb as R,Gc as fe,Nb as T,Oa as nt,Ob as ot,P as Xe,Pb as h,Rb as p,Sa as c,Tc as te,Vb as ve,Wb as ue,X as et,Xb as me,Za as y,db as A,ea as _e,ec as l,f as Je,fc as _,fd as ie,g as Ke,gc as N,gd as st,hc as Ue,ia as ee,ib as Ce,jb as pe,ld as Se,md as xe,oa as v,pa as S,rc as at,tc as W,u as ge,v as Ze,vb as je,vc as rt,wb as m,xa as tt,yb as f,zb as k,zc as z}from"./chunk-46QINP2S.js";import{a as F,b as $}from"./chunk-BDOJB7O2.js";function O(n,a){return n.find(e=>e.PartAssemblyAndType===a)}function B(n){return n.getOverlay("endpointLabel").label}var he={App:{Name:"App",Label:"App DataSources",Icon:"star",UiHint:"DataSources from the current App"},Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function ti(n,a){let e={};for(let i of n){let t=O(a,i.PartAssemblyAndType),o=t?F($(F({},t.PrimaryType?he[t.PrimaryType]:he.Unknown),{DynamicIn:t.DynamicIn??!1,DynamicOut:t.OutMode!="static",Icon:t.Icon,UiHint:t.UiHint,HelpLink:t.HelpLink,outMode:t.OutMode}),t.EnableConfig!=null?{EnableConfig:t.EnableConfig}:{}):$(F({},he.Unknown),{DynamicOut:!1,DynamicIn:!1,outMode:"static"});e[i.EntityGuid]=o}return e}var ke=(()=>{class n extends gt{fetchPipelinePromise(e,i){return this.fetchPromise(Yt,{params:{appId:this.appId,id:e.toString()}}).then(t=>(t.DataSources.length||this.#e(t,i),this.#t(t.DataSources),t))}#e(e,i){let t=I.pipelineDesigner.defaultPipeline.dataSources;for(let o of t){let d=O(i,o.PartAssemblyAndType),u={Description:"",EntityGuid:o.EntityGuid,EntityId:void 0,Name:d.Name,PartAssemblyAndType:o.PartAssemblyAndType,VisualDesignerData:o.VisualDesignerData};e.DataSources.push(u)}e.Pipeline.StreamWiring=I.pipelineDesigner.defaultPipeline.streamWiring}#t(e){if(!e.some(t=>t.EntityGuid===I.pipelineDesigner.outDataSource.EntityGuid)){let t=I.pipelineDesigner.outDataSource,o={Description:t.Description,EntityGuid:t.EntityGuid,EntityId:void 0,Name:t.Name,PartAssemblyAndType:t.PartAssemblyAndType,VisualDesignerData:t.VisualDesignerData};e.push(o)}for(let t of e)t.VisualDesignerData??={Top:50,Left:50}}fetchDataSourcesPromise(){return this.fetchPromise(Xt,{params:{appid:this.appId,zoneId:this.zoneId}}).then(e=>(e.push(I.pipelineDesigner.outFinalTarget),e))}typeNameFilter(e,i){let t=e.split(", ");switch(i){case"classFullName":return t[0];case"className":let d=t[0].split(".");return d[d.length-1];default:return e}}savePipeline(e){let i=e.Pipeline,t=e.DataSources;return this.http.post(Zt,{pipeline:i,dataSources:t},{params:{appId:this.appId,Id:i.EntityId.toString()}}).pipe(ge(o=>(this.#t(o.DataSources),o)))}runPipelinePromise(e,i){return this.fetchPromise(Jt,{params:{appId:this.appId,id:e.toString(),top:i.toString()}})}debugStreamPromise(e,i,t,o){return this.fetchPromise(Kt,{params:{appId:this.appId,id:e.toString(),from:i,out:t,top:o.toString()}})}static{this.\u0275fac=(()=>{let e;return function(t){return(e||(e=it(n)))(t||n)}})()}static{this.\u0275prov=_e({token:n,factory:n.\u0275fac})}}return n})();function hi(n,a){if(n&1&&l(0),n&2){let e=p();Ue(' for Stream: "',e.debugStream.name,'" on Source: "',e.debugStream.sourceName,'" ')}}function gi(n,a){n&1&&(r(0,"div",13)(1,"span"),l(2,"Results"),s()())}function _i(n,a){n&1&&l(0," Showing All results ")}function yi(n,a){if(n&1&&l(0),n&2){let e=p();N(" Showing top ",e.top," results ")}}function Ci(n,a){n&1&&l(0," All ")}function vi(n,a){if(n&1&&l(0),n&2){let e=p().$implicit;N(" ",e," ")}}function Si(n,a){if(n&1){let e=T();r(0,"button",14),h("click",function(){let t=v(e).$implicit,o=p();return S(o.show(t))}),l(1," Show "),m(2,Ci,1,0),m(3,vi,1,1),s()}if(n&2){let e=a.$implicit;c(2),f(e===0?2:-1),c(),f(e!==0?3:-1)}}function xi(n,a){n&1&&(r(0,"div",16)(1,"span"),l(2,"Parameters"),s()())}function Di(n,a){if(n&1&&(r(0,"li"),l(1),s()),n&2){let e=a.$implicit;c(),_(e)}}function bi(n,a){if(n&1&&(r(0,"mat-tab"),pe(1,xi,3,0,"div",15),r(2,"div",7)(3,"ul"),b(4,Di,2,1,"li",null,k),s()()()),n&2){let e=p();c(4),E(e.parameters)}}function Ei(n,a){n&1&&(r(0,"div",17)(1,"span"),l(2,"Sources"),s()())}function Ii(n,a){if(n&1&&(r(0,"div"),l(1),s()),n&2){let e=p().$implicit;c(),_(e.value.Definition==null?null:e.value.Definition.Name)}}function Mi(n,a){if(n&1&&(r(0,"li")(1,"b"),l(2),s(),l(3,"="),r(4,"em"),l(5),s()()),n&2){let e=a.$implicit;c(2),_(e.key),c(3),_(e.value)}}function Pi(n,a){if(n&1&&(r(0,"tr")(1,"td"),m(2,Ii,2,1,"div"),r(3,"pre"),l(4),s()(),r(5,"td"),l(6),s(),r(7,"td")(8,"ol"),b(9,Mi,6,2,"li",null,k),z(11,"keyvalue"),s()(),r(12,"td"),l(13),s()()),n&2){let e=a.$implicit;c(2),f(e.value.Definition!=null&&e.value.Definition.Name?2:-1),c(2),_(e.value.Guid),c(2),_(e.value.Type),c(3),E(J(11,4,e.value.Configuration)),c(4),_(e.value.Error)}}function wi(n,a){n&1&&(r(0,"div",18)(1,"span"),l(2,"Streams"),s()())}function Ti(n,a){if(n&1&&(r(0,"tr")(1,"td")(2,"pre"),l(3),s()(),r(4,"td")(5,"pre"),l(6),s()(),r(7,"td"),l(8),s(),r(9,"td"),l(10),s()()),n&2){let e=a.$implicit;c(3),_(e.Source+":"+e.SourceOut),c(3),_(e.Target+":"+e.TargetIn),c(2),_(e.Count),c(2),_(e.Error)}}var ii=(()=>{class n{constructor(e,i,t){this.dialogData=e,this.dialog=i,this.visualQueryService=t}ngOnInit(){let e=this.visualQueryService.pipelineModel().Pipeline,i=(e.Params?.split(`
`)??[]).filter(o=>!!o),t=(e.TestParameters?.split(`
`)??[]).filter(o=>!!o);this.parameters=[].concat(i,t),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialog.close()}show(e){e!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,e):this.visualQueryService.runPipeline(e),this.closeDialog())}static{this.\u0275fac=function(i){return new(i||n)(y(ae),y(oe),y(V))}}static{this.\u0275cmp=A({type:n,selectors:[["app-query-result"]],decls:57,vars:11,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["dynamicHeight","","color","accent",1,"eav-tab-group"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"eav-tab-content"],[1,"eav-tab-description"],["mat-button",""],[1,"query-result"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),l(3," Query Results "),m(4,hi,1,2),s(),r(5,"button",3),h("click",function(){return t.closeDialog()}),r(6,"mat-icon"),l(7,"close"),s()()(),r(8,"div",4)(9,"p"),l(10),s(),r(11,"mat-tab-group",5)(12,"mat-tab"),pe(13,gi,3,0,"div",6),r(14,"div",7)(15,"div",8)(16,"div"),m(17,_i,1,0),m(18,yi,1,1),s(),r(19,"div"),b(20,Si,4,2,"button",9,k),s()(),r(22,"pre",10),l(23),z(24,"json"),s()()(),m(25,bi,6,0,"mat-tab"),r(26,"mat-tab"),pe(27,Ei,3,0,"div",11),r(28,"div",7)(29,"table")(30,"tr")(31,"th"),l(32,"Name and Guid"),s(),r(33,"th"),l(34,"Type"),s(),r(35,"th"),l(36,"Configuration"),s(),r(37,"th"),l(38,"Error"),s()(),b(39,Pi,14,6,"tr",null,k),z(41,"keyvalue"),s()()(),r(42,"mat-tab"),pe(43,wi,3,0,"div",12),r(44,"div",7)(45,"table")(46,"tr")(47,"th"),l(48,"Source"),s(),r(49,"th"),l(50,"Target"),s(),r(51,"th"),l(52,"Items"),s(),r(53,"th"),l(54,"Error"),s()(),b(55,Ti,11,4,"tr",null,k),s()()()()()()),i&2&&(c(4),f(t.debugStream?4:-1),c(6),Ue(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",t.timeUsed,"ms (",t.ticksUsed," ticks) "),c(7),f(t.top===0?17:-1),c(),f(t.top!==0?18:-1),c(2),E(t.optionsForTop),c(3),_(J(24,7,t.result)),c(2),f(t.parameters!=null&&t.parameters.length?25:-1),c(14),E(J(41,9,t.sources)),c(16),E(t.streams))},dependencies:[Z,ne,K,L,Q,zt,$t,Ht,Wt,Se,xe],styles:[`.eav-dialog[_ngcontent-%COMP%]{overflow:hidden}.eav-tab-group[_ngcontent-%COMP%]{padding:0}.eav-tab-content[_ngcontent-%COMP%]{height:calc(100vh - 268px);overflow-y:auto;margin-top:1rem}.eav-tab-description[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-right:1rem;padding:0 1rem 1rem;font-size:16px;line-height:1.5}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;font-size:13px;margin:0 10px 0 0;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow:auto}.query-result[_ngcontent-%COMP%]{margin:0;height:calc(100vh - 363px)}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}
/*# sourceMappingURL=query-result-EBBL5YYU.css.map */`]})}}return n})();var ni=(()=>{class n{constructor(e,i){this.dialogData=e,this.dialog=i}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialog.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api-query"),"_blank")}static{this.\u0275fac=function(i){return new(i||n)(y(ae),y(oe))}}static{this.\u0275cmp=A({type:n,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["align","end"],["mat-button","","tippy","Open 2sxc Insights",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),l(3,"Stream Error Results"),s(),r(4,"button",3),h("click",function(){return t.closeDialog()}),r(5,"mat-icon"),l(6,"close"),s()()(),r(7,"div",4)(8,"pre"),l(9),z(10,"json"),s()(),r(11,"mat-dialog-actions",5)(12,"button",6),h("click",function(){return t.openInsights()}),r(13,"mat-icon",7),l(14,"speed"),s(),r(15,"span"),l(16,"Insights"),s()()()()),i&2&&(c(9),_(J(10,1,t.errorData)))},dependencies:[Z,ne,K,L,Q,Ee,Se],styles:[`.description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}
/*# sourceMappingURL=stream-error-result-WV4OM4IH.css.map */`]})}}return n})();var V=(()=>{class n extends _t{#e;#t;#i;#n;#o;#a;#r;#s;constructor(e,i,t,o,d){super(),this.snackBar=e,this.matDialog=i,this.viewContainerRef=t,this.zone=o,this.changeDetectorRef=d,this.#e=q(Te),this.#t=q(Ut),this.#i=q(ke),this.#n=q(we),this.#o=q(lt),this.pipelineModel=H(null),this.dataSources=H(null),this.dataSourceConfigs=H({}),this.putEntityCountOnConnections$=new Je,this.#a=parseInt(this.#n.getParam("pipelineId"),10),this.#r=!1,this.#s=!1}ngOnDestroy(){this.putEntityCountOnConnections$.complete(),super.ngOnDestroy()}init(){this.#m(()=>this.#c(!0,!0,!1)),this.#f(),this.#n.doOnDialogClosed(()=>{(this.#r||this.#s)&&this.#c(this.#r,this.#s,this.#r),this.#r=!1,this.#s=!1})}editPipelineEntity(){this.#l(()=>{let e={items:[Ie.editId(this.pipelineModel().Pipeline.EntityId)]},i=Me(e);this.#n.navRelative([`edit/${i}`]),this.#r=!0})}saveAndRun(e,i){if(e&&i)return this.#l(()=>this.runPipeline());if(e)return this.#l();if(i)return this.runPipeline()}showDataSourceDetails(e){let i=G(this.pipelineModel()),t=le.tryParse(i.Pipeline.VisualDesignerData)??{};t.ShowDataSourceDetails=e,i.Pipeline.VisualDesignerData=JSON.stringify(t),this.pipelineModel.set(i)}addDataSource(e){let i=G(this.pipelineModel()),t={Description:"",EntityGuid:"unsaved"+(i.DataSources.length+1),EntityId:void 0,Name:e.Name,PartAssemblyAndType:e.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}};i.DataSources.push(t),this.pipelineModel.set(i),this.#l()}removeDataSource(e,i,t){let o=G(this.pipelineModel());o.DataSources=o.DataSources.filter(d=>d.EntityGuid!==e),o.Pipeline.StreamWiring=i,o.Pipeline.StreamsOut=t,this.pipelineModel.set(o)}renameDataSource(e,i){let t=G(this.pipelineModel()),o=t.DataSources.find(d=>d.EntityGuid===e);o.Name=i,this.pipelineModel.set(t)}changeDataSourceDescription(e,i){let t=G(this.pipelineModel()),o=t.DataSources.find(d=>d.EntityGuid===e);o.Description=i,this.pipelineModel.set(t)}changeConnections(e,i){let t=G(this.pipelineModel());t.Pipeline.StreamWiring=e,t.Pipeline.StreamsOut=i,this.pipelineModel.set(t)}changeDataSourcePosition(e,i){let t=G(this.pipelineModel()),o=t.DataSources.find(d=>d.EntityGuid===e);o&&(o.VisualDesignerData=F(F({},o.VisualDesignerData),i),this.pipelineModel.set(t))}#p(e){let i={};e.forEach(t=>{t.EntityId!=null&&(i[t.EntityId]=[],t.Metadata?.forEach(o=>{Object.entries(o).forEach(([d,u])=>{if(u==null||u===""||["Created","Guid","Id","Modified","Title","_Type"].includes(d))return;Array.isArray(u)&&u[0]?.Title!==null&&u[0]?.Id!==null&&(u=`${u[0].Title} (${u[0].Id})`);let C={name:d,value:u};i[t.EntityId].push(C)})}))}),this.dataSourceConfigs.set(i)}editDataSource(e){let t=O(this.dataSources(),e.PartAssemblyAndType).ContentType,{targetType:o,keyType:d}=I.metadata.entity,u=e.EntityGuid;this.#t.getMetadataPromise(o,d,u,t).then(C=>{if(C.Items.length){let w={items:[Ie.editId(C.Items[0].Id)]},D=Me(w);this.#n.navRelative([`edit/${D}`]),this.#s=!0;return}this.#e.retrieveContentType(t).subscribe({next:w=>{if(w==null){this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});return}let D={items:[Ie.newMetadata(u,t,I.metadata.entity)]},j=Me(D);this.#n.navRelative([`edit/${j}`]),this.#s=!0},error:w=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}#l(e){this.snackBar.open("Saving..."),this.#i.savePipeline(this.pipelineModel()).subscribe({next:i=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel.set(i),e?.()},error:i=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(e=25){this.snackBar.open("Running query..."),this.#i.runPipelinePromise(this.pipelineModel().Pipeline.EntityId,e).then(i=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.queryResult=i,this.#d(i,e),console.warn(i),this.pipelineModel.set(G(this.pipelineModel())),setTimeout(()=>{this.putEntityCountOnConnections$.next(i)})}).catch(i=>{this.snackBar.open("Query failed",null,{duration:2e3})})}debugStream(e,i=25){if(e.Error)return this.#u(e);if(e.Count===0)return;this.snackBar.open("Running stream...");let t=this.pipelineModel().Pipeline.EntityId;this.#i.debugStreamPromise(t,e.Source,e.SourceOut,i).then(o=>{this.snackBar.open("Stream worked",null,{duration:2e3});let d=this.pipelineModel().DataSources.find(C=>C.EntityGuid===e.Source),u={name:e.SourceOut,source:e.Source,sourceName:d?.Name,original:e};this.#d(o,i,u),console.warn(o)}).catch(o=>{this.snackBar.open("Stream failed",null,{duration:2e3})})}#c(e,i,t){t&&this.snackBar.open("Reloading query, please wait..."),this.#i.fetchPipelinePromise(this.#a,this.dataSources()).then(o=>{t&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.#o.setTitle(`${o.Pipeline.Name} - Visual Query`),e&&this.pipelineModel.set(o),i&&this.#p(o.DataSources)})}#d(e,i,t){let o={result:e,debugStream:t,top:i};this.matDialog.open(ii,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:o,panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}#u(e){let i={errorData:e.ErrorData};this.matDialog.open(ni,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:i,panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}#m(e){this.#i.fetchDataSourcesPromise().then(i=>{this.dataSources.set(i),e()})}#f(){this.zone.runOutsideAngular(()=>{this.subscriptions.add(Ye(window,"keydown").pipe(Be(()=>!this.#n.snapshot.firstChild),Be(e=>qt(e))).subscribe(e=>{e.preventDefault(),this.zone.run(()=>{this.#l()})}))})}static{this.\u0275fac=function(i){return new(i||n)(ee(ht),ee(be),ee(ye),ee(tt),ee(te))}}static{this.\u0275prov=_e({token:n,factory:n.\u0275fac})}}return n})();function oi(n,a){if(!n)return;let i=G(n).filter(o=>o.Difficulty<=a&&o.PartAssemblyAndType!==I.pipelineDesigner.outDataSource.PartAssemblyAndType);i.sort((o,d)=>o.Name.toLocaleLowerCase().localeCompare(d.Name.toLocaleLowerCase()));let t={};for(let o of i){let d=o.PrimaryType;t[d]?t[d].push(o):t[d]=[o]}return t}function ki(n,a){if(n&1){let e=T();r(0,"div",7),h("click",function(){let t=v(e).$implicit,o=p(4);return S(o.addDataSource(t))}),r(1,"mat-icon"),l(2),s(),r(3,"span"),l(4),s()()}if(n&2){let e=a.$implicit,i=p(4);g("tippy",e.UiHint||e.Name),c(2),_(e.Icon||i.guiTypes.Unknown.Icon),c(2),_(e.Name)}}function Ri(n,a){if(n&1&&(r(0,"div",5),b(1,ki,5,3,"div",6,je().trackDataSources,!0),s()),n&2){let e=p().$implicit;c(),E(e.value)}}function Oi(n,a){if(n&1){let e=T();r(0,"div",4),h("click",function(){let t=v(e).$implicit,o=p(2);return S(o.toggleItem(t.key))}),r(1,"mat-icon"),l(2),s(),r(3,"span"),l(4),s()(),m(5,Ri,3,0,"div",5)}if(n&2){let e=a.$implicit,i=p(2);g("tippy",i.guiTypes[e.key].UiHint||e.key),c(2),_(i.guiTypes[e.key].Icon||i.guiTypes.Unknown.Icon),c(2),_(i.guiTypes[e.key].Label??i.guiTypes[e.key].Name??e.key),c(),f(i.toggledItems.includes(e.key)?5:-1)}}function Ai(n,a){if(n&1){let e=T();r(0,"div",0)(1,"div",1)(2,"span",2),l(3,"Show Advanced"),s(),r(4,"mat-slide-toggle",3),h("change",function(t){v(e);let o=p();return S(o.toggleDifficulty(t))}),s()(),b(5,Oi,6,4,null,null,je().trackGroups,!0),z(7,"keyvalue"),s()}if(n&2){let e=p();c(5),E(J(7,0,e.sorted()))}}var ri=(()=>{class n{#e;#t;constructor(e){this.visualQueryService=e,this.toggledItems=[],this.guiTypes=he,this.#e=I.pipelineDesigner.dataSourceDifficulties,this.#t=H(this.#e.default),this.sorted=fe(()=>oi(this.visualQueryService.dataSources(),this.#t()))}toggleDifficulty(e){let i=e.checked?this.#e.advanced:this.#e.default;this.#t.set(i)}addDataSource(e){this.visualQueryService.addDataSource(e)}toggleItem(e){Rt.toggleInArray(e,this.toggledItems)}trackGroups(e,i){return i.key}trackDataSources(e,i){return i.PartAssemblyAndType}static{this.\u0275fac=function(i){return new(i||n)(y(V))}}static{this.\u0275cmp=A({type:n,selectors:[["app-add-explorer"]],decls:1,vars:1,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"eav-show-advanced"],[1,"eav-slide-toggle-label"],["color","primary",3,"change"],["tippyShowDelay","750",1,"collapsible",3,"click","tippy"],[1,"list"],["tippyShowDelay","750",1,"list-item",3,"tippy"],["tippyShowDelay","750",1,"list-item",3,"click","tippy"]],template:function(i,t){i&1&&m(0,Ai,8,2,"div",0),i&2&&f(t.sorted()?0:-1)},dependencies:[se,re,L,Q,kt,xe],styles:[`.mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}.eav-show-advanced[_ngcontent-%COMP%]{margin-left:8px}
/*# sourceMappingURL=add-explorer-XZCVJJEA.css.map */`]})}}return n})();var si="dataSource_";function M(n){return si+n}function X(n){return n.replace(si,"")}var Qi={all:!1},Oe=class n{constructor(){this.log=P({ConnectionLineColors:n},Qi),this.#e=0,this.#t={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.#i=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.#n=this.#i.length-1,this.#o={}}#e;#t;#i;#n;#o;nextLinePaintStyle(a){return this.#o[a]??=this.#a()}#a(){return $(F({},this.#t),{stroke:this.#i[this.#e++%this.#n]})}};var Li={all:!1,eventConnectionDetached:!1,eventConnectionAttached:!1},Ae=class n{constructor(a,e,i,t,o){this.instance=a,this.pipelineModel=e,this.dataSources=i,this.endpointsSvc=t,this.onConnectionsChanged=o,this.log=P({ConnectionsManager:n},Li),this.bulkDelete=!1}setup(){this.instance.bind("connectionDetached",a=>this.handleDetached(a)),this.instance.bind("connection",a=>this.handleAttached(a))}getAll(){return this.instance.getAllConnections().map(e=>({From:X(e.sourceId),Out:B(e.endpoints[0]),To:X(e.targetId),In:B(e.endpoints[1])}))}handleDetached(a){let e=this.log.fnIf("eventConnectionDetached");if(this.bulkDelete)return e.end("in bulk-delete mode, exit");let i=a.target,t=this.pipelineModel.DataSources.find(C=>C.EntityGuid===X(i.id)),o=O(this.dataSources,t.PartAssemblyAndType),d=B(a.targetEndpoint);!o.In.some(C=>this.endpointsSvc.getInfo(C,!1).name===d)&&this.instance.deleteEndpoint(a.targetEndpoint),setTimeout(()=>this.onConnectionsChanged()),e.end("done")}handleAttached(a){let e=this.log.fnIf("eventConnectionAttached");if(a.sourceId===a.targetId)return setTimeout(()=>{this.instance.deleteConnection(a.connection,{fireEvent:!1}),setTimeout(()=>this.onConnectionsChanged())}),e.end("self-connection, will delete and exit");let i=a.targetEndpoint.getOverlay("endpointLabel"),t=i.getLabel(),d=this.instance.getEndpoints(a.target.id).some(u=>B(u)===t&&a.targetEndpoint.id!==u.id&&u.canvas.classList.contains("targetEndpoint"));d&&i.setLabel(`PleaseRename${Math.floor(Math.random()*99999)}`),setTimeout(()=>this.onConnectionsChanged()),e.end("done",{targetLabel:t,targetHasSameLabel:d})}};var li=n=>({active:n});function Vi(n,a){n&1&&(r(0,"app-field-hint"),l(1," You will get suggestions for out-streams after you run query "),s())}function Fi(n,a){n&1&&(r(0,"app-field-hint",11),l(1," This field is required "),s()),n&2&&g("isError",!0)}function Ni(n,a){if(n&1&&(r(0,"mat-form-field",9)(1,"mat-label"),l(2,"Label"),s(),R(3,"input",10),s(),m(4,Vi,2,0,"app-field-hint"),m(5,Fi,2,1,"app-field-hint",11)),n&2){let e=p();c(4),f(e.isSource&&!e.pipelineResultExists?4:-1),c(),f(e.controls.label.touched&&(e.controls.label.errors!=null&&e.controls.label.errors.required)?5:-1)}}function qi(n,a){if(n&1&&(r(0,"mat-option",18),l(1),s()),n&2){let e=a.$implicit;g("value",e.value),c(),N(" ",e.name," ")}}function Gi(n,a){if(n&1&&(r(0,"mat-form-field",9)(1,"mat-label"),l(2,"Scope"),s(),r(3,"mat-select",17),b(4,qi,2,2,"mat-option",18,k),s()(),r(6,"app-field-hint"),l(7," The scope should almost never be changed - "),r(8,"a",19),l(9,"see help"),s()()),n&2){let e=p(2);c(3),g("placeholder",e.scopeOptions.length?"":"No items found"),c(),E(e.scopeOptions)}}function Bi(n,a){if(n&1&&(r(0,"mat-option",18),l(1),s()),n&2){let e=a.$implicit;g("value",e),c(),N(" ",e," ")}}function ji(n,a){if(n&1&&(r(0,"mat-select",12),b(1,Bi,2,2,"mat-option",18,k),s()),n&2){let e=p(2);g("placeholder",e.labelOptions.length?"":"No items found"),c(),E(e.labelOptions)}}function Ui(n,a){n&1&&R(0,"input",10)}function $i(n,a){n&1&&(r(0,"app-field-hint",11),l(1," This field is required "),s()),n&2&&g("isError",!0)}function Hi(n,a){if(n&1){let e=T();m(0,Gi,10,1),r(1,"mat-form-field",9)(2,"mat-label"),l(3,"Label"),s(),m(4,ji,3,1,"mat-select",12),m(5,Ui,1,0,"input",10),r(6,"div",13)(7,"button",14),h("click",function(){v(e);let t=p();return S(t.toggleGuidedLabel(!0))}),r(8,"mat-icon",15),l(9," search "),s()(),r(10,"button",16),h("click",function(){v(e);let t=p();return S(t.toggleGuidedLabel(!1))}),r(11,"mat-icon",15),l(12," text_fields "),s()()()(),m(13,$i,2,1,"app-field-hint",11)}if(n&2){let e=p();f(e.advancedMode&&e.guidedLabel?0:-1),c(4),f(e.guidedLabel?4:-1),c(),f(e.guidedLabel?-1:5),c(2),g("ngClass",W(6,li,e.guidedLabel)),c(3),g("ngClass",W(8,li,!e.guidedLabel)),c(3),f(e.controls.label.touched&&(e.controls.label.errors!=null&&e.controls.label.errors.required)?13:-1)}}function Wi(n,a){if(n&1){let e=T();r(0,"mat-slide-toggle",20),h("change",function(t){v(e);let o=p();return S(o.toggleAdvancedMode(t))}),l(1),s()}if(n&2){let e=p();g("checked",e.advancedMode),c(),N(" ",e.advancedMode?"Advanced":"Simple"," ")}}var ci=(()=>{class n extends Pe{#e;constructor(e,i,t,o){super(),this.dialogData=e,this.dialog=i,this.visualQueryService=t,this.changeDetectorRef=o,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=this.visualQueryService.queryResult!=null,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1,this.#e=q(Te)}ngOnInit(){this.#t(),this.#i()}closeDialog(e){this.dialog.close(e)}toggleGuidedLabel(e){this.guidedLabel=e}toggleAdvancedMode(e){this.advancedMode=e.checked}saveAndClose(){let e=this.form.getRawValue();this.closeDialog(e.label)}#t(){this.form=new xt({label:new $e(this.dialogData.label,Ct.required),scope:new $e(I.scopes.default.value)}),this.controls=this.form.controls,!(!this.isSource||!this.pipelineResultExists)&&(this.subscriptions.add(this.controls.scope.valueChanges.pipe(et(this.controls.scope.value),Xe()).subscribe(e=>{this.labelOptions=Object.values(this.visualQueryService.queryResult.Sources).find(i=>i.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(i=>i.Scope===e).map(i=>i.Name),!this.labelOptions.includes(this.controls.label.value)&&this.controls.label.value!=null&&this.controls.label.patchValue(null)})),this.#e.getScopesPromise().then(e=>{let i=Object.values(this.visualQueryService.queryResult.Sources).find(o=>o.Guid===this.dialogData.pipelineDataSourceGuid).Out,t=e.filter(o=>i.some(d=>d.Scope===o.value));this.scopeOptions=t,this.changeDetectorRef.markForCheck()}))}#i(){this.dialog.keydownEvents().subscribe(e=>{Gt(e)&&this.form.valid&&(e.preventDefault(),this.saveAndClose())})}static{this.\u0275fac=function(i){return new(i||n)(y(ae),y(oe),y(V),y(te))}}static{this.\u0275cmp=A({type:n,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(i,t){i&2&&ot("className",t.hostClass)},features:[Ce],decls:15,vars:7,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"formGroup"],[1,"eav-dialog-actions"],["color","accent",3,"checked"],[3,"action","label","disabled","ngClass"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","formControlName","label","required",""],[3,"isError"],["formControlName","label","required","",3,"placeholder"],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"click","ngClass"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"click","ngClass"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["color","accent",3,"change","checked"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),l(3,"Rename stream"),s(),r(4,"button",3),h("click",function(){return t.closeDialog()}),r(5,"mat-icon"),l(6,"close"),s()()(),r(7,"div",4)(8,"form",5),m(9,Ni,6,2),m(10,Hi,14,10),s()(),r(11,"mat-dialog-actions",6)(12,"div"),m(13,Wi,2,2,"mat-slide-toggle",7),s(),r(14,"app-save-close-button-fab",8),h("action",function(){return t.saveAndClose()}),s()()()),i&2&&(c(8),g("formGroup",t.form),c(),f(!t.isSource||!t.pipelineResultExists?9:-1),c(),f(t.isSource&&t.pipelineResultExists?10:-1),c(3),f(t.isSource&&t.pipelineResultExists?13:-1),c(),g("label","Rename and close (ctrl + enter)")("disabled",!t.form.valid)("ngClass",t.form.valid?"":"disabled"))},dependencies:[Z,K,L,Q,Mt,Dt,yt,vt,St,It,Pt,Et,bt,ft,mt,pt,ut,Tt,wt,Ft,Vt,Ot,At,ie,Ee,se,re,Bt,Lt,jt],encapsulation:2})}}return n})();var zi={all:!0,getEndpointOverlays:!0,getEndpointInfo:!0,buildSourceDef:!0,buildTargetDef:!0},Qe=class n{constructor(a,e){this.pipelineModel=a,this.renameDialogParts=e,this.log=P({EndpointDefinitionsService:n},zi)}#e(a){let e=this.log.fnIf("getEndpointOverlays",{isSource:a}),i=[["Label",{id:"endpointLabel",location:[.5,a?0:1],label:"Default",cssClass:a?"endpointSourceLabel":"endpointTargetLabel"}]];return e.r(i)}getInfo(a,e){let i=this.log.fnIf("getEndpointInfo",{endpointName:a,isDynamic:e}),t=a.trim(),o=t.endsWith("*"),d=o?t.substring(0,t.length-1):t;return e?i.r({name:d,required:!1},"isDynamic"):i.r({name:d,required:o},"notDynamic")}buildSourceDef(a,e){let i=this.log.fnIf("buildSourceDef",{pipelineDataSourceGuid:a,style:e}),t=!0,o={paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint "+(e??""),maxConnections:-1,isSource:t,anchor:["Continuous",{faces:["top"]}],overlays:this.#e(t),events:{click:d=>this.onChangeLabel(d,t,a)}};return i.r(o)}buildTargetDef(a,e){let i=this.log.fnIf("buildTargetDef",{pipelineDataSourceGuid:a,style:e}),t=!1,o={paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint "+(e??" "),maxConnections:1,isTarget:!t,anchor:["Continuous",{faces:["bottom"]}],overlays:this.#e(t),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:d=>this.onChangeLabel(d,t,a)}};return i.r(o)}onChangeLabel(a,e,i){if(!this.pipelineModel.Pipeline.AllowEdit)return;debugger;let t=a?.getOverlay?.("endpointLabel")??a;this.renameDialogParts.matDialog.open(ci,{autoFocus:!1,data:{pipelineDataSourceGuid:i,isSource:e,label:t.label},viewContainerRef:this.renameDialogParts.viewContainerRef,width:"650px"}).afterClosed().subscribe(o=>{o&&(t.setLabel(o),setTimeout(()=>this.renameDialogParts.onConnectionsChanged()))}),this.renameDialogParts.changeDetectorRef.markForCheck()}};var Ji={all:!1,addEndpoint:!1,reOrientAllLabels:!1,updateAfterChanges:!1,wireHasConnection:!1,mirrorEndpoints:!1,fields:["TestIn2","Default"]},Ki=3,Zi=30,Le=class n{constructor(a,e,i,t){this.instance=a,this.endpointDefs=e,this.connections=i,this.queryData=t,this.log=P({EndpointsManager:n},Ji),this.#t=!1}addEndpoint(a,e,i,t,o){let d=this.log.fnIfInList("addEndpoint","fields",e,{endpointName:e,isIn:i,queryDs:t}),u=O(this.queryData.dataSources,t.PartAssemblyAndType),C=i?u.In:u.Out,w=C?.some(fi=>this.endpointDefs.getInfo(fi,!1).required===!1),D=this.endpointDefs.getInfo(e,w);d.a("endpointInfo",{dataSource:u,connectionList:C,hasDynamic:w,endpointInfo:D});let j=w?"dynamic":D.required?this.#e(a,D.name,i)?"":"required":"",x=a.id+(i?"_in_":"_out_")+D.name,U=i?this.endpointDefs.buildTargetDef(t.EntityGuid,`${j} ${o}`):this.endpointDefs.buildSourceDef(t.EntityGuid,`${j} ${o}`),mi={uuid:x,enabled:this.queryData.query.Pipeline.AllowEdit||t.EntityGuid===I.pipelineDesigner.outDataSource.EntityGuid},ze=this.instance.addEndpoint(a,U,mi).getOverlay("endpointLabel");ze.setLabel(D.name),d.end("end",{overlay:ze})}#e(a,e,i=!0){let t=this.log.fnIf("wireHasConnection",{domDataSource:a,name:e,isIn:i}),o=this.queryData.query.Pipeline.StreamWiring?.some(d=>i?M(d.To)===a.id&&d.In===e:M(d.From)===a.id&&d.Out===e);return t.r(o,"wireExists"+o)}#t;updateAfterChanges(){let a=this.log.fnIf("updateAfterChanges",{query:this.queryData.query,isDoing:this.#t});if(this.#t)return a.end("already doing update, exit");this.#t=!0,this.#i(),this.#o(),this.#t=!1,this.instance.repaintEverything(),a.end("done")}#i(){let a=this.log.fnIf("mirrorEndpoints",{query:this.queryData.query});this.queryData.query.DataSources.map(i=>{let t=O(this.queryData.dataSources,i.PartAssemblyAndType);return t.OutMode==="mirror-in"?{def:t,guid:i.EntityGuid}:null}).filter(i=>i!==null).forEach(i=>{let{inPoints:t,outPoints:o}=this.#n(i.guid),d=t.map(x=>({point:x,label:B(x)})),u=o.map(x=>({point:x,label:B(x)})),C=d.filter(x=>!u.some(U=>U.label===x.label)),w=u.filter(x=>!d.some(U=>U.label===x.label));a.a("inMissingInOut",{inPoints:t,outPoints:o,missingInOut:C,outWithoutIn:w});let{domDataSource:D,dataSource:j}=this.queryData.findDataSourceAndDom(i.guid);C.length&&C.forEach(x=>this.addEndpoint(D,x.label,!1,j,"mirror-in")),w.forEach(x=>{x.point.canvas.classList.contains("mirror-in")&&(x.point.connections?.length||this.instance.deleteEndpoint(x.point))})})}#n(a){let e=this.instance.selectEndpoints({element:M(a)}),i=[],t=[];return e.each(o=>(o.isTarget?i:t).push(o)),{inPoints:i,outPoints:t}}#o(){let a=this.log.fnIf("reOrientAllLabels");this.queryData.query.DataSources.map(i=>i.EntityGuid).forEach(i=>{let{inPoints:t,outPoints:o}=this.#n(i);this.#a(t),this.#a(o)}),a.end()}#a(a){let e=a.length>Ki,i=a.map(t=>B(t)).join(",");e||i.length>Zi?a.forEach(t=>t.addClass("angled")):a.forEach(t=>t.removeClass("angled"))}removeAllEndpoints(a){let e=M(a);this.connections.bulkDelete=!0,this.instance.batch(()=>{this.instance.selectEndpoints({element:e}).delete()}),this.connections.bulkDelete=!1}};var Ve=class{constructor(a,e){this.jsPlumbRoot=a,this.lineColors=e,this.instance=window.jsPlumb.getInstance(this.createInstanceDefaults(this.jsPlumbRoot))}createInstanceDefaults(a){return{Container:a,Connector:["Bezier",{curviness:70}],PaintStyle:this.lineColors.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}destroy(){this.instance.reset(),this.instance.unbindContainer(),this.instance=null}};var Yi={all:!1,putEntityCountOnConnections:!1},Fe=class n{constructor(a,e,i){this.instance=a,this.pipelineModel=e,this.onDebugStream=i,this.log=P({LinesDecorator:n},Yi)}addEntityCount(a){let e=this.log.fnIf("putEntityCountOnConnections");a.Streams?.forEach(i=>{let t=M(i.Source),d=["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(i.Target)?M("Out"):M(i.Target),u=t+"_out_"+i.SourceOut,C=d+"_in_"+i.TargetIn;this.instance.getEndpoint(u)?.connections?.filter(D=>D.endpoints[1].getUuid()===C)?.forEach(D=>{let j=i.Error?"":i.Count.toString(),x="streamEntitiesCount "+(i.Error?"streamEntitiesError":"");D.setLabel({label:j,cssClass:x,events:{click:()=>{this.pipelineModel.Pipeline.AllowEdit&&this.onDebugStream(i)}}})})}),e.end("done")}};var Xi={all:!1,findDataSourceAndDom:!1},Ne=class n{constructor(a,e,i){this.jsPlumbRoot=a,this.query=e,this.dataSources=i,this.log=P({QueryDataManager:n},Xi)}findDomAndDef(a,e){let i=this.findDataSourceAndDom(a);if(!i)return null;let t=O(this.dataSources,e);return t?$(F({},i),{definition:t}):null}findDataSourceAndDom(a){let e=this.log.fnIf("findDataSourceAndDom",{sourceElementId:a}),i=this.jsPlumbRoot.querySelector("#"+M(a));if(!i)return e.r(null,"DOM not found, exit");let t=X(i.id),o=this.query.DataSources.find(d=>d.EntityGuid===t);return e.r({domDataSource:i,dataSource:o},"returning data source")}};var en={all:!1,initWirings:!0,ensureWireEndpointExists:!0,findDataSourceInDom:!0,fields:["TestIn2","*"]},qe=class n{constructor(a,e,i){this.plumber=a,this.instance=e,this.queryData=i,this.log=P({WiringsHelper:n},en)}initWirings(){let a=this.log.fnIf("initWirings"),e=this.queryData.query.Pipeline.StreamWiring;if(!e)return a.end("no wirings");let i=e.map(t=>{let d=M(t.From)+"_out_"+t.Out,C=M(t.To)+"_in_"+t.In;return{outPointDomId:d,inPointDomId:C,wire:t}});a.a("wirings",{wireDetails:i}),i.forEach(t=>{this.#t(t.outPointDomId,t.wire.From,t.wire.Out,!1),this.#t(t.inPointDomId,t.wire.To,t.wire.In,!0)}),i.forEach(t=>this.#e(t.outPointDomId,t.inPointDomId)),this.instance.repaintEverything(),a.end()}#e(a,e){try{this.instance.connect({uuids:[a,e],paintStyle:this.plumber.lineColors.nextLinePaintStyle(a)})}catch{console.error({message:"Connection failed",from:a,to:e})}}#t(a,e,i,t){let o=this.log.fnIfInList("ensureWireEndpointExists","fields",i,{endpointId:a,sourceGuid:e,name:i,isIn:t}),d=this.#i(a,e,i);return d==null?o.r(d,"set null"):(this.plumber.endpoints.addEndpoint(d.domDataSource,i,t,d.dataSource),o.r(d,"ok"))}#i(a,e,i){let t=this.log.fnIfInList("findDataSourceInDom","fields",i,{endpointId:a,sourceGuid:e,name:i});if(this.instance.getEndpoint(a))return t.r(null,"endpoint exists, exit");let o=this.queryData.findDataSourceAndDom(e);return t.r(o,`found: ${o!=null}`)}};var tn={all:!1,addEndpoint:!0,initDomDataSources:!1,eventConnectionDetached:!0,eventConnectionAttached:!0,fields:["TestIn2"]},Ge=class n{#e;#t;#i;constructor(a,e,i,t,o,d,u){this.jsPlumbRoot=a,this.query=e,this.dataSources=i,this.onConnectionsChangedParent=t,this.onDragend=o,this.onDebugStream=d,this.log=P({Plumber:n},tn),this.lineColors=new Oe,this.queryData=new Ne(this.jsPlumbRoot,this.query,this.dataSources),this.#t=new Qe(e,$(F({},u),{onConnectionsChanged:()=>this.#n()})),this.#i=new Ve(this.jsPlumbRoot,this.lineColors),this.#e=this.#i.instance,this.lineDecorator=new Fe(this.#e,this.query,this.onDebugStream),this.connections=new Ae(this.#e,this.query,this.dataSources,this.#t,()=>this.#n()),this.endpoints=new Le(this.#e,this.#t,this.connections,this.queryData),this.#e.batch(()=>{this.#o(),new qe(this,this.#e,this.queryData).initWirings(),this.connections.setup(),this.endpoints.updateAfterChanges()}),this.#e.repaintEverything()}#n(){this.endpoints.updateAfterChanges(),this.onConnectionsChangedParent()}destroy(){this.#i.destroy()}removeAllEndpoints(a){let e=M(a);this.connections.bulkDelete=!0,this.#e.batch(()=>{this.#e.selectEndpoints({element:e}).delete()}),this.connections.bulkDelete=!1}getStreamsOut(){let a=[];return this.#e.selectEndpoints({target:M("Out")}).each(i=>{a.push(B(i))}),a.join(",")}#o(){let a=this.log.fnIf("initDomDataSources");for(let e of this.query.DataSources){let{domDataSource:i,definition:t}=this.queryData.findDomAndDef(e.EntityGuid,e.PartAssemblyAndType);if(!i)continue;this.query.Pipeline.AllowEdit&&this.#e.draggable(i,{grid:[20,20],stop:u=>{let C=u.el,w=X(C.id),D={Top:u.finalPos[1],Left:u.finalPos[0]};setTimeout(()=>this.onDragend(w,D))}});let o=t.Out?.length??0;if(a.a("dataSource.Out",{outCount:o,out:t.Out}),t.Out?.forEach(u=>{this.endpoints.addEndpoint(i,u,!1,e)}),t.OutMode!="static"){let u=this.#t.buildSourceDef(e.EntityGuid);this.#e.makeSource(i,u,{filter:".add-endpoint"})}let d=t.In?.length??0;if(a.a("dataSource.In",{inCount:d,in:t.In}),t.In?.forEach(u=>{this.endpoints.addEndpoint(i,u,!0,e)}),t.In){let u=this.#t.buildTargetDef(e.EntityGuid);u.maxConnections=-1,this.#e.makeTarget(i,u)}}a.end()}};var nn=["domRoot"],on=["domDataSource"],an=(n,a,e)=>({top:n,left:a,"min-width":e}),rn=n=>({"show-details":n});function sn(n,a){if(n&1){let e=T();r(0,"mat-icon",16),h("click",function(){v(e);let t=p().$implicit,o=p(3);return S(o.configureDataSource(t))}),l(1," settings "),s()}}function ln(n,a){if(n&1){let e=T();r(0,"mat-icon",17),h("click",function(){v(e);let t=p().$implicit,o=p(3);return S(o.openHelp(o.typeInfos()[t.EntityGuid].HelpLink))}),l(1," help_outline "),s()}}function cn(n,a){if(n&1){let e=T();r(0,"mat-icon",18),h("click",function(){v(e);let t=p().$implicit,o=p(3);return S(o.remove(t))}),l(1," delete "),s()}}function dn(n,a){if(n&1&&(r(0,"tr",21)(1,"td",22),l(2),s(),r(3,"td",23),l(4),s()()),n&2){let e=a.$implicit;c(),g("title",e.name),c(),_(e.name),c(),g("title",e.value),c(),_(e.value)}}function pn(n,a){if(n&1&&(R(0,"hr",19),r(1,"table",20),b(2,dn,5,4,"tr",21,k),s()),n&2){let e=p().$implicit,i=p(3);c(2),E(i.visQuerySvc.dataSourceConfigs()[e.EntityId])}}function un(n,a){n&1&&R(0,"div",14)}function mn(n,a){n&1&&R(0,"div",15)}function fn(n,a){if(n&1){let e=T();r(0,"div",3,1)(2,"div",4)(3,"mat-icon",5),l(4),s(),m(5,sn,2,0,"mat-icon",6),m(6,ln,2,0,"mat-icon",7),s(),r(7,"div",8),m(8,cn,2,0,"mat-icon",9),s(),r(9,"div",10),h("click",function(){let t=v(e).$implicit,o=p(3);return S(o.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&o.editName(t))}),r(10,"span"),l(11),s(),r(12,"mat-icon",11),l(13,"edit"),s()(),R(14,"br"),r(15,"div",12),h("click",function(){let t=v(e).$implicit,o=p(3);return S(o.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&o.editDescription(t))}),r(16,"span"),l(17),s(),r(18,"mat-icon",11),l(19,"edit"),s()(),R(20,"br"),m(21,pn,4,0),r(22,"div",13),l(23),s(),m(24,un,1,0,"div",14),m(25,mn,1,0,"div",15),s()}if(n&2){let e,i,t=a.$implicit,o=p(3);g("id",o.domIdOfGuid(t.EntityGuid))("ngStyle",rt(15,an,t.VisualDesignerData.Top+"px",t.VisualDesignerData.Left+"px",t.VisualDesignerData.Width?t.VisualDesignerData.Width+"px":null))("ngClass",W(19,rn,o.showDataSourceDetails()&&((e=o.visQuerySvc.dataSourceConfigs()[t.EntityId])==null?null:e.length))),c(3),g("title",o.typeInfos()[t.EntityGuid].UiHint),c(),N(" ",o.typeInfos()[t.EntityGuid].Icon," "),c(),f(o.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&o.typeInfos()[t.EntityGuid].EnableConfig?5:-1),c(),f(o.typeInfos()[t.EntityGuid].HelpLink?6:-1),c(2),f(o.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&!o.isOutDataSource(t)?8:-1),c(3),_(t.Name||"(no name)"),c(6),_(t.Description),c(4),f(o.showDataSourceDetails()&&((i=o.visQuerySvc.dataSourceConfigs()[t.EntityId])!=null&&i.length)?21:-1),c(),g("title",t.PartAssemblyAndType),c(),N("Type: ",o.getTypeName(t.PartAssemblyAndType)),c(),f(o.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&o.typeInfos()[t.EntityGuid].DynamicOut?24:-1),c(),f(o.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&o.typeInfos()[t.EntityGuid].DynamicIn?25:-1)}}function hn(n,a){if(n&1&&b(0,fn,26,21,"div",3,k),n&2){let e=p(2);E(e.visQuerySvc.pipelineModel().DataSources)}}function gn(n,a){if(n&1&&(r(0,"div",2,0),m(2,hn,2,0),s()),n&2){let e=p();c(2),f(e.hardReset?-1:2)}}var _n={all:!1,ngAfterViewInit:!1},yn="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js",We=(()=>{class n extends Pe{#e;#t;#i;constructor(e,i,t,o){super(),this.visQuerySvc=e,this.changeDetectorRef=i,this.matDialog=t,this.viewContainerRef=o,this.log=P({PlumbEditorComponent:n},_n),this.domIdOfGuid=M,this.hardReset=!1,this.#t=new Ke(!1),this.#i=q(ke),this.showDataSourceDetails=fe(()=>(le.tryParse(this.visQuerySvc.pipelineModel()?.Pipeline.VisualDesignerData)??{}).ShowDataSourceDetails??!1),this.typeInfos=fe(()=>ti(this.visQuerySvc.pipelineModel()?.DataSources??[],this.visQuerySvc.dataSources()))}ngOnInit(){Nt([{test:"jsPlumb",src:yn}],()=>{this.#t.next(!0)}),this.subscriptions.add(this.visQuerySvc.putEntityCountOnConnections$.subscribe(e=>{this.#e.lineDecorator.addEntityCount(e)}))}ngAfterViewInit(){let e=this.log.fnIf("ngAfterViewInit"),i=this.domDataSourcesRef.changes.pipe(ge(()=>!0));this.subscriptions.add(Ze([this.#t,i]).subscribe(([t,o])=>{!t||!o||(e.a("scriptLoaded and domDataSourcesLoaded",{scriptLoaded:t,domDataSourcesLoaded:o}),this.#e?.destroy(),this.#e=new Ge(this.domRootRef.nativeElement,this.visQuerySvc.pipelineModel(),this.visQuerySvc.dataSources(),()=>this.onConnectionsChanged(),this.onDragend.bind(this),this.onDebugStream.bind(this),{matDialog:this.matDialog,viewContainerRef:this.viewContainerRef,changeDetectorRef:this.changeDetectorRef,onConnectionsChanged:()=>this.onConnectionsChanged()}))})),e.end()}ngOnDestroy(){this.#e?.destroy(),this.#t.complete(),super.ngOnDestroy()}onConnectionsChanged(){let e=this.#e.connections.getAll(),i=this.#e.getStreamsOut();this.visQuerySvc.changeConnections(e,i)}onDragend(e,i){this.visQuerySvc.changeDataSourcePosition(e,i)}onDebugStream(e){this.visQuerySvc.debugStream(e)}configureDataSource(e){if(e.EntityGuid.includes("unsaved"))return this.visQuerySvc.saveAndRun(!0,!1);this.visQuerySvc.editDataSource(e)}getTypeName(e){let i=O(this.visQuerySvc.dataSources(),e);return this.#i.typeNameFilter(i?.TypeNameForUi||e,"className")}isOutDataSource(e){return e.PartAssemblyAndType===I.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(e){if(!confirm(`Delete ${e.Name} data source?`))return;this.#e.removeAllEndpoints(e.EntityGuid);let i=this.#e.connections.getAll(),t=this.#e.getStreamsOut();this.visQuerySvc.removeDataSource(e.EntityGuid,i,t)}openHelp(e){window.open(e,"_blank")}editName(e){let i=prompt("Rename data source",e.Name)?.trim();i==null||i===""||this.visQuerySvc.renameDataSource(e.EntityGuid,i)}editDescription(e){let i=prompt("Edit description",e.Description)?.trim();i!=null&&this.visQuerySvc.changeDataSourceDescription(e.EntityGuid,i)}static{this.\u0275fac=function(i){return new(i||n)(y(V),y(te),y(be),y(ye))}}static{this.\u0275cmp=A({type:n,selectors:[["app-plumb-editor"]],viewQuery:function(i,t){if(i&1&&ve(nn,5)(on,5),i&2){let o;ue(o=me())&&(t.domRootRef=o.first),ue(o=me())&&(t.domDataSourcesRef=o)}},features:[Ce],decls:1,vars:1,consts:[["domRoot",""],["domDataSource",""],["id","pipeline-root"],[1,"dataSource",3,"id","ngStyle","ngClass"],[1,"actions","left"],[1,"type-info",3,"title"],["title","Configure data source","appMousedownStopPropagation","",1,"configure"],["title","Help for this data source","appMousedownStopPropagation","",1,"help"],[1,"actions","right"],["title","Delete","appMousedownStopPropagation","",1,"delete"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"]],template:function(i,t){i&1&&m(0,gn,3,1,"div",2),i&2&&f(t.visQuerySvc.pipelineModel()?0:-1)},dependencies:[st,ie,L,Q,Qt],styles:[`[_nghost-%COMP%]{display:block;width:100%;height:100%}
/*# sourceMappingURL=plumb-editor-KNRKWQ4J.css.map */`]})}}return n})();function di(n,a){if(!n)return[];let e=[];try{let i=n.Pipeline.Params?.split(/\r?\n/)||[],t=n.Pipeline.TestParameters?.split(/\r?\n/)||[];i.forEach(o=>{if(o=o?.trim(),!o)return;/^[a-zA-Z0-9]+=(.*)$/gmi.test(o)||e.push(`
          A <em>Query Parameter</em> seems wrong: <br>
          <code>${o}</code> <br>
          It should use the syntax: <br>
          <code>key=value</code> <br>
          or resolve to a token like: <br>
          <code>key=[source:key]</code>
        `)}),t.forEach(o=>{if(o=o?.trim(),!o)return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gmi.test(o)||e.push(`
          A <em>Test Parameter</em> seems wrong: <br>
          <code>${o}</code> <br>
          It should use the syntax: <br>
          <code>[source:key]=value</code>
        `);let w=/^\[module:id\]=([0-9]*)$/gmi.exec(o);if(w){let x=w[1],U=a.moduleId?.toString();x!==U&&e.push(`
            Your test ModuleId (${x}) is different from the current ModuleId (${U}).<br>
            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it
          `)}/^\[module:moduleid\]=([0-9]*)$/gmi.exec(o)&&e.push(`
          You are using deprecated [Module:ModuleId] test parameter.<br>
          Please use [Module:Id]
        `)})}catch(i){console.error("Something went wrong in calculateWarnings for params",i)}return e}function vn(n,a){if(n&1&&(r(0,"li"),l(1),s()),n&2){let e=a.$implicit;c(),N(" ",e," ")}}function Sn(n,a){if(n&1&&(r(0,"ul",9),b(1,vn,2,1,"li",null,k),s()),n&2){let e,i=p(2);c(),E((e=i.vsSvc.pipelineModel().Pipeline.Params)==null?null:e.split(`
`))}}function xn(n,a){if(n&1&&(r(0,"li"),l(1),s()),n&2){let e=a.$implicit;c(),N(" ",e," ")}}function Dn(n,a){if(n&1&&(r(0,"ul",9),b(1,xn,2,1,"li",null,k),s()),n&2){let e,i=p(2);c(),E((e=i.vsSvc.pipelineModel().Pipeline.TestParameters)==null?null:e.split(`
`))}}function bn(n,a){if(n&1){let e=T();r(0,"div",5)(1,"span",12),l(2,"Show DataSource Params"),s(),r(3,"mat-slide-toggle",13),h("change",function(t){v(e);let o=p(2);return S(o.showDataSourceDetails(t))}),s()()}if(n&2){let e=p(2);c(3),g("checked",e.visualDesignerDataSig().ShowDataSourceDetails)}}function En(n,a){if(n&1&&R(0,"li",16),n&2){let e=a.$implicit;g("innerHTML",e,nt)}}function In(n,a){if(n&1&&(r(0,"div",14)(1,"div",6)(2,"span"),l(3,"Warnings"),s(),r(4,"mat-icon",15),l(5,"warning"),s()(),r(6,"ol",9),b(7,En,1,1,"li",16,k),s()()),n&2){let e=p(3);c(7),E(e.warningSig())}}function Mn(n,a){if(n&1&&m(0,In,9,0,"div",14),n&2){let e=p(2);f(e.warningSig().length?0:-1)}}function Pn(n,a){if(n&1&&(r(0,"div",10)(1,"div",6),l(2,"Query Description"),s(),r(3,"div"),l(4),s()()),n&2){let e=p(2);c(4),_(e.vsSvc.pipelineModel().Pipeline.Description)}}function wn(n,a){if(n&1){let e=T();r(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),h("click",function(){v(e);let t=p();return S(t.saveAndRunQuery(!0,!0))}),l(4," Save and run "),s(),r(5,"button",4),h("click",function(){v(e);let t=p();return S(t.saveAndRunQuery(!1,!0))}),l(6," Run "),s(),r(7,"button",4),h("click",function(){v(e);let t=p();return S(t.saveAndRunQuery(!0,!1))}),l(8," Save "),s()(),r(9,"div",5)(10,"div",6)(11,"div"),l(12,"Query Parameters"),s(),r(13,"div")(14,"button",7),h("click",function(){v(e);let t=p();return S(t.editPipeline())}),r(15,"mat-icon"),l(16,"edit"),s()(),r(17,"button",8),h("click",function(){v(e);let t=p();return S(t.openParamsHelp())}),r(18,"mat-icon"),l(19,"info"),s()()()(),m(20,Sn,3,0,"ul",9),s(),r(21,"div",5)(22,"div",6),l(23,"Test Parameters"),s(),m(24,Dn,3,0,"ul",9),s(),m(25,bn,4,1,"div",5),m(26,Mn,1,1),m(27,Pn,5,1,"div",10),r(28,"div",11)(29,"button",4),h("click",function(){v(e);let t=p();return S(t.openRestApi())}),r(30,"span"),l(31,"Use in JSON / REST API"),s(),r(32,"mat-icon"),l(33,"code_curly"),s()()()()()}if(n&2){let e,i,t=p();c(20),f((e=t.vsSvc.pipelineModel().Pipeline.Params)!=null&&e.length?20:-1),c(4),f((i=t.vsSvc.pipelineModel().Pipeline.TestParameters)!=null&&i.length?24:-1),c(),f(t.visualDesignerDataSig()?25:-1),c(),f(t.warningSig()?26:-1),c(),f(t.vsSvc.pipelineModel().Pipeline.Description?27:-1)}}var pi=(()=>{class n{#e;constructor(e,i){this.context=e,this.vsSvc=i,this.warningSig=H(di(this.vsSvc?.pipelineModel()??null,this.context)),this.visualDesignerDataSig=H(le.tryParse(this.vsSvc?.pipelineModel()?.Pipeline.VisualDesignerData)??{}),this.#e=q(we)}editPipeline(){this.vsSvc.editPipelineEntity()}openParamsHelp(){window.open("https://go.2sxc.org/QueryParams","_blank")}saveAndRunQuery(e,i){this.vsSvc.saveAndRun(e,i)}showDataSourceDetails(e){this.vsSvc.showDataSourceDetails(e.checked)}openRestApi(){let e=this.vsSvc.pipelineModel().Pipeline.EntityGuid;this.#e.navRelative([ei.getUrlQueryDialog(e)])}static{this.\u0275fac=function(i){return new(i||n)(y(De),y(V))}}static{this.\u0275cmp=A({type:n,selectors:[["app-run-explorer"]],decls:1,vars:1,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","",1,"eav-action-button","action",2,"border","1px #adadad solid",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],[1,"values"],[1,"description"],[1,"footer-actions"],[1,"eav-slide-toggle-label"],["color","primary",3,"change","checked"],[1,"warnings"],[2,"color","red"],[3,"innerHTML"]],template:function(i,t){i&1&&m(0,wn,34,5,"div",0),i&2&&f(t.vsSvc.pipelineModel()?0:-1)},dependencies:[Z,ne,K,L,Q,se,re],styles:[`.wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}.eav-slide-toggle-label[_ngcontent-%COMP%]{margin-right:4px;font-size:14px}
/*# sourceMappingURL=run-explorer-55KX3UC4.css.map */`]})}}return n})();var ui=n=>({active:n}),ns=(()=>{class n{constructor(e,i,t){this.context=e,this.route=i,this.visualQueryService=t,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(e){this.activeExplorer=this.activeExplorer===e?null:e}openHelp(){window.open("https://go.2sxc.org/visual-query","_blank")}static{this.\u0275fac=function(i){return new(i||n)(y(De),y(ct),y(V))}}static{this.\u0275cmp=A({type:n,selectors:[["app-visual-query"]],viewQuery:function(i,t){if(i&1&&ve(We,5),i&2){let o;ue(o=me())&&(t.plumbEditor=o.first)}},features:[at([V])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"click","ngClass"],["tippy","Add",1,"button",3,"click","ngClass"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(i,t){i&1&&(R(0,"router-outlet"),r(1,"div",0)(2,"div",1)(3,"div",2),h("click",function(){return t.toggleExplorer(t.explorer.run)}),r(4,"mat-icon"),l(5,"play_arrow"),s()(),r(6,"div",3),h("click",function(){return t.toggleExplorer(t.explorer.add)}),r(7,"mat-icon"),l(8,"add"),s()(),R(9,"div",4),r(10,"div",5),h("click",function(){return t.openHelp()}),r(11,"mat-icon"),l(12,"help_outline"),s()()(),R(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),s()),i&2&&(c(3),g("ngClass",W(4,ui,t.activeExplorer===t.explorer.run)),c(3),g("ngClass",W(6,ui,t.activeExplorer===t.explorer.add)),c(7),g("hidden",t.activeExplorer!==t.explorer.run),c(),g("hidden",t.activeExplorer!==t.explorer.add))},dependencies:[dt,ie,L,Q,pi,ri,We],styles:[`.editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}
/*# sourceMappingURL=visual-query-45P4HZ7I.css.map */`]})}}return n})();export{ns as VisualQueryComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/visual-query-V5SYZVPQ.js.map
