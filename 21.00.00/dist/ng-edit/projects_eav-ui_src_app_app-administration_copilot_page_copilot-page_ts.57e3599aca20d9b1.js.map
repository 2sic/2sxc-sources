{"version":3,"file":"projects_eav-ui_src_app_app-administration_copilot_page_copilot-page_ts.57e3599aca20d9b1.js","mappings":"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","names":["CopilotService","this","webApiEditions","webApiGeneratedCode","constructor","http","context","log","classLog","specs","#getCopilotSpecs","getEditions","pipe","map","data","editions","getDefaultEdition","find","e","isDefault","getGenerators","generators","get","_a","params","appId","toString","defaultOrFirst","#findDefaultEdition","d","description","label","name","replace","shareReplay","i0","i1","i2","factory","ɵfac","generator_r3","version","ctx","descriptionHtml","$event","_r1","ctx_r1","selectedGenerator","CopilotGeneratorComponent_Conditional_9_For_7_Template","CopilotGeneratorComponent_Conditional_9_Conditional_8_Template","sort","tmp_5_0","selectedGenerator$","edition_r5","_r4","selectedEdition","CopilotGeneratorComponent_Conditional_12_For_5_Template","entity_r7","Title","CopilotGeneratorComponent_Conditional_15_Conditional_8_For_1_Template","_forTrack0","_r8","deleteConfiguration","_r6","selectedEntity","CopilotGeneratorComponent_Conditional_15_Conditional_8_Template","editConfig","CopilotGeneratorComponent_Conditional_15_Conditional_15_Template","undefined","tmp_3_0","entities$","CopilotGeneratorComponent","outputType","input","title","#copilotSvc","transient","#entitySvc","EntityService","#dialogRouter","DialogRoutingService","#matDialog","MatDialog","#snackBar","MatSnackBar","#context","Context","#http","HttpClient","#viewContainerRef","inject","ViewContainerRef","#copilotConfigurationGuid","editions$","showConfigurationDropdown","signal","generators$","gens","filter","g","ngOnInit","take","subscribe","fetchEntities","doOnDialogClosed","getEntities$","of","contentTypeName","form","items","EditPrep","editId","Id","newFromType","url","convertFormToUrl","navRelative","selected","open","ConfirmDeleteDialogComponent","autoFocus","entityId","entityTitle","message","hasDeleteSnackbar","viewContainerRef","width","afterClosed","isConfirmed","delete","next","duration","error","console","toggleConfigurationDropdown","set","autoGeneratedCode","edition","generator","configurationId","timeTaken","selectors","inputs","decls","vars","consts","template","rf","CopilotGeneratorComponent_Conditional_9_Template","CopilotGeneratorComponent_Conditional_12_Template","CopilotGeneratorComponent_Conditional_15_Template","tmp_2_0","MatSelectModule","MatButtonModule","i3","MatCardModule","i4","MatIconModule","i5","CommonModule","i6","styles","CopilotPageComponent","activatedRoute","snapshot","heading","intro","RouterOutlet"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/copilot/copilot-service.ts","./projects/eav-ui/src/app/app-administration/copilot/copilot-generator.html","./projects/eav-ui/src/app/app-administration/copilot/copilot-generator.ts","./projects/eav-ui/src/app/app-administration/copilot/page/copilot-page.ts","./projects/eav-ui/src/app/app-administration/copilot/page/copilot-page.html"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Context } from '../../shared/services/context';\r\nimport { EditionData, EditionDataDto } from './edition-data';\r\nimport { map, shareReplay } from 'rxjs';\r\nimport { Edition, EditionDto } from './edition';\r\nimport { classLog } from '../../shared/logging';\r\n\r\n@Injectable()\r\nexport class CopilotService {\r\n  \r\n  log = classLog({CopilotService});\r\n\r\n  static webApiEditions: string = 'admin/code/getEditions';\r\n  static webApiGeneratedCode: string = 'admin/code/generateDataModels';\r\n\r\n  public specs = this.#getCopilotSpecs();\r\n\r\n  constructor(private http: HttpClient, private context: Context) { }\r\n\r\n  getEditions() {\r\n    return this.specs.pipe(map(data => data.editions));\r\n  }\r\n\r\n  getDefaultEdition() {\r\n    return this.specs.pipe(map(data => data.editions.find(e => e.isDefault)));\r\n  }\r\n\r\n  getGenerators() {\r\n    return this.specs.pipe(map(data => data.generators));\r\n  }\r\n\r\n  #getCopilotSpecs() {\r\n    return this.http.get<EditionDataDto>(CopilotService.webApiEditions, {\r\n      params: {\r\n        appId: this.context.appId.toString()\r\n      }\r\n    }).pipe(\r\n      map((data) => {\r\n        const defaultOrFirst = this.#findDefaultEdition(data.editions);\r\n        const editions = data.editions.map(d => {\r\n          const isDefault = d == defaultOrFirst;\r\n          return {\r\n            ...d,\r\n            isDefault,\r\n            description: (d.description || \"no description provided\") + (isDefault ? ' ✅' : ''),\r\n            label: `/${d.name}/AppCode/Data`.replace(/\\/\\//g, '/'),\r\n          } as Edition;\r\n        });\r\n\r\n        return { ...data, editions } as EditionData;\r\n      }),\r\n      shareReplay(1),\r\n    );\r\n  }\r\n\r\n  #findDefaultEdition(editions: EditionDto[]): EditionDto {\r\n    return editions.find(d => d.isDefault) ?? editions.find(d => d.name === '') ?? editions[0];\r\n  }\r\n\r\n}","<div class=\"eav-cards-box\" [class.eav-cards-box-expanded]=\"showConfigurationDropdown()\">\r\n  <mat-card class=\"eav-card\">\r\n    <mat-card-header class=\"eav-card-header\">\r\n      <mat-card-title>{{ title() }}</mat-card-title>\r\n      <mat-icon>support_agent</mat-icon>\r\n    </mat-card-header>\r\n    <mat-card-content>\r\n      <br />\r\n      <!-- Generator select -->\r\n      @if (generators$ | async; as generators) {\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Generator</mat-label>\r\n          <mat-select required [(value)]=\"selectedGenerator\">\r\n            <mat-select-trigger>\r\n              {{ selectedGenerator }}\r\n            </mat-select-trigger>\r\n            @for (generator of generators.sort(); track generator) {\r\n              <mat-option [value]=\"generator.name\">\r\n                <strong>{{ generator.name }} v{{ generator.version }}</strong\r\n                ><br />\r\n                {{ generator.description }}\r\n              </mat-option>\r\n            }\r\n          </mat-select>\r\n          @if (selectedGenerator$ | async; as selectedGenerator) {\r\n            <mat-hint [innerHTML]=\"selectedGenerator.descriptionHtml\"></mat-hint>\r\n          }\r\n        </mat-form-field>\r\n        <br />\r\n      }\r\n\r\n      <br />\r\n      <!-- Edition select -->\r\n      @if (editions$ | async; as editions) {\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Select an Edition to generate code for</mat-label>\r\n          <mat-select required [(value)]=\"selectedEdition\">\r\n            @for (edition of editions.sort(); track edition) {\r\n              <mat-option [value]=\"edition.name\">\r\n                <strong>{{ edition.label }}</strong> ({{ edition.description }})\r\n              </mat-option>\r\n            }\r\n          </mat-select>\r\n          <mat-hint>\r\n            Editions are managed in the <code>/App_Data/app.json</code> file. See\r\n            <a href=\"https://go.2sxc.org/app-json\" target=\"_blank\">docs</a>.\r\n          </mat-hint>\r\n        </mat-form-field>\r\n      }\r\n\r\n      <br />\r\n      <!-- Configurations select -->\r\n      @if (showConfigurationDropdown()) {\r\n        <br />\r\n\r\n        <div class=\"configuration-select\">\r\n          <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n            <mat-label>Select a Configuration</mat-label>\r\n            <mat-select [(value)]=\"selectedEntity\">\r\n              <mat-option [value]=\"undefined\">\r\n                Empty (press + to create new)\r\n              </mat-option>\r\n              @if (entities$ | async; as entities)\r\n              {\r\n                @for (entity of entities; track entity.Id)\r\n                {\r\n                  <mat-option [value]=\"entity\">\r\n                    {{ entity.Title }}\r\n                  </mat-option>\r\n                }\r\n              }\r\n            </mat-select>\r\n            <mat-hint>\r\n              Reusable configuration for the Data Copilot generator.\r\n            </mat-hint>\r\n          </mat-form-field>\r\n\r\n          <!-- Add / edit button -->\r\n          <button\r\n            mat-icon-button\r\n            class=\"eav-icon\"\r\n            aria-label=\"Create\"\r\n            (click)=\"editConfig()\"\r\n          >\r\n            <mat-icon>{{ selectedEntity ? \"edit\" : \"add\" }}</mat-icon>\r\n          </button>\r\n          \r\n          <!-- Delete button -->\r\n          @if (selectedEntity)\r\n          {\r\n            <button\r\n              mat-icon-button\r\n              class=\"eav-icon\"\r\n              aria-label=\"Delete\"\r\n              (click)=\"deleteConfiguration()\"\r\n            >\r\n              <mat-icon>delete</mat-icon>\r\n            </button>\r\n          }\r\n\r\n        </div>\r\n      }\r\n\r\n    </mat-card-content>\r\n    <div class=\"eav-card-space-div\"></div>\r\n    <mat-card-actions align=\"end\">\r\n      <button mat-button class=\"eav-button__with-icon\" (click)=\"toggleConfigurationDropdown()\">\r\n        <mat-icon class=\"eav-icon\">discover_tune</mat-icon>\r\n        <span>Use Configuration</span>\r\n      </button>\r\n      <button mat-button class=\"eav-button__with-icon\" (click)=\"autoGeneratedCode()\">\r\n        <mat-icon class=\"eav-icon\">code</mat-icon>\r\n        <span>Generate Code</span>\r\n      </button>\r\n    </mat-card-actions>\r\n  </mat-card>\r\n</div>\r\n","import { CommonModule } from '@angular/common';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Component, inject, input, signal, ViewContainerRef } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { EntityLightIdentifier } from 'projects/edit-types/src/EntityLight';\r\nimport { map, Observable, of, take } from 'rxjs';\r\nimport { transient } from '../../../../../core';\r\nimport { convertFormToUrl } from '../../shared/helpers/url-prep.helper';\r\nimport { EditForm, EditPrep } from '../../shared/models/edit-form.model';\r\nimport { RichResult } from '../../shared/models/rich-result';\r\nimport { DialogRoutingService } from '../../shared/routing/dialog-routing.service';\r\nimport { Context } from '../../shared/services/context';\r\nimport { EntityService } from '../../shared/services/entity.service';\r\nimport { ConfirmDeleteDialogComponent } from '../sub-dialogs/confirm-delete-dialog/confirm-delete-dialog';\r\nimport { ConfirmDeleteDialogData } from '../sub-dialogs/confirm-delete-dialog/confirm-delete-dialog.models';\r\nimport { CopilotService } from './copilot-service';\r\n\r\ntype DataCopilotConfiguration = {\r\n  Guid: string;\r\n  Id: number;\r\n  Title?: string;\r\n};\r\n\r\n@Component({\r\n  selector: 'app-copilot-generator',\r\n  templateUrl: './copilot-generator.html',\r\n  styleUrls: ['./copilot-generator.scss'],\r\n  imports: [\r\n    MatSelectModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatIconModule,\r\n    CommonModule,\r\n  ]\r\n})\r\nexport class CopilotGeneratorComponent {\r\n\r\n  outputType = input<string>();\r\n  title? = input<string>('Copilot Generator');\r\n\r\n  #copilotSvc = transient(CopilotService);\r\n  #entitySvc = transient(EntityService);\r\n  #dialogRouter = transient(DialogRoutingService);\r\n  #matDialog = transient(MatDialog);\r\n  #snackBar = transient(MatSnackBar);\r\n  #context = transient(Context);\r\n  #http = transient(HttpClient);\r\n\r\n  #viewContainerRef = inject(ViewContainerRef);\r\n\r\n  readonly #copilotConfigurationGuid = 'b08dcd23-2eb0-4a5e-a3d0-3178d2aae451';\r\n\r\n  webApiGeneratedCode: string = 'admin/code/generateDataModels';\r\n  editions$ = this.#copilotSvc.getEditions();\r\n\r\n  showConfigurationDropdown = signal(false);\r\n\r\n  entities$: Observable<EntityLightIdentifier[]>;\r\n  selectedEntity?: DataCopilotConfiguration;\r\n\r\n  generators$ = this.#copilotSvc.getGenerators()\r\n    .pipe(\r\n      map((gens) => gens.filter(g => g.outputType === this.outputType()))\r\n    );\r\n\r\n  selectedGenerator$ = this.generators$.pipe(map(gens => gens.find(g => g.name === this.selectedGenerator)));\r\n\r\n  selectedGenerator = '';\r\n  selectedEdition = '';\r\n\r\n  ngOnInit(): void {\r\n    this.generators$.pipe(take(1)).subscribe(gens => {\r\n      this.selectedGenerator = gens[0]?.name ?? '';\r\n    });\r\n    this.#copilotSvc.specs.pipe(take(1)).subscribe(specs => {\r\n      this.selectedEdition = specs.editions.find(e => e.isDefault)?.name ?? '';\r\n    });\r\n    this.fetchEntities();\r\n\r\n    // Subscribe to route changes to refresh entities when dialog closes\r\n    this.#dialogRouter.doOnDialogClosed(() => this.fetchEntities());\r\n  }\r\n\r\n  fetchEntities() {\r\n    this.entities$ = this.#entitySvc.getEntities$(of({ contentTypeName: this.#copilotConfigurationGuid }));\r\n  }\r\n\r\n\r\n  editConfig() {\r\n    const form: EditForm = {\r\n      items: [this.selectedEntity\r\n        ? EditPrep.editId(this.selectedEntity.Id)\r\n        : EditPrep.newFromType(this.#copilotConfigurationGuid)\r\n      ]\r\n    };\r\n\r\n    const url = convertFormToUrl(form);\r\n    this.#dialogRouter.navRelative([`edit/${url}`]); //\r\n  }\r\n\r\n  deleteConfiguration() {\r\n    const selected = this.selectedEntity;\r\n    const data: ConfirmDeleteDialogData = {\r\n      entityId: selected.Id,\r\n      entityTitle: selected.Title,\r\n      message: \"Are you sure you want to delete?  \",\r\n      hasDeleteSnackbar: true\r\n    };\r\n\r\n    const confirmationDialogRef = this.#matDialog.open(ConfirmDeleteDialogComponent, {\r\n      autoFocus: false,\r\n      data,\r\n      viewContainerRef: this.#viewContainerRef,\r\n      width: '400px',\r\n    });\r\n\r\n    confirmationDialogRef.afterClosed().subscribe((isConfirmed: boolean) => {\r\n      if (isConfirmed) {\r\n        this.#entitySvc.delete(\r\n          this.#context.appId,           // appId: number\r\n          this.#copilotConfigurationGuid,// contentType: string\r\n          selected.Id,                   // entityId: number\r\n          false                          // force: boolean\r\n        ).subscribe({\r\n          next: () => {\r\n            this.#snackBar.open('Deleted', null, { duration: 2000 });\r\n            this.fetchEntities();\r\n          },\r\n          error: (error) => {\r\n            console.error('Error deleting configuration:', error);\r\n            this.#snackBar.open('Error deleting configuration', null, { duration: 3000 });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  toggleConfigurationDropdown() {\r\n    this.showConfigurationDropdown.set(!this.showConfigurationDropdown());\r\n  }\r\n\r\n  autoGeneratedCode() {\r\n    this.#http.get<RichResult>(this.webApiGeneratedCode, {\r\n      params: {\r\n        appId: this.#context.appId,\r\n        edition: this.selectedEdition,\r\n        generator: this.selectedGenerator,\r\n        ...(this.selectedEntity ? { configurationId: this.selectedEntity.Id } : {}),\r\n      }\r\n    }).subscribe(d => {\r\n      this.#snackBar.open(d.message + `\\n (this took ${d.timeTaken}ms)`, null, { duration: 5000, });\r\n    });\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\r\nimport { ActivatedRoute, RouterOutlet } from '@angular/router';\r\nimport { CopilotGeneratorComponent } from '../copilot-generator';\r\nimport { CopilotSpec } from '../copilot-specs';\r\n\r\n@Component({\r\n  selector: 'app-data-copilot',\r\n  templateUrl: './copilot-page.html',\r\n  styleUrl: './copilot-page.scss',\r\n  imports: [\r\n    CopilotGeneratorComponent,\r\n    RouterOutlet,\r\n  ]\r\n})\r\nexport class CopilotPageComponent {\r\n\r\n  data: CopilotSpec;\r\n\r\n  constructor(activatedRoute: ActivatedRoute) {\r\n    this.data = activatedRoute.snapshot.data as CopilotSpec;\r\n  }\r\n}\r\n","<div class=\"outer-container\">\r\n  <h1>{{ data.heading }}</h1>\r\n  <p>\r\n    {{ data.intro }}\r\n  </p>\r\n</div>\r\n\r\n<app-copilot-generator\r\n  [outputType]=\"data.outputType\"\r\n  [title]=\"data.title\"\r\n></app-copilot-generator>\r\n\r\n<router-outlet></router-outlet>"],"x_google_ignoreList":[]}