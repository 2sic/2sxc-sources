{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/routing/dialog-in-new-window.service.ts"],
  "sourcesContent": ["import { inject, Injectable } from '@angular/core';\r\nimport { DialogTypeConstants } from '../constants/dialog-type.constants';\r\n// tslint:disable-next-line:max-line-length\r\nimport { keyAppId, keyContentBlockId, keyDebug, keyDialog, keyExtras, keyIsShared, keyItems, keyModuleId, keyPartOfPage, keyUrl, keyZoneId, prefix } from '../constants/session.constants';\r\nimport { EditPrep, ViewOrFileIdentifier } from '../models/edit-form.model';\r\nimport { Context } from '../services/context';\r\nimport { ExtrasParam } from './dialog-url-params.model';\r\n\r\n/**\r\n * Service to open dialogs in a new window.\r\n */\r\n@Injectable()\r\nexport class DialogInNewWindowService {\r\n\r\n  protected context = inject(Context);\r\n\r\n  openCodeFile(path: string, isShared: boolean, templateId?: number) {\r\n    const form = {\r\n      items: [{\r\n        Path: path,\r\n        ...(templateId != null && EditPrep.editId(templateId)),\r\n      }] as ViewOrFileIdentifier[]\r\n    };\r\n\r\n    const hashParams: Record<string, string> = {\r\n      ...this.#buildHashParam(keyDialog, DialogTypeConstants.Develop),\r\n      ...this.#buildHashParam(keyIsShared, isShared.toString()),\r\n      ...this.#buildHashParam(keyItems, JSON.stringify(form.items)),\r\n    };\r\n    const url = this.#buildFullUrl(hashParams);\r\n    window.open(url, '_blank');\r\n  }\r\n\r\n  openAppAdministration(zoneId: number, appId: number, tab?: string, scope?: string) {\r\n    const extras: ExtrasParam = {\r\n      ...(tab && { tab }),\r\n      ...(scope && { scope }),\r\n    };\r\n    const hashParams: Record<string, string> = {\r\n      ...this.#buildHashParam(keyZoneId, zoneId.toString()),\r\n      ...this.#buildHashParam(keyAppId, appId.toString()),\r\n      ...this.#buildHashParam(keyDialog, DialogTypeConstants.App),\r\n      ...(Object.keys(extras).length ? this.#buildHashParam(keyExtras, JSON.stringify(extras)) : ''),\r\n    };\r\n    const url = this.#buildFullUrl(hashParams);\r\n    window.open(url, '_blank');\r\n  }\r\n\r\n  /** A lot of the link is identical when opening the admin-dialogs in a new window */\r\n  #buildSharedHashParams() {\r\n    const hashParams: Record<string, string> = {\r\n      ...this.#buildHashParam(keyZoneId, this.context.zoneId),\r\n      ...this.#buildHashParam(keyAppId, this.context.appId),\r\n      ...this.#buildHashParam(keyModuleId, this.context.moduleId?.toString()),\r\n      ...this.#buildHashParam(keyContentBlockId, this.context.contentBlockId?.toString()),\r\n      ...this.#buildHashParam(keyPartOfPage),\r\n      ...(sessionStorage.getItem(keyDebug) ? this.#buildHashParam(keyDebug) : {}),\r\n    };\r\n    return hashParams;\r\n  }\r\n\r\n  /** Encodes param if necessary */\r\n  #buildHashParam(key: string, value?: number | string) {\r\n    const rawKey = key.replace(prefix, '');\r\n    const valueTemp = value ?? sessionStorage.getItem(key);\r\n    const rawValue = encodeURIComponent(valueTemp);\r\n    const hashParam: Record<string, string> = { [rawKey]: rawValue };\r\n    return hashParam;\r\n  }\r\n\r\n  /** Builds the full (ugly) url with all the hash parameters */\r\n  #buildFullUrl(hashParams: Record<string, string>) {\r\n    const oldHref = sessionStorage.getItem(keyUrl);\r\n    const oldUrl = new URL(oldHref);\r\n    const newHref = oldUrl.origin + oldUrl.pathname + oldUrl.search;\r\n\r\n    const allHashParams: Record<string, string> = {\r\n      ...this.#buildSharedHashParams(),\r\n      ...hashParams,\r\n    };\r\n    const hashUrl = Object.entries(allHashParams).reduce((acc, [key, value]) => `${acc}&${key}=${value}`, '').replace('&', '#');\r\n    return newHref + hashUrl;\r\n  }\r\n}\r\n"],
  "mappings": "sSAYA,IAAaA,GAAwB,IAAA,CAA/B,MAAOA,CAAwB,CADrCC,aAAA,CAGY,KAAAC,QAAUC,EAAOC,CAAO,EAElCC,aAAaC,EAAcC,EAAmBC,EAAmB,CAC/D,IAAMC,EAAO,CACXC,MAAO,CAACC,EAAA,CACNC,KAAMN,GACFE,GAAc,MAAQK,EAASC,OAAON,CAAU,EACrD,GAGGO,EAAqCJ,MAAA,GACtC,KAAKK,GAAgBC,EAAWC,EAAoBC,OAAO,GAC3D,KAAKH,GAAgBI,EAAab,EAASc,SAAQ,CAAE,GACrD,KAAKL,GAAgBM,EAAUC,KAAKC,UAAUf,EAAKC,KAAK,CAAC,GAExDe,EAAM,KAAKC,GAAcX,CAAU,EACzCY,OAAOC,KAAKH,EAAK,QAAQ,CAC3B,CAEAI,sBAAsBC,EAAgBC,EAAeC,EAAcC,EAAc,CAC/E,IAAMC,EAAsBvB,IAAA,GACtBqB,GAAO,CAAEA,IAAAA,CAAG,GACZC,GAAS,CAAEA,MAAAA,CAAK,GAEhBlB,EAAqCJ,QAAA,GACtC,KAAKK,GAAgBmB,EAAWL,EAAOT,SAAQ,CAAE,GACjD,KAAKL,GAAgBoB,EAAUL,EAAMV,SAAQ,CAAE,GAC/C,KAAKL,GAAgBC,EAAWC,EAAoBmB,GAAG,GACtDC,OAAOC,KAAKL,CAAM,EAAEM,OAAS,KAAKxB,GAAgByB,EAAWlB,KAAKC,UAAUU,CAAM,CAAC,EAAI,IAEvFT,EAAM,KAAKC,GAAcX,CAAU,EACzCY,OAAOC,KAAKH,EAAK,QAAQ,CAC3B,CAGAiB,IAAsB,CASpB,OAR2C/B,YAAA,GACtC,KAAKK,GAAgBmB,EAAW,KAAKjC,QAAQ4B,MAAM,GACnD,KAAKd,GAAgBoB,EAAU,KAAKlC,QAAQ6B,KAAK,GACjD,KAAKf,GAAgB2B,EAAa,KAAKzC,QAAQ0C,UAAUvB,SAAQ,CAAE,GACnE,KAAKL,GAAgB6B,EAAmB,KAAK3C,QAAQ4C,gBAAgBzB,SAAQ,CAAE,GAC/E,KAAKL,GAAgB+B,CAAa,GACjCC,eAAeC,QAAQC,CAAQ,EAAI,KAAKlC,GAAgBkC,CAAQ,EAAI,CAAA,EAG5E,CAGAlC,GAAgBmC,EAAaC,EAAuB,CAClD,IAAMC,EAASF,EAAIG,QAAQC,EAAQ,EAAE,EAC/BC,EAAYJ,GAASJ,eAAeC,QAAQE,CAAG,EAC/CM,EAAWC,mBAAmBF,CAAS,EAE7C,MAD0C,CAAE,CAACH,CAAM,EAAGI,CAAQ,CAEhE,CAGA/B,GAAcX,EAAkC,CAC9C,IAAM4C,EAAUX,eAAeC,QAAQW,CAAM,EACvCC,EAAS,IAAIC,IAAIH,CAAO,EACxBI,EAAUF,EAAOG,OAASH,EAAOI,SAAWJ,EAAOK,OAEnDC,EAAwCxD,IAAA,GACzC,KAAK+B,GAAsB,GAC3B3B,GAECqD,EAAU9B,OAAO+B,QAAQF,CAAa,EAAEG,OAAO,CAACC,EAAK,CAACpB,EAAKC,CAAK,IAAM,GAAGmB,CAAG,IAAIpB,CAAG,IAAIC,CAAK,GAAI,EAAE,EAAEE,QAAQ,IAAK,GAAG,EAC1H,OAAOS,EAAUK,CACnB,iDAtEWpE,EAAwB,CAAA,iCAAxBA,EAAwBwE,QAAxBxE,EAAwByE,SAAA,CAAA,CAAA,SAAxBzE,CAAwB,GAAA",
  "names": ["DialogInNewWindowService", "constructor", "context", "inject", "Context", "openCodeFile", "path", "isShared", "templateId", "form", "items", "__spreadValues", "Path", "EditPrep", "editId", "hashParams", "#buildHashParam", "keyDialog", "DialogTypeConstants", "Develop", "keyIsShared", "toString", "keyItems", "JSON", "stringify", "url", "#buildFullUrl", "window", "open", "openAppAdministration", "zoneId", "appId", "tab", "scope", "extras", "keyZoneId", "keyAppId", "App", "Object", "keys", "length", "keyExtras", "#buildSharedHashParams", "keyModuleId", "moduleId", "keyContentBlockId", "contentBlockId", "keyPartOfPage", "sessionStorage", "getItem", "keyDebug", "key", "value", "rawKey", "replace", "prefix", "valueTemp", "rawValue", "encodeURIComponent", "oldHref", "keyUrl", "oldUrl", "URL", "newHref", "origin", "pathname", "search", "allHashParams", "hashUrl", "entries", "reduce", "acc", "factory", "\u0275fac"]
}
