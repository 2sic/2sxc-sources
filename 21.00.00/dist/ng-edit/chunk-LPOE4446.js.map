{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/services/query.service.ts"],
  "sourcesContent": ["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { classLog } from '../logging';\r\nimport { QueryStreams } from '../models/query-stream.model';\r\nimport { Context } from './context';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  getAvailableEntities: false,\r\n  getEntities: false,\r\n};\r\n\r\n@Injectable()\r\nexport class QueryService {\r\n\r\n  log = classLog({QueryService}, logSpecs);\r\n\r\n  constructor(private http: HttpClient, private context: Context) { }\r\n\r\n  getFromQuery(queryUrl: string, params: string, fields: string, entitiesFilter?: string[]): Observable<QueryStreams> {\r\n    this.log.fnIf('getAvailableEntities', { queryUrl, params, fields, entitiesFilter });\r\n    // Check if any params we should auto-add are already set (like in a query which has these params set in the configuration)\r\n    const hasParams = !!params;\r\n    const paramsLower = params?.toLocaleLowerCase() ?? '';\r\n    const hasAppId = paramsLower.includes('appid=') ?? false;\r\n    const allParams = ''\r\n      + (hasAppId ? '' : `&appId=${this.context.appId}`)\r\n      + (hasParams ? `&${params}` : '')\r\n      + '&$select=' + (fields ?? '' /* special catch to avoid the word \"null\" */);\r\n    // trim initial & because it will always start with an & and it should't\r\n    const urlParams = allParams.substring(1);\r\n    return this.http.post<QueryStreams>(`app/auto/query/${queryUrl}?${urlParams}`,\r\n      {\r\n        Guids: entitiesFilter,\r\n      },\r\n    );\r\n  }\r\n\r\n  getEntities({ contentTypes, itemIds, fields, log }: { contentTypes: string[]; itemIds: string[]; fields: string; log: string }): Observable<QueryStreams> {\r\n    this.log.fnIf(`getEntities`, { log, contentTypes, itemIds, fields });\r\n    const allParams =\r\n      '&typeNames=' + (contentTypes?.join(',') ?? '')\r\n      + `&appId=${this.context.appId}`\r\n      + '&$select=' + (fields ?? '' /* special catch to avoid the word \"null\" */);\r\n    // trim initial & because it will always start with an & and it should't\r\n    const urlParams = allParams.substring(1);\r\n    return this.http.post<QueryStreams>(\r\n      `app/auto/query/System.EntityPicker/Default?${urlParams}`,\r\n      { Guids: itemIds} // 2dg Guids must be in the body as an array (API filter & too many IDs for URL parameters).\r\n    );\r\n  }\r\n}\r\n"],
  "mappings": "0GAOA,IAAMA,EAAW,CACfC,IAAK,GACLC,qBAAsB,GACtBC,YAAa,IAIFC,GAAY,IAAA,CAAnB,MAAOA,CAAY,CAIvBC,YAAoBC,EAA0BC,EAAgB,CAA1C,KAAAD,KAAAA,EAA0B,KAAAC,QAAAA,EAF9C,KAAAC,IAAMC,EAAS,CAACL,aAAAA,CAAY,EAAGJ,CAAQ,CAE2B,CAElEU,aAAaC,EAAkBC,EAAgBC,EAAgBC,EAAyB,CACtF,KAAKN,IAAIO,KAAK,uBAAwB,CAAEJ,SAAAA,EAAUC,OAAAA,EAAQC,OAAAA,EAAQC,eAAAA,CAAc,CAAE,EAElF,IAAME,EAAY,CAAC,CAACJ,EAQdK,KAPcL,GAAQM,kBAAiB,GAAM,IACtBC,SAAS,QAAQ,GAAK,GAEnC,GAAK,UAAU,KAAKZ,QAAQa,KAAK,KAC5CJ,EAAY,IAAIJ,CAAM,GAAK,IAC5B,aAAeC,GAAU,KAEDQ,UAAU,CAAC,EACvC,OAAO,KAAKf,KAAKgB,KAAmB,kBAAkBX,CAAQ,IAAIM,CAAS,GACzE,CACEM,MAAOT,EACR,CAEL,CAEAX,YAAY,CAAEqB,aAAAA,EAAcC,QAAAA,EAASZ,OAAAA,EAAQL,IAAAA,CAAG,EAA8E,CAC5H,KAAKA,IAAIO,KAAK,cAAe,CAAEP,IAAAA,EAAKgB,aAAAA,EAAcC,QAAAA,EAASZ,OAAAA,CAAM,CAAE,EAMnE,IAAMI,GAJJ,eAAiBO,GAAcE,KAAK,GAAG,GAAK,IAC1C,UAAU,KAAKnB,QAAQa,KAAK,aACbP,GAAU,KAEDQ,UAAU,CAAC,EACvC,OAAO,KAAKf,KAAKgB,KACf,8CAA8CL,CAAS,GACvD,CAAEM,MAAOE,CAAO,EAEpB,iDArCWrB,GAAYuB,EAAAC,CAAA,EAAAD,EAAAE,CAAA,CAAA,CAAA,CAAA,iCAAZzB,EAAY0B,QAAZ1B,EAAY2B,SAAA,CAAA,CAAA,SAAZ3B,CAAY,GAAA",
  "names": ["logSpecs", "all", "getAvailableEntities", "getEntities", "QueryService", "constructor", "http", "context", "log", "classLog", "getFromQuery", "queryUrl", "params", "fields", "entitiesFilter", "fnIf", "hasParams", "urlParams", "toLocaleLowerCase", "includes", "appId", "substring", "post", "Guids", "contentTypes", "itemIds", "join", "\u0275\u0275inject", "HttpClient", "Context", "factory", "\u0275fac"]
}
