import{a as Be,b as Pe,c as $}from"./chunk-2DYNCIOE.js";import{a as ke,b as Ae,d as Le}from"./chunk-ZRGOAEF3.js";import"./chunk-Q5UOKVIL.js";import"./chunk-VSMYOUA2.js";import"./chunk-O3YSC345.js";import"./chunk-LTBMRGUR.js";import"./chunk-Q7SYXYTY.js";import"./chunk-HW433KCS.js";import"./chunk-GLFISIX2.js";import"./chunk-MBSXBYF5.js";import"./chunk-AAMPB3UT.js";import{b as De}from"./chunk-DDUEZMYJ.js";import{a as Ve}from"./chunk-LOXR3JJX.js";import"./chunk-NIPOW2E2.js";import"./chunk-56YE37V6.js";import"./chunk-U657U553.js";import"./chunk-QFYVXC4V.js";import"./chunk-T7AKPKMZ.js";import"./chunk-JNRBLGLU.js";import"./chunk-4YE3E6NH.js";import{a as Oe}from"./chunk-ZBQC6E3M.js";import"./chunk-AO43RQAG.js";import{c as we}from"./chunk-SCB2MVKQ.js";import{a as Se}from"./chunk-4SMJHLGZ.js";import{a as Ie}from"./chunk-QUYVM733.js";import"./chunk-JEQANFI7.js";import{a as R}from"./chunk-NVCP7HH3.js";import{b as Te,c as Fe}from"./chunk-ODL7UGWI.js";import"./chunk-LPOE4446.js";import"./chunk-WAPW5AUJ.js";import"./chunk-ENHI5GWA.js";import{a as be,b as Ee,c as Ne}from"./chunk-DAEXUMJT.js";import"./chunk-IGMB27B5.js";import{e as xe,h as Me}from"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as me}from"./chunk-HCPBPEHV.js";import{f as de,l as pe}from"./chunk-QVLOO535.js";import"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{b as fe,f as _e,g as he,i as w,k as ge,l as ye,s as Ce,v as ve}from"./chunk-UMOPET3G.js";import{b as ae,i as re,j as se}from"./chunk-4LV77BQU.js";import{b as F}from"./chunk-RGKBOUPL.js";import{d as le}from"./chunk-EZZQWHAZ.js";import{b as ne,c as oe}from"./chunk-23CS2WID.js";import{a as P}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{c as ie}from"./chunk-OYQCZWOE.js";import{b as ce,g as ue}from"./chunk-G33ZJSCE.js";import"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$b as E,Aa as M,Ab as I,Bb as b,Ca as H,Cb as u,Db as s,Eb as d,F as Q,Gc as B,H as j,Hc as ee,J as W,K as z,Nb as k,Ob as K,Pb as v,Rb as c,Sa as a,Vb as U,Wb as A,Xb as L,Za as S,db as q,ec as p,fc as f,fd as te,gc as N,ib as G,lc as Y,mc as J,nc as X,oa as y,p as O,pa as C,tc as Z,wb as _,yb as h,zb as D}from"./chunk-46QINP2S.js";import{a as V}from"./chunk-BDOJB7O2.js";var Re=["ngForm"],$e=["autoFocusInputField"],Qe=n=>({"eav-input-obsolete":n}),je=(n,m)=>m.SortOrder;function We(n,m){n&1&&p(0," Fields ")}function ze(n,m){n&1&&p(0," Add Fields ")}function He(n,m){n&1&&p(0," Edit Field ")}function qe(n,m){if(n&1&&(s(0,"app-field-hint",20),p(1),d()),n&2){let e=c(4);u("isError",!0),a(),f(e.fieldNameError)}}function Ge(n,m){if(n&1&&(s(0,"app-field-hint",20),p(1),d()),n&2){c(2);let e=E(6);u("isError",!0),a(),N(" ",e.errors.reservedNames," ")}}function Ke(n,m){if(n&1&&(_(0,qe,2,2,"app-field-hint",20),_(1,Ge,2,2,"app-field-hint",20)),n&2){c();let e=E(6);h(e.errors.pattern?0:-1),a(),h(e.errors.reservedNames?1:-1)}}function Ue(n,m){if(n&1&&(s(0,"mat-option",16),p(1),s(2,"mat-icon",15),p(3),d()()),n&2){let e=m.$implicit;u("value",e.name),a(),N(" ",e.label," "),a(2),f(e.icon)}}function Ye(n,m){if(n&1&&(s(0,"span")(1,"mat-icon",18),p(2),d()()),n&2){let e=c().$implicit;a(2),f(e.icon)}}function Je(n,m){if(n&1&&(s(0,"mat-option",19),p(1),_(2,Ye,3,1,"span"),d()),n&2){let e=m.$implicit;u("value",e.inputType)("ngClass",Z(4,Qe,e.isObsolete)),a(),N(" ",e.label," "),a(),h(e.icon?2:-1)}}function Xe(n,m){if(n&1){let e=k();s(0,"div",8)(1,"div",11)(2,"mat-form-field",12)(3,"mat-label"),p(4,"Name"),d(),s(5,"input",13,1),X("ngModelChange",function(o){let t=y(e).$implicit;return J(t.StaticName,o)||(t.StaticName=o),C(o)}),d()(),_(8,Ke,2,2),d(),s(9,"div",11)(10,"mat-form-field",12)(11,"mat-label"),p(12,"Data Type"),d(),s(13,"mat-select",14),v("selectionChange",function(o){let t=y(e).$index,r=c(2);return C(r.setFieldType(t,o.value))}),s(14,"mat-select-trigger")(15,"mat-icon",15),p(16),d(),s(17,"span"),p(18),d()(),I(19,Ue,4,3,"mat-option",16,D),d()(),s(21,"app-field-hint"),p(22),d()(),s(23,"div",11)(24,"mat-form-field",12)(25,"mat-label"),p(26,"Input Type"),d(),s(27,"mat-select",17),v("selectionChange",function(o){let t=y(e).$index,r=c(2);return C(r.updateFieldPart(t,{InputType:o.value}))}),s(28,"mat-select-trigger")(29,"span"),p(30),d(),s(31,"mat-icon",18),p(32),d()(),I(33,Je,3,6,"mat-option",19,D),d()(),s(35,"app-field-hint"),p(36),d()()()}if(n&2){let e,i,o=m.$implicit,t=m.$index,r=E(6),l=c(2);a(5),u("pattern",l.fieldNamePattern)("appReservedNames",l.reservedNames()),Y("ngModel",o.StaticName),u("name","StaticName"+t)("disabled",l.editMode==="inputType"),a(3),h(r.touched&&r.errors?8:-1),a(5),u("ngModel",o.Type)("name","Type"+t)("disabled",l.editMode!=null),a(3),f(l.findIcon(o.Type)),a(2),f(l.findLabel(o.Type)),a(),b(l.dataTypes()),a(3),f(l.hints()[t].data),a(5),u("ngModel",o.InputType)("name","InputType"+t)("disabled",l.editMode==="name"),a(3),f((e=l.getInputTypeOption(o.InputType))==null?null:e.label),a(2),f((i=l.getInputTypeOption(o.InputType))==null?null:i.icon),a(),b(l.inputTypeOptions()[t]),a(3),f(l.hints()[t].input)}}function Ze(n,m){if(n&1){let e=k();s(0,"form",6,0),v("ngSubmit",function(){y(e);let o=c();return C(o.saveAndClose())}),s(2,"div",7),I(3,Xe,37,18,"div",8,je),d(),s(5,"mat-dialog-actions",9)(6,"app-save-close-button-fab",10),v("action",function(){y(e);let o=c();return C(o.saveAndClose())}),d()()()}if(n&2){let e=c();a(3),b(e.fields()),a(3),u("triggerOnFormSubmit",!0)("ngClass",e.canSave()?"":"disabled")("disabled",!e.canSave())}}var Qt=(()=>{class n extends Se{#o;#e;constructor(e,i,o){super(),this.dialog=e,this.route=i,this.snackBar=o,this.hostClass="dialog-component",this.formValid=M(!1),this.canSave=B(()=>this.formValid()&&!this.saving()),this.#o=P(De),this.#e=P(Le),this.fieldNamePattern=Be,this.fieldNameError=Pe,this.findIcon=ke,this.findLabel=Ae,this.editMode=this.route.snapshot.paramMap.get("editMode"),this.filteredInputTypeOptions=[],this.saving=M(!1),this.dataTypes=this.#e.dataTypes().value,this.#t=this.#e.getInputTypes().value,this.#i=this.#o.getType(this.route.snapshot.paramMap.get("contentTypeStaticName")).value,this.#n=B(()=>{let t=this.#i();return H(()=>this.#e.getFieldsLive(M(0),t?.NameId))}),this.fields=(()=>{let t=F("fields",()=>{let r=this.#n()();if(this.editMode!=null){if(r.length===0)return[];let l=this.route.snapshot.paramMap.get("id"),x=l?parseInt(l,10):null;return[r.find(T=>T.Id===x)]}else return this.#r(r.length)});return ee({source:t,computation:r=>r})})(),this.#a=this.#e.getReservedNames().value,this.reservedNames=F("reservedNamesAll",()=>{let t=this.#n()(),r=this.#a();if(t.length===0)return r;let l=$.mergeReserved(r,t);return this.editMode==="name"&&delete l[t[0].StaticName],l}),this.inputTypeOptions=F("inputTypeOptions",()=>{let t=this.#t();return this.fields().map((l,x)=>t.filter(g=>g.dataType===l.Type.toLocaleLowerCase()))}),this.hints=F("hints",()=>this.fields().map((r,l)=>{let x=this.dataTypes().find(T=>T.name===r.Type),g=this.#t().find(T=>T.inputType===r.InputType);return{data:x?.description??"",input:g?.isObsolete?`OBSOLETE - ${g.obsoleteMessage}`:g?.description??""}})),this.dialog.disableClose=!0,this.subscriptions.add(this.dialog.backdropClick().subscribe(t=>{this.ngForm?.dirty&&!confirm("You have unsaved changes. Are you sure you want to close this dialog?")||this.closeDialog()}))}#t;#i;#n;#a;ngAfterViewInit(){if(this.fields().length&&this.ngForm)this.formValid.set(this.ngForm?.form.valid??!1),this.ngForm?.form.statusChanges.subscribe(()=>{this.formValid.set(this.ngForm?.form.valid??!1)});else{setTimeout(()=>this.ngAfterViewInit(),250);return}this.autoFocusInputField&&setTimeout(()=>this.autoFocusInputField.first?.nativeElement?.focus(),250)}ngOnInit(){this.#s()}#r(e){return[...Array(8).keys()].map(i=>({Id:0,Type:Ie.String,InputType:R.StringDefault,StaticName:"",IsTitle:e===0&&i===0,SortOrder:e+i+1}))}updateFieldPart(e,i){this.fields.update(o=>[...o].map((t,r)=>r!==e?t:V(V({},t),i)))}setFieldType(e,i){this.updateFieldPart(e,{Type:i});let o=i.toLocaleLowerCase()+R.DefaultSuffix,t=this.inputTypeOptions()[e],r=t.find(l=>l.inputType===o)?.inputType??t[0].inputType;this.updateFieldPart(e,{InputType:r})}getInputTypeOption(e){return this.#t().find(i=>i.inputType===e)}closeDialog(){this.dialog.close()}saveAndClose(){this.saving.set(!0),this.snackBar.open("Saving...");let e=()=>{this.saving.set(!1),this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()};if(this.editMode!=null){let i=this.fields()[0];this.editMode==="name"?this.#e.rename(i.Id,this.#i().Id,i.StaticName).subscribe(()=>e()):this.editMode==="inputType"&&this.#e.updateInputType(i.Id,i.StaticName,i.InputType).subscribe(()=>e())}else O(...this.fields()).pipe(Q(i=>!!i.StaticName),z(i=>this.#e.add(i,this.#i().Id).pipe(j(o=>O(null)))),W()).subscribe(()=>e())}#s(){this.dialog.keydownEvents().subscribe(e=>{we(e)&&this.canSave()&&(e.preventDefault(),this.saveAndClose())})}static{this.\u0275fac=function(i){return new(i||n)(S(ce),S(ie),S(me))}}static{this.\u0275cmp=q({type:n,selectors:[["app-edit-content-type-fields"]],viewQuery:function(i,o){if(i&1&&U(Re,5,w)($e,5),i&2){let t;A(t=L())&&(o.ngForm=t.first),A(t=L())&&(o.autoFocusInputField=t)}},hostVars:1,hostBindings:function(i,o){i&2&&K("className",o.hostClass)},features:[G],decls:10,vars:4,consts:[["ngForm","ngForm"],["staticName","ngModel","autoFocusInputField",""],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[3,"ngSubmit"],[1,"eav-dialog-content"],[1,"eav-row-container"],["align","end"],[3,"action","triggerOnFormSubmit","ngClass","disabled"],[1,"eav-edit-input"],["color","accent",1,"eav-mat-form-field"],["matInput","",3,"ngModelChange","pattern","appReservedNames","ngModel","name","disabled"],["panelClass","eav-type-field-type-select","panelWidth","",3,"selectionChange","ngModel","name","disabled"],[1,"eav-type-icon"],[3,"value"],["panelClass","eav-type-field-input-type-select","panelWidth","",3,"selectionChange","ngModel","name","disabled"],[1,"eav-input-icon"],[3,"value","ngClass"],[3,"isError"]],template:function(i,o){if(i&1&&(s(0,"div",2)(1,"div",3)(2,"div",4),_(3,We,1,0),_(4,ze,1,0),_(5,He,1,0),d(),s(6,"button",5),v("click",function(){return o.closeDialog()}),s(7,"mat-icon"),p(8,"close"),d()()(),_(9,Ze,7,3,"form"),d()),i&2){let t;a(3),h(o.editMode===void 0?3:-1),a(),h(o.editMode===null?4:-1),a(),h(o.editMode!=null?5:-1),a(4),h((t=o.fields())!=null&&t.length?9:-1)}},dependencies:[ve,ye,fe,_e,he,Ce,ge,w,se,re,ae,Fe,Te,$,Ne,be,Ee,xe,oe,ne,Me,te,ue,pe,de,le,Ve,Oe],styles:[`.eav-row-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.eav-edit-input[_ngcontent-%COMP%]{padding-bottom:8px;width:30%}.eav-type-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;margin-right:8px;font-size:inherit;vertical-align:top;line-height:inherit}.eav-input-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;margin-left:8px;font-size:inherit;vertical-align:top;line-height:inherit}.eav-input-obsolete[_ngcontent-%COMP%]{text-decoration:black line-through;color:#696969}  .mdc-menu-surface.mat-mdc-select-panel.eav-type-field-input-type-select,   .mdc-menu-surface.mat-mdc-select-panel.eav-type-field-type-select{max-height:500px}
/*# sourceMappingURL=edit-content-type-fields-LV664MAM.css.map */`]})}}return n})();export{Qt as EditContentTypeFieldsComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/edit-content-type-fields-O7KMJXG6.js.map
