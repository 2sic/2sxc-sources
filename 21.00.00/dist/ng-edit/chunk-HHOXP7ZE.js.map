{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/content-items/services/content-items.service.ts"],
  "sourcesContent": ["import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { from, map, switchMap } from 'rxjs';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { webApiFieldsAll } from '../../shared/fields/content-types-fields.service';\r\nimport { Field } from '../../shared/fields/field.model';\r\nimport { toBase64 } from '../../shared/helpers/file-to-base64.helper';\r\nimport { classLog } from '../../shared/logging';\r\nimport { webApiEntityList, webApiEntityRoot } from '../../shared/services/entity.service';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { ContentItem } from '../models/content-item.model';\r\n\r\nconst logSpecs = {\r\n  getAll: true,\r\n  getAllLive: true,\r\n  getAllOnce: true,\r\n\r\n}\r\n@Injectable()\r\nexport class ContentItemsService extends HttpServiceBaseSignal {\r\n\r\n  log = classLog({ ContentItemsService }, logSpecs);\r\n  \r\n  getAllPromise(contentTypeStaticName: string): Promise<ContentItem[]> {\r\n    this.log.fnIf('getAll', { contentTypeStaticName });\r\n    return this.fetchPromise<ContentItem[]>(webApiEntityList, {\r\n      params: { appId: this.appId, contentType: contentTypeStaticName }\r\n    });\r\n  }\r\n\r\n  getAllOnce(contentTypeStaticName: string) {\r\n    this.log.fnIf('getAllOnce', { contentTypeStaticName });\r\n    return httpResource<ContentItem[]>(() => {\r\n      return ({\r\n        url: this.apiUrl(webApiEntityList),\r\n        params: { appId: this.appId, contentType: contentTypeStaticName }\r\n      });\r\n    });\r\n  }\r\n\r\n  getAllLive(contentTypeStaticName: string, refresh: Signal<unknown>) {\r\n    this.log.fnIf('getAllLive', { contentTypeStaticName, refresh });\r\n    return httpResource<ContentItem[]>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiEntityList),\r\n        params: { appId: this.appId, contentType: contentTypeStaticName }\r\n      });\r\n    });\r\n  }\r\n\r\n  getColumnsPromise(contentTypeStaticName: string): Promise<Field[]> {\r\n    return this.fetchPromise<Field[]>(webApiFieldsAll, {\r\n      params: { appId: this.appId, staticName: contentTypeStaticName }\r\n    });\r\n  }\r\n\r\n  importItem(file: File) {\r\n    return from(toBase64(file)).pipe(\r\n      switchMap(fileBase64 => {\r\n        return this.http.post<boolean>(this.apiUrl(webApiEntityRoot + 'upload'), {\r\n          AppId: this.appId,\r\n          ContentBase64: fileBase64,\r\n        });\r\n      }),\r\n      map(success => {\r\n        const result: FileUploadResult = {\r\n          Success: success,\r\n          Messages: [],\r\n        };\r\n        return result;\r\n      }),\r\n    );\r\n  }\r\n}\r\n"],
  "mappings": "yRAYA,IAAMA,EAAW,CACfC,OAAQ,GACRC,WAAY,GACZC,WAAY,IAIDC,GAAoB,IAAA,CAA3B,MAAOA,UAA4BC,CAAqB,CAD9DC,aAAA,qBAGE,KAAAC,IAAMC,EAAS,CAAEJ,oBAAAA,CAAmB,EAAIJ,CAAQ,EAEhDS,cAAcC,EAA6B,CACzC,YAAKH,IAAII,KAAK,SAAU,CAAED,sBAAAA,CAAqB,CAAE,EAC1C,KAAKE,aAA4BC,EAAkB,CACxDC,OAAQ,CAAEC,MAAO,KAAKA,MAAOC,YAAaN,CAAqB,EAChE,CACH,CAEAP,WAAWO,EAA6B,CACtC,YAAKH,IAAII,KAAK,aAAc,CAAED,sBAAAA,CAAqB,CAAE,EAC9CO,EAA4B,KACzB,CACNC,IAAK,KAAKC,OAAON,CAAgB,EACjCC,OAAQ,CAAEC,MAAO,KAAKA,MAAOC,YAAaN,CAAqB,GAElE,CACH,CAEAR,WAAWQ,EAA+BU,EAAwB,CAChE,YAAKb,IAAII,KAAK,aAAc,CAAED,sBAAAA,EAAuBU,QAAAA,CAAO,CAAE,EACvDH,EAA4B,KACjCG,EAAO,EACC,CACNF,IAAK,KAAKC,OAAON,CAAgB,EACjCC,OAAQ,CAAEC,MAAO,KAAKA,MAAOC,YAAaN,CAAqB,GAElE,CACH,CAEAW,kBAAkBX,EAA6B,CAC7C,OAAO,KAAKE,aAAsBU,EAAiB,CACjDR,OAAQ,CAAEC,MAAO,KAAKA,MAAOQ,WAAYb,CAAqB,EAC/D,CACH,CAEAc,WAAWC,EAAU,CACnB,OAAOC,EAAKC,EAASF,CAAI,CAAC,EAAEG,KAC1BC,EAAUC,GACD,KAAKC,KAAKC,KAAc,KAAKb,OAAOc,EAAmB,QAAQ,EAAG,CACvEC,MAAO,KAAKnB,MACZoB,cAAeL,EAChB,CACF,EACDM,EAAIC,IAC+B,CAC/BC,QAASD,EACTE,SAAU,CAAA,GAGb,CAAC,CAEN,qEAtDWnC,CAAmB,IAAAoC,GAAnBpC,CAAmB,CAAA,CAAA,GAAA,CAAA,iCAAnBA,EAAmBqC,QAAnBrC,EAAmBsC,SAAA,CAAA,CAAA,SAAnBtC,CAAoB,GAAA",
  "names": ["logSpecs", "getAll", "getAllLive", "getAllOnce", "ContentItemsService", "HttpServiceBaseSignal", "constructor", "log", "classLog", "getAllPromise", "contentTypeStaticName", "fnIf", "fetchPromise", "webApiEntityList", "params", "appId", "contentType", "httpResource", "url", "apiUrl", "refresh", "getColumnsPromise", "webApiFieldsAll", "staticName", "importItem", "file", "from", "toBase64", "pipe", "switchMap", "fileBase64", "http", "post", "webApiEntityRoot", "AppId", "ContentBase64", "map", "success", "Success", "Messages", "__ngFactoryType__", "factory", "\u0275fac"]
}
