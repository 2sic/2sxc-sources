import{a as Oe}from"./chunk-CZKIDW24.js";import{a as Ae}from"./chunk-LOXR3JJX.js";import{a as ne,b as re}from"./chunk-T7AKPKMZ.js";import{a as ke}from"./chunk-ZBQC6E3M.js";import{c as $e}from"./chunk-SCB2MVKQ.js";import{a as Ne}from"./chunk-4SMJHLGZ.js";import{o as Pe}from"./chunk-VT6LNH6I.js";import{b as V,c as Ee}from"./chunk-ODL7UGWI.js";import{a as Te,c as Ke}from"./chunk-DAEXUMJT.js";import{e as Ie,h as Ve}from"./chunk-ME7PJXWA.js";import{f as ue,l as fe}from"./chunk-QVLOO535.js";import{b as Ce,d as k,f as _e,g as be,h as xe,j as g,l as we,n as Me,o as ye,r as De,v as Se,w as Fe}from"./chunk-UMOPET3G.js";import{b as me,i as ce,j as de}from"./chunk-4LV77BQU.js";import{b as se,c as pe}from"./chunk-23CS2WID.js";import{a as le}from"./chunk-OIHIMR2W.js";import{b as ve,c as he,g as ge}from"./chunk-G33ZJSCE.js";import{$ as S,A as L,Aa as F,Ab as P,Ac as ee,Bb as I,C as q,Cb as v,Db as r,Eb as o,Fb as O,Ga as H,Gc as te,Lc as ie,Nb as Q,Ob as X,P as u,Pb as $,Rb as M,Sa as s,X as f,Y as z,Za as b,aa as G,db as U,ec as p,fb as J,fc as Y,fd as oe,g as N,gc as y,ib as W,id as ae,j as R,oa as T,p as j,pa as K,tc as A,u as C,v as _,wb as x,yb as w,zb as E,zc as Z}from"./chunk-46QINP2S.js";var Be=(()=>{class i{constructor(e,t){this.matInput=e,this.elementRef=t,this.autofocusSelectValue=ie(!1)}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue())&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if(typeof e=="boolean")return e;if(typeof e=="string"){let t=e.toLocaleLowerCase();return t==="true"?!0:t==="false"?!1:void 0}if(e==null)return e}static{this.\u0275fac=function(t){return new(t||i)(b(V),b(H))}}static{this.\u0275dir=J({type:i,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:[1,"autofocusSelectValue"]}})}}return i})();var Re=i=>({disabled:i});function ze(i,d){if(i&1&&(r(0,"mat-option",10),p(1),o()),i&2){let e=d.$implicit;v("value",e),s(),y(" ",e," ")}}function Ge(i,d){if(i&1&&(r(0,"mat-option",10),p(1),o()),i&2){let e=d.$implicit;v("value",e),s(),y(" ",e," ")}}function He(i,d){if(i&1&&(r(0,"mat-option",10),p(1),o()),i&2){let e=d.$implicit;v("value",e.Key),s(),y(" ",e.Name," ")}}function Ue(i,d){i&1&&(r(0,"app-field-hint",14),p(1," This field is required "),o()),i&2&&v("isError",!0)}function Je(i,d){if(i&1&&(r(0,"div",15)(1,"div",19)(2,"label",20),p(3,"Preview"),o()(),r(4,"pre",21),p(5),o()()),i&2){let e=M();s(2),v("ngClass",A(3,Re,e.loadingPreview)),s(2),v("ngClass",A(5,Re,e.loadingPreview)),s(),Y(e.preview)}}function We(i,d){if(i&1&&(r(0,"div",16),p(1),o()),i&2){let e=M();s(),y(" ",e.previewError," ")}}function Qe(i,d){i&1&&(r(0,"div"),O(1,"mat-spinner",22)(2,"div",23),o())}function Xe(i,d){if(i&1){let e=Q();r(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),p(4,"Create"),o(),r(5,"span",3),p(6),o()(),r(7,"button",4),$("click",function(){T(e);let l=M();return K(l.closeDialog())}),r(8,"mat-icon"),p(9,"close"),o()()(),r(10,"form",5)(11,"div",6)(12,"div",7)(13,"div")(14,"mat-form-field",8)(15,"mat-label"),p(16,"Platform"),o(),r(17,"mat-select",9),P(18,ze,2,2,"mat-option",10,E),o()()(),r(20,"div")(21,"mat-form-field",8)(22,"mat-label"),p(23,"Purpose"),o(),r(24,"mat-select",11),P(25,Ge,2,2,"mat-option",10,E),o()()()(),r(27,"div",7)(28,"mat-form-field",8)(29,"mat-label"),p(30,"Template"),o(),r(31,"mat-select",12),P(32,He,2,2,"mat-option",10,E),o()()(),r(34,"div",7)(35,"mat-form-field",8)(36,"mat-label"),p(37,"Name"),o(),O(38,"input",13),o(),x(39,Ue,2,1,"app-field-hint",14),o(),x(40,Je,6,7,"div",15),x(41,We,2,1,"div",16),x(42,Qe,3,0,"div"),o(),r(43,"mat-dialog-actions",17)(44,"app-save-close-button-fab",18),$("action",function(){T(e);let l=M();return K(l.saveAndClose())}),o()()()()}if(i&2){let e=d,t=M();s(6),y(" ",t.controls.finalName.value||(t.controls.folder.value?t.controls.folder.value.trim()+"/":"")," "),s(4),v("formGroup",t.ngForm),s(8),I(e.platforms),s(7),I(e.purposes),s(7),I(e.templates),s(7),w(t.controls.name.touched&&(t.controls.name.errors!=null&&t.controls.name.errors.required)?39:-1),s(),w(e.preview?40:-1),s(),w(!e.loadingPreview&&e.previewError?41:-1),s(),w(e.loadingPreview?42:-1),s(2),v("ngClass",t.canSave()?"":"disabled")("disabled",!t.canSave())("label","Form.Buttons.CreateAndClose")}}var Tt=(()=>{class i extends Ne{#e;#t;#i;#o;constructor(e,t){super(),this.dialogData=e,this.dialog=t,this.hostClass="dialog-component",this.#e="All",this.#o=le(Oe),this.formValid=F(!1),this.loadingPreview=F(!1),this.previewValid=F(!1),this.canSave=te(()=>this.formValid()&&!this.loadingPreview()&&this.previewValid())}ngOnInit(){this.#l(),this.#t=new N([]),this.#i=new N(!1),this.#n(),this.#a(),this.#r(),this.subscriptions.add(this.#i.subscribe(e=>this.loadingPreview.set(e)))}ngAfterViewInit(){this.ngForm?.statusChanges.subscribe(()=>{this.formValid.set(this.ngForm?.valid??!1)})}ngOnDestroy(){this.#t.complete(),this.#i.complete(),super.ngOnDestroy()}#a(){this.#o.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).then(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.#t.next(e.Templates)})}#n(){this.ngForm=new xe({platform:new g(this.#e),purpose:new g({value:this.dialogData.purpose??this.#e,disabled:this.dialogData.purpose!=null}),templateKey:new g(null,k.required),name:new g(this.dialogData.name??null,k.required),finalName:new g({value:null,disabled:!0}),folder:new g({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.ngForm.controls,this.subscriptions.add(_([this.#t,this.controls.templateKey.valueChanges.pipe(f(this.controls.templateKey.value),u())]).subscribe(([e,t])=>{let l=e.find(n=>n.Key===t),m=this.dialogData.name?this.controls.name.value||this.dialogData.name:l?.SuggestedFileName??null;this.controls.name.value!==m&&this.controls.name.patchValue(m)})),this.subscriptions.add(_([this.#t,this.controls.templateKey.valueChanges.pipe(f(this.controls.templateKey.value),u()),this.controls.name.valueChanges.pipe(f(this.controls.name.value),u()),this.controls.folder.valueChanges.pipe(f(this.controls.folder.value),u())]).subscribe(([e,t,l,m])=>{let n=e.find(c=>c.Key===t),a=null;l&&(m=m.trim(),l=Pe.sanitizePath(l.trim()),l=`${n?.Prefix??""}${l}${n?.Suffix??""}${n?.Extension??""}`,a=`${m?`${m}/`:""}${l}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==a&&this.controls.finalName.patchValue(a)}))}#r(){let e=this.#t.pipe(C(n=>{let a={[this.#e]:this.#e};return n.forEach(c=>{c.Platforms?.forEach(h=>{a[h]=h})}),Object.keys(a)})),t=this.#t.pipe(C(n=>{let a={[this.#e]:this.#e};return n.forEach(c=>{a[c.Purpose]=c.Purpose}),Object.keys(a)})),l=_([this.#t,this.controls.platform.valueChanges.pipe(f(this.controls.platform.value),u()),this.controls.purpose.valueChanges.pipe(f(this.controls.purpose.value),u())]).pipe(C(([n,a,c])=>n.filter(D=>{let B=a===this.#e||(D.Platforms?.includes(a)??!1),je=c===this.#e||D.Purpose===c;return B&&je})),S(n=>{if(!n.some(a=>a.Key===this.controls.templateKey.value)){let a=n[0]?.Key??null;this.controls.templateKey.value!==a&&this.controls.templateKey.patchValue(a)}})),m=_([this.controls.finalName.valueChanges.pipe(f(this.controls.finalName.value),u()),this.controls.templateKey.valueChanges.pipe(f(this.controls.templateKey.value),u())]).pipe(G(100,R,{leading:!0,trailing:!0}),S(()=>{this.#i.next(!0)}),z(([n,a])=>!n||!a?j(void 0):L([this.#o.getPreview(n,this.dialogData.global,a),q(500)]).pipe(C(([c])=>c))),S(()=>{this.#i.next(!1)}));this.subscriptions.add(m.subscribe(n=>{this.previewValid.set(n?.IsValid??!1)})),this.viewModel$=_([e,t,l,m,this.#i]).pipe(C(([n,a,c,h,D])=>({platforms:n,purposes:a,templates:c,loadingPreview:D,preview:h?.Preview,previewValid:h?.IsValid??!1,previewError:h?.Error})))}closeDialog(e){this.dialog.close(e)}saveAndClose(){let e=this.ngForm.getRawValue(),t={name:e.finalName,templateKey:e.templateKey};this.closeDialog(t)}#l(){this.dialog.keydownEvents().subscribe(e=>{$e(e)&&this.canSave()&&(e.preventDefault(),this.saveAndClose())})}static{this.\u0275fac=function(t){return new(t||i)(b(he),b(ve))}}static{this.\u0275cmp=U({type:i,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(t,l){t&2&&X("className",l.hostClass)},features:[W],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],["mat-icon-button","","tippy","Close dialog",3,"click"],[3,"formGroup"],[1,"eav-dialog-content"],[1,"eav-field-container"],["color","accent",1,"eav-mat-form-field"],["formControlName","platform"],[3,"value"],["formControlName","purpose"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"eav-preview-container"],[1,"eav-preview-error"],["align","end"],[3,"action","ngClass","disabled","label"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"]],template:function(t,l){if(t&1&&(x(0,Xe,45,9,"div",0),Z(1,"async")),t&2){let m;w((m=ee(1,1,l.viewModel$))?0:-1,m)}},dependencies:[Se,we,Ce,_e,be,De,Fe,ye,Me,de,ce,me,Ke,Te,Ie,Ve,Ee,V,pe,se,ge,re,ne,fe,ue,oe,Ae,Be,ke,ae],styles:[`.eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{overflow-x:auto;max-width:450px;font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-preview-container[_ngcontent-%COMP%]{margin:8px 6px 6px;display:flex;flex-direction:column;align-items:stretch}.eav-preview-label-box[_ngcontent-%COMP%]{margin-bottom:4px}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto;max-height:55vh}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}
/*# sourceMappingURL=create-file-dialog-2KCC5JSD.css.map */`]})}}return i})();export{Tt as a};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/chunk-6N3NJCWN.js.map
