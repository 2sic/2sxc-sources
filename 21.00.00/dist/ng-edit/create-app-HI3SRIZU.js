import{a as ve}from"./chunk-GLFISIX2.js";import{a as Ce}from"./chunk-MBSXBYF5.js";import{a as he}from"./chunk-LOXR3JJX.js";import{a as pe}from"./chunk-ORK43FFD.js";import{a as ce,b as de,c as ue}from"./chunk-56YE37V6.js";import{a as ge}from"./chunk-ZBQC6E3M.js";import"./chunk-AO43RQAG.js";import{c as fe}from"./chunk-SCB2MVKQ.js";import"./chunk-4SMJHLGZ.js";import{b as re,c as le}from"./chunk-ODL7UGWI.js";import"./chunk-R3Y7P2GW.js";import"./chunk-ENHI5GWA.js";import{c as me}from"./chunk-DAEXUMJT.js";import"./chunk-IGMB27B5.js";import{h as se}from"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as J}from"./chunk-HCPBPEHV.js";import{f as L,h as $,l as H}from"./chunk-QVLOO535.js";import"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{b as Y,d as b,f as Q,g as W,h as X,j as S,l as ee,n as te,o as ie,r as ae,v as oe,w as ne}from"./chunk-UMOPET3G.js";import{b as z,i as j,j as q}from"./chunk-4LV77BQU.js";import"./chunk-EZZQWHAZ.js";import{b as V,c as G}from"./chunk-23CS2WID.js";import{a as _}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{d as R,e as O}from"./chunk-OYQCZWOE.js";import{b as Z,g as K}from"./chunk-G33ZJSCE.js";import"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{Aa as f,B as A,Ba as E,Cb as p,Cd as P,Db as a,Eb as n,F as M,Fb as u,Gc as B,M as y,Nb as D,Ob as U,Pb as C,Qa as w,Rb as h,Sa as l,Za as v,db as N,ec as r,gc as F,ja as T,oa as I,pa as k,u as x,wb as c,yb as d}from"./chunk-46QINP2S.js";import"./chunk-BDOJB7O2.js";var _e=/^[A-Za-z](?:[A-Za-z0-9\s\(\)-]+)*$/,be="Standard letters, numbers, spaces, hyphens and round brackets are allowed. Must start with a letter.";function Me(t,g){t&1&&(a(0,"app-field-hint",12),r(1," Required "),n()),t&2&&p("isError",!0)}function Se(t,g){if(t&1&&(a(0,"app-field-hint",12),r(1),n()),t&2){let e=h(2);p("isError",!0),l(),F(" ",e.appNameError," ")}}function xe(t,g){if(t&1&&(c(0,Me,2,1,"app-field-hint",12),c(1,Se,2,2,"app-field-hint",12)),t&2){let e=h();d(e.form.controls.name.errors!=null&&e.form.controls.name.errors.required?0:-1),l(),d(e.form.controls.name.errors!=null&&e.form.controls.name.errors.pattern?1:-1)}}function Ae(t,g){if(t&1){let e=D();u(0,"br"),a(1,"span"),r(2," To use an existing App as a template, please switch to the "),a(3,"strong"),r(4," Import App Dialog "),n()(),u(5,"br")(6,"br"),a(7,"button",13),C("click",function(){I(e);let i=h();return k(i.switchToImportApp())}),r(8,"Switch to Import App"),n()}}function ye(t,g){if(t&1&&u(0,"iframe",14),t&2){let e=h(2);p("src",e.remoteInstallerUrl,w)}}function Te(t,g){if(t&1&&c(0,ye,1,1,"iframe",14),t&2){let e=h();d(e.ready()?0:-1)}}var lt=(()=>{class t{#t;#e;#i;constructor(e,o,i){this.dialog=e,this.snackBar=o,this.sanitizer=i,this.hostClass="dialog-component",this.loading=f(!1),this.appNameError=be,this.remoteInstallerUrl="",this.ready=f(!1),this.showAppCatalog=f(!0),this.alreadyProcessing=!1,this.canSave=B(()=>this.canCreate()&&!this.loading()),this.#t=_(Ce),this.#e=_(ve),this.#i=_(pe),this.router=T(O),this.packageUrl=f(null),this.canCreate=f(!1),this.messages$=A(window,"message").pipe(M(()=>!this.alreadyProcessing),M(s=>s.origin==="https://2sxc.org"),x(s=>{let m=JSON.parse(s.data);this.packageUrl.set(m.packages?.[0]?.url||null)})),this.form=this.buildForm(),this.updateCanCreate(),this.form.valueChanges.subscribe(()=>this.updateCanCreate()),this.#e.loadGettingStarted(!1),this.#e.settings$.pipe(y(1)).subscribe(s=>{let m=s.remoteUrl;m+=(m.includes("?")?"&":"?")+"isTemplate=true",this.remoteInstallerUrl=this.sanitizer.bypassSecurityTrustResourceUrl(m),this.ready.set(!0)}),E(()=>{this.packageUrl(),this.updateCanCreate()})}ngOnInit(){this.#a(),this.#e.loadGettingStarted(!1),this.messages$.subscribe()}createAndClose(){if(!this.canCreate())return;this.form.disable(),this.loading.set(!0),this.snackBar.open("Creating app...",void 0,{duration:2e3});let e,o=Number(this.form.controls.appTemplateId.value),i=this.form.controls.name.value?.trim().replace(/\s\s+/g," ");o===1&&this.packageUrl()&&this.packageUrl().length>0?e=this.#t.createTemplate(this.packageUrl(),i):o===0&&(e=this.#t.create(i,null,0)),e.subscribe({error:()=>this.handleCreateError(),next:()=>this.handleCreateSuccess()})}handleCreateError(){this.form.enable(),this.loading.set(!1),this.snackBar.open("Failed to create app. Please check console for more information",void 0,{duration:3e3})}handleCreateSuccess(){this.form.enable(),this.loading.set(!1),this.snackBar.open("Created app",void 0,{duration:2e3}),this.closeDialog()}closeDialog(){this.dialog.close()}buildForm(){return new X({name:new S(null,[b.required,b.pattern(_e)]),appTemplateId:new S(1,b.required)})}updateCanCreate(){let e=this.form.controls.name.value?.trim(),o=Number(this.form.controls.appTemplateId.value),i=this.packageUrl(),s=!!e&&(o===0||o===1&&!!i);this.canCreate.set(s)}onTemplateChange(e){this.showAppCatalog.set(e===1),this.updateCanCreate()}switchToImportApp(){let e=this.router.url.split("/").filter(Boolean);e.splice(-1,1,"import"),this.dialog.close(),setTimeout(()=>this.#i.navPath("/"+e.join("/")),100)}get appTemplateIdValue(){return this.form.controls.appTemplateId.value}#a(){this.dialog.keydownEvents().subscribe(e=>{fe(e)&&this.canSave()&&(e.preventDefault(),this.createAndClose())})}static{this.\u0275fac=function(o){return new(o||t)(v(Z),v(J),v(P))}}static{this.\u0275cmp=N({type:t,selectors:[["app-create-app"]],hostVars:1,hostBindings:function(o,i){o&2&&U("className",i.hostClass)},decls:29,vars:11,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click","disabled"],[1,"eav-dialog-content"],[3,"formGroup"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","formControlName","name"],["formControlName","appTemplateId","required","",3,"change"],[3,"value"],["align","end"],[3,"action","ngClass","disabled","label"],[3,"isError"],["mat-raised-button","",1,"eav-action-button",3,"click"],[1,"eav-app-catalog-iframe",3,"src"]],template:function(o,i){o&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),r(3,"Create App"),n(),a(4,"button",3),C("click",function(){return i.closeDialog()}),a(5,"mat-icon"),r(6,"close"),n()()(),a(7,"div",4),u(8,"router-outlet"),a(9,"form",5)(10,"mat-form-field",6)(11,"mat-label"),r(12,"Name"),n(),u(13,"input",7),n(),a(14,"app-field-hint"),r(15," App name will also be used for the folder "),n(),c(16,xe,2,2),u(17,"br"),a(18,"mat-radio-group",8),C("change",function(m){return i.onTemplateChange(m.value)}),a(19,"mat-radio-button",9),r(20,"Use Template"),n(),a(21,"mat-radio-button",9),r(22,"Completely new / empty App"),n(),a(23,"mat-radio-button",9),r(24,"Use existing App as Template"),n()()(),c(25,Ae,9,0),c(26,Te,1,1),n(),a(27,"mat-dialog-actions",10)(28,"app-save-close-button-fab",11),C("action",function(){return i.createAndClose()}),n()()()),o&2&&(l(4),p("disabled",i.loading()),l(5),p("formGroup",i.form),l(7),d(i.form.controls.name.touched?16:-1),l(3),p("value",1),l(2),p("value",0),l(2),p("value",2),l(2),d(i.appTemplateIdValue==2?25:-1),l(),d(i.showAppCatalog()?26:-1),l(2),p("ngClass",i.canSave()?"":"disabled")("disabled",!i.canSave())("label","Form.Buttons.CreateAndClose"))},dependencies:[R,oe,ee,Y,Q,W,ae,ne,ie,te,q,j,z,le,re,me,se,K,H,$,L,he,ue,ce,de,G,V,ge],styles:[`.eav-result-container[_ngcontent-%COMP%]{margin-top:16px}.eav-app-catalog-button[_ngcontent-%COMP%]{margin-left:12px}.eav-app-catalog-iframe[_ngcontent-%COMP%]{margin-top:16px;width:100%;height:500px;border:none}.eav-progress[_ngcontent-%COMP%]{position:absolute;left:0;top:0;height:100%;width:100%;background:#fffc;display:flex;justify-content:center;flex-direction:column;text-align:center}.eav-progress[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin:0 auto}.eav-progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:48px}
/*# sourceMappingURL=create-app-4YJSL6TC.css.map */`]})}}return t})();export{lt as CreateAppComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/create-app-HI3SRIZU.js.map
