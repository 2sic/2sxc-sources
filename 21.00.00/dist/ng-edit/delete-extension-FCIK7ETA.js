import{a as $}from"./chunk-U3KGODJQ.js";import{a as Z}from"./chunk-V7RAQGUV.js";import{a as q,b as H}from"./chunk-BKBBHERO.js";import"./chunk-JNRBLGLU.js";import{a as Q}from"./chunk-ZBQC6E3M.js";import"./chunk-AO43RQAG.js";import{c as G}from"./chunk-SCB2MVKQ.js";import"./chunk-4SMJHLGZ.js";import{a as U,b as z,d as J,e as X,f as Y}from"./chunk-HYUOS4CI.js";import"./chunk-ENHI5GWA.js";import"./chunk-IGMB27B5.js";import"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as P}from"./chunk-HCPBPEHV.js";import{f as L,l as R}from"./chunk-QVLOO535.js";import{c as N}from"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{f as V,k as O,v as K}from"./chunk-UMOPET3G.js";import"./chunk-EZZQWHAZ.js";import{b as I,c as k}from"./chunk-23CS2WID.js";import{a as A}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{c as F}from"./chunk-OYQCZWOE.js";import{b as W,c as j,g as B}from"./chunk-G33ZJSCE.js";import"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{Cb as h,Db as l,Eb as a,Fb as T,Gc as y,Nb as _,Pb as D,Rb as d,Sa as s,Za as p,db as b,ec as c,gc as M,ja as S,lc as C,mc as E,nc as v,oa as u,pa as g,wb as f,yb as x}from"./chunk-46QINP2S.js";import"./chunk-BDOJB7O2.js";function te(n,ee){if(n&1){let e=_();l(0,"p"),c(1),a(),l(2,"p")(3,"mat-slide-toggle",10),v("ngModelChange",function(t){u(e);let i=d();return E(i.withData,t)||(i.withData=t),g(t)}),c(4," With Data "),a()()}if(n&2){let e=d();s(),M("Caution: This app has ",e.totalLocalEntities()," local entities."),s(2),C("ngModel",e.withData)}}function ie(n,ee){if(n&1){let e=_();l(0,"mat-slide-toggle",10),v("ngModelChange",function(t){u(e);let i=d();return E(i.forceDelete,t)||(i.forceDelete=t),g(t)}),c(1," Force Delete "),a()}if(n&2){let e=d();C("ngModel",e.forceDelete)}}var Fe=(()=>{class n{#e;#t;constructor(e,o,t){this.route=e,this.dialogData=o,this.dialog=t,this.#e=S(P),this.#t=A(Z),this.extensionFolder=this.route.snapshot.paramMap.get("extension"),this.edition=this.route.snapshot.queryParamMap.get("edition")||"",this.withData=!1,this.forceDelete=!1,this.preflightResult=this.#t.preflightExtension(this.extensionFolder,this.edition).value,this.totalLocalEntities=y(()=>{let i=this.preflightResult();return i?.data?.contentTypes?i.data.contentTypes.map(r=>r.localEntities).reduce((r,m)=>r+m,0):0}),this.mustForceDelete=y(()=>{let i=this.preflightResult();if(!i)return!1;let r=i.summary,m=r.changed+r.added+r.missing;return i.files.some(w=>w.path.endsWith("App_Data/extension.json")&&w.status!=="missing")?i.foundLock?m>0?(this.askForce(`The extension has file changes (${m}).`),!0):this.totalLocalEntities()>0?(this.askForce(`The extension has ${this.totalLocalEntities()} local entities.`),!0):!1:(this.showError("Missing extension.lock.json. Deletion not allowed."),!0):!0})}ngOnInit(){this.#i()}#i(){this.dialog.keydownEvents().subscribe(e=>{G(e)&&(e.preventDefault(),this.deleteAndClose())})}closeDialog(e){this.#e.dismiss(),e?this.dialog.close(e):this.dialog.close()}deleteAndClose(){if(this.mustForceDelete()&&!this.forceDelete){this.showError('Deletion requires force. Please enable "Force Delete" and try again.');return}this.executeDelete(this.forceDelete)}askForce(e){this.#e.open(`${e}`,"",{duration:1e4})}executeDelete(e){this.#t.deleteExtension(this.extensionFolder,this.edition,e,this.withData).subscribe({next:()=>{this.#e.open("Extension deleted successfully","OK",{duration:3e3}),this.dialog.close(!0)},error:o=>{let t=o?.error?.exceptionMessage??"Delete failed.";this.showError(t)}})}showError(e){this.#e.open(e,"OK",{duration:8e3})}static{this.\u0275fac=function(o){return new(o||n)(p(F),p(j),p(W))}}static{this.\u0275cmp=b({type:n,selectors:[["app-delete-extension"]],decls:18,vars:6,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"expanded"],[3,"data"],[3,"ngModel"],["align","end"],["icon","delete",3,"action","label"],[3,"ngModelChange","ngModel"]],template:function(o,t){o&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),c(3),a(),l(4,"button",3),D("click",function(){return t.closeDialog()}),l(5,"mat-icon"),c(6,"close"),a()()(),l(7,"div",4)(8,"mat-accordion")(9,"mat-expansion-panel",5)(10,"mat-expansion-panel-header")(11,"mat-panel-title"),c(12,"Extension Details"),a()(),T(13,"app-inspect-extension-content",6),a()(),f(14,te,5,2),f(15,ie,2,1,"mat-slide-toggle",7),a(),l(16,"mat-dialog-actions",8)(17,"app-save-close-button-fab",9),D("action",function(){return t.deleteAndClose()}),a()()()),o&2&&(s(3),M("Delete ",t.extensionFolder),s(6),h("expanded",!1),s(4),h("data",t.preflightResult()),s(),x(t.totalLocalEntities()>0?14:-1),s(),x(t.mustForceDelete()?15:-1),s(2),h("label","Delete and close (ctrl + enter)"))},dependencies:[R,L,k,I,B,Q,H,q,K,V,O,Y,X,U,z,J,$,N],styles:[`mat-dialog-actions[_ngcontent-%COMP%]{gap:16px}
/*# sourceMappingURL=delete-extension-HKRP4AAQ.css.map */`]})}}return n})();export{Fe as DeleteExtensionComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/delete-extension-FCIK7ETA.js.map
