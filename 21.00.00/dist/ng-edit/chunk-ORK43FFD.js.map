{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/shared/routing/dialog-routing.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { ActivatedRoute, NavigationEnd, NavigationExtras, Router } from '@angular/router';\r\nimport { filter, map, pairwise, startWith, tap } from 'rxjs';\r\nimport { classLog } from '../logging';\r\nimport { ServiceBase } from '../services/service-base';\r\n\r\nconst logSpecs = {\r\n  doOnDialogClosed: true,\r\n};\r\n\r\n/**\r\n * Helper to handle dialog routings, especially:\r\n * 1. handling on-child-closed events (it also takes care of subscriptions)\r\n * 2. accessing the router and route - a very common task when you have dialogs\r\n */\r\n@Injectable()\r\nexport class DialogRoutingService extends ServiceBase {\r\n\r\n  log = classLog({ DialogRoutingService }, logSpecs);\r\n\r\n  constructor(\r\n    public router: Router,\r\n    public route: ActivatedRoute\r\n  ) { super(); }\r\n\r\n  get snapshot() { return this.route.snapshot; }\r\n\r\n  get url() { return this.router.url; }\r\n\r\n  get urlSegments() { return this.router.url.split('/'); }\r\n\r\n  getParam(key: string): string {\r\n    return this.route.snapshot.paramMap.get(key);\r\n  }\r\n\r\n  getParams<K extends string>(keys: K[]): Record<K, string> {\r\n    const paramMap = this.route.snapshot.paramMap;\r\n    return keys.reduce((acc, key) => {\r\n      acc[key] = paramMap.get(key);\r\n      return acc;\r\n    }, {} as Record<string, string>);\r\n  }\r\n\r\n  getQueryParam(key: string): string {\r\n    return this.route.snapshot.queryParamMap.get(key);\r\n  }\r\n\r\n  getQueryParams<K extends string>(keys: K[]): Record<K, string> {\r\n    const queryParamMap = this.route.snapshot.queryParamMap;\r\n    return keys.reduce((acc, key) => {\r\n      acc[key] = queryParamMap.get(key);\r\n      return acc;\r\n    }, {} as Record<string, string>);\r\n  }\r\n\r\n  state<T = any>() { return this.router.currentNavigation().extras?.state as T; }\r\n\r\n  /**\r\n   * Preferred way to register a callback, since the caller doesn't need to worry about subscriptions.\r\n   */\r\n  public doOnDialogClosed(callback: () => void) {\r\n    const l = this.log.fnIf('doOnDialogClosed');\r\n    this.subscriptions.add(\r\n      this.childDialogClosed$().subscribe((data: unknown) => {\r\n        l.a('Dialog closed', { data });\r\n        return callback();\r\n      })\r\n    );\r\n    l.end();\r\n  }\r\n\r\n  public doOnDialogClosedWithData(callback: (data: any) => void) {\r\n    const l = this.log.fnIf('doOnDialogClosed');\r\n    this.subscriptions.add(\r\n      this.#childDialogClosedWithData().subscribe(({ state }) => {\r\n        l.a('Dialog closed', { state });\r\n        callback(state);\r\n      })\r\n    );\r\n    l.end();\r\n  }\r\n\r\n  /**\r\n   * Get the URL for a sub-route of the current route.\r\n   */\r\n  public urlSubRoute(params: string) {\r\n    const tree = this.router.createUrlTree([params], { relativeTo: this.route });\r\n    const routeUrl = this.router.serializeUrl(tree);\r\n    return routeUrl;\r\n  }\r\n\r\n  /**\r\n   * Navigate to a new route.\r\n   * Just looks a bit simpler than the internal array notation.\r\n   */\r\n  public navPath(url: string, extras?: NavigationExtras): Promise<boolean> {\r\n    return this.router.navigate([url], extras);\r\n  }\r\n\r\n  /**\r\n   * Navigate relative to the current route.\r\n   */\r\n  public navRelative(commands: any[], extras?: Omit<NavigationExtras, 'relativeTo'>): Promise<boolean> {\r\n    return this.router.navigate(commands, { ...extras, relativeTo: this.route });\r\n  }\r\n\r\n  public childDialogClosed$() {\r\n    return this.router.events.pipe(\r\n      filter(event => event instanceof NavigationEnd),\r\n      startWith(!!this.route.snapshot.firstChild),\r\n      map(() => !!this.route.snapshot.firstChild),\r\n      pairwise(),\r\n      filter(([hadChildBefore, hasChildNow]) => hadChildBefore && !hasChildNow),\r\n    )\r\n  }\r\n\r\n  #childDialogClosedWithData() {\r\n    return this.router.events.pipe(\r\n      filter(event => event instanceof NavigationEnd),\r\n      tap(event => {\r\n        const l = this.log.fn(\"childDialogClosed$\", {\r\n          event,\r\n          firstChild: this.route.snapshot.firstChild,\r\n          snapShot: this.route.snapshot,\r\n          state: this.router.currentNavigation()?.extras.state,\r\n        });\r\n        l.a('NavigationEnd', { event });\r\n        l.end();\r\n      }),\r\n      startWith(!!this.route.snapshot.firstChild),\r\n      map(() => ({\r\n        hasChildNow: !!this.route.snapshot.firstChild,\r\n        state: this.router.currentNavigation()?.extras.state,\r\n      })),\r\n      pairwise(),\r\n      filter(([prev, curr]) => prev.hasChildNow && !curr.hasChildNow),\r\n      map(([prev, curr]) => ({\r\n        hadChildBefore: prev.hasChildNow,\r\n        hasChildNow: curr.hasChildNow,\r\n        state: curr.state\r\n      }))\r\n    );\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["logSpecs", "doOnDialogClosed", "DialogRoutingService", "ServiceBase", "constructor", "router", "route", "log", "classLog", "snapshot", "url", "urlSegments", "split", "getParam", "key", "paramMap", "get", "getParams", "keys", "reduce", "acc", "getQueryParam", "queryParamMap", "getQueryParams", "state", "currentNavigation", "extras", "callback", "l", "fnIf", "subscriptions", "add", "childDialogClosed$", "subscribe", "data", "a", "end", "doOnDialogClosedWithData", "#childDialogClosedWithData", "urlSubRoute", "params", "tree", "createUrlTree", "relativeTo", "serializeUrl", "navPath", "navigate", "navRelative", "commands", "__spreadProps", "__spreadValues", "events", "pipe", "filter", "event", "NavigationEnd", "startWith", "firstChild", "map", "pairwise", "hadChildBefore", "hasChildNow", "tap", "fn", "snapShot", "prev", "curr", "\u0275\u0275inject", "Router", "ActivatedRoute", "factory", "\u0275fac"]
}
