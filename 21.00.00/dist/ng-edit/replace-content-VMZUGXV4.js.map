{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/replace-content/replace-content.ts", "projects/eav-ui/src/app/replace-content/replace-content.html"],
  "sourcesContent": ["import { CdkFixedSizeVirtualScroll, CdkVirtualForOf, CdkVirtualScrollViewport } from '@angular/cdk/scrolling';\r\nimport { Component, HostBinding, model, OnInit } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatAutocompleteModule, MatAutocompleteSelectedEvent } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogActions, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { RouterOutlet } from '@angular/router';\r\nimport { convert, transient } from '../../../../core';\r\nimport { isCtrlEnter } from '../edit/dialog/main/keyboard-shortcuts';\r\nimport { ContentGroupAdd } from '../manage-content-list/models/content-group.model';\r\nimport { ContentGroupService } from '../manage-content-list/services/content-group.service';\r\nimport { TippyDirective } from '../shared/directives/tippy.directive';\r\nimport { convertFormToUrl } from '../shared/helpers/url-prep.helper';\r\nimport { EditForm, EditPrep } from '../shared/models/edit-form.model';\r\nimport { SaveCloseButtonFabComponent } from '../shared/modules/save-close-button-fab/save-close-button-fab';\r\nimport { DialogRoutingService } from '../shared/routing/dialog-routing.service';\r\nimport { computedObj, signalObj } from '../shared/signals/signal.utilities';\r\n\r\ninterface ReplaceOption {\r\n  id: number;\r\n  label: string;\r\n}\r\n\r\n@Component({\r\n    selector: 'app-replace-content',\r\n    templateUrl: './replace-content.html',\r\n    styleUrls: ['./replace-content.scss'],\r\n    imports: [\r\n        RouterOutlet,\r\n        MatFormFieldModule,\r\n        MatInputModule,\r\n        MatAutocompleteModule,\r\n        FormsModule,\r\n        CdkVirtualScrollViewport,\r\n        CdkFixedSizeVirtualScroll,\r\n        CdkVirtualForOf,\r\n        MatOptionModule,\r\n        MatButtonModule,\r\n        MatIconModule,\r\n        MatDialogActions,\r\n        TippyDirective,\r\n        SaveCloseButtonFabComponent,\r\n    ]\r\n})\r\nexport class ReplaceContentComponent implements OnInit {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  #contentGroupSvc = transient(ContentGroupService);\r\n  #dialogRoutes = transient(DialogRoutingService);\r\n\r\n  constructor(\r\n    private dialog: MatDialogRef<ReplaceContentComponent>,\r\n    private snackBar: MatSnackBar,\r\n  ) { }\r\n\r\n  #params = convert(this.#dialogRoutes.getParams(['guid', 'part', 'index']), p => ({\r\n    guid: p.guid,\r\n    part: p.part,\r\n    index: parseInt(p.index, 10),\r\n  }));\r\n\r\n  #contentTypeName: string;\r\n  \r\n  /** Mode is adding the to-be-selected item, not replace */\r\n  protected isAddMode = signalObj('isAddMode', !!this.#dialogRoutes.getQueryParam('add'));\r\n\r\n  /** The text being searched for */\r\n  filterText = model<string>('');\r\n\r\n  /** The options which could be used */\r\n  #optionsRaw = signalObj<ReplaceOption[]>('options', []);\r\n\r\n  /** The options after filtering */\r\n  options = computedObj<ReplaceOption[]>('filteredOptions', () => {\r\n    const filter = this.filterText().toLocaleLowerCase();\r\n    return this.#optionsRaw()\r\n      .filter(o => o.label.toLocaleLowerCase().includes(filter));\r\n  });\r\n\r\n  /** The system has a selected item, when the text exactly matches the label of an option */\r\n  canSave = computedObj<boolean>('isMatch', () => this.options().map(o => o.label).includes(this.filterText()));\r\n\r\n  ngOnInit() {\r\n    this.#watchKeyboardShortcuts();\r\n\r\n    this.#fetchConfig(false, null);\r\n\r\n    this.#dialogRoutes.doOnDialogClosed(() => {\r\n      const navigation = this.#dialogRoutes.router.getCurrentNavigation();\r\n      const editResult = navigation.extras?.state;\r\n      const cloneId: number = editResult?.[Object.keys(editResult)[0]];\r\n      this.#fetchConfig(true, cloneId);\r\n    });\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialog.close();\r\n  }\r\n\r\n  select(event: MatAutocompleteSelectedEvent) {\r\n    this.filterText.set(event.option.value);\r\n  }\r\n\r\n  copySelected() {\r\n    const contentGroup = this.#buildContentGroup();\r\n    const form: EditForm = {\r\n      items: [EditPrep.copy(this.#contentTypeName, contentGroup.id)],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.#dialogRoutes.navRelative([`edit/${formUrl}`]);\r\n  }\r\n\r\n  #fetchConfig(isRefresh: boolean, cloneId: number) {\r\n    const contentGroup = this.#buildContentGroup();\r\n    this.#contentGroupSvc.getItemsPromise(contentGroup).then(replaceConfig => {\r\n      const options = Object.entries(replaceConfig.Items)\r\n        .map(([itemId, itemName]) => ({\r\n          id: parseInt(itemId, 10),\r\n          label: `${itemName} (${itemId})`,\r\n        } satisfies ReplaceOption));\r\n      this.#optionsRaw.set(options);\r\n\r\n      // don't set selected option if dialog should be in add-mode and don't change selected option on refresh unless it's cloneId\r\n      if ((!contentGroup.add && !isRefresh) || cloneId != null) {\r\n        const newId = !isRefresh ? replaceConfig.SelectedId : cloneId;\r\n        const newFilter = this.#optionsRaw().find(o => o.id === newId)?.label || '';\r\n        this.filterText.set(newFilter);\r\n      }\r\n      this.#contentTypeName = replaceConfig.ContentTypeName;\r\n    });\r\n  }\r\n\r\n  #buildContentGroup() {\r\n    const filter = this.filterText();\r\n    const id = this.#optionsRaw().find(o => o.label === filter)?.id ?? null;\r\n\r\n    const contentGroup: ContentGroupAdd = {\r\n      id,\r\n      ...this.#params,\r\n      add: this.isAddMode(),\r\n    };\r\n    return contentGroup;\r\n  }\r\n  \r\n  saveAndClose() {\r\n    this.snackBar.open('Saving...');\r\n    const contentGroup = this.#buildContentGroup();\r\n    this.#contentGroupSvc.saveItem(contentGroup).subscribe(() => {\r\n      this.snackBar.open('Saved', null, { duration: 2000 });\r\n      this.closeDialog();\r\n    });\r\n  }\r\n  \r\n  #watchKeyboardShortcuts(): void {\r\n    this.dialog.keydownEvents().subscribe(event => {\r\n      if (isCtrlEnter(event) && this.canSave()) {\r\n        event.preventDefault();\r\n        this.saveAndClose();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n", "<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">\r\n      {{ isAddMode() ? 'Add Existing Item' : 'Replace Content Item' }}\r\n    </div>\r\n    <button mat-icon-button tippy=\"Close dialog\" (click)=\"closeDialog()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n  <div class=\"eav-dialog-content\">\r\n    <router-outlet></router-outlet>\r\n    <p>{{isAddMode()\r\n      ? 'Select a content-item to add to this list.'\r\n      : 'By replacing a content-item you can make other content appear in the slot of the original content.'}}\r\n    </p>\r\n    <div class=\"eav-options-box\">\r\n      <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n        <mat-label>Choose item</mat-label>\r\n        <!-- Search field -->\r\n        <input matInput [matAutocomplete]=\"auto\" [(ngModel)]=\"filterText\"> \r\n        <!-- Auto-Complete list based on search -->\r\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"select($event)\"\r\n          [hideSingleSelectionIndicator]=\"true\">\r\n          <cdk-virtual-scroll-viewport itemSize=\"48\" minBufferPx=\"500\" maxBufferPx=\"1000\"\r\n            [style.height.px]=\"options().length < 6 ? options().length * 48 : 240\"\r\n          >\r\n            <mat-option *cdkVirtualFor=\"let option of options()\" [value]=\"option.label\">{{ option.label }}</mat-option>\r\n          </cdk-virtual-scroll-viewport>\r\n        </mat-autocomplete>\r\n      </mat-form-field>\r\n      <!-- Copy Button -->\r\n      <button\r\n        mat-icon-button\r\n        tippy=\"Create a Copy\"\r\n        tippyPlacement=\"top\"\r\n        [disabled]=\"!canSave()\"\r\n        (click)=\"copySelected()\"\r\n      >\r\n        <mat-icon>file_copy</mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n  <!-- Close / Save -->\r\n  <mat-dialog-actions align=\"end\">\r\n    <app-save-close-button-fab\r\n      [ngClass]=\"!canSave() ? 'disabled' : ''\"\r\n      [disabled]=\"!canSave()\"\r\n      (action)=\"saveAndClose()\"\r\n    />\r\n  </mat-dialog-actions>\r\n</div>\r\n"],
  "mappings": "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",
  "names": ["\u0275\u0275elementStart", "\u0275\u0275text", "\u0275\u0275elementEnd", "\u0275\u0275property", "option_r2", "label", "\u0275\u0275advance", "\u0275\u0275textInterpolate", "ReplaceContentComponent", "#contentGroupSvc", "#dialogRoutes", "constructor", "dialog", "snackBar", "hostClass", "transient", "ContentGroupService", "DialogRoutingService", "#params", "convert", "getParams", "p", "guid", "part", "index", "parseInt", "isAddMode", "signalObj", "getQueryParam", "filterText", "model", "#optionsRaw", "options", "computedObj", "filter", "toLocaleLowerCase", "o", "includes", "canSave", "map", "#contentTypeName", "ngOnInit", "#watchKeyboardShortcuts", "#fetchConfig", "doOnDialogClosed", "editResult", "router", "getCurrentNavigation", "extras", "state", "cloneId", "Object", "keys", "closeDialog", "close", "select", "event", "set", "option", "value", "copySelected", "contentGroup", "#buildContentGroup", "form", "items", "EditPrep", "copy", "id", "formUrl", "convertFormToUrl", "navRelative", "isRefresh", "getItemsPromise", "then", "replaceConfig", "entries", "Items", "itemId", "itemName", "add", "newId", "SelectedId", "newFilter", "find", "ContentTypeName", "__spreadProps", "__spreadValues", "saveAndClose", "open", "saveItem", "subscribe", "duration", "keydownEvents", "isCtrlEnter", "preventDefault", "\u0275\u0275directiveInject", "MatDialogRef", "MatSnackBar", "selectors", "hostVars", "hostBindings", "rf", "ctx", "\u0275\u0275domProperty", "\u0275\u0275listener", "i0", "\u0275\u0275restoreView", "_r1", "\u0275\u0275resetView", "\u0275\u0275element", "\u0275\u0275twoWayListener", "$event", "\u0275\u0275twoWayBindingSet", "\u0275\u0275template", "ReplaceContentComponent_mat_option_19_Template", "\u0275\u0275textInterpolate1", "auto_r3", "\u0275\u0275twoWayProperty", "\u0275\u0275styleProp", "length", "RouterOutlet", "MatFormFieldModule", "MatFormField", "MatLabel", "MatInputModule", "MatInput", "MatAutocompleteModule", "MatAutocomplete", "MatOption", "MatAutocompleteTrigger", "FormsModule", "DefaultValueAccessor", "NgControlStatus", "NgModel", "CdkVirtualScrollViewport", "CdkFixedSizeVirtualScroll", "CdkVirtualForOf", "MatOptionModule", "MatButtonModule", "MatIconButton", "MatIconModule", "MatIcon", "MatDialogActions", "TippyDirective", "SaveCloseButtonFabComponent", "styles"]
}
