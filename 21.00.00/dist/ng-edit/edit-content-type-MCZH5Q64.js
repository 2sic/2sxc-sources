import{a as E}from"./chunk-VTBPXANR.js";import{b as bt}from"./chunk-DDUEZMYJ.js";import{a as ft}from"./chunk-WCNLNRUK.js";import{a as _t}from"./chunk-LOXR3JJX.js";import"./chunk-JNRBLGLU.js";import{a as yt}from"./chunk-ZBQC6E3M.js";import"./chunk-AO43RQAG.js";import{c as Ct}from"./chunk-SCB2MVKQ.js";import"./chunk-4SMJHLGZ.js";import{c as Y}from"./chunk-HJXR3IL7.js";import{b as pt,c as ct}from"./chunk-ODL7UGWI.js";import{a as vt,b as St,c as Tt,d as xt,e as Et,f as Mt}from"./chunk-HYUOS4CI.js";import"./chunk-ENHI5GWA.js";import{a as ht,c as gt}from"./chunk-DAEXUMJT.js";import"./chunk-IGMB27B5.js";import{e as dt,h as ut}from"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as K}from"./chunk-HCPBPEHV.js";import{f as $,l as G}from"./chunk-QVLOO535.js";import{c as mt}from"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{b as tt,f as et,g as nt,i as it,k as ot,l as at,r as rt,s as st,v as lt}from"./chunk-UMOPET3G.js";import{b as U,e as z,i as Q,j as Z}from"./chunk-4LV77BQU.js";import{a as C,b as J}from"./chunk-RGKBOUPL.js";import"./chunk-EZZQWHAZ.js";import{b as H,c as q}from"./chunk-23CS2WID.js";import{a as j}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{c as R}from"./chunk-OYQCZWOE.js";import{b as W,g as X}from"./chunk-G33ZJSCE.js";import{aa as L}from"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$b as x,Aa as b,Ab as k,Bb as w,Cb as p,Db as o,Eb as a,Fb as T,Gc as B,Nb as V,Ob as O,Pb as m,Rb as c,Sa as r,Vb as A,Wb as D,Xb as F,Za as S,db as N,ec as s,fc as P,gc as v,oa as u,pa as f,wb as h,yb as g,zb as I}from"./chunk-46QINP2S.js";import{a as _,b as y}from"./chunk-BDOJB7O2.js";var wt=/(^[A-Za-z][A-Za-z0-9]*$)|(^@[A-Za-z][A-Za-z0-9\-]*$)/,Nt=wt.toString(),Vt=Nt.substring(1,Nt.toString().length-1),It=Vt,kt="Standard letters and numbers are allowed. Must start with a letter.";var Ot=["ngForm"];function At(i,d){i&1&&(o(0,"app-field-hint",19),s(1,"This field is required"),a()),i&2&&p("isError",!0)}function Dt(i,d){if(i&1&&(o(0,"app-field-hint",19),s(1),a()),i&2){let t=c(3);p("isError",!0),r(),P(t.contentTypeNameError)}}function Ft(i,d){if(i&1&&(h(0,At,2,1,"app-field-hint",19),h(1,Dt,2,2,"app-field-hint",19)),i&2){c();let t=x(9);g(t.errors.required?0:-1),r(),g(t.errors.pattern?1:-1)}}function Pt(i,d){if(i&1&&(o(0,"mat-option",13),s(1),a()),i&2){let t=d.$implicit;p("value",t.value),r(),v(" ",t.name," ")}}function Bt(i,d){if(i&1&&(o(0,"div",8)(1,"h3"),s(2,"Shared Content Type (Ghost)"),a(),o(3,"p"),s(4,"Note: this can't be edited in the UI, for now if you really know what you're doing, do it in the DB"),a(),o(5,"p"),s(6),a()()),i&2){let t=c(2);r(6),v("Uses Type Definition of: ",t.contentType().SharedDefId)}}function Rt(i,d){if(i&1){let t=V();o(0,"form",6,0),m("ngSubmit",function(){u(t);let n=c();return f(n.saveAndClose())}),o(2,"div",7)(3,"div")(4,"div",8)(5,"mat-form-field",9)(6,"mat-label"),s(7,"Name"),a(),o(8,"input",10,1),m("ngModelChange",function(n){u(t);let l=c();return f(l.changeContentTypeName(n))}),a()(),h(10,Ft,2,2),a(),o(11,"mat-accordion")(12,"mat-expansion-panel")(13,"mat-expansion-panel-header")(14,"mat-panel-title"),s(15,"Advanced"),a(),T(16,"mat-panel-description"),a(),o(17,"div",8)(18,"div",11)(19,"mat-form-field",9)(20,"mat-label"),s(21,"Scope"),a(),o(22,"mat-select",12),m("ngModelChange",function(n){u(t);let l=c();return f(l.changeScope(n))}),k(23,Pt,2,2,"mat-option",13,I),o(25,"mat-option",13),s(26,"Other..."),a()()(),o(27,"button",14),m("click",function(){u(t);let n=c();return f(n.unlockScope())}),o(28,"mat-icon"),s(29),a()()(),o(30,"app-field-hint"),s(31," The scope should almost never be changed - "),o(32,"a",15),s(33,"see help"),a()()(),o(34,"div",8)(35,"mat-form-field",9)(36,"mat-label"),s(37,"Static Name"),a(),T(38,"input",16),a()(),h(39,Bt,7,1,"div",8),a()()()(),o(40,"mat-dialog-actions",17)(41,"app-save-close-button-fab",18),m("action",function(){u(t);let n=c();return f(n.saveAndClose())}),a()()()}if(i&2){let t=x(9),e=c();r(8),p("pattern",e.contentTypeNamePattern)("ngModel",e.contentType().Name),r(2),g(t.touched&&t.errors?10:-1),r(),p("@.disabled",e.disableAnimation()),r(11),p("ngModel",e.contentType().Scope)("disabled",e.lockScope()),r(),w(e.scopeOptions()),r(2),p("value",e.dropdownInsertValue),r(2),p("tippy",e.lockScope()?"Unlock":"Lock"),r(2),v(" ",e.lockScope()?"lock":"lock_open"," "),r(9),p("ngModel",e.contentType().NameId),r(),g(e.contentType().SharedDefId?39:-1),r(2),p("triggerOnFormSubmit",!0)("ngClass",e.canSave()?"":"disabled")("disabled",!e.canSave())}}var Ee=(()=>{class i{#e;#t;#n;constructor(t,e,n){this.dialog=t,this.route=e,this.snackBar=n,this.log=L({EditContentTypeComponent:i}),this.hostClass="dialog-component",this.#e=j(bt),this.#t=this.route.snapshot.parent.paramMap.get("scope"),this.#n=this.route.snapshot.paramMap.get("contentTypeStaticName"),this.contentTypeNamePattern=It,this.contentTypeNameError=kt,this.dropdownInsertValue=E,this.modeIsEdit=!!this.#n,this.lockScope=C("lockScope",!0),this.disableAnimation=C("disableAnimation",!0),this.loading=C("loading",!1),this.formValid=b(!1),this.canSave=B(()=>this.formValid()&&!this.loading()),this.contentType=C("contentType",{StaticName:"",Name:"",Description:"",Scope:this.#t,ChangeNameId:!1,NewNameId:""}),this.#o=this.#e.getScopesSig(),this.#i=C("scopeOptionsManual",[]),this.scopeOptions=J("scopeOptions",()=>{let l=this.#o(),M=this.#i();return l?M.concat(this.#r(l)):M}),this.log.a("constructor"),this.#a()}ngOnInit(){this.#s()}#a(){this.modeIsEdit&&this.#e.retrieveContentType(this.#n).subscribe(t=>{this.contentType.set(y(_({},t),{ChangeNameId:!1,NewNameId:t.NameId}))})}#o;#i;#r(t){let e=[];return t.forEach(n=>{e.some(l=>l.value===n.value)||e.push(n)}),e.some(n=>n.value===this.#t)||e.push({name:this.#t,value:this.#t}),e}ngAfterViewInit(){this.ngForm?.form.statusChanges.subscribe(()=>{this.formValid.set(this.ngForm?.form.valid??!1)}),setTimeout(()=>this.disableAnimation.set(!1))}closeDialog(){this.dialog.close()}changeContentTypeName(t){this.contentType.set(y(_({},this.contentType()),{Name:t}))}changeScope(t){t===E&&(t=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||Y.scopes.default.value,this.scopeOptions().some(e=>e.value===t)||this.#i.set([{name:t,value:t},...this.scopeOptions()])),this.contentType.set(y(_({},this.contentType()),{Scope:t}))}unlockScope(){this.lockScope.set(!this.lockScope()),this.lockScope()&&this.contentType.set(y(_({},this.contentType()),{Scope:this.#t}))}saveAndClose(){this.loading.set(!0),this.snackBar.open("Saving..."),this.#e.save(this.contentType()).subscribe(t=>{this.loading.set(!1),this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()}),document.activeElement instanceof HTMLElement&&document.activeElement.blur()}#s(){this.dialog.keydownEvents().subscribe(t=>{Ct(t)&&this.canSave()&&(t.preventDefault(),this.saveAndClose())})}static{this.\u0275fac=function(e){return new(e||i)(S(W),S(R),S(K))}}static{this.\u0275cmp=N({type:i,selectors:[["app-edit-content-type"]],viewQuery:function(e,n){if(e&1&&A(Ot,5),e&2){let l;D(l=F())&&(n.ngForm=l.first)}},hostVars:1,hostBindings:function(e,n){e&2&&O("className",n.hostClass)},decls:8,vars:2,consts:[["ngForm","ngForm"],["name","ngModel"],[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[3,"ngSubmit"],[1,"eav-dialog-content"],[1,"eav-edit-input"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","required","","name","Name",3,"ngModelChange","pattern","ngModel"],[1,"eav-form-and-button"],["name","Scope",3,"ngModelChange","ngModel","disabled"],[3,"value"],["mat-icon-button","","type","button","matTextSuffix","",1,"eav-scope-button",3,"click","tippy"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["matInput","","type","text","name","StaticName","disabled","",3,"ngModel"],["align","end"],[3,"action","triggerOnFormSubmit","ngClass","disabled"],[3,"isError"]],template:function(e,n){e&1&&(o(0,"div",2)(1,"div",3)(2,"div",4),s(3),a(),o(4,"button",5),m("click",function(){return n.closeDialog()}),o(5,"mat-icon"),s(6,"close"),a()()(),h(7,Rt,42,14,"form"),a()),e&2&&(r(3),v(" ",n.modeIsEdit?"Edit Content Type":"New Content Type"," "),r(4),g(n.contentType()?7:-1))},dependencies:[lt,at,tt,et,nt,rt,st,ot,it,Z,Q,U,z,ct,pt,Mt,Et,vt,St,xt,Tt,gt,ht,dt,ut,G,$,q,H,X,_t,ft,mt,yt],styles:[`.eav-edit-input[_ngcontent-%COMP%]{padding-bottom:8px}.eav-form-and-button[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between}.eav-form-and-button[_ngcontent-%COMP%]   .eav-scope-button[_ngcontent-%COMP%]{margin-left:8px}
/*# sourceMappingURL=edit-content-type-PUOC2MTS.css.map */`]})}}return i})();export{Ee as EditContentTypeComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/edit-content-type-MCZH5Q64.js.map
