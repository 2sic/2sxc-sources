import{a as Re}from"./chunk-GLFISIX2.js";import{a as Oe}from"./chunk-MBSXBYF5.js";import{a as Ne}from"./chunk-AAMPB3UT.js";import{a as Pe,b as Ae,c as Ee}from"./chunk-56YE37V6.js";import{a as re,b as se}from"./chunk-T7AKPKMZ.js";import{a as Ve}from"./chunk-4YE3E6NH.js";import{a as ke}from"./chunk-4SMJHLGZ.js";import{b as Se,c as Ie}from"./chunk-ODL7UGWI.js";import{c as he}from"./chunk-HCPBPEHV.js";import{f as ge,h as fe,l as _e}from"./chunk-QVLOO535.js";import{b as ye,d as R,f as Te,g as De,l as Me,n as we,o as be,t as Fe,w as Ue}from"./chunk-UMOPET3G.js";import{b as ce,i as ue}from"./chunk-4LV77BQU.js";import{b as pe,c as de}from"./chunk-23CS2WID.js";import{a as k}from"./chunk-OIHIMR2W.js";import{b as Ce,c as ve,h as xe}from"./chunk-G33ZJSCE.js";import{ca as me}from"./chunk-DX662RXJ.js";import{$ as M,$b as X,Aa as w,Ab as E,Ac as I,B as H,Bb as O,Cb as u,Cd as le,Db as n,Eb as r,F as x,Fb as _,H as j,Lc as ie,M as $,Nb as v,Oa as U,Ob as Q,Pb as h,Qa as W,Rb as p,Sa as l,Tc as oe,Vb as q,Wb as K,Xb as Y,Y as F,Za as T,db as L,ea as z,ec as s,fc as Z,fd as ne,gc as N,ia as G,ib as J,ja as P,oa as g,p as D,pa as f,u as b,uc as ee,vc as te,wb as d,xd as ae,yb as m,zb as A,zc as S}from"./chunk-46QINP2S.js";var B=(function(t){return t.importOriginal="importOriginal",t.importAsTemplate="importAsTemplate",t})(B||{}),Be={Warning:0,Success:1,Error:2},He={App:0,AppPart:1,ContentType:2,ContentItem:3,Query:4,View:5,ImportParts:6,Extension:7};var V=class{constructor(a){this.moduleId=a,this.alreadyProcessing=!1,this.messages$=H(window,"message").pipe(M(e=>console.log("debug: received window message",e,this.moduleId)),x(()=>!this.alreadyProcessing),x(e=>e.origin==="https://2sxc.org"),b(e=>{try{return JSON.parse(e.data)}catch(o){console.error("error procesing message. Message was "+e.data,o);return}}),x(e=>e&&Number(e.moduleId)===this.moduleId),M(e=>console.log("debug: processed 2sxc.org message",e)))}};var je=(()=>{class t{constructor(e){this.http=e}installPackages(e,o){return e.reduce((i,c)=>i.pipe(F(()=>c.url?(o(c),this.http.post(`sys/install/RemotePackage?packageUrl=${c.url}`,{})):D(!0))),D(!0))}static{this.\u0275fac=function(o){return new(o||t)(G(ae))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();var ze=["installerWindow"],Ge=(t,a)=>({"outer-container-app":t,"eav-dialog-content":a}),We=(t,a,e)=>({"sxc-message-warning":t,"sxc-message-success":a,"sxc-message-error":e});function Le(t,a){if(t&1){let e=v();n(0,"div",3),_(1,"div",12),S(2,"safeHtml"),n(3,"button",13),h("click",function(){g(e);let i=p();return f(i.closeDialog())}),n(4,"mat-icon"),s(5,"close"),r()()()}if(t&2){let e=p();l(),u("innerHtml",I(2,1,e.dialogData.title),U)}}function Je(t,a){if(t&1&&(_(0,"h3",5),S(1,"safeHtml")),t&2){let e=p();u("innerHtml",I(1,1,e.dialogData.title),U)}}function Qe(t,a){t&1&&_(0,"mat-spinner",6)}function qe(t,a){t&1&&(n(0,"span"),s(1," The app will be imported as is, using the original name and folder. "),r(),n(2,"span"),s(3," If you already have the same app installed, it will prevent you from overwriting it. "),r())}function Ke(t,a){t&1&&(n(0,"span"),s(1," The app will be imported using a new name / folder. "),r(),n(2,"span"),s(3," This allows you to create multiple isolated copies of the same app or to create something very different using this app as a template. "),r(),_(4,"br"),n(5,"mat-form-field",17)(6,"mat-label"),s(7,"Name"),r(),_(8,"input",18),r())}function Ye(t,a){if(t&1&&(n(0,"form",14)(1,"mat-radio-group",15)(2,"mat-radio-button",16),s(3," Import App(s) "),r(),n(4,"mat-radio-button",16),s(5," Import and Rename / Reset "),r()(),_(6,"br"),d(7,qe,4,0)(8,Ke,9,0),r(),_(9,"br")),t&2){let e,o=p();u("formGroup",o.importForm),l(2),u("value",o.importModeValues.importOriginal),l(2),u("value",o.importModeValues.importAsTemplate),l(3),m(((e=o.importForm.get("importMode"))==null?null:e.value)===o.importModeValues.importOriginal?7:((e=o.importForm.get("importMode"))==null?null:e.value)===o.importModeValues.importAsTemplate?8:-1)}}function Xe(t,a){t&1&&(n(0,"div"),s(1,"Select or drop file"),r())}function Ze(t,a){if(t&1&&(n(0,"div"),s(1),r()),t&2){let e=a.$implicit;l(),Z(e.name)}}function et(t,a){if(t&1){let e=v();n(0,"button",19),h("click",function(){g(e);let i=p();return f(i.toggleShowAppCatalog())}),s(1," Get recommended Apps from Catalog "),r()}if(t&2){let e=p();u("disabled",e.uploading()||e.importForm.invalid)}}function tt(t,a){if(t&1){let e=v();n(0,"button",20),h("click",function(){g(e);let i=p();return f(i.upload())}),s(1," Upload "),r()}if(t&2){let e=p();u("disabled",!e.files().length||e.uploading()||!!e.result()||e.importForm.invalid)}}function it(t,a){if(t&1){let e=v();n(0,"a",25),h("click",function(){g(e);let i=p(3);return f(i.closeDialog(!0))}),s(1,"Close"),r()}}function ot(t,a){if(t&1){let e=v();n(0,"a",25),h("click",function(){g(e);let i=p(3);return f(i.cleanUpload())}),s(1,"Clean"),r()}}function nt(t,a){if(t&1&&(n(0,"div",21),s(1," Upload succeeded. See the messages below for more information. "),d(2,it,2,0,"a",24)(3,ot,2,0,"a",24),r()),t&2){let e=p(2);l(2),m(e.uploadType()!=e.UploadTypes.ImportParts?2:3)}}function at(t,a){if(t&1){let e=v();n(0,"a",25),h("click",function(){g(e);let i=p(3);return f(i.closeDialog(!0))}),s(1,"Close"),r()}}function lt(t,a){if(t&1){let e=v();n(0,"a",25),h("click",function(){g(e);let i=p(3);return f(i.cleanUpload())}),s(1,"Clean"),r()}}function rt(t,a){if(t&1&&(n(0,"div",22),s(1," Upload failed. See the messages below for more information. "),d(2,at,2,0,"a",24)(3,lt,2,0,"a",24),r()),t&2){let e=p(2);l(2),m(e.uploadType()!=e.UploadTypes.ImportParts?2:3)}}function st(t,a){if(t&1&&(n(0,"div",23),s(1),r()),t&2){let e=a.$implicit,o=p(2);u("ngClass",te(2,We,e.MessageType===o.FileUploadMessageTypes.Warning,e.MessageType===o.FileUploadMessageTypes.Success,e.MessageType===o.FileUploadMessageTypes.Error)),l(),N(" ",e.Text," ")}}function pt(t,a){if(t&1&&(n(0,"div",11),d(1,nt,4,1,"div",21),d(2,rt,4,1,"div",22),E(3,st,2,6,"div",23,A),r()),t&2){let e=p();l(),m(e.result().Success?1:-1),l(),m(e.result().Success?-1:2),l(),O(e.result().Messages)}}function dt(t,a){if(t&1&&_(0,"iframe",26,1),t&2){let e=p(2);u("src",e.remoteInstallerUrl,W)}}function mt(t,a){if(t&1&&(n(0,"div",27),_(1,"mat-progress-spinner",28),n(2,"span"),s(3),r()()),t&2){let e=p(2);l(),u("mode","indeterminate"),l(2),N(" Installing ",e.currentPackage==null?null:e.currentPackage.displayName,".. ")}}function ct(t,a){if(t&1&&(d(0,dt,2,1,"iframe",26),d(1,mt,4,2,"div",27)),t&2){let e=p();m(e.ready?0:-1),l(),m(e.showProgress?1:-1)}}var ii=(()=>{class t extends ke{#t;#e;#i;#o;constructor(e,o,i,c,y){super(),this.dialogData=e,this.dialog=o,this.snackBar=i,this.sanitizer=c,this.changeDetectorRef=y,this.hostClass="dialog-component",this.uploadType=ie(),this.uploading=w(!1),this.showAppCatalog=w(!1),this.result=w(void 0),this.files=w([]),this.FileUploadMessageTypes=Be,this.UploadTypes=He,this.importModeValues=B,this.showProgress=!1,this.remoteInstallerUrl="",this.urlChangeImportMode="",this.ready=!1,this.#t=k(je),this.#e=k(Re),this.#i=k(Oe),this.#o=P(Fe),this.importForm=this.#o.group({importMode:[this.importModeValues.importOriginal,R.required],name:[""]}),this.context=P(me),this.messages=new V(this.context.moduleId),this.subscriptions.add(this.#e.settings$.subscribe(C=>{this.settings=C,this.urlChangeImportMode=C.remoteUrl,this.remoteInstallerUrl=this.sanitizer.bypassSecurityTrustResourceUrl(C.remoteUrl),this.ready=!0})),this.#a()}ngOnInit(){this.importForm.get("importMode")?.valueChanges.subscribe(e=>{let o=e===this.importModeValues.importAsTemplate,i=this.urlChangeImportMode+(this.urlChangeImportMode.includes("?")?"&":"?")+`selectOnlyMode=${o}`;this.remoteInstallerUrl=this.sanitizer.bypassSecurityTrustResourceUrl(i)}),this.dialogData.files!=null&&this.filesDropped(this.dialogData.files),this.#e.loadGettingStarted(!1),this.subscriptions.add(this.messages.messages$.pipe(x(e=>e.action==="specs")).subscribe(()=>{let e=this.installerWindow.nativeElement,o={action:"specs",data:{installedApps:this.settings.installedApps,rules:this.settings.installedApps.map(c=>({target:"guid",appGuid:c.guid,mode:"f",url:""}))}},i=JSON.stringify(o);e.contentWindow.postMessage(i,"*"),console.log("debug: just sent specs message #2:"+i,o,e)})),this.subscriptions.add(this.messages.messages$.pipe(x(e=>e.action==="install"),b(e=>Object.values(e.packages)),x(e=>{let i=`Do you want to install these packages?

${e.reduce((c,y)=>`${c} - ${y.displayName}
`,"")}
This takes about 10 seconds per package. Don't reload the page while it's installing.`;return confirm(i)}),F(e=>(this.messages.alreadyProcessing=!0,this.showProgress=!0,this.changeDetectorRef.detectChanges(),this.importForm.get("importMode")?.value===this.importModeValues.importAsTemplate?this.#i.createTemplate(e[0].url,this.importForm.get("name")?.value):this.#t.installPackages(e,o=>this.currentPackage=o))),M(()=>{this.showProgress=!1,this.changeDetectorRef.detectChanges(),alert("Installation complete \u{1F44D}"),window.top.location.reload(),this.closeDialog(!0)}),j(e=>{console.error("Error: ",e),this.showProgress=!1,this.messages.alreadyProcessing=!1,this.changeDetectorRef.detectChanges();let o=`An error occurred: Package ${this.currentPackage.displayName}

${e.error?.Message??e.error?.message??""}

${e.message}

Please try again later or check how to manually install content-templates: https://azing.org/2sxc/r/0O4OymoA`;return alert(o),D(e)})).subscribe())}ngOnDestroy(){super.ngOnDestroy()}closeDialog(e){this.dialog.close(e)}cleanUpload(){this.result.set(void 0),this.files.set([]),this.uploading.set(!1)}#a(){let e=this.importForm.get("name");this.importForm.get("importMode")?.valueChanges.subscribe(o=>{let i=o===this.importModeValues.importAsTemplate;e?.setValidators(i?[R.required]:null),e?.updateValueAndValidity()})}filesDropped(e){this.#n(e)}filesChanged(e){let o=e.target.files,i=Array.from(o);this.#n(i)}upload(){this.uploading.set(!0);let e=this.importForm.get("name")?.value;this.subscriptions.add(this.dialogData.upload$(this.files(),e).pipe($(1)).subscribe({next:o=>{this.uploading.set(!1),this.result.set(o)},error:()=>{this.uploading.set(!1),this.result.set(void 0),this.snackBar.open("Upload failed. Please check console for more information",void 0,{duration:3e3})}}))}toggleShowAppCatalog(){this.showAppCatalog.set(!this.showAppCatalog())}#n(e){this.dialogData.multiple||(e=e.slice(0,1)),this.files.set(e)}static{this.\u0275fac=function(o){return new(o||t)(T(ve),T(Ce),T(he),T(le),T(oe))}}static{this.\u0275cmp=L({type:t,selectors:[["app-file-upload-dialog"]],viewQuery:function(o,i){if(o&1&&q(ze,5),o&2){let c;K(c=Y())&&(i.installerWindow=c.first)}},hostVars:1,hostBindings:function(o,i){o&2&&Q("className",i.hostClass)},inputs:{uploadType:[1,"uploadType"]},features:[J],decls:19,vars:18,consts:[["fileInput",""],["installerWindow",""],["appDragAndDrop","",1,"eav-dialog",2,"margin-bottom","12px",3,"filesDropped","allowedFileTypes"],[1,"eav-dialog-header"],[3,"ngClass"],[3,"innerHtml"],["mode","indeterminate","diameter","20"],["mat-raised-button","","tippy","Open file browser",3,"click","disabled"],["type","file","multiple","",1,"hide",3,"change"],["mat-raised-button","","tippy","Open app catalog",1,"eav-app-catalog-button","eav-action-button",3,"disabled"],["mat-raised-button","",1,"eav-action-button",2,"margin-left","12px",3,"disabled"],[1,"eav-result-container"],[1,"eav-dialog-header__title",3,"innerHtml"],["mat-icon-button","","tippy","Close dialog",3,"click"],[3,"formGroup"],["formControlName","importMode","aria-label","Select import mode"],[3,"value"],["color","accent",1,"eav-mat-form-field",2,"max-width","300px"],["matInput","","type","text","formControlName","name"],["mat-raised-button","","tippy","Open app catalog",1,"eav-app-catalog-button","eav-action-button",3,"click","disabled"],["mat-raised-button","",1,"eav-action-button",2,"margin-left","12px",3,"click","disabled"],[1,"sxc-message","sxc-message-info"],[1,"sxc-message","sxc-message-error"],[1,"sxc-message",3,"ngClass"],["href","javascript:void(0)"],["href","javascript:void(0)",3,"click"],[1,"eav-app-catalog-iframe",3,"src"],[1,"eav-progress"],[3,"mode"]],template:function(o,i){if(o&1){let c=v();n(0,"div",2),h("filesDropped",function(C){return g(c),f(i.filesDropped(C))}),d(1,Le,6,3,"div",3),n(2,"div",4),d(3,Je,2,3,"h3",5),d(4,Qe,1,0,"mat-spinner",6),_(5,"p",5),S(6,"safeHtml"),d(7,Ye,10,4),n(8,"div")(9,"button",7),h("click",function(){g(c);let C=X(14);return f(C.click())}),d(10,Xe,2,0,"div"),E(11,Ze,2,1,"div",null,A),r(),n(13,"input",8,0),h("change",function(C){return g(c),f(i.filesChanged(C))}),r(),d(15,et,2,1,"button",9),d(16,tt,2,1,"button",10),r(),d(17,pt,5,2,"div",11),d(18,ct,2,2),r()()}o&2&&(u("allowedFileTypes",i.dialogData.allowedFileTypes),l(),m(i.uploadType()!=i.UploadTypes.ImportParts?1:-1),l(),u("ngClass",ee(15,Ge,i.uploadType()===i.UploadTypes.ImportParts,i.uploadType()!==i.UploadTypes.ImportParts)),l(),m(i.uploadType()==i.UploadTypes.ImportParts?3:-1),l(),m(i.uploading()?4:-1),l(),u("innerHtml",I(6,13,i.dialogData.description),U),l(2),m(i.uploadType()==i.UploadTypes.App?7:-1),l(2),u("disabled",i.uploading()||i.importForm.invalid),l(),m(i.files().length?-1:10),l(),O(i.files()),l(4),m(i.uploadType()==i.UploadTypes.App&&!i.files().length?15:-1),l(),m(i.files().length?16:-1),l(),m(i.result()?17:-1),l(),m(i.uploadType()==i.UploadTypes.App&&i.showAppCatalog()&&!i.files().length&&i.importForm.valid?18:-1))},dependencies:[ne,xe,se,re,Ne,_e,fe,ge,de,pe,Ee,Pe,Ae,Ie,Se,ue,ce,Ue,Me,ye,Te,De,be,we,Ve],styles:[`[_nghost-%COMP%]     .eav-dialog a{color:#465da3!important}.eav-result-container[_ngcontent-%COMP%]{margin-top:16px}.eav-app-catalog-button[_ngcontent-%COMP%]{margin-left:12px}.eav-app-catalog-iframe[_ngcontent-%COMP%]{margin-top:16px;width:100%;height:500px;border:none}.eav-progress[_ngcontent-%COMP%]{position:absolute;left:0;top:0;height:100%;width:100%;background:#fffc;display:flex;justify-content:center;flex-direction:column;text-align:center}.eav-progress[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin:0 auto}.eav-progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:48px}.outer-container-app[_ngcontent-%COMP%]{padding:0 24px}
/*# sourceMappingURL=file-upload-dialog-7YPKWFJJ.css.map */`]})}}return t})();export{B as a,Be as b,He as c,V as d,ii as e};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/chunk-HW433KCS.js.map
