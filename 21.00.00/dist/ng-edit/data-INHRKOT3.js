import{a as Ke}from"./chunk-CPCBBVMU.js";import{a as qe}from"./chunk-FIBQFWU3.js";import{a as Ye}from"./chunk-PSAFKHUD.js";import{a as je}from"./chunk-WO7E65AC.js";import{a as H}from"./chunk-3IXEXCJT.js";import{a as Je}from"./chunk-SXZJT35J.js";import{a as W}from"./chunk-VTBPXANR.js";import{b as We}from"./chunk-O3YSC345.js";import{a as He}from"./chunk-AAMPB3UT.js";import{b as Ve}from"./chunk-DDUEZMYJ.js";import{a as Ue}from"./chunk-J5KNE364.js";import{e as g}from"./chunk-RAUQWANF.js";import{a as $e}from"./chunk-3S44UA6M.js";import{b as ze,d as Ge}from"./chunk-S7Y6G6OZ.js";import{a as Le}from"./chunk-JZD2T5W2.js";import{a as Ee}from"./chunk-BTSJJPXV.js";import{a as U,b as $}from"./chunk-NKT65OQW.js";import"./chunk-NIPOW2E2.js";import{a as we}from"./chunk-ORK43FFD.js";import"./chunk-56YE37V6.js";import{a as ve}from"./chunk-V5UC4TMG.js";import"./chunk-U657U553.js";import{a as ye}from"./chunk-QFYVXC4V.js";import{a as V}from"./chunk-L77E4UL2.js";import"./chunk-JNRBLGLU.js";import"./chunk-4YE3E6NH.js";import"./chunk-ZBQC6E3M.js";import"./chunk-AO43RQAG.js";import"./chunk-SCB2MVKQ.js";import{a as Se}from"./chunk-4SMJHLGZ.js";import{a as Re,b as Pe,c as Oe,d as Be,e as Ne}from"./chunk-TH3YUOZ2.js";import{a as F}from"./chunk-564RKXG7.js";import{c as B}from"./chunk-HJXR3IL7.js";import"./chunk-K5FCDENP.js";import{a as be}from"./chunk-YHKI2L7W.js";import"./chunk-R3Y7P2GW.js";import"./chunk-WAPW5AUJ.js";import"./chunk-ENHI5GWA.js";import{a as ke,b as Ae,c as Fe}from"./chunk-DAEXUMJT.js";import"./chunk-IGMB27B5.js";import{e as xe,h as Ie}from"./chunk-ME7PJXWA.js";import"./chunk-GL2SUH6T.js";import"./chunk-3M22BTAM.js";import{c as ge}from"./chunk-HCPBPEHV.js";import{c as x,g as I,h as he,i as ue,l as fe}from"./chunk-QVLOO535.js";import{c as C}from"./chunk-XREQECMQ.js";import"./chunk-RPJBZPSB.js";import{f as Me,k as _e,v as De}from"./chunk-UMOPET3G.js";import{i as de,j as ce}from"./chunk-4LV77BQU.js";import"./chunk-EZZQWHAZ.js";import{b as v,c as T}from"./chunk-23CS2WID.js";import{a as O}from"./chunk-OIHIMR2W.js";import"./chunk-BDMUNOAA.js";import{a as pe,d as le,e as me}from"./chunk-OYQCZWOE.js";import{d as Te,g as Ce}from"./chunk-G33ZJSCE.js";import"./chunk-DX662RXJ.js";import"./chunk-N5GZ74QQ.js";import"./chunk-XASILSQS.js";import{$a as ee,$b as ae,Aa as R,Ab as ne,Bb as oe,Cb as p,Db as o,Ea as X,Eb as a,F as G,Fb as k,Gc as L,M as K,Nb as A,Pa as d,Pb as b,Rb as u,Sa as s,X as Q,Za as Z,db as y,ec as r,fc as re,gc as P,ib as N,ja as M,jb as te,o as Y,oa as w,pa as E,pc as se,u as q,wb as _,yb as D,zb as ie}from"./chunk-46QINP2S.js";import{a as c,b as h}from"./chunk-BDOJB7O2.js";function nt(n,f){if(n&1&&(o(0,"a",2)(1,"mat-icon"),r(2,"edit"),a()()),n&2){let e=u();p("href",e.params.urlTo("createUpdateMetaData",e.contentType),d)}}function ot(n,f){n&1&&(o(0,"div",3)(1,"mat-icon"),r(2,"edit"),a()())}function at(n,f){if(n&1&&(o(0,"a",4)(1,"mat-icon",9),r(2," local_offer "),a()()),n&2){let e=u();p("href",e.params.urlTo("openMetadata",e.contentType),d),s(),p("matBadge",e.contentType.Metadata.length)("matBadgeHidden",!e.contentType.Metadata.length)}}function rt(n,f){if(n&1&&(o(0,"div",3)(1,"mat-icon",10),r(2," local_offer "),a()()),n&2){let e=u();s(),p("matBadge",e.contentType.Metadata.length)("matBadgeHidden",!e.contentType.Metadata.length)}}function st(n,f){if(n&1&&(o(0,"a",5)(1,"mat-icon",9),r(2," person"),a()()),n&2){let e=u();p("href",e.params.urlTo("openPermissions",e.contentType),d),s(),p("matBadge",e.contentType.Permissions.Count)("matBadgeHidden",!e.contentType.Permissions.Count)}}function pt(n,f){if(n&1&&(o(0,"div",3)(1,"mat-icon",10),r(2," person "),a()()),n&2){let e=u();s(),p("matBadge",e.contentType.Permissions.Count)("matBadgeHidden",!e.contentType.Permissions.Count)}}function lt(n,f){if(n&1){let e=A();o(0,"a",11)(1,"mat-icon"),r(2,"settings"),a(),o(3,"span"),r(4,"Rename"),a()(),o(5,"a",12),k(6,"mat-icon",13),o(7,"span"),r(8,"REST API"),a()(),o(9,"button",14),b("click",function(){w(e);let i=u();return E(i.params.do("typeExport",i.contentType))}),o(10,"mat-icon"),r(11,"cloud_download"),a(),o(12,"span"),r(13,"Export content type"),a()(),o(14,"a",12)(15,"mat-icon"),r(16,"cloud_download"),a(),o(17,"span"),r(18,"Export data"),a()(),o(19,"a",12)(20,"mat-icon"),r(21,"cloud_upload"),a(),o(22,"span"),r(23,"Import data"),a()(),o(24,"button",15),b("click",function(){w(e);let i=u();return E(i.params.do("deleteContentType",i.contentType))}),o(25,"mat-icon"),r(26,"delete"),a(),o(27,"span"),r(28,"Delete"),a()()}if(n&2){let e=u();p("href",e.params.urlTo("editContentType",e.contentType),d)("disabled",e.contentType.EditInfo.DisableRename),s(5),p("href",e.params.urlTo("openRestApi",e.contentType),d),s(9),p("href",e.params.urlTo("dataExport",e.contentType),d),s(5),p("href",e.params.urlTo("dataImport",e.contentType),d),s(5),p("disabled",e.contentType.EditInfo.DisableDelete)}}var Xe=(()=>{class n extends Ke{agInit(e){this.params=e,this.contentType=e.data;let t=this.params.enablePermissionsGetter();this.enablePermissions=t&&Ee().test(this.contentType.NameId)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=X(n)))(i||n)}})()}static{this.\u0275cmp=y({type:n,selectors:[["app-data-actions"]],features:[N],decls:13,vars:4,consts:[["menu","matMenu"],[1,"actions-component"],["matRipple","","tippy","Description and more",1,"eav-grid-action-button","default-link","highlight",3,"href"],[1,"eav-grid-action-button","disabled"],["matRipple","","tippy","Metadata",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","Permissions",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["matMenuContent",""],["matBadgePosition","below after","matBadgeSize","small","aria-hidden","false",3,"matBadge","matBadgeHidden"],["matBadgePosition","below after","matBadgeSize","small","matBadgeDisabled","true","aria-hidden","false",3,"matBadge","matBadgeHidden"],["mat-menu-item","",3,"href","disabled"],["mat-menu-item","",3,"href"],["svgIcon","code-curly"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"]],template:function(t,i){if(t&1&&(o(0,"div",1),_(1,nt,3,1,"a",2)(2,ot,3,0,"div",3),_(3,at,3,3,"a",4)(4,rt,3,2,"div",3),_(5,st,3,3,"a",5)(6,pt,3,2,"div",3),o(7,"div",6)(8,"mat-icon"),r(9,"more_horiz"),a()()(),o(10,"mat-menu",7,0),te(12,lt,29,6,"ng-template",8),a()),t&2){let l=ae(11);s(),D(!i.contentType.EditInfo.DisableEdit||i.contentType.Properties?1:2),s(2),D(i.contentType.EditInfo.DisableMetadata?4:3),s(2),D(!i.contentType.EditInfo.DisableEdit&&i.enablePermissions?5:6),s(2),p("matMenuTriggerFor",l)}},dependencies:[I,x,T,v,$,U,Ne,Oe,Re,Pe,Be,C],encapsulation:2})}}return n})();var Ze=(()=>{class n{agInit(e){this.params=e,this.contentType=e.data,this.value=e.value,this.tooltip=this.contentType.EditInfo.ReadOnly?`${this.contentType.EditInfo.ReadOnlyMessage?`${this.contentType.EditInfo.ReadOnlyMessage}

`:""}This ContentType shares the definition of #${this.contentType.SharedDefId} so you can't edit it here. Read 2sxc.org/help?tag=shared-types`:"Edit fields",this.icon=this.contentType.EditInfo.ReadOnly?"share":"dns"}refresh(e){return!0}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=y({type:n,selectors:[["app-data-fields"]],decls:4,vars:5,consts:[[1,"actions-component"],["matRipple","",1,"eav-grid-action-button","default-link","highlight",3,"tippy","href"],["matBadgePosition","below after","matBadgeColor","accent","matBadgeSize","small","aria-hidden","false",3,"matBadge","matBadgeHidden"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"a",1)(2,"mat-icon",2),r(3),a()()()),t&2&&(s(),p("tippy",i.tooltip)("href",i.params.fieldsUrl(i.contentType),d),s(),p("matBadge",i.value)("matBadgeHidden",!i.value),s(),P(" ",i.icon," "))},dependencies:[I,x,T,v,$,U,C],encapsulation:2})}}return n})();var et=(()=>{class n{constructor(){this.router=M(me)}agInit(e){this.params=e,this.contentType=e.data,this.value=e.value}refresh(e){return!0}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=y({type:n,selectors:[["app-data-items"]],decls:7,vars:5,consts:[[1,"actions-component"],["matRipple","",1,"eav-grid-action-button","default-link","highlight",3,"tippy","href"],[1,"text-icon"],["matRipple","","tippy","Add item",1,"eav-grid-action-button","default-link","highlight",3,"href"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"a",1)(2,"div",2),r(3),a()(),o(4,"a",3)(5,"mat-icon"),r(6,"add"),a()()()),t&2&&(s(),p("tippy",se("",i.value," items"))("href",i.params.itemsUrl(i.contentType),d),s(2),re(i.value),s(),p("href",i.params.addItemUrl(i.contentType),d))},dependencies:[I,x,T,v,C],styles:[`.text-icon[_ngcontent-%COMP%]{width:24px;height:24px;font-size:12px;line-height:22px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border:1px solid rgba(29,39,61,.44);border-radius:12px;box-sizing:border-box;background-color:#002753;color:#fff;-webkit-user-select:none;user-select:none}.text-icon[_ngcontent-%COMP%]{min-width:24px;width:initial}
/*# sourceMappingURL=data-items-EWJWD7UT.css.map */`]})}}return n})();function mt(n,f){if(n&1&&(o(0,"mat-option",6),r(1),a()),n&2){let e=f.$implicit;p("value",e.name),s(),P(" ",e.label," ")}}function dt(n,f){if(n&1){let e=A();o(0,"button",12),b("click",function(){w(e);let i=u();return E(i.createGhost())}),o(1,"mat-icon",9),r(2,"share"),a(),o(3,"span"),r(4,"Ghost"),a()()}}var Di=(()=>{class n extends Se{#i;#r;#n;#s;#p;#t;#a;constructor(e){super(),this.viewContainerRef=e,this.isDebug=M(ye).isDebug,this.#i=M(ge),this.#r=M(Te),this.#n=O(Ve),this.#s=O(qe),this.#p=O(ve),this.#t=O(we),this.#a={empty:{description:"<p><b>This is where you manage data</b></p>",hint:"<p>Click the (+) in the bottom right corner to create your first Content Type (think: table).</p>"},content:{description:"<p><b>Each row shows a Content Type</b> <br> They define the fields, similar to a database table.</p>",hint:"<p>Click on the title to list the Entities (think: records). <br>You can also create new Entities, configure the fields and export/import the schema or the data.</p>"}},this.uxHelpText=L(()=>this.contentTypes()?.length===0?this.#a.empty:this.#a.content),this.contentTypes=R(void 0),this.scope=R(void 0),this.scopeOptions=R([]),this.scopeSelected=L(()=>this.scopeOptions().find(t=>t.name===this.scope())),this.gridOptions=this.#d(),this.dropdownInsertValue=W,this.refresh=R(0)}ngOnInit(){this.#l(),this.#m(),this.#t.doOnDialogClosedWithData(()=>{this.#o()}),this.#p.getCurrent$().subscribe(e=>{this.enablePermissions=e.Context.Enable.AppPermissions})}filesDropped(e){let t=e[0];switch(t.name.substring(t.name.lastIndexOf(".")+1).toLocaleLowerCase()){case"xml":Y(We(e[0])).pipe(K(1)).subscribe(l=>{let m=l.split('<Entity Type="')[1]?.split('"')[0],z=this.contentTypes().find(S=>S.Name===m);if(z==null){let S=`Cannot find Content Type named '${m}'. Please open Content Type Import dialog manually.`;this.#i.open(S,null,{duration:5e3});return}this.#f(z,e)});break;case"json":this.importType(e);break}}importType(e){let t={files:e};this.#t.navRelative(["import"],{state:t})}urlToImportType(){return this.#e("import")}editContentType(e){if(!e)this.#t.navRelative(["add"]);else{if(e.EditInfo.ReadOnly)return;this.#t.navRelative([`${e.NameId}/edit`])}}#o(){this.#n.retrieveContentTypesPromise(this.scope()).then(e=>{for(let t of e)t._compareLabel=t.Label.replace(new RegExp("\\p{Emoji}","gu"),"\u017E");this.contentTypes.set(e),this.refresh.update(t=>++t),this.scope()!==B.scopes.default.value&&this.#i.open("Warning! You are in a special scope. Changing things here could easily break functionality",null,{duration:2e3})})}#l(){this.#n.getScopesV2Promise().then(e=>{let t=this.scopeOptions().filter(l=>e.find(m=>m.name===l.name)==null),i=e.map(l=>{let m=l.typesInherited?l.typesInherited==l.typesTotal?l.typesInherited+" sys types":`${l.typesTotal} types / ${l.typesInherited} system`:`${l.typesTotal} types`;return h(c({},l),{label:l.name+` - ${m}`})});this.scopeOptions.set([...i,...t])})}createGhost(){let e=window.prompt("To create a ghost content-type enter source static name / id - this is a very advanced operation - read more about it on 2sxc.org/help?tag=ghost");e&&(this.#i.open("Saving..."),this.#n.createGhost(e).subscribe(t=>{this.#i.open("Saved",null,{duration:2e3}),this.#o()}))}changeScope(e){e===W&&(e=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||B.scopes.default.value),this.#t.navRelative(["..",e])}#m(){this.subscriptions.add(this.#t.router.events.pipe(G(e=>e instanceof pe),q(()=>this.#t.getParam("scope")),Q(this.#t.getParam("scope")),G(e=>!!e),be(e=>e)).subscribe(e=>{if(this.scope.set(e),!this.scopeOptions().map(t=>t.name).includes(e)){let t={name:e,label:e,typesTotal:0,typesInherited:0,typesOfApp:0};this.scopeOptions.set([...this.scopeOptions(),t])}this.#o()}))}#d(){return h(c({},$e),{columnDefs:[h(c({},g.IdWithDefaultRenderer),{cellRendererParams:g.idFieldParamsTooltipGetter("StaticName")}),h(c({},g.TextWidePrimary),{headerName:"ContentType",field:"Label",sort:"asc",comparator:(t,i,l,m,z)=>{let S=l.data,tt=m.data;return S._compareLabel.localeCompare(tt._compareLabel)},cellRenderer:t=>H.cellLink(this.#e(`items/${t.data.NameId}`),t.data.Label)}),h(c({},g.Items),{field:"Items",cellRenderer:et,cellRendererParams:{addItemUrl:t=>this.#e(`edit/${this.#c(t)}`),itemsUrl:t=>this.#e(`items/${t.NameId}`)}}),h(c({},g.Fields),{field:"Fields",cellRenderer:Ze,cellRendererParams:{fieldsUrl:t=>this.#e(`fields/${t.NameId}`)}}),h(c({},g.TextWideMin100),{field:"Name",cellClass:t=>`${t.data.EditInfo.DisableEdit?"no-outline":"primary-action highlight"}`.split(" "),cellRenderer:t=>H.cellLink(this.#e(`${t.data.NameId}/edit`),t.data?.Name)}),h(c({},g.TextWideFlex3),{field:"Description",valueGetter:t=>t.data?.Properties?.Description}),h(c({},g.ActionsPinnedRight4),{cellRenderer:Xe,cellRendererParams:{enablePermissionsGetter:()=>this.enablePermissions,urlTo:(t,i)=>{switch(t){case"createUpdateMetaData":return this.#e(`edit/${this.#h(i)}`);case"openPermissions":return this.#e(Le.getUrlContentType(i.NameId));case"editContentType":return this.#e(i.EditInfo.ReadOnly?"":`${i.NameId}/edit`);case"openMetadata":return this.#e(Ye.getUrlContentType(i.NameId,`Metadata for Content Type: ${i.Name} (${i.Id})`));case"openRestApi":return this.#e(je.getUrlData(i));case"dataExport":return this.#e(`export/${i.NameId}`);case"dataImport":return this.#e(`${i.NameId}/import`)}},do:(t,i)=>{switch(t){case"typeExport":this.#u(i);break;case"deleteContentType":this.#g(i);break}}}})]})}#e(e){return"#"+this.#t.urlSubRoute(e)}#c(e){return V({items:[F.newFromType(e.NameId)]})}urlToNewContentType(){return this.#e("add")}#h(e){let t={items:[e.Properties?F.editId(e.Properties.Id):h(c({},F.newMetadata(e.NameId,B.contentTypes.contentType,B.metadata.contentType)),{Prefill:{Label:e.Name,Description:e.Description}})]};return V(t)}#u(e){this.#s.exportJson(e.NameId)}#f(e,t){this.#t.navRelative([`${e.NameId}/import`],{state:{files:t}})}#g(e){let t={entityId:e.Id,entityTitle:e.Name,message:"Are you sure you want to delete?",hasDeleteSnackbar:!0};this.#r.open(Ue,{autoFocus:!1,data:t,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(l=>{l&&this.#n.delete(e).subscribe(m=>{this.#i.open("Deleted",null,{duration:2e3}),this.#o()})})}static{this.\u0275fac=function(t){return new(t||n)(Z(ee))}}static{this.\u0275cmp=y({type:n,selectors:[["app-data"]],features:[N],decls:25,vars:12,consts:[[3,"helpText","refresh","rowLength"],["appDragAndDrop","",1,"ag-theme-material",3,"filesDropped","rowData","gridOptions","allowedFileTypes"],[1,"eav-dialog-actions"],[1,"eav-dialog-actions-div"],["color","accent",1,"eav-mat-form-field","eav-scope-dropdown"],["name","Scope","panelWidth","",3,"ngModelChange","ngModel"],[3,"value"],[3,"href"],["mat-button","","tippy","Import content type","tippyPlacement","top",1,"eav-button__with-icon"],[1,"eav-icon"],["mat-button","","color","accent","tippy","Create a ghost content type","tippyPlacement","top",1,"eav-button__with-icon"],["mat-fab","","mat-elevation-z24","","tippy","Create a new content type","tippyPlacement","top",1,"grid-fab"],["mat-button","","color","accent","tippy","Create a ghost content type","tippyPlacement","top",1,"eav-button__with-icon",3,"click"]],template:function(t,i){if(t&1&&(o(0,"app-grid-with-help",0)(1,"ag-grid-angular",1),b("filesDropped",function(m){return i.filesDropped(m)}),a(),o(2,"mat-dialog-actions",2)(3,"div",3)(4,"mat-form-field",4)(5,"mat-select",5),b("ngModelChange",function(m){return i.changeScope(m)}),o(6,"mat-select-trigger")(7,"span"),r(8),a()(),ne(9,mt,2,2,"mat-option",6,ie),o(11,"mat-option",6),r(12," Scope: Other... "),a()()(),o(13,"a",7)(14,"button",8)(15,"mat-icon",9),r(16,"cloud_upload"),a(),o(17,"span"),r(18,"Content Type"),a()()(),_(19,dt,5,0,"button",10),a(),o(20,"a",7)(21,"button",11)(22,"mat-icon"),r(23,"add"),a()()()()(),k(24,"router-outlet")),t&2){let l,m;p("helpText",i.uxHelpText())("refresh",i.refresh())("rowLength",(l=i.contentTypes())==null?null:l.length),s(),p("rowData",i.contentTypes())("gridOptions",i.gridOptions)("allowedFileTypes","xml,json"),s(4),p("ngModel",i.scope()),s(3),P("Scope: ",(m=i.scopeSelected())==null?null:m.label),s(),oe(i.scopeOptions()),s(2),p("value",i.dropdownInsertValue),s(2),p("href",i.urlToImportType(),d),s(6),D(i.isDebug()?19:-1),s(),p("href",i.urlToNewContentType(),d)}},dependencies:[Ce,ce,de,Fe,ke,Ae,xe,De,Me,_e,Ie,fe,he,ue,T,v,le,Ge,ze,He,C,Je],styles:[`[_nghost-%COMP%]     .ag-row-hover .ag-cell a, [_nghost-%COMP%]     .ag-row-hover .ag-cell .id-box *, [_nghost-%COMP%]     .ag-row-hover .ag-cell mat-icon, .eav-button__with-icon[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:#85283b!important}
/*# sourceMappingURL=data-PDSONRU4.css.map */`]})}}return n})();export{Di as DataComponent};
//# sourceMappingURL=https://sources.2sxc.org/21.00.00/dist/ng-edit/data-INHRKOT3.js.map
