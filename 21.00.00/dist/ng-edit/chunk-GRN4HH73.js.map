{
  "version": 3,
  "sources": ["projects/eav-ui/src/app/edit/dialog/header/language-settings-dialog/LanguageDropdown/language-part.enum.ts", "projects/eav-ui/src/app/shared/services/user-language.service.ts", "projects/eav-ui/src/app/edit/localization/language.service.ts"],
  "sourcesContent": ["export enum LanguagePart {\r\n  UI = 'ui',\r\n  Form = 'form',\r\n  PrimaryTranslatable = 'primaryTranslatable'\r\n}", "import { Injectable } from '@angular/core';\r\nimport { LanguagePart } from '../../edit/dialog/header/language-settings-dialog/LanguageDropdown/language-part.enum';\r\nimport { DialogUiSettings, keySettings } from '../constants/session.constants';\r\nimport { StateManagerLocal } from '../user/state-manager';\r\n\r\nconst storeKey = 'user-language';\r\n\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class UserLanguageService {\r\n\r\n  constructor() { }\r\n\r\n  #stateManager = new StateManagerLocal(storeKey);\r\n\r\n  /** Get the UI mixing url, stored etc. */\r\n  #config(part: LanguagePart, fallback?: string): { language: string, force: boolean } {\r\n    // Check if URL overrides everything\r\n    const fromUrl = this.#dialogUiSettings()?.[ part == LanguagePart.UI ? 'languageUi' : 'languageForm' ];\r\n    if (fromUrl?.endsWith('!'))\r\n      return { language: fromUrl.slice(0, -1), force: true };\r\n    return { language: this.stored(part) ?? fromUrl ?? fallback, force: false };\r\n  }\r\n\r\n  value(part: LanguagePart): string {\r\n    return this.#config(part).language;\r\n  }\r\n\r\n  /**\r\n   * Get the UI or Form as stored for the user, for the config-UI\r\n   * Important: can be an empty string! which must be returned as null.\r\n   */\r\n  stored(part: LanguagePart): string {\r\n    return this.#stateManager.get(part) || null;\r\n  }\r\n\r\n  /** Set the UI language in the store */\r\n  save(part: LanguagePart, language: string) {\r\n    this.#stateManager.add(part, language || null); // try to save null instead of \"\"\r\n  }\r\n\r\n  /** Get the code like 'en' or 'de' for setting the language */\r\n  uiCode(fallback?: string): string {\r\n    return this.#config(LanguagePart.UI, fallback)?.language?.toLocaleLowerCase().split('-')[0];\r\n  }\r\n\r\n  /**\r\n   * Return true/false for the PrimaryTranslatable option.\r\n   * If nothing stored, returns false.\r\n   */\r\n  primaryTranslatableEnabled(): boolean {\r\n    const stored = this.stored(LanguagePart.PrimaryTranslatable);\r\n    if (stored === null || stored === undefined) return false;\r\n    // stored might already be boolean serialized as string 'true'/'false'\r\n    if (typeof stored === 'string') {\r\n      return stored.toLowerCase() === 'true';\r\n    }\r\n    return !!stored;\r\n  }\r\n\r\n  /**\r\n   * Save the PrimaryTranslatable boolean flag.\r\n   * Stored as string 'true' or 'false' to keep compatibility with existing StateManagerLocal.\r\n   */\r\n  savePrimaryTranslatable(enabled: boolean) {\r\n    this.save(LanguagePart.PrimaryTranslatable, enabled ? 'true' : 'false');\r\n  }\r\n\r\n  isForced(part: LanguagePart): boolean {\r\n    return this.#config(part)?.force;\r\n  }\r\n\r\n  userConfigurable(): boolean {\r\n    const isConfigurable = this.#dialogUiSettings()?.languageUserSettings;\r\n    return isConfigurable !== false && isConfigurable !== \"false\";\r\n  }\r\n\r\n  // note: for now just here, if we need it more often\r\n  // create some service which caches the object instead of deserializing every time\r\n  #dialogUiSettings(): DialogUiSettings {\r\n    if (this.#uiSettingsCached)\r\n      return this.#uiSettingsCached;\r\n    const storedMaybeString = sessionStorage.getItem(keySettings);\r\n    return (!storedMaybeString)\r\n      ? null\r\n      : this.#uiSettingsCached = JSON.parse(storedMaybeString);\r\n  }\r\n  #uiSettingsCached?: DialogUiSettings;\r\n}\r\n", "import { Injectable } from '@angular/core';\r\nimport { classLog } from '../../shared/logging';\r\nimport { Language } from '../../shared/models/language.model';\r\nimport { SignalStoreBase } from '../shared/store/signal-store-base';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LanguageService extends SignalStoreBase<string, Language> {\r\n\r\n  constructor() {\r\n    super(classLog({LanguageService}));\r\n  }\r\n\r\n  override getId = (item: Language) => item.NameId.toLocaleLowerCase();\r\n}\r\n"],
  "mappings": "wIAAA,IAAYA,GAAZ,SAAYA,EAAY,CACtBA,OAAAA,EAAA,GAAA,KACAA,EAAA,KAAA,OACAA,EAAA,oBAAA,sBAHUA,CAIZ,GAJYA,GAAY,CAAA,CAAA,ECKxB,IAAMC,EAAW,gBAIJC,GAAmB,IAAA,CAA1B,MAAOA,CAAmB,CAE9BC,aAAA,CAAgB,CAEhBC,GAAgB,IAAIC,EAAkBJ,CAAQ,EAG9CK,GAAQC,EAAoBC,EAAiB,CAE3C,IAAMC,EAAU,KAAKC,GAAiB,IAAMH,GAAQI,EAAaC,GAAK,aAAe,cAAc,EACnG,OAAIH,GAASI,SAAS,GAAG,EAChB,CAAEC,SAAUL,EAAQM,MAAM,EAAG,EAAE,EAAGC,MAAO,EAAI,EAC/C,CAAEF,SAAU,KAAKG,OAAOV,CAAI,GAAKE,GAAWD,EAAUQ,MAAO,EAAK,CAC3E,CAEAE,MAAMX,EAAkB,CACtB,OAAO,KAAKD,GAAQC,CAAI,EAAEO,QAC5B,CAMAG,OAAOV,EAAkB,CACvB,OAAO,KAAKH,GAAce,IAAIZ,CAAI,GAAK,IACzC,CAGAa,KAAKb,EAAoBO,EAAgB,CACvC,KAAKV,GAAciB,IAAId,EAAMO,GAAY,IAAI,CAC/C,CAGAQ,OAAOd,EAAiB,CACtB,OAAO,KAAKF,GAAQK,EAAaC,GAAIJ,CAAQ,GAAGM,UAAUS,kBAAiB,EAAGC,MAAM,GAAG,EAAE,CAAC,CAC5F,CAMAC,4BAA0B,CACxB,IAAMR,EAAS,KAAKA,OAAON,EAAae,mBAAmB,EAC3D,OAAIT,GAAW,KAAqC,GAEhD,OAAOA,GAAW,SACbA,EAAOU,YAAW,IAAO,OAE3B,CAAC,CAACV,CACX,CAMAW,wBAAwBC,EAAgB,CACtC,KAAKT,KAAKT,EAAae,oBAAqBG,EAAU,OAAS,OAAO,CACxE,CAEAC,SAASvB,EAAkB,CACzB,OAAO,KAAKD,GAAQC,CAAI,GAAGS,KAC7B,CAEAe,kBAAgB,CACd,IAAMC,EAAiB,KAAKtB,GAAiB,GAAIuB,qBACjD,OAAOD,IAAmB,IAASA,IAAmB,OACxD,CAIAtB,IAAiB,CACf,GAAI,KAAKwB,GACP,OAAO,KAAKA,GACd,IAAMC,EAAoBC,eAAeC,QAAQC,CAAW,EAC5D,OAASH,EAEL,KAAKD,GAAoBK,KAAKC,MAAML,CAAiB,EADrD,IAEN,CACAD,mDA9EWhC,EAAmB,CAAA,iCAAnBA,EAAmBuC,QAAnBvC,EAAmBwC,UAAAC,WADN,MAAM,CAAA,CAAA,SACnBzC,CAAmB,GAAA,ECHhC,IAAa0C,GAAgB,IAAA,CAAvB,MAAOA,UAAwBC,CAAiC,CAEpEC,aAAA,CACE,MAAMC,EAAS,CAACH,gBAAAA,CAAe,CAAC,CAAC,EAG1B,KAAAI,MAASC,GAAmBA,EAAKC,OAAOC,kBAAiB,CAFlE,iDAJWP,EAAe,CAAA,iCAAfA,EAAeQ,QAAfR,EAAeS,UAAAC,WADF,MAAM,CAAA,CAAA,SACnBV,CAAgB,GAAA",
  "names": ["LanguagePart", "storeKey", "UserLanguageService", "constructor", "#stateManager", "StateManagerLocal", "#config", "part", "fallback", "fromUrl", "#dialogUiSettings", "LanguagePart", "UI", "endsWith", "language", "slice", "force", "stored", "value", "get", "save", "add", "uiCode", "toLocaleLowerCase", "split", "primaryTranslatableEnabled", "PrimaryTranslatable", "toLowerCase", "savePrimaryTranslatable", "enabled", "isForced", "userConfigurable", "isConfigurable", "languageUserSettings", "#uiSettingsCached", "storedMaybeString", "sessionStorage", "getItem", "keySettings", "JSON", "parse", "factory", "\u0275fac", "providedIn", "LanguageService", "SignalStoreBase", "constructor", "classLog", "getId", "item", "NameId", "toLocaleLowerCase", "factory", "\u0275fac", "providedIn"]
}
