{"version":3,"sources":["./src/$_lazy_route_resource lazy namespace object","./src/app/core/log.ts","./src/app/debug-config.ts","./src/app/core/boot-control.ts","./src/app/config.ts","../connect-parts/inpage-quick-dialog/quick-dialog-params.ts","./src/app/i18n/constants.ts","./src/app/core/backend-settings.ts","./src/app/core/behavior-observable.ts","./src/app/template-picker/constants.ts","./src/app/template-picker/data/content-types-processor.service.ts","./src/app/core/app.ts","./src/app/template-picker/picker.service.ts","./src/app/core/constants.ts","./src/app/template-picker/data/template-processor.ts","./src/app/template-picker/template-filter.pipe.ts","./src/app/template-picker/current-data.service.ts","./src/app/installer/installer.service.ts","./src/app/installer/getting-started.service.ts","./src/app/installer/installer.component.html","./src/app/installer/installer.component.ts","./src/app/template-picker/template-picker.component.html","./src/app/template-picker/template-picker.component.ts","./src/app/app.component.ts","./src/app/i18n/index.ts","./src/app/app.component.html","./src/app/core/core.module.ts","./src/app/installer/installer.module.ts","./src/app/material-module.ts","./src/app/template-picker/template-picker.module.ts","./src/app/app.module.ts","./src/main.ts"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","module","exports","id","name","parent","autoDump","logs","Array","loggers","Object","this","add","msg","push","Log","forceLogToConsole","arguments","Constants","console","log","apply","subLog","newLog","dump","configureRuntimeLogging","state","window","_reboot","Subject","rebootRequest$","asObservable","getRebootController","BootController","instance","reboot","next","appId","parseInt","get","apps","moduleId","Number","cbId","getSxcInstance","$2sxc","Config","key","urlParams","require","SupportedLanguages","i18nPrefix","http","BehaviorSubject","data","pipe","distinctUntilChanged","switchMap","map","bundle","Context","share","setApp","BackendSettings","create","initialValue","subj","obs","subject","reset","isInitial","value","Observable","cViewWithoutContent","translate","buildList","allTypes","type","allTemplates","template","unhide","unhideSelectedType","addEmptyTypeIfNeeded","filtered","hideNecessaryTypes","sortTypes","types","filter","t","IsHidden","contentTypes","currentType","currentTemplate","c","TemplateId","StaticName","forEach","templates","layoutElementLabel","instant","find","ContentTypeStaticName","slice","Name","Thumbnail","Label","sort","a","b","localeCompare","sortTypesWithDefault","IsDefault","firstDefault","findContentTypesById","selectedContentTypeId","ContentTypesProcessor","json","assign","VersionMain","Version","substr","uninitializedList","apps$","contentTypes$","templates$","ready$","mustLoadApps","buildObservables","enableLogging","combineLatest","set","startWith","saveAppId","reloadParts","loadApps","post","toPromise","initLoading","requireApps","reloadAppParts","loadTemplates","loadContentTypes","subscribe","response","ct","Properties","alreadyLoaded","appsFilter","App","streamLog","length","r","PickerService","pickSelected","selected","app","sortTemplates","transform","args","typeId","contentType","undefined","typeNameFilter","isContent","TemplateFilterPipe","api","templateFilter","ctProcessor","appId$","initialTypeId$","initialTemplateId$","selectedType$","selectedTemplate$","buildBasicObservables","app$","AppId","initialType$","type$","merge","findTemplatesForTypeOrAll","initialTemplate$","selected$","template$","TemplateProcessor","types$","init","config","JSON","stringify","appReady$","typeReady$","scan","acc","contentTypeId","templReady$","debounceTime","templateId","loadAll$","initLogging","activateCurrentApp","inita$","inittyp$","initt$","initAll$","slog","initLog","activateType","activateTemplate","CurrentDataService","installPackages","packages","step","reduce","url","InstallerService","gettingStartedSubject","gettingStarted$","tap","loadGettingStarted","isContentApp","GettingStartedService","installer","sanitizer","remoteInstallerUrl","ready","subscriptions","bypassSecurityTrustResourceUrl","bootController","destroy","sub","unsubscribe","ngOnInit","alreadyProcessing","fromEvent","evt","parse","action","values","packagesDisplayNames","displayName","confirm","showProgress","p","currentPackage","alert","top","location","reload","InstallerComponent","backendSettings","cdRef","showCancel","showAdvanced","showInstaller","tabIndex","isBadContextForInstaller","loading$","preventAppSwich","showDebug","bridge","frameElement","dashInfo","getAdditionalDashboardConfig","boot","debugObservables","autosyncObservablesToEnsureUiUpdates","debug","settings","Enable","CodeEditor","initDone$","initObservables","initValuesFromBridge","initTrue$","typeOrAppReady","_","switchTab","templatesLoading$","skipUntil","previewTemplate","defaultContentType","detectChanges","preventTypeSwitch","hasContent","isInnerContent","supportsAjax","cancel","run","persistTemplate","setTemplate","selectApp","before","after","updateApp","selectContentType","setContentType","selectTemplate","timer","newApp","ajax","SupportsAjaxReload","showMessage","toString","reloadAndReInit","newConfig","TemplatePickerComponent","el","context","preConfigure","sxc","addLangs","ctxDto","lang","Language","setDefaultLang","use","Current","split","AppComponent","CoreModule","InstallerModule","MATERIAL_MODULES","MaterialModule","TemplatePickerModule","HttpLoaderFactory","loader","AppModule","forRoot","provide","useFactory","deps","platform","destroyed","bootstrapModule","appBootstrap","catch","err","error"],"mappings":"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","file":"main.790b5e966ddbde266794.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"crnd\";","import { Constants } from './constants';\r\nimport { DebugConfig } from 'app/debug-config';\r\n\r\n\r\nexport class Log {\r\n  /** global state to determine if logging to console should be done or not */\r\n  public static forceLogToConsole = false;\r\n\r\n  name = '';\r\n  autoDump = DebugConfig.logger.logToConsole;\r\n  logs = new Array<string>();\r\n  parent: Log;\r\n  loggers: any = new Object();\r\n\r\n  constructor (name?: string, parent?: Log) {\r\n    this.name = name;\r\n    this.parent = parent;\r\n  }\r\n\r\n  add(msg: string, ...args: any[]): void {\r\n    this.logs.push(msg);\r\n    if (this.name) msg = this.name + ':' + msg;\r\n    if (this.parent) this.parent.logs.push(msg);\r\n    if (this.autoDump || Log.forceLogToConsole) {\r\n      arguments[0] = Constants.logName + ': ' + msg;\r\n      console.log.apply(null, arguments);\r\n    }\r\n  }\r\n\r\n  subLog(name: string, autoDump?: boolean): Log {\r\n    const newLog = new Log(name, this);\r\n    this.loggers[name] = newLog;\r\n    newLog.autoDump = typeof(autoDump) === 'boolean'\r\n      ? autoDump : this.autoDump;\r\n    if (DebugConfig.logger.internals)\r\n      this.add(`logger: subLog(${name}, ${autoDump}) resulting in autoDump=${newLog.autoDump}`);\r\n\r\n    return newLog;\r\n  }\r\n\r\n  dump(): void {\r\n    this.add('dumping to console');\r\n    console.log(`Log dump for '${this.name}'`, this);\r\n  }\r\n\r\n  public static configureRuntimeLogging(state: boolean) {\r\n    if(DebugConfig.logger.urlDebugActivatesLive)\r\n      Log.forceLogToConsole = state;\r\n  }\r\n}\r\n\r\n\r\nexport const log = new Log();\r\n\r\nwindow['logger'] = log;\r\n","\r\n/** configuration what to debug directly to the screen and what to keep secret */\r\nexport const DebugConfig = {\r\n\r\n  /** logger configuration */\r\n  logger: {\r\n    /** should we stream messages directly to console */\r\n    logToConsole: false,\r\n    /** should we also log internal events */\r\n    internals: false,\r\n    /** allow url param ?debug=true to turn on logging */\r\n    urlDebugEnablesAll: true,\r\n    /** if url param ?debug=true also enables all live-logging */\r\n    urlDebugActivatesLive: true\r\n  },\r\n\r\n  /** api debugging */\r\n  api: {\r\n    enabled: false,\r\n    streams: false,\r\n  },\r\n\r\n  /** template picker */\r\n  picker: {\r\n    enabled: false,\r\n    streams: false,\r\n    showDebugPanel: false\r\n  },\r\n\r\n  /** template state */\r\n  state: {\r\n    enabled: false,\r\n    streams: false,\r\n    inits: false,\r\n  },\r\n\r\n  /** content-type processor */\r\n  typeProcessor: false,\r\n  /** template processor */\r\n  templateProcessor: false,\r\n};\r\n","import { Subject } from 'rxjs';\r\nimport { log as parentLog } from './log';\r\n\r\nconst log = parentLog.subLog('boot-controller');\r\n/**\r\n * Special reboot controller, to restart the angular app\r\n * when critical parameters were changed\r\n */\r\nexport class BootController {\r\n  private static instance: BootController;\r\n  private _reboot: Subject<boolean> = new Subject();\r\n  rebootRequest$ = this._reboot.asObservable();\r\n\r\n  static getRebootController() {\r\n    log.add('getRebootController()');\r\n    if (!BootController.instance) {\r\n      BootController.instance = new BootController();\r\n    }\r\n    return BootController.instance;\r\n  }\r\n\r\n  public reboot() {\r\n    log.add('restarting...');\r\n    this._reboot.next(true);\r\n  }\r\n}\r\n","import { SxcRoot } from '../../../sxc-typings';\r\nimport { urlParams } from './core/constants';\r\n\r\ndeclare const $2sxc: SxcRoot;\r\n\r\nexport class Config {\r\n  static appId = () => parseInt(get(urlParams.appId));\r\n  static apps = () => get(urlParams.apps);\r\n\r\n  static moduleId = () => Number(req(urlParams.moduleId));\r\n  static cbId = () => Number(req(urlParams.contentBlockId));\r\n\r\n  static getSxcInstance = () => $2sxc(Config.moduleId(), Config.cbId());\r\n}\r\n\r\n\r\nfunction req(key) { return $2sxc.urlParams.require(key); }\r\n\r\nfunction get(key) { return $2sxc.urlParams.get(key); }\r\n","\r\n/** These are all the url params the UI needs to function */\r\nexport const urlParams = {\r\n  // These are used in UI.html, but we keep them here so we have a full list documented\r\n  pageId: 'tid',\r\n\r\n  /**\r\n   *  request verification token header name\r\n   */\r\n  requestVerificationTokenHeader: 'rvth',\r\n\r\n  /**\r\n   *  request verification token value\r\n   */\r\n  requestVerificationToken: 'rvt',\r\n\r\n  api: 'api',\r\n\r\n  /**\r\n   * Context: App we're on.\r\n   * This is often 0 (zero) as initially it's not known.\r\n   */\r\n  appId: 'appId',\r\n\r\n  /**\r\n   * Selection of what apps should be shown by the dialog\r\n   * this is an optional parameter\r\n   */\r\n  apps: 'apps',\r\n\r\n  /** Context: Module we're on */\r\n  moduleId: 'mid',\r\n\r\n  /** Context: ContentBlock we're on */\r\n  contentBlockId: 'cbid',\r\n};\r\n","/* Constants for i18n */\r\n\r\nexport const PrimaryUiLanguage = 'en';\r\nexport const SupportedLanguages = ['en', 'de', 'es', 'fr', 'it', 'uk'];\r\nexport const i18nPrefix = 'TemplatePicker.LayoutElement';\r\nexport const pathToI18n = './i18n/';\r\nexport const i18nExtension = '.js';\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { map, switchMap, share, distinctUntilChanged } from 'rxjs/operators';\r\nimport { Constants } from './constants';\r\nimport { ContextDto } from '../../../../shared';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class BackendSettings {\r\n\r\n  appId = new BehaviorSubject<number>(0);\r\n\r\n  data: Observable<ContextDto>\r\n\r\n  constructor(http: HttpClient) {\r\n    this.data = this.appId.pipe(\r\n      distinctUntilChanged(),\r\n      switchMap(id => http.get<{ Context: ContextDto }>(`${Constants.webApiDialogContext}?appId=${id}`)),\r\n      map(bundle => bundle.Context),\r\n      share()\r\n    );\r\n  }\r\n\r\n  setApp(id: number) {\r\n    this.appId.next(id);\r\n  }\r\n}\r\n","import { BehaviorSubject, Observable } from 'rxjs';\r\n\r\n// Todo: probably not needed any more, since now Subjects are automatically observables\r\nexport class BehaviorObservable<T> extends Observable<T> {\r\n  private constructor() {\r\n    super();\r\n  }\r\n  /** The source subject */\r\n  subject: BehaviorSubject<T>;\r\n\r\n  /** will reset back to the initial value */\r\n  reset: () => void;\r\n\r\n  /** check if it's the initial object */\r\n  isInitial: () => boolean;\r\n\r\n  /** the initial object */\r\n  initialValue: T;\r\n\r\n  /** shorthand to push next value */\r\n  next: (value: T) => void;\r\n\r\n  static create<T>(initialValue: T): BehaviorObservable<T> {\r\n    const subj = new BehaviorSubject<T>(initialValue);\r\n    const obs = subj.asObservable() as BehaviorObservable<T>;\r\n    obs.initialValue = initialValue;\r\n    obs.subject = subj;\r\n    obs.reset = () => {\r\n      obs.subject.next(obs.initialValue);\r\n    };\r\n    obs.isInitial = () => {\r\n      return obs.subject.value === obs.initialValue;\r\n    };\r\n    obs.next = (value: T) => obs.subject.next(value);\r\n    return obs;\r\n  }\r\n}\r\n","export const cViewWithoutContent = '_LayoutElement';\r\nexport const cAppActionImport = -1;\r\n","import { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { log as parentLog } from 'app/core/log';\r\nimport { DebugConfig } from 'app/debug-config';\r\nimport { i18nPrefix } from 'app/i18n';\r\nimport { cViewWithoutContent } from '../constants';\r\nimport { ContentType } from '../content-type';\r\nimport { Template } from '../template';\r\n\r\n// const debug = true;\r\nconst log = parentLog.subLog('ct-processor', DebugConfig.typeProcessor);\r\n\r\n/**\r\n * This is a helper to do various transformations for the list of content-types\r\n */\r\n@Injectable()\r\nexport class ContentTypesProcessor {\r\n  constructor(private translate: TranslateService) { }\r\n\r\n  public buildList(allTypes: ContentType[], type: ContentType, allTemplates: Template[], template: Template): ContentType[] {\r\n    log.add('buildList(...) of content-types to show');\r\n    let unhide = this.unhideSelectedType(allTypes, type, template);\r\n    unhide = this.addEmptyTypeIfNeeded(unhide, allTemplates);\r\n    const filtered = this.hideNecessaryTypes(unhide);\r\n    return this.sortTypes(filtered);\r\n  }\r\n\r\n  private hideNecessaryTypes(types: ContentType[]): ContentType[] {\r\n    return types.filter(t => !t.IsHidden);\r\n  }\r\n\r\n  /**\r\n   * Ensure current content-type is visible, just in case it's configured as hidden\r\n   */\r\n  private unhideSelectedType(contentTypes: ContentType[], currentType: ContentType, currentTemplate: Template): ContentType[] {\r\n    contentTypes\r\n      .filter(c => (currentTemplate?.TemplateId === c.TemplateId) || (c.StaticName === currentType?.StaticName))\r\n      .forEach(c => c.IsHidden = false);\r\n    return contentTypes;\r\n  }\r\n\r\n\r\n  /**\r\n   * add an empty content-type for UI selection if any template would support \"no content-type\"\r\n   */\r\n  private addEmptyTypeIfNeeded(contentTypes: ContentType[], templates: Template[]): ContentType[] {\r\n    const layoutElementLabel = (this.translate && this.translate.instant(i18nPrefix))\r\n      || cViewWithoutContent; // if translate is not ready, use the nicer label\r\n\r\n    // add option for empty content type\r\n    if (templates && templates.find(t => t.ContentTypeStaticName === '')) {\r\n      contentTypes = contentTypes.slice(); // copy it first to not change original\r\n      contentTypes.push({\r\n        StaticName: cViewWithoutContent,\r\n        Name: i18nPrefix,\r\n        Thumbnail: null,\r\n        Label: layoutElementLabel,\r\n        IsHidden: false,\r\n      } as ContentType);\r\n    }\r\n    return contentTypes;\r\n  }\r\n\r\n  /**\r\n   * Sort the types by label\r\n   */\r\n  private sortTypes(contentTypes: ContentType[]): ContentType[] {\r\n    // https://stackoverflow.com/questions/51165/how-to-sort-strings-in-javascript\r\n    return contentTypes.sort((a, b) => ('' + a.Label).localeCompare(b.Label));\r\n  }\r\n\r\n  /**\r\n   * Sort the types by IsDefault DESC and Label ASC\r\n  */\r\n  private static sortTypesWithDefault(contentTypes: ContentType[]): ContentType[] {\r\n    return contentTypes.sort((a, b) => {\r\n      // first sort by IsDefault DESC\r\n      if (a.IsDefault > b.IsDefault) return -1;\r\n      if (a.IsDefault < b.IsDefault) return 1;\r\n      // than sort by Label ASC\r\n      return ('' + a.Label).localeCompare(b.Label);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get first default or alphabetically\r\n   */\r\n  static firstDefault(contentTypes: ContentType[]): ContentType {\r\n    return this.sortTypesWithDefault([...contentTypes])[0];\r\n  }\r\n\r\n  // tslint:disable-next-line:member-ordering\r\n  static findContentTypesById(contentTypes: ContentType[], selectedContentTypeId: string): ContentType {\r\n    log.add(`findContentTypesById(..., ${selectedContentTypeId}`);\r\n    return selectedContentTypeId\r\n      ? contentTypes.find(c => c.StaticName === selectedContentTypeId)\r\n      : null;\r\n  }\r\n\r\n}\r\n","export class App {\r\n    AppId: number;\r\n    Name: string;\r\n    Thumbnail: string;\r\n    SupportsAjaxReload: boolean;\r\n    Version: string;\r\n    VersionMain: number;\r\n\r\n    constructor(json: any) {\r\n        Object.assign(this, json);\r\n\r\n        try {\r\n            this.VersionMain = parseInt(this.Version.substr(0,2));\r\n        } catch(e) { /* ignore */}\r\n    }\r\n\r\n}\r\n","import { combineLatest } from 'rxjs';\r\nimport { map, startWith, share } from 'rxjs/operators';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { App } from 'app/core/app';\r\nimport { ContentType } from 'app/template-picker/content-type';\r\nimport { Template } from 'app/template-picker/template';\r\nimport { log as parentLog } from 'app/core/log';\r\nimport { Constants } from 'app/core/constants';\r\nimport { DebugConfig } from 'app/debug-config';\r\nimport { BehaviorObservable } from 'app/core/behavior-observable';\r\nimport { Config } from '../config';\r\n\r\nconst log = parentLog.subLog('api', DebugConfig.api.enabled);\r\nconst uninitializedList = []; // this must be created as a variable, so we can check later if it's still the original or a new empty list\r\n@Injectable()\r\nexport class PickerService {\r\n  // #region public properties\r\n  /** all apps of the zone */\r\n  apps$ = BehaviorObservable.create<App[]>(uninitializedList);\r\n\r\n  /** all types of this app */\r\n  contentTypes$ = BehaviorObservable.create<ContentType[]>(uninitializedList);\r\n\r\n  /** templates/views of this app */\r\n  templates$ = BehaviorObservable.create<Template[]>(uninitializedList);\r\n\r\n  /**\r\n   * ready is true when all necessary data is loaded\r\n   * note that apps are not loaded if not needed */\r\n  ready$ = new Observable<boolean>();\r\n  // #endregion\r\n\r\n  // #region private properties\r\n  private mustLoadApps = false;\r\n  // all the subjects - these are all multi-cast, so don't use share!\r\n  // #endregion\r\n\r\n  constructor(private http: HttpClient) {\r\n    log.add('constructor()');\r\n    this.buildObservables();\r\n    this.enableLogging();\r\n  }\r\n\r\n  private buildObservables() {\r\n    log.add(`buildObservables()`);\r\n\r\n    // ready requires all to have data, but app can be skipped if not required\r\n    this.ready$ = combineLatest([this.apps$, this.contentTypes$, this.templates$])\r\n      .pipe(\r\n        map(([a, ct, t]) => ({ apps: a, types: ct, templates: t })),\r\n        map(set => set.templates !== uninitializedList\r\n          && set.types !== uninitializedList\r\n          && (!this.mustLoadApps || !!(set.apps && set.apps !== uninitializedList))),\r\n        startWith(false),\r\n        share());\r\n  }\r\n\r\n  public saveAppId(appId: string, reloadParts: boolean): Promise<any> {\r\n    log.add(`saveAppId(${appId}, ${reloadParts})`);\r\n    // skip doing anything here, if we're in content-mode (which doesn't use/change apps)\r\n    if (!this.loadApps) throw new Error(`can't save app, as we're not in app-mode`);\r\n    return this.http.post(`${Constants.webApiSetApp}?appId=${appId}`, {}).toPromise();\r\n  }\r\n\r\n\r\n\r\n  public initLoading(requireApps: boolean): Observable<any> {\r\n    log.add(`initLoading(requireApps: ${requireApps})`);\r\n    this.mustLoadApps = requireApps;\r\n    if (requireApps) this.loadApps();\r\n    return this.reloadAppParts();\r\n  }\r\n\r\n  public reloadAppParts(): Observable<any> {\r\n    return combineLatest([this.loadTemplates(), this.loadContentTypes()]);\r\n  }\r\n\r\n  /**\r\n   * load templates - is sometimes repeated if the app changes\r\n   */\r\n  public loadTemplates(): Observable<any> {\r\n    log.add('loadTemplates()');\r\n    this.templates$.reset();\r\n    const obs = this.http.get<Template[]>(Constants.webApiGetTemplates)\r\n      .pipe(share()); // ensure it's only run once\r\n\r\n    obs.subscribe(response => this.templates$.next(response || []));\r\n    return obs;\r\n  }\r\n\r\n  /**\r\n   * Load the ContentTypes - only needed on first initialization\r\n   */\r\n  private loadContentTypes(): Observable<any> {\r\n    log.add(`loadContentTypes()`);\r\n    this.contentTypes$.reset();\r\n    const obs = this.http.get<ContentType[]>(Constants.webApiGetTypes)\r\n      .pipe(share()); // ensure it's only run once\r\n    obs.pipe(map(response => (response || []).map(ct => {\r\n        ct.Label = ct.Properties?.Label ?? ct.Name;\r\n        return ct;\r\n      })))\r\n      .subscribe(json => this.contentTypes$.next(json));\r\n    return obs;\r\n  }\r\n\r\n  /**\r\n   * Load all Apps, only needed on first initialization\r\n   */\r\n  private loadApps(): Observable<any> {\r\n    const alreadyLoaded = !this.apps$.isInitial();\r\n    log.add(`loadApps() - skip:${alreadyLoaded}`);\r\n    if (alreadyLoaded) return;\r\n\r\n    const appsFilter = Config.apps();\r\n\r\n    const obs = this.http.get<any[]>(`${Constants.webApiGetApps}?apps=${appsFilter}`)\r\n      .pipe(share()); // ensure it's only run once\r\n\r\n    obs.subscribe(response => this.apps$.subject.next(response.map(a => new App(a))));\r\n    return obs;\r\n  }\r\n\r\n  private enableLogging() {\r\n    const streamLog = parentLog.subLog('api-streams', DebugConfig.api.streams);\r\n    this.apps$.subscribe(a => streamLog.add(`app$:${a && a.length}`));\r\n    this.contentTypes$.subscribe(ct => streamLog.add(`contentTypes$:${ct && ct.length}`));\r\n    this.templates$.subscribe(t => streamLog.add(`templates$:${t && t.length}`));\r\n    this.ready$.subscribe(r => streamLog.add(`ready$:${r}`));\r\n  }\r\n\r\n}\r\n","export const Constants = {\r\n  logName: 'quick-edit',\r\n\r\n  //#region WebApi Endpoints used: 2sxc\r\n  webApiDialogContext: 'admin/dialog/settings',\r\n  webApiInstallPackage: 'sys/install/RemotePackage',\r\n  webApiRemoteInstaller: 'sys/install/RemoteWizardUrl',\r\n  webApiGetTemplates: 'cms/block/Templates',\r\n  webApiGetTypes: 'cms/block/ContentTypes',\r\n  webApiGetApps: 'cms/block/Apps',\r\n  webApiSetApp: 'cms/block/App',\r\n  //#endregion\r\n};\r\n\r\nexport * from '../../../../connect-parts/inpage-quick-dialog/quick-dialog-params';\r\n","import { Template } from '../template';\r\nimport { ContentType } from '../content-type';\r\nimport { App } from 'app/core/app';\r\nimport { log as parentLog } from 'app/core/log';\r\nimport { DebugConfig } from 'app/debug-config';\r\n\r\nconst log = parentLog.subLog('TemplateProcessor', DebugConfig.templateProcessor);\r\n\r\nexport class TemplateProcessor {\r\n  static pickSelected(selected: Template, templates: Template[], type: ContentType, app: App): Template {\r\n    log.add(`pickSelected(selected: ${selected && selected.TemplateId}, templates: ${templates.length})`)\r\n    // if one is selected, return that; but only if it's in the list of possible templates\r\n    if (selected && templates.find(t => t.TemplateId === selected.TemplateId))\r\n      return selected;\r\n\r\n    // if none is selected, return the first (preferred default DESC); assuming a type or app has been selected\r\n    if ((type || app) && templates && templates.length) return this.sortTemplates([...templates])[0];\r\n\r\n    // nothing valid\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Sort the templates by IsDefault DESC and Name ASC\r\n   */\r\n  static sortTemplates(templates: Template[]): Template[] {\r\n    // https://stackoverflow.com/questions/51165/how-to-sort-strings-in-javascript\r\n    return templates.sort((a, b) => {\r\n      // first sort by IsDefault DESC\r\n      if (a.IsDefault > b.IsDefault) return -1;\r\n      if (a.IsDefault < b.IsDefault) return 1;\r\n      // than by Name ASC\r\n      return ('' + a.Name).localeCompare(b.Name);\r\n    });\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { cViewWithoutContent } from './constants';\r\nimport { Template } from './template';\r\nimport { ContentType } from './content-type';\r\n\r\n@Pipe({\r\n  name: 'templateFilter'\r\n})\r\nexport class TemplateFilterPipe implements PipeTransform {\r\n\r\n\r\n  transform(templates: Template[], args: {isContent: boolean, contentType: ContentType } ): Template[] {\r\n\r\n    const typeId = args.contentType ? args.contentType.StaticName : undefined;\r\n\r\n    // in case we're filtering for the special \"empty\" code, use empty in the filter\r\n    const typeNameFilter = typeId === cViewWithoutContent\r\n      ? ''\r\n      : (typeId || '');\r\n\r\n    return templates\r\n      .filter(t => !t.IsHidden)\r\n      .filter(t => !args.isContent || t.ContentTypeStaticName === typeNameFilter);\r\n  }\r\n}\r\n","\r\n// #region imports\r\nimport { Injectable } from '@angular/core';\r\nimport { App } from 'app/core/app';\r\nimport { BehaviorObservable } from 'app/core/behavior-observable';\r\nimport { log as parentLog } from 'app/core/log';\r\nimport { DebugConfig } from 'app/debug-config';\r\nimport { IQuickDialogConfig } from 'app/interfaces/shared';\r\nimport { combineLatest, merge, Observable } from 'rxjs';\r\nimport { debounceTime, filter, map, scan, share, startWith, tap } from 'rxjs/operators';\r\nimport { ContentType } from './content-type';\r\nimport { ContentTypesProcessor } from './data/content-types-processor.service';\r\nimport { TemplateProcessor } from './data/template-processor';\r\nimport { PickerService } from './picker.service';\r\nimport { Template } from './template';\r\nimport { TemplateFilterPipe } from './template-filter.pipe';\r\n\r\n// #endregion\r\n\r\nconst log = parentLog.subLog('state', DebugConfig.state.enabled);\r\n\r\n@Injectable()\r\nexport class CurrentDataService {\r\n  /** Currently selected app */\r\n  app$: Observable<App>;\r\n\r\n  /** Relevant types */\r\n  types$: Observable<ContentType[]>;\r\n\r\n  /** The currently selected type */\r\n  type$: Observable<ContentType>;\r\n\r\n  /** Stream containing the currently selected template or null if not selected */\r\n  template$: Observable<Template>;\r\n\r\n  /** all templates relevant for the UI */\r\n  templates$: Observable<Template[]>;\r\n\r\n  private appId$ = BehaviorObservable.create<number>(null);\r\n  private initialTypeId$ = BehaviorObservable.create<string>(null);\r\n  private initialTemplateId$ = BehaviorObservable.create<number>(null);\r\n  private selectedType$ = BehaviorObservable.create<ContentType>(null);\r\n  private selectedTemplate$ = BehaviorObservable.create<Template>(null);\r\n\r\n\r\n  private config: IQuickDialogConfig;\r\n\r\n  constructor(\r\n    private api: PickerService,\r\n    private templateFilter: TemplateFilterPipe,\r\n    private ctProcessor: ContentTypesProcessor\r\n  ) {\r\n    this.buildBasicObservables();\r\n  }\r\n\r\n  private buildBasicObservables() {\r\n    // app-stream should contain selected app, once the ID is known - or null\r\n    this.app$ = combineLatest([\r\n      this.api.apps$,\r\n      this.appId$]).pipe(map(([apps, appId]) => apps.find(a => a.AppId === appId)));\r\n\r\n    // current type should be either the initial type, or a manually selected type\r\n    const initialType$ = combineLatest([this.initialTypeId$, this.api.contentTypes$])\r\n      .pipe(map(([typeId, all]) => ContentTypesProcessor.findContentTypesById(all, typeId)));\r\n    this.type$ = merge(initialType$, this.selectedType$).pipe(\r\n      startWith(null as ContentType),\r\n      share());\r\n\r\n    // the templates-list is always filtered by the currently selected type\r\n    this.templates$ = combineLatest([this.api.templates$, this.type$])\r\n      .pipe(map(([all, current]) => this.findTemplatesForTypeOrAll(all, current)))\r\n      .pipe(startWith(new Array<Template>()));\r\n\r\n    // the current template is either the last selected, or auto-selected when conditions change\r\n    const initialTemplate$ = combineLatest([\r\n      this.initialTemplateId$,\r\n      this.api.templates$])\r\n      .pipe(\r\n        map(([id, templates]) => templates.find(t => t.TemplateId === id)),\r\n        filter(t => t != null), // only allow new values which are not null, to guarantee later template$ updates don't affect this\r\n        startWith(null as Template),\r\n        share());\r\n\r\n    const selected$ = merge(initialTemplate$, this.selectedTemplate$.pipe(filter(t => t !== null)));\r\n    this.template$ = combineLatest([\r\n      selected$,\r\n      this.templates$,\r\n      this.type$,\r\n      this.app$]).pipe(\r\n        map(([selected, templates, type, app]) => TemplateProcessor.pickSelected(selected, templates, type, app)),\r\n        startWith(null as Template),\r\n        share(),\r\n      );\r\n\r\n    // construct list of relevant types for the UI\r\n    this.types$ = combineLatest([\r\n      this.api.contentTypes$,\r\n      this.type$,\r\n      this.api.templates$,\r\n      this.template$])\r\n      .pipe(map(([types, type, templates, template]) => this.ctProcessor.buildList(types, type, templates, template)));\r\n  }\r\n\r\n  init(config: IQuickDialogConfig): Observable<boolean> {\r\n    this.config = config;\r\n    // app-init is ready, if it has an app or doesn't need to init one\r\n    log.add(`initializing with config:${JSON.stringify(config)}`, config);\r\n    const appReady$ = this.app$.pipe(\r\n      map(a => config.isContent || !!a),\r\n      startWith(config.isContent || !config.appId)\r\n    );\r\n\r\n    const typeReady$ = this.type$.pipe(\r\n      map(t => !!t),\r\n      scan((acc, value) => acc || value, !config.contentTypeId)\r\n    );\r\n    const templReady$ = this.template$.pipe(\r\n      map(t => !!t),\r\n      debounceTime(100), // need to debounce, because the template might have a value and change again\r\n      startWith(!config.templateId)\r\n    );\r\n\r\n    const loadAll$ = combineLatest([appReady$, templReady$, typeReady$])\r\n      .pipe(map(set => set[0] && set[1] && set[2]));\r\n\r\n    this.initLogging(appReady$, typeReady$, templReady$, loadAll$);\r\n\r\n    // automatically set the app, type and template\r\n    this.activateCurrentApp(config.appId);\r\n    this.initialTypeId$.next(config.contentTypeId);\r\n    this.initialTemplateId$.next(config.templateId);\r\n\r\n    return loadAll$;\r\n  }\r\n\r\n  private initLogging(inita$: Observable<boolean>,\r\n    inittyp$: Observable<boolean>,\r\n    initt$: Observable<boolean>,\r\n    initAll$: Observable<boolean>): void {\r\n    const slog = log.subLog('stream', DebugConfig.state.streams);\r\n    this.type$.subscribe(t => slog.add(`type$ update:'${t && t.Label}'`, t));\r\n    this.app$.subscribe(a => slog.add(`app$ update:'${a && a.AppId}'`, a));\r\n    this.template$.subscribe(t => slog.add(`template$ update:'${t && t.TemplateId}'`, t));\r\n    this.templates$.subscribe(t => slog.add(`templates$ count:'${t && t.length}'`, t));\r\n    this.types$.subscribe(t => slog.add(`types$ count:'${t && t.length}'`, t));\r\n    this.selectedTemplate$.subscribe(t => slog.add(`selectedTemplate$: ${t && t.TemplateId}`));\r\n\r\n    const initLog = log.subLog('stream-init', DebugConfig.state.inits);\r\n    this.initialTypeId$.subscribe(t => initLog.add(`initial TypeId:'${t}'`, t));\r\n    this.initialTemplateId$.subscribe(t => initLog.add(`initial TemplateId:'${t}'`, t));\r\n    inita$.subscribe(t => initLog.add(`init app$`, t));\r\n    inittyp$.subscribe(t => initLog.add(`init type$`, t));\r\n    initt$.subscribe(t => initLog.add(`init temp$`, t));\r\n    initAll$.subscribe(t => initLog.add(`init all$`, t));\r\n  }\r\n\r\n\r\n\r\n  //#region activate calls from outside\r\n  activateCurrentApp(appId: number) {\r\n    log.add(`activateApp(${appId})`);\r\n    this.appId$.next(appId);\r\n  }\r\n  activateType(contentType: ContentType) {\r\n    log.add(`activateType(${contentType.Name})`);\r\n    this.selectedType$.next(contentType);\r\n  }\r\n  activateTemplate(template: Template) {\r\n    log.add(`activateTemplate(${template.TemplateId})`);\r\n    this.selectedTemplate$.next(template);\r\n  }\r\n  //#endregion\r\n\r\n  private findTemplatesForTypeOrAll(allTemplates: Template[], contentType: ContentType): Template[] {\r\n    return this.templateFilter.transform(allTemplates, { contentType, isContent: this.config.isContent });\r\n  }\r\n\r\n}\r\n","\r\nimport {of as observableOf } from 'rxjs';\r\n\r\nimport {switchMap} from 'rxjs/operators';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Constants } from 'app/core/constants';\r\n\r\n@Injectable()\r\nexport class InstallerService {\r\n\r\n  constructor(\r\n    private http: HttpClient\r\n  ) { }\r\n\r\n  installPackages(packages: any[], step: Function): Observable<any> {\r\n    return packages.reduce((t: Observable<Response>, c) => t.pipe(\r\n        switchMap(() => {\r\n          if (!c.url) return observableOf(true);\r\n          step(c);\r\n          return <Observable<any>>this.http.post(`${Constants.webApiInstallPackage}?packageUrl=${c.url}`, {});\r\n        })), observableOf(true));\r\n  }\r\n}\r\n","\r\nimport { startWith, map, tap } from 'rxjs/operators';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Subject, Observable } from 'rxjs';\r\nimport { log } from 'app/core/log';\r\nimport { Constants } from 'app/core/constants';\r\n\r\n@Injectable()\r\nexport class GettingStartedService {\r\n  gettingStarted$: Observable<string>;\r\n  ready$ = new Observable<boolean>();\r\n\r\n  private gettingStartedSubject: Subject<string> = new Subject<string>();\r\n\r\n  constructor(private http: HttpClient) {\r\n    this.gettingStarted$ = this.gettingStartedSubject.asObservable();\r\n    this.ready$ = this.gettingStarted$.pipe(\r\n      map(() => true),\r\n      startWith(false));\r\n\r\n    this.ready$.pipe(tap(r => log.add(`ready getting started:${r}`))).subscribe();\r\n  }\r\n\r\n  public loadGettingStarted(isContentApp: boolean): void {\r\n    this.http.get<string>(`${Constants.webApiRemoteInstaller}?isContentApp=${isContentApp}`)\r\n      .subscribe(json => this.gettingStartedSubject.next(json));\r\n  }\r\n\r\n}\r\n","<div class=\"progress\" *ngIf=\"showProgress\">\r\n  <mat-progress-spinner [mode]=\"'indeterminate'\"></mat-progress-spinner>\r\n  <span>Installing {{ currentPackage?.displayName }}..</span>\r\n</div>\r\n<div *ngIf=\"ready\">\r\n  <iframe class=\"fr-getting-started\" id=\"frGettingStarted\" [src]=\"remoteInstallerUrl\" width=\"100%\" height=\"300px\"></iframe>\r\n</div>\r\n","\r\nimport { tap, switchMap, map, filter, debounceTime } from 'rxjs/operators';\r\nimport { Component, OnInit, Input } from '@angular/core';\r\nimport { InstallerService } from 'app/installer/installer.service';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { fromEvent, Subscription } from 'rxjs';\r\nimport { GettingStartedService } from './getting-started.service';\r\nimport { Config } from '../config';\r\n\r\ndeclare const $2sxc: any;\r\n\r\n@Component({\r\n  selector: 'app-installer',\r\n  templateUrl: './installer.component.html',\r\n  styleUrls: ['./installer.component.scss']\r\n})\r\nexport class InstallerComponent implements OnInit {\r\n  @Input() isContentApp: boolean;\r\n\r\n  showProgress: boolean;\r\n  currentPackage: any;\r\n  remoteInstallerUrl = '';\r\n  ready = false;\r\n\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  constructor(\r\n    private installer: InstallerService,\r\n    private api: GettingStartedService,\r\n    private sanitizer: DomSanitizer,\r\n  ) {\r\n    this.subscriptions.push(\r\n      this.api.gettingStarted$.subscribe(url => {\r\n        this.remoteInstallerUrl = <string>this.sanitizer.bypassSecurityTrustResourceUrl(url);\r\n        this.ready = true;\r\n      }));\r\n\r\n    window.bootController.rebootRequest$.pipe(\r\n      debounceTime(1000))\r\n      .subscribe(() => this.destroy());\r\n  }\r\n\r\n  destroy(): void {\r\n    this.subscriptions\r\n      .forEach(sub => sub.unsubscribe());\r\n    console.log('destroy subs', this.subscriptions);\r\n  }\r\n\r\n  ngOnInit() {\r\n    let alreadyProcessing = false;\r\n    this.api.loadGettingStarted(this.isContentApp);\r\n\r\n    this.subscriptions.push(fromEvent(window, 'message').pipe(\r\n\r\n      // Ensure only one installation is processed.\r\n      filter(() => !alreadyProcessing),\r\n\r\n      // Get data from event.\r\n      map((evt: MessageEvent) => {\r\n        try {\r\n          return JSON.parse(evt.data);\r\n        } catch (e) {\r\n          return void 0;\r\n        }\r\n      }),\r\n\r\n      // Check if data is correct.\r\n      filter(data => data\r\n        && Number(data.moduleId) === Config.moduleId()\r\n        && data.action === 'install'),\r\n\r\n      // Get packages from data.\r\n      map(data => Object.values(data.packages)),\r\n\r\n      // Show confirm dialog.\r\n      filter(packages => {\r\n        const packagesDisplayNames = packages\r\n          .reduce((t, c) => `${t} - ${(c as any).displayName}\\n`, '');\r\n\r\n        const msg = `Do you want to install these packages?\r\n\r\n${packagesDisplayNames}\r\nThis takes about 10 seconds per package. Don't reload the page while it's installing.`;\r\n        return confirm(msg);\r\n      }),\r\n\r\n      switchMap(packages => {\r\n        alreadyProcessing = true;\r\n        this.showProgress = true;\r\n        return this.installer.installPackages(packages, p => this.currentPackage = p);\r\n      }),\r\n\r\n      tap(() => {\r\n        this.showProgress = false;\r\n        alert('Installation complete 👍');\r\n        window.top.location.reload();\r\n      }))\r\n\r\n      .subscribe(null, () => {\r\n        this.showProgress = false;\r\n        alert('An error occurred.');\r\n        alreadyProcessing = false;\r\n      }));\r\n  }\r\n}\r\n","\r\n<div class=\"content\">\r\n\r\n  <!-- debug info section -->\r\n  <div *ngIf=\"showDebug\">\r\n    <h4>Debug 2sxc 11 / ng 11</h4>\r\n    <ul>\r\n      <li>Types: {{ types?.length }}, current: {{contentType?.StaticName}}, default: {{defaultContentType?.Label}}</li>\r\n      <li>Apps: {{ (apps$ | async)?.length }}, current: {{app?.AppId }} </li>\r\n      <li>Templates: {{templates?.length}}, current: {{template?.TemplateId}}</li>\r\n      <li>Config: isContent='{{isContent}}' Ready: {{ready}} </li>\r\n      <li>Tab to show: '{{tabIndex}}' / preventTypeSwitch '{{preventTypeSwitch}}' / preventAppSwitch '{{preventAppSwich}}'</li>\r\n    </ul>\r\n  </div>\r\n\r\n  <!-- loading indicator -->\r\n  <mat-progress-bar [ngStyle]=\"{ opacity: ready ? 0 : 1 }\" [mode]=\"'indeterminate'\"></mat-progress-bar>\r\n\r\n  <!-- main dialog, starting with save/cancel button -->\r\n  <div class=\"card\"\r\n    [ngClass]=\"{ blocked: !ready }\"\r\n  >\r\n    <div class=\"top-controls\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n      <button mat-fab *ngIf=\"template\" (click)=\"persistTemplate(template)\" [attr.title]=\"'TemplatePicker.Save' | translate\">\r\n        <mat-icon>check</mat-icon>\r\n      </button>\r\n      <button mat-mini-fab class=\"secondary\" *ngIf=\"showCancel\" (click)=\"cancel()\" [attr.title]=\"('TemplatePicker.' + (isContent ? 'Cancel' : 'Close')) | translate\">\r\n        <mat-icon>close</mat-icon>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- tabs -->\r\n    <mat-tab-group [(selectedIndex)]=\"tabIndex\">\r\n      <mat-tab>\r\n        <ng-template mat-tab-label>\r\n          {{(isContent\r\n            ? (contentType?.Name || ('TemplatePicker.ContentTypePickerDefault' | translate))\r\n            : (app?.Name || ('TemplatePicker.AppPickerDefault' | translate)))}}\r\n        </ng-template>\r\n\r\n        <!-- App Selector -->\r\n        <div *ngIf=\"!isContent; else contentApp\" class=\"tiles\">\r\n\r\n          <div class=\"tile\"\r\n            [ngClass]=\"{ active: app?.AppId === a.AppId, blocked: preventTypeSwitch }\"\r\n            [attr.title]=\"a.Name\"\r\n            (click)=\"selectApp(app, a)\"\r\n            (dblclick)=\"switchTab()\" *ngFor=\"let a of apps$ | async\">\r\n            <div class=\"bg\">\r\n              <img *ngIf=\"a.Thumbnail !== null && a.Thumbnail !== ''\" class=\"bg-img\" [attr.src]=\"a.Thumbnail + '?w=176&h=176'\">\r\n              <div *ngIf=\"a.Thumbnail === null || a.Thumbnail === ''\" class=\"bg-icon\">\r\n                <mat-icon>star</mat-icon>\r\n              </div>\r\n            </div>\r\n            <div class=\"version\"><span>v{{a.VersionMain}}</span></div>\r\n\r\n            <div class=\"title\" [ngClass]=\"{ show: a.Thumbnail === null || a.Thumbnail === '' }\">\r\n              <span>{{a.Name}}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- install and manage buttons -->\r\n          <div class=\"tile config\" *ngIf=\"showAdvanced\" (click)=\"run('app-import')\" [attr.title]=\"'TemplatePicker.Install' | translate\">\r\n            <div class=\"bg\">\r\n              <div class=\"bg-icon\">\r\n                <mat-icon>get_app</mat-icon>\r\n              </div>\r\n            </div>\r\n            <div class=\"title show\">\r\n              <span>{{\"TemplatePicker.Install\" | translate}}</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"tile config\" *ngIf=\"showAdvanced\" (click)=\"run('zone')\" [attr.title]=\"'TemplatePicker.Zone' | translate\">\r\n            <div class=\"bg\">\r\n              <div class=\"bg-icon\">\r\n                <mat-icon>apps</mat-icon>\r\n              </div>\r\n            </div>\r\n            <div class=\"title show\">\r\n              <span>{{\"TemplatePicker.Zone\" | translate}}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Content-Type selection (when not a generic app, but the default content-app -->\r\n        <ng-template #contentApp>\r\n          <div class=\"tiles\">\r\n            <div mat-button class=\"tile\"\r\n              [ngClass]=\"{ active: contentType ? contentType?.StaticName === c.StaticName : defaultContentType?.StaticName === c.StaticName, blocked: preventTypeSwitch }\"\r\n              [attr.title]=\"(c.Label | translate) + (showDebug ? ' (' + c.StaticName + ')' : '')\"\r\n              (click)=\"selectContentType(contentType, c)\"\r\n              (dblclick)=\"switchTab()\"\r\n              *ngFor=\"let c of types\"\r\n            >\r\n              <div class=\"bg\">\r\n                <img *ngIf=\"c.Thumbnail !== null && c.Thumbnail !== ''\" class=\"bg-img\" [attr.src]=\"c.Thumbnail + '?w=176&h=176'\">\r\n                <div *ngIf=\"c.Thumbnail === null || c.Thumbnail === ''\" class=\"bg-icon\">\r\n                  <mat-icon>bubble_chart</mat-icon>\r\n                </div>\r\n              </div>\r\n              <div class=\"title\" [ngClass]=\"{ show: c.Thumbnail === null || c.Thumbnail === '' }\">\r\n                <span>{{c.Label}}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </ng-template>\r\n      </mat-tab>\r\n\r\n      <!-- template selection after app/content-type selection -->\r\n      <mat-tab *ngIf=\"isContent ? contentType : app\" [label]=\"('TemplatePicker.ChangeView' | translate) + '(' + templates.length + ')'\">\r\n        <div class=\"tiles\">\r\n          <mat-spinner class=\"templates-spinner\" *ngIf=\"templatesLoading$ | async\"></mat-spinner>\r\n          <div class=\"tile\"\r\n            [ngClass]=\"{ active: template?.TemplateId === t.TemplateId }\"\r\n            [attr.title]=\"t.Name + (showDebug ? ' (' + t.TemplateId + ')' : '')\"\r\n            (click)=\"selectTemplate(t)\"\r\n            *ngFor=\"let t of templates\">\r\n            <div class=\"bg\">\r\n              <img *ngIf=\"t.Thumbnail !== null && t.Thumbnail !== ''\" class=\"bg-img\" [attr.src]=\"t.Thumbnail + '?w=176&h=176'\">\r\n              <div *ngIf=\"t.Thumbnail === null || t.Thumbnail === ''\" class=\"bg-icon\">\r\n                <mat-icon *ngIf=\"isContent\">view_carousel</mat-icon>\r\n                <mat-icon *ngIf=\"!isContent\">view_quilt</mat-icon>\r\n              </div>\r\n            </div>\r\n            <div class=\"title\" [ngClass]=\"{ show: t.Thumbnail === null || t.Thumbnail === '' }\">\r\n              <span>{{t.Name}}</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"tile config\" *ngIf=\"showAdvanced && !isContent && app?.AppId !== null\" (click)=\"run('app')\" [attr.title]=\"'TemplatePicker.App' | translate\">\r\n            <div class=\"bg\">\r\n              <div class=\"bg-icon\">\r\n                <mat-icon>settings</mat-icon>\r\n              </div>\r\n            </div>\r\n            <div class=\"title show\">\r\n              <span>{{\"TemplatePicker.App\" | translate}}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </mat-tab>\r\n    </mat-tab-group>\r\n\r\n    <span class=\"no-install-allowed\" *ngIf=\"isBadContextForInstaller && showInstaller\">No {{isContent ? 'Content Apps' : 'Apps'}} installed yet. Please persue the installation by creating a new {{isContent ? 'Content' : 'App'}} in the root of your website.</span>\r\n    <app-installer *ngIf=\"!isBadContextForInstaller && showInstaller\" [isContentApp]=\"isContent\"></app-installer>\r\n  </div>\r\n</div>\r\n","\r\nimport { ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { App } from 'app/core/app';\r\nimport { BehaviorObservable } from 'app/core/behavior-observable';\r\nimport { Log, log as parentLog } from 'app/core/log';\r\nimport { DebugConfig } from 'app/debug-config';\r\nimport { IDialogFrameElement, IIFrameBridge, IQuickDialogConfig } from 'app/interfaces/shared';\r\nimport { ContentType } from 'app/template-picker/content-type';\r\nimport { Template } from 'app/template-picker/template';\r\nimport { combineLatest, merge, Observable, timer } from 'rxjs';\r\nimport { filter, map, skipUntil, startWith } from 'rxjs/operators';\r\nimport { BackendSettings } from '../core/backend-settings';\r\nimport { cAppActionImport } from './constants';\r\nimport { CurrentDataService } from './current-data.service';\r\nimport { ContentTypesProcessor } from './data/content-types-processor.service';\r\nimport { PickerService } from './picker.service';\r\n\r\nconst log = parentLog.subLog('picker', DebugConfig.picker.enabled);\r\n\r\n@Component({\r\n  selector: 'app-template-picker',\r\n  templateUrl: './template-picker.component.html',\r\n  styleUrls: ['./template-picker.component.scss'],\r\n})\r\nexport class TemplatePickerComponent implements OnInit {\r\n  // #region properties\r\n  /** Stream of all apps */\r\n  apps$: Observable<App[]>;\r\n\r\n  /** is cancelling possible */\r\n  showCancel = true;\r\n\r\n  /** is in the main content-app or a generic app */\r\n  isContent: boolean;\r\n\r\n  /** show advanced features (admin/host only) */\r\n  showAdvanced = false;\r\n\r\n  /** show the installer */\r\n  showInstaller = false;\r\n\r\n  /** Stream to indicate ready, for loading-indicator */\r\n  ready$: Observable<boolean>;\r\n  templatesLoading$: Observable<boolean>;\r\n\r\n  /** Tab-id, when we set it, the tab switches */\r\n  tabIndex = 0;\r\n\r\n  /** Indicate if the user is allowed to change content-types or not */\r\n  preventTypeSwitch: boolean;\r\n\r\n  /** Indicates whether the installer can be shown in this dialog or not */\r\n  isBadContextForInstaller = false;\r\n\r\n  /** The communication-object to the parent */\r\n  private bridge: IIFrameBridge;\r\n\r\n  /** internal loading state */\r\n  private loading$ = BehaviorObservable.create<boolean>(false);\r\n\r\n  /** Ajax-support changes how saving/changing is handled */\r\n  private supportsAjax: boolean;\r\n\r\n  preventAppSwich = false;\r\n\r\n  public showDebug = DebugConfig.picker.showDebugPanel;\r\n  // #endregion\r\n\r\n  // #region data to show - using local variables, because streams didn't update correctly :(\r\n  app: App;\r\n  templates: Template[];\r\n  template: Template;\r\n  contentType: ContentType;\r\n  types: ContentType[];\r\n  defaultContentType: ContentType;\r\n  ready = false;\r\n  //#endregion\r\n\r\n  constructor(\r\n    private backendSettings: BackendSettings,\r\n    private api: PickerService,\r\n    public state: CurrentDataService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    // get configuration from iframe-bridge and set everything\r\n    this.bridge = (<IDialogFrameElement>window.frameElement).bridge;\r\n    const dashInfo = this.bridge.getAdditionalDashboardConfig();\r\n\r\n    this.boot(dashInfo);\r\n    this.debugObservables();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.autosyncObservablesToEnsureUiUpdates();\r\n  }\r\n\r\n\r\n  private boot(dashInfo: IQuickDialogConfig) {\r\n    this.showDebug = dashInfo.debug;\r\n    Log.configureRuntimeLogging(dashInfo.debug);\r\n\r\n    // Make sure we have the latest backend settings\r\n    this.backendSettings.setApp(dashInfo.appId);\r\n    this.backendSettings.data.subscribe(settings => {\r\n      this.showAdvanced = settings.Enable?.CodeEditor ?? false;\r\n    });\r\n\r\n    // start data-loading\r\n    this.api.initLoading(!dashInfo.isContent);\r\n\r\n    // init parts, variables, observables\r\n    const initDone$ = this.state.init(dashInfo);\r\n    this.initObservables(initDone$);\r\n    this.initValuesFromBridge(dashInfo);\r\n    this.loading$.next(false);\r\n  }\r\n\r\n  private debugObservables() {\r\n    if (!DebugConfig.picker.streams) return;\r\n    this.loading$.subscribe(l => log.add(`loading$:${l}`));\r\n    this.ready$.subscribe(r => log.add(`ready$:${r}`));\r\n  }\r\n\r\n  /**\r\n   * wire up observables for this component\r\n   */\r\n  private initObservables(initDone$: Observable<boolean>): void {\r\n    const initTrue$ = initDone$.pipe(filter(t => !!t));\r\n\r\n    // wire up basic observables\r\n    this.ready$ = combineLatest([this.api.ready$, this.loading$])\r\n      .pipe(map(([r, l]) => r && !l));\r\n\r\n    // all apps are the same as provided by the api\r\n    this.apps$ = this.api.apps$;\r\n\r\n    // if the content-type or app is set, switch tabs (ignore null/empty states)\r\n    const typeOrAppReady = merge(this.state.type$, this.state.app$)\r\n      .pipe(filter(t => !!t));\r\n    combineLatest([typeOrAppReady, initTrue$])\r\n      .subscribe(_ => this.switchTab());\r\n\r\n    // once the data is known, check if installer is needed\r\n    combineLatest([this.api.templates$,\r\n      this.api.contentTypes$,\r\n      this.api.apps$,\r\n      this.api.ready$.pipe(filter(r => !!r))])\r\n      .pipe(\r\n        map(([templates, _, apps, _2]) => {\r\n          log.add('apps/templates loaded, will check if we should show installer');\r\n          this.showInstaller = this.isContent\r\n            ? templates.length === 0\r\n            : apps.filter(a => a.AppId !== cAppActionImport).length === 0;\r\n        }))\r\n      .subscribe();\r\n\r\n    // template loading is true, when the template-list or selected template are not ready\r\n    this.templatesLoading$ = combineLatest([this.state.templates$, this.state.template$])\r\n      .pipe(\r\n        map(([all, selected]) => !(all && selected)),\r\n        startWith(false)\r\n      );\r\n\r\n    // whenever the template changes, ensure the preview reloads\r\n    // but don't do this when initializing, that's why we listen to initDone$\r\n    this.state.template$.pipe(\r\n      filter(t => !!t),\r\n      skipUntil(initTrue$))\r\n      .subscribe(t => this.previewTemplate(t));\r\n  }\r\n\r\n  /** The UI doesn't update reliably :(, so we copy the data to local variables */\r\n  private autosyncObservablesToEnsureUiUpdates(): any {\r\n    this.state.app$.subscribe(a => this.app = a);\r\n    this.state.templates$.subscribe(t => this.templates = t);\r\n    this.state.template$.subscribe(t => this.template = t);\r\n    this.state.types$.subscribe(t => {\r\n      this.types = t;\r\n      this.defaultContentType = ContentTypesProcessor.firstDefault(t);\r\n    });\r\n    this.state.type$.subscribe(t => this.contentType = t);\r\n\r\n    this.ready$.subscribe(r => this.ready = r);\r\n    merge(\r\n      this.ready$,\r\n      this.state.app$,\r\n      this.state.type$,\r\n      this.state.types$,\r\n      this.state.template$,\r\n      this.state.templates$,\r\n      ).subscribe(() => this.cdRef.detectChanges());\r\n  }\r\n\r\n\r\n  private initValuesFromBridge(config: IQuickDialogConfig): void {\r\n    this.preventTypeSwitch = config.hasContent;\r\n    this.isBadContextForInstaller = config.isInnerContent;\r\n    this.isContent = config.isContent;\r\n    this.supportsAjax = this.isContent || config.supportsAjax;\r\n    this.preventAppSwich = config.hasContent;\r\n    this.showCancel = config.templateId != null;\r\n  }\r\n\r\n  //#region basic UI action binding\r\n  cancel(): void { this.bridge.cancel(); }\r\n\r\n  run(action: string): void { this.bridge.run(action); }\r\n\r\n  persistTemplate(template: Template) { this.bridge.setTemplate(template.TemplateId, template.Name, true); }\r\n\r\n  /**\r\n   * app selection from UI\r\n   */\r\n  selectApp(before: App, after: App): void {\r\n    console.log('selectApp()');\r\n    if (before && before.AppId === after.AppId) this.switchTab();\r\n    else this.updateApp(after);\r\n  }\r\n\r\n  /**\r\n   * content-type selection from UI\r\n   */\r\n  selectContentType(before: ContentType, after: ContentType): void {\r\n    if (before && before.StaticName === after.StaticName) this.switchTab();\r\n    else this.setContentType(after);\r\n  }\r\n\r\n  /**\r\n   * activate a template from the UI\r\n   */\r\n  selectTemplate(template: Template): void {\r\n    this.state.activateTemplate(template);\r\n  }\r\n  //#endregion\r\n\r\n  private setContentType(contentType: ContentType): void {\r\n    log.add(`select content-type '${contentType.Name}'; prevent: ${this.preventTypeSwitch}`);\r\n    if (this.preventTypeSwitch) return;\r\n    this.state.activateType(contentType);\r\n  }\r\n\r\n  switchTab() {\r\n    log.add('switchTab()');\r\n    // must delay change because of a bug in the tabs-updating\r\n    timer(100).toPromise().then(_ => this.tabIndex = 1);\r\n  }\r\n\r\n\r\n  private updateApp(newApp: App): void {\r\n    // ajax-support can change as apps are changed; for ajax, maybe both the previous and new must support it\r\n    // or just new? still WIP\r\n    const ajax = newApp.SupportsAjaxReload;\r\n    log.add(`changing app to ${newApp.AppId}; prevent-switch: ${this.preventAppSwich} use-ajax:${ajax}`);\r\n    if (this.preventAppSwich) return;\r\n\r\n\r\n    this.loading$.next(true);\r\n    this.bridge.showMessage('loading App...');\r\n    const savePromise = this.api.saveAppId(newApp.AppId.toString(), ajax);\r\n\r\n    if (ajax) {\r\n      savePromise.then(() => {\r\n        log.add('saved app, will reset some stuff');\r\n        // do this after save completed, to ensure that the module is ready on the server\r\n        log.add('calling reloadAndReInit()');\r\n        this.bridge.reloadAndReInit()\r\n          .then(newConfig => this.boot(newConfig));\r\n      });\r\n    } else {\r\n      savePromise.then(() => window.parent.location.reload());\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  private previewTemplate(t: Template): void {\r\n    log.add(`previewTemplate(${t.TemplateId}), ajax is ${this.supportsAjax}`);\r\n    this.loading$.next(true);\r\n    this.bridge\r\n      .setTemplate(t.TemplateId, t.Name, false)\r\n      .then(_ => this.loading$.next(false));\r\n  }\r\n\r\n}\r\n","import { TranslateService } from '@ngx-translate/core';\r\nimport { Component, ElementRef } from '@angular/core';\r\nimport { DnnAppComponent, Context } from '@2sic.com/dnn-sxc-angular';\r\nimport { Config } from './config';\r\nimport { SupportedLanguages, langCode2, PrimaryUiLanguage } from './i18n';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BackendSettings } from './core/backend-settings';\r\n\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.css']\r\n})\r\nexport class AppComponent extends DnnAppComponent {\r\n  constructor(\r\n    public translate: TranslateService,\r\n    el: ElementRef,\r\n    context: Context,\r\n    backendSettings: BackendSettings,\r\n  ) {\r\n    super(el, context.preConfigure({ sxc: Config.getSxcInstance() }), false);\r\n    translate.addLangs(SupportedLanguages);\r\n\r\n    backendSettings.setApp(Config.appId());\r\n\r\n    backendSettings.data\r\n      .subscribe(ctxDto => {\r\n        const lang = ctxDto.Language;\r\n        translate.setDefaultLang(PrimaryUiLanguage);\r\n        translate.use(langCode2(lang.Current));\r\n      });\r\n  }\r\n}\r\n","\r\nexport * from './constants';\r\n\r\n\r\nexport function langCode2(langCode5: string) {\r\n  return langCode5.split('-')[0];\r\n}\r\n","<app-template-picker></app-template-picker>\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { GettingStartedService } from 'app/installer/getting-started.service';\r\nimport { PickerService } from 'app/template-picker/picker.service';\r\nimport { CurrentDataService } from 'app/template-picker/current-data.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    HttpClientModule\r\n  ],\r\n  declarations: [],\r\n  providers: [\r\n    GettingStartedService,\r\n    PickerService,\r\n    CurrentDataService,\r\n  ]\r\n})\r\nexport class CoreModule { }\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { InstallerComponent } from './installer.component';\r\nimport { InstallerService } from 'app/installer/installer.service';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatProgressSpinnerModule,\r\n  ],\r\n  exports: [\r\n    InstallerComponent\r\n  ],\r\n  declarations: [\r\n    InstallerComponent\r\n  ],\r\n  providers: [\r\n    InstallerService\r\n  ]\r\n})\r\nexport class InstallerModule { }","import { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\nimport { MatProgressBarModule } from '@angular/material/progress-bar';\r\nimport { MatExpansionModule } from '@angular/material/expansion';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatToolbarModule } from '@angular/material/toolbar';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\n\r\nconst MATERIAL_MODULES = [\r\n  MatButtonModule,\r\n  MatDialogModule,\r\n  MatExpansionModule,\r\n  MatIconModule,\r\n  MatProgressBarModule,\r\n  MatProgressSpinnerModule,\r\n  MatTabsModule,\r\n  MatToolbarModule,\r\n];\r\n\r\n@NgModule({\r\n  imports: MATERIAL_MODULES,\r\n  exports: MATERIAL_MODULES,\r\n})\r\n\r\nexport class MaterialModule { }\r\n","import { TranslateModule } from '@ngx-translate/core';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatProgressBarModule } from '@angular/material/progress-bar';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { CommonModule } from '@angular/common';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { TemplatePickerComponent } from './template-picker.component';\r\nimport { TemplateFilterPipe } from './template-filter.pipe';\r\nimport { CoreModule } from 'app/core/core.module';\r\nimport { FlexLayoutModule } from '@angular/flex-layout';\r\nimport { InstallerModule } from 'app/installer/installer.module';\r\nimport { DebugPipe } from './debug.pipe';\r\nimport { ContentTypesProcessor } from './data/content-types-processor.service';\r\nimport { MaterialModule } from 'app/material-module';\r\n\r\n@NgModule({\r\n  exports: [\r\n    TemplatePickerComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    BrowserAnimationsModule,\r\n    MatMenuModule,\r\n    MatTabsModule,\r\n    MaterialModule,\r\n    MatProgressBarModule,\r\n    CoreModule,\r\n    FormsModule,\r\n    FlexLayoutModule,\r\n    InstallerModule,\r\n    TranslateModule\r\n  ],\r\n  providers: [\r\n    TemplateFilterPipe,\r\n    ContentTypesProcessor\r\n  ],\r\n  declarations: [\r\n    TemplatePickerComponent,\r\n    TemplateFilterPipe,\r\n    DebugPipe,\r\n  ]\r\n})\r\nexport class TemplatePickerModule { }\r\n","import { TranslateHttpLoader } from '@ngx-translate/http-loader';\r\nimport { TranslateLoader, TranslateModule } from '@ngx-translate/core';\r\nimport { BrowserModule } from '@angular/platform-browser';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { DnnInterceptor } from '@2sic.com/dnn-sxc-angular';\r\nimport { AppComponent } from './app.component';\r\nimport { TemplatePickerModule } from 'app/template-picker/template-picker.module';\r\nimport { HttpClient, HttpClientModule } from '@angular/common/http';\r\nimport { MaterialModule } from './material-module';\r\nimport { log } from './core/log';\r\nimport { pathToI18n, i18nExtension } from './i18n';\r\n\r\nexport function HttpLoaderFactory(http: HttpClient) {\r\n  const loader = new TranslateHttpLoader(http, pathToI18n, i18nExtension);\r\n  log.add('created translate-loader', loader);\r\n  return loader;\r\n}\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppComponent\r\n  ],\r\n  exports: [ ],\r\n  imports: [\r\n    BrowserModule,\r\n    HttpClientModule,\r\n    FormsModule,\r\n    TemplatePickerModule,\r\n    TranslateModule.forRoot({\r\n      loader: {\r\n        provide: TranslateLoader,\r\n        useFactory: HttpLoaderFactory,\r\n        deps: [HttpClient]\r\n      }\r\n    }),\r\n    MaterialModule, // must be after BrowserModule\r\n  ],\r\n  providers: [DnnInterceptor],\r\n  bootstrap: [AppComponent]\r\n})\r\nexport class AppModule { }\r\n","\r\nimport { startWith } from 'rxjs/operators';\r\nimport { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\nimport { BootController } from './app/core/boot-control';\r\nimport { log } from 'app/core/log';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nlog.add('loading main.ts');\r\n\r\ndeclare const window;\r\nconst platform = platformBrowserDynamic();\r\n\r\nfunction init() {\r\n  log.add('init()');\r\n\r\n  try {\r\n    // kill listeners\r\n    if (!platform.destroyed)\r\n      platform.destroy();\r\n  } catch (e) {\r\n    console.log('platform destroy error', e);\r\n  }\r\n\r\n  // must re-create the object here, otherwise AOT compiler optimizations\r\n  // break these lines of code\r\n  platformBrowserDynamic().bootstrapModule(AppModule)\r\n    .then(() => window.appBootstrap && window.appBootstrap())\r\n    .catch(err => console.error('NG Bootstrap Error =>', err));\r\n}\r\n\r\n\r\n// provide hook for outside reboot calls\r\nconst bootController = window.bootController = BootController.getRebootController();\r\n\r\n// Init on reboot request.\r\nbootController.rebootRequest$.pipe(\r\n  startWith(true)) // Init on first load.\r\n  .subscribe(() => init());\r\n"],"sourceRoot":"webpack:///"}