"use strict";(self.webpackChunkng_dialogs=self.webpackChunkng_dialogs||[]).push([["default-projects_ng-dialogs_src_app_create-file-dialog_index_ts"],{1183:function(H,Q,a){a.d(Q,{t:function(){return L}});var E=a(8069),N=a(8047),s=a(635),e=a(8598),_=a(7133),M=a(8784),S=a(2425),D="admin/AppFiles/asset",L=function(){var b=function(){function w(x,r,d){(0,E.Z)(this,w),this.http=x,this.context=r,this.dnnContext=d}return(0,N.Z)(w,[{key:"get",value:function(r,d,v){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(D),{params:Object.assign({appId:this.context.appId,global:d},this.templateIdOrPath(r,d,v))}).pipe((0,s.U)(function(C){if("auto"===C.Type.toLocaleLowerCase())switch(C.Extension.toLocaleLowerCase()){case".cs":case".cshtml":C.Type="Razor";break;case".html":case".css":case".js":C.Type="Token"}return C}))}},{key:"save",value:function(r,d,v,C){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(D),v,{params:Object.assign({appId:this.context.appId,global:d},this.templateIdOrPath(r,d,C))})}},{key:"getAll",value:function(r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:Object.assign({appId:this.context.appId},r&&{mask:r})}).pipe((0,s.U)(function(d){var v=d.Files;return v.forEach(function(C){var O;null!==(O=C.Shared)&&void 0!==O||(C.Shared=!1)}),v}))}},{key:"getWebApis",value:function(){return this.getAll("*Controller.cs").pipe((0,s.U)(function(r){return r.map(function(v){var C=v.Path.lastIndexOf("/"),O=v.Path.lastIndexOf("."),P=v.Path.substring(0,C),T=v.Path.substring(C+1,O);return{path:v.Path,folder:P,name:T,isShared:v.Shared}})}))}},{key:"getWebApiDetails",value:function(r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:r}})}},{key:"getPredefinedTemplates",value:function(r,d){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:Object.assign(Object.assign({},r&&{purpose:r}),d&&{type:d})})}},{key:"getPreview",value:function(r,d,v){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:r,templateKey:v,global:d}})}},{key:"create",value:function(r,d,v){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:d,purpose:"auto",path:r,templateKey:v}})}},{key:"templateIdOrPath",value:function(r,d,v){var C;if(/^[0-9]*$/g.test(r)){var O=null===(C=v.find(function(P){var T;return(null===(T=P.EntityId)||void 0===T?void 0:T.toString())===r&&P.IsShared===d}))||void 0===C?void 0:C.Path;return Object.assign({templateId:r},null!=O&&{path:O})}return{path:r}}}]),w}();return b.\u0275fac=function(x){return new(x||b)(_.LFG(M.eN),_.LFG(e._),_.LFG(S._y))},b.\u0275prov=_.Yz7({token:b,factory:b.\u0275fac}),b}()},5260:function(H,Q,a){a.d(Q,{UH:function(){return me},qH:function(){return he},i6:function(){return k}});var E=a(8069),N=a(8047),s=a(587),e=a(7133),_=a(5758),M=a(4770),S=a(1434),K=a(1130),D=a(6362),J=a(7317),$=a(3135);function V(o,i){1&o&&(e.TgZ(0,"app-field-hint",11),e._uU(1," This field is required "),e.qZA()),2&o&&e.Q6J("isError",!0)}var k=function(){var o=function(){function i(n){(0,E.Z)(this,i),this.dialogRef=n,this.hostClass="dialog-component"}return(0,N.Z)(i,[{key:"ngOnInit",value:function(){this.form=new s.cw({isShared:new s.NI(null,s.kI.required)})}},{key:"closeDialog",value:function(t){this.dialogRef.close(t)}},{key:"confirm",value:function(){var t=this.form.getRawValue();this.closeDialog(t.isShared)}}]),i}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(_.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-file-location-dialog"]],hostVars:1,hostBindings:function(n,t){2&n&&e.Ikx("className",t.hostClass)},decls:19,vars:5,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],["appearance","standard","color","accent"],["formControlName","isShared"],[3,"value"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],[3,"isError"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2,"New file location"),e.qZA(),e.qZA(),e.TgZ(3,"form",2),e.TgZ(4,"div",3),e.TgZ(5,"mat-form-field",4),e.TgZ(6,"mat-label"),e._uU(7,"Location"),e.qZA(),e.TgZ(8,"mat-select",5),e.TgZ(9,"mat-option",6),e._uU(10,"App"),e.qZA(),e.TgZ(11,"mat-option",6),e._uU(12,"Shared (global)"),e.qZA(),e.qZA(),e.qZA(),e.YNc(13,V,2,1,"app-field-hint",7),e.TgZ(14,"div",8),e.TgZ(15,"button",9),e.NdJ("click",function(){return t.closeDialog()}),e._uU(16,"Cancel"),e.qZA(),e.TgZ(17,"button",10),e.NdJ("click",function(){return t.confirm()}),e._uU(18," Confirm "),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(3),e.Q6J("formGroup",t.form),e.xp6(6),e.Q6J("value",!1),e.xp6(2),e.Q6J("value",!0),e.xp6(2),e.Q6J("ngIf",t.form.controls.isShared.touched&&(null==t.form.controls.isShared.errors?null:t.form.controls.isShared.errors.required)),e.xp6(4),e.Q6J("disabled",!t.form.valid))},directives:[s._Y,s.JL,s.sg,M.KE,M.hX,S.gD,s.JJ,s.u,K.ey,D.O5,J.lW,$.Y],styles:[""]}),o}(),L=a(7797),b=a(2090),w=a(7714),x=a(6317),r=a(6562),d=a(6936),v=a(745),C=a(1640),O=a(8947),P=a(4874),T=a(8977),U=a(635),j=a(9337),X=a(1944),Y=a(3945),ee=a(4987),R={leading:!0,trailing:!1};function te(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R,n=i.leading,t=i.trailing;return(0,X.e)(function(c,y){var A=!1,I=null,p=null,l=!1,u=function(){null==p||p.unsubscribe(),p=null,t&&(m(),l&&y.complete())},f=function(){p=null,l&&y.complete()},h=function(g){return p=(0,ee.Xf)(o(g)).subscribe(new Y.Q(y,u,f))},m=function(){if(A){A=!1;var g=I;I=null,y.next(g),!l&&h(g)}};c.subscribe(new Y.Q(y,function(Z){A=!0,I=Z,(!p||p.closed)&&(n?m():h(Z))},function(){l=!0,(!(t&&A&&p)||p.closed)&&y.complete()}))})}var oe=a(2673),ae=a(5656),W=a(1183),q=a(4683),ie=function(){var o=function(){function i(n,t){(0,E.Z)(this,i),this.matInput=n,this.elementRef=t,this.autofocusSelectValue=!1}return(0,N.Z)(i,[{key:"ngOnInit",value:function(){var t=this;setTimeout(function(){t.matInput.focus(),t.toBoolean(t.autofocusSelectValue)&&t.elementRef.nativeElement.setSelectionRange(0,t.matInput.value.length)})}},{key:"toBoolean",value:function(t){if("boolean"==typeof t)return t;if("string"==typeof t){var c=t.toLocaleLowerCase();return"true"===c||"false"!==c&&void 0}return null==t?t:void 0}}]),i}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(q.Nt),e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}}),o}(),z=a(4742);function le(o,i){if(1&o&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&o){var n=i.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n," ")}}function re(o,i){if(1&o&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&o){var n=i.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n," ")}}function se(o,i){if(1&o&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&o){var n=i.$implicit;e.Q6J("value",n.Key),e.xp6(1),e.hij(" ",n.Name," ")}}function ce(o,i){1&o&&(e.TgZ(0,"app-field-hint",21),e._uU(1," This field is required "),e.qZA()),2&o&&e.Q6J("isError",!0)}function ue(o,i){1&o&&(e.ynx(0),e._UZ(1,"mat-spinner",22),e._UZ(2,"div",23),e.BQk())}var G=function(i){return{disabled:i}};function pe(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"div",24),e.TgZ(2,"label",25),e._uU(3,"Preview"),e.qZA(),e.qZA(),e.TgZ(4,"pre",26),e._uU(5),e.qZA(),e.BQk()),2&o){var n=e.oxw().ngIf;e.xp6(2),e.Q6J("ngClass",e.VKq(3,G,n.loadingPreview)),e.xp6(2),e.Q6J("ngClass",e.VKq(5,G,n.loadingPreview)),e.xp6(1),e.Oqu(n.preview)}}function fe(o,i){if(1&o&&(e.TgZ(0,"div",27),e._uU(1),e.qZA()),2&o){var n=e.oxw().ngIf;e.xp6(1),e.hij(" ",n.previewError," ")}}function de(o,i){if(1&o){var n=e.EpF();e.ynx(0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"span"),e._uU(4,"Create"),e.qZA(),e.TgZ(5,"span",3),e._uU(6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"form",4),e.TgZ(8,"div",5),e.TgZ(9,"div",6),e.TgZ(10,"div",7),e.TgZ(11,"mat-form-field",8),e.TgZ(12,"mat-label"),e._uU(13,"Platform"),e.qZA(),e.TgZ(14,"mat-select",9),e.YNc(15,le,2,2,"mat-option",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(16,"div",7),e.TgZ(17,"mat-form-field",8),e.TgZ(18,"mat-label"),e._uU(19,"Purpose"),e.qZA(),e.TgZ(20,"mat-select",11),e.YNc(21,re,2,2,"mat-option",10),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",12),e.TgZ(23,"mat-form-field",8),e.TgZ(24,"mat-label"),e._uU(25,"Template"),e.qZA(),e.TgZ(26,"mat-select",13),e.YNc(27,se,2,2,"mat-option",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(28,"div",12),e.TgZ(29,"mat-form-field",8),e.TgZ(30,"mat-label"),e._uU(31,"Name"),e.qZA(),e._UZ(32,"input",14),e.qZA(),e.YNc(33,ce,2,1,"app-field-hint",15),e.qZA(),e.qZA(),e.TgZ(34,"div",16),e.YNc(35,ue,3,0,"ng-container",0),e.TgZ(36,"button",17),e.NdJ("click",function(){return e.CHM(n),e.oxw().closeDialog()}),e._uU(37,"Cancel"),e.qZA(),e.TgZ(38,"button",18),e.NdJ("click",function(){return e.CHM(n),e.oxw().confirm()}),e._uU(39," Create "),e.qZA(),e.qZA(),e.YNc(40,pe,6,7,"ng-container",0),e.YNc(41,fe,2,1,"div",19),e.qZA(),e.BQk()}if(2&o){var t=i.ngIf,c=e.oxw();e.xp6(6),e.Oqu(c.controls.finalName.value||(c.controls.folder.value?c.controls.folder.value.trim()+"/":"")),e.xp6(1),e.Q6J("formGroup",c.form),e.xp6(8),e.Q6J("ngForOf",t.platforms),e.xp6(6),e.Q6J("ngForOf",t.purposes),e.xp6(6),e.Q6J("ngForOf",t.templates),e.xp6(6),e.Q6J("ngIf",c.controls.name.touched&&(null==c.controls.name.errors?null:c.controls.name.errors.required)),e.xp6(2),e.Q6J("ngIf",t.loadingPreview),e.xp6(3),e.Q6J("disabled",!c.form.valid||t.loadingPreview||!t.previewValid),e.xp6(2),e.Q6J("ngIf",t.preview),e.xp6(1),e.Q6J("ngIf",!t.loadingPreview&&t.previewError)}}var me=function(){var o=function(){function i(n,t,c){(0,E.Z)(this,i),this.dialogData=n,this.dialogRef=t,this.sourceService=c,this.hostClass="dialog-component",this.all="All"}return(0,N.Z)(i,[{key:"ngOnInit",value:function(){this.subscription=new w.w0,this.templates$=new x.X([]),this.loadingPreview$=new x.X(!1),this.buildForm(),this.fetchTemplates(),this.buildTemplateVars()}},{key:"ngOnDestroy",value:function(){this.templates$.complete(),this.loadingPreview$.complete(),this.subscription.unsubscribe()}},{key:"closeDialog",value:function(t){this.dialogRef.close(t)}},{key:"confirm",value:function(){var t=this.form.getRawValue();this.closeDialog({name:t.finalName,templateKey:t.templateKey})}},{key:"fetchTemplates",value:function(){var t=this;this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(function(c){t.controls.templateKey.value!==c.Default&&t.controls.templateKey.patchValue(c.Default),t.templates$.next(c.Templates)})}},{key:"buildForm",value:function(){var c,y,t=this;this.form=new s.cw({platform:new s.NI(this.all),purpose:new s.NI({value:null!==(c=this.dialogData.purpose)&&void 0!==c?c:this.all,disabled:null!=this.dialogData.purpose}),templateKey:new s.NI(null,s.kI.required),name:new s.NI(null,s.kI.required),finalName:new s.NI({value:null,disabled:!0}),folder:new s.NI({value:null!==(y=this.dialogData.folder)&&void 0!==y?y:"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,r.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,P.O)(this.controls.templateKey.value),(0,T.x)())]).subscribe(function(A){var u,I=(0,b.Z)(A,2),l=I[1],f=I[0].find(function(m){return m.Key===l}),h=null!==(u=null==f?void 0:f.SuggestedFileName)&&void 0!==u?u:null;t.controls.name.value!==h&&t.controls.name.patchValue(h)})),this.subscription.add((0,r.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,P.O)(this.controls.templateKey.value),(0,T.x)()),this.controls.name.valueChanges.pipe((0,P.O)(this.controls.name.value),(0,T.x)()),this.controls.folder.valueChanges.pipe((0,P.O)(this.controls.folder.value),(0,T.x)())]).subscribe(function(A){var h,m,Z,I=(0,b.Z)(A,4),l=I[1],u=I[2],f=I[3],g=I[0].find(function(B){return B.Key===l}),F=null;u&&(f=f.trim(),u=ae.vl.sanitizePath(u.trim()),u="".concat(null!==(h=null==g?void 0:g.Prefix)&&void 0!==h?h:"").concat(u).concat(null!==(m=null==g?void 0:g.Suffix)&&void 0!==m?m:"").concat(null!==(Z=null==g?void 0:g.Extension)&&void 0!==Z?Z:""),F="".concat(f?"".concat(f,"/"):"").concat(u).replace(/\/{2,}/g,"/")),t.controls.finalName.value!==F&&t.controls.finalName.patchValue(F)}))}},{key:"buildTemplateVars",value:function(){var t=this,c=this.templates$.pipe((0,U.U)(function(p){var l=(0,L.Z)({},t.all,t.all);return p.forEach(function(u){var f;null===(f=u.Platforms)||void 0===f||f.forEach(function(h){l[h]=h})}),Object.keys(l)})),y=this.templates$.pipe((0,U.U)(function(p){var l=(0,L.Z)({},t.all,t.all);return p.forEach(function(u){l[u.Purpose]=u.Purpose}),Object.keys(l)})),A=(0,r.a)([this.templates$,this.controls.platform.valueChanges.pipe((0,P.O)(this.controls.platform.value),(0,T.x)()),this.controls.purpose.valueChanges.pipe((0,P.O)(this.controls.purpose.value),(0,T.x)())]).pipe((0,U.U)(function(p){var l=(0,b.Z)(p,3),f=l[1],h=l[2];return l[0].filter(function(Z){var g,F;return(f===t.all||null!==(F=null===(g=Z.Platforms)||void 0===g?void 0:g.includes(f))&&void 0!==F&&F)&&(h===t.all||Z.Purpose===h)})}),(0,j.b)(function(p){var l,u;if(!p.some(function(h){return h.Key===t.controls.templateKey.value})){var f=null!==(u=null===(l=p[0])||void 0===l?void 0:l.Key)&&void 0!==u?u:null;t.controls.templateKey.value!==f&&t.controls.templateKey.patchValue(f)}})),I=(0,r.a)([this.controls.finalName.valueChanges.pipe((0,P.O)(this.controls.finalName.value),(0,T.x)()),this.controls.templateKey.valueChanges.pipe((0,P.O)(this.controls.templateKey.value),(0,T.x)())]).pipe(function ne(o){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R,t=(0,O.H)(o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.z);return te(function(){return t},n)}(100,d.z,{leading:!0,trailing:!0}),(0,j.b)(function(){t.loadingPreview$.next(!0)}),(0,oe.w)(function(p){var l=(0,b.Z)(p,2),u=l[0],f=l[1];return u&&f?(0,C.D)([t.sourceService.getPreview(u,t.dialogData.global,f),(0,O.H)(500)]).pipe((0,U.U)(function(h){return(0,b.Z)(h,1)[0]})):(0,v.of)(void 0)}),(0,j.b)(function(){t.loadingPreview$.next(!1)}));this.templateVars$=(0,r.a)([c,y,A,I,this.loadingPreview$]).pipe((0,U.U)(function(p){var g,l=(0,b.Z)(p,5),m=l[3];return{platforms:l[0],purposes:l[1],templates:l[2],loadingPreview:l[4],preview:null==m?void 0:m.Preview,previewValid:null!==(g=null==m?void 0:m.IsValid)&&void 0!==g&&g,previewError:null==m?void 0:m.Error}}))}}]),i}();return o.\u0275fac=function(n){return new(n||o)(e.Y36(_.WI),e.Y36(_.so),e.Y36(W.t))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(n,t){2&n&&e.Ikx("className",t.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box","hide-scrollbar"],[1,"file-name"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],[1,"field-container","multiple"],[1,"multiple-field"],["appearance","standard","color","accent"],["formControlName","platform"],[3,"value",4,"ngFor","ngForOf"],["formControlName","purpose"],[1,"field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","preview-error",4,"ngIf"],[3,"value"],[3,"isError"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"preview-label-box"],[1,"preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"preview-error"]],template:function(n,t){1&n&&(e.YNc(0,de,42,10,"ng-container",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,t.templateVars$))},directives:[D.O5,s._Y,s.JL,s.sg,M.KE,M.hX,S.gD,s.JJ,s.u,D.sg,q.Nt,s.Fj,s.Q7,ie,J.lW,K.ey,$.Y,z.$g,D.mk],pipes:[D.Ov],styles:[".dialog-title-box[_ngcontent-%COMP%]{justify-content:flex-start;align-items:baseline;line-height:normal;white-space:nowrap;overflow-x:auto}.dialog-title-box[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.field-container.multiple[_ngcontent-%COMP%]{display:flex}.field-container.multiple[_ngcontent-%COMP%]   .multiple-field[_ngcontent-%COMP%]{flex:1}.field-container.multiple[_ngcontent-%COMP%]   .multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.preview-label-box[_ngcontent-%COMP%]{position:relative}.preview-label-box[_ngcontent-%COMP%]   .preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0px;font-size:12px;color:#0009;pointer-events:none}.preview-label-box[_ngcontent-%COMP%]   .preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]}),o}(),ge=a(8598),ve=a(8450),he=function(){var o=(0,N.Z)(function i(){(0,E.Z)(this,i)});return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[ge._,W.t],imports:[[D.ez,ve.q,J.ot,S.LD,s.UX,M.lN,q.c,z.Cq]]}),o}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.02.00/ng-edit/default-projects_ng-dialogs_src_app_create-file-dialog_index_ts.17e6df3a45b96f65.js.map