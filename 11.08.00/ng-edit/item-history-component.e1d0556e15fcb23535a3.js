(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{yyn8:function(t,e,n){"use strict";n.r(e),n.d(e,"ItemHistoryComponent",(function(){return k}));var i=n("D57K"),a=n("C05f"),o=n("HM3f"),r=n("YtkY"),s=n("EM62"),c=n("OZ4H"),l=n("sEIs"),b=n("ml94"),u=n("W1gw"),d=n("2kYt"),p=n("PBFl"),g=n("Y2X+"),f=n("bFHC"),h=n("iAde"),m=n("3Uyd");function v(t,e){1&t&&(s.Sb(0,"div"),s.Oc(1,"Loading..."),s.Rb())}function y(t,e){1&t&&(s.Sb(0,"div"),s.Oc(1,"No previous versions of this item found"),s.Rb())}function O(t,e){if(1&t&&(s.Qb(0),s.Oc(1),s.Pb()),2&t){var n=s.ec().$implicit;s.Ab(1),s.Qc(" ",null==n.attributeValues[0]?null:n.attributeValues[0].value," ")}}function S(t,e){if(1&t&&(s.Sb(0,"i"),s.Oc(1),s.Rb()),2&t){var n=e.$implicit;s.Ab(1),s.Qc("[",n.langKey,"]")}}function _(t,e){if(1&t&&(s.Sb(0,"div",23),s.Sb(1,"div",24),s.Oc(2),s.Rb(),s.Sb(3,"div",25),s.Oc(4),s.Rb(),s.Rb()),2&t){var n=e.$implicit;s.Eb("history-changed",n.hasChanged),s.Ab(2),s.Qc("",n.langKey,":"),s.Ab(2),s.Pc(n.value)}}function x(t,e){if(1&t&&(s.Sb(0,"div",21),s.Mc(1,_,5,4,"div",22),s.Rb()),2&t){var n=s.ec().$implicit;s.Ab(1),s.kc("ngForOf",n.attributeValues)}}function w(t,e){if(1&t){var n=s.Tb();s.Sb(0,"div",14),s.Sb(1,"div",15),s.ac("click",(function(){s.Ac(n);var t=e.$implicit,i=s.ec(2).$implicit;return s.ec(3).attributeExpandedToggle(i.versionNumber,t.attributeName)})),s.Sb(2,"div",16),s.Oc(3),s.Rb(),s.Sb(4,"div",17),s.Mc(5,O,2,1,"ng-container",0),s.Rb(),s.Sb(6,"div",18),s.Mc(7,S,2,1,"i",19),s.Sb(8,"i"),s.Oc(9),s.Rb(),s.Rb(),s.Rb(),s.Mc(10,x,2,1,"div",20),s.Rb()}if(2&t){var i=e.$implicit,a=s.ec(2).$implicit,o=s.ec(3);s.Ab(2),s.Eb("history-changed",i.hasChanged),s.Ab(1),s.Qc(" ",i.attributeName," "),s.Ab(1),s.Eb("history-changed",i.hasChanged),s.Ab(1),s.kc("ngIf",!o.expandedAttributes[a.versionNumber+i.attributeName]),s.Ab(2),s.kc("ngForOf",i.attributeValues),s.Ab(2),s.Qc("[",i.dataType,"]"),s.Ab(1),s.kc("ngIf",o.expandedAttributes[a.versionNumber+i.attributeName])}}function I(t,e){if(1&t){var n=s.Tb();s.Sb(0,"button",26),s.ac("click",(function(){s.Ac(n);var t=s.ec(2).$implicit;return s.ec(3).restore(t.changeSetId)})),s.Oc(1," Restore "),s.Rb()}}function A(t,e){if(1&t&&(s.Qb(0),s.Mc(1,w,11,9,"div",11),s.Sb(2,"div",12),s.Mc(3,I,2,0,"button",13),s.Rb(),s.Pb()),2&t){var n=s.ec().$implicit;s.Ab(1),s.kc("ngForOf",n.attributes),s.Ab(2),s.kc("ngIf",!n.isLastVersion)}}function M(t,e){if(1&t){var n=s.Tb();s.Sb(0,"mat-expansion-panel",10),s.ac("expandedChange",(function(t){s.Ac(n);var i=e.$implicit;return s.ec(3).panelExpandedChange(t,i.versionNumber)})),s.Sb(1,"mat-expansion-panel-header"),s.Sb(2,"mat-panel-title"),s.Oc(3),s.Rb(),s.Sb(4,"mat-panel-description"),s.Oc(5),s.fc(6,"date"),s.Rb(),s.Rb(),s.Mc(7,A,4,2,"ng-container",0),s.Rb()}if(2&t){var i=e.$implicit,a=s.ec(3);s.Ab(3),s.Qc("Version ",i.versionNumber,""),s.Ab(2),s.Pc(s.hc(6,3,i.timeStamp,"yyyy-MM-dd hh:mm")),s.Ab(2),s.kc("ngIf",a.expandedPanels[i.versionNumber])}}function C(t,e){if(1&t&&(s.Sb(0,"mat-accordion",8),s.Mc(1,M,8,6,"mat-expansion-panel",9),s.Rb()),2&t){var n=s.ec().ngIf;s.Ab(1),s.kc("ngForOf",n.historyItems)}}function R(t,e){if(1&t){var n=s.Tb();s.Qb(0),s.Sb(1,"div",1),s.Sb(2,"div",2),s.Sb(3,"div"),s.Oc(4,"Item History"),s.Rb(),s.Sb(5,"button",3),s.ac("click",(function(){return s.Ac(n),s.ec().closeDialog()})),s.Sb(6,"mat-icon"),s.Oc(7,"close"),s.Rb(),s.Rb(),s.Rb(),s.Rb(),s.Sb(8,"p",4),s.Oc(9,"Check version history for this item and restore the version you need."),s.Rb(),s.Sb(10,"div",5),s.Mc(11,v,2,0,"div",0),s.Mc(12,y,2,0,"div",0),s.Mc(13,C,2,1,"mat-accordion",6),s.Rb(),s.Sb(14,"mat-paginator",7),s.ac("page",(function(t){return s.Ac(n),s.ec().pageChange(t)})),s.Rb(),s.Pb()}if(2&t){var i=e.ngIf,a=s.ec();s.Ab(11),s.kc("ngIf",null===i.historyItems),s.Ab(1),s.kc("ngIf",0===(null==i.historyItems?null:i.historyItems.length)),s.Ab(1),s.kc("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),s.Ab(1),s.kc("length",i.length)("pageSize",a.pageSize)}}var k=function(){function t(t,e,n,s){var c=this;this.dialogRef=t,this.route=e,this.versionsService=n,this.snackBar=s,this.hostClass="dialog-component",this.pageSize=10,this.expandedPanels={},this.expandedAttributes={},this.itemId=parseInt(this.route.snapshot.paramMap.get("itemId"),10),this.versions$=new a.a(null),this.page$=new a.a(1),this.historyItems$=Object(o.a)([this.versions$,this.page$]).pipe(Object(r.a)((function(t){var e,n,a,o=Object(i.f)(t,2);return n=o[1],a=c.pageSize,null==(e=o[0])||null==n||null==a?null:(null==e?void 0:e.slice((n-1)*a,n*a)).map((function(t){var n=e.find((function(e){return e.VersionNumber===t.VersionNumber-1})),a=n?JSON.parse(n.Json):null,o=!e.some((function(e){return e.VersionNumber===t.VersionNumber+1})),r=JSON.parse(t.Json),s=[];return Object.entries(r.Entity.Attributes).forEach((function(t){var e=Object(i.f)(t,2),n=e[0],o=Object.entries(e[1]).map((function(t){var e,o=Object(i.f)(t,2),r=o[0],s=o[1],c=Object.entries(s).map((function(t){var e,o,s=Object(i.f)(t,2),c=s[0],l=s[1];return{langKey:c,value:l,hasChanged:JSON.stringify(l)!==JSON.stringify(null===(o=null===(e=null==a?void 0:a.Entity.Attributes[n])||void 0===e?void 0:e[r])||void 0===o?void 0:o[c])}}));return{attributeName:r,dataType:n,hasChanged:JSON.stringify(s)!==JSON.stringify(null===(e=null==a?void 0:a.Entity.Attributes[n])||void 0===e?void 0:e[r]),attributeValues:c}}));s.push.apply(s,Object(i.g)(o))})),{changeSetId:t.ChangeSetId,attributes:s,historyId:t.HistoryId,timeStamp:t.TimeStamp,user:t.User,versionNumber:t.VersionNumber,isLastVersion:o}}))}))),this.templateVars$=Object(o.a)([this.versions$,this.historyItems$]).pipe(Object(r.a)((function(t){var e=Object(i.f)(t,2),n=e[0];return{length:null==n?void 0:n.length,historyItems:e[1]}})))}return t.prototype.ngOnInit=function(){this.versionsService.fetchVersions(this.itemId).subscribe(this.versions$)},t.prototype.ngOnDestroy=function(){this.versions$.complete(),this.page$.complete()},t.prototype.closeDialog=function(){this.dialogRef.close()},t.prototype.panelExpandedChange=function(t,e){this.expandedPanels[e]=t},t.prototype.attributeExpandedToggle=function(t,e){this.expandedAttributes[t+e]=!this.expandedAttributes[t+e]},t.prototype.pageChange=function(t){this.expandedPanels={},this.expandedAttributes={},this.page$.next(t.pageIndex+1)},t.prototype.restore=function(t){var e=this;this.snackBar.open("Restoring previous version..."),this.versionsService.restore(this.itemId,t).subscribe((function(t){e.snackBar.open("Previous version restored. Will reload edit dialog",null,{duration:3e3}),e.dialogRef.close({refreshEdit:!0})}))},t.\u0275fac=function(e){return new(e||t)(s.Mb(c.g),s.Mb(l.a),s.Mb(b.a),s.Mb(u.b))},t.\u0275cmp=s.Gb({type:t,selectors:[["app-item-history"]],hostVars:1,hostBindings:function(t,e){2&t&&s.Vb("className",e.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","matTooltip","Close dialog",3,"click"],[1,"dialog-description"],[1,"dialog-component-content","fancy-scrollbar-light"],["multi","","class","history-tables",4,"ngIf"],["showFirstLastButtons","true",3,"length","pageSize","page"],["multi","",1,"history-tables"],[3,"expandedChange",4,"ngFor","ngForOf"],[3,"expandedChange"],["class","table-row",4,"ngFor","ngForOf"],[1,"row-actions"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"table-row"],[1,"table-row__main","row-main",3,"click"],[1,"row-main__label"],[1,"row-main__value"],[1,"row-main__type"],[4,"ngFor","ngForOf"],["class","table-row__details",4,"ngIf"],[1,"table-row__details"],["class","detail-row",3,"history-changed",4,"ngFor","ngForOf"],[1,"detail-row"],[1,"detail-row__label"],[1,"detail-row__value"],["mat-raised-button","","color","accent",3,"click"]],template:function(t,e){1&t&&(s.Mc(0,R,15,5,"ng-container",0),s.fc(1,"async")),2&t&&s.kc("ngIf",s.gc(1,1,e.templateVars$))},directives:[d.t,c.h,p.b,g.a,f.a,h.a,m.a,d.s,m.c,m.e,m.f,m.d],pipes:[d.b,d.f],styles:[".mat-accordion[_ngcontent-%COMP%]{display:block;padding:4px 0}.mat-expansion-panel-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{font-size:14px}.table-row__main[_ngcontent-%COMP%]{display:flex}.table-row__details[_ngcontent-%COMP%]{display:block}.row-main[_ngcontent-%COMP%]{cursor:pointer;padding:4px 0}.row-main__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.row-main__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-main__type[_ngcontent-%COMP%]{flex:0 0 auto;font-size:12px}.row-main__type[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:not(:last-of-type){margin-right:2px}.detail-row[_ngcontent-%COMP%]{display:flex;padding-bottom:4px;cursor:default}.detail-row__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.detail-row__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"],changeDetection:0}),t}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/11.07.03/ng-edit/item-history-component.e1d0556e15fcb23535a3.js.map