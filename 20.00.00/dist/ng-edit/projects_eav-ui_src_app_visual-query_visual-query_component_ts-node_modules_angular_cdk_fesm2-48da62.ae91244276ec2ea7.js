"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_visual-query_visual-query_component_ts-node_modules_angular_cdk_fesm2-48da62"],{320:(O,f,r)=>{r.d(f,{t:()=>C});var m=r(89204),d=r(46443),u=r(71772),g=r(24467),l=r(99293),h=r(44444);let C=(()=>{class S extends g.B{getAppInfo(){return(0,d.fx)(()=>({url:this.apiUrl("admin/app/Statistics"),params:{appid:this.appId,zoneId:this.zoneId}}))}exportAppUrl(){return`${this.apiUrl(`${u.u}Export`)}?appId=${this.appId}&zoneId=${this.zoneId}`}exportForVersionControl(P){var E=this;return(0,m.A)(function*({includeContentGroups:j,resetAppGuid:y,withFiles:I}){return E.getStatusPromise("admin/app/SaveData",{params:{appid:E.appId,zoneId:E.zoneId,includeContentGroups:j.toString(),resetAppGuid:y.toString(),withPortalFiles:I.toString()}})}).apply(this,arguments)}static#t=this.\u0275fac=(()=>{let P;return function(j){return(P||(P=l.xGo(S)))(j||S)}})();static#e=this.\u0275prov=h.jDH({token:S,factory:S.\u0275fac})}return S})()},2570:(O,f,r)=>{r.d(f,{y:()=>P});var m=r(89204),d=r(46443),u=r(24467),g=r(99293),l=r(44444);const h="admin/view/all";let P=(()=>{class E extends u.B{getAllOnce(){return(0,d.fx)(()=>({url:this.apiUrl(h),params:{appId:this.appId}}))}getAllLive(y){return(0,d.fx)(()=>(y(),{url:this.apiUrl(h),params:{appId:this.appId}}))}delete(y){var I=this;return(0,m.A)(function*(){return I.getStatusPromise("admin/view/delete",{params:{appId:I.appId,Id:y.toString()}})})()}import(y){const I=new FormData;return I.append("File",y),this.http.post(this.apiUrl("admin/view/import"),I,{params:{appId:this.appId,zoneId:this.zoneId}})}export(y){const I=this.apiUrl("admin/view/json")+"?appId="+this.appId+"&viewId="+y;window.open(I,"_blank","")}getPolymorphismLive(y){return(0,d.fx)(()=>(y(),{url:this.apiUrl("admin/view/polymorphism"),params:{appId:this.appId}}))}getUsage(y){return this.newHttpResource(()=>({url:this.apiUrl("admin/view/usage"),params:{appId:this.appId,guid:y}}))}static#t=this.\u0275fac=(()=>{let y;return function(D){return(y||(y=g.xGo(E)))(D||E)}})();static#e=this.\u0275prov=l.jDH({token:E,factory:E.\u0275fac})}return E})()},4981:(O,f,r)=>{r.d(f,{f:()=>m});class m{static toggleInArray(u,g){const l=g.indexOf(u);return-1===l?g.push(u):g.splice(l,1),g}}},17693:(O,f,r)=>{r.d(f,{X:()=>h,g:()=>j});var m=r(46443),d=r(64173),u=r(96474),g=r(99293),l=r(44444);const h="admin/type/",_="admin/type/get",v="admin/type/list",C="admin/type/scopes";let j=(()=>{class y extends u.D{retrieveContentType(D){return this.getHttpApiUrl(_,{params:{appId:this.appId,contentTypeId:D}})}getType(D){return(0,m.fx)(()=>({url:this.apiUrl(_),params:{appId:this.appId,contentTypeId:D}}))}getTypes(D){return(0,m.fx)(()=>({url:this.apiUrl(v),params:{appId:this.appId,scope:D()}}),{defaultValue:[]})}retrieveContentTypesPromise(D){return this.fetchPromise(v,{params:{appId:this.appId,scope:D}})}getScopesPromise(){return this.fetchPromise(C,{params:{appId:this.appId}}).then(D=>{const L=D.old;return Object.keys(L).map(B=>({name:L[B],value:B}))})}getScopesSig(){const D=(0,m.fx)(()=>({url:this.apiUrl(C),params:{appid:this.appId}}));return(0,d.EW)(()=>{const B=(0,D.value)();if(!B||!B.old)return[];const U=B.old;return Object.keys(U).map(Y=>({name:U[Y],value:Y}))})}getScopesV2Promise(){return this.fetchPromise(C,{params:{appId:this.appId}}).then(D=>D.scopes)}save(D){return this.http.post(this.apiUrl("admin/type/save"),D,{params:{appid:this.appId}})}delete(D){return this.http.delete(this.apiUrl("admin/type/delete"),{params:{appid:this.appId,staticName:D.NameId}})}import(D){const L=new FormData;for(const $ of D)L.append("File",$);return this.http.post(this.apiUrl("admin/type/import"),L,{params:{appId:this.appId,zoneId:this.zoneId}})}createGhost(D){return this.http.post(this.apiUrl("admin/type/addghost"),null,{params:{appid:this.appId,sourceNameId:D}})}static#t=this.\u0275fac=(()=>{let D;return function($){return(D||(D=g.xGo(y)))($||y)}})();static#e=this.\u0275prov=l.jDH({token:y,factory:y.\u0275fac})}return y})()},23840:(O,f,r)=>{r.d(f,{z:()=>d});var m=r(99293);let d=(()=>{class u{onMousedown(l){l.stopPropagation()}static#t=this.\u0275fac=function(h){return new(h||u)};static#e=this.\u0275dir=m.FsC({type:u,selectors:[["","appMousedownStopPropagation",""]],hostBindings:function(h,_){1&h&&m.bIt("mousedown",function(C){return _.onMousedown(C)})}})}return u})()},28447:(O,f,r)=>{r.r(f),r.d(f,{VisualQueryComponent:()=>on});var m=r(87945),d=r(93840),u=r(29658),g=r(68873),l=r(44444),h=r(64173),_=r(8827),v=r(50052),C=r(34601),S=r(4981);function b(o,a){return o.find(e=>e.PartAssemblyAndType===a)}function P(o){return o.getOverlay("endpointLabel").label}const E={App:{Name:"App",Label:"App DataSources",Icon:"star",UiHint:"DataSources from the current App"},Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};var y=r(80436),I=r(19686),D=r(84205),L=r(18537),$=r(51567),B=r(17693),U=r(80401),Y=r(43216),M=r(70334),k=r(70271),A=r(75445),H=r(24467),t=r(99293);let pt=(()=>{class o extends H.B{fetchPipelinePromise(e,i){return this.fetchPromise(A.JL,{params:{appId:this.appId,id:e.toString()}}).then(n=>(n.DataSources.length||this.#t(n,i),this.#e(n.DataSources),n))}#t(e,i){const n=v.YX.pipelineDesigner.defaultPipeline.dataSources;for(const s of n){const c=b(i,s.PartAssemblyAndType);e.DataSources.push({Description:"",EntityGuid:s.EntityGuid,EntityId:void 0,Name:c.Name,PartAssemblyAndType:s.PartAssemblyAndType,VisualDesignerData:s.VisualDesignerData})}e.Pipeline.StreamWiring=v.YX.pipelineDesigner.defaultPipeline.streamWiring}#e(e){if(!e.some(n=>n.EntityGuid===v.YX.pipelineDesigner.outDataSource.EntityGuid)){const n=v.YX.pipelineDesigner.outDataSource;e.push({Description:n.Description,EntityGuid:n.EntityGuid,EntityId:void 0,Name:n.Name,PartAssemblyAndType:n.PartAssemblyAndType,VisualDesignerData:n.VisualDesignerData})}for(const n of e)n.VisualDesignerData??={Top:50,Left:50}}fetchDataSourcesPromise(){return this.fetchPromise(A.vN,{params:{appid:this.appId,zoneId:this.zoneId}}).then(e=>(e.push(v.YX.pipelineDesigner.outFinalTarget),e))}typeNameFilter(e,i){const n=e.split(", ");switch(i){case"classFullName":return n[0];case"className":const c=n[0].split(".");return c[c.length-1];default:return e}}savePipeline(e){const i=e.Pipeline;return this.http.post(A.Cu,{pipeline:i,dataSources:e.DataSources},{params:{appId:this.appId,Id:i.EntityId.toString()}}).pipe((0,k.T)(s=>(this.#e(s.DataSources),s)))}runPipelinePromise(e,i){return this.fetchPromise(A.Mk,{params:{appId:this.appId,id:e.toString(),top:i.toString()}})}debugStreamPromise(e,i,n,s){return this.fetchPromise(A.ei,{params:{appId:this.appId,id:e.toString(),from:i,out:n,top:s.toString()}})}static#n=this.\u0275fac=(()=>{let e;return function(n){return(e||(e=t.xGo(o)))(n||o)}})();static#i=this.\u0275prov=l.jDH({token:o,factory:o.\u0275fac})}return o})();var W=r(12938),Ct=r(32760),tt=r(4038),ut=r(60852),Et=r(4979),K=r(84175),V=r(81863),Z=r(38223),q=r(88622);function St(o,a){if(1&o&&t.EFF(0),2&o){const e=t.XpG();t.Lme(' for Stream: "',e.debugStream.name,'" on Source: "',e.debugStream.sourceName,'" ')}}function bt(o,a){1&o&&(t.j41(0,"div",13)(1,"span"),t.EFF(2,"Results"),t.k0s()())}function Pt(o,a){1&o&&t.EFF(0," Showing All results ")}function It(o,a){if(1&o&&t.EFF(0),2&o){const e=t.XpG();t.SpI(" Showing top ",e.top," results ")}}function Rt(o,a){1&o&&t.EFF(0," All ")}function xt(o,a){if(1&o&&t.EFF(0),2&o){const e=t.XpG().$implicit;t.SpI(" ",e," ")}}function Mt(o,a){if(1&o){const e=t.RV6();t.j41(0,"button",14),t.bIt("click",function(){const n=l.eBV(e).$implicit,s=t.XpG();return l.Njj(s.show(n))}),t.EFF(1," Show "),t.nVh(2,Rt,1,0),t.nVh(3,xt,1,1),t.k0s()}if(2&o){const e=a.$implicit;t.R7$(2),t.vxM(0===e?2:-1),t.R7$(),t.vxM(0!==e?3:-1)}}function Tt(o,a){1&o&&(t.j41(0,"div",16)(1,"span"),t.EFF(2,"Parameters"),t.k0s()())}function Ft(o,a){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.R7$(),t.JRh(e)}}function Ot(o,a){if(1&o&&(t.j41(0,"mat-tab"),t.DNE(1,Tt,3,0,"div",15),t.j41(2,"div",11)(3,"ul"),t.Z7z(4,Ft,2,1,"li",null,t.fX1),t.k0s()()()),2&o){const e=t.XpG();t.R7$(4),t.Dyx(e.parameters)}}function At(o,a){1&o&&(t.j41(0,"div",17)(1,"span"),t.EFF(2,"Sources"),t.k0s()())}function kt(o,a){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(null==e.value.Definition?null:e.value.Definition.Name)}}function jt(o,a){if(1&o&&(t.j41(0,"li")(1,"b"),t.EFF(2),t.k0s(),t.EFF(3,"="),t.j41(4,"em"),t.EFF(5),t.k0s()()),2&o){const e=a.$implicit;t.R7$(2),t.JRh(e.key),t.R7$(3),t.JRh(e.value)}}function wt(o,a){if(1&o&&(t.j41(0,"tr")(1,"td"),t.nVh(2,kt,2,1,"div"),t.j41(3,"pre"),t.EFF(4),t.k0s()(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td")(8,"ol"),t.Z7z(9,jt,6,2,"li",null,t.fX1),t.nI1(11,"keyvalue"),t.k0s()(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&o){const e=a.$implicit;t.R7$(2),t.vxM(null!=e.value.Definition&&e.value.Definition.Name?2:-1),t.R7$(2),t.JRh(e.value.Guid),t.R7$(2),t.JRh(e.value.Type),t.R7$(3),t.Dyx(t.bMT(11,4,e.value.Configuration)),t.R7$(4),t.JRh(e.value.Error)}}function Gt(o,a){1&o&&(t.j41(0,"div",18)(1,"span"),t.EFF(2,"Streams"),t.k0s()())}function Ut(o,a){if(1&o&&(t.j41(0,"tr")(1,"td")(2,"pre"),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"pre"),t.EFF(6),t.k0s()(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s()()),2&o){const e=a.$implicit;t.R7$(3),t.JRh(e.Source+":"+e.SourceOut),t.R7$(3),t.JRh(e.Target+":"+e.TargetIn),t.R7$(2),t.JRh(e.Count),t.R7$(2),t.JRh(e.Error)}}let Lt=(()=>{class o{constructor(e,i,n){this.dialogData=e,this.dialog=i,this.visualQueryService=n}ngOnInit(){const e=this.visualQueryService.pipelineModel().Pipeline,i=(e.Params?.split("\n")??[]).filter(s=>!!s),n=(e.TestParameters?.split("\n")??[]).filter(s=>!!s);this.parameters=[].concat(i,n),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialog.close()}show(e){e!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,e):this.visualQueryService.runPipeline(e),this.closeDialog())}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(V.e),t.rXU(V.k),t.rXU(z))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-query-result"]],decls:56,vars:11,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["dynamicHeight","","color","accent",1,"eav-tab-group"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"eav-tab-description"],["mat-button",""],[1,"eav-pre-scroll"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],[1,"eav-tab-content"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3," Query Results "),t.nVh(4,St,1,2),t.k0s(),t.j41(5,"button",3),t.bIt("click",function(){return n.closeDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",4)(9,"p"),t.EFF(10),t.k0s(),t.j41(11,"mat-tab-group",5)(12,"mat-tab"),t.DNE(13,bt,3,0,"div",6),t.j41(14,"div",7)(15,"div"),t.nVh(16,Pt,1,0),t.nVh(17,It,1,1),t.k0s(),t.j41(18,"div"),t.Z7z(19,Mt,4,2,"button",8,t.fX1),t.k0s()(),t.j41(21,"pre",9),t.EFF(22),t.nI1(23,"json"),t.k0s()(),t.nVh(24,Ot,6,0,"mat-tab"),t.j41(25,"mat-tab"),t.DNE(26,At,3,0,"div",10),t.j41(27,"div",11)(28,"table")(29,"tr")(30,"th"),t.EFF(31,"Name and Guid"),t.k0s(),t.j41(32,"th"),t.EFF(33,"Type"),t.k0s(),t.j41(34,"th"),t.EFF(35,"Configuration"),t.k0s(),t.j41(36,"th"),t.EFF(37,"Error"),t.k0s()(),t.Z7z(38,wt,14,6,"tr",null,t.fX1),t.nI1(40,"keyvalue"),t.k0s()()(),t.j41(41,"mat-tab"),t.DNE(42,Gt,3,0,"div",12),t.j41(43,"div",11)(44,"table")(45,"tr")(46,"th"),t.EFF(47,"Source"),t.k0s(),t.j41(48,"th"),t.EFF(49,"Target"),t.k0s(),t.j41(50,"th"),t.EFF(51,"Items"),t.k0s(),t.j41(52,"th"),t.EFF(53,"Error"),t.k0s()(),t.Z7z(54,Ut,11,4,"tr",null,t.fX1),t.k0s()()()()()()),2&i&&(t.R7$(4),t.vxM(n.debugStream?4:-1),t.R7$(6),t.Lme(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",n.timeUsed,"ms (",n.ticksUsed," ticks) "),t.R7$(6),t.vxM(0===n.top?16:-1),t.R7$(),t.vxM(0!==n.top?17:-1),t.R7$(2),t.Dyx(n.optionsForTop),t.R7$(3),t.JRh(t.bMT(23,7,n.result)),t.R7$(2),t.vxM(null!=n.parameters&&n.parameters.length?24:-1),t.R7$(14),t.Dyx(t.bMT(40,9,n.sources)),t.R7$(16),t.Dyx(n.streams))},dependencies:[K.Hl,K.$z,q.M,d.m_,d.An,Z.RI,Z.ES,Z.mq,Z.T8,m.TG,m.lG],styles:[".eav-dialog[_ngcontent-%COMP%]{overflow:hidden}.eav-tab-group[_ngcontent-%COMP%]{padding:0}.eav-tab-content[_ngcontent-%COMP%]{height:calc(100vh - 268px);overflow-y:auto}.eav-tab-description[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-right:1rem;padding:1rem;font-size:16px;line-height:1.5}.eav-pre-scroll[_ngcontent-%COMP%]{height:calc(100vh - 348px);overflow-y:auto}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 10px 0 0;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]})}return o})(),$t=(()=>{class o{constructor(e,i){this.dialogData=e,this.dialog=i}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialog.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api-query"),"_blank")}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(V.e),t.rXU(V.k))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["align","end"],["mat-button","","tippy","Open 2sxc Insights",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Stream Error Results"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return n.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"pre"),t.EFF(9),t.nI1(10,"json"),t.k0s()(),t.j41(11,"mat-dialog-actions",5)(12,"button",6),t.bIt("click",function(){return n.openInsights()}),t.j41(13,"mat-icon",7),t.EFF(14,"speed"),t.k0s(),t.j41(15,"span"),t.EFF(16,"Insights"),t.k0s()()()()),2&i&&(t.R7$(9),t.JRh(t.bMT(10,1,n.errorData)))},dependencies:[K.Hl,K.$z,q.M,d.m_,d.An,V.M,m.TG],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]})}return o})();var et=r(37580),Bt=r(3347);let z=(()=>{class o extends Et.V{#t;#e;#n;#i;#o;#s;#a;#r;constructor(e,i,n,s,c){super(),this.snackBar=e,this.matDialog=i,this.viewContainerRef=n,this.zone=s,this.changeDetectorRef=c,this.#t=(0,W.d)(B.g),this.#e=(0,W.d)(U.T),this.#n=(0,W.d)(pt),this.#i=(0,W.d)(ut.c),this.#o=(0,W.d)(y.hE),this.pipelineModel=(0,l.vPA)(null),this.dataSources=(0,l.vPA)(null),this.dataSourceConfigs=(0,l.vPA)({}),this.putEntityCountOnConnections$=new D.B,this.#s=parseInt(this.#i.getParam("pipelineId"),10),this.#a=!1,this.#r=!1}ngOnDestroy(){this.putEntityCountOnConnections$.complete(),super.ngOnDestroy()}init(){this.#h(()=>this.#c(!0,!0,!1)),this.#m(),this.#i.doOnDialogClosed(()=>{(this.#a||this.#r)&&this.#c(this.#a,this.#r,this.#a),this.#a=!1,this.#r=!1})}editPipelineEntity(){this.#l(()=>{const e={items:[M.c.editId(this.pipelineModel().Pipeline.EntityId)]},i=(0,Y.s)(e);this.#i.navRelative([`edit/${i}`]),this.#a=!0})}saveAndRun(e,i){return e&&i?this.#l(()=>this.runPipeline()):e?this.#l():i?this.runPipeline():void 0}showDataSourceDetails(e){const i=(0,I.A)(this.pipelineModel()),n=tt.i.tryParse(i.Pipeline.VisualDesignerData)??{};n.ShowDataSourceDetails=e,i.Pipeline.VisualDesignerData=JSON.stringify(n),this.pipelineModel.set(i)}addDataSource(e){const i=(0,I.A)(this.pipelineModel());i.DataSources.push({Description:"",EntityGuid:"unsaved"+(i.DataSources.length+1),EntityId:void 0,Name:e.Name,PartAssemblyAndType:e.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel.set(i),this.#l()}removeDataSource(e,i,n){const s=(0,I.A)(this.pipelineModel());s.DataSources=s.DataSources.filter(c=>c.EntityGuid!==e),s.Pipeline.StreamWiring=i,s.Pipeline.StreamsOut=n,this.pipelineModel.set(s)}renameDataSource(e,i){const n=(0,I.A)(this.pipelineModel());n.DataSources.find(c=>c.EntityGuid===e).Name=i,this.pipelineModel.set(n)}changeDataSourceDescription(e,i){const n=(0,I.A)(this.pipelineModel());n.DataSources.find(c=>c.EntityGuid===e).Description=i,this.pipelineModel.set(n)}changeConnections(e,i){const n=(0,I.A)(this.pipelineModel());n.Pipeline.StreamWiring=e,n.Pipeline.StreamsOut=i,this.pipelineModel.set(n)}changeDataSourcePosition(e,i){const n=(0,I.A)(this.pipelineModel()),s=n.DataSources.find(c=>c.EntityGuid===e);s&&(s.VisualDesignerData={...s.VisualDesignerData,...i},this.pipelineModel.set(n))}#p(e){const i={};e.forEach(n=>{null!=n.EntityId&&(i[n.EntityId]=[],n.Metadata?.forEach(s=>{Object.entries(s).forEach(([c,p])=>{null==p||""===p||["Created","Guid","Id","Modified","Title","_Type"].includes(c)||(Array.isArray(p)&&null!==p[0]?.Title&&null!==p[0]?.Id&&(p=`${p[0].Title} (${p[0].Id})`),i[n.EntityId].push({name:c,value:p}))})}))}),this.dataSourceConfigs.set(i)}editDataSource(e){const n=b(this.dataSources(),e.PartAssemblyAndType).ContentType,{targetType:s,keyType:c}=v.YX.metadata.entity,p=e.EntityGuid;this.#e.getMetadataPromise(s,c,p,n).then(R=>{if(R.Items.length){const F={items:[M.c.editId(R.Items[0].Id)]},T=(0,Y.s)(F);return this.#i.navRelative([`edit/${T}`]),void(this.#r=!0)}this.#t.retrieveContentType(n).subscribe({next:F=>{if(null==F)return void this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});const T={items:[M.c.newMetadata(p,n,v.YX.metadata.entity)]},X=(0,Y.s)(T);this.#i.navRelative([`edit/${X}`]),this.#r=!0},error:F=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}#l(e){this.snackBar.open("Saving..."),this.#n.savePipeline(this.pipelineModel()).subscribe({next:i=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel.set(i),e?.()},error:i=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(e=25){this.snackBar.open("Running query..."),this.#n.runPipelinePromise(this.pipelineModel().Pipeline.EntityId,e).then(i=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.queryResult=i,this.#d(i,e),console.warn(i),this.pipelineModel.set((0,I.A)(this.pipelineModel())),setTimeout(()=>{this.putEntityCountOnConnections$.next(i)})}).catch(i=>{this.snackBar.open("Query failed",null,{duration:2e3})})}debugStream(e,i=25){if(e.Error)return this.#u(e);if(0===e.Count)return;this.snackBar.open("Running stream...");const n=this.pipelineModel().Pipeline.EntityId;this.#n.debugStreamPromise(n,e.Source,e.SourceOut,i).then(s=>{this.snackBar.open("Stream worked",null,{duration:2e3});const c=this.pipelineModel().DataSources.find(R=>R.EntityGuid===e.Source);this.#d(s,i,{name:e.SourceOut,source:e.Source,sourceName:c?.Name,original:e}),console.warn(s)}).catch(s=>{this.snackBar.open("Stream failed",null,{duration:2e3})})}#c(e,i,n){n&&this.snackBar.open("Reloading query, please wait..."),this.#n.fetchPipelinePromise(this.#s,this.dataSources()).then(s=>{n&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.#o.setTitle(`${s.Pipeline.Name} - Visual Query`),e&&this.pipelineModel.set(s),i&&this.#p(s.DataSources)})}#d(e,i,n){this.matDialog.open(Lt,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:e,debugStream:n,top:i},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}#u(e){this.matDialog.open($t,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:e.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}#h(e){this.#n.fetchDataSourcesPromise().then(i=>{this.dataSources.set(i),e()})}#m(){this.zone.runOutsideAngular(()=>{this.subscriptions.add((0,L.R)(window,"keydown").pipe((0,$.p)(()=>!this.#i.snapshot.firstChild),(0,$.p)(e=>(0,Ct.J)(e))).subscribe(e=>{e.preventDefault(),this.zone.run(()=>{this.#l()})}))})}static#_=this.\u0275fac=function(i){return new(i||o)(l.KVO(Bt.UG),l.KVO(V.h),l.KVO(t.c1b),l.KVO(t.SKi),l.KVO(et.gRc))};static#f=this.\u0275prov=l.jDH({token:o,factory:o.\u0275fac})}return o})();function Qt(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",7),t.bIt("click",function(){const n=l.eBV(e).$implicit,s=t.XpG(4);return l.Njj(s.addDataSource(n))}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()}if(2&o){const e=a.$implicit,i=t.XpG(4);t.Y8G("tippy",e.UiHint||e.Name),t.R7$(2),t.JRh(e.Icon||i.guiTypes.Unknown.Icon),t.R7$(2),t.JRh(e.Name)}}function Xt(o,a){if(1&o&&(t.j41(0,"div",5),t.Z7z(1,Qt,5,3,"div",6,t.BUC().trackDataSources,!0),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.Dyx(e.value)}}function Nt(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",4),t.bIt("click",function(){const n=l.eBV(e).$implicit,s=t.XpG(2);return l.Njj(s.toggleItem(n.key))}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()(),t.nVh(5,Xt,3,0,"div",5)}if(2&o){const e=a.$implicit,i=t.XpG(2);t.Y8G("tippy",i.guiTypes[e.key].UiHint||e.key),t.R7$(2),t.JRh(i.guiTypes[e.key].Icon||i.guiTypes.Unknown.Icon),t.R7$(2),t.JRh(i.guiTypes[e.key].Label??i.guiTypes[e.key].Name??e.key),t.R7$(),t.vxM(i.toggledItems.includes(e.key)?5:-1)}}function Wt(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"span",2),t.EFF(3,"Show Advanced"),t.k0s(),t.j41(4,"mat-slide-toggle",3),t.bIt("change",function(n){l.eBV(e);const s=t.XpG();return l.Njj(s.toggleDifficulty(n))}),t.k0s()(),t.Z7z(5,Nt,6,4,null,null,t.BUC().trackGroups,!0),t.nI1(7,"keyvalue"),t.k0s()}if(2&o){const e=t.XpG();t.R7$(5),t.Dyx(t.bMT(7,0,e.sorted()))}}let Kt=(()=>{class o{#t;#e;constructor(e){this.visualQueryService=e,this.toggledItems=[],this.guiTypes=E,this.#t=v.YX.pipelineDesigner.dataSourceDifficulties,this.#e=(0,l.vPA)(this.#t.default),this.sorted=(0,h.EW)(()=>function Vt(o,a){if(!o)return;const i=(0,I.A)(o).filter(s=>s.Difficulty<=a&&s.PartAssemblyAndType!==v.YX.pipelineDesigner.outDataSource.PartAssemblyAndType);i.sort((s,c)=>s.Name.toLocaleLowerCase().localeCompare(c.Name.toLocaleLowerCase()));const n={};for(const s of i){const c=s.PrimaryType;n[c]?n[c].push(s):n[c]=[s]}return n}(this.visualQueryService.dataSources(),this.#e()))}toggleDifficulty(e){const i=e.checked?this.#t.advanced:this.#t.default;this.#e.set(i)}addDataSource(e){this.visualQueryService.addDataSource(e)}toggleItem(e){S.f.toggleInArray(e,this.toggledItems)}trackGroups(e,i){return i.key}trackDataSources(e,i){return i.PartAssemblyAndType}static#n=this.\u0275fac=function(i){return new(i||o)(t.rXU(z))};static#i=this.\u0275cmp=t.VBU({type:o,selectors:[["app-add-explorer"]],decls:1,vars:1,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"eav-show-advanced"],[1,"eav-slide-toggle-label"],["color","primary",3,"change"],["tippyShowDelay","750",1,"collapsible",3,"click","tippy"],[1,"list"],["tippyShowDelay","750",1,"list-item",3,"tippy"],["tippyShowDelay","750",1,"list-item",3,"click","tippy"]],template:function(i,n){1&i&&t.nVh(0,Wt,8,2,"div",0),2&i&&t.vxM(n.sorted()?0:-1)},dependencies:[_.mV,_.sG,d.m_,d.An,m.lG,C.e],styles:[".mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}.eav-show-advanced[_ngcontent-%COMP%]{margin-left:8px}"]})}return o})();var Ht=r(75797),zt=r(19999),ht=r(43176),Yt=r(23840),Jt=r(33518),Q=r(34435);const mt="dataSource_";function w(o){return mt+o}function J(o){return o.replace(mt,"")}const Zt={all:!1};class nt{constructor(){this.log=(0,Q.Tq)({ConnectionLineColors:nt},Zt),this.#t=0,this.#e={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.#n=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.#i=this.#n.length-1,this.#o={}}#t;#e;#n;#i;#o;nextLinePaintStyle(a){return this.#o[a]??=this.#s()}#s(){return{...this.#e,stroke:this.#n[this.#t++%this.#i]}}}const qt={all:!1,eventConnectionDetached:!1,eventConnectionAttached:!1};class it{constructor(a,e,i,n,s){this.instance=a,this.pipelineModel=e,this.dataSources=i,this.endpointsSvc=n,this.onConnectionsChanged=s,this.log=(0,Q.Yx)({ConnectionsManager:it},qt),this.bulkDelete=!1}setup(){this.instance.bind("connectionDetached",a=>this.handleDetached(a)),this.instance.bind("connection",a=>this.handleAttached(a))}getAll(){return this.instance.getAllConnections().map(e=>({From:J(e.sourceId),Out:P(e.endpoints[0]),To:J(e.targetId),In:P(e.endpoints[1])}))}handleDetached(a){const e=this.log.fnIf("eventConnectionDetached");if(this.bulkDelete)return e.end("in bulk-delete mode, exit");const i=a.target,n=this.pipelineModel.DataSources.find(R=>R.EntityGuid===J(i.id)),s=b(this.dataSources,n.PartAssemblyAndType),c=P(a.targetEndpoint);!s.In.some(R=>this.endpointsSvc.getInfo(R,!1).name===c)&&this.instance.deleteEndpoint(a.targetEndpoint),setTimeout(()=>this.onConnectionsChanged()),e.end("done")}handleAttached(a){const e=this.log.fnIf("eventConnectionAttached");if(a.sourceId===a.targetId)return setTimeout(()=>{this.instance.deleteConnection(a.connection,{fireEvent:!1}),setTimeout(()=>this.onConnectionsChanged())}),e.end("self-connection, will delete and exit");const i=a.targetEndpoint.getOverlay("endpointLabel"),n=i.getLabel(),c=this.instance.getEndpoints(a.target.id).some(p=>P(p)===n&&a.targetEndpoint.id!==p.id&&p.canvas.classList.contains("targetEndpoint"));c&&i.setLabel(`PleaseRename${Math.floor(99999*Math.random())}`),setTimeout(()=>this.onConnectionsChanged()),e.end("done",{targetLabel:n,targetHasSameLabel:c})}}var G=r(34456),te=r(31403),ee=r(31016),_t=r(59791),ft=r(64043),ne=r(63037),ie=r(91817),oe=r(43758),se=r(39333),ot=r(87698),ae=r(23731);const gt=o=>({active:o});function re(o,a){1&o&&(t.j41(0,"app-field-hint"),t.EFF(1," You will get suggestions for out-streams after you run query "),t.k0s())}function le(o,a){1&o&&(t.j41(0,"app-field-hint",12),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function ce(o,a){if(1&o&&(t.j41(0,"mat-form-field",10)(1,"mat-label"),t.EFF(2,"Label"),t.k0s(),t.nrm(3,"input",11),t.k0s(),t.nVh(4,re,2,0,"app-field-hint"),t.nVh(5,le,2,1,"app-field-hint",12)),2&o){const e=t.XpG();t.R7$(4),t.vxM(e.isSource&&!e.pipelineResultExists?4:-1),t.R7$(),t.vxM(e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?5:-1)}}function de(o,a){if(1&o&&(t.j41(0,"mat-option",19),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",e.name," ")}}function pe(o,a){if(1&o&&(t.j41(0,"mat-form-field",10)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",18),t.Z7z(4,de,2,2,"mat-option",19,t.fX1),t.k0s()(),t.j41(6,"app-field-hint"),t.EFF(7," The scope should almost never be changed - "),t.j41(8,"a",20),t.EFF(9,"see help"),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(3),t.Y8G("placeholder",e.scopeOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.scopeOptions)}}function ue(o,a){if(1&o&&(t.j41(0,"mat-option",19),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function he(o,a){if(1&o&&(t.j41(0,"mat-select",13),t.Z7z(1,ue,2,2,"mat-option",19,t.fX1),t.k0s()),2&o){const e=t.XpG(2);t.Y8G("placeholder",e.labelOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.labelOptions)}}function me(o,a){1&o&&t.nrm(0,"input",11)}function _e(o,a){1&o&&(t.j41(0,"app-field-hint",12),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function fe(o,a){if(1&o){const e=t.RV6();t.nVh(0,pe,10,1),t.j41(1,"mat-form-field",10)(2,"mat-label"),t.EFF(3,"Label"),t.k0s(),t.nVh(4,he,3,1,"mat-select",13),t.nVh(5,me,1,0,"input",11),t.j41(6,"div",14)(7,"button",15),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.toggleGuidedLabel(!0))}),t.j41(8,"mat-icon",16),t.EFF(9,"search"),t.k0s()(),t.j41(10,"button",17),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.toggleGuidedLabel(!1))}),t.j41(11,"mat-icon",16),t.EFF(12,"text_fields"),t.k0s()()()(),t.nVh(13,_e,2,1,"app-field-hint",12)}if(2&o){const e=t.XpG();t.vxM(e.advancedMode&&e.guidedLabel?0:-1),t.R7$(4),t.vxM(e.guidedLabel?4:-1),t.R7$(),t.vxM(e.guidedLabel?-1:5),t.R7$(2),t.Y8G("ngClass",t.eq3(6,gt,e.guidedLabel)),t.R7$(3),t.Y8G("ngClass",t.eq3(8,gt,!e.guidedLabel)),t.R7$(3),t.vxM(e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?13:-1)}}function ge(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-slide-toggle",21),t.bIt("change",function(n){l.eBV(e);const s=t.XpG();return l.Njj(s.toggleAdvancedMode(n))}),t.EFF(1),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("checked",e.advancedMode),t.R7$(),t.SpI(" ",e.advancedMode?"Advanced":"Simple"," ")}}let ve=(()=>{class o extends ht.${#t;constructor(e,i,n,s){super(),this.dialogData=e,this.dialog=i,this.visualQueryService=n,this.changeDetectorRef=s,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.queryResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1,this.#t=(0,W.d)(A.gs)}ngOnInit(){this.#e()}closeDialog(e){this.dialog.close(e)}toggleGuidedLabel(e){this.guidedLabel=e}toggleAdvancedMode(e){this.advancedMode=e.checked}rename(){const e=this.form.getRawValue();this.closeDialog(e.label)}#e(){this.form=new G.J3({label:new G.hs(this.dialogData.label,G.k0.required),scope:new G.hs(v.YX.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscriptions.add(this.controls.scope.valueChanges.pipe((0,ne.Z)(this.controls.scope.value),(0,ie.F)()).subscribe(e=>{this.labelOptions=Object.values(this.visualQueryService.queryResult.Sources).find(i=>i.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(i=>i.Scope===e).map(i=>i.Name),!this.labelOptions.includes(this.controls.label.value)&&null!=this.controls.label.value&&this.controls.label.patchValue(null)})),this.#t.getScopesPromise().then(e=>{const i=Object.values(this.visualQueryService.queryResult.Sources).find(s=>s.Guid===this.dialogData.pipelineDataSourceGuid).Out,n=e.filter(s=>i.some(c=>c.Scope===s.value));this.scopeOptions=n,this.changeDetectorRef.markForCheck()}))}static#n=this.\u0275fac=function(i){return new(i||o)(t.rXU(V.e),t.rXU(V.k),t.rXU(z),t.rXU(et.gRc))};static#i=this.\u0275cmp=t.VBU({type:o,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(i,n){2&i&&t.Avn("className",n.hostClass)},features:[t.Vt3],decls:19,vars:5,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"formGroup"],[1,"eav-dialog-actions"],["color","accent",3,"checked"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","formControlName","label","required",""],[3,"isError"],["formControlName","label","required","",3,"placeholder"],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"click","ngClass"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"click","ngClass"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["color","accent",3,"change","checked"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Rename stream"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return n.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"form",5),t.nVh(9,ce,6,2),t.nVh(10,fe,14,10),t.k0s()(),t.j41(11,"mat-dialog-actions",6)(12,"div"),t.nVh(13,ge,2,2,"mat-slide-toggle",7),t.k0s(),t.j41(14,"div")(15,"button",8),t.bIt("click",function(){return n.closeDialog()}),t.EFF(16,"Cancel"),t.k0s(),t.j41(17,"button",9),t.bIt("click",function(){return n.rename()}),t.EFF(18," Rename "),t.k0s()()()()),2&i&&(t.R7$(8),t.Y8G("formGroup",n.form),t.R7$(),t.vxM(n.isSource&&n.pipelineResultExists?-1:9),t.R7$(),t.vxM(n.isSource&&n.pipelineResultExists?10:-1),t.R7$(3),t.vxM(n.isSource&&n.pipelineResultExists?13:-1),t.R7$(4),t.Y8G("disabled",!n.form.valid))},dependencies:[K.Hl,K.$z,q.M,d.m_,d.An,G.YN,G.qT,G.me,G.BC,G.cb,G.YS,G.X1,G.j4,G.JD,ee.M,ot.j,ot.M,ot.g,_t.fS,_t.fg,ft.M,ft.g,ae.M,te.M,m.YU,V.M,_.mV,_.sG,oe.F,se.c],encapsulation:2})}return o})();const ye={all:!0,getEndpointOverlays:!0,getEndpointInfo:!0,buildSourceDef:!0,buildTargetDef:!0};class st{constructor(a,e){this.pipelineModel=a,this.renameDialogParts=e,this.log=(0,Q.Tq)({EndpointDefinitionsService:st},ye)}#t(a){return this.log.fnIf("getEndpointOverlays",{isSource:a}).r([["Label",{id:"endpointLabel",location:[.5,a?0:1],label:"Default",cssClass:a?"endpointSourceLabel":"endpointTargetLabel"}]])}getInfo(a,e){const i=this.log.fnIf("getEndpointInfo",{endpointName:a,isDynamic:e}),n=a.trim(),s=n.endsWith("*"),c=s?n.substring(0,n.length-1):n;return e?i.r({name:c,required:!1},"isDynamic"):i.r({name:c,required:s},"notDynamic")}buildSourceDef(a,e){const i=this.log.fnIf("buildSourceDef",{pipelineDataSourceGuid:a,style:e}),n=!0,s={paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint "+(e??""),maxConnections:-1,isSource:n,anchor:["Continuous",{faces:["top"]}],overlays:this.#t(n),events:{click:c=>this.onChangeLabel(c,n,a)}};return i.r(s)}buildTargetDef(a,e){const i=this.log.fnIf("buildTargetDef",{pipelineDataSourceGuid:a,style:e}),n=!1,s={paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint "+(e??" "),maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.#t(n),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:c=>this.onChangeLabel(c,n,a)}};return i.r(s)}onChangeLabel(a,e,i){if(!this.pipelineModel.Pipeline.AllowEdit)return;const n=a?.getOverlay?.("endpointLabel")??a;this.renameDialogParts.matDialog.open(ve,{autoFocus:!1,data:{pipelineDataSourceGuid:i,isSource:e,label:n.label},viewContainerRef:this.renameDialogParts.viewContainerRef,width:"650px"}).afterClosed().subscribe(s=>{s&&(n.setLabel(s),setTimeout(()=>this.renameDialogParts.onConnectionsChanged()))}),this.renameDialogParts.changeDetectorRef.markForCheck()}}const De={all:!1,addEndpoint:!1,reOrientAllLabels:!1,updateAfterChanges:!1,wireHasConnection:!1,mirrorEndpoints:!1,fields:["TestIn2","Default"]};class at{constructor(a,e,i,n){this.instance=a,this.endpointDefs=e,this.connections=i,this.queryData=n,this.log=(0,Q.Yx)({EndpointsManager:at},De),this.#e=!1}addEndpoint(a,e,i,n,s){const c=this.log.fnIfInList("addEndpoint","fields",e,{endpointName:e,isIn:i,queryDs:n}),p=b(this.queryData.dataSources,n.PartAssemblyAndType),R=i?p.In:p.Out,F=R?.some(an=>!1===this.endpointDefs.getInfo(an,!1).required),T=this.endpointDefs.getInfo(e,F);c.a("endpointInfo",{dataSource:p,connectionList:R,hasDynamic:F,endpointInfo:T});const X=F?"dynamic":T.required?this.#t(a,T.name,i)?"":"required":"",x=a.id+(i?"_in_":"_out_")+T.name,N=i?this.endpointDefs.buildTargetDef(n.EntityGuid,`${X} ${s}`):this.endpointDefs.buildSourceDef(n.EntityGuid,`${X} ${s}`),Dt=this.instance.addEndpoint(a,N,{uuid:x,enabled:this.queryData.query.Pipeline.AllowEdit||n.EntityGuid===v.YX.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel");Dt.setLabel(T.name),c.end("end",{overlay:Dt})}#t(a,e,i=!0){const n=this.log.fnIf("wireHasConnection",{domDataSource:a,name:e,isIn:i}),s=this.queryData.query.Pipeline.StreamWiring?.some(c=>i?w(c.To)===a.id&&c.In===e:w(c.From)===a.id&&c.Out===e);return n.r(s,"wireExists"+s)}#e;updateAfterChanges(){const a=this.log.fnIf("updateAfterChanges",{query:this.queryData.query,isDoing:this.#e});if(this.#e)return a.end("already doing update, exit");this.#e=!0,this.#n(),this.#o(),this.#e=!1,this.instance.repaintEverything(),a.end("done")}#n(){const a=this.log.fnIf("mirrorEndpoints",{query:this.queryData.query});this.queryData.query.DataSources.map(i=>{const n=b(this.queryData.dataSources,i.PartAssemblyAndType);return"mirror-in"===n.OutMode?{def:n,guid:i.EntityGuid}:null}).filter(i=>null!==i).forEach(i=>{const{inPoints:n,outPoints:s}=this.#i(i.guid),c=n.map(x=>({point:x,label:P(x)})),p=s.map(x=>({point:x,label:P(x)})),R=c.filter(x=>!p.some(N=>N.label===x.label)),F=p.filter(x=>!c.some(N=>N.label===x.label));a.a("inMissingInOut",{inPoints:n,outPoints:s,missingInOut:R,outWithoutIn:F});const{domDataSource:T,dataSource:X}=this.queryData.findDataSourceAndDom(i.guid);R.length&&R.forEach(x=>this.addEndpoint(T,x.label,!1,X,"mirror-in")),F.forEach(x=>{x.point.canvas.classList.contains("mirror-in")&&(x.point.connections?.length||this.instance.deleteEndpoint(x.point))})})}#i(a){const e=this.instance.selectEndpoints({element:w(a)}),i=[],n=[];return e.each(s=>(s.isTarget?i:n).push(s)),{inPoints:i,outPoints:n}}#o(){const a=this.log.fnIf("reOrientAllLabels");this.queryData.query.DataSources.map(i=>i.EntityGuid).forEach(i=>{const{inPoints:n,outPoints:s}=this.#i(i);this.#s(n),this.#s(s)}),a.end()}#s(a){const e=a.length>3,i=a.map(n=>P(n)).join(",");a.forEach(e||i.length>30?n=>n.addClass("angled"):n=>n.removeClass("angled"))}removeAllEndpoints(a){const e=w(a);this.connections.bulkDelete=!0,this.instance.batch(()=>{this.instance.selectEndpoints({element:e}).delete()}),this.connections.bulkDelete=!1}}class Se{constructor(a,e){this.jsPlumbRoot=a,this.lineColors=e,this.instance=window.jsPlumb.getInstance(this.createInstanceDefaults(this.jsPlumbRoot))}createInstanceDefaults(a){return{Container:a,Connector:["Bezier",{curviness:70}],PaintStyle:this.lineColors.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}destroy(){this.instance.reset(),this.instance.unbindContainer(),this.instance=null}}const be={all:!1,putEntityCountOnConnections:!1};class rt{constructor(a,e,i){this.instance=a,this.pipelineModel=e,this.onDebugStream=i,this.log=(0,Q.Yx)({LinesDecorator:rt},be)}addEntityCount(a){const e=this.log.fnIf("putEntityCountOnConnections");a.Streams?.forEach(i=>{const n=w(i.Source),c=["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(i.Target)?w("Out"):w(i.Target),p=n+"_out_"+i.SourceOut,R=c+"_in_"+i.TargetIn;this.instance.getEndpoint(p)?.connections?.filter(T=>T.endpoints[1].getUuid()===R)?.forEach(T=>{const X=i.Error?"":i.Count.toString();T.setLabel({label:X,cssClass:"streamEntitiesCount "+(i.Error?"streamEntitiesError":""),events:{click:()=>{this.pipelineModel.Pipeline.AllowEdit&&this.onDebugStream(i)}}})})}),e.end("done")}}const Pe={all:!1,findDataSourceAndDom:!1};class lt{constructor(a,e,i){this.jsPlumbRoot=a,this.query=e,this.dataSources=i,this.log=(0,Q.Yx)({QueryDataManager:lt},Pe)}findDomAndDef(a,e){const i=this.findDataSourceAndDom(a);if(!i)return null;const n=b(this.dataSources,e);return n?{...i,definition:n}:null}findDataSourceAndDom(a){const e=this.log.fnIf("findDataSourceAndDom",{sourceElementId:a}),i=this.jsPlumbRoot.querySelector("#"+w(a));if(!i)return e.r(null,"DOM not found, exit");const n=J(i.id),s=this.query.DataSources.find(c=>c.EntityGuid===n);return e.r({domDataSource:i,dataSource:s},"returning data source")}}const Ie={all:!1,initWirings:!0,ensureWireEndpointExists:!0,findDataSourceInDom:!0,fields:["TestIn2","*"]};class ct{constructor(a,e,i){this.plumber=a,this.instance=e,this.queryData=i,this.log=(0,Q.Yx)({WiringsHelper:ct},Ie)}initWirings(){const a=this.log.fnIf("initWirings"),e=this.queryData.query.Pipeline.StreamWiring;if(!e)return a.end("no wirings");const i=e.map(n=>({outPointDomId:w(n.From)+"_out_"+n.Out,inPointDomId:w(n.To)+"_in_"+n.In,wire:n}));a.a("wirings",{wireDetails:i}),i.forEach(n=>{this.#e(n.outPointDomId,n.wire.From,n.wire.Out,!1),this.#e(n.inPointDomId,n.wire.To,n.wire.In,!0)}),i.forEach(n=>this.#t(n.outPointDomId,n.inPointDomId)),this.instance.repaintEverything(),a.end()}#t(a,e){try{this.instance.connect({uuids:[a,e],paintStyle:this.plumber.lineColors.nextLinePaintStyle(a)})}catch{console.error({message:"Connection failed",from:a,to:e})}}#e(a,e,i,n){const s=this.log.fnIfInList("ensureWireEndpointExists","fields",i,{endpointId:a,sourceGuid:e,name:i,isIn:n}),c=this.#n(a,e,i);return null==c?s.r(c,"set null"):(this.plumber.endpoints.addEndpoint(c.domDataSource,i,n,c.dataSource),s.r(c,"ok"))}#n(a,e,i){const n=this.log.fnIfInList("findDataSourceInDom","fields",i,{endpointId:a,sourceGuid:e,name:i});if(this.instance.getEndpoint(a))return n.r(null,"endpoint exists, exit");const s=this.queryData.findDataSourceAndDom(e);return n.r(s,`found: ${null!=s}`)}}const Re={all:!1,addEndpoint:!0,initDomDataSources:!1,eventConnectionDetached:!0,eventConnectionAttached:!0,fields:["TestIn2"]};class dt{#t;#e;#n;constructor(a,e,i,n,s,c,p){this.jsPlumbRoot=a,this.query=e,this.dataSources=i,this.onConnectionsChangedParent=n,this.onDragend=s,this.onDebugStream=c,this.log=(0,Q.Yx)({Plumber:dt},Re),this.lineColors=new nt,this.queryData=new lt(this.jsPlumbRoot,this.query,this.dataSources),this.#e=new st(e,{...p,onConnectionsChanged:()=>this.#i()}),this.#n=new Se(this.jsPlumbRoot,this.lineColors),this.#t=this.#n.instance,this.lineDecorator=new rt(this.#t,this.query,this.onDebugStream),this.connections=new it(this.#t,this.query,this.dataSources,this.#e,()=>this.#i()),this.endpoints=new at(this.#t,this.#e,this.connections,this.queryData),this.#t.batch(()=>{this.#o(),new ct(this,this.#t,this.queryData).initWirings(),this.connections.setup(),this.endpoints.updateAfterChanges()}),this.#t.repaintEverything()}#i(){this.endpoints.updateAfterChanges(),this.onConnectionsChangedParent()}destroy(){this.#n.destroy()}removeAllEndpoints(a){const e=w(a);this.connections.bulkDelete=!0,this.#t.batch(()=>{this.#t.selectEndpoints({element:e}).delete()}),this.connections.bulkDelete=!1}getStreamsOut(){const a=[];return this.#t.selectEndpoints({target:w("Out")}).each(i=>{a.push(P(i))}),a.join(",")}#o(){const a=this.log.fnIf("initDomDataSources");for(const e of this.query.DataSources){const{domDataSource:i,definition:n}=this.queryData.findDomAndDef(e.EntityGuid,e.PartAssemblyAndType);if(i){if(this.query.Pipeline.AllowEdit&&this.#t.draggable(i,{grid:[20,20],stop:p=>{const F=J(p.el.id),T={Top:p.finalPos[1],Left:p.finalPos[0]};setTimeout(()=>this.onDragend(F,T))}}),a.a("dataSource.Out",{outCount:n.Out?.length??0,out:n.Out}),n.Out?.forEach(p=>{this.endpoints.addEndpoint(i,p,!1,e)}),"static"!=n.OutMode){const p=this.#e.buildSourceDef(e.EntityGuid);this.#t.makeSource(i,p,{filter:".add-endpoint"})}if(a.a("dataSource.In",{inCount:n.In?.length??0,in:n.In}),n.In?.forEach(p=>{this.endpoints.addEndpoint(i,p,!0,e)}),n.In){const p=this.#e.buildTargetDef(e.EntityGuid);p.maxConnections=-1,this.#t.makeTarget(i,p)}}}a.end()}}const xe=["domRoot"],Me=["domDataSource"],Te=(o,a,e)=>({top:o,left:a,"min-width":e}),Fe=o=>({"show-details":o});function Oe(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",16),t.bIt("click",function(){l.eBV(e);const n=t.XpG().$implicit,s=t.XpG(3);return l.Njj(s.configureDataSource(n))}),t.EFF(1," settings "),t.k0s()}}function Ae(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",17),t.bIt("click",function(){l.eBV(e);const n=t.XpG().$implicit,s=t.XpG(3);return l.Njj(s.openHelp(s.typeInfos()[n.EntityGuid].HelpLink))}),t.EFF(1," help_outline "),t.k0s()}}function ke(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",18),t.bIt("click",function(){l.eBV(e);const n=t.XpG().$implicit,s=t.XpG(3);return l.Njj(s.remove(n))}),t.EFF(1," delete "),t.k0s()}}function je(o,a){if(1&o&&(t.j41(0,"tr",21)(1,"td",22),t.EFF(2),t.k0s(),t.j41(3,"td",23),t.EFF(4),t.k0s()()),2&o){const e=a.$implicit;t.R7$(),t.Y8G("title",e.name),t.R7$(),t.JRh(e.name),t.R7$(),t.Y8G("title",e.value),t.R7$(),t.JRh(e.value)}}function we(o,a){if(1&o&&(t.nrm(0,"hr",19),t.j41(1,"table",20),t.Z7z(2,je,5,4,"tr",21,t.fX1),t.k0s()),2&o){const e=t.XpG().$implicit,i=t.XpG(3);t.R7$(2),t.Dyx(i.visQuerySvc.dataSourceConfigs()[e.EntityId])}}function Ge(o,a){1&o&&t.nrm(0,"div",14)}function Ue(o,a){1&o&&t.nrm(0,"div",15)}function Le(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",3,1)(2,"div",4)(3,"mat-icon",5),t.EFF(4),t.k0s(),t.nVh(5,Oe,2,0,"mat-icon",6),t.nVh(6,Ae,2,0,"mat-icon",7),t.k0s(),t.j41(7,"div",8),t.nVh(8,ke,2,0,"mat-icon",9),t.k0s(),t.j41(9,"div",10),t.bIt("click",function(){const n=l.eBV(e).$implicit,s=t.XpG(3);return l.Njj(s.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&s.editName(n))}),t.j41(10,"span"),t.EFF(11),t.k0s(),t.j41(12,"mat-icon",11),t.EFF(13,"edit"),t.k0s()(),t.nrm(14,"br"),t.j41(15,"div",12),t.bIt("click",function(){const n=l.eBV(e).$implicit,s=t.XpG(3);return l.Njj(s.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&s.editDescription(n))}),t.j41(16,"span"),t.EFF(17),t.k0s(),t.j41(18,"mat-icon",11),t.EFF(19,"edit"),t.k0s()(),t.nrm(20,"br"),t.nVh(21,we,4,0),t.j41(22,"div",13),t.EFF(23),t.k0s(),t.nVh(24,Ge,1,0,"div",14),t.nVh(25,Ue,1,0,"div",15),t.k0s()}if(2&o){let e,i;const n=a.$implicit,s=t.XpG(3);t.Y8G("id",s.domIdOfGuid(n.EntityGuid))("ngStyle",t.sMw(15,Te,n.VisualDesignerData.Top+"px",n.VisualDesignerData.Left+"px",n.VisualDesignerData.Width?n.VisualDesignerData.Width+"px":null))("ngClass",t.eq3(19,Fe,s.showDataSourceDetails()&&(null==(e=s.visQuerySvc.dataSourceConfigs()[n.EntityId])?null:e.length))),t.R7$(3),t.Y8G("title",s.typeInfos()[n.EntityGuid].UiHint),t.R7$(),t.SpI(" ",s.typeInfos()[n.EntityGuid].Icon," "),t.R7$(),t.vxM(s.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&s.typeInfos()[n.EntityGuid].EnableConfig?5:-1),t.R7$(),t.vxM(s.typeInfos()[n.EntityGuid].HelpLink?6:-1),t.R7$(2),t.vxM(s.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&!s.isOutDataSource(n)?8:-1),t.R7$(3),t.JRh(n.Name||"(no name)"),t.R7$(6),t.JRh(n.Description),t.R7$(4),t.vxM(s.showDataSourceDetails()&&null!=(i=s.visQuerySvc.dataSourceConfigs()[n.EntityId])&&i.length?21:-1),t.R7$(),t.Y8G("title",n.PartAssemblyAndType),t.R7$(),t.SpI("Type: ",s.getTypeName(n.PartAssemblyAndType)),t.R7$(),t.vxM(s.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&s.typeInfos()[n.EntityGuid].DynamicOut?24:-1),t.R7$(),t.vxM(s.visQuerySvc.pipelineModel().Pipeline.AllowEdit&&s.typeInfos()[n.EntityGuid].DynamicIn?25:-1)}}function $e(o,a){if(1&o&&t.Z7z(0,Le,26,21,"div",3,t.fX1),2&o){const e=t.XpG(2);t.Dyx(e.visQuerySvc.pipelineModel().DataSources)}}function Be(o,a){if(1&o&&(t.j41(0,"div",2,0),t.nVh(2,$e,2,0),t.k0s()),2&o){const e=t.XpG();t.R7$(2),t.vxM(e.hardReset?-1:2)}}const Ve={all:!1,ngAfterViewInit:!1};let vt=(()=>{class o extends ht.${#t;#e;#n;constructor(e,i,n,s){super(),this.visQuerySvc=e,this.changeDetectorRef=i,this.matDialog=n,this.viewContainerRef=s,this.log=(0,Q.Tq)({PlumbEditorComponent:o},Ve),this.domIdOfGuid=w,this.hardReset=!1,this.#e=new Ht.t(!1),this.#n=(0,W.d)(pt),this.showDataSourceDetails=(0,h.EW)(()=>(tt.i.tryParse(this.visQuerySvc.pipelineModel()?.Pipeline.VisualDesignerData)??{}).ShowDataSourceDetails??!1),this.typeInfos=(0,h.EW)(()=>function j(o,a){const e={};for(const i of o){const n=b(a,i.PartAssemblyAndType),s=n?{...n.PrimaryType?E[n.PrimaryType]:E.Unknown,DynamicIn:n.DynamicIn??!1,DynamicOut:"static"!=n.OutMode,Icon:n.Icon,UiHint:n.UiHint,HelpLink:n.HelpLink,outMode:n.OutMode,...null!=n.EnableConfig?{EnableConfig:n.EnableConfig}:{}}:{...E.Unknown,DynamicOut:!1,DynamicIn:!1,outMode:"static"};e[i.EntityGuid]=s}return e}(this.visQuerySvc.pipelineModel()?.DataSources??[],this.visQuerySvc.dataSources()))}ngOnInit(){(0,Jt.P)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],()=>{this.#e.next(!0)}),this.subscriptions.add(this.visQuerySvc.putEntityCountOnConnections$.subscribe(e=>{this.#t.lineDecorator.addEntityCount(e)}))}ngAfterViewInit(){const e=this.log.fnIf("ngAfterViewInit"),i=this.domDataSourcesRef.changes.pipe((0,k.T)(()=>!0));this.subscriptions.add((0,zt.z)([this.#e,i]).subscribe(([n,s])=>{!n||!s||(e.a("scriptLoaded and domDataSourcesLoaded",{scriptLoaded:n,domDataSourcesLoaded:s}),this.#t?.destroy(),this.#t=new dt(this.domRootRef.nativeElement,this.visQuerySvc.pipelineModel(),this.visQuerySvc.dataSources(),()=>this.onConnectionsChanged(),this.onDragend.bind(this),this.onDebugStream.bind(this),{matDialog:this.matDialog,viewContainerRef:this.viewContainerRef,changeDetectorRef:this.changeDetectorRef,onConnectionsChanged:()=>this.onConnectionsChanged()}))})),e.end()}ngOnDestroy(){this.#t?.destroy(),this.#e.complete(),super.ngOnDestroy()}onConnectionsChanged(){const e=this.#t.connections.getAll(),i=this.#t.getStreamsOut();this.visQuerySvc.changeConnections(e,i)}onDragend(e,i){this.visQuerySvc.changeDataSourcePosition(e,i)}onDebugStream(e){this.visQuerySvc.debugStream(e)}configureDataSource(e){if(e.EntityGuid.includes("unsaved"))return this.visQuerySvc.saveAndRun(!0,!1);this.visQuerySvc.editDataSource(e)}getTypeName(e){const i=b(this.visQuerySvc.dataSources(),e);return this.#n.typeNameFilter(i?.TypeNameForUi||e,"className")}isOutDataSource(e){return e.PartAssemblyAndType===v.YX.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(e){if(!confirm(`Delete ${e.Name} data source?`))return;this.#t.removeAllEndpoints(e.EntityGuid);const i=this.#t.connections.getAll(),n=this.#t.getStreamsOut();this.visQuerySvc.removeDataSource(e.EntityGuid,i,n)}openHelp(e){window.open(e,"_blank")}editName(e){const i=prompt("Rename data source",e.Name)?.trim();null==i||""===i||this.visQuerySvc.renameDataSource(e.EntityGuid,i)}editDescription(e){const i=prompt("Edit description",e.Description)?.trim();null!=i&&this.visQuerySvc.changeDataSourceDescription(e.EntityGuid,i)}static#i=this.\u0275fac=function(i){return new(i||o)(t.rXU(z),t.rXU(et.gRc),t.rXU(V.h),t.rXU(t.c1b))};static#o=this.\u0275cmp=t.VBU({type:o,selectors:[["app-plumb-editor"]],viewQuery:function(i,n){if(1&i&&(t.GBs(xe,5),t.GBs(Me,5)),2&i){let s;t.mGM(s=t.lsd())&&(n.domRootRef=s.first),t.mGM(s=t.lsd())&&(n.domDataSourcesRef=s)}},features:[t.Vt3],decls:1,vars:1,consts:[["domRoot",""],["domDataSource",""],["id","pipeline-root"],[1,"dataSource",3,"id","ngStyle","ngClass"],[1,"actions","left"],[1,"type-info",3,"title"],["title","Configure data source","appMousedownStopPropagation","",1,"configure"],["title","Help for this data source","appMousedownStopPropagation","",1,"help"],[1,"actions","right"],["title","Delete","appMousedownStopPropagation","",1,"delete"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"]],template:function(i,n){1&i&&t.nVh(0,Be,3,1,"div",2),2&i&&t.vxM(n.visQuerySvc.pipelineModel()?0:-1)},dependencies:[m.B3,m.YU,d.m_,d.An,Yt.z],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}\n\n/*# sourceMappingURL=plumb-editor.component.ts-angular-inline--1.css.map*/"]})}return o})();var Xe=r(14079);function We(o,a){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.R7$(),t.SpI(" ",e," ")}}function Ke(o,a){if(1&o&&(t.j41(0,"ul",9),t.Z7z(1,We,2,1,"li",null,t.fX1),t.k0s()),2&o){let e;const i=t.XpG(2);t.R7$(),t.Dyx(null==(e=i.vsSvc.pipelineModel().Pipeline.Params)?null:e.split("\n"))}}function He(o,a){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.R7$(),t.SpI(" ",e," ")}}function ze(o,a){if(1&o&&(t.j41(0,"ul",9),t.Z7z(1,He,2,1,"li",null,t.fX1),t.k0s()),2&o){let e;const i=t.XpG(2);t.R7$(),t.Dyx(null==(e=i.vsSvc.pipelineModel().Pipeline.TestParameters)?null:e.split("\n"))}}function Ye(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",5)(1,"span",12),t.EFF(2,"Show DataSource Params"),t.k0s(),t.j41(3,"mat-slide-toggle",13),t.bIt("change",function(n){l.eBV(e);const s=t.XpG(2);return l.Njj(s.showDataSourceDetails(n))}),t.k0s()()}if(2&o){const e=t.XpG(2);t.R7$(3),t.Y8G("checked",e.visualDesignerDataSig().ShowDataSourceDetails)}}function Je(o,a){1&o&&t.nrm(0,"li",16),2&o&&t.Y8G("innerHTML",a.$implicit,t.npT)}function Ze(o,a){if(1&o&&(t.j41(0,"div",14)(1,"div",6)(2,"span"),t.EFF(3,"Warnings"),t.k0s(),t.j41(4,"mat-icon",15),t.EFF(5,"warning"),t.k0s()(),t.j41(6,"ol",9),t.Z7z(7,Je,1,1,"li",16,t.fX1),t.k0s()()),2&o){const e=t.XpG(3);t.R7$(7),t.Dyx(e.warningSig())}}function qe(o,a){if(1&o&&t.nVh(0,Ze,9,0,"div",14),2&o){const e=t.XpG(2);t.vxM(e.warningSig().length?0:-1)}}function tn(o,a){if(1&o&&(t.j41(0,"div",10)(1,"div",6),t.EFF(2,"Query Description"),t.k0s(),t.j41(3,"div"),t.EFF(4),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(4),t.JRh(e.vsSvc.pipelineModel().Pipeline.Description)}}function en(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.saveAndRunQuery(!0,!0))}),t.EFF(4,"Save and run"),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.saveAndRunQuery(!1,!0))}),t.EFF(6,"Run"),t.k0s(),t.j41(7,"button",4),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.saveAndRunQuery(!0,!1))}),t.EFF(8,"Save"),t.k0s()(),t.j41(9,"div",5)(10,"div",6)(11,"div"),t.EFF(12,"Query Parameters"),t.k0s(),t.j41(13,"div")(14,"button",7),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.editPipeline())}),t.j41(15,"mat-icon"),t.EFF(16,"edit"),t.k0s()(),t.j41(17,"button",8),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.openParamsHelp())}),t.j41(18,"mat-icon"),t.EFF(19,"info"),t.k0s()()()(),t.nVh(20,Ke,3,0,"ul",9),t.k0s(),t.j41(21,"div",5)(22,"div",6),t.EFF(23,"Test Parameters"),t.k0s(),t.nVh(24,ze,3,0,"ul",9),t.k0s(),t.nVh(25,Ye,4,1,"div",5),t.nVh(26,qe,1,1),t.nVh(27,tn,5,1,"div",10),t.j41(28,"div",11)(29,"button",4),t.bIt("click",function(){l.eBV(e);const n=t.XpG();return l.Njj(n.openRestApi())}),t.j41(30,"span"),t.EFF(31,"Use in JSON / REST API"),t.k0s(),t.j41(32,"mat-icon"),t.EFF(33,"code_curly"),t.k0s()()()()()}if(2&o){let e,i;const n=t.XpG();t.R7$(20),t.vxM(null!=(e=n.vsSvc.pipelineModel().Pipeline.Params)&&e.length?20:-1),t.R7$(4),t.vxM(null!=(i=n.vsSvc.pipelineModel().Pipeline.TestParameters)&&i.length?24:-1),t.R7$(),t.vxM(n.visualDesignerDataSig()?25:-1),t.R7$(),t.vxM(n.warningSig()?26:-1),t.R7$(),t.vxM(n.vsSvc.pipelineModel().Pipeline.Description?27:-1)}}let nn=(()=>{class o{#t;constructor(e,i){this.context=e,this.vsSvc=i,this.warningSig=(0,l.vPA)(function Ne(o,a){if(!o)return[];const e=[];try{const i=o.Pipeline.Params?.split(/\r?\n/)||[],n=o.Pipeline.TestParameters?.split(/\r?\n/)||[];i.forEach(s=>{s=s?.trim(),s&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(s)||e.push(`\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        `))}),n.forEach(s=>{if(s=s?.trim(),!s)return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(s)||e.push(`\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        `);const F=/^\[module:id\]=([0-9]*)$/gim.exec(s);if(F){const x=F[1],N=a.moduleId?.toString();x!==N&&e.push(`\n            Your test ModuleId (${x}) is different from the current ModuleId (${N}).<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          `)}/^\[module:moduleid\]=([0-9]*)$/gim.exec(s)&&e.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")})}catch(i){console.error("Something went wrong in calculateWarnings for params",i)}return e}(this.vsSvc?.pipelineModel()??null,this.context)),this.visualDesignerDataSig=(0,l.vPA)(tt.i.tryParse(this.vsSvc?.pipelineModel()?.Pipeline.VisualDesignerData)??{}),this.#t=(0,W.d)(ut.c)}editPipeline(){this.vsSvc.editPipelineEntity()}openParamsHelp(){window.open("https://go.2sxc.org/QueryParams","_blank")}saveAndRunQuery(e,i){this.vsSvc.saveAndRun(e,i)}showDataSourceDetails(e){this.vsSvc.showDataSourceDetails(e.checked)}openRestApi(){const e=this.vsSvc.pipelineModel().Pipeline.EntityGuid;this.#t.navRelative([Xe.N5.getUrlQueryDialog(e)])}static#e=this.\u0275fac=function(i){return new(i||o)(t.rXU(g.o),t.rXU(z))};static#n=this.\u0275cmp=t.VBU({type:o,selectors:[["app-run-explorer"]],decls:1,vars:1,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],[1,"values"],[1,"description"],[1,"footer-actions"],[1,"eav-slide-toggle-label"],["color","primary",3,"change","checked"],[1,"warnings"],[2,"color","red"],[3,"innerHTML"]],template:function(i,n){1&i&&t.nVh(0,en,34,5,"div",0),2&i&&t.vxM(n.vsSvc.pipelineModel()?0:-1)},dependencies:[K.Hl,K.$z,q.M,d.m_,d.An,_.mV,_.sG],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}.eav-slide-toggle-label[_ngcontent-%COMP%]{margin-right:4px;font-size:14px}"]})}return o})();const yt=o=>({active:o});let on=(()=>{class o{constructor(e,i,n){this.context=e,this.route=i,this.visualQueryService=n,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(e){this.activeExplorer=this.activeExplorer===e?null:e}openHelp(){window.open("https://go.2sxc.org/visual-query","_blank")}static#t=this.\u0275fac=function(i){return new(i||o)(t.rXU(g.o),t.rXU(u.nX),t.rXU(z))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-visual-query"]],viewQuery:function(i,n){if(1&i&&t.GBs(vt,5),2&i){let s;t.mGM(s=t.lsd())&&(n.plumbEditor=s.first)}},features:[t.Jv_([z])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"click","ngClass"],["tippy","Add",1,"button",3,"click","ngClass"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(i,n){1&i&&(t.nrm(0,"router-outlet"),t.j41(1,"div",0)(2,"div",1)(3,"div",2),t.bIt("click",function(){return n.toggleExplorer(n.explorer.run)}),t.j41(4,"mat-icon"),t.EFF(5,"play_arrow"),t.k0s()(),t.j41(6,"div",3),t.bIt("click",function(){return n.toggleExplorer(n.explorer.add)}),t.j41(7,"mat-icon"),t.EFF(8,"add"),t.k0s()(),t.nrm(9,"div",4),t.j41(10,"div",5),t.bIt("click",function(){return n.openHelp()}),t.j41(11,"mat-icon"),t.EFF(12,"help_outline"),t.k0s()()(),t.nrm(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),t.k0s()),2&i&&(t.R7$(3),t.Y8G("ngClass",t.eq3(4,yt,n.activeExplorer===n.explorer.run)),t.R7$(3),t.Y8G("ngClass",t.eq3(6,yt,n.activeExplorer===n.explorer.add)),t.R7$(7),t.Y8G("hidden",n.activeExplorer!==n.explorer.run),t.R7$(),t.Y8G("hidden",n.activeExplorer!==n.explorer.add))},dependencies:[u.n3,m.YU,d.m_,d.An,nn,Kt,vt],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}return o})()},32549:(O,f,r)=>{r.d(f,{A:()=>u});const u=(0,r(69093).A)(Object.getPrototypeOf,Object)},32760:(O,f,r)=>{function m(u){return"Escape"===u.key}function d(u){return("s"===u.key||"S"===u.key)&&(u.ctrlKey||u.metaKey)}r.d(f,{J:()=>d,K:()=>m})},45839:(O,f,r)=>{r.d(f,{A:()=>d});const d=function m(u,g){for(var l=-1,h=null==u?0:u.length;++l<h&&!1!==g(u[l],l,u););return u}},49390:(O,f,r)=>{r.d(f,{F:()=>d});var m=r(17355);class d extends m.L{_origin="program";setFocusOrigin(g){return this._origin=g,this}setActiveItem(g){super.setActiveItem(g),this.activeItem&&this.activeItem.focus(this._origin)}}},49934:(O,f,r)=>{r.d(f,{A:()=>g});var m=r(23151),d=Object.create;const g=function(){function l(){}return function(h){if(!(0,m.A)(h))return{};if(d)return d(h);l.prototype=h;var _=new l;return l.prototype=void 0,_}}()},58624:(O,f,r)=>{r.d(f,{Q:()=>l,S:()=>h});var m=r(71772),d=r(24467),u=r(99293),g=r(44444);const l="admin/appParts/";let h=(()=>{class _ extends d.B{importAppParts(C){const S=new FormData;return S.append("File",C),this.http.post(this.apiUrl(l+"Import"),S,{params:{appId:this.appId,zoneId:this.zoneId}})}resetApp(C){return this.http.post(this.apiUrl(m.u+"Reset"),{},{params:{appId:this.appId,zoneId:this.zoneId,withPortalFiles:C.toString()}})}static#t=this.\u0275fac=(()=>{let C;return function(b){return(C||(C=u.xGo(_)))(b||_)}})();static#e=this.\u0275prov=g.jDH({token:_,factory:_.\u0275fac})}return _})()},70693:(O,f,r)=>{function m(u){return new Promise((g,l)=>{const h=new FileReader;h.readAsDataURL(u),h.onload=()=>{g(h.result.split(",")[1])},h.onerror=_=>{l(_)}})}function d(u){return new Promise((g,l)=>{const h=new FileReader;h.readAsText(u),h.onload=()=>{g(h.result)},h.onerror=_=>{l(_)}})}r.d(f,{d:()=>d,n:()=>m})},71475:(O,f,r)=>{r.d(f,{j:()=>_});var m=r(46443),d=r(24467),u=r(58624),g=r(99293),l=r(44444);let _=(()=>{class v extends d.B{getContentInfoLiveParam(S){return(0,m.fx)(()=>({url:this.apiUrl("admin/appParts/get"),params:{appid:this.appId,zoneId:this.zoneId,scope:S()}}))}exportParts(S,b,P){const E=this.apiUrl(u.Q+"Export")+"?appId="+this.appId+"&zoneId="+this.zoneId+"&contentTypeIdsString="+S.join(";")+"&entityIdsString="+b.join(";")+"&templateIdsString="+P.join(";");window.open(E,"_blank","")}static#t=this.\u0275fac=(()=>{let S;return function(P){return(S||(S=g.xGo(v)))(P||v)}})();static#e=this.\u0275prov=l.jDH({token:v,factory:v.\u0275fac})}return v})()},71772:(O,f,r)=>{r.d(f,{I:()=>v,u:()=>_});var m=r(36647),d=r(59452),u=r(13550),g=r(24467),l=r(99293),h=r(44444);const _="admin/app/";let v=(()=>{class C extends g.B{importApp(b,P,E=!1){const j=new FormData;return j.append("File",b),j.append("Name",P??""),this.http.post(this.apiUrl(_+"Import"),j,{params:{zoneId:this.zoneId}}).pipe((0,m.n)(y=>{if(E&&y.Messages[0]?.MessageType===u.G1.Warning){const I=prompt(y.Messages[0].Text+" Would you like to install it using another folder name?");if(I)return this.importApp(b,I,!0)}return(0,d.of)(y)}))}static#t=this.\u0275fac=(()=>{let b;return function(E){return(b||(b=l.xGo(C)))(E||C)}})();static#e=this.\u0275prov=h.jDH({token:C,factory:C.\u0275fac})}return C})()},74079:(O,f,r)=>{r.d(f,{Cu:()=>D,JL:()=>L,Mk:()=>y,ei:()=>I,vN:()=>$,xR:()=>B});var m=r(46443),d=r(14600),u=r(36647),g=r(70271),l=r(70693),h=r(34435),_=r(9234),v=r(96474),C=r(99293),S=r(44444);const b={all:!0,getAll:!1,getAllSig:!0,getAllLive:!1,getAllRes:!0,importQuery:!1,clonePipeline:!1,delete:!1,update:!1},y="admin/query/Run",I="admin/query/DebugStream",D="admin/query/Save",L="admin/query/Get",$="admin/query/DataSources";let B=(()=>{class U extends v.D{constructor(){super(...arguments),this.log=(0,h.Tq)({PipelinesService:U},b)}getAll(M){return this.log.fnIf("getAll").r(this.getHttpApiUrl(_.Gg,{params:{appId:this.appId,contentType:M}}))}getAllLive(M,k){return this.log.fnIf("getAllLive",{contentType:M,refresh:k}),(0,m.fx)(()=>(k(),{url:this.apiUrl(_.Gg),params:{appId:this.appId,contentType:M}}))}getAllRes(M,k){const A=this.log.fnIf("getAllRes"),H=(0,m.fx)(()=>({url:_.Gg,params:{appId:this.appId,contentType:M}}),{defaultValue:k});return A.r(H)}importQuery(M){const k=this.log.fnIf("importQuery"),A=(0,d.H)((0,l.n)(M)).pipe((0,u.n)(H=>this.http.post(this.apiUrl("admin/query/import"),{AppId:this.appId,ContentBase64:H})),(0,g.T)(H=>({Success:H,Messages:[]})));return k.r(A)}clonePipelinePromise(M){const k=this.log.fnIf("clonePipeline"),A=this.fetchPromise("admin/query/Clone",{params:{Id:M.toString(),appId:this.appId}});return k.r(A)}delete(M){const k=this.log.fnIf("delete"),A=this.http.delete(this.apiUrl("admin/query/Delete"),{params:{appId:this.appId,Id:M.toString()}});return k.r(A)}static#t=this.\u0275fac=(()=>{let M;return function(A){return(M||(M=C.xGo(U)))(A||U)}})();static#e=this.\u0275prov=S.jDH({token:U,factory:U.\u0275fac})}return U})()},75445:(O,f,r)=>{r.d(f,{Cu:()=>h.Cu,JL:()=>h.JL,Mk:()=>h.Mk,X6:()=>d.X,ei:()=>h.ei,gs:()=>d.g,tr:()=>m.t,vN:()=>h.vN,xR:()=>h.xR,y0:()=>_.y});var m=r(61479),d=r(17693),h=(r(71475),r(320),r(58624),r(74079)),_=r(2570)}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.00/dist/ng-edit/projects_eav-ui_src_app_visual-query_visual-query_component_ts-node_modules_angular_cdk_fesm2-48da62.ae91244276ec2ea7.js.map