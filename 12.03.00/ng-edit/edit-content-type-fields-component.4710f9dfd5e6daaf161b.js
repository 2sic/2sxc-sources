(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{XAsQ:function(e,t,n){"use strict";n.r(t),n.d(t,"EditContentTypeFieldsComponent",function(){return _});var i=n("mrSG"),a=n("3Pt+"),o=n("2Vo4"),r=n("quSY"),c=n("cp0P"),s=n("LRne"),l=n("w1tV"),p=n("5+tZ"),d=n("lJxs"),u=n("pLZG"),b=n("bOdf"),f=n("JIr8"),h=n("Kqap"),m=n("BFxc"),y=n("xbPD"),g=n("mCNh");function v(e,t,n){return 0===n?[t]:(e.push(t),e)}var T=/^[A-Za-z][A-Za-z0-9]+$/,M=n("bv8H"),O=n("3btq"),N=n("8gzK"),I={Boolean:{label:"Boolean (yes/no)",description:"Yes/no or true/false values"},Custom:{label:"Custom - ui-tools or custom types",description:"Use for things like gps-pickers (which writes into multiple fields) or for custom-data which serializes something exotic into the db like an array, a custom json or anything"},DateTime:{label:"Date and/or time",description:"For date, time or combined values"},Empty:{label:"Empty - for form-titles etc.",description:"Use to structure your form"},Entity:{label:"Entity (other content-items)",description:"One or more other content-items"},Hyperlink:{label:"Link / file reference",description:"Hyperlink or reference to a picture / file"},Number:{label:"Number",description:"Any kind of number"},String:{label:"Text / string",description:"Any kind of text"}},S=n("fXoL"),D=n("0IaG"),V=n("tyNb"),U=n("uwFg"),w=n("spPA"),F=n("dNgK"),j=n("ofXK"),C=n("bTqV"),x=n("kmnG"),k=n("qFsG"),$=function(){function e(){this.reservedNames={}}return e.prototype.validate=function(e){var t,n,a;try{for(var o=Object(i.i)(Object.entries(this.reservedNames)),r=o.next();!r.done;r=o.next()){var c=Object(i.g)(r.value,2),s=c[1];if(c[0].toLocaleLowerCase()===(null===(a=e.value)||void 0===a?void 0:a.toLocaleLowerCase()))return{reservedNames:s}}}catch(l){t={error:l}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return null},e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=S.Kb({type:e,selectors:[["","appReservedNames",""]],inputs:{reservedNames:["appReservedNames","reservedNames"]},features:[S.Cb([{provide:a.j,useExisting:e,multi:!0}])]}),e}(),K=n("d3UM"),P=n("NFeN"),E=n("PRNy"),L=n("FKr1"),H=["ngForm"];function R(e,t){1&e&&(S.Tb(0),S.Mc(1,"Fields"),S.Sb())}function A(e,t){1&e&&(S.Tb(0),S.Mc(1,"Add Fields"),S.Sb())}function B(e,t){1&e&&(S.Tb(0),S.Mc(1,"Edit Field"),S.Sb())}function q(e,t){if(1&e&&(S.Vb(0,"app-field-hint",20),S.Mc(1),S.Ub()),2&e){var n=S.hc(4);S.nc("isError",!0),S.Db(1),S.Nc(n.fieldNameError)}}function z(e,t){if(1&e&&(S.Vb(0,"app-field-hint",20),S.Mc(1),S.Ub()),2&e){S.hc(2);var n=S.yc(6);S.nc("isError",!0),S.Db(1),S.Oc(" ",n.errors.reservedNames," ")}}function G(e,t){if(1&e&&(S.Tb(0),S.Kc(1,q,2,2,"app-field-hint",19),S.Kc(2,z,2,2,"app-field-hint",19),S.Sb()),2&e){S.hc();var n=S.yc(6);S.Db(1),S.nc("ngIf",n.errors.pattern),S.Db(1),S.nc("ngIf",n.errors.reservedNames)}}function J(e,t){if(1&e&&(S.Vb(0,"mat-option",21),S.Vb(1,"mat-icon"),S.Mc(2),S.Ub(),S.Vb(3,"span"),S.Mc(4),S.Ub(),S.Ub()),2&e){var n=t.$implicit;S.nc("value",n.name),S.Db(2),S.Nc(n.icon),S.Db(2),S.Nc(n.label)}}function Y(e,t){if(1&e&&(S.Vb(0,"mat-option",21),S.Mc(1),S.Ub()),2&e){var n=t.$implicit;S.nc("value",n.inputType),S.Db(1),S.Oc(" ",n.label,"")}}function Z(e,t){if(1&e){var n=S.Wb();S.Vb(0,"div",11),S.Vb(1,"div",12),S.Vb(2,"mat-form-field",13),S.Vb(3,"mat-label"),S.Mc(4,"Name"),S.Ub(),S.Vb(5,"input",14,15),S.dc("ngModelChange",function(e){return t.$implicit.StaticName=e}),S.Ub(),S.Ub(),S.Kc(7,G,3,2,"ng-container",2),S.Ub(),S.Vb(8,"div",12),S.Vb(9,"mat-form-field",13),S.Vb(10,"mat-label"),S.Mc(11,"Data Type"),S.Ub(),S.Vb(12,"mat-select",16),S.dc("selectionChange",function(){S.Ac(n);var e=t.index,i=S.hc(2);return i.calculateInputTypeOptions(e),i.resetInputType(e),i.calculateHints(e)})("ngModelChange",function(e){return t.$implicit.Type=e}),S.Vb(13,"mat-select-trigger"),S.Vb(14,"mat-icon",17),S.Mc(15),S.Ub(),S.Vb(16,"span"),S.Mc(17),S.Ub(),S.Ub(),S.Kc(18,J,5,3,"mat-option",18),S.Ub(),S.Ub(),S.Vb(19,"app-field-hint"),S.Mc(20),S.Ub(),S.Ub(),S.Vb(21,"div",12),S.Vb(22,"mat-form-field",13),S.Vb(23,"mat-label"),S.Mc(24,"Input Type"),S.Ub(),S.Vb(25,"mat-select",16),S.dc("selectionChange",function(){S.Ac(n);var e=t.index;return S.hc(2).calculateHints(e)})("ngModelChange",function(e){return t.$implicit.InputType=e}),S.Kc(26,Y,2,2,"mat-option",18),S.Ub(),S.Ub(),S.Vb(27,"app-field-hint"),S.Mc(28),S.Ub(),S.Ub(),S.Ub()}if(2&e){var i=t.$implicit,a=t.index,o=S.yc(6),r=S.hc(2);S.Db(5),S.nc("pattern",r.fieldNamePattern)("appReservedNames",r.reservedNames)("ngModel",i.StaticName)("name","StaticName"+a)("disabled","inputType"===r.editMode),S.Db(2),S.nc("ngIf",o.touched&&o.errors),S.Db(5),S.nc("ngModel",i.Type)("name","Type"+a)("disabled",null!=r.editMode),S.Db(3),S.Nc(r.findIcon(i.Type)),S.Db(2),S.Nc(i.Type),S.Db(1),S.nc("ngForOf",r.dataTypes),S.Db(2),S.Nc(r.dataTypeHints[a]),S.Db(5),S.nc("ngModel",i.InputType)("name","InputType"+a)("disabled","name"===r.editMode),S.Db(1),S.nc("ngForOf",r.filteredInputTypeOptions[a]),S.Db(2),S.Nc(r.inputTypeHints[a])}}function X(e,t){if(1&e){var n=S.Wb();S.Vb(0,"form",4,5),S.dc("ngSubmit",function(){return S.Ac(n),S.hc().save()}),S.Vb(2,"div",6),S.Kc(3,Z,29,18,"div",7),S.Ub(),S.Vb(4,"div",8),S.Vb(5,"button",9),S.dc("click",function(){return S.Ac(n),S.hc().closeDialog()}),S.Mc(6,"Cancel"),S.Ub(),S.Vb(7,"button",10),S.ic(8,"async"),S.Mc(9," Save "),S.Ub(),S.Ub(),S.Ub()}if(2&e){var i=S.yc(1),a=S.hc();S.Db(3),S.nc("ngForOf",a.fields),S.Db(4),S.nc("disabled",!i.form.valid||S.jc(8,2,a.saving$))}}var _=function(){function e(e,t,n,i,a){var c=this;this.dialogRef=e,this.route=t,this.contentTypesService=n,this.contentTypesFieldsService=i,this.snackBar=a,this.hostClass="dialog-component",this.fields=[],this.filteredInputTypeOptions=[],this.dataTypeHints=[],this.inputTypeHints=[],this.fieldNamePattern=T,this.fieldNameError="Standard letters and numbers are allowed. Must start with a letter.",this.findIcon=N.a,this.loading$=new o.a(!0),this.saving$=new o.a(!1),this.subscription=new r.a,this.dialogRef.disableClose=!0,this.subscription.add(this.dialogRef.backdropClick().subscribe(function(e){c.form.dirty&&!confirm("You have unsaved changes. Are you sure you want to close this dialog?")||c.closeDialog()}))}return e.prototype.ngOnInit=function(){var e=this;this.editMode=this.route.snapshot.paramMap.get("editMode");var t=this.route.snapshot.paramMap.get("contentTypeStaticName"),n=this.contentTypesService.retrieveContentType(t).pipe(Object(l.a)()),a=n.pipe(Object(p.a)(function(t){return e.contentTypesFieldsService.getFields(t)})),o=this.contentTypesFieldsService.typeListRetrieve().pipe(Object(d.a)(function(e){return function(e){var t,n,a=[];try{for(var o=Object(i.i)(e),r=o.next();!r.done;r=o.next()){var c=r.value;a.push({name:c,label:I[c].label,icon:Object(N.a)(c),description:I[c].description})}}catch(s){t={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a}(e)})),r=this.contentTypesFieldsService.getInputTypesList(),s=this.contentTypesFieldsService.getReservedNames();Object(c.a)([n,a,o,r,s]).subscribe(function(t){var n=Object(i.g)(t,5),a=n[1],o=n[2],r=n[3],c=n[4];e.contentType=n[0],e.dataTypes=o,e.inputTypeOptions=r;var s={};if(a.forEach(function(e){s[e.StaticName]="Field with this name already exists"}),e.reservedNames=Object(i.a)(Object(i.a)({},c),s),null!=e.editMode){var l=e.route.snapshot.paramMap.get("id")?parseInt(e.route.snapshot.paramMap.get("id"),10):null,p=a.find(function(e){return e.Id===l});"name"===e.editMode&&delete e.reservedNames[p.StaticName],e.fields.push(p)}else for(var d=1;d<=8;d++)e.fields.push({Id:0,Type:M.a.String,InputType:O.a.StringDefault,StaticName:"",IsTitle:0===a.length,SortOrder:a.length+d});for(d=0;d<e.fields.length;d++)e.calculateInputTypeOptions(d),e.calculateHints(d);e.loading$.next(!1)})},e.prototype.ngOnDestroy=function(){this.loading$.complete(),this.saving$.complete(),this.subscription.unsubscribe()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.calculateInputTypeOptions=function(e){var t=this;this.filteredInputTypeOptions[e]=this.inputTypeOptions.filter(function(n){return n.dataType===t.fields[e].Type.toLocaleLowerCase()})},e.prototype.resetInputType=function(e){var t=this.fields[e].Type.toLocaleLowerCase()+O.a.DefaultSuffix;this.filteredInputTypeOptions[e].some(function(e){return e.inputType===t})||(t=this.filteredInputTypeOptions[e][0].inputType),this.fields[e].InputType=t},e.prototype.calculateHints=function(e){var t,n,i=this,a=this.dataTypes.find(function(t){return t.name===i.fields[e].Type}),o=this.inputTypeOptions.find(function(t){return t.inputType===i.fields[e].InputType});this.dataTypeHints[e]=null!==(t=null==a?void 0:a.description)&&void 0!==t?t:"",this.inputTypeHints[e]=null!==(n=null==o?void 0:o.description)&&void 0!==n?n:""},e.prototype.save=function(){var e=this;if(this.saving$.next(!0),this.snackBar.open("Saving..."),null!=this.editMode){var t=this.fields[0];"name"===this.editMode?this.contentTypesFieldsService.rename(t.Id,this.contentType.Id,t.StaticName).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()}):"inputType"===this.editMode&&this.contentTypesFieldsService.updateInputType(t.Id,t.StaticName,t.InputType).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})}else s.a.apply(void 0,Object(i.h)(this.fields)).pipe(Object(u.a)(function(e){return!!e.StaticName}),Object(b.a)(function(t){return e.contentTypesFieldsService.add(t,e.contentType.Id).pipe(Object(f.a)(function(e){return Object(s.a)(null)}))}),function(e,t){return arguments.length>=2?function(n){return Object(g.a)(Object(h.a)(e,t),Object(m.a)(1),Object(y.a)(t))(n)}:function(t){return Object(g.a)(Object(h.a)(function(t,n,i){return e(t,n,i+1)}),Object(m.a)(1))(t)}}(v,[])).subscribe(function(t){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})},e.\u0275fac=function(t){return new(t||e)(S.Pb(D.f),S.Pb(V.a),S.Pb(U.a),S.Pb(w.a),S.Pb(F.b))},e.\u0275cmp=S.Jb({type:e,selectors:[["app-edit-content-type-fields"]],viewQuery:function(e,t){var n;1&e&&S.Rc(H,1,a.o),2&e&&S.xc(n=S.ec())&&(t.form=n.first)},hostVars:1,hostBindings:function(e,t){2&e&&S.Yb("className",t.hostClass)},decls:7,vars:6,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["class","dialog-form",3,"ngSubmit",4,"ngIf"],[1,"dialog-form",3,"ngSubmit"],["ngForm","ngForm"],[1,"dialog-form-content","fancy-scrollbar-light"],["class","row-container",4,"ngFor","ngForOf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","submit","color","accent",3,"disabled"],[1,"row-container"],[1,"edit-input"],["appearance","standard","color","accent"],["matInput","",3,"pattern","appReservedNames","ngModel","name","disabled","ngModelChange"],["staticName","ngModel"],[3,"ngModel","name","disabled","selectionChange","ngModelChange"],[1,"type-icon"],[3,"value",4,"ngFor","ngForOf"],[3,"isError",4,"ngIf"],[3,"isError"],[3,"value"]],template:function(e,t){1&e&&(S.Vb(0,"div",0),S.Vb(1,"div",1),S.Kc(2,R,2,0,"ng-container",2),S.Kc(3,A,2,0,"ng-container",2),S.Kc(4,B,2,0,"ng-container",2),S.Ub(),S.Ub(),S.Kc(5,X,10,4,"form",3),S.ic(6,"async")),2&e&&(S.Db(2),S.nc("ngIf",void 0===t.editMode),S.Db(1),S.nc("ngIf",null===t.editMode),S.Db(1),S.nc("ngIf",null!=t.editMode),S.Db(1),S.nc("ngIf",!1===S.jc(6,4,t.loading$)))},directives:[D.g,j.n,a.v,a.n,a.o,j.m,C.a,x.c,x.g,k.b,a.c,a.r,$,a.m,a.p,K.a,K.c,P.a,E.a,L.k],pipes:[j.b],styles:[".row-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.edit-input[_ngcontent-%COMP%]{padding-bottom:8px;width:30%}.type-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;margin-right:8px;font-size:inherit;vertical-align:top;line-height:inherit}"]}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/12.03.00/ng-edit/edit-content-type-fields-component.4710f9dfd5e6daaf161b.js.map