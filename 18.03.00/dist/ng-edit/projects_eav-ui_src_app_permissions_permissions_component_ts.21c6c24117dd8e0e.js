"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_permissions_permissions_component_ts"],{3620:(M,g,t)=>{function s(c,r){return r(c)}function u(c,r){return r(c)}t.d(g,{C:()=>s,z:()=>u})},2458:(M,g,t)=>{t.r(g),t.d(g,{PermissionsComponent:()=>C});var s=t(9148),u=t(4175),c=t(7941),r=t(3840),d=t(2159),f=t(2938),i=t(3620),n=t(1828),l=t(251),o=t(52),p=t(3216),D=t(334),e=t(7037),a=t(8471),_=t(5060),m=t(4601);let P=(()=>{class O{agInit(h){this.params=h}refresh(h){return!0}deletePermission(){this.params.onDelete(this.params.data)}static{this.\u0275fac=function(v){return new(v||O)}}static{this.\u0275cmp=s.VBU({type:O,selectors:[["app-permissions-actions"]],standalone:!0,features:[s.aNF],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(v,E){1&v&&(s.j41(0,"div",0)(1,"div",1),s.bIt("click",function(){return E.deletePermission()}),s.j41(2,"mat-icon"),s.EFF(3,"delete"),s.k0s()()())},dependencies:[_.pZ,_.r6,r.m_,r.An,m.e],encapsulation:2})}}return O})();var T=t(4900),y=t(3347),I=t(9841);let C=(()=>{class O{#e;#s;#t;#a;constructor(h,v){this.dialog=h,this.snackBar=v,this.gridOptions=this.buildGridOptions(),this.permissions=(0,s.vPA)([]),this.#e=(0,f.d)(T.K),this.#s=(0,f.d)(a.c),this.#t=(0,i.C)(this.#s.getParams(["targetType","keyType","key"]),E=>({targetType:parseInt(E.targetType,10),keyType:E.keyType,key:E.key})),this.#a={[o.YX.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.#i(),this.#s.doOnDialogClosed(()=>this.#i())}closeDialog(){this.dialog.close()}#i(){this.#e.getAll(this.#t.targetType,this.#t.keyType,this.#t.key).subscribe(h=>{this.permissions.set(h)})}editPermission(h){let v;v=null==h?{items:[{...D.c.newMetadataFromInfo(o.YX.contentTypes.permissions,D.c.constructMetadataInfo(this.#t.targetType,this.#t.keyType,this.#t.key)),...this.#a[this.#t.targetType]&&{Prefill:this.#a[this.#t.targetType]}}]}:{items:[D.c.editId(h.Id)]};const E=(0,p.s)(v);this.#s.navRelative([`edit/${E}`])}deletePermission(h){confirm(`Delete '${h.Title}' (${h.Id})?`)&&(this.snackBar.open("Deleting..."),this.#e.delete(h.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#i()}))}buildGridOptions(){return{...l.C,columnDefs:[{...n.r.Id,cellRendererParams:n.r.idFieldParamsTooltipGetter()},{...n.r.TextWide,headerName:"Name",field:"Title",sort:"asc",onCellClicked:v=>{this.editPermission(v.data)}},{...n.r.TextWide,field:"Identity"},{...n.r.TextWide,field:"Condition"},{...n.r.Character,field:"Grant"},{...n.r.ActionsPinnedRight1,cellRenderer:P,cellRendererParams:{onDelete:E=>this.deletePermission(E)}}]}}static{this.\u0275fac=function(v){return new(v||O)(s.rXU(c.CP),s.rXU(y.UG))}}static{this.\u0275cmp=s.VBU({type:O,selectors:[["app-permissions"]],standalone:!0,features:[s.aNF],decls:15,vars:2,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(v,E){1&v&&(s.j41(0,"div",0)(1,"div",1)(2,"div",2),s.EFF(3,"Permissions"),s.k0s(),s.j41(4,"button",3),s.bIt("click",function(){return E.closeDialog()}),s.j41(5,"mat-icon"),s.EFF(6,"close"),s.k0s()()(),s.j41(7,"div",4),s.nrm(8,"router-outlet"),s.j41(9,"div",5),s.nrm(10,"ag-grid-angular",6),s.k0s(),s.j41(11,"mat-dialog-actions",7)(12,"button",8),s.bIt("click",function(){return E.editPermission(null)}),s.j41(13,"mat-icon"),s.EFF(14,"add"),s.k0s()()()()()),2&v&&(s.R7$(10),s.Y8G("rowData",E.permissions())("gridOptions",E.gridOptions))},dependencies:[u.Hl,u.iY,u.Sr,r.m_,r.An,d.n3,c.E7,e.p,I.xs],encapsulation:2})}}return O})()},401:(M,g,t)=>{t.d(g,{T:()=>r});var s=t(6474),u=t(9148);let r=(()=>{class d extends s.D{getMetadata(i,n,l,o){return this.getHttp("admin/metadata/get",{params:{appId:this.appId,targetType:i.toString(),keyType:n,key:l.toString(),...o&&{contentType:o}}})}static{this.\u0275fac=(()=>{let i;return function(l){return(i||(i=u.xGo(d)))(l||d)}})()}static{this.\u0275prov=u.jDH({token:d,factory:d.\u0275fac})}}return d})()},4900:(M,g,t)=>{t.d(g,{K:()=>i});var s=t(271),u=t(2938),c=t(52),r=t(6817),d=t(401),f=t(9148);let i=(()=>{class n{constructor(){this.metadataService=(0,u.d)(d.T),this.entitiesService=(0,u.d)(r.R)}getAll(o,p,D){return this.metadataService.getMetadata(o,p,D,c.YX.contentTypes.permissions).pipe((0,s.T)(e=>e.Items))}delete(o){return this.entitiesService.delete(c.YX.contentTypes.permissions,o,!1)}static{this.\u0275fac=function(p){return new(p||n)}}static{this.\u0275prov=f.jDH({token:n,factory:n.\u0275fac})}}return n})()},8471:(M,g,t)=>{t.d(g,{c:()=>o});var s=t(2159),u=t(1567),c=t(3037),r=t(271),d=t(5057),f=t(4435),i=t(4979),n=t(9148);const l={doOnDialogClosed:!0};let o=(()=>{class p extends i.V{constructor(e,a){super(),this.router=e,this.route=a,this.log=(0,f.T)({DialogRoutingService:p},l)}get snapshot(){return this.route.snapshot}get url(){return this.router.url}getParam(e){return this.route.snapshot.paramMap.get(e)}getParams(e){const a=this.route.snapshot.paramMap;return e.reduce((_,m)=>(_[m]=a.get(m),_),{})}getQueryParam(e){return this.route.snapshot.queryParamMap.get(e)}getQueryParams(e){const a=this.route.snapshot.queryParamMap;return e.reduce((_,m)=>(_[m]=a.get(m),_),{})}state(){return this.router.getCurrentNavigation().extras?.state}doOnDialogClosed(e){const a=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.childDialogClosed$().subscribe(()=>e())),a.end()}urlSubRoute(e){const a=this.router.createUrlTree([e],{relativeTo:this.route});return this.router.serializeUrl(a)}navPath(e,a){return this.router.navigate([e],a)}navRelative(e,a){return this.router.navigate(e,{...a,relativeTo:this.route})}navParentFirstChild(e,a){return this.router.navigate(e,{...a,relativeTo:this.route.parent.firstChild})}childDialogClosed$(){return this.router.events.pipe((0,u.p)(e=>e instanceof s.wF),(0,c.Z)(!!this.route.snapshot.firstChild),(0,r.T)(()=>!!this.route.snapshot.firstChild),(0,d.J)(),(0,u.p)(([e,a])=>e&&!a))}static{this.\u0275fac=function(a){return new(a||p)(n.KVO(s.Ix),n.KVO(s.nX))}}static{this.\u0275prov=n.jDH({token:p,factory:p.\u0275fac})}}return p})()},6817:(M,g,t)=>{t.d(g,{R:()=>r});var s=t(9234),u=t(6474),c=t(9148);let r=(()=>{class d extends u.D{create(i,n){return this.http.post(`app/auto/data/${i}`,n,{params:{appId:this.appId,zoneId:this.zoneId}})}update(i,n,l){return this.http.post(`app/auto/data/${i}/${n}`,l,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(i,n,l){return this.http.delete(this.apiUrl(s.gb+"delete"),{params:{contentType:i,id:n.toString(),appId:this.appId,force:l.toString()}})}static{this.\u0275fac=(()=>{let i;return function(l){return(i||(i=c.xGo(d)))(l||d)}})()}static{this.\u0275prov=c.jDH({token:d,factory:d.\u0275fac})}}return d})()},9234:(M,g,t)=>{t.d(g,{Gg:()=>D,Tr:()=>e,gb:()=>p});var s=t(1567),u=t(6647),c=t(6301),r=t(271),d=t(2938),f=t(4435),i=t(6474),n=t(4839),l=t(9148);const o={all:!1,getEntities:!1,getAvailableEntities:!1,delete:!1},p="admin/entity/",D="admin/entity/list";let e=(()=>{class a extends i.D{constructor(){super(...arguments),this.log=(0,f.T)({EntityService:a},o),this.queryService=(0,d.d)(n.c)}getEntities$(m){return this.log.fnIf("getEntities"),m.pipe((0,s.p)(P=>null!=P),(0,u.n)(P=>this.getAvailableEntities(P.contentTypeName).pipe((0,c.t)(1))))}getAvailableEntities(m,P){return this.log.fnIf("getAvailableEntities"),this.queryService.getEntities({contentTypes:[m],itemIds:P,fields:"Id,Guid,Title",log:"getAvailableEntities"}).pipe((0,r.T)(y=>y.Default))}delete(m,P,T,y,I,C){return this.log.fnIf("delete",{appId:m,contentType:P,entityId:T,force:y,parentId:I,parent}),this.http.delete(this.apiUrl(p+"delete"),{params:{contentType:P,id:T.toString(),appId:m,force:y.toString(),...I&&{parentId:I.toString()},...I&&C&&{parentField:C}}})}static{this.\u0275fac=(()=>{let m;return function(T){return(m||(m=l.xGo(a)))(T||a)}})()}static{this.\u0275prov=l.jDH({token:a,factory:a.\u0275fac})}}return a})()},4839:(M,g,t)=>{t.d(g,{c:()=>f});var s=t(4435),u=t(8873),c=t(9148),r=t(6443);const d={all:!1,getAvailableEntities:!1,getEntities:!1};let f=(()=>{class i{constructor(l,o){this.http=l,this.context=o,this.log=(0,s.T)({QueryService:i},d)}getFromQuery(l,o,p,D){this.log.fnIf("getAvailableEntities",{queryUrl:l,params:o,fields:p,entitiesFilter:D});const e=!!o,P=(((o?.toLocaleLowerCase()??"").includes("appid=")?"":`&appId=${this.context.appId}`)+(e?`&${o}`:"")+"&$select="+(p??"")).substring(1);return this.http.post(`app/auto/query/${l}?${P}`,{Guids:D})}getEntities({contentTypes:l,itemIds:o,fields:p,log:D}){this.log.fnIf("getEntities",{log:D,contentTypes:l,itemIds:o,fields:p});const a=("&typeNames="+(l?.join(",")??"")+`&appId=${this.context.appId}&itemIds=`+(o?.join(",")??"")+"&$select="+(p??"")).substring(1);return this.http.post(`app/auto/query/System.EntityPicker/Default?${a}`,{})}static{this.\u0275fac=function(o){return new(o||i)(c.KVO(r.Qq),c.KVO(u.o))}}static{this.\u0275prov=c.jDH({token:i,factory:i.\u0275fac})}}return i})()},4979:(M,g,t)=>{t.d(g,{V:()=>c});var s=t(7092),u=t(9148);let c=(()=>{class r{constructor(){this.subscriptions=new s.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275prov=u.jDH({token:r,factory:r.\u0275fac})}}return r})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.03.00/dist/ng-edit/projects_eav-ui_src_app_permissions_permissions_component_ts.21c6c24117dd8e0e.js.map