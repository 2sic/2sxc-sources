"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts"],{54029:(Y,N,a)=>{a.d(N,{g:()=>pt});var d=a(34456),$=a(81863),D=a(87945),A=a(84175),B=a(31403),U=a(31016),O=a(59791),T=a(41134),j=a(64043),R=a(75797),P=a(19999),C=a(63037),F=a(91817),M=a(70271),x=a(98764),G=a(18473),i=a(50819),s=a(91687),l=a(82645),m=a(74581);var b=a(36647),S=a(59452),z=a(61873),Z=a(12938),W=a(79996),H=a(13050),J=a(43176),Q=a(43758),_=a(37580),t=a(99293);let q=(()=>{class n{constructor(e,o){this.matInput=e,this.elementRef=o,this.autofocusSelectValue=(0,_.hFB)(!1)}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue())&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const o=e.toLocaleLowerCase();return"true"===o||"false"!==o&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(o){return new(o||n)(t.rXU(O.fg),t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:n,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:[1,"autofocusSelectValue"]}})}return n})();var V=a(44444),L=a(87698),tt=a(23731);const X=n=>({disabled:n});function et(n,f){if(1&n&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&n){const e=f.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function ot(n,f){if(1&n&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&n){const e=f.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function at(n,f){if(1&n&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&n){const e=f.$implicit;t.Y8G("value",e.Key),t.R7$(),t.SpI(" ",e.Name," ")}}function nt(n,f){1&n&&(t.j41(0,"app-field-hint",16),t.EFF(1," This field is required "),t.k0s()),2&n&&t.Y8G("isError",!0)}function it(n,f){1&n&&t.nrm(0,"mat-spinner",21)(1,"div",22)}function st(n,f){if(1&n&&(t.j41(0,"div",23)(1,"label",24),t.EFF(2,"Preview"),t.k0s()(),t.j41(3,"pre",25),t.EFF(4),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(3,X,e.loadingPreview)),t.R7$(2),t.Y8G("ngClass",t.eq3(5,X,e.loadingPreview)),t.R7$(),t.JRh(e.preview)}}function lt(n,f){if(1&n&&(t.j41(0,"div",20),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.previewError," ")}}function rt(n,f){if(1&n){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),t.EFF(4,"Create"),t.k0s(),t.j41(5,"span",3),t.EFF(6),t.k0s()()(),t.j41(7,"div",4)(8,"form",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"mat-form-field",9)(13,"mat-label"),t.EFF(14,"Platform"),t.k0s(),t.j41(15,"mat-select",10),t.Z7z(16,et,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),t.EFF(21,"Purpose"),t.k0s(),t.j41(22,"mat-select",12),t.Z7z(23,ot,2,2,"mat-option",11,t.fX1),t.k0s()()()(),t.j41(25,"div",13)(26,"mat-form-field",9)(27,"mat-label"),t.EFF(28,"Template"),t.k0s(),t.j41(29,"mat-select",14),t.Z7z(30,at,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(32,"div",13)(33,"mat-form-field",9)(34,"mat-label"),t.EFF(35,"Name"),t.k0s(),t.nrm(36,"input",15),t.k0s(),t.nVh(37,nt,2,1,"app-field-hint",16),t.k0s()(),t.j41(38,"div",17),t.nVh(39,it,2,0),t.j41(40,"button",18),t.bIt("click",function(){V.eBV(e);const h=t.XpG();return V.Njj(h.closeDialog())}),t.EFF(41,"Cancel"),t.k0s(),t.j41(42,"button",19),t.bIt("click",function(){V.eBV(e);const h=t.XpG();return V.Njj(h.confirm())}),t.EFF(43," Create "),t.k0s()(),t.nVh(44,st,5,7),t.nVh(45,lt,2,1,"div",20),t.k0s()()()}if(2&n){const e=f,o=t.XpG();t.R7$(6),t.JRh(o.controls.finalName.value||(o.controls.folder.value?o.controls.folder.value.trim()+"/":"")),t.R7$(2),t.Y8G("formGroup",o.form),t.R7$(8),t.Dyx(e.platforms),t.R7$(7),t.Dyx(e.purposes),t.R7$(7),t.Dyx(e.templates),t.R7$(7),t.vxM(o.controls.name.touched&&null!=o.controls.name.errors&&o.controls.name.errors.required?37:-1),t.R7$(2),t.vxM(e.loadingPreview?39:-1),t.R7$(3),t.Y8G("disabled",!o.form.valid||e.loadingPreview||!e.previewValid),t.R7$(2),t.vxM(e.preview?44:-1),t.R7$(),t.vxM(!e.loadingPreview&&e.previewError?45:-1)}}let pt=(()=>{class n extends J.${#t;#e;#o;#a;constructor(e,o){super(),this.dialogData=e,this.dialog=o,this.hostClass="dialog-component",this.#t="All",this.#a=(0,Z.d)(W.F)}ngOnInit(){this.#e=new R.t([]),this.#o=new R.t(!1),this.#i(),this.#n(),this.#s()}ngOnDestroy(){this.#e.complete(),this.#o.complete(),super.ngOnDestroy()}closeDialog(e){this.dialog.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}#n(){this.#a.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).then(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.#e.next(e.Templates)})}#i(){this.form=new d.J3({platform:new d.hs(this.#t),purpose:new d.hs({value:this.dialogData.purpose??this.#t,disabled:null!=this.dialogData.purpose}),templateKey:new d.hs(null,d.k0.required),name:new d.hs(this.dialogData.name??null,d.k0.required),finalName:new d.hs({value:null,disabled:!0}),folder:new d.hs({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscriptions.add((0,P.z)([this.#e,this.controls.templateKey.valueChanges.pipe((0,C.Z)(this.controls.templateKey.value),(0,F.F)())]).subscribe(([e,o])=>{const h=e.find(p=>p.Key===o),v=this.dialogData.name?this.controls.name.value||this.dialogData.name:h?.SuggestedFileName??null;this.controls.name.value!==v&&this.controls.name.patchValue(v)})),this.subscriptions.add((0,P.z)([this.#e,this.controls.templateKey.valueChanges.pipe((0,C.Z)(this.controls.templateKey.value),(0,F.F)()),this.controls.name.valueChanges.pipe((0,C.Z)(this.controls.name.value),(0,F.F)()),this.controls.folder.valueChanges.pipe((0,C.Z)(this.controls.folder.value),(0,F.F)())]).subscribe(([e,o,h,v])=>{const p=e.find(c=>c.Key===o);let r=null;h&&(v=v.trim(),h=H.SX.sanitizePath(h.trim()),r=`${v?`${v}/`:""}${h=`${p?.Prefix??""}${h}${p?.Suffix??""}${p?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==r&&this.controls.finalName.patchValue(r)}))}#s(){const e=this.#e.pipe((0,M.T)(p=>{const r={[this.#t]:this.#t};return p.forEach(c=>{c.Platforms?.forEach(g=>{r[g]=g})}),Object.keys(r)})),o=this.#e.pipe((0,M.T)(p=>{const r={[this.#t]:this.#t};return p.forEach(c=>{r[c.Purpose]=c.Purpose}),Object.keys(r)})),h=(0,P.z)([this.#e,this.controls.platform.valueChanges.pipe((0,C.Z)(this.controls.platform.value),(0,F.F)()),this.controls.purpose.valueChanges.pipe((0,C.Z)(this.controls.purpose.value),(0,F.F)())]).pipe((0,M.T)(([p,r,c])=>p.filter(y=>{const w=r===this.#t||(y.Platforms?.includes(r)??!1),K=c===this.#t||y.Purpose===c;return w&&K})),(0,x.M)(p=>{if(!p.some(r=>r.Key===this.controls.templateKey.value)){const r=p[0]?.Key??null;this.controls.templateKey.value!==r&&this.controls.templateKey.patchValue(r)}})),v=(0,P.z)([this.controls.finalName.valueChanges.pipe((0,C.Z)(this.controls.finalName.value),(0,F.F)()),this.controls.templateKey.valueChanges.pipe((0,C.Z)(this.controls.templateKey.value),(0,F.F)())]).pipe(function I(n,f=G.E,e){const o=(0,m.O)(n,f);return function u(n,f){return(0,i.N)((e,o)=>{const{leading:h=!0,trailing:v=!1}=f??{};let p=!1,r=null,c=null,g=!1;const y=()=>{c?.unsubscribe(),c=null,v&&(k(),g&&o.complete())},w=()=>{c=null,g&&o.complete()},K=E=>c=(0,l.Tg)(n(E)).subscribe((0,s._)(o,y,w)),k=()=>{if(p){p=!1;const E=r;r=null,o.next(E),!g&&K(E)}};e.subscribe((0,s._)(o,E=>{p=!0,r=E,(!c||c.closed)&&(h?k():K(E))},()=>{g=!0,(!(v&&p&&c)||c.closed)&&o.complete()}))})}(()=>o,e)}(100,G.E,{leading:!0,trailing:!0}),(0,x.M)(()=>{this.#o.next(!0)}),(0,b.n)(([p,r])=>p&&r?(0,z.p)([this.#a.getPreview(p,this.dialogData.global,r),(0,m.O)(500)]).pipe((0,M.T)(([c])=>c)):(0,S.of)(void 0)),(0,x.M)(()=>{this.#o.next(!1)}));this.viewModel$=(0,P.z)([e,o,h,v,this.#o]).pipe((0,M.T)(([p,r,c,g,y])=>({platforms:p,purposes:r,templates:c,loadingPreview:y,preview:g?.Preview,previewValid:g?.IsValid??!1,previewError:g?.Error})))}static#l=this.\u0275fac=function(o){return new(o||n)(t.rXU($.e),t.rXU($.k))};static#r=this.\u0275cmp=t.VBU({type:n,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(o,h){2&o&&t.Avn("className",h.hostClass)},features:[t.Vt3],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-mat-form-field"],["formControlName","platform"],[3,"value"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],[1,"eav-preview-error"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light","max-h",3,"ngClass"]],template:function(o,h){if(1&o&&(t.nVh(0,rt,46,7,"div",0),t.nI1(1,"async")),2&o){let v;t.vxM((v=t.bMT(1,1,h.viewModel$))?0:-1,v)}},dependencies:[d.YN,d.qT,d.me,d.BC,d.cb,d.YS,d.X1,d.j4,d.JD,U.M,L.j,L.M,j.M,j.g,tt.M,B.M,O.fS,O.fg,T.D6,T.LG,A.Hl,A.$z,D.YU,D.Jj,Q.F,q],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.max-h[_ngcontent-%COMP%]{max-height:55vh}"]})}return n})()},79996:(Y,N,a)=>{a.d(N,{F:()=>M});var d=a(46443),$=a(64173),D=a(70271),A=a(96474),B=a(99293),U=a(44444);const T="admin/AppFiles/asset",P="admin/ApiExplorer/AppApiFiles";let M=(()=>{class x extends A.D{get(i,s,l){return this.getHttpApiUrl(T,{params:{appId:this.appId,global:s,...this.templateIdOrPath(i,s,l)}}).pipe((0,D.T)(u=>{if("auto"===u.Type.toLocaleLowerCase())switch(u.Extension.toLocaleLowerCase()){case".cs":case".cshtml":u.Type="Razor";break;case".html":case".css":case".js":u.Type="Token"}return u}))}save(i,s,l,u){return this.http.post(this.apiUrl(T),l,{params:{appId:this.appId,global:s,...this.templateIdOrPath(i,s,u)}})}getAllPromise(i){return this.fetchPromise("admin/AppFiles/AppFiles",{params:{appId:this.appId,...i&&{mask:i}}}).then(({Files:s})=>(s.forEach(l=>{l.Shared??=!1}),s))}getWebApis(){return this.getHttpApiUrl(P,{params:{appId:this.appId}}).pipe((0,D.T)(({files:i})=>(i.forEach(s=>{s.isShared??=!1,s.isCompiled??=!1}),i))).pipe((0,D.T)(i=>i.map(l=>{const u=l.path.lastIndexOf("/"),m=l.path.lastIndexOf("."),I=l.path.substring(0,u),b=l.path.substring(u+1,m);return{path:l.path,folder:I,name:b,isShared:l.isShared,endpointPath:l.endpointPath,isCompiled:l.isCompiled,edition:l.edition}})))}getWebApisLive(i){const s=(0,d.fx)(()=>(i(),{url:this.apiUrl(P),params:{appId:this.appId}}));return(0,$.EW)(()=>{const u=s.value()?.files;return u?(u.forEach(m=>{m.isShared??=!1,m.isCompiled??=!1}),u.map(m=>{const I=m.path.lastIndexOf("/"),b=m.path.lastIndexOf("."),S=m.path.substring(0,I),z=m.path.substring(I+1,b);return{path:m.path,folder:S,name:z,isShared:m.isShared,endpointPath:m.endpointPath,isCompiled:m.isCompiled,edition:m.edition}})):[]})}getWebApiDetails(i){return this.getHttpApiUrl("admin/ApiExplorer/inspect",{params:{appId:this.appId,zoneId:this.zoneId,path:i}})}getPredefinedTemplates(i,s){return this.fetchPromise("admin/AppFiles/GetTemplates",{params:{...i&&{purpose:i},...s&&{type:s}}})}getPreview(i,s,l){return this.getHttpApiUrl("admin/AppFiles/preview",{params:{appId:this.appId,path:i,templateKey:l,global:s}})}create(i,s,l){return this.http.post(this.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.appId,global:s,purpose:"auto",path:i,templateKey:l}})}templateIdOrPath(i,s,l){if(/^[0-9]*$/g.test(i)){const u=l.find(m=>m.EntityId?.toString()===i&&m.IsShared===s)?.Path;return{templateId:i,...null!=u&&{path:u}}}return{path:i}}static#t=this.\u0275fac=(()=>{let i;return function(l){return(i||(i=B.xGo(x)))(l||x)}})();static#e=this.\u0275prov=U.jDH({token:x,factory:x.\u0275fac})}return x})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.02/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts.15b68e9e762c05a6.js.map