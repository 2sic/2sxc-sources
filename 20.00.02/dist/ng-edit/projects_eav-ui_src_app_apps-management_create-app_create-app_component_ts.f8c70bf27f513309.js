"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_apps-management_create-app_create-app_component_ts"],{12987:(x,E,e)=>{e.d(E,{n:()=>v});var h=e(70271),T=e(63037),s=e(84205),a=e(44444),p=e(47215);let v=(()=>{class C{constructor(u){this.http=u,this.installSettingsSubject=new s.B,this.settings$=this.installSettingsSubject.asObservable(),this.settings$.pipe((0,h.T)(()=>!0),(0,T.Z)(!1)).subscribe()}loadGettingStarted(u){this.http.get(`sys/install/InstallSettings?isContentApp=${u}`).subscribe(f=>this.installSettingsSubject.next(f))}static#t=this.\u0275fac=function(f){return new(f||C)(a.KVO(p.Qq))};static#e=this.\u0275prov=a.jDH({token:C,factory:C.\u0275fac})}return C})()},18537:(x,E,e)=>{e.d(E,{R:()=>f});var h=e(82645),T=e(43942),s=e(1365),a=e(88830),p=e(81530),v=e(38067);const C=["addListener","removeListener"],P=["addEventListener","removeEventListener"],u=["on","off"];function f(n,m,l,g){if((0,p.T)(l)&&(g=l,l=void 0),g)return f(n,m,l).pipe((0,v.I)(g));const[_,M]=function b(n){return(0,p.T)(n.addEventListener)&&(0,p.T)(n.removeEventListener)}(n)?P.map(t=>S=>n[t](m,S,l)):function U(n){return(0,p.T)(n.addListener)&&(0,p.T)(n.removeListener)}(n)?C.map(A(n,m)):function D(n){return(0,p.T)(n.on)&&(0,p.T)(n.off)}(n)?u.map(A(n,m)):[];if(!_&&(0,a.X)(n))return(0,s.Z)(t=>f(t,m,l))((0,h.Tg)(n));if(!_)throw new TypeError("Invalid event target");return new T.c(t=>{const S=(...F)=>t.next(1<F.length?F:F[0]);return _(S),()=>M(S)})}function A(n,m){return l=>g=>n[l](m,g)}},43758:(x,E,e)=>{e.d(E,{F:()=>b});var h=e(87945),T=e(37580),s=e(31016),a=e(99293),p=e(44444),v=e(87698);const C=["*"],P=n=>({"hint-box__short":n});function u(n,m){1&n&&a.eu8(0)}function f(n,m){if(1&n&&(a.j41(0,"mat-hint"),a.DNE(1,u,1,0,"ng-container",2),a.k0s()),2&n){a.XpG();const l=a.sdS(4);a.R7$(),a.Y8G("ngTemplateOutlet",l)}}function A(n,m){1&n&&a.eu8(0)}function U(n,m){if(1&n&&(a.j41(0,"mat-error"),a.DNE(1,A,1,0,"ng-container",2),a.k0s()),2&n){a.XpG();const l=a.sdS(4);a.R7$(),a.Y8G("ngTemplateOutlet",l)}}function D(n,m){1&n&&a.SdG(0)}let b=(()=>{class n{constructor(){this.isError=(0,T.hFB)(!1),this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(g){return new(g||n)};static#e=this.\u0275cmp=a.VBU({type:n,selectors:[["app-field-hint"]],inputs:{isError:[1,"isError"]},ngContentSelectors:C,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(g,_){if(1&g){const M=a.RV6();a.NAR(),a.j41(0,"div",1),a.bIt("click",function(){return p.eBV(M),p.Njj(_.toggleIsShort())}),a.nVh(1,f,2,1,"mat-hint")(2,U,2,1,"mat-error"),a.k0s(),a.DNE(3,D,1,0,"ng-template",null,0,a.C5r)}if(2&g){let M;a.Y8G("ngClass",a.eq3(2,P,_.isShort)),a.R7$(),a.vxM(!1===(M=_.isError())?1:!0===M?2:-1)}},dependencies:[s.M,v.c,v.b,h.YU,h.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return n})()},87001:(x,E,e)=>{e.r(E),e.d(E,{CreateAppComponent:()=>W});var h=e(44444),T=e(64173),s=e(34456),a=e(84175),p=e(31403),v=e(81863),C=e(31016),P=e(59791),u=e(53804),f=e(64043),A=e(29658),U=e(18537),D=e(51567),b=e(70271),n=e(12938),m=e(43758),l=e(12987);const g=/^[A-Za-z](?:[A-Za-z0-9\s\(\)-]+)*$/;var M=e(83583),t=e(99293),S=e(3347),F=e(80436),y=e(87698);const R=["installerWindow"];function B(i,I){1&i&&(t.j41(0,"app-field-hint",13),t.EFF(1," Required "),t.k0s()),2&i&&t.Y8G("isError",!0)}function L(i,I){if(1&i&&(t.j41(0,"app-field-hint",13),t.EFF(1),t.k0s()),2&i){const o=t.XpG(2);t.Y8G("isError",!0),t.R7$(),t.SpI(" ",o.appNameError," ")}}function j(i,I){if(1&i&&(t.nVh(0,B,2,1,"app-field-hint",13),t.nVh(1,L,2,2,"app-field-hint",13)),2&i){const o=t.XpG();t.vxM(null!=o.form.controls.name.errors&&o.form.controls.name.errors.required?0:-1),t.R7$(),t.vxM(null!=o.form.controls.name.errors&&o.form.controls.name.errors.pattern?1:-1)}}function G(i,I){if(1&i&&t.nrm(0,"iframe",14,0),2&i){const o=t.XpG(2);t.Y8G("src",o.remoteInstallerUrl,t.f$h)}}function $(i,I){if(1&i&&t.nVh(0,G,2,1,"iframe",14),2&i){const o=t.XpG();t.vxM(o.ready()?0:-1)}}let W=(()=>{class i{constructor(o,c,r){this.dialog=o,this.snackBar=c,this.sanitizer=r,this.hostClass="dialog-component",this.loading=(0,h.vPA)(!1),this.appNameError="Standard letters, numbers, spaces, hyphens and round brackets are allowed. Must start with a letter.",this.remoteInstallerUrl="",this.ready=(0,h.vPA)(!1),this.showAppCatalog=(0,h.vPA)(!0),this.alreadyProcessing=!1,this.appsListService=(0,n.d)(M.U),this.installSettingsService=(0,n.d)(l.n),this.packageUrl=(0,h.vPA)(null),this.canCreate=(0,h.vPA)(!1),this.messages$=(0,U.R)(window,"message").pipe((0,D.p)(()=>!this.alreadyProcessing),(0,D.p)(d=>"https://2sxc.org"===d.origin),(0,b.T)(d=>{const O=JSON.parse(d.data);this.packageUrl.set(O.packages?.[0]?.url||null)})),this.form=this.buildForm(),this.updateCanCreate(),this.form.valueChanges.subscribe(()=>this.updateCanCreate()),this.installSettingsService.loadGettingStarted(!1),this.installSettingsService.settings$.subscribe(d=>{let O=d.remoteUrl;O+=(O.includes("?")?"&":"?")+"isTemplate=true",this.remoteInstallerUrl=this.sanitizer.bypassSecurityTrustResourceUrl(O),this.ready.set(!0)}),(0,T.QZ)(()=>{this.packageUrl(),this.updateCanCreate()})}ngOnInit(){this.installSettingsService.loadGettingStarted(!1),this.messages$.subscribe()}create(){if(!this.canCreate())return;let o;this.form.disable(),this.loading.set(!0),this.snackBar.open("Creating app...",void 0,{duration:2e3});const c=Number(this.form.controls.appTemplateId.value),r=this.form.controls.name.value?.trim().replace(/\s\s+/g," ");o=1===c&&this.packageUrl()&&this.packageUrl().length>0?this.appsListService.createTemplate(this.packageUrl(),r):this.appsListService.create(r,null,0),o.subscribe({error:()=>this.handleCreateError(),next:()=>this.handleCreateSuccess()})}handleCreateError(){this.form.enable(),this.loading.set(!1),this.snackBar.open("Failed to create app. Please check console for more information",void 0,{duration:3e3})}handleCreateSuccess(){this.form.enable(),this.loading.set(!1),this.snackBar.open("Created app",void 0,{duration:2e3}),this.closeDialog()}closeDialog(){this.dialog.close()}buildForm(){return new s.J3({name:new s.hs(null,[s.k0.required,s.k0.pattern(g)]),appTemplateId:new s.hs(1,s.k0.required)})}updateCanCreate(){const o=this.form.controls.name.value?.trim(),c=Number(this.form.controls.appTemplateId.value),r=this.packageUrl();this.canCreate.set(!!o&&(0===c||1===c&&!!r))}onTemplateChange(o){this.showAppCatalog.set(1==o.value),this.updateCanCreate()}static#t=this.\u0275fac=function(c){return new(c||i)(t.rXU(v.k),t.rXU(S.UG),t.rXU(F.up))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-create-app"]],viewQuery:function(c,r){if(1&c&&t.GBs(R,5),2&c){let d;t.mGM(d=t.lsd())&&(r.installerWindow=d.first)}},hostVars:1,hostBindings:function(c,r){2&c&&t.Avn("className",r.hostClass)},decls:26,vars:7,consts:[["installerWindow",""],[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-content"],[3,"formGroup"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","formControlName","name"],["formControlName","appTemplateId","required","",3,"change"],[3,"value"],["align","end"],["type","button","mat-raised-button","",3,"click","disabled"],["type","button","mat-raised-button","","color","accent",3,"click","disabled"],[3,"isError"],[1,"eav-app-catalog-iframe",3,"src"]],template:function(c,r){1&c&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3),t.EFF(3,"Create App"),t.k0s()(),t.j41(4,"div",4),t.nrm(5,"router-outlet"),t.j41(6,"form",5)(7,"mat-form-field",6)(8,"mat-label"),t.EFF(9,"Name"),t.k0s(),t.nrm(10,"input",7),t.k0s(),t.j41(11,"app-field-hint"),t.EFF(12," App name will also be used for the folder "),t.k0s(),t.nVh(13,j,2,2),t.nrm(14,"br"),t.j41(15,"mat-radio-group",8),t.bIt("change",function(O){return r.onTemplateChange(O)}),t.j41(16,"mat-radio-button",9),t.EFF(17,"Complete Naked / Raw App"),t.k0s(),t.j41(18,"mat-radio-button",9),t.EFF(19,"Use Template"),t.k0s()()(),t.nVh(20,$,1,1),t.k0s(),t.j41(21,"mat-dialog-actions",10)(22,"button",11),t.bIt("click",function(){return r.closeDialog()}),t.EFF(23,"Cancel"),t.k0s(),t.j41(24,"button",12),t.bIt("click",function(){return r.create()}),t.EFF(25," Create "),t.k0s()()()),2&c&&(t.R7$(6),t.Y8G("formGroup",r.form),t.R7$(7),t.vxM(r.form.controls.name.touched?13:-1),t.R7$(3),t.Y8G("value",0),t.R7$(2),t.Y8G("value",1),t.R7$(2),t.vxM(r.showAppCatalog()?20:-1),t.R7$(2),t.Y8G("disabled",r.loading()),t.R7$(2),t.Y8G("disabled",r.loading()||!r.canCreate()))},dependencies:[A.n3,s.YN,s.qT,s.me,s.BC,s.cb,s.YS,s.X1,s.j4,s.JD,C.M,y.j,y.M,P.fS,P.fg,f.M,p.M,v.M,a.Hl,a.$z,m.F,u.Wk,u.VT,u._g],styles:[".eav-result-container[_ngcontent-%COMP%]{margin-top:16px}.eav-app-catalog-button[_ngcontent-%COMP%]{margin-left:12px}.eav-app-catalog-iframe[_ngcontent-%COMP%]{margin-top:16px;width:100%;height:500px;border:none}.eav-progress[_ngcontent-%COMP%]{position:absolute;left:0;top:0;height:100%;width:100%;background:#fffc;display:flex;justify-content:center;flex-direction:column;text-align:center}.eav-progress[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin:0 auto}.eav-progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:48px}"]})}return i})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.02/dist/ng-edit/projects_eav-ui_src_app_apps-management_create-app_create-app_component_ts.f8c70bf27f513309.js.map