{"version":3,"file":"projects_eav-ui_src_app_app-administration_recycle-bin_recycle-bin_ts.3dc7d14164ad546c.js","mappings":"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","names":["i0","ctx_r0","historyItem","SingleHistoryDialogComponent","constructor","this","inject","MAT_DIALOG_DATA","dialog","MatDialogRef","selectors","decls","vars","consts","template","rf","ctx","close","SingleHistoryDialogComponent_Conditional_3_Template","SingleHistoryDialogComponent_Conditional_4_Template","HistoryItemComponent","DialogHeaderComponent","styles","type_r2","name","title","AppRecycleBin","MatDialog","gridOptions","buildGridOptions","dataSourceData","computed","deletedEntities","map","entity","json","JSON","parse","realTitle","Entity","Attributes","String","Title","realContentType","Type","Name","contentType","#dataSvc","transient","SysDataService","#context","Context","#http","HttpClient","#refresh","signal","#defaultRangeEnd","dayjs","endOf","#defaultRangeStart","subtract","startOf","dateRangeStart","model","dateRangeEnd","selectedContentType","#data","getMany","source","refresh","streams","params","start","end","DateFrom","utc","toISOString","DateTo","ContentType","value","default","GoToRecycleBin","contentTypes","defaultGridOptions","columnDefs","ColumnDefinitions","TextWideMin100","headerName","field","flex","valueFormatter","format","ActionsPinnedRight4","cellRenderer","onCellClicked","event","colDef","onRowSelected","data","target","closest","restore","item","historyItems","getHistoryItems","ChangeSetId","HistoryId","Id","id","Json","TimeStamp","deleted","User","deletedBy","VersionNumber","Version","open","width","maxHeight","length","autoFocus","error","console","confirm","HttpParams","set","appId","toString","transactionId","post","responseType","subscribe","next","alert","update","v","message","inputs","outputs","$event","_r1","AppRecycleBin_For_24_Template","_forTrack0","featureId","dateRangePicker_r3","CommonModule","RouterOutlet","FormsModule","i1","MatButtonModule","MatCardModule","i2","MatDatepickerModule","i3","MatFormFieldModule","i4","MatIconModule","MatInputModule","MatSelectModule","i5","i6","MatExpansionModule","MatTooltipModule","MatDayjsModule","FeatureIconWithDialogComponent","FeatureInfoBoxComponent","SxcGridModule","i7","MatDialogModule"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/recycle-bin/single-history-dialog.html","./projects/eav-ui/src/app/app-administration/recycle-bin/single-history-dialog.ts","./projects/eav-ui/src/app/app-administration/recycle-bin/recycle-bin.html","./projects/eav-ui/src/app/app-administration/recycle-bin/recycle-bin.ts"],"sourcesContent":["<div class=\"eav-dialog\">\r\n  \r\n  <app-dialog-header \r\n    [title]=\"'History Item Details'\"\r\n    (close)=\"this.dialog.close()\"\r\n  />\r\n  <div class=\"eav-dialog-content\">\r\n    @if (historyItem) {\r\n      <app-history-item [historyItem]=\"historyItem\" [expanded]=\"true\" />\r\n    } @else {\r\n      <p>No history data available.</p>\r\n    }\r\n  </div> \r\n</div>\r\n","import { Component, inject } from '@angular/core';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\nimport { HistoryItemComponent } from '../../item-history/history-item';\r\nimport { HistoryItem } from '../../item-history/models/history-item.model';\r\nimport { DialogHeaderComponent } from \"../../shared/dialog-header/dialog-header\";\r\n\r\n@Component({\r\n  selector: 'app-single-history-dialog',\r\n  templateUrl: './single-history-dialog.html',\r\n  styleUrls: ['./single-history-dialog.scss'],\r\n  imports: [\r\n    HistoryItemComponent,\r\n    DialogHeaderComponent\r\n  ],\r\n})\r\nexport class SingleHistoryDialogComponent {\r\n  historyItem = inject(MAT_DIALOG_DATA) as HistoryItem | null;\r\n  \r\n  dialog = inject(MatDialogRef<{}>);\r\n}","<mat-card>\r\n  <mat-card-header>\r\n    <mat-card-title>\r\n      <span class=\"mat-headline\">Recycle Bin (Beta)</span>\r\n    </mat-card-title>\r\n  </mat-card-header>\r\n  <mat-card-content>\r\n    <p class=\"mat-body-1\">\r\n      Here you can see and restore deleted items within this app.\r\n    </p>\r\n    <p class=\"mat-caption\"><strong>Note:</strong> This feature is currently in beta and may not be fully stable. Use with caution.</p>\r\n\r\n    <app-feature-info-box [featureNameId]=\"GoToRecycleBin.featureId\"></app-feature-info-box>\r\n    \r\n    <h3 class=\"mat-subtitle-1\">\r\n      Deleted Items ({{ deletedEntities().length }} total)\r\n      <app-feature-icon-with-dialog [featureNameId]=\"'EntityUndelete'\"></app-feature-icon-with-dialog>\r\n    </h3>\r\n\r\n    <div class=\"recycle-bin-filters\">\r\n      <mat-form-field appearance=\"outline\" color=\"accent\" class=\"recycle-bin-filter\">\r\n        <mat-label>Filter by Content Type</mat-label>\r\n        <mat-select [(value)]=\"selectedContentType\">\r\n          <mat-option value=\"\">All Types</mat-option>\r\n          @for (type of contentTypes(); track type.name) {\r\n            <mat-option [value]=\"type.name\">{{ type.title }}</mat-option>\r\n          }\r\n        </mat-select>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field appearance=\"outline\" color=\"accent\" class=\"recycle-bin-filter\">\r\n        <mat-label>Date range</mat-label>\r\n        <mat-date-range-input [rangePicker]=\"dateRangePicker\">\r\n          <input matStartDate [(ngModel)]=\"dateRangeStart\" placeholder=\"Start date\" />\r\n          <input matEndDate [(ngModel)]=\"dateRangeEnd\" placeholder=\"End date\" />\r\n        </mat-date-range-input>\r\n        <mat-datepicker-toggle matSuffix [for]=\"dateRangePicker\"></mat-datepicker-toggle>\r\n        <mat-date-range-picker #dateRangePicker></mat-date-range-picker>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div>\r\n      <ag-grid-angular\r\n        class=\"ag-theme-material\"\r\n        style=\"width: 100%; min-height: 300px\"\r\n        [rowData]=\"dataSourceData()\"\r\n        [gridOptions]=\"gridOptions\"\r\n        domLayout=\"autoHeight\"\r\n      ></ag-grid-angular>\r\n    </div>\r\n  </mat-card-content>\r\n  <router-outlet></router-outlet>\r\n</mat-card>\r\n","import { GridOptions } from '@ag-grid-community/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Component, computed, inject, model, signal } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatDatepickerModule } from '@angular/material/datepicker';\r\nimport { MatDialog, MatDialogModule } from '@angular/material/dialog';\r\nimport { MatExpansionModule } from '@angular/material/expansion';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { RouterOutlet } from '@angular/router';\r\nimport dayjs, { Dayjs } from 'dayjs';\r\nimport { transient } from 'projects/core';\r\nimport { MatDayjsModule } from '../../edit/shared/date-adapters/date-adapter-api';\r\nimport { FeatureInfoBoxComponent } from '../../features/feature-info-box/feature-info-box';\r\nimport { FeatureIconWithDialogComponent } from '../../features/icons/feature-icon-with-dialog';\r\nimport { FeatureSummary } from '../../features/models';\r\nimport { getHistoryItems } from '../../item-history/item-history.helpers';\r\nimport { ColumnDefinitions } from '../../shared/ag-grid/column-definitions';\r\nimport { defaultGridOptions } from '../../shared/constants/default-grid-options.constants';\r\nimport { SxcGridModule } from '../../shared/modules/sxc-grid-module/sxc-grid.module';\r\nimport { Context } from '../../shared/services/context';\r\nimport { SysDataService } from '../../shared/services/sys-data.service';\r\nimport { GoToRecycleBin } from './go-to-recycle-bin';\r\nimport { SingleHistoryDialogComponent } from './single-history-dialog';\r\n\r\nconst RECYCLE_BIN_DATASOURCE_ID = 'f890bec1-dee8-4ed6-9f2e-8ad412d2f4dc';\r\nconst RECYCLE_BIN_RESTORE_URL = 'admin/data/recycle';\r\n\r\n@Component({\r\n  selector: 'recycle-bin',\r\n  templateUrl: './recycle-bin.html',\r\n  styleUrls: ['./recycle-bin.scss'],\r\n  imports: [\r\n    CommonModule,\r\n    RouterOutlet,\r\n    FormsModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatDatepickerModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatExpansionModule,\r\n    MatTooltipModule,\r\n    MatDayjsModule,\r\n    FeatureIconWithDialogComponent,\r\n    FeatureInfoBoxComponent,\r\n    SxcGridModule,\r\n    MatDialogModule,\r\n  ]\r\n})\r\nexport class AppRecycleBin {\r\n  private dialog = inject(MatDialog);\r\n\r\n  gridOptions: GridOptions = this.buildGridOptions();\r\n\r\n  dataSourceData = computed(() =>\r\n    this.deletedEntities().map((entity: any) => {\r\n      if (entity.json) {\r\n        try {\r\n          const json = JSON.parse(entity.json);\r\n          return {\r\n            ...entity,\r\n            realTitle: json?.Entity?.Attributes?.String?.Title?.['*'] || entity.title,\r\n            realContentType: json?.Entity?.Type?.Name || entity.contentType,\r\n          };\r\n        } catch {\r\n          return;\r\n        }\r\n      }\r\n      return {\r\n        ...entity,\r\n        realTitle: entity.title,\r\n        realContentType: entity.contentType,\r\n      };\r\n    })\r\n  );\r\n\r\n  private buildGridOptions(): GridOptions {\r\n    return {\r\n      ...defaultGridOptions,\r\n      columnDefs: [\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Title',\r\n          field: 'realTitle',\r\n          flex: 2,\r\n        },\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Content Type',\r\n          field: 'realContentType',\r\n        },\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Deleted By',\r\n          field: 'deletedBy',\r\n        },\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Date',\r\n          field: 'deleted',\r\n          valueFormatter: (params: any) => params.value ? dayjs(params.value).format('YYYY-MM-DD HH:mm') : '',\r\n        },\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Item ID',\r\n          field: 'id',\r\n        },\r\n        {\r\n          ...ColumnDefinitions.ActionsPinnedRight4,\r\n          headerName: 'Actions',\r\n          cellRenderer: (params: any) => {\r\n            return `\r\n                  <div class=\"eav-grid-action-button highlight\" data-action=\"restore\" matRipple tippy=\"Restore\" style=\"display: inline-flex; align-items: center; gap: 6px; padding: 0 28px;\">\r\n                    <span class=\"material-symbols-outlined\">autorenew</span>\r\n                    <span>Restore</span>\r\n                  </div>\r\n                `;\r\n          },\r\n        },\r\n      ],\r\n      onCellClicked: (event: any) => {\r\n        if (event.colDef.headerName === 'Actions') {\r\n          if ((event.event.target as HTMLElement).closest('[data-action=\"restore\"]')) {\r\n            this.restore(event.data);\r\n          }\r\n          return; // prevent row click\r\n        }\r\n        this.onRowSelected(event.data);\r\n      },\r\n    };\r\n  }\r\n\r\n  onRowSelected(item: DeletedEntity) {\r\n    try {\r\n      // Parse the deleted entity as a version\r\n      const entity = JSON.parse(item.json).Entity;\r\n      // Build a Version object\r\n      const version = {\r\n        ChangeSetId: 0,\r\n        HistoryId: entity?.Id ?? item.id,\r\n        Json: item.json,\r\n        TimeStamp: item.deleted,\r\n        User: item.deletedBy,\r\n        VersionNumber: entity?.Version ?? 1\r\n      };\r\n      // Use getHistoryItems to process the data\r\n      // We use a single version, so pass [version] and itself as versions\r\n      const historyItems = getHistoryItems([version], 1, 1, 'live');\r\n      this.dialog.open(SingleHistoryDialogComponent, {\r\n        width: '900px',\r\n        maxHeight: '80vh',\r\n        data: historyItems && historyItems.length > 0 ? historyItems[0] : null,  \r\n        autoFocus: false,\r\n      });\r\n    } catch (error) {\r\n      console.error('Invalid deleted entity JSON', error);\r\n    }\r\n  }\r\n\r\n  #dataSvc = transient(SysDataService);\r\n  #context = inject(Context);\r\n  #http = inject(HttpClient);\r\n\r\n  #refresh = signal(0);\r\n\r\n  #defaultRangeEnd = dayjs().endOf('day');\r\n  #defaultRangeStart = dayjs().subtract(6, 'day').startOf('day');\r\n\r\n  dateRangeStart = model<Dayjs | null>(this.#defaultRangeStart);\r\n  dateRangeEnd = model<Dayjs | null>(this.#defaultRangeEnd);\r\n\r\n  selectedContentType = model('');\r\n\r\n  #data = this.#dataSvc.getMany<{ default: DeletedEntity[], feature: FeatureSummary[], contentTypes: ContentTypeInfo[] }>({\r\n    source: RECYCLE_BIN_DATASOURCE_ID,\r\n    refresh: this.#refresh,\r\n    streams: 'Default,Feature,ContentTypes',\r\n    params: computed(() => {\r\n      const start = this.dateRangeStart();\r\n      const end = this.dateRangeEnd();\r\n      return {\r\n        ...(start ? { DateFrom: start.startOf('day').utc().toISOString() } : {}),\r\n        ...(end ? { DateTo: end.endOf('day').utc().toISOString() } : {}),\r\n        ...(this.selectedContentType() ? { ContentType: this.selectedContentType() } : {}),\r\n      };\r\n    }),\r\n  });\r\n\r\n  deletedEntities = computed(() => this.#data.value()?.default ?? []);\r\n\r\n  GoToRecycleBin = GoToRecycleBin;\r\n\r\n  contentTypes = computed(() => this.#data.value()?.contentTypes ?? []);\r\n\r\n  restore(item: DeletedEntity): void {\r\n    if (!confirm(`Are you sure you want to restore \"${item.title || '(no title)'}\"?`))\r\n      return;\r\n\r\n\r\n    const params = new HttpParams()\r\n      .set('appid', this.#context.appId.toString())\r\n      .set('transactionid', item.transactionId.toString());\r\n\r\n    this.#http.post(RECYCLE_BIN_RESTORE_URL, {},\r\n      {\r\n        params,\r\n        responseType: 'text'\r\n      }).subscribe({\r\n        next: () => {\r\n          alert('Data restored successfully');\r\n          this.#refresh.update(v => v + 1);\r\n        },\r\n        error: (error) => {\r\n          console.error('Error restoring data:', error);\r\n          alert(`Error restoring data: ${error.message || 'Unknown error'}`);\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\ntype DeletedEntity = {\r\n  parentRef: string;\r\n  appId: number;\r\n  guid: string | null;\r\n  id: number;\r\n  transactionId: number;\r\n  contentType: string;\r\n  deletedBy: string;\r\n  title: string | null;\r\n  deleted: string;\r\n  json: string;\r\n};\r\n\r\ntype ContentTypeInfo = {\r\n  name: string;\r\n  staticName: string;\r\n  count: number;\r\n  title: string;\r\n};"],"x_google_ignoreList":[]}