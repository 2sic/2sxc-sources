"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_app-administration_recycle-bin_recycle-bin_ts"],{86227(ee,M,n){n.d(M,{AppRecycleBin:()=>_});var E=n(79748),R=n(50698),s=n(56884),m=n(36664),y=n(37580),h=n(34456),S=n(84175),g=n(53777),l=n(61977),u=n(87941),x=n(90353),D=n(24950),O=n(93840),b=n(59791),C=n(25175),N=n(80640),I=n(69393),j=n(49645),f=n.n(j),F=n(12938),B=n(30709),P=n(66184),H=n(97930),A=n(76857),c=n(11828),G=n(60251),Y=n(67037),W=n(68873),V=n(14513),$=n(52694),k=n(45444),U=n(73834),e=n(36124);function X(i,p){if(1&i&&e.nrm(0,"app-history-item",3),2&i){const t=e.XpG();e.Y8G("historyItem",t.historyItem)("expanded",!0)}}function J(i,p){1&i&&(e.j41(0,"p"),e.EFF(1,"No history data available."),e.k0s())}let Q=(()=>{class i{constructor(){this.historyItem=(0,s.WQX)(u.Vh),this.dialog=(0,s.WQX)(u.CP)}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-single-history-dialog"]],decls:5,vars:2,consts:[[1,"eav-dialog"],[3,"close","title"],[1,"eav-dialog-content"],[3,"historyItem","expanded"]],template:function(o,a){1&o&&(e.j41(0,"div",0)(1,"app-dialog-header",1),e.bIt("close",function(){return a.dialog.close()}),e.k0s(),e.j41(2,"div",2),e.nVh(3,X,1,2,"app-history-item",3)(4,J,2,0,"p"),e.k0s()()),2&o&&(e.R7$(),e.Y8G("title","History Item Details"),e.R7$(2),e.vxM(a.historyItem?3:4))},dependencies:[k.J,U.B],styles:[".eav-dialog-content[_ngcontent-%COMP%]{padding-bottom:16px!important}"]})}}return i})();var v=n(80423),L=n(96462),z=n(58857);const Z=(i,p)=>p.name;function w(i,p){if(1&i&&(e.j41(0,"mat-option",10),e.EFF(1),e.k0s()),2&i){const t=p.$implicit;e.Y8G("value",t.name),e.R7$(),e.JRh(t.title)}}let _=(()=>{class i{constructor(){this.dialog=(0,s.WQX)(u.bZ),this.gridOptions=this.buildGridOptions(),this.dataSourceData=(0,m.EW)(()=>this.deletedEntities().map(t=>{if(t.json)try{const o=JSON.parse(t.json);return{...t,realTitle:o?.Entity?.Attributes?.String?.Title?.["*"]||t.title,realContentType:o?.Entity?.Type?.Name||t.contentType}}catch{return}return{...t,realTitle:t.title,realContentType:t.contentType}})),this.#n=(0,F.d)(V.t),this.#a=(0,s.WQX)(W.o),this.#o=(0,s.WQX)(R.Qq),this.#e=(0,s.vPA)(0),this.#i=f()().endOf("day"),this.#s=f()().subtract(6,"day").startOf("day"),this.dateRangeStart=(0,y.geq)(this.#s),this.dateRangeEnd=(0,y.geq)(this.#i),this.selectedContentType=(0,y.geq)(""),this.#t=this.#n.getMany({source:"f890bec1-dee8-4ed6-9f2e-8ad412d2f4dc",refresh:this.#e,streams:"Default,Feature,ContentTypes",params:(0,m.EW)(()=>{const t=this.dateRangeStart(),o=this.dateRangeEnd();return{...t?{DateFrom:t.startOf("day").utc().toISOString()}:{},...o?{DateTo:o.endOf("day").utc().toISOString()}:{},...this.selectedContentType()?{ContentType:this.selectedContentType()}:{}}})}),this.deletedEntities=(0,m.EW)(()=>this.#t.value()?.default??[]),this.GoToRecycleBin=$.U,this.contentTypes=(0,m.EW)(()=>this.#t.value()?.contentTypes??[])}buildGridOptions(){return{...G.C,columnDefs:[{...c.r.TextWideMin100,headerName:"Title",field:"realTitle",flex:2},{...c.r.TextWideMin100,headerName:"Content Type",field:"realContentType"},{...c.r.TextWideMin100,headerName:"Deleted By",field:"deletedBy"},{...c.r.TextWideMin100,headerName:"Date",field:"deleted",valueFormatter:t=>t.value?f()(t.value).format("YYYY-MM-DD HH:mm"):""},{...c.r.TextWideMin100,headerName:"Item ID",field:"id"},{...c.r.ActionsPinnedRight4,headerName:"Actions",cellRenderer:t=>'\n                  <div class="eav-grid-action-button highlight" data-action="restore" matRipple tippy="Restore" style="display: inline-flex; align-items: center; gap: 6px; padding: 0 28px;">\n                    <span class="material-symbols-outlined">autorenew</span>\n                    <span>Restore</span>\n                  </div>\n                '}],onCellClicked:t=>{"Actions"!==t.colDef.headerName?this.onRowSelected(t.data):t.event.target.closest('[data-action="restore"]')&&this.restore(t.data)}}}onRowSelected(t){try{const o=JSON.parse(t.json).Entity,r=(0,A.z)([{ChangeSetId:0,HistoryId:o?.Id??t.id,Json:t.json,TimeStamp:t.deleted,User:t.deletedBy,VersionNumber:o?.Version??1}],1,1,"live");this.dialog.open(Q,{width:"900px",maxHeight:"80vh",data:r&&r.length>0?r[0]:null,autoFocus:!1})}catch(o){console.error("Invalid deleted entity JSON",o)}}#n;#a;#o;#e;#i;#s;#t;restore(t){if(!confirm(`Are you sure you want to restore "${t.title||"(no title)"}"?`))return;const o=(new R.Nl).set("appid",this.#a.appId.toString()).set("transactionid",t.transactionId.toString());this.#o.post("admin/data/recycle",{},{params:o,responseType:"text"}).subscribe({next:()=>{alert("Data restored successfully"),this.#e.update(a=>a+1)},error:a=>{console.error("Error restoring data:",a),alert(`Error restoring data: ${a.message||"Unknown error"}`)}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["recycle-bin"]],inputs:{dateRangeStart:[1,"dateRangeStart"],dateRangeEnd:[1,"dateRangeEnd"],selectedContentType:[1,"selectedContentType"]},outputs:{dateRangeStart:"dateRangeStartChange",dateRangeEnd:"dateRangeEndChange",selectedContentType:"selectedContentTypeChange"},decls:37,vars:10,consts:[["dateRangePicker",""],[1,"mat-headline"],[1,"mat-body-1"],[1,"mat-caption"],[3,"featureNameId"],[1,"mat-subtitle-1"],[1,"recycle-bin-filters"],["appearance","outline","color","accent",1,"recycle-bin-filter"],[3,"valueChange","value"],["value",""],[3,"value"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModelChange","ngModel"],["matEndDate","","placeholder","End date",3,"ngModelChange","ngModel"],["matSuffix","",3,"for"],["domLayout","autoHeight",1,"ag-theme-material",2,"width","100%","min-height","300px",3,"rowData","gridOptions"]],template:function(o,a){if(1&o){const r=e.RV6();e.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title")(3,"span",1),e.EFF(4,"Recycle Bin (Beta)"),e.k0s()()(),e.j41(5,"mat-card-content")(6,"p",2),e.EFF(7," Here you can see and restore deleted items within this app. "),e.k0s(),e.j41(8,"p",3)(9,"strong"),e.EFF(10,"Note:"),e.k0s(),e.EFF(11," This feature is currently in beta and may not be fully stable. Use with caution."),e.k0s(),e.nrm(12,"app-feature-info-box",4),e.j41(13,"h3",5),e.EFF(14),e.nrm(15,"app-feature-icon-with-dialog",4),e.k0s(),e.j41(16,"div",6)(17,"mat-form-field",7)(18,"mat-label"),e.EFF(19,"Filter by Content Type"),e.k0s(),e.j41(20,"mat-select",8),e.mxI("valueChange",function(d){return s.eBV(r),e.DH7(a.selectedContentType,d)||(a.selectedContentType=d),s.Njj(d)}),e.j41(21,"mat-option",9),e.EFF(22,"All Types"),e.k0s(),e.Z7z(23,w,2,2,"mat-option",10,Z),e.k0s()(),e.j41(25,"mat-form-field",7)(26,"mat-label"),e.EFF(27,"Date range"),e.k0s(),e.j41(28,"mat-date-range-input",11)(29,"input",12),e.mxI("ngModelChange",function(d){return s.eBV(r),e.DH7(a.dateRangeStart,d)||(a.dateRangeStart=d),s.Njj(d)}),e.k0s(),e.j41(30,"input",13),e.mxI("ngModelChange",function(d){return s.eBV(r),e.DH7(a.dateRangeEnd,d)||(a.dateRangeEnd=d),s.Njj(d)}),e.k0s()(),e.nrm(31,"mat-datepicker-toggle",14)(32,"mat-date-range-picker",null,0),e.k0s()(),e.j41(34,"div"),e.nrm(35,"ag-grid-angular",15),e.k0s()(),e.nrm(36,"router-outlet"),e.k0s()}if(2&o){const r=e.sdS(33);e.R7$(12),e.Y8G("featureNameId",a.GoToRecycleBin.featureId),e.R7$(2),e.SpI(" Deleted Items (",a.deletedEntities().length," total) "),e.R7$(),e.Y8G("featureNameId","EntityUndelete"),e.R7$(5),e.R50("value",a.selectedContentType),e.R7$(3),e.Dyx(a.contentTypes()),e.R7$(5),e.Y8G("rangePicker",r),e.R7$(),e.R50("ngModel",a.dateRangeStart),e.R7$(),e.R50("ngModel",a.dateRangeEnd),e.R7$(),e.Y8G("for",r),e.R7$(4),e.Y8G("rowData",a.dataSourceData())("gridOptions",a.gridOptions)}},dependencies:[E.MD,I.n3,h.YN,h.me,h.BC,h.vS,S.Hl,g.Hu,g.RN,g.m2,g.MM,g.dh,l.X6,l.bU,l.el,l.xR,l.IG,l.SG,D.RG,v.rl,v.nJ,v.yw,O.m_,b.fS,C.Ve,C.VO,L.wT,x.MY,N.uc,B.uf,H.X,P.b,Y.p,z.xs,u.hM],styles:["[_nghost-%COMP%]     .ag-row-hover .ag-cell a, [_nghost-%COMP%]     .ag-row-hover .ag-cell .eav-grid-action-button, .eav-button__with-icon[_ngcontent-%COMP%]{color:#85283b!important}.eav-button__with-icon[_ngcontent-%COMP%]:disabled{color:#00000061!important}[_nghost-%COMP%]     .ag-row-hover .ag-cell, [_nghost-%COMP%]     .eav-grid-action-button:hover{color:#85283b!important;cursor:pointer;transition:color .2s}.recycle-bin-filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;flex-wrap:wrap;margin-bottom:8px}.recycle-bin-filter[_ngcontent-%COMP%]{min-width:240px;max-width:320px}.recycle-bin-list[_ngcontent-%COMP%]{display:block;padding:4px 0}.recycle-bin-details[_ngcontent-%COMP%]{display:block;padding:16px 0;font-size:14px}.recycle-bin-detail-row[_ngcontent-%COMP%]{display:flex;padding-bottom:8px;gap:16px}.recycle-bin-detail-row[_ngcontent-%COMP%]:last-child{padding-bottom:0}.recycle-bin-detail-label[_ngcontent-%COMP%]{flex:0 0 auto;width:120px;font-weight:500}.recycle-bin-detail-value[_ngcontent-%COMP%]{flex:1 1 auto;word-break:break-word}.recycle-bin-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"]})}}return i})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.03.00/dist/ng-edit/projects_eav-ui_src_app_app-administration_recycle-bin_recycle-bin_ts.3dc7d14164ad546c.js.map