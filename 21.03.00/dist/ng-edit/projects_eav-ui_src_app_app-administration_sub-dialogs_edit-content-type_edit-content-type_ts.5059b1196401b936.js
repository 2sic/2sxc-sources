"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_app-administration_sub-dialogs_edit-content-type_edit-content-type_ts"],{89167(Q,h,o){o.r(h),o.d(h,{EditContentTypeComponent:()=>H});var c=o(56884),S=o(36664),l=o(34456),E=o(84175),b=o(20762),u=o(87941),d=o(90353),F=o(24950),v=o(93840),f=o(59791),g=o(25175),N=o(12938),k=o(32760),j=o(11855),C=o(5858),M=o(50052),x=o(39333),I=o(34601),G=o(34435),R=o(63628),p=o(67993);const y=/(^[A-Za-z][A-Za-z0-9]*$)|(^@[A-Za-z][A-Za-z0-9\-]*$)/.toString(),V=y.substring(1,y.toString().length-1);var O=o(17693),t=o(36124),X=o(69393),$=o(3347),m=o(80423),Y=o(96462),B=o(55326);const D=["ngForm"];function P(a,r){1&a&&(t.j41(0,"app-field-hint",19),t.EFF(1,"This field is required"),t.k0s()),2&a&&t.Y8G("isError",!0)}function U(a,r){if(1&a&&(t.j41(0,"app-field-hint",19),t.EFF(1),t.k0s()),2&a){const n=t.XpG(3);t.Y8G("isError",!0),t.R7$(),t.JRh(n.contentTypeNameError)}}function _(a,r){if(1&a&&(t.nVh(0,P,2,1,"app-field-hint",19),t.nVh(1,U,2,2,"app-field-hint",19)),2&a){t.XpG();const n=t.sdS(9);t.vxM(n.errors.required?0:-1),t.R7$(),t.vxM(n.errors.pattern?1:-1)}}function K(a,r){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const n=r.$implicit;t.Y8G("value",n.value),t.R7$(),t.SpI(" ",n.name," ")}}function Z(a,r){if(1&a&&(t.j41(0,"div",8)(1,"h3"),t.EFF(2,"Shared Content Type (Ghost)"),t.k0s(),t.j41(3,"p"),t.EFF(4,"Note: this can't be edited in the UI, for now if you really know what you're doing, do it in the DB"),t.k0s(),t.j41(5,"p"),t.EFF(6),t.k0s()()),2&a){const n=t.XpG(2);t.R7$(6),t.SpI("Uses Type Definition of: ",n.contentType().SharedDefId)}}function z(a,r){if(1&a){const n=t.RV6();t.j41(0,"form",6,0),t.bIt("ngSubmit",function(){c.eBV(n);const i=t.XpG();return c.Njj(i.saveAndClose())}),t.j41(2,"div",7)(3,"div")(4,"div",8)(5,"mat-form-field",9)(6,"mat-label"),t.EFF(7,"Name"),t.k0s(),t.j41(8,"input",10,1),t.bIt("ngModelChange",function(i){c.eBV(n);const s=t.XpG();return c.Njj(s.changeContentTypeName(i))}),t.k0s()(),t.nVh(10,_,2,2),t.k0s(),t.j41(11,"mat-accordion")(12,"mat-expansion-panel")(13,"mat-expansion-panel-header")(14,"mat-panel-title"),t.EFF(15,"Advanced"),t.k0s(),t.nrm(16,"mat-panel-description"),t.k0s(),t.j41(17,"div",8)(18,"div",11)(19,"mat-form-field",9)(20,"mat-label"),t.EFF(21,"Scope"),t.k0s(),t.j41(22,"mat-select",12),t.bIt("ngModelChange",function(i){c.eBV(n);const s=t.XpG();return c.Njj(s.changeScope(i))}),t.Z7z(23,K,2,2,"mat-option",13,t.fX1),t.j41(25,"mat-option",13),t.EFF(26,"Other..."),t.k0s()()(),t.j41(27,"button",14),t.bIt("click",function(){c.eBV(n);const i=t.XpG();return c.Njj(i.unlockScope())}),t.j41(28,"mat-icon"),t.EFF(29),t.k0s()()(),t.j41(30,"app-field-hint"),t.EFF(31," The scope should almost never be changed - "),t.j41(32,"a",15),t.EFF(33,"see help"),t.k0s()()(),t.j41(34,"div",8)(35,"mat-form-field",9)(36,"mat-label"),t.EFF(37,"Static Name"),t.k0s(),t.nrm(38,"input",16),t.k0s()(),t.nVh(39,Z,7,1,"div",8),t.k0s()()()(),t.j41(40,"mat-dialog-actions",17)(41,"app-save-close-button-fab",18),t.bIt("action",function(){c.eBV(n);const i=t.XpG();return c.Njj(i.saveAndClose())}),t.k0s()()()}if(2&a){const n=t.sdS(9),e=t.XpG();t.R7$(8),t.Y8G("pattern",e.contentTypeNamePattern)("ngModel",e.contentType().Name),t.R7$(2),t.vxM(n.touched&&n.errors?10:-1),t.R7$(),t.Y8G("@.disabled",e.disableAnimation()),t.R7$(11),t.Y8G("ngModel",e.contentType().Scope)("disabled",e.lockScope()),t.R7$(),t.Dyx(e.scopeOptions()),t.R7$(2),t.Y8G("value",e.dropdownInsertValue),t.R7$(2),t.Y8G("tippy",e.lockScope()?"Unlock":"Lock"),t.R7$(2),t.SpI(" ",e.lockScope()?"lock":"lock_open"," "),t.R7$(9),t.Y8G("ngModel",e.contentType().NameId),t.R7$(),t.vxM(e.contentType().SharedDefId?39:-1),t.R7$(2),t.Y8G("triggerOnFormSubmit",!0)("ngClass",e.canSave()?"":"disabled")("disabled",!e.canSave())}}let H=(()=>{class a{#n;#t;#e;constructor(n,e,i){this.dialog=n,this.route=e,this.snackBar=i,this.log=(0,G.Tq)({EditContentTypeComponent:a}),this.hostClass="dialog-component",this.#n=(0,N.d)(O.g),this.#t=this.route.snapshot.parent.paramMap.get("scope"),this.#e=this.route.snapshot.paramMap.get("contentTypeStaticName"),this.contentTypeNamePattern=V,this.contentTypeNameError="Standard letters and numbers are allowed. Must start with a letter.",this.dropdownInsertValue=C.O,this.modeIsEdit=!!this.#e,this.lockScope=(0,p.KX)("lockScope",!0),this.disableAnimation=(0,p.KX)("disableAnimation",!0),this.loading=(0,p.KX)("loading",!1),this.formValid=(0,c.vPA)(!1),this.canSave=(0,S.EW)(()=>this.formValid()&&!this.loading()),this.contentType=(0,p.KX)("contentType",{StaticName:"",Name:"",Description:"",Scope:this.#t,ChangeNameId:!1,NewNameId:""}),this.#i=this.#n.getScopesSig(),this.#o=(0,p.KX)("scopeOptionsManual",[]),this.scopeOptions=(0,p.bo)("scopeOptions",()=>{const s=this.#i(),T=this.#o();return s?T.concat(this.#s(s)):T}),this.log.a("constructor"),this.#a()}ngOnInit(){this.#c()}#a(){this.modeIsEdit&&this.#n.retrieveContentType(this.#e).subscribe(n=>{this.contentType.set({...n,ChangeNameId:!1,NewNameId:n.NameId})})}#i;#o;#s(n){const e=[];return n.forEach(i=>{e.some(s=>s.value===i.value)||e.push(i)}),e.some(i=>i.value===this.#t)||e.push({name:this.#t,value:this.#t}),e}ngAfterViewInit(){this.ngForm?.form.statusChanges.subscribe(()=>{this.formValid.set(this.ngForm?.form.valid??!1)}),setTimeout(()=>this.disableAnimation.set(!1))}closeDialog(){this.dialog.close()}changeContentTypeName(n){this.contentType.set({...this.contentType(),Name:n})}changeScope(n){n===C.O&&(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||M.YX.scopes.default.value,this.scopeOptions().some(e=>e.value===n)||this.#o.set([{name:n,value:n},...this.scopeOptions()])),this.contentType.set({...this.contentType(),Scope:n})}unlockScope(){this.lockScope.set(!this.lockScope()),this.lockScope()&&this.contentType.set({...this.contentType(),Scope:this.#t})}saveAndClose(){this.loading.set(!0),this.snackBar.open("Saving..."),this.#n.save(this.contentType()).subscribe(n=>{this.loading.set(!1),this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()}),document.activeElement instanceof HTMLElement&&document.activeElement.blur()}#c(){this.dialog.keydownEvents().subscribe(n=>{(0,k.YU)(n)&&this.canSave()&&(n.preventDefault(),this.saveAndClose())})}static{this.\u0275fac=function(e){return new(e||a)(t.rXU(u.CP),t.rXU(X.nX),t.rXU($.UG))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-edit-content-type"]],viewQuery:function(e,i){if(1&e&&t.GBs(D,5),2&e){let s;t.mGM(s=t.lsd())&&(i.ngForm=s.first)}},hostVars:1,hostBindings:function(e,i){2&e&&t.Avn("className",i.hostClass)},decls:8,vars:2,consts:[["ngForm","ngForm"],["name","ngModel"],[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[3,"ngSubmit"],[1,"eav-dialog-content"],[1,"eav-edit-input"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","required","","name","Name",3,"ngModelChange","pattern","ngModel"],[1,"eav-form-and-button"],["name","Scope",3,"ngModelChange","ngModel","disabled"],[3,"value"],["mat-icon-button","","type","button","matTextSuffix","",1,"eav-scope-button",3,"click","tippy"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["matInput","","type","text","name","StaticName","disabled","",3,"ngModel"],["align","end"],[3,"action","triggerOnFormSubmit","ngClass","disabled"],[3,"isError"]],template:function(e,i){1&e&&(t.j41(0,"div",2)(1,"div",3)(2,"div",4),t.EFF(3),t.k0s(),t.j41(4,"button",5),t.bIt("click",function(){return i.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.nVh(7,z,42,14,"form"),t.k0s()),2&e&&(t.R7$(3),t.SpI(" ",i.modeIsEdit?"Edit Content Type":"New Content Type"," "),t.R7$(4),t.vxM(i.contentType()?7:-1))},dependencies:[l.YN,l.qT,l.me,l.BC,l.cb,l.YS,l.R_,l.vS,l.cV,F.RG,m.rl,m.nJ,m.yw,f.fS,f.fg,d.MY,d.BS,d.GK,d.Z2,d.WN,d.Q6,g.Ve,g.VO,Y.wT,b.S,E.Hl,B.iY,v.m_,v.An,u.E7,j.F,x.c,I.e,R.i],styles:[".eav-edit-input[_ngcontent-%COMP%]{padding-bottom:8px}.eav-form-and-button[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between}.eav-form-and-button[_ngcontent-%COMP%]   .eav-scope-button[_ngcontent-%COMP%]{margin-left:8px}"]})}}return a})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.03.00/dist/ng-edit/projects_eav-ui_src_app_app-administration_sub-dialogs_edit-content-type_edit-content-type_ts.5059b1196401b936.js.map