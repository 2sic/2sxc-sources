{"version":3,"file":"inpage.min.js","mappings":"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","sources":["webpack:///webpack/runtime/create fake namespace object","webpack:///./node_modules/cross-fetch/dist/browser-ponyfill.js","webpack:///./node_modules/loc-i18next/dist/commonjs/main.js","webpack:///./node_modules/loc-i18next/index.js","webpack:///./node_modules/shake.js/shake.js","webpack:///./src/dnn/dnn-08.00.04.ts","webpack:///./node_modules/i18next-http-backend/esm/getFetch.cjs","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getWindow.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/instanceOf.js","webpack:///./node_modules/@popperjs/core/lib/utils/math.js","webpack:///./node_modules/@popperjs/core/lib/utils/userAgent.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/isLayoutViewport.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getBoundingClientRect.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getWindowScroll.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getNodeName.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getDocumentElement.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getWindowScrollBarX.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getComputedStyle.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/isScrollParent.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getCompositeRect.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getNodeScroll.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getHTMLElementScroll.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getLayoutRect.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getParentNode.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getScrollParent.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/listScrollParents.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/isTableElement.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getOffsetParent.js","webpack:///./node_modules/@popperjs/core/lib/enums.js","webpack:///./node_modules/@popperjs/core/lib/utils/orderModifiers.js","webpack:///./node_modules/@popperjs/core/lib/createPopper.js","webpack:///./node_modules/@popperjs/core/lib/utils/debounce.js","webpack:///./node_modules/@popperjs/core/lib/utils/mergeByName.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/eventListeners.js","webpack:///./node_modules/@popperjs/core/lib/utils/getBasePlacement.js","webpack:///./node_modules/@popperjs/core/lib/utils/getVariation.js","webpack:///./node_modules/@popperjs/core/lib/utils/getMainAxisFromPlacement.js","webpack:///./node_modules/@popperjs/core/lib/utils/computeOffsets.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/computeStyles.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/applyStyles.js","webpack:///./node_modules/@popperjs/core/lib/utils/getOppositePlacement.js","webpack:///./node_modules/@popperjs/core/lib/utils/getOppositeVariationPlacement.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/contains.js","webpack:///./node_modules/@popperjs/core/lib/utils/rectToClientRect.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getClippingRect.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getViewportRect.js","webpack:///./node_modules/@popperjs/core/lib/dom-utils/getDocumentRect.js","webpack:///./node_modules/@popperjs/core/lib/utils/mergePaddingObject.js","webpack:///./node_modules/@popperjs/core/lib/utils/getFreshSideObject.js","webpack:///./node_modules/@popperjs/core/lib/utils/expandToHashMap.js","webpack:///./node_modules/@popperjs/core/lib/utils/detectOverflow.js","webpack:///./node_modules/@popperjs/core/lib/utils/within.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/hide.js","webpack:///./node_modules/@popperjs/core/lib/popper.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/popperOffsets.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/offset.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/flip.js","webpack:///./node_modules/@popperjs/core/lib/utils/computeAutoPlacement.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/preventOverflow.js","webpack:///./node_modules/@popperjs/core/lib/utils/getAltAxis.js","webpack:///./node_modules/@popperjs/core/lib/modifiers/arrow.js","webpack:///./node_modules/tippy.js/dist/tippy.esm.js","webpack:///../core/constants/index.ts","webpack:///../core/logging/log-entry-options.ts","webpack:///../core/logging/has-log.ts","webpack:///./src/constants/debug.ts","webpack:///../core/logging/Log.ts","webpack:///../core/logging/log-call.ts","webpack:///../core/plumbing/obj.ts","webpack:///../core/logging/entry.ts","webpack:///../core/logging/insights.ts","webpack:///../core/plumbing/url.ts","webpack:///../core/plumbing/assets-loader.ts","webpack:///../core/plumbing/no-jquery.ts","webpack:///../$2sxc/src/constants/index.ts","webpack:///../$2sxc/src/environment/env-loader-dnn-sf.ts","webpack:///../$2sxc/src/environment/env-loader-dynamic.ts","webpack:///../$2sxc/src/environment/env-loader-meta.ts","webpack:///../$2sxc/src/environment/sxc-global-environment.ts","webpack:///../$2sxc/src/sxc/web-api/ajax-promise.ts","webpack:///../$2sxc/src/sxc/web-api/encrypted-data.ts","webpack:///../$2sxc/src/sxc/web-api/secure-endpoint.ts","webpack:///../$2sxc/src/sxc/web-api/sxc-web-api.ts","webpack:///../$2sxc/src/data/target-types.ts","webpack:///../$2sxc/src/sxc/sxc-part.ts","webpack:///../$2sxc/src/sxc/data/sxc-data-service-base.ts","webpack:///../$2sxc/src/sxc/data/sxc-data.ts","webpack:///../$2sxc/src/sxc/data/sxc-query.ts","webpack:///../$2sxc/src/sxc/sxc-cms.ts","webpack:///../$2sxc/src/sxc-global/sxc-global-http.ts","webpack:///../$2sxc/src/dom/dom-tools.ts","webpack:///../$2sxc/src/sxc/sxc.ts","webpack:///./src/sxc/sxc-tools.ts","webpack:///./src/constants/dialog-paths.ts","webpack:///./src/constants/ids.ts","webpack:///./src/constants/index.ts","webpack:///./src/constants/content-block.ts","webpack:///./src/constants/toolbar.ts","webpack:///./src/context/parts/context-instance.ts","webpack:///./src/context/parts/context-page.ts","webpack:///./src/context/parts/context-system.ts","webpack:///./src/context/parts/context-tenant.ts","webpack:///./src/context/html-attribute/parts/content-block.ts","webpack:///./src/context/parts/context-user.ts","webpack:///./src/context/html-attribute/parts/user.ts","webpack:///./src/context/parts/context-app.ts","webpack:///./src/context/parts/context-ui.ts","webpack:///./src/context/bundles/context-bundle-instance.ts","webpack:///./src/context/parts/context-content-block.ts","webpack:///./src/context/parts/context-item.ts","webpack:///./src/context/bundles/context-bundle-content.ts","webpack:///./src/context/bundles/context-bundle-toolbar.ts","webpack:///./src/context/bundles/context-bundle-button.ts","webpack:///./src/commands/command.ts","webpack:///./src/commands/commands.ts","webpack:///./src/commands/command/shared-logic.ts","webpack:///./src/html/dom-tools.ts","webpack:///./src/quick-edit/selection.ts","webpack:///./src/quick-edit/modifier-base.ts","webpack:///./src/quick-edit/quick-e-overlays.ts","webpack:///./src/quick-edit/quick-e-configuration.ts","webpack:///./src/quick-edit/context-for-lists.ts","webpack:///./src/toolbar/config/toolbar-settings.ts","webpack:///./src/workflow/workflow-helper.ts","webpack:///./src/workflow/toolbar-workflow-manager.ts","webpack:///./src/workflow/workflow-step-code-arguments.ts","webpack:///./src/workflow/workflow-phases.ts","webpack:///./src/workflow/workflow-step-helper.ts","webpack:///./src/toolbar/toolbar-lifecycle.ts","webpack:///./src/toolbar/tag-toolbars/tag-toolbar.ts","webpack:///./src/toolbar/tag-toolbars/tag-toolbar-manager.ts","webpack:///./src/commands/cmd-par-hlp.ts","webpack:///./src/toolbar/config/button-command.ts","webpack:///./src/toolbar/config/button.ts","webpack:///./src/toolbar/config/button-safe.ts","webpack:///./src/toolbar/config/toolbar.ts","webpack:///./src/toolbar/render/render-part-base.ts","webpack:///./src/toolbar/render/render-button.ts","webpack:///./src/toolbar/render/render-groups.ts","webpack:///./src/toolbar/render/toolbar-renderer.ts","webpack:///./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack:///./node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack:///./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack:///./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","webpack:///./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack:///./node_modules/@babel/runtime/helpers/esm/inherits.js","webpack:///./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","webpack:///./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack:///./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack:///./node_modules/i18next/dist/esm/i18next.js","webpack:///./node_modules/@babel/runtime/helpers/esm/toArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack:///./node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack:///./node_modules/i18next-http-backend/esm/utils.js","webpack:///./node_modules/i18next-http-backend/esm/request.js","webpack:///./node_modules/i18next-http-backend/esm/index.js","webpack:///./src/i18n/2sxc.translate.ts","webpack:///./src/i18n/translator.ts","webpack:///./src/i18n/index.ts","webpack:///./src/toolbar/initialize/toolbar-finder-and-initializer.ts","webpack:///./src/toolbar/templates/toolbar-when-no-toolbar-provided.ts","webpack:///./src/toolbar/initialize/toolbar-init-config.ts","webpack:///./src/toolbar/config-loaders/config-formats/in-page-button.ts","webpack:///./src/toolbar/config-loaders/config-formats/in-page-command.ts","webpack:///./src/toolbar/config-loaders/button-config-loader.ts","webpack:///./src/toolbar/config-loaders/command-config-loader.ts","webpack:///./src/toolbar/templates/constants.ts","webpack:///./src/toolbar/config-loaders/group-config-loader.ts","webpack:///./src/toolbar/rules/rule-constants.ts","webpack:///./src/toolbar/rules/rule-operators.ts","webpack:///./src/toolbar/rules/build-steps.ts","webpack:///./src/toolbar/rules/rule-params-helper.ts","webpack:///./src/constants/rules.ts","webpack:///./src/toolbar/templates/template-empty.ts","webpack:///./src/toolbar/templates/template-default.ts","webpack:///./src/toolbar/templates/template-sublist.ts","webpack:///./src/toolbar/templates/toolbar-template-manager.ts","webpack:///./src/toolbar/templates/toolbar-template.ts","webpack:///./src/toolbar/templates/toolbar-template-group.ts","webpack:///./src/toolbar/templates/template-editor.ts","webpack:///./src/toolbar/rules/rule.ts","webpack:///./src/toolbar/config/Note.ts","webpack:///./src/commands/command/command-insights.ts","webpack:///./src/toolbar/rules/rules-obsolete-code.ts","webpack:///./src/toolbar/rules/rule-manager.ts","webpack:///./src/toolbar/config-loaders/toolbar-config-loader-v09.ts","webpack:///./src/toolbar/config-loaders/toolbar-config-loader-v10.ts","webpack:///./src/toolbar/config-loaders/toolbar-config-loader.ts","webpack:///./src/toolbar/toolbar-manager.ts","webpack:///./src/quick-edit/modifier-content-block-internal.ts","webpack:///./src/quick-edit/modifier-content-block.ts","webpack:///./src/quick-edit/position-coordinates.ts","webpack:///./src/quick-edit/modifier-dnn-module.ts","webpack:///./src/quick-edit/modifier-dnn-module-internal.ts","webpack:///./src/quick-edit/positioning.ts","webpack:///./src/quick-edit/quick-e-clipboard.ts","webpack:///./src/quick-edit/selectors-instance.ts","webpack:///./src/quick-edit/quick-e.ts","webpack:///./src/quick-edit/index.ts","webpack:///./src/contentBlock/content-block-editor.ts","webpack:///./src/contentBlock/render.ts","webpack:///./src/commands/command/content-list-actions.ts","webpack:///./src/commands/command/command-add.ts","webpack:///./src/commands/command/command-add-existing.ts","webpack:///./src/commands/command/command-app.ts","webpack:///./src/commands/command/command-app-import.ts","webpack:///./src/commands/command/command-app-resources.ts","webpack:///./src/commands/command/command-app-settings.ts","webpack:///./src/commands/command/command-apps.ts","webpack:///./src/commands/command/command-content-type.ts","webpack:///./src/commands/command/command-data.ts","webpack:///./src/commands/command/command-copy.ts","webpack:///./src/commands/command/command-code.ts","webpack:///./src/commands/command/old-command-custom.ts","webpack:///./src/commands/command/command-edition.ts","webpack:///./src/commands/command/command-delete.ts","webpack:///./src/entity-manipulation/item-commands.ts","webpack:///./src/commands/command/command-edit.ts","webpack:///./src/commands/command/command-info.ts","webpack:///./src/commands/command/command-list.ts","webpack:///./src/commands/command/command-layout.ts","webpack:///./src/commands/command/command-log.ts","webpack:///./src/commands/command/command-metadata.ts","webpack:///./src/commands/command/command-more.ts","webpack:///./src/commands/command/command-movedown.ts","webpack:///./src/commands/command/command-moveup.ts","webpack:///./src/commands/command/command-new.ts","webpack:///./src/commands/command/command-publish.ts","webpack:///./src/commands/command/command-remove.ts","webpack:///./src/commands/command/command-replace.ts","webpack:///./src/commands/command/command-template.ts","webpack:///./src/commands/command/command-query.ts","webpack:///./src/commands/command/command-view.ts","webpack:///./src/commands/command/command-system.ts","webpack:///./src/commands/command/content-list-action-params.ts","webpack:///./src/commands/command/workflow-commands.ts","webpack:///../$2sxc/src/sxc-global/context-identifier.ts","webpack:///./src/cms/run-params-helpers.ts","webpack:///./src/quick-dialog/quick-dialog-config.ts","webpack:///./src/quick-dialog/iframe-bridge.ts","webpack:///./src/manage/session-state-handler.ts","webpack:///./src/quick-dialog/state.ts","webpack:///./src/quick-dialog/index.ts","webpack:///./src/quick-dialog/quick-dialog-container.ts","webpack:///./src/quick-dialog/quick-dialog.ts","webpack:///./src/manage/dialog-core-params.ts","webpack:///./src/commands/command-link-generator.ts","webpack:///./src/commands/engine/cms-engine.ts","webpack:///./src/toolbar/render/svg-icons.ts","webpack:///./src/bootstrap/bootstrap.ts","webpack:///./src/cms/sxc-global-cms.ts","webpack:///./src/sxc/sxc-cms-real.ts","webpack:///./src/manage/edit-manager.ts","webpack:///./src/toolbar/toolbar-global-enable-shake.ts","webpack:///./src/index.ts","webpack:///./src/manage/sxc-global-manage.ts","webpack:///./src/system/2sxc.system.ts"],"sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var global = typeof self !== 'undefined' ? self : this;\nvar __self__ = (function () {\nfunction F() {\nthis.fetch = false;\nthis.DOMException = global.DOMException\n}\nF.prototype = global;\nreturn new F();\n})();\n(function(self) {\n\nvar irrelevant = (function (exports) {\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob:\n      'FileReader' in self &&\n      'Blob' in self &&\n      (function() {\n        try {\n          new Blob();\n          return true\n        } catch (e) {\n          return false\n        }\n      })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  };\n\n  function isDataView(obj) {\n    return obj && DataView.prototype.isPrototypeOf(obj)\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ];\n\n    var isArrayBufferView =\n      ArrayBuffer.isView ||\n      function(obj) {\n        return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n      };\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name);\n    }\n    if (/[^a-z0-9\\-#$%&'*+.^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value);\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift();\n        return {done: value === undefined, value: value}\n      }\n    };\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      };\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {};\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value);\n      }, this);\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1]);\n      }, this);\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name]);\n      }, this);\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name);\n    value = normalizeValue(value);\n    var oldValue = this.map[name];\n    this.map[name] = oldValue ? oldValue + ', ' + value : value;\n  };\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)];\n  };\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name);\n    return this.has(name) ? this.map[name] : null\n  };\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  };\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value);\n  };\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this);\n      }\n    }\n  };\n\n  Headers.prototype.keys = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push(name);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.values = function() {\n    var items = [];\n    this.forEach(function(value) {\n      items.push(value);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.entries = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push([name, value]);\n    });\n    return iteratorFor(items)\n  };\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true;\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result);\n      };\n      reader.onerror = function() {\n        reject(reader.error);\n      };\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsArrayBuffer(blob);\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsText(blob);\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf);\n    var chars = new Array(view.length);\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i]);\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength);\n      view.set(new Uint8Array(buf));\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false;\n\n    this._initBody = function(body) {\n      this._bodyInit = body;\n      if (!body) {\n        this._bodyText = '';\n      } else if (typeof body === 'string') {\n        this._bodyText = body;\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body;\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body;\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString();\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer);\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer]);\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body);\n      } else {\n        this._bodyText = body = Object.prototype.toString.call(body);\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8');\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type);\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n        }\n      }\n    };\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this);\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      };\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      };\n    }\n\n    this.text = function() {\n      var rejected = consumed(this);\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    };\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      };\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    };\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT'];\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase();\n    return methods.indexOf(upcased) > -1 ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {};\n    var body = options.body;\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url;\n      this.credentials = input.credentials;\n      if (!options.headers) {\n        this.headers = new Headers(input.headers);\n      }\n      this.method = input.method;\n      this.mode = input.mode;\n      this.signal = input.signal;\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit;\n        input.bodyUsed = true;\n      }\n    } else {\n      this.url = String(input);\n    }\n\n    this.credentials = options.credentials || this.credentials || 'same-origin';\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers);\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET');\n    this.mode = options.mode || this.mode || null;\n    this.signal = options.signal || this.signal;\n    this.referrer = null;\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body);\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, {body: this._bodyInit})\n  };\n\n  function decode(body) {\n    var form = new FormData();\n    body\n      .trim()\n      .split('&')\n      .forEach(function(bytes) {\n        if (bytes) {\n          var split = bytes.split('=');\n          var name = split.shift().replace(/\\+/g, ' ');\n          var value = split.join('=').replace(/\\+/g, ' ');\n          form.append(decodeURIComponent(name), decodeURIComponent(value));\n        }\n      });\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers();\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ');\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':');\n      var key = parts.shift().trim();\n      if (key) {\n        var value = parts.join(':').trim();\n        headers.append(key, value);\n      }\n    });\n    return headers\n  }\n\n  Body.call(Request.prototype);\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {};\n    }\n\n    this.type = 'default';\n    this.status = options.status === undefined ? 200 : options.status;\n    this.ok = this.status >= 200 && this.status < 300;\n    this.statusText = 'statusText' in options ? options.statusText : 'OK';\n    this.headers = new Headers(options.headers);\n    this.url = options.url || '';\n    this._initBody(bodyInit);\n  }\n\n  Body.call(Response.prototype);\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  };\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''});\n    response.type = 'error';\n    return response\n  };\n\n  var redirectStatuses = [301, 302, 303, 307, 308];\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  };\n\n  exports.DOMException = self.DOMException;\n  try {\n    new exports.DOMException();\n  } catch (err) {\n    exports.DOMException = function(message, name) {\n      this.message = message;\n      this.name = name;\n      var error = Error(message);\n      this.stack = error.stack;\n    };\n    exports.DOMException.prototype = Object.create(Error.prototype);\n    exports.DOMException.prototype.constructor = exports.DOMException;\n  }\n\n  function fetch(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init);\n\n      if (request.signal && request.signal.aborted) {\n        return reject(new exports.DOMException('Aborted', 'AbortError'))\n      }\n\n      var xhr = new XMLHttpRequest();\n\n      function abortXhr() {\n        xhr.abort();\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        };\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL');\n        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n        resolve(new Response(body, options));\n      };\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.onabort = function() {\n        reject(new exports.DOMException('Aborted', 'AbortError'));\n      };\n\n      xhr.open(request.method, request.url, true);\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true;\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false;\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob';\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value);\n      });\n\n      if (request.signal) {\n        request.signal.addEventListener('abort', abortXhr);\n\n        xhr.onreadystatechange = function() {\n          // DONE (success or failure)\n          if (xhr.readyState === 4) {\n            request.signal.removeEventListener('abort', abortXhr);\n          }\n        };\n      }\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);\n    })\n  }\n\n  fetch.polyfill = true;\n\n  if (!self.fetch) {\n    self.fetch = fetch;\n    self.Headers = Headers;\n    self.Request = Request;\n    self.Response = Response;\n  }\n\n  exports.Headers = Headers;\n  exports.Request = Request;\n  exports.Response = Response;\n  exports.fetch = fetch;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n  return exports;\n\n})({});\n})(__self__);\n__self__.fetch.ponyfill = true;\n// Remove \"polyfill\" property added by whatwg-fetch\ndelete __self__.fetch.polyfill;\n// Choose between native implementation (global) or custom implementation (__self__)\n// var ctx = global.fetch ? global : __self__;\nvar ctx = __self__; // this line disable service worker support temporarily\nexports = ctx.fetch // To enable: import fetch from 'cross-fetch'\nexports.default = ctx.fetch // For TypeScript consumers without esModuleInterop.\nexports.fetch = ctx.fetch // To enable: import {fetch} from 'cross-fetch'\nexports.Headers = ctx.Headers\nexports.Request = ctx.Request\nexports.Response = ctx.Response\nmodule.exports = exports\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar defaults = {\n    selectorAttr: 'data-i18n',\n    targetAttr: 'i18n-target',\n    optionsAttr: 'i18n-options',\n    useOptionsAttr: false,\n    parseDefaultValueFromContent: true,\n    document: document\n};\n\nfunction init(i18next) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    options = _extends({}, defaults, options);\n    var extendDefault = function extendDefault(o, val) {\n        return options.parseDefaultValueFromContent ? _extends({}, o, { defaultValue: val }) : o;\n    };\n    function parse(elem, key, opts) {\n        var attr = 'text';\n\n        if (key.indexOf('[') == 0) {\n            var parts = key.split(']');\n            key = parts[1];\n            attr = parts[0].substr(1, parts[0].length - 1);\n        }\n\n        key = key.indexOf(';') == key.length - 1 ? key.substr(0, key.length - 2) : key;\n\n        if (attr === 'html') {\n            elem.innerHTML = i18next.t(key, extendDefault(opts, elem.innerHTML));\n        } else if (attr === 'text') {\n            elem.textContent = i18next.t(key, extendDefault(opts, elem.textContent));\n        } else if (attr === 'prepend') {\n            var startIdx = elem.innerHTML.indexOf('<loc-i18n>');\n            var endIdx = elem.innerHTML.indexOf('</loc-i18n>') + 11;\n            if (startIdx > -1 && endIdx > 6) {\n                elem.innerHTML = [elem.innerHTML.substring(0, startIdx), elem.innerHTML.slice(endIdx)].join('');\n            }\n            elem.innerHTML = ['<loc-i18n>', i18next.t(key, extendDefault(opts, elem.innerHTML)), '</loc-i18n>', elem.innerHTML].join('');\n        } else if (attr === 'append') {\n            var _startIdx = elem.innerHTML.indexOf('<loc-i18n>');\n            var _endIdx = elem.innerHTML.indexOf('</loc-i18n>') + 11;\n            if (_startIdx > -1 && _endIdx > 6) {\n                elem.innerHTML = [elem.innerHTML.substring(0, _startIdx), elem.innerHTML.slice(_endIdx)].join('');\n            }\n            elem.innerHTML = [elem.innerHTML, '<loc-i18n>', i18next.t(key, extendDefault(opts, elem.innerHTML), '</loc-i18n>')].join('');\n        } else if (attr.indexOf('data-') === 0) {\n            var dataAttr = attr.substr('data-'.length);\n            var translated = i18next.t(key, extendDefault(opts, elem.getAttribute(dataAttr)));\n            // we change into the data cache\n            elem.setAttribute(dataAttr, translated);\n            // we change into the dom\n            elem.setAttribute(attr, translated);\n        } else {\n            elem.setAttribute(attr, i18next.t(key, extendDefault(opts, elem.getAttribute(attr))));\n        }\n    };\n\n    function relaxedJsonParse(badJSON) {\n        return JSON.parse(badJSON.replace(/:\\s*\"([^\"]*)\"/g, function (match, p1) {\n            return ': \"' + p1.replace(/:/g, '@colon@') + '\"';\n        }).replace(/:\\s*'([^']*)'/g, function (match, p1) {\n            return ': \"' + p1.replace(/:/g, '@colon@') + '\"';\n        }).replace(/(['\"])?([a-z0-9A-Z_]+)(['\"])?\\s*:/g, '\"$2\": ').replace(/@colon@/g, ':'));\n    }\n\n    function _loc(elem, opts) {\n        var key = elem.getAttribute(options.selectorAttr);\n        //        if (!key && typeof key !== 'undefined' && key !== false)\n        //            key = elem.textContent || elem.innerHTML;\n        if (!key) return;\n\n        var target = elem,\n            targetSelector = elem.getAttribute(options.targetAttr);\n\n        if (targetSelector != null) target = elem.querySelector(targetSelector) || elem;\n\n        if (!opts && options.useOptionsAttr === true) opts = relaxedJsonParse(elem.getAttribute(options.optionsAttr) || '{}');\n\n        opts = opts || {};\n\n        if (key.indexOf(';') >= 0) {\n            var keys = key.split(';');\n            for (var ix = 0, l_ix = keys.length; ix < l_ix; ix++) {\n                if (keys[ix] != '') parse(target, keys[ix], opts);\n            }\n        } else {\n            parse(target, key, opts);\n        }\n\n        if (options.useOptionsAttr === true) {\n            var clone = {};\n            clone = _extends({ clone: clone }, opts);\n            delete clone.lng;\n            elem.setAttribute(options.optionsAttr, JSON.stringify(clone));\n        }\n    }\n\n    function handle(selector, opts) {\n        var elems = options.document.querySelectorAll(selector);\n        for (var i = 0; i < elems.length; i++) {\n            var elem = elems[i];\n            var childs = elem.querySelectorAll('[' + options.selectorAttr + ']');\n            for (var j = childs.length - 1; j > -1; j--) {\n                _loc(childs[j], opts);\n            }\n            _loc(elem, opts);\n        }\n    };\n    return handle;\n}\n\nexports.default = {\n    init: init\n};","module.exports = require('./dist/commonjs/main.js').default;\n","/*\n * Author: Alex Gibson\n * https://github.com/alexgibson/shake.js\n * License: MIT license\n */\n\n(function(global, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(function() {\n            return factory(global, global.document);\n        });\n    } else if (typeof module !== 'undefined' && module.exports) {\n        module.exports = factory(global, global.document);\n    } else {\n        global.Shake = factory(global, global.document);\n    }\n} (typeof window !== 'undefined' ? window : this, function (window, document) {\n\n    'use strict';\n\n    function Shake(options) {\n        //feature detect\n        this.hasDeviceMotion = 'ondevicemotion' in window;\n\n        this.options = {\n            threshold: 15, //default velocity threshold for shake to register\n            timeout: 1000 //default interval between events\n        };\n\n        if (typeof options === 'object') {\n            for (var i in options) {\n                if (options.hasOwnProperty(i)) {\n                    this.options[i] = options[i];\n                }\n            }\n        }\n\n        //use date to prevent multiple shakes firing\n        this.lastTime = new Date();\n\n        //accelerometer values\n        this.lastX = null;\n        this.lastY = null;\n        this.lastZ = null;\n\n        //create custom event\n        if (typeof document.CustomEvent === 'function') {\n            this.event = new document.CustomEvent('shake', {\n                bubbles: true,\n                cancelable: true\n            });\n        } else if (typeof document.createEvent === 'function') {\n            this.event = document.createEvent('Event');\n            this.event.initEvent('shake', true, true);\n        } else {\n            return false;\n        }\n    }\n\n    //reset timer values\n    Shake.prototype.reset = function () {\n        this.lastTime = new Date();\n        this.lastX = null;\n        this.lastY = null;\n        this.lastZ = null;\n    };\n\n    //start listening for devicemotion\n    Shake.prototype.start = function () {\n        this.reset();\n        if (this.hasDeviceMotion) {\n            window.addEventListener('devicemotion', this, false);\n        }\n    };\n\n    //stop listening for devicemotion\n    Shake.prototype.stop = function () {\n        if (this.hasDeviceMotion) {\n            window.removeEventListener('devicemotion', this, false);\n        }\n        this.reset();\n    };\n\n    //calculates if shake did occur\n    Shake.prototype.devicemotion = function (e) {\n        var current = e.accelerationIncludingGravity;\n        var currentTime;\n        var timeDifference;\n        var deltaX = 0;\n        var deltaY = 0;\n        var deltaZ = 0;\n\n        if ((this.lastX === null) && (this.lastY === null) && (this.lastZ === null)) {\n            this.lastX = current.x;\n            this.lastY = current.y;\n            this.lastZ = current.z;\n            return;\n        }\n\n        deltaX = Math.abs(this.lastX - current.x);\n        deltaY = Math.abs(this.lastY - current.y);\n        deltaZ = Math.abs(this.lastZ - current.z);\n\n        if (((deltaX > this.options.threshold) && (deltaY > this.options.threshold)) || ((deltaX > this.options.threshold) && (deltaZ > this.options.threshold)) || ((deltaY > this.options.threshold) && (deltaZ > this.options.threshold))) {\n            //calculate time in milliseconds since last shake registered\n            currentTime = new Date();\n            timeDifference = currentTime.getTime() - this.lastTime.getTime();\n\n            if (timeDifference > this.options.timeout) {\n                window.dispatchEvent(this.event);\n                this.lastTime = new Date();\n            }\n        }\n\n        this.lastX = current.x;\n        this.lastY = current.y;\n        this.lastZ = current.z;\n\n    };\n\n    //event handler\n    Shake.prototype.handleEvent = function (e) {\n        if (typeof (this[e.type]) === 'function') {\n            return this[e.type](e);\n        }\n    };\n\n    return Shake;\n}));\n","// The following script fixes a bug in DNN 08.00.04\r\n// the bug tries to detect a module-ID based on classes in a tag,\r\n// but uses a bad regex and captures the number 2 on all 2sxc-modules\r\n// instead of the real id\r\n// this patch changes the order of the className of 2sxc modules when\r\n// they are accessed through '$.fn.attr'\r\n// 'DnnModule-2sxc DnnModule-xxx' -> DNN thinks the mod id is 2 (false)\r\n// 'DnnModule-xxx DnnModule-2sxc' -> DNN thinks the mod id is xxx (correct)\r\n// documented here https://github.com/2sic/2sxc/issues/986\r\n\r\n/**\r\n * Fix drag-drop functionality in dnn 08.00.04 - it has an incorrect regex\r\n * @internal\r\n */\r\n'use strict';\r\n\r\n(() => {\r\n  if (window.$ == null) return;\r\n\r\n  const fn = window.$.fn.attr;\r\n  window.$.fn.attr = function() {\r\n    const val = fn.apply(this, arguments);\r\n    if (arguments[0] !== 'class' || typeof val !== 'string' || val.search('DnnModule-2sxc ') === -1) return val;\r\n    return val.replace('DnnModule-2sxc ', '') + ' DnnModule-2sxc';\r\n  };\r\n})();\r\n","var fetchApi\nif (typeof fetch === 'function') {\n  if (typeof global !== 'undefined' && global.fetch) {\n    fetchApi = global.fetch\n  } else if (typeof window !== 'undefined' && window.fetch) {\n    fetchApi = window.fetch\n  }\n}\n\nif (typeof require !== 'undefined' && (typeof window === 'undefined' || typeof window.document === 'undefined')) {\n  var f = fetchApi || require('cross-fetch')\n  if (f.default) f = f.default\n  exports.default = f\n  module.exports = exports.default\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default function getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}","import getWindow from \"./getWindow.js\";\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nexport { isElement, isHTMLElement, isShadowRoot };","export var max = Math.max;\nexport var min = Math.min;\nexport var round = Math.round;","export default function getUAString() {\n  var uaData = navigator.userAgentData;\n\n  if (uaData != null && uaData.brands) {\n    return uaData.brands.map(function (item) {\n      return item.brand + \"/\" + item.version;\n    }).join(' ');\n  }\n\n  return navigator.userAgent;\n}","import getUAString from \"../utils/userAgent.js\";\nexport default function isLayoutViewport() {\n  return !/^((?!chrome|android).)*safari/i.test(getUAString());\n}","import { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport { round } from \"../utils/math.js\";\nimport getWindow from \"./getWindow.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getBoundingClientRect(element, includeScale, isFixedStrategy) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n\n  var clientRect = element.getBoundingClientRect();\n  var scaleX = 1;\n  var scaleY = 1;\n\n  if (includeScale && isHTMLElement(element)) {\n    scaleX = element.offsetWidth > 0 ? round(clientRect.width) / element.offsetWidth || 1 : 1;\n    scaleY = element.offsetHeight > 0 ? round(clientRect.height) / element.offsetHeight || 1 : 1;\n  }\n\n  var _ref = isElement(element) ? getWindow(element) : window,\n      visualViewport = _ref.visualViewport;\n\n  var addVisualOffsets = !isLayoutViewport() && isFixedStrategy;\n  var x = (clientRect.left + (addVisualOffsets && visualViewport ? visualViewport.offsetLeft : 0)) / scaleX;\n  var y = (clientRect.top + (addVisualOffsets && visualViewport ? visualViewport.offsetTop : 0)) / scaleY;\n  var width = clientRect.width / scaleX;\n  var height = clientRect.height / scaleY;\n  return {\n    width: width,\n    height: height,\n    top: y,\n    right: x + width,\n    bottom: y + height,\n    left: x,\n    x: x,\n    y: y\n  };\n}","import getWindow from \"./getWindow.js\";\nexport default function getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}","export default function getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}","import { isElement } from \"./instanceOf.js\";\nexport default function getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nexport default function getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  // Popper 1 is broken in this case and never had a bug report so let's assume\n  // it's not an issue. I don't think anyone ever specifies width on <html>\n  // anyway.\n  // Browsers where the left scrollbar doesn't cause an issue report `0` for\n  // this (e.g. Edge 2019, IE11, Safari)\n  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;\n}","import getWindow from \"./getWindow.js\";\nexport default function getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}","import getComputedStyle from \"./getComputedStyle.js\";\nexport default function isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getNodeScroll from \"./getNodeScroll.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport { round } from \"../utils/math.js\";\n\nfunction isElementScaled(element) {\n  var rect = element.getBoundingClientRect();\n  var scaleX = round(rect.width) / element.offsetWidth || 1;\n  var scaleY = round(rect.height) / element.offsetHeight || 1;\n  return scaleX !== 1 || scaleY !== 1;\n} // Returns the composite rect of an element relative to its offsetParent.\n// Composite means it takes into account transforms as well as layout.\n\n\nexport default function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n\n  var isOffsetParentAnElement = isHTMLElement(offsetParent);\n  var offsetParentIsScaled = isHTMLElement(offsetParent) && isElementScaled(offsetParent);\n  var documentElement = getDocumentElement(offsetParent);\n  var rect = getBoundingClientRect(elementOrVirtualElement, offsetParentIsScaled, isFixed);\n  var scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  var offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || // https://github.com/popperjs/popper-core/issues/1078\n    isScrollParent(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      offsets = getBoundingClientRect(offsetParent, true);\n      offsets.x += offsetParent.clientLeft;\n      offsets.y += offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}","import getWindowScroll from \"./getWindowScroll.js\";\nimport getWindow from \"./getWindow.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getHTMLElementScroll from \"./getHTMLElementScroll.js\";\nexport default function getNodeScroll(node) {\n  if (node === getWindow(node) || !isHTMLElement(node)) {\n    return getWindowScroll(node);\n  } else {\n    return getHTMLElementScroll(node);\n  }\n}","export default function getHTMLElementScroll(element) {\n  return {\n    scrollLeft: element.scrollLeft,\n    scrollTop: element.scrollTop\n  };\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\"; // Returns the layout rect of an element relative to its offsetParent. Layout\n// means it doesn't take into account transforms.\n\nexport default function getLayoutRect(element) {\n  var clientRect = getBoundingClientRect(element); // Use the clientRect sizes if it's not been transformed.\n  // Fixes https://github.com/popperjs/popper-core/issues/1223\n\n  var width = element.offsetWidth;\n  var height = element.offsetHeight;\n\n  if (Math.abs(clientRect.width - width) <= 1) {\n    width = clientRect.width;\n  }\n\n  if (Math.abs(clientRect.height - height) <= 1) {\n    height = clientRect.height;\n  }\n\n  return {\n    x: element.offsetLeft,\n    y: element.offsetTop,\n    width: width,\n    height: height\n  };\n}","import getNodeName from \"./getNodeName.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport { isShadowRoot } from \"./instanceOf.js\";\nexport default function getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}","import getParentNode from \"./getParentNode.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nexport default function getScrollParent(node) {\n  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {\n    // $FlowFixMe[incompatible-return]: assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(node) && isScrollParent(node)) {\n    return node;\n  }\n\n  return getScrollParent(getParentNode(node));\n}","import getScrollParent from \"./getScrollParent.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getWindow from \"./getWindow.js\";\nimport isScrollParent from \"./isScrollParent.js\";\n/*\ngiven a DOM element, return the list of all scroll parents, up the list of ancesors\nuntil we get to the top window object. This list is what we attach scroll listeners\nto, because if any of these parent elements scroll, we'll need to re-calculate the\nreference element's position.\n*/\n\nexport default function listScrollParents(element, list) {\n  var _element$ownerDocumen;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  var scrollParent = getScrollParent(element);\n  var isBody = scrollParent === ((_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body);\n  var win = getWindow(scrollParent);\n  var target = isBody ? [win].concat(win.visualViewport || [], isScrollParent(scrollParent) ? scrollParent : []) : scrollParent;\n  var updatedList = list.concat(target);\n  return isBody ? updatedList : // $FlowFixMe[incompatible-call]: isBody tells us target will be an HTMLElement here\n  updatedList.concat(listScrollParents(getParentNode(target)));\n}","import getNodeName from \"./getNodeName.js\";\nexport default function isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}","import getWindow from \"./getWindow.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isHTMLElement, isShadowRoot } from \"./instanceOf.js\";\nimport isTableElement from \"./isTableElement.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getUAString from \"../utils/userAgent.js\";\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = /firefox/i.test(getUAString());\n  var isIE = /Trident/i.test(getUAString());\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  if (isShadowRoot(currentNode)) {\n    currentNode = currentNode.host;\n  }\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nexport default function getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}","export var top = 'top';\nexport var bottom = 'bottom';\nexport var right = 'right';\nexport var left = 'left';\nexport var auto = 'auto';\nexport var basePlacements = [top, bottom, right, left];\nexport var start = 'start';\nexport var end = 'end';\nexport var clippingParents = 'clippingParents';\nexport var viewport = 'viewport';\nexport var popper = 'popper';\nexport var reference = 'reference';\nexport var variationPlacements = /*#__PURE__*/basePlacements.reduce(function (acc, placement) {\n  return acc.concat([placement + \"-\" + start, placement + \"-\" + end]);\n}, []);\nexport var placements = /*#__PURE__*/[].concat(basePlacements, [auto]).reduce(function (acc, placement) {\n  return acc.concat([placement, placement + \"-\" + start, placement + \"-\" + end]);\n}, []); // modifiers that need to read the DOM\n\nexport var beforeRead = 'beforeRead';\nexport var read = 'read';\nexport var afterRead = 'afterRead'; // pure-logic modifiers\n\nexport var beforeMain = 'beforeMain';\nexport var main = 'main';\nexport var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)\n\nexport var beforeWrite = 'beforeWrite';\nexport var write = 'write';\nexport var afterWrite = 'afterWrite';\nexport var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];","import { modifierPhases } from \"../enums.js\"; // source: https://stackoverflow.com/questions/49875255\n\nfunction order(modifiers) {\n  var map = new Map();\n  var visited = new Set();\n  var result = [];\n  modifiers.forEach(function (modifier) {\n    map.set(modifier.name, modifier);\n  }); // On visiting object, check for its dependencies and visit them recursively\n\n  function sort(modifier) {\n    visited.add(modifier.name);\n    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);\n    requires.forEach(function (dep) {\n      if (!visited.has(dep)) {\n        var depModifier = map.get(dep);\n\n        if (depModifier) {\n          sort(depModifier);\n        }\n      }\n    });\n    result.push(modifier);\n  }\n\n  modifiers.forEach(function (modifier) {\n    if (!visited.has(modifier.name)) {\n      // check for visited object\n      sort(modifier);\n    }\n  });\n  return result;\n}\n\nexport default function orderModifiers(modifiers) {\n  // order based on dependencies\n  var orderedModifiers = order(modifiers); // order based on phase\n\n  return modifierPhases.reduce(function (acc, phase) {\n    return acc.concat(orderedModifiers.filter(function (modifier) {\n      return modifier.phase === phase;\n    }));\n  }, []);\n}","import getCompositeRect from \"./dom-utils/getCompositeRect.js\";\nimport getLayoutRect from \"./dom-utils/getLayoutRect.js\";\nimport listScrollParents from \"./dom-utils/listScrollParents.js\";\nimport getOffsetParent from \"./dom-utils/getOffsetParent.js\";\nimport getComputedStyle from \"./dom-utils/getComputedStyle.js\";\nimport orderModifiers from \"./utils/orderModifiers.js\";\nimport debounce from \"./utils/debounce.js\";\nimport validateModifiers from \"./utils/validateModifiers.js\";\nimport uniqueBy from \"./utils/uniqueBy.js\";\nimport getBasePlacement from \"./utils/getBasePlacement.js\";\nimport mergeByName from \"./utils/mergeByName.js\";\nimport detectOverflow from \"./utils/detectOverflow.js\";\nimport { isElement } from \"./dom-utils/instanceOf.js\";\nimport { auto } from \"./enums.js\";\nvar INVALID_ELEMENT_ERROR = 'Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.';\nvar INFINITE_LOOP_ERROR = 'Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.';\nvar DEFAULT_OPTIONS = {\n  placement: 'bottom',\n  modifiers: [],\n  strategy: 'absolute'\n};\n\nfunction areValidElements() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return !args.some(function (element) {\n    return !(element && typeof element.getBoundingClientRect === 'function');\n  });\n}\n\nexport function popperGenerator(generatorOptions) {\n  if (generatorOptions === void 0) {\n    generatorOptions = {};\n  }\n\n  var _generatorOptions = generatorOptions,\n      _generatorOptions$def = _generatorOptions.defaultModifiers,\n      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,\n      _generatorOptions$def2 = _generatorOptions.defaultOptions,\n      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;\n  return function createPopper(reference, popper, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var state = {\n      placement: 'bottom',\n      orderedModifiers: [],\n      options: Object.assign({}, DEFAULT_OPTIONS, defaultOptions),\n      modifiersData: {},\n      elements: {\n        reference: reference,\n        popper: popper\n      },\n      attributes: {},\n      styles: {}\n    };\n    var effectCleanupFns = [];\n    var isDestroyed = false;\n    var instance = {\n      state: state,\n      setOptions: function setOptions(setOptionsAction) {\n        var options = typeof setOptionsAction === 'function' ? setOptionsAction(state.options) : setOptionsAction;\n        cleanupModifierEffects();\n        state.options = Object.assign({}, defaultOptions, state.options, options);\n        state.scrollParents = {\n          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],\n          popper: listScrollParents(popper)\n        }; // Orders the modifiers based on their dependencies and `phase`\n        // properties\n\n        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers\n\n        state.orderedModifiers = orderedModifiers.filter(function (m) {\n          return m.enabled;\n        }); // Validate the provided modifiers so that the consumer will get warned\n        // if one of the modifiers is invalid for any reason\n\n        if (process.env.NODE_ENV !== \"production\") {\n          var modifiers = uniqueBy([].concat(orderedModifiers, state.options.modifiers), function (_ref) {\n            var name = _ref.name;\n            return name;\n          });\n          validateModifiers(modifiers);\n\n          if (getBasePlacement(state.options.placement) === auto) {\n            var flipModifier = state.orderedModifiers.find(function (_ref2) {\n              var name = _ref2.name;\n              return name === 'flip';\n            });\n\n            if (!flipModifier) {\n              console.error(['Popper: \"auto\" placements require the \"flip\" modifier be', 'present and enabled to work.'].join(' '));\n            }\n          }\n\n          var _getComputedStyle = getComputedStyle(popper),\n              marginTop = _getComputedStyle.marginTop,\n              marginRight = _getComputedStyle.marginRight,\n              marginBottom = _getComputedStyle.marginBottom,\n              marginLeft = _getComputedStyle.marginLeft; // We no longer take into account `margins` on the popper, and it can\n          // cause bugs with positioning, so we'll warn the consumer\n\n\n          if ([marginTop, marginRight, marginBottom, marginLeft].some(function (margin) {\n            return parseFloat(margin);\n          })) {\n            console.warn(['Popper: CSS \"margin\" styles cannot be used to apply padding', 'between the popper and its reference element or boundary.', 'To replicate margin, use the `offset` modifier, as well as', 'the `padding` option in the `preventOverflow` and `flip`', 'modifiers.'].join(' '));\n          }\n        }\n\n        runModifierEffects();\n        return instance.update();\n      },\n      // Sync update  it will always be executed, even if not necessary. This\n      // is useful for low frequency updates where sync behavior simplifies the\n      // logic.\n      // For high frequency updates (e.g. `resize` and `scroll` events), always\n      // prefer the async Popper#update method\n      forceUpdate: function forceUpdate() {\n        if (isDestroyed) {\n          return;\n        }\n\n        var _state$elements = state.elements,\n            reference = _state$elements.reference,\n            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements\n        // anymore\n\n        if (!areValidElements(reference, popper)) {\n          if (process.env.NODE_ENV !== \"production\") {\n            console.error(INVALID_ELEMENT_ERROR);\n          }\n\n          return;\n        } // Store the reference and popper rects to be read by modifiers\n\n\n        state.rects = {\n          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),\n          popper: getLayoutRect(popper)\n        }; // Modifiers have the ability to reset the current update cycle. The\n        // most common use case for this is the `flip` modifier changing the\n        // placement, which then needs to re-run all the modifiers, because the\n        // logic was previously ran for the previous placement and is therefore\n        // stale/incorrect\n\n        state.reset = false;\n        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier\n        // is filled with the initial data specified by the modifier. This means\n        // it doesn't persist and is fresh on each update.\n        // To ensure persistent data, use `${name}#persistent`\n\n        state.orderedModifiers.forEach(function (modifier) {\n          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);\n        });\n        var __debug_loops__ = 0;\n\n        for (var index = 0; index < state.orderedModifiers.length; index++) {\n          if (process.env.NODE_ENV !== \"production\") {\n            __debug_loops__ += 1;\n\n            if (__debug_loops__ > 100) {\n              console.error(INFINITE_LOOP_ERROR);\n              break;\n            }\n          }\n\n          if (state.reset === true) {\n            state.reset = false;\n            index = -1;\n            continue;\n          }\n\n          var _state$orderedModifie = state.orderedModifiers[index],\n              fn = _state$orderedModifie.fn,\n              _state$orderedModifie2 = _state$orderedModifie.options,\n              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,\n              name = _state$orderedModifie.name;\n\n          if (typeof fn === 'function') {\n            state = fn({\n              state: state,\n              options: _options,\n              name: name,\n              instance: instance\n            }) || state;\n          }\n        }\n      },\n      // Async and optimistically optimized update  it will not be executed if\n      // not necessary (debounced to run at most once-per-tick)\n      update: debounce(function () {\n        return new Promise(function (resolve) {\n          instance.forceUpdate();\n          resolve(state);\n        });\n      }),\n      destroy: function destroy() {\n        cleanupModifierEffects();\n        isDestroyed = true;\n      }\n    };\n\n    if (!areValidElements(reference, popper)) {\n      if (process.env.NODE_ENV !== \"production\") {\n        console.error(INVALID_ELEMENT_ERROR);\n      }\n\n      return instance;\n    }\n\n    instance.setOptions(options).then(function (state) {\n      if (!isDestroyed && options.onFirstUpdate) {\n        options.onFirstUpdate(state);\n      }\n    }); // Modifiers have the ability to execute arbitrary code before the first\n    // update cycle runs. They will be executed in the same order as the update\n    // cycle. This is useful when a modifier adds some persistent data that\n    // other modifiers need to use, but the modifier is run after the dependent\n    // one.\n\n    function runModifierEffects() {\n      state.orderedModifiers.forEach(function (_ref3) {\n        var name = _ref3.name,\n            _ref3$options = _ref3.options,\n            options = _ref3$options === void 0 ? {} : _ref3$options,\n            effect = _ref3.effect;\n\n        if (typeof effect === 'function') {\n          var cleanupFn = effect({\n            state: state,\n            name: name,\n            instance: instance,\n            options: options\n          });\n\n          var noopFn = function noopFn() {};\n\n          effectCleanupFns.push(cleanupFn || noopFn);\n        }\n      });\n    }\n\n    function cleanupModifierEffects() {\n      effectCleanupFns.forEach(function (fn) {\n        return fn();\n      });\n      effectCleanupFns = [];\n    }\n\n    return instance;\n  };\n}\nexport var createPopper = /*#__PURE__*/popperGenerator(); // eslint-disable-next-line import/no-unused-modules\n\nexport { detectOverflow };","export default function debounce(fn) {\n  var pending;\n  return function () {\n    if (!pending) {\n      pending = new Promise(function (resolve) {\n        Promise.resolve().then(function () {\n          pending = undefined;\n          resolve(fn());\n        });\n      });\n    }\n\n    return pending;\n  };\n}","export default function mergeByName(modifiers) {\n  var merged = modifiers.reduce(function (merged, current) {\n    var existing = merged[current.name];\n    merged[current.name] = existing ? Object.assign({}, existing, current, {\n      options: Object.assign({}, existing.options, current.options),\n      data: Object.assign({}, existing.data, current.data)\n    }) : current;\n    return merged;\n  }, {}); // IE11 does not support Object.values\n\n  return Object.keys(merged).map(function (key) {\n    return merged[key];\n  });\n}","import getWindow from \"../dom-utils/getWindow.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar passive = {\n  passive: true\n};\n\nfunction effect(_ref) {\n  var state = _ref.state,\n      instance = _ref.instance,\n      options = _ref.options;\n  var _options$scroll = options.scroll,\n      scroll = _options$scroll === void 0 ? true : _options$scroll,\n      _options$resize = options.resize,\n      resize = _options$resize === void 0 ? true : _options$resize;\n  var window = getWindow(state.elements.popper);\n  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);\n\n  if (scroll) {\n    scrollParents.forEach(function (scrollParent) {\n      scrollParent.addEventListener('scroll', instance.update, passive);\n    });\n  }\n\n  if (resize) {\n    window.addEventListener('resize', instance.update, passive);\n  }\n\n  return function () {\n    if (scroll) {\n      scrollParents.forEach(function (scrollParent) {\n        scrollParent.removeEventListener('scroll', instance.update, passive);\n      });\n    }\n\n    if (resize) {\n      window.removeEventListener('resize', instance.update, passive);\n    }\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'eventListeners',\n  enabled: true,\n  phase: 'write',\n  fn: function fn() {},\n  effect: effect,\n  data: {}\n};","import { auto } from \"../enums.js\";\nexport default function getBasePlacement(placement) {\n  return placement.split('-')[0];\n}","export default function getVariation(placement) {\n  return placement.split('-')[1];\n}","export default function getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';\n}","import getBasePlacement from \"./getBasePlacement.js\";\nimport getVariation from \"./getVariation.js\";\nimport getMainAxisFromPlacement from \"./getMainAxisFromPlacement.js\";\nimport { top, right, bottom, left, start, end } from \"../enums.js\";\nexport default function computeOffsets(_ref) {\n  var reference = _ref.reference,\n      element = _ref.element,\n      placement = _ref.placement;\n  var basePlacement = placement ? getBasePlacement(placement) : null;\n  var variation = placement ? getVariation(placement) : null;\n  var commonX = reference.x + reference.width / 2 - element.width / 2;\n  var commonY = reference.y + reference.height / 2 - element.height / 2;\n  var offsets;\n\n  switch (basePlacement) {\n    case top:\n      offsets = {\n        x: commonX,\n        y: reference.y - element.height\n      };\n      break;\n\n    case bottom:\n      offsets = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case right:\n      offsets = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case left:\n      offsets = {\n        x: reference.x - element.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      offsets = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;\n\n  if (mainAxis != null) {\n    var len = mainAxis === 'y' ? 'height' : 'width';\n\n    switch (variation) {\n      case start:\n        offsets[mainAxis] = offsets[mainAxis] - (reference[len] / 2 - element[len] / 2);\n        break;\n\n      case end:\n        offsets[mainAxis] = offsets[mainAxis] + (reference[len] / 2 - element[len] / 2);\n        break;\n\n      default:\n    }\n  }\n\n  return offsets;\n}","import { top, left, right, bottom, end } from \"../enums.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getWindow from \"../dom-utils/getWindow.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getComputedStyle from \"../dom-utils/getComputedStyle.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport { round } from \"../utils/math.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar unsetSides = {\n  top: 'auto',\n  right: 'auto',\n  bottom: 'auto',\n  left: 'auto'\n}; // Round the offsets to the nearest suitable subpixel based on the DPR.\n// Zooming can change the DPR, but it seems to report a value that will\n// cleanly divide the values into the appropriate subpixels.\n\nfunction roundOffsetsByDPR(_ref) {\n  var x = _ref.x,\n      y = _ref.y;\n  var win = window;\n  var dpr = win.devicePixelRatio || 1;\n  return {\n    x: round(x * dpr) / dpr || 0,\n    y: round(y * dpr) / dpr || 0\n  };\n}\n\nexport function mapToStyles(_ref2) {\n  var _Object$assign2;\n\n  var popper = _ref2.popper,\n      popperRect = _ref2.popperRect,\n      placement = _ref2.placement,\n      variation = _ref2.variation,\n      offsets = _ref2.offsets,\n      position = _ref2.position,\n      gpuAcceleration = _ref2.gpuAcceleration,\n      adaptive = _ref2.adaptive,\n      roundOffsets = _ref2.roundOffsets,\n      isFixed = _ref2.isFixed;\n  var _offsets$x = offsets.x,\n      x = _offsets$x === void 0 ? 0 : _offsets$x,\n      _offsets$y = offsets.y,\n      y = _offsets$y === void 0 ? 0 : _offsets$y;\n\n  var _ref3 = typeof roundOffsets === 'function' ? roundOffsets({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref3.x;\n  y = _ref3.y;\n  var hasX = offsets.hasOwnProperty('x');\n  var hasY = offsets.hasOwnProperty('y');\n  var sideX = left;\n  var sideY = top;\n  var win = window;\n\n  if (adaptive) {\n    var offsetParent = getOffsetParent(popper);\n    var heightProp = 'clientHeight';\n    var widthProp = 'clientWidth';\n\n    if (offsetParent === getWindow(popper)) {\n      offsetParent = getDocumentElement(popper);\n\n      if (getComputedStyle(offsetParent).position !== 'static' && position === 'absolute') {\n        heightProp = 'scrollHeight';\n        widthProp = 'scrollWidth';\n      }\n    } // $FlowFixMe[incompatible-cast]: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it\n\n\n    offsetParent = offsetParent;\n\n    if (placement === top || (placement === left || placement === right) && variation === end) {\n      sideY = bottom;\n      var offsetY = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.height : // $FlowFixMe[prop-missing]\n      offsetParent[heightProp];\n      y -= offsetY - popperRect.height;\n      y *= gpuAcceleration ? 1 : -1;\n    }\n\n    if (placement === left || (placement === top || placement === bottom) && variation === end) {\n      sideX = right;\n      var offsetX = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.width : // $FlowFixMe[prop-missing]\n      offsetParent[widthProp];\n      x -= offsetX - popperRect.width;\n      x *= gpuAcceleration ? 1 : -1;\n    }\n  }\n\n  var commonStyles = Object.assign({\n    position: position\n  }, adaptive && unsetSides);\n\n  var _ref4 = roundOffsets === true ? roundOffsetsByDPR({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref4.x;\n  y = _ref4.y;\n\n  if (gpuAcceleration) {\n    var _Object$assign;\n\n    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) <= 1 ? \"translate(\" + x + \"px, \" + y + \"px)\" : \"translate3d(\" + x + \"px, \" + y + \"px, 0)\", _Object$assign));\n  }\n\n  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + \"px\" : '', _Object$assign2[sideX] = hasX ? x + \"px\" : '', _Object$assign2.transform = '', _Object$assign2));\n}\n\nfunction computeStyles(_ref5) {\n  var state = _ref5.state,\n      options = _ref5.options;\n  var _options$gpuAccelerat = options.gpuAcceleration,\n      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,\n      _options$adaptive = options.adaptive,\n      adaptive = _options$adaptive === void 0 ? true : _options$adaptive,\n      _options$roundOffsets = options.roundOffsets,\n      roundOffsets = _options$roundOffsets === void 0 ? true : _options$roundOffsets;\n\n  if (process.env.NODE_ENV !== \"production\") {\n    var transitionProperty = getComputedStyle(state.elements.popper).transitionProperty || '';\n\n    if (adaptive && ['transform', 'top', 'right', 'bottom', 'left'].some(function (property) {\n      return transitionProperty.indexOf(property) >= 0;\n    })) {\n      console.warn(['Popper: Detected CSS transitions on at least one of the following', 'CSS properties: \"transform\", \"top\", \"right\", \"bottom\", \"left\".', '\\n\\n', 'Disable the \"computeStyles\" modifier\\'s `adaptive` option to allow', 'for smooth transitions, or remove these properties from the CSS', 'transition declaration on the popper element if only transitioning', 'opacity or background-color for example.', '\\n\\n', 'We recommend using the popper element as a wrapper around an inner', 'element that can have any CSS property transitioned for animations.'].join(' '));\n    }\n  }\n\n  var commonStyles = {\n    placement: getBasePlacement(state.placement),\n    variation: getVariation(state.placement),\n    popper: state.elements.popper,\n    popperRect: state.rects.popper,\n    gpuAcceleration: gpuAcceleration,\n    isFixed: state.options.strategy === 'fixed'\n  };\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.styles.popper = Object.assign({}, state.styles.popper, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.popperOffsets,\n      position: state.options.strategy,\n      adaptive: adaptive,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  if (state.modifiersData.arrow != null) {\n    state.styles.arrow = Object.assign({}, state.styles.arrow, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.arrow,\n      position: 'absolute',\n      adaptive: false,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-placement': state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'computeStyles',\n  enabled: true,\n  phase: 'beforeWrite',\n  fn: computeStyles,\n  data: {}\n};","import getNodeName from \"../dom-utils/getNodeName.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // This modifier takes the styles prepared by the `computeStyles` modifier\n// and applies them to the HTMLElements such as popper and arrow\n\nfunction applyStyles(_ref) {\n  var state = _ref.state;\n  Object.keys(state.elements).forEach(function (name) {\n    var style = state.styles[name] || {};\n    var attributes = state.attributes[name] || {};\n    var element = state.elements[name]; // arrow is optional + virtual elements\n\n    if (!isHTMLElement(element) || !getNodeName(element)) {\n      return;\n    } // Flow doesn't support to extend this property, but it's the most\n    // effective way to apply styles to an HTMLElement\n    // $FlowFixMe[cannot-write]\n\n\n    Object.assign(element.style, style);\n    Object.keys(attributes).forEach(function (name) {\n      var value = attributes[name];\n\n      if (value === false) {\n        element.removeAttribute(name);\n      } else {\n        element.setAttribute(name, value === true ? '' : value);\n      }\n    });\n  });\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state;\n  var initialStyles = {\n    popper: {\n      position: state.options.strategy,\n      left: '0',\n      top: '0',\n      margin: '0'\n    },\n    arrow: {\n      position: 'absolute'\n    },\n    reference: {}\n  };\n  Object.assign(state.elements.popper.style, initialStyles.popper);\n  state.styles = initialStyles;\n\n  if (state.elements.arrow) {\n    Object.assign(state.elements.arrow.style, initialStyles.arrow);\n  }\n\n  return function () {\n    Object.keys(state.elements).forEach(function (name) {\n      var element = state.elements[name];\n      var attributes = state.attributes[name] || {};\n      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them\n\n      var style = styleProperties.reduce(function (style, property) {\n        style[property] = '';\n        return style;\n      }, {}); // arrow is optional + virtual elements\n\n      if (!isHTMLElement(element) || !getNodeName(element)) {\n        return;\n      }\n\n      Object.assign(element.style, style);\n      Object.keys(attributes).forEach(function (attribute) {\n        element.removeAttribute(attribute);\n      });\n    });\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'applyStyles',\n  enabled: true,\n  phase: 'write',\n  fn: applyStyles,\n  effect: effect,\n  requires: ['computeStyles']\n};","var hash = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nexport default function getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}","var hash = {\n  start: 'end',\n  end: 'start'\n};\nexport default function getOppositeVariationPlacement(placement) {\n  return placement.replace(/start|end/g, function (matched) {\n    return hash[matched];\n  });\n}","import { isShadowRoot } from \"./instanceOf.js\";\nexport default function contains(parent, child) {\n  var rootNode = child.getRootNode && child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n      var next = child;\n\n      do {\n        if (next && parent.isSameNode(next)) {\n          return true;\n        } // $FlowFixMe[prop-missing]: need a better way to handle this...\n\n\n        next = next.parentNode || next.host;\n      } while (next);\n    } // Give up, the result is false\n\n\n  return false;\n}","export default function rectToClientRect(rect) {\n  return Object.assign({}, rect, {\n    left: rect.x,\n    top: rect.y,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  });\n}","import { viewport } from \"../enums.js\";\nimport getViewportRect from \"./getViewportRect.js\";\nimport getDocumentRect from \"./getDocumentRect.js\";\nimport listScrollParents from \"./listScrollParents.js\";\nimport getOffsetParent from \"./getOffsetParent.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport contains from \"./contains.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport rectToClientRect from \"../utils/rectToClientRect.js\";\nimport { max, min } from \"../utils/math.js\";\n\nfunction getInnerBoundingClientRect(element, strategy) {\n  var rect = getBoundingClientRect(element, false, strategy === 'fixed');\n  rect.top = rect.top + element.clientTop;\n  rect.left = rect.left + element.clientLeft;\n  rect.bottom = rect.top + element.clientHeight;\n  rect.right = rect.left + element.clientWidth;\n  rect.width = element.clientWidth;\n  rect.height = element.clientHeight;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\n\nfunction getClientRectFromMixedType(element, clippingParent, strategy) {\n  return clippingParent === viewport ? rectToClientRect(getViewportRect(element, strategy)) : isElement(clippingParent) ? getInnerBoundingClientRect(clippingParent, strategy) : rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping parent\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingParents(element) {\n  var clippingParents = listScrollParents(getParentNode(element));\n  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;\n  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // $FlowFixMe[incompatible-return]: https://github.com/facebook/flow/issues/1414\n\n\n  return clippingParents.filter(function (clippingParent) {\n    return isElement(clippingParent) && contains(clippingParent, clipperElement) && getNodeName(clippingParent) !== 'body';\n  });\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping parents\n\n\nexport default function getClippingRect(element, boundary, rootBoundary, strategy) {\n  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);\n  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);\n  var firstClippingParent = clippingParents[0];\n  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {\n    var rect = getClientRectFromMixedType(element, clippingParent, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromMixedType(element, firstClippingParent, strategy));\n  clippingRect.width = clippingRect.right - clippingRect.left;\n  clippingRect.height = clippingRect.bottom - clippingRect.top;\n  clippingRect.x = clippingRect.left;\n  clippingRect.y = clippingRect.top;\n  return clippingRect;\n}","import getWindow from \"./getWindow.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getViewportRect(element, strategy) {\n  var win = getWindow(element);\n  var html = getDocumentElement(element);\n  var visualViewport = win.visualViewport;\n  var width = html.clientWidth;\n  var height = html.clientHeight;\n  var x = 0;\n  var y = 0;\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    var layoutViewport = isLayoutViewport();\n\n    if (layoutViewport || !layoutViewport && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x + getWindowScrollBarX(element),\n    y: y\n  };\n}","import getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nimport { max } from \"../utils/math.js\"; // Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nexport default function getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  var html = getDocumentElement(element);\n  var winScroll = getWindowScroll(element);\n  var body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  var width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  var height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  var x = -winScroll.scrollLeft + getWindowScrollBarX(element);\n  var y = -winScroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n}","import getFreshSideObject from \"./getFreshSideObject.js\";\nexport default function mergePaddingObject(paddingObject) {\n  return Object.assign({}, getFreshSideObject(), paddingObject);\n}","export default function getFreshSideObject() {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n}","export default function expandToHashMap(value, keys) {\n  return keys.reduce(function (hashMap, key) {\n    hashMap[key] = value;\n    return hashMap;\n  }, {});\n}","import getClippingRect from \"../dom-utils/getClippingRect.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getBoundingClientRect from \"../dom-utils/getBoundingClientRect.js\";\nimport computeOffsets from \"./computeOffsets.js\";\nimport rectToClientRect from \"./rectToClientRect.js\";\nimport { clippingParents, reference, popper, bottom, top, right, basePlacements, viewport } from \"../enums.js\";\nimport { isElement } from \"../dom-utils/instanceOf.js\";\nimport mergePaddingObject from \"./mergePaddingObject.js\";\nimport expandToHashMap from \"./expandToHashMap.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport default function detectOverflow(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      _options$placement = _options.placement,\n      placement = _options$placement === void 0 ? state.placement : _options$placement,\n      _options$strategy = _options.strategy,\n      strategy = _options$strategy === void 0 ? state.strategy : _options$strategy,\n      _options$boundary = _options.boundary,\n      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,\n      _options$rootBoundary = _options.rootBoundary,\n      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,\n      _options$elementConte = _options.elementContext,\n      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,\n      _options$altBoundary = _options.altBoundary,\n      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,\n      _options$padding = _options.padding,\n      padding = _options$padding === void 0 ? 0 : _options$padding;\n  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n  var altContext = elementContext === popper ? reference : popper;\n  var popperRect = state.rects.popper;\n  var element = state.elements[altBoundary ? altContext : elementContext];\n  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary, strategy);\n  var referenceClientRect = getBoundingClientRect(state.elements.reference);\n  var popperOffsets = computeOffsets({\n    reference: referenceClientRect,\n    element: popperRect,\n    strategy: 'absolute',\n    placement: placement\n  });\n  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, popperOffsets));\n  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect\n  // 0 or negative = within the clipping rect\n\n  var overflowOffsets = {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element\n\n  if (elementContext === popper && offsetData) {\n    var offset = offsetData[placement];\n    Object.keys(overflowOffsets).forEach(function (key) {\n      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;\n      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';\n      overflowOffsets[key] += offset[axis] * multiply;\n    });\n  }\n\n  return overflowOffsets;\n}","import { max as mathMax, min as mathMin } from \"./math.js\";\nexport function within(min, value, max) {\n  return mathMax(min, mathMin(value, max));\n}\nexport function withinMaxClamp(min, value, max) {\n  var v = within(min, value, max);\n  return v > max ? max : v;\n}","import { top, bottom, left, right } from \"../enums.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\n\nfunction getSideOffsets(overflow, rect, preventedOffsets) {\n  if (preventedOffsets === void 0) {\n    preventedOffsets = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  return {\n    top: overflow.top - rect.height - preventedOffsets.y,\n    right: overflow.right - rect.width + preventedOffsets.x,\n    bottom: overflow.bottom - rect.height + preventedOffsets.y,\n    left: overflow.left - rect.width - preventedOffsets.x\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return [top, right, bottom, left].some(function (side) {\n    return overflow[side] >= 0;\n  });\n}\n\nfunction hide(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var preventedOffsets = state.modifiersData.preventOverflow;\n  var referenceOverflow = detectOverflow(state, {\n    elementContext: 'reference'\n  });\n  var popperAltOverflow = detectOverflow(state, {\n    altBoundary: true\n  });\n  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);\n  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);\n  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);\n  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);\n  state.modifiersData[name] = {\n    referenceClippingOffsets: referenceClippingOffsets,\n    popperEscapeOffsets: popperEscapeOffsets,\n    isReferenceHidden: isReferenceHidden,\n    hasPopperEscaped: hasPopperEscaped\n  };\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-reference-hidden': isReferenceHidden,\n    'data-popper-escaped': hasPopperEscaped\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'hide',\n  enabled: true,\n  phase: 'main',\n  requiresIfExists: ['preventOverflow'],\n  fn: hide\n};","import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nimport offset from \"./modifiers/offset.js\";\nimport flip from \"./modifiers/flip.js\";\nimport preventOverflow from \"./modifiers/preventOverflow.js\";\nimport arrow from \"./modifiers/arrow.js\";\nimport hide from \"./modifiers/hide.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles, offset, flip, preventOverflow, arrow, hide];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow }; // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper as createPopperLite } from \"./popper-lite.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport * from \"./modifiers/index.js\";","import computeOffsets from \"../utils/computeOffsets.js\";\n\nfunction popperOffsets(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  // Offsets are the actual position the popper needs to have to be\n  // properly positioned near its reference element\n  // This is the most basic placement, and will be adjusted by\n  // the modifiers in the next step\n  state.modifiersData[name] = computeOffsets({\n    reference: state.rects.reference,\n    element: state.rects.popper,\n    strategy: 'absolute',\n    placement: state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'popperOffsets',\n  enabled: true,\n  phase: 'read',\n  fn: popperOffsets,\n  data: {}\n};","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { top, left, right, placements } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport function distanceAndSkiddingToXY(placement, rects, offset) {\n  var basePlacement = getBasePlacement(placement);\n  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;\n\n  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {\n    placement: placement\n  })) : offset,\n      skidding = _ref[0],\n      distance = _ref[1];\n\n  skidding = skidding || 0;\n  distance = (distance || 0) * invertDistance;\n  return [left, right].indexOf(basePlacement) >= 0 ? {\n    x: distance,\n    y: skidding\n  } : {\n    x: skidding,\n    y: distance\n  };\n}\n\nfunction offset(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options,\n      name = _ref2.name;\n  var _options$offset = options.offset,\n      offset = _options$offset === void 0 ? [0, 0] : _options$offset;\n  var data = placements.reduce(function (acc, placement) {\n    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);\n    return acc;\n  }, {});\n  var _data$state$placement = data[state.placement],\n      x = _data$state$placement.x,\n      y = _data$state$placement.y;\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.modifiersData.popperOffsets.x += x;\n    state.modifiersData.popperOffsets.y += y;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'offset',\n  enabled: true,\n  phase: 'main',\n  requires: ['popperOffsets'],\n  fn: offset\n};","import getOppositePlacement from \"../utils/getOppositePlacement.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getOppositeVariationPlacement from \"../utils/getOppositeVariationPlacement.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport computeAutoPlacement from \"../utils/computeAutoPlacement.js\";\nimport { bottom, top, start, right, left, auto } from \"../enums.js\";\nimport getVariation from \"../utils/getVariation.js\"; // eslint-disable-next-line import/no-unused-modules\n\nfunction getExpandedFallbackPlacements(placement) {\n  if (getBasePlacement(placement) === auto) {\n    return [];\n  }\n\n  var oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];\n}\n\nfunction flip(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n\n  if (state.modifiersData[name]._skip) {\n    return;\n  }\n\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? true : _options$altAxis,\n      specifiedFallbackPlacements = options.fallbackPlacements,\n      padding = options.padding,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      _options$flipVariatio = options.flipVariations,\n      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio,\n      allowedAutoPlacements = options.allowedAutoPlacements;\n  var preferredPlacement = state.options.placement;\n  var basePlacement = getBasePlacement(preferredPlacement);\n  var isBasePlacement = basePlacement === preferredPlacement;\n  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));\n  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {\n    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding,\n      flipVariations: flipVariations,\n      allowedAutoPlacements: allowedAutoPlacements\n    }) : placement);\n  }, []);\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var checksMap = new Map();\n  var makeFallbackChecks = true;\n  var firstFittingPlacement = placements[0];\n\n  for (var i = 0; i < placements.length; i++) {\n    var placement = placements[i];\n\n    var _basePlacement = getBasePlacement(placement);\n\n    var isStartVariation = getVariation(placement) === start;\n    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;\n    var len = isVertical ? 'width' : 'height';\n    var overflow = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      altBoundary: altBoundary,\n      padding: padding\n    });\n    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;\n\n    if (referenceRect[len] > popperRect[len]) {\n      mainVariationSide = getOppositePlacement(mainVariationSide);\n    }\n\n    var altVariationSide = getOppositePlacement(mainVariationSide);\n    var checks = [];\n\n    if (checkMainAxis) {\n      checks.push(overflow[_basePlacement] <= 0);\n    }\n\n    if (checkAltAxis) {\n      checks.push(overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0);\n    }\n\n    if (checks.every(function (check) {\n      return check;\n    })) {\n      firstFittingPlacement = placement;\n      makeFallbackChecks = false;\n      break;\n    }\n\n    checksMap.set(placement, checks);\n  }\n\n  if (makeFallbackChecks) {\n    // `2` may be desired in some cases  research later\n    var numberOfChecks = flipVariations ? 3 : 1;\n\n    var _loop = function _loop(_i) {\n      var fittingPlacement = placements.find(function (placement) {\n        var checks = checksMap.get(placement);\n\n        if (checks) {\n          return checks.slice(0, _i).every(function (check) {\n            return check;\n          });\n        }\n      });\n\n      if (fittingPlacement) {\n        firstFittingPlacement = fittingPlacement;\n        return \"break\";\n      }\n    };\n\n    for (var _i = numberOfChecks; _i > 0; _i--) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  }\n\n  if (state.placement !== firstFittingPlacement) {\n    state.modifiersData[name]._skip = true;\n    state.placement = firstFittingPlacement;\n    state.reset = true;\n  }\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'flip',\n  enabled: true,\n  phase: 'main',\n  fn: flip,\n  requiresIfExists: ['offset'],\n  data: {\n    _skip: false\n  }\n};","import getVariation from \"./getVariation.js\";\nimport { variationPlacements, basePlacements, placements as allPlacements } from \"../enums.js\";\nimport detectOverflow from \"./detectOverflow.js\";\nimport getBasePlacement from \"./getBasePlacement.js\";\nexport default function computeAutoPlacement(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      placement = _options.placement,\n      boundary = _options.boundary,\n      rootBoundary = _options.rootBoundary,\n      padding = _options.padding,\n      flipVariations = _options.flipVariations,\n      _options$allowedAutoP = _options.allowedAutoPlacements,\n      allowedAutoPlacements = _options$allowedAutoP === void 0 ? allPlacements : _options$allowedAutoP;\n  var variation = getVariation(placement);\n  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {\n    return getVariation(placement) === variation;\n  }) : basePlacements;\n  var allowedPlacements = placements.filter(function (placement) {\n    return allowedAutoPlacements.indexOf(placement) >= 0;\n  });\n\n  if (allowedPlacements.length === 0) {\n    allowedPlacements = placements;\n\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(['Popper: The `allowedAutoPlacements` option did not allow any', 'placements. Ensure the `placement` option matches the variation', 'of the allowed placements.', 'For example, \"auto\" cannot be used to allow \"bottom-start\".', 'Use \"auto-start\" instead.'].join(' '));\n    }\n  } // $FlowFixMe[incompatible-type]: Flow seems to have problems with two array unions...\n\n\n  var overflows = allowedPlacements.reduce(function (acc, placement) {\n    acc[placement] = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding\n    })[getBasePlacement(placement)];\n    return acc;\n  }, {});\n  return Object.keys(overflows).sort(function (a, b) {\n    return overflows[a] - overflows[b];\n  });\n}","import { top, left, right, bottom, start } from \"../enums.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport getAltAxis from \"../utils/getAltAxis.js\";\nimport { within, withinMaxClamp } from \"../utils/within.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport getFreshSideObject from \"../utils/getFreshSideObject.js\";\nimport { min as mathMin, max as mathMax } from \"../utils/math.js\";\n\nfunction preventOverflow(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      padding = options.padding,\n      _options$tether = options.tether,\n      tether = _options$tether === void 0 ? true : _options$tether,\n      _options$tetherOffset = options.tetherOffset,\n      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;\n  var overflow = detectOverflow(state, {\n    boundary: boundary,\n    rootBoundary: rootBoundary,\n    padding: padding,\n    altBoundary: altBoundary\n  });\n  var basePlacement = getBasePlacement(state.placement);\n  var variation = getVariation(state.placement);\n  var isBasePlacement = !variation;\n  var mainAxis = getMainAxisFromPlacement(basePlacement);\n  var altAxis = getAltAxis(mainAxis);\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : tetherOffset;\n  var normalizedTetherOffsetValue = typeof tetherOffsetValue === 'number' ? {\n    mainAxis: tetherOffsetValue,\n    altAxis: tetherOffsetValue\n  } : Object.assign({\n    mainAxis: 0,\n    altAxis: 0\n  }, tetherOffsetValue);\n  var offsetModifierState = state.modifiersData.offset ? state.modifiersData.offset[state.placement] : null;\n  var data = {\n    x: 0,\n    y: 0\n  };\n\n  if (!popperOffsets) {\n    return;\n  }\n\n  if (checkMainAxis) {\n    var _offsetModifierState$;\n\n    var mainSide = mainAxis === 'y' ? top : left;\n    var altSide = mainAxis === 'y' ? bottom : right;\n    var len = mainAxis === 'y' ? 'height' : 'width';\n    var offset = popperOffsets[mainAxis];\n    var min = offset + overflow[mainSide];\n    var max = offset - overflow[altSide];\n    var additive = tether ? -popperRect[len] / 2 : 0;\n    var minLen = variation === start ? referenceRect[len] : popperRect[len];\n    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go\n    // outside the reference bounds\n\n    var arrowElement = state.elements.arrow;\n    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {\n      width: 0,\n      height: 0\n    };\n    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();\n    var arrowPaddingMin = arrowPaddingObject[mainSide];\n    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want\n    // to include its full size in the calculation. If the reference is small\n    // and near the edge of a boundary, the popper can overflow even if the\n    // reference is not overflowing as well (e.g. virtual elements with no\n    // width or height)\n\n    var arrowLen = within(0, referenceRect[len], arrowRect[len]);\n    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis : minLen - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis;\n    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis : maxLen + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis;\n    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);\n    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;\n    var offsetModifierValue = (_offsetModifierState$ = offsetModifierState == null ? void 0 : offsetModifierState[mainAxis]) != null ? _offsetModifierState$ : 0;\n    var tetherMin = offset + minOffset - offsetModifierValue - clientOffset;\n    var tetherMax = offset + maxOffset - offsetModifierValue;\n    var preventedOffset = within(tether ? mathMin(min, tetherMin) : min, offset, tether ? mathMax(max, tetherMax) : max);\n    popperOffsets[mainAxis] = preventedOffset;\n    data[mainAxis] = preventedOffset - offset;\n  }\n\n  if (checkAltAxis) {\n    var _offsetModifierState$2;\n\n    var _mainSide = mainAxis === 'x' ? top : left;\n\n    var _altSide = mainAxis === 'x' ? bottom : right;\n\n    var _offset = popperOffsets[altAxis];\n\n    var _len = altAxis === 'y' ? 'height' : 'width';\n\n    var _min = _offset + overflow[_mainSide];\n\n    var _max = _offset - overflow[_altSide];\n\n    var isOriginSide = [top, left].indexOf(basePlacement) !== -1;\n\n    var _offsetModifierValue = (_offsetModifierState$2 = offsetModifierState == null ? void 0 : offsetModifierState[altAxis]) != null ? _offsetModifierState$2 : 0;\n\n    var _tetherMin = isOriginSide ? _min : _offset - referenceRect[_len] - popperRect[_len] - _offsetModifierValue + normalizedTetherOffsetValue.altAxis;\n\n    var _tetherMax = isOriginSide ? _offset + referenceRect[_len] + popperRect[_len] - _offsetModifierValue - normalizedTetherOffsetValue.altAxis : _max;\n\n    var _preventedOffset = tether && isOriginSide ? withinMaxClamp(_tetherMin, _offset, _tetherMax) : within(tether ? _tetherMin : _min, _offset, tether ? _tetherMax : _max);\n\n    popperOffsets[altAxis] = _preventedOffset;\n    data[altAxis] = _preventedOffset - _offset;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'preventOverflow',\n  enabled: true,\n  phase: 'main',\n  fn: preventOverflow,\n  requiresIfExists: ['offset']\n};","export default function getAltAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport contains from \"../dom-utils/contains.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport { within } from \"../utils/within.js\";\nimport mergePaddingObject from \"../utils/mergePaddingObject.js\";\nimport expandToHashMap from \"../utils/expandToHashMap.js\";\nimport { left, right, basePlacements, top, bottom } from \"../enums.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar toPaddingObject = function toPaddingObject(padding, state) {\n  padding = typeof padding === 'function' ? padding(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : padding;\n  return mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n};\n\nfunction arrow(_ref) {\n  var _state$modifiersData$;\n\n  var state = _ref.state,\n      name = _ref.name,\n      options = _ref.options;\n  var arrowElement = state.elements.arrow;\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var basePlacement = getBasePlacement(state.placement);\n  var axis = getMainAxisFromPlacement(basePlacement);\n  var isVertical = [left, right].indexOf(basePlacement) >= 0;\n  var len = isVertical ? 'height' : 'width';\n\n  if (!arrowElement || !popperOffsets) {\n    return;\n  }\n\n  var paddingObject = toPaddingObject(options.padding, state);\n  var arrowRect = getLayoutRect(arrowElement);\n  var minProp = axis === 'y' ? top : left;\n  var maxProp = axis === 'y' ? bottom : right;\n  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];\n  var startDiff = popperOffsets[axis] - state.rects.reference[axis];\n  var arrowOffsetParent = getOffsetParent(arrowElement);\n  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is\n  // outside of the popper bounds\n\n  var min = paddingObject[minProp];\n  var max = clientSize - arrowRect[len] - paddingObject[maxProp];\n  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;\n  var offset = within(min, center, max); // Prevents breaking syntax highlighting...\n\n  var axisProp = axis;\n  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options;\n  var _options$element = options.element,\n      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element;\n\n  if (arrowElement == null) {\n    return;\n  } // CSS selector\n\n\n  if (typeof arrowElement === 'string') {\n    arrowElement = state.elements.popper.querySelector(arrowElement);\n\n    if (!arrowElement) {\n      return;\n    }\n  }\n\n  if (process.env.NODE_ENV !== \"production\") {\n    if (!isHTMLElement(arrowElement)) {\n      console.error(['Popper: \"arrow\" element must be an HTMLElement (not an SVGElement).', 'To use an SVG arrow, wrap it in an HTMLElement that will be used as', 'the arrow.'].join(' '));\n    }\n  }\n\n  if (!contains(state.elements.popper, arrowElement)) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(['Popper: \"arrow\" modifier\\'s `element` must be a child of the popper', 'element.'].join(' '));\n    }\n\n    return;\n  }\n\n  state.elements.arrow = arrowElement;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'arrow',\n  enabled: true,\n  phase: 'main',\n  fn: arrow,\n  effect: effect,\n  requires: ['popperOffsets'],\n  requiresIfExists: ['preventOverflow']\n};","/**!\n* tippy.js v6.3.7\n* (c) 2017-2021 atomiks\n* MIT License\n*/\nimport { createPopper, applyStyles } from '@popperjs/core';\n\nvar ROUND_ARROW = '<svg width=\"16\" height=\"6\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 6s1.796-.013 4.67-3.615C5.851.9 6.93.006 8 0c1.07-.006 2.148.887 3.343 2.385C14.233 6.005 16 6 16 6H0z\"></svg>';\nvar BOX_CLASS = \"tippy-box\";\nvar CONTENT_CLASS = \"tippy-content\";\nvar BACKDROP_CLASS = \"tippy-backdrop\";\nvar ARROW_CLASS = \"tippy-arrow\";\nvar SVG_ARROW_CLASS = \"tippy-svg-arrow\";\nvar TOUCH_OPTIONS = {\n  passive: true,\n  capture: true\n};\nvar TIPPY_DEFAULT_APPEND_TO = function TIPPY_DEFAULT_APPEND_TO() {\n  return document.body;\n};\n\nfunction hasOwnProperty(obj, key) {\n  return {}.hasOwnProperty.call(obj, key);\n}\nfunction getValueAtIndexOrReturn(value, index, defaultValue) {\n  if (Array.isArray(value)) {\n    var v = value[index];\n    return v == null ? Array.isArray(defaultValue) ? defaultValue[index] : defaultValue : v;\n  }\n\n  return value;\n}\nfunction isType(value, type) {\n  var str = {}.toString.call(value);\n  return str.indexOf('[object') === 0 && str.indexOf(type + \"]\") > -1;\n}\nfunction invokeWithArgsOrReturn(value, args) {\n  return typeof value === 'function' ? value.apply(void 0, args) : value;\n}\nfunction debounce(fn, ms) {\n  // Avoid wrapping in `setTimeout` if ms is 0 anyway\n  if (ms === 0) {\n    return fn;\n  }\n\n  var timeout;\n  return function (arg) {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      fn(arg);\n    }, ms);\n  };\n}\nfunction removeProperties(obj, keys) {\n  var clone = Object.assign({}, obj);\n  keys.forEach(function (key) {\n    delete clone[key];\n  });\n  return clone;\n}\nfunction splitBySpaces(value) {\n  return value.split(/\\s+/).filter(Boolean);\n}\nfunction normalizeToArray(value) {\n  return [].concat(value);\n}\nfunction pushIfUnique(arr, value) {\n  if (arr.indexOf(value) === -1) {\n    arr.push(value);\n  }\n}\nfunction unique(arr) {\n  return arr.filter(function (item, index) {\n    return arr.indexOf(item) === index;\n  });\n}\nfunction getBasePlacement(placement) {\n  return placement.split('-')[0];\n}\nfunction arrayFrom(value) {\n  return [].slice.call(value);\n}\nfunction removeUndefinedProps(obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    if (obj[key] !== undefined) {\n      acc[key] = obj[key];\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction div() {\n  return document.createElement('div');\n}\nfunction isElement(value) {\n  return ['Element', 'Fragment'].some(function (type) {\n    return isType(value, type);\n  });\n}\nfunction isNodeList(value) {\n  return isType(value, 'NodeList');\n}\nfunction isMouseEvent(value) {\n  return isType(value, 'MouseEvent');\n}\nfunction isReferenceElement(value) {\n  return !!(value && value._tippy && value._tippy.reference === value);\n}\nfunction getArrayOfElements(value) {\n  if (isElement(value)) {\n    return [value];\n  }\n\n  if (isNodeList(value)) {\n    return arrayFrom(value);\n  }\n\n  if (Array.isArray(value)) {\n    return value;\n  }\n\n  return arrayFrom(document.querySelectorAll(value));\n}\nfunction setTransitionDuration(els, value) {\n  els.forEach(function (el) {\n    if (el) {\n      el.style.transitionDuration = value + \"ms\";\n    }\n  });\n}\nfunction setVisibilityState(els, state) {\n  els.forEach(function (el) {\n    if (el) {\n      el.setAttribute('data-state', state);\n    }\n  });\n}\nfunction getOwnerDocument(elementOrElements) {\n  var _element$ownerDocumen;\n\n  var _normalizeToArray = normalizeToArray(elementOrElements),\n      element = _normalizeToArray[0]; // Elements created via a <template> have an ownerDocument with no reference to the body\n\n\n  return element != null && (_element$ownerDocumen = element.ownerDocument) != null && _element$ownerDocumen.body ? element.ownerDocument : document;\n}\nfunction isCursorOutsideInteractiveBorder(popperTreeData, event) {\n  var clientX = event.clientX,\n      clientY = event.clientY;\n  return popperTreeData.every(function (_ref) {\n    var popperRect = _ref.popperRect,\n        popperState = _ref.popperState,\n        props = _ref.props;\n    var interactiveBorder = props.interactiveBorder;\n    var basePlacement = getBasePlacement(popperState.placement);\n    var offsetData = popperState.modifiersData.offset;\n\n    if (!offsetData) {\n      return true;\n    }\n\n    var topDistance = basePlacement === 'bottom' ? offsetData.top.y : 0;\n    var bottomDistance = basePlacement === 'top' ? offsetData.bottom.y : 0;\n    var leftDistance = basePlacement === 'right' ? offsetData.left.x : 0;\n    var rightDistance = basePlacement === 'left' ? offsetData.right.x : 0;\n    var exceedsTop = popperRect.top - clientY + topDistance > interactiveBorder;\n    var exceedsBottom = clientY - popperRect.bottom - bottomDistance > interactiveBorder;\n    var exceedsLeft = popperRect.left - clientX + leftDistance > interactiveBorder;\n    var exceedsRight = clientX - popperRect.right - rightDistance > interactiveBorder;\n    return exceedsTop || exceedsBottom || exceedsLeft || exceedsRight;\n  });\n}\nfunction updateTransitionEndListener(box, action, listener) {\n  var method = action + \"EventListener\"; // some browsers apparently support `transition` (unprefixed) but only fire\n  // `webkitTransitionEnd`...\n\n  ['transitionend', 'webkitTransitionEnd'].forEach(function (event) {\n    box[method](event, listener);\n  });\n}\n/**\n * Compared to xxx.contains, this function works for dom structures with shadow\n * dom\n */\n\nfunction actualContains(parent, child) {\n  var target = child;\n\n  while (target) {\n    var _target$getRootNode;\n\n    if (parent.contains(target)) {\n      return true;\n    }\n\n    target = target.getRootNode == null ? void 0 : (_target$getRootNode = target.getRootNode()) == null ? void 0 : _target$getRootNode.host;\n  }\n\n  return false;\n}\n\nvar currentInput = {\n  isTouch: false\n};\nvar lastMouseMoveTime = 0;\n/**\n * When a `touchstart` event is fired, it's assumed the user is using touch\n * input. We'll bind a `mousemove` event listener to listen for mouse input in\n * the future. This way, the `isTouch` property is fully dynamic and will handle\n * hybrid devices that use a mix of touch + mouse input.\n */\n\nfunction onDocumentTouchStart() {\n  if (currentInput.isTouch) {\n    return;\n  }\n\n  currentInput.isTouch = true;\n\n  if (window.performance) {\n    document.addEventListener('mousemove', onDocumentMouseMove);\n  }\n}\n/**\n * When two `mousemove` event are fired consecutively within 20ms, it's assumed\n * the user is using mouse input again. `mousemove` can fire on touch devices as\n * well, but very rarely that quickly.\n */\n\nfunction onDocumentMouseMove() {\n  var now = performance.now();\n\n  if (now - lastMouseMoveTime < 20) {\n    currentInput.isTouch = false;\n    document.removeEventListener('mousemove', onDocumentMouseMove);\n  }\n\n  lastMouseMoveTime = now;\n}\n/**\n * When an element is in focus and has a tippy, leaving the tab/window and\n * returning causes it to show again. For mouse users this is unexpected, but\n * for keyboard use it makes sense.\n * TODO: find a better technique to solve this problem\n */\n\nfunction onWindowBlur() {\n  var activeElement = document.activeElement;\n\n  if (isReferenceElement(activeElement)) {\n    var instance = activeElement._tippy;\n\n    if (activeElement.blur && !instance.state.isVisible) {\n      activeElement.blur();\n    }\n  }\n}\nfunction bindGlobalEventListeners() {\n  document.addEventListener('touchstart', onDocumentTouchStart, TOUCH_OPTIONS);\n  window.addEventListener('blur', onWindowBlur);\n}\n\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\nvar isIE11 = isBrowser ? // @ts-ignore\n!!window.msCrypto : false;\n\nfunction createMemoryLeakWarning(method) {\n  var txt = method === 'destroy' ? 'n already-' : ' ';\n  return [method + \"() was called on a\" + txt + \"destroyed instance. This is a no-op but\", 'indicates a potential memory leak.'].join(' ');\n}\nfunction clean(value) {\n  var spacesAndTabs = /[ \\t]{2,}/g;\n  var lineStartWithSpaces = /^[ \\t]*/gm;\n  return value.replace(spacesAndTabs, ' ').replace(lineStartWithSpaces, '').trim();\n}\n\nfunction getDevMessage(message) {\n  return clean(\"\\n  %ctippy.js\\n\\n  %c\" + clean(message) + \"\\n\\n  %c\\uD83D\\uDC77\\u200D This is a development-only message. It will be removed in production.\\n  \");\n}\n\nfunction getFormattedMessage(message) {\n  return [getDevMessage(message), // title\n  'color: #00C584; font-size: 1.3em; font-weight: bold;', // message\n  'line-height: 1.5', // footer\n  'color: #a6a095;'];\n} // Assume warnings and errors never have the same message\n\nvar visitedMessages;\n\nif (process.env.NODE_ENV !== \"production\") {\n  resetVisitedMessages();\n}\n\nfunction resetVisitedMessages() {\n  visitedMessages = new Set();\n}\nfunction warnWhen(condition, message) {\n  if (condition && !visitedMessages.has(message)) {\n    var _console;\n\n    visitedMessages.add(message);\n\n    (_console = console).warn.apply(_console, getFormattedMessage(message));\n  }\n}\nfunction errorWhen(condition, message) {\n  if (condition && !visitedMessages.has(message)) {\n    var _console2;\n\n    visitedMessages.add(message);\n\n    (_console2 = console).error.apply(_console2, getFormattedMessage(message));\n  }\n}\nfunction validateTargets(targets) {\n  var didPassFalsyValue = !targets;\n  var didPassPlainObject = Object.prototype.toString.call(targets) === '[object Object]' && !targets.addEventListener;\n  errorWhen(didPassFalsyValue, ['tippy() was passed', '`' + String(targets) + '`', 'as its targets (first) argument. Valid types are: String, Element,', 'Element[], or NodeList.'].join(' '));\n  errorWhen(didPassPlainObject, ['tippy() was passed a plain object which is not supported as an argument', 'for virtual positioning. Use props.getReferenceClientRect instead.'].join(' '));\n}\n\nvar pluginProps = {\n  animateFill: false,\n  followCursor: false,\n  inlinePositioning: false,\n  sticky: false\n};\nvar renderProps = {\n  allowHTML: false,\n  animation: 'fade',\n  arrow: true,\n  content: '',\n  inertia: false,\n  maxWidth: 350,\n  role: 'tooltip',\n  theme: '',\n  zIndex: 9999\n};\nvar defaultProps = Object.assign({\n  appendTo: TIPPY_DEFAULT_APPEND_TO,\n  aria: {\n    content: 'auto',\n    expanded: 'auto'\n  },\n  delay: 0,\n  duration: [300, 250],\n  getReferenceClientRect: null,\n  hideOnClick: true,\n  ignoreAttributes: false,\n  interactive: false,\n  interactiveBorder: 2,\n  interactiveDebounce: 0,\n  moveTransition: '',\n  offset: [0, 10],\n  onAfterUpdate: function onAfterUpdate() {},\n  onBeforeUpdate: function onBeforeUpdate() {},\n  onCreate: function onCreate() {},\n  onDestroy: function onDestroy() {},\n  onHidden: function onHidden() {},\n  onHide: function onHide() {},\n  onMount: function onMount() {},\n  onShow: function onShow() {},\n  onShown: function onShown() {},\n  onTrigger: function onTrigger() {},\n  onUntrigger: function onUntrigger() {},\n  onClickOutside: function onClickOutside() {},\n  placement: 'top',\n  plugins: [],\n  popperOptions: {},\n  render: null,\n  showOnCreate: false,\n  touch: true,\n  trigger: 'mouseenter focus',\n  triggerTarget: null\n}, pluginProps, renderProps);\nvar defaultKeys = Object.keys(defaultProps);\nvar setDefaultProps = function setDefaultProps(partialProps) {\n  /* istanbul ignore else */\n  if (process.env.NODE_ENV !== \"production\") {\n    validateProps(partialProps, []);\n  }\n\n  var keys = Object.keys(partialProps);\n  keys.forEach(function (key) {\n    defaultProps[key] = partialProps[key];\n  });\n};\nfunction getExtendedPassedProps(passedProps) {\n  var plugins = passedProps.plugins || [];\n  var pluginProps = plugins.reduce(function (acc, plugin) {\n    var name = plugin.name,\n        defaultValue = plugin.defaultValue;\n\n    if (name) {\n      var _name;\n\n      acc[name] = passedProps[name] !== undefined ? passedProps[name] : (_name = defaultProps[name]) != null ? _name : defaultValue;\n    }\n\n    return acc;\n  }, {});\n  return Object.assign({}, passedProps, pluginProps);\n}\nfunction getDataAttributeProps(reference, plugins) {\n  var propKeys = plugins ? Object.keys(getExtendedPassedProps(Object.assign({}, defaultProps, {\n    plugins: plugins\n  }))) : defaultKeys;\n  var props = propKeys.reduce(function (acc, key) {\n    var valueAsString = (reference.getAttribute(\"data-tippy-\" + key) || '').trim();\n\n    if (!valueAsString) {\n      return acc;\n    }\n\n    if (key === 'content') {\n      acc[key] = valueAsString;\n    } else {\n      try {\n        acc[key] = JSON.parse(valueAsString);\n      } catch (e) {\n        acc[key] = valueAsString;\n      }\n    }\n\n    return acc;\n  }, {});\n  return props;\n}\nfunction evaluateProps(reference, props) {\n  var out = Object.assign({}, props, {\n    content: invokeWithArgsOrReturn(props.content, [reference])\n  }, props.ignoreAttributes ? {} : getDataAttributeProps(reference, props.plugins));\n  out.aria = Object.assign({}, defaultProps.aria, out.aria);\n  out.aria = {\n    expanded: out.aria.expanded === 'auto' ? props.interactive : out.aria.expanded,\n    content: out.aria.content === 'auto' ? props.interactive ? null : 'describedby' : out.aria.content\n  };\n  return out;\n}\nfunction validateProps(partialProps, plugins) {\n  if (partialProps === void 0) {\n    partialProps = {};\n  }\n\n  if (plugins === void 0) {\n    plugins = [];\n  }\n\n  var keys = Object.keys(partialProps);\n  keys.forEach(function (prop) {\n    var nonPluginProps = removeProperties(defaultProps, Object.keys(pluginProps));\n    var didPassUnknownProp = !hasOwnProperty(nonPluginProps, prop); // Check if the prop exists in `plugins`\n\n    if (didPassUnknownProp) {\n      didPassUnknownProp = plugins.filter(function (plugin) {\n        return plugin.name === prop;\n      }).length === 0;\n    }\n\n    warnWhen(didPassUnknownProp, [\"`\" + prop + \"`\", \"is not a valid prop. You may have spelled it incorrectly, or if it's\", 'a plugin, forgot to pass it in an array as props.plugins.', '\\n\\n', 'All props: https://atomiks.github.io/tippyjs/v6/all-props/\\n', 'Plugins: https://atomiks.github.io/tippyjs/v6/plugins/'].join(' '));\n  });\n}\n\nvar innerHTML = function innerHTML() {\n  return 'innerHTML';\n};\n\nfunction dangerouslySetInnerHTML(element, html) {\n  element[innerHTML()] = html;\n}\n\nfunction createArrowElement(value) {\n  var arrow = div();\n\n  if (value === true) {\n    arrow.className = ARROW_CLASS;\n  } else {\n    arrow.className = SVG_ARROW_CLASS;\n\n    if (isElement(value)) {\n      arrow.appendChild(value);\n    } else {\n      dangerouslySetInnerHTML(arrow, value);\n    }\n  }\n\n  return arrow;\n}\n\nfunction setContent(content, props) {\n  if (isElement(props.content)) {\n    dangerouslySetInnerHTML(content, '');\n    content.appendChild(props.content);\n  } else if (typeof props.content !== 'function') {\n    if (props.allowHTML) {\n      dangerouslySetInnerHTML(content, props.content);\n    } else {\n      content.textContent = props.content;\n    }\n  }\n}\nfunction getChildren(popper) {\n  var box = popper.firstElementChild;\n  var boxChildren = arrayFrom(box.children);\n  return {\n    box: box,\n    content: boxChildren.find(function (node) {\n      return node.classList.contains(CONTENT_CLASS);\n    }),\n    arrow: boxChildren.find(function (node) {\n      return node.classList.contains(ARROW_CLASS) || node.classList.contains(SVG_ARROW_CLASS);\n    }),\n    backdrop: boxChildren.find(function (node) {\n      return node.classList.contains(BACKDROP_CLASS);\n    })\n  };\n}\nfunction render(instance) {\n  var popper = div();\n  var box = div();\n  box.className = BOX_CLASS;\n  box.setAttribute('data-state', 'hidden');\n  box.setAttribute('tabindex', '-1');\n  var content = div();\n  content.className = CONTENT_CLASS;\n  content.setAttribute('data-state', 'hidden');\n  setContent(content, instance.props);\n  popper.appendChild(box);\n  box.appendChild(content);\n  onUpdate(instance.props, instance.props);\n\n  function onUpdate(prevProps, nextProps) {\n    var _getChildren = getChildren(popper),\n        box = _getChildren.box,\n        content = _getChildren.content,\n        arrow = _getChildren.arrow;\n\n    if (nextProps.theme) {\n      box.setAttribute('data-theme', nextProps.theme);\n    } else {\n      box.removeAttribute('data-theme');\n    }\n\n    if (typeof nextProps.animation === 'string') {\n      box.setAttribute('data-animation', nextProps.animation);\n    } else {\n      box.removeAttribute('data-animation');\n    }\n\n    if (nextProps.inertia) {\n      box.setAttribute('data-inertia', '');\n    } else {\n      box.removeAttribute('data-inertia');\n    }\n\n    box.style.maxWidth = typeof nextProps.maxWidth === 'number' ? nextProps.maxWidth + \"px\" : nextProps.maxWidth;\n\n    if (nextProps.role) {\n      box.setAttribute('role', nextProps.role);\n    } else {\n      box.removeAttribute('role');\n    }\n\n    if (prevProps.content !== nextProps.content || prevProps.allowHTML !== nextProps.allowHTML) {\n      setContent(content, instance.props);\n    }\n\n    if (nextProps.arrow) {\n      if (!arrow) {\n        box.appendChild(createArrowElement(nextProps.arrow));\n      } else if (prevProps.arrow !== nextProps.arrow) {\n        box.removeChild(arrow);\n        box.appendChild(createArrowElement(nextProps.arrow));\n      }\n    } else if (arrow) {\n      box.removeChild(arrow);\n    }\n  }\n\n  return {\n    popper: popper,\n    onUpdate: onUpdate\n  };\n} // Runtime check to identify if the render function is the default one; this\n// way we can apply default CSS transitions logic and it can be tree-shaken away\n\nrender.$$tippy = true;\n\nvar idCounter = 1;\nvar mouseMoveListeners = []; // Used by `hideAll()`\n\nvar mountedInstances = [];\nfunction createTippy(reference, passedProps) {\n  var props = evaluateProps(reference, Object.assign({}, defaultProps, getExtendedPassedProps(removeUndefinedProps(passedProps)))); // ===========================================================================\n  //  Private members\n  // ===========================================================================\n\n  var showTimeout;\n  var hideTimeout;\n  var scheduleHideAnimationFrame;\n  var isVisibleFromClick = false;\n  var didHideDueToDocumentMouseDown = false;\n  var didTouchMove = false;\n  var ignoreOnFirstUpdate = false;\n  var lastTriggerEvent;\n  var currentTransitionEndListener;\n  var onFirstUpdate;\n  var listeners = [];\n  var debouncedOnMouseMove = debounce(onMouseMove, props.interactiveDebounce);\n  var currentTarget; // ===========================================================================\n  //  Public members\n  // ===========================================================================\n\n  var id = idCounter++;\n  var popperInstance = null;\n  var plugins = unique(props.plugins);\n  var state = {\n    // Is the instance currently enabled?\n    isEnabled: true,\n    // Is the tippy currently showing and not transitioning out?\n    isVisible: false,\n    // Has the instance been destroyed?\n    isDestroyed: false,\n    // Is the tippy currently mounted to the DOM?\n    isMounted: false,\n    // Has the tippy finished transitioning in?\n    isShown: false\n  };\n  var instance = {\n    // properties\n    id: id,\n    reference: reference,\n    popper: div(),\n    popperInstance: popperInstance,\n    props: props,\n    state: state,\n    plugins: plugins,\n    // methods\n    clearDelayTimeouts: clearDelayTimeouts,\n    setProps: setProps,\n    setContent: setContent,\n    show: show,\n    hide: hide,\n    hideWithInteractivity: hideWithInteractivity,\n    enable: enable,\n    disable: disable,\n    unmount: unmount,\n    destroy: destroy\n  }; // TODO: Investigate why this early return causes a TDZ error in the tests \n  // it doesn't seem to happen in the browser\n\n  /* istanbul ignore if */\n\n  if (!props.render) {\n    if (process.env.NODE_ENV !== \"production\") {\n      errorWhen(true, 'render() function has not been supplied.');\n    }\n\n    return instance;\n  } // ===========================================================================\n  // Initial mutations\n  // ===========================================================================\n\n\n  var _props$render = props.render(instance),\n      popper = _props$render.popper,\n      onUpdate = _props$render.onUpdate;\n\n  popper.setAttribute('data-tippy-root', '');\n  popper.id = \"tippy-\" + instance.id;\n  instance.popper = popper;\n  reference._tippy = instance;\n  popper._tippy = instance;\n  var pluginsHooks = plugins.map(function (plugin) {\n    return plugin.fn(instance);\n  });\n  var hasAriaExpanded = reference.hasAttribute('aria-expanded');\n  addListeners();\n  handleAriaExpandedAttribute();\n  handleStyles();\n  invokeHook('onCreate', [instance]);\n\n  if (props.showOnCreate) {\n    scheduleShow();\n  } // Prevent a tippy with a delay from hiding if the cursor left then returned\n  // before it started hiding\n\n\n  popper.addEventListener('mouseenter', function () {\n    if (instance.props.interactive && instance.state.isVisible) {\n      instance.clearDelayTimeouts();\n    }\n  });\n  popper.addEventListener('mouseleave', function () {\n    if (instance.props.interactive && instance.props.trigger.indexOf('mouseenter') >= 0) {\n      getDocument().addEventListener('mousemove', debouncedOnMouseMove);\n    }\n  });\n  return instance; // ===========================================================================\n  //  Private methods\n  // ===========================================================================\n\n  function getNormalizedTouchSettings() {\n    var touch = instance.props.touch;\n    return Array.isArray(touch) ? touch : [touch, 0];\n  }\n\n  function getIsCustomTouchBehavior() {\n    return getNormalizedTouchSettings()[0] === 'hold';\n  }\n\n  function getIsDefaultRenderFn() {\n    var _instance$props$rende;\n\n    // @ts-ignore\n    return !!((_instance$props$rende = instance.props.render) != null && _instance$props$rende.$$tippy);\n  }\n\n  function getCurrentTarget() {\n    return currentTarget || reference;\n  }\n\n  function getDocument() {\n    var parent = getCurrentTarget().parentNode;\n    return parent ? getOwnerDocument(parent) : document;\n  }\n\n  function getDefaultTemplateChildren() {\n    return getChildren(popper);\n  }\n\n  function getDelay(isShow) {\n    // For touch or keyboard input, force `0` delay for UX reasons\n    // Also if the instance is mounted but not visible (transitioning out),\n    // ignore delay\n    if (instance.state.isMounted && !instance.state.isVisible || currentInput.isTouch || lastTriggerEvent && lastTriggerEvent.type === 'focus') {\n      return 0;\n    }\n\n    return getValueAtIndexOrReturn(instance.props.delay, isShow ? 0 : 1, defaultProps.delay);\n  }\n\n  function handleStyles(fromHide) {\n    if (fromHide === void 0) {\n      fromHide = false;\n    }\n\n    popper.style.pointerEvents = instance.props.interactive && !fromHide ? '' : 'none';\n    popper.style.zIndex = \"\" + instance.props.zIndex;\n  }\n\n  function invokeHook(hook, args, shouldInvokePropsHook) {\n    if (shouldInvokePropsHook === void 0) {\n      shouldInvokePropsHook = true;\n    }\n\n    pluginsHooks.forEach(function (pluginHooks) {\n      if (pluginHooks[hook]) {\n        pluginHooks[hook].apply(pluginHooks, args);\n      }\n    });\n\n    if (shouldInvokePropsHook) {\n      var _instance$props;\n\n      (_instance$props = instance.props)[hook].apply(_instance$props, args);\n    }\n  }\n\n  function handleAriaContentAttribute() {\n    var aria = instance.props.aria;\n\n    if (!aria.content) {\n      return;\n    }\n\n    var attr = \"aria-\" + aria.content;\n    var id = popper.id;\n    var nodes = normalizeToArray(instance.props.triggerTarget || reference);\n    nodes.forEach(function (node) {\n      var currentValue = node.getAttribute(attr);\n\n      if (instance.state.isVisible) {\n        node.setAttribute(attr, currentValue ? currentValue + \" \" + id : id);\n      } else {\n        var nextValue = currentValue && currentValue.replace(id, '').trim();\n\n        if (nextValue) {\n          node.setAttribute(attr, nextValue);\n        } else {\n          node.removeAttribute(attr);\n        }\n      }\n    });\n  }\n\n  function handleAriaExpandedAttribute() {\n    if (hasAriaExpanded || !instance.props.aria.expanded) {\n      return;\n    }\n\n    var nodes = normalizeToArray(instance.props.triggerTarget || reference);\n    nodes.forEach(function (node) {\n      if (instance.props.interactive) {\n        node.setAttribute('aria-expanded', instance.state.isVisible && node === getCurrentTarget() ? 'true' : 'false');\n      } else {\n        node.removeAttribute('aria-expanded');\n      }\n    });\n  }\n\n  function cleanupInteractiveMouseListeners() {\n    getDocument().removeEventListener('mousemove', debouncedOnMouseMove);\n    mouseMoveListeners = mouseMoveListeners.filter(function (listener) {\n      return listener !== debouncedOnMouseMove;\n    });\n  }\n\n  function onDocumentPress(event) {\n    // Moved finger to scroll instead of an intentional tap outside\n    if (currentInput.isTouch) {\n      if (didTouchMove || event.type === 'mousedown') {\n        return;\n      }\n    }\n\n    var actualTarget = event.composedPath && event.composedPath()[0] || event.target; // Clicked on interactive popper\n\n    if (instance.props.interactive && actualContains(popper, actualTarget)) {\n      return;\n    } // Clicked on the event listeners target\n\n\n    if (normalizeToArray(instance.props.triggerTarget || reference).some(function (el) {\n      return actualContains(el, actualTarget);\n    })) {\n      if (currentInput.isTouch) {\n        return;\n      }\n\n      if (instance.state.isVisible && instance.props.trigger.indexOf('click') >= 0) {\n        return;\n      }\n    } else {\n      invokeHook('onClickOutside', [instance, event]);\n    }\n\n    if (instance.props.hideOnClick === true) {\n      instance.clearDelayTimeouts();\n      instance.hide(); // `mousedown` event is fired right before `focus` if pressing the\n      // currentTarget. This lets a tippy with `focus` trigger know that it\n      // should not show\n\n      didHideDueToDocumentMouseDown = true;\n      setTimeout(function () {\n        didHideDueToDocumentMouseDown = false;\n      }); // The listener gets added in `scheduleShow()`, but this may be hiding it\n      // before it shows, and hide()'s early bail-out behavior can prevent it\n      // from being cleaned up\n\n      if (!instance.state.isMounted) {\n        removeDocumentPress();\n      }\n    }\n  }\n\n  function onTouchMove() {\n    didTouchMove = true;\n  }\n\n  function onTouchStart() {\n    didTouchMove = false;\n  }\n\n  function addDocumentPress() {\n    var doc = getDocument();\n    doc.addEventListener('mousedown', onDocumentPress, true);\n    doc.addEventListener('touchend', onDocumentPress, TOUCH_OPTIONS);\n    doc.addEventListener('touchstart', onTouchStart, TOUCH_OPTIONS);\n    doc.addEventListener('touchmove', onTouchMove, TOUCH_OPTIONS);\n  }\n\n  function removeDocumentPress() {\n    var doc = getDocument();\n    doc.removeEventListener('mousedown', onDocumentPress, true);\n    doc.removeEventListener('touchend', onDocumentPress, TOUCH_OPTIONS);\n    doc.removeEventListener('touchstart', onTouchStart, TOUCH_OPTIONS);\n    doc.removeEventListener('touchmove', onTouchMove, TOUCH_OPTIONS);\n  }\n\n  function onTransitionedOut(duration, callback) {\n    onTransitionEnd(duration, function () {\n      if (!instance.state.isVisible && popper.parentNode && popper.parentNode.contains(popper)) {\n        callback();\n      }\n    });\n  }\n\n  function onTransitionedIn(duration, callback) {\n    onTransitionEnd(duration, callback);\n  }\n\n  function onTransitionEnd(duration, callback) {\n    var box = getDefaultTemplateChildren().box;\n\n    function listener(event) {\n      if (event.target === box) {\n        updateTransitionEndListener(box, 'remove', listener);\n        callback();\n      }\n    } // Make callback synchronous if duration is 0\n    // `transitionend` won't fire otherwise\n\n\n    if (duration === 0) {\n      return callback();\n    }\n\n    updateTransitionEndListener(box, 'remove', currentTransitionEndListener);\n    updateTransitionEndListener(box, 'add', listener);\n    currentTransitionEndListener = listener;\n  }\n\n  function on(eventType, handler, options) {\n    if (options === void 0) {\n      options = false;\n    }\n\n    var nodes = normalizeToArray(instance.props.triggerTarget || reference);\n    nodes.forEach(function (node) {\n      node.addEventListener(eventType, handler, options);\n      listeners.push({\n        node: node,\n        eventType: eventType,\n        handler: handler,\n        options: options\n      });\n    });\n  }\n\n  function addListeners() {\n    if (getIsCustomTouchBehavior()) {\n      on('touchstart', onTrigger, {\n        passive: true\n      });\n      on('touchend', onMouseLeave, {\n        passive: true\n      });\n    }\n\n    splitBySpaces(instance.props.trigger).forEach(function (eventType) {\n      if (eventType === 'manual') {\n        return;\n      }\n\n      on(eventType, onTrigger);\n\n      switch (eventType) {\n        case 'mouseenter':\n          on('mouseleave', onMouseLeave);\n          break;\n\n        case 'focus':\n          on(isIE11 ? 'focusout' : 'blur', onBlurOrFocusOut);\n          break;\n\n        case 'focusin':\n          on('focusout', onBlurOrFocusOut);\n          break;\n      }\n    });\n  }\n\n  function removeListeners() {\n    listeners.forEach(function (_ref) {\n      var node = _ref.node,\n          eventType = _ref.eventType,\n          handler = _ref.handler,\n          options = _ref.options;\n      node.removeEventListener(eventType, handler, options);\n    });\n    listeners = [];\n  }\n\n  function onTrigger(event) {\n    var _lastTriggerEvent;\n\n    var shouldScheduleClickHide = false;\n\n    if (!instance.state.isEnabled || isEventListenerStopped(event) || didHideDueToDocumentMouseDown) {\n      return;\n    }\n\n    var wasFocused = ((_lastTriggerEvent = lastTriggerEvent) == null ? void 0 : _lastTriggerEvent.type) === 'focus';\n    lastTriggerEvent = event;\n    currentTarget = event.currentTarget;\n    handleAriaExpandedAttribute();\n\n    if (!instance.state.isVisible && isMouseEvent(event)) {\n      // If scrolling, `mouseenter` events can be fired if the cursor lands\n      // over a new target, but `mousemove` events don't get fired. This\n      // causes interactive tooltips to get stuck open until the cursor is\n      // moved\n      mouseMoveListeners.forEach(function (listener) {\n        return listener(event);\n      });\n    } // Toggle show/hide when clicking click-triggered tooltips\n\n\n    if (event.type === 'click' && (instance.props.trigger.indexOf('mouseenter') < 0 || isVisibleFromClick) && instance.props.hideOnClick !== false && instance.state.isVisible) {\n      shouldScheduleClickHide = true;\n    } else {\n      scheduleShow(event);\n    }\n\n    if (event.type === 'click') {\n      isVisibleFromClick = !shouldScheduleClickHide;\n    }\n\n    if (shouldScheduleClickHide && !wasFocused) {\n      scheduleHide(event);\n    }\n  }\n\n  function onMouseMove(event) {\n    var target = event.target;\n    var isCursorOverReferenceOrPopper = getCurrentTarget().contains(target) || popper.contains(target);\n\n    if (event.type === 'mousemove' && isCursorOverReferenceOrPopper) {\n      return;\n    }\n\n    var popperTreeData = getNestedPopperTree().concat(popper).map(function (popper) {\n      var _instance$popperInsta;\n\n      var instance = popper._tippy;\n      var state = (_instance$popperInsta = instance.popperInstance) == null ? void 0 : _instance$popperInsta.state;\n\n      if (state) {\n        return {\n          popperRect: popper.getBoundingClientRect(),\n          popperState: state,\n          props: props\n        };\n      }\n\n      return null;\n    }).filter(Boolean);\n\n    if (isCursorOutsideInteractiveBorder(popperTreeData, event)) {\n      cleanupInteractiveMouseListeners();\n      scheduleHide(event);\n    }\n  }\n\n  function onMouseLeave(event) {\n    var shouldBail = isEventListenerStopped(event) || instance.props.trigger.indexOf('click') >= 0 && isVisibleFromClick;\n\n    if (shouldBail) {\n      return;\n    }\n\n    if (instance.props.interactive) {\n      instance.hideWithInteractivity(event);\n      return;\n    }\n\n    scheduleHide(event);\n  }\n\n  function onBlurOrFocusOut(event) {\n    if (instance.props.trigger.indexOf('focusin') < 0 && event.target !== getCurrentTarget()) {\n      return;\n    } // If focus was moved to within the popper\n\n\n    if (instance.props.interactive && event.relatedTarget && popper.contains(event.relatedTarget)) {\n      return;\n    }\n\n    scheduleHide(event);\n  }\n\n  function isEventListenerStopped(event) {\n    return currentInput.isTouch ? getIsCustomTouchBehavior() !== event.type.indexOf('touch') >= 0 : false;\n  }\n\n  function createPopperInstance() {\n    destroyPopperInstance();\n    var _instance$props2 = instance.props,\n        popperOptions = _instance$props2.popperOptions,\n        placement = _instance$props2.placement,\n        offset = _instance$props2.offset,\n        getReferenceClientRect = _instance$props2.getReferenceClientRect,\n        moveTransition = _instance$props2.moveTransition;\n    var arrow = getIsDefaultRenderFn() ? getChildren(popper).arrow : null;\n    var computedReference = getReferenceClientRect ? {\n      getBoundingClientRect: getReferenceClientRect,\n      contextElement: getReferenceClientRect.contextElement || getCurrentTarget()\n    } : reference;\n    var tippyModifier = {\n      name: '$$tippy',\n      enabled: true,\n      phase: 'beforeWrite',\n      requires: ['computeStyles'],\n      fn: function fn(_ref2) {\n        var state = _ref2.state;\n\n        if (getIsDefaultRenderFn()) {\n          var _getDefaultTemplateCh = getDefaultTemplateChildren(),\n              box = _getDefaultTemplateCh.box;\n\n          ['placement', 'reference-hidden', 'escaped'].forEach(function (attr) {\n            if (attr === 'placement') {\n              box.setAttribute('data-placement', state.placement);\n            } else {\n              if (state.attributes.popper[\"data-popper-\" + attr]) {\n                box.setAttribute(\"data-\" + attr, '');\n              } else {\n                box.removeAttribute(\"data-\" + attr);\n              }\n            }\n          });\n          state.attributes.popper = {};\n        }\n      }\n    };\n    var modifiers = [{\n      name: 'offset',\n      options: {\n        offset: offset\n      }\n    }, {\n      name: 'preventOverflow',\n      options: {\n        padding: {\n          top: 2,\n          bottom: 2,\n          left: 5,\n          right: 5\n        }\n      }\n    }, {\n      name: 'flip',\n      options: {\n        padding: 5\n      }\n    }, {\n      name: 'computeStyles',\n      options: {\n        adaptive: !moveTransition\n      }\n    }, tippyModifier];\n\n    if (getIsDefaultRenderFn() && arrow) {\n      modifiers.push({\n        name: 'arrow',\n        options: {\n          element: arrow,\n          padding: 3\n        }\n      });\n    }\n\n    modifiers.push.apply(modifiers, (popperOptions == null ? void 0 : popperOptions.modifiers) || []);\n    instance.popperInstance = createPopper(computedReference, popper, Object.assign({}, popperOptions, {\n      placement: placement,\n      onFirstUpdate: onFirstUpdate,\n      modifiers: modifiers\n    }));\n  }\n\n  function destroyPopperInstance() {\n    if (instance.popperInstance) {\n      instance.popperInstance.destroy();\n      instance.popperInstance = null;\n    }\n  }\n\n  function mount() {\n    var appendTo = instance.props.appendTo;\n    var parentNode; // By default, we'll append the popper to the triggerTargets's parentNode so\n    // it's directly after the reference element so the elements inside the\n    // tippy can be tabbed to\n    // If there are clipping issues, the user can specify a different appendTo\n    // and ensure focus management is handled correctly manually\n\n    var node = getCurrentTarget();\n\n    if (instance.props.interactive && appendTo === TIPPY_DEFAULT_APPEND_TO || appendTo === 'parent') {\n      parentNode = node.parentNode;\n    } else {\n      parentNode = invokeWithArgsOrReturn(appendTo, [node]);\n    } // The popper element needs to exist on the DOM before its position can be\n    // updated as Popper needs to read its dimensions\n\n\n    if (!parentNode.contains(popper)) {\n      parentNode.appendChild(popper);\n    }\n\n    instance.state.isMounted = true;\n    createPopperInstance();\n    /* istanbul ignore else */\n\n    if (process.env.NODE_ENV !== \"production\") {\n      // Accessibility check\n      warnWhen(instance.props.interactive && appendTo === defaultProps.appendTo && node.nextElementSibling !== popper, ['Interactive tippy element may not be accessible via keyboard', 'navigation because it is not directly after the reference element', 'in the DOM source order.', '\\n\\n', 'Using a wrapper <div> or <span> tag around the reference element', 'solves this by creating a new parentNode context.', '\\n\\n', 'Specifying `appendTo: document.body` silences this warning, but it', 'assumes you are using a focus management solution to handle', 'keyboard navigation.', '\\n\\n', 'See: https://atomiks.github.io/tippyjs/v6/accessibility/#interactivity'].join(' '));\n    }\n  }\n\n  function getNestedPopperTree() {\n    return arrayFrom(popper.querySelectorAll('[data-tippy-root]'));\n  }\n\n  function scheduleShow(event) {\n    instance.clearDelayTimeouts();\n\n    if (event) {\n      invokeHook('onTrigger', [instance, event]);\n    }\n\n    addDocumentPress();\n    var delay = getDelay(true);\n\n    var _getNormalizedTouchSe = getNormalizedTouchSettings(),\n        touchValue = _getNormalizedTouchSe[0],\n        touchDelay = _getNormalizedTouchSe[1];\n\n    if (currentInput.isTouch && touchValue === 'hold' && touchDelay) {\n      delay = touchDelay;\n    }\n\n    if (delay) {\n      showTimeout = setTimeout(function () {\n        instance.show();\n      }, delay);\n    } else {\n      instance.show();\n    }\n  }\n\n  function scheduleHide(event) {\n    instance.clearDelayTimeouts();\n    invokeHook('onUntrigger', [instance, event]);\n\n    if (!instance.state.isVisible) {\n      removeDocumentPress();\n      return;\n    } // For interactive tippies, scheduleHide is added to a document.body handler\n    // from onMouseLeave so must intercept scheduled hides from mousemove/leave\n    // events when trigger contains mouseenter and click, and the tip is\n    // currently shown as a result of a click.\n\n\n    if (instance.props.trigger.indexOf('mouseenter') >= 0 && instance.props.trigger.indexOf('click') >= 0 && ['mouseleave', 'mousemove'].indexOf(event.type) >= 0 && isVisibleFromClick) {\n      return;\n    }\n\n    var delay = getDelay(false);\n\n    if (delay) {\n      hideTimeout = setTimeout(function () {\n        if (instance.state.isVisible) {\n          instance.hide();\n        }\n      }, delay);\n    } else {\n      // Fixes a `transitionend` problem when it fires 1 frame too\n      // late sometimes, we don't want hide() to be called.\n      scheduleHideAnimationFrame = requestAnimationFrame(function () {\n        instance.hide();\n      });\n    }\n  } // ===========================================================================\n  //  Public methods\n  // ===========================================================================\n\n\n  function enable() {\n    instance.state.isEnabled = true;\n  }\n\n  function disable() {\n    // Disabling the instance should also hide it\n    // https://github.com/atomiks/tippy.js-react/issues/106\n    instance.hide();\n    instance.state.isEnabled = false;\n  }\n\n  function clearDelayTimeouts() {\n    clearTimeout(showTimeout);\n    clearTimeout(hideTimeout);\n    cancelAnimationFrame(scheduleHideAnimationFrame);\n  }\n\n  function setProps(partialProps) {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n      warnWhen(instance.state.isDestroyed, createMemoryLeakWarning('setProps'));\n    }\n\n    if (instance.state.isDestroyed) {\n      return;\n    }\n\n    invokeHook('onBeforeUpdate', [instance, partialProps]);\n    removeListeners();\n    var prevProps = instance.props;\n    var nextProps = evaluateProps(reference, Object.assign({}, prevProps, removeUndefinedProps(partialProps), {\n      ignoreAttributes: true\n    }));\n    instance.props = nextProps;\n    addListeners();\n\n    if (prevProps.interactiveDebounce !== nextProps.interactiveDebounce) {\n      cleanupInteractiveMouseListeners();\n      debouncedOnMouseMove = debounce(onMouseMove, nextProps.interactiveDebounce);\n    } // Ensure stale aria-expanded attributes are removed\n\n\n    if (prevProps.triggerTarget && !nextProps.triggerTarget) {\n      normalizeToArray(prevProps.triggerTarget).forEach(function (node) {\n        node.removeAttribute('aria-expanded');\n      });\n    } else if (nextProps.triggerTarget) {\n      reference.removeAttribute('aria-expanded');\n    }\n\n    handleAriaExpandedAttribute();\n    handleStyles();\n\n    if (onUpdate) {\n      onUpdate(prevProps, nextProps);\n    }\n\n    if (instance.popperInstance) {\n      createPopperInstance(); // Fixes an issue with nested tippies if they are all getting re-rendered,\n      // and the nested ones get re-rendered first.\n      // https://github.com/atomiks/tippyjs-react/issues/177\n      // TODO: find a cleaner / more efficient solution(!)\n\n      getNestedPopperTree().forEach(function (nestedPopper) {\n        // React (and other UI libs likely) requires a rAF wrapper as it flushes\n        // its work in one\n        requestAnimationFrame(nestedPopper._tippy.popperInstance.forceUpdate);\n      });\n    }\n\n    invokeHook('onAfterUpdate', [instance, partialProps]);\n  }\n\n  function setContent(content) {\n    instance.setProps({\n      content: content\n    });\n  }\n\n  function show() {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n      warnWhen(instance.state.isDestroyed, createMemoryLeakWarning('show'));\n    } // Early bail-out\n\n\n    var isAlreadyVisible = instance.state.isVisible;\n    var isDestroyed = instance.state.isDestroyed;\n    var isDisabled = !instance.state.isEnabled;\n    var isTouchAndTouchDisabled = currentInput.isTouch && !instance.props.touch;\n    var duration = getValueAtIndexOrReturn(instance.props.duration, 0, defaultProps.duration);\n\n    if (isAlreadyVisible || isDestroyed || isDisabled || isTouchAndTouchDisabled) {\n      return;\n    } // Normalize `disabled` behavior across browsers.\n    // Firefox allows events on disabled elements, but Chrome doesn't.\n    // Using a wrapper element (i.e. <span>) is recommended.\n\n\n    if (getCurrentTarget().hasAttribute('disabled')) {\n      return;\n    }\n\n    invokeHook('onShow', [instance], false);\n\n    if (instance.props.onShow(instance) === false) {\n      return;\n    }\n\n    instance.state.isVisible = true;\n\n    if (getIsDefaultRenderFn()) {\n      popper.style.visibility = 'visible';\n    }\n\n    handleStyles();\n    addDocumentPress();\n\n    if (!instance.state.isMounted) {\n      popper.style.transition = 'none';\n    } // If flipping to the opposite side after hiding at least once, the\n    // animation will use the wrong placement without resetting the duration\n\n\n    if (getIsDefaultRenderFn()) {\n      var _getDefaultTemplateCh2 = getDefaultTemplateChildren(),\n          box = _getDefaultTemplateCh2.box,\n          content = _getDefaultTemplateCh2.content;\n\n      setTransitionDuration([box, content], 0);\n    }\n\n    onFirstUpdate = function onFirstUpdate() {\n      var _instance$popperInsta2;\n\n      if (!instance.state.isVisible || ignoreOnFirstUpdate) {\n        return;\n      }\n\n      ignoreOnFirstUpdate = true; // reflow\n\n      void popper.offsetHeight;\n      popper.style.transition = instance.props.moveTransition;\n\n      if (getIsDefaultRenderFn() && instance.props.animation) {\n        var _getDefaultTemplateCh3 = getDefaultTemplateChildren(),\n            _box = _getDefaultTemplateCh3.box,\n            _content = _getDefaultTemplateCh3.content;\n\n        setTransitionDuration([_box, _content], duration);\n        setVisibilityState([_box, _content], 'visible');\n      }\n\n      handleAriaContentAttribute();\n      handleAriaExpandedAttribute();\n      pushIfUnique(mountedInstances, instance); // certain modifiers (e.g. `maxSize`) require a second update after the\n      // popper has been positioned for the first time\n\n      (_instance$popperInsta2 = instance.popperInstance) == null ? void 0 : _instance$popperInsta2.forceUpdate();\n      invokeHook('onMount', [instance]);\n\n      if (instance.props.animation && getIsDefaultRenderFn()) {\n        onTransitionedIn(duration, function () {\n          instance.state.isShown = true;\n          invokeHook('onShown', [instance]);\n        });\n      }\n    };\n\n    mount();\n  }\n\n  function hide() {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n      warnWhen(instance.state.isDestroyed, createMemoryLeakWarning('hide'));\n    } // Early bail-out\n\n\n    var isAlreadyHidden = !instance.state.isVisible;\n    var isDestroyed = instance.state.isDestroyed;\n    var isDisabled = !instance.state.isEnabled;\n    var duration = getValueAtIndexOrReturn(instance.props.duration, 1, defaultProps.duration);\n\n    if (isAlreadyHidden || isDestroyed || isDisabled) {\n      return;\n    }\n\n    invokeHook('onHide', [instance], false);\n\n    if (instance.props.onHide(instance) === false) {\n      return;\n    }\n\n    instance.state.isVisible = false;\n    instance.state.isShown = false;\n    ignoreOnFirstUpdate = false;\n    isVisibleFromClick = false;\n\n    if (getIsDefaultRenderFn()) {\n      popper.style.visibility = 'hidden';\n    }\n\n    cleanupInteractiveMouseListeners();\n    removeDocumentPress();\n    handleStyles(true);\n\n    if (getIsDefaultRenderFn()) {\n      var _getDefaultTemplateCh4 = getDefaultTemplateChildren(),\n          box = _getDefaultTemplateCh4.box,\n          content = _getDefaultTemplateCh4.content;\n\n      if (instance.props.animation) {\n        setTransitionDuration([box, content], duration);\n        setVisibilityState([box, content], 'hidden');\n      }\n    }\n\n    handleAriaContentAttribute();\n    handleAriaExpandedAttribute();\n\n    if (instance.props.animation) {\n      if (getIsDefaultRenderFn()) {\n        onTransitionedOut(duration, instance.unmount);\n      }\n    } else {\n      instance.unmount();\n    }\n  }\n\n  function hideWithInteractivity(event) {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n      warnWhen(instance.state.isDestroyed, createMemoryLeakWarning('hideWithInteractivity'));\n    }\n\n    getDocument().addEventListener('mousemove', debouncedOnMouseMove);\n    pushIfUnique(mouseMoveListeners, debouncedOnMouseMove);\n    debouncedOnMouseMove(event);\n  }\n\n  function unmount() {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n      warnWhen(instance.state.isDestroyed, createMemoryLeakWarning('unmount'));\n    }\n\n    if (instance.state.isVisible) {\n      instance.hide();\n    }\n\n    if (!instance.state.isMounted) {\n      return;\n    }\n\n    destroyPopperInstance(); // If a popper is not interactive, it will be appended outside the popper\n    // tree by default. This seems mainly for interactive tippies, but we should\n    // find a workaround if possible\n\n    getNestedPopperTree().forEach(function (nestedPopper) {\n      nestedPopper._tippy.unmount();\n    });\n\n    if (popper.parentNode) {\n      popper.parentNode.removeChild(popper);\n    }\n\n    mountedInstances = mountedInstances.filter(function (i) {\n      return i !== instance;\n    });\n    instance.state.isMounted = false;\n    invokeHook('onHidden', [instance]);\n  }\n\n  function destroy() {\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== \"production\") {\n      warnWhen(instance.state.isDestroyed, createMemoryLeakWarning('destroy'));\n    }\n\n    if (instance.state.isDestroyed) {\n      return;\n    }\n\n    instance.clearDelayTimeouts();\n    instance.unmount();\n    removeListeners();\n    delete reference._tippy;\n    instance.state.isDestroyed = true;\n    invokeHook('onDestroy', [instance]);\n  }\n}\n\nfunction tippy(targets, optionalProps) {\n  if (optionalProps === void 0) {\n    optionalProps = {};\n  }\n\n  var plugins = defaultProps.plugins.concat(optionalProps.plugins || []);\n  /* istanbul ignore else */\n\n  if (process.env.NODE_ENV !== \"production\") {\n    validateTargets(targets);\n    validateProps(optionalProps, plugins);\n  }\n\n  bindGlobalEventListeners();\n  var passedProps = Object.assign({}, optionalProps, {\n    plugins: plugins\n  });\n  var elements = getArrayOfElements(targets);\n  /* istanbul ignore else */\n\n  if (process.env.NODE_ENV !== \"production\") {\n    var isSingleContentElement = isElement(passedProps.content);\n    var isMoreThanOneReferenceElement = elements.length > 1;\n    warnWhen(isSingleContentElement && isMoreThanOneReferenceElement, ['tippy() was passed an Element as the `content` prop, but more than', 'one tippy instance was created by this invocation. This means the', 'content element will only be appended to the last tippy instance.', '\\n\\n', 'Instead, pass the .innerHTML of the element, or use a function that', 'returns a cloned version of the element instead.', '\\n\\n', '1) content: element.innerHTML\\n', '2) content: () => element.cloneNode(true)'].join(' '));\n  }\n\n  var instances = elements.reduce(function (acc, reference) {\n    var instance = reference && createTippy(reference, passedProps);\n\n    if (instance) {\n      acc.push(instance);\n    }\n\n    return acc;\n  }, []);\n  return isElement(targets) ? instances[0] : instances;\n}\n\ntippy.defaultProps = defaultProps;\ntippy.setDefaultProps = setDefaultProps;\ntippy.currentInput = currentInput;\nvar hideAll = function hideAll(_temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      excludedReferenceOrInstance = _ref.exclude,\n      duration = _ref.duration;\n\n  mountedInstances.forEach(function (instance) {\n    var isExcluded = false;\n\n    if (excludedReferenceOrInstance) {\n      isExcluded = isReferenceElement(excludedReferenceOrInstance) ? instance.reference === excludedReferenceOrInstance : instance.popper === excludedReferenceOrInstance.popper;\n    }\n\n    if (!isExcluded) {\n      var originalDuration = instance.props.duration;\n      instance.setProps({\n        duration: duration\n      });\n      instance.hide();\n\n      if (!instance.state.isDestroyed) {\n        instance.setProps({\n          duration: originalDuration\n        });\n      }\n    }\n  });\n};\n\n// every time the popper is destroyed (i.e. a new target), removing the styles\n// and causing transitions to break for singletons when the console is open, but\n// most notably for non-transform styles being used, `gpuAcceleration: false`.\n\nvar applyStylesModifier = Object.assign({}, applyStyles, {\n  effect: function effect(_ref) {\n    var state = _ref.state;\n    var initialStyles = {\n      popper: {\n        position: state.options.strategy,\n        left: '0',\n        top: '0',\n        margin: '0'\n      },\n      arrow: {\n        position: 'absolute'\n      },\n      reference: {}\n    };\n    Object.assign(state.elements.popper.style, initialStyles.popper);\n    state.styles = initialStyles;\n\n    if (state.elements.arrow) {\n      Object.assign(state.elements.arrow.style, initialStyles.arrow);\n    } // intentionally return no cleanup function\n    // return () => { ... }\n\n  }\n});\n\nvar createSingleton = function createSingleton(tippyInstances, optionalProps) {\n  var _optionalProps$popper;\n\n  if (optionalProps === void 0) {\n    optionalProps = {};\n  }\n\n  /* istanbul ignore else */\n  if (process.env.NODE_ENV !== \"production\") {\n    errorWhen(!Array.isArray(tippyInstances), ['The first argument passed to createSingleton() must be an array of', 'tippy instances. The passed value was', String(tippyInstances)].join(' '));\n  }\n\n  var individualInstances = tippyInstances;\n  var references = [];\n  var triggerTargets = [];\n  var currentTarget;\n  var overrides = optionalProps.overrides;\n  var interceptSetPropsCleanups = [];\n  var shownOnCreate = false;\n\n  function setTriggerTargets() {\n    triggerTargets = individualInstances.map(function (instance) {\n      return normalizeToArray(instance.props.triggerTarget || instance.reference);\n    }).reduce(function (acc, item) {\n      return acc.concat(item);\n    }, []);\n  }\n\n  function setReferences() {\n    references = individualInstances.map(function (instance) {\n      return instance.reference;\n    });\n  }\n\n  function enableInstances(isEnabled) {\n    individualInstances.forEach(function (instance) {\n      if (isEnabled) {\n        instance.enable();\n      } else {\n        instance.disable();\n      }\n    });\n  }\n\n  function interceptSetProps(singleton) {\n    return individualInstances.map(function (instance) {\n      var originalSetProps = instance.setProps;\n\n      instance.setProps = function (props) {\n        originalSetProps(props);\n\n        if (instance.reference === currentTarget) {\n          singleton.setProps(props);\n        }\n      };\n\n      return function () {\n        instance.setProps = originalSetProps;\n      };\n    });\n  } // have to pass singleton, as it maybe undefined on first call\n\n\n  function prepareInstance(singleton, target) {\n    var index = triggerTargets.indexOf(target); // bail-out\n\n    if (target === currentTarget) {\n      return;\n    }\n\n    currentTarget = target;\n    var overrideProps = (overrides || []).concat('content').reduce(function (acc, prop) {\n      acc[prop] = individualInstances[index].props[prop];\n      return acc;\n    }, {});\n    singleton.setProps(Object.assign({}, overrideProps, {\n      getReferenceClientRect: typeof overrideProps.getReferenceClientRect === 'function' ? overrideProps.getReferenceClientRect : function () {\n        var _references$index;\n\n        return (_references$index = references[index]) == null ? void 0 : _references$index.getBoundingClientRect();\n      }\n    }));\n  }\n\n  enableInstances(false);\n  setReferences();\n  setTriggerTargets();\n  var plugin = {\n    fn: function fn() {\n      return {\n        onDestroy: function onDestroy() {\n          enableInstances(true);\n        },\n        onHidden: function onHidden() {\n          currentTarget = null;\n        },\n        onClickOutside: function onClickOutside(instance) {\n          if (instance.props.showOnCreate && !shownOnCreate) {\n            shownOnCreate = true;\n            currentTarget = null;\n          }\n        },\n        onShow: function onShow(instance) {\n          if (instance.props.showOnCreate && !shownOnCreate) {\n            shownOnCreate = true;\n            prepareInstance(instance, references[0]);\n          }\n        },\n        onTrigger: function onTrigger(instance, event) {\n          prepareInstance(instance, event.currentTarget);\n        }\n      };\n    }\n  };\n  var singleton = tippy(div(), Object.assign({}, removeProperties(optionalProps, ['overrides']), {\n    plugins: [plugin].concat(optionalProps.plugins || []),\n    triggerTarget: triggerTargets,\n    popperOptions: Object.assign({}, optionalProps.popperOptions, {\n      modifiers: [].concat(((_optionalProps$popper = optionalProps.popperOptions) == null ? void 0 : _optionalProps$popper.modifiers) || [], [applyStylesModifier])\n    })\n  }));\n  var originalShow = singleton.show;\n\n  singleton.show = function (target) {\n    originalShow(); // first time, showOnCreate or programmatic call with no params\n    // default to showing first instance\n\n    if (!currentTarget && target == null) {\n      return prepareInstance(singleton, references[0]);\n    } // triggered from event (do nothing as prepareInstance already called by onTrigger)\n    // programmatic call with no params when already visible (do nothing again)\n\n\n    if (currentTarget && target == null) {\n      return;\n    } // target is index of instance\n\n\n    if (typeof target === 'number') {\n      return references[target] && prepareInstance(singleton, references[target]);\n    } // target is a child tippy instance\n\n\n    if (individualInstances.indexOf(target) >= 0) {\n      var ref = target.reference;\n      return prepareInstance(singleton, ref);\n    } // target is a ReferenceElement\n\n\n    if (references.indexOf(target) >= 0) {\n      return prepareInstance(singleton, target);\n    }\n  };\n\n  singleton.showNext = function () {\n    var first = references[0];\n\n    if (!currentTarget) {\n      return singleton.show(0);\n    }\n\n    var index = references.indexOf(currentTarget);\n    singleton.show(references[index + 1] || first);\n  };\n\n  singleton.showPrevious = function () {\n    var last = references[references.length - 1];\n\n    if (!currentTarget) {\n      return singleton.show(last);\n    }\n\n    var index = references.indexOf(currentTarget);\n    var target = references[index - 1] || last;\n    singleton.show(target);\n  };\n\n  var originalSetProps = singleton.setProps;\n\n  singleton.setProps = function (props) {\n    overrides = props.overrides || overrides;\n    originalSetProps(props);\n  };\n\n  singleton.setInstances = function (nextInstances) {\n    enableInstances(true);\n    interceptSetPropsCleanups.forEach(function (fn) {\n      return fn();\n    });\n    individualInstances = nextInstances;\n    enableInstances(false);\n    setReferences();\n    setTriggerTargets();\n    interceptSetPropsCleanups = interceptSetProps(singleton);\n    singleton.setProps({\n      triggerTarget: triggerTargets\n    });\n  };\n\n  interceptSetPropsCleanups = interceptSetProps(singleton);\n  return singleton;\n};\n\nvar BUBBLING_EVENTS_MAP = {\n  mouseover: 'mouseenter',\n  focusin: 'focus',\n  click: 'click'\n};\n/**\n * Creates a delegate instance that controls the creation of tippy instances\n * for child elements (`target` CSS selector).\n */\n\nfunction delegate(targets, props) {\n  /* istanbul ignore else */\n  if (process.env.NODE_ENV !== \"production\") {\n    errorWhen(!(props && props.target), ['You must specity a `target` prop indicating a CSS selector string matching', 'the target elements that should receive a tippy.'].join(' '));\n  }\n\n  var listeners = [];\n  var childTippyInstances = [];\n  var disabled = false;\n  var target = props.target;\n  var nativeProps = removeProperties(props, ['target']);\n  var parentProps = Object.assign({}, nativeProps, {\n    trigger: 'manual',\n    touch: false\n  });\n  var childProps = Object.assign({\n    touch: defaultProps.touch\n  }, nativeProps, {\n    showOnCreate: true\n  });\n  var returnValue = tippy(targets, parentProps);\n  var normalizedReturnValue = normalizeToArray(returnValue);\n\n  function onTrigger(event) {\n    if (!event.target || disabled) {\n      return;\n    }\n\n    var targetNode = event.target.closest(target);\n\n    if (!targetNode) {\n      return;\n    } // Get relevant trigger with fallbacks:\n    // 1. Check `data-tippy-trigger` attribute on target node\n    // 2. Fallback to `trigger` passed to `delegate()`\n    // 3. Fallback to `defaultProps.trigger`\n\n\n    var trigger = targetNode.getAttribute('data-tippy-trigger') || props.trigger || defaultProps.trigger; // @ts-ignore\n\n    if (targetNode._tippy) {\n      return;\n    }\n\n    if (event.type === 'touchstart' && typeof childProps.touch === 'boolean') {\n      return;\n    }\n\n    if (event.type !== 'touchstart' && trigger.indexOf(BUBBLING_EVENTS_MAP[event.type]) < 0) {\n      return;\n    }\n\n    var instance = tippy(targetNode, childProps);\n\n    if (instance) {\n      childTippyInstances = childTippyInstances.concat(instance);\n    }\n  }\n\n  function on(node, eventType, handler, options) {\n    if (options === void 0) {\n      options = false;\n    }\n\n    node.addEventListener(eventType, handler, options);\n    listeners.push({\n      node: node,\n      eventType: eventType,\n      handler: handler,\n      options: options\n    });\n  }\n\n  function addEventListeners(instance) {\n    var reference = instance.reference;\n    on(reference, 'touchstart', onTrigger, TOUCH_OPTIONS);\n    on(reference, 'mouseover', onTrigger);\n    on(reference, 'focusin', onTrigger);\n    on(reference, 'click', onTrigger);\n  }\n\n  function removeEventListeners() {\n    listeners.forEach(function (_ref) {\n      var node = _ref.node,\n          eventType = _ref.eventType,\n          handler = _ref.handler,\n          options = _ref.options;\n      node.removeEventListener(eventType, handler, options);\n    });\n    listeners = [];\n  }\n\n  function applyMutations(instance) {\n    var originalDestroy = instance.destroy;\n    var originalEnable = instance.enable;\n    var originalDisable = instance.disable;\n\n    instance.destroy = function (shouldDestroyChildInstances) {\n      if (shouldDestroyChildInstances === void 0) {\n        shouldDestroyChildInstances = true;\n      }\n\n      if (shouldDestroyChildInstances) {\n        childTippyInstances.forEach(function (instance) {\n          instance.destroy();\n        });\n      }\n\n      childTippyInstances = [];\n      removeEventListeners();\n      originalDestroy();\n    };\n\n    instance.enable = function () {\n      originalEnable();\n      childTippyInstances.forEach(function (instance) {\n        return instance.enable();\n      });\n      disabled = false;\n    };\n\n    instance.disable = function () {\n      originalDisable();\n      childTippyInstances.forEach(function (instance) {\n        return instance.disable();\n      });\n      disabled = true;\n    };\n\n    addEventListeners(instance);\n  }\n\n  normalizedReturnValue.forEach(applyMutations);\n  return returnValue;\n}\n\nvar animateFill = {\n  name: 'animateFill',\n  defaultValue: false,\n  fn: function fn(instance) {\n    var _instance$props$rende;\n\n    // @ts-ignore\n    if (!((_instance$props$rende = instance.props.render) != null && _instance$props$rende.$$tippy)) {\n      if (process.env.NODE_ENV !== \"production\") {\n        errorWhen(instance.props.animateFill, 'The `animateFill` plugin requires the default render function.');\n      }\n\n      return {};\n    }\n\n    var _getChildren = getChildren(instance.popper),\n        box = _getChildren.box,\n        content = _getChildren.content;\n\n    var backdrop = instance.props.animateFill ? createBackdropElement() : null;\n    return {\n      onCreate: function onCreate() {\n        if (backdrop) {\n          box.insertBefore(backdrop, box.firstElementChild);\n          box.setAttribute('data-animatefill', '');\n          box.style.overflow = 'hidden';\n          instance.setProps({\n            arrow: false,\n            animation: 'shift-away'\n          });\n        }\n      },\n      onMount: function onMount() {\n        if (backdrop) {\n          var transitionDuration = box.style.transitionDuration;\n          var duration = Number(transitionDuration.replace('ms', '')); // The content should fade in after the backdrop has mostly filled the\n          // tooltip element. `clip-path` is the other alternative but is not\n          // well-supported and is buggy on some devices.\n\n          content.style.transitionDelay = Math.round(duration / 10) + \"ms\";\n          backdrop.style.transitionDuration = transitionDuration;\n          setVisibilityState([backdrop], 'visible');\n        }\n      },\n      onShow: function onShow() {\n        if (backdrop) {\n          backdrop.style.transitionDuration = '0ms';\n        }\n      },\n      onHide: function onHide() {\n        if (backdrop) {\n          setVisibilityState([backdrop], 'hidden');\n        }\n      }\n    };\n  }\n};\n\nfunction createBackdropElement() {\n  var backdrop = div();\n  backdrop.className = BACKDROP_CLASS;\n  setVisibilityState([backdrop], 'hidden');\n  return backdrop;\n}\n\nvar mouseCoords = {\n  clientX: 0,\n  clientY: 0\n};\nvar activeInstances = [];\n\nfunction storeMouseCoords(_ref) {\n  var clientX = _ref.clientX,\n      clientY = _ref.clientY;\n  mouseCoords = {\n    clientX: clientX,\n    clientY: clientY\n  };\n}\n\nfunction addMouseCoordsListener(doc) {\n  doc.addEventListener('mousemove', storeMouseCoords);\n}\n\nfunction removeMouseCoordsListener(doc) {\n  doc.removeEventListener('mousemove', storeMouseCoords);\n}\n\nvar followCursor = {\n  name: 'followCursor',\n  defaultValue: false,\n  fn: function fn(instance) {\n    var reference = instance.reference;\n    var doc = getOwnerDocument(instance.props.triggerTarget || reference);\n    var isInternalUpdate = false;\n    var wasFocusEvent = false;\n    var isUnmounted = true;\n    var prevProps = instance.props;\n\n    function getIsInitialBehavior() {\n      return instance.props.followCursor === 'initial' && instance.state.isVisible;\n    }\n\n    function addListener() {\n      doc.addEventListener('mousemove', onMouseMove);\n    }\n\n    function removeListener() {\n      doc.removeEventListener('mousemove', onMouseMove);\n    }\n\n    function unsetGetReferenceClientRect() {\n      isInternalUpdate = true;\n      instance.setProps({\n        getReferenceClientRect: null\n      });\n      isInternalUpdate = false;\n    }\n\n    function onMouseMove(event) {\n      // If the instance is interactive, avoid updating the position unless it's\n      // over the reference element\n      var isCursorOverReference = event.target ? reference.contains(event.target) : true;\n      var followCursor = instance.props.followCursor;\n      var clientX = event.clientX,\n          clientY = event.clientY;\n      var rect = reference.getBoundingClientRect();\n      var relativeX = clientX - rect.left;\n      var relativeY = clientY - rect.top;\n\n      if (isCursorOverReference || !instance.props.interactive) {\n        instance.setProps({\n          // @ts-ignore - unneeded DOMRect properties\n          getReferenceClientRect: function getReferenceClientRect() {\n            var rect = reference.getBoundingClientRect();\n            var x = clientX;\n            var y = clientY;\n\n            if (followCursor === 'initial') {\n              x = rect.left + relativeX;\n              y = rect.top + relativeY;\n            }\n\n            var top = followCursor === 'horizontal' ? rect.top : y;\n            var right = followCursor === 'vertical' ? rect.right : x;\n            var bottom = followCursor === 'horizontal' ? rect.bottom : y;\n            var left = followCursor === 'vertical' ? rect.left : x;\n            return {\n              width: right - left,\n              height: bottom - top,\n              top: top,\n              right: right,\n              bottom: bottom,\n              left: left\n            };\n          }\n        });\n      }\n    }\n\n    function create() {\n      if (instance.props.followCursor) {\n        activeInstances.push({\n          instance: instance,\n          doc: doc\n        });\n        addMouseCoordsListener(doc);\n      }\n    }\n\n    function destroy() {\n      activeInstances = activeInstances.filter(function (data) {\n        return data.instance !== instance;\n      });\n\n      if (activeInstances.filter(function (data) {\n        return data.doc === doc;\n      }).length === 0) {\n        removeMouseCoordsListener(doc);\n      }\n    }\n\n    return {\n      onCreate: create,\n      onDestroy: destroy,\n      onBeforeUpdate: function onBeforeUpdate() {\n        prevProps = instance.props;\n      },\n      onAfterUpdate: function onAfterUpdate(_, _ref2) {\n        var followCursor = _ref2.followCursor;\n\n        if (isInternalUpdate) {\n          return;\n        }\n\n        if (followCursor !== undefined && prevProps.followCursor !== followCursor) {\n          destroy();\n\n          if (followCursor) {\n            create();\n\n            if (instance.state.isMounted && !wasFocusEvent && !getIsInitialBehavior()) {\n              addListener();\n            }\n          } else {\n            removeListener();\n            unsetGetReferenceClientRect();\n          }\n        }\n      },\n      onMount: function onMount() {\n        if (instance.props.followCursor && !wasFocusEvent) {\n          if (isUnmounted) {\n            onMouseMove(mouseCoords);\n            isUnmounted = false;\n          }\n\n          if (!getIsInitialBehavior()) {\n            addListener();\n          }\n        }\n      },\n      onTrigger: function onTrigger(_, event) {\n        if (isMouseEvent(event)) {\n          mouseCoords = {\n            clientX: event.clientX,\n            clientY: event.clientY\n          };\n        }\n\n        wasFocusEvent = event.type === 'focus';\n      },\n      onHidden: function onHidden() {\n        if (instance.props.followCursor) {\n          unsetGetReferenceClientRect();\n          removeListener();\n          isUnmounted = true;\n        }\n      }\n    };\n  }\n};\n\nfunction getProps(props, modifier) {\n  var _props$popperOptions;\n\n  return {\n    popperOptions: Object.assign({}, props.popperOptions, {\n      modifiers: [].concat((((_props$popperOptions = props.popperOptions) == null ? void 0 : _props$popperOptions.modifiers) || []).filter(function (_ref) {\n        var name = _ref.name;\n        return name !== modifier.name;\n      }), [modifier])\n    })\n  };\n}\n\nvar inlinePositioning = {\n  name: 'inlinePositioning',\n  defaultValue: false,\n  fn: function fn(instance) {\n    var reference = instance.reference;\n\n    function isEnabled() {\n      return !!instance.props.inlinePositioning;\n    }\n\n    var placement;\n    var cursorRectIndex = -1;\n    var isInternalUpdate = false;\n    var triedPlacements = [];\n    var modifier = {\n      name: 'tippyInlinePositioning',\n      enabled: true,\n      phase: 'afterWrite',\n      fn: function fn(_ref2) {\n        var state = _ref2.state;\n\n        if (isEnabled()) {\n          if (triedPlacements.indexOf(state.placement) !== -1) {\n            triedPlacements = [];\n          }\n\n          if (placement !== state.placement && triedPlacements.indexOf(state.placement) === -1) {\n            triedPlacements.push(state.placement);\n            instance.setProps({\n              // @ts-ignore - unneeded DOMRect properties\n              getReferenceClientRect: function getReferenceClientRect() {\n                return _getReferenceClientRect(state.placement);\n              }\n            });\n          }\n\n          placement = state.placement;\n        }\n      }\n    };\n\n    function _getReferenceClientRect(placement) {\n      return getInlineBoundingClientRect(getBasePlacement(placement), reference.getBoundingClientRect(), arrayFrom(reference.getClientRects()), cursorRectIndex);\n    }\n\n    function setInternalProps(partialProps) {\n      isInternalUpdate = true;\n      instance.setProps(partialProps);\n      isInternalUpdate = false;\n    }\n\n    function addModifier() {\n      if (!isInternalUpdate) {\n        setInternalProps(getProps(instance.props, modifier));\n      }\n    }\n\n    return {\n      onCreate: addModifier,\n      onAfterUpdate: addModifier,\n      onTrigger: function onTrigger(_, event) {\n        if (isMouseEvent(event)) {\n          var rects = arrayFrom(instance.reference.getClientRects());\n          var cursorRect = rects.find(function (rect) {\n            return rect.left - 2 <= event.clientX && rect.right + 2 >= event.clientX && rect.top - 2 <= event.clientY && rect.bottom + 2 >= event.clientY;\n          });\n          var index = rects.indexOf(cursorRect);\n          cursorRectIndex = index > -1 ? index : cursorRectIndex;\n        }\n      },\n      onHidden: function onHidden() {\n        cursorRectIndex = -1;\n      }\n    };\n  }\n};\nfunction getInlineBoundingClientRect(currentBasePlacement, boundingRect, clientRects, cursorRectIndex) {\n  // Not an inline element, or placement is not yet known\n  if (clientRects.length < 2 || currentBasePlacement === null) {\n    return boundingRect;\n  } // There are two rects and they are disjoined\n\n\n  if (clientRects.length === 2 && cursorRectIndex >= 0 && clientRects[0].left > clientRects[1].right) {\n    return clientRects[cursorRectIndex] || boundingRect;\n  }\n\n  switch (currentBasePlacement) {\n    case 'top':\n    case 'bottom':\n      {\n        var firstRect = clientRects[0];\n        var lastRect = clientRects[clientRects.length - 1];\n        var isTop = currentBasePlacement === 'top';\n        var top = firstRect.top;\n        var bottom = lastRect.bottom;\n        var left = isTop ? firstRect.left : lastRect.left;\n        var right = isTop ? firstRect.right : lastRect.right;\n        var width = right - left;\n        var height = bottom - top;\n        return {\n          top: top,\n          bottom: bottom,\n          left: left,\n          right: right,\n          width: width,\n          height: height\n        };\n      }\n\n    case 'left':\n    case 'right':\n      {\n        var minLeft = Math.min.apply(Math, clientRects.map(function (rects) {\n          return rects.left;\n        }));\n        var maxRight = Math.max.apply(Math, clientRects.map(function (rects) {\n          return rects.right;\n        }));\n        var measureRects = clientRects.filter(function (rect) {\n          return currentBasePlacement === 'left' ? rect.left === minLeft : rect.right === maxRight;\n        });\n        var _top = measureRects[0].top;\n        var _bottom = measureRects[measureRects.length - 1].bottom;\n        var _left = minLeft;\n        var _right = maxRight;\n\n        var _width = _right - _left;\n\n        var _height = _bottom - _top;\n\n        return {\n          top: _top,\n          bottom: _bottom,\n          left: _left,\n          right: _right,\n          width: _width,\n          height: _height\n        };\n      }\n\n    default:\n      {\n        return boundingRect;\n      }\n  }\n}\n\nvar sticky = {\n  name: 'sticky',\n  defaultValue: false,\n  fn: function fn(instance) {\n    var reference = instance.reference,\n        popper = instance.popper;\n\n    function getReference() {\n      return instance.popperInstance ? instance.popperInstance.state.elements.reference : reference;\n    }\n\n    function shouldCheck(value) {\n      return instance.props.sticky === true || instance.props.sticky === value;\n    }\n\n    var prevRefRect = null;\n    var prevPopRect = null;\n\n    function updatePosition() {\n      var currentRefRect = shouldCheck('reference') ? getReference().getBoundingClientRect() : null;\n      var currentPopRect = shouldCheck('popper') ? popper.getBoundingClientRect() : null;\n\n      if (currentRefRect && areRectsDifferent(prevRefRect, currentRefRect) || currentPopRect && areRectsDifferent(prevPopRect, currentPopRect)) {\n        if (instance.popperInstance) {\n          instance.popperInstance.update();\n        }\n      }\n\n      prevRefRect = currentRefRect;\n      prevPopRect = currentPopRect;\n\n      if (instance.state.isMounted) {\n        requestAnimationFrame(updatePosition);\n      }\n    }\n\n    return {\n      onMount: function onMount() {\n        if (instance.props.sticky) {\n          updatePosition();\n        }\n      }\n    };\n  }\n};\n\nfunction areRectsDifferent(rectA, rectB) {\n  if (rectA && rectB) {\n    return rectA.top !== rectB.top || rectA.right !== rectB.right || rectA.bottom !== rectB.bottom || rectA.left !== rectB.left;\n  }\n\n  return true;\n}\n\ntippy.setDefaultProps({\n  render: render\n});\n\nexport default tippy;\nexport { animateFill, createSingleton, delegate, followCursor, hideAll, inlinePositioning, ROUND_ARROW as roundArrow, sticky };\n//# sourceMappingURL=tippy.esm.js.map\n","/**\r\n * Special version which is filled in during compile by the definePlugin\r\n * The real version comes from the main package.json file in this repo\r\n * The sub-projects also use this version\r\n */\r\ndeclare const ROOTVERSION: string;\r\n\r\n/** @internal */\r\nexport const ToSxcName = \"2sxc\";\r\n\r\n/** @internal */\r\nexport const SxcVersion = ROOTVERSION;\r\n\r\n/** @internal */\r\nexport const SxcApiUrlRoot = 'desktopmodules/2sxc/api/';\r\n\r\n/** @internal */\r\nexport const HeaderNames = {\r\n    // 2sxc specific header\r\n    ContentBlockId: \"ContentBlockId\",\r\n\r\n    // headers as defined by DNN\r\n    ModuleId: \"ModuleId\",\r\n    TabId: \"TabId\",\r\n\r\n    // Header which should replace \"TabId\" in the long run\r\n    PageId: \"PageId\",\r\n};\r\n\r\n/** @internal */\r\nexport const ApiUrlRoots = ['app', 'app-sys', 'app-api', 'app-query', 'app-content', 'eav', 'view', 'dnn'];\r\n/** @internal */\r\nexport const AppApiMarker = 'app';\r\n\r\n// TODO: this should later lead to remapping of old url calls, but it's not in use yet\r\n// note that these were always 'auto' so `app-content` would need to be come `app/auto/content`\r\n/** @internal */\r\nexport const AppApiMap = {\r\n    'app-api': 'app/[name]/api',\r\n    'app-query': 'app/[name]/query',\r\n    'app-content': 'app/[name]/content'\r\n};\r\n\r\n// These are Not-Defined-IDs.\r\n// Because\r\n\r\n/**\r\n * This is a marker for an ID which is not defined\r\n * This is for situations where a 0 or even a negative number\r\n * could be real numbers, so this number is so big, it should never be a real ID\r\n * @internal\r\n */\r\nexport const NumberNotDefinedHuge = 274200000000;\r\n\r\n// Moving to here because it's used in inpage and $2sxc\r\n\r\n/**\r\n * Attribute Names used in the HTML\r\n */\r\nexport const Attributes = {\r\n  InstanceId: 'data-cb-instance',\r\n  Context: 'data-edit-context',\r\n  ContentBlockId: 'data-cb-id',\r\n};\r\n\r\nexport const C = {\r\n  Attributes: Attributes,\r\n  Sel: {\r\n    SxcDivs: `div[${Attributes.Context}]`,\r\n  },\r\n\r\n}","/** @internal */\r\nexport enum LogEntryOptions {\r\n    log = 'log',\r\n    warn = 'warn',\r\n    error = 'error',\r\n    throw = 'throw',\r\n}\r\n","import { Log } from '.';\r\n\r\n/**\r\n * Any object that has an own log object\r\n * @export\r\n * @interface HasLog\r\n * @public\r\n */\r\nexport abstract class HasLog {\r\n  /**\r\n   * The logger for this object\r\n   * @internal usually not relevant and could make docs confusing\r\n   */\r\n  log: Log;\r\n\r\n  /**\r\n   * initialize the logger\r\n   * ideally it has a parent-logger to attach to\r\n   * @param logName name to show in the logger\r\n   * @param parentLog parent-logger to attach to\r\n   * @param initialMessage optional start-message to log\r\n   * @internal\r\n   */\r\n  constructor(\r\n    logName: string,\r\n    parentLog?: Log,\r\n    initialMessage?: string,\r\n  ) {\r\n    this.initLogInternal(logName, parentLog, initialMessage);\r\n  }\r\n\r\n  /** @internal */\r\n  public initLog = (name: string, parentLog?: Log, initialMessage?: string)\r\n    : void => this.initLogInternal(name, parentLog, initialMessage)\r\n\r\n  /** @internal */\r\n  private initLogInternal(name: string, parentLog?: Log, initialMessage?: string): void {\r\n    // standard & most common case: just create new log\r\n    if (this.log == null) {\r\n      this.log = new Log(name, parentLog, initialMessage);\r\n      return;\r\n    }\r\n\r\n    // late-init case, where the log was already created - just reconfig keeping what was in it\r\n    this.log.rename(name);\r\n    this.log.linkLog(parentLog);\r\n    if (initialMessage != null)\r\n      this.log.add(initialMessage);\r\n  }\r\n\r\n}\r\n","// Log Names must be added here, and not in the places where they are used\r\n// Reason is that otherwise we get circular dependencies\r\n\r\nexport const QuickEClipboardLogId = \"Q-E.Clpbrd\";\r\n\r\n/**\r\n * Special variable which is filled in during compile by the definePlugin\r\n */\r\ndeclare const IsDevBuild: boolean;\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const Debug = {\r\n  isDevBuild: IsDevBuild,\r\n  cms: {\r\n    autoDump: false,\r\n    run: true,\r\n  },\r\n\r\n  /**\r\n   * Logs the arguments if the build is a development build\r\n   *\r\n   * @param {...any[]} args\r\n   */\r\n  log (...args: any[]) {\r\n    if (IsDevBuild)\r\n      console.log(...args);\r\n  },\r\n\r\n  // Full debug on specific parts of the code\r\n  // should always be empty in production\r\n  parts: {\r\n    commandInfo: false,\r\n    ToolbarConfigLoaderV10: false,\r\n    RuleManager: false,\r\n    CommandTippy: false,\r\n    [QuickEClipboardLogId]: false,\r\n    'Rnd.Rndrer': false,\r\n    'QDl.IfBrig': false,\r\n    'Cmd.Exec': false,\r\n    'Cms.Api': false,\r\n    'Q-E.Main': false,\r\n    'debugObservables': false,\r\n    'Sys.Bootst': false,\r\n    'Bts.Module': false,\r\n  }\r\n};\r\n","import { LogEntry, LogCall } from '.';\r\nimport { Debug } from '../../inpage/src/constants/debug';\r\n\r\nconst keepData = location.search.indexOf(\"debug=true\") !== -1;\r\n\r\nconst maxScopeLen = 3;\r\nconst maxNameLen = 6;\r\nconst liveDump = false;\r\nconst maxEntriesReached = 'Maximum amount of entries added to log, will stop adding more';\r\n\r\n/**\r\n * A log object which will collect log entries for another object\r\n * @export\r\n * @interface Log\r\n * @public\r\n */\r\nexport class Log {\r\n\r\n  /**\r\n   * List of all entries added to this log\r\n   */\r\n  entries = new Array<LogEntry>();\r\n\r\n  /** @internal */\r\n  private depth = 0;\r\n\r\n  /** @internal */\r\n  private callDepths: string[] = [];\r\n  \r\n  /** @internal */\r\n  startTime: number;\r\n\r\n  /**\r\n   * Maximum amount of entries to add - to prevent memory hogging\r\n   */\r\n  maxEntries = 1000;\r\n\r\n  /**\r\n   * Create a logger and optionally attach it to a parent logger\r\n   * @param string name this logger should use\r\n   * @param Log optional parrent logger to attach to\r\n   * @param string optional initial message to log\r\n   * @internal\r\n   */\r\n  constructor(name: string, parent?: Log, initialMessage?: string) {\r\n    this.rename(name);\r\n    this.linkLog(parent);\r\n\r\n    // after linking, check if we have debug settings\r\n    if (Debug.isDevBuild) {\r\n      const shouldDebug = (Debug.parts as Record<string, boolean>)[name];\r\n      if (shouldDebug != null) {\r\n        this.liveDump = shouldDebug;\r\n        this.keepData = shouldDebug;\r\n      }\r\n    }\r\n\r\n    this.startTime = new Date().getTime();\r\n    if (initialMessage != null) this.add(initialMessage);\r\n  }\r\n\r\n  /* if we should live-dump, can be selectively activated */\r\n  /** @internal */\r\n  liveDump: boolean = liveDump;\r\n\r\n  /** @internal */\r\n  _parentHasLiveDump: boolean = false;\r\n\r\n  /** @internal */\r\n  keepData: boolean = keepData;\r\n\r\n  /** @internal */\r\n  _parentHasKeepData: boolean = false;\r\n\r\n  /**\r\n   * Full identifier of this log-object, with full hierarchy\r\n   * @internal\r\n   */\r\n  fullIdentifier = (): string => `${(this.parent ? this.parent.fullIdentifier() : '')}${this.identifier()}`\r\n\r\n  /**\r\n   * give this logger a new name\r\n   * usually happens in constructor, but in rare cases\r\n   * it's called manually\r\n   * @param name\r\n   * @internal\r\n   */\r\n  rename(name: string): void {\r\n    try {\r\n      const dot = name.indexOf('.');\r\n      this.scope = dot > 0 ? name.substr(0, Math.min(dot, maxScopeLen)) + '.' : '';\r\n      const rest = dot > 0 ? name.substr(dot + 1) : name;\r\n      this.name = rest.substr(0, Math.min(rest.length, maxNameLen));\r\n      this.name = this.name.substr(0, Math.min(this.name.length, maxNameLen));\r\n    } catch (e) {\r\n        /* ignore */\r\n    }\r\n  }\r\n\r\n  /**\r\n   * link this log to a parent\r\n   * usually happens in constructor, but in rare cases\r\n   * this must be called manually\r\n   * @internal\r\n   */\r\n  linkLog = (parent: Log): void => {\r\n    this.parent = parent || this.parent; // if new parent isn't defined, don't replace\r\n    if (this.parent) {\r\n      this._parentHasLiveDump = this.parent.liveDump || this.parent._parentHasLiveDump;\r\n      this._parentHasKeepData = this.parent.keepData || this.parent._parentHasKeepData;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a simple message to the log\r\n   * @param message\r\n   *\r\n   * preferred usage is with string parameter:\r\n   * log.add(`description ${ parameter }`);\r\n   *\r\n   * in case that we experience error with normal string parameter, we can use arrow function to enclose parameter like this () => parameter\r\n   * but use it very rarely, because there is certainly a performance implication!\r\n   * log.add(`description ${() => parameter}`);\r\n   */\r\n  add(message: (() => string) | string, data?: unknown): string {\r\n    // check if the log is already too big\r\n    if (this.entries.length > this.maxEntries) \r\n      return this._prepareMessage(message);\r\n\r\n    // if we just reached the max, add special message\r\n    if (this.entries.length === this.maxEntries) \r\n      this._addEntry(this._prepareEntry(maxEntriesReached));\r\n\r\n    const entry = this._prepareEntry(message, data);\r\n    this._addEntry(entry);\r\n    return entry.message;\r\n  }\r\n\r\n  /** @internal */\r\n  addData(message: (() => string) | string, data: unknown): void {\r\n    if (this.logData()) this.add(message, data);\r\n  }\r\n\r\n  /** @internal */\r\n  logData(): boolean {\r\n    return this.keepData || this._parentHasKeepData;\r\n  }\r\n\r\n  /** @internal */\r\n  _prepareEntry(message: (() => string) | string, data?: unknown): LogEntry {\r\n    const msg = this._prepareMessage(message);\r\n    const time = new Date().getTime() - this.startTime;\r\n    const entry = new LogEntry(this, msg, this.depth, time, data);\r\n    return entry;\r\n  }\r\n\r\n  /** @internal */\r\n  private _prepareMessage(message: (() => string) | string): string {\r\n    if (message instanceof Function) {\r\n      try {\r\n        return ((message as () => string)());\r\n      } catch (e) {\r\n        return 'err: message undefined';\r\n      }\r\n    }\r\n    return message.toString();\r\n  }\r\n\r\n  /** @internal */\r\n  call(name: string, callParams?: string, message?: string, data?: {[key:string]: unknown }): LogCall {\r\n    return new LogCall(this, name, callParams, message, data);\r\n  }\r\n\r\n  /** @internal */\r\n  _callDepthAdd(name: string): void {\r\n    this.depth++;\r\n    this.callDepths.push(name);\r\n  }\r\n\r\n  /** @internal */\r\n  _callDepthRemove(name: string): void {\r\n    this.depth--;\r\n    const last = this.callDepths.pop();\r\n    if (last !== name)\r\n      console.warn(`log: call depth reduced by '${name}' but last was '${last}'`);\r\n  }\r\n\r\n  /**\r\n   * helper to create a text-output of the log info\r\n   * @param separator\r\n   * @param start\r\n   * @param end\r\n   * @internal\r\n   */\r\n  dump(one: LogEntry = null, separator = ' - '): void {\r\n    if (one) this.dumpOne(0, one, separator);\r\n    else this.dumpList();\r\n  }\r\n\r\n  /** @internal */\r\n  dumpList(start: number = 0, length?: number) {\r\n    let index = start;\r\n    this.entries\r\n      .slice(start, length ? start + length : undefined)\r\n      .forEach((e) => this.dumpOne(index++, e));\r\n  }\r\n\r\n  /** @internal */\r\n  private dumpOne(index: number, e: LogEntry, separator = ' - '): void {\r\n    const result = (e.result) ? ' =' + e.result : '';\r\n    const line = ('0000' + index).slice(-4) + ' ' + e.source() + separator + '..'.repeat(e.depth) + e.message + result;\r\n    if (e.data) console.log(line, e.data);\r\n    else console.log(line);\r\n  }\r\n\r\n\r\n  /**\r\n   * add an entry-object to this logger\r\n   * this is often called by sub-loggers to add to parent\r\n   * @param entry\r\n   * @internal\r\n   */\r\n  _addEntry(entry: LogEntry): void {\r\n    if (this.liveDump) this.dump(entry);\r\n    this.entries.push(entry);\r\n    if (this.parent) this.parent._addEntry(entry);\r\n  }\r\n\r\n  /**\r\n   * helper to generate a random 2-char ID\r\n   * @param stringLength\r\n   * @internal\r\n   */\r\n  private randomString(stringLength: number): string {\r\n    const chars = '0123456789abcdefghiklmnopqrstuvwxyz';\r\n    let randomstring = '';\r\n    for (let i = 0; i < stringLength; i++) {\r\n      const rnum = Math.floor(Math.random() * chars.length);\r\n      randomstring += chars.substring(rnum, rnum + 1);\r\n    }\r\n    return randomstring;\r\n  }\r\n\r\n  /**\r\n   * parent logger - important if loggers are chained\r\n   * @internal\r\n   */\r\n  private parent: Log;\r\n\r\n  /**\r\n   * scope of this logger - to easily see which ones\r\n   * are about the same topic\r\n   * @internal\r\n   */\r\n  private scope = 'tdo';\r\n\r\n  /**\r\n   * The name of this log, for scenarios where multiple loggers are mixed\r\n   */\r\n  public name = 'unknwn';\r\n\r\n\r\n  /**\r\n   * Unique 2-character ID of this specific log object\r\n   * @internal\r\n   */\r\n  private id = (): string => this.idCache || (this.idCache = this.randomString(2));\r\n\r\n  /** @internal */\r\n  private idCache: string;\r\n\r\n  /**\r\n   * Unique identifier of this log object, with name and ID\r\n   * @internal\r\n   */\r\n  private identifier = (): string => `${this.scope}${this.name}(${this.id()})`;\r\n\r\n}\r\n","import { LogEntry, Log, LogEntryOptions as LEO } from '.';\r\n\r\n/** @internal */\r\nexport class LogCall {\r\n    /** The initial entry created - important for later attaching the final result of the call */\r\n    public initialEntry: LogEntry;\r\n\r\n    constructor(public log: Log, public name: string, callParams?: string, message?: string, data?: {[key:string]: unknown }) {\r\n        this.initialEntry = this.log._prepareEntry(name + '(' + (callParams || '') + ')');\r\n        this.log._callDepthAdd(name);\r\n        this.log._addEntry(this.initialEntry);\r\n        if (typeof message === 'string') this.add(message);\r\n        if (data) for (let key in data) this.data('initial:' + key, data[key]);\r\n    }\r\n\r\n    private lastMessage: string;\r\n\r\n    add(message: string, data?: unknown, behavior?: LEO) {\r\n        this.lastMessage = message;\r\n        this.log.add(message, data);\r\n        if (behavior) this.processExtraBehavior(behavior, message, data);\r\n    }\r\n\r\n    onlyAddIfNew(message: string, behavior?: LEO) {\r\n        if (this.lastMessage !== message)\r\n        this.add(message);\r\n        if (behavior) this.processExtraBehavior(behavior, message, undefined);\r\n    }\r\n\r\n    /** Add data - but only if data logging is enabled */\r\n    data(message: string, data: unknown) {\r\n        this.log.addData(message, data);\r\n    }\r\n\r\n    done(message?: string, behavior?: LEO): void {\r\n        this.return(null, message || '', behavior);\r\n    }\r\n\r\n    return<T>(result: T, message?: string, behavior?: LEO) {\r\n        message = message || '';\r\n        this.initialEntry.result = message;\r\n        this.log._callDepthRemove(this.name);\r\n\r\n        // if we're in keep-data / debug mode, keep that\r\n        this.initialEntry.data = result;\r\n\r\n        // if we're in live-dump mode, then the entry was already dumped, show again\r\n        if (this.log.liveDump || this.log._parentHasLiveDump)\r\n            this.add(this.name + ' = ' + message, result);\r\n\r\n        if (behavior) this.processExtraBehavior<T>(behavior, message, result);\r\n        return result;\r\n    }\r\n\r\n    /* \r\n     * treat all extra output or errors\r\n     * to allow setting a debug stop point when needed\r\n     * then you can trace the stack-call to see where the error originated\r\n     */\r\n    private processExtraBehavior<T>(behavior: LEO, message: string, data: T) {\r\n        if (behavior === LEO.log) console.log(message, data);\r\n        if (behavior === LEO.warn) console.warn(message, data);\r\n        if (behavior === LEO.error || behavior === LEO.throw) console.error(message, data);\r\n        if (behavior === LEO.throw) throw message;\r\n    }\r\n}\r\n","\r\n/**\r\n * Object manipulator helpers\r\n * @internal\r\n */\r\nexport class Obj {\r\n    /**\r\n     * This is the same as Object.assign, but type-safe.\r\n     * Use it as a replacetment for Object.Assign(this, ... ) in constructors\r\n     */\r\n    static TypeSafeAssign <T, K extends keyof T>(...args: T[]) {\r\n        args.reduce( (result, current) =>\r\n            (Object.keys(current) as K[]).reduce((target, key) => {\r\n                target[key] = current[key];\r\n                return target;\r\n            }, result)\r\n        , args[0]);\r\n    }\r\n\r\n    static DeepClone<T>(original: T, ignoreCircular = false): T {\r\n        if(original === undefined || original === null)\r\n            return original;\r\n        const str = ignoreCircular ? JSON.stringify(original, getCircularReplacer) : JSON.stringify(original);\r\n        if(str === undefined || str === null)\r\n            return original;\r\n        return JSON.parse(str) as T;\r\n    }\r\n}\r\n\r\n\r\nconst getCircularReplacer = () => {\r\n    const seen = new WeakSet();\r\n    return (_:any, value: any) => {\r\n      if (typeof value === \"object\" && value !== null) {\r\n        if (seen.has(value)) {\r\n          return;\r\n        }\r\n        seen.add(value);\r\n      }\r\n      return value;\r\n    };\r\n  };\r\n","import { Obj } from \"../plumbing\";\r\nimport { Log } from \".\";\r\n\r\n/**\r\n * A log entry item\r\n * @export\r\n * @interface LogEntry\r\n * @public\r\n */\r\nexport class LogEntry {\r\n  /**\r\n   * The result of an operation - treated differently in the output\r\n   * @internal\r\n   */\r\n  public result: string;\r\n\r\n  /**\r\n   * Data which is logged - if data-logging is enabled\r\n   * @internal\r\n   */\r\n  get data(): unknown {\r\n    return this._data;\r\n  }\r\n  /** @internal */\r\n  set data(data: unknown) {\r\n    if (data === undefined) return;\r\n    if (this.log.logData()) this._data = Obj.DeepClone(data, true);\r\n  }\r\n  /** @internal */\r\n  private _data?: unknown;\r\n\r\n  /** @internal */\r\n  public source = (): string => this.log.fullIdentifier();\r\n\r\n  /** @internal */\r\n  constructor(\r\n    /** @internal */\r\n    private log: Log,\r\n    public message: string,\r\n    /** @internal */\r\n    public depth: number,\r\n    /** A timestamp for this entry to better see sequences of things happening */\r\n    public time: number,\r\n    data?: unknown\r\n  ) {\r\n    if (data) this.data = data;\r\n  }\r\n}\r\n","import { HasLog, Log } from '.';\r\n\r\ndeclare const window: Window;\r\n\r\n/** @public */\r\ntype LogList = Array<{ key: string, log: Log}>;\r\n\r\nconst msgIntro = 'This is the $2sxc JS Insights - see https://go.2sxc.org/insights \\n'\r\n    + 'Add ?debug=true to the url to log more data. \\n'\r\n    + 'Copy/paste code lines below to see details. \\n'\r\n    + '----------------------------------------------------------------------\\n';\r\n\r\n/** @internal */\r\nclass InsightsSingleton extends HasLog {\r\n\r\n    constructor() {\r\n        super('Sys.Insght');\r\n        this.add('system', 'insights', this.log);\r\n        this.log.add(`this log is usually empty, as it's just a helper tool`)\r\n    }\r\n\r\n    history: { [key: string]: InsightsLogSet } = {};\r\n\r\n    add(setName: string, logName: string, log: Log ) {\r\n        if (!(setName in this.history))\r\n            this.history[setName] = new InsightsLogSet(setName);\r\n        this.history[setName].logs.push({key: logName, log: log});\r\n    }\r\n\r\n    show(partName: string, index?: number, start?: number, length?: number): void {\r\n        // if nothing specified, list what to do to see inner parts\r\n        if (!partName) {\r\n            const keys = Object.keys(this.history);\r\n            console.log(`${msgIntro}${keys.length} insights-sections found: \\n` + keys.map((p) => `$2sxc.insights('${p}');`).join('\\n'));\r\n            return;\r\n        }\r\n\r\n        // partName found, check if it exists\r\n        const part = this.history[partName];\r\n        if (!part) {\r\n            console.error(`part '${partName}' not found`);\r\n            return;\r\n        }\r\n\r\n        // We have a partName, but no index - show list and how to get details\r\n        if (index === undefined) {\r\n            let count = 0;\r\n            const logNames = part.logs\r\n                .map((s) => `$2sxc.insights('${partName}', ${count++}); - will show for '${s.key}'`)\r\n                .join('\\n');\r\n            console.log(`'${partName}' contains ${part.logs.length} entries. Copy/paste the code to to see the logs: \\n` + logNames);\r\n            return;\r\n        }\r\n\r\n        // verify the entry exists\r\n        const logSet = part.logs.length >= index && part.logs[index];\r\n        if (!logSet) {\r\n            console.error(`index ${index} not found in part '${partName}'`);\r\n            return;\r\n        }\r\n\r\n        if (!logSet.log) {\r\n            console.error(`found index ${index} on part '${partName}' but it has no logs`);\r\n            return;\r\n        }\r\n\r\n        console.log(`Will dump the log for ${partName}[${index}] '${logSet.key}'`);\r\n        let autoLimit = false;\r\n        if (start === undefined) {\r\n            autoLimit = true;\r\n            start = 0;\r\n            length = 25;\r\n        }\r\n        logSet.log.dumpList(start || 0, length);\r\n        if (autoLimit && logSet.log.entries.length > length)\r\n            console.warn(`Only showing ${length} of ${logSet.log.entries.length} logs. To show all, add start param '..., 0)' or start/length '..., 0, 100)'`)\r\n}\r\n}\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nclass InsightsLogSet {\r\n    logs: LogList = [];\r\n    constructor(public name: string) {}\r\n}\r\n\r\n// ensure it's only created once\r\n// this is important, because the inpage code also uses this class\r\n// and would otherwise create the object separately\r\nconst singleton: InsightsSingleton = \r\n    window.$2sxc && window.$2sxc._insights   // try to load existing\r\n    || new InsightsSingleton();             // otherwise create new\r\n\r\n/** @internal */\r\nexport const Insights = singleton;\r\n","\r\n/** @internal */\r\nexport function flattenSlashes(original: string): string {\r\n  return original.replace(/(\\/+)/g, '/');\r\n}\r\n","/** @internal */\r\nexport class AssetsLoader {\r\n\r\n  /** Asynchronously runs external and inline scripts in series */\r\n  static runScripts(scripts: HTMLScriptElement[], callback: () => void): void {\r\n    const script = scripts[0];\r\n    const others = scripts.slice(1);\r\n    if (script == null) {\r\n      callback?.();\r\n      return;\r\n    }\r\n\r\n    // create copy\r\n    const copy = document.createElement('script');\r\n    // attributes\r\n    Array.from(script.attributes).forEach((attribute) => {\r\n      copy.setAttribute(attribute.nodeName, attribute.nodeValue);\r\n    });\r\n    // inline part\r\n    copy.textContent = script.textContent;\r\n\r\n    // if src then insert in head, wait for onload or onerror, remove from head and move to next one\r\n    if (copy.type && copy.src) {\r\n      const listener = () => {\r\n        copy.onload = null;\r\n        copy.onerror = null;\r\n        document.head.removeChild(copy);\r\n        this.runScripts(others, callback);\r\n      };\r\n      copy.onload = listener;\r\n      copy.onerror = listener;\r\n      document.head.appendChild(copy);\r\n      return;\r\n    }\r\n\r\n    // if no src then inline, insert to head and remove instantly and move to next one\r\n    setTimeout(() => {\r\n      document.head.appendChild(copy);\r\n      document.head.removeChild(copy);\r\n      this.runScripts(others, callback);\r\n    });\r\n  }\r\n}\r\n","import { AssetsLoader } from './assets-loader';\r\n\r\n/** @internal */\r\nexport class NoJQ {\r\n\r\n    /** https://api.jquery.com/ready/ */\r\n    static ready(callback: () => void): void {\r\n        if (document.readyState === 'complete') {\r\n            callback();\r\n        } else {\r\n            document.addEventListener('DOMContentLoaded', () => callback(), { once: true });\r\n        }\r\n    }\r\n\r\n    /** https://api.jquery.com/jquery.param/ */\r\n    static param(obj: any): string {\r\n        const param = Object.entries(obj)\r\n            .map(([k, v]) => `${encodeURIComponent(k)}=${v == null ? '' : typeof v === 'string' ? encodeURIComponent(v) : encodeURIComponent(JSON.stringify(v))}`)\r\n            .join('&');\r\n        return param;\r\n    }\r\n\r\n    /** Build DOM elements from string */\r\n    static domFromString(string: string): HTMLElement[] {\r\n        // build elements from string into dummy parent\r\n        const dummyParent = document.createElement('div');\r\n        dummyParent.insertAdjacentHTML('afterbegin', string);\r\n\r\n        // scripts created from string are not executable and have to recreated manually to be executable\r\n        Array.from(dummyParent.querySelectorAll('script')).forEach((brokenScript) => {\r\n            const workingScript = document.createElement('script');\r\n            // copy attributes\r\n            Array.from(brokenScript.attributes).forEach((attribute) => {\r\n                workingScript.setAttribute(attribute.nodeName, attribute.nodeValue);\r\n            });\r\n            // copy inline part\r\n            workingScript.textContent = brokenScript.textContent;\r\n            // replace a non executable script with executable one\r\n            NoJQ.replaceWith(brokenScript, workingScript, false);\r\n        });\r\n\r\n        // remove created elements from dummy parent so it can be garbage collected\r\n        const elements = Array.from(dummyParent.children) as HTMLElement[];\r\n        elements.forEach((element) => {\r\n            dummyParent.removeChild(element);\r\n        });\r\n        return elements;\r\n    }\r\n\r\n    /** https://api.jquery.com/offset/ */\r\n    static offset(element: HTMLElement): { left: number; top: number; } {\r\n        const clientRect = element.getBoundingClientRect();\r\n        const offset: { left: number; top: number; } = {\r\n            top: clientRect.top + window.scrollY,\r\n            left: clientRect.left + window.scrollX,\r\n        };\r\n        return offset;\r\n    }\r\n\r\n    /** https://api.jquery.com/width/ */\r\n    static width(element: HTMLElement): number {\r\n        // jquery width === offsetWidth - borders - padding\r\n        const computedStyle = getComputedStyle(element);\r\n        const width = element.offsetWidth === 0\r\n            ? 0\r\n            : element.offsetWidth\r\n            - (parseInt(computedStyle.getPropertyValue('border-left-width'), 10) + parseInt(computedStyle.getPropertyValue('border-right-width'), 10))\r\n            - (parseInt(computedStyle.getPropertyValue('padding-left'), 10) + parseInt(computedStyle.getPropertyValue('padding-right'), 10));\r\n        return width;\r\n    }\r\n\r\n    /** https://api.jquery.com/height/ */\r\n    static height(element: HTMLElement): number {\r\n        // jquery height === offsetHeight - borders - padding\r\n        const computedStyle = getComputedStyle(element);\r\n        const height = element.offsetHeight === 0\r\n            ? 0\r\n            : element.offsetHeight\r\n            - (parseInt(computedStyle.getPropertyValue('border-top-width'), 10) + parseInt(computedStyle.getPropertyValue('border-bottom-width'), 10))\r\n            - (parseInt(computedStyle.getPropertyValue('padding-top'), 10) + parseInt(computedStyle.getPropertyValue('padding-bottom'), 10));\r\n        return height;\r\n    }\r\n\r\n\r\n    /** https://api.jquery.com/empty/ */\r\n    static empty(element: HTMLElement): void {\r\n        Array.from(element.childNodes).forEach((n) => {\r\n            element.removeChild(n);\r\n        });\r\n    }\r\n\r\n    /** https://api.jquery.com/replacewith/ */\r\n    static replaceWith(toBeReplaced: HTMLElement, newElement: HTMLElement, runScripts: boolean): void {\r\n        const parent = toBeReplaced.parentElement;\r\n\r\n        // disable scripts before replacing dom\r\n        const scripts = Array.from(newElement.querySelectorAll('script'));\r\n        const restores: ScriptTypeRestore[] = [];\r\n        scripts.forEach((script) => {\r\n            restores.push({ script, type: script.type });\r\n            script.type = null;\r\n        });\r\n\r\n        // replace dom\r\n        parent.replaceChild(newElement, toBeReplaced);\r\n\r\n        // enable scripts\r\n        restores.forEach((restore) => {\r\n            restore.script.type = restore.type;\r\n        });\r\n\r\n        if (runScripts) {\r\n            // run scripts manually to ensure proper timing\r\n            AssetsLoader.runScripts(scripts, undefined);\r\n        }\r\n    }\r\n\r\n    /** https://api.jquery.com/append/ */\r\n    static append(parent: HTMLElement, newElements: HTMLElement[], runScripts: boolean): void {\r\n        const scripts: HTMLScriptElement[] = [];\r\n\r\n        newElements.forEach((element) => {\r\n            if (element.tagName.toLocaleLowerCase() === 'script') {\r\n                const script = element as HTMLScriptElement;\r\n                // disable script before inserting to the dom\r\n                const restoreType = script.type;\r\n                script.type = null;\r\n                // insert to dom\r\n                parent.appendChild(script);\r\n                // enable script\r\n                script.type = restoreType;\r\n                scripts.push(script);\r\n            } else {\r\n                parent.appendChild(element);\r\n            }\r\n        });\r\n\r\n        if (runScripts && scripts.length > 0) {\r\n            // run scripts manually to ensure proper timing\r\n            AssetsLoader.runScripts(scripts, undefined);\r\n        }\r\n    }\r\n}\r\n\r\ninterface ScriptTypeRestore {\r\n    script: HTMLScriptElement;\r\n    type: string;\r\n}\r\n","\r\n/**\r\n * This is a placeholder in the settings, which must be replaced with \"2sxc\" or another term for other dnn extensions\r\n * @internal\r\n */\r\nexport const ApiExtensionPlaceholder = 'e.x.t';\r\n\r\n/**\r\n * The special header meta tag containing settings for 2sxc\r\n * @internal\r\n */\r\nexport const MetaHeaderJsApi = '_jsApi';\r\n\r\n/**\r\n * The fallback path to the UI\r\n * @internal\r\n */\r\nexport const DnnUiRoot = '/desktopmodules/ToSic.Sxc/';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const PlatformOqtane = 'oqtane';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const PlatformDnn = 'dnn';\r\n\r\n/**\r\n * The fallback AntiForgery token header name (as in Dnn)\r\n * @internal\r\n */\r\nexport const AntiForgeryTokenHeaderNameDnn = 'RequestVerificationToken';\r\n","import { HasLog, NoJQ } from '../../../core';\r\nimport { AntiForgeryTokenHeaderNameDnn, DnnUiRoot, PlatformDnn } from '../constants';\r\nimport { EnvironmentSpecs } from './environment-specs';\r\nimport { SxcGlobalEnvironment } from './sxc-global-environment';\r\n\r\nconst helpAutoDetect = 'You must inject the jsApi parameters to prevent auto-detection.';\r\ndeclare const window: Window;\r\n\r\n/**\r\n * This helps load environment information from DNN ServicesFramework - it's a fallback in case the other mechanisms fail\r\n * @internal\r\n */\r\nexport class EnvironmentDnnSfLoader extends HasLog {\r\n    constructor(public env: SxcGlobalEnvironment) {\r\n        super('Env.DnnLdr', env.log);\r\n    }\r\n\r\n\r\n    /**\r\n     * This will assume the new parameter injection failed and it will attempt to fallback\r\n     * it's for backward compatibility, in case something is using $2sxc and doesn't provide the new\r\n     * implementation\r\n     */\r\n    dnnSfFallback(): void {\r\n        const cl = this.log.call('dnnSfFallback');\r\n        // await page-ready to then initialize the stuff\r\n        NoJQ.ready(() => this.dnnSfLoadWhenDocumentReady());\r\n        cl.done('started dom-ready watcher')\r\n    }\r\n\r\n    private dnnSfLoadWhenDocumentReady(): void {\r\n        const cl = this.log.call('dnnSfLoadWhenDocumentReady');\r\n        if (typeof window.$ === 'undefined') {\r\n            cl.done('error');\r\n            throw `Can't load pageid, moduleid, etc. and $ is not available. \\n ${helpAutoDetect}`;\r\n        }\r\n\r\n        const sf = window.$.ServicesFramework;\r\n        if (typeof sf === 'undefined') {\r\n            cl.done('error');\r\n            throw `Can't load pageid, moduleid etc. and DNN SF is not available. \\n ${helpAutoDetect}`;\r\n        }\r\n        const dnnSf = sf(0);\r\n        var apiRoot = dnnSf.getServiceRoot('2sxc');\r\n        var sfJsInfo: EnvironmentSpecs = {\r\n            page: dnnSf.getTabId(),\r\n            root: 'unknown',\r\n            api: apiRoot,\r\n            appApi: apiRoot,\r\n            rvtHeader: AntiForgeryTokenHeaderNameDnn,\r\n            rvt: dnnSf.getAntiForgeryValue(),\r\n            uiRoot: DnnUiRoot,\r\n            platform: PlatformDnn\r\n            // dialogQuery: '',\r\n            // publicKey: ''\r\n        };\r\n        this.env.load(sfJsInfo, 'dnn SF');\r\n        cl.done();\r\n    }\r\n}\r\n","import { Log } from '../../../core';\r\nimport { EnvironmentMetaLoader } from './env-loader-meta';\r\nimport { EnvironmentSpecs } from './environment-specs';\r\n\r\nconst InputValue = 'value';\r\n\r\nconst SelectorInputRvt = `input[name=__RequestVerificationToken]`;\r\n\r\n/**\r\n * Special loader for dynamic pages like Oqtane, where content can change at runtime\r\n * @internal\r\n */\r\nexport class EnvironmentLoaderDynamic {\r\n\r\n  public log: Log;\r\n\r\n  constructor(\r\n      private mainLoader: EnvironmentMetaLoader\r\n  ) {\r\n    this.log = new Log('ldr.dynmic', mainLoader.log);\r\n  }\r\n\r\n  /**\r\n   * Watch for changes in our special meta header, to update the variables.\r\n   * Important for Oqtane, which changes the page on the fly without reloading.\r\n   */\r\n  public startMetaTagObserver(attribute: string): void {\r\n    if (!!this.observer) return;\r\n    this.observer = new MutationObserver((mutationsList: MutationRecord[]) => {\r\n      for(const mut of mutationsList)\r\n        if (mut.type === 'attributes' && mut.attributeName === attribute)\r\n          this.mainLoader.updateEnv(JSON.parse(this.mainLoader.getMetaContent()) as EnvironmentSpecs)\r\n    });\r\n    this.log.add('start observing meta tag');\r\n    this.observer.observe(this.mainLoader.getJsApiMetaTag(), { attributes: true, childList: false, subtree: false });\r\n  }\r\n  private observer: MutationObserver;\r\n\r\n  /**\r\n   * Load RequestVerificationToken from the hidden form-field in Oqtane\r\n   */\r\n  public startInputRvtObserver(): void {\r\n    if (!!this.inputRvtObserver) return;\r\n    this.inputRvtObserver = new MutationObserver((mutationsList: MutationRecord[]) => {\r\n      for(const mut of mutationsList)\r\n        if (mut.type === 'attributes' && mut.attributeName === InputValue)\r\n          this.loadRvtFromHiddenInput(mut.target as HTMLInputElement);\r\n    });\r\n    this.log.add('start observing Rvt Input');\r\n    const hiddenField = document.querySelector(SelectorInputRvt);\r\n    if (hiddenField == null) {\r\n      console.log(`Can't find Oqtane RVT field with selector ${SelectorInputRvt}\\n` +`So we cannot watch it for changes.\\n` +`This will probably cause the $2sxc to fail.`);\r\n      return;\r\n    }\r\n    this.loadRvtFromHiddenInput(hiddenField as HTMLInputElement);\r\n    this.inputRvtObserver.observe(hiddenField, { attributes: true, childList: false, subtree: false });\r\n  }\r\n  private inputRvtObserver: MutationObserver;\r\n\r\n  private loadRvtFromHiddenInput(input: HTMLInputElement){\r\n    this.log.add('Input Rvt updated');\r\n    if(input && input.value)\r\n      this.mainLoader.env.updateRvt(input.value);\r\n  }\r\n}\r\n","import { EnvironmentDnnSfLoader } from './env-loader-dnn-sf';\r\nimport { MetaHeaderJsApi, PlatformOqtane } from '../constants';\r\nimport { HasLog, Log } from '../../../core';\r\nimport { EnvironmentLoaderDynamic } from './env-loader-dynamic';\r\nimport { SxcGlobalEnvironment } from './sxc-global-environment';\r\nimport { EnvironmentSpecs } from './environment-specs';\r\n\r\n// temp: usually 10, but because Oqtane has some delays, we'll temporarily increase to 100 till we're safe\r\nconst maxRetries = 100;\r\nconst retryMs = 10;\r\n\r\nconst MetaSourceId = 'meta header';\r\n\r\nconst MetaProperty = 'content';\r\n\r\n\r\nfunction logTest(): boolean\r\n{\r\n    console.log('test');\r\n    return true;\r\n}\r\n/**\r\n * This loads environment information from the meta-header tag.\r\n * Because of timing issues, it will try multiple times\r\n * @internal\r\n */\r\nexport class EnvironmentMetaLoader extends HasLog {\r\n    public retries = 0;\r\n\r\n    // public log: Log;\r\n\r\n    private dynamicPageHelper: EnvironmentLoaderDynamic;\r\n\r\n    constructor(public env: SxcGlobalEnvironment) {\r\n        super('Env.MetaLd', logTest ? env.log : env.log);\r\n        this.dynamicPageHelper = new EnvironmentLoaderDynamic(this);\r\n    }\r\n\r\n    public loadMetaFromHeader(forceFallback = false): void {\r\n        const cl = this.log.call('loadMetaFromHeader', `${forceFallback}`);\r\n        // avoid duplicate execution\r\n        if(this.env.ready) return cl.done('loadMeta - ready');\r\n\r\n        this.log.add('loadMetaFromHeader: start, retry:' + this.retries + ', force fallback: ' + forceFallback);\r\n        const meta = this.getMetaContent();\r\n        if(!meta) {\r\n            this.retries++;\r\n            if(forceFallback || this.retries >= maxRetries) {\r\n                new EnvironmentDnnSfLoader(this.env).dnnSfFallback();\r\n                return cl.done()\r\n            }\r\n            setTimeout(() => { this.loadMetaFromHeader(); }, retryMs);\r\n            return cl.done('will retry');\r\n        }\r\n        // Load the settings\r\n        this.updateEnv(JSON.parse(meta) as EnvironmentSpecs);\r\n\r\n        // monitor setting changes - important for Oqtane\r\n        this.dynamicPageHelper.startMetaTagObserver(MetaProperty);\r\n        cl.done();\r\n    }\r\n\r\n    public updateEnv(newJsInfo: EnvironmentSpecs) {\r\n        this.log.add('meta env info updated');\r\n        this.env.load(newJsInfo, MetaSourceId);\r\n        if(newJsInfo.platform === PlatformOqtane)\r\n            this.dynamicPageHelper.startInputRvtObserver();\r\n    }\r\n\r\n    public getMetaContent(): string {\r\n        const ourMeta = this.getJsApiMetaTag();\r\n        if (!ourMeta) return null;\r\n        return ourMeta.getAttribute(MetaProperty)\r\n    }\r\n\r\n    public getJsApiMetaTag() {\r\n        return document.querySelector(`meta[name=${MetaHeaderJsApi}]`);\r\n    }\r\n\r\n\r\n    /**\r\n     * Watch for changes in our special meta header, to update the variables.\r\n     * Important for Oqtane, which changes the page on the fly without reloading.\r\n     */\r\n    public startMetaTagObserver(): void {\r\n      if (!!this.observer) return;\r\n      this.observer = new MutationObserver((mutationsList: MutationRecord[]) => {\r\n        for(const mut of mutationsList)\r\n          if (mut.type === 'attributes' && mut.attributeName === MetaProperty)\r\n            this.updateEnv(JSON.parse(this.getMetaContent()) as EnvironmentSpecs)\r\n      });\r\n      this.log.add('start observing meta tag');\r\n      this.observer.observe(this.getJsApiMetaTag(), { attributes: true, childList: false, subtree: false });\r\n    }\r\n    private observer: MutationObserver;\r\n\r\n}\r\n","import { EnvironmentMetaLoader } from './env-loader-meta';\r\nimport { HasLog, Insights, SxcApiUrlRoot } from '../../../core';\r\nimport { AntiForgeryTokenHeaderNameDnn, DnnUiRoot, PlatformDnn } from '../constants';\r\nimport { EnvironmentSpecs } from './environment-specs';\r\n\r\ndeclare const _jsApi: EnvironmentSpecs;\r\n\r\n/**\r\n * Provides environment information to $2sxc - usually page-id, api-root and stuff like that\r\n * @public\r\n */\r\nexport class SxcGlobalEnvironment extends HasLog {\r\n    /** @internal */\r\n    private header: EnvironmentSpecs;\r\n    /** \r\n     * Flag to determine if the environment information is available. \r\n     */\r\n    public ready = false;\r\n    /** \r\n     * Where the environment information came from.\r\n     */\r\n    public source = '';\r\n\r\n    /** @internal */\r\n    public metaLoader: EnvironmentMetaLoader;\r\n\r\n    /** @internal */\r\n    constructor() {\r\n        super('Environment', null, 'starting');\r\n        this.log.keepData = true;   // always keep here for clarity\r\n        Insights.add('system', 'environment', this.log);\r\n        this.metaLoader = new EnvironmentMetaLoader(this);\r\n\r\n        // check if a global variable was already set which we should use\r\n        if(typeof _jsApi !== typeof undefined) {\r\n            this.log.add('found _jsApi, will use');\r\n            this.load(_jsApi, 'global variable _jsApi');\r\n        } else {\r\n            this.log.add('will start initializing');\r\n            this.metaLoader.loadMetaFromHeader();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Manually load a new EnvironmentSpecs in cases where the page cannot provide them. \r\n     * This is only used in scenarios outside of Dnn / Oqtane, you will usually not need this. \r\n     * @param envSpecs new info to load\r\n     * @param source _optional_ name where the data came from\r\n     */\r\n    public load(envSpecs: EnvironmentSpecs, source?: string) {\r\n        const cl = this.log.call('load');\r\n        if(envSpecs.root && !envSpecs.api) {\r\n            cl.add('root provided, api missing, will auto-complete');\r\n            const addSlash = (envSpecs.root.endsWith('/') ? '' : '/');\r\n            envSpecs.api = `${envSpecs.root}${addSlash}${SxcApiUrlRoot}`;\r\n        }\r\n        this.header = envSpecs;\r\n\r\n        // in some cases the UpdateRvt may already have been called before\r\n        // in which case it's probably more relevant\r\n        // so we should set it again\r\n        if(this.replacedRvt) this.header.rvt = this.replacedRvt;\r\n\r\n        this.ready = true;\r\n        this.source = source || 'external/unknown' + (this.replacedRvt ? '+rvt': '');\r\n        cl.return(envSpecs, 'loaded from ' + this.source);\r\n    }\r\n\r\n    /** @internal */\r\n    private replacedRvt: string;\r\n\r\n    /** @internal */\r\n    public updateRvt(newRvt: string) {\r\n        if(!newRvt) return;\r\n        this.replacedRvt = newRvt;\r\n        this.header.rvt = newRvt;\r\n    }\r\n\r\n    /**\r\n     * The API endpoint url from the environment\r\n     */\r\n    public api(): string {\r\n        this.ensureReadyOrThrow('api');\r\n        return this.header.api;\r\n    }\r\n\r\n    // WIP - may return undefined\r\n    /** @internal */\r\n    public appApi(): string {\r\n        // WIP - must get it to work without 'appApi' but only 'api' to ensure ...\r\n        this.ensureReadyOrThrow('appApi');\r\n        return this.header.appApi;\r\n    }\r\n\r\n    /**\r\n     * The current page ID - often needed in API calls\r\n     */\r\n    public page(): number {\r\n        this.ensureReadyOrThrow('page');\r\n        return this.header.page;\r\n    }\r\n\r\n    /**\r\n     * The request verification token header name for internal WebAPI calls\r\n     */\r\n    public rvtHeader(): string {\r\n        this.ensureReadyOrThrow('rvtHeader');\r\n        return this.header.rvtHeader || AntiForgeryTokenHeaderNameDnn;\r\n    }\r\n\r\n    /**\r\n     * The request-verification token for internal WebAPI calls\r\n     */\r\n    public rvt(): string {\r\n        this.ensureReadyOrThrow('rvt');\r\n        return this.header.rvt;\r\n    }\r\n\r\n    /**\r\n     * The uiRoot path\r\n     * @internal\r\n     */\r\n    public uiRoot(): string {\r\n        this.ensureReadyOrThrow('uiRoot');\r\n        return this.header.uiRoot || DnnUiRoot;\r\n    }\r\n\r\n    /**\r\n     * The platform code like 'oqt' or 'dnn' in case the JS needs to know the difference\r\n     */\r\n    public platform(): string {\r\n        this.ensureReadyOrThrow('platform');\r\n        return this.header.platform || PlatformDnn;\r\n    }\r\n\r\n    /**\r\n     * The dialogQuery added in 14.08 because of issues with opening the dialog on sub-portals\r\n     * ATM very internal\r\n     * Don't check if it was initialized, because it's valid if it doesn't exist\r\n     * @internal\r\n     */\r\n    public dialogQuery(): string {\r\n      return this.header.dialogQuery ?? null;\r\n    }\r\n  \r\n    /**\r\n     * The public key for secure endpoints\r\n     * ATM very internal\r\n     * Don't check if it was initialized, because it's valid if it doesn't exist\r\n     * @internal\r\n     */\r\n    public publicKey(): string {\r\n      return this.header.publicKey ?? null;\r\n    }\r\n\r\n    /** @internal */\r\n    private ensureReadyOrThrow(partRequested: string): void {\r\n        if(this.ready) return;\r\n\r\n        // try one last time - usually it should really be ready by now\r\n        this.log.add('ensureReady - force last attempt to load MetaHeader for ' + partRequested)\r\n        this.metaLoader.loadMetaFromHeader(true);\r\n\r\n        // if still not ready, throw exception to console log\r\n        if(this.ready) return;\r\n        throw `Can't find ${partRequested} - something went wrong, pls contact 2sxc.org`;\r\n    }\r\n\r\n}\r\n\r\n","import { NoJQ } from '../../../../core';\r\nimport { Sxc } from '../sxc';\r\nimport { ZzzAjaxSettingsDeprecated } from './ajax-settings';\r\nimport { SxcWebApi } from './sxc-web-api';\r\n\r\n/** @internal */\r\nexport class AjaxPromise {\r\n  constructor(private api: SxcWebApi, private sxc: Sxc) {\r\n  }\r\n\r\n  /**\r\n   * Make a jQuery style promise request\r\n   * @param settings: settings\r\n   * @returns JQueryPromise<any>\r\n   */\r\n  public makePromise(settings: ZzzAjaxSettingsDeprecated): any {\r\n    var headers = this.api.headers();\r\n    // debugger;\r\n    if (window.$ == null) {\r\n      throw new Error('JQuery is now removed from 2sxc installation. Please use newer api like fetch or include JQuery in your project');\r\n    }\r\n    const promise = window.$.ajax({\r\n      async: true,\r\n      dataType: (settings as any).dataType || 'json', // default is json if not specified\r\n      data: JSON.stringify((settings as any).data),\r\n      contentType: 'application/json',\r\n      type: (settings as any).method,\r\n      url: this.getActionUrl(settings),\r\n      beforeSend(xhr: any) {\r\n        for (var key in headers)\r\n          if (headers.hasOwnProperty(key))\r\n            xhr.setRequestHeader(key, headers[key]);\r\n      },\r\n    }) as any;\r\n\r\n    if (!settings.preventAutoFail)\r\n      promise.fail(this.sxc.showDetailedHttpError);\r\n\r\n    return promise;\r\n  }\r\n\r\n\r\n  /**\r\n   * Generate the correct WebApi url\r\n   * @param settings the settings as they would be in jQuery\r\n   */\r\n  private getActionUrl(settings: ZzzAjaxSettingsDeprecated): string {\r\n    var url = (settings as any).url || 'app/auto/api/' + settings.controller + '/' + settings.action;\r\n    // 2020-03-13 stop adding 2sxc endpoint-name, it's already happening in apiUrl so with this it happens 2x\r\n    // var endpoint = settings.endpoint || ToSxcName;\r\n    var base = this.sxc.http.apiUrl(url, settings.endpoint);\r\n\r\n    return base + (!settings.params ? '' : ('?' + NoJQ.param(settings.params)));\r\n  }\r\n}\r\n","/**\r\n * Represents encrypted data including the version, encrypted data, key, and IV.\r\n */\r\nexport class EncryptedData {\r\n  /** The encryption version number. */\r\n  public version: number;\r\n  /** The base64-encoded encrypted data. */\r\n  public data: string;\r\n  /** The base64-encoded encrypted AES key. */\r\n  public key: string;\r\n  /** The base64-encoded initialization vector (IV). */\r\n  public iv: string;\r\n\r\n  /**\r\n   * Creates an instance of EncryptedData.\r\n   * @param data - The base64-encoded encrypted data.\r\n   * @param key - The base64-encoded encrypted AES key.\r\n   * @param iv - The base64-encoded initialization vector.\r\n   */\r\n  constructor(data: string, key: string, iv: string) {\r\n    this.version = 1;\r\n    this.data = data;\r\n    this.key = key;\r\n    this.iv = iv;\r\n  }\r\n}\r\n","import { Sxc } from '../sxc';\r\nimport { EncryptedData } from './encrypted-data';\r\nimport { FetchOptions } from './fetch-options';\r\n\r\nexport class SecureEndpoint implements Omit<FetchOptions, 'method'> {\r\n  public encryptBody;\r\n  public encryptShowErrorToUser;\r\n\r\n  private throwIfFails: boolean;\r\n\r\n  constructor(private sxc: Sxc, config: FetchOptions) {\r\n    // console.log(`encrypt config`, config);\r\n    // Set the encryption mode, (null defaults to 'auto')\r\n    this.encryptBody = config.encryptBody ?? config.encrypt ?? 'auto';\r\n    // If encrypt is 'force' and encryption fails, throw error\r\n    this.throwIfFails = (config.encryptBody == true || config.encryptBody == 'force');\r\n    // If showErrorToUser is true, show error to user\r\n    this.encryptShowErrorToUser = config.encryptShowErrorToUser ?? false;\r\n  }\r\n\r\n  /**\r\n   * Function to encrypt data\r\n   * @param data - Data to encrypt\r\n   * @returns Encrypted data containing the encrypted key, IV, and encrypted data, or unencrypted data if public key or crypto is not available\r\n   */\r\n  public async encryptData(data: string | Record<string, unknown>): Promise<string | Record<string, unknown>> {\r\n    // Return unencrypted data if encryption is disabled\r\n    if (this.encryptBody === false)\r\n      return data;\r\n\r\n    // Fetch the RSA public key from the server\r\n    const publicKeyPem: string | null = this.sxc.env.publicKey();\r\n\r\n    // If the public key is not available, eventually return original unencrypted data\r\n    if (!publicKeyPem) {\r\n      this.handleOrThrowError(\"Encryption is not available. Public key is missing.\");\r\n      return data; // eventually fallback to return unencrypted data\r\n    }\r\n\r\n    // window.crypto.subtle feature is available only in secure browser contexts (HTTPS, localhost, etc). \r\n    if (!window.crypto.subtle) {\r\n      this.handleOrThrowError(\"Encryption is not available because 'window.crypto.subtle' is unavailable. Check if page is on HTTPS.\");\r\n      return data; // eventually fallback to return unencrypted data\r\n    }\r\n\r\n    // Import the RSA public key\r\n    const publicKey: CryptoKey = await this.importPublicKey(publicKeyPem);\r\n\r\n    // Generate a random AES key\r\n    const aesKey: CryptoKey = await window.crypto.subtle.generateKey(\r\n      // algorithm:\r\n      {\r\n        name: \"AES-CBC\",\r\n        length: 256,\r\n      },\r\n      // extractable:\r\n      true, \r\n      // keyUsages:\r\n      [\"encrypt\", \"decrypt\"]\r\n    );\r\n\r\n    // Export the AES key to raw bits\r\n    const rawAesKey: ArrayBuffer = await window.crypto.subtle.exportKey(\"raw\", aesKey);\r\n\r\n    // Encrypt the AES key using RSA public key\r\n    const encryptedKey: ArrayBuffer = await window.crypto.subtle.encrypt(\r\n      {\r\n        name: \"RSA-OAEP\",\r\n      },\r\n      publicKey,\r\n      rawAesKey\r\n    );\r\n\r\n    // Generate a random IV (initialization vector, so that the first block is not predictable)\r\n    const iv: Uint8Array = window.crypto.getRandomValues(new Uint8Array(16)); // 16 bytes for AES-CBC\r\n\r\n    // Convert the data to ArrayBuffer\r\n    const enc: TextEncoder = new TextEncoder();\r\n\r\n    const dataString: string = JSON.stringify(data ?? \"\");\r\n\r\n    const encodedMessage: Uint8Array = enc.encode(dataString);\r\n\r\n    // Encrypt the data using AES key\r\n    const encryptedData: ArrayBuffer = await window.crypto.subtle.encrypt(\r\n      {\r\n        name: \"AES-CBC\",\r\n        iv: iv,\r\n      },\r\n      aesKey,\r\n      encodedMessage\r\n    );\r\n\r\n    // Convert ArrayBuffers to base64 strings\r\n    // This ensures that the very final JSON conversion is lighter\r\n    // Otherwise the binary values will be converted to \"\\u0006\" sequences which take much more space\r\n    const encryptedKeyBase64: string = this.arrayBufferToBase64(encryptedKey);\r\n    const encryptedDataBase64: string = this.arrayBufferToBase64(encryptedData);\r\n    const ivBase64: string = this.arrayBufferToBase64(iv.buffer);\r\n\r\n    const encrypted = new EncryptedData(encryptedDataBase64, encryptedKeyBase64, ivBase64);\r\n    return encrypted as unknown as Record<string, unknown>;\r\n  }\r\n\r\n  /**\r\n   * Handle error as configured. Throw exception or log warning and eventually show alert to user\r\n   * @param message - Error message\r\n   */\r\n  private handleOrThrowError(message: string) {\r\n    if (this.encryptShowErrorToUser) alert(message);\r\n    if (this.throwIfFails)\r\n      // console.error(message);  \r\n      throw new Error(message);\r\n    // for debugging\r\n    // else\r\n    //   console.warn(message + \"\\nReturning unencrypted data.\");\r\n  }\r\n\r\n  /**\r\n   * Converts SPKI PEM format to DER ArrayBuffer\r\n   * @param spkiPem - SPKI public key in PEM format\r\n   * @returns ArrayBuffer of DER\r\n   */\r\n  private getSpkiDer(spkiPem: string): ArrayBuffer {\r\n    const binaryDerString: string = window.atob(spkiPem);\r\n    return this.str2ab(binaryDerString);\r\n  }\r\n\r\n  /**\r\n   * Imports the public key for encryption\r\n   * @param spkiPem - SPKI public key in PEM format\r\n   * @returns CryptoKey usable for encryption\r\n   */\r\n  private async importPublicKey(spkiPem: string): Promise<CryptoKey> {\r\n    // window.crypto.subtle feature is available only in secure browser contexts (HTTPS, localhost, etc).\r\n    return await window.crypto.subtle.importKey(\r\n      \"spki\",\r\n      this.getSpkiDer(spkiPem),\r\n      {\r\n        name: \"RSA-OAEP\",\r\n        hash: \"SHA-256\",\r\n      },\r\n      true,\r\n      [\"encrypt\"]\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Converts a string to an ArrayBuffer\r\n   * @param str - Input string\r\n   * @returns ArrayBuffer representation\r\n   */\r\n  private str2ab(str: string): ArrayBuffer {\r\n    const buf: ArrayBuffer = new ArrayBuffer(str.length);\r\n    const bufView: Uint8Array = new Uint8Array(buf);\r\n    for (let i = 0; i < str.length; i++) {\r\n      bufView[i] = str.charCodeAt(i);\r\n    }\r\n    return buf;\r\n  }\r\n\r\n  /**\r\n   * Converts an ArrayBuffer to a Base64 string\r\n   * @param buffer - Input ArrayBuffer\r\n   * @returns Base64 encoded string\r\n   */\r\n  private arrayBufferToBase64(buffer: ArrayBuffer): string {\r\n    const bytes: Uint8Array = new Uint8Array(buffer);\r\n    let binary: string = '';\r\n    for (let i = 0; i < bytes.byteLength; i++) {\r\n      binary += String.fromCharCode(bytes[i]);\r\n    }\r\n    return window.btoa(binary);\r\n  }\r\n}","import { Sxc } from '../sxc';\r\nimport { AjaxPromise } from './ajax-promise';\r\nimport { ZzzAjaxSettingsDeprecated } from './ajax-settings';\r\nimport { NoJQ } from '../../../../core';\r\nimport { ZzzSxcWebApiDeprecated } from './sxc-web-api-deprecated';\r\nimport { FetchOptions } from './fetch-options';\r\nimport { SecureEndpoint } from './secure-endpoint';\r\n\r\n/**\r\n * helper API to run ajax / REST calls to the server\r\n * it will ensure that the headers etc. are set correctly\r\n * and that urls are rewritten\r\n * @public\r\n */\r\nexport class SxcWebApi implements ZzzSxcWebApiDeprecated {\r\n  // 2023-05-22 believe this is never used, so removing  \r\n  // /**\r\n  //  * @internal\r\n  //  * TODO: PROBABLY remove ? but must be sure it's not used elsewhere\r\n  //  */\r\n  // private readonly env: SxcGlobalEnvironment;\r\n\r\n  /**\r\n   * \r\n   * @param sxc \r\n   * @internal\r\n   */\r\n  constructor(private readonly sxc: Sxc) {\r\n    // 2023-05-22 believe this is never used, so removing\r\n    // this.env = sxc.root.env;\r\n  }\r\n\r\n  /**\r\n   * **Deprecated** - docs in the separate interface\r\n   * @deprecated use fetchJson instead\r\n   */\r\n  get(settingsOrUrl: string | ZzzAjaxSettingsDeprecated, params?: any, data?: any, preventAutoFail?: boolean): any {\r\n    return this.request(settingsOrUrl, params, data, preventAutoFail, 'GET');\r\n  }\r\n\r\n  /**\r\n   * **Deprecated** - docs in the separate interface\r\n   * @deprecated use fetchJson instead\r\n   */\r\n  post(settingsOrUrl: string | ZzzAjaxSettingsDeprecated, params?: any, data?: any, preventAutoFail?: boolean): any {\r\n    return this.request(settingsOrUrl, params, data, preventAutoFail, 'POST');\r\n  }\r\n\r\n  /**\r\n   * **Deprecated** - docs in the separate interface\r\n   * @deprecated use fetchJson instead\r\n   */\r\n  delete(settingsOrUrl: string | ZzzAjaxSettingsDeprecated, params?: any, data?: any, preventAutoFail?: boolean): any {\r\n    return this.request(settingsOrUrl, params, data, preventAutoFail, 'DELETE');\r\n  }\r\n\r\n  /**\r\n   * **Deprecated** - docs in the separate interface\r\n   * @deprecated use fetchJson instead\r\n   */\r\n  put(settingsOrUrl: string | ZzzAjaxSettingsDeprecated, params?: any, data?: any, preventAutoFail?: boolean): any {\r\n    return this.request(settingsOrUrl, params, data, preventAutoFail, 'PUT');\r\n  }\r\n\r\n  /**\r\n   * **Deprecated** - docs in the separate interface\r\n   * @deprecated use fetchJson instead\r\n   */\r\n  request(settings: string | ZzzAjaxSettingsDeprecated, params: any, data: any, preventAutoFail: boolean, method: string): any {\r\n\r\n    // url parameter: auto convert a single value (instead of object of values) to an id=... parameter\r\n    // tslint:disable-next-line:curly\r\n    if (typeof params !== 'object' && typeof params !== 'undefined')\r\n      params = { id: params };\r\n\r\n    // if the first parameter is a string, resolve settings\r\n    if (typeof settings === 'string') {\r\n      const controllerAction = settings.split('/');\r\n      const controllerName = controllerAction[0];\r\n      const actionName = controllerAction[1];\r\n\r\n      if (controllerName === '' || actionName === '')\r\n        console.warn('Error: controller or action not defined. Will continue with likely errors.');\r\n\r\n      settings = {\r\n        controller: controllerName,\r\n        action: actionName,\r\n        params,\r\n        data,\r\n        url: controllerAction.length > 2 ? settings : null,\r\n        preventAutoFail,\r\n      } as any;\r\n    }\r\n\r\n    const defaults = {\r\n      method: method === null ? 'POST' : method,\r\n      params: null as any,\r\n      preventAutoFail: false,\r\n    };\r\n    // new 10.25\r\n    var http = new AjaxPromise(this, this.sxc);\r\n\r\n    settings = Object.assign({}, defaults, settings);\r\n\r\n    const promise = http.makePromise(settings as ZzzAjaxSettingsDeprecated);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Will retrieve data from the backend using a standard fetch. \r\n   * @param url a full url or short-hand like `controller/method?params` `app/auto/api/controller/method?params`. Note that params would also be specified on the url. \r\n   * @param data optional POST data\r\n   * @param method optional method or fetch options, defaults to `GET` unless it has data, in which case it defaults to `POST`\r\n   * @returns a Promise containing a Response object, just like a normal fetch would. \r\n   * example: webApi.fetchRaw('Rss/Feed');\r\n   * example: webApi.fetchRaw(webApi.url('Rss/Feed', { id: 47 })); // url params\r\n   * example: webApi.fetchRaw('Rss/Feed', { id: 47 }); // post params\r\n   * example: webApi.fetchRaw(webApi.url('Rss/Feed', { id: 47 }), { something: 'this is a test' }); // url & post params\r\n   * maybe: webApi.fetchRaw({url: 'Rss/Feed', params: { id: 47 }})\r\n   * maybe: webApi.fetchRaw({url: ..., params: { ...}, body: { ...}, method: 'GET' })\r\n   */\r\n  async fetchRaw(url: string, data?: string | Record<string, unknown>, method?: string | FetchOptions): Promise<Response> {\r\n    const ctxParams = {} as { appId?: number; zoneId?: number; };\r\n    const ctx = this.sxc.ctx;\r\n\r\n    // Auto-Add appid / zoneid if needed\r\n    // Note: #_autoAppIdsInUrl is only used in edit-ui formulas\r\n    const urlLower = url.toLocaleLowerCase();\r\n    if (ctx?._autoAppIdsInUrl && urlLower.includes('app/auto/')) {\r\n      if (ctx.appId && !urlLower.includes('appid=')) ctxParams.appId = ctx.appId;\r\n      if (ctx.zoneId && !urlLower.includes('zoneid=')) ctxParams.zoneId = ctx.zoneId;\r\n    }\r\n    url = this.url(url, ctxParams);\r\n\r\n    // Handle method and options\r\n    const fetchOptions = this.prepareOptions(method, data);\r\n\r\n    const headers = this.headers(fetchOptions.method);\r\n\r\n    // Handle encryption if needed\r\n    if (fetchOptions.method == 'POST')\r\n      data = await new SecureEndpoint(this.sxc, fetchOptions).encryptData(data);\r\n\r\n    if (data) {\r\n      // test if data is a json. If it's not, convert it to json\r\n      try {\r\n        JSON.parse(data as string);\r\n      } catch {\r\n        data = JSON.stringify(data);\r\n      }\r\n    }\r\n\r\n    return fetch(url, {\r\n      headers,\r\n      method: fetchOptions.method,\r\n      ...(data && { body: data as string }),\r\n    });\r\n  }\r\n\r\n  // prepare options\r\n  private prepareOptions(methodOrOptions: string | FetchOptions, data: string | Record<string, any>): FetchOptions {\r\n    const defaults: FetchOptions = {\r\n      method: (data ? 'POST' : 'GET'),\r\n      encrypt: 'auto',\r\n      encryptBody: 'auto', \r\n    };\r\n    if (typeof methodOrOptions === 'string')\r\n      return { ...defaults, method: methodOrOptions };\r\n    \r\n    if (typeof methodOrOptions === 'object')\r\n      return {\r\n        ...methodOrOptions,\r\n        method: methodOrOptions.method || defaults.method,\r\n        encrypt: methodOrOptions.encrypt ?? defaults.encrypt,\r\n        encryptBody: methodOrOptions.encryptBody ?? methodOrOptions.encrypt ?? defaults.encryptBody,\r\n      };\r\n    return defaults;\r\n  }\r\n\r\n  // Note: fetch was documented in v12.10 (December 2021) but will probably never be used externally\r\n  // So we rename it to fetchRaw and later will make fetch just be the json implementation.\r\n  // Renamed and added this warning in 13.04 (2022-03-14), will drop in v14 and probably make it do fetchJson by default\r\n  // Changed functionality in 13.10 (2022-05-04) to make it do fetchJson by default\r\n  // Changed functionality back in 13.11 (2022-05-10) because it seems that Mobius was published using fetch\r\n  // Important: Do not document in the docs, as it shouldn't be used\r\n  /** @internal */\r\n  async fetch(url: string, data?: string | Record<string, any>, method?: string | FetchOptions): Promise<Response> {\r\n    console.warn(`You are calling 'fetch' on the sxc.webApi. This is deprecated will stop in 2sxc v15, please use fetchRaw(...) or fetchJson(...) instead.`)\r\n    return this.fetchJson(url, data, method);\r\n  }\r\n\r\n  /**\r\n   * Will retrieve data from the backend using a standard fetch and give you an object. \r\n   * @param url a full url or short-hand like `controller/method?params` `app/auto/api/controller/method?params`. Note that params would also be specified on the url. \r\n   * @param data optional POST data\r\n   * @param method optional method or fetch options,, defaults to `GET` unless it has data, in which case it defaults to `POST`\r\n   * @returns a Promise containing any object.\r\n   */\r\n  async fetchJson<T = any>(url: string, data?: string | Record<string, any>, method?: string | FetchOptions): Promise<T> {\r\n    return this.fetchRaw(url, data, method).then(response => response.json());\r\n  }\r\n\r\n  /**\r\n   * All the headers which are needed in an ajax call for this to work reliably.\r\n   * Use this if you need to get a list of headers in another system\r\n   */\r\n  headers(method?: string): Record<string, string> {\r\n    const headers = this.sxc.http.headers(this.sxc.id, this.sxc.cbid, this.sxc.ctx);\r\n    if (!method) {\r\n      return headers;\r\n    }\r\n\r\n    switch (method.toLocaleUpperCase()) {\r\n      case 'GET':\r\n        headers['Accept'] = 'application/json';\r\n        break;\r\n      default:\r\n        headers['Accept'] = 'application/json';\r\n        headers['Content-Type'] = 'application/json';\r\n    }\r\n    return headers;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param url A short, medium or long url. \r\n   * Short like `controller/method`, \r\n   * medium like `app/auto/api/controller/method`\r\n   * long like `https://xyz.\r\n   * In all cases it can also have ?params etc.\r\n   * @param params Optional parameters as string or object, will be added to url-params. \r\n   * @returns In the cases of a short/medium url, \r\n   * it will auto-expand to have the full url as needed for an API call. \r\n   */\r\n  url(url: string, params?: string | Record<string, any>): string {\r\n    if (url == null) return url;\r\n\r\n    const urlAndParams = url.split('#')[0].split('?');\r\n\r\n    // url fixes\r\n    url = urlAndParams[0];\r\n    const urlParts = url.split('/');\r\n    if (urlParts.length === 2 && urlParts[0] && urlParts[1]) {\r\n      const controller = urlParts[0];\r\n      const action = urlParts[1];\r\n      url = `app/auto/api/${controller}/${action}`;\r\n    }\r\n    url = this.sxc.http.apiUrl(url);\r\n\r\n    // params fixes\r\n    params = `${urlAndParams[1] || ''}&${params ? typeof params === 'string' ? params : NoJQ.param(params) : ''}`\r\n      .split('&')\r\n      .filter(p => !!p)\r\n      .join('&');\r\n\r\n    // result\r\n    url = [url, params].filter(p => !!p).join('?');\r\n    return url;\r\n  }\r\n}\r\n","/**\r\n * Metadata Target Types\r\n * \r\n * These are constants to determine what something is assigned to (e.g. it describes an Entity, a file, etc.)\r\n * \r\n * Use it for the @see MetadataFor objects\r\n * @public\r\n */\r\nexport enum MetadataTargetTypes {\r\n  /** \r\n   * Undefined Type (0) - included for completeness.\r\n   * Not usually used, actually None (1) is the default\r\n   */\r\n  Undefined = 0,\r\n\r\n  /** \r\n   * Things that are not used as Metadata (1). This is the default for most Entities.\r\n   */\r\n  None = 1,\r\n\r\n  /** \r\n   * Metadata of attributes / fields (2). This is used to store configuration like the field label, amount-of-rows, etc.\r\n   * Remarks = \r\n   * The key is always a number (int) pointing to the Attribute ID in the DB.\r\n   */\r\n  Attribute = 2,\r\n\r\n  /** \r\n   * App metadata (3). Used to give Apps additional properties. \r\n   * Remarks = \r\n   * The key should always be an int ID of the App.\r\n   */\r\n  App = 3,\r\n\r\n  /** \r\n   * Metadata of entities / data-items (4). \r\n   * This lets us enhance entities with additional information. \r\n   * Remarks = \r\n   * The Key should always be a GUID\r\n   */\r\n  Entity = 4,\r\n\r\n  /** \r\n   * Metadata of a content-type / data-schema (5). Used to give it a description etc. \r\n  */\r\n  ContentType = 5,\r\n\r\n  /** \r\n   * Zone metadata (6) - used to give a Zone additional information. \r\n   * Only used in very special cases, best not use.\r\n   */\r\n  Zone = 6,\r\n\r\n  /** \r\n   * Item / Object of the Platform, like a File or Folder etc. (10)\r\n   * Remarks = \r\n   * * The key is usually a string to further specify what it's describing, like \"file:72\"\r\n   * * The text equivalent is CmsObject\r\n   */\r\n  CmsItem = 10,\r\n\r\n  /** \r\n   * The entire system / platform - so Metadata for the current Dnn/Oqtane installation (11).\r\n   * Remarks = \r\n   * This is not in use as of now, just added for completeness sakes.\r\n   * New in v13\r\n   */\r\n  System = 11,\r\n\r\n  /** \r\n   * A Site - like the current site (12)\r\n   * Remarks = New in v13</remarks>\r\n   */\r\n  Site = 12,\r\n\r\n  /** \r\n   * A Site - like the current site (13)\r\n   * Remarks = New in v13 / beta</remarks>\r\n   */\r\n  // [PrivateApi]\r\n  SiteVariant = 13,\r\n\r\n  /** \r\n   * A Page - like the current page (14)\r\n   * Remarks = New in v13</remarks>\r\n   */\r\n  Page = 14,\r\n\r\n  /** \r\n   * A Page - like the current page (15) \r\n   * Remarks = New in v13 / beta</remarks>\r\n   */\r\n  // [PrivateApi]\r\n  PageVariant = 15,\r\n\r\n  /** \r\n   * A Module - like a module containing some content (16) \r\n   * Remarks = New in v13</remarks>\r\n   */\r\n  Module = 16,\r\n\r\n  /** \r\n   * A Module - like a module containing some content (17)\r\n   * Remarks = New in v13 / beta</remarks>\r\n   */\r\n  // [PrivateApi]\r\n  ModuleVariant = 17,\r\n\r\n  /** \r\n   * A User - like the admin-user (18)\r\n   * Remarks = New in v13</remarks>\r\n   */\r\n  User = 18,\r\n\r\n  /** Custom target (90). This is what you should use for basic apps which have a custom target that's none of the other defaults. */\r\n  Custom = 90,\r\n\r\n  /** Custom target (91). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom1 = 91,\r\n  /** Custom target (92). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom2 = 92,\r\n  /** Custom target (93). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom3 = 93,\r\n  /** Custom target (94). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom4 = 94,\r\n  /** Custom target (95). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom5 = 95,\r\n  /** Custom target (96). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom6 = 96,\r\n  /** Custom target (97). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom7 = 97,\r\n  /** Custom target (98). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom8 = 98,\r\n  /** Custom target (99). Use this for basic apps which need multiple different custom targets (advanced, rare use case) */\r\n  Custom9 = 99,\r\n}\r\n","import { Sxc } from './sxc';\r\n\r\n/**\r\n * Base class for anything attached to an sxc-instance.\r\n * This is internal and not important, but we can't keep it out of the docs. \r\n * @public\r\n */\r\nexport abstract class SxcPart {\r\n  /**\r\n  * Creates an instance of SxcData.\r\n  * @param sxc: sxc\r\n  * @param partName: name of the part\r\n  * @internal\r\n  */\r\n  constructor(\r\n    /** @internal */\r\n    public sxc: Sxc, \r\n    /** @internal */\r\n    public partName: string) {      \r\n  }\r\n\r\n}\r\n  ","import { Sxc } from '../sxc';\r\nimport { SxcPart } from '../sxc-part';\r\nimport { SxcWebApi } from '../web-api/sxc-web-api';\r\n\r\n/**\r\n * Base class doing common checks.\r\n * This is internal and not important, but we can't keep it out of the docs. \r\n * @public\r\n */\r\nexport abstract class SxcDataServiceBase extends SxcPart {\r\n  protected readonly webApi: SxcWebApi;\r\n  /**\r\n  * Creates an instance of SxcData.\r\n  * @param sxc: \r\n  * @param name: the content-type name\r\n  * @internal\r\n  */\r\n  constructor(\r\n    sxc: Sxc,\r\n    readonly name: string,\r\n    nameInError: string\r\n  ) {\r\n    super(sxc, 'data');\r\n    this.webApi = sxc.webApi;\r\n    \r\n    // Fail early if something is wrong\r\n    nameInError += ' name ';\r\n    if (name == null) throw nameInError + 'is empty';\r\n    if (name.indexOf(\"/\") != -1 || name.indexOf(\"\\\\\") != -1) throw nameInError + 'has slashes - not allowed';\r\n    if (name.indexOf(\"?\") != -1) throw nameInError + 'has \"?\" - not allowed';\r\n  }\r\n\r\n}\r\n  ","import { MetadataFor } from '../../data/metadata-for';\r\nimport { MetadataTargetTypes } from '../../data/target-types';\r\nimport { Sxc } from '../sxc';\r\nimport { SxcDataServiceBase } from './sxc-data-service-base';\r\n\r\nconst ContentApiRoot = 'app/auto/data';\r\n\r\n/**\r\n* Data Service for an App / Sxc-Instance to get/create data of a specific Content-Type\r\n* @public\r\n*/\r\nexport class SxcData<T = unknown> extends SxcDataServiceBase {\r\n  /**\r\n  * Creates an instance of SxcData.\r\n  * @param sxc:\r\n  * @param name: the content-type name\r\n  * @internal\r\n  */\r\n  constructor(sxc: Sxc, readonly name: string) {\r\n    super(sxc, name, 'ContentType');\r\n  }\r\n\r\n  /**\r\n   * Get all items of this type.\r\n   */\r\n  getAll(): Promise<T[]> {\r\n    return this.getInternal<T[]>();\r\n  }\r\n\r\n  /**\r\n   * Get the specific item with the ID. It will return null if not found\r\n   */\r\n  getOne(id: number): Promise<T> | null {\r\n    return this.getInternal<T>(id);\r\n  };\r\n\r\n  /** Future\r\n   *  @internal \r\n   */\r\n  private getMany(criteria: Record<string, unknown>, fields: Array<string>): Promise<T[]> {\r\n    throw 'not implemented - probably v13.5 or something';\r\n  }\r\n\r\n\r\n  /**\r\n   * Get all or one data entity from the backend\r\n   * @param id optional id as number or string - if not provided, will get all\r\n   * @param params optional parameters - ATM not usefuly but we plan to support more filters etc. \r\n   * @returns an array with 1 or n entities in the simple JSON format\r\n   * @internal\r\n   */\r\n  private getInternal<TCall>(id?: string | number, params?: string | Record<string, unknown>): Promise<TCall> {\r\n    let path = `${ContentApiRoot}/${this.name}`;\r\n    if (id && (typeof id === 'string' || typeof id === 'number')) path += \"/\" + id;\r\n    return this.webApi.fetchJson(this.webApi.url(path, params));\r\n  }\r\n\r\n  /**\r\n   * Create a new entity with the values supplied\r\n   * @param values a simple object containing the values to create\r\n   */\r\n  create(values: Record<string, unknown>): Promise<Record<string, unknown>>;\r\n\r\n  /**\r\n   * Create a new entity with the values supplied and also a metadata-for reference\r\n   * @param values a simple object containing the values to create\r\n   */\r\n  create(values: Record<string, unknown>, metadataFor: MetadataFor | string): Promise<Record<string, unknown>>;\r\n\r\n  /** @internal */\r\n  create(values: Record<string, unknown>, metadataFor?: MetadataFor | string): Promise<Record<string, unknown>> {\r\n    const path = `${ContentApiRoot}/${this.name}`;\r\n    if (metadataFor != null) {\r\n      if (typeof(metadataFor) === 'string')\r\n        metadataFor = { Target: MetadataTargetTypes.Entity, Guid: metadataFor } as MetadataFor;\r\n      try {\r\n        values.For = metadataFor;\r\n      } catch { }\r\n    }\r\n    return this.webApi.fetchJson(this.webApi.url(path), values, 'POST');\r\n  }\r\n\r\n  /**\r\n   * Update an existing entity with the values supplied\r\n   */\r\n  update(id: number, values: Record<string, unknown>): Promise<Record<string, unknown>> {\r\n    const path = `${ContentApiRoot}/${this.name}/${id}`;\r\n    return this.webApi.fetchJson(this.webApi.url(path), values, 'POST');\r\n  }\r\n\r\n  /**\r\n   * Delete an entity\r\n   * @param id id of the item to delete\r\n   */\r\n  delete(id: number): Promise<null>;\r\n\r\n  /**\r\n   * Delete an entity\r\n   * @param guid GUID of the item to delete\r\n   */\r\n  delete(guid: string): Promise<null>;\r\n\r\n  /** @internal */\r\n  delete(idOrGuid: number | string): Promise<null> {\r\n    const path = `${ContentApiRoot}/${this.name}/${idOrGuid}`;\r\n    return this.webApi.fetchRaw(this.webApi.url(path), undefined, 'DELETE').then(response => null);\r\n  }\r\n}\r\n\r\n","import { Sxc } from '../sxc';\r\nimport { SxcDataServiceBase } from './sxc-data-service-base';\r\n\r\n/**\r\n * Instance Query Service\r\n * @public\r\n */\r\nexport class SxcQuery extends SxcDataServiceBase {\r\n\r\n  /**\r\n   * Creates an instance of SxcQuery.\r\n   * @internal\r\n   */\r\n  constructor(sxc: Sxc, readonly name: string) {\r\n    super(sxc, name, 'Query');\r\n  }\r\n\r\n  getAll<T = unknown>(): Promise<T>;\r\n  getAll<T = unknown>(urlParams: string | Record<string, unknown>): Promise<T>;\r\n  getAll<T = unknown>(urlParams: string | Record<string, unknown>, data: string | Record<string, unknown>): Promise<T>;\r\n  /**\r\n   * Retrieve the entire query with all streams\r\n   *\r\n   * @template T\r\n   * @returns {Promise<T>} containing a object with stream-names and items in the streams.\r\n   */\r\n  getAll<T = unknown>(urlParams?: string | Record<string, unknown>, data?: string | Record<string, unknown>): Promise<T> {\r\n    return this.getInternal<T>(undefined, urlParams, data);\r\n  }\r\n\r\n  /**\r\n   * Get just one stream, returning an array of items in that stream\r\n   *\r\n   * @template T\r\n   * @param stream\r\n   * @returns {Promise<T[]>} containing an array of items - or empty if stream not found or nothing returned\r\n   */\r\n  getStream<T = unknown>(stream: string): Promise<T[]>;\r\n  getStream<T = unknown>(stream: string, urlParams: string | Record<string, unknown>): Promise<T[]>;\r\n  getStream<T = unknown>(stream: string, urlParams: string | Record<string, unknown>, data: string | Record<string, unknown>): Promise<T[]>;\r\n  \r\n  getStream<T = unknown>(stream: string, urlParams?: string | Record<string, unknown>, data?: string | Record<string, unknown>): Promise<T[]> {\r\n    if (stream.indexOf(',') !== -1) throw \"parameter 'stream' can only contain one stream name for 'getStream'\";\r\n    return this.getInternal<unknown>(stream, urlParams, data).then((data) => {\r\n      if (data == null || !data.hasOwnProperty(stream)) return [];\r\n      return (data as any)[stream] as T[];\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get a query but only the mentioned streams.\r\n   * This will reduce the amount of data retrieved on queries that have many streams. \r\n   * @template T The schema/interfaces of what will be returned\r\n   * @returns {Promise<T>} Promise containing a object with stream-names and items in the streams.\r\n   * @public\r\n   */\r\n  getStreams<T = unknown>(streams: string): Promise<T>;\r\n  /**\r\n   * Get a query but only the mentioned streams.\r\n   * This will reduce the amount of data retrieved on queries that have many streams. \r\n   * @template T The schema/interfaces of what will be returned\r\n   * @param streams name of streams to get, comma separated\r\n   * @param urlParams additional parameters for the URL, either as a string or as a object\r\n   * @returns {Promise<T>} Promise containing a object with stream-names and items in the streams.\r\n   * @public\r\n   */\r\n  getStreams<T = unknown>(streams: string, urlParams: string | Record<string, unknown>): Promise<T>;\r\n  /**\r\n   * Get a query but only the mentioned streams.\r\n   * This will reduce the amount of data retrieved on queries that have many streams. \r\n   * @template T The schema/interfaces of what will be returned\r\n   * @param streams name of streams to get, comma separated\r\n   * @param urlParams additional parameters for the URL, either as a string or as a object\r\n   * @param data data to include in case of a POST call - if this is provided, it will use a post\r\n   * @returns {Promise<T>} Promise containing a object with stream-names and items in the streams.\r\n   * @public\r\n   */\r\n  getStreams<T = unknown>(streams: string, urlParams: string | Record<string, unknown>, data: string | Record<string, unknown>): Promise<T>;\r\n  /**\r\n   * Get a query but only the mentioned streams.\r\n   * This will reduce the amount of data retrieved on queries that have many streams. \r\n   *\r\n   * @template T The schema/interfaces of what will be returned\r\n   * @param streams name of streams to get, comma separated\r\n   * @param urlParams additional parameters for the URL, either as a string or as a object\r\n   * @param data data to include in case of a POST call - if this is provided, it will use a post\r\n   * @returns {Promise<T>} Promise containing a object with stream-names and items in the streams.\r\n   */\r\n  getStreams<T = unknown>(streams: string, urlParams?: string | Record<string, unknown>, data?: string | Record<string, unknown>): Promise<T> {\r\n    return this.getInternal<T>(streams, urlParams, data);\r\n  }\r\n\r\n  /**\r\n   * Get all or one data entity from the backend\r\n   * @param id optional id as number or string - if not provided, will get all\r\n   * @param params optional parameters - ATM not usefuly but we plan to support more filters etc. \r\n   * @returns an array with 1 or n entities in the simple JSON format\r\n   * @internal\r\n   */\r\n  private getInternal<T = unknown>(streams?: string, params?: string | Record<string, any>, data?: string | Record<string, unknown>): Promise<T> {\r\n    let path = \"app/auto/query/\" + this.name;\r\n    if (streams && (typeof streams === 'string')) path += \"?stream=\" + streams;\r\n    return this.webApi.fetchJson(this.webApi.url(path, params), data);\r\n  }\r\n}\r\n","import { SxcPart } from './sxc-part';\r\nimport { RunParams } from '../cms/run-params';\r\nimport { Sxc } from './sxc';\r\n\r\n/**\r\n * This is in charge of sxc.cms on the instance level.\r\n * ATM it just has the run command.\r\n * In future, it may also have dedicated command like `layout` etc.\r\n * @public\r\n */\r\nexport class SxcCms extends SxcPart {\r\n\r\n  /** @internal */\r\n  constructor(sxc: Sxc) {\r\n    super(sxc, \"cms\");\r\n  }\r\n\r\n  /**\r\n   * Run a command on this sxc-instance. \r\n   * Requires edit mode to be on, which would enable the edit-JS parts.\r\n   * To use, remember to activate `2sxc.JsCms` on the page\r\n   * @param runParams - real type is actually RunParams\r\n   */\r\n  run<T>(runParams: RunParams): Promise<void | T> { \r\n    throw 'cms.run() requires editing to be on, or page-feature \"2sxc.JsCms\" to be enabled to work';\r\n  }\r\n}","import { ApiExtensionPlaceholder } from '../constants';\r\nimport { AppApiMarker, HasLog, HeaderNames, ToSxcName } from '../../../core';\r\nimport { SxcGlobalEnvironment } from '../environment/sxc-global-environment';\r\nimport { ContextIdentifier } from './context-identifier';\r\n\r\n/**\r\n * Global HTTP Service for information and helpers on `$2sxc.http`\r\n * @public\r\n */\r\nexport class SxcGlobalHttp extends HasLog {\r\n    /** @internal */\r\n    constructor(private env: SxcGlobalEnvironment) {\r\n        super('Sxc.Http');\r\n    }\r\n\r\n    /**\r\n     * All the headers which are needed in an ajax call.\r\n     * @returns Dictionary / Record of headers\r\n     */\r\n    headers(): Record<string, string>;\r\n\r\n    /**\r\n     * All the headers which are needed in an ajax call - within a module context.\r\n     * @param id _optional_ module ID\r\n     * @returns Dictionary / Record of headers\r\n     */\r\n    headers(id: number): Record<string, string>;\r\n\r\n    /**\r\n     * All the headers which are needed in an ajax call - within a module and content-block context.\r\n     * @param id _optional_ module ID\r\n     * @param cbid _optional_ content block ID\r\n     * @returns Dictionary / Record of headers\r\n     */\r\n    headers(id: number, cbid: number): Record<string, string>;\r\n\r\n    /**\r\n     * All the headers which are needed in an ajax call.\r\n     * Uses a module and content-block context (but these could also be null) \r\n     * and a full context identifier for advanced operations.\r\n     * @param id _optional_ module ID\r\n     * @param cbid _optional_ content block ID\r\n     * @param ctx _optional_ context information to include in the header\r\n     * @returns Dictionary / Record of headers\r\n     */\r\n    headers(id: number, cbid: number, ctx: ContextIdentifier): Record<string, string>;\r\n\r\n    /**\r\n     * All the headers which are needed in an ajax call.\r\n     * Uses a module and content-block context (but these could also be null) \r\n     * and a full context identifier for advanced operations.\r\n     * @param id _optional_ module ID\r\n     * @param cbid _optional_ content block ID\r\n     * @param ctx _optional_ context information to include in the header\r\n     * @returns Dictionary / Record of headers\r\n     */\r\n    headers(id?: number, cbid?: number, ctx?: ContextIdentifier): Record<string, string> {\r\n        const cl = this.log.call('headers', `${id}, ${cbid}`);\r\n        const fHeaders: Record<string, string> = {};\r\n        const pageId = (ctx?.pageId ?? this.env.page()).toString();\r\n        id = ctx?.moduleId ?? id;\r\n        cbid = ctx?.blockId ?? cbid;\r\n\r\n        // TODO: THE #_ignoreHeaders is only used in edit-ui, and should be changed to somehow say use-in-URL\r\n        if (!ctx?._noContextInHttpHeaders) {\r\n            if (id) fHeaders[HeaderNames.ModuleId] = id.toString();\r\n            if (cbid) fHeaders[HeaderNames.ContentBlockId] = cbid.toString();\r\n            fHeaders[HeaderNames.TabId] = pageId;\r\n            fHeaders[HeaderNames.PageId] = pageId;\r\n        }\r\n        fHeaders[this.env.rvtHeader()] = this.env.rvt();\r\n        return cl.return(fHeaders, `headers(id:${id}, cbid:${cbid})`);\r\n    }\r\n\r\n    /**\r\n     * Get the API-Root path for a specific extension/endpoint\r\n     * @returns\r\n     * @internal Not relevant for 2sxc, only used if calling platform endpoints\r\n     */\r\n    apiRoot(endpointName: string): string {\r\n        const cl = this.log.call('apiRoot');\r\n        var result = this.env.api().replace(ApiExtensionPlaceholder, endpointName);\r\n        return cl.return(result, `apiRoot('${endpointName}')`);\r\n    }\r\n\r\n    /**\r\n     * Get the API-Root path for Apps\r\n     * new in v12\r\n     * @internal\r\n     */\r\n     appApiRoot(): string {\r\n        const cl = this.log.call('appApiRoot');\r\n        // try to get it, or fall back to the previous / old convention\r\n        var result = this.env.appApi() ?? this.apiRoot(ToSxcName);\r\n        return cl.return(result, `appApiRoot()`);\r\n    }\r\n\r\n    /**\r\n     * Convert short urls like `app/auto/api/Posts/All` to the full URL needed.\r\n     * Will ignore urls which clearly already are the full url.\r\n     * @param url short URL like `app/auto/api/Posts/All`\r\n     * @returns the converted, long url with the full endpoint\r\n     */\r\n    apiUrl(url: string): string;\r\n\r\n    /**\r\n     * Convert short urls like `app/auto/api/Posts/All` to the full URL needed.\r\n     * Will ignore urls which clearly already are the full url.\r\n     * @param url short URL like `app/auto/api/Posts/All`\r\n     * @param endpointName _optional_ endpoint name if accessing a different exotic endpoint\r\n     * @returns the converted, long url with the full endpoint\r\n     */\r\n    apiUrl(url: string, endpointName: string): string;\r\n\r\n    /**\r\n     * Convert short urls like `app/auto/api/Posts/All` to the full URL needed.\r\n     * Will ignore urls which clearly already are the full url.\r\n     * @param url short URL like `app/auto/api/Posts/All`\r\n     * @param endpointName _optional_ endpoint name if accessing a different exotic endpoint\r\n     * @returns the converted, long url with the full endpoint\r\n     */\r\n    apiUrl(url: string, endpointName?: string): string\r\n    {\r\n        const cl = this.log.call('apiUrl');\r\n        this.log.add(`apiUrl(url:'${url}', endpointName:'${endpointName}')`);\r\n\r\n        // null/undefined check\r\n        if(url == null) return url;\r\n\r\n        // if starts with http: or https: then ignore\r\n        if(!url || url.indexOf('http:') == 0 || url.indexOf('https:') == 0 || url.indexOf('//') == 0)\r\n            return cl.return(url);\r\n\r\n        // if no endpoint specified, then also skip absolute and relative urls\r\n        if(!endpointName && (url.indexOf('/') == 0 || url.indexOf('.') == 0))\r\n            return cl.return(url);\r\n\r\n        var baseUrl = url.toLocaleLowerCase().startsWith(AppApiMarker)\r\n            ? this.appApiRoot()\r\n            : this.apiRoot(endpointName || ToSxcName);\r\n\r\n\r\n        // ensure base ends with slash\r\n        if(baseUrl[baseUrl.length-1] != '/') baseUrl += '/';\r\n        // ensure url doesn't start with slash\r\n        if(url[0] == '/') url = url.slice(1);\r\n        return cl.return(baseUrl + url);\r\n    }\r\n}\r\n","import { Sxc } from '..';\r\nimport { C } from '../../../core/constants';\r\nimport { InstanceContext } from './instance-context';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class DomTools {\r\n  /**\r\n   * get edit-context info of html element or sxc-object\r\n   */\r\n  static getContext(sxc: Sxc, htmlElement?: HTMLElement): InstanceContext {\r\n    const editContextTag: HTMLElement = (htmlElement)\r\n      ? DomTools.getContainerTag(htmlElement)\r\n      : DomTools.getTag(sxc);\r\n    return DomTools.getContextOfTag(editContextTag);\r\n  }\r\n\r\n\r\n  /**\r\n   * get the edit-context object (a json object) of the current tag/sxc-instance\r\n   * @returns edit-context object\r\n   */\r\n  static getContextOfTag(htmlTag: HTMLElement | undefined): InstanceContext {\r\n      const attr = htmlTag?.getAttribute(C.Attributes.Context);\r\n      return JSON.parse(attr || '{ }') as InstanceContext;\r\n  }\r\n\r\n  \r\n  /**\r\n   * get nearest html tag of the sxc instance with data-edit-context\r\n   */\r\n  static getContainerTag(htmlTag: HTMLElement): HTMLElement {\r\n    return htmlTag.closest<HTMLElement>(C.Sel.SxcDivs);\r\n  }\r\n\r\n\r\n  /**\r\n   * get a html tag of the sxc instance\r\n   * @returns resulting html\r\n   */\r\n  static getTag(sxci: Sxc): HTMLElement {\r\n    return document.querySelector<HTMLElement>(`div[${C.Attributes.ContentBlockId}='${sxci.cbid}']`);\r\n  }\r\n\r\n}","import { SxcGlobalEnvironment } from './../environment/sxc-global-environment';\r\nimport { ContextIdentifier } from '../sxc-global/context-identifier';\r\nimport { SxcWebApi } from './web-api/sxc-web-api';\r\nimport { ApiUrlRoots, HasLog, ToSxcName } from '../../../core';\r\nimport { SxcManage } from './sxc-manage';\r\nimport { SxcData } from './data/sxc-data';\r\nimport { SxcQuery } from './data/sxc-query';\r\nimport { SxcCms } from './sxc-cms';\r\nimport { SxcGlobal } from '../sxc-global/sxc-global';\r\nimport { SxcGlobalHttp } from '../sxc-global/sxc-global-http';\r\nimport { EnvironmentSpecs } from '../environment/environment-specs';\r\nimport { InstanceContext } from '../dom/instance-context';\r\nimport { DomTools } from '../dom/dom-tools';\r\n\r\n/**\r\n* The typical sxc-instance object for a specific DNN module or content-block\r\n* @public\r\n*/\r\nexport class Sxc extends HasLog {\r\n  /** @internal */\r\n  private _isSxcInstance = true;\r\n\r\n\r\n  /**\r\n   * Web API calls for this instance.\r\n   * This is the pure call APIs system. \r\n   * To get data or queries, best use the data or query services.\r\n   */\r\n  webApi: SxcWebApi;\r\n\r\n  /**\r\n   * manage object which provides access to additional content-management features\r\n   * it only exists if 2sxc is in edit mode (otherwise the JS are not included for these features)\r\n   * @internal\r\n   */\r\n  manage: SxcManage = null; // initialize correctly later on\r\n\r\n  /**\r\n   * CMS operations on this sxc-instance, such as opening the edit dialog etc.\r\n   */\r\n  cms: SxcCms = new SxcCms(this);\r\n  \r\n  /** @internal */\r\n  constructor(\r\n    /** the sxc-instance ID, which is usually the DNN Module Id */\r\n    public id: number,\r\n    /**\r\n     * content-block ID, which is either the module ID, or the content-block definition entity ID\r\n     * this is an advanced concept you usually don't care about, otherwise you should research it\r\n     */\r\n    public cbid: number,\r\n    /** \r\n     * the id/key of this instance in the cache for reset\r\n     * @internal\r\n     */\r\n    public cacheKey: string,\r\n    /** \r\n     * The environment information, important for http-calls \r\n     * @internal\r\n     */\r\n    public readonly root: SxcGlobal,\r\n    /** \r\n     * Custom context information provided by the constructor - will replace auto-context detection\r\n     * @internal\r\n     */\r\n    public ctx?: ContextIdentifier,\r\n  ) {\r\n    super('SxcInstance', null, 'Generating for ' + id + ':' + cbid);\r\n    \r\n    // add manage property, but not within initializer, because inside the manage-initializer it may reference 2sxc again\r\n    try { // sometimes the manage can't be built, like before installing\r\n      if (root._manage) root._manage.initInstance(this);\r\n    } catch (e) {\r\n      console.error('error in 2sxc - will only log but not throw', e);\r\n    }\r\n\r\n    // New 16.01 - get env from the current tag instead of the entire page - if possible\r\n    const envAndHttp = this.loadEnv(root);\r\n    this.env = envAndHttp.env;\r\n    this.http = envAndHttp.http;\r\n    this.webApi = new SxcWebApi(this);\r\n\r\n    // ensure that data-APIs used incorrectly shows good warnings\r\n    patchDataWithWarnings(this.data);\r\n    \r\n    // this only works when manage exists (not installing) and translator exists too\r\n    // ensure that we really have a manage context, otherwise we can't initialize i18n and it doesn't make sense\r\n    if (root._translateInit && this.manage?.context?.app?.currentLanguage)\r\n      root._translateInit(this.manage);    // init translate, not really nice, but ok for now\r\n  }\r\n\r\n  /**\r\n   * New v16.01 - WIP\r\n   * We have the problem that sometimes the environment is not available on the page or is wrong. \r\n   * * On a page where a 2sxc-module was just added\r\n   * * On a module which is in the skin, so technically from a different page\r\n   * \r\n   * Based on this we are trying to include all relevant information from the root-env, but override it with the local env\r\n   * @param root \r\n   * @returns \r\n   */\r\n  private loadEnv(root: SxcGlobal): { env: SxcGlobalEnvironment, http: SxcGlobalHttp } {\r\n    // get the JsApi from the JSON attribute using the inpage `manage` object\r\n    // will only exist if JsCms is active!\r\n    let localEnv = ((this.manage as any)?.editContext as InstanceContext)?.jsApi\r\n      // Try the JsApi from the JSON attribute directly\r\n      ?? DomTools.getContext(this)?.jsApi;\r\n\r\n    if (!localEnv) return { env: root.env, http: root.http };\r\n    const rootEnv = (root.env as any).headers as EnvironmentSpecs;\r\n    const final = localEnv ? { ...rootEnv, ...localEnv } : rootEnv;\r\n    const env = new SxcGlobalEnvironment();\r\n    env.load(final, 'sxc-instance');\r\n    return { env, http: new SxcGlobalHttp(env) };\r\n  }\r\n\r\n  /**\r\n   * Env helper for API calls and such\r\n   * @internal\r\n   */\r\n  public env: SxcGlobalEnvironment;\r\n  /**\r\n   * Http helper for API calls and such\r\n   * @internal\r\n   */\r\n  public http: SxcGlobalHttp;\r\n\r\n  /**\r\n   * TypeGuard for TypeScript to verify this is a SxcInstance\r\n   * @param thing \r\n   * @internal\r\n   */\r\n  public static is(thing: unknown): thing is Sxc {\r\n    return (thing as Sxc)._isSxcInstance;\r\n  }\r\n\r\n  /**\r\n   * Get a data service for a specific content-type.\r\n   *\r\n   * @param contentType: name of the content type which this service will get\r\n   */\r\n  data<T = unknown>(contentType: string) : SxcData<T> {\r\n    return new SxcData<T>(this, contentType);\r\n  }\r\n  \r\n  /**\r\n   * \r\n   * @param query \r\n   */\r\n  query(query: string) : SxcQuery {\r\n    return new SxcQuery(this, query);\r\n  }\r\n    \r\n    \r\n  /**\r\n  * converts a short api-call path like \"/app/Blog/query/xyz\" to the DNN full path\r\n  * which varies from installation to installation like \"/desktopmodules/api/2sxc/app/...\"\r\n  * @deprecated use http.apiUrl instead\r\n  * @param virtualPath\r\n  * @returns mapped path\r\n  * @internal\r\n  */\r\n  resolveServiceUrl(virtualPath: string) {\r\n    const scope = virtualPath.split('/')[0].toLowerCase();\r\n    \r\n    // stop if it's not one of our special paths\r\n    if (ApiUrlRoots.indexOf(scope) === -1)\r\n    return virtualPath;\r\n    \r\n    return this.http.apiRoot(ToSxcName) + scope + '/' + virtualPath.substring(virtualPath.indexOf('/') + 1);\r\n  }\r\n    \r\n    \r\n  /**\r\n   * Show a nice error with more infos around 2sxc\r\n   * @param result \r\n   * @returns \r\n   * @internal\r\n   */\r\n  showDetailedHttpError(result: any): any {\r\n    if (window.console)\r\n    console.log(result);\r\n    \r\n    // check if the error was just because a language file couldn't be loaded - then don't show a message\r\n    if (result.status === 404 &&\r\n      result.config &&\r\n      result.config.url &&\r\n      result.config.url.indexOf('/dist/i18n/') > -1) {\r\n        if (window.console)\r\n        console.log('just fyi: failed to load language resource; will have to use default');\r\n        return result;\r\n    }\r\n      \r\n    // if it's an unspecified 0-error, it's probably not an error but a cancelled request,\r\n    // (happens when closing popups containing angularJS)\r\n    if (result.status === 0 || result.status === -1)\r\n    return result;\r\n    \r\n    // let's try to show good messages in most cases\r\n    let infoText = 'Had an error talking to the server (status ' + result.status + ').';\r\n    const srvResp = result.responseText\r\n      ? JSON.parse(result.responseText) // for jquery ajax errors\r\n      : result.data; // for angular $http\r\n    if (srvResp) {\r\n      const msg = srvResp.Message;\r\n      if (msg) infoText += '\\nMessage: ' + msg;\r\n      const msgDet = srvResp.MessageDetail || srvResp.ExceptionMessage;\r\n      if (msgDet) infoText += '\\nDetail: ' + msgDet;\r\n      \r\n      \r\n      if (msgDet && msgDet.indexOf('No action was found') === 0)\r\n      if (msgDet.indexOf('that matches the name') > 0)\r\n      infoText += '\\n\\nTip from 2sxc: you probably got the action-name wrong in your JS.';\r\n      else if (msgDet.indexOf('that matches the request.') > 0)\r\n      infoText += '\\n\\nTip from 2sxc: Seems like the parameters are the wrong amount or type.';\r\n      \r\n      if (msg && msg.indexOf('Controller') === 0 && msg.indexOf('not found') > 0)\r\n      infoText +=\r\n      // tslint:disable-next-line:max-line-length\r\n      \"\\n\\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word 'controller' from the call in JS. To call a controller called 'DemoController' only use 'Demo'.\";\r\n      \r\n    }\r\n    // tslint:disable-next-line:max-line-length\r\n    infoText += '\\n\\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug';\r\n    alert(infoText);\r\n    \r\n    return result;\r\n  }\r\n    \r\n  /**\r\n   * Test if the current code is in edit-mode and additional javascripts have been loaded to make it work\r\n   * @returns true if we are in edit-mode\r\n   */\r\n  isEditMode(): boolean {\r\n    return this.manage?._isEditMode() === true;\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param resetCache \r\n   * @returns \r\n   * @internal\r\n   */\r\n  recreate(resetCache: boolean): Sxc {\r\n    if (resetCache) delete this.root._controllers[this.cacheKey]; // clear cache\r\n    return this.root(this.id, this.cbid) as any as Sxc; // generate new\r\n  }\r\n}\r\n\r\n// Help cach error on call of old code\r\n// Background: From v3 to v12 data had a unusualy system for retrieving data belonging to the module\r\n// We believe it's almost never used, but the TimelineJs App always used it, and we believe\r\n// 2-3 other examples may have as well. \r\n// Now in v13 sxc.data is used to get any kind of data,\r\n// and we want to make sure that old code will show a warning helping people fix this\r\n// All the old code would have started with sxc.data.on('load', ...) so this is where we give them the error\r\n// We only do this if it hasn't been done already\r\nfunction patchDataWithWarnings(data: any) {\r\n  if (!(data as any).on) {\r\n    (data as any).on = () => { throw warning };\r\n    Object.defineProperty(data, 'sourceUrl', {\r\n        get: function() { throw warning }\r\n    });\r\n  }\r\n}\r\n\r\nconst warning = 'Warning Obsolete Feature on 2sxc JS: the .data has been obsolete for a long time and is repurposed. \\n'\r\n+ 'If you are calling \".data.on(...)\" or \".data.sourceUrl\" you are running very old code. \\n' \r\n+ 'Guidance to fix this: https://go.2sxc.org/brc-13-id.';","import { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { AttrJsonEditContext } from '../context/html-attribute';\r\nimport { DomTools } from '../../../$2sxc/src/dom/dom-tools';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class SxcTools {\r\n    /**\r\n     * get edit-context info of html element or sxc-object\r\n     */\r\n    static getEditContext(sxc: Sxc, htmlElement?: HTMLElement): AttrJsonEditContext {\r\n      return DomTools.getContext(sxc, htmlElement) as AttrJsonEditContext;\r\n    }\r\n\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport enum DialogPaths {\r\n    quickDialog = 'dist/quick-dialog/', // quick-dialog\r\n    eavUi = 'dist/ng-edit/', // Angular\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport const IDs = {\r\n  // classes\r\n  cls: {\r\n    scMenu: 'sc-menu',\r\n  },\r\n  attr: {\r\n    toolbar: 'toolbar',\r\n    toolbarData: 'data-toolbar',\r\n    settings: 'settings',\r\n    settingsData: 'data-settings',\r\n  },\r\n  publishAllowed: 'DraftOptional',\r\n  sel: {\r\n    scMenu: '.sc-menu',\r\n    tagScMenu: 'ul.sc-menu',\r\n  },\r\n};\r\n","import { ContentBlock, ContentBlockIds } from './content-block';\r\nimport { Debug } from './debug';\r\nimport { DialogPaths } from './dialog-paths';\r\nimport { IDs } from './ids';\r\nimport { ToolbarConstants } from './toolbar';\r\n\r\n/**\r\n * Attribute Names used in the HTML\r\n */\r\nconst Attributes = {\r\n  InstanceId: 'data-cb-instance',\r\n  Context: 'data-edit-context',\r\n  ContentBlockId: 'data-cb-id',\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const C = {\r\n  ContentBlock: ContentBlock,\r\n  DialogPaths: DialogPaths,\r\n  IDs: IDs,\r\n  AttrNames: Attributes,\r\n  ClsNames: {\r\n    UnInitialized: 'sc-uninitialized',\r\n    UnAvailable: 'sc-unavailable',\r\n  },\r\n  Toolbar: ToolbarConstants,\r\n  Cb: ContentBlockIds,\r\n  Debug: Debug,\r\n  Sel: {\r\n    SxcDivs: `div[${Attributes.Context}]`,\r\n  },\r\n};\r\n","/**\r\n * This just holds some constants, but it looks like _LayoutElement is unused - but I think it should be!\r\n * @internal\r\n */\r\nexport class ContentBlock {\r\n// constants\r\nstatic cViewWithoutContent: string = '_LayoutElement'; // needed to differentiate the \"select item\" from the \"empty-is-selected\" which are both empty\r\nstatic UseExistingTemplate = -1;\r\n}\r\n\r\n\r\n/**\r\n * ContentBlock constants\r\n * @internal\r\n */\r\nexport const ContentBlockIds = {\r\n    classes: {\r\n    name: 'sc-content-block',\r\n    },\r\n    selectors: {\r\n    ofName: '.sc-content-block',\r\n    },\r\n};\r\n","\r\n// The parts themselves must also be constants\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const ToolbarConstants = {\r\n  attrToMarkInitalized: '2sxc-tagtoolbar',\r\n  attr: {\r\n    full: 'sxc-toolbar',\r\n    hover: 'sxc-toolbar-hover',\r\n    disable: 'data-disable-toolbar',\r\n  },\r\n  classes: {\r\n    oldHover: 'sc-element',\r\n  },\r\n  selectors: {\r\n    ofOldHover: '.sc-element',\r\n  },\r\n  eventNames: {\r\n    onInit: 'toolbar-init',\r\n  },\r\n};\r\n","import { Sxc } from '../../../../$2sxc/src/sxc/sxc';\r\nimport { SxcVersion } from '../../../../core';\r\nimport { C } from '../../constants';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { AttrJsonEntity } from '../html-attribute/parts/parameters-entity';\r\n\r\n/**\r\n * information related to the current DNN module, incl.instanceId,\r\n * @internal\r\n */\r\nexport class ContextOfInstance {\r\n    id: number; // instance id (aka moduleId)\r\n    isEditable: boolean = false;\r\n    allowPublish: boolean = true;\r\n    // sxc\r\n    sxcVersion: string = SxcVersion;\r\n    parameters: AttrJsonEntity[] | null = null;\r\n    sxcRootUrl: string = '';\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc: Sxc) {\r\n        if (editCtx.Environment) {\r\n            this.id = editCtx.Environment.InstanceId;\r\n            this.isEditable = editCtx.Environment.IsEditable ?? false;\r\n            // sxc\r\n            this.sxcVersion = editCtx.Environment.SxcVersion ?? SxcVersion;\r\n            this.parameters = editCtx.Environment.parameters;\r\n            this.sxcRootUrl = editCtx.Environment.SxcRootUrl ?? '';\r\n        }\r\n\r\n        if (!this.id)\r\n            // if the module isn't known, check the additional context.\r\n            // Otherwise give it a real number but an obvious fallback\r\n            // This is for integration into other systems which don't need a module-id\r\n            this.id = sxc?.ctx?.moduleId ?? -2742;\r\n\r\n        if (editCtx.contentBlockReference)\r\n            this.allowPublish = editCtx.contentBlockReference.publishingMode === C.IDs.publishAllowed;\r\n    }\r\n}\r\n","import { Sxc } from '../../../../$2sxc/src/sxc/sxc';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * this will be information related to the current page\r\n * @internal\r\n */\r\nexport class ContextOfPage {\r\n    id: number;\r\n    // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n    // url: string;\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc: Sxc) {\r\n        if (editCtx.Environment) {\r\n            this.id = editCtx.Environment.PageId;\r\n            // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n            // this.url = editCtx.Environment.PageUrl;\r\n        }\r\n\r\n        // catch cases where it wasn't provided\r\n        this.id = this.id ?? sxc?.ctx?.pageId ?? window.$2sxc.env.page() ?? -2742;\r\n    }\r\n}\r\n","import { AttrJsonEditContext, ContextErrorJsonAndObj, ContextProblems } from '../html-attribute';\r\n\r\n/**\r\n * this will be everything about the current system, like system / api -paths etc.\r\n * @internal\r\n */\r\nexport class ContextOfSystem {\r\n  error: string;\r\n\r\n  problems?: ContextProblems[];\r\n\r\n  constructor(editCtx: AttrJsonEditContext) {\r\n    this.problems = editCtx.error?.problems;\r\n    if (editCtx.error) {\r\n      this.error = editCtx.error.type;\r\n    }\r\n  }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * this will be something about the current tenant(the dnn portal)\r\n * @internal\r\n */\r\nexport class ContextOfTenant {\r\n    // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n    // id: number;\r\n    // url: string;\r\n\r\n    constructor(editCtx: AttrJsonEditContext) {\r\n        if (editCtx.Environment) {\r\n            // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n            // this.id = editCtx.Environment.WebsiteId;\r\n            // this.url = editCtx.Environment.WebsiteUrl;\r\n        }\r\n    }\r\n}\r\n","import { NumberNotDefinedHuge } from '../../../../../core';\r\nimport { IDs } from '../../../constants/ids';\r\n\r\n/**\r\n * This contains a pointer to a content-block. The data is always provided by the server,\r\n * so this class is never really instantiated.\r\n * @internal\r\n */\r\nexport class ContentBlockReference {\r\n  /** How changes are published - draft required/optional */\r\n  public publishingMode: string = IDs.publishAllowed;\r\n\r\n  /** ID of the reference item - very rarely used */\r\n  public id: number = NumberNotDefinedHuge;\r\n\r\n  /** GUID of the parent item referencing this Content Block */\r\n  public parentGuid: string = null;\r\n\r\n  /** Field in which this content block is references */\r\n  public parentField: string = null;\r\n\r\n  /** Index of the reference - what position it's in in the list of that field */\r\n  public parentIndex: number = 0;\r\n\r\n  /** If this content is part of the page */\r\n  public partOfPage: boolean = false;\r\n\r\n  constructor(original: Partial<ContentBlockReference>) {\r\n      Object.assign(this, original);\r\n  }\r\n}\r\n","import { AttrJsonEditContext, AttrJsonUser } from \"../html-attribute\";\r\n\r\n/**\r\n * things about the user\r\n * ~~note that the properties are also used in url-params and ajax calls, so don't rename~~\r\n * 2022-02-23 2dm - renamed to upper case now, assume it shouldn't have a side effect because\r\n * it shouldn't be used in ajax calls, since the dialogs get the settings from the backend\r\n * @internal\r\n */\r\nexport class ContextOfUser extends AttrJsonUser {\r\n  constructor(editCtx?: AttrJsonEditContext) {\r\n    super();\r\n    if (!editCtx || !editCtx.User) return;\r\n    this.CanDevelop = editCtx.User.CanDevelop;\r\n    this.CanAdmin = editCtx.User.CanAdmin;\r\n    this.canSwitchEdition = editCtx.User.canSwitchEdition;\r\n  }\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport class AttrJsonUser {\r\n  CanDevelop: boolean;\r\n\r\n  // new v13\r\n  CanAdmin: boolean;\r\n\r\n  /**\r\n   * user can switch editions\r\n   */\r\n  canSwitchEdition: boolean;\r\n}\r\n","import { Sxc } from \"../../../../$2sxc/src\";\r\nimport { AttrJsonEditContext } from \"../html-attribute\";\r\n\r\nexport class ContentAppUnifiedInCtxAndAttr {\r\n  /**\r\n   * App name for showing in the layout infos - new v17\r\n   */\r\n  appName: string;\r\n}\r\n\r\n/**\r\n * this will be about the current app, settings of the app, app - paths, etc.\r\n * @internal\r\n */\r\nexport class ContextOfApp extends ContentAppUnifiedInCtxAndAttr {\r\n  // ContentGroup\r\n  /**\r\n   * IsContent is used for 2 things\r\n   * 1. Determine if certain buttons should be enabled in the toolbar\r\n   * 2. To forward to the quick-dialog, which changes behavior based on this\r\n   * Should default to true, because that's the more basic/restricted mode\r\n   */\r\n  isContent: boolean = true;\r\n  settingsId: number = null;\r\n  resourcesId: number = null;\r\n  appPath: string;\r\n  hasContent: boolean;\r\n  supportsAjax: boolean = false;\r\n  zoneId: number;\r\n  id: number; // appId\r\n  // languages\r\n  currentLanguage: string;\r\n  primaryLanguage: string;\r\n  allLanguages: string[] | null;\r\n\r\n  constructor(editCtx: AttrJsonEditContext, sxc: Sxc) {\r\n    super();\r\n    // Initialize Content-Group App information\r\n    if (editCtx.contentBlock) {\r\n      const cb = editCtx.contentBlock;\r\n      this.id = cb.AppId;\r\n      this.isContent = cb.IsContent ?? true;\r\n      this.resourcesId = cb.AppResourcesId ?? null;\r\n      this.settingsId = cb.AppSettingsId ?? null;\r\n      this.appPath = cb.AppUrl; // this is the only value which doesn't have a slash by default. note that the app-root doesn't exist when opening \"manage-app\"\r\n      this.hasContent = cb.HasContent;\r\n      this.supportsAjax = cb.SupportsAjax ?? false;\r\n      this.zoneId = cb.ZoneId;\r\n\r\n      // new for layout stats v17\r\n       this.appName = cb.appName;\r\n    }\r\n\r\n    // if we have more context information, use this to provide possibly missing data\r\n    if (sxc && sxc.ctx) {\r\n      this.id = this.id ?? sxc.ctx.appId;\r\n      this.zoneId = this.id ?? sxc.ctx.zoneId;\r\n    }\r\n\r\n    // Initialize language information\r\n    if (editCtx.Language) {\r\n      this.currentLanguage = editCtx.Language.Current;\r\n      this.primaryLanguage = editCtx.Language.Primary;\r\n      this.allLanguages = editCtx.Language.All;\r\n    }\r\n  }\r\n}\r\n","import { AttrJsonEditContext } from \"../html-attribute\";\r\n\r\n/**\r\n * ensure that the UI will load the correct assets to enable editing\r\n * @internal\r\n */\r\nexport class ContextOfUi {\r\n  autoToolbar?: boolean; // toolbar auto-show\r\n\r\n  constructor(editCtx: AttrJsonEditContext) {\r\n    if (editCtx.Ui) {\r\n      this.autoToolbar = editCtx.Ui.AutoToolbar; // toolbar auto-show\r\n    }\r\n  }\r\n}\r\n","import { Sxc } from '../../../../$2sxc/src/sxc/sxc';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { ContextOfInstance, ContextOfPage, ContextOfSystem, ContextOfTenant, ContextOfUser } from '../parts';\r\nimport { ContextOfApp } from '../parts/context-app';\r\nimport { ContextOfUi } from '../parts/context-ui';\r\n\r\n/**\r\n * @public\r\n */\r\nexport class ContextBundleInstance {\r\n  /**\r\n   * instance of sxc object\r\n   */\r\n  sxc: Sxc;\r\n\r\n  /** @internal */\r\n  instance: ContextOfInstance; // information related to the current DNN module, incl.instanceId, etc.\r\n  /** @internal */\r\n  app: ContextOfApp; // this will be about the current app, settings of the app, app - paths, etc.\r\n  /** @internal */\r\n  ui: ContextOfUi; // ensure that the UI will load the correct assets to enable editing\r\n  /** @internal */\r\n  page: ContextOfPage; // this will be information related to the current page\r\n  /** @internal */\r\n  system: ContextOfSystem; // this will be everything about the current system, like system / api -paths etc.\r\n  /** @internal */\r\n  tenant: ContextOfTenant; // this will be something about the current tenant(the dnn portal)\r\n  /** @internal */\r\n  user: ContextOfUser; // things about the user\r\n\r\n  _isContext = true;\r\n\r\n  /** @internal */\r\n  constructor(editCtx: AttrJsonEditContext, sxc: Sxc) {\r\n    // this will be about the current app, settings of the app, app - paths, etc.\r\n    this.app = new ContextOfApp(editCtx, sxc);\r\n\r\n    // information related to the current DNN module, incl.instanceId, etc.\r\n    this.instance = new ContextOfInstance(editCtx, sxc);\r\n\r\n    // things about the user\r\n    this.user = new ContextOfUser(editCtx);\r\n\r\n    // this will be information related to the current page\r\n    this.page = new ContextOfPage(editCtx, sxc);\r\n\r\n    // this will be everything about the current system, like system / api -paths etc.\r\n    this.system = new ContextOfSystem(editCtx);\r\n\r\n    // this will be something about the current tenant(the dnn portal)\r\n    this.tenant = new ContextOfTenant(editCtx);\r\n\r\n    // ensure that the UI will load the correct assets to enable editing\r\n    this.ui = new ContextOfUi(editCtx);\r\n  }\r\n\r\n  /** @internal */\r\n  static is(thing: unknown): thing is ContextBundleInstance {\r\n    const maybeButton = thing as ContextBundleInstance;\r\n    return maybeButton.sxc !== undefined && maybeButton.instance !== undefined;\r\n  }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\nexport class ContentBlockUnifiedInCtxAndAttr {\r\n  /**\r\n   * Informs if the razor file is from a shared location - usually false.\r\n   * Important for opening the code editor.\r\n   * \r\n   * True if the template comes from the shared location - new in v13\r\n   * Changed to lower case in v17 and unified in v17\r\n   */\r\n  templateIsShared: boolean;\r\n\r\n  /**\r\n   * View name for showing in the layout infos - new v17\r\n   */\r\n  viewName: string;\r\n\r\n  // /**\r\n  //  * App name for showing in the layout infos - new v17\r\n  //  */\r\n  // appName: string;\r\n\r\n  renderMs: number;\r\n  renderLightspeed: boolean;\r\n\r\n  /**\r\n   * Disable the view switching, typically because the current view was triggered by a url parameter.\r\n   */\r\n  viewSwitchDisabled?: boolean;\r\n} \r\n\r\n/**\r\n * information related to the current contentBlock, incl\r\n * @internal\r\n */\r\nexport class ContextOfContentBlock extends ContentBlockUnifiedInCtxAndAttr {\r\n  // ContentGroup\r\n  isCreated: boolean;\r\n  isList: boolean;\r\n  queryId: number;\r\n  /** new v17.07 for layout-info only ATM */\r\n  queryName: string;\r\n  /** new v17.07 for layout-info only ATM */\r\n  queryInfo: string;\r\n  templateId: number;\r\n  contentTypeId: string;\r\n  contentGroupId: string;\r\n\r\n  // TemplateEdition for better editing\r\n  // New in 12.11\r\n  templatePath?: string;\r\n\r\n  \r\n\r\n  // New in 12.11\r\n  edition?: string;\r\n\r\n  /**\r\n   * new 17.08, CSV of editions\r\n   */\r\n  editions?: string;\r\n\r\n  constructor(editCtx: AttrJsonEditContext) {\r\n    super();\r\n    // Initialize Content-Group Values\r\n    const cb = editCtx.contentBlock;\r\n    if (!cb) return;\r\n    this.isCreated = cb.IsCreated;\r\n    this.isList = cb.IsList;\r\n\r\n    this.queryId = cb.QueryId;\r\n    this.queryName = cb.queryName;\r\n    this.queryInfo = cb.queryInfo;\r\n    this.templateId = cb.TemplateId;\r\n    this.templatePath = cb.TemplatePath;\r\n    this.templateIsShared = cb.templateIsShared;\r\n    this.edition = cb.Edition ?? null;\r\n    this.editions = cb.editions ?? null;\r\n    this.contentTypeId = cb.ContentTypeName;\r\n    this.contentGroupId = cb.Guid;\r\n\r\n    this.viewName = cb.viewName;\r\n    this.renderMs = cb.renderMs;\r\n    this.renderLightspeed = cb.renderLightspeed;\r\n\r\n    this.viewSwitchDisabled = cb.viewSwitchDisabled;\r\n  }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * information about the current item\r\n * ATM empty, not sure if it serves a purpose...\r\n * @internal\r\n */\r\nexport class ContextOfItem {\r\n    // tslint:disable-next-line: no-empty\r\n    constructor(editCtx: AttrJsonEditContext) {}\r\n}\r\n","import { ContextBundleInstance, ContextOfContentBlock, ContextOfItem } from '..';\r\nimport { Sxc } from '../../../../$2sxc/src/sxc/sxc';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { ContentBlockReference } from '../html-attribute/parts/content-block';\r\n\r\n/**\r\n * @public\r\n */\r\nexport class ContextBundleContent extends ContextBundleInstance {\r\n  /**\r\n   * information about the current item\r\n   * @internal\r\n   */\r\n  item: ContextOfItem;\r\n\r\n  /**\r\n   * Reference to a Content-Block\r\n   * @internal\r\n   */\r\n  contentBlockReference: ContentBlockReference;\r\n\r\n  /**\r\n   * The content-block itself with specs like is-app, etc.\r\n   * @internal\r\n   */\r\n  contentBlock: ContextOfContentBlock;\r\n\r\n  /** @internal */\r\n  constructor(editCtx: AttrJsonEditContext, sxc: Sxc) {\r\n    super(editCtx, sxc);\r\n\r\n    // information about the current item\r\n    this.item = new ContextOfItem(editCtx);\r\n\r\n    this.contentBlockReference = new ContentBlockReference(editCtx.contentBlockReference);\r\n\r\n    // information related to the current contentBlock\r\n    this.contentBlock = new ContextOfContentBlock(editCtx);\r\n  }\r\n}\r\n","import { ContextBundleContent, ContextComplete } from '.';\r\nimport { Sxc } from '../../../../$2sxc/src/sxc/sxc';\r\nimport { Button } from '../../toolbar/config/button';\r\nimport { Toolbar } from '../../toolbar/config/toolbar';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * @public\r\n */\r\nexport class ContextBundleToolbar extends ContextBundleContent {\r\n  /** @internal */\r\n  toolbar: Toolbar;\r\n\r\n  /** @internal */\r\n  constructor(editCtx: AttrJsonEditContext, sxc: Sxc) {\r\n    super(editCtx, sxc);\r\n    // note that the toolbar will not be filled here, as it will be filled somewhere else\r\n  }\r\n\r\n  /** @internal */\r\n  forButton(button: Button): ContextComplete {\r\n    // the ContextBundleButton is the same as toolbar, just with .button\r\n    const clone = {...this} as unknown as ContextComplete;\r\n    clone.button = button;\r\n    return clone;\r\n  }\r\n}\r\n","import { Sxc } from '../../../../$2sxc/src/sxc/sxc';\r\nimport { Obj } from '../../plumbing';\r\nimport { SxcTools } from '../../sxc/sxc-tools';\r\nimport { Button } from '../../toolbar/config/button';\r\nimport { ToolbarWorkflowManager } from '../../workflow';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { ContextBundleToolbar } from './context-bundle-toolbar';\r\nimport { DomTools } from '../../../../$2sxc/src/dom/dom-tools';\r\n/**\r\n * @public\r\n */\r\nexport class ContextComplete extends ContextBundleToolbar {\r\n  /** @internal */\r\n  private _isCtxComplete = true;\r\n\r\n  /** @internal */\r\n  button?: Button;\r\n\r\n  /** @internal\r\n   * must be implemented as static, because the final object is actually just an interface and created from values.\r\n   */\r\n  static getRule(ctx: ContextComplete) {\r\n    return ctx.toolbar?.settings?._rules?.find(ctx.button.id);\r\n  }\r\n\r\n  /** @internal */\r\n  commandWorkflow?: ToolbarWorkflowManager;\r\n\r\n  /** @internal */\r\n  constructor(editCtx: AttrJsonEditContext, sxc?: Sxc) {\r\n    super(editCtx, sxc);\r\n    // note that the button will not be filled here, as it will be filled somewhere else\r\n  }\r\n\r\n  /**\r\n   * Primary API to get the context (context is cached)\r\n   * @internal\r\n   */\r\n  static expandContext(tagOrSxc: Sxc | HTMLElement | number, cbid?: number): ContextComplete {\r\n    let sxc: Sxc;\r\n    let containerTag: HTMLElement = null;\r\n\r\n    if (Sxc.is(tagOrSxc)) { // it is SxcInstance\r\n        sxc = tagOrSxc;\r\n    } else if (typeof tagOrSxc === 'number') { // it is number\r\n        sxc = window.$2sxc(tagOrSxc, cbid);\r\n    } else { // it is HTMLElement\r\n        sxc = window.$2sxc(tagOrSxc);\r\n        containerTag = DomTools.getContainerTag(tagOrSxc);\r\n    }\r\n\r\n    const contextOfButton = ContextComplete.getContextInstance(sxc, containerTag);\r\n    contextOfButton.sxc = sxc;\r\n    return contextOfButton;\r\n  }\r\n\r\n  /**\r\n   * Create copy of context, so it can be modified before use\r\n   * @internal\r\n   */\r\n  static contextCopy(htmlElementOrId: HTMLElement | number, cbid?: number): ContextComplete {\r\n    const contextOfButton = ContextComplete.expandContext(htmlElementOrId, cbid);\r\n    // set sxc to null because of cyclic reference, so we can serialize it\r\n    contextOfButton.sxc = null;\r\n    // make a copy\r\n    const copyOfContext = Obj.DeepClone(contextOfButton);\r\n    // bring sxc back to context\r\n    contextOfButton.sxc = window.$2sxc(htmlElementOrId) as Sxc;\r\n    return copyOfContext;\r\n  }\r\n\r\n  /**\r\n   * Create new context\r\n   * @param sxc\r\n   * @param htmlElement\r\n   * @internal\r\n   */\r\n  static getContextInstance(sxc: Sxc, htmlElement?: HTMLElement): ContextComplete {\r\n    const editContext = SxcTools.getEditContext(sxc, htmlElement);\r\n    return new ContextComplete(editContext, sxc);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  static is(thing: unknown): thing is ContextComplete {\r\n    return (thing as ContextComplete)._isCtxComplete;\r\n  }\r\n}\r\n","import tippy, { Props } from 'tippy.js';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { Button } from '../toolbar/config/button';\r\nimport { Note } from '../toolbar/config/Note';\r\nimport { Debug } from '../constants/debug';\r\n\r\nexport const iconPrefix = 'icon-sxc-';\r\nexport const tlbI18nPrefix = 'Toolbar.';\r\n\r\nconst debugTippy = Debug.parts.CommandTippy;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class Command {\r\n  constructor(public name: string) {\r\n  }\r\n\r\n  /** the defaults are important for new buttons that just know this command */\r\n  buttonDefaults: Partial<Button>;\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  mergeDefaults(translateKey: string, icon: string, uiOnly: boolean, partOfPage: boolean, more: Partial<Button>): void {\r\n    if (typeof (partOfPage) !== 'boolean')\r\n      throw 'partOfPage in commands not provided, order will be wrong!';\r\n\r\n    this.buttonDefaults = {\r\n      icon: () => `${iconPrefix}${icon}`,\r\n      title: () => `${tlbI18nPrefix}${translateKey}`,\r\n      uiActionOnly: () => uiOnly,\r\n      partOfPage: () => partOfPage,\r\n      color: () => undefined,\r\n\r\n      /** Initialize Tippy if we have any notes */\r\n      tippy: (ctx, tag) => {\r\n        // get the rule and only continue if there is a note attached\r\n        const ui = ContextComplete.getRule(ctx)?.ui;\r\n        let note = (ui?.note);\r\n        \r\n        // if there is no specified note, see if the button definition would have one\r\n        if (!note && more.notes) {\r\n          var notes = more.notes(ctx);\r\n          if (notes && notes.length > 0) note = notes[0];\r\n        }\r\n\r\n        // if no note, return\r\n        if (!note?.note) return undefined;\r\n\r\n        const allowHtml = note?.asHtml ?? false;\r\n\r\n        // see https://atomiks.github.io/tippyjs/v5/all-props/\r\n        let tippyProps: Partial<Props> = {\r\n          // the normal contents to show, maybe with html\r\n          content: note.note,\r\n          // the theme to use - ATM a build in-theme and some custom css in `tippy.scss`\r\n          theme: 'light',\r\n          // use a 'v' arrow at the bottom\r\n          arrow: true,\r\n          // custom delay/linger, default in 0\r\n          delay: [note.delay, note.linger],\r\n          // allow html in the content\r\n          allowHTML: allowHtml,\r\n                          \r\n          // activate these to debug the styling in F12\r\n          // trigger: 'click',\r\n          // hideOnClick: false,\r\n          // interactive: true,\r\n\r\n          // custom styling applied when it appears\r\n          onMount: (instance) => {\r\n            // ATM only background color handled\r\n            const content = instance.popper.querySelector('.tippy-content') as HTMLElement;\r\n            if (note.isSystem) content.style.background = '#DFC2F2';\r\n            if (!note?.background) return;\r\n            // console.log('popper', content);\r\n            content.style.background = note.background;\r\n          }                \r\n        };\r\n\r\n        // Experimental 16.02 - ATM used for insights /code-help Tippys only\r\n        if (note.interactive)\r\n          tippyProps = this.tippyMakeInteractive(tippyProps);\r\n        \r\n        // If config has links, add them and enable interactive\r\n        tippyProps = this.tippyAddLinks(tippyProps, note);\r\n\r\n        if (debugTippy) console.log('Command-Tippy', note, tippyProps);\r\n\r\n        tippy(tag, tippyProps);\r\n\r\n        // if the note has a delay, add an indicator\r\n        if (note.delay > 100) {\r\n          tag.classList.add('note-delayed');\r\n          if (note.isSystem) tag.classList.add('note-system');\r\n        }\r\n\r\n        return undefined;\r\n      },\r\n      ...more,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * If config has links, add them and enable interactive\r\n   */\r\n  private tippyAddLinks(tippyProps: Partial<Props>, note: Note) {\r\n    // If no links, return\r\n    if (!note.links || note.links.length === 0) return tippyProps;\r\n    // Generate html for the links\r\n    const html = note.links.map(l => `<a class=\"tippy-button ${l.primary ? 'tippy-button-primary': ''}\" href=\"${l.url}\" target=\"_blank\">${l.label ?? ' more'}</a>`);\r\n    return {\r\n      // make interactive\r\n      ...this.tippyMakeInteractive(tippyProps),\r\n      allowHTML: true,\r\n      // content must be repacked, and links added at the bottom.\r\n      content: `<div>${note.note}<div>\r\n      <br>\r\n      <div class=\"tippy-buttons\">${html}</div>`,\r\n    };\r\n  } \r\n\r\n  /**\r\n   * If it needs to be interactive, then changes are made to allow mouse to travel to it.\r\n   * eg. we need to append it to the body\r\n   */\r\n  private tippyMakeInteractive(tippyProps: Partial<Props>) {\r\n    return {\r\n      ...tippyProps,\r\n      interactive: true,\r\n      appendTo: () => document.body,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @returns \r\n   * @internal\r\n   */\r\n  static build(name: string,\r\n                translateKey: string,\r\n                icon: string,\r\n                uiOnly: boolean,\r\n                partOfPage: boolean,\r\n                more: Partial<Button>,\r\n                ): Command {\r\n    const cmd = new Command(name);\r\n    // debug entry\r\n    // if (name == 'layout') {\r\n    //   console.log('test 2dm: ' + name);\r\n    //   debugger;\r\n    // }\r\n\r\n    // Toolbar API v2\r\n    cmd.mergeDefaults(translateKey, icon, uiOnly, partOfPage, more);\r\n\r\n    return cmd;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  static clone(command: Command, name: string) {\r\n    const clone = new Command(name);\r\n    clone.buttonDefaults = command.buttonDefaults;\r\n    return clone;\r\n  }\r\n}\r\n","import { HasLog, Insights } from '../core';\r\nimport { Button } from '../toolbar/config';\r\nimport { Command } from './command';\r\n\r\n/**\r\n * Singleton Catalog of all commands\r\n * @internal\r\n */\r\nexport class Commands extends HasLog {\r\n\r\n  /** Singleton */\r\n  public static singleton(): Commands {\r\n    return this.#singleton ?? (this.#singleton = new Commands());\r\n  }\r\n  static #singleton: Commands;\r\n\r\n  public static add(name: string, translateKey: string, icon: string, uiOnly: boolean, partOfPage: boolean, more: Partial<Button>): Command {\r\n    return this.singleton().add(name, translateKey, icon, uiOnly, partOfPage, more);\r\n  }\r\n\r\n  public static addCommand(command: Command): void {\r\n    return this.singleton().addCommand(command);\r\n  }\r\n\r\n  #all: Command[] = [];\r\n  list: Record<string, Command> = {}; // hash - table of action definitions, to be used a list()[\"action - name\"]\r\n\r\n  private constructor() {\r\n    super('Cmd.Catlog');\r\n    Insights.add('system', 'command-catalog', this.log);\r\n  }\r\n\r\n  get = (name: string) => this.list[name]; // a specific action definition\r\n\r\n  add(name: string, translateKey: string, icon: string, uiOnly: boolean, partOfPage: boolean, more: Partial<Button>): Command {\r\n    const cmd = this.#add(Command.build(name, translateKey, icon, uiOnly, partOfPage, more));\r\n    this.log.add(`add command '${name}'`, cmd);\r\n    return cmd;\r\n  }\r\n\r\n  addCommand(command: Command): void {\r\n    const cmd = this.#add(command);\r\n    this.log.add(`add command '${cmd.name}'`, cmd);\r\n  }\r\n\r\n\r\n  #add(def: Command): Command {\r\n    if (!this.list[def.name]) {\r\n      // add\r\n      this.#all.push(def);\r\n      this.list[def.name] = def;\r\n    } else if (this.list[def.name] !== def) {\r\n      // update\r\n      this.list[def.name] = def;\r\n    }\r\n    return def;\r\n  }\r\n\r\n}\r\n","import { CmdParHlp } from '..';\r\nimport { ContextComplete } from '../../context';\r\n\r\n/**\r\n * Shared logic like for deciding if we show list buttons\r\n * here\r\n * @internal\r\n */\r\nexport class SharedLogic {\r\n  static isPartOfBlockList(context: ContextComplete) {\r\n    return !!(context.contentBlock.isList &&\r\n      context.button.command.params.useModuleList &&\r\n      CmdParHlp.getIndex(context) !== -1);    // -1 is the header item\r\n    }\r\n\r\n    /**\r\n     * This will tell us, if the item is being referenced (like in a list)\r\n     * It's similar to isBlockList, but will return true even if it's\r\n     * a non-list (single item only)\r\n     */\r\n    static isBlockReference(context: ContextComplete) {\r\n      return !!context.button.command.params.useModuleList;    // -1 is the header item\r\n    }\r\n\r\n    static isFieldList(context: ContextComplete) {\r\n      const params = context.button?.command.params;\r\n      return !!(params?.fields && params?.parent);\r\n    }\r\n\r\n    static isList(context: ContextComplete) {\r\n      return this.isPartOfBlockList(context) || this.isFieldList(context);\r\n    }\r\n\r\n    static isReferencedItem(context: ContextComplete) {\r\n      return this.isBlockReference(context) || this.isFieldList(context);\r\n    }\r\n}\r\n","import { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { C } from '../constants';\r\nimport { DomTools } from '../../../$2sxc/src/dom/dom-tools';\r\n/**\r\n * @internal\r\n */\r\nexport class HtmlTools {\r\n\r\n    static disable(tag: HTMLElement): void {\r\n        tag.setAttribute(C.Toolbar.attr.disable, 'true');\r\n    }\r\n\r\n    static isDisabled(sxc: Sxc): boolean {\r\n        const tag = DomTools.getTag(sxc);\r\n        return !!tag.getAttribute(C.Toolbar.attr.disable);\r\n    }\r\n\r\n    /**\r\n     * Find the text of one or more attributes in fallback order, till we found one\r\n     */\r\n    static getFirstAttribute(toolbar: HTMLElement, name1: string, name2: string): string {\r\n        return HtmlTools.tryGetAttrText(toolbar, name1) || HtmlTools.tryGetAttrText(toolbar, name2) || '{}';\r\n    }\r\n\r\n    /**\r\n     * Get text-content of an attribute (or return null)\r\n     */\r\n    static tryGetAttrText(tag: HTMLElement, name: string): string {\r\n        const item1 = tag.attributes.getNamedItem(name);\r\n        return item1 && item1.textContent;\r\n    }\r\n\r\n    /**\r\n     * Add html classes to a DOM element\r\n     */\r\n    static addClasses(element: HTMLElement, classes: string) {\r\n        if (!classes) return;\r\n        if (classes.indexOf(','))\r\n            classes = classes.replace(',', ' ');\r\n        const classessArray = classes.split(' ');\r\n        for (let c = 0; c < classessArray.length; c++)\r\n            if (classessArray[c])\r\n                element.classList.add(classessArray[c]);\r\n    }\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport class Selection {\r\n    /** The parent is either \"dnn\" or a module information */\r\n    parent: string | number;\r\n\r\n    // new in 11.06 - inner content now always uses guid\r\n    parentGuid: string;\r\n\r\n    /** The field inside the parent used for this content */\r\n    field: string;\r\n\r\n    list: HTMLElement;\r\n    item: HTMLElement;\r\n    index: number;\r\n    type: 'mod' | 'cb';\r\n}\r\n","import { Selection } from '.';\r\nimport { HasLog } from '../core';\r\n\r\n/**\r\n * Base class for module / content-block editors\r\n * @internal\r\n */\r\nexport abstract class ModifierBase extends HasLog {\r\n    constructor(name: string) {\r\n        super(name);\r\n    }\r\n\r\n    abstract delete(clip: Selection): Promise<void>;\r\n\r\n    abstract isRealMove(oldClip: Selection, newClip: Selection): boolean;\r\n\r\n    abstract move(oldClip: Selection, newClip: Selection): void;\r\n}\r\n","import { Positioning, QuickEditConfigButtons } from '.';\r\nimport { iconPrefix } from '../commands';\r\nimport { C } from '../constants';\r\nimport { NoJQ } from '../plumbing';\r\n\r\nconst iconPre = iconPrefix;\r\n/**\r\n * @internal\r\n */\r\nexport namespace QuickEditOverlay {\r\n  export interface Selection extends HTMLElement {\r\n    toggleOverlay(target: boolean | HTMLElement, buttons?: QuickEditConfigButtons): void;\r\n    target: HTMLElement;\r\n  }\r\n\r\n  export interface Main extends HTMLElement {\r\n    activeContentBlock: HTMLElement;\r\n    activeModule: HTMLElement;\r\n    _parentNode: HTMLElement;\r\n  }\r\n\r\n  export function setButtonActivationClasses(buttons: QuickEditConfigButtons, linkTags: HTMLElement[]) {\r\n    // remove any previously set classes for these\r\n    for (const [k, v] of Object.entries(new QuickEditConfigButtons()))\r\n      linkTags.forEach((l) => {\r\n        l.classList.remove(`enable-${k}`, `disable-${k}`);\r\n      });\r\n\r\n    // set classes from config\r\n    for (const [k, v] of Object.entries(buttons))\r\n      linkTags.forEach((l) => {\r\n        l.classList.add(`${(v ? 'enable' : 'disable')}-${k}`);\r\n      });\r\n  }\r\n\r\n  export function btn(action: string, icon: string, i18N: string, invisible?: boolean, unavailable?: boolean, classes?: string): string {\r\n    return `<a class='sc-content-block-menu-btn sc-cb-action ${iconPre}${icon} ${invisible ? ' sc-invisible ' : ''}${unavailable ? ` ${C.ClsNames.UnAvailable} ` : ''}${classes}' data-action='${action}' data-i18n='[title]QuickInsertMenu.${i18N}'></a>`;\r\n  }\r\n\r\n  export const selectedOverlay = NoJQ.domFromString('<div class=\"sc-content-block-menu sc-content-block-selected-menu sc-i18n\"></div>').map((o) => {\r\n    o.append(\r\n      NoJQ.domFromString(QuickEditOverlay.btn('delete', 'trash-empty', 'Delete'))[0],\r\n      NoJQ.domFromString(QuickEditOverlay.btn('sendToPane', 'move', 'Move', null, null, 'sc-cb-mod-only'))[0],\r\n      NoJQ.domFromString('<div id=\"paneList\"></div>')[0],\r\n    );\r\n    return o;\r\n  })[0] as QuickEditOverlay.Selection;\r\n}\r\n\r\n\r\n/** Expand the selectedOverlay with the necessary toggle function */\r\nQuickEditOverlay.selectedOverlay.toggleOverlay = (target: boolean | HTMLElement, buttons?: QuickEditConfigButtons) => {\r\n  if (!target) {\r\n    QuickEditOverlay.selectedOverlay.style.display = 'none';\r\n  } else {\r\n    // 1. set overlay at the right coordinates\r\n    const coords = Positioning.get(target as HTMLElement);\r\n    coords.yh = coords.y + 20;\r\n    Positioning.positionAndAlign(QuickEditOverlay.selectedOverlay, coords);\r\n    QuickEditOverlay.selectedOverlay.target = target as HTMLElement;\r\n\r\n    // 2. Activate / deactivate correct buttons\r\n    QuickEditOverlay.setButtonActivationClasses(buttons, Array.from(QuickEditOverlay.selectedOverlay.querySelectorAll<HTMLElement>('a')));\r\n  }\r\n};\r\n","\r\nexport const QuickEditConfigEnableAuto: string = 'auto';\r\n\r\n/**\r\n * Buttons on a quick-edit toolbar\r\n * @public\r\n */\r\n// Note: It's actually used as an interface, but we made it a class so the docs can show the default being true on all values\r\nexport class QuickEditConfigButtons {\r\n  /**\r\n   * Enable the button to \"Add Content\"\r\n   */\r\n  addContent?: boolean = true;\r\n\r\n  /**\r\n   * Enable the button to \"add App\"\r\n   */\r\n  addApp?: boolean = true;\r\n\r\n  /**\r\n   * Enable the button \"Select\"\r\n   */\r\n  select?: boolean = true;\r\n\r\n  /**\r\n   * Enable the button \"Paste\"\r\n   */\r\n  paste?: boolean = true;\r\n\r\n  /**\r\n   * Enable the button \"Delete\"\r\n   */\r\n  delete?: boolean = true;\r\n\r\n  /**\r\n   * Enable the button \"Move\"\r\n   */\r\n  move?: boolean = true;\r\n}\r\n\r\n/**\r\n * Quick Edit Configuration which has an `enable` and specific button configurations\r\n * @public\r\n */\r\nexport class QuickEditConfig {\r\n  /**\r\n   * Determine whether this section is enabled.\r\n   */\r\n  // Important: write 'auto', don't use constant, because of generated docs\r\n  enable?: boolean | 'auto' = 'auto';\r\n\r\n  /**\r\n   * Optional detailed configuration of the buttons.\r\n   * The buttons configuration on the root.\r\n   * Will be used for the `modules` and `innerBlocks` if not specified there.\r\n   * Note that if not specified, will always default to true for all buttons.\r\n   */\r\n  buttons?: QuickEditConfigButtons;\r\n}\r\n\r\n/**\r\n * Quick Edit - Full configuration at root, with `enable` and rules for `modules` and `innerBlocks`\r\n * @public\r\n */\r\nexport class QuickEditConfigRoot extends QuickEditConfig {\r\n  // /**\r\n  //  * The buttons configuration on the root.\r\n  //  * Will be used for the `modules` and `innerBlocks` if not specified there.\r\n  //  * Note that if not specified, will always default to true for all buttons.\r\n  //  */\r\n  // buttons?: QuickEditConfigButtons;\r\n\r\n  /**\r\n   * Optional configuration for the Inner Content Blocks.\r\n   */\r\n  innerBlocks?: QuickEditConfig;\r\n\r\n  /**\r\n   * Optional configuration for the Modules.\r\n   */\r\n  modules?: QuickEditConfig;\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  static getDefault(): QuickEditConfigRoot {\r\n    return {\r\n      enable: true,\r\n      buttons: new QuickEditConfigButtons(),\r\n      innerBlocks: {\r\n        enable: QuickEditConfigEnableAuto,\r\n      },\r\n      modules: {\r\n        enable: QuickEditConfigEnableAuto,\r\n      },\r\n    } as QuickEditConfigRoot;\r\n  }\r\n}","import { QeSelectors } from '.';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ContextForLists {\r\n    parent: string | number;\r\n\r\n    // new in 11.06 - all list-operations now use the parentGuid for inner-content\r\n    parentGuid: string;\r\n\r\n    field: string;\r\n    type?: string;\r\n    guid?: string;\r\n    apps?: string;\r\n    max?: number;\r\n\r\n    appList?: string[];\r\n\r\n    static getFromDom(tag: HTMLElement): ContextForLists {\r\n        const result: ContextForLists = JSON.parse(tag.getAttribute(QeSelectors.blocks.cb.context) || null) || {};\r\n        result.appList = []; // empty by default\r\n        if (result != null && typeof (result.apps) === 'string' && result.apps.length > 1)\r\n            result.appList = result.apps\r\n                .split(',')\r\n                .map((s) => s.trim())   // trim\r\n                .filter((s) => !!s);    // drop empty ones\r\n        return result;\r\n    }\r\n}\r\n","import { RuleManager } from '../rules/rule-manager';\r\n\r\n/** @internal */\r\nexport const TlbHoverPrefix = 'sc-tb-hover-';\r\n/** @internal */\r\nexport const TlbShowPrefix = 'sc-tb-show-';\r\n\r\n/** @internal */\r\nexport const TLB_MORE_END = 'end';\r\n/** @internal */\r\nexport const TLB_MORE_START = 'start';\r\n/** @internal */\r\nexport const TLB_MORE_AUTO = 'auto';  // Note: added in 14.07.05\r\n/** @internal */\r\nexport const TLB_MORE_NEVER = 'never';  // Note: added in 14.07.05\r\n/** @internal */\r\ntype TypeAutoAddMore = null | typeof TLB_MORE_AUTO | typeof TLB_MORE_END | typeof TLB_MORE_START | typeof TLB_MORE_NEVER;\r\nconst TLB_MORE_OLD_TRUE = true;       //  [true: used to be right/start]\r\nconst TLB_MORE_OLD_RIGHT = 'right';   // fallback for older v1 setting\r\n\r\n/** @internal */\r\nexport const TLB_HOV_RIGHT = 'right';\r\n/** @internal */\r\nexport const TLB_HOV_LEFT = 'left';\r\n/** @internal */\r\nexport const TLB_HOV_NONE = 'none'; // unclear if this is ever used?\r\n/** @internal */\r\ntype TypeHoverH = typeof TLB_HOV_LEFT | typeof TLB_HOV_RIGHT | 'none';\r\n\r\n/** @internal */\r\nexport const TLB_HOV_TOP = 'top'; // not in use ATM / default\r\n/** @internal */\r\nexport const TLB_HOV_MID = 'middle';\r\n/** @internal */\r\nexport const TLB_HOV_BOT = 'bottom'; // not in use ATM / not implemented\r\ntype TypeHoverV = typeof TLB_HOV_MID | typeof TLB_HOV_TOP | typeof TLB_HOV_BOT | 'none';\r\n\r\n/** @internal */\r\nexport const TLB_SHOW_ALWAYS = 'always';\r\n/** @internal */\r\nexport const TLB_SHOW_HOVER = 'hover';\r\n/** @internal */\r\ntype TypeShow = typeof TLB_SHOW_ALWAYS | typeof TLB_SHOW_HOVER;\r\n\r\nconst followDefault = 'default';\r\n/** @internal */\r\nexport const TLB_FOLLOW_INITIAL = 'initial';\r\n/** @internal */\r\nexport const TLB_FOLLOW_ALWAYS = 'always';\r\n/** @internal */\r\nexport const TLB_FOLLOW_SCROLL = 'scroll';\r\n/** @internal */\r\nexport type TypeFollow = 'default' | 'none' | typeof TLB_FOLLOW_INITIAL | typeof TLB_FOLLOW_ALWAYS | typeof TLB_FOLLOW_SCROLL;\r\n\r\n/**\r\n * Toolbar behavior settings like float, etc.\r\n * @internal\r\n */\r\nexport class ToolbarSettings {\r\n  /** Automatically add the '...' more button to the toolbar */\r\n  autoAddMore: TypeAutoAddMore = TLB_MORE_AUTO;\r\n\r\n  /**\r\n   * Hover placement of the toolbar\r\n   * Note: originally it was just left | right | default etc.\r\n   * In v15 we augmented this to allow right-middle, left-middle etc. for image toolbars\r\n   */\r\n  hover: TypeHoverH = TLB_HOV_RIGHT;\r\n\r\n  /** Show behavior (always, hover, ...) */\r\n  show: TypeShow = TLB_SHOW_HOVER;\r\n\r\n  /**\r\n   * Experimental - try to delay the show in certain cases where the toolbar is not typical\r\n   * Introduced in 16.04, not officially released\r\n   * Reason is that certain image toolbars should be felt to be different, as they affect non-private images\r\n   * @internal\r\n   */\r\n  delayShow: number = 0;\r\n\r\n  /** Follow behavior - if the toolbar should scroll with the page or remain where it was hovered */\r\n  follow: TypeFollow = followDefault;\r\n\r\n  /**\r\n   * Old term, keep for compatibility. Please use `.class` instead\r\n   * @deprecated\r\n   */\r\n  classes: string = '';\r\n\r\n  /**\r\n   * Term for the class for simplicity and consistency with button styling\r\n   * New 10.27\r\n   */\r\n  class: string = '';\r\n\r\n  /**\r\n   * color configuration which applies to all buttons\r\n   * use \"colorname\", \"#xxyyzz\" or \"color1,color2\" to specify the colors\r\n   * New in 10.27\r\n   */\r\n  color?: string = '';\r\n\r\n  /**\r\n   * modifiers for the buttons\r\n   * Should never be set from the page, but the toolbar initializer will set this\r\n   * New in 10.27\r\n   */\r\n  _rules?: RuleManager;\r\n\r\n  constructor(defaults: Partial<ToolbarSettings>) {\r\n\r\n    // Copy all properties of the defaults IF this object also has that property\r\n    if (defaults != null)\r\n      Object.keys(this).forEach(k => {\r\n        let kd = k as keyof typeof defaults;\r\n        if (defaults[kd]) (this as any)[k] = defaults[kd];\r\n      });\r\n\r\n    // Swap the real follow-default to be \"none\"\r\n    if (this.follow === followDefault) this.follow = 'none';\r\n  }\r\n\r\n\r\n  /**\r\n   * removes autoAddMore and classes if are null or empty, to keep same behaviour like in v1\r\n   *\r\n   * Note 2dm: not sure why we're doing this, but it seems like we only need this to merge\r\n   * various objects, so we probably want to make sure the in-html-toolbar doesn't accidentally\r\n   * contain null-items we don't want passed on\r\n   * @param toolbarSettings\r\n   */\r\n  static dropEmptyProperties(toolbarSettings: ToolbarSettings): Partial<ToolbarSettings> {\r\n    const partialSettings = {...toolbarSettings};\r\n    if (!partialSettings.autoAddMore) delete partialSettings.autoAddMore;\r\n    if (!partialSettings.classes) delete partialSettings.classes;\r\n    return partialSettings;\r\n  }\r\n\r\n  static getDefaults = () => new ToolbarSettings({ autoAddMore: TLB_MORE_AUTO, hover: TLB_HOV_RIGHT, show: TLB_SHOW_HOVER, follow: followDefault });\r\n\r\n  /** Setup for situations where an empty toolbar is needed, without any data or configuration */\r\n  static getForEmpty = () => new ToolbarSettings({ autoAddMore: TLB_MORE_AUTO, hover: TLB_HOV_LEFT, show: TLB_SHOW_HOVER, follow: followDefault });\r\n\r\n  static getForEmptyAsRule = () => `settings&autoAddMore=${TLB_MORE_AUTO}&hover=${TLB_HOV_LEFT}&show=${TLB_SHOW_HOVER}&follow=${followDefault}`;\r\n\r\n  /**\r\n   * figure out best code to determine where to put it.\r\n   * Important to neutralize historically different param names,\r\n   * and to auto-detect if hover is left.\r\n   * @param settings\r\n   * @returns\r\n   */\r\n  static bestAddMorePos(settings: ToolbarSettings) {\r\n    const result: TypeAutoAddMore = settings?.autoAddMore ?? TLB_MORE_AUTO;\r\n\r\n    // On Auto try to detect based on hover position\r\n    if (result === TLB_MORE_AUTO)\r\n      return settings?.hover?.startsWith(TLB_HOV_LEFT) /* === TLB_HOV_LEFT */ ? TLB_MORE_START : TLB_MORE_END;\r\n\r\n    // Standard values today, just return them\r\n    if (result === TLB_MORE_END || result === TLB_MORE_START || result === TLB_MORE_NEVER)\r\n      return result;\r\n\r\n    // Check old values which may still be in use\r\n    if (result as string === TLB_MORE_OLD_RIGHT || result as boolean === TLB_MORE_OLD_TRUE)\r\n      return TLB_MORE_END;\r\n\r\n    // If it's anything else we don't know, just return it. It could be a custom class name, though this is not supported.\r\n    return result;\r\n  }\r\n}\r\n\r\n","import { ToolbarWithWorkflow, ToolbarWorkflowManager, WorkflowStepCodeArguments } from '.';\r\n\r\nlet dummyWorkflowManager: ToolbarWorkflowManager;\r\nconst debug = false;\r\n\r\n/**\r\n * Various helpers to get a workflow or determine result state\r\n * @internal\r\n */\r\nexport class WorkflowHelper {\r\n\r\n    /**\r\n     * Find the command workflow on a toolbar (or return null).\r\n     * Will go upwards in the DOM to find the toolbar node which has the configuration stored\r\n     */\r\n    static getWorkflow(node: HTMLElement): ToolbarWorkflowManager {\r\n        if (!node) return WorkflowHelper.getDummyManager();\r\n\r\n        if (debug) console.log('try to find command workflow on ', node);\r\n        const maxParents = 100;\r\n        let parentCount = 0;\r\n        let current = node;\r\n        while (current && parentCount++ < maxParents) {\r\n            const cmdWf = (current as ToolbarWithWorkflow).commandWorkflow;\r\n            if (cmdWf) return cmdWf;\r\n            current = current.parentElement;\r\n        }\r\n        if (debug) console.log('not found, will return dummy');\r\n        return WorkflowHelper.getDummyManager();\r\n    }\r\n\r\n    /**\r\n     * Get a dummy workflow manager\r\n     *\r\n     * @returns the manager\r\n     * @internal\r\n     */\r\n    static getDummyManager(): ToolbarWorkflowManager {\r\n        if (!dummyWorkflowManager) dummyWorkflowManager = new ToolbarWorkflowManager(null, true);\r\n        return dummyWorkflowManager;\r\n    }\r\n\r\n    /**\r\n     * Determine if a workflow has been cancelled\r\n     *\r\n     * @returns is cancelled\r\n     * @internal\r\n     */\r\n    static isCancelled(currentArgs: WorkflowStepCodeArguments | boolean): boolean {\r\n        const cancel = this._isCancelled(currentArgs);\r\n        if (debug) console.log('is cancelled: ' + cancel, currentArgs);\r\n        return cancel;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns\r\n     * @internal\r\n     */\r\n    private static _isCancelled(currentArgs: WorkflowStepCodeArguments | boolean): boolean {\r\n        // promise forgot to return anything, no cancel\r\n        if (currentArgs == null) return false;\r\n\r\n        // promise returned simple false, cancel\r\n        if (currentArgs === false) return true;\r\n\r\n        // determine cancel based on either a boolean result or a real WorkflowArguments with cancel.\r\n        return (currentArgs as WorkflowStepCodeArguments).cancel === true;\r\n    }\r\n\r\n}\r\n","import { WorkflowPhases, WorkflowStep, WorkflowStepCodeArguments, WorkflowStepHelper } from '.';\r\nimport { WorkflowCommands } from '../commands';\r\nimport { ContextComplete } from '../context';\r\nimport { HasLog, Insights, Log } from '../core';\r\nimport { ToolbarWithWorkflow } from './toolbar-with-workflow';\r\nimport { WorkflowHelper } from './workflow-helper';\r\n\r\n/**\r\n * A workflow manager _of a Toolbar_ which will run stuff before / after commands.\r\n * When toolbars are created, they will add a Manager and then raise an event for in-page code to add workflow steps.\r\n * Normally the toolbar with raise a `toolbar-init` event where you can then add steps.\r\n * @public\r\n */\r\nexport class ToolbarWorkflowManager extends HasLog {\r\n\r\n  /**\r\n   * The workflow steps registered on this toolbar\r\n   * @internal\r\n   */\r\n  steps: WorkflowStep[] = [];\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  constructor(parentLog: Log, private isDummy = false) {\r\n    super('Cmd.Wrkflw', parentLog, 'constructor');\r\n  }\r\n\r\n  /**\r\n   * Register one or many [workflow-steps](xref:Api.Js.SxcJs.WorkflowStep) to the toolbar, to use if toolbar commands are executed.\r\n   */\r\n  // @publicApi(\"Used publicly on the Workflow-object in toolbar-init\")\r\n  add(steps: WorkflowStep | WorkflowStep[]) {\r\n    if (!steps) return;\r\n    if (Array.isArray(steps)) {\r\n      steps.forEach((s) => this.addOne(s));\r\n    } else\r\n      this.addOne(steps);\r\n  }\r\n\r\n  /**\r\n   * Add a single workflow step to this manager\r\n   * @internal\r\n   */\r\n  private addOne(step: WorkflowStep) {\r\n    step = WorkflowStepHelper.initDefaults(step);\r\n    const cl = this.log.call('add', `'${step.name}' for '${step.command}'-'${step.phase}'`);\r\n    if (!step) {\r\n      const errorMsg = \"Trying to add workflow step but didn't get anything\";\r\n      cl.add(errorMsg);\r\n      throw errorMsg;\r\n    }\r\n    this.steps.push(step);\r\n    cl.done();\r\n  }\r\n\r\n\r\n  /**\r\n   * Run a workflow.\r\n   * @internal\r\n   * @returns This will let you chain what happens. The arguments contain a status if it should be cancelled.\r\n   */\r\n  run(wfArgs: WorkflowStepCodeArguments): Promise<WorkflowStepCodeArguments> {\r\n    const cl = this.log.call('run', `'${wfArgs.command}' for '${wfArgs.phase}'`);\r\n\r\n    // if this is just a temporary / dummy workflow manager, just return a success-promise\r\n    if (this.isDummy) {\r\n      cl.done('Dummy workflow, nothing to run, will return a resolved promise');\r\n      return emptyWorkflow(wfArgs);\r\n    }\r\n\r\n    // Find all steps to run\r\n    const stepsForCommand = this.steps\r\n      // only those of this command or all\r\n      .filter((s) => s.command === wfArgs.command || s.command === WorkflowCommands.all)\r\n      .filter((s) => s.phase === wfArgs.phase || s.phase === WorkflowPhases.all)\r\n      // only those having real code\r\n      .filter((s) => s.code)\r\n      .sort((s) => s.priority);\r\n\r\n    if (stepsForCommand.length === 0) {\r\n      cl.done('no steps found for this command / phase, will return a resolved promise');\r\n      return emptyWorkflow(wfArgs);\r\n    }\r\n\r\n    // run in sequence but cancel at any time if necessary\r\n    const promise = new Promise<WorkflowStepCodeArguments>((resolve, reject) => {\r\n      let promiseChain = Promise.resolve(wfArgs);\r\n      // let previousArgs = wfArgs;\r\n      // let interruptChain = false;\r\n      for (let stepCount = 0; stepCount < stepsForCommand.length; stepCount++) {\r\n        const nextStep = stepsForCommand[stepCount];\r\n        promiseChain = promiseChain.then((resultingArgs) => {\r\n          return this.runNextPromiseIfNotCancelled(resultingArgs, wfArgs, nextStep.code);\r\n        });\r\n      }\r\n\r\n      promiseChain.then((finalArgs) => { resolve(finalArgs); });\r\n      promiseChain.catch(reject);\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Attach a workflow to a toolbar.\r\n   * Will be used at start to hook this manager to the toolbar.\r\n   * Then the init-event will be called to allow adding steps.\r\n   * @internal\r\n   */\r\n  attach(node: HTMLElement, context: ContextComplete) {\r\n    const cl = this.log.call('attach');\r\n    if (!node) return;\r\n    (node as ToolbarWithWorkflow).commandWorkflow = this;\r\n    Insights.add('workflow', context.toolbar?.identifier, this.log);\r\n    cl.done();\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @internal\r\n   */\r\n  private runNextPromiseIfNotCancelled(currentArgs: WorkflowStepCodeArguments | boolean, prevArgs: WorkflowStepCodeArguments, nextFactory: WorkflowStep['code']) {\r\n    // determine cancel based on either a boolean result or a real WorkflowArguments with cancel.\r\n    const cancel = WorkflowHelper.isCancelled(currentArgs);\r\n    // make sure we have real arguments no matter what came in - assuming we have prevArgs\r\n    currentArgs = (currentArgs && typeof(currentArgs) !== 'boolean') ? currentArgs : { ...prevArgs };\r\n    // in case the cancel came as boolean, we must now set it on the currentArgs\r\n    currentArgs.cancel = cancel;\r\n    return cancel ? emptyWorkflow(currentArgs) : nextFactory(currentArgs);\r\n  }\r\n\r\n}\r\n\r\nfunction emptyWorkflow(wfArgs: WorkflowStepCodeArguments) {\r\n  return Promise.resolve<WorkflowStepCodeArguments>(wfArgs);\r\n}\r\n","import { WorkflowPhases } from '.';\r\nimport { ContextComplete } from '../context';\r\n\r\n\r\n/**\r\n * Arguments for [WorkflowStepCode](xref:Api.Js.SxcJs.WorkflowStepCode).\r\n * Will be passed to your code and should also be returned by your code.\r\n * This also allows cancelling further execution.\r\n * @public\r\n */\r\nexport class WorkflowStepCodeArguments {\r\n  /**\r\n   * @internal\r\n   */\r\n  constructor(\r\n    /**\r\n     * Name this workflow is running for\r\n     */\r\n    public command: string,\r\n\r\n    /**\r\n     * The phase it's in (before, after, etc.)\r\n     */\r\n    public phase: WorkflowPhases,\r\n\r\n    /**\r\n     * Context of the current command / step being run\r\n     */\r\n    public context: ContextComplete,\r\n\r\n    /**\r\n     * Result in after-phases of the workflow\r\n     * BETA - never really tested this\r\n     */\r\n    public result: unknown = null,\r\n    ) {\r\n  }\r\n\r\n  /**\r\n   * If the workflow should be cancelled.\r\n   * Can be set by any workflow step.\r\n   * If set to true, following steps / workflows will not run.\r\n   */\r\n  cancel: boolean = false;\r\n}\r\n","/**\r\n * Phases / events of a specific workflow.\r\n */\r\nexport enum WorkflowPhases {\r\n  /**\r\n   * Run at every phase - before and after events/commands\r\n   */\r\n  all = 'all',\r\n\r\n  /**\r\n   * Run before a specific event / command\r\n   */\r\n  before = 'before',\r\n\r\n  /**\r\n   * Run after a specific event / command\r\n   */\r\n  after = 'after',\r\n}\r\n","import { WorkflowPhases, WorkflowStep } from '.';\r\nimport { WorkflowCommands } from '../commands';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class WorkflowStepHelper {\r\n  static initDefaults(step: WorkflowStep) {\r\n    step.name = step.name ?? '';\r\n    step.command = step.command ?? WorkflowCommands.all;\r\n    step.phase = step.phase ?? WorkflowPhases.before;\r\n    step.priority = step.priority ?? 1;\r\n    if (!step.code || typeof(step.code) !== 'function')\r\n      throw \"Tried preparing a workflow step, but the promise either doesn't exist or is not a promise factory\";\r\n    return step;\r\n  }\r\n}\r\n","import { ToolbarEventArguments } from '.';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context';\r\nimport { ToolbarWorkflowManager } from '../workflow';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ToolbarLifecycle {\r\n\r\n    /**\r\n     * This will be triggered when a hover toolbar has been built,\r\n     * so that on-page JS can register workflows for this toolbar.\r\n     * @static\r\n     * @param {HTMLElement} toolbarElement The toolbar HTML DOM passed into the event\r\n     * @param {HTMLElement} anchoredElement The DOM element which had the @Edit.TagToolbar(...) - on which the event will be raised\r\n     * @param {ContextComplete} context The toolbar context\r\n     */\r\n    static raiseToolbarInitEvent(toolbarElement: HTMLElement, anchoredElement: HTMLElement, context: ContextComplete) {\r\n        const commandWorkflow = new ToolbarWorkflowManager(null);\r\n        commandWorkflow.attach(toolbarElement, context);\r\n\r\n        const event = new CustomEvent(C.Toolbar.eventNames.onInit, {\r\n            bubbles: true,  // Important so it can be handled by a parent tag\r\n            detail: {\r\n                // type: ToolbarTypes.tag,\r\n                element: toolbarElement,\r\n                identifier: context.toolbar?.identifier,\r\n                workflow: commandWorkflow,\r\n            } as ToolbarEventArguments,\r\n        });\r\n        anchoredElement?.dispatchEvent(event);\r\n    }\r\n}\r\n","import { TagToolbarManager, ToolbarRenderer } from '..';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { Translator } from '../../i18n';\r\nimport { NoJQ } from '../../plumbing';\r\nimport { TLB_FOLLOW_ALWAYS, TLB_FOLLOW_INITIAL, TLB_FOLLOW_SCROLL, TLB_SHOW_ALWAYS, TypeFollow, TLB_HOV_RIGHT, TLB_HOV_MID, TlbHoverPrefix } from '../config/toolbar-settings';\r\nimport { ToolbarLifecycle } from '../toolbar-lifecycle';\r\n\r\nconst logThis = false;\r\n\r\nconst TagToolbarPadding = 4;\r\nconst TagToolbarPaddingRight = 0;\r\nconst ToolbarHeight = 20;\r\n\r\n/**\r\n * This is the modern toolbar which is attached to a tag from which it hovers.\r\n * Internally the toolbar Dom-Elements are hidden at the bottom of the page.\r\n * This object is responsible for creating them,\r\n * and making sure that hover-events etc. cause the right toolbar to show up.\r\n * @internal\r\n */\r\nexport class TagToolbar {\r\n  private toolbarElement = null as HTMLElement;\r\n  private initialized = false;\r\n  private follow: TypeFollow;\r\n  private alwaysShow = false;\r\n  private delayShow = 0;\r\n\r\n  /**\r\n   * A Tag-Toolbar which is outside of the module DOM and floating freely\r\n   * @param {HTMLElement} hoverTag\r\n   * @param {ContextComplete} context\r\n   * @param {typeof Translator} [translator] special translator, only included because otherwise WebPack causes circular references\r\n   */\r\n  constructor(private readonly hoverTag: HTMLElement, private readonly context: ContextComplete, private translator?: typeof Translator) {\r\n    const settings = context.toolbar.settings;\r\n    this.follow = settings.follow;\r\n    this.alwaysShow = settings.show === TLB_SHOW_ALWAYS;\r\n    this.delayShow = settings.delayShow ?? 0;\r\n\r\n    // Ensure toolbar gets visible when hovering\r\n    this.addMouseEvents(hoverTag);\r\n    if (this.alwaysShow) this.showPermanently();\r\n  }\r\n\r\n  /**\r\n   * Attach Mouse-Enter and Mouse-Leave events to ensure show/hide of the toolbar\r\n   */\r\n  private addMouseEvents(hoverTag: HTMLElement) {\r\n    hoverTag.addEventListener('mouseenter', () => {\r\n      if (this.delayShow == 0) this.show();\r\n      else this.delayShowTimeout = setTimeout(() => { this.show();}, this.delayShow);\r\n    });\r\n    if (!this.alwaysShow)\r\n      hoverTag.addEventListener('mouseleave', (e) => {\r\n        // new 16.04\r\n        if (this.delayShowTimeout) clearTimeout(this.delayShowTimeout);\r\n\r\n        // note: not sure why this is here, but it's probably needed\r\n        this.initializeIfNecessary();\r\n        // if we hover the menu itself now, don't hide it\r\n        const relatedTarget = e.relatedTarget as HTMLElement;\r\n        if (!this.toolbarElement.contains(relatedTarget) && this.toolbarElement !== relatedTarget)\r\n          this.hide();\r\n      });\r\n  }\r\n  private delayShowTimeout: ReturnType<typeof setTimeout> = null;\r\n\r\n  private initializeIfNecessary() {\r\n    if (this.initialized) return;\r\n\r\n    const nextFreeId = TagToolbarManager.getNextToolbarId();\r\n    const toolbarId = `${this.context.instance.id}-${this.context.contentBlockReference.id}-${nextFreeId}`;\r\n\r\n    // render toolbar and append tag to body\r\n    this.toolbarElement = new ToolbarRenderer(this.context).generate();\r\n\r\n    // 2021-11-15 2dm disabled this, seems like a duplicate to the attach-mouse-enter which always runs\r\n    if (!this.alwaysShow)\r\n      this.toolbarElement.addEventListener('mouseleave', (e) => {\r\n        // if we do not hover the tag now, hide it\r\n        const relatedTarget = e.relatedTarget as HTMLElement;\r\n        if (!this.hoverTag.contains(relatedTarget) && this.hoverTag !== relatedTarget)\r\n          this.hide();\r\n      });\r\n\r\n    document.body.append(this.toolbarElement);\r\n\r\n    this.toolbarElement.setAttribute(TagToolbarManager.TagToolbarForAttr, toolbarId);\r\n    this.hoverTag.setAttribute(TagToolbarManager.TagToolbarAttr, toolbarId);\r\n\r\n    const toolbarStyle = this.toolbarElement.style;\r\n    toolbarStyle.position = 'absolute';\r\n    // Do the following things on toolbars which are invisible (show != always)\r\n    if (!this.alwaysShow) {\r\n      toolbarStyle.display = 'none';\r\n      toolbarStyle.transition = 'top 0.5s ease-out';\r\n    }\r\n\r\n    // ensure it's translated\r\n    this.translator?.autoTranslateMenus();\r\n    this.initialized = true;\r\n\r\n    // new in v11.12 - toolbar Workflow\r\n    ToolbarLifecycle.raiseToolbarInitEvent(this.toolbarElement, this.hoverTag, this.context);\r\n  }\r\n\r\n  private updatePosition(initial: boolean) {\r\n    const position = {\r\n      top: 'auto' as 'auto' | number,\r\n      left: 'auto' as 'auto' | number,\r\n      right: 'auto' as 'auto' | number,\r\n      viewportOffset: this.hoverTag.getBoundingClientRect().top,\r\n      bodyOffset: TagToolbarManager.getBodyScrollOffset(),\r\n      tagScrollOffset: 0,\r\n      tagOffset: NoJQ.offset(this.hoverTag),\r\n      tagWidth: this.hoverTag.offsetWidth,\r\n      tagHeight: this.hoverTag.offsetHeight,\r\n      mousePos: TagToolbarManager.mousePosition,\r\n      win: {\r\n        scrollY: window.scrollY,\r\n        width: document.documentElement.clientWidth,\r\n      },\r\n      padding: TagToolbarPadding,\r\n      // tag: this.hoverTag, // just for debugging\r\n    };\r\n\r\n    if (logThis)\r\n      console.log('updatePosition', {\r\n      initial: initial,\r\n      hoverTag: this.hoverTag,\r\n      mousePosition: TagToolbarManager.mousePosition,\r\n      toolbarElementBoundingRect: this.toolbarElement.getBoundingClientRect(),\r\n      position: position,\r\n    });\r\n\r\n    // If we scrolled down, the toolbar might not be visible - calculate offset\r\n    position.tagScrollOffset = Math.min(position.viewportOffset - position.bodyOffset.top, 0);\r\n\r\n    // Update top coordinates\r\n    // new: only do this on initial=true && follow != 'none' or not-initial\r\n    // start by setting default-top\r\n    position.top = position.tagOffset.top + TagToolbarPadding - position.bodyOffset.top;\r\n    const trackMouse = (this.follow === TLB_FOLLOW_ALWAYS)\r\n      || (this.follow === TLB_FOLLOW_INITIAL && initial)\r\n      || (this.follow === TLB_FOLLOW_SCROLL && position.tagScrollOffset !== 0);\r\n\r\n    const tagClasses = this.toolbarElement.classList;\r\n    if (trackMouse)\r\n      position.top = position.mousePos.y + position.win.scrollY - position.bodyOffset.top - (ToolbarHeight / 2);\r\n    else\r\n      if (tagClasses.contains(TlbHoverPrefix + TLB_HOV_MID))\r\n        position.top = position.top + (position.tagHeight / 2) - ToolbarHeight;\r\n\r\n    // Update left / right coordinates\r\n    if (tagClasses.contains(TlbHoverPrefix + TLB_HOV_RIGHT))\r\n      position.right = position.win.width - position.tagOffset.left - position.tagWidth + TagToolbarPaddingRight - position.bodyOffset.left;\r\n    else\r\n      position.left = position.tagOffset.left + TagToolbarPadding + position.bodyOffset.left;\r\n\r\n\r\n\r\n    const tlbStyle = this.toolbarElement.style;\r\n    tlbStyle.top = typeof position.top === 'number' ? `${position.top}px` : position.top;\r\n    tlbStyle.left = typeof position.left === 'number' ? `${position.left}px` : position.left;\r\n    tlbStyle.right = typeof position.right === 'number' ? `${position.right}px` : position.right;\r\n  }\r\n\r\n\r\n  /**\r\n   * Hide the toolbar and detach scrolling-watcher\r\n   */\r\n  private hide() {\r\n    if (this.alwaysShow) return;\r\n    this.toolbarElement.style.display = 'none';\r\n    this.disableScrollWatcher();\r\n  }\r\n\r\n\r\n  /**\r\n   * Show the toolbar\r\n   */\r\n  private show() {\r\n    // console.log('show');\r\n    this.initializeIfNecessary();\r\n    this.toolbarElement.style.display = 'inline-flex';\r\n    this.updatePosition(true);\r\n    this.activateScrollWatcher();\r\n  }\r\n\r\n  /**\r\n   * Always show the toolbar.\r\n   */\r\n  private showPermanently() {\r\n    // console.log('show permanently');\r\n    this.show();\r\n    // after a moment, adjust position because often initial position is a bit off\r\n    window.addEventListener('load', this.updateFn);\r\n    document.addEventListener('readystatechange', this.updateFn);\r\n    // Also watch resizing, as the position would be wrong otherwise\r\n    window.addEventListener('resize', this.updateFn);\r\n  }\r\n\r\n  /** Remember if scrollwatcher has been enabled */\r\n  private watcherActive = false;\r\n  /** The update function as a prebuild function, so it can be reused in on/off */\r\n  private updateFn = () => this.updatePosition(false);\r\n  /** Enable scroll watcher & remember */\r\n  private activateScrollWatcher() {\r\n    if (this.watcherActive) return;\r\n    const trackOngoing = this.follow === TLB_FOLLOW_SCROLL || this.follow === TLB_FOLLOW_ALWAYS;\r\n    if (!trackOngoing) return;\r\n    window.addEventListener('scroll', this.updateFn);\r\n    if (this.follow === TLB_FOLLOW_ALWAYS) window.addEventListener('mousemove', this.updateFn);\r\n    this.watcherActive = true;\r\n  }\r\n\r\n  /** Disable scroll watcher - if it is active */\r\n  private disableScrollWatcher() {\r\n    if (!this.watcherActive) return;\r\n    window.removeEventListener('scroll', this.updateFn);\r\n    window.removeEventListener('mousemove', this.updateFn);\r\n    this.watcherActive = false;\r\n  }\r\n}\r\n\r\n","import { NoJQ } from '../../plumbing';\r\n\r\n/**\r\n * The global Tag Toolbar Manager is responsible for the new TagToolbars\r\n * These have certain shared aspects, like:\r\n * - a numbering scheme to keep them apart\r\n * - a mouse tracker to keep track of the position as the toolbar follows the scroll\r\n * @internal\r\n */\r\nexport class TagToolbarManager {\r\n    /** Mark Dom-Notes with the ID which Tag-Toolbar they want on mouse-over */\r\n    static TagToolbarAttr = 'data-tagtoolbar';\r\n\r\n    /** Mark TagToolbar Html-Nodes with the ID of the Dom-Tag they belong to */\r\n    static TagToolbarForAttr = 'data-tagtoolbar-for';\r\n\r\n    /** The current mouseposition, always updated when the mouse changes */\r\n    static mousePosition = {\r\n        x: 0,\r\n        y: 0,\r\n    };\r\n\r\n    /** The next free ID to mark a TagToolbar */\r\n    static getNextToolbarId() {\r\n        return TagToolbarManager.lastMenuId++;\r\n    }\r\n    private static lastMenuId = 0;\r\n\r\n    /**\r\n     * Returns the body offset if positioning is relative or absolute\r\n     */\r\n    static getBodyScrollOffset() {\r\n        const posNoJq = document.body.style.position;\r\n        const body = document.body;\r\n        const bodyPos = posNoJq; // body.css('position');\r\n        if (bodyPos === 'relative' || bodyPos === 'absolute') {\r\n            const offset = NoJQ.offset(body);\r\n            return {\r\n                top: offset.top,\r\n                left: offset.left,\r\n            };\r\n        }\r\n        return {\r\n            top: 0,\r\n            left: 0,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Remove orphan tag-toolbars from DOM\r\n     * This can be necessary if the module was replaced by ajax,\r\n     * leaving behind un-attached TagToolbars.\r\n     */\r\n    static cleanupOrphanedToolbars() {\r\n        const tagToolbars = document.querySelectorAll<HTMLElement>(`[${TagToolbarManager.TagToolbarForAttr}]`);\r\n        tagToolbars.forEach((e) => {\r\n            const id = e.getAttribute(TagToolbarManager.TagToolbarForAttr);\r\n            if (!document.querySelectorAll<HTMLElement>(`[${TagToolbarManager.TagToolbarAttr}=\"${id}\"]`).length) {\r\n                e.remove();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * Keep the mouse-position update for future use\r\n */\r\nwindow.addEventListener('mousemove', (e) => {\r\n    TagToolbarManager.mousePosition.x = e.clientX;\r\n    TagToolbarManager.mousePosition.y = e.clientY;\r\n});\r\n","import { CommandParams } from '../../../$2sxc/src/cms/command-params';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class CmdParHlp {\r\n  static getIndex(params: CommandParams | ContextComplete) {\r\n    const realParams = (ContextComplete.is(params)) ? params.button.command.params : params;\r\n    return realParams.index ?? realParams.sortOrder;\r\n  }\r\n}\r\n","import { Command, CommandNames, CommandParams, Commands } from '../../commands';\r\nimport { TypeValue } from '../../plumbing';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ButtonCommand {\r\n    readonly command: Command; // reference to action to be run\r\n\r\n    // customCode: string;\r\n\r\n    constructor(public name: CommandNames, /* contentType?: string, */ public params?: CommandParams) {\r\n        if (!params)\r\n          this.params = {};\r\n        // 2dm 2022-07-05 #badContentTypeExtractAndRefill - we seem to extract it, just to put it back on the ButtonCommand\r\n        // if (contentType) this.params.contentType = contentType;\r\n        this.command = Commands.singleton().get(name); // activate command for this\r\n    }\r\n\r\n    /** make static, as many ButtonCommand signatures are actually not objects */\r\n    static mergeAdditionalParams(command: ButtonCommand, additionalParams: Record<string, TypeValue>): CommandParams {\r\n        let params: CommandParams = {};\r\n        if (command) {\r\n            if (command.name)\r\n              params.action = command.name;\r\n            if (command.params)\r\n              params = {...params, ...command.params, ...additionalParams};\r\n        }\r\n        command.params = params;\r\n        return params;\r\n    }\r\n}\r\n","import { ButtonCommand } from '.';\r\nimport { ItemUrlParameters } from '../../../../$2sxc/src/cms/item-identifiers';\r\nimport { CommandNames, CommandParams } from '../../commands';\r\nimport { CommandCode } from '../../commands/command-code';\r\nimport { CommandLinkGenerator } from '../../commands/command-link-generator';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { Obj } from '../../plumbing';\r\nimport { Note } from './Note';\r\n\r\n/**\r\n * This is the most common call signature on most ButtonConfig properties\r\n * @public\r\n */\r\nexport type ButtonPropGen<T> = (context: ContextComplete) => T;\r\n\r\ntype ButtonGenOrProp<T> = ButtonPropGen<T> | T;\r\n\r\n\r\n/**\r\n * The real button configuration as it's used at runtime\r\n * @internal\r\n */\r\nexport class Button {\r\n  /** The ID is important for tracking this button and applying modifiers */\r\n  id: string;\r\n\r\n  /** The underlying command which will be run */\r\n  command: ButtonCommand;\r\n\r\n  /** classes which will be applied to this button */\r\n  classes: string = '';\r\n\r\n  constructor(command: ButtonCommand, name: string) {\r\n    this.command = command;\r\n    // if the name is an identifier, split it\r\n    const parts = Button.splitName(name);\r\n    this.id = parts.id;\r\n    // this.name = parts.name;\r\n    // get defaults from action commandDefinition\r\n    if (command?.command?.buttonDefaults)\r\n      Obj.TypeSafeAssign(this, command.command.buttonDefaults);\r\n  }\r\n\r\n  static splitName(identifier: string): { id: string, name: CommandNames } {\r\n    const parts = identifier.split('=');\r\n    return { id: parts[0], name: (parts[1] || identifier) as CommandNames};\r\n  }\r\n\r\n  /** Configure the link generator before it creates the link */\r\n  configureLinkGenerator: (context: ContextComplete, linkGenerator: CommandLinkGenerator) => void;\r\n\r\n  tweakGeneratedUrlParameters?: (context: ContextComplete, itemUrlParameters: ItemUrlParameters) => ItemUrlParameters;\r\n\r\n  /** The dialog name */\r\n  dialog?: ButtonGenOrProp<string>;\r\n\r\n  /** Check if full-screen, always a function */\r\n  fullScreen?: ButtonPropGen<boolean>;\r\n\r\n  /** Determines if the button should be disabled */\r\n  disabled?: ButtonGenOrProp<boolean>;\r\n\r\n  /** Dynamically determine classes - must always be a function */\r\n  dynamicClasses: ButtonPropGen<string>;\r\n\r\n  /** The icon to show in the button */\r\n  icon?: ButtonGenOrProp<string>;\r\n\r\n  /** Determine if it should use the inline window, always a function */\r\n  inlineWindow?: ButtonPropGen<boolean> = () => false;\r\n\r\n  /** Check if we should open a new window, always an FN */\r\n  newWindow?: ButtonPropGen<boolean>;\r\n\r\n  /** Method which determines if it should be shown or not */\r\n  showCondition?: ButtonPropGen<boolean>;\r\n\r\n  /** The title of this button which will usually be i18n keys */\r\n  title?: ButtonPropGen<string>;\r\n\r\n  /** Determines if this button runs in the page - affecting publishing */\r\n  partOfPage?: ButtonPropGen<boolean>;\r\n\r\n  /** The code to run for this button - if empty, will default to open a dialog */\r\n  code?: CommandCode;\r\n\r\n  /**\r\n   * The color which could be supplied per button - new for `info`\r\n   * New v15.04\r\n   */\r\n  color: ButtonPropGen<string | undefined>;\r\n\r\n  /**\r\n   * The tippy which could be supplied per button - new for `info`\r\n   * v15.04\r\n   */\r\n  tippy: (context: ContextComplete, tag: HTMLElement) => void;\r\n\r\n  /**\r\n   * Additional parameters which are used to RUN the command.\r\n   * So it's not used when preparing a toolbar button, but only when executing\r\n   *\r\n   * Important: used to be called 'addParamsToLink' up to v18.03, but I assume was never public\r\n   */\r\n  parameters?: ButtonPropGen<CommandParams>;\r\n\r\n  /** this is just a UI interaction, won't create data so won't need pre-flight */\r\n  uiActionOnly: ButtonPropGen<boolean>;\r\n\r\n  /**\r\n   * Ability to specify notes which will be shown in the toolbar\r\n   * @internal\r\n   */\r\n  notes?: ButtonPropGen<Note[]>;\r\n\r\n  /**\r\n   * Specify that this button should not include items in the command\r\n   * New 18.03\r\n   * @internal\r\n   */\r\n  noItems?: ButtonGenOrProp<boolean>;\r\n\r\n  /** Detect if this is a Button */\r\n  static is(thing: unknown): thing is Button {\r\n    return (thing as Button).command !== undefined;\r\n  }\r\n\r\n  static isArray(thing: unknown): thing is Button[] {\r\n    return (thing as Button[]).length && Button.is((thing as Button[])[0]);\r\n  }\r\n\r\n  static isPropGen<T>(thing: ButtonGenOrProp<T>): thing is ButtonPropGen<T> {\r\n    return typeof thing === 'function';\r\n  }\r\n}\r\n\r\n","import { Button, ButtonPropGen } from '.';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\n\r\n/**\r\n * Special helper to read a button configuration\r\n * and make sure that all properties have the correct fallback values\r\n * @internal\r\n */\r\nexport class ButtonSafe {\r\n\r\n  constructor(private button: Button, private context: ContextComplete) { }\r\n\r\n  action = () => this.button.command;\r\n\r\n  classes = () => this.button.classes || '';\r\n\r\n  /**\r\n   * New v15.04 for `info`\r\n   * @returns the color of the button, or undefined if not set\r\n   */\r\n  color = () => getVal(this.button.color, this.context, undefined);\r\n\r\n  /** The dialog name - should default to the name */\r\n  dialog = () => getVal(this.button.dialog, this.context, this.button.command.name);\r\n\r\n  /** Determines if the button should be disabled */\r\n  disabled = () => getVal(this.button.disabled, this.context, false);\r\n\r\n  /** Dynamically determine classes - must always be a function */\r\n  dynamicClasses = () => getVal(this.button.dynamicClasses, this.context, '');\r\n\r\n  /** Check if full-screen, always a function */\r\n  fullScreen = () => getVal(this.button.fullScreen, this.context, false);\r\n\r\n  /** The icon to show in the button */\r\n  icon = () => getVal(this.button.icon, this.context, '');\r\n\r\n  /** Determine if it should use the inline window, always a function */\r\n  inlineWindow = () => getVal(this.button.inlineWindow, this.context, false);\r\n\r\n  /** Check if we should open a new window, always an FN */\r\n  newWindow = () => getVal(this.button.newWindow, this.context, false);\r\n\r\n  /** The parameters which are used to run the command */\r\n  parameters = () => getVal(this.button.parameters, this.context, {});\r\n\r\n  /** Determines if this button runs in the page - affecting publishing */\r\n  partOfPage = () => getVal(this.button.partOfPage, this.context, false);\r\n\r\n  /** Method which determines if it should be shown or not */\r\n  showCondition = () => getVal(this.button.showCondition, this.context, true);\r\n\r\n  tippy = (context: ContextComplete, tag: HTMLElement) => this.button.tippy?.(context, tag);\r\n\r\n  /** The title of this button which will usually be i18n keys */\r\n  title = () => getVal(this.button.title, this.context, 'unknown-title');\r\n\r\n  /** this is just a UI interaction, won't create data so won't need pre-flight */\r\n  uiActionOnly = () => getVal(this.button.uiActionOnly, this.context, true);\r\n\r\n  /** Don't add items-info to the link, new v18.03 */\r\n  noItems = () => getVal(this.button.noItems, this.context, false);\r\n}\r\n\r\n\r\n/** Evaluate a property or generator and return the property */\r\nfunction getVal<T>(propOrGen: ButtonPropGen<T> | T, ctx: ContextComplete, fallback: T): T {\r\n  if (propOrGen == null)\r\n    return fallback;\r\n  const result = Button.isPropGen(propOrGen)\r\n    ? propOrGen(ctx)\r\n    : propOrGen;\r\n  return result === undefined ? fallback : result;\r\n}\r\n","import { ButtonGroup, ToolbarSettings } from '.';\r\nimport { TypeValue } from '../../plumbing';\r\n\r\n/**\r\n * Runtime configuration of the toolbar.\r\n * contains a toolbar config + settings + mny groups\r\n * @internal\r\n */\r\nexport class Toolbar {\r\n    /** Toolbar ID to better identify which toolbar we're looking at - has special long name to never confuse with other IDs */\r\n    identifier: string;\r\n\r\n    /** The groups of buttons in this toolbar */\r\n    groups: ButtonGroup[] = [];\r\n\r\n    /** Setttings like floating of toolbar, etc. */\r\n    settings: ToolbarSettings;\r\n\r\n    /** Params for the commands, like EntityId, Content - Type - Name */\r\n    params: Record<string, TypeValue>;\r\n\r\n    /** show more debug info */\r\n    debug?: boolean = false;\r\n\r\n    /**  the button defaults like icon, etc. */\r\n    defaults: Record<string, TypeValue>;\r\n\r\n    constructor() {\r\n        this.identifier = Toolbar.createIdentifier();\r\n    }\r\n\r\n    static createIdentifier() {\r\n        return 'Toolbar' + Math.floor(Math.random() * 99999);\r\n    }\r\n}\r\n","import { HasLog } from '../../core';\r\nimport { ToolbarRenderer } from './toolbar-renderer';\r\n\r\n/**\r\n * Base class for inner part renderers.\r\n * The goal is that we have the code in own objects, but that these can only be used\r\n * from the primary parent object of the type ToolbarRenderer\r\n *\r\n * @internal\r\n */\r\nexport class RenderPart extends HasLog {\r\n    constructor(protected parent: ToolbarRenderer, logName: string) {\r\n        super(logName, parent.log);\r\n    }\r\n\r\n}\r\n","import { CommandNames, CommandParams } from '../../commands';\r\nimport { Debug } from '../../constants/debug';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { HtmlTools } from '../../html/dom-tools';\r\nimport { ButtonCommand, ButtonSafe } from '../config';\r\nimport { BuildRule } from '../rules/rule';\r\nimport { RenderPart } from './render-part-base';\r\nimport { ToolbarRenderer } from './toolbar-renderer';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class RenderButton extends RenderPart {\r\n  constructor(parent: ToolbarRenderer) {\r\n    super(parent, \"Rnd.Button\");\r\n  }\r\n\r\n  render(ctx: ContextComplete, groupIndex: number): HTMLElement {\r\n    const cl = this.log.call(\r\n      \"render\",\r\n      `context: obj, group: ${groupIndex}, btn: ${ctx.button.id}/${ctx.button.command?.name}`\r\n    );\r\n    const btnSafe = new ButtonSafe(ctx.button, ctx);\r\n\r\n    // check if we have rules and merge params into the button\r\n    const rule = ContextComplete.getRule(ctx);\r\n    if (rule) cl.data(\"rule found, will try to merge params\", rule);\r\n    let params = ButtonCommand.mergeAdditionalParams(\r\n      btnSafe.action(),\r\n      rule?.params\r\n    );\r\n\r\n    if (rule?.settings)\r\n      params = { ...params, settings: rule.settings };\r\n\r\n    const group = ctx.toolbar?.groups?.[groupIndex];\r\n    const groupName = group?.name;\r\n\r\n    const btnLink = document.createElement(\"a\");\r\n\r\n    const disabled = btnSafe.disabled();\r\n\r\n    // put call as plain JavaScript to preserve even if DOM is serialized\r\n    if (!disabled) {\r\n      const runJs = this.generateRunJs(rule, ctx, params);\r\n      btnLink.setAttribute(\"onclick\", runJs);\r\n    }\r\n\r\n    // Add various classes\r\n    const classes =\r\n      (disabled ? \" disabled\" : \"\") +\r\n      (btnSafe.action() ? ` sc-${btnSafe.action().name}` : \"\") +\r\n      ` in-group-${groupIndex}` +\r\n      (groupName ? ` in-group-${groupName}` : \"\") +\r\n      \" \" +\r\n      (rule?.ui.class ?? \"\") +\r\n      \" \" +\r\n      (rule?.ui.classes ?? \"\") +\r\n      \" \" +\r\n      btnSafe.classes() +\r\n      \" \" +\r\n      btnSafe.dynamicClasses();\r\n    cl.add(\"classes: \" + classes);\r\n    HtmlTools.addClasses(btnLink, classes);\r\n\r\n    // set title for button, optionally with i18n\r\n    this.setTitle(rule, btnLink, btnSafe);\r\n\r\n    const divTag = document.createElement(\"div\");\r\n    divTag.appendChild(this.iconTag(btnSafe, rule));\r\n    btnLink.appendChild(divTag);\r\n\r\n    // set color - new in 10.27\r\n    this.processColorRules(btnSafe, rule, ctx, divTag);\r\n\r\n    // add tippy new 15.04\r\n    btnSafe.tippy(ctx, btnLink);\r\n\r\n    return cl.return(btnLink);\r\n  }\r\n\r\n  private setTitle(\r\n    rule: BuildRule,\r\n    btnLink: HTMLAnchorElement,\r\n    btn: ButtonSafe\r\n  ) {\r\n    const callLog = this.log.call(\"setTitles\");\r\n    const uiTitle = rule?.ui?.title;\r\n    if (uiTitle) {\r\n      if (uiTitle.indexOf(\"i18n:\") === 0) {\r\n        const i18nTitle = uiTitle.substring(5);\r\n        callLog.add(`i18nTitle: ${i18nTitle}`);\r\n        btnLink.setAttribute(\"data-i18n\", `[title]${i18nTitle}`);\r\n      } else {\r\n        callLog.add(`uiTitle: ${uiTitle}`);\r\n        btnLink.setAttribute(\"title\", uiTitle);\r\n      }\r\n    } else {\r\n      const i18nTitle = btn.title();\r\n      callLog.add(`i18nTitle: ${i18nTitle}`);\r\n      if (i18nTitle) btnLink.setAttribute(\"data-i18n\", `[title]${i18nTitle}`);\r\n    }\r\n    callLog.done();\r\n  }\r\n\r\n  private processColorRules(\r\n    btn: ButtonSafe,\r\n    rule: BuildRule,\r\n    ctx: ContextComplete,\r\n    divTag: HTMLDivElement\r\n  ) {\r\n    const callLog = this.log.call(\"processColorRules\");\r\n    let color = rule?.ui?.color ?? btn.color() ?? ctx.toolbar.settings.color;\r\n\r\n    // catch edge case where the color is something like 808080 - which is treated as a number\r\n    if (color && typeof color === \"number\")\r\n      color = (color as number).toString();\r\n    if (color && typeof color === \"string\") {\r\n      const parts = color.split(\",\");\r\n      if (parts[0])\r\n        divTag.style.background = correctColorCodes(parts[0]);\r\n      if (parts[1])\r\n        divTag.style.color = correctColorCodes(parts[1]);\r\n    }\r\n\r\n    return callLog.done(color ?? \"no color\");\r\n  }\r\n\r\n  private generateRunJs(\r\n    rule: BuildRule,\r\n    ctx: ContextComplete,\r\n    params: CommandParams\r\n  ) {\r\n    // 2022-05-18 2dm: #CustomContext New we can override the context\r\n    let modifyContext = rule?.context;\r\n    modifyContext = (!modifyContext || Object.keys(modifyContext).length === 0)\r\n      ? undefined\r\n      : { ...modifyContext, complete: true };\r\n    const targetContext = modifyContext\r\n      ? JSON.stringify(modifyContext)\r\n      : `${ctx.instance.id}, ${ctx.contentBlockReference.id}`;\r\n\r\n    // Placing real JS on each button\r\n    if (params?.action === CommandNames.code) {\r\n      const { action, ...cleanParams } = params;\r\n      const newP = { action: params.action, params: cleanParams };\r\n      return `$2sxc(${targetContext}).cms.run(${JSON.stringify(newP)}, event);`;\r\n    }\r\n    return `$2sxc(${targetContext}).manage.run(${JSON.stringify(\r\n      params\r\n    )}, event);`;\r\n  }\r\n\r\n  private iconTag(btn: ButtonSafe, rule: BuildRule) {\r\n    const callLog = this.log.call(\"iconTag\");\r\n    const icon = rule?.ui?.icon || btn.icon();\r\n    if (icon.indexOf(\"<svg\") > -1) {\r\n      // Temporary dom element\r\n      const symbol = document.createElement(\"template\");\r\n      symbol.innerHTML = icon;\r\n      // Note: It would be tempting to set the viewBox here, but it's not possible\r\n      // because we cannot calculate the size before rendering\r\n      return callLog.return(symbol.content.firstChild, icon);\r\n    } else {\r\n      const symbol = document.createElement(\"i\");\r\n      HtmlTools.addClasses(symbol, icon);\r\n      symbol.setAttribute(\"aria-hidden\", \"true\");\r\n      return callLog.return(symbol, icon);\r\n    }\r\n  }\r\n}\r\n\r\n// detect Hex-colors 6-digits or 8 in case transparent\r\nconst colorDetect = '^([A-Fa-f0-9]{6,8})$';\r\n\r\nfunction correctColorCodes(color: string) {\r\n    if (color && color.match(colorDetect)) return '#' + color;\r\n    return color;\r\n}\r\n","import { ContextBundleToolbar } from '../../context/bundles/context-bundle-toolbar';\r\nimport { ButtonGroup } from '../config';\r\nimport { RenderPart } from './render-part-base';\r\nimport { ToolbarRenderer } from './toolbar-renderer';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class RenderButtonGroups extends RenderPart {\r\n    constructor(parent: ToolbarRenderer) {\r\n        super(parent, 'Rnd.Groups');\r\n    }\r\n\r\n    generate(context: ContextBundleToolbar): HTMLElement[] {\r\n        const cl = this.log.call('generate');\r\n        let tags: HTMLElement[] = []; // temporary storage for detached HTML DOM objects\r\n        const btnGroups = context.toolbar.groups;\r\n\r\n        for (let i = 0; i < btnGroups.length; i++)\r\n            tags = tags.concat(this.generateGroup(btnGroups[i], context, i));\r\n\r\n        return cl.return(tags, `total tags: ${tags.length}`);\r\n    }\r\n\r\n    private generateGroup(group: ButtonGroup, context: ContextBundleToolbar, groupNumber: number): HTMLElement[] {\r\n        const cl = this.log.call('generateGroup', `group #${groupNumber}`);\r\n        const tags: HTMLElement[] = []; // temporary storage for detached HTML DOM objects\r\n        const btns = group.buttons;\r\n        for (let h = 0; h < btns.length; h++) {\r\n            const btnContext = context.forButton(btns[h]);\r\n            const tag = this.parent.button.render(btnContext, groupNumber);\r\n            // add button to group of buttons\r\n            const item = document.createElement('li');\r\n            item.appendChild(tag);\r\n            tags.push(item);\r\n        }\r\n        return cl.return(tags, `tags: ${tags.length}`);\r\n    }\r\n}\r\n","import { TlbShowPrefix } from './../config/toolbar-settings';\r\nimport { CmdParHlp } from '../../commands/cmd-par-hlp';\r\nimport { IDs } from '../../constants/ids';\r\nimport { ContextBundleToolbar } from '../../context/bundles/context-bundle-toolbar';\r\nimport { HasLog, Insights } from '../../core';\r\nimport { HtmlTools } from '../../html/dom-tools';\r\nimport { TlbHoverPrefix } from '../config';\r\nimport { RenderButton } from './render-button';\r\nimport { RenderButtonGroups } from './render-groups';\r\n\r\nconst attrIdentifier = 'toolbar-identifier';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ToolbarRenderer extends HasLog {\r\n    private readonly groups: RenderButtonGroups;\r\n    public readonly button: RenderButton;\r\n\r\n    constructor(private context: ContextBundleToolbar) {\r\n        super('Rnd.Toolbr');\r\n        Insights.add('toolbar-render', context.toolbar?.identifier || '', this.log);\r\n        this.groups = new RenderButtonGroups(this);\r\n        this.button = new RenderButton(this);\r\n    }\r\n\r\n    /**\r\n     * Convert a generated Toolbar into an HTML-string.\r\n     * AFAIK it's only used in external scripts through older APIs, and never called directly.\r\n     */\r\n    render(): string {\r\n        const cl = this.log.call('render');\r\n        return cl.return(this.generate().outerHTML);\r\n    }\r\n\r\n    /**\r\n     * Generate an HTML toolbar tag for adding to the page\r\n     */\r\n    generate(): HTMLUListElement {\r\n        const cl = this.log.call('generate');\r\n        // render groups of buttons\r\n        const context = this.context;\r\n        cl.data('toolbar config', context.toolbar);\r\n        const groups = this.groups.generate(context);\r\n\r\n        // render toolbar\r\n        const tlbTag = document.createElement('ul');\r\n        tlbTag.setAttribute(attrIdentifier, context.toolbar?.identifier);\r\n        tlbTag.classList.add(IDs.cls.scMenu);\r\n        tlbTag.classList.add('group-0'); // IE11 fix, add each class separately\r\n\r\n        // add behaviour classes\r\n        const settings = context.toolbar.settings;\r\n        const hover = settings.hover?.split('-'); // in case it has two values, like right-middle\r\n        hover?.forEach(h => tlbTag.classList.add(`${TlbHoverPrefix}${h}`));\r\n        tlbTag.classList.add(`${TlbShowPrefix}${settings.show}`);\r\n        if (CmdParHlp.getIndex(context.toolbar.params) === -1)\r\n            tlbTag.classList.add('listContent');\r\n        if (context.toolbar.params.fields)\r\n            tlbTag.classList.add('sc-sublist');\r\n\r\n        HtmlTools.addClasses(tlbTag, settings.class || settings.classes);\r\n\r\n        // add button groups to toolbar\r\n        tlbTag.setAttribute('group-count', context.toolbar.groups.length.toString());\r\n        for (let g = 0; g < groups.length; g++)\r\n            tlbTag.appendChild(groups[g]);\r\n\r\n        return cl.return(tlbTag, 'done');\r\n    }\r\n}\r\n","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return assertThisInitialized(self);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import _typeof from '@babel/runtime/helpers/esm/typeof';\nimport _classCallCheck from '@babel/runtime/helpers/esm/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/esm/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/esm/assertThisInitialized';\nimport _inherits from '@babel/runtime/helpers/esm/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/esm/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/esm/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport _toArray from '@babel/runtime/helpers/esm/toArray';\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar consoleLogger = {\n  type: 'logger',\n  log: function log(args) {\n    this.output('log', args);\n  },\n  warn: function warn(args) {\n    this.output('warn', args);\n  },\n  error: function error(args) {\n    this.output('error', args);\n  },\n  output: function output(type, args) {\n    if (console && console[type]) console[type].apply(console, args);\n  }\n};\n\nvar Logger = function () {\n  function Logger(concreteLogger) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Logger);\n\n    this.init(concreteLogger, options);\n  }\n\n  _createClass(Logger, [{\n    key: \"init\",\n    value: function init(concreteLogger) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      this.prefix = options.prefix || 'i18next:';\n      this.logger = concreteLogger || consoleLogger;\n      this.options = options;\n      this.debug = options.debug;\n    }\n  }, {\n    key: \"setDebug\",\n    value: function setDebug(bool) {\n      this.debug = bool;\n    }\n  }, {\n    key: \"log\",\n    value: function log() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return this.forward(args, 'log', '', true);\n    }\n  }, {\n    key: \"warn\",\n    value: function warn() {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      return this.forward(args, 'warn', '', true);\n    }\n  }, {\n    key: \"error\",\n    value: function error() {\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      return this.forward(args, 'error', '');\n    }\n  }, {\n    key: \"deprecate\",\n    value: function deprecate() {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      return this.forward(args, 'warn', 'WARNING DEPRECATED: ', true);\n    }\n  }, {\n    key: \"forward\",\n    value: function forward(args, lvl, prefix, debugOnly) {\n      if (debugOnly && !this.debug) return null;\n      if (typeof args[0] === 'string') args[0] = \"\".concat(prefix).concat(this.prefix, \" \").concat(args[0]);\n      return this.logger[lvl](args);\n    }\n  }, {\n    key: \"create\",\n    value: function create(moduleName) {\n      return new Logger(this.logger, _objectSpread(_objectSpread({}, {\n        prefix: \"\".concat(this.prefix, \":\").concat(moduleName, \":\")\n      }), this.options));\n    }\n  }]);\n\n  return Logger;\n}();\n\nvar baseLogger = new Logger();\n\nvar EventEmitter = function () {\n  function EventEmitter() {\n    _classCallCheck(this, EventEmitter);\n\n    this.observers = {};\n  }\n\n  _createClass(EventEmitter, [{\n    key: \"on\",\n    value: function on(events, listener) {\n      var _this = this;\n\n      events.split(' ').forEach(function (event) {\n        _this.observers[event] = _this.observers[event] || [];\n\n        _this.observers[event].push(listener);\n      });\n      return this;\n    }\n  }, {\n    key: \"off\",\n    value: function off(event, listener) {\n      if (!this.observers[event]) return;\n\n      if (!listener) {\n        delete this.observers[event];\n        return;\n      }\n\n      this.observers[event] = this.observers[event].filter(function (l) {\n        return l !== listener;\n      });\n    }\n  }, {\n    key: \"emit\",\n    value: function emit(event) {\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      if (this.observers[event]) {\n        var cloned = [].concat(this.observers[event]);\n        cloned.forEach(function (observer) {\n          observer.apply(void 0, args);\n        });\n      }\n\n      if (this.observers['*']) {\n        var _cloned = [].concat(this.observers['*']);\n\n        _cloned.forEach(function (observer) {\n          observer.apply(observer, [event].concat(args));\n        });\n      }\n    }\n  }]);\n\n  return EventEmitter;\n}();\n\nfunction defer() {\n  var res;\n  var rej;\n  var promise = new Promise(function (resolve, reject) {\n    res = resolve;\n    rej = reject;\n  });\n  promise.resolve = res;\n  promise.reject = rej;\n  return promise;\n}\nfunction makeString(object) {\n  if (object == null) return '';\n  return '' + object;\n}\nfunction copy(a, s, t) {\n  a.forEach(function (m) {\n    if (s[m]) t[m] = s[m];\n  });\n}\n\nfunction getLastOfPath(object, path, Empty) {\n  function cleanKey(key) {\n    return key && key.indexOf('###') > -1 ? key.replace(/###/g, '.') : key;\n  }\n\n  function canNotTraverseDeeper() {\n    return !object || typeof object === 'string';\n  }\n\n  var stack = typeof path !== 'string' ? [].concat(path) : path.split('.');\n\n  while (stack.length > 1) {\n    if (canNotTraverseDeeper()) return {};\n    var key = cleanKey(stack.shift());\n    if (!object[key] && Empty) object[key] = new Empty();\n\n    if (Object.prototype.hasOwnProperty.call(object, key)) {\n      object = object[key];\n    } else {\n      object = {};\n    }\n  }\n\n  if (canNotTraverseDeeper()) return {};\n  return {\n    obj: object,\n    k: cleanKey(stack.shift())\n  };\n}\n\nfunction setPath(object, path, newValue) {\n  var _getLastOfPath = getLastOfPath(object, path, Object),\n      obj = _getLastOfPath.obj,\n      k = _getLastOfPath.k;\n\n  obj[k] = newValue;\n}\nfunction pushPath(object, path, newValue, concat) {\n  var _getLastOfPath2 = getLastOfPath(object, path, Object),\n      obj = _getLastOfPath2.obj,\n      k = _getLastOfPath2.k;\n\n  obj[k] = obj[k] || [];\n  if (concat) obj[k] = obj[k].concat(newValue);\n  if (!concat) obj[k].push(newValue);\n}\nfunction getPath(object, path) {\n  var _getLastOfPath3 = getLastOfPath(object, path),\n      obj = _getLastOfPath3.obj,\n      k = _getLastOfPath3.k;\n\n  if (!obj) return undefined;\n  return obj[k];\n}\nfunction getPathWithDefaults(data, defaultData, key) {\n  var value = getPath(data, key);\n\n  if (value !== undefined) {\n    return value;\n  }\n\n  return getPath(defaultData, key);\n}\nfunction deepExtend(target, source, overwrite) {\n  for (var prop in source) {\n    if (prop !== '__proto__' && prop !== 'constructor') {\n      if (prop in target) {\n        if (typeof target[prop] === 'string' || target[prop] instanceof String || typeof source[prop] === 'string' || source[prop] instanceof String) {\n          if (overwrite) target[prop] = source[prop];\n        } else {\n          deepExtend(target[prop], source[prop], overwrite);\n        }\n      } else {\n        target[prop] = source[prop];\n      }\n    }\n  }\n\n  return target;\n}\nfunction regexEscape(str) {\n  return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n}\nvar _entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;'\n};\nfunction escape(data) {\n  if (typeof data === 'string') {\n    return data.replace(/[&<>\"'\\/]/g, function (s) {\n      return _entityMap[s];\n    });\n  }\n\n  return data;\n}\nvar isIE10 = typeof window !== 'undefined' && window.navigator && typeof window.navigator.userAgentData === 'undefined' && window.navigator.userAgent && window.navigator.userAgent.indexOf('MSIE') > -1;\nvar chars = [' ', ',', '?', '!', ';'];\nfunction looksLikeObjectPath(key, nsSeparator, keySeparator) {\n  nsSeparator = nsSeparator || '';\n  keySeparator = keySeparator || '';\n  var possibleChars = chars.filter(function (c) {\n    return nsSeparator.indexOf(c) < 0 && keySeparator.indexOf(c) < 0;\n  });\n  if (possibleChars.length === 0) return true;\n  var r = new RegExp(\"(\".concat(possibleChars.map(function (c) {\n    return c === '?' ? '\\\\?' : c;\n  }).join('|'), \")\"));\n  var matched = !r.test(key);\n\n  if (!matched) {\n    var ki = key.indexOf(keySeparator);\n\n    if (ki > 0 && !r.test(key.substring(0, ki))) {\n      matched = true;\n    }\n  }\n\n  return matched;\n}\n\nfunction ownKeys$1(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$1(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$1(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$1(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction deepFind(obj, path) {\n  var keySeparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '.';\n  if (!obj) return undefined;\n  if (obj[path]) return obj[path];\n  var paths = path.split(keySeparator);\n  var current = obj;\n\n  for (var i = 0; i < paths.length; ++i) {\n    if (!current) return undefined;\n\n    if (typeof current[paths[i]] === 'string' && i + 1 < paths.length) {\n      return undefined;\n    }\n\n    if (current[paths[i]] === undefined) {\n      var j = 2;\n      var p = paths.slice(i, i + j).join(keySeparator);\n      var mix = current[p];\n\n      while (mix === undefined && paths.length > i + j) {\n        j++;\n        p = paths.slice(i, i + j).join(keySeparator);\n        mix = current[p];\n      }\n\n      if (mix === undefined) return undefined;\n      if (mix === null) return null;\n\n      if (path.endsWith(p)) {\n        if (typeof mix === 'string') return mix;\n        if (p && typeof mix[p] === 'string') return mix[p];\n      }\n\n      var joinedPath = paths.slice(i + j).join(keySeparator);\n      if (joinedPath) return deepFind(mix, joinedPath, keySeparator);\n      return undefined;\n    }\n\n    current = current[paths[i]];\n  }\n\n  return current;\n}\n\nvar ResourceStore = function (_EventEmitter) {\n  _inherits(ResourceStore, _EventEmitter);\n\n  var _super = _createSuper(ResourceStore);\n\n  function ResourceStore(data) {\n    var _this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      ns: ['translation'],\n      defaultNS: 'translation'\n    };\n\n    _classCallCheck(this, ResourceStore);\n\n    _this = _super.call(this);\n\n    if (isIE10) {\n      EventEmitter.call(_assertThisInitialized(_this));\n    }\n\n    _this.data = data || {};\n    _this.options = options;\n\n    if (_this.options.keySeparator === undefined) {\n      _this.options.keySeparator = '.';\n    }\n\n    if (_this.options.ignoreJSONStructure === undefined) {\n      _this.options.ignoreJSONStructure = true;\n    }\n\n    return _this;\n  }\n\n  _createClass(ResourceStore, [{\n    key: \"addNamespaces\",\n    value: function addNamespaces(ns) {\n      if (this.options.ns.indexOf(ns) < 0) {\n        this.options.ns.push(ns);\n      }\n    }\n  }, {\n    key: \"removeNamespaces\",\n    value: function removeNamespaces(ns) {\n      var index = this.options.ns.indexOf(ns);\n\n      if (index > -1) {\n        this.options.ns.splice(index, 1);\n      }\n    }\n  }, {\n    key: \"getResource\",\n    value: function getResource(lng, ns, key) {\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n      var ignoreJSONStructure = options.ignoreJSONStructure !== undefined ? options.ignoreJSONStructure : this.options.ignoreJSONStructure;\n      var path = [lng, ns];\n      if (key && typeof key !== 'string') path = path.concat(key);\n      if (key && typeof key === 'string') path = path.concat(keySeparator ? key.split(keySeparator) : key);\n\n      if (lng.indexOf('.') > -1) {\n        path = lng.split('.');\n      }\n\n      var result = getPath(this.data, path);\n      if (result || !ignoreJSONStructure || typeof key !== 'string') return result;\n      return deepFind(this.data && this.data[lng] && this.data[lng][ns], key, keySeparator);\n    }\n  }, {\n    key: \"addResource\",\n    value: function addResource(lng, ns, key, value) {\n      var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {\n        silent: false\n      };\n      var keySeparator = this.options.keySeparator;\n      if (keySeparator === undefined) keySeparator = '.';\n      var path = [lng, ns];\n      if (key) path = path.concat(keySeparator ? key.split(keySeparator) : key);\n\n      if (lng.indexOf('.') > -1) {\n        path = lng.split('.');\n        value = ns;\n        ns = path[1];\n      }\n\n      this.addNamespaces(ns);\n      setPath(this.data, path, value);\n      if (!options.silent) this.emit('added', lng, ns, key, value);\n    }\n  }, {\n    key: \"addResources\",\n    value: function addResources(lng, ns, resources) {\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n        silent: false\n      };\n\n      for (var m in resources) {\n        if (typeof resources[m] === 'string' || Object.prototype.toString.apply(resources[m]) === '[object Array]') this.addResource(lng, ns, m, resources[m], {\n          silent: true\n        });\n      }\n\n      if (!options.silent) this.emit('added', lng, ns, resources);\n    }\n  }, {\n    key: \"addResourceBundle\",\n    value: function addResourceBundle(lng, ns, resources, deep, overwrite) {\n      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {\n        silent: false\n      };\n      var path = [lng, ns];\n\n      if (lng.indexOf('.') > -1) {\n        path = lng.split('.');\n        deep = resources;\n        resources = ns;\n        ns = path[1];\n      }\n\n      this.addNamespaces(ns);\n      var pack = getPath(this.data, path) || {};\n\n      if (deep) {\n        deepExtend(pack, resources, overwrite);\n      } else {\n        pack = _objectSpread$1(_objectSpread$1({}, pack), resources);\n      }\n\n      setPath(this.data, path, pack);\n      if (!options.silent) this.emit('added', lng, ns, resources);\n    }\n  }, {\n    key: \"removeResourceBundle\",\n    value: function removeResourceBundle(lng, ns) {\n      if (this.hasResourceBundle(lng, ns)) {\n        delete this.data[lng][ns];\n      }\n\n      this.removeNamespaces(ns);\n      this.emit('removed', lng, ns);\n    }\n  }, {\n    key: \"hasResourceBundle\",\n    value: function hasResourceBundle(lng, ns) {\n      return this.getResource(lng, ns) !== undefined;\n    }\n  }, {\n    key: \"getResourceBundle\",\n    value: function getResourceBundle(lng, ns) {\n      if (!ns) ns = this.options.defaultNS;\n      if (this.options.compatibilityAPI === 'v1') return _objectSpread$1(_objectSpread$1({}, {}), this.getResource(lng, ns));\n      return this.getResource(lng, ns);\n    }\n  }, {\n    key: \"getDataByLanguage\",\n    value: function getDataByLanguage(lng) {\n      return this.data[lng];\n    }\n  }, {\n    key: \"hasLanguageSomeTranslations\",\n    value: function hasLanguageSomeTranslations(lng) {\n      var data = this.getDataByLanguage(lng);\n      var n = data && Object.keys(data) || [];\n      return !!n.find(function (v) {\n        return data[v] && Object.keys(data[v]).length > 0;\n      });\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.data;\n    }\n  }]);\n\n  return ResourceStore;\n}(EventEmitter);\n\nvar postProcessor = {\n  processors: {},\n  addPostProcessor: function addPostProcessor(module) {\n    this.processors[module.name] = module;\n  },\n  handle: function handle(processors, value, key, options, translator) {\n    var _this = this;\n\n    processors.forEach(function (processor) {\n      if (_this.processors[processor]) value = _this.processors[processor].process(value, key, options, translator);\n    });\n    return value;\n  }\n};\n\nfunction ownKeys$2(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$2(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$2(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$2(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper$1(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct$1(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct$1() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nvar checkedLoadedFor = {};\n\nvar Translator = function (_EventEmitter) {\n  _inherits(Translator, _EventEmitter);\n\n  var _super = _createSuper$1(Translator);\n\n  function Translator(services) {\n    var _this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Translator);\n\n    _this = _super.call(this);\n\n    if (isIE10) {\n      EventEmitter.call(_assertThisInitialized(_this));\n    }\n\n    copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector', 'i18nFormat', 'utils'], services, _assertThisInitialized(_this));\n    _this.options = options;\n\n    if (_this.options.keySeparator === undefined) {\n      _this.options.keySeparator = '.';\n    }\n\n    _this.logger = baseLogger.create('translator');\n    return _this;\n  }\n\n  _createClass(Translator, [{\n    key: \"changeLanguage\",\n    value: function changeLanguage(lng) {\n      if (lng) this.language = lng;\n    }\n  }, {\n    key: \"exists\",\n    value: function exists(key) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        interpolation: {}\n      };\n\n      if (key === undefined || key === null) {\n        return false;\n      }\n\n      var resolved = this.resolve(key, options);\n      return resolved && resolved.res !== undefined;\n    }\n  }, {\n    key: \"extractFromKey\",\n    value: function extractFromKey(key, options) {\n      var nsSeparator = options.nsSeparator !== undefined ? options.nsSeparator : this.options.nsSeparator;\n      if (nsSeparator === undefined) nsSeparator = ':';\n      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n      var namespaces = options.ns || this.options.defaultNS || [];\n      var wouldCheckForNsInKey = nsSeparator && key.indexOf(nsSeparator) > -1;\n      var seemsNaturalLanguage = !this.options.userDefinedKeySeparator && !options.keySeparator && !this.options.userDefinedNsSeparator && !options.nsSeparator && !looksLikeObjectPath(key, nsSeparator, keySeparator);\n\n      if (wouldCheckForNsInKey && !seemsNaturalLanguage) {\n        var m = key.match(this.interpolator.nestingRegexp);\n\n        if (m && m.length > 0) {\n          return {\n            key: key,\n            namespaces: namespaces\n          };\n        }\n\n        var parts = key.split(nsSeparator);\n        if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();\n        key = parts.join(keySeparator);\n      }\n\n      if (typeof namespaces === 'string') namespaces = [namespaces];\n      return {\n        key: key,\n        namespaces: namespaces\n      };\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(keys, options, lastKey) {\n      var _this2 = this;\n\n      if (_typeof(options) !== 'object' && this.options.overloadTranslationOptionHandler) {\n        options = this.options.overloadTranslationOptionHandler(arguments);\n      }\n\n      if (!options) options = {};\n      if (keys === undefined || keys === null) return '';\n      if (!Array.isArray(keys)) keys = [String(keys)];\n      var returnDetails = options.returnDetails !== undefined ? options.returnDetails : this.options.returnDetails;\n      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n\n      var _this$extractFromKey = this.extractFromKey(keys[keys.length - 1], options),\n          key = _this$extractFromKey.key,\n          namespaces = _this$extractFromKey.namespaces;\n\n      var namespace = namespaces[namespaces.length - 1];\n      var lng = options.lng || this.language;\n      var appendNamespaceToCIMode = options.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;\n\n      if (lng && lng.toLowerCase() === 'cimode') {\n        if (appendNamespaceToCIMode) {\n          var nsSeparator = options.nsSeparator || this.options.nsSeparator;\n\n          if (returnDetails) {\n            resolved.res = \"\".concat(namespace).concat(nsSeparator).concat(key);\n            return resolved;\n          }\n\n          return \"\".concat(namespace).concat(nsSeparator).concat(key);\n        }\n\n        if (returnDetails) {\n          resolved.res = key;\n          return resolved;\n        }\n\n        return key;\n      }\n\n      var resolved = this.resolve(keys, options);\n      var res = resolved && resolved.res;\n      var resUsedKey = resolved && resolved.usedKey || key;\n      var resExactUsedKey = resolved && resolved.exactUsedKey || key;\n      var resType = Object.prototype.toString.apply(res);\n      var noObject = ['[object Number]', '[object Function]', '[object RegExp]'];\n      var joinArrays = options.joinArrays !== undefined ? options.joinArrays : this.options.joinArrays;\n      var handleAsObjectInI18nFormat = !this.i18nFormat || this.i18nFormat.handleAsObject;\n      var handleAsObject = typeof res !== 'string' && typeof res !== 'boolean' && typeof res !== 'number';\n\n      if (handleAsObjectInI18nFormat && res && handleAsObject && noObject.indexOf(resType) < 0 && !(typeof joinArrays === 'string' && resType === '[object Array]')) {\n        if (!options.returnObjects && !this.options.returnObjects) {\n          if (!this.options.returnedObjectHandler) {\n            this.logger.warn('accessing an object - but returnObjects options is not enabled!');\n          }\n\n          var r = this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, res, _objectSpread$2(_objectSpread$2({}, options), {}, {\n            ns: namespaces\n          })) : \"key '\".concat(key, \" (\").concat(this.language, \")' returned an object instead of string.\");\n\n          if (returnDetails) {\n            resolved.res = r;\n            return resolved;\n          }\n\n          return r;\n        }\n\n        if (keySeparator) {\n          var resTypeIsArray = resType === '[object Array]';\n          var copy = resTypeIsArray ? [] : {};\n          var newKeyToUse = resTypeIsArray ? resExactUsedKey : resUsedKey;\n\n          for (var m in res) {\n            if (Object.prototype.hasOwnProperty.call(res, m)) {\n              var deepKey = \"\".concat(newKeyToUse).concat(keySeparator).concat(m);\n              copy[m] = this.translate(deepKey, _objectSpread$2(_objectSpread$2({}, options), {\n                joinArrays: false,\n                ns: namespaces\n              }));\n              if (copy[m] === deepKey) copy[m] = res[m];\n            }\n          }\n\n          res = copy;\n        }\n      } else if (handleAsObjectInI18nFormat && typeof joinArrays === 'string' && resType === '[object Array]') {\n        res = res.join(joinArrays);\n        if (res) res = this.extendTranslation(res, keys, options, lastKey);\n      } else {\n        var usedDefault = false;\n        var usedKey = false;\n        var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';\n        var hasDefaultValue = Translator.hasDefaultValue(options);\n        var defaultValueSuffix = needsPluralHandling ? this.pluralResolver.getSuffix(lng, options.count, options) : '';\n        var defaultValue = options[\"defaultValue\".concat(defaultValueSuffix)] || options.defaultValue;\n\n        if (!this.isValidLookup(res) && hasDefaultValue) {\n          usedDefault = true;\n          res = defaultValue;\n        }\n\n        if (!this.isValidLookup(res)) {\n          usedKey = true;\n          res = key;\n        }\n\n        var missingKeyNoValueFallbackToKey = options.missingKeyNoValueFallbackToKey || this.options.missingKeyNoValueFallbackToKey;\n        var resForMissing = missingKeyNoValueFallbackToKey && usedKey ? undefined : res;\n        var updateMissing = hasDefaultValue && defaultValue !== res && this.options.updateMissing;\n\n        if (usedKey || usedDefault || updateMissing) {\n          this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? defaultValue : res);\n\n          if (keySeparator) {\n            var fk = this.resolve(key, _objectSpread$2(_objectSpread$2({}, options), {}, {\n              keySeparator: false\n            }));\n            if (fk && fk.res) this.logger.warn('Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.');\n          }\n\n          var lngs = [];\n          var fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, options.lng || this.language);\n\n          if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {\n            for (var i = 0; i < fallbackLngs.length; i++) {\n              lngs.push(fallbackLngs[i]);\n            }\n          } else if (this.options.saveMissingTo === 'all') {\n            lngs = this.languageUtils.toResolveHierarchy(options.lng || this.language);\n          } else {\n            lngs.push(options.lng || this.language);\n          }\n\n          var send = function send(l, k, specificDefaultValue) {\n            var defaultForMissing = hasDefaultValue && specificDefaultValue !== res ? specificDefaultValue : resForMissing;\n\n            if (_this2.options.missingKeyHandler) {\n              _this2.options.missingKeyHandler(l, namespace, k, defaultForMissing, updateMissing, options);\n            } else if (_this2.backendConnector && _this2.backendConnector.saveMissing) {\n              _this2.backendConnector.saveMissing(l, namespace, k, defaultForMissing, updateMissing, options);\n            }\n\n            _this2.emit('missingKey', l, namespace, k, res);\n          };\n\n          if (this.options.saveMissing) {\n            if (this.options.saveMissingPlurals && needsPluralHandling) {\n              lngs.forEach(function (language) {\n                _this2.pluralResolver.getSuffixes(language, options).forEach(function (suffix) {\n                  send([language], key + suffix, options[\"defaultValue\".concat(suffix)] || defaultValue);\n                });\n              });\n            } else {\n              send(lngs, key, defaultValue);\n            }\n          }\n        }\n\n        res = this.extendTranslation(res, keys, options, resolved, lastKey);\n        if (usedKey && res === key && this.options.appendNamespaceToMissingKey) res = \"\".concat(namespace, \":\").concat(key);\n\n        if ((usedKey || usedDefault) && this.options.parseMissingKeyHandler) {\n          if (this.options.compatibilityAPI !== 'v1') {\n            res = this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey ? \"\".concat(namespace, \":\").concat(key) : key, usedDefault ? res : undefined);\n          } else {\n            res = this.options.parseMissingKeyHandler(res);\n          }\n        }\n      }\n\n      if (returnDetails) {\n        resolved.res = res;\n        return resolved;\n      }\n\n      return res;\n    }\n  }, {\n    key: \"extendTranslation\",\n    value: function extendTranslation(res, key, options, resolved, lastKey) {\n      var _this3 = this;\n\n      if (this.i18nFormat && this.i18nFormat.parse) {\n        res = this.i18nFormat.parse(res, _objectSpread$2(_objectSpread$2({}, this.options.interpolation.defaultVariables), options), resolved.usedLng, resolved.usedNS, resolved.usedKey, {\n          resolved: resolved\n        });\n      } else if (!options.skipInterpolation) {\n        if (options.interpolation) this.interpolator.init(_objectSpread$2(_objectSpread$2({}, options), {\n          interpolation: _objectSpread$2(_objectSpread$2({}, this.options.interpolation), options.interpolation)\n        }));\n        var skipOnVariables = typeof res === 'string' && (options && options.interpolation && options.interpolation.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables);\n        var nestBef;\n\n        if (skipOnVariables) {\n          var nb = res.match(this.interpolator.nestingRegexp);\n          nestBef = nb && nb.length;\n        }\n\n        var data = options.replace && typeof options.replace !== 'string' ? options.replace : options;\n        if (this.options.interpolation.defaultVariables) data = _objectSpread$2(_objectSpread$2({}, this.options.interpolation.defaultVariables), data);\n        res = this.interpolator.interpolate(res, data, options.lng || this.language, options);\n\n        if (skipOnVariables) {\n          var na = res.match(this.interpolator.nestingRegexp);\n          var nestAft = na && na.length;\n          if (nestBef < nestAft) options.nest = false;\n        }\n\n        if (options.nest !== false) res = this.interpolator.nest(res, function () {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n\n          if (lastKey && lastKey[0] === args[0] && !options.context) {\n            _this3.logger.warn(\"It seems you are nesting recursively key: \".concat(args[0], \" in key: \").concat(key[0]));\n\n            return null;\n          }\n\n          return _this3.translate.apply(_this3, args.concat([key]));\n        }, options);\n        if (options.interpolation) this.interpolator.reset();\n      }\n\n      var postProcess = options.postProcess || this.options.postProcess;\n      var postProcessorNames = typeof postProcess === 'string' ? [postProcess] : postProcess;\n\n      if (res !== undefined && res !== null && postProcessorNames && postProcessorNames.length && options.applyPostProcessor !== false) {\n        res = postProcessor.handle(postProcessorNames, res, key, this.options && this.options.postProcessPassResolved ? _objectSpread$2({\n          i18nResolved: resolved\n        }, options) : options, this);\n      }\n\n      return res;\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(keys) {\n      var _this4 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var found;\n      var usedKey;\n      var exactUsedKey;\n      var usedLng;\n      var usedNS;\n      if (typeof keys === 'string') keys = [keys];\n      keys.forEach(function (k) {\n        if (_this4.isValidLookup(found)) return;\n\n        var extracted = _this4.extractFromKey(k, options);\n\n        var key = extracted.key;\n        usedKey = key;\n        var namespaces = extracted.namespaces;\n        if (_this4.options.fallbackNS) namespaces = namespaces.concat(_this4.options.fallbackNS);\n        var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';\n\n        var needsZeroSuffixLookup = needsPluralHandling && !options.ordinal && options.count === 0 && _this4.pluralResolver.shouldUseIntlApi();\n\n        var needsContextHandling = options.context !== undefined && (typeof options.context === 'string' || typeof options.context === 'number') && options.context !== '';\n        var codes = options.lngs ? options.lngs : _this4.languageUtils.toResolveHierarchy(options.lng || _this4.language, options.fallbackLng);\n        namespaces.forEach(function (ns) {\n          if (_this4.isValidLookup(found)) return;\n          usedNS = ns;\n\n          if (!checkedLoadedFor[\"\".concat(codes[0], \"-\").concat(ns)] && _this4.utils && _this4.utils.hasLoadedNamespace && !_this4.utils.hasLoadedNamespace(usedNS)) {\n            checkedLoadedFor[\"\".concat(codes[0], \"-\").concat(ns)] = true;\n\n            _this4.logger.warn(\"key \\\"\".concat(usedKey, \"\\\" for languages \\\"\").concat(codes.join(', '), \"\\\" won't get resolved as namespace \\\"\").concat(usedNS, \"\\\" was not yet loaded\"), 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n          }\n\n          codes.forEach(function (code) {\n            if (_this4.isValidLookup(found)) return;\n            usedLng = code;\n            var finalKeys = [key];\n\n            if (_this4.i18nFormat && _this4.i18nFormat.addLookupKeys) {\n              _this4.i18nFormat.addLookupKeys(finalKeys, key, code, ns, options);\n            } else {\n              var pluralSuffix;\n              if (needsPluralHandling) pluralSuffix = _this4.pluralResolver.getSuffix(code, options.count, options);\n              var zeroSuffix = \"\".concat(_this4.options.pluralSeparator, \"zero\");\n\n              if (needsPluralHandling) {\n                finalKeys.push(key + pluralSuffix);\n\n                if (needsZeroSuffixLookup) {\n                  finalKeys.push(key + zeroSuffix);\n                }\n              }\n\n              if (needsContextHandling) {\n                var contextKey = \"\".concat(key).concat(_this4.options.contextSeparator).concat(options.context);\n                finalKeys.push(contextKey);\n\n                if (needsPluralHandling) {\n                  finalKeys.push(contextKey + pluralSuffix);\n\n                  if (needsZeroSuffixLookup) {\n                    finalKeys.push(contextKey + zeroSuffix);\n                  }\n                }\n              }\n            }\n\n            var possibleKey;\n\n            while (possibleKey = finalKeys.pop()) {\n              if (!_this4.isValidLookup(found)) {\n                exactUsedKey = possibleKey;\n                found = _this4.getResource(code, ns, possibleKey, options);\n              }\n            }\n          });\n        });\n      });\n      return {\n        res: found,\n        usedKey: usedKey,\n        exactUsedKey: exactUsedKey,\n        usedLng: usedLng,\n        usedNS: usedNS\n      };\n    }\n  }, {\n    key: \"isValidLookup\",\n    value: function isValidLookup(res) {\n      return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');\n    }\n  }, {\n    key: \"getResource\",\n    value: function getResource(code, ns, key) {\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      if (this.i18nFormat && this.i18nFormat.getResource) return this.i18nFormat.getResource(code, ns, key, options);\n      return this.resourceStore.getResource(code, ns, key, options);\n    }\n  }], [{\n    key: \"hasDefaultValue\",\n    value: function hasDefaultValue(options) {\n      var prefix = 'defaultValue';\n\n      for (var option in options) {\n        if (Object.prototype.hasOwnProperty.call(options, option) && prefix === option.substring(0, prefix.length) && undefined !== options[option]) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }]);\n\n  return Translator;\n}(EventEmitter);\n\nfunction capitalize(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nvar LanguageUtil = function () {\n  function LanguageUtil(options) {\n    _classCallCheck(this, LanguageUtil);\n\n    this.options = options;\n    this.supportedLngs = this.options.supportedLngs || false;\n    this.logger = baseLogger.create('languageUtils');\n  }\n\n  _createClass(LanguageUtil, [{\n    key: \"getScriptPartFromCode\",\n    value: function getScriptPartFromCode(code) {\n      if (!code || code.indexOf('-') < 0) return null;\n      var p = code.split('-');\n      if (p.length === 2) return null;\n      p.pop();\n      if (p[p.length - 1].toLowerCase() === 'x') return null;\n      return this.formatLanguageCode(p.join('-'));\n    }\n  }, {\n    key: \"getLanguagePartFromCode\",\n    value: function getLanguagePartFromCode(code) {\n      if (!code || code.indexOf('-') < 0) return code;\n      var p = code.split('-');\n      return this.formatLanguageCode(p[0]);\n    }\n  }, {\n    key: \"formatLanguageCode\",\n    value: function formatLanguageCode(code) {\n      if (typeof code === 'string' && code.indexOf('-') > -1) {\n        var specialCases = ['hans', 'hant', 'latn', 'cyrl', 'cans', 'mong', 'arab'];\n        var p = code.split('-');\n\n        if (this.options.lowerCaseLng) {\n          p = p.map(function (part) {\n            return part.toLowerCase();\n          });\n        } else if (p.length === 2) {\n          p[0] = p[0].toLowerCase();\n          p[1] = p[1].toUpperCase();\n          if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());\n        } else if (p.length === 3) {\n          p[0] = p[0].toLowerCase();\n          if (p[1].length === 2) p[1] = p[1].toUpperCase();\n          if (p[0] !== 'sgn' && p[2].length === 2) p[2] = p[2].toUpperCase();\n          if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());\n          if (specialCases.indexOf(p[2].toLowerCase()) > -1) p[2] = capitalize(p[2].toLowerCase());\n        }\n\n        return p.join('-');\n      }\n\n      return this.options.cleanCode || this.options.lowerCaseLng ? code.toLowerCase() : code;\n    }\n  }, {\n    key: \"isSupportedCode\",\n    value: function isSupportedCode(code) {\n      if (this.options.load === 'languageOnly' || this.options.nonExplicitSupportedLngs) {\n        code = this.getLanguagePartFromCode(code);\n      }\n\n      return !this.supportedLngs || !this.supportedLngs.length || this.supportedLngs.indexOf(code) > -1;\n    }\n  }, {\n    key: \"getBestMatchFromCodes\",\n    value: function getBestMatchFromCodes(codes) {\n      var _this = this;\n\n      if (!codes) return null;\n      var found;\n      codes.forEach(function (code) {\n        if (found) return;\n\n        var cleanedLng = _this.formatLanguageCode(code);\n\n        if (!_this.options.supportedLngs || _this.isSupportedCode(cleanedLng)) found = cleanedLng;\n      });\n\n      if (!found && this.options.supportedLngs) {\n        codes.forEach(function (code) {\n          if (found) return;\n\n          var lngOnly = _this.getLanguagePartFromCode(code);\n\n          if (_this.isSupportedCode(lngOnly)) return found = lngOnly;\n          found = _this.options.supportedLngs.find(function (supportedLng) {\n            if (supportedLng.indexOf(lngOnly) === 0) return supportedLng;\n          });\n        });\n      }\n\n      if (!found) found = this.getFallbackCodes(this.options.fallbackLng)[0];\n      return found;\n    }\n  }, {\n    key: \"getFallbackCodes\",\n    value: function getFallbackCodes(fallbacks, code) {\n      if (!fallbacks) return [];\n      if (typeof fallbacks === 'function') fallbacks = fallbacks(code);\n      if (typeof fallbacks === 'string') fallbacks = [fallbacks];\n      if (Object.prototype.toString.apply(fallbacks) === '[object Array]') return fallbacks;\n      if (!code) return fallbacks[\"default\"] || [];\n      var found = fallbacks[code];\n      if (!found) found = fallbacks[this.getScriptPartFromCode(code)];\n      if (!found) found = fallbacks[this.formatLanguageCode(code)];\n      if (!found) found = fallbacks[this.getLanguagePartFromCode(code)];\n      if (!found) found = fallbacks[\"default\"];\n      return found || [];\n    }\n  }, {\n    key: \"toResolveHierarchy\",\n    value: function toResolveHierarchy(code, fallbackCode) {\n      var _this2 = this;\n\n      var fallbackCodes = this.getFallbackCodes(fallbackCode || this.options.fallbackLng || [], code);\n      var codes = [];\n\n      var addCode = function addCode(c) {\n        if (!c) return;\n\n        if (_this2.isSupportedCode(c)) {\n          codes.push(c);\n        } else {\n          _this2.logger.warn(\"rejecting language code not found in supportedLngs: \".concat(c));\n        }\n      };\n\n      if (typeof code === 'string' && code.indexOf('-') > -1) {\n        if (this.options.load !== 'languageOnly') addCode(this.formatLanguageCode(code));\n        if (this.options.load !== 'languageOnly' && this.options.load !== 'currentOnly') addCode(this.getScriptPartFromCode(code));\n        if (this.options.load !== 'currentOnly') addCode(this.getLanguagePartFromCode(code));\n      } else if (typeof code === 'string') {\n        addCode(this.formatLanguageCode(code));\n      }\n\n      fallbackCodes.forEach(function (fc) {\n        if (codes.indexOf(fc) < 0) addCode(_this2.formatLanguageCode(fc));\n      });\n      return codes;\n    }\n  }]);\n\n  return LanguageUtil;\n}();\n\nvar sets = [{\n  lngs: ['ach', 'ak', 'am', 'arn', 'br', 'fil', 'gun', 'ln', 'mfe', 'mg', 'mi', 'oc', 'pt', 'pt-BR', 'tg', 'tl', 'ti', 'tr', 'uz', 'wa'],\n  nr: [1, 2],\n  fc: 1\n}, {\n  lngs: ['af', 'an', 'ast', 'az', 'bg', 'bn', 'ca', 'da', 'de', 'dev', 'el', 'en', 'eo', 'es', 'et', 'eu', 'fi', 'fo', 'fur', 'fy', 'gl', 'gu', 'ha', 'hi', 'hu', 'hy', 'ia', 'it', 'kk', 'kn', 'ku', 'lb', 'mai', 'ml', 'mn', 'mr', 'nah', 'nap', 'nb', 'ne', 'nl', 'nn', 'no', 'nso', 'pa', 'pap', 'pms', 'ps', 'pt-PT', 'rm', 'sco', 'se', 'si', 'so', 'son', 'sq', 'sv', 'sw', 'ta', 'te', 'tk', 'ur', 'yo'],\n  nr: [1, 2],\n  fc: 2\n}, {\n  lngs: ['ay', 'bo', 'cgg', 'fa', 'ht', 'id', 'ja', 'jbo', 'ka', 'km', 'ko', 'ky', 'lo', 'ms', 'sah', 'su', 'th', 'tt', 'ug', 'vi', 'wo', 'zh'],\n  nr: [1],\n  fc: 3\n}, {\n  lngs: ['be', 'bs', 'cnr', 'dz', 'hr', 'ru', 'sr', 'uk'],\n  nr: [1, 2, 5],\n  fc: 4\n}, {\n  lngs: ['ar'],\n  nr: [0, 1, 2, 3, 11, 100],\n  fc: 5\n}, {\n  lngs: ['cs', 'sk'],\n  nr: [1, 2, 5],\n  fc: 6\n}, {\n  lngs: ['csb', 'pl'],\n  nr: [1, 2, 5],\n  fc: 7\n}, {\n  lngs: ['cy'],\n  nr: [1, 2, 3, 8],\n  fc: 8\n}, {\n  lngs: ['fr'],\n  nr: [1, 2],\n  fc: 9\n}, {\n  lngs: ['ga'],\n  nr: [1, 2, 3, 7, 11],\n  fc: 10\n}, {\n  lngs: ['gd'],\n  nr: [1, 2, 3, 20],\n  fc: 11\n}, {\n  lngs: ['is'],\n  nr: [1, 2],\n  fc: 12\n}, {\n  lngs: ['jv'],\n  nr: [0, 1],\n  fc: 13\n}, {\n  lngs: ['kw'],\n  nr: [1, 2, 3, 4],\n  fc: 14\n}, {\n  lngs: ['lt'],\n  nr: [1, 2, 10],\n  fc: 15\n}, {\n  lngs: ['lv'],\n  nr: [1, 2, 0],\n  fc: 16\n}, {\n  lngs: ['mk'],\n  nr: [1, 2],\n  fc: 17\n}, {\n  lngs: ['mnk'],\n  nr: [0, 1, 2],\n  fc: 18\n}, {\n  lngs: ['mt'],\n  nr: [1, 2, 11, 20],\n  fc: 19\n}, {\n  lngs: ['or'],\n  nr: [2, 1],\n  fc: 2\n}, {\n  lngs: ['ro'],\n  nr: [1, 2, 20],\n  fc: 20\n}, {\n  lngs: ['sl'],\n  nr: [5, 1, 2, 3],\n  fc: 21\n}, {\n  lngs: ['he', 'iw'],\n  nr: [1, 2, 20, 21],\n  fc: 22\n}];\nvar _rulesPluralsTypes = {\n  1: function _(n) {\n    return Number(n > 1);\n  },\n  2: function _(n) {\n    return Number(n != 1);\n  },\n  3: function _(n) {\n    return 0;\n  },\n  4: function _(n) {\n    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);\n  },\n  5: function _(n) {\n    return Number(n == 0 ? 0 : n == 1 ? 1 : n == 2 ? 2 : n % 100 >= 3 && n % 100 <= 10 ? 3 : n % 100 >= 11 ? 4 : 5);\n  },\n  6: function _(n) {\n    return Number(n == 1 ? 0 : n >= 2 && n <= 4 ? 1 : 2);\n  },\n  7: function _(n) {\n    return Number(n == 1 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);\n  },\n  8: function _(n) {\n    return Number(n == 1 ? 0 : n == 2 ? 1 : n != 8 && n != 11 ? 2 : 3);\n  },\n  9: function _(n) {\n    return Number(n >= 2);\n  },\n  10: function _(n) {\n    return Number(n == 1 ? 0 : n == 2 ? 1 : n < 7 ? 2 : n < 11 ? 3 : 4);\n  },\n  11: function _(n) {\n    return Number(n == 1 || n == 11 ? 0 : n == 2 || n == 12 ? 1 : n > 2 && n < 20 ? 2 : 3);\n  },\n  12: function _(n) {\n    return Number(n % 10 != 1 || n % 100 == 11);\n  },\n  13: function _(n) {\n    return Number(n !== 0);\n  },\n  14: function _(n) {\n    return Number(n == 1 ? 0 : n == 2 ? 1 : n == 3 ? 2 : 3);\n  },\n  15: function _(n) {\n    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);\n  },\n  16: function _(n) {\n    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n !== 0 ? 1 : 2);\n  },\n  17: function _(n) {\n    return Number(n == 1 || n % 10 == 1 && n % 100 != 11 ? 0 : 1);\n  },\n  18: function _(n) {\n    return Number(n == 0 ? 0 : n == 1 ? 1 : 2);\n  },\n  19: function _(n) {\n    return Number(n == 1 ? 0 : n == 0 || n % 100 > 1 && n % 100 < 11 ? 1 : n % 100 > 10 && n % 100 < 20 ? 2 : 3);\n  },\n  20: function _(n) {\n    return Number(n == 1 ? 0 : n == 0 || n % 100 > 0 && n % 100 < 20 ? 1 : 2);\n  },\n  21: function _(n) {\n    return Number(n % 100 == 1 ? 1 : n % 100 == 2 ? 2 : n % 100 == 3 || n % 100 == 4 ? 3 : 0);\n  },\n  22: function _(n) {\n    return Number(n == 1 ? 0 : n == 2 ? 1 : (n < 0 || n > 10) && n % 10 == 0 ? 2 : 3);\n  }\n};\nvar deprecatedJsonVersions = ['v1', 'v2', 'v3'];\nvar suffixesOrder = {\n  zero: 0,\n  one: 1,\n  two: 2,\n  few: 3,\n  many: 4,\n  other: 5\n};\n\nfunction createRules() {\n  var rules = {};\n  sets.forEach(function (set) {\n    set.lngs.forEach(function (l) {\n      rules[l] = {\n        numbers: set.nr,\n        plurals: _rulesPluralsTypes[set.fc]\n      };\n    });\n  });\n  return rules;\n}\n\nvar PluralResolver = function () {\n  function PluralResolver(languageUtils) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, PluralResolver);\n\n    this.languageUtils = languageUtils;\n    this.options = options;\n    this.logger = baseLogger.create('pluralResolver');\n\n    if ((!this.options.compatibilityJSON || this.options.compatibilityJSON === 'v4') && (typeof Intl === 'undefined' || !Intl.PluralRules)) {\n      this.options.compatibilityJSON = 'v3';\n      this.logger.error('Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.');\n    }\n\n    this.rules = createRules();\n  }\n\n  _createClass(PluralResolver, [{\n    key: \"addRule\",\n    value: function addRule(lng, obj) {\n      this.rules[lng] = obj;\n    }\n  }, {\n    key: \"getRule\",\n    value: function getRule(code) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (this.shouldUseIntlApi()) {\n        try {\n          return new Intl.PluralRules(code, {\n            type: options.ordinal ? 'ordinal' : 'cardinal'\n          });\n        } catch (_unused) {\n          return;\n        }\n      }\n\n      return this.rules[code] || this.rules[this.languageUtils.getLanguagePartFromCode(code)];\n    }\n  }, {\n    key: \"needsPlural\",\n    value: function needsPlural(code) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var rule = this.getRule(code, options);\n\n      if (this.shouldUseIntlApi()) {\n        return rule && rule.resolvedOptions().pluralCategories.length > 1;\n      }\n\n      return rule && rule.numbers.length > 1;\n    }\n  }, {\n    key: \"getPluralFormsOfKey\",\n    value: function getPluralFormsOfKey(code, key) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      return this.getSuffixes(code, options).map(function (suffix) {\n        return \"\".concat(key).concat(suffix);\n      });\n    }\n  }, {\n    key: \"getSuffixes\",\n    value: function getSuffixes(code) {\n      var _this = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var rule = this.getRule(code, options);\n\n      if (!rule) {\n        return [];\n      }\n\n      if (this.shouldUseIntlApi()) {\n        return rule.resolvedOptions().pluralCategories.sort(function (pluralCategory1, pluralCategory2) {\n          return suffixesOrder[pluralCategory1] - suffixesOrder[pluralCategory2];\n        }).map(function (pluralCategory) {\n          return \"\".concat(_this.options.prepend).concat(pluralCategory);\n        });\n      }\n\n      return rule.numbers.map(function (number) {\n        return _this.getSuffix(code, number, options);\n      });\n    }\n  }, {\n    key: \"getSuffix\",\n    value: function getSuffix(code, count) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var rule = this.getRule(code, options);\n\n      if (rule) {\n        if (this.shouldUseIntlApi()) {\n          return \"\".concat(this.options.prepend).concat(rule.select(count));\n        }\n\n        return this.getSuffixRetroCompatible(rule, count);\n      }\n\n      this.logger.warn(\"no plural rule found for: \".concat(code));\n      return '';\n    }\n  }, {\n    key: \"getSuffixRetroCompatible\",\n    value: function getSuffixRetroCompatible(rule, count) {\n      var _this2 = this;\n\n      var idx = rule.noAbs ? rule.plurals(count) : rule.plurals(Math.abs(count));\n      var suffix = rule.numbers[idx];\n\n      if (this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {\n        if (suffix === 2) {\n          suffix = 'plural';\n        } else if (suffix === 1) {\n          suffix = '';\n        }\n      }\n\n      var returnSuffix = function returnSuffix() {\n        return _this2.options.prepend && suffix.toString() ? _this2.options.prepend + suffix.toString() : suffix.toString();\n      };\n\n      if (this.options.compatibilityJSON === 'v1') {\n        if (suffix === 1) return '';\n        if (typeof suffix === 'number') return \"_plural_\".concat(suffix.toString());\n        return returnSuffix();\n      } else if (this.options.compatibilityJSON === 'v2') {\n        return returnSuffix();\n      } else if (this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {\n        return returnSuffix();\n      }\n\n      return this.options.prepend && idx.toString() ? this.options.prepend + idx.toString() : idx.toString();\n    }\n  }, {\n    key: \"shouldUseIntlApi\",\n    value: function shouldUseIntlApi() {\n      return !deprecatedJsonVersions.includes(this.options.compatibilityJSON);\n    }\n  }]);\n\n  return PluralResolver;\n}();\n\nfunction ownKeys$3(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$3(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$3(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$3(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar Interpolator = function () {\n  function Interpolator() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Interpolator);\n\n    this.logger = baseLogger.create('interpolator');\n    this.options = options;\n\n    this.format = options.interpolation && options.interpolation.format || function (value) {\n      return value;\n    };\n\n    this.init(options);\n  }\n\n  _createClass(Interpolator, [{\n    key: \"init\",\n    value: function init() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (!options.interpolation) options.interpolation = {\n        escapeValue: true\n      };\n      var iOpts = options.interpolation;\n      this.escape = iOpts.escape !== undefined ? iOpts.escape : escape;\n      this.escapeValue = iOpts.escapeValue !== undefined ? iOpts.escapeValue : true;\n      this.useRawValueToEscape = iOpts.useRawValueToEscape !== undefined ? iOpts.useRawValueToEscape : false;\n      this.prefix = iOpts.prefix ? regexEscape(iOpts.prefix) : iOpts.prefixEscaped || '{{';\n      this.suffix = iOpts.suffix ? regexEscape(iOpts.suffix) : iOpts.suffixEscaped || '}}';\n      this.formatSeparator = iOpts.formatSeparator ? iOpts.formatSeparator : iOpts.formatSeparator || ',';\n      this.unescapePrefix = iOpts.unescapeSuffix ? '' : iOpts.unescapePrefix || '-';\n      this.unescapeSuffix = this.unescapePrefix ? '' : iOpts.unescapeSuffix || '';\n      this.nestingPrefix = iOpts.nestingPrefix ? regexEscape(iOpts.nestingPrefix) : iOpts.nestingPrefixEscaped || regexEscape('$t(');\n      this.nestingSuffix = iOpts.nestingSuffix ? regexEscape(iOpts.nestingSuffix) : iOpts.nestingSuffixEscaped || regexEscape(')');\n      this.nestingOptionsSeparator = iOpts.nestingOptionsSeparator ? iOpts.nestingOptionsSeparator : iOpts.nestingOptionsSeparator || ',';\n      this.maxReplaces = iOpts.maxReplaces ? iOpts.maxReplaces : 1000;\n      this.alwaysFormat = iOpts.alwaysFormat !== undefined ? iOpts.alwaysFormat : false;\n      this.resetRegExp();\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      if (this.options) this.init(this.options);\n    }\n  }, {\n    key: \"resetRegExp\",\n    value: function resetRegExp() {\n      var regexpStr = \"\".concat(this.prefix, \"(.+?)\").concat(this.suffix);\n      this.regexp = new RegExp(regexpStr, 'g');\n      var regexpUnescapeStr = \"\".concat(this.prefix).concat(this.unescapePrefix, \"(.+?)\").concat(this.unescapeSuffix).concat(this.suffix);\n      this.regexpUnescape = new RegExp(regexpUnescapeStr, 'g');\n      var nestingRegexpStr = \"\".concat(this.nestingPrefix, \"(.+?)\").concat(this.nestingSuffix);\n      this.nestingRegexp = new RegExp(nestingRegexpStr, 'g');\n    }\n  }, {\n    key: \"interpolate\",\n    value: function interpolate(str, data, lng, options) {\n      var _this = this;\n\n      var match;\n      var value;\n      var replaces;\n      var defaultData = this.options && this.options.interpolation && this.options.interpolation.defaultVariables || {};\n\n      function regexSafe(val) {\n        return val.replace(/\\$/g, '$$$$');\n      }\n\n      var handleFormat = function handleFormat(key) {\n        if (key.indexOf(_this.formatSeparator) < 0) {\n          var path = getPathWithDefaults(data, defaultData, key);\n          return _this.alwaysFormat ? _this.format(path, undefined, lng, _objectSpread$3(_objectSpread$3(_objectSpread$3({}, options), data), {}, {\n            interpolationkey: key\n          })) : path;\n        }\n\n        var p = key.split(_this.formatSeparator);\n        var k = p.shift().trim();\n        var f = p.join(_this.formatSeparator).trim();\n        return _this.format(getPathWithDefaults(data, defaultData, k), f, lng, _objectSpread$3(_objectSpread$3(_objectSpread$3({}, options), data), {}, {\n          interpolationkey: k\n        }));\n      };\n\n      this.resetRegExp();\n      var missingInterpolationHandler = options && options.missingInterpolationHandler || this.options.missingInterpolationHandler;\n      var skipOnVariables = options && options.interpolation && options.interpolation.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables;\n      var todos = [{\n        regex: this.regexpUnescape,\n        safeValue: function safeValue(val) {\n          return regexSafe(val);\n        }\n      }, {\n        regex: this.regexp,\n        safeValue: function safeValue(val) {\n          return _this.escapeValue ? regexSafe(_this.escape(val)) : regexSafe(val);\n        }\n      }];\n      todos.forEach(function (todo) {\n        replaces = 0;\n\n        while (match = todo.regex.exec(str)) {\n          var matchedVar = match[1].trim();\n          value = handleFormat(matchedVar);\n\n          if (value === undefined) {\n            if (typeof missingInterpolationHandler === 'function') {\n              var temp = missingInterpolationHandler(str, match, options);\n              value = typeof temp === 'string' ? temp : '';\n            } else if (options && options.hasOwnProperty(matchedVar)) {\n              value = '';\n            } else if (skipOnVariables) {\n              value = match[0];\n              continue;\n            } else {\n              _this.logger.warn(\"missed to pass in variable \".concat(matchedVar, \" for interpolating \").concat(str));\n\n              value = '';\n            }\n          } else if (typeof value !== 'string' && !_this.useRawValueToEscape) {\n            value = makeString(value);\n          }\n\n          var safeValue = todo.safeValue(value);\n          str = str.replace(match[0], safeValue);\n\n          if (skipOnVariables) {\n            todo.regex.lastIndex += value.length;\n            todo.regex.lastIndex -= match[0].length;\n          } else {\n            todo.regex.lastIndex = 0;\n          }\n\n          replaces++;\n\n          if (replaces >= _this.maxReplaces) {\n            break;\n          }\n        }\n      });\n      return str;\n    }\n  }, {\n    key: \"nest\",\n    value: function nest(str, fc) {\n      var _this2 = this;\n\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var match;\n      var value;\n\n      var clonedOptions = _objectSpread$3({}, options);\n\n      clonedOptions.applyPostProcessor = false;\n      delete clonedOptions.defaultValue;\n\n      function handleHasOptions(key, inheritedOptions) {\n        var sep = this.nestingOptionsSeparator;\n        if (key.indexOf(sep) < 0) return key;\n        var c = key.split(new RegExp(\"\".concat(sep, \"[ ]*{\")));\n        var optionsString = \"{\".concat(c[1]);\n        key = c[0];\n        optionsString = this.interpolate(optionsString, clonedOptions);\n        optionsString = optionsString.replace(/'/g, '\"');\n\n        try {\n          clonedOptions = JSON.parse(optionsString);\n          if (inheritedOptions) clonedOptions = _objectSpread$3(_objectSpread$3({}, inheritedOptions), clonedOptions);\n        } catch (e) {\n          this.logger.warn(\"failed parsing options string in nesting for key \".concat(key), e);\n          return \"\".concat(key).concat(sep).concat(optionsString);\n        }\n\n        delete clonedOptions.defaultValue;\n        return key;\n      }\n\n      while (match = this.nestingRegexp.exec(str)) {\n        var formatters = [];\n        var doReduce = false;\n\n        if (match[0].indexOf(this.formatSeparator) !== -1 && !/{.*}/.test(match[1])) {\n          var r = match[1].split(this.formatSeparator).map(function (elem) {\n            return elem.trim();\n          });\n          match[1] = r.shift();\n          formatters = r;\n          doReduce = true;\n        }\n\n        value = fc(handleHasOptions.call(this, match[1].trim(), clonedOptions), clonedOptions);\n        if (value && match[0] === str && typeof value !== 'string') return value;\n        if (typeof value !== 'string') value = makeString(value);\n\n        if (!value) {\n          this.logger.warn(\"missed to resolve \".concat(match[1], \" for nesting \").concat(str));\n          value = '';\n        }\n\n        if (doReduce) {\n          value = formatters.reduce(function (v, f) {\n            return _this2.format(v, f, options.lng, _objectSpread$3(_objectSpread$3({}, options), {}, {\n              interpolationkey: match[1].trim()\n            }));\n          }, value.trim());\n        }\n\n        str = str.replace(match[0], value);\n        this.regexp.lastIndex = 0;\n      }\n\n      return str;\n    }\n  }]);\n\n  return Interpolator;\n}();\n\nfunction ownKeys$4(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$4(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$4(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$4(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction parseFormatStr(formatStr) {\n  var formatName = formatStr.toLowerCase().trim();\n  var formatOptions = {};\n\n  if (formatStr.indexOf('(') > -1) {\n    var p = formatStr.split('(');\n    formatName = p[0].toLowerCase().trim();\n    var optStr = p[1].substring(0, p[1].length - 1);\n\n    if (formatName === 'currency' && optStr.indexOf(':') < 0) {\n      if (!formatOptions.currency) formatOptions.currency = optStr.trim();\n    } else if (formatName === 'relativetime' && optStr.indexOf(':') < 0) {\n      if (!formatOptions.range) formatOptions.range = optStr.trim();\n    } else {\n      var opts = optStr.split(';');\n      opts.forEach(function (opt) {\n        if (!opt) return;\n\n        var _opt$split = opt.split(':'),\n            _opt$split2 = _toArray(_opt$split),\n            key = _opt$split2[0],\n            rest = _opt$split2.slice(1);\n\n        var val = rest.join(':').trim().replace(/^'+|'+$/g, '');\n        if (!formatOptions[key.trim()]) formatOptions[key.trim()] = val;\n        if (val === 'false') formatOptions[key.trim()] = false;\n        if (val === 'true') formatOptions[key.trim()] = true;\n        if (!isNaN(val)) formatOptions[key.trim()] = parseInt(val, 10);\n      });\n    }\n  }\n\n  return {\n    formatName: formatName,\n    formatOptions: formatOptions\n  };\n}\n\nvar Formatter = function () {\n  function Formatter() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Formatter);\n\n    this.logger = baseLogger.create('formatter');\n    this.options = options;\n    this.formats = {\n      number: function number(val, lng, options) {\n        return new Intl.NumberFormat(lng, options).format(val);\n      },\n      currency: function currency(val, lng, options) {\n        return new Intl.NumberFormat(lng, _objectSpread$4(_objectSpread$4({}, options), {}, {\n          style: 'currency'\n        })).format(val);\n      },\n      datetime: function datetime(val, lng, options) {\n        return new Intl.DateTimeFormat(lng, _objectSpread$4({}, options)).format(val);\n      },\n      relativetime: function relativetime(val, lng, options) {\n        return new Intl.RelativeTimeFormat(lng, _objectSpread$4({}, options)).format(val, options.range || 'day');\n      },\n      list: function list(val, lng, options) {\n        return new Intl.ListFormat(lng, _objectSpread$4({}, options)).format(val);\n      }\n    };\n    this.init(options);\n  }\n\n  _createClass(Formatter, [{\n    key: \"init\",\n    value: function init(services) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        interpolation: {}\n      };\n      var iOpts = options.interpolation;\n      this.formatSeparator = iOpts.formatSeparator ? iOpts.formatSeparator : iOpts.formatSeparator || ',';\n    }\n  }, {\n    key: \"add\",\n    value: function add(name, fc) {\n      this.formats[name.toLowerCase().trim()] = fc;\n    }\n  }, {\n    key: \"format\",\n    value: function format(value, _format, lng, options) {\n      var _this = this;\n\n      var formats = _format.split(this.formatSeparator);\n\n      var result = formats.reduce(function (mem, f) {\n        var _parseFormatStr = parseFormatStr(f),\n            formatName = _parseFormatStr.formatName,\n            formatOptions = _parseFormatStr.formatOptions;\n\n        if (_this.formats[formatName]) {\n          var formatted = mem;\n\n          try {\n            var valOptions = options && options.formatParams && options.formatParams[options.interpolationkey] || {};\n            var l = valOptions.locale || valOptions.lng || options.locale || options.lng || lng;\n            formatted = _this.formats[formatName](mem, l, _objectSpread$4(_objectSpread$4(_objectSpread$4({}, formatOptions), options), valOptions));\n          } catch (error) {\n            _this.logger.warn(error);\n          }\n\n          return formatted;\n        } else {\n          _this.logger.warn(\"there was no format function for \".concat(formatName));\n        }\n\n        return mem;\n      }, value);\n      return result;\n    }\n  }]);\n\n  return Formatter;\n}();\n\nfunction ownKeys$5(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$5(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$5(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$5(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper$2(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct$2(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct$2() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction removePending(q, name) {\n  if (q.pending[name] !== undefined) {\n    delete q.pending[name];\n    q.pendingCount--;\n  }\n}\n\nvar Connector = function (_EventEmitter) {\n  _inherits(Connector, _EventEmitter);\n\n  var _super = _createSuper$2(Connector);\n\n  function Connector(backend, store, services) {\n    var _this;\n\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Connector);\n\n    _this = _super.call(this);\n\n    if (isIE10) {\n      EventEmitter.call(_assertThisInitialized(_this));\n    }\n\n    _this.backend = backend;\n    _this.store = store;\n    _this.services = services;\n    _this.languageUtils = services.languageUtils;\n    _this.options = options;\n    _this.logger = baseLogger.create('backendConnector');\n    _this.waitingReads = [];\n    _this.maxParallelReads = options.maxParallelReads || 10;\n    _this.readingCalls = 0;\n    _this.maxRetries = options.maxRetries >= 0 ? options.maxRetries : 5;\n    _this.retryTimeout = options.retryTimeout >= 1 ? options.retryTimeout : 350;\n    _this.state = {};\n    _this.queue = [];\n\n    if (_this.backend && _this.backend.init) {\n      _this.backend.init(services, options.backend, options);\n    }\n\n    return _this;\n  }\n\n  _createClass(Connector, [{\n    key: \"queueLoad\",\n    value: function queueLoad(languages, namespaces, options, callback) {\n      var _this2 = this;\n\n      var toLoad = {};\n      var pending = {};\n      var toLoadLanguages = {};\n      var toLoadNamespaces = {};\n      languages.forEach(function (lng) {\n        var hasAllNamespaces = true;\n        namespaces.forEach(function (ns) {\n          var name = \"\".concat(lng, \"|\").concat(ns);\n\n          if (!options.reload && _this2.store.hasResourceBundle(lng, ns)) {\n            _this2.state[name] = 2;\n          } else if (_this2.state[name] < 0) ; else if (_this2.state[name] === 1) {\n            if (pending[name] === undefined) pending[name] = true;\n          } else {\n            _this2.state[name] = 1;\n            hasAllNamespaces = false;\n            if (pending[name] === undefined) pending[name] = true;\n            if (toLoad[name] === undefined) toLoad[name] = true;\n            if (toLoadNamespaces[ns] === undefined) toLoadNamespaces[ns] = true;\n          }\n        });\n        if (!hasAllNamespaces) toLoadLanguages[lng] = true;\n      });\n\n      if (Object.keys(toLoad).length || Object.keys(pending).length) {\n        this.queue.push({\n          pending: pending,\n          pendingCount: Object.keys(pending).length,\n          loaded: {},\n          errors: [],\n          callback: callback\n        });\n      }\n\n      return {\n        toLoad: Object.keys(toLoad),\n        pending: Object.keys(pending),\n        toLoadLanguages: Object.keys(toLoadLanguages),\n        toLoadNamespaces: Object.keys(toLoadNamespaces)\n      };\n    }\n  }, {\n    key: \"loaded\",\n    value: function loaded(name, err, data) {\n      var s = name.split('|');\n      var lng = s[0];\n      var ns = s[1];\n      if (err) this.emit('failedLoading', lng, ns, err);\n\n      if (data) {\n        this.store.addResourceBundle(lng, ns, data);\n      }\n\n      this.state[name] = err ? -1 : 2;\n      var loaded = {};\n      this.queue.forEach(function (q) {\n        pushPath(q.loaded, [lng], ns);\n        removePending(q, name);\n        if (err) q.errors.push(err);\n\n        if (q.pendingCount === 0 && !q.done) {\n          Object.keys(q.loaded).forEach(function (l) {\n            if (!loaded[l]) loaded[l] = {};\n            var loadedKeys = q.loaded[l];\n\n            if (loadedKeys.length) {\n              loadedKeys.forEach(function (ns) {\n                if (loaded[l][ns] === undefined) loaded[l][ns] = true;\n              });\n            }\n          });\n          q.done = true;\n\n          if (q.errors.length) {\n            q.callback(q.errors);\n          } else {\n            q.callback();\n          }\n        }\n      });\n      this.emit('loaded', loaded);\n      this.queue = this.queue.filter(function (q) {\n        return !q.done;\n      });\n    }\n  }, {\n    key: \"read\",\n    value: function read(lng, ns, fcName) {\n      var _this3 = this;\n\n      var tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : this.retryTimeout;\n      var callback = arguments.length > 5 ? arguments[5] : undefined;\n      if (!lng.length) return callback(null, {});\n\n      if (this.readingCalls >= this.maxParallelReads) {\n        this.waitingReads.push({\n          lng: lng,\n          ns: ns,\n          fcName: fcName,\n          tried: tried,\n          wait: wait,\n          callback: callback\n        });\n        return;\n      }\n\n      this.readingCalls++;\n      return this.backend[fcName](lng, ns, function (err, data) {\n        _this3.readingCalls--;\n\n        if (_this3.waitingReads.length > 0) {\n          var next = _this3.waitingReads.shift();\n\n          _this3.read(next.lng, next.ns, next.fcName, next.tried, next.wait, next.callback);\n        }\n\n        if (err && data && tried < _this3.maxRetries) {\n          setTimeout(function () {\n            _this3.read.call(_this3, lng, ns, fcName, tried + 1, wait * 2, callback);\n          }, wait);\n          return;\n        }\n\n        callback(err, data);\n      });\n    }\n  }, {\n    key: \"prepareLoading\",\n    value: function prepareLoading(languages, namespaces) {\n      var _this4 = this;\n\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var callback = arguments.length > 3 ? arguments[3] : undefined;\n\n      if (!this.backend) {\n        this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n        return callback && callback();\n      }\n\n      if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n      if (typeof namespaces === 'string') namespaces = [namespaces];\n      var toLoad = this.queueLoad(languages, namespaces, options, callback);\n\n      if (!toLoad.toLoad.length) {\n        if (!toLoad.pending.length) callback();\n        return null;\n      }\n\n      toLoad.toLoad.forEach(function (name) {\n        _this4.loadOne(name);\n      });\n    }\n  }, {\n    key: \"load\",\n    value: function load(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {}, callback);\n    }\n  }, {\n    key: \"reload\",\n    value: function reload(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {\n        reload: true\n      }, callback);\n    }\n  }, {\n    key: \"loadOne\",\n    value: function loadOne(name) {\n      var _this5 = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var s = name.split('|');\n      var lng = s[0];\n      var ns = s[1];\n      this.read(lng, ns, 'read', undefined, undefined, function (err, data) {\n        if (err) _this5.logger.warn(\"\".concat(prefix, \"loading namespace \").concat(ns, \" for language \").concat(lng, \" failed\"), err);\n        if (!err && data) _this5.logger.log(\"\".concat(prefix, \"loaded namespace \").concat(ns, \" for language \").concat(lng), data);\n\n        _this5.loaded(name, err, data);\n      });\n    }\n  }, {\n    key: \"saveMissing\",\n    value: function saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n      if (this.services.utils && this.services.utils.hasLoadedNamespace && !this.services.utils.hasLoadedNamespace(namespace)) {\n        this.logger.warn(\"did not save key \\\"\".concat(key, \"\\\" as the namespace \\\"\").concat(namespace, \"\\\" was not yet loaded\"), 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n        return;\n      }\n\n      if (key === undefined || key === null || key === '') return;\n\n      if (this.backend && this.backend.create) {\n        this.backend.create(languages, namespace, key, fallbackValue, null, _objectSpread$5(_objectSpread$5({}, options), {}, {\n          isUpdate: isUpdate\n        }));\n      }\n\n      if (!languages || !languages[0]) return;\n      this.store.addResource(languages[0], namespace, key, fallbackValue);\n    }\n  }]);\n\n  return Connector;\n}(EventEmitter);\n\nfunction get() {\n  return {\n    debug: false,\n    initImmediate: true,\n    ns: ['translation'],\n    defaultNS: ['translation'],\n    fallbackLng: ['dev'],\n    fallbackNS: false,\n    supportedLngs: false,\n    nonExplicitSupportedLngs: false,\n    load: 'all',\n    preload: false,\n    simplifyPluralSuffix: true,\n    keySeparator: '.',\n    nsSeparator: ':',\n    pluralSeparator: '_',\n    contextSeparator: '_',\n    partialBundledLanguages: false,\n    saveMissing: false,\n    updateMissing: false,\n    saveMissingTo: 'fallback',\n    saveMissingPlurals: true,\n    missingKeyHandler: false,\n    missingInterpolationHandler: false,\n    postProcess: false,\n    postProcessPassResolved: false,\n    returnNull: true,\n    returnEmptyString: true,\n    returnObjects: false,\n    joinArrays: false,\n    returnedObjectHandler: false,\n    parseMissingKeyHandler: false,\n    appendNamespaceToMissingKey: false,\n    appendNamespaceToCIMode: false,\n    overloadTranslationOptionHandler: function handle(args) {\n      var ret = {};\n      if (_typeof(args[1]) === 'object') ret = args[1];\n      if (typeof args[1] === 'string') ret.defaultValue = args[1];\n      if (typeof args[2] === 'string') ret.tDescription = args[2];\n\n      if (_typeof(args[2]) === 'object' || _typeof(args[3]) === 'object') {\n        var options = args[3] || args[2];\n        Object.keys(options).forEach(function (key) {\n          ret[key] = options[key];\n        });\n      }\n\n      return ret;\n    },\n    interpolation: {\n      escapeValue: true,\n      format: function format(value, _format, lng, options) {\n        return value;\n      },\n      prefix: '{{',\n      suffix: '}}',\n      formatSeparator: ',',\n      unescapePrefix: '-',\n      nestingPrefix: '$t(',\n      nestingSuffix: ')',\n      nestingOptionsSeparator: ',',\n      maxReplaces: 1000,\n      skipOnVariables: true\n    }\n  };\n}\nfunction transformOptions(options) {\n  if (typeof options.ns === 'string') options.ns = [options.ns];\n  if (typeof options.fallbackLng === 'string') options.fallbackLng = [options.fallbackLng];\n  if (typeof options.fallbackNS === 'string') options.fallbackNS = [options.fallbackNS];\n\n  if (options.supportedLngs && options.supportedLngs.indexOf('cimode') < 0) {\n    options.supportedLngs = options.supportedLngs.concat(['cimode']);\n  }\n\n  return options;\n}\n\nfunction ownKeys$6(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$6(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$6(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$6(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper$3(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct$3(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct$3() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction noop() {}\n\nfunction bindMemberFunctions(inst) {\n  var mems = Object.getOwnPropertyNames(Object.getPrototypeOf(inst));\n  mems.forEach(function (mem) {\n    if (typeof inst[mem] === 'function') {\n      inst[mem] = inst[mem].bind(inst);\n    }\n  });\n}\n\nvar I18n = function (_EventEmitter) {\n  _inherits(I18n, _EventEmitter);\n\n  var _super = _createSuper$3(I18n);\n\n  function I18n() {\n    var _this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var callback = arguments.length > 1 ? arguments[1] : undefined;\n\n    _classCallCheck(this, I18n);\n\n    _this = _super.call(this);\n\n    if (isIE10) {\n      EventEmitter.call(_assertThisInitialized(_this));\n    }\n\n    _this.options = transformOptions(options);\n    _this.services = {};\n    _this.logger = baseLogger;\n    _this.modules = {\n      external: []\n    };\n    bindMemberFunctions(_assertThisInitialized(_this));\n\n    if (callback && !_this.isInitialized && !options.isClone) {\n      if (!_this.options.initImmediate) {\n        _this.init(options, callback);\n\n        return _possibleConstructorReturn(_this, _assertThisInitialized(_this));\n      }\n\n      setTimeout(function () {\n        _this.init(options, callback);\n      }, 0);\n    }\n\n    return _this;\n  }\n\n  _createClass(I18n, [{\n    key: \"init\",\n    value: function init() {\n      var _this2 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var callback = arguments.length > 1 ? arguments[1] : undefined;\n\n      if (typeof options === 'function') {\n        callback = options;\n        options = {};\n      }\n\n      if (!options.defaultNS && options.defaultNS !== false && options.ns) {\n        if (typeof options.ns === 'string') {\n          options.defaultNS = options.ns;\n        } else if (options.ns.indexOf('translation') < 0) {\n          options.defaultNS = options.ns[0];\n        }\n      }\n\n      var defOpts = get();\n      this.options = _objectSpread$6(_objectSpread$6(_objectSpread$6({}, defOpts), this.options), transformOptions(options));\n\n      if (this.options.compatibilityAPI !== 'v1') {\n        this.options.interpolation = _objectSpread$6(_objectSpread$6({}, defOpts.interpolation), this.options.interpolation);\n      }\n\n      if (options.keySeparator !== undefined) {\n        this.options.userDefinedKeySeparator = options.keySeparator;\n      }\n\n      if (options.nsSeparator !== undefined) {\n        this.options.userDefinedNsSeparator = options.nsSeparator;\n      }\n\n      function createClassOnDemand(ClassOrObject) {\n        if (!ClassOrObject) return null;\n        if (typeof ClassOrObject === 'function') return new ClassOrObject();\n        return ClassOrObject;\n      }\n\n      if (!this.options.isClone) {\n        if (this.modules.logger) {\n          baseLogger.init(createClassOnDemand(this.modules.logger), this.options);\n        } else {\n          baseLogger.init(null, this.options);\n        }\n\n        var formatter;\n\n        if (this.modules.formatter) {\n          formatter = this.modules.formatter;\n        } else if (typeof Intl !== 'undefined') {\n          formatter = Formatter;\n        }\n\n        var lu = new LanguageUtil(this.options);\n        this.store = new ResourceStore(this.options.resources, this.options);\n        var s = this.services;\n        s.logger = baseLogger;\n        s.resourceStore = this.store;\n        s.languageUtils = lu;\n        s.pluralResolver = new PluralResolver(lu, {\n          prepend: this.options.pluralSeparator,\n          compatibilityJSON: this.options.compatibilityJSON,\n          simplifyPluralSuffix: this.options.simplifyPluralSuffix\n        });\n\n        if (formatter && (!this.options.interpolation.format || this.options.interpolation.format === defOpts.interpolation.format)) {\n          s.formatter = createClassOnDemand(formatter);\n          s.formatter.init(s, this.options);\n          this.options.interpolation.format = s.formatter.format.bind(s.formatter);\n        }\n\n        s.interpolator = new Interpolator(this.options);\n        s.utils = {\n          hasLoadedNamespace: this.hasLoadedNamespace.bind(this)\n        };\n        s.backendConnector = new Connector(createClassOnDemand(this.modules.backend), s.resourceStore, s, this.options);\n        s.backendConnector.on('*', function (event) {\n          for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n            args[_key - 1] = arguments[_key];\n          }\n\n          _this2.emit.apply(_this2, [event].concat(args));\n        });\n\n        if (this.modules.languageDetector) {\n          s.languageDetector = createClassOnDemand(this.modules.languageDetector);\n          s.languageDetector.init(s, this.options.detection, this.options);\n        }\n\n        if (this.modules.i18nFormat) {\n          s.i18nFormat = createClassOnDemand(this.modules.i18nFormat);\n          if (s.i18nFormat.init) s.i18nFormat.init(this);\n        }\n\n        this.translator = new Translator(this.services, this.options);\n        this.translator.on('*', function (event) {\n          for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n            args[_key2 - 1] = arguments[_key2];\n          }\n\n          _this2.emit.apply(_this2, [event].concat(args));\n        });\n        this.modules.external.forEach(function (m) {\n          if (m.init) m.init(_this2);\n        });\n      }\n\n      this.format = this.options.interpolation.format;\n      if (!callback) callback = noop;\n\n      if (this.options.fallbackLng && !this.services.languageDetector && !this.options.lng) {\n        var codes = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);\n        if (codes.length > 0 && codes[0] !== 'dev') this.options.lng = codes[0];\n      }\n\n      if (!this.services.languageDetector && !this.options.lng) {\n        this.logger.warn('init: no languageDetector is used and no lng is defined');\n      }\n\n      var storeApi = ['getResource', 'hasResourceBundle', 'getResourceBundle', 'getDataByLanguage'];\n      storeApi.forEach(function (fcName) {\n        _this2[fcName] = function () {\n          var _this2$store;\n\n          return (_this2$store = _this2.store)[fcName].apply(_this2$store, arguments);\n        };\n      });\n      var storeApiChained = ['addResource', 'addResources', 'addResourceBundle', 'removeResourceBundle'];\n      storeApiChained.forEach(function (fcName) {\n        _this2[fcName] = function () {\n          var _this2$store2;\n\n          (_this2$store2 = _this2.store)[fcName].apply(_this2$store2, arguments);\n\n          return _this2;\n        };\n      });\n      var deferred = defer();\n\n      var load = function load() {\n        var finish = function finish(err, t) {\n          if (_this2.isInitialized && !_this2.initializedStoreOnce) _this2.logger.warn('init: i18next is already initialized. You should call init just once!');\n          _this2.isInitialized = true;\n          if (!_this2.options.isClone) _this2.logger.log('initialized', _this2.options);\n\n          _this2.emit('initialized', _this2.options);\n\n          deferred.resolve(t);\n          callback(err, t);\n        };\n\n        if (_this2.languages && _this2.options.compatibilityAPI !== 'v1' && !_this2.isInitialized) return finish(null, _this2.t.bind(_this2));\n\n        _this2.changeLanguage(_this2.options.lng, finish);\n      };\n\n      if (this.options.resources || !this.options.initImmediate) {\n        load();\n      } else {\n        setTimeout(load, 0);\n      }\n\n      return deferred;\n    }\n  }, {\n    key: \"loadResources\",\n    value: function loadResources(language) {\n      var _this3 = this;\n\n      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n      var usedCallback = callback;\n      var usedLng = typeof language === 'string' ? language : this.language;\n      if (typeof language === 'function') usedCallback = language;\n\n      if (!this.options.resources || this.options.partialBundledLanguages) {\n        if (usedLng && usedLng.toLowerCase() === 'cimode') return usedCallback();\n        var toLoad = [];\n\n        var append = function append(lng) {\n          if (!lng) return;\n\n          var lngs = _this3.services.languageUtils.toResolveHierarchy(lng);\n\n          lngs.forEach(function (l) {\n            if (toLoad.indexOf(l) < 0) toLoad.push(l);\n          });\n        };\n\n        if (!usedLng) {\n          var fallbacks = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);\n          fallbacks.forEach(function (l) {\n            return append(l);\n          });\n        } else {\n          append(usedLng);\n        }\n\n        if (this.options.preload) {\n          this.options.preload.forEach(function (l) {\n            return append(l);\n          });\n        }\n\n        this.services.backendConnector.load(toLoad, this.options.ns, function (e) {\n          if (!e && !_this3.resolvedLanguage && _this3.language) _this3.setResolvedLanguage(_this3.language);\n          usedCallback(e);\n        });\n      } else {\n        usedCallback(null);\n      }\n    }\n  }, {\n    key: \"reloadResources\",\n    value: function reloadResources(lngs, ns, callback) {\n      var deferred = defer();\n      if (!lngs) lngs = this.languages;\n      if (!ns) ns = this.options.ns;\n      if (!callback) callback = noop;\n      this.services.backendConnector.reload(lngs, ns, function (err) {\n        deferred.resolve();\n        callback(err);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"use\",\n    value: function use(module) {\n      if (!module) throw new Error('You are passing an undefined module! Please check the object you are passing to i18next.use()');\n      if (!module.type) throw new Error('You are passing a wrong module! Please check the object you are passing to i18next.use()');\n\n      if (module.type === 'backend') {\n        this.modules.backend = module;\n      }\n\n      if (module.type === 'logger' || module.log && module.warn && module.error) {\n        this.modules.logger = module;\n      }\n\n      if (module.type === 'languageDetector') {\n        this.modules.languageDetector = module;\n      }\n\n      if (module.type === 'i18nFormat') {\n        this.modules.i18nFormat = module;\n      }\n\n      if (module.type === 'postProcessor') {\n        postProcessor.addPostProcessor(module);\n      }\n\n      if (module.type === 'formatter') {\n        this.modules.formatter = module;\n      }\n\n      if (module.type === '3rdParty') {\n        this.modules.external.push(module);\n      }\n\n      return this;\n    }\n  }, {\n    key: \"setResolvedLanguage\",\n    value: function setResolvedLanguage(l) {\n      if (!l || !this.languages) return;\n      if (['cimode', 'dev'].indexOf(l) > -1) return;\n\n      for (var li = 0; li < this.languages.length; li++) {\n        var lngInLngs = this.languages[li];\n        if (['cimode', 'dev'].indexOf(lngInLngs) > -1) continue;\n\n        if (this.store.hasLanguageSomeTranslations(lngInLngs)) {\n          this.resolvedLanguage = lngInLngs;\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"changeLanguage\",\n    value: function changeLanguage(lng, callback) {\n      var _this4 = this;\n\n      this.isLanguageChangingTo = lng;\n      var deferred = defer();\n      this.emit('languageChanging', lng);\n\n      var setLngProps = function setLngProps(l) {\n        _this4.language = l;\n        _this4.languages = _this4.services.languageUtils.toResolveHierarchy(l);\n        _this4.resolvedLanguage = undefined;\n\n        _this4.setResolvedLanguage(l);\n      };\n\n      var done = function done(err, l) {\n        if (l) {\n          setLngProps(l);\n\n          _this4.translator.changeLanguage(l);\n\n          _this4.isLanguageChangingTo = undefined;\n\n          _this4.emit('languageChanged', l);\n\n          _this4.logger.log('languageChanged', l);\n        } else {\n          _this4.isLanguageChangingTo = undefined;\n        }\n\n        deferred.resolve(function () {\n          return _this4.t.apply(_this4, arguments);\n        });\n        if (callback) callback(err, function () {\n          return _this4.t.apply(_this4, arguments);\n        });\n      };\n\n      var setLng = function setLng(lngs) {\n        if (!lng && !lngs && _this4.services.languageDetector) lngs = [];\n        var l = typeof lngs === 'string' ? lngs : _this4.services.languageUtils.getBestMatchFromCodes(lngs);\n\n        if (l) {\n          if (!_this4.language) {\n            setLngProps(l);\n          }\n\n          if (!_this4.translator.language) _this4.translator.changeLanguage(l);\n          if (_this4.services.languageDetector) _this4.services.languageDetector.cacheUserLanguage(l);\n        }\n\n        _this4.loadResources(l, function (err) {\n          done(err, l);\n        });\n      };\n\n      if (!lng && this.services.languageDetector && !this.services.languageDetector.async) {\n        setLng(this.services.languageDetector.detect());\n      } else if (!lng && this.services.languageDetector && this.services.languageDetector.async) {\n        this.services.languageDetector.detect(setLng);\n      } else {\n        setLng(lng);\n      }\n\n      return deferred;\n    }\n  }, {\n    key: \"getFixedT\",\n    value: function getFixedT(lng, ns, keyPrefix) {\n      var _this5 = this;\n\n      var fixedT = function fixedT(key, opts) {\n        var options;\n\n        if (_typeof(opts) !== 'object') {\n          for (var _len3 = arguments.length, rest = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n            rest[_key3 - 2] = arguments[_key3];\n          }\n\n          options = _this5.options.overloadTranslationOptionHandler([key, opts].concat(rest));\n        } else {\n          options = _objectSpread$6({}, opts);\n        }\n\n        options.lng = options.lng || fixedT.lng;\n        options.lngs = options.lngs || fixedT.lngs;\n        options.ns = options.ns || fixedT.ns;\n        options.keyPrefix = options.keyPrefix || keyPrefix || fixedT.keyPrefix;\n        var keySeparator = _this5.options.keySeparator || '.';\n        var resultKey = options.keyPrefix ? \"\".concat(options.keyPrefix).concat(keySeparator).concat(key) : key;\n        return _this5.t(resultKey, options);\n      };\n\n      if (typeof lng === 'string') {\n        fixedT.lng = lng;\n      } else {\n        fixedT.lngs = lng;\n      }\n\n      fixedT.ns = ns;\n      fixedT.keyPrefix = keyPrefix;\n      return fixedT;\n    }\n  }, {\n    key: \"t\",\n    value: function t() {\n      var _this$translator;\n\n      return this.translator && (_this$translator = this.translator).translate.apply(_this$translator, arguments);\n    }\n  }, {\n    key: \"exists\",\n    value: function exists() {\n      var _this$translator2;\n\n      return this.translator && (_this$translator2 = this.translator).exists.apply(_this$translator2, arguments);\n    }\n  }, {\n    key: \"setDefaultNamespace\",\n    value: function setDefaultNamespace(ns) {\n      this.options.defaultNS = ns;\n    }\n  }, {\n    key: \"hasLoadedNamespace\",\n    value: function hasLoadedNamespace(ns) {\n      var _this6 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (!this.isInitialized) {\n        this.logger.warn('hasLoadedNamespace: i18next was not initialized', this.languages);\n        return false;\n      }\n\n      if (!this.languages || !this.languages.length) {\n        this.logger.warn('hasLoadedNamespace: i18n.languages were undefined or empty', this.languages);\n        return false;\n      }\n\n      var lng = this.resolvedLanguage || this.languages[0];\n      var fallbackLng = this.options ? this.options.fallbackLng : false;\n      var lastLng = this.languages[this.languages.length - 1];\n      if (lng.toLowerCase() === 'cimode') return true;\n\n      var loadNotPending = function loadNotPending(l, n) {\n        var loadState = _this6.services.backendConnector.state[\"\".concat(l, \"|\").concat(n)];\n\n        return loadState === -1 || loadState === 2;\n      };\n\n      if (options.precheck) {\n        var preResult = options.precheck(this, loadNotPending);\n        if (preResult !== undefined) return preResult;\n      }\n\n      if (this.hasResourceBundle(lng, ns)) return true;\n      if (!this.services.backendConnector.backend || this.options.resources && !this.options.partialBundledLanguages) return true;\n      if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;\n      return false;\n    }\n  }, {\n    key: \"loadNamespaces\",\n    value: function loadNamespaces(ns, callback) {\n      var _this7 = this;\n\n      var deferred = defer();\n\n      if (!this.options.ns) {\n        callback && callback();\n        return Promise.resolve();\n      }\n\n      if (typeof ns === 'string') ns = [ns];\n      ns.forEach(function (n) {\n        if (_this7.options.ns.indexOf(n) < 0) _this7.options.ns.push(n);\n      });\n      this.loadResources(function (err) {\n        deferred.resolve();\n        if (callback) callback(err);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"loadLanguages\",\n    value: function loadLanguages(lngs, callback) {\n      var deferred = defer();\n      if (typeof lngs === 'string') lngs = [lngs];\n      var preloaded = this.options.preload || [];\n      var newLngs = lngs.filter(function (lng) {\n        return preloaded.indexOf(lng) < 0;\n      });\n\n      if (!newLngs.length) {\n        if (callback) callback();\n        return Promise.resolve();\n      }\n\n      this.options.preload = preloaded.concat(newLngs);\n      this.loadResources(function (err) {\n        deferred.resolve();\n        if (callback) callback(err);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"dir\",\n    value: function dir(lng) {\n      if (!lng) lng = this.resolvedLanguage || (this.languages && this.languages.length > 0 ? this.languages[0] : this.language);\n      if (!lng) return 'rtl';\n      var rtlLngs = ['ar', 'shu', 'sqr', 'ssh', 'xaa', 'yhd', 'yud', 'aao', 'abh', 'abv', 'acm', 'acq', 'acw', 'acx', 'acy', 'adf', 'ads', 'aeb', 'aec', 'afb', 'ajp', 'apc', 'apd', 'arb', 'arq', 'ars', 'ary', 'arz', 'auz', 'avl', 'ayh', 'ayl', 'ayn', 'ayp', 'bbz', 'pga', 'he', 'iw', 'ps', 'pbt', 'pbu', 'pst', 'prp', 'prd', 'ug', 'ur', 'ydd', 'yds', 'yih', 'ji', 'yi', 'hbo', 'men', 'xmn', 'fa', 'jpr', 'peo', 'pes', 'prs', 'dv', 'sam', 'ckb'];\n      return rtlLngs.indexOf(this.services.languageUtils.getLanguagePartFromCode(lng)) > -1 || lng.toLowerCase().indexOf('-arab') > 1 ? 'rtl' : 'ltr';\n    }\n  }, {\n    key: \"cloneInstance\",\n    value: function cloneInstance() {\n      var _this8 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n\n      var mergedOptions = _objectSpread$6(_objectSpread$6(_objectSpread$6({}, this.options), options), {\n        isClone: true\n      });\n\n      var clone = new I18n(mergedOptions);\n      var membersToCopy = ['store', 'services', 'language'];\n      membersToCopy.forEach(function (m) {\n        clone[m] = _this8[m];\n      });\n      clone.services = _objectSpread$6({}, this.services);\n      clone.services.utils = {\n        hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n      };\n      clone.translator = new Translator(clone.services, clone.options);\n      clone.translator.on('*', function (event) {\n        for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n          args[_key4 - 1] = arguments[_key4];\n        }\n\n        clone.emit.apply(clone, [event].concat(args));\n      });\n      clone.init(mergedOptions, callback);\n      clone.translator.options = clone.options;\n      clone.translator.backendConnector.services.utils = {\n        hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n      };\n      return clone;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        options: this.options,\n        store: this.store,\n        language: this.language,\n        languages: this.languages,\n        resolvedLanguage: this.resolvedLanguage\n      };\n    }\n  }]);\n\n  return I18n;\n}(EventEmitter);\n\n_defineProperty(I18n, \"createInstance\", function () {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var callback = arguments.length > 1 ? arguments[1] : undefined;\n  return new I18n(options, callback);\n});\n\nvar instance = I18n.createInstance();\ninstance.createInstance = I18n.createInstance;\n\nvar createInstance = instance.createInstance;\nvar init = instance.init;\nvar loadResources = instance.loadResources;\nvar reloadResources = instance.reloadResources;\nvar use = instance.use;\nvar changeLanguage = instance.changeLanguage;\nvar getFixedT = instance.getFixedT;\nvar t = instance.t;\nvar exists = instance.exists;\nvar setDefaultNamespace = instance.setDefaultNamespace;\nvar hasLoadedNamespace = instance.hasLoadedNamespace;\nvar loadNamespaces = instance.loadNamespaces;\nvar loadLanguages = instance.loadLanguages;\n\nexport default instance;\nexport { changeLanguage, createInstance, exists, getFixedT, hasLoadedNamespace, init, loadLanguages, loadNamespaces, loadResources, reloadResources, setDefaultNamespace, t, use };\n","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _toArray(arr) {\n  return arrayWithHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nvar arr = [];\nvar each = arr.forEach;\nvar slice = arr.slice;\nexport function defaults(obj) {\n  each.call(slice.call(arguments, 1), function (source) {\n    if (source) {\n      for (var prop in source) {\n        if (obj[prop] === undefined) obj[prop] = source[prop];\n      }\n    }\n  });\n  return obj;\n}\nexport function hasXMLHttpRequest() {\n  return typeof XMLHttpRequest === 'function' || (typeof XMLHttpRequest === \"undefined\" ? \"undefined\" : _typeof(XMLHttpRequest)) === 'object';\n}\n\nfunction isPromise(maybePromise) {\n  return !!maybePromise && typeof maybePromise.then === 'function';\n}\n\nexport function makePromise(maybePromise) {\n  if (isPromise(maybePromise)) {\n    return maybePromise;\n  }\n\n  return Promise.resolve(maybePromise);\n}","function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nimport { defaults, hasXMLHttpRequest } from './utils.js';\nimport * as fetchNode from './getFetch.cjs';\nvar fetchApi;\n\nif (typeof fetch === 'function') {\n  if (typeof global !== 'undefined' && global.fetch) {\n    fetchApi = global.fetch;\n  } else if (typeof window !== 'undefined' && window.fetch) {\n    fetchApi = window.fetch;\n  }\n}\n\nvar XmlHttpRequestApi;\n\nif (hasXMLHttpRequest()) {\n  if (typeof global !== 'undefined' && global.XMLHttpRequest) {\n    XmlHttpRequestApi = global.XMLHttpRequest;\n  } else if (typeof window !== 'undefined' && window.XMLHttpRequest) {\n    XmlHttpRequestApi = window.XMLHttpRequest;\n  }\n}\n\nvar ActiveXObjectApi;\n\nif (typeof ActiveXObject === 'function') {\n  if (typeof global !== 'undefined' && global.ActiveXObject) {\n    ActiveXObjectApi = global.ActiveXObject;\n  } else if (typeof window !== 'undefined' && window.ActiveXObject) {\n    ActiveXObjectApi = window.ActiveXObject;\n  }\n}\n\nif (!fetchApi && fetchNode && !XmlHttpRequestApi && !ActiveXObjectApi) fetchApi = fetchNode.default || fetchNode;\nif (typeof fetchApi !== 'function') fetchApi = undefined;\n\nvar addQueryString = function addQueryString(url, params) {\n  if (params && _typeof(params) === 'object') {\n    var queryString = '';\n\n    for (var paramName in params) {\n      queryString += '&' + encodeURIComponent(paramName) + '=' + encodeURIComponent(params[paramName]);\n    }\n\n    if (!queryString) return url;\n    url = url + (url.indexOf('?') !== -1 ? '&' : '?') + queryString.slice(1);\n  }\n\n  return url;\n};\n\nvar requestWithFetch = function requestWithFetch(options, url, payload, callback) {\n  if (options.queryStringParams) {\n    url = addQueryString(url, options.queryStringParams);\n  }\n\n  var headers = defaults({}, typeof options.customHeaders === 'function' ? options.customHeaders() : options.customHeaders);\n  if (payload) headers['Content-Type'] = 'application/json';\n  fetchApi(url, defaults({\n    method: payload ? 'POST' : 'GET',\n    body: payload ? options.stringify(payload) : undefined,\n    headers: headers\n  }, typeof options.requestOptions === 'function' ? options.requestOptions(payload) : options.requestOptions)).then(function (response) {\n    if (!response.ok) return callback(response.statusText || 'Error', {\n      status: response.status\n    });\n    response.text().then(function (data) {\n      callback(null, {\n        status: response.status,\n        data: data\n      });\n    }).catch(callback);\n  }).catch(callback);\n};\n\nvar requestWithXmlHttpRequest = function requestWithXmlHttpRequest(options, url, payload, callback) {\n  if (payload && _typeof(payload) === 'object') {\n    payload = addQueryString('', payload).slice(1);\n  }\n\n  if (options.queryStringParams) {\n    url = addQueryString(url, options.queryStringParams);\n  }\n\n  try {\n    var x;\n\n    if (XmlHttpRequestApi) {\n      x = new XmlHttpRequestApi();\n    } else {\n      x = new ActiveXObjectApi('MSXML2.XMLHTTP.3.0');\n    }\n\n    x.open(payload ? 'POST' : 'GET', url, 1);\n\n    if (!options.crossDomain) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n\n    x.withCredentials = !!options.withCredentials;\n\n    if (payload) {\n      x.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    if (x.overrideMimeType) {\n      x.overrideMimeType('application/json');\n    }\n\n    var h = options.customHeaders;\n    h = typeof h === 'function' ? h() : h;\n\n    if (h) {\n      for (var i in h) {\n        x.setRequestHeader(i, h[i]);\n      }\n    }\n\n    x.onreadystatechange = function () {\n      x.readyState > 3 && callback(x.status >= 400 ? x.statusText : null, {\n        status: x.status,\n        data: x.responseText\n      });\n    };\n\n    x.send(payload);\n  } catch (e) {\n    console && console.log(e);\n  }\n};\n\nvar request = function request(options, url, payload, callback) {\n  if (typeof payload === 'function') {\n    callback = payload;\n    payload = undefined;\n  }\n\n  callback = callback || function () {};\n\n  if (fetchApi) {\n    return requestWithFetch(options, url, payload, callback);\n  }\n\n  if (hasXMLHttpRequest() || typeof ActiveXObject === 'function') {\n    return requestWithXmlHttpRequest(options, url, payload, callback);\n  }\n};\n\nexport default request;","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { defaults, makePromise } from './utils.js';\nimport request from './request.js';\n\nvar getDefaults = function getDefaults() {\n  return {\n    loadPath: '/locales/{{lng}}/{{ns}}.json',\n    addPath: '/locales/add/{{lng}}/{{ns}}',\n    allowMultiLoading: false,\n    parse: function parse(data) {\n      return JSON.parse(data);\n    },\n    stringify: JSON.stringify,\n    parsePayload: function parsePayload(namespace, key, fallbackValue) {\n      return _defineProperty({}, key, fallbackValue || '');\n    },\n    request: request,\n    reloadInterval: typeof window !== 'undefined' ? false : 60 * 60 * 1000,\n    customHeaders: {},\n    queryStringParams: {},\n    crossDomain: false,\n    withCredentials: false,\n    overrideMimeType: false,\n    requestOptions: {\n      mode: 'cors',\n      credentials: 'same-origin',\n      cache: 'default'\n    }\n  };\n};\n\nvar Backend = function () {\n  function Backend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    _classCallCheck(this, Backend);\n\n    this.services = services;\n    this.options = options;\n    this.allOptions = allOptions;\n    this.type = 'backend';\n    this.init(services, options, allOptions);\n  }\n\n  _createClass(Backend, [{\n    key: \"init\",\n    value: function init(services) {\n      var _this = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      this.services = services;\n      this.options = defaults(options, this.options || {}, getDefaults());\n      this.allOptions = allOptions;\n\n      if (this.services && this.options.reloadInterval) {\n        setInterval(function () {\n          return _this.reload();\n        }, this.options.reloadInterval);\n      }\n    }\n  }, {\n    key: \"readMulti\",\n    value: function readMulti(languages, namespaces, callback) {\n      this._readAny(languages, languages, namespaces, namespaces, callback);\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      this._readAny([language], language, [namespace], namespace, callback);\n    }\n  }, {\n    key: \"_readAny\",\n    value: function _readAny(languages, loadUrlLanguages, namespaces, loadUrlNamespaces, callback) {\n      var _this2 = this;\n\n      var loadPath = this.options.loadPath;\n\n      if (typeof this.options.loadPath === 'function') {\n        loadPath = this.options.loadPath(languages, namespaces);\n      }\n\n      loadPath = makePromise(loadPath);\n      loadPath.then(function (resolvedLoadPath) {\n        if (!resolvedLoadPath) return callback(null, {});\n\n        var url = _this2.services.interpolator.interpolate(resolvedLoadPath, {\n          lng: languages.join('+'),\n          ns: namespaces.join('+')\n        });\n\n        _this2.loadUrl(url, callback, loadUrlLanguages, loadUrlNamespaces);\n      });\n    }\n  }, {\n    key: \"loadUrl\",\n    value: function loadUrl(url, callback, languages, namespaces) {\n      var _this3 = this;\n\n      this.options.request(this.options, url, undefined, function (err, res) {\n        if (res && (res.status >= 500 && res.status < 600 || !res.status)) return callback('failed loading ' + url + '; status code: ' + res.status, true);\n        if (res && res.status >= 400 && res.status < 500) return callback('failed loading ' + url + '; status code: ' + res.status, false);\n        if (!res && err && err.message && err.message.indexOf('Failed to fetch') > -1) return callback('failed loading ' + url + ': ' + err.message, true);\n        if (err) return callback(err, false);\n        var ret, parseErr;\n\n        try {\n          if (typeof res.data === 'string') {\n            ret = _this3.options.parse(res.data, languages, namespaces);\n          } else {\n            ret = res.data;\n          }\n        } catch (e) {\n          parseErr = 'failed parsing ' + url + ' to json';\n        }\n\n        if (parseErr) return callback(parseErr, false);\n        callback(null, ret);\n      });\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue, callback) {\n      var _this4 = this;\n\n      if (!this.options.addPath) return;\n      if (typeof languages === 'string') languages = [languages];\n      var payload = this.options.parsePayload(namespace, key, fallbackValue);\n      var finished = 0;\n      var dataArray = [];\n      var resArray = [];\n      languages.forEach(function (lng) {\n        var addPath = _this4.options.addPath;\n\n        if (typeof _this4.options.addPath === 'function') {\n          addPath = _this4.options.addPath(lng, namespace);\n        }\n\n        var url = _this4.services.interpolator.interpolate(addPath, {\n          lng: lng,\n          ns: namespace\n        });\n\n        _this4.options.request(_this4.options, url, payload, function (data, res) {\n          finished += 1;\n          dataArray.push(data);\n          resArray.push(res);\n\n          if (finished === languages.length) {\n            if (callback) callback(dataArray, resArray);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"reload\",\n    value: function reload() {\n      var _this5 = this;\n\n      var _this$services = this.services,\n          backendConnector = _this$services.backendConnector,\n          languageUtils = _this$services.languageUtils,\n          logger = _this$services.logger;\n      var currentLanguage = backendConnector.language;\n      if (currentLanguage && currentLanguage.toLowerCase() === 'cimode') return;\n      var toLoad = [];\n\n      var append = function append(lng) {\n        var lngs = languageUtils.toResolveHierarchy(lng);\n        lngs.forEach(function (l) {\n          if (toLoad.indexOf(l) < 0) toLoad.push(l);\n        });\n      };\n\n      append(currentLanguage);\n      if (this.allOptions.preload) this.allOptions.preload.forEach(function (l) {\n        return append(l);\n      });\n      toLoad.forEach(function (lng) {\n        _this5.allOptions.ns.forEach(function (ns) {\n          backendConnector.read(lng, ns, 'read', null, null, function (err, data) {\n            if (err) logger.warn(\"loading namespace \".concat(ns, \" for language \").concat(lng, \" failed\"), err);\n            if (!err && data) logger.log(\"loaded namespace \".concat(ns, \" for language \").concat(lng), data);\n            backendConnector.loaded(\"\".concat(lng, \"|\").concat(ns), err, data);\n          });\n        });\n      });\n    }\n  }]);\n\n  return Backend;\n}();\n\nBackend.type = 'backend';\nexport default Backend;","import { Translator } from '.';\r\n\r\n/**\r\n * provide an official translate API for 2sxc\r\n * @param key\r\n * @internal\r\n */\r\nexport function translate(key: string): string { return Translator.translate(key); }\r\n","import i18next, { i18n } from 'i18next';\r\nimport XHR from 'i18next-http-backend';\r\n// @ts-ignore\r\nimport locI18next from 'loc-i18next';\r\nimport { primaryLanguage, translations, translationsPath } from '.';\r\nimport { IDs } from '../constants/ids';\r\nimport { ContextComplete } from '../context/bundles';\r\nimport { HasLog, Insights, flattenSlashes } from '../core';\r\nimport { EditManager } from '../manage/edit-manager';\r\nimport { SxcTools } from '../sxc/sxc-tools';\r\n\r\nlet localize: any;\r\n// let initialized: boolean = false;\r\n\r\nclass TranslatorGlobal extends HasLog {\r\n    i18n: i18n;\r\n\r\n    private locReady = false;\r\n    private initialized = false;\r\n\r\n    constructor() {\r\n        super('Sys.Trnslt');\r\n        Insights.add('system', 'translator', this.log);\r\n        this.i18n = i18next;\r\n    }\r\n\r\n    translate(key: string): string {\r\n        if (!this.initialized) return key;\r\n        if (!this.i18n.isInitialized) return key;\r\n        return this.i18n.t(key) || key;\r\n    }\r\n\r\n    /**\r\n     * Initialize a manager-object on a 2sxc-instance\r\n     */\r\n    initManager(manage: EditManager): void {\r\n        const cl = this.log.call('initManager');\r\n        if (this.initialized) return cl.done('already initialized');\r\n\r\n        const context = manage.context || this.tryToFindAContext();\r\n\r\n        cl.add('will initialize');\r\n        const realRootPath = window.$2sxc.env.uiRoot();\r\n        this.i18n\r\n            .use(XHR)\r\n            .init({\r\n                lng: context.app.currentLanguage.substr(0, 2),\r\n                fallbackLng: primaryLanguage,\r\n                // whitelist: translations,\r\n                preload: [primaryLanguage],\r\n                backend: {\r\n                    loadPath: flattenSlashes(realRootPath + translationsPath),\r\n                },\r\n            }, () => this.initLoc());\r\n        this.initialized = true;\r\n        cl.done();\r\n    }\r\n\r\n    tryToFindAContext(): ContextComplete {\r\n        const cl = this.log.call('tryToFindAContext');\r\n        cl.add('no context found, will seek');\r\n        // trying to get context...\r\n        const htmlElementOrId = document.querySelector<HTMLElement>('div[data-cb-id]');\r\n        this.initialized = true; // the next SxcEdit.get will call _translate so we must set true to prevent loops\r\n        const sxc = window.$2sxc(htmlElementOrId);\r\n        this.initialized = false; // for real, it is not initialized...\r\n        const editContext = SxcTools.getEditContext(sxc);\r\n        const context = new ContextComplete(editContext, sxc);\r\n        context.sxc = sxc;\r\n        return cl.return(context);\r\n    }\r\n\r\n    /**\r\n     * Initialize loc and auto-translate menu nodes in the DOM\r\n     * This is called when the initialize-promise resolves\r\n     */\r\n    initLoc() {\r\n        const cl = this.log.call('initLoc');\r\n        // for options see https://github.com/mthh/loc-i18next#initialize-the-plugin\r\n        localize = locI18next.init(i18next);\r\n        this.locReady = true;\r\n        this.autoTranslateMenus();\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * Tell loc to translate all the translatable menu nodes\r\n     * Do this on initial load, and every time dynamic content gets re-created\r\n     */\r\n    autoTranslateMenus() {\r\n        const cl = this.log.call('autoTranslateMenus');\r\n        if (!this.locReady) return cl.done('loc not ready');\r\n        // start localizing, details: https://github.com/mthh/loc-i18next#usage-of-selector-function\r\n        const menus = document.querySelectorAll<HTMLElement>(IDs.sel.tagScMenu);\r\n        localize(IDs.sel.tagScMenu); // inline toolbars\r\n        const quickEButtons = document.querySelectorAll<HTMLElement>('.sc-i18n');\r\n        localize('.sc-i18n'); // quick-insert menus\r\n        cl.add(`found ${menus.length} menus and ${quickEButtons.length} buttons`);\r\n        cl.done();\r\n    }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const Translator = new TranslatorGlobal();\r\n","/**\r\n * @internal\r\n */\r\nexport const primaryLanguage = 'en';\r\n/**\r\n * @internal\r\n */\r\nexport const translations = ['en', 'de', 'fr', 'fa', 'it', 'uk', 'nl'];\r\n/**\r\n * @internal\r\n */\r\nexport const translationsPath = 'dist/inpage/i18n/{{lng}}.js';\r\n\r\nexport * from './translator';\r\nexport * from './2sxc.translate';\r\n","import { C } from '../../constants/index';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { Translator } from '../../i18n/translator';\r\nimport { HasLog } from '../../core';\r\nimport { ToolbarRenderer } from '../render/toolbar-renderer';\r\nimport { TagToolbar } from '../tag-toolbars/tag-toolbar';\r\nimport { ToolbarLifecycle } from '../toolbar-lifecycle';\r\nimport { ToolbarManager } from '../toolbar-manager';\r\nimport { ToolbarInitConfig } from './toolbar-init-config';\r\nimport { getToolbarWhenNoneProvided } from '../templates/toolbar-when-no-toolbar-provided';\r\n\r\n// quick debug - set to false if not needed for production\r\nconst dbg = false;\r\n/**\r\n * @internal\r\n */\r\nexport const toolbarSelector = `.sc-menu[toolbar],.sc-menu[data-toolbar],[${C.Toolbar.attr.full}]`;\r\n\r\n/**\r\n * This class is responsible for finding toolbar configurations in the doom\r\n * and then initializing them.\r\n * @internal\r\n */\r\nexport class ToolbarConfigFinderAndInitializer extends HasLog {\r\n\r\n    /**\r\n     * Special constructor which only allows this builder to be instatiated from the TagManager\r\n     * This is to simplify program control flow\r\n     */\r\n    constructor(private tlbManager: ToolbarManager) {\r\n        super('Tlb.Buildr', tlbManager.log);\r\n    }\r\n\r\n    /**\r\n     * Generate toolbars inside a MODULE tag (usually a div with class sc-edit-context)\r\n     * @param parentTag\r\n     * @param optionalId\r\n     */\r\n    buildDnnModule(parentTag: HTMLElement): void {\r\n        const cl = this.log.call('buildDnnModule');\r\n\r\n        // if something says the toolbars are disabled, then skip\r\n        if (parentTag.getAttribute(C.Toolbar.attr.disable)) return cl.done('disabled');\r\n\r\n        let toolbars = this.findChildTagsWithConfig(parentTag);\r\n\r\n        // no toolbars found, must help a bit because otherwise editing is hard\r\n        if (toolbars.length === 0) {\r\n            toolbars = addDefaultToolbarConfigToTag(parentTag);\r\n            if (toolbars == null) return cl.done('toolbars=null');\r\n        }\r\n\r\n        toolbars.forEach((e) => this.loadConfigAndInitialize(e));\r\n\r\n        // ensure translations are rebuilt\r\n        Translator.autoTranslateMenus();\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * Build toolbar, but allow an html node as target\r\n     * Will automatically find a wrapping sc-edit-context and all containing toolbars\r\n     * @param node\r\n     */\r\n    build(node: HTMLElement): void {\r\n        // for toolbars that are not inside 2sxc modules (e.g. in skin)\r\n        if (node.matches(toolbarSelector) && !node.closest(C.Sel.SxcDivs)) {\r\n            this.loadConfigAndInitialize(node);\r\n            return;\r\n        }\r\n\r\n        // go up the DOM to find the parent which has context-information\r\n        // if we have no contextNode (a parent content block), we can\r\n        // assume the node is outside of a 2sxc module so not interesting\r\n        const contextNode = node.closest<HTMLElement>(C.Cb.selectors.ofName);\r\n        if (contextNode == null) return;\r\n\r\n        // check if the current node needs a toolbar\r\n        if (node.matches(toolbarSelector)) this.loadConfigAndInitialize(node);\r\n\r\n        // activate all child-nodes with toolbars\r\n        const toolbars = node.querySelectorAll<HTMLElement>(toolbarSelector);\r\n        toolbars.forEach((e) => this.loadConfigAndInitialize(e));\r\n    }\r\n\r\n\r\n    //////////////////////////////// Private Functions ////////////////////////////////////\r\n\r\n    /**\r\n     * find current toolbars inside this wrapper-tag\r\n     */\r\n    private findChildTagsWithConfig(parentTag: HTMLElement): HTMLElement[] {\r\n        const allInner = Array.from(parentTag.querySelectorAll<HTMLElement>(toolbarSelector));\r\n\r\n        // return only those, which don't belong to a sub-item\r\n        const onlyDirectDescendents = allInner.filter((e) => e.closest(C.Cb.selectors.ofName) === parentTag);\r\n        if (dbg)\r\n            console.log('found toolbars for parent', parentTag, onlyDirectDescendents);\r\n        return onlyDirectDescendents;\r\n    }\r\n\r\n\r\n    /**\r\n     * Setup a toolbar for a specific tag/node by loading its self-contained configuration\r\n     * and replacing / preparing the toolbar as needed.\r\n     * @param node\r\n     */\r\n    private loadConfigAndInitialize(tag: HTMLElement): void {\r\n        const cl = this.log.call('loadConfigAndInitialize');\r\n\r\n        // Do not process tag if a toolbar has already been attached\r\n        if (tag.getAttribute(`data-${C.Toolbar.attrToMarkInitalized}`))\r\n            return cl.done('already initialized');\r\n\r\n        const config = ToolbarInitConfig.loadFromTag(tag);\r\n\r\n        if (config != null) {  // is null if load failed\r\n            // catch errors, as this is very common - make sure the others are still rendered\r\n            try {\r\n                this.convertConfigToToolbars(tag, config);\r\n            } catch (err2) {\r\n                console.error('error creating toolbar - will skip this one', err2);\r\n            }\r\n        }\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * Take a configuration and convert into a toolbar-menu; also attach the hover-attribute\r\n     * @param tag\r\n     * @param config\r\n     */\r\n    private convertConfigToToolbars(tag: HTMLElement, config: ToolbarInitConfig): void {\r\n        const cl = this.log.call('convertConfigToToolbars');\r\n        cl.data('tag', tag);\r\n        cl.data('config', config);\r\n        const context = ContextComplete.expandContext(tag);\r\n        context.toolbar = this.tlbManager.loadConfig(context, config);\r\n\r\n        // V2 where the full toolbar is included in one setting\r\n        if (tag.getAttribute(C.Toolbar.attr.full)) {\r\n            cl.add('V2 TagToolbar detected');\r\n            const tagToolbar = new TagToolbar(tag, context, Translator);\r\n            tag.setAttribute(`data-${C.Toolbar.attrToMarkInitalized}`, `${tagToolbar != null}`);\r\n            this.addHoverAttributeToTag(tag);\r\n            return cl.done();\r\n        }\r\n\r\n        // default case, tag is the old <ul> tag, so find the sc-element parent before replacing\r\n        const toolbar = new ToolbarRenderer(context).generate();\r\n        const hoverParent = tag.closest<HTMLElement>(C.Toolbar.selectors.ofOldHover);\r\n        cl.data('parentTag', hoverParent);\r\n        tag.replaceWith(toolbar);\r\n\r\n        if (hoverParent) {\r\n            cl.add('V1 hover-toolbar and parents found - will add attribute');\r\n            this.addHoverAttributeToTag(hoverParent);\r\n        }\r\n\r\n        // Also run toolbar-init on the new toolbar.\r\n        // Must use var 'toolbar' and not 'tag', as that is kind of reset/not existing at this\r\n        // So the event would get lost\r\n        // Added in 12.10\r\n        ToolbarLifecycle.raiseToolbarInitEvent(toolbar, toolbar, context);\r\n\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * add hover-attribute to tag which is responsible for the menu to appear/disappear\r\n     */\r\n    private addHoverAttributeToTag(tag: HTMLElement): void {\r\n        const cl = this.log.call('addHoverAttributeToTag');\r\n        if (!tag) return cl.done('no tag found'); // skip in case nothing was given\r\n        if (!tag.hasAttribute(C.Toolbar.attr.hover)) {\r\n            cl.add('will add attribute ' + C.Toolbar.attr.hover);\r\n            tag.setAttribute(C.Toolbar.attr.hover, '');\r\n        }\r\n        cl.done();\r\n    }\r\n}\r\n\r\n\r\n//////////////////////////////// Private Functions ////////////////////////////////////\r\n\r\n\r\n\r\n\r\n/**\r\n * Create a default/fallback toolbar and return it\r\n */\r\nfunction addDefaultToolbarConfigToTag(parentTag: HTMLElement): HTMLElement[] {\r\n    if (dbg) console.log(\"didn't find toolbar, so will auto-create\", parentTag);\r\n\r\n    const outsideCb = !parentTag.classList.contains(C.Cb.classes.name);\r\n    const contentTag = outsideCb ? parentTag.querySelector<HTMLElement>(`div${C.Cb.selectors.ofName}`) : parentTag;\r\n\r\n    // auto toolbar\r\n    const ctx = ContextComplete.expandContext(contentTag);\r\n    if (ctx.ui.autoToolbar === false)\r\n        return null;\r\n\r\n    contentTag.setAttribute(C.Toolbar.attr.full, JSON.stringify(getToolbarWhenNoneProvided()));\r\n\r\n    return [contentTag];\r\n}\r\n","import { ToolbarSettings } from '../config/toolbar-settings';\r\nimport { ToolbarInitConfig } from '../initialize/toolbar-init-config';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function getToolbarWhenNoneProvided(): ToolbarInitConfig {\r\n  const toolbar = [ToolbarSettings.getForEmptyAsRule()];\r\n\r\n  return {\r\n    toolbar,\r\n  } as ToolbarInitConfig;\r\n}\r\n","import { C } from '../../constants';\r\nimport { HtmlTools } from '../../html/dom-tools';\r\nimport { InPageButtonJson, InPageCommandJson, ToolbarWip } from '../config-loaders';\r\nimport * as Toolbarsettings from '../config/toolbar-settings';\r\nimport ToolbarSettings = Toolbarsettings.ToolbarSettings;\r\nimport { ToolbarTemplate } from '../templates';\r\n\r\n/**\r\n * take various common input format and convert it to a full toolbar-structure definition\r\n * can handle the following input formats (the param unstructuredConfig):\r\n * complete tree (detected by \"groups): \\{ groups: [ \\{\\}, \\{\\}], name: ..., defaults: \\{...\\} \\}\r\n * group of buttons (detected by \"buttons): \\{ buttons: \"...\" | [], name: ..., ... \\}\r\n * list of buttons (detected by IsArray with action): [ \\{ action: \"...\" | []\\}, \\{ action: \"\"|[]\\} ]\r\n * button (detected by \"command\"): \\{ command: \"\"|[], icon: \"..\", ... \\}\r\n * just a command (detected by \"action\"): \\{ entityId: 17, action: \"edit\" \\}\r\n * array of commands: [\\{entityId: 17, action: \"edit\"\\}, \\{contentType: \"blog\", action: \"new\"\\}]\r\n * @internal\r\n */\r\nexport type InPageToolbarConfigVariations =\r\n    ToolbarWip\r\n    | InPageButtonJson\r\n    | InPageCommandJson\r\n    | ToolbarTemplate;\r\n\r\n/**\r\n * The configuration / settings of a toolbar as loaded from the DOM\r\n * @internal\r\n */\r\nexport class ToolbarInitConfig {\r\n    toolbar: InPageToolbarConfigVariations | string[];\r\n    settings: ToolbarSettings;\r\n\r\n    /**\r\n     * Load the toolbar configuration from the sxc-toolbar attribute OR the old schema\r\n     * @param tag\r\n     * @returns a configuration object or null in case of an error\r\n     */\r\n    static loadFromTag(tag: HTMLElement): ToolbarInitConfig {\r\n        try {\r\n            const newConfigFormat = HtmlTools.tryGetAttrText(tag, C.Toolbar.attr.full);\r\n            if (newConfigFormat) {\r\n                const result = JSON.parse(newConfigFormat);\r\n                // check for new V10.27 format, which is just an array!\r\n                if (Array.isArray(result))\r\n                    return { toolbar: result } as ToolbarInitConfig;\r\n                return result as ToolbarInitConfig;\r\n            } else {\r\n                const at = C.IDs.attr;\r\n                const data = HtmlTools.getFirstAttribute(tag, at.toolbar, at.toolbarData);\r\n                const settings = HtmlTools.getFirstAttribute(tag, at.settings, at.settingsData);\r\n                return {\r\n                    toolbar: JSON.parse(data),\r\n                    settings: JSON.parse(settings) as ToolbarSettings,\r\n                } as ToolbarInitConfig;\r\n            }\r\n        } catch (err) {\r\n        console.error(\r\n            'error in settings JSON - probably invalid - make sure you quote properties like \"name\": ...', tag, err);\r\n        return null;\r\n        }\r\n    }\r\n}\r\n","import { InPageCommandJson } from '..';\r\nimport { CommandParams } from '../../../../../$2sxc/src/cms/command-params';\r\nimport { Button } from '../../config';\r\n\r\n/**\r\n * Button Definition v1. from old API\r\n * it is publicly used out of inpage, so take a care to preserve its signature\r\n * @internal\r\n */\r\nexport class InPageButtonJson {\r\n\r\n    /** the internal command which will be called, should contain both the name and the parameters like { action: \"new\", contentType: \"BlogPost\"} */\r\n    command?: InPageCommandJson;\r\n\r\n    /** text which is shown on mouse-over. Note that 2sxc will try to run it through the translator, so you can also use placeholders like Toolbar.Metadata */\r\n    title?: string;\r\n\r\n    /** a css class giving the button the icon. It can be one of the icons 2sxc provides, or it can be your own - just be sure to include a CSS & font which resolves the icon */\r\n    icon?: string;\r\n\r\n    // classes comma separated list of class-names like makeRed,glowHover\r\n    classes?: string;\r\n\r\n    /** disabled would disable the click on the button */\r\n    disabled?: boolean;\r\n\r\n    /**\r\n     * partOfPage (new in 2sxc 9.5)\r\n     * determines if resulting changes should effect the Evoq/DNN Page Publishing\r\n     * note that it only effects the page-lifecyle, if the resulting dialogs and APIs respect this setting\r\n     */\r\n    partOfPage?: boolean;\r\n\r\n    /** if this is just something visual; otherwise a webservice will ensure that a content-group exists (for editing etc.) */\r\n    uiActionOnly?: boolean;\r\n\r\n    /** the code executed on click, if it's not the default action */\r\n    code?<T>(settings: CommandParams): Promise<void | T>;\r\n\r\n    dialog?: string;\r\n    newWindow?: boolean;\r\n    inlineWindow?: boolean;\r\n    fullScreen?: boolean;\r\n\r\n    _expanded?: boolean; // marker to determine that the configuration has already been initialized\r\n\r\n    // check two common signatures - command and action\r\n    static is(thing: unknown): thing is InPageButtonJson {\r\n        return (thing as InPageButtonJson).command !== undefined || (thing as { action: string }).action !== undefined;\r\n    }\r\n\r\n    static isArray(thing: unknown[]): thing is InPageButtonJson[] {\r\n        return thing.length > 0 && InPageButtonJson.is(thing[0]);\r\n    }\r\n\r\n    static toButton(oldFormat: InPageButtonJson): Partial<Button> {\r\n        const config: Partial<Button> = {};\r\n\r\n        // simple value properties\r\n        if (oldFormat.classes) config.classes = oldFormat.classes;\r\n        if (oldFormat.dialog) config.dialog = oldFormat.dialog;\r\n        if (oldFormat.disabled) config.disabled = oldFormat.disabled;\r\n        if (oldFormat.icon) config.icon = oldFormat.icon;\r\n\r\n        // Method Properties\r\n        if (oldFormat.fullScreen) config.fullScreen = evalPropOrFun<boolean>(oldFormat.fullScreen);\r\n        if (oldFormat.icon) config.icon = evalPropOrFun<string>(oldFormat.icon);\r\n        if (oldFormat.inlineWindow) config.inlineWindow = evalPropOrFun<boolean>(oldFormat.inlineWindow);\r\n        if (oldFormat.newWindow) config.newWindow = evalPropOrFun<boolean>(oldFormat.newWindow);\r\n        if (oldFormat.partOfPage) config.partOfPage = evalPropOrFun<boolean>(oldFormat.partOfPage);\r\n        if (oldFormat.title) config.title = evalPropOrFun<string>(oldFormat.title);\r\n\r\n        return config;\r\n    }\r\n\r\n}\r\n\r\n\r\nfunction evalPropOrFun<T>(propOrFunction: T | (() => T)): () => T {\r\n    if (propOrFunction === undefined || propOrFunction === null)\r\n      return null;\r\n    if (typeof (propOrFunction) === 'function')\r\n      return propOrFunction as () => T;\r\n    return () => propOrFunction;\r\n}\r\n","import { CommandNames } from '../../../commands';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface InPageCommandJsonWithTooMuchInfo extends InPageCommandJson {\r\n    entity?: {\r\n        EntityId: number,\r\n        _2sxcEditInformation: {\r\n            sortOrder?: number,\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class InPageCommandJson  {\r\n    /** List of buttons to show */\r\n    action?: CommandNames;\r\n\r\n    /** The entity id to edit */\r\n    entityId?: number;\r\n\r\n    /** the content-type for new items */\r\n    contentType?: string;\r\n\r\n    /** determines that we should use a module list */\r\n    useModuleList?: true;\r\n\r\n    /** index in the list */\r\n    sortOrder?: number;\r\n\r\n    /** Experimental in 10.27 */\r\n    modify?: string;\r\n\r\n    /** Experimental for 10.30 */\r\n    parent?: string;\r\n    /** Experimental for 10.30 */\r\n    fields?: string;\r\n\r\n    static hasActions(thing: unknown): thing is InPageCommandJson {\r\n        // check two common signatures - command and action\r\n        return typeof(thing as InPageCommandJson).action === 'string';\r\n    }\r\n\r\n    static hasModify(thing: unknown): thing is InPageCommandJson {\r\n        // check two common signatures - command and action\r\n        return !!(thing as InPageCommandJson).modify;\r\n    }\r\n\r\n    /** Important for object merging - because otherwise action will be preserved */\r\n    static noAction(thing: InPageCommandJson) {\r\n        // some clean-up\r\n        delete thing.action; // remove the action property\r\n        return thing;\r\n    }\r\n\r\n\r\n}\r\n","import { InPageCommandJson } from '.';\r\nimport { InPageButtonJson } from '.';\r\nimport { ToolbarConfigLoader } from '.';\r\nimport { Commands } from '../../commands';\r\nimport { ContextComplete } from '../../context/bundles';\r\nimport { HasLog } from '../../core';\r\nimport { TypeValue } from '../../plumbing';\r\nimport { Button, ButtonCommand, Toolbar } from '../config';\r\nimport { ButtonSafe } from '../config/button-safe';\r\nimport { CommandNames } from './../../commands/';\r\n\r\n/**\r\n * This is a system to build button configurations\r\n * @internal\r\n */\r\nexport class ButtonConfigLoader extends HasLog {\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.BtCfBl', toolbar.log);\r\n    }\r\n\r\n    /**\r\n     * takes an object like \"actionname\" or { action: \"actionname\", ... }\r\n     * and changes it to a { command: { action: \"actionname\" }, ... }\r\n     */\r\n    normalize(original: InPageButtonJson | InPageCommandJson | string): InPageButtonJson {\r\n        const cl = this.log.call('normalize');\r\n        cl.data('initial', original);\r\n\r\n        // prevent multiple inits\r\n        const asBtnConfig = original as InPageButtonJson;\r\n        if (asBtnConfig._expanded || asBtnConfig.command)\r\n            return cl.return(asBtnConfig, \"already expanded, won't modify\");\r\n\r\n        // if just a name, turn into a command\r\n        // use the deep version with command.action, because of more clean-up later on\r\n        if (typeof original === 'string')\r\n            return cl.return(this.btnConfigStructure(original, {}), 'found name, use that');\r\n\r\n        // if it's a command w/action, wrap into command + trim\r\n        if (InPageCommandJson.hasActions(original)) {\r\n            cl.add('action found, will move down to .command', original);\r\n            if (original.action) original.action = original.action.trim() as CommandNames;\r\n            return cl.return({\r\n                command: original,\r\n                _expanded: true,\r\n            }, 'had actions, convert to commands');\r\n        }\r\n\r\n        throw 'can\\'t expand InPageButtonConfiguration - unexpected type signature encountered';\r\n    }\r\n\r\n    btnConfigStructure(name: string, params: {}): InPageButtonJson {\r\n        const wrapLog = this.log.call('getFromName', name);\r\n        return wrapLog.return({\r\n            command: {\r\n                action: name.trim() as CommandNames,\r\n                params: params,\r\n            },\r\n            _expanded: true,\r\n        }, `name \"${name}\" found, will re-map to .command.action`);\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * remove buttons which are not valid based on add condition\r\n     */\r\n    removeDisableButtons(context: ContextComplete, full: Toolbar): void {\r\n        const wrapLog = this.log.call('removeDisableButtons', `length of groups: ${full.groups.length}`);\r\n        const btnGroups = full.groups;\r\n        for (let g = 0; g < btnGroups.length; g++) {\r\n            const btns = btnGroups[g].buttons;\r\n            this.removeUnfitButtons(context, /* full,*/ btns /* config, */);\r\n\r\n            wrapLog.add('will disable appropriate buttons');\r\n\r\n            // remove the group, if no buttons left, or only \"more\"\r\n            if (btns.length === 0 || (btns.length === 1 && btns[0].command.name === CommandNames.more)) {\r\n                wrapLog.add('found no more buttons except for the \"more\" - will remove that group');\r\n                btnGroups.splice(g--, 1); // remove, and decrement counter\r\n            }\r\n        }\r\n        wrapLog.return(null);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * enhance button-object with default icons, etc.\r\n     */\r\n    addDefaultBtnSettings(btn: Button,\r\n                          groupDefaults: Record<string, TypeValue> | null,\r\n                          tlbDefaults: Record<string, TypeValue> | null | undefined,\r\n                          actions: Commands) {\r\n        const cl = this.log.call('addDefaultBtnSettings', '', `for ${() => btn.command.name}`);\r\n        for (let d = 0; d < btnProperties.length; d++)\r\n            fallbackBtnSetting(btn, groupDefaults, tlbDefaults, actions, btnProperties[d]);\r\n        cl.return(null);\r\n    }\r\n\r\n\r\n\r\n    private removeUnfitButtons(context: ContextComplete, btns: Button[]): void {\r\n        const cl = this.log.call('removeUnfitButtons');\r\n        let removals = '';\r\n        for (let i = 0; i < btns.length; i++) {\r\n            const btn = btns[i];\r\n            if (btn.command) {\r\n                context.button = btn; // add to context for calls\r\n                const rule = this.toolbar.toolbarV10.rules.find(btn.id || btn.command.name);\r\n                let show: boolean = rule?.overrideShow();\r\n                if (show == null) {\r\n                  // make sure params on the rule are also respected when checking the show-condition\r\n                  // I think this should have happened earlier, but as of 2022-06 it's necessary\r\n                  var btnSafe = new ButtonSafe(btn, context);\r\n                  ButtonCommand.mergeAdditionalParams(btnSafe.action(), rule?.params);\r\n                  show = btnSafe.showCondition();\r\n                }\r\n                if (show === false) {\r\n                    removals += `#${i} \"${btn.command.name}\"; `;\r\n                    btns.splice(i--, 1);\r\n                }\r\n                cl.add(`btn '${btn.command.name}' show ${show}`);\r\n            }\r\n        }\r\n        if (removals)\r\n            cl.add(`removed buttons: ${removals}`);\r\n        cl.return(null);\r\n    }\r\n\r\n}\r\n\r\nconst btnProperties = [\r\n  'classes',\r\n  'icon',\r\n  'title',\r\n  'dynamicClasses',\r\n  'showCondition',\r\n  'disabled',\r\n];\r\n\r\n\r\n/**\r\n * configure missing button properties with various fallback options\r\n * @param btn\r\n * @param group\r\n * @param fullToolbarConfig\r\n * @param actions\r\n * @param propName\r\n */\r\nfunction fallbackBtnSetting(btn: Button,\r\n                            groupDefaults: Record<string, TypeValue> | null,\r\n                            toolbarDefaults: Record<string, TypeValue> | null | undefined,\r\n                            actions: Commands,\r\n                            propName: string) {\r\n    const target = btn as unknown as Record<string, TypeValue>;\r\n\r\n    // skip it property is already set\r\n    if (target[propName])\r\n        return;\r\n\r\n    if (groupDefaults && groupDefaults[propName])\r\n        return target[propName] = groupDefaults[propName];\r\n\r\n    // if the toolbar has defaults, try use that property\r\n    if (toolbarDefaults && toolbarDefaults[propName])\r\n        return target[propName] = toolbarDefaults[propName];\r\n\r\n    // if there is an action, try to use that property name\r\n    if (btn.command && btn.command.name) {\r\n        const a = actions.get(btn.command.name);\r\n        if (a && a.buttonDefaults) {\r\n            const c = a.buttonDefaults as Record<string, TypeValue>;\r\n            if (c[propName])\r\n                return target[propName] = c[propName];\r\n        }\r\n    }\r\n}\r\n","import { ToolbarConfigLoader } from '.';\r\nimport { InPageCommandJsonWithTooMuchInfo } from '.';\r\nimport { CommandParams } from '../../../../$2sxc/src/cms/command-params';\r\nimport { HasLog } from '../../core';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class CommandConfigLoader extends HasLog {\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.CmdLdr', toolbar.log);\r\n    }\r\n    /**\r\n     * entity support (compatibility for pre 2sxc v9.x)\r\n     * does some clean-up work on a button-definition object\r\n     * because the target item could be specified directly, or in a complex internal object called entity\r\n     * @param actDef\r\n     */\r\n    updateToV9(actDef: InPageCommandJsonWithTooMuchInfo): CommandParams {\r\n\r\n        // doesn't have the pre-V9 properties, so we're fine\r\n        if (!actDef.entity || !actDef.entity._2sxcEditInformation)\r\n            return actDef as CommandParams;\r\n\r\n        const editInfo = actDef.entity._2sxcEditInformation;\r\n\r\n        // move up sortOrder property and set useModuleList\r\n        if (editInfo.sortOrder !== undefined)\r\n          actDef.useModuleList = true; // has sort-order, so use list\r\n        if (editInfo.sortOrder !== undefined)  actDef.sortOrder = editInfo.sortOrder;\r\n\r\n        // move up entityId and clean-up the old 'entity' property\r\n        if (actDef.entity.EntityId !== undefined) actDef.entityId = actDef.entity.EntityId;\r\n        delete actDef.entity;\r\n\r\n        return actDef as unknown as CommandParams;\r\n    }\r\n\r\n}\r\n\r\n","/**\r\n * @internal\r\n */\r\nexport const TemplateConstants = {\r\n    NameDefault: 'default',\r\n    NameEmpty: 'empty',\r\n    GroupDefault: 'default',\r\n    GroupList: 'list',\r\n    GroupEditAdvanced: 'edit-advanced',\r\n    GroupView: 'view',\r\n    GroupApp: 'app',\r\n    GroupUnknown: 'unknown',\r\n    ButtonSeparator: ',',\r\n};\r\n","import { ToolbarWip } from '.';\r\nimport { InPageButtonJson, InPageCommandJson } from '.';\r\nimport { ButtonGroupWip } from '.';\r\nimport { RunParams } from '../../../../$2sxc/src/cms/run-params';\r\nimport { CommandNames, CommandParams, Commands } from '../../commands';\r\nimport { HasLog } from '../../core';\r\nimport { TypeValue } from '../../plumbing';\r\nimport { Button, ButtonCommand, Toolbar, ToolbarSettings } from '../config';\r\nimport { ButtonGroup } from '../config';\r\nimport { TemplateConstants as TC } from '../templates/constants';\r\nimport { TLB_MORE_END, TLB_MORE_NEVER } from './../config/toolbar-settings';\r\nimport { ToolbarConfigLoader } from './toolbar-config-loader';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ButtonGroupConfigLoader extends HasLog {\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.GrpCnf', toolbar.log);\r\n    }\r\n\r\n    /**\r\n     * this will traverse a groups-tree and expand each group\r\n     * so if groups were just strings like \"edit,new\" or compact buttons, they will be expanded afterwards\r\n     * @param fullToolbar\r\n     */\r\n    expandButtonGroups(fullToolbar: ToolbarWip): Toolbar {\r\n        const cl = this.log.call('expandButtonGroups');\r\n\r\n        // by now we should have a structure, let's check/fix the buttons\r\n        cl.add(`will expand groups - found ${fullToolbar.groups.length} items`);\r\n        for (let g = 0; g < fullToolbar.groups.length; g++) {\r\n            // expand a verb-list like \"edit,new\" into objects like [{ action: \"edit\" }, {action: \"new\"}]\r\n            const group = fullToolbar.groups[g];\r\n            const groupDefaults = (group as ButtonGroup).defaults;\r\n            const btns = this.expandButtonList(group, fullToolbar.settings);\r\n            const buttonConfigs: Button[] = [];\r\n\r\n            if (Array.isArray(btns)) {\r\n                cl.add(`will process ${btns.length} buttons`);\r\n                for (let b = 0; b < btns.length; b++)\r\n                    buttonConfigs.push(this.convertToButton(btns[b], fullToolbar.params, fullToolbar.defaults, groupDefaults));\r\n            } else\r\n                cl.add(\"no button array found, won't do a.nything\");\r\n\r\n            // Toolbar API v2 overwrite V1\r\n            group.buttons = buttonConfigs;\r\n        }\r\n        const toolbar = fullToolbar as Toolbar;\r\n        this.dropMoreIfOnlyOneGroup(toolbar);\r\n        return cl.return(toolbar);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Converts the InPageButtonJson to a Button\r\n     * WARNING: Note that this does the same task as convertToButton in the ButtonConfigLoader - but very differently\r\n     *          I'm not sure why though.\r\n     */\r\n    convertToButton(btn: InPageButtonJson,\r\n                    sharedParams: CommandParams | Record<string, TypeValue>,\r\n                    sharedDefaults: Record<string, TypeValue>,\r\n                    groupDefaults: Record<string, TypeValue>,\r\n                    ): Button {\r\n        let btnCommand = (btn as unknown as { command: CommandParams; }).command;\r\n        const identifier = btnCommand.action;\r\n        const name = Button.splitName(identifier).name;\r\n\r\n        if (!(Commands.singleton().get(name))) {\r\n            this.log.add(`couldn't find action ${name} - show warning`);\r\n            console.warn('warning: toolbar-button with unknown action-name:', name);\r\n        }\r\n\r\n        // first check if we already got params in the object - then we will use those, otherwise the main object\r\n        const realParams = (btnCommand as RunParams).params || InPageCommandJson.noAction(btnCommand);\r\n\r\n        // 2dm 2022-07-05 #badContentTypeExtractAndRefill - we seem to extract it, just to put it back on the ButtonCommand\r\n        // const contentType = realParams.contentType;\r\n\r\n        // if the button belongs to a content-item, move the specs up to the item into the settings-object\r\n        btnCommand = this.toolbar.command.updateToV9(btnCommand);\r\n\r\n        // parameters adapter from v1 to v2\r\n        const params = { ...realParams, ...sharedParams };\r\n        // Toolbar API v2\r\n        const command = new ButtonCommand(name, /* contentType, */ params);\r\n        let newButtonConfig = new Button(command, identifier);\r\n\r\n        // settings adapter from v1 to v2\r\n        newButtonConfig = { ...newButtonConfig, ...InPageButtonJson.toButton(btn) };\r\n\r\n        // ensure all buttons have either own settings, or the fallback\r\n        this.toolbar.button.addDefaultBtnSettings(newButtonConfig, groupDefaults, sharedDefaults, Commands.singleton());\r\n        return newButtonConfig;\r\n    }\r\n\r\n    /**\r\n     * take a list of buttons (objects OR strings)\r\n     * and convert to proper array of buttons with actions\r\n     * on the in is a object with buttons, which are either:\r\n     * - a string like \"edit\" or multi-value \"layout,more\"\r\n     * - an array of such strings incl. optional complex objects which are\r\n     */\r\n    private expandButtonList(root: ButtonGroupWip, settings: ToolbarSettings): InPageButtonJson[] {\r\n        const wrapLog = this.log.call('expandButtonList'); // new Log('Tlb.ExpBts', this.log, 'start');\r\n        wrapLog.add('initial', root);\r\n        const buttonsWip = root.buttons;\r\n\r\n        let newButtons: InPageButtonJson[] = [];\r\n\r\n        // convert compact buttons (with multi-verb action objects) into own button-objects\r\n        // important because an older syntax allowed {action: \"new,edit\", entityId: 17}\r\n        if (Array.isArray(buttonsWip)) {\r\n            wrapLog.add(`detected array of btns (${buttonsWip.length}), will ensure it's an object`);\r\n            for (let b = 0; b < buttonsWip.length; b++) {\r\n                const btn = buttonsWip[b] as InPageButtonJson;\r\n                const actionNames = (btn as InPageCommandJson).action;\r\n                wrapLog.add(`will process actions: '${actionNames}' for `, btn);\r\n                if (typeof actionNames === 'string' && actionNames.indexOf(',') > -1) {\r\n                    wrapLog.add(`actionNames has mult values: '${actionNames}'`);\r\n                    this.expandButtonAndAddToList(newButtons, btn, actionNames);\r\n                } else {\r\n                    wrapLog.add('actionNames has 1 value', btn);\r\n                    newButtons.push(btn);\r\n                }\r\n            }\r\n        } else if (typeof buttonsWip === 'string') {\r\n            wrapLog.add(`detected that it is a string \"${buttonsWip}\", will split by \",\" and ...`);\r\n            this.expandButtonAndAddToList(newButtons, {}, buttonsWip);\r\n        } else {\r\n            wrapLog.add('no special case detected, will use the buttons-object as is');\r\n            newButtons = buttonsWip;\r\n        }\r\n        wrapLog.add(`after check, found ${newButtons.length} buttons`, newButtons);\r\n\r\n        // optionally add a more-button in each group\r\n        this.addMoreButton(settings, newButtons);\r\n\r\n        const result = newButtons.map((x) => this.toolbar.button.normalize(x)); // ensure the internal def is also an array now\r\n        return wrapLog.return(result, 'done');\r\n    }\r\n\r\n\r\n    private expandButtonAndAddToList(list: InPageButtonJson[], btn: InPageButtonJson, names: string): void {\r\n        const cl = this.log.call('expandButtonAndAddToList', `..., ..., '${names}'`, `button def \"${btn} is string of mult names, will expand into array with action-properties\"`);\r\n        const actions = names.length ? names.split(TC.ButtonSeparator) : [];\r\n        const params = {...btn} as InPageCommandJson;\r\n        delete params.action;\r\n        for (let a = 0; a < actions.length; a++) {\r\n            const commandPart = this.toolbar.button.btnConfigStructure(actions[a], params);\r\n            cl.data('commandPart', commandPart);\r\n            list.push(commandPart); // {...btn, ...commandPart });\r\n        }\r\n        cl.return(list);\r\n    }\r\n\r\n    /** Add the \"more\" button at the end or beginning */\r\n    private addMoreButton(settings: ToolbarSettings, list: InPageButtonJson[]): void {\r\n        const cl = this.log.call('addMoreButtons');\r\n        const addMore = ToolbarSettings.bestAddMorePos(settings);\r\n        if (addMore && addMore !== TLB_MORE_NEVER) {\r\n            this.log.add(`will add a more \"...\" button to ${addMore}`);\r\n            const moreButton = this.toolbar.button.btnConfigStructure(CommandNames.more, {});\r\n            if (addMore === TLB_MORE_END)\r\n                list.push(moreButton);\r\n            else\r\n                list.unshift(moreButton);\r\n        } else this.log.add('will not add more \"...\" button');\r\n        cl.return(list);\r\n    }\r\n\r\n    /**\r\n     * If there is only one group, then remove the More button.\r\n     * Note that this has to happen almost at the end, because groups will be removed if empty\r\n     */\r\n    private dropMoreIfOnlyOneGroup(toolbar: Toolbar): void {\r\n        const cl = this.log.call('dropMoreIfOnlyOneGroup');\r\n        if (toolbar.groups.length !== 1) return cl.done('not just 1 group');\r\n        cl.add('exactly one group found, will remove more');\r\n        const buttons = toolbar.groups[0].buttons;\r\n        const index = buttons.findIndex((b) => b.command?.name === CommandNames.more);\r\n        if (index === -1) return cl.done(\"no 'more' button found\");\r\n        buttons.splice(index, 1);\r\n        cl.done('more removed');\r\n    }\r\n\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport const RuleConstants = {\r\n    Keys: {\r\n        None: 'none',\r\n    },\r\n};\r\n","/**\r\n * @internal\r\n */\r\nexport enum Operations {\r\n    add = '+',\r\n    addAuto = '',\r\n    remove = '-',\r\n    system = '$', // for $params, $settings?\r\n    modify = '%',\r\n    // comment = '/',\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport enum BuildSteps {\r\n    toolbar = 'toolbar',\r\n    group = 'group',\r\n    button = 'button',\r\n    params = 'params',\r\n    settings = 'settings',\r\n}\r\n","import { RuleParams } from '.';\r\nimport { CommandParamsMetadata } from '../../../../$2sxc/src/cms/command-params-metadata';\r\nimport { Log, LogEntryOptions as LEO } from '../../core';\r\nimport { TypeValue } from '../../plumbing';\r\n\r\nconst prefillPrefix = 'prefill:';\r\nconst filterPrefix = 'filter:';\r\nconst contextPrefix = 'context:';\r\nconst formPrefix = 'form:';\r\n\r\n// 2024-12-10 v18.07 #dialogSettings - new prefix for dialog settings\r\n// 2025-07-08 v20 changed to `dialog:`, was not in use yet\r\nconst dialogSettingsPrefix = 'dialog:';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ProcessedParams {\r\n  params: RuleParams;\r\n  context: Record<string, TypeValue>;\r\n\r\n  /**\r\n   * Dialog Settings to pass to the dialog.\r\n   * WIP v20\r\n   */\r\n  settings?: Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class RuleParamsHelper {\r\n\r\n  static processParams(params: RuleParams, log: Log): ProcessedParams {\r\n    const cl = log.call('processParams');\r\n    const prefill = RuleParamsHelper.extractSubKeys(params, prefillPrefix, log);\r\n    if (prefill)\r\n      params.prefill = prefill;\r\n\r\n    const filters = RuleParamsHelper.extractSubKeys(params, filterPrefix, log);\r\n    if (filters)\r\n      params.filters = filters;\r\n\r\n    const formParams = RuleParamsHelper.extractSubKeys(params, formPrefix, log);\r\n    if (formParams)\r\n      params.form = formParams;\r\n\r\n    const settings = RuleParamsHelper.extractSubKeys(params, dialogSettingsPrefix, log);\r\n\r\n    const context = RuleParamsHelper.extractSubKeys(params, contextPrefix, log);\r\n\r\n    // catch a very common mistake in metadata\r\n    if (params.metadata) {\r\n      delete params.metadata;\r\n      cl.add(\"params had additional metadata - invalid, will remove. Use 'for' instead\", null, LEO.error);\r\n    }\r\n\r\n    // process metadata\r\n    if (params.for)\r\n      params.metadata = RuleParamsHelper.processMetadata(params, log);\r\n    return cl.return({ params, context, settings });\r\n  }\r\n\r\n  private static processMetadata(params: RuleParams, log: Log): CommandParamsMetadata {\r\n    const cl = log.call('processMetadata');\r\n\r\n    // get the for-target and if exists, delete from params\r\n    const mdFor = params.for;\r\n    if (!mdFor)\r\n      return cl.return(undefined, 'no metadata');\r\n    delete params.for;\r\n\r\n    // just one part, use it as key\r\n    if (mdFor.indexOf(',') === -1)\r\n      return cl.return({ key: mdFor }, 'only has key');\r\n    const parts = mdFor.split(',').map((p) => p.trim());\r\n    if (parts.length !== 3)\r\n      return cl.return(undefined, `error: metadata-for parts count expected 3: ${parts.length}`, LEO.error);\r\n\r\n    // part 1 must be a number\r\n    const targetType = +parts[0];\r\n    if (isNaN(targetType))\r\n      return cl.return(undefined, `error: first key part is not number - got ${targetType}`, LEO.error);\r\n\r\n    // part 2 must be a string with 'string', 'guid' or 'number'\r\n    const keyType = parts[1];\r\n    if (keyType !== 'string' && keyType !== 'guid' && keyType !== 'number')\r\n      return cl.return(undefined, `error: key is not known type, should be string, guid or number, but got ${keyType}`, LEO.error);\r\n\r\n    // part 3 is the key\r\n    const key = parts[2];\r\n    if (key === null || key === undefined || key === '')\r\n      return cl.return(undefined, `error: key strange value: '${key}'`, LEO.error);\r\n\r\n    // todo: warn if no metadata or id!\r\n    if (!params.contentType || params.entityId == null)\r\n      return cl.return(undefined, 'error: contentType and entityId missing', LEO.error);\r\n\r\n    return cl.return({\r\n      key: key,\r\n      targetType: targetType,\r\n      keyType: keyType,\r\n    });\r\n  }\r\n\r\n\r\n  /** Do special processing on all prefill:Field=Value rules */\r\n  private static extractSubKeys(params: RuleParams, prefix: string, log: Log): Record<string, TypeValue> {\r\n    const cl = log.call('processSubMultiKeys');\r\n\r\n    // only load special prefills if we don't already have a prefill\r\n    if (!params)\r\n      return cl.return(undefined, 'no params');\r\n\r\n    const keys = Object.keys(params).filter((k) => k.indexOf(prefix) === 0);\r\n    if (!keys || keys.length === 0)\r\n      return cl.return(undefined, `no speciall '${prefix}' keys`);\r\n\r\n    const prefixLen = prefix.length;\r\n    const list: Record<string, TypeValue> = {};\r\n    keys.forEach((k) => {\r\n      let value: unknown = params[k];\r\n      // 2020-04-02 prefill is a bit flaky - this should fix the common issues\r\n      // fix boolean true must be \"true\"\r\n      if (value === true || value === false)\r\n        value = value.toString();\r\n      // filter:[] is a special case - it's an array of IDs\r\n      else if (prefix === filterPrefix)\r\n        value = RuleParamsHelper.filterValues(value as string);\r\n      // prefill: try to detect list of guids\r\n      else if (prefix === prefillPrefix)\r\n        value = RuleParamsHelper.prefillValues(value as string);\r\n\r\n      list[k.substring(prefixLen)] = value as TypeValue;\r\n      delete params[k];\r\n    });\r\n    return cl.return(list, 'got list of multi-keys');\r\n  }\r\n\r\n  private static filterValues(value: string): string | Array<unknown> {\r\n    if (typeof value === 'string' && value.length > 0 && value[0] === '[' && value[value.length - 1] === ']') {\r\n      try {\r\n        const array = JSON.parse(value) as Array<unknown>;\r\n        return array;\r\n      } catch {\r\n        console.warn(`filter:[] value is not a valid JSON array: ${value}`);\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Process Prefill values - basically check if it's an array of GUIDs and convert to that\r\n   * @param value \r\n   * @returns \r\n   */\r\n  private static prefillValues(value: string): string | string[] {\r\n    // must be string\r\n    if (!value || typeof value !== 'string')\r\n      return value;\r\n    // must have a comma to become an array\r\n    if (value.indexOf(',') === -1)\r\n      return value;\r\n    // shouldn't have any quotes\r\n    if (value.indexOf('\"') >= 0 || value.indexOf(\"'\") >= 0)\r\n      return value;\r\n    const probablyArray = value.split(',').map((g) => g.trim());\r\n    // guid check regex from https://stackoverflow.com/questions/7905929/how-to-test-valid-uuid-guid\r\n    const guidCount = probablyArray\r\n        .filter((g) => g.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i) !== null);\r\n        // .filter((m) => m === true);\r\n    if (guidCount && guidCount.length === probablyArray.length)\r\n      return probablyArray;\r\n    return value;\r\n  }\r\n}\r\n","export const prefixBase64 = 'base64:';\r\nexport const prefixJson64 = 'json64:';","import { TemplateConstants as TC, ToolbarTemplate } from '.';\r\n\r\n/**\r\n * @internal\r\n */\r\n// the default / initial buttons in a standard toolbar\r\nexport const ToolbarTemplateEmpty: ToolbarTemplate = {\r\n  name: TC.NameEmpty,\r\n  groups: [\r\n    {\r\n      name: TC.GroupDefault,\r\n      buttons: '',\r\n    },\r\n  ],\r\n  defaults: {},\r\n  params: {},\r\n  settings: {},\r\n  _isToolbarTemplate: true,\r\n};\r\n","import { TemplateConstants as TC, ToolbarTemplate } from '.';\r\nimport { CommandNames as CN } from '../../commands';\r\n\r\n/**\r\n * @internal\r\n */\r\n// the default / initial buttons in a standard toolbar\r\nexport const ToolbarTemplateDefault: ToolbarTemplate = {\r\n  name: TC.NameDefault,\r\n  groups: [\r\n    {\r\n      name: TC.GroupDefault,\r\n      buttons: [CN.edit, CN.new, CN.metadata, CN.publish, CN.layout].join(','),\r\n    }, {\r\n      name: TC.GroupList,\r\n      buttons: [CN.add, CN.addExisting, CN.replace, CN.remove, CN.moveUp, CN.moveDown, CN.list].join(','),\r\n    }, {\r\n      name: TC.GroupEditAdvanced,\r\n      buttons: [CN.delete].join(','),\r\n    }, {\r\n      name: TC.GroupView,\r\n      buttons: [CN.template, CN.view, CN.data, CN.query, CN.fields].join(','),\r\n      defaults: {\r\n        classes: 'group-pro',\r\n      },\r\n    }, {\r\n      name: TC.GroupApp,\r\n      buttons: [CN.app, CN.appSettings, CN.appResources, CN.system, CN.insights].join(','),\r\n      defaults: {\r\n        classes: 'group-pro',\r\n      },\r\n    },\r\n  ],\r\n  defaults: {},\r\n  params: {},\r\n  settings: {},\r\n  _isToolbarTemplate: true,\r\n};\r\n","import { TemplateConstants as TC, ToolbarTemplate } from '.';\r\n\r\n/**\r\n * @internal\r\n */\r\n// the default / initial buttons in a standard toolbar\r\nexport const ToolbarTemplateSublist: ToolbarTemplate = {\r\n  name: 'sublist',\r\n  groups: [\r\n    {\r\n      name: TC.GroupDefault,\r\n      buttons: 'edit,new,publish',\r\n      defaults: {\r\n        classes: 'group-inlist',\r\n      },\r\n    }, {\r\n      name: TC.GroupList,\r\n      buttons: 'add-existing,replace,remove,moveup,movedown,instance-list',\r\n      defaults: {\r\n        classes: 'group-inlist',\r\n      },\r\n    }, {\r\n      name: TC.GroupEditAdvanced,\r\n      buttons: 'delete',\r\n      defaults: {\r\n        classes: 'group-inlist',\r\n      },\r\n    },\r\n  ],\r\n  defaults: {},\r\n  params: {},\r\n  settings: {},\r\n  _isToolbarTemplate: true,\r\n};\r\n","import { ToolbarTemplate, ToolbarTemplateDefault, ToolbarTemplateEmpty, ToolbarTemplateSublist } from '.';\r\nimport { HasLog, Insights } from '../../core';\r\nimport { Obj } from '../../plumbing';\r\n\r\n/**\r\n * The template manager provides toolbar templates to the entire system.\r\n * It basically keeps a list of predefined templates, and returns the ones needed\r\n * @internal\r\n */\r\nexport class ToolbarTemplateManager extends HasLog {\r\n    /** Singleton */\r\n    public static singleton(): ToolbarTemplateManager {\r\n        return this._singleton ?? (this._singleton = new ToolbarTemplateManager());\r\n    }\r\n    private static _singleton: ToolbarTemplateManager;\r\n\r\n    configTemplateList: ToolbarTemplate[] = [];\r\n\r\n    /** hash - table of templates, to be used a list()['template - name'] */\r\n    list: Record<string, ToolbarTemplate> = {};\r\n\r\n    constructor() {\r\n        super('Tlb.TmpMan', null, 'build');\r\n        Insights.add('system', 'toolbar-template-manager', this.log);\r\n        this.add(ToolbarTemplateEmpty);\r\n        this.add(ToolbarTemplateDefault);\r\n        this.add(ToolbarTemplateSublist);\r\n    }\r\n\r\n    /**\r\n     * Deep copy toolbar template, so it can be modified without changing the next use\r\n     */\r\n    copy(name: string): ToolbarTemplate {\r\n        return Obj.DeepClone(this.findOrShowError(name));\r\n    }\r\n    private findOrShowError(name: string): ToolbarTemplate {\r\n        const found = this.list[name];\r\n        if (found) return found;\r\n        throw `try to find toolbar template '${name}' but not found`;\r\n    }\r\n\r\n    /**\r\n     * adds a template to the list, if it doesn't exist\r\n     */\r\n    private add(template: ToolbarTemplate) {\r\n        this.list[template.name] = template;\r\n    }\r\n}\r\n","import { ListWithCursor, ToolbarTemplateGroup } from '.';\r\nimport { TypeValue } from '../../plumbing';\r\nimport { ToolbarSettings } from '../config/toolbar-settings';\r\n\r\n/**\r\n * This describes a template configuration of a toolbar\r\n * It's meant to provide type-save templates for what buttons are used where\r\n * @internal\r\n */\r\nexport class ToolbarTemplate implements ListWithCursor {\r\n    name: string;\r\n    groups: ToolbarTemplateGroup[] = [];\r\n    defaults?: Record<string, TypeValue> = {};\r\n    params?: Record<string, TypeValue> = {};\r\n    settings?: Partial<ToolbarSettings> = {};\r\n    debug?: boolean;\r\n    _isToolbarTemplate: true;\r\n    _insertCursor?: 0;\r\n\r\n    static is(thing: unknown): thing is ToolbarTemplate {\r\n        return (thing as ToolbarTemplate)._isToolbarTemplate;\r\n    }\r\n\r\n    static hasGroups(thing: unknown): thing is ToolbarTemplate {\r\n        return Array.isArray((thing as ToolbarTemplate).groups);\r\n    }\r\n\r\n}\r\n","import { ListWithCursor, TemplateConstants } from '.';\r\n\r\n/**\r\n * This describes a button group in a toolbar template.\r\n * It should only be used for that\r\n * @internal\r\n */\r\nexport class ToolbarTemplateGroup implements ListWithCursor {\r\n    name: string = TemplateConstants.GroupUnknown;\r\n    buttons: string = '';\r\n    defaults?: Record<string, string> = {};\r\n    _insertCursor?: 0;\r\n\r\n    static is(thing: unknown): thing is ToolbarTemplateGroup {\r\n        return (thing as ToolbarTemplateGroup).buttons !== undefined;\r\n    }\r\n}\r\n","import { ListWithCursor, ToolbarTemplate, ToolbarTemplateGroup } from '.';\r\nimport { HasLog } from '../../core';\r\nimport { ToolbarConfigLoader } from '../config-loaders';\r\nimport { BuildRule, BuildSteps } from '../rules';\r\nimport { TemplateConstants as TC } from './constants';\r\n\r\n/**\r\n * This object is used to change the structure of a toolbar template.\r\n * It's only purpose is to assist in the new V10 format for quickly making toolbars.\r\n * @internal\r\n */\r\nexport class TemplateEditor extends HasLog {\r\n    constructor(public toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.TplEdt', toolbar.log);\r\n    }\r\n\r\n    addButton(template: ToolbarTemplate, groupName: string, id: string, name: string, pos: number): void {\r\n        // fromStart\r\n        const fromStart = pos >= 0;\r\n        pos = Math.abs(pos) - (fromStart ? 0 : 1);\r\n        // console.log('addbutton - pos', `${fromStart ? '+' : '-'}${pos}`);\r\n        const cl = this.log.call('addButton', `..., ${groupName}, ${id}, ${name}, ${fromStart ? '+' : '-'}${pos}, ${fromStart}`);\r\n        if (!template) return cl.done('no template');\r\n        let group = this.findGroupOrDefault(template, groupName);\r\n        if (!group) group = this.addGroup(template, groupName, 1000); // create group at end\r\n        const buttons = group.buttons?.split(TC.ButtonSeparator) ?? [];\r\n        const buttonId = id === name ? name : `${id}=${name}`;\r\n        const posStartEnd = this.correctPosStartEnd(buttons, pos, fromStart);\r\n        const posInsert = fromStart ? this.findInsertPosition(group, posStartEnd) : posStartEnd;\r\n        cl.add(`pos: ${pos}, startEnd: ${posStartEnd}, insert:${posInsert}`);\r\n        buttons.splice(posInsert, 0, buttonId);\r\n        group.buttons = buttons\r\n            .filter((b) => b.length) // drop empty items\r\n            .join(TC.ButtonSeparator);\r\n        cl.done();\r\n    }\r\n\r\n\r\n    private findInsertPosition(group: ListWithCursor, pos: number): number {\r\n        group._insertCursor = group._insertCursor || 0;\r\n        if (pos === 0) pos = group._insertCursor++;\r\n        return pos;\r\n    }\r\n\r\n    private correctPosStartEnd(target: Array<unknown>, pos: number, fromStart: boolean) {\r\n        if (fromStart) return pos;\r\n        pos = target.length - pos;\r\n        return pos >= 0 ? pos : target.length;\r\n    }\r\n\r\n    add(template: ToolbarTemplate, rules: BuildRule[]) {\r\n      rules.forEach((r) => {\r\n        if (r.step === BuildSteps.group)\r\n          this.addGroup(template, r.name, r.pos);\r\n        else\r\n          this.addButton(template, r.group, r.id, r.name, r.pos);\r\n      });\r\n    }\r\n\r\n    addGroup(template: ToolbarTemplate, groupName: string, pos: number): ToolbarTemplateGroup {\r\n        const fromStart = pos >= 0;\r\n        pos = Math.abs(pos) - (fromStart ? 0 : 1);\r\n        const cl = this.log.call('addGroup', `..., ${groupName}, ${fromStart ? '+' : '-'}${pos}`);\r\n        this.ensureGroups(template);\r\n        const alreadyExists = this.findGroup(template, groupName);\r\n        if (alreadyExists) return cl.return(alreadyExists, 'already exists');\r\n        const newGroup = new ToolbarTemplateGroup();\r\n        newGroup.name = groupName;\r\n        const posStartEnd = this.correctPosStartEnd(template.groups, pos, fromStart);\r\n        const posInsert = fromStart ? this.findInsertPosition(template, posStartEnd) : posStartEnd;\r\n        template.groups.splice(posInsert, 0, newGroup);\r\n        return cl.return(newGroup, 'created');\r\n    }\r\n\r\n    removeGroup(template: ToolbarTemplate, groupName: string): void {\r\n        const group = this.findGroup(template, groupName);\r\n        if (!group) return;\r\n        const index = template.groups.indexOf(group);\r\n        if (index < 0) return;\r\n        template.groups.splice(index, 1);\r\n    }\r\n\r\n    private ensureGroups = (template: ToolbarTemplate): void => { if (!template.groups) template.groups = []; };\r\n    private findGroup = (template: ToolbarTemplate, name: string): ToolbarTemplateGroup =>\r\n        template.groups.find((t) => t.name === name)\r\n\r\n    private findGroupOrDefault(template: ToolbarTemplate, name: string): ToolbarTemplateGroup {\r\n        const cl = this.log.call('findGroup', name);\r\n        this.ensureGroups(template);\r\n        if (template.groups.length === 0) return cl.return(null, 'no groups');\r\n        const found = this.findGroup(template, name);\r\n        if (found) return cl.return(found, 'found');\r\n        return cl.return(template.groups[0], 'not found, return first)');\r\n    }\r\n}\r\n","import { Operations as Operators, RuleConstants as RC, RuleParams, RuleParamsHelper } from '.';\r\nimport { prefixBase64, prefixJson64 } from '../../constants/rules';\r\nimport { HasLog, Log } from '../../core';\r\nimport { TypeValue } from '../../plumbing';\r\nimport { ToolbarButtonSettings, ToolbarSettings } from '../config';\r\nimport { TemplateConstants } from '../templates';\r\nimport { BuildSteps } from './build-steps';\r\nimport { ProcessedParams } from './rule-params-helper';\r\n\r\n/**\r\n * Contains a rule how to add/modify a toolbar.\r\n * @internal\r\n */\r\nexport class BuildRule extends HasLog {\r\n  //#region Rule parts\r\n  /** The ID for this rule - often the same as the name */\r\n  id: string;\r\n\r\n  /** Name of the thing being added - often a command name or can be the group name */\r\n  name: string;\r\n\r\n\r\n  /** The build command to run */\r\n  step: BuildSteps | string;\r\n\r\n  /** what this rule should do */\r\n  operator: Operators;\r\n\r\n\r\n  /** Group name - when adding more buttons */\r\n  group: string = TemplateConstants.NameDefault;\r\n\r\n  /**\r\n   * position where something is added - the group or the button\r\n   * Note that JS preserves -0\r\n   */\r\n  pos: number = 0;\r\n\r\n  //#endregion\r\n\r\n  //#region command parts\r\n\r\n  params?: RuleParams = {};\r\n\r\n  /**\r\n   * Button Rules - determines what a button should do / not do\r\n   * Note: can also be Partial<ToolbarSettings>\r\n   */\r\n  ui: ToolbarButtonSettings & Partial<ToolbarSettings> = {};\r\n\r\n  //#endregion\r\n\r\n  //#region New #CustomContext\r\n\r\n  context: {\r\n    appId?: number,\r\n    zoneId?: number,\r\n    complete?: boolean,\r\n  } = {};\r\n\r\n  //#endregion\r\n\r\n  /** WIP v20 new? */\r\n  settings?: Record<string, unknown>;\r\n\r\n  constructor(public ruleString: string, parentLog: Log) {\r\n    super('Tlb.BdRule', parentLog);\r\n    if (!ruleString) {\r\n      this.log.add('rule is empty');\r\n      return;\r\n    }\r\n    this.load();\r\n  }\r\n\r\n  public static Create({ name, ui, params, pos, log }: { name: string; ui?: ToolbarButtonSettings & Partial<ToolbarSettings>; params?: RuleParams, pos?: number, log: Log; }): BuildRule {\r\n    var rule = new BuildRule('', log);\r\n    rule.name = name;\r\n    rule.ui = ui ?? {};\r\n    rule.operator = Operators.add;\r\n    rule.setIdBasedOnOperation(rule.name);\r\n    rule.params = params ?? {};\r\n    if (pos) rule.pos = pos;\r\n    return rule;\r\n  }\r\n\r\n  /** Tells if this rule will override the show settings  */\r\n  overrideShow(): boolean | undefined {\r\n    if (this.operator === Operators.remove) return false;\r\n    if (this.operator === Operators.add) return true;\r\n    if (this.operator === Operators.addAuto) return undefined;\r\n    if (this.operator === Operators.modify)\r\n      return this.ui?.show; // can be true/false/undefined\r\n    return undefined;\r\n  }\r\n\r\n\r\n  private load() {\r\n    const cl = this.log.call('load', this.ruleString);\r\n    const parts = splitUrlSections(this.ruleString);\r\n    if (!parts.key)\r\n      return cl.done(\"no key, won't load\");\r\n\r\n    this.loadHeader(parts.key);\r\n    if (parts.params) {\r\n      const processed = this.loadParamsAndPrefill(parts.params);\r\n      this.params = processed.params;\r\n      this.context = processed.context;\r\n      this.settings = processed.settings;\r\n    }\r\n    // ATM seems unused...? hash is already processed before in loadHeader\r\n    // if (parts.ui) this.hash = this.loadDictionary(parts.ui);\r\n    return cl.done();\r\n  }\r\n\r\n\r\n\r\n  private loadHeader(rule: string): void {\r\n    const cl = this.log.call('loadHeader', rule);\r\n    const parts = this.splitParamsArray(rule);\r\n    let key = parts?.[0]?.[0] || RC.Keys.None;\r\n\r\n    // Pick up the operation from header, but if it's not a known operator, auto-detect\r\n    let operator = key[0];\r\n    const knownOperatorFound = Object.values(Operators).includes(operator as Operators);\r\n    if (!knownOperatorFound)\r\n      operator = (key === BuildSteps.params || key === BuildSteps.settings || key === BuildSteps.toolbar)\r\n        ? Operators.system\r\n        : Operators.add;\r\n    this.operator = operator as Operators;\r\n    cl.add(`name part '${key}', firstChar '${operator}'`);\r\n    // remember the primary keyword because this determines what we're doing\r\n    // but truncate the first char if it had an operator\r\n    key = knownOperatorFound ? key.substring(1) : key;\r\n\r\n    const knowStepFound = Object.values(BuildSteps).includes(key as BuildSteps);\r\n    this.step = knowStepFound ? key : BuildSteps.button;\r\n\r\n    this.setIdBasedOnOperation(key);\r\n\r\n    // command name defaults to name, can be reset by load-headers\r\n    // assumes key is something like \"group=myGroup\" or just \"edit\"\r\n    this.name = parts?.[0]?.[1] || key;\r\n    if (parts.length > 1) this.leadHeaderAndUi(key, parts.slice(1));\r\n\r\n    return cl.done();\r\n  }\r\n\r\n  public setIdBasedOnOperation(key: string) {\r\n    // for system and %-change operations the id should be the name of the standard button\r\n    // ...but if it's an add-operation, we must keep the IDs appart because various\r\n    // properties are set at a much later time\r\n    this.id = (this.operator === Operators.add || this.operator === Operators.addAuto)\r\n      ? 'rndId' + Math.floor(Math.random() * 99999)\r\n      : key;\r\n  }\r\n\r\n  /**\r\n   * Load the header\r\n   * @param forKey the key being loaded, to handle special case settings/toolbar\r\n   * @param rest the parameters to process\r\n   */\r\n  private leadHeaderAndUi(forKey: string, rest: string[][]) {\r\n    const cl = this.log.call('loadHeaderParts');\r\n    if (!rest.length)\r\n      return cl.done('nothing to load');\r\n    const parts = this.dicToArray(rest);\r\n    // #1 pick up id & name\r\n    if (parts.id)\r\n      this.id = parts.id as string;\r\n    if (parts.name)\r\n      this.name = parts.name as string;\r\n    // #2 pick up group\r\n    if (typeof parts.group === 'string') {\r\n      this.group = parts.group;\r\n      delete parts.group;\r\n    }\r\n    // #3 position can be number or -number to indicate from other side\r\n    // Note that JS preserves -0, which is kind of unique\r\n    if (parts.pos != null)\r\n    {\r\n      this.pos = Number(parts.pos);\r\n      // v15.09 2023-04-06 get rid of -0 (legacy) because it causes trouble with simple int in C# APIs\r\n      if (Object.is(this.pos, -0))\r\n        this.pos = -1;\r\n    }\r\n\r\n    // #4 icon is automatically kept\r\n    // #5 show override of buttons (on buttons, must convert to bool)\r\n    if (forKey !== BuildSteps.settings && forKey !== BuildSteps.toolbar)\r\n      if (typeof parts.show === 'string')\r\n        (parts as Record<string, TypeValue>).show = parts.show === 'true';\r\n    this.ui = parts;\r\n    return cl.return(this.ui, 'button rules');\r\n  }\r\n\r\n  private loadParamsAndPrefill(rule: string): ProcessedParams {\r\n    const cl = this.log.call('loadParams', rule);\r\n    const parms = this.splitParamsDic(rule);\r\n    cl.data('params', parms);\r\n    const split = RuleParamsHelper.processParams(parms, this.log);\r\n    return cl.return(split);\r\n  }\r\n\r\n  //#region string manipulation helpers\r\n\r\n  private dicToArray(original: string[][]): Record<string, string> {\r\n    return original.reduce((map, obj) => {\r\n      map[obj[0]] = obj[1];\r\n      return map;\r\n    }, {} as Record<string, string>);\r\n  }\r\n\r\n  private splitParamsDic(original: string): Record<string, string> {\r\n    return this.dicToArray(this.splitParamsArray(original));\r\n  }\r\n\r\n  private splitParamsArray(original: string): string[][] {\r\n    if (!original) return [];\r\n    const split1 = original.split('&');\r\n    const split2 = split1.map((p) => {\r\n      let i = p.indexOf('=');\r\n      if (i < 0) i = p.length;\r\n      const keyValues = [p.slice(0,i), p.slice(i+1)];\r\n      // 2022-08-15 2dm before - would have lost cases where '=' occurs in the value a few times\r\n      // const keyValues = p.split('=');\r\n      const key = keyValues[0];\r\n      let val: any = keyValues[1];\r\n      // disabled, don't see a use case for this\r\n      // check if the value had '=' - then re-join\r\n      // if (keyValues.length > 1)\r\n      //     val = keyValues.slice(1).join('=');\r\n\r\n      // fix url encoding\r\n      if (val?.indexOf('%') > -1) val = decodeURIComponent(val);\r\n      // fix C# typed true/false or string representations\r\n      if (val === 'True' || val === 'true')\r\n        return [key, true];\r\n      if (val === 'False' || val === 'false')\r\n        return [key, false];\r\n\r\n      // cast numbers to proper number objects\r\n      if (!isNaN(+val))\r\n        return [key, Number(val)];\r\n\r\n      // revert base64 encoding\r\n      if (typeof(val) === 'string' && val.startsWith(prefixBase64)) {\r\n        const afterPrefix = val.split(prefixBase64)[1];\r\n        return [key, window.atob(afterPrefix)];\r\n      }\r\n\r\n      if (typeof(val) === 'string' && val.startsWith(prefixJson64)) {\r\n        const afterPrefix = val.split(prefixJson64)[1];\r\n        return [key, JSON.parse(window.atob(afterPrefix))];\r\n      }\r\n\r\n      return [key, val];\r\n    });\r\n    return split2;\r\n  }\r\n\r\n\r\n  //#endregion\r\n}\r\n\r\n\r\n\r\n\r\nfunction splitUrlSections(str: string): { key: string, params: string, button: string } | undefined {\r\n  // dev link: https://regex101.com/r/vK4rV7/519\r\n  // inpsired by https://stackoverflow.com/questions/27745/getting-parts-of-a-url-regex\r\n\r\n  const regex = /^([^\\/?#]*)?([^?#]*)(\\?([^#]*))?(#(.*))?/i;\r\n  // const str = `+edit&something=other&els=ok?aoeuaoeu=5&aoeuaou=aoeu#but=thi&aouoaeu`;\r\n  const m = regex.exec(str);\r\n\r\n  if (m && m !== null)\r\n    return { key: m[1], params: m[4], button: m[6] };\r\n  return undefined;\r\n}\r\n\r\n// #CustomContext\r\n// /**\r\n//  * Will take a UI definition and extract the context if available\r\n//  * @param ui original value before split\r\n//  * @returns \r\n//  */\r\n// function splitUiParts(ui: string): [string, string] {\r\n//   if (!ui) return [null, null];\r\n\r\n//   // If it starts with ## then the original value only had the context\r\n//   // In this case the first # of the three ### was already removed\r\n//   if (ui.startsWith('##')) return [null, ui.substring(2)];\r\n\r\n//   const parts = ui.split('###');\r\n//   return [parts[0], parts.length > 1 ? parts[1] : null];\r\n// }\r\n","import { prefixJson64 } from '../../constants/rules';\r\nimport { NoteLink } from './NoteLink';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport type TypeNoteMode = 'info' | 'warning' | 'error' | 'help' | 'link' | undefined;\r\n\r\n/**\r\n * @internal\r\n */\r\n\r\nexport class Note {\r\n  constructor(params: Partial<Note> = undefined) {\r\n    if (params) Object.assign(this, params);    \r\n  }\r\n  /** The note itself, as text. ATM no HTML support. */\r\n  note?: string;\r\n  /** The type is mainly for the icon ATM. */\r\n  type?: TypeNoteMode;\r\n\r\n  links?: NoteLink[];\r\n\r\n  /** background color */\r\n  background?: string;\r\n\r\n  /**\r\n   * allowHtml - ATM not used - could change\r\n   * @internal\r\n   */\r\n  asHtml?: boolean;\r\n\r\n  /**\r\n   * ATM not used - could change\r\n   * @internal\r\n   */\r\n  interactive?: boolean;\r\n\r\n  /**\r\n   * delay in ms\r\n   * @internal\r\n   */\r\n  delay?: number;\r\n\r\n  /**\r\n   * linger in ms\r\n   * @internal\r\n   */\r\n  linger?: number;\r\n\r\n  /**\r\n   * indicates that this is a system note, which is usually a different color\r\n   * @internal\r\n   */\r\n  isSystem?: boolean;\r\n\r\n  public static toJson64String(note: Note): string {\r\n    return `${prefixJson64}${window.btoa(JSON.stringify(note))}`;\r\n  }\r\n}\r\n","import { Command, CommandNames, Commands } from '..';\r\n\r\nconst InsightsApiRoot = 'sys/insights';\r\n\r\nexport function insightsUrl(part: string): string {\r\n  return window.$2sxc.http.apiUrl(`${InsightsApiRoot}/${part}`);\r\n}\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.insights, 'Insights', 'speed', true, false, {\r\n  dialog: (_) => CommandNames.insights_old_server,\r\n  showCondition: (context) => context.user.CanDevelop,\r\n  code(context, event) {\r\n    const path = insightsUrl(context.button.command.params?.part as string ?? 'logs');\r\n    return new Promise((resolve) => {\r\n      window.open(path, '_blank');\r\n      return resolve();\r\n    });\r\n  },\r\n\r\n  noItems: true,\r\n});\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.insights_old_server));\r\n","import { CommandNames } from '../../../../$2sxc/src/cms/command-names';\r\nimport { Log } from '../../../../core/logging/Log';\r\nimport { insightsUrl } from '../../commands/command/command-insights';\r\nimport { ContextProblems } from '../../context/html-attribute/parts/error';\r\nimport { BuildRule } from './rule';\r\n\r\nconst thingPlaceholder = 'thing-to-replace';\r\n\r\n// https://fonts.google.com/icons?selected=Material+Symbols+Outlined:bug_report:FILL@0;wght@0;GRAD@0;opsz@NaN&icon.set=Material+Symbols&icon.query=bug\r\nconst iconBug = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"48\" viewBox=\"0 -960 960 960\" width=\"48\"><path d=\"M480-120q-65 0-121-31t-83-89H160v-60h92q-7-26-7-52.5V-406h-86v-60h86q0-29 .5-57.5T254-580h-94v-60h120q14-28 37-49t51-35l-77-76 40-40 94 94q28-10 56.5-10t56.5 10l94-94 40 40-76 76q28 14 49.5 35.5T683-640h118v60h-95q9 28 8.5 56.5T714-466h87v60h-87q0 27 .5 53.5T708-300h93v60H685q-26 59-82.5 89.5T480-120Zm0-60q72 0 123-50.5T654-353v-167q0-72-51-122.5T480-693q-72 0-123 50.5T306-520v167q0 72 51 122.5T480-180Zm-80-140h160v-60H400v60Zm0-173h160v-60H400v60Zm80 57h.5-.5.5-.5.5-.5.5-.5Z\"/></svg>';\r\n\r\n// const iconRip = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"1em\" viewBox=\"0 0 448 512\"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d=\"M368 432V192c0-79.5-64.5-144-144-144S80 112.5 80 192V432H32V192C32 86 118 0 224 0S416 86 416 192V432H368zM0 488c0-13.3 10.7-24 24-24H424c13.3 0 24 10.7 24 24s-10.7 24-24 24H24c-13.3 0-24-10.7-24-24zM248 152v40h48c13.3 0 24 10.7 24 24s-10.7 24-24 24H248V360c0 13.3-10.7 24-24 24s-24-10.7-24-24V240H152c-13.3 0-24-10.7-24-24s10.7-24 24-24h48V152c0-13.3 10.7-24 24-24s24 10.7 24 24z\"/></svg>';\r\n\r\nconst ripButton = { // ToolbarButtonSettings & Partial<ToolbarSettings> = {\r\n  color: 'orange',\r\n  icon: iconBug,\r\n  note: {\r\n    note: `<strong>Obsolete Code detected in this ${thingPlaceholder}</strong>\r\n    <br>\r\n    This uses obsolete code which will be removed soon. You should fix the code so it won't break on a future update.`,\r\n    allowHtml: true,\r\n  },\r\n}\r\n\r\nconst codeObsolete = 'obsolete';\r\nconst appCodeObsolete = 'obsolete-app';\r\n\r\n\r\n/**\r\n * Add buttons to warn about obsolete code\r\n */\r\nexport function addStandardObsoleteButtons(log: Log, problems: ContextProblems[], appId: number)\r\n  : [ContextProblems[], BuildRule[]] {\r\n  // If any of the problems report 'obsolete'\r\n  // add a special button and then skip those problems\r\n  var rules: BuildRule[] = [];\r\n  if (problems.find(p => p.code === codeObsolete) !== undefined)\r\n    rules.push(createButtonForObsolete(log, appId, 'Razor', 'red'));\r\n  else if (problems.find(p => p.code === appCodeObsolete) !== undefined)\r\n    rules.push(createButtonForObsolete(log, appId, 'App', null));\r\n\r\n  const remaining = problems.filter(p => p.code !== codeObsolete && p.code != appCodeObsolete);\r\n  return [ remaining, rules ];\r\n}\r\n\r\nfunction createButtonForObsolete(log: Log, appId: number, thing: string, color: string) {\r\n  return BuildRule.Create({\r\n    name: CommandNames.insights,\r\n    ui: {\r\n      ...ripButton,\r\n      color: color ?? ripButton.color,\r\n      note: {\r\n        ...ripButton.note,\r\n        links: [\r\n          { \r\n            url: insightsUrl(`logs?key=warnings-obsolete&filter=AppId=${appId}`),\r\n            label: 'Obsolete this App',\r\n            primary: true\r\n          },\r\n          { \r\n            url: insightsUrl('logs?key=warnings-obsolete'),\r\n            label: 'all obsolete',\r\n            primary: false\r\n          }\r\n        ],\r\n        note: ripButton.note.note.replace(thingPlaceholder, thing),\r\n      }\r\n    },\r\n    params: { part: 'Logs?&key=warnings-obsolete'},\r\n    pos: 11,\r\n    log: log\r\n  });\r\n}","import { Operations as OP, BuildRule } from '.';\r\nimport { CommandNames } from '../../commands';\r\nimport { Debug } from '../../constants/debug';\r\nimport { ContextComplete } from '../../context';\r\nimport { HasLog } from '../../core';\r\nimport { ToolbarConfigLoader } from '../config-loaders';\r\nimport { Note } from '../config/Note';\r\nimport { BuildSteps } from './build-steps';\r\nimport { addStandardObsoleteButtons } from './rules-obsolete-code';\r\n\r\nconst debug = Debug.parts.RuleManager;\r\n\r\nconst throwOnError = true;\r\nconst devInfoButtonsIndex = 20;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class RuleManager extends HasLog {\r\n  /** List of rules which were picked up and will be applied */\r\n  rules: BuildRule[] = [];\r\n\r\n  ruleManagerId = Math.floor(Math.random() * 99999);\r\n\r\n  /** Basic constructor, must be called from a ToolbarConfigLoader */\r\n  constructor(parent: ToolbarConfigLoader) {\r\n    super('Tlb.RlMngr', parent.log, 'constructor');\r\n    this.log.add('tempId:' + this.ruleManagerId);\r\n  }\r\n\r\n  /** Load/initialize the rules which were found */\r\n  load(rawList: string[]): BuildRule[] {\r\n    const cl = this.log.call('load', `${() => rawList.length}`);\r\n    if (!Array.isArray(rawList))\r\n        return cl.return([], 'raw is empty');\r\n\r\n    rawList.forEach((raw) => {\r\n      if (typeof raw !== 'string') {\r\n        console.error('tried to parse a toolbar rule and expected a string, but got something else');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        this.rules.push(new BuildRule(raw, this.log));\r\n      } catch (e) {\r\n        if (throwOnError) throw e;\r\n        cl.add(`error adding string-rule '${raw}'`, e);\r\n      }\r\n    });\r\n\r\n    return cl.return(this.rules, 'final rules');\r\n  }\r\n\r\n  /**\r\n   * Find out if there are any problems on this block, and add buttons to see them to the toolbar\r\n   * @param context \r\n   * @returns \r\n   */\r\n  addDeveloperInfos(context: ContextComplete) {\r\n    // Skip if already added\r\n    if (this.debugAdded) return;\r\n\r\n    // Skip if no problems reported\r\n    const hasErr = !!context.system.error;\r\n    if (hasErr) {\r\n      const note = new Note({\r\n        // type: 'error',\r\n        note: '<strong>Server Insights Logs</strong> can help <br> you debug server errors.',\r\n        asHtml: true,\r\n      });\r\n      // note.note = '<strong>Server Insights Logs</strong> can help <br> you debug server errors.';\r\n      // note.allowHtml = true;\r\n      this.rules.push(BuildRule.Create({ name: CommandNames.insights, ui: { note, color: 'red' }, pos: 10, log: this.log }));\r\n    }\r\n\r\n    // Get any other problems and stop if none found\r\n    let problems = context.system.problems;\r\n    if (!(problems?.length > 0)) return;\r\n\r\n    // If any of the problems report 'obsolete'\r\n    // add a special button and then skip those problems\r\n    const [remaining, newRules] = addStandardObsoleteButtons(this.log, problems, context.app.id);\r\n    problems = remaining;\r\n    newRules.forEach(r => this.rules.push(r));\r\n\r\n    // Add warning/info buttons provided by the context - new v16.02\r\n    if (debug) console.log('2dm - has problems', problems);\r\n\r\n    // create rules to add the buttons for all remaining problems\r\n    const rules = problems.map((p, i) => {\r\n      const note = new Note({\r\n        type: p.severity,\r\n        note: p.message?.replace('\\n', '<br>'),\r\n        asHtml: true,\r\n        interactive: true,\r\n      });\r\n      // note.note = p.message?.replace('\\n', '<br>');\r\n      if (p.link)\r\n        note.links = [{ url: p.link, label: 'see docs', primary: true }];\r\n      // note.type = p.severity;\r\n      // note.allowHtml = true;\r\n      // note.interactive = true;\r\n      return BuildRule.Create({ name: CommandNames.info, ui: { note }, params: { link: p.link }, pos: devInfoButtonsIndex + i, log: this.log });\r\n    });\r\n    if (debug) console.log('2dm - rules', rules);\r\n    rules.forEach(r => this.rules.push(r));\r\n  }\r\n  private debugAdded = false;\r\n\r\n  /** Find a single rule matching an ID */\r\n  find(id: string): BuildRule | undefined { return this.rules.find((r) => r.id === id); }\r\n\r\n  /** find all rules matching a criteria */\r\n  filter(criteria: (x: BuildRule) => boolean): BuildRule[] { return this.rules.filter(criteria); }\r\n\r\n\r\n  /**\r\n   * The settings are usually retrieved on settings,\r\n   * but you can also put them behind the toolbar.\r\n   * But mixing both won't work ATM by design.\r\n   */\r\n  getSettings() {\r\n    const all = this.getSystemRuleS(BuildSteps.settings) || [];\r\n    // Params must be merged BEFORE adding the main toolbar rule\r\n    // because actually settings shouldn't have params, but historically it was used\r\n    // But toolbar-rule params are never for the settings\r\n    // Because this params-mistake was only made when only 1 settings was allowed\r\n    // We will only use one setting\r\n    const params = Object.assign({}, ...all.slice(0, 1).map((a) => a?.params));\r\n\r\n    const tlbPart = this.getToolbar();\r\n    if (tlbPart) all.unshift(tlbPart); // add to start, so it's the lowest priority\r\n    const ui = Object.assign({}, ...all.map((a) => a?.ui));\r\n\r\n    return { ui, params };\r\n  }\r\n\r\n  /**\r\n   * The params for the command - if not found, will use the toolbar params.\r\n   * But it's either or, mixing won't work by design ATM.\r\n   */\r\n  getParams = () => this.getSystemRule(BuildSteps.params) || this.getToolbar();\r\n\r\n  getToolbar = () => this.getSystemRule(BuildSteps.toolbar);\r\n  getAdd = () => this.filter((br) => br.operator === OP.add || br.operator === OP.addAuto);\r\n  getRemoveGroups = () => this.filter((br) => br.operator === OP.remove && br.step === BuildSteps.group);\r\n\r\n  /** Find a system rule (marked with '$') */\r\n  private getSystemRule(name: BuildSteps): BuildRule | undefined {\r\n    return this.rules.find((r) => r.operator === OP.system && r.step === name);\r\n  }\r\n\r\n  /** Find a system rule (marked with '$') */\r\n  private getSystemRuleS(name: BuildSteps): BuildRule[] | undefined {\r\n    return this.rules.filter((r) => r.operator === OP.system && r.step === name);\r\n  }\r\n\r\n}\r\n","import { InPageButtonGroupJson, InPageButtonJson, InPageCommandJson, ToolbarConfigLoader, ToolbarWip } from '.';\r\nimport { InPageToolbarConfigVariations, ToolbarInitConfig } from '..';\r\nimport { ContextComplete } from '../../context';\r\nimport { HasLog } from '../../core';\r\nimport { Button, Toolbar, ToolbarSettings } from '../config';\r\nimport { RuleManager } from '../rules';\r\nimport { ToolbarTemplate, ToolbarTemplateDefault, ToolbarTemplateGroup, ToolbarTemplateSublist } from '../templates';\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ToolbarConfigLoaderV09 extends HasLog {\r\n\r\n  private rules: RuleManager;\r\n\r\n  constructor(private configLoader: ToolbarConfigLoader) {\r\n    super('Tlb.TlbV09', configLoader.log);\r\n    this.rules = new RuleManager(configLoader);\r\n  }\r\n\r\n\r\n\r\n  public loadV9(context: ContextComplete, config: ToolbarInitConfig): Toolbar {\r\n    const cl = this.log.call('loadV9');\r\n    let toolbarSettings = config.settings;\r\n\r\n    // Default to empty toolbar settings if we don't have a toolbar or settings\r\n    // important: the checks look a bit strange, but there are cases where {} settings are handed in\r\n    // and we can't count the keys because that would result in other checks\r\n    if (Object.keys(config.toolbar).length > 0 && toolbarSettings === ({} as ToolbarSettings)) {\r\n      cl.add('no data or settings, will use default settings for empty');\r\n      toolbarSettings = ToolbarSettings.getForEmpty();\r\n    }\r\n\r\n    // if it has an action or is an array, keep that. Otherwise get standard buttons\r\n    const draftToolbar = this.getTemplateIfNoButtonsSpecified(context, config.toolbar as InPageToolbarConfigVariations);\r\n    cl.data('after template check', draftToolbar);\r\n\r\n    const toolbar = this.buildFullDefinition(context, draftToolbar, toolbarSettings);\r\n    return cl.return(toolbar, 'ok');\r\n  }\r\n\r\n\r\n  /**\r\n   * If the raw data has specs for what buttons, use that\r\n   * Otherwise load the button list from the template\r\n   */\r\n  private getTemplateIfNoButtonsSpecified(context: ContextComplete, raw: InPageToolbarConfigVariations): InPageToolbarConfigVariations {\r\n    const cl = this.log.call('getTemplateIfNoButtonsSpecified');\r\n    cl.add('initial', raw);\r\n\r\n    if (InPageCommandJson.hasActions(raw)) return cl.return(raw, 'has actions, keep raw');\r\n    if (ToolbarTemplate.hasGroups(raw)) return cl.return(raw, 'has groups, keep raw');\r\n    if (ToolbarTemplateGroup.is(raw)) return cl.return(raw, 'is group, keep raw');\r\n    if (Array.isArray(raw)) return cl.return(raw, 'is array, keep raw');\r\n\r\n    // final: nothing defined, use template\r\n    cl.add('no toolbar structure specified, will use standard toolbar template');\r\n    // If it's a sub-list toolbar, use the special template for it\r\n    const defToolbarname = (raw as InPageCommandJson).fields ? ToolbarTemplateSublist.name : ToolbarTemplateDefault.name;\r\n    const template = this.configLoader.templates.copy(defToolbarname);\r\n    template.params = (Array.isArray(raw) && raw[0]) || raw; // attach parameters\r\n\r\n    // New 16.02 - add developer infos / buttons WIP\r\n    this.rules.addDeveloperInfos(context);\r\n    const addRules = this.rules.getAdd();\r\n    this.configLoader.templateEditor.add(template, addRules);\r\n\r\n    return cl.return(template, 'use template');\r\n  }\r\n\r\n\r\n\r\n\r\n  /**\r\n   * take various common input format and convert it to a full toolbar-structure definition\r\n   * can handle the following input formats (the param unstructuredConfig):\r\n   * complete tree (detected by \"groups): \\{ groups: [ \\{\\}, \\{\\}], name: ..., defaults: \\{...\\} \\}\r\n   * group of buttons (detected by \"buttons): \\{ buttons: \"...\" | [], name: ..., ... \\}\r\n   * list of buttons (detected by IsArray with action): [ \\{ action: \"...\" | []\\}, \\{ action: \"\"|[]\\} ]\r\n   * button (detected by \"command\"): \\{ command: \"\"|[], icon: \"..\", ... \\}\r\n   * just a command (detected by \"action\"): \\{ entityId: 17, action: \"edit\" \\}\r\n   * array of commands: [\\{entityId: 17, action: \"edit\"\\}, \\{contentType: \"blog\", action: \"new\"\\}]\r\n   */\r\n  private buildFullDefinition(\r\n      toolbarContext: ContextComplete,\r\n      unstructuredConfig: InPageToolbarConfigVariations,\r\n      toolbarSettings: ToolbarSettings,\r\n  ): Toolbar {\r\n    const cl = this.log.call('buildFullDefinition');\r\n\r\n    const configWip = this.ensureDefinitionTree(unstructuredConfig, toolbarSettings); // as unknown as Toolbar;\r\n\r\n    if (ToolbarTemplate.is(unstructuredConfig) && unstructuredConfig.debug)\r\n        console.log('toolbar: detailed debug on; start build full Def');\r\n\r\n    const result = this.configLoader.buildTreeAndModifyAccordingToRules(toolbarContext, configWip);\r\n\r\n    // New v16.02\r\n    result.settings._rules = this.rules;\r\n\r\n    return cl.return(result);\r\n  }\r\n\r\n\r\n\r\n  //#region build initial toolbar object\r\n  /**\r\n   * this will take an input which could already be a tree, but it could also be a\r\n   * button-definition, or just a string, and make sure that afterwards it's a tree with groups\r\n   * the groups could still be in compact form, or already expanded, depending on the input\r\n   * output is object with:\r\n   * - groups containing buttons[], but buttons could still be very flat\r\n   * - defaults, already officially formatted\r\n   * - params, officially formatted\r\n   */\r\n  private ensureDefinitionTree(unstructuredConfig: InPageToolbarConfigVariations, toolbarSettings: ToolbarSettings): ToolbarWip {\r\n    const l = this.log.call('ensureDefinitionTree');\r\n    // original is null/undefined, just return empty set\r\n    if (!unstructuredConfig) throw (`preparing toolbar, with nothing to work on: ${unstructuredConfig}`);\r\n\r\n    const newToolbar: ToolbarWip = new Toolbar();\r\n    newToolbar.groups = this.findGroups(unstructuredConfig);\r\n\r\n    const probablyTemplate = unstructuredConfig as ToolbarTemplate;\r\n    newToolbar.params = probablyTemplate.params || {}; // these are the default command parameters\r\n    newToolbar.settings = { ...ToolbarSettings.getDefaults(), ...probablyTemplate.settings, ...ToolbarSettings.dropEmptyProperties(toolbarSettings)};\r\n\r\n    newToolbar.debug = probablyTemplate.debug || false; // show more debug info\r\n    newToolbar.defaults = probablyTemplate.defaults || {}; // the button defaults like icon, etc.\r\n\r\n    return l.return(newToolbar);\r\n  }\r\n\r\n\r\n  private findGroups(unstructuredConfig: InPageToolbarConfigVariations): InPageButtonGroupJson[] {\r\n    const l = this.log.call('findGroups');\r\n    l.data('initial', unstructuredConfig);\r\n\r\n    // case 0: nothing in the config\r\n    if (!unstructuredConfig || (Object.getOwnPropertyNames(unstructuredConfig).length === 0))\r\n      return l.return([], 'case 0: empty object, use []');\r\n\r\n    const arrGroups: InPageButtonGroupJson[] = [];\r\n\r\n    // ensure that the groups are all correct\r\n    l.add('will detect what initial structure was given');\r\n\r\n    // Case 2: Array\r\n    if (Array.isArray(unstructuredConfig)) {\r\n      l.add('Case 2: is array');\r\n      if (unstructuredConfig.length === 0)\r\n        return l.return([], '2a: empty array');\r\n      if (Button.isArray(unstructuredConfig))\r\n        return l.return([{ buttons: unstructuredConfig }], '2b: array of groups');\r\n      if (InPageButtonJson.is(unstructuredConfig[0]))\r\n        return l.return([{ buttons: unstructuredConfig as InPageButtonJson[]}],\r\n          '2b: is list of buttons, return 1 group');\r\n      console.warn('error detecting groups in this toolbar');\r\n      return l.return([], \"2x: error, it's array but can't detect type, use []\");\r\n    }\r\n\r\n    // Case 3: not an array\r\n    l.add('Case 3: not array');\r\n    if (InPageButtonJson.is(unstructuredConfig)) {\r\n      return l.return([ { buttons: [unstructuredConfig] }],\r\n        'Case 3a: not array, but has action/buttons properties, will wrap config into array');\r\n    }\r\n\r\n    l.add('Case 3: not array and no \"action\", will return it or blank');\r\n    // we either have groups already, or we'll return blank\r\n    if (ToolbarTemplate.hasGroups(unstructuredConfig))\r\n      return l.return(unstructuredConfig.groups, '4: found groups');\r\n\r\n    l.add('can\\'t detect what this is - show warning');\r\n    console.warn(\"toolbar tried to build toolbar but couldn't detect type of this:\", arrGroups);\r\n    return l.return([], 'warning');\r\n  }\r\n}\r\n","import { ToolbarConfigLoader, InPageCommandJson } from '.';\r\nimport { ToolbarInitConfig } from '..';\r\nimport { Debug } from '../../constants/debug';\r\nimport { ContextComplete } from '../../context';\r\nimport { HasLog } from '../../core';\r\nimport { Toolbar, ToolbarSettings } from '../config';\r\nimport { BuildSteps, RuleManager } from '../rules';\r\nimport { ToolbarTemplate, ToolbarTemplateDefault, ToolbarTemplateSublist } from '../templates';\r\nimport { ToolbarWip } from './config-formats/toolbar-wip';\r\n\r\nconst debug = Debug.parts.ToolbarConfigLoaderV10;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ToolbarConfigLoaderV10 extends HasLog {\r\n\r\n  public rules: RuleManager;\r\n\r\n  constructor(private configLoader: ToolbarConfigLoader) {\r\n    super('Tlb.TlbV10', configLoader.log, 'constructor');\r\n    this.rules = new RuleManager(configLoader);\r\n  }\r\n\r\n\r\n  public loadV10(context: ContextComplete, config: ToolbarInitConfig, raw: string[]): Toolbar {\r\n    const cl = this.log.call('loadV10');\r\n\r\n    this.rules.load(raw);\r\n\r\n    // #1 prepare settings - get rules and mix with defaults\r\n    // We should use the `ui` parameter, as it's UI rules, but because previously\r\n    // it used the `params` - we must support both :(\r\n    const settingRule = this.rules.getSettings();\r\n    let settingsUiRule = settingRule?.ui as Partial<ToolbarSettings>;\r\n    if (Object.keys(settingsUiRule || {}).length === 0)\r\n      settingsUiRule = settingRule?.params as Partial<ToolbarSettings>;\r\n    const settings = new ToolbarSettings(settingsUiRule);\r\n\r\n    // #2 load either the default toolbar or the one specified\r\n    const toolbarRule = this.rules.getToolbar();\r\n\r\n    // #3 find params\r\n    const params = this.rules.getParams();\r\n\r\n    // If it's a sub-list toolbar, use the special template for it\r\n    const isSublist = (config.toolbar as InPageCommandJson).fields || params?.params?.fields;\r\n    const defToolbarname = isSublist ? ToolbarTemplateSublist.name : ToolbarTemplateDefault.name;\r\n    const toolbarTemplateName = toolbarRule?.name ?? defToolbarname;\r\n    let template = this.configLoader.templates.copy(toolbarTemplateName);\r\n    template.settings = settings;\r\n    if (params) template.params = params.params;\r\n\r\n    // #4 Remove unwanted groups\r\n    const removeGroups = this.rules.getRemoveGroups();\r\n    removeGroups.forEach((rg) => this.configLoader.templateEditor.removeGroup(template, rg.name));\r\n\r\n    // Add additional buttons 16.02\r\n    this.rules.addDeveloperInfos(context);\r\n    const addRules = this.rules.getAdd();\r\n    this.configLoader.templateEditor.add(template, addRules);\r\n\r\n    // Build the real toolbar structure\r\n    const toolbar = this.configLoader.buildTreeAndModifyAccordingToRules(context, template as ToolbarWip);\r\n    if (!toolbar.identifier) toolbar.identifier = Toolbar.createIdentifier();\r\n    toolbar.settings._rules = this.rules;\r\n    // process the rules one by one\r\n    return cl.return(toolbar, 'ok');\r\n  }\r\n}\r\n","import { ButtonConfigLoader, ButtonGroupConfigLoader, CommandConfigLoader, ToolbarConfigLoaderV09, ToolbarConfigLoaderV10, ToolbarWip } from '.';\r\nimport { ToolbarManager } from '..';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { HasLog, LogEntry } from '../../core';\r\nimport { Toolbar } from '../config';\r\nimport { InPageToolbarConfigVariations, ToolbarInitConfig } from '../initialize/toolbar-init-config';\r\nimport { TemplateEditor, ToolbarTemplate, ToolbarTemplateManager } from '../templates';\r\n\r\n// Enable when debugging toolbar creation - will dump all logs to the console\r\nconst liveDumpThis = false;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ToolbarConfigLoader extends HasLog {\r\n\r\n  public toolbarV09: ToolbarConfigLoaderV09;\r\n  public toolbarV10: ToolbarConfigLoaderV10;\r\n  public groups: ButtonGroupConfigLoader;\r\n  public button: ButtonConfigLoader;\r\n  public command: CommandConfigLoader;\r\n  public templates = ToolbarTemplateManager.singleton();\r\n  public templateEditor: TemplateEditor;\r\n\r\n  public logs: Array<{ key: string, entries: LogEntry[]}>;\r\n\r\n  /** Special constructor that can only be called from the ToolbarManager */\r\n  constructor(_owner: ToolbarManager) {\r\n      // important: always create a new log as it will be stored in insights\r\n      super('Tlb.TlbCnf');\r\n  }\r\n\r\n  private setLoggingAndCreateHelpers(toolbarData: InPageToolbarConfigVariations): void {\r\n    // note: could be true, false or 'live'\r\n    let debugLog = toolbarData && (toolbarData as ToolbarTemplate).debug;\r\n    if (debugLog === undefined && Array.isArray(toolbarData) && toolbarData.length)\r\n      debugLog = (toolbarData[0] as ToolbarTemplate).debug;\r\n\r\n    debugLog = debugLog || false;\r\n\r\n    if (liveDumpThis || debugLog) {\r\n      this.log.keepData = true;\r\n      if (liveDumpThis || debugLog.toString() === 'live')\r\n        this.log.liveDump = true;\r\n      this.log.add(`found debug=${debugLog}, will enable intense logging`);\r\n    }\r\n    this.toolbarV09 = new ToolbarConfigLoaderV09(this);\r\n    this.toolbarV10 = new ToolbarConfigLoaderV10(this);\r\n    this.groups = new ButtonGroupConfigLoader(this);\r\n    this.button = new ButtonConfigLoader(this);\r\n    this.command = new CommandConfigLoader(this);\r\n    this.templateEditor = new TemplateEditor(this);\r\n  }\r\n\r\n\r\n\r\n  load(context: ContextComplete, config: ToolbarInitConfig): Toolbar {\r\n    const l = this.log.call('load', '', 'expand start', { context: context, config: config });\r\n    // cl.data('initial context', context);\r\n    // cl.data('initial config', config);\r\n    // if null/undefined, use empty object\r\n    const raw = config.toolbar = config.toolbar || {};\r\n    this.setLoggingAndCreateHelpers(raw as InPageToolbarConfigVariations);\r\n\r\n    // check if it's a V10 toolbar\r\n    if (Array.isArray(raw) && raw.length >= 0 && typeof raw[0] === 'string')\r\n      return l.return(this.toolbarV10.loadV10(context, config, raw), 'v10 done');\r\n\r\n    // do standard V3 procedures\r\n    return l.return(this.toolbarV09.loadV9(context, config), 'V9 done');\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  public buildTreeAndModifyAccordingToRules(toolbarContext: ContextComplete, configWip: ToolbarWip) {\r\n    const wrapLog = this.log.call('buildFullDefinition');\r\n    const tlbConfig = this.groups.expandButtonGroups(configWip);\r\n    this.button.removeDisableButtons(toolbarContext, tlbConfig);\r\n    return wrapLog.return(tlbConfig);\r\n  }\r\n\r\n\r\n//#endregion initial toolbar object\r\n\r\n}\r\n","import { ToolbarConfigFinderAndInitializer } from '.';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HasLog, Insights } from '../core';\r\nimport { ToolbarConfigLoader } from './config-loaders/toolbar-config-loader';\r\nimport { Toolbar } from './config/toolbar';\r\nimport { ToolbarInitConfig } from './initialize/toolbar-init-config';\r\n\r\n/**\r\n * Toolbar manager for the whole page - basically a set of APIs\r\n * the toolbar manager is an internal helper taking care of toolbars, buttons etc.\r\n * @internal\r\n */\r\nexport class ToolbarManager extends HasLog {\r\n\r\n  /** Singleton */\r\n  public static singleton(): ToolbarManager {\r\n    return this._singleton ?? (this._singleton = new ToolbarManager());\r\n  }\r\n  private static _singleton: ToolbarManager;\r\n\r\n  private readonly toolbarFinder: ToolbarConfigFinderAndInitializer;\r\n\r\n  private constructor() {\r\n    super('Tlb.Mngr', null, 'init');\r\n    Insights.add('system', 'toolbar-manager', this.log);\r\n    this.toolbarFinder = new ToolbarConfigFinderAndInitializer(this);\r\n  }\r\n\r\n  buildModule(parentTag: HTMLElement) {\r\n    this.toolbarFinder.buildDnnModule(parentTag);\r\n  }\r\n\r\n  build(node: HTMLElement) {\r\n    this.toolbarFinder.build(node);\r\n  }\r\n\r\n  loadConfig(context: ContextComplete, config: ToolbarInitConfig): Toolbar {\r\n    const loader = this.getLoader(JSON.stringify(config.toolbar || ''));\r\n    return loader.load(context, config);\r\n  }\r\n\r\n  /** Generate a single-use loader. It must be single use so the logs work */\r\n  getLoader(instanceName: string) {\r\n    const loader = new ToolbarConfigLoader(this);\r\n    Insights.add('toolbar', instanceName, loader.log);\r\n    return loader;\r\n  }\r\n}\r\n\r\n// export const ToolbarManager = new ToolbarManagerGlobal();\r\n","import { ModifierContentBlock, Selection } from \".\";\r\nimport { Sxc } from \"../../../$2sxc/src\";\r\nimport { ContentListActionParams } from \"../commands\";\r\nimport { HasLog, NoJQ } from \"../core\";\r\nimport { ToolbarManager } from \"../toolbar/toolbar-manager\";\r\n\r\n// note: this import must be at the end of the list, for reasons unknown\r\n// otherwise you get an error at runtime, something about constructors\r\n// Object prototype may only be an Object or null: undefined\r\n// not sure why though\r\n// tslint:disable-next-line: ordered-imports\r\nimport { translate } from \"../i18n\";\r\n\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiNew = \"cms/block/block\";\r\nconst webApiMove = \"cms/list/move\";\r\nconst webApiRemove = \"cms/list/Delete\";\r\n//#endregion\r\n\r\n/**\r\n * contains commands to create/move/delete a content-block in an inner-content\r\n * @internal\r\n */\r\nexport class ModifierContentBlockInstance extends HasLog {\r\n  constructor(parent: ModifierContentBlock, private sxcInstance: Sxc) {\r\n    super(\"QE.MdCbIn\", parent.log);\r\n  }\r\n\r\n  /**\r\n   * create content block\r\n   */\r\n  create(\r\n    parentId: number,\r\n    field: string,\r\n    index: number,\r\n    app: string, // app name\r\n    container: HTMLElement,\r\n    guid: string // guid of new item\r\n  ): Promise<void> {\r\n    // the wrapper, into which this will be placed and the list of pre-existing blocks\r\n    if (!container) {\r\n      alert(\"can't add content-block as we couldn't find the list\");\r\n      return Promise.resolve();\r\n    }\r\n    const cBlockList = container.querySelectorAll<HTMLElement>(\r\n      \"div.sc-content-block\"\r\n    );\r\n    if (index > cBlockList.length) index = cBlockList.length; // make sure index is never greater than the amount of items\r\n\r\n    const params = { parentId, field, index, app, guid };\r\n\r\n    const promise = this.sxcInstance.webApi\r\n      .fetchJson(\r\n        this.sxcInstance.webApi.url(webApiNew, params),\r\n        undefined,\r\n        \"POST\"\r\n      )\r\n      .then((result) => {\r\n        const newTag = NoJQ.domFromString(result)[0]; // prepare tag for inserting\r\n\r\n        // should I add it to a specific position...\r\n        if (cBlockList.length > 0 && index > 0)\r\n          cBlockList[\r\n            cBlockList.length > index - 1 ? index - 1 : cBlockList.length - 1\r\n          ].after(newTag);\r\n        // ...or just at the beginning?\r\n        else container.prepend(newTag);\r\n\r\n        // ReSharper disable once UnusedLocals\r\n        const sxcNew = window.$2sxc(newTag);\r\n        ToolbarManager.singleton().buildModule(newTag);\r\n      });\r\n    return Promise.resolve(promise);\r\n  }\r\n\r\n  /**\r\n   * move content block\r\n   * @param parentId\r\n   * @param field\r\n   * @param indexFrom\r\n   * @param indexTo\r\n   */\r\n  move(\r\n    parent: string,\r\n    field: string,\r\n    indexFrom: number,\r\n    indexTo: number\r\n  ): Promise<void> {\r\n    const params: ContentListActionParams = {\r\n      parent: parent,\r\n      fields: field,\r\n      index: indexFrom,\r\n      toIndex: indexTo,\r\n    };\r\n\r\n    const promise = this.sxcInstance.webApi\r\n      .fetchRaw(\r\n        this.sxcInstance.webApi.url(webApiMove, params),\r\n        undefined,\r\n        \"POST\"\r\n      )\r\n      .then(() => {\r\n        console.log(\"done moving!\");\r\n        window.location.reload();\r\n      });\r\n    return Promise.resolve(promise);\r\n  }\r\n\r\n  /**\r\n   * delete a content-block inside a list of content-blocks\r\n   * @param parent\r\n   * @param field\r\n   * @param index\r\n   */\r\n  delete(selection: Selection): Promise<void> {\r\n    if (!confirm(translate(\"QuickInsertMenu.ConfirmDelete\"))) return null;\r\n\r\n    const params: ContentListActionParams = {\r\n      parent: selection.parentGuid,\r\n      fields: selection.field,\r\n      index: selection.index,\r\n    };\r\n\r\n    const promise = this.sxcInstance.webApi\r\n      .fetchRaw(\r\n        this.sxcInstance.webApi.url(webApiRemove, params),\r\n        undefined,\r\n        \"DELETE\"\r\n      )\r\n      .then(() => {\r\n        console.log(\"done deleting!\");\r\n        window.location.reload();\r\n      });\r\n    return Promise.resolve(promise);\r\n  }\r\n}\r\n","import {\r\n  ModifierBase,\r\n  QeSelectors,\r\n  QuickE,\r\n  QuickEClipboard,\r\n  Selection,\r\n} from \".\";\r\nimport { ContextForLists } from \"./context-for-lists\";\r\nimport { ModifierContentBlockInstance } from \"./modifier-content-block-internal\";\r\nimport { DomTools } from '../../../$2sxc/src/dom/dom-tools';\r\nimport { AttrJsonEditContext } from '../context/html-attribute/edit-context-root';\r\n\r\n/**\r\n * extend the quick edit with the core commands\r\n * @internal\r\n */\r\nexport class ModifierContentBlock extends ModifierBase {\r\n  constructor() {\r\n    super(\"QE.CntBlk\");\r\n  }\r\n\r\n  private getInstanceModifier(tag: HTMLElement) {\r\n    const sxc = window.$2sxc(tag);\r\n    debugger;\r\n    return new ModifierContentBlockInstance(this, sxc);\r\n  }\r\n\r\n  /** Delete an inner content-block */\r\n  delete(clip: Selection): Promise<void> {\r\n    return this.getInstanceModifier(clip.list).delete(clip);\r\n  }\r\n\r\n  create(\r\n    parent: number,\r\n    field: string,\r\n    listIndex: number,\r\n    appOrContent: string,\r\n    list: HTMLElement,\r\n    newGuid: string\r\n  ): Promise<void> {\r\n    return this.getInstanceModifier(list).create(\r\n      parent,\r\n      field,\r\n      listIndex,\r\n      appOrContent,\r\n      list,\r\n      newGuid\r\n    );\r\n  }\r\n\r\n  move(oldClip: Selection, newClip: Selection) {\r\n    const from = this.findClipListIndex(oldClip);\r\n    const to = this.findClipListIndex(newClip);\r\n    this.getInstanceModifier(oldClip.list).move(\r\n      newClip.parentGuid,\r\n      newClip.field,\r\n      from,\r\n      to\r\n    );\r\n  }\r\n\r\n  // cb-numbering is a bit different, because the selector is at the bottom\r\n  // only there we should also skip on +1;\r\n  isRealMove(oldClip: Selection, newClip: Selection): boolean {\r\n    return this.findClipListIndex(oldClip) + 1 !== this.findClipListIndex(newClip);\r\n  }\r\n\r\n  /**\r\n   * find the real index of this block in the list - may not match the DOM index\r\n   */\r\n  findClipListIndex(clip: Selection): number {\r\n    return this.findListIndex(clip.item, clip.index);\r\n  }\r\n\r\n  /**\r\n   * find the real index of a block tag as it may not match the DOM index\r\n   * TODO: @2dm - not really sure what this is, should be documented more clearly\r\n   */\r\n  findListIndex(tag: HTMLElement, fallback: number): number {\r\n    const editContext = DomTools.getContextOfTag(tag) as AttrJsonEditContext;\r\n    const listIndex = editContext?.contentBlockReference?.parentIndex ?? fallback;\r\n    return listIndex;\r\n  }\r\n\r\n  /**\r\n   * The button click handler. Must be static, as it will be attached to the buttons\r\n   * So the 'this' is not a ContentBlockModifier, but the html-tag which was clicked\r\n   */\r\n  static onCbButtonClick() {\r\n    const blockTag = QuickE.singleton().main.activeContentBlock;\r\n    const button = this as unknown as HTMLElement;\r\n    const list = QeSelectors.blocks.cb.findClosestList(blockTag);\r\n    const listItems = list.querySelectorAll<HTMLElement>(\r\n      QeSelectors.blocks.cb.selector\r\n    );\r\n    const actionConfig = ContextForLists.getFromDom(list);\r\n    const newGuid: string | null = actionConfig.guid || null;\r\n\r\n    // if the target is a content-block, then the list already has items\r\n    // so the domIndex must be based on that. Otherwise use 0\r\n    const domIndex = blockTag.classList.contains(QeSelectors.blocks.cb.class)\r\n      ? Array.from(listItems).indexOf(blockTag) + 1\r\n      : 0;\r\n\r\n    // Check if it's a cut/paste action\r\n    const cbAction = button.getAttribute(\"data-action\");\r\n    if (cbAction)\r\n      return QuickEClipboard.singleton().do(\r\n        cbAction,\r\n        list,\r\n        domIndex,\r\n        QeSelectors.blocks.cb.id\r\n      );\r\n\r\n    // this is a create-additional block action\r\n    // in this case the clipboard doesn't exist\r\n    // so we'll have to find the dom object and get the list index\r\n    const listIndex =\r\n      QuickEClipboard.singleton().modCb.findListIndex(blockTag, domIndex - 1) +\r\n      1;\r\n\r\n    const appOrContent = button.getAttribute(\"data-type\");\r\n    return QuickEClipboard.singleton().modCb.create(\r\n      actionConfig.parent as number,\r\n      actionConfig.field,\r\n      listIndex,\r\n      appOrContent,\r\n      list,\r\n      newGuid\r\n    );\r\n  }\r\n}\r\n","\r\n/**\r\n * @internal\r\n */\r\nexport class PositionCoordinates {\r\n    public w?: number;\r\n    public yh?: number;\r\n    public element?: HTMLElement;\r\n\r\n    constructor(public x: number, public y: number) { }\r\n\r\n}\r\n","import { ModifierBase, ModifierDnnModuleInternal, QeSelectors, QuickE, QuickEClipboard, Selection } from '.';\r\nimport { NoJQ } from '../plumbing';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ModifierDnnModule extends ModifierBase {\r\n\r\n    private modInternal: ModifierDnnModuleInternal;\r\n\r\n    constructor() {\r\n        super('QE.DnnMod');\r\n        this.modInternal = new ModifierDnnModuleInternal(this);\r\n    }\r\n\r\n    delete(clip: Selection): Promise<void> {\r\n        if (!confirm('are you sure?')) return;\r\n        const modId = this.modInternal.getModuleId(clip.item.className);\r\n        this.modInternal.delete(modId);\r\n    }\r\n\r\n    // todo: unsure if this is a good place for this bit of code...\r\n    move(oldClip: Selection, newClip: Selection /*, from: number, to: number*/): void {\r\n        const from = oldClip.index;\r\n        const to = newClip.index;\r\n        const modId = this.modInternal.getModuleId(oldClip.item.className);\r\n        const pane: string = this.modInternal.getPaneName(newClip.list);\r\n        this.modInternal.move(modId, pane, to);\r\n    }\r\n\r\n    isRealMove(oldClip: Selection, newClip: Selection): boolean {\r\n        const oldPane = this.modInternal.getPaneName(oldClip.list);\r\n        const newPane = this.modInternal.getPaneName(newClip.list);\r\n        return oldPane !== newPane || oldClip.index !== newClip.index;\r\n    }\r\n\r\n\r\n    showSendToPane(): void {\r\n        // debugger; // there is a bug where pane options are not updated when user clicks send to pane once, until that button is clicked again\r\n        // to reproduce: select module in header pane, click sendToPane. Now select module in content pane and notice panes list is showing panes for previous module\r\n        const quickE = QuickE.singleton();\r\n        const pane = QeSelectors.blocks.mod.findClosestList(quickE.main.activeModule);\r\n        // debugger; // breaks in inner content buttons, like Accordion App. Check if I can hide this button in inner content\r\n        if (!pane) return;\r\n\r\n        // show the pane-options\r\n        const pl = quickE.selected.querySelector<HTMLElement>('#paneList');\r\n        if (!pl.matches(':empty')) NoJQ.empty(pl);\r\n        pl.append(this.modInternal.getMoveButtons(this.modInternal.getPaneName(pane)));\r\n    }\r\n\r\n    static onModuleButtonClick() {\r\n        const _this = this as unknown as HTMLElement;\r\n        const type = _this.getAttribute('data-type');\r\n        const dnnMod = QuickE.singleton().main.activeModule;\r\n        const pane = QeSelectors.blocks.mod.findClosestList(dnnMod);\r\n        let index = 0;\r\n\r\n        if (dnnMod.classList.contains('DnnModule'))\r\n            index = Array.from(pane.querySelectorAll<HTMLElement>('.DnnModule')).indexOf(dnnMod) + 1;\r\n\r\n        const cbAction = _this.getAttribute('data-action');\r\n        if (cbAction)\r\n            return QuickEClipboard.singleton().do(cbAction, pane, index, QeSelectors.blocks.mod.id); // copy/paste\r\n        const modManage = QuickEClipboard.singleton().modDnn.modInternal;\r\n        return modManage.create(modManage.getPaneName(pane), index, type);\r\n    }\r\n}\r\n","import { ModifierDnnModule, QuickE, QuickEClipboard } from '.';\r\nimport { HasLog, NoJQ } from '../core';\r\n\r\n// Important - for DNN it still uses #jquery\r\nconst dnnSF = (id?: number) => window.$.dnnSF(id);\r\n\r\n/**\r\n * module specific stuff\r\n * @internal\r\n */\r\nexport class ModifierDnnModuleInternal extends HasLog {\r\n\r\n    constructor(parent: ModifierDnnModule) {\r\n        super('QE.ModMng', parent.log);\r\n    }\r\n\r\n    /**\r\n     * Delete a module\r\n     */\r\n    delete(modId: number): Promise<any> {\r\n        const service = dnnSF(modId);\r\n        const tabId: number = service.getTabId();\r\n        return sendDnnAjax({\r\n            modId,\r\n            url: dnnSF().getServiceRoot('2sxc') + 'dnn/module/delete',\r\n            method: 'GET',\r\n            data: {\r\n                tabId: tabId,\r\n                modId: modId,\r\n            },\r\n            // ReSharper disable once UnusedParameter\r\n            success: () => window.location.reload(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new module\r\n     */\r\n    create(paneName: string, index: number, type: string): Promise<any> {\r\n        return sendDnnAjax({\r\n            modId: null,\r\n            url: dnnSF().getServiceRoot('internalservices') + 'controlbar/GetPortalDesktopModules',\r\n            method: 'GET',\r\n            data: 'category=All&loadingStartIndex=0&loadingPageSize=100&searchTerm=',\r\n            success: (desktopModules: ModuleInfo[]) => {\r\n                const moduleToFind: string = type === 'Default' ? ' Content' : ' App';\r\n                let module: ModuleInfo = null;\r\n\r\n                // ReSharper disable once UnusedParameter\r\n                desktopModules.forEach((e, i: number) => {\r\n                    if (e.ModuleName === moduleToFind)\r\n                        module = e;\r\n                });\r\n\r\n                return (!module)\r\n                    ? alert(moduleToFind + ' module not found.')\r\n                    : createMod(paneName, index, module.ModuleID);\r\n            },\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Move a DNN Module\r\n     */\r\n    move(modId: number, pane: string, order: number): void {\r\n        const service = dnnSF(modId);\r\n        const tabId = service.getTabId();\r\n        const dataVar = {\r\n            TabId: tabId,\r\n            ModuleId: modId,\r\n            Pane: pane,\r\n            ModuleOrder: (2 * order + 0),\r\n            // strange formula, copied from DNN https://github.com/dnnsoftware/Dnn.Platform/blob/fd225b8de07042837f7473cd49fba13de42a3cc0/Website/admin/Menus/ModuleActions/ModuleActions.js#L70\r\n            // stv: changed formula from: (2 * order + 4)\r\n            // ...to: (2 * order + 0)\r\n        };\r\n\r\n        sendDnnAjax({\r\n            modId,\r\n            url: dnnSF(modId).getServiceRoot('internalservices') + 'ModuleService/MoveModule',\r\n            method: 'POST',\r\n            data: dataVar,\r\n            success: () => window.location.reload(),\r\n        });\r\n    }\r\n\r\n    getPaneName(pane: HTMLElement): string {\r\n        return pane.getAttribute('id').replace('dnn_', '');\r\n    }\r\n\r\n    /**\r\n     * find the correct module id from a list of classes - used on the module-wrapper\r\n     */\r\n    getModuleId(classes: string): number | null {\r\n        const result = classes.match(/DnnModule-([0-9]+)(?:\\W|$)/);\r\n        return (result && result.length === 2) ? Number(result[1]) : null;\r\n    }\r\n\r\n    getMoveButtons(current: string): HTMLElement {\r\n        const pns = QuickE.singleton().cachedPanes;\r\n        // generate list of panes as links\r\n        const targets = NoJQ.domFromString('<div></div>')[0];\r\n        for (let p = 0; p < pns.length; p++) {\r\n            const pName: string = this.getPaneName(pns[p]);\r\n            const selected: string = (current === pName) ? ' selected ' : '';\r\n            if (selected === '') {\r\n                const target = NoJQ.domFromString(`<a data='${pName}'>${pName}</a>`)[0];\r\n                targets.append(target);\r\n            }\r\n        }\r\n\r\n        // attach click event...\r\n        const _this = this;\r\n        targets.querySelectorAll<HTMLElement>('a').forEach((e) => {\r\n            e.addEventListener('click', function () {\r\n                const link = this;\r\n                const clip = QuickEClipboard.singleton().clipboard;\r\n                const modId = _this.getModuleId(clip.item.className);\r\n                const newPane = link.getAttribute('data');\r\n                _this.move(modId, newPane, 0);\r\n            });\r\n        });\r\n\r\n        return targets;\r\n    }\r\n}\r\n\r\n// call an api on dnn\r\nfunction sendDnnAjax(req: DnnHttpRequest): Promise<any> {\r\n    // set DNN headers\r\n    const dnnHeaders: Record<string, string> = {};\r\n    const fakeXhr = {\r\n        setRequestHeader(name: string, value: string) {\r\n            dnnHeaders[name] = value;\r\n        },\r\n    } as JQueryXHR;\r\n    dnnSF(req.modId).setModuleHeaders(fakeXhr);\r\n\r\n    const settings: RequestInit = {\r\n        headers: {\r\n            'X-Requested-With': 'XMLHttpRequest',\r\n            ...dnnHeaders,\r\n        },\r\n        method: req.method,\r\n    };\r\n    let url = req.url;\r\n    if (req.data) {\r\n        switch (req.method) {\r\n            case 'GET':\r\n                url += typeof req.data === 'string' ? `?${req.data}` : `?${NoJQ.param(req.data)}`;\r\n                break;\r\n            case 'POST':\r\n                settings.body = new URLSearchParams(NoJQ.param(req.data));\r\n                (settings.headers as Record<string, string>)['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';\r\n                break;\r\n        }\r\n    }\r\n\r\n    const success = req.success;\r\n    return fetch(url, settings)\r\n        .then((response) => {\r\n            if (response.status >= 200 && response.status < 300) {\r\n                return response.text();\r\n            }\r\n            throw new Error(response.statusText);\r\n        })\r\n        .then((resText) => {\r\n            let resData: any;\r\n            try {\r\n                resData = JSON.parse(resText);\r\n            } catch {\r\n                resData = resText;\r\n            }\r\n            success?.(resData);\r\n            return resData;\r\n        })\r\n        .catch((err: Error) => {\r\n            alert(`Error while talking to server: ${err.message}`);\r\n            return undefined;\r\n        });\r\n}\r\n\r\n// create / insert a new module\r\nfunction createMod(paneName: string, position: number, modId: number): Promise<any> {\r\n    const postData = {\r\n        Module: modId,\r\n        Page: '',\r\n        Pane: paneName,\r\n        Position: -1,\r\n        Sort: position,\r\n        Visibility: 0,\r\n        AddExistingModule: false,\r\n        CopyModule: false,\r\n    };\r\n    return sendDnnAjax({\r\n        modId: null,\r\n        url: dnnSF().getServiceRoot('internalservices') + 'controlbar/AddModule',\r\n        method: 'POST',\r\n        data: postData,\r\n        success: () => window.location.reload(),\r\n    });\r\n}\r\n\r\ninterface ModuleInfo {\r\n    ModuleName: string;\r\n    ModuleID: number;\r\n}\r\n\r\ninterface DnnHttpRequest {\r\n    modId: number;\r\n    url: string;\r\n    method: 'GET' | 'POST';\r\n    data?: Record<string, any> | string;\r\n    success?: (data: any) => void;\r\n}\r\n","import { PositionCoordinates, QeSelectors, QuickE } from '.';\r\nimport { NoJQ } from '../plumbing';\r\nimport { ContextForLists } from './context-for-lists';\r\n\r\n/**\r\n * Module with everything related to positioning the quick-edit in-page editing\r\n * @internal\r\n */\r\nexport class Positioning {\r\n    static positionAndAlign = positionAndAlign;\r\n    static refresh = refresh;\r\n\r\n    /**\r\n     * Find the position of an element\r\n     */\r\n    static get(element: HTMLElement): PositionCoordinates {\r\n        const coords: PositionCoordinates = {\r\n            element: element,\r\n            x: NoJQ.offset(element).left,\r\n            w: NoJQ.width(element),\r\n            y: NoJQ.offset(element).top,\r\n            // For content-block ITEMS, the menu must be visible at the end\r\n            // For content-block-LISTS, the menu must be at top\r\n            yh: NoJQ.offset(element).top + (element.matches(QeSelectors.eitherCbOrMod) ? NoJQ.height(element) : 0),\r\n        };\r\n\r\n        return coords;\r\n    }\r\n\r\n    /**\r\n     * Prepare offset calculation based on body positioning\r\n     */\r\n    static getBodyPosition(): PositionCoordinates {\r\n        const posNoJq = document.body.style.position;\r\n        const bodyPos = posNoJq; // QuickE.body.css('position');\r\n        const quickE = QuickE.singleton();\r\n        return bodyPos === 'relative' || bodyPos === 'absolute'\r\n            ? new PositionCoordinates(NoJQ.offset(quickE.body).left, NoJQ.offset(quickE.body).top)\r\n            : new PositionCoordinates(0, 0);\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * Refresh content block and modules elements\r\n */\r\nfunction refreshDomObjects(): void {\r\n    // must update this, as sometimes after finishing page load the position changes, like when dnn adds the toolbar\r\n    const quickE = QuickE.singleton();\r\n    quickE.bodyOffset = Positioning.getBodyPosition();\r\n\r\n    if (quickE.config.innerBlocks.enable) {\r\n        // get all content-block lists which are empty, or which allow multiple child-items\r\n        const lists = QeSelectors.blocks.cb.findAllLists().filter((e) => e.matches(`:not(.${QeSelectors.blocks.cb.singleItem}), :empty`));\r\n        const children: HTMLElement[] = [];\r\n        lists.forEach((l) => {\r\n            children.push(...Array.from(l.querySelectorAll<HTMLElement>(QeSelectors.blocks.cb.selector)));\r\n        });\r\n        quickE.contentBlocks = [...lists, ...children];\r\n    }\r\n\r\n    if (quickE.config.modules.enable) {\r\n        const panes = quickE.cachedPanes;\r\n        const children: HTMLElement[] = [];\r\n        panes.forEach((p) => {\r\n            children.push(...Array.from(p.querySelectorAll<HTMLElement>(QeSelectors.blocks.mod.selector)));\r\n        });\r\n        quickE.modules = [...panes, ...children];\r\n    }\r\n}\r\n\r\n/**\r\n * Last time when contentblock and modules are refreshed.\r\n * Helps to skip unnecessary calls to refresh(e).\r\n */\r\nlet lastCall: Date;\r\n\r\n/**\r\n * position, align and show a menu linked to another item\r\n * @internal\r\n */\r\nfunction positionAndAlign(element: HTMLElement, coords: PositionCoordinates) {\r\n    const quickE = QuickE.singleton();\r\n    element.style.left = `${coords.x - quickE.bodyOffset.x}px`;\r\n    element.style.top = `${coords.yh - quickE.bodyOffset.y}px`;\r\n    element.style.width = `${NoJQ.width(coords.element)}px`;\r\n    element.style.display = 'inline-flex';\r\n    return element;\r\n}\r\n\r\n/**\r\n * Refresh positioning / visibility of the quick-insert bar\r\n * @internal\r\n */\r\nfunction refresh(e: MouseEvent) {\r\n    const highlightClass: string = 'sc-cb-highlight-for-insert';\r\n    const newDate = new Date();\r\n    if ((!lastCall) || (newDate.getTime() - lastCall.getTime() > 1000)) {\r\n        // console.log('refreshed contentblock and modules');\r\n        lastCall = newDate;\r\n        refreshDomObjects();\r\n    }\r\n\r\n    // find the closest content-blocks and modules\r\n    const currentCoords = new PositionCoordinates(e.clientX, e.clientY);\r\n    const quickE = QuickE.singleton();\r\n    if (quickE.config.innerBlocks.enable && quickE.contentBlocks)\r\n        quickE.nearestCb = findNearest(quickE.contentBlocks, currentCoords);\r\n    if (quickE.config.modules.enable && quickE.modules)\r\n        quickE.nearestMod = findNearest(quickE.modules, currentCoords);\r\n\r\n    // hide the buttons for content-block or module, if they are not affected\r\n    quickE.modActions.forEach((a) => {\r\n        a.classList.toggle('sc-invisible', quickE.nearestMod === null);\r\n    });\r\n    quickE.cbActions.forEach((a) => {\r\n        a.classList.toggle('sc-invisible', quickE.nearestCb === null);\r\n    });\r\n\r\n    const oldParent = quickE.main._parentNode;\r\n\r\n    if (quickE.nearestCb !== null || quickE.nearestMod !== null) {\r\n        const alignTo = quickE.nearestCb || quickE.nearestMod;\r\n\r\n        // find parent pane to highlight\r\n        const parentPane = QeSelectors.blocks.mod.findClosestList(alignTo.element);\r\n        const parentCbList = QeSelectors.blocks.cb.findClosestList(alignTo.element);\r\n        const parentContainer = parentCbList ?? parentPane;\r\n        provideCorrectAddButtons(parentContainer);\r\n        // put part of the pane-name into the button-labels\r\n        if (parentPane) {\r\n            let paneName: string = parentPane.getAttribute('id') || '';\r\n            if (paneName.length > 4) paneName = paneName.substr(4);\r\n            quickE.modActions.filter((a) => a.matches('[titleTemplate]')).forEach((a) => {\r\n                a.setAttribute('title', a.getAttribute('titleTemplate').replace('{0}', paneName));\r\n            });\r\n        }\r\n\r\n        positionAndAlign(quickE.main, alignTo);\r\n\r\n        // Keep current block as current on menu\r\n        quickE.main.activeContentBlock = quickE.nearestCb ? quickE.nearestCb.element : null;\r\n        quickE.main.activeModule = quickE.nearestMod ? quickE.nearestMod.element : null;\r\n        quickE.main._parentNode = parentContainer;\r\n        parentContainer.classList.add(highlightClass);\r\n    } else {\r\n        quickE.main._parentNode = null;\r\n        quickE.main.style.display = 'none';\r\n    }\r\n\r\n    // if previously a parent-pane was highlighted, un-highlight it now\r\n    if (oldParent && oldParent !== quickE.main._parentNode)\r\n        oldParent.classList.remove(highlightClass);\r\n}\r\n\r\nfunction provideCorrectAddButtons(tag: HTMLElement) {\r\n    const listSettings = ContextForLists.getFromDom(tag);\r\n    let showContent = true;\r\n    let showApps = true;\r\n    if (listSettings.appList.length > 0) {\r\n        showContent = listSettings.appList.indexOf('Content') > -1;\r\n        // only show apps if the list is longer than 'Content' if it contains that\r\n        showApps = listSettings.appList.length - (showContent ? 1 : 0) > 0;\r\n    }\r\n    QuickE.singleton().cbActions.forEach((a) => {\r\n        a.classList.toggle('hide-content', !showContent);\r\n        a.classList.toggle('hide-app', !showApps);\r\n    });\r\n}\r\n\r\n/**\r\n * Return the nearest element to the mouse cursor from elements\r\n */\r\nfunction findNearest(elements: HTMLElement[], position: PositionCoordinates): PositionCoordinates {\r\n    const maxDistance: number = 30; // Defines the maximal distance of the cursor when the menu is displayed\r\n\r\n    let nearestItem: PositionCoordinates = null;\r\n    let nearestDistance = maxDistance;\r\n\r\n    const posX: number = position.x + window.scrollX;\r\n    const posY: number = position.y + window.scrollY;\r\n\r\n    // Find nearest element\r\n    elements.forEach((element) => {\r\n        const e = Positioning.get(element);\r\n\r\n        // First check x coordinates - must be within container\r\n        if (posX < e.x || posX > e.x + e.w)\r\n            return;\r\n\r\n        // Check if y coordinates are within boundaries\r\n        const distance = Math.abs(posY - e.yh);\r\n\r\n        if (distance < maxDistance && distance < nearestDistance) {\r\n            nearestItem = e;\r\n            nearestDistance = distance;\r\n        }\r\n    });\r\n\r\n    return nearestItem;\r\n}\r\n","import { ModifierBase, ModifierDnnModule, QeSelectors, QuickE, Selection } from \".\";\r\nimport { C } from \"../constants\";\r\nimport { QuickEClipboardLogId } from \"../constants/debug\";\r\nimport { HasLog, Insights, NoJQ } from \"../core\";\r\nimport { ContextForLists } from \"./context-for-lists\";\r\nimport { ModifierContentBlock } from \"./modifier-content-block\";\r\n\r\n/**\r\n * add a clipboard to the quick edit\r\n * @internal\r\n */\r\nexport class QuickEClipboard extends HasLog {\r\n  /** Singleton */\r\n  public static singleton(): QuickEClipboard {\r\n    return this._singleton ?? (this._singleton = new QuickEClipboard());\r\n  }\r\n  private static _singleton: QuickEClipboard;\r\n\r\n  /**\r\n   * clipboard object - remembers what module (or content-block) was previously copied / needs to be pasted\r\n   */\r\n  clipboard = new Selection();\r\n\r\n  mods: { [key: string]: ModifierBase } = {};\r\n  modDnn: ModifierDnnModule;\r\n  modCb: ModifierContentBlock;\r\n\r\n  private constructor() {\r\n    super(QuickEClipboardLogId);\r\n    Insights.add(\"Q-E\", \"clipboard\", this.log);\r\n    this.mods.cb = this.modCb = new ModifierContentBlock();\r\n    this.mods.mod = this.modDnn = new ModifierDnnModule();\r\n\r\n    // initialize once the DOM is ready\r\n    NoJQ.ready(() => this.initializeSecondaryButtons());\r\n  }\r\n\r\n  /**\r\n   * bind clipboard actions to DOM buttons\r\n   */\r\n  initializeSecondaryButtons() {\r\n    const cl = this.log.call(\"initializeSecondaryButtons\");\r\n    const qem = this;\r\n    QuickE.singleton()\r\n      .selected.querySelectorAll<HTMLElement>(\"a\")\r\n      .forEach((e) => {\r\n        e.addEventListener(\"click\", function () {\r\n          const action = this.getAttribute(\"data-action\");\r\n          switch (action) {\r\n            case \"delete\":\r\n              return qem.mods[qem.clipboard.type].delete(qem.clipboard);\r\n            case \"sendToPane\":\r\n              return qem.modDnn.showSendToPane();\r\n            default:\r\n              throw new Error(`unexpected action: ${action}`);\r\n          }\r\n        });\r\n      });\r\n    cl.done();\r\n  }\r\n\r\n  /**\r\n   * perform copy and paste commands - needs the clipboard\r\n   * @param cbAction\r\n   * @param list\r\n   * @param domIndex\r\n   * @param type\r\n   */\r\n  do(\r\n    cbAction: string,\r\n    list: HTMLElement,\r\n    domIndex: number,\r\n    type: string\r\n  ): void {\r\n    const cl = this.log.call(\r\n      \"do\",\r\n      `${cbAction}, domIndex: ${domIndex}, typed: ${type}`\r\n    );\r\n    const newClip = this.createSpecs(type, list, domIndex);\r\n\r\n    // action!\r\n    switch (cbAction) {\r\n      case \"select\":\r\n        this.mark(newClip);\r\n        break;\r\n\r\n      case \"paste\":\r\n        const from = this.clipboard.index;\r\n        const to = newClip.index;\r\n        // check that we only move block-to-block or module to module\r\n        if (this.clipboard.type !== newClip.type)\r\n          return alert(\r\n            \"can't move module-to-block; move only works from module-to-module or block-to-block\"\r\n          );\r\n\r\n        if (isNaN(from) || isNaN(to)) return this.clearUi(); // skip, nothing real\r\n\r\n        const operator =\r\n          newClip.type === QeSelectors.blocks.cb.id ? this.modCb : this.modDnn;\r\n\r\n        if (!operator.isRealMove(this.clipboard, newClip))\r\n          return this.clearUi(); // skip, no change\r\n        operator.move(this.clipboard, newClip);\r\n\r\n        this.clearUi();\r\n        break;\r\n      default:\r\n    }\r\n    return cl.return(null);\r\n  }\r\n\r\n  private mark(newData: Selection): void {\r\n    const cl = this.log.call(\"mark\");\r\n    cl.data(\"specs\", newData);\r\n\r\n    if (newData) {\r\n      // if it was already selected with the same thing, then release it\r\n      if (this.clipboard && this.clipboard.item === newData.item)\r\n        return cl.return(this.clearUi());\r\n      this.clipboard = newData;\r\n    }\r\n\r\n    this.removeSelectionMarker(); // clear previous markings\r\n\r\n    // sometimes missing data.item\r\n    if (!this.clipboard.item) return cl.done();\r\n\r\n    const selectedItem = this.clipboard.item;\r\n    selectedItem.classList.add(QeSelectors.selected);\r\n    if (selectedItem.previousElementSibling?.matches(\"iframe\"))\r\n      selectedItem.previousElementSibling.classList.add(QeSelectors.selected);\r\n    this.setSecondaryActionsState(true);\r\n    const quickE = QuickE.singleton();\r\n    const btnConfig =\r\n      this.clipboard?.type === QeSelectors.blocks.cb.id\r\n        ? quickE.config.innerBlocks.buttons\r\n        : quickE.config.modules.buttons;\r\n    quickE.selected.toggleOverlay(selectedItem, btnConfig);\r\n    cl.done();\r\n  }\r\n\r\n  /** Clear the UI so nothing is selected any more */\r\n  private clearUi(): void {\r\n    const cl = this.log.call(\"clearUi\");\r\n    this.removeSelectionMarker();\r\n    this.clipboard = null;\r\n    this.setSecondaryActionsState(false);\r\n    QuickE.singleton().selected.toggleOverlay(false);\r\n    cl.done();\r\n  }\r\n\r\n  private removeSelectionMarker() {\r\n    document\r\n      .querySelectorAll<HTMLElement>(`.${QeSelectors.selected}`)\r\n      .forEach((s) => s.classList.remove(QeSelectors.selected));\r\n  }\r\n\r\n  private setSecondaryActionsState(state: boolean): void {\r\n    const cl = this.log.call(\"setSecondaryActionsState\");\r\n    let buttons = Array.from(\r\n      document.querySelectorAll<HTMLElement>(\"a.sc-content-block-menu-btn\")\r\n    );\r\n    buttons = buttons.filter((btn) => btn.classList.contains(\"icon-sxc-paste\"));\r\n    buttons.forEach((btn) => btn.classList.toggle(C.ClsNames.UnAvailable, !state));\r\n    cl.done();\r\n  }\r\n\r\n  private createSpecs(\r\n    type: string,\r\n    list: HTMLElement,\r\n    domIndex: number\r\n  ): Selection {\r\n    const cl = this.log.call(\"createSpecs\", `${type}, ..., ${domIndex}`);\r\n    const listItems = list.querySelectorAll<HTMLElement>(\r\n      QeSelectors.blocks[type].selector\r\n    );\r\n    // when paste module below the last module in pane\r\n    // index is 1 larger than the length, then select last\r\n    const currentItem: HTMLElement =\r\n      domIndex >= listItems.length\r\n        ? listItems[listItems.length - 1]\r\n        : listItems[domIndex];\r\n\r\n    // get info what item/block is being edited\r\n    const contextInfo = ContextForLists.getFromDom(list) || {\r\n      parent: \"dnn\",\r\n      field: list.id,\r\n      parentGuid: null as string,\r\n    };\r\n    return cl.return({\r\n      parent: contextInfo.parent,\r\n      parentGuid: contextInfo.parentGuid,\r\n      field: contextInfo.field,\r\n      list: list,\r\n      item: currentItem,\r\n      index: domIndex,\r\n      type: type,\r\n    } as Selection);\r\n  }\r\n}\r\n","/**\r\n * selectors used all over the in-page-editing, centralized to ensure consistency\r\n * @internal\r\n */\r\nconst contentBlockAndModuleSelectors: { [key: string]: CbOrMod } = {\r\n    cb: {\r\n        id: 'cb',\r\n        class: 'sc-content-block',\r\n        selector: '.sc-content-block',\r\n        findAllLists: () => Array.from(document.querySelectorAll<HTMLElement>('.sc-content-block-list')),\r\n        findClosestList: (element: HTMLElement) => element.closest<HTMLElement>('.sc-content-block-list'),\r\n        context: 'data-list-context',\r\n        singleItem: 'single-item',\r\n    },\r\n    mod: {\r\n        id: 'mod',\r\n        class: 'DnnModule',\r\n        selector: '.DnnModule',\r\n        // Found no better way to get all panes - the hidden variable does not exist when not in edit page mode\r\n        findAllLists: () => {\r\n            // TODO: 2024-12-04 2dm - seems we had a workaround for the `:has` selector, but probably don't need it anymore\r\n            //\r\n            // jquery :has selector (https://api.jquery.com/has-selector/) is not a compatible with css selector\r\n            // and doesn't work without jquery (https://developer.mozilla.org/en-US/docs/Web/CSS/:has)\r\n            // and has absolutely terrible performance (380-560 ms)\r\n            // $('.DNNEmptyPane, .dnnDropEmptyPanes, :has(>.DnnModule)')\r\n\r\n            // as fast as can be (3-5 ms)\r\n            const found: HTMLElement[] = [];\r\n            const all = document.querySelectorAll<HTMLElement>('*');\r\n            for (let i = 0; i < all.length; i++) {\r\n                const el = all[i];\r\n                if (el.matches('.DNNEmptyPane, .dnnDropEmptyPanes')) {\r\n                    found.push(el);\r\n                    continue;\r\n                }\r\n                const children = el.children;\r\n                for (let j = 0; j < children.length; j++) {\r\n                    const child = children[j];\r\n                    if (child.matches('.DnnModule')) {\r\n                        found.push(el);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return found;\r\n        },\r\n        findClosestList: (element: HTMLElement) => {\r\n            if (!element) return null;\r\n            if (element.matches('.DNNEmptyPane, .dnnDropEmptyPanes')) {\r\n                return element;\r\n            }\r\n            for (let i = 0; i < element.children.length; i++) {\r\n                const child = element.children[i];\r\n                if (child.matches('.DnnModule')) {\r\n                    return element;\r\n                }\r\n            }\r\n            return contentBlockAndModuleSelectors.mod.findClosestList(element.parentElement);\r\n        },\r\n        context: null,\r\n    },\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const QeSelectors = {\r\n    blocks: contentBlockAndModuleSelectors,\r\n    eitherCbOrMod: '.DnnModule, .sc-content-block',\r\n    selected: 'sc-cb-is-selected',\r\n};\r\n\r\n\r\n/**\r\n * Structure for constants in the selectors, to guarantee we got everything\r\n */\r\ninterface CbOrMod {\r\n    id: string;\r\n    class: string;\r\n    selector: string;\r\n    findAllLists: () => HTMLElement[];\r\n    findClosestList: (element: HTMLElement) => HTMLElement;\r\n    context: string;\r\n    singleItem?: string;\r\n}\r\n","import { time } from 'console';\r\nimport { ModifierContentBlock, ModifierDnnModule, PositionCoordinates, Positioning, QeSelectors, QuickEditOverlay } from '.';\r\nimport { HasLog, Insights, NoJQ } from '../core';\r\nimport { QuickEditConfigEnableAuto, QuickEditConfigRoot } from './quick-e-configuration';\r\nimport { iconPrefix } from '../commands';\r\n\r\nconst configAttr: string = 'quick-edit-config';\r\nconst iconPre = iconPrefix;\r\nconst classForAddContent = 'sc-content-block-menu-addcontent';\r\nconst classForAddApp = 'sc-content-block-menu-addapp';\r\n\r\n/**\r\n * the quick-edit object\r\n * the quick-insert object\r\n * @internal\r\n */\r\nexport class QuickE extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): QuickE {\r\n      // we are reusing existing QuickE object in case that inpage script is loaded again \r\n      return this._singleton ??= window.$quickE ?? new QuickE();\r\n    }\r\n    private static _singleton: QuickE;\r\n\r\n    body = document.body;\r\n    main = NoJQ.domFromString('<div class=\"sc-content-block-menu sc-content-block-quick-insert sc-i18n\"></div>')[0] as QuickEditOverlay.Main;\r\n    template =\r\n        `<a class='sc-content-block-menu-btn sc-cb-action ${iconPre}content ${classForAddContent} sc-invisible' data-type='Default' data-i18n='[titleTemplate]QuickInsertMenu.AddBlockContent'></a>`\r\n        + `<a class='sc-content-block-menu-btn sc-cb-action ${iconPre}app ${classForAddApp} sc-invisible' data-type='' data-i18n='[titleTemplate]QuickInsertMenu.AddBlockApp'></a>`\r\n        + `${QuickEditOverlay.btn('select', 'ok', 'Select', true)}${QuickEditOverlay.btn('paste', 'paste', 'Paste', true, true)}`;\r\n    selected = QuickEditOverlay.selectedOverlay;\r\n    // will be populated later in the module section\r\n    contentBlocks: HTMLElement[] = null;\r\n    cachedPanes: HTMLElement[] = null;\r\n    modules: HTMLElement[] = null;\r\n    nearestCb: PositionCoordinates = null;\r\n    nearestMod: PositionCoordinates = null;\r\n    // add stuff which depends on other values to create\r\n    cbActions = NoJQ.domFromString(this.template);\r\n    modActions = NoJQ.domFromString(this.template.replace(/QuickInsertMenu.AddBlock/g, 'QuickInsertMenu.AddModule')).map((a) => {\r\n        a.setAttribute('data-context', 'module');\r\n        a.classList.add('sc-content-block-menu-module');\r\n        return a;\r\n    });\r\n\r\n    //\r\n    config = QuickEditConfigRoot.getDefault();\r\n\r\n    bodyOffset: PositionCoordinates;\r\n\r\n    private constructor() {\r\n        super('Q-E.Main');\r\n        Insights.add('Q-E', 'manager', this.log);\r\n        this.modActions.forEach((a) => {\r\n            a.addEventListener('click', ModifierDnnModule.onModuleButtonClick);\r\n        });\r\n        this.cbActions.forEach((a) => {\r\n            a.addEventListener('click', ModifierContentBlock.onCbButtonClick);\r\n        });\r\n    }\r\n\r\n    start(): void {\r\n        const cl = this.log.call('start');\r\n        try {\r\n            this.loadPageConfig();\r\n            // check for body, because in some cases html from Oqtane page could be without body for a moment\r\n            if (!!this.body && this.config.enable) {\r\n                // initialize first body-offset\r\n                this.bodyOffset = Positioning.getBodyPosition();\r\n                this.enable();\r\n                this.initWatchMouse();\r\n            }\r\n        } catch (e) {\r\n            console.error(\"couldn't start quick-edit\", e);\r\n        }\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * reset the quick-edit\r\n     * for example after ajax-loading a content-block, which may cause changed configurations\r\n     */\r\n    reset(): void {\r\n        const cl = this.log.call('reset');\r\n        this.loadPageConfig();\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * This checks if the page has any alternate configuration\r\n     * Note that it's also used after ajax refreshes, which can change the config\r\n     * So if it does reconfigure itself, it will start with the default config again\r\n     */\r\n    loadPageConfig() {\r\n        const cl = this.log.call('loadPageConfig', null, null, { config: this.config });\r\n        this.logConfig();\r\n        const configs = document.querySelectorAll<HTMLElement>(`[${configAttr}]`);\r\n        let confJ: string;\r\n\r\n        if (configs?.length > 0) {\r\n            cl.add('found configs', configs);\r\n            // go through reverse list, as the last is the most important...\r\n            let finalConfig = {} as QuickEditConfigRoot;\r\n            for (let c = configs.length; c >= 0; c--) {\r\n                // 2021-09-17 spm either the loop is wrong and we should only get configs[0] or we should be gettings configs[c]\r\n                confJ = configs[0].getAttribute(configAttr);\r\n                try {\r\n                    const confO = JSON.parse(confJ) as Partial<QuickEditConfigRoot>;\r\n                    cl.data('additional config', confO);\r\n                    finalConfig = { ...finalConfig, ...confO };\r\n                    cl.data('merged config', finalConfig);\r\n                } catch (e) {\r\n                    cl.add('had trouble with json');\r\n                    console.warn('had trouble with json', e);\r\n                }\r\n            }\r\n            const defConfig = QuickEditConfigRoot.getDefault();\r\n            this.config = { ...defConfig, ...finalConfig, buttons: { ...defConfig.buttons, ...finalConfig.buttons } };\r\n        } else\r\n            cl.add('no configs found, will use exiting');\r\n\r\n        // expand/merge configs on the sub-nodes module/block\r\n        this.config.innerBlocks.buttons = { ...this.config?.buttons, ...this.config?.innerBlocks?.buttons };\r\n        this.config.modules.buttons = { ...this.config?.buttons, ...this.config?.modules?.buttons };\r\n\r\n        this.logConfig();\r\n\r\n        this.detectWhichMenusToActivate();\r\n\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * existing inner blocks found? Will affect if modules can be quick-inserted...\r\n     */\r\n    private detectWhichMenusToActivate() {\r\n        const conf = this.config;\r\n        const cl = this.log.call('detectWhichMenusToActivate');\r\n        const innerCBs = QeSelectors.blocks.cb.findAllLists();\r\n        const hasInnerCBs = (innerCBs.length > 0);\r\n        cl.add(`has Content Blocks: ${hasInnerCBs}`, innerCBs);\r\n        // if it has inner-content, then it's probably a details page, where quickly adding modules would be a problem, so for now, disable modules in this case\r\n        if (conf.modules.enable === null || conf.modules.enable === QuickEditConfigEnableAuto)\r\n            conf.modules.enable = !hasInnerCBs;\r\n        // for now, ContentBlocks are only enabled if they exist on the page\r\n        if (conf.innerBlocks.enable === null || conf.innerBlocks.enable === QuickEditConfigEnableAuto)\r\n            conf.innerBlocks.enable = hasInnerCBs;\r\n        cl.add(`module.enable: ${conf.modules.enable}`);\r\n        cl.add(`innerBlocks.enable: ${conf.innerBlocks.enable}`);\r\n        cl.done();\r\n    }\r\n\r\n    private enable(): void {\r\n        const cl = this.log.call('enable');\r\n        // build all toolbar html-elements\r\n        this.prepareToolbarInDom();\r\n\r\n        // Cache the panes (because panes can't change dynamically)\r\n        this.initPanes();\r\n        cl.done();\r\n    }\r\n\r\n    prepareToolbarInDom(): void {\r\n        const cl = this.log.call('prepareToolbarInDom');\r\n        this.body.append(this.main);\r\n        this.body.append(this.selected);\r\n        this.cbActions.forEach((a) => this.main.append(a));\r\n        this.modActions.forEach((a) => this.main.append(a));\r\n\r\n        // use config to enable/disable some buttons\r\n        QuickEditOverlay.setButtonActivationClasses(this.config.innerBlocks.buttons, this.cbActions);\r\n        QuickEditOverlay.setButtonActivationClasses(this.config.modules.buttons, this.modActions);\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * cache the panes which can contain modules\r\n     */\r\n    private initPanes(): void {\r\n        const cl = this.log.call('initPanes');\r\n        this.cachedPanes = QeSelectors.blocks.mod.findAllLists();\r\n        this.cachedPanes.forEach((pane) => {\r\n            pane.classList.add('sc-cb-pane-glow');\r\n        });\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * start watching for mouse-move\r\n     */\r\n    private initWatchMouse() {\r\n        const cl = this.log.call('initWatchMouse');\r\n        let refreshTimeout: number = null;\r\n        document.body.addEventListener('mousemove', (e) => {\r\n            if (refreshTimeout === null)\r\n                refreshTimeout = window.setTimeout(() => {\r\n                    requestAnimationFrame(() => {\r\n                        Positioning.refresh(e);\r\n                        refreshTimeout = null;\r\n                    });\r\n                },\r\n                    20);\r\n        });\r\n        cl.done();\r\n    }\r\n\r\n    private logConfig() {\r\n        this.log.add(`config enabled: ${this.config.enable}, mod: ${this.config.modules.enable}, cb: ${this.config.innerBlocks.enable}. ${JSON.stringify(this.config)})`);\r\n    }\r\n\r\n}\r\n","// must come first because we're still relying on build order\r\nexport * from './selection';\r\nexport * from './modifier-base';\r\n\r\nexport * from './quick-e-overlays';\r\nexport * from './quick-e-configuration';\r\n\r\nexport * from './modifier-content-block';\r\nexport * from './position-coordinates';\r\nexport * from './modifier-dnn-module';\r\nexport * from './modifier-dnn-module-internal';\r\nexport * from './positioning';\r\nexport * from './quick-e';\r\nexport * from './quick-e-clipboard';\r\nexport * from './selectors-instance';\r\n\r\nconst css = require('./quickE.scss');","import { C } from '../constants/index';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HtmlTools } from '../html/dom-tools';\r\nimport { HasLog, Insights } from '../core';\r\nimport { renderer } from './render';\r\n\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiRender = 'cms/block/render';\r\nconst webApiSave = 'cms/block/template';\r\n//#endregion\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ContentBlockEditor extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): ContentBlockEditor {\r\n        return this._singleton ?? (this._singleton = new ContentBlockEditor());\r\n    }\r\n    private static _singleton: ContentBlockEditor;\r\n\r\n\r\n    private constructor() {\r\n        super('Sys.CbEdit');\r\n        Insights.add('system', 'cb-editor-api', this.log);\r\n    }\r\n\r\n\r\n    /**\r\n     * prepare the instance so content can be added\r\n     * this ensure the content-group has been created, which is required to add content\r\n     * @param {ContextComplete} context\r\n     */\r\n    prepareToAddContent(context: ContextComplete, useModuleList: boolean): Promise<string | void> {\r\n        const cl = this.log.call('prepareToAddContent');\r\n        const isCreated: boolean = context.contentBlock.isCreated;\r\n        if (isCreated || !useModuleList)\r\n            return cl.return(Promise.resolve());\r\n\r\n        // persist the template\r\n        const promise = this.updateTemplate(context, context.contentBlock.templateId, true);\r\n        return cl.return(promise, 'ok');\r\n    }\r\n\r\n\r\n    /**\r\n     * Update the template and adjust UI accordingly.\r\n     * @param {ContextComplete} context\r\n     * @param {number} templateId\r\n     * @param {boolean} forceCreate\r\n     */\r\n    updateTemplateFromDia(context: ContextComplete, templateId: number): Promise<void> {\r\n        const cl = this.log.call('updateTemplateFromDia', `..., ${templateId}`);\r\n        const wasShowingPreview = HtmlTools.isDisabled(context.sxc);\r\n        cl.add(`wasShowingPreview: ${wasShowingPreview}`);\r\n        const promise = this.updateTemplate(context, templateId, false)\r\n            .then(() => {\r\n                // only reload on ajax, not on app as that was already re-loaded on the preview\r\n                // necessary to show the original template again\r\n                if (wasShowingPreview) renderer.reloadAndReInitialize(context, 'contentBlockEditor.updateTemplateFromDia');\r\n            });\r\n        return cl.return(promise);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Retrieve the preview from the web-api\r\n     * @param {ContextComplete} context\r\n     * @param {number} templateId\r\n     * @returns {promise} promise with the html in the result\r\n     */\r\n    getPreviewWithTemplate(context: ContextComplete, templateId: number): Promise<string> {\r\n        const cl = this.log.call('getPreviewWithTemplate', `..., ${templateId}`);\r\n        templateId = templateId || C.ContentBlock.UseExistingTemplate; // fallback, meaning use saved ID\r\n        const params: WebApiParams = {\r\n            templateId: templateId,\r\n            lang: context.app.currentLanguage,\r\n            cbid: context.contentBlockReference.id,\r\n            originalparameters: JSON.stringify(context.instance.parameters),\r\n            edition: context.contentBlock.edition,\r\n        };\r\n        cl.data('params', params);\r\n        const promise = context.sxc.webApi.fetchRaw(context.sxc.webApi.url(webApiRender, params))\r\n            .then((response) => response.text());\r\n        return cl.return(promise);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Update the template.\r\n     */\r\n    private updateTemplate(context: ContextComplete, templateId: number, forceCreate: boolean): Promise<string | void> {\r\n        const cl = this.log.call('updateTemplate');\r\n        const promise = this.saveTemplate(context, templateId, forceCreate)\r\n            .then((data) => {\r\n                if (!data) return null;\r\n\r\n                // fixes a special case where the guid is given with quotes (depends on version of angularjs) issue #532\r\n                const newGuid = data.replace(/[\\\",\\']/g, '');\r\n\r\n                if (console)\r\n                    console.log(`created content group {${newGuid}}`);\r\n\r\n                return context.contentBlock.contentGroupId = newGuid;\r\n            }).catch(() => {\r\n                // error handling\r\n                return alert('error - result not ok, was not able to create ContentGroup');\r\n            });\r\n        return cl.return(promise);\r\n    }\r\n\r\n\r\n    /**\r\n     * Save the template configuration for this instance\r\n     * @param {ContextComplete} context\r\n     * @param {number} templateId\r\n     * @param {boolean} [forceCreateContentGroup]\r\n     * @returns {promise}\r\n     */\r\n    private saveTemplate(context: ContextComplete, templateId: number, forceCreateContentGroup: boolean): Promise<string> {\r\n        const cl = this.log.call('saveTemplate');\r\n        const params: WebApiParams = {\r\n            templateId: templateId,\r\n            forceCreateContentGroup: forceCreateContentGroup,\r\n            newTemplateChooserState: false,\r\n        };\r\n        cl.data('params', params);\r\n        const promise = context.sxc.webApi.fetchJson(context.sxc.webApi.url(webApiSave, params), undefined, 'POST');\r\n        return cl.return(promise);\r\n    }\r\n\r\n}\r\n\r\n\r\ninterface WebApiParams {\r\n    templateId?: number;\r\n    lang?: string;\r\n    cbisentity?: boolean;\r\n    cbid?: number;\r\n    originalparameters?: string;\r\n    forceCreateContentGroup?: boolean;\r\n    newTemplateChooserState?: boolean;\r\n    zoneId?: number;\r\n    appId?: number;\r\n    edition?: string;\r\n}\r\n","import { WorkflowCommands } from '../commands';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HtmlTools } from '../html/dom-tools';\r\nimport { HasLog, Insights, NoJQ } from '../core';\r\nimport { QuickE } from '../quick-edit/quick-e';\r\nimport { WorkflowHelper, WorkflowPhases, WorkflowStepCodeArguments } from '../workflow';\r\nimport { ContentBlockEditor } from './content-block-editor';\r\nimport { DomTools } from '../../../$2sxc/src/dom/dom-tools';\r\nimport { AssetsLoader } from '../../../core/plumbing/assets-loader';\r\n/**\r\n * This is the rendering component, responsible to update the page when something changes.\r\n * Depending on the feature-set it will use ajax or not\r\n * @internal\r\n */\r\nclass RendererGlobal extends HasLog {\r\n\r\n  constructor() {\r\n    super('Rnd.Rndrer');\r\n    Insights.add('system', 'renderer', this.log);\r\n    this.log.add('constructor');\r\n  }\r\n\r\n  /**\r\n   * Show a message where the content of a module should be - usually as placeholder till something else happens\r\n   * @param {ContextComplete} context\r\n   * @param newContent\r\n   * @returns {} nothing\r\n   */\r\n  showMessage(context: ContextComplete, newContent: string): void {\r\n    DomTools.getTag(context.sxc).innerHTML = newContent;\r\n  }\r\n\r\n\r\n  /**\r\n   * this one assumes a replace / change has already happened, but now must be finalized...\r\n   * @param {ContextComplete} context\r\n   * @param {boolean} forceAjax\r\n   * @param {boolean} preview\r\n   */\r\n  reloadAndReInitialize(context: ContextComplete, triggeredBy: string, forceAjax?: boolean, preview?: boolean): Promise<void> {\r\n    const cl = this.log.call('reloadAndReInitialize', `..., triggeredBy: ${triggeredBy}, forceAjax: ${forceAjax}, preview: ${preview}`, null, { context: context });\r\n\r\n    // get workflow engine or a dummy engine\r\n    const wf = context.commandWorkflow ?? WorkflowHelper.getDummyManager();\r\n    const promiseChain = wf.run(new WorkflowStepCodeArguments(WorkflowCommands.refresh, WorkflowPhases.before, context));\r\n\r\n    // 2021-02-21 2dm New in 11.12 enable toolbar to not reload in a SPA scenario\r\n    const finalPromise = promiseChain.then((wfArgs) => {\r\n      if (WorkflowHelper.isCancelled(wfArgs)) {\r\n        cl.add('Workflow return false, will cancel and not refresh.');\r\n        return Promise.resolve();\r\n      }\r\n\r\n      // Oqtane handling (depends on module interactivity)\r\n      var fullPageReload = false;\r\n      const winForOqt = window as any;\r\n      if (winForOqt.ToSic?.Sxc?.Oqtane) {\r\n        winForOqt.ToSic.Sxc.Oqtane.reloadModule(context.sxc.id).then((reloaded: boolean) => {\r\n          fullPageReload = reloaded;\r\n          if (reloaded)\r\n            cl.add(`Oqtane Interactive, use full page reload`);\r\n          else\r\n            cl.add(`Oqtane Static, use ajaxLoad`);\r\n          return Promise.resolve();\r\n        }).catch((error: Error) => {\r\n          console.error('Error in Oqtane.reloadModule:', error);\r\n        });\r\n      }\r\n\r\n      // if ajax is not supported, we must reload the whole page\r\n      if (!forceAjax && !context.app.supportsAjax || fullPageReload) {\r\n        cl.done('not ajax - reloading page');\r\n        window.location.reload();\r\n        return Promise.resolve();\r\n      }\r\n\r\n      cl.add('is ajax, calling ajaxReload');\r\n      return this.ajaxLoad(context, C.ContentBlock.UseExistingTemplate, preview, 'render.reloadAndReInitialize')\r\n        .then((result) => {\r\n          // If Evoq, tell Evoq that page has changed if it has changed (Ajax call)\r\n          if (window.dnn_tabVersioningEnabled) { // this only exists in evoq or on new DNNs with tabVersioning\r\n            cl.add('system is using tabVersioning - will inform DNN');\r\n            try {\r\n              window.dnn.ContentEditorManager.triggerChangeOnPageContentEvent();\r\n            } catch (e) { /* ignore */ }\r\n          }\r\n          return cl.return(result);\r\n        })\r\n        .catch((error) => console.log('Error in reloadAndReInitialize', error));\r\n    });\r\n\r\n    return finalPromise;\r\n  }\r\n\r\n  /**\r\n   * ajax-call, then replace\r\n   * @param {ContextComplete} context\r\n   * @param {number} alternateTemplateId\r\n   * @param {boolean} justPreview\r\n   */\r\n  ajaxLoad(context: ContextComplete, alternateTemplateId: number, justPreview: boolean, triggeredBy: string): Promise<void> {\r\n    const cl = this.log.call('ajaxLoad', `triggeredBy: ${triggeredBy}`);\r\n    cl.add('starting promise chain');\r\n    return ContentBlockEditor.singleton().getPreviewWithTemplate(context, alternateTemplateId)\r\n      .then((result: string) => {\r\n        cl.add(\"get preview done, let's replace the content\");\r\n        this.replaceContentBlock(context, result, justPreview);\r\n      })\r\n      .then(() => {\r\n        cl.add('replace done, resetting quickE');\r\n        QuickE.singleton().reset(); // reset quick-edit, because the config could have changed\r\n        cl.done();\r\n      });\r\n  }\r\n\r\n\r\n  /**\r\n   * ajax update/replace the content of the content-block\r\n   * optionally also initialize the toolbar (if not just preview)\r\n   * @param {ContextComplete} context\r\n   * @param newContent\r\n   * @param {boolean} justPreview\r\n   */\r\n  private replaceContentBlock(context: ContextComplete, newContent: string, justPreview: boolean): void {\r\n    const cl = this.log.call('replaceContentBlock');\r\n    try {\r\n      try {\r\n        const newContentObj = JSON.parse(newContent) as ContentBlockReplacement;\r\n        const newHeadHtml = newContentObj.Resources\r\n          .map((resource) => {\r\n            if (resource.Type === 'js') {\r\n              return `<script type=\"text/javascript\" src=\"${resource.Url}\"></script>`;\r\n            }\r\n            if (resource.Type === 'css') {\r\n              return `<link rel=\"stylesheet\" href=\"${resource.Url}\">`;\r\n            }\r\n          })\r\n          .filter((resource) => resource != null)\r\n          .join('\\n');\r\n        const newHead = NoJQ.domFromString(newHeadHtml);\r\n        const newDom = NoJQ.domFromString(newContentObj.Html)[0];\r\n\r\n        NoJQ.append(document.head, newHead, false);\r\n        // Must disable toolbar before we attach to DOM\r\n        if (justPreview) HtmlTools.disable(newDom);\r\n        NoJQ.replaceWith(DomTools.getTag(context.sxc), newDom, false);\r\n\r\n        // run scripts manually to ensure proper timing\r\n        const scripts = [\r\n          ...newHead.filter((asset) => asset.tagName.toLocaleLowerCase() === 'script'),\r\n          ...Array.from(newDom.querySelectorAll('script')),\r\n        ] as HTMLScriptElement[];\r\n        AssetsLoader.runScripts(scripts, undefined);\r\n      } catch {\r\n        const newDom = NoJQ.domFromString(newContent)[0];\r\n\r\n        // Must disable toolbar before we attach to DOM\r\n        if (justPreview) HtmlTools.disable(newDom);\r\n        NoJQ.replaceWith(DomTools.getTag(context.sxc), newDom, true);\r\n      }\r\n\r\n      // reset the cache, so the sxc-object is refreshed\r\n      context.sxc.recreate(true);\r\n    } catch (e) {\r\n      console.log('Error while rendering template:', e);\r\n    }\r\n    cl.done();\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const renderer = new RendererGlobal();\r\n\r\ninterface ContentBlockReplacement {\r\n  Html: string;\r\n  Resources: ContentBlockResource[];\r\n}\r\n\r\ninterface ContentBlockResource {\r\n  Contents: null;\r\n  Id: null;\r\n  Type: 'js' | 'css';\r\n  Url: string;\r\n}\r\n","import { CmdParHlp } from '..';\r\nimport { renderer } from '../../contentBlock/render';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { ContentListActionParams } from './content-list-action-params';\r\n\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiAdd = 'cms/block/item';\r\nconst webApiRemoveFromList = 'cms/list/delete';\r\nconst webApiReorder = 'cms/list/move';\r\nconst webApiItemPublish = 'cms/edit/publish';\r\nconst webApiBlockPublish = 'cms/block/publish';\r\n//#endregion\r\n\r\n/**\r\n * These actions make changes to a content-block - like adding, removing or publishing items in the block\r\n * @internal\r\n */\r\nclass ContentListActions {\r\n  /**\r\n   * add an item to the list at this position\r\n   * @param {ContextComplete} context\r\n   * @param {number} index\r\n   */\r\n  addItem<T>(context: ContextComplete, index: number) {\r\n    return doAndReload<T>(context, webApiAdd, { index }, 'post');\r\n  }\r\n\r\n  /**\r\n   * remove an item from a list, then reload\r\n   */\r\n  removeFromList(context: ContextComplete) {\r\n    const params = context.button.command.params;\r\n    return doAndReload<void>(context, webApiRemoveFromList, {\r\n      index: CmdParHlp.getIndex(params),\r\n      parent: params.parent,\r\n      fields: params.fields,\r\n    }, 'delete');\r\n  }\r\n\r\n  /**\r\n   * change the order of an item in a list, then reload\r\n   */\r\n  changeOrder(context: ContextComplete, index: number, toIndex: number) {\r\n    const params = context.button.command.params;\r\n    return doAndReload<void>(context, webApiReorder, {\r\n      parent: params.parent,\r\n      fields: params.fields,\r\n      index,\r\n      toIndex,\r\n    }, 'post');\r\n  }\r\n\r\n  /**\r\n   * set a content-item in this block to published, then reload\r\n   */\r\n  publish(context: ContextComplete, part: string, index: number) {\r\n    return doAndReload<void>(context, webApiBlockPublish, {\r\n      part,\r\n      index,\r\n    }, 'post');\r\n  }\r\n\r\n  /**\r\n   * publish an item using it's ID\r\n   */\r\n  publishId(context: ContextComplete, entityId: number) {\r\n    return doAndReload<void>(context, webApiItemPublish,\r\n      { id: entityId },\r\n      'post');\r\n    }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const Actions = new ContentListActions();\r\n\r\n/*\r\n * this is a content block in the browser\r\n *\r\n * A Content Block is a stand alone unit of content, with it's own definition of\r\n * 1. content items\r\n * 2. template\r\n * + some other stuff\r\n *\r\n * it should be able to render itself\r\n */\r\n\r\n/**\r\n * internal helper, to do something and reload the content block\r\n */\r\nfunction doAndReload<T>(\r\n  context: ContextComplete,\r\n  url: string,\r\n  params: ContentListActionParams,\r\n  verb: 'get' | 'post' | 'delete' = 'get',\r\n): Promise<void | T> {\r\n  return (verb === 'post'\r\n    ? context.sxc.webApi.fetchRaw(context.sxc.webApi.url(url, params), null, 'POST')\r\n    : verb === 'delete'\r\n      ? context.sxc.webApi.fetchRaw(context.sxc.webApi.url(url, params), undefined, 'DELETE')\r\n      : context.sxc.webApi.fetchJson(context.sxc.webApi.url(url, params)))\r\n    .then(() => {\r\n      renderer.reloadAndReInitialize(context, 'doAndReload');\r\n    });\r\n}\r\n","import { CommandNames, Commands } from '..';\r\nimport { Actions } from './content-list-actions';\r\nimport { SharedLogic } from './shared-logic';\r\nimport { CmdParHlp } from '../cmd-par-hlp';\r\n\r\n/**\r\n * add brings no dialog, just add an empty item\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.add, 'AddDemo', 'plus-circled', false, true, {\r\n    showCondition: (ctx) => SharedLogic.isList(ctx),\r\n\r\n    code: (ctx) => Actions.addItem(ctx, CmdParHlp.getIndex(ctx) + 1),\r\n  },\r\n);\r\n\r\n","import { CmdParHlp, CommandNames, Commands } from '..';\r\nimport { ItemIdentifierInList } from '../../../../$2sxc/src/cms/item-identifiers';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.addExisting, 'AddExisting', 'add-existing', false, true, {\r\n  dialog: (_) => 'replace',\r\n\r\n  showCondition: (context) => SharedLogic.isList(context),\r\n\r\n  configureLinkGenerator: (context, linkGenerator) => {\r\n    if (SharedLogic.isFieldList(context)) {\r\n      const params = context.button.command.params;\r\n      linkGenerator.items = [{\r\n        Add: true,\r\n        Index: CmdParHlp.getIndex(params) + 1,\r\n        Parent: params.parent,\r\n        Field: params.fields,\r\n      }];\r\n      return;\r\n    }\r\n    \r\n    if (SharedLogic.isPartOfBlockList(context)) {\r\n      const topItem = linkGenerator.items[0] as ItemIdentifierInList;\r\n      topItem.Add = true;\r\n      topItem.Index++;\r\n      linkGenerator.items = [topItem];\r\n    }\r\n  },\r\n});\r\n","import { CommandNames, Commands } from '..';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.app, 'App', 'settings', true, false, {\r\n  showCondition: (context) => context.user.CanAdmin,\r\n\r\n  noItems: true,\r\n});\r\n","import { CommandNames, Commands } from '..';\r\n\r\n/**\r\n * open the import dialog\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.appImport, 'Dashboard', '', true, false, {\r\n  noItems: true,\r\n});\r\n","import { CommandNames, Commands, tlbI18nPrefix } from '..';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.appResources, 'AppResources', 'translate', true, false, {\r\n  dialog: (_) => CommandNames.edit,\r\n\r\n  disabled: (context) => context.app.resourcesId === null,\r\n\r\n  title: (context) => `${tlbI18nPrefix}AppResources${context.app.resourcesId === null ? 'Disabled' : ''}`,\r\n\r\n  // only if resources exist or are 0 (to be created)...\r\n  showCondition: (context) => !!context.user.CanAdmin,\r\n\r\n  configureLinkGenerator: (context, linkGenerator) => {\r\n    linkGenerator.items = [{ EntityId: context.app.resourcesId }];\r\n  },\r\n\r\n  // if it doesn't have a query, make the button faded\r\n  dynamicClasses: (context) => context.app.resourcesId !== null ? '' : 'empty',\r\n\r\n  // The items will transport the resourcesId\r\n  noItems: false,\r\n});\r\n","import { CommandNames, Commands } from '..';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.appSettings, 'AppSettings', 'sliders', true, false, {\r\n\r\n  dialog: () => CommandNames.edit,\r\n\r\n  disabled: (context) => context.app.settingsId === null,\r\n\r\n  title: (context) =>\r\n  `Toolbar.AppSettings${\r\n    context.app.settingsId === null ? 'Disabled' : ''\r\n  }`,\r\n\r\n  // only if settings exist, or are 0 (to be created)\r\n  showCondition: (context) => context.user.CanAdmin,\r\n\r\n  configureLinkGenerator: (context, linkGenerator) => {\r\n    linkGenerator.items = [{ EntityId: context.app.settingsId }];\r\n  },\r\n\r\n  // if it doesn't have a settings, make it less strong\r\n  dynamicClasses: (context) => context.app.settingsId !== null ? '' : 'empty',\r\n\r\n  // The items will transport the settingsId\r\n  noItems: false,\r\n});\r\n","import { CommandNames, Commands } from '..';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.apps, 'Zone', 'manage', true, false, {\r\n  showCondition: (context) => !!context.user.CanAdmin,\r\n\r\n  noItems: true,\r\n});\r\n","import { Command, CommandContentTypeParams, CommandNames, Commands } from '..';\r\nimport { ContextComplete } from '../../context';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.fields, 'ContentType', 'fields', true, false, {\r\n  dialog: (_) => CommandNames.fields_old_contenttype,\r\n\r\n  parameters: createContentTypeParams,\r\n\r\n  // only show to admin-users and in cases where we know the content-type\r\n  showCondition: (ctx) => !!ctx.user.CanDevelop && !!createContentTypeParams(ctx).contentType,\r\n\r\n  noItems: true,\r\n});\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.fields_old_contenttype));\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function createContentTypeParams(ctx: ContextComplete): { contentType: string } {\r\n  return {\r\n    contentType: ctx.button.command.params.contentType\r\n    || ctx.contentBlock.contentTypeId,\r\n  } satisfies CommandContentTypeParams;\r\n}\r\n","import { Command, CommandNames, Commands } from '..';\r\nimport { createContentTypeParams } from './command-content-type';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.data, 'ContentItems', 'table', true, false, {\r\n  dialog: (_) => CommandNames.data_old_contentItems,\r\n\r\n  parameters: createContentTypeParams,\r\n\r\n  // only show to admin-users and in cases where we know the content-type\r\n  showCondition: (context) => !!context.user.CanAdmin && !!createContentTypeParams(context).contentType,\r\n\r\n  tweakGeneratedUrlParameters: (context, itemUrlParameters) => {\r\n    const filters = context.button.command.params.filters;\r\n    if (!filters) return itemUrlParameters;\r\n\r\n    let enc = JSON.stringify(filters);\r\n\r\n    // special case - if it contains a \"+\" character, this won't survive\r\n    // encoding through the hash as it's always replaced with a space, even if it would be pre converted to %2b\r\n    // so we're base64 encoding it - see https://github.com/2sic/2sxc/issues/1061\r\n    if (enc.indexOf('+') > -1)\r\n      enc = btoa(enc);\r\n    return {\r\n      ...itemUrlParameters,\r\n      filters: enc,\r\n    }\r\n  },\r\n\r\n\r\n  noItems: true,\r\n});\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.data_old_contentItems));\r\n","import { CommandNames, Commands } from '..';\r\nimport { createContentTypeParams } from './command-content-type';\r\n\r\n/**\r\n * open an edit-item dialog\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.copy, 'Copy', 'copy', false, true, {\r\n  dialog: (_) => CommandNames.edit,\r\n\r\n  // needs to have an existing entityId to work\r\n  showCondition: (ctx) => !!ctx.button.command.params.entityId,\r\n\r\n  configureLinkGenerator: (ctx, linkGenerator) => {\r\n    const originalId = ctx.button.command.params.entityId;\r\n    const typeName = createContentTypeParams(ctx).contentType;\r\n    if (!typeName) throw new Error(\"can't copy: missing contentType\");\r\n    linkGenerator.items = [{ DuplicateEntity: originalId, ContentTypeName: typeName }];\r\n  },\r\n});\r\n","import { Command, CommandNames, Commands } from '..';\r\n\r\n/**\r\n * @internal\r\n */\r\nconst paramsName = 'params';\r\nconst ctxName = 'context';\r\nconst evtName = 'event';\r\n\r\nconst errPrefix = \"Running 'code' command, \";\r\nconst errNoCode = `${errPrefix}but no 'call' found to run - see console for debug info.`;\r\nconst errCodeNotString = `${errPrefix}but 'call' doesn't seem to be a string.`;\r\n/**\r\n * import this module to commands.ts\r\n * This is only available in v14+, before it was called 'custom' and that still exists\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.code, 'Custom', 'bomb', true, false, {\r\n  code(context, event) {\r\n    return new Promise((resolve, reject) => {\r\n      const params = context.button.command.params;\r\n\r\n      function errAndResolve(message: string) {\r\n        console.warn(message, params);\r\n        alert(message + '\\n See console for details.');\r\n        resolve();\r\n      }\r\n\r\n      let code = params.call;\r\n      if (!code)\r\n        return errAndResolve(errNoCode);\r\n      if (typeof code !== 'string')\r\n        return errAndResolve(errCodeNotString);\r\n      if (code.indexOf('(') !== -1 || code.indexOf(' ') !== -1)\r\n        return errAndResolve(`${errPrefix}but 'call' contained '(' or ' ' characters - not allowed.`);\r\n\r\n      // Make it a signature for the (not good) Function structure\r\n      code += `(${paramsName}, ${ctxName}, ${evtName})`;\r\n\r\n      // new signature v14.04 when using 'code' has params first, old had context first\r\n\r\n      // 1. clean params from all functions which were added by code in the entire pipeline\r\n      const clean = {} as Record<string, unknown>;\r\n      Object.entries(params).forEach(([k, v]) => { if (typeof v !== 'function') clean[k] = v; });\r\n      const { action, call, ...cleanest } = clean;  // remove 'action' and 'call'\r\n\r\n      try {\r\n        // Todo: rework to not use 'Function' - use turnOn concept\r\n        const fnNew = new Function(paramsName, ctxName, evtName, code);\r\n        resolve(fnNew(cleanest, context, event));\r\n      } catch (err) {\r\n        console.error('error in custom button-code: ', params);\r\n        reject(err);\r\n      }\r\n    });\r\n  },\r\n});\r\n\r\nCommands.addCommand(cmd);\r\n\r\n","import { CommandNames, Commands } from '..';\r\n\r\n/**\r\n * @internal\r\n */\r\nconst ctxName = 'context';\r\nconst evtName = 'event';\r\n\r\nconst errNoCode = \"Trying to run Custom-Code action, but no 'call' (v10+, recommended) or 'customCode' (v9, old) found to run - see console for debug info.\";\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n * @deprecated - obsolete in v14.04 but of course still supported\r\n */\r\nCommands.add(CommandNames.code_old_custom, 'Custom', 'bomb', true, false, {\r\n  code(context, event) {\r\n    return new Promise((resolve, reject) => {\r\n      const actPar = context.button.command.params;\r\n      // the old V9 name\r\n      let code = actPar.customCode;\r\n      // also try the V10 edition - uses `call`\r\n      if (!code) {\r\n        code = actPar.call;\r\n        if (typeof code === 'string' && code.indexOf(' ') === -1 && code.indexOf('(') === -1)\r\n          code += `(${ctxName}, ${evtName})`;\r\n      }\r\n      if (!code) {\r\n        console.warn(errNoCode, actPar);\r\n        alert(errNoCode);\r\n        resolve();\r\n      }\r\n      try {\r\n        const fn = new Function(ctxName, evtName, code);\r\n        resolve(fn(context, event));\r\n      } catch (err) {\r\n        console.error('error in custom button-code: ', actPar);\r\n        reject(err);\r\n      }\r\n    });\r\n  },\r\n});\r\n","import { CommandNames, Commands } from '..';\r\nimport { ContextComplete } from '../../context';\r\nimport { Note } from '../../toolbar/config/Note';\r\n\r\nconst ConfigEditionContentType = 'b535b6aa-d0a1-40c1-b996-b7e8461efc0c'; // this is the content type for the edition configuration\r\n\r\n/**\r\n * This is a dummy command to just set an edition.\r\n * It's not meant to show in the toolbar, but it should be callable on $2sxc(...).cms.run({ action: 'edition' })\r\n * \r\n * can have these parameters on the params object\r\n * - ask - force the UI to prompt for the edition\r\n * - edition - the edition to set, or prefill in the prompt\r\n * - editions - optional list of editions to suggest\r\n * - reset: boolean - reset the edition\r\n * \r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.edition, 'Edition', 'edition', true, false, {\r\n\r\n  code(context, _) {\r\n    const edition = context.contentBlock.edition;\r\n\r\n    return $2sxc(context.sxc.id, context.sxc.id).cms.run({\r\n      action: CommandNames.new,\r\n      params: {\r\n        contentType: ConfigEditionContentType,\r\n        edition,\r\n        settings: {\r\n          save: 'false'\r\n        },\r\n      },\r\n    });\r\n  },\r\n\r\n  notes(context) {\r\n    // Debug.log(`2dm ctx`, context);\r\n    const edition = context.contentBlock.edition;\r\n    const editionButton = editionInNote(context, true);\r\n\r\n    const stats = `\r\n    View: <strong>${context.contentBlock.viewName}</strong> - ${(edition ? 'edition: ' + editionButton : '')}<br>\r\n    `;\r\n    const note = `<strong>View / Edition</strong> <br>\r\n    ${stats}`;\r\n\r\n    const noteObj = new Note({\r\n      type: 'info',\r\n      note,\r\n      asHtml: true,\r\n      delay: 0,\r\n      interactive: true,\r\n      isSystem: true,\r\n    });\r\n    return [noteObj];\r\n  },\r\n\r\n  noItems: true,\r\n});\r\n\r\n/**\r\n * Edition info for inside a note.\r\n * Will contain either just the info / name, or a button to change it.\r\n * @param context \r\n * @param showToAll show no matter what the permissions (otherwise super-user only)\r\n * @returns \r\n */\r\nexport function editionInNote(context: ContextComplete, showToAll: boolean): string {\r\n  const edition = context.contentBlock.edition;\r\n\r\n  // figure out if we provide a button to change editions\r\n  const enableEditionSwitch = showToAll || context.user.CanDevelop || context.user.canSwitchEdition;\r\n\r\n  const editionButton = enableEditionSwitch\r\n    ? `<button onclick=\"$2sxc(${context.sxc.id, context.sxc.id}).cms.run({ action:'edition'})\">${edition}</button>`\r\n    : edition;\r\n\r\n  return editionButton;\r\n}\r\n","import { CommandNames, Commands } from '..';\r\nimport { contentItems } from '../../entity-manipulation/item-commands';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.delete, 'Delete', 'cancel', true, false, {\r\n  // disabled: true,\r\n  showCondition(context) {\r\n    const p = context.button.command.params;\r\n    // can never be used for a modulelist item, as it is always in use somewhere\r\n    if (p.useModuleList) return false;\r\n\r\n    // check if all data exists required for deleting\r\n    // before 10.27, it was entityId, entityGuid and entityTitle\r\n    // since 10.27, there will always be a guid (if it has an ID)\r\n    // and enabling it requires an action-modifier \"+delete\",\r\n    // so the automatic detection only applies\r\n    // to the pre-10.27 custom toolbars case\r\n    return (!!p.entityId && !!p.entityGuid && !!p.entityTitle);\r\n  },\r\n\r\n\r\n  code(context) {\r\n    const p = context.button.command.params;\r\n    const title = p.title || p.entityTitle; // prefer new title, and fallback to old for pre 10.27 configs\r\n    return contentItems.delete(context, p.entityId, p.entityGuid, title);\r\n  },\r\n});\r\n","import { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { translate } from '../i18n';\r\n\r\n/**\r\n * this enhances the $2sxc client controller with stuff only needed when logged in\r\n * @internal\r\n */\r\n\r\n// #region contentItem Commands\r\nexport let contentItems = {\r\n  // delete command - try to really delete a content-item\r\n  delete: (context: ContextComplete, itemId: number, itemGuid: string, itemTitle: string): Promise<void> => {\r\n    // first show main warning / get ok\r\n    const ok = confirm(translate('Delete.Confirm')\r\n      .replace('{id}', String(itemId))\r\n      .replace('{title}', itemTitle));\r\n\r\n    if (!ok) return Promise.resolve();\r\n\r\n    /**\r\n     * ZoneId and AppId are sent because of rare, special case that is not default\r\n     * (default is that 2sxc is finding ZoneId and AppId on server side from ModuleId)\r\n     * when we need to delete entity from other app or zone, than current one.\r\n     * TODO: send this params, only when is necessary (value change detection for ZoneId, AppId)\r\n     */\r\n    const params = {\r\n      zoneId: context.app.zoneId,\r\n      appId: context.app.id,\r\n    };\r\n\r\n    return context.sxc.webApi.fetchRaw(context.sxc.webApi.url(`app/auto/content/any/${itemGuid}`, params), undefined, 'DELETE')\r\n      .then((response) => {\r\n        if (response.status >= 200 && response.status < 300) {\r\n          location.reload();\r\n        } else if (response.status >= 400 && response.status < 500) {\r\n          // check if it's a permission config problem\r\n          const msgJs = translate('Delete.ErrCheckConsole');\r\n          if (response.status === 401) alert(translate('Delete.ErrPermission') + msgJs);\r\n          if (response.status === 400) alert(translate('Delete.ErrInUse') + msgJs);\r\n        }\r\n      }).catch((error) => {\r\n        console.log(error);\r\n      });\r\n  },\r\n};\r\n\r\n","import { CommandNames, Commands } from '..';\r\n\r\n/**\r\n * open an edit-item dialog\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.edit, 'Edit', 'pencil', false, true, {\r\n  parameters: _ => ({ mode: CommandNames.edit }),\r\n  showCondition(ctx) {\r\n    const pars = ctx.button.command.params;\r\n    // need ID or a \"slot\", otherwise edit won't work\r\n    const result = !!pars.entityId || !!pars.useModuleList;\r\n    return result;\r\n  },\r\n});\r\n","import { CmsEngine, CommandNames, Commands } from '..';\r\nimport { ContextComplete } from '../../context';\r\nimport { iconPrefix, tlbI18nPrefix } from '../command';\r\nimport { Note, TypeNoteMode } from '../../toolbar/config/Note';\r\nimport { Debug } from '../../constants/debug';\r\n\r\nconst debug = Debug.parts.commandInfo;\r\n\r\nconst i18nKeys: Record<TypeNoteMode, string> = {\r\n  info: 'Info',\r\n  warning: 'Warning',\r\n  error: 'Error',\r\n  help: 'Help',\r\n  link: 'Link',\r\n}\r\n\r\nconst icons: Record<TypeNoteMode, string> = {\r\n  info: 'info',\r\n  warning: 'warning',\r\n  error: 'warning',\r\n  help: 'Help',\r\n  link: 'Link',\r\n}\r\nconst colors = {\r\n  info: 'gray',\r\n  warning: 'orange',\r\n  error: 'red',\r\n}\r\n\r\nfunction getNote(ctx: ContextComplete): Note {\r\n  if (debug) console.log('2dm - note: ctx-ui', ctx?.ui);\r\n  const note = ContextComplete.getRule(ctx)?.ui?.note ?? { };\r\n  // Set type explicitly (spread operator wouldn't always work, because type could be null)\r\n  note.type = note.type ?? 'info';\r\n  if (debug) console.log('2dm - note', note);\r\n  return note;\r\n}\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.info, 'Info', 'info', true, false, {\r\n\r\n  icon: (ctx) => iconPrefix + (icons[getNote(ctx).type] ?? 'info'),\r\n\r\n  title: (ctx) => tlbI18nPrefix + (i18nKeys[getNote(ctx).type as TypeNoteMode] ?? 'Info'),\r\n\r\n  color: (ctx) => colors[getNote(ctx)?.type as keyof typeof colors ?? 'info'],\r\n\r\n  // TODO: improve call so params are always directly available\r\n  code(context, event) {\r\n    if (debug) console.log('2dm - info-button code', context);\r\n    const params = context.button.command.params;\r\n    const link = params?.link as string;\r\n    const target = params?.target as string; \r\n    if (debug) console.log('2dm - info-button code - link', link);\r\n\r\n    if (!link) {\r\n      console.log('info-button clicked, but nothing will happen, because no link was specified in the params. This may be expected/ok.');\r\n      return Promise.resolve();\r\n    }\r\n\r\n    // try to use normal click behavior, otherwise use window.open\r\n    if (!CmsEngine.applyLinkToButton(event, link, target))\r\n      window.open(link as string, target ?? '_blank');\r\n    return Promise.resolve();\r\n  },\r\n\r\n  noItems: true,\r\n});\r\n","import { Command, CommandNames, Commands, SharedLogic } from '..';\r\nimport { CmdParHlp } from '../cmd-par-hlp';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.list, 'Sort', 'list-numbered', false, true, {\r\n  dialog: (_) => CommandNames.list_old_instanceList,\r\n\r\n  showCondition: (context) => SharedLogic.isList(context),\r\n\r\n  configureLinkGenerator: (context, linkGenerator) => {\r\n    if (!SharedLogic.isFieldList(context)) return;\r\n\r\n    const params = context.button.command.params;\r\n    linkGenerator.items = [{\r\n      Add: false,\r\n      Index: CmdParHlp.getIndex(params),\r\n      Parent: params.parent,\r\n      Field: params.fields,\r\n    }];\r\n  },\r\n\r\n  // the items contain info about the list to show\r\n  noItems: false,\r\n});\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.list_old_instanceList));\r\n","import { CmsEngine, CommandNames, Commands, tlbI18nPrefix } from '..';\r\nimport { QeSelectors } from '../../quick-edit';\r\nimport { ContextForLists } from '../../quick-edit/context-for-lists';\r\nimport { Note } from '../../toolbar/config/Note';\r\nimport { DomTools } from '../../../../$2sxc/src/dom/dom-tools';\r\nimport { editionInNote } from './command-edition';\r\n\r\nconst translateKey = 'ChangeLayout';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.layout, translateKey, 'glasses', true, true, {\r\n\r\n  inlineWindow: (_) => true,\r\n\r\n  code(ctx, event) {\r\n    // console.log('layout');\r\n    // Try to find the closest tag based on the click\r\n    // if this fails, try to find it based on the sxc-instance\r\n    const attrSel = '[' + QeSelectors.blocks.cb.context + ']';\r\n    // note: sometimes when the page loads, this can be auto-triggered and not have an event\r\n    const listSpecs = DomTools.getTag(ctx.sxc).closest<HTMLElement>(attrSel);\r\n\r\n    // Now check if we have apps-parameters to pass on\r\n    if (listSpecs) {\r\n      const specs = ContextForLists.getFromDom(listSpecs);\r\n      ctx.button.command.params.apps = specs.apps;\r\n    }\r\n    return CmsEngine.openDialog(ctx, event, 'commandLayout.add');\r\n  },\r\n\r\n  /** make button disabled on details-views */\r\n  disabled(ctx) {\r\n    return !!ctx.contentBlock.viewSwitchDisabled;\r\n  },\r\n\r\n  title(ctx) {\r\n    const i18nKey = tlbI18nPrefix + translateKey + (!ctx.contentBlock.viewSwitchDisabled ? '' : 'Disabled');\r\n    // console.log('layout title', i18nKey);\r\n    return i18nKey;\r\n  },\r\n\r\n  \r\n  notes(ctx) {\r\n    // Debug.log(`2dm ctx`, context);\r\n\r\n    const app = ctx.app;\r\n    const cb = ctx.contentBlock;\r\n    const edition = cb.edition;\r\n\r\n    const lightspeed = `<a href=\"https://go.2sxc.org/lightspeed\" target=\"_blank\"> LightSpeed Cache</a>`\r\n    const renderTime = cb.renderLightspeed\r\n      ? `<strike>${cb.renderMs}ms</strike> 0ms using ${lightspeed}`\r\n      : `${cb.renderMs}ms (no ${lightspeed})`;\r\n\r\n    const queryInfo = cb.queryName ? `Query: ${cb.queryName} <br>${cb.queryInfo}<br>` : '';\r\n\r\n    const editionButton = editionInNote(ctx, false);\r\n\r\n    const stats = `\r\n    App: <strong>${app.appName}</strong> <br>\r\n    View: <strong>${cb.viewName}</strong> - ${(edition ? 'edition: ' + editionButton : '')}<br>\r\n    ${queryInfo}\r\n    Page: ${ctx.page.id}, Module: ${ctx.instance.id} <br>\r\n     ${renderTime} <br>\r\n    `;\r\n    const note = `<strong>Layout</strong> <br>\r\n    ${stats}`;\r\n\r\n    const noteObj = new Note({\r\n      type: 'info',\r\n      note,\r\n      asHtml: true,\r\n      delay: 500,\r\n      interactive: true,\r\n      isSystem: true,\r\n    });\r\n    return [noteObj];\r\n  },\r\n\r\n  noItems: true,\r\n});\r\n","import { CommandNames, Commands } from '..';\r\n\r\n/**\r\n * This is a dummy command to just log a message.\r\n * It's not meant to show in the toolbar, but it should be callable on $2sxc(...).cms.run({ action: 'log', params: { message: 'hello' } })\r\n * \r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.log, 'Log', 'bomb', true, false, {\r\n\r\n  code(context, _event) {\r\n    console.log('command: log (message/context)', context.button.command.params.message, context);\r\n    return new Promise((_resolve, _reject) => {});\r\n  },\r\n\r\n  noItems: true,\r\n});\r\n\r\n// Test code\r\n// Debug.log(\"CommandLog loaded \");\r\n\r\n// window.setTimeout(() => {\r\n//   Debug.log(\"CommandLog timeout \");\r\n//   window.$2sxc(12062).cms.run({ action: 'log' as any, params: { message: 'hello' } });\r\n// }, 100);","import { Command, CommandNames, Commands } from '..';\r\nimport { ItemIdentifierSimple } from '../../../../$2sxc/src/cms/item-identifiers';\r\n\r\nconst MetadataDefaultKeyType = 'string';\r\nconst MetadataDefaultTargetType = 10; // cms-item\r\n/**\r\n * create a metadata toolbar\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nexport const MetadataCommand = Command.build(CommandNames.metadata, 'Metadata', 'tag', false, false, {\r\n\r\n  parameters: (_) => ({ mode: CommandNames.newMode }),\r\n\r\n  dialog: (_) => CommandNames.edit, // don't use \"new\" (default) but use \"edit\"\r\n\r\n  // if it doesn't have data yet, make it less strong\r\n  dynamicClasses: (ctx) => ctx.button.command.params.entityId ? '' : 'empty',\r\n\r\n  // only add a metadata-button if it has metadata-infos\r\n  showCondition: (ctx) => !!ctx.button.command.params.metadata,\r\n\r\n  configureLinkGenerator(_, linkGenerator) {\r\n    const itm: Partial<ItemIdentifierSimple> = {\r\n      Metadata: {\r\n        ...{ keyType: MetadataDefaultKeyType, targetType: MetadataDefaultTargetType },\r\n        ...linkGenerator.context.button.command.params.metadata },\r\n    };\r\n    linkGenerator.items[0] = {...linkGenerator.items[0], ...itm };\r\n  },\r\n\r\n  // The items will transport the metadata\r\n  noItems: false,\r\n});\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const ImageMetadataCommand = Command.build(CommandNames.image, 'Image', 'focus', false, false, {\r\n  parameters: MetadataCommand.buttonDefaults.parameters,\r\n  dialog: MetadataCommand.buttonDefaults.dialog,\r\n  classes: 'single-field',\r\n  dynamicClasses: MetadataCommand.buttonDefaults.dynamicClasses,\r\n  showCondition: MetadataCommand.buttonDefaults.showCondition,\r\n  configureLinkGenerator: MetadataCommand.buttonDefaults.configureLinkGenerator,\r\n});\r\n\r\nCommands.addCommand(MetadataCommand);\r\nCommands.addCommand(ImageMetadataCommand);\r\n\r\n","import { CommandNames, Commands } from '..';\r\nimport { C } from '../../constants';\r\nimport { IDs } from '../../constants/ids';\r\n\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.more, 'MoreActions', 'options btn-mode', true, false, {\r\n  code(context, event) {\r\n    return new Promise((resolve, reject) => {\r\n      const btn2 = event.target as HTMLElement;\r\n      const fullMenu2 = btn2.closest(IDs.sel.tagScMenu) as HTMLElement;\r\n      const oldState2 = Number(fullMenu2.getAttribute('data-state') || 0);\r\n      const max2 = Number(fullMenu2.getAttribute('group-count'));\r\n      const newState2 = (oldState2 + 1) % max2;\r\n\r\n      fullMenu2.classList.remove(`group-${oldState2}`);\r\n      fullMenu2.classList.add(`group-${newState2}`);\r\n      fullMenu2.setAttribute('data-state', String(newState2));\r\n\r\n      event.preventDefault();\r\n\r\n      function mouseenterHandler(e: MouseEvent) {\r\n        fullMenu2.style.opacity = '1';\r\n      }\r\n\r\n      function mouseleaveHandler(e: MouseEvent) {\r\n        if (e.screenX !== 0 && e.screenY !== 0) {\r\n          // hide toolbar on mouseleave\r\n          fullMenu2.style.opacity = '0';\r\n        } else {\r\n          // this is fix for Chrome issue\r\n          // ensure to show toolbar because X=0 and Y=0\r\n          fullMenu2.style.opacity = '1';\r\n          console.warn(\r\n            'workaround for toolbar hide onmouseleave issue',\r\n            e.screenX,\r\n            e.screenY,\r\n            e.target,\r\n          );\r\n        }\r\n      }\r\n\r\n      // because of issue in Chrome we need to override CSS rules in edit.css for toolbar toggle on mouse hover\r\n      const scElement = fullMenu2.closest(\r\n        '.' + C.Toolbar.classes.oldHover,\r\n      );\r\n      // add mouseenter and mouseleave events to parent sc-element if not already added\r\n      if (scElement && fullMenu2.getAttribute('listener') !== 'true') {\r\n        scElement.addEventListener('mouseenter', mouseenterHandler);\r\n        scElement.addEventListener('mouseleave', mouseleaveHandler);\r\n        fullMenu2.setAttribute('listener', 'true'); // flag that events are added\r\n      }\r\n\r\n      resolve();\r\n    });\r\n  },\r\n});\r\n","import { CmdParHlp, CommandNames, Commands, SharedLogic } from '..';\r\nimport { Actions } from './content-list-actions';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.moveDown, 'MoveDown', 'move-down', false, true, {\r\n  // TODO: do not display if is last item in list\r\n  showCondition: (context) => SharedLogic.isList(context),\r\n  code(context) {\r\n    // TODO: make sure index is never greater than the amount of items\r\n    const i = CmdParHlp.getIndex(context);\r\n    return Actions.changeOrder(context, i, i + 1);\r\n  },\r\n});\r\n","import { CmdParHlp, CommandNames, Commands } from '..';\r\nimport { Actions } from './content-list-actions';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.moveUp, 'MoveUp', 'move-up', false, true, {\r\n  showCondition(context) {\r\n    return !!(SharedLogic.isList(context) && CmdParHlp.getIndex(context) !== 0);\r\n  },\r\n  code(context) {\r\n    const i = CmdParHlp.getIndex(context);\r\n    return Actions.changeOrder(context, i, Math.max(i - 1, 0));\r\n  },\r\n});\r\n","import { CmsEngine, CommandNames, Commands } from '..';\r\nimport { SharedLogic } from './shared-logic';\r\nimport { CmdParHlp } from '../cmd-par-hlp';\r\n\r\n/**\r\n * 'new' is a dialog to add something, and will not add if cancelled\r\n * new can also be used for mini-toolbars which just add an entity not attached to a module\r\n * in that case it's essential to add a contentType like\r\n * <ul class=\"sc-menu\" data-toolbar='{\"action\":\"new\", \"contentType\": \"Category\"}'></ul>\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.new, 'New', 'plus', false, true, {\r\n  parameters: (_) => ({ mode: CommandNames.newMode }),\r\n\r\n  dialog: (_) => CommandNames.edit, // don't use \"new\" (default) but use \"edit\"\r\n\r\n  showCondition(context) {\r\n    // don't provide new if type unknown or on the header-item\r\n    return  !!context.button.command.params.contentType || SharedLogic.isList(context);\r\n  },\r\n\r\n  code(context, event) {\r\n    const params = context.button.command.params;\r\n    // todo - should refactor this to be a toolbarManager.contentBlock command\r\n    params.index = CmdParHlp.getIndex(params) + 1;\r\n\r\n    // if we have an EntityId, this means that it picked up id/guid from the current item,\r\n    // so we must reset both EntityId and EntityGuid\r\n    // note that we don't reset this if entityId = 0, because that usually means the guid was preset on purpose\r\n    if (params.entityId && params.entityId !== 0) {\r\n      delete params.entityId;\r\n      delete params.entityGuid;\r\n    }\r\n\r\n    // if we have useModuleList AND contentType then something is inconsistent\r\n    // since useModuleList doesn't need to specify the contentType\r\n    // this means that it's a custom new button, and useModuleList is wrong.\r\n    if (params.useModuleList && params.contentType)\r\n    delete params.useModuleList;\r\n\r\n    // done\r\n    return CmsEngine.openDialog(context, event, 'commandNew.add');\r\n  },\r\n});\r\n","import { CmdParHlp, CommandNames, Commands } from '..';\r\nimport { translate } from '../../i18n';\r\nimport { Actions } from './content-list-actions';\r\n\r\n/**\r\n * todo: shouldn't be available if changes are not allowed\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.publish, 'Unpublished', 'eye-off', false, false, {\r\n  showCondition(context) {\r\n    return context.button.command.params.isPublished === false;\r\n  },\r\n  disabled(context) {\r\n    return !context.instance.allowPublish || context.button.command.params.isPublished !== false;\r\n  },\r\n  code(context, event): Promise<void> {\r\n    const params = context.button.command.params;\r\n    return new Promise((resolve, reject) => {\r\n      if (params.isPublished) {\r\n        alert(translate('Toolbar.AlreadyPublished'));\r\n        return resolve();\r\n      }\r\n\r\n      // if we have an entity-id, publish based on that\r\n      if (params.entityId)\r\n        return Actions.publishId(context, params.entityId);\r\n\r\n      const i = CmdParHlp.getIndex(context);\r\n      const part: string = i === -1 ? 'listcontent' : 'content';\r\n      const index = i === -1 ? 0 : i;\r\n      return Actions.publish(context, part, index);\r\n    });\r\n  },\r\n});\r\n","import { CommandNames, Commands, SharedLogic } from '..';\r\nimport { translate } from '../../i18n';\r\nimport { Actions } from './content-list-actions';\r\n\r\n/**\r\n * remove an item from the placeholder (usually for lists)\r\n *\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.remove, 'Remove', 'minus-circled', false, true, {\r\n  showCondition: (context) => SharedLogic.isList(context),\r\n  code(context) {\r\n    return new Promise((resolve, reject) => {\r\n      if (confirm(translate('Toolbar.ConfirmRemove')))\r\n      return Actions.removeFromList(context);\r\n      return resolve();\r\n    });\r\n  },\r\n});\r\n","import { CmdParHlp, CommandNames, Commands } from '..';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nCommands.add(CommandNames.replace, 'Replace', 'replace', false, true, {\r\n\r\n  showCondition(context) {\r\n    return SharedLogic.isReferencedItem(context);\r\n  },\r\n\r\n  configureLinkGenerator: (context, linkGenerator) => {\r\n    // default case is ContentBlock - in which case it doesn't need to redefine the items\r\n    if (!SharedLogic.isFieldList(context)) return;\r\n\r\n    // fieldList - redefine the items\r\n    const params = context.button.command.params;\r\n    linkGenerator.items = [{\r\n      Add: false,\r\n      Index: CmdParHlp.getIndex(params),\r\n      Parent: params.parent,\r\n      Field: params.fields,\r\n    }];\r\n  },\r\n});\r\n","import { Command, CommandNames, Commands } from '..';\r\nimport { TemplateIdentifier } from '../../../../$2sxc/src/cms/item-identifiers';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.template, 'Develop', 'code', true, false, {\r\n  newWindow: (_) => true,\r\n  dialog: (_) => 'develop',\r\n\r\n  showCondition: (context) => !!context.user.CanDevelop,\r\n\r\n  configureLinkGenerator: (context, linkGenerator) => {\r\n    const cb = context.contentBlock;\r\n    const identifier: TemplateIdentifier = { EntityId: cb.templateId };\r\n    if (cb.templatePath) identifier.Path = cb.templatePath;\r\n    if (cb.edition) identifier.Edition = cb.edition;\r\n    linkGenerator.items = [identifier];\r\n  },\r\n\r\n  parameters: (ctx) => ({ isshared: ctx.contentBlock.templateIsShared }),\r\n\r\n  // Special: the items are fake, they transport info about the template\r\n  noItems: false,\r\n});\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.template_old_develop));\r\n","import { Command, CommandNames, Commands, tlbI18nPrefix } from '..';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.query, 'QueryEdit', 'filter', true, false, {\r\n  dialog: (_) => 'pipeline-designer',\r\n\r\n  parameters: (ctx) => ({ pipelineId: ctx.contentBlock.queryId }),\r\n\r\n  newWindow: (_) => true,\r\n\r\n  disabled: (ctx) => ctx.app.settingsId === null || !ctx.contentBlock.queryId,\r\n\r\n  title: (ctx) => `${tlbI18nPrefix}QueryEdit${ctx.contentBlock.queryId === null ? 'Disabled' : ''}`,\r\n\r\n  showCondition: (ctx) => !!ctx.user.CanDevelop && !ctx.app.isContent,\r\n\r\n  // if it doesn't have a query, make it less strong\r\n  dynamicClasses: (ctx) => ctx.contentBlock.queryId ? '' : 'empty',\r\n\r\n  noItems: true,\r\n});\r\n\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.query_old_templateQuery));\r\n","import { Command, CommandNames, Commands } from '..';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.view, 'TemplateSettings', 'sliders', true, false, {\r\n  dialog: (_) => 'edit',\r\n\r\n  showCondition: (ctx) => !!ctx.user.CanDevelop && !ctx.app.isContent,\r\n\r\n  configureLinkGenerator: (ctx, linkGen) => {\r\n    linkGen.items = [{ EntityId: ctx.contentBlock.templateId }];\r\n  },\r\n\r\n  // Special: the items are fake, they transport info about the template\r\n  noItems: false,\r\n});\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.view_old_templateSettings));\r\n","import { Command, CommandNames, Commands } from '..';\r\n\r\n/**\r\n * import this module to commands.ts\r\n * @internal\r\n */\r\nconst cmd = Command.build(CommandNames.system, 'Zone', 'manage', true, false, {\r\n  dialog: (_) => CommandNames.system_old_zone,\r\n  \r\n  showCondition: (ctx) => !!ctx.user.CanAdmin,\r\n\r\n  noItems: true,\r\n});\r\n\r\nCommands.addCommand(cmd);\r\nCommands.addCommand(Command.clone(cmd, CommandNames.system_old_zone));\r\n","/**\r\n * params for getAndReload WebAPI\r\n * @internal\r\n */\r\nexport class ContentListActionParams {\r\n  id?: number;\r\n\r\n  /** TODO: unclear if this really serves a purpose. it's only used in publish, replace etc., and I assume it must always publish both... */\r\n  part?: string;\r\n\r\n  parent?: string;\r\n  fields?: string;\r\n\r\n  /** The index for this item */\r\n  index?: number;\r\n\r\n  /** target index when re-ordering an item */\r\n  toIndex?: number;\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport const WorkflowCommands = {\r\n  /** Special command: 'all' is a catch-all for workflows that should run on every command */\r\n  all: 'all',\r\n\r\n  /** Special Command: 'refresh' is usually run inside other commands after execution */\r\n  refresh: 'refresh',\r\n};\r\n","/**\r\n * ContextIdentifier is used to initialize a Sxc object outside of the default context.\r\n * @public\r\n */\r\nexport class ContextIdentifier {\r\n  /**\r\n   * ZoneId of this Context\r\n   * @requires zoneId\r\n   */\r\n  zoneId: number;\r\n\r\n  /**\r\n   * AppId of this Context\r\n   * @requires appId\r\n   */\r\n  appId: number;\r\n\r\n  /** \r\n   * PageId of this Context (optional)\r\n   * @optional\r\n   */\r\n  pageId?: number;\r\n\r\n  /**\r\n   * ModuleId of this Context (optional)\r\n   * @optional\r\n   */\r\n  moduleId?: number;\r\n\r\n  /**\r\n   * Exclude pageId and moduleId headers in web requests.\r\n   * Internal - only used in edit-ui formulas. Any other use must be documented here.\r\n   * @internal\r\n   */\r\n  _noContextInHttpHeaders?: boolean;\r\n\r\n  /**\r\n   * Auto add the appid= and zoneid= to the url if not yet set\r\n   * Internal - only used in edit-ui formulas. Any other use must be documented here.\r\n   * @internal\r\n   */\r\n  _autoAppIdsInUrl?: boolean;\r\n\r\n  /**\r\n   * Marks the context as complete, so it won't merge in anything else \r\n   * WIP #CustomContext ATM for the updated edit-ui\r\n   * @internal\r\n   */\r\n  complete?: boolean;\r\n\r\n  /**\r\n   * WIP #CustomContext not really used yet\r\n   * @internal\r\n   */\r\n  blockId?: number;\r\n\r\n  /**\r\n   * Type Guard to determine if an object is a ContextIdentifier\r\n   * @param original \r\n   * @returns \r\n   * @internal\r\n   */\r\n  static is(original: unknown): original is ContextIdentifier {\r\n    const origAsContextId = original as ContextIdentifier;\r\n    return origAsContextId.zoneId !== undefined && origAsContextId.appId !== undefined;\r\n  }\r\n\r\n  /**\r\n   * Internal\r\n   * @param ctx \r\n   * @internal\r\n   */\r\n  static ensureCompleteOrThrow(ctx: ContextIdentifier): ContextIdentifier {\r\n    // if it's fulfills the minimum requirements\r\n    if (ctx.zoneId && ctx.appId) return ctx; \r\n  \r\n    const msg = `It looks like the id given is a ContextIdentifier, but it's missing either zoneId or appId.`;\r\n    console.error(msg, ctx);\r\n    throw msg;\r\n  }\r\n  \r\n  /**\r\n   * Create a string-id to identify in a cache. \r\n   * @param ctx \r\n   * @returns \r\n   * @internal\r\n   */\r\n  static toCacheKey(ctx: ContextIdentifier): string {\r\n    this.ensureCompleteOrThrow(ctx);\r\n    return `${ctx.zoneId}/${ctx.appId}/${ctx.pageId}/${ctx.moduleId}/${ctx.blockId}`;\r\n  }\r\n}\r\n","import { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { RunParams, RunParamsWithContext } from '../../../$2sxc/src/cms/run-params';\r\nimport { ContextIdentifier } from '../../../$2sxc/src/sxc-global/context-identifier';\r\nimport { CommandNames, CommandParams, Commands } from '../commands';\r\nimport { HasLog, Log } from '../core';\r\n\r\n/**\r\n * Helper class to process parameters given to the Cms.Run statement\r\n * Important because certain params may sometimes be full objects, and sometimes just a name.\r\n * In addition, even if we have more than the name, we must ensure that defaults are also included\r\n *\r\n * @internal\r\n */\r\nexport class RunParamsHelpers extends HasLog {\r\n    constructor(parentLog?: Log) {\r\n        super('Cmd.RunPrm', parentLog, 'start');\r\n    }\r\n\r\n    /**\r\n     * name or settings adapter to settings\r\n     * @param nameOrSettings\r\n     * @returns settings\r\n     */\r\n    public getParamsFromNameOrParams(nameOrSettings: string | CommandParams): CommandParams {\r\n        const cl = this.log.call('getParamsFromNameOrParams', `${nameOrSettings}`);\r\n        // check if nameOrString is name (string) or object (settings)\r\n        const nameIsString = typeof nameOrSettings === 'string';\r\n        cl.add(`adapting settings; name string: ${nameIsString}; name = ${nameOrSettings}`);\r\n        const result = nameIsString\r\n            ? { action: nameOrSettings as CommandNames } satisfies CommandParams\r\n            : nameOrSettings;\r\n        return cl.return(result);\r\n    }\r\n\r\n    /**\r\n     * Take a settings-name or partial settings object,\r\n     * and return a full settings object with all defaults from\r\n     * the command definition\r\n     * @param params\r\n     */\r\n    public expandParamsWithDefaults(params: CommandParams): CommandParams {\r\n        const cl = this.log.call('expandParamsWithDefaults');\r\n        const name = params.action;\r\n        cl.add(`will add defaults for ${name} from buttonConfig`);\r\n        const defaults = Commands.singleton().get(name).buttonDefaults;\r\n        cl.data('defaults to merge', defaults);\r\n        // TODO: 2dm - suspicious cast\r\n        // merge conf & settings, but...?\r\n        return cl.return({...defaults, ...params} as CommandParams);\r\n    }\r\n\r\n\r\n    // ----- Static Helpers -----\r\n    /**\r\n     * Checks if the run params are complete, as would be used in the $2sxc.cms.run\r\n     * @internal\r\n     */\r\n    static is$sxcRunParams(o: unknown): o is RunParamsWithContext {\r\n        const t = o as RunParamsWithContext;\r\n        return (t.tag != null || (t.context != null && (ContextIdentifier.is(t.context) || Sxc.is(t.context)))) &&\r\n        RunParamsHelpers.isRunParamsInstance(t);\r\n    }\r\n\r\n    /**\r\n     * Checks if it's at least an instance run param - having at least `action` or `params`\r\n     * @internal\r\n     */\r\n    private static isRunParamsInstance(maybeRunParams: unknown): maybeRunParams is RunParams {\r\n        const typed = maybeRunParams as RunParams;\r\n        return (typed.action != null || typed.params != null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static ensureRunParamsInstanceOrError(runParams: RunParamsWithContext) {\r\n        if (!RunParamsHelpers.isRunParamsInstance(runParams))\r\n        throw `${errPrefix} with at least ${runContextInstanceMinimalRequirements}`;\r\n        if (runParams.context)\r\n        throw `${errPrefix} without 'context' since it already provides the context`;\r\n    }\r\n}\r\n\r\n\r\nconst runContextInstanceMinimalRequirements = \"'action' and/or 'params'\";\r\nconst errPrefix = 'sxc instance run() expects runParams';\r\n","import { IQuickDialogConfig } from '../../../connect-parts/inpage-quick-dialog';\r\nimport { ContextComplete } from '../context';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class QuickDialogConfig implements IQuickDialogConfig {\r\n    appId: number;\r\n    /**\r\n     * This will cause the quick-dialog to start in a different mode\r\n     * True means it starts with Content-Type picker and then view\r\n     * False means it starts with App-Picker and then View\r\n     */\r\n    isContent: boolean;\r\n    isInnerContent: boolean;\r\n    hasContent: boolean;\r\n    isList: boolean;\r\n    templateId: number;\r\n    contentTypeId: string;\r\n    // user: ContextOfUser;\r\n    supportsAjax: boolean;\r\n    debug: boolean;\r\n\r\n    static fromContext(context: ContextComplete): QuickDialogConfig {\r\n        const config = new QuickDialogConfig();\r\n        config.appId = context.app.id;\r\n        config.isContent = context.app.isContent;\r\n        config.isInnerContent = context.instance.id !== context.contentBlockReference.id; // if it differs, it's inner\r\n        config.hasContent = context.app.hasContent;\r\n        config.isList = context.contentBlock.isList;\r\n        config.templateId = context.contentBlock.templateId;\r\n        config.contentTypeId = context.contentBlock.contentTypeId;\r\n        // config.user = ContextOfUser.fromContext(context);\r\n        config.supportsAjax = context.app.supportsAjax;\r\n        config.debug = window.$2sxc.debug.load;\r\n        return config;\r\n    }\r\n}\r\n","import { QuickDialogContainer } from '.';\r\nimport { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { IIFrameBridge } from '../../../connect-parts/inpage-quick-dialog';\r\nimport { IQuickDialogConfig } from '../../../connect-parts/inpage-quick-dialog';\r\nimport { ContentBlockEditor } from '../contentBlock/content-block-editor';\r\nimport { renderer } from '../contentBlock/render';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HasLog, NoJQ } from '../core';\r\nimport { EditManager } from '../manage/edit-manager';\r\nimport { QuickDialog } from './quick-dialog';\r\nimport { QuickDialogConfig } from './quick-dialog-config';\r\nimport { DomTools } from '../../../$2sxc/src/dom/dom-tools';\r\n\r\nconst scrollTopOffset: number = 80;\r\nconst animationTime: number = 400;\r\n\r\n/**\r\n * @internal\r\n */\r\n// ReSharper disable once InconsistentNaming\r\nexport class IFrameBridge extends HasLog implements IIFrameBridge {\r\n\r\n    constructor(parent: QuickDialogContainer) {\r\n        super('QDl.IfBrig', parent.log);\r\n    }\r\n\r\n    private sxcCacheKey: string;\r\n    private dialogName: string;\r\n\r\n    /** internal object to keep track of the sxc-instance */\r\n    private instanceSxc: Sxc;\r\n\r\n    /** The html-tag of the current module */\r\n    private tagModule: HTMLElement;\r\n\r\n    /**\r\n     * get the sxc-object of this iframe\r\n     */\r\n    private uncachedSxc(): Sxc {\r\n        if (!this.instanceSxc) throw \"can't find sxc-instance of IFrame, probably it wasn't initialized yet\";\r\n        return this.instanceSxc.recreate(true);\r\n    }\r\n\r\n    getContext(): ContextComplete {\r\n        const cl = this.log.call('getContext');\r\n        return cl.return(ContextComplete.expandContext(this.uncachedSxc()));\r\n    }\r\n\r\n    getAdditionalDashboardConfig() {\r\n        const cl = this.log.call('getAdditionalDashboardConfig');\r\n        return cl.return(QuickDialogConfig.fromContext(this.getContext()));\r\n    }\r\n\r\n    hide(): void {\r\n        QuickDialog.singleton().setVisible(false);\r\n    }\r\n\r\n    run(verb: string) {\r\n        (this.uncachedSxc().manage as EditManager).run(verb, undefined, undefined, 'iframeBridge.run');\r\n    }\r\n\r\n    cancel(): void { QuickDialog.singleton().cancel(this); }\r\n\r\n    showMessage(message: string) {\r\n        const cl = this.log.call('showMessage');\r\n        renderer.showMessage(this.getContext(), `<p class=\"no-live-preview-available\">${message}</p>`);\r\n        this.scrollToTarget(this.tagModule);\r\n        cl.done();\r\n    }\r\n\r\n    reloadAndReInit(): Promise<IQuickDialogConfig> {\r\n        const cl = this.log.call('reloadAndReInit');\r\n        this.changed = false;\r\n        cl.done();\r\n        return renderer.reloadAndReInitialize(this.getContext(), 'iframeBridge.reloadAndReInit', true, true)\r\n            .then(() => {\r\n              cl.add('scrollToTarget');\r\n              return this.scrollToTarget(this.tagModule);\r\n            })\r\n            .then(() => {\r\n              cl.add('getAdditionalDashboardConfig');\r\n              return Promise.resolve(this.getAdditionalDashboardConfig());\r\n            });\r\n    }\r\n\r\n    setTemplate(templateId: number, templateName: string, final: boolean): Promise<boolean> {\r\n        const cl = this.log.call('setTemplate', `tid: ${templateId}, tname: ${templateName}, final: ${final}`);\r\n        this.changed = true;\r\n        const config = this.getAdditionalDashboardConfig();\r\n        const context = this.getContext();\r\n        const ajax = config.isContent || config.supportsAjax;\r\n\r\n        // add msg on full-reload, as it takes longer\r\n        // don't add this on ajax, as it will have side-effects because sometimes\r\n        // in ajax the content won't be replaced\r\n        if (!ajax)\r\n            this.showMessage(`refreshing <b>${templateName}</b>...`);\r\n\r\n        const reallySave = final || !ajax;\r\n        let promise = reallySave\r\n            ? ContentBlockEditor.singleton().updateTemplateFromDia(context, templateId)\r\n            : renderer.ajaxLoad(context, templateId, true, 'iframeBridge.setTemplate');\r\n\r\n        if (final)\r\n            promise = promise.then(() => QuickDialog.singleton().setVisible(false));\r\n\r\n        promise = ajax\r\n            ? promise.then(() => this.scrollToTarget(this.tagModule))\r\n            : promise.then(() => window.parent.location.reload());\r\n\r\n        // return true if ajax, so upstream can update UIs\r\n        return cl.return(promise.then(() => ajax));\r\n    }\r\n\r\n    changed = false;\r\n\r\n    /**\r\n     * prepare the bridge with the info of the current instance\r\n     */\r\n    setup(sxc: Sxc, dialogName: string): void {\r\n        const cl = this.log.call('setup');\r\n        cl.data('rewire with sxc: ', sxc);\r\n        cl.data('dialogName: ', dialogName);\r\n        this.changed = false;\r\n        this.instanceSxc = sxc;\r\n        const tag = DomTools.getTag(sxc);\r\n        cl.data('tag: ', tag);\r\n        this.tagModule = tag?.parentElement;      \r\n        this.sxcCacheKey = sxc.cacheKey;\r\n        if (dialogName) this.dialogName = dialogName;\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * check if the dialog is showing for the current sxc-instance\r\n     * @param dialogName - name of dialog\r\n     * @returns {boolean} true if it's currently showing for this sxc-instance\r\n     */\r\n    isConfiguredFor(instanceId: string, dialogName: string): boolean {\r\n        const cl = this.log.call('isConfiguredFor', `id:${instanceId}, dialog:${dialogName}`);\r\n        const result = this.sxcCacheKey === instanceId // the iframe is showing for the current sxc\r\n            && this.dialogName === dialogName; // the view is the same as previously\r\n        return cl.return(result);\r\n    }\r\n\r\n    private scrollToTarget(target: HTMLElement): void {\r\n        const cl = this.log.call('scrollToTarget');\r\n        const specs: ScrollToOptions = {\r\n            top: NoJQ.offset(target).top - scrollTopOffset,\r\n            left: 0,\r\n            behavior: 'smooth',\r\n        };\r\n        // debugger; // scrolls to wrong location. Target is wrong\r\n        // window.scrollTo(specs);\r\n        cl.done();\r\n    }\r\n}\r\n\r\n\r\n","import { HasLog, Insights } from '../core';\r\n\r\n/**\r\n * This object helps persist / load / reset\r\n * a setting in the session-state\r\n * @internal\r\n */\r\n\r\n// General notes\r\n// - must always use try-catch because in certain environments like iFrame prohibit access to sessionStorage\r\nexport class SessionStateHandler<T> extends HasLog {\r\n  constructor(private readonly key: string) {\r\n    super('Ses.State');\r\n    Insights.add('system', 'session-state ' + key, this.log);\r\n  }\r\n\r\n  set(value: string): void {\r\n    this.log.add(`state '${this.key}' set(${value})`);\r\n    try {\r\n      sessionStorage.setItem(this.key, value);\r\n    } catch { /* ignore */ }\r\n  }\r\n\r\n  remove(): void {\r\n    this.log.add(`state '${this.key}' remove()`);\r\n    try {\r\n      sessionStorage.removeItem(this.key);\r\n    } catch { /* ignore */ }\r\n  }\r\n\r\n  get(): T {\r\n    const result = getItemValue<T>(this.key);\r\n    this.log.add(`state '${this.key}' get() = '${result}'`);\r\n    try {\r\n      return result;\r\n    } catch { /* ignore */ }\r\n  }\r\n}\r\n\r\n\r\nfunction getItemValue<T>(key: string): T {\r\n  try {\r\n    const value = sessionStorage.getItem(key);\r\n    return JSON.parse(value) as T;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n","import { SessionStateHandler } from '../manage/session-state-handler';\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport let cbId = new SessionStateHandler<number>('dia-cbid');\r\n\r\n/**\r\n * @internal\r\n */\r\nexport let cancelled = new SessionStateHandler<boolean>('cancelled-dialog');\r\n","\r\nexport * from '../../../connect-parts/inpage-quick-dialog';\r\nexport * from './iframe-bridge';\r\nexport * from './quick-dialog';\r\nexport * from './quick-dialog-config';\r\nexport * from './quick-dialog-container';\r\nexport * from './state';\r\n\r\nconst css = require('./quick-dialog.css');","import { IDialogFrameElement, IFrameBridge } from '.';\r\nimport { HasLog, NoJQ } from '../core';\r\nimport { QuickDialog } from './quick-dialog';\r\n\r\n/**\r\n * this is a dialog manager which is in charge of all quick-dialoges\r\n * it always has a reference to the latest dialog created by a.ny module instance\r\n * @internal\r\n */\r\n\r\nconst containerClass = 'inpage-frame-wrapper';\r\nconst iframeClass = 'inpage-frame';\r\nconst iframeTag = 'iframe';\r\nconst containerTemplate = `<div class=\"${containerClass}\"><div class=\"${iframeClass}\"></div></div>`;\r\nconst resizeInterval = 200;\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class QuickDialogContainer extends HasLog {\r\n\r\n    constructor(quickDialog: QuickDialog) {\r\n        super('QDl.Contnr', quickDialog.log);\r\n    }\r\n\r\n    private isFullscreen: boolean = false;\r\n    private resizeWatcher: number = null;\r\n    /**\r\n     * get the current container\r\n     * @returns html element of the div\r\n     */\r\n    getOrCreate(): HTMLElement {\r\n        const container = document.querySelector<HTMLElement>(`.${containerClass}`);\r\n        return container ?? this.buildContainerAndIFrame();\r\n    }\r\n\r\n    /**\r\n     * build the container in the dom w/iframe for re-use\r\n     * @returns dom-object\r\n     */\r\n    private buildContainerAndIFrame(): HTMLElement {\r\n        const callLog = this.log.call('buildContainerAndIFrame');\r\n        const container = NoJQ.domFromString(containerTemplate)[0];\r\n        if (document.querySelectorAll<HTMLElement>('#personaBar-iframe').length > 0)\r\n            container.classList.add('persona-bar-visible');\r\n        const newIFrame = document.createElement(iframeTag);\r\n\r\n        // 2023-07-07 2dm 2sxc 16.02 - added `color-scheme: auto;` to fix dark mode\r\n        // Otherwise the iframe is not transparent in dark mode\r\n        // https://fvsch.com/transparent-iframes\r\n        newIFrame.style.cssText = 'color-scheme: auto;';\r\n\r\n        const extendedIFrame = convertIFrameToQuickDialog(newIFrame, this);\r\n        container.querySelector<HTMLElement>(`.${iframeClass}`).append(extendedIFrame);\r\n        document.body.append(container);\r\n        this.watchForResize(container);\r\n        return callLog.return(container, 'ok');\r\n    }\r\n\r\n    /**\r\n     * find the iframe which hosts the dialog\r\n     * @param container: - html-container\r\n     * @returns iframe object\r\n     */\r\n    getIFrame(container?: HTMLElement): IDialogFrameElement {\r\n        if (!container) container = this.getOrCreate();\r\n        return container.querySelector<IDialogFrameElement>(iframeTag);\r\n    }\r\n\r\n    /**\r\n     * set container css for size\r\n     */\r\n    setSize(fullScreen: boolean): void {\r\n        const cl = this.log.call('setSize');\r\n        const container = this.getOrCreate();\r\n        // set container height\r\n        container.style.minHeight = fullScreen ? '100%' : '225px';\r\n        this.isFullscreen = fullScreen;\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * create watcher which monitors the iframe size and adjusts the container as needed\r\n     */\r\n    private watchForResize(container: HTMLElement): void {\r\n        // only add a timer if not already running\r\n        if (this.resizeWatcher) return;\r\n        const callLog = this.log.call('watchForResize');\r\n        // if (!resizeWatcher)\r\n        this.resizeWatcher = window.setInterval(() => {\r\n            try {\r\n                const frm = this.getIFrame(container);\r\n                if (!frm) {\r\n                    callLog.onlyAddIfNew('no iframe');\r\n                    return;\r\n                }\r\n\r\n                const height: number = frm.contentDocument.body.offsetHeight;\r\n                if (frm.previousHeight === height) {\r\n                    callLog.onlyAddIfNew('no height change');\r\n                    return;\r\n                }\r\n                frm.style.minHeight = container.style.minHeight;\r\n                frm.style.height = height + 'px';\r\n                frm.previousHeight = height;\r\n                if (this.isFullscreen) {\r\n                    frm.style.height = '100%';\r\n                    frm.style.position = 'absolute';\r\n                }\r\n                callLog.onlyAddIfNew('changed to ' + height);\r\n            } catch (e) {\r\n                callLog.add('error', e);\r\n            }\r\n        }, resizeInterval);\r\n        callLog.return(null, 'watcher added');\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nfunction convertIFrameToQuickDialog(iFrame: HTMLIFrameElement, parent: QuickDialogContainer): IDialogFrameElement {\r\n    const callLog = parent.log.call('build');\r\n    callLog.data('prototype', IFrameBridge.prototype);\r\n    const iFrameExtended = iFrame as IDialogFrameElement;\r\n    iFrameExtended.bridge = new IFrameBridge(parent);\r\n    callLog.data('extensions', iFrameExtended.bridge);\r\n    return callLog.return(iFrameExtended);\r\n}\r\n","import { IDialogFrameElement, IIFrameBridge } from '.';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HasLog, Insights } from '../core';\r\nimport { IFrameBridge } from './iframe-bridge';\r\nimport { QuickDialogContainer } from './quick-dialog-container';\r\nimport * as QuickEditState from './state';\r\n\r\nconst diagShowClass: string = 'dia-select';\r\n\r\n/** dialog manager - the currently active dialog object */\r\nlet current: IDialogFrameElement = null;\r\n\r\ninterface IFrameWindow extends Window {\r\n    reboot(): void;\r\n}\r\n\r\n/**\r\n * this is a dialog manager which is in charge of all quick-dialogues\r\n * it always has a reference to the latest dialog created by a.ny module instance\r\n * @internal\r\n */\r\nexport class QuickDialog extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): QuickDialog {\r\n        return this._singleton ?? (this._singleton = new QuickDialog());\r\n    }\r\n    private static _singleton: QuickDialog;\r\n\r\n\r\n    private container: QuickDialogContainer;\r\n    private constructor() {\r\n        super('Qdl.Managr');\r\n        Insights.add('quick-dialog', 'manager', this.log);\r\n        this.container = new QuickDialogContainer(this);\r\n    }\r\n\r\n    /**\r\n     * Determines if a.ny dialog is currently showing\r\n     */\r\n    isVisible() {\r\n        return current != null;\r\n    }\r\n\r\n    /**\r\n     * toggle visibility\r\n     * @param {boolean} [show] true/false optional\r\n     */\r\n    setVisible(show: boolean): void {\r\n        const cl = this.log.call('setVisible');\r\n        const cont = this.container.getOrCreate();\r\n        cont.classList.toggle(diagShowClass, show);\r\n        this.rememberDialogState(this.container.getIFrame(cont), show);\r\n        current = show ? this.container.getIFrame() : null;\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * show / reset the current iframe to use new url and callback\r\n     * @param {ContextComplete} context object\r\n     * @param url - url to show\r\n     * @param {function()} closeCallback - callback event\r\n     * @param {boolean} isFullscreen - if it should open full screen\r\n     * @param [dialogName] - optional name of dialog, to check if it's already open\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    showOrToggleFromToolbar(\r\n        context: ContextComplete,\r\n        url: string,\r\n        isFullscreen: boolean,\r\n        dialogName: string,\r\n    ): Promise<boolean> {\r\n        const cl = this.log.call('showOrToggleFromToolbar', `ctx, url: '${url}', isFullScreen:${isFullscreen}, name:'${dialogName}'`);\r\n        this.container.setSize(isFullscreen);\r\n        const iFrame = this.container.getIFrame();\r\n\r\n        // in case it's a toggle\r\n        if (this.isVisible()) {\r\n            cl.add('is already visible');\r\n            // check if we're just toggling the current, or will show a new one afterwards\r\n            const isForSame = dialogName && current\r\n                && (current.bridge as IFrameBridge).isConfiguredFor(context.sxc.cacheKey, dialogName);\r\n            const togglePromise = isForSame ? this.promise : null;\r\n            this.cancel(current.bridge);\r\n            // just a hide this, return the old promise\r\n            if (togglePromise) return cl.return(togglePromise, 'just toggle off');\r\n        }\r\n\r\n        const dialogUrl = this.setUrlToQuickDialog(url);\r\n        (iFrame.bridge as IFrameBridge).setup(context.sxc, dialogName);\r\n        iFrame.setAttribute('src', dialogUrl);\r\n        // if the window had already been loaded, re-init\r\n        if (iFrame.contentWindow && (iFrame.contentWindow as IFrameWindow).reboot)\r\n            (iFrame.contentWindow as IFrameWindow).reboot();\r\n\r\n        // make sure it's visible'\r\n        this.setVisible(true);\r\n        return cl.return(this.promiseRestart(), 'restart');\r\n    }\r\n\r\n    cancel(bridge: IIFrameBridge) {\r\n        const callLog = this.log.call('cancel');\r\n        this.setVisible(false);\r\n        QuickEditState.cancelled.set('true');\r\n        this.resolvePromise(bridge.changed);\r\n        callLog.done();\r\n    }\r\n\r\n    private rememberDialogState(\r\n        iframe: IDialogFrameElement,\r\n        state: boolean,\r\n    ): void {\r\n        const callLog = this.log.call('rememberDialogState');\r\n        callLog.add(`qDialog persistDia(..., ${state})`);\r\n        if (state) {\r\n            const cbId = (iframe.bridge as IFrameBridge)\r\n                .getContext()\r\n                .contentBlockReference.id.toString();\r\n            callLog.add(`contentBlockId: ${cbId})`);\r\n            return callLog.return(QuickEditState.cbId.set(cbId));\r\n        }\r\n        return callLog.return(QuickEditState.cbId.remove(), 'remove');\r\n    }\r\n\r\n    //#region promise handling\r\n    private promise: Promise<boolean>;\r\n    private resolvePromise: (value?: boolean) => void;\r\n    private promiseRestart(): Promise<boolean> {\r\n        this.promise = new Promise<boolean>(\r\n            (resolve) => (this.resolvePromise = resolve),\r\n        );\r\n        return this.promise;\r\n    }\r\n    //#endregion\r\n\r\n    /**\r\n     * rewrite the url to fit the quick-dialog situation\r\n     * optionally with a live-compiled version from ng-serve\r\n     * @param url - original url pointing to the default dialog\r\n     * @returns {string} new url pointing to quick dialog\r\n     */\r\n    private setUrlToQuickDialog(url: string): string {\r\n        const cl = this.log.call('setUrlToQuickDialog', url);\r\n        // change default url-schema from the primary angular-app to the quick-dialog\r\n        url = url.replace(C.DialogPaths.eavUi, C.DialogPaths.quickDialog);\r\n        return cl.return(url);\r\n    }\r\n}\r\n","import { ContextComplete } from '../context/bundles/context-bundle-button';\r\n/**\r\n * This is for building/serializing the main url params when opening a dialog.\r\n * It does not contain the \"params\" / \"items\" part\r\n * @internal\r\n */\r\nexport class DialogCoreParams {\r\n  readonly zoneId: number;\r\n  readonly appId: number;\r\n  readonly mid: number;\r\n  readonly cbid: number;\r\n\r\n  readonly partOfPage?: boolean;\r\n  readonly publishing?: string;\r\n\r\n  /** new in 10.27 - for quick-dialog */\r\n  readonly apps?: string;\r\n\r\n  /**\r\n   * Settings to pass to the dialog.\r\n   * @internal v18.07 - not public - trying to finalize v20 (believe it was not used yet)\r\n   */\r\n  public settings?: unknown;\r\n\r\n  constructor(context: ContextComplete, partOfPage: boolean) {\r\n\r\n    // #CustomContext\r\n    // Note that as of v18, the #CustomContext was probably never fully completed\r\n    const ctx = context.sxc?.ctx;\r\n    if (ctx?.complete === true) {\r\n        this.zoneId = ctx.zoneId;\r\n        this.appId = ctx.appId;\r\n\r\n        // Only set moduleId and cbid if they are specified\r\n        if (ctx.moduleId != null)\r\n          this.mid = ctx.moduleId;\r\n        const cbid = ctx?.blockId ?? this.mid;\r\n        if (cbid)\r\n          this.cbid = cbid;\r\n    } else {\r\n        this.zoneId = ctx?.zoneId ?? context.app.zoneId;\r\n        this.appId = ctx?.appId ?? context.app.id;\r\n        this.mid = ctx?.moduleId ?? context.instance.id;\r\n        this.cbid = ctx?.blockId ?? context.contentBlockReference.id;\r\n    }\r\n\r\n    // If this action is \"part of the page\" then tell the dialog how the publishing should work\r\n    this.partOfPage = partOfPage;\r\n    if (partOfPage)\r\n      this.publishing = context.contentBlockReference.publishingMode;\r\n\r\n    // new in 10.27 - for quick-dialog\r\n    // I believe it's to restrict apps which can be selected\r\n    // for adding to inner content.\r\n    // Note that this is probably an undocumented feature, which should be surfaced some day.\r\n    if (context.button?.command?.params?.apps)\r\n        this.apps = context.button.command.params.apps;\r\n\r\n    this.settings = context.button?.command?.params?.settings;\r\n    if (!this.settings)\r\n      delete this.settings;\r\n  }\r\n}\r\n","import { CmdParHlp } from '.';\r\nimport { SxcGlobalEnvironment } from '../../../$2sxc/src';\r\nimport { CommandParams } from '../../../$2sxc/src/cms/command-params';\r\nimport { AnyIdentifier, ItemIdentifierInList, ItemIdentifierSimple, ItemUrlParameters } from '../../../$2sxc/src/cms/item-identifiers';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HasLog, Log } from '../core';\r\nimport { DialogCoreParams } from '../manage/dialog-core-params';\r\nimport { NoJQ, flattenSlashes } from '../plumbing';\r\nimport { ButtonSafe } from '../toolbar/config';\r\n\r\n/**\r\n * This is responsible for taking a context with command and everything\r\n * then building the link for opening the correct dialogs\r\n * @internal\r\n */\r\nexport class CommandLinkGenerator extends HasLog {\r\n  public items: AnyIdentifier[];\r\n\r\n  constructor(private buttonSafe: ButtonSafe, public readonly context: ContextComplete, parentLog: Log) {\r\n    super('Cmd.LnkGen', parentLog);\r\n    const cl = this.log.call('constructor');\r\n    const command = buttonSafe.action();\r\n\r\n    // Initialize Items - use predefined or create empty array\r\n    this.items = command.params.items || [];\r\n    cl.data('items', this.items);\r\n\r\n    this.#buildItemsList(buttonSafe);\r\n\r\n    // if the command has own configuration stuff, do that now\r\n    if (context.button.configureLinkGenerator)\r\n      context.button.configureLinkGenerator(context, this);\r\n    cl.done();\r\n  }\r\n\r\n  #getUrlParams(): ItemUrlParameters {\r\n    const l = this.log.call('constructor');\r\n    // initialize params\r\n    const dialog = this.buttonSafe.dialog();\r\n    // This corrects how the variable to name the dialog changed in the history of 2sxc from action to dialog\r\n    const { items: _, ...otherParams } = this.buttonSafe.parameters();\r\n    const urlParams = {\r\n      dialog: dialog || this.buttonSafe.action().name,\r\n      ...otherParams\r\n    } satisfies ItemUrlParameters;\r\n    l.data('urlParams', urlParams);\r\n    return urlParams;\r\n  }\r\n\r\n\r\n  /**\r\n   * Generate items for editing/changing or simple item depending on the scenario.\r\n   */\r\n  #buildItemsList(button: ButtonSafe) {\r\n    if (button.action().params.useModuleList)\r\n      this.#addContentGroupItems(true);\r\n    else if (button.action().params.parent)\r\n      this.#addItemInList();\r\n    else\r\n      this.#addItem();\r\n  }\r\n\r\n  /**\r\n   * build the link, combining specific params with global ones and put all in the url\r\n   */\r\n  getLink() {\r\n    const context = this.context;\r\n    const button = new ButtonSafe(context.button, context);\r\n    const params = button.action().params;\r\n\r\n    debugger;\r\n\r\n    // initialize params\r\n    const urlItems = context.button.tweakGeneratedUrlParameters\r\n      ? context.button.tweakGeneratedUrlParameters(context, this.#getUrlParams())\r\n      : this.#getUrlParams();\r\n\r\n    // steps for all actions: prefill, serialize, open-dialog\r\n    // when doing new, there may be a prefill in the link to initialize the new item\r\n    if (params.prefill)\r\n      for (let i = 0; i < this.items.length; i++)\r\n        this.#addFieldsAndParameters(this.items[i] as ItemIdentifierSimple, params);\r\n\r\n    delete urlItems.prefill; // added 2020-03-11, seemed strange that it's not removed\r\n\r\n    // Only add items if button doesn't forbid it - new v18.03\r\n    if (!button.noItems())\r\n      urlItems.items = JSON.stringify(this.items); // Serialize/json-ify the complex items-list\r\n\r\n    // clone the params and adjust parts based on partOfPage settings...\r\n    const partOfPage = button.partOfPage();\r\n    const ngDialogParams = new DialogCoreParams(context, partOfPage);\r\n\r\n    // initialize root url to dialog\r\n    const rootUrl = this.#getDialogUrl(context);\r\n\r\n    const debugUrlParam = window.$2sxc.urlParams.get('debug') ? '&debug=true' : '';\r\n    const dialogParams = NoJQ.param(ngDialogParams).replace(/%2F/g, '/');\r\n    return`${rootUrl}#${dialogParams}&${NoJQ.param(urlItems)}${debugUrlParam}`;\r\n  }\r\n\r\n  /**\r\n   * Determine the url to open a dialog, based on the settings which UI version to use\r\n   */\r\n  #getDialogUrl(context: ContextComplete): string {\r\n    const env = context.sxc?.env ?? window.$2sxc.env;\r\n    let customParams = env.dialogQuery();\r\n    if (customParams && !customParams.startsWith('&'))\r\n      customParams = '&' + customParams;\r\n    const baseUrl = flattenSlashes(`${env.uiRoot()}${C.DialogPaths.eavUi}`);\r\n    return `${baseUrl}?pageId=${env.page()}&wpk=${this.#withPublicKey(env)}&sxcver=${context.instance.sxcVersion}${customParams}`;\r\n  }\r\n\r\n  #withPublicKey(env: SxcGlobalEnvironment): boolean {\r\n    return env.publicKey() !== null;\r\n  }\r\n\r\n  #addItem() {\r\n    const item = {} as ItemIdentifierSimple;\r\n    const params = this.context.button.command.params;\r\n\r\n    // two ways to name the content-type-name this, v 7.2+ and older\r\n    const ct = params.contentType || (params as CommandParams & { attributeSetName: string }).attributeSetName;\r\n    if (params.entityId)\r\n      item.EntityId = params.entityId;\r\n    if (ct)\r\n      item.ContentTypeName = ct;\r\n\r\n    // only add if there was stuff to add\r\n    if (item.EntityId || item.ContentTypeName) {\r\n      this.items.push(this.#addFieldsAndParameters(item, params));\r\n    }\r\n  }\r\n\r\n  #addFieldsAndParameters<T extends AnyIdentifier>(item: T, params: CommandParams): T {\r\n    if (params == null) return item;\r\n    const itemIdentifier = item as ItemIdentifierSimple;\r\n    if (params.prefill) itemIdentifier.Prefill = params.prefill;\r\n    if (params.uifields) itemIdentifier.UiFields = params.uifields;\r\n    if (params.form) itemIdentifier.Parameters = params.form;\r\n    return item;\r\n  }\r\n\r\n  /**\r\n   * this will tell the command to edit a item from the sorted list in the group,\r\n   * optionally together with the presentation item\r\n   */\r\n  #addContentGroupItems(withPresentation: boolean) {\r\n    const cl = this.log.call('addContentGroupItems', `${withPresentation}`);\r\n    // const params = this.context.button.command.params;\r\n    const i = CmdParHlp.getIndex(this.context);\r\n    const isContentAndNotHeader = (i !== -1);\r\n    const index = isContentAndNotHeader ? i : 0;\r\n    const isAdd = this.context.button.command.name === 'new';\r\n    const groupId = this.context.contentBlock.contentGroupId;\r\n    const params = this.context.button.command.params;\r\n\r\n    const fields: string[] = [this.#findPartName(true)];\r\n    if (withPresentation)\r\n      fields.push(this.#findPartName(false));\r\n    fields.map((f) => this.#addContentGroupItem(groupId, index, f, isAdd, params));\r\n    cl.done();\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * this adds an item of the content-group, based on the group GUID and the sequence number\r\n   */\r\n  #addContentGroupItem(guid: string, index: number, part: string, isAdd: boolean, params: CommandParams) {\r\n    const cl = this.log.call('addContentGroupItem', `${guid}, ${index}, ${part}, ${isAdd}`);\r\n    const item = {\r\n      Add: isAdd,\r\n      Index: index,\r\n      Parent: guid,\r\n      Field: part.toLocaleLowerCase(),\r\n    };\r\n    this.items.push(this.#addFieldsAndParameters(item, params));\r\n    cl.done();\r\n  }\r\n\r\n\r\n  /**\r\n   * If a parent is specified, use that\r\n   * this will tell the command to edit a item which also belongs to a list\r\n   * this is relevant when adding new items\r\n   */\r\n  #addItemInList() {\r\n    const params = this.context.button.command.params;\r\n    const index = CmdParHlp.getIndex(params);\r\n    const isAdd = this.context.button.command.name === 'new';\r\n    const groupId = params.parent;\r\n\r\n    // New in 10.27 - if params has a field, use that\r\n    if (params.fields)\r\n      params.fields.split(',').map((f) => { \r\n        const item = {\r\n          EntityId: isAdd ? 0 : params.entityId,\r\n          Field: f,\r\n          Parent: groupId,\r\n          Add: isAdd,\r\n          Index: index,\r\n        } as ItemIdentifierInList;\r\n        this.items.push(this.#addFieldsAndParameters(item, params));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * find the part name for both the API to give the right item (when using groups) and for i18n\r\n   */\r\n  #findPartName(content: boolean): string {\r\n    const isContentAndNotHeader = (CmdParHlp.getIndex(this.context) !== -1);\r\n    return (isContentAndNotHeader ? '' : 'List') + (content ? 'Content' : 'Presentation');\r\n  }\r\n}\r\n\r\n","import { RunParams } from '../../../../$2sxc/src/cms/run-params';\r\nimport { CommandParams } from '../../../../$2sxc/src/cms/command-params';\r\nimport { RunParamsHelpers } from '../../cms/run-params-helpers';\r\nimport { ContentBlockEditor } from '../../contentBlock/content-block-editor';\r\nimport { renderer } from '../../contentBlock/render';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { ContextBundleInstance } from '../../context/bundles/context-bundle-instance';\r\nimport { HasLog, Insights, Log } from '../../core';\r\nimport { QuickDialog } from '../../quick-dialog/quick-dialog';\r\nimport { Button, ButtonSafe } from '../../toolbar/config';\r\nimport { ButtonCommand } from '../../toolbar/config';\r\nimport { InPageButtonJson } from '../../toolbar/config-loaders/config-formats/in-page-button';\r\nimport { WorkflowHelper, WorkflowPhases, WorkflowStepCodeArguments } from '../../workflow';\r\nimport { ToolbarWorkflowManager } from '../../workflow/toolbar-workflow-manager';\r\nimport { WorkflowStep } from '../../workflow/workflow-step';\r\nimport { CommandLinkGenerator } from '../command-link-generator';\r\nimport { Debug } from '../../constants/debug';\r\n\r\nconst debug = false;\r\n\r\ntype CommandPromise<T> = Promise<T|void>;\r\n\r\n/**\r\n * The CMS engine is global, and needs the context to work.\r\n * @internal\r\n */\r\nexport class CmsEngine extends HasLog {\r\n\r\n  private runParamsHelper: RunParamsHelpers;\r\n\r\n  constructor(parentLog?: Log) {\r\n    super('Cmd.Exec', parentLog, 'start');\r\n    this.runParamsHelper = new RunParamsHelpers(this.log);\r\n  }\r\n\r\n  detectParamsAndRun<T>(\r\n    context: ContextBundleInstance,\r\n    nameOrParams: string | CommandParams,\r\n    eventOrParams: CommandParams | MouseEvent,\r\n    event?: MouseEvent,\r\n  ): Promise<void | T> {\r\n    const cl = this.log.call('detectParamsAndRun', `${arguments.length} params`);\r\n    let cmdParams: CommandParams;\r\n\r\n    const thirdParamIsEvent = !event && eventOrParams && typeof (eventOrParams as MouseEvent).altKey !== 'undefined';\r\n    cl.add(`might cycle parameters. third is event=${thirdParamIsEvent}`);\r\n\r\n    if (thirdParamIsEvent) {\r\n      // no event param, but settings contains the event-object\r\n      cl.add('cycling params; event missing & eventOrSettings seems to be an event; settings assumed empty');\r\n      event = eventOrParams as MouseEvent; // move it to the correct variable\r\n      cmdParams = this.runParamsHelper.getParamsFromNameOrParams(nameOrParams);\r\n    } else {\r\n      cmdParams = {\r\n        ...(eventOrParams || {}),\r\n        ...this.runParamsHelper.getParamsFromNameOrParams(nameOrParams),\r\n      };\r\n    }\r\n\r\n    // ensure we have the right event despite browser differences\r\n    event = event || (window.event as MouseEvent);\r\n\r\n    const result: CommandPromise<T> = this.run(context as ContextComplete, cmdParams, event, undefined, 'sxcGlobalCms.detectParamsAndRun');\r\n    return cl.return(result);\r\n  }\r\n\r\n  /**\r\n   * run a command\r\n   * this method expects a clear order of parameters\r\n   * @param context\r\n   * @param settings\r\n   * @param event\r\n   */\r\n  run<T>(context: ContextComplete, params: CommandParams, event: MouseEvent, wipParamsWithWorkflow?: RunParams, triggeredBy?: string): CommandPromise<T> {\r\n    const cl = this.log.call('run<T>', `triggeredBy: ${triggeredBy}`, undefined, { context });\r\n\r\n    const cmdParams = this.runParamsHelper.expandParamsWithDefaults(params);\r\n\r\n    const origEvent = event;\r\n    const name = cmdParams.action;\r\n\r\n    // console.warn('2dm: cms-engine.ts: run', { context, params, cmdParams });\r\n    \r\n    cl.add(`run command '${name}'`);\r\n\r\n    // Toolbar API v2\r\n    const btnCommand = new ButtonCommand(name, cmdParams);\r\n    const newButtonConfig = new Button(btnCommand, btnCommand.name);\r\n\r\n    // merge conf & settings, but settings has higher priority\r\n    const button: Button = {\r\n      ...newButtonConfig,\r\n      ...InPageButtonJson.toButton(cmdParams as unknown),\r\n    };\r\n\r\n    // attach to context for inner calls which might access it\r\n    context.button = button;\r\n    cl.data('button', context.button);\r\n\r\n    // New in 11.12 - find commandWorkflow of toolbar or use a dummy so the remaining code will always work\r\n    // note: in cases where the click comes from elsewhere (like from the quick-dialog) there is no event\r\n\r\n    // New in 12.10 - Workflow can be provided by run-call\r\n    let wf: ToolbarWorkflowManager;\r\n    if (wipParamsWithWorkflow?.workflows) {\r\n      wf = new ToolbarWorkflowManager(this.log);\r\n      wf.add(wipParamsWithWorkflow.workflows as WorkflowStep | WorkflowStep[]);\r\n    } else\r\n      wf = WorkflowHelper.getWorkflow(origEvent?.target as HTMLElement);\r\n\r\n    // Attach to context, so it's available after running the command\r\n    context.commandWorkflow = wf;\r\n    const wrapperPromise = wf.run(new WorkflowStepCodeArguments(name, WorkflowPhases.before, context));\r\n\r\n    // In case we don't have special code, use generic code\r\n    let commandPromise = button.code;\r\n    if (!commandPromise) {\r\n      cl.add('button, no code - generating code to open standard dialog');\r\n      commandPromise = CmsEngine.openDialog;\r\n    }\r\n\r\n    // get button configuration to detect if it's only a UI action (like the more-button)\r\n    let finalPromise: CommandPromise<T>;\r\n    if (new ButtonSafe(button, context).uiActionOnly()) {\r\n      cl.add('UI command, no pre-flight to ensure content-block');\r\n      finalPromise = wrapperPromise.then((wfArgs) => WorkflowHelper.isCancelled(wfArgs)\r\n        ? Promise.resolve<T>(null)\r\n        : commandPromise(context, origEvent, 'cmsEngine.run#UI command'));\r\n    } else {\r\n      // if more than just a UI-action, then it needs to be sure the content-group is created first\r\n      cl.add('command might change data, wrap in pre-flight to ensure content-block');\r\n      finalPromise = wrapperPromise.then((wfArgs) => WorkflowHelper.isCancelled(wfArgs)\r\n        ? Promise.resolve<T>(null)\r\n        : ContentBlockEditor.singleton()\r\n            .prepareToAddContent(context, cmdParams.useModuleList)\r\n            .then(() => commandPromise(context, origEvent, 'cmsEngine.run#non UI command'))\r\n      );\r\n    }\r\n\r\n    // Attach post-command workflow\r\n    const promiseWithAfterEffects = finalPromise.then((result) => {\r\n      return wf\r\n        .run(new WorkflowStepCodeArguments(name, WorkflowPhases.after, null, result))\r\n        .then(() => result);\r\n    });\r\n\r\n    return cl.return(promiseWithAfterEffects);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Open a new dialog of the angular-ui\r\n   */\r\n  static openDialog<T>(context: ContextComplete, event: MouseEvent, triggeredBy: string): CommandPromise<T> {\r\n    const log = new Log('Cms.OpnDlg', null, `triggeredBy: ${triggeredBy}`);\r\n    Insights.add('cms', 'open-dialog', log);\r\n    // the link contains everything to open a full dialog (lots of params added)\r\n    const btn = new ButtonSafe(context.button, context);\r\n    const link = new CommandLinkGenerator(btn, context, log).getLink();\r\n\r\n    const origEvent = event || (window.event as MouseEvent);\r\n\r\n    return new Promise<T>((resolve) => {\r\n      // prepare promise for callback when the dialog closes\r\n      // to reload the in-page view w/ajax or page reload\r\n      const completePromise = () => {\r\n        // call the normal promise-resolve so the `.then` will be continued\r\n        resolve(context as unknown as T);\r\n        // reload the UI as specified\r\n        renderer.reloadAndReInitialize(context, 'cmsEngine.openDialog');\r\n      };\r\n\r\n      // Case 1: check if inline window (quick-dialog)\r\n      if (btn.inlineWindow()) {\r\n        // test if it should be full screen (value or resolve-function)\r\n        QuickDialog.singleton()\r\n          .showOrToggleFromToolbar(context, link, btn.fullScreen(), btn.dialog())\r\n          .then((isChanged) => { if (isChanged) completePromise(); });\r\n        return;\r\n      }\r\n\r\n      // Case 2: It's a normal pop-up dialog - either in a new tab/window or in a popup\r\n      const isNewWindow = btn.newWindow();\r\n\r\n      // Experimental v17 - ctrl-click opens in new window; shift-click opens in popup\r\n      if (isNewWindow || origEvent?.ctrlKey || origEvent?.shiftKey) {\r\n        // 1. resolve promise, as the window won't report when closed\r\n        resolve(context as unknown as T);\r\n\r\n        if (debug) console.log('2dm link click with ctrl/shift - open in new window');\r\n\r\n        // 2. add real link to the A tag. The first tag is probably the <i> tag, so we need to find the <a> tag\r\n        if (CmsEngine.applyLinkToButton(origEvent, link, isNewWindow ? '_blank' : null)) {\r\n          if (debug) console.log('link click with ctrl/shift all done');\r\n          return;\r\n        }\r\n\r\n        if (debug) console.log('2sxc run: link should open in a new window, but was not started from a link. Using window.open()');\r\n        window.open(link);\r\n        return;\r\n      }\r\n\r\n      // case 3: not new window, no special ctrl/shift, so use the normal popup\r\n      window.$2sxc.totalPopup.open(link, completePromise);\r\n    });\r\n  }\r\n\r\n  static applyLinkToButton(event: MouseEvent, link: string, target: string): boolean {\r\n    if (debug) console.log('applyLinkToButton', event, link, target);\r\n\r\n    // Get clicked tag from event and try to find a parent link tag\r\n    // event can be unknown, eg. when triggered from the Dnn-Module-Menu https://github.com/2sic/2sxc/issues/3280\r\n    let tag = event?.target as HTMLElement;\r\n    while (tag != null && tag.tagName !== 'A') tag = tag.parentElement;\r\n\r\n    // If we didn't find an A tag, we can't apply the link. Return false so the caller handles it.\r\n    if (tag == null) {\r\n      if (debug) console.log('no tag found, returning false');\r\n      return false;\r\n    }\r\n\r\n    if (debug) console.log('tag found, applying link to it', tag);\r\n\r\n    // Remember the old link / target, in case we accidentally change a link which is not part of the toolbar\r\n    const aTag = tag as HTMLLinkElement;\r\n    const oldLink = aTag.href;\r\n    const oldTarget = aTag.target;\r\n    aTag.href = link;\r\n\r\n    // 3. If it's a new window, we must also set the target\r\n    if (target) aTag.target = target;\r\n            \r\n    // 4. After the click is run, we must clear the href again, so it doesn't open in the current window\r\n    setTimeout(() => {\r\n      if (debug) console.log('restoring old link', aTag, oldLink, oldTarget);\r\n      // note: we usually must removeAttribute, otherwise next-normal-clicks will not behave as expected\r\n      if (oldLink) aTag.href = oldLink; else aTag.removeAttribute('href');\r\n      if (oldTarget) aTag.target = oldTarget; else aTag.removeAttribute('target');\r\n    }, 100);\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { IDs } from '../../constants/ids';\r\n\r\nconst viewBoxAttribute = 'viewBox';\r\n\r\n// 2022-08-15 2dm experimental\r\n// must have a bunch of try-catch to prevent failure\r\n// This should handle special SVGs added do the page\r\n\r\nexport function monitorSvgIconsInToolbar() {\r\n  const observer = new MutationObserver((m) => {\r\n    // Once a change has been made, It's easiest to just find unprocessed SVGs in the document\r\n    // ...inside the svg-wrapper span\r\n    // const svgs = document.querySelectorAll(`${IDs.sel.scMenu} svg:not([${viewBoxAttribute}])`);\r\n    const svgs = document.querySelectorAll(`${IDs.sel.scMenu} svg:not([${viewBoxAttribute}])`);\r\n\r\n    // console.log('2dm svgs', svgs);\r\n    svgs.forEach((svg) => {\r\n      setSvgViewBox(svg);\r\n    });\r\n  });\r\n\r\n  observer.observe(document.body, {\r\n    attributes: false,\r\n    childList: true,\r\n    subtree: true,\r\n  });\r\n}\r\n\r\n\r\n\r\nfunction setSvgViewBox(svg: any)  {\r\n  // Skip if it already has a viewBox\r\n  const previous = svg.getAttribute(viewBoxAttribute);\r\n  if (previous) return;\r\n\r\n  // calculate max size of all elements in the SVG\r\n  const { xMin, xMax, yMin, yMax } = [...(svg).children].reduce((acc, el) => {\r\n    const { x, y, width, height } = el.getBBox();\r\n    if (!acc.xMin || x < acc.xMin) acc.xMin = x;\r\n    if (!acc.xMax || x + width > acc.xMax) acc.xMax = x + width;\r\n    if (!acc.yMin || y < acc.yMin) acc.yMin = y;\r\n    if (!acc.yMax || y + height > acc.yMax) acc.yMax = y + height;\r\n    return acc;\r\n  }, {});\r\n\r\n  const viewbox = `${xMin} ${yMin} ${xMax - xMin} ${yMax - yMin}`;\r\n\r\n  svg.setAttribute(viewBoxAttribute, viewbox);\r\n}\r\n\r\n","import { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { CommandNames, iconPrefix } from '../commands';\r\nimport { C } from '../constants';\r\nimport { HasLog, Insights, Log } from '../core';\r\nimport { EditManager } from '../manage/edit-manager';\r\nimport { NoJQ } from '../plumbing';\r\nimport { QuickDialog } from '../quick-dialog';\r\nimport * as QuickEditState from '../quick-dialog/state';\r\nimport { toolbarSelector } from '../toolbar';\r\nimport { monitorSvgIconsInToolbar } from '../toolbar/render/svg-icons';\r\nimport { TagToolbarManager } from '../toolbar/tag-toolbars/tag-toolbar-manager';\r\nimport { ToolbarManager } from '../toolbar/toolbar-manager';\r\nimport { DomTools } from '../../../$2sxc/src/dom/dom-tools';\r\n\r\n/**\r\n * This contains everything necessary to bootstrap the edit mode.\r\n * It must be initialized and started at the end in the x-bootstrap code,\r\n * to ensure everything is already ready and loaded\r\n * @internal\r\n */\r\nexport class BootstrapInPage extends HasLog {\r\n  constructor() {\r\n    super('Sys.Bootst', null, 'Building Bootstrapper');\r\n    Insights.add('system', 'bootstrap', this.log);\r\n  }\r\n\r\n  private initializedInstances: HTMLElement[] = [];\r\n  private openedTemplatePickerOnce: boolean = false;\r\n  private diagCancelStateOnStart: boolean = QuickEditState.cancelled.get();\r\n\r\n  // The bootstrapper code could be more optimized for multiple loads, \r\n  // but it was not feasible to do so at this time.\r\n  initialize() {\r\n    const callLog = this.log.call('initialize');\r\n    // reset cancelled state after one reload\r\n    if (this.diagCancelStateOnStart) QuickEditState.cancelled.remove();\r\n\r\n    // initialize all modules\r\n    this.initAllInstances(true);\r\n\r\n    // start observing the body for configured mutations\r\n    this.watchDomChanges();\r\n\r\n    // start watching the body for toolbar mutations (SVGs)\r\n    monitorSvgIconsInToolbar();\r\n    callLog.return('done');\r\n  }\r\n\r\n\r\n  /**\r\n   * Scan all instances and initialize them\r\n   * @param isFirstRun should be true only on the very initial call\r\n   */\r\n  private initAllInstances(isFirstRun: boolean): void {\r\n    const callLog = this.log.call('initAllInstances');\r\n\r\n    // initialize toolbars that are not inside 2sxc modules (e.g. in skin)\r\n    const noModuleToolbars = Array.from(document.querySelectorAll<HTMLElement>(toolbarSelector))\r\n      .filter((e) => !e.closest(C.Sel.SxcDivs));\r\n\r\n    this.log.add(`Found ${noModuleToolbars.length} toolbars outside of 2sxc modules`);\r\n    noModuleToolbars.forEach((e) => {\r\n      ToolbarManager.singleton().build(e);\r\n    });\r\n\r\n    // initialize toolbars inside 2sxc modules\r\n    const modToolbars = document.querySelectorAll<HTMLElement>(C.Sel.SxcDivs);\r\n    this.log.add(`Found ${modToolbars.length} toolbars inside 2sxc modules`);\r\n    modToolbars.forEach((e) => {\r\n      this.initInstance(e, isFirstRun);\r\n    });\r\n    if (isFirstRun) this.tryShowTemplatePicker();\r\n    callLog.return('initAllInstances done');\r\n  }\r\n\r\n  /**\r\n   * create an observer instance and start observing\r\n   */\r\n  private watchDomChanges() {\r\n    const callLog = this.log.call('watchDomChanges');\r\n    const observer = new MutationObserver((m) => {\r\n      // Watch statistics how changes were processed\r\n      window.$2sxc.stats.watchDomChanges++;\r\n      let processed = 0;\r\n\r\n      // Loop through each changed item, check if it's something we want to initialize\r\n      m.forEach((v) => {\r\n        v.addedNodes.forEach((n) => {\r\n          // remove #comment and text nodes\r\n          if ((n as HTMLElement).matches == null) return;\r\n          const node = n as HTMLElement;\r\n\r\n          // Menus which appear also cause DOM changes, but we want to ignore these for performance reasons\r\n          if (node.matches(C.IDs.cls.scMenu)) return;\r\n\r\n          processed++;\r\n\r\n          // If the added node is a [data-edit-context], it is either a module or a content block which was replaced\r\n          // re-initialize the module\r\n          if (node.matches(C.Sel.SxcDivs)) {\r\n            this.initInstance(node, false);\r\n            // in case it has inner content, try to open the picker-dialog\r\n            if (!QuickDialog.singleton().isVisible()) this.tryShowTemplatePicker();\r\n          }\r\n          // If the added node contains [data-edit-context] nodes, it is likely the DNN module drag manager which added\r\n          // the node. To prevent multiple initialization while dragging modules, we additionally check for the\r\n          // .active-module class which seems to be applied while dragging the module.\r\n          else if (node.matches(':not(.active-module)') && node.querySelectorAll<HTMLElement>(C.Sel.SxcDivs).length > 0) {\r\n            node.querySelectorAll<HTMLElement>(C.Sel.SxcDivs).forEach((e) => {\r\n              this.initInstance(e, false);\r\n            });\r\n          } else\r\n            ToolbarManager.singleton().build(node);\r\n        });\r\n      });\r\n\r\n      // Clean up orphan tags if nodes have been added\r\n      if (processed) TagToolbarManager.cleanupOrphanedToolbars();\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      attributes: false,\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n    callLog.return('watchDomChanges done');\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Show the template picker if\r\n   * - template picker has not yet been opened\r\n   * - dialog has not been cancelled\r\n   * - only one uninitialized module on page\r\n   * @returns\r\n   */\r\n  private tryShowTemplatePicker(): boolean {\r\n    const cl = this.log.call('tryShowTemplatePicker');\r\n    let sxc: Sxc;\r\n\r\n    // first check if we should show one according to the state-settings\r\n    const openDialogId = QuickEditState.cbId.get();\r\n    if (openDialogId) {\r\n      // must check if it's on this page, as it could be from another page\r\n      const found = document.querySelectorAll<HTMLElement>(`[${C.AttrNames.ContentBlockId}=\"${openDialogId}\"]`);\r\n      if (found.length) {\r\n        // since the CB-ID could also be an inner content (marked as a negative \"-\" number)\r\n        // we must be sure that we use the right id a.nyhow\r\n        if (openDialogId < 0) {\r\n          const instanceId = Number(found[0].attributes.getNamedItem(C.AttrNames.InstanceId).value);\r\n          sxc = window.$2sxc(instanceId, openDialogId);\r\n        } else sxc = window.$2sxc(openDialogId);\r\n      }\r\n    }\r\n\r\n    if (!sxc) {\r\n      const uninitializedModules = document.querySelectorAll<HTMLElement>(`.${C.ClsNames.UnInitialized}`);\r\n\r\n      if (this.diagCancelStateOnStart || this.openedTemplatePickerOnce)\r\n        return cl.return(false, 'cancelled');\r\n\r\n      // already showing a dialog\r\n      if (QuickDialog.singleton().isVisible())\r\n        return cl.return(false, 'should be invisible');\r\n\r\n      // not exactly one uninitialized module\r\n      if (uninitializedModules.length !== 1)\r\n        return cl.return(false, 'has un-init modules');\r\n\r\n      // show the template picker of this module\r\n      const module = Array.from(uninitializedModules).find((e) => e.parentElement.matches(C.Sel.SxcDivs))?.parentElement;\r\n      sxc = window.$2sxc(module);\r\n    }\r\n\r\n    if (sxc) {\r\n      (sxc.manage as EditManager).run(CommandNames.layout);\r\n      this.openedTemplatePickerOnce = true;\r\n    }\r\n    return cl.return(true, 'tryShowTemplatePicker() done');\r\n  }\r\n\r\n\r\n  private initInstance(module: HTMLElement, isFirstRun: boolean): void {\r\n    const cl = this.log.call('initInstance', `isFirstRun: ${isFirstRun}) initialized: ${this.initializedInstances} module: obj`, null, { module });\r\n\r\n    // if instance is already in the list of initialized modules, skip\r\n    // otherwise add for next time to prevent recursions\r\n    if (this.initializedInstances.find((m) => m === module)) return;\r\n    this.initializedInstances.push(module);\r\n\r\n    let sxc = window.$2sxc(module);\r\n\r\n    // check if the sxc must be re-created. This is necessary when modules are dynamically changed\r\n    // because the configuration may change, and that is cached otherwise, resulting in toolbars with wrong config\r\n    if (!isFirstRun) sxc = sxc.recreate(true) as Sxc;\r\n\r\n    // check if we must show the glasses\r\n    // this must always run because it can be added ajax-style\r\n    const wasEmpty = this.showGlassesButtonIfUninitialized(sxc);\r\n\r\n    if (isFirstRun || !wasEmpty) {\r\n      // use a logger for each iteration\r\n      const log = new Log('Bts.Module');\r\n\r\n      ToolbarManager.singleton().buildModule(module);\r\n    }\r\n    cl.done();\r\n  }\r\n\r\n\r\n  private showGlassesButtonIfUninitialized(sxci: Sxc): boolean {\r\n    const callLog = this.log.call('showGlassesButtonIfUninitialized', `sxci:`, null, { sxci });\r\n\r\n    // already initialized\r\n    if (this.isInitialized(sxci))\r\n      return callLog.return(false, 'is initialized');\r\n\r\n    // already has a glasses button\r\n    const tag = DomTools.getTag(sxci);\r\n    if (tag.querySelectorAll<HTMLElement>(`.${C.ClsNames.UnInitialized}`).length !== 0)\r\n      return callLog.return(false, 'already has button');\r\n\r\n    // note: title is added on mouseover, as the translation isn't ready at page-load\r\n    const btn = NoJQ.domFromString(\r\n      `<div class=\"${C.ClsNames.UnInitialized}\" onmouseover=\"this.title = $2sxc.translate(this.title)\" title=\"InPage.NewElement\">` +\r\n      `<div class=\"${iconPrefix}glasses\"></div>` +\r\n      '</div>',\r\n    )[0];\r\n\r\n    btn.addEventListener('click', () => (sxci.manage as EditManager).run(CommandNames.layout));\r\n\r\n    tag.append(btn);\r\n    return callLog.return(true, 'ok');\r\n  }\r\n\r\n  /**\r\n   * Determines whether the Sxc instance is properly initialized.\r\n   * This method checks if the app is ready for use, considering special cases\r\n   * where the app may be rendered within a skin or affected by this inpage JavaScript\r\n   * assets loaded by other apps.\r\n   *\r\n   * @param sxcInstance - The Sxc instance to check for initialization.\r\n   * @returns True if the app is initialized; otherwise, false.\r\n   */\r\n  isInitialized(sxcInstance: Sxc): boolean {\r\n    const editManager = sxcInstance?.manage as EditManager;\r\n    const editContext = editManager?.editContext;\r\n    const contentBlock = editContext?.contentBlock;\r\n\r\n    // Special handling for apps rendered within a skin using IRenderService.\r\n    // In such cases, when the app is not editable, it still receives a 'data-edit-context' attribute\r\n    // that contains only the 'jsApi' node (without the 'contentBlock' node).\r\n    // If another app on the page (in edit mode) loads this inpage JavaScript assets,\r\n    // a bug causes the template picker to appear for this app even though it is in view mode\r\n    // and lacks most of the editContext nodes except 'jsApi'.\r\n    // Refer to issue 2sic/2sic#3380 for more details.\r\n    const isAppInSkin = !contentBlock && editContext?.jsApi != null;\r\n\r\n    // Check if the content block exists and has a valid template ID.\r\n    const hasValidTemplate = contentBlock && contentBlock.TemplateId !== 0;\r\n\r\n    return hasValidTemplate || isAppInSkin;\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { ContextIdentifier } from '../../../$2sxc/src/sxc-global/context-identifier';\r\nimport { RunParamsWithContext, RunParamsWithContextClean } from '../../../$2sxc/src/cms/run-params';\r\nimport { CommandParams } from '../../../$2sxc/src/cms/command-params';\r\nimport { CmsEngine } from '../commands';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { ContextBundleInstance } from '../context/bundles/context-bundle-instance';\r\nimport { HasLog, Insights, Log } from '../core';\r\nimport { RunParamsHelpers } from './run-params-helpers';\r\n\r\nconst logId = 'Cms.Api';\r\n\r\n/**\r\n * Global Content-Management System on the $2sxc.cms.\r\n *\r\n * It is only available if the page is in edit mode / the page feature `2sxc.JsCms` has been activated.\r\n * @public\r\n */\r\n// Note that it can be used standalone, not just on $2sxc, as it doesn't directly rely on that.\r\nexport class SxcGlobalCms extends HasLog {\r\n  /**\r\n   * @internal\r\n   */\r\n  autoDump = C.Debug.cms.autoDump;\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  constructor() {\r\n    super(logId, null);\r\n  }\r\n\r\n  /**\r\n   * reset / clear the log\r\n   * @internal\r\n   */\r\n  resetLog() {\r\n    this.log = new Log(logId, null, 'log was reset');\r\n    Insights.add('cms', 'run', this.log);\r\n  }\r\n\r\n\r\n  /**\r\n   * Run a command within a specific context - mostly for internal use.\r\n   * @param runParams The complete run params with a context\r\n   * @returns A promise which triggers when the command has completed.\r\n   */\r\n  run<T>(runParams: RunParamsWithContext): Promise<void | T>;\r\n\r\n\r\n  /**\r\n   * Run a command within a specific context.\r\n   * @param tag The context providing tag - an HTML tag inside a module/content-block\r\n   * @param action command-name (action)\r\n   * @param event Optional mouse-event which allows the command to do some optimizations for that case - like a mouse-click\r\n   * @returns A promise which triggers when the command has completed.\r\n   */\r\n  run<T>(tag: HTMLElement, action: string, event?: MouseEvent): Promise<void | T>;\r\n\r\n  /**\r\n   * Run a command within a specific context.\r\n   * @param tag The context providing tag - an HTML tag inside a module/content-block\r\n   * @param action command-name (action)\r\n   * @param params an object containing the the command-params\r\n   * @param event Optional mouse-event which allows the command to do some optimizations for that case - like a mouse-click\r\n   * @returns A promise which triggers when the command has completed.\r\n   */\r\n  run<T>(tag: HTMLElement, action: string, params?: CommandParams, event?: MouseEvent): Promise<void | T>;\r\n\r\n  /**\r\n   * Run a command within a specific context.\r\n   * @param tag The context providing tag - an HTML tag inside a module/content-block\r\n   * @param commandParams an object containing the the command-params as well as the command-name (action)\r\n   * @param event Optional mouse-event which allows the command to do some optimizations for that case - like a mouse-click\r\n   * @returns A promise which triggers when the command has completed.\r\n   */\r\n  run<T>(tag: HTMLElement, commandParams: CommandParams, event?: MouseEvent): Promise<void | T>;\r\n\r\n  /**\r\n   * Run - full signature, internal use, not publicly documented; only included because docs-generator needs it.\r\n   * Please use other signatures with more specific parameter types\r\n   */\r\n  run<T>(\r\n    context: HTMLElement | RunParamsWithContext,\r\n    nameOrSettings?: string | CommandParams,\r\n    eventOrSettings?: CommandParams | MouseEvent,\r\n    event?: MouseEvent,\r\n  ): Promise<void | T> {\r\n    return this.runInternal(context, nameOrSettings, eventOrSettings, event, \"sxcGlobalCms.run\");\r\n  }\r\n\r\n  /**\r\n   * Run a command within a specific context.\r\n   * @param context The context - either an HTML tag which determines a module/instance, or an Sxc instance\r\n   * @param nameOrSettings\r\n   * @param eventOrSettings\r\n   * @param event Optional mouse-event which allows the command to do some optimizations for that case - like a mouse-click\r\n   * @returns A promise which triggers when the command has completed.\r\n   * @internal\r\n   */\r\n  runInternal<T>(\r\n    context: ContextBundleInstance | HTMLElement | RunParamsWithContext,\r\n    nameOrSettings?: string | CommandParams,\r\n    eventOrSettings?: CommandParams | MouseEvent,\r\n    event?: MouseEvent,\r\n    triggeredBy?: string,\r\n  ): Promise<void | T> {\r\n    const cl = this.log.call('run<T>2', `triggeredBy: ${triggeredBy}`);\r\n\r\n    const cmsEngine = new CmsEngine(this.log);\r\n\r\n    // Figure out inner-call based on if context is new RunParams or not (in that case it should be a tag or a full context)\r\n    // normally this shouldn't even get here, but older code was like this, so we keep it for now 2025-07 v20\r\n    if (RunParamsHelpers.is$sxcRunParams(context)) {\r\n      // V1 which has RunParamsWithContext all in the first parameter\r\n      const contextGiver = ContextIdentifier.is(context.context) || Sxc.is(context.context)\r\n        ? window.$2sxc(context.context)\r\n        : window.$2sxc(context.tag);\r\n      const contextClean = { ...context, context: contextGiver } satisfies RunParamsWithContextClean;\r\n      return this.runClean<T>(contextClean);\r\n    }\r\n    \r\n    const realCtx = ContextBundleInstance.is(context)\r\n      ? context\r\n      : ContextComplete.expandContext(context);\r\n\r\n    const innerCall: () => Promise<void> = () => cmsEngine.detectParamsAndRun(realCtx, nameOrSettings, eventOrSettings, event);\r\n\r\n    const result: Promise<void | T> = this.do(innerCall);\r\n    return cl.return(result, 'ok');\r\n  }\r\n\r\n  /**\r\n   * Run a command within a specific context.\r\n   * @param runParamsWithCtx The context - either an HTML tag which determines a module/instance, or an Sxc instance\r\n   * @returns A promise which triggers when the command has completed.\r\n   * @internal\r\n   */\r\n  runClean<T>(runParamsWithCtx: RunParamsWithContextClean): Promise<void | T> {\r\n    const cl = this.log.call('runClean<T>', `triggeredBy: ${runParamsWithCtx.triggeredBy}`);\r\n\r\n    // Figure out inner-call based on if context is new RunParams or not (in that case it should be a tag or a full context)\r\n    const ctxComplete = ContextComplete.expandContext(runParamsWithCtx.context);\r\n    runParamsWithCtx.params = {\r\n      action: runParamsWithCtx.action,\r\n      ...runParamsWithCtx.params,\r\n    } satisfies CommandParams;\r\n\r\n    const innerCall: () => Promise<void> = () => new CmsEngine(this.log)\r\n      .run(ctxComplete, runParamsWithCtx.params, runParamsWithCtx.event, runParamsWithCtx, `${runParamsWithCtx.triggeredBy} - sxcGlobalCms.runInternal`);\r\n\r\n    const result: Promise<void | T> = this.do(innerCall);\r\n    return cl.return(result, 'ok');\r\n  }\r\n\r\n\r\n  /**\r\n   * reset/clear the log if alwaysResetLog is true\r\n   * @internal\r\n   */\r\n  private do<T>(innerCall: () => Promise<T>): Promise<T> {\r\n    const cl = this.log.call('do');\r\n    this.resetLog();\r\n    const result = innerCall();\r\n    if (this.autoDump) this.log.dump();\r\n    return cl.return(result);\r\n  }\r\n}\r\n","import { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { RunParams, RunParamsWithContextClean } from '../../../$2sxc/src/cms/run-params';\r\nimport { SxcCms } from '../../../$2sxc/src/sxc/sxc-cms';\r\nimport { RunParamsHelpers } from '../cms/run-params-helpers';\r\nimport { SxcGlobalCms } from '../cms/sxc-global-cms';\r\n\r\n/**\r\n * This is in charge of sxc.cms on the instance level.\r\n * ATM it just has the run command.\r\n * In future, it may also have dedicated command like `layout` etc.\r\n * @internal\r\n */\r\nexport class SxcCmsReal extends SxcCms {\r\n\r\n  /** @internal */\r\n  constructor(sxc: Sxc) {\r\n    super(sxc);\r\n  }\r\n\r\n  /**\r\n   * Run a command on this sxc-instance.\r\n   * Requires edit mode to be on, which would enable the edit-JS parts.\r\n   * To use, remember to activate `2sxc.JsCms` on the page\r\n   * @param runParams - real type is actually RunParams\r\n   */\r\n  run<T>(runParams: RunParams): Promise<void | T> {\r\n    RunParamsHelpers.ensureRunParamsInstanceOrError(runParams);\r\n    return new SxcGlobalCms().runClean({ ...runParams, context: this.sxc, triggeredBy: 'sxcCmsReal.run' } satisfies RunParamsWithContextClean);\r\n  }\r\n}\r\n","import { SxcManage } from '../../../$2sxc/src/sxc/sxc-manage';\r\nimport { RunParamsWithContext } from '../../../$2sxc/src/cms/run-params';\r\nimport { SxcGlobalCms } from '../cms/sxc-global-cms';\r\nimport { CommandParams } from '../commands';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { AttrJsonEditContext } from '../context/html-attribute/edit-context-root';\r\nimport { HasLog, Log } from '../plumbing';\r\nimport { InPageToolbarConfigVariations, ToolbarInitConfig, ToolbarManager } from '../toolbar';\r\nimport { ToolbarSettings } from '../toolbar/config';\r\nimport { InPageButtonJson } from '../toolbar/config-loaders';\r\nimport { ToolbarRenderer } from '../toolbar/render/toolbar-renderer';\r\n\r\n/**\r\n * Instance specific edit manager\r\n * @internal\r\n */\r\nexport class EditManager extends HasLog implements SxcManage {\r\n\r\n    constructor(\r\n        public editContext: AttrJsonEditContext,\r\n        public context: ContextComplete,\r\n        parentLog?: Log\r\n    ) {\r\n        super('Edit.Mng', parentLog, 'start');\r\n    }\r\n\r\n    //#region Official, public properties and commands, which are stable for use from the outside\r\n\r\n    /**\r\n     * run a command - command used in toolbars and custom buttons\r\n     * it is publicly used out of inpage, so take a care to preserve function signature\r\n     */\r\n    run<T>(\r\n      nameOrSettings: string | CommandParams,\r\n      eventOrSettings?: CommandParams | MouseEvent,\r\n      event?: MouseEvent,\r\n      triggeredBy?: string,\r\n    ): Promise<void | T> {\r\n      const cl = this.log.call('run<T>', `triggeredBy: ${triggeredBy}`);\r\n      // Capture cases where this is called using the new/modern params, which is a mistake\r\n      if ((nameOrSettings as RunParamsWithContext).context || (nameOrSettings as RunParamsWithContext).workflows)\r\n        throw \"You are calling '.manage.run(...)' with a parameter 'context' or workflows. You should probably be calling the new '.cms.run(...)' instead.\";\r\n      const cntx = ContextComplete.expandContext(this.context.sxc);\r\n      cl.done();\r\n      return new SxcGlobalCms().runInternal(cntx, nameOrSettings, eventOrSettings, event, 'editManager.run');\r\n    }\r\n    /**\r\n     * Generate a button (an <a>-tag) for one specific toolbar-action.\r\n     * @param {InPageButtonJson} actDef - settings, an object containing the spec for the expected button\r\n     * @param {int} groupIndex - number what button-group it's in'\r\n     * @returns {string} html of a button\r\n     * it is publicly used out of inpage, so take a care to preserve function signature\r\n     */\r\n    getButton(actDef: InPageButtonJson, groupIndex: number): string {\r\n        this.context.button = ToolbarManager.singleton().getLoader('getButton')\r\n            .groups.convertToButton(actDef, {}, {}, {});\r\n        const button = new ToolbarRenderer(this.context).button.render(this.context, groupIndex);\r\n        return button.outerHTML;\r\n    }\r\n\r\n    /**\r\n     * Builds the toolbar and returns it as HTML\r\n     * @param {Object} tbConfig - general toolbar config\r\n     * @param {ToolbarSettings} moreSettings - additional / override settings\r\n     * @returns {string} html of the current toolbar\r\n     *\r\n     * it is publicly used in Razor scripts of inpage, so take a care to preserve function signature\r\n     */\r\n    getToolbar(tbConfig: ToolbarInitConfig | InPageToolbarConfigVariations, moreSettings: ToolbarSettings): string {\r\n        // if toolbar is an array, use as-is, otherwise assume properties are params\r\n        const toolbar = Array.isArray(tbConfig) ? tbConfig : { ...tbConfig };\r\n        const typedConfig = {\r\n          settings: { ...(tbConfig as ToolbarInitConfig).settings, ...moreSettings },\r\n          toolbar: toolbar as InPageToolbarConfigVariations,\r\n        } satisfies ToolbarInitConfig;\r\n        const toolbarConfig = ToolbarManager.singleton().loadConfig(this.context, typedConfig);\r\n        this.context.toolbar = toolbarConfig;\r\n        return new ToolbarRenderer(this.context).render();\r\n    }\r\n\r\n    //#endregion official, public properties - everything below this can change\r\n\r\n    /**\r\n     * internal method to find out if it's in edit-mode\r\n     */\r\n    _isEditMode = () => this.editContext.Environment.IsEditable ?? false;\r\n\r\n    /**\r\n     * change config by replacing the guid, and refreshing dependent sub-objects\r\n     */\r\n    _updateContentGroupGuid(context: ContextComplete, newGuid: string) {\r\n        context.contentBlock.contentGroupId = newGuid;\r\n        this.editContext.contentBlock.Guid = newGuid;\r\n    }\r\n\r\n}\r\n","import { NoJQ } from '../plumbing';\r\nimport { TlbShowPrefix } from './config';\r\n\r\n// tslint:disable-next-line: no-var-requires\r\nconst Shake = require('shake.js');\r\n// ReSharper disable once InconsistentNaming\r\n// enable shake detection on all toolbars\r\nNoJQ.ready(() => {\r\n  // this will add a css-class to auto-show all toolbars (or remove it again)\r\n  function toggleAllToolbars() {\r\n    document.body.classList.toggle(`${TlbShowPrefix}all`);\r\n  }\r\n\r\n  // debugger; // shake is not working, neither on ios nor android. Might be because of http and might work with https\r\n  const shake = new Shake({ callback: toggleAllToolbars });\r\n  // start shake-event monitoring, which will then generate a window-event\r\n  shake.start();\r\n});\r\n","import { SxcGlobal } from '../../$2sxc/src/sxc-global/sxc-global';\r\nimport { BootstrapInPage } from './bootstrap/bootstrap';\r\nimport { SxcGlobalCms } from './cms/sxc-global-cms';\r\nimport { ContextComplete } from './context/bundles/context-bundle-button';\r\nimport { translate, Translator } from './i18n';\r\nimport { EditManager } from './manage/edit-manager';\r\nimport { SxcGlobalManage } from './manage/sxc-global-manage';\r\nimport { NoJQ } from './plumbing';\r\nimport { QuickE } from './quick-edit/quick-e';\r\nimport { SxcGlobalWithCms } from './sxc/sxc-global-with-cms';\r\nimport { SystemUpgrader } from './system';\r\n\r\n// Exports for Docs\r\nexport * from './commands';\r\nexport * from './cms';\r\nexport * from './quick-edit';\r\nexport * from './sxc';\r\nexport * from './workflow';\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nimport './toolbar/toolbar-global-enable-shake';\r\n\r\n// #1 Note that $2sxc must always exist, the server ensures the load order\r\nconst $2sxc = window.$2sxc as SxcGlobal & SxcGlobalWithCms;\r\nconst wasLoaded = !!$2sxc._manage; // for Oqtane\r\n\r\n// #2 Now attach initialization helpers and global objects, so that $2sxc always has these\r\n$2sxc.context ??= ContextComplete.expandContext; // primary API to get the context\r\n$2sxc._translateInit ??= (manage: EditManager) => Translator.initManager(manage); // reference in ./2sxc-api/js/ToSic.Sxc.Instance.ts\r\n$2sxc.translate ??= translate; // provide an official translate API for 2sxc\r\n$2sxc._manage ??= new SxcGlobalManage(); // used out of this project in ToSic.Sxc.Instance and 2sxc.api.js\r\n$2sxc.cms ??= new SxcGlobalCms();\r\n$2sxc.system ??= new SystemUpgrader(); // this enhances the $2sxc client controller with stuff only needed when logged in\r\nwindow.$quickE ??= QuickE.singleton(); // store QuickE as global object so it can be reused in case of multiple loads of inpage script\r\n\r\n// #3 Initialize all objects as needed\r\n// before calling check if already initialized, just in case these scripts were loaded multiple times\r\nfunction loadInpage() {\r\n  // The bootstrapper code could be more optimized for multiple loads, \r\n  // but it was not feasible to do so at this time. \r\n  const bootstrapper = new BootstrapInPage();\r\n  bootstrapper.initialize();\r\n  QuickE.singleton().start();\r\n}\r\n\r\n// For Oqtane, we shouldn't reinitialize inpage if the script is loaded more than once.\r\nif (!wasLoaded)\r\n  NoJQ.ready(loadInpage); // Initialize all on first load, first script\r\nelse\r\n  NoJQ.ready(() => window.$quickE.start()); // Just start quickE\r\n\r\n// Apply Dnn Bugfixes\r\nimport './dnn/index';\r\n\r\nimport './styles/index.scss';\r\nimport { Debug } from './constants/debug';\r\n\r\n// TODO: @2dm - this doesn't quite work - only in $2sxc / core but not in the inpage\r\n// probably because it seems to have a duplicate copy of the $2sxc code...\r\n// Debug.log('2sxc inpage - dev mode!');","import { Sxc } from '../../../$2sxc/src/sxc/sxc';\r\nimport { SxcGlobalManage as ISxcGlobalManage } from '../../../$2sxc/src/sxc-global/sxc-global-manage';\r\nimport { ContextComplete } from '../context';\r\nimport { SxcCmsReal } from '../sxc/sxc-cms-real';\r\nimport { SxcTools } from '../sxc/sxc-tools';\r\nimport { ToolbarManager } from '../toolbar';\r\nimport { EditManager } from './edit-manager';\r\n\r\n/**\r\n * A helper-controller in charge of opening edit-dialogues + creating the toolbars for it\r\n * all in-page toolbars etc.\r\n * if loaded, it's found under the $2sxc(module).manage\r\n * it has commands to\r\n * - getButton\r\n * - getToolbar\r\n * - run(...)\r\n * - isEditMode\r\n * @internal\r\n */\r\nexport class SxcGlobalManage implements ISxcGlobalManage {\r\n  /**\r\n   * Init the manage-object on a just-created sxc-instance\r\n   * we must keep signature of initInstance in sync with the 2sxc.api.js\r\n   * @param sxc\r\n   */\r\n  initInstance(sxc: Sxc) {\r\n    try {\r\n      const myContext = ContextComplete.expandContext(sxc);\r\n      const editContext = SxcTools.getEditContext(sxc);\r\n\r\n      sxc.manage = new EditManager(editContext, myContext);\r\n\r\n      // add code for the cms.run command, which doesn't exist until editing is enabled\r\n      sxc.cms = new SxcCmsReal(sxc);\r\n    } catch (e) {\r\n      console.error('error in 2sxc - will log but not throw', e);\r\n    }\r\n  }\r\n\r\n  /** Internal - ATM only used in dnn-sxc-angular to enable toolbar initialization */\r\n  _toolbarManager = ToolbarManager.singleton();\r\n}\r\n","\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiInstallComplete = 'sys/install/resume';\r\n//#endregion\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class SystemUpgrader {\r\n    // upgrade command - started when an error contains a link to start this\r\n    finishUpgrade(domElement: HTMLElement): void {\r\n        const mc = window.$2sxc(domElement);\r\n        mc.webApi.fetchRaw(webApiInstallComplete)\r\n            .then(() => {\r\n                alert('Upgrade ok, restarting the CMS and reloading...');\r\n                location.reload();\r\n            });\r\n        alert('starting upgrade. This could take a few minutes. You\\'ll see an \\'ok\\' when it\\'s done. Please wait...');\r\n    }\r\n}\r\n"],"names":["leafPrototypes","getProto","global","self","this","__self__","F","fetch","DOMException","prototype","exports","support","Symbol","Blob","e","viewClasses","isArrayBufferView","ArrayBuffer","isView","obj","indexOf","Object","toString","call","normalizeName","name","String","test","TypeError","toLowerCase","normalizeValue","value","iteratorFor","items","iterator","next","shift","done","undefined","Headers","headers","map","forEach","append","Array","isArray","header","getOwnPropertyNames","consumed","body","bodyUsed","Promise","reject","fileReaderReady","reader","resolve","onload","result","onerror","error","readBlobAsArrayBuffer","blob","FileReader","promise","readAsArrayBuffer","bufferClone","buf","slice","view","Uint8Array","byteLength","set","buffer","Body","_initBody","_bodyInit","_bodyText","isPrototypeOf","_bodyBlob","FormData","_bodyFormData","URLSearchParams","DataView","_bodyArrayBuffer","get","type","rejected","Error","arrayBuffer","then","text","readAsText","chars","length","i","fromCharCode","join","readArrayBufferAsText","formData","decode","json","JSON","parse","oldValue","has","hasOwnProperty","callback","thisArg","keys","push","values","entries","methods","Request","input","options","method","upcased","url","credentials","mode","signal","toUpperCase","referrer","form","trim","split","bytes","replace","decodeURIComponent","Response","bodyInit","status","ok","statusText","clone","response","redirectStatuses","redirect","RangeError","location","err","message","stack","create","constructor","init","request","aborted","xhr","XMLHttpRequest","abortXhr","abort","rawHeaders","getAllResponseHeaders","line","parts","key","responseURL","responseText","ontimeout","onabort","open","withCredentials","responseType","setRequestHeader","addEventListener","onreadystatechange","readyState","removeEventListener","send","polyfill","defineProperty","ponyfill","ctx","module","_extends","assign","target","arguments","source","defaults","selectorAttr","targetAttr","optionsAttr","useOptionsAttr","parseDefaultValueFromContent","document","i18next","extendDefault","o","val","defaultValue","elem","opts","attr","substr","innerHTML","t","textContent","startIdx","endIdx","substring","_startIdx","_endIdx","dataAttr","translated","getAttribute","setAttribute","relaxedJsonParse","badJSON","match","p1","_loc","targetSelector","querySelector","ix","l_ix","lng","stringify","handle","selector","elems","querySelectorAll","childs","j","factory","window","Shake","hasDeviceMotion","threshold","timeout","lastTime","Date","lastX","lastY","lastZ","CustomEvent","event","bubbles","cancelable","createEvent","initEvent","reset","start","stop","devicemotion","deltaX","deltaY","deltaZ","current","accelerationIncludingGravity","x","y","z","Math","abs","getTime","dispatchEvent","handleEvent","$","fn","apply","search","fetchApi","g","f","default","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","getPrototypeOf","ns","r","def","definition","enumerable","globalThis","Function","prop","toStringTag","getWindow","node","ownerDocument","defaultView","isElement","Element","isHTMLElement","HTMLElement","isShadowRoot","ShadowRoot","max","min","round","getUAString","uaData","navigator","userAgentData","brands","item","brand","version","userAgent","isLayoutViewport","getBoundingClientRect","element","includeScale","isFixedStrategy","clientRect","scaleX","scaleY","offsetWidth","width","offsetHeight","height","visualViewport","addVisualOffsets","left","offsetLeft","top","offsetTop","right","bottom","getWindowScroll","win","scrollLeft","pageXOffset","scrollTop","pageYOffset","getNodeName","nodeName","getDocumentElement","documentElement","getWindowScrollBarX","getComputedStyle","isScrollParent","_getComputedStyle","overflow","overflowX","overflowY","getCompositeRect","elementOrVirtualElement","offsetParent","isFixed","isOffsetParentAnElement","offsetParentIsScaled","rect","isElementScaled","scroll","offsets","clientLeft","clientTop","getLayoutRect","getParentNode","assignedSlot","parentNode","host","getScrollParent","listScrollParents","list","_element$ownerDocumen","scrollParent","isBody","concat","updatedList","isTableElement","getTrueOffsetParent","position","getOffsetParent","isFirefox","currentNode","css","transform","perspective","contain","willChange","filter","getContainingBlock","auto","basePlacements","end","viewport","popper","variationPlacements","reduce","acc","placement","modifierPhases","order","modifiers","Map","visited","Set","sort","modifier","add","requires","requiresIfExists","dep","depModifier","DEFAULT_OPTIONS","strategy","areValidElements","_len","args","_key","some","popperGenerator","generatorOptions","_generatorOptions","_generatorOptions$def","defaultModifiers","_generatorOptions$def2","defaultOptions","reference","pending","state","orderedModifiers","modifiersData","elements","attributes","styles","effectCleanupFns","isDestroyed","instance","setOptions","setOptionsAction","cleanupModifierEffects","scrollParents","contextElement","merged","phase","orderModifiers","existing","data","m","enabled","_ref3","_ref3$options","effect","cleanupFn","update","forceUpdate","_state$elements","rects","index","_state$orderedModifie","_state$orderedModifie2","_options","destroy","onFirstUpdate","passive","_ref","_options$scroll","_options$resize","resize","getBasePlacement","getVariation","getMainAxisFromPlacement","computeOffsets","basePlacement","variation","commonX","commonY","mainAxis","len","unsetSides","mapToStyles","_ref2","_Object$assign2","popperRect","gpuAcceleration","adaptive","roundOffsets","_offsets$x","_offsets$y","hasX","hasY","sideX","sideY","heightProp","widthProp","_Object$assign","commonStyles","_ref4","dpr","devicePixelRatio","roundOffsetsByDPR","style","removeAttribute","initialStyles","margin","arrow","property","attribute","hash","getOppositePlacement","matched","getOppositeVariationPlacement","contains","parent","child","rootNode","getRootNode","isSameNode","rectToClientRect","getClientRectFromMixedType","clippingParent","html","clientWidth","clientHeight","layoutViewport","getViewportRect","getInnerBoundingClientRect","winScroll","scrollWidth","scrollHeight","direction","getDocumentRect","mergePaddingObject","paddingObject","expandToHashMap","hashMap","detectOverflow","_options$placement","_options$strategy","_options$boundary","boundary","_options$rootBoundary","rootBoundary","_options$elementConte","elementContext","_options$altBoundary","altBoundary","_options$padding","padding","altContext","clippingClientRect","mainClippingParents","clippingParents","clipperElement","getClippingParents","firstClippingParent","clippingRect","accRect","getClippingRect","referenceClientRect","popperOffsets","popperClientRect","elementClientRect","overflowOffsets","offsetData","offset","multiply","axis","within","getSideOffsets","preventedOffsets","isAnySideFullyClipped","side","eventListeners","_ref5","_options$gpuAccelerat","_options$adaptive","_options$roundOffsets","_options$offset","invertDistance","skidding","distance","distanceAndSkiddingToXY","_data$state$placement","_skip","_options$mainAxis","checkMainAxis","_options$altAxis","altAxis","checkAltAxis","specifiedFallbackPlacements","fallbackPlacements","_options$flipVariatio","flipVariations","allowedAutoPlacements","preferredPlacement","oppositePlacement","getExpandedFallbackPlacements","placements","_options$allowedAutoP","allowedPlacements","overflows","b","computeAutoPlacement","referenceRect","checksMap","makeFallbackChecks","firstFittingPlacement","_basePlacement","isStartVariation","isVertical","mainVariationSide","altVariationSide","checks","every","check","_loop","_i","fittingPlacement","find","_options$tether","tether","_options$tetherOffset","tetherOffset","isBasePlacement","tetherOffsetValue","normalizedTetherOffsetValue","offsetModifierState","_offsetModifierState$","mainSide","altSide","additive","minLen","maxLen","arrowElement","arrowRect","arrowPaddingObject","arrowPaddingMin","arrowPaddingMax","arrowLen","minOffset","maxOffset","arrowOffsetParent","clientOffset","offsetModifierValue","tetherMax","preventedOffset","_offsetModifierState$2","_mainSide","_altSide","_offset","_min","_max","isOriginSide","_offsetModifierValue","_tetherMin","_tetherMax","_preventedOffset","v","withinMaxClamp","_state$modifiersData$","toPaddingObject","minProp","maxProp","endDiff","startDiff","clientSize","centerToReference","center","axisProp","centerOffset","_options$element","preventOverflow","referenceOverflow","popperAltOverflow","referenceClippingOffsets","popperEscapeOffsets","isReferenceHidden","hasPopperEscaped","CONTENT_CLASS","ARROW_CLASS","SVG_ARROW_CLASS","TOUCH_OPTIONS","capture","TIPPY_DEFAULT_APPEND_TO","getValueAtIndexOrReturn","isType","str","invokeWithArgsOrReturn","ms","arg","clearTimeout","setTimeout","normalizeToArray","pushIfUnique","arr","arrayFrom","removeUndefinedProps","div","createElement","setTransitionDuration","els","el","transitionDuration","setVisibilityState","updateTransitionEndListener","box","action","listener","actualContains","_target$getRootNode","currentInput","isTouch","lastMouseMoveTime","onDocumentTouchStart","performance","onDocumentMouseMove","now","onWindowBlur","activeElement","_tippy","blur","isVisible","isIE11","msCrypto","defaultProps","appendTo","aria","content","expanded","delay","duration","getReferenceClientRect","hideOnClick","ignoreAttributes","interactive","interactiveBorder","interactiveDebounce","moveTransition","onAfterUpdate","onBeforeUpdate","onCreate","onDestroy","onHidden","onHide","onMount","onShow","onShown","onTrigger","onUntrigger","onClickOutside","plugins","popperOptions","render","showOnCreate","touch","trigger","triggerTarget","animateFill","followCursor","inlinePositioning","sticky","allowHTML","animation","inertia","maxWidth","role","theme","zIndex","defaultKeys","getExtendedPassedProps","passedProps","pluginProps","plugin","_name","evaluateProps","props","out","valueAsString","getDataAttributeProps","dangerouslySetInnerHTML","createArrowElement","className","appendChild","setContent","getChildren","firstElementChild","boxChildren","children","classList","backdrop","onUpdate","prevProps","nextProps","_getChildren","removeChild","$$tippy","idCounter","mouseMoveListeners","mountedInstances","createTippy","showTimeout","hideTimeout","scheduleHideAnimationFrame","lastTriggerEvent","currentTransitionEndListener","currentTarget","isVisibleFromClick","didHideDueToDocumentMouseDown","didTouchMove","ignoreOnFirstUpdate","listeners","debouncedOnMouseMove","onMouseMove","id","unique","popperInstance","isEnabled","isMounted","isShown","clearDelayTimeouts","cancelAnimationFrame","setProps","partialProps","invokeHook","removeListeners","addListeners","cleanupInteractiveMouseListeners","handleAriaExpandedAttribute","handleStyles","createPopperInstance","getNestedPopperTree","nestedPopper","requestAnimationFrame","show","isAlreadyVisible","isDisabled","isTouchAndTouchDisabled","getCurrentTarget","hasAttribute","getIsDefaultRenderFn","visibility","addDocumentPress","transition","_getDefaultTemplateCh2","getDefaultTemplateChildren","_instance$popperInsta2","_getDefaultTemplateCh3","_box","_content","handleAriaContentAttribute","onTransitionEnd","onTransitionedIn","hide","isAlreadyHidden","removeDocumentPress","_getDefaultTemplateCh4","onTransitionedOut","unmount","hideWithInteractivity","getDocument","enable","disable","destroyPopperInstance","_props$render","pluginsHooks","hasAriaExpanded","scheduleShow","getNormalizedTouchSettings","getIsCustomTouchBehavior","_instance$props$rende","getDelay","isShow","fromHide","pointerEvents","hook","shouldInvokePropsHook","_instance$props","pluginHooks","currentValue","nextValue","onDocumentPress","actualTarget","composedPath","onTouchMove","onTouchStart","doc","on","eventType","handler","onMouseLeave","Boolean","onBlurOrFocusOut","_lastTriggerEvent","shouldScheduleClickHide","isEventListenerStopped","wasFocused","scheduleHide","isCursorOverReferenceOrPopper","popperTreeData","_instance$popperInsta","popperState","clientX","clientY","topDistance","bottomDistance","leftDistance","rightDistance","exceedsTop","exceedsBottom","exceedsLeft","exceedsRight","isCursorOutsideInteractiveBorder","relatedTarget","_instance$props2","computedReference","_getNormalizedTouchSe","touchValue","touchDelay","tippy","targets","optionalProps","instances","isNodeList","setDefaultProps","ToSxcName","SxcVersion","ApiUrlRoots","Attributes","InstanceId","Context","ContentBlockId","C","Sel","SxcDivs","LogEntryOptions","HasLog","log","logName","parentLog","initialMessage","initLogInternal","initLog","rename","linkLog","Log","QuickEClipboardLogId","Debug","isDevBuild","cms","autoDump","run","console","commandInfo","ToolbarConfigLoaderV10","RuleManager","CommandTippy","keepData","depth","callDepths","startTime","maxEntries","shouldDebug","liveDump","_parentHasLiveDump","_parentHasKeepData","fullIdentifier","identifier","dot","scope","rest","_prepareMessage","_addEntry","_prepareEntry","entry","addData","logData","msg","time","LogEntry","callParams","LogCall","_callDepthAdd","_callDepthRemove","last","pop","warn","dump","one","separator","dumpOne","dumpList","repeat","randomString","stringLength","randomstring","rnum","floor","random","idCache","initialEntry","lastMessage","behavior","processExtraBehavior","onlyAddIfNew","return","Obj","static","original","ignoreCircular","getCircularReplacer","seen","WeakSet","_","_data","DeepClone","InsightsLogSet","logs","singleton","$2sxc","_insights","super","history","setName","partName","p","part","count","logNames","s","logSet","autoLimit","Insights","flattenSlashes","AssetsLoader","scripts","script","others","copy","from","nodeValue","src","head","runScripts","NoJQ","once","k","encodeURIComponent","string","dummyParent","insertAdjacentHTML","brokenScript","workingScript","replaceWith","scrollY","scrollX","computedStyle","parseInt","getPropertyValue","childNodes","toBeReplaced","newElement","parentElement","restores","replaceChild","restore","newElements","tagName","toLocaleLowerCase","restoreType","DnnUiRoot","AntiForgeryTokenHeaderNameDnn","helpAutoDetect","EnvironmentDnnSfLoader","env","dnnSfFallback","cl","ready","dnnSfLoadWhenDocumentReady","sf","ServicesFramework","dnnSf","apiRoot","getServiceRoot","sfJsInfo","page","getTabId","root","api","appApi","rvtHeader","rvt","getAntiForgeryValue","uiRoot","platform","load","SelectorInputRvt","EnvironmentLoaderDynamic","mainLoader","startMetaTagObserver","observer","MutationObserver","mutationsList","mut","attributeName","updateEnv","getMetaContent","observe","getJsApiMetaTag","childList","subtree","startInputRvtObserver","inputRvtObserver","loadRvtFromHiddenInput","hiddenField","updateRvt","MetaProperty","EnvironmentMetaLoader","retries","dynamicPageHelper","loadMetaFromHeader","forceFallback","meta","newJsInfo","ourMeta","SxcGlobalEnvironment","metaLoader","_jsApi","envSpecs","addSlash","endsWith","replacedRvt","newRvt","ensureReadyOrThrow","dialogQuery","publicKey","partRequested","AjaxPromise","sxc","makePromise","settings","ajax","async","dataType","contentType","getActionUrl","beforeSend","preventAutoFail","fail","showDetailedHttpError","controller","http","apiUrl","endpoint","params","param","EncryptedData","iv","SecureEndpoint","encryptBody","encryptShowErrorToUser","throwIfFails","config","encrypt","publicKeyPem","handleOrThrowError","crypto","subtle","importPublicKey","aesKey","generateKey","rawAesKey","exportKey","encryptedKey","getRandomValues","enc","TextEncoder","dataString","encodedMessage","encode","encryptedData","encryptedKeyBase64","arrayBufferToBase64","encryptedDataBase64","ivBase64","alert","getSpkiDer","spkiPem","binaryDerString","atob","str2ab","importKey","bufView","charCodeAt","binary","btoa","SxcWebApi","settingsOrUrl","post","delete","put","controllerAction","controllerName","actionName","ctxParams","urlLower","_autoAppIdsInUrl","includes","appId","zoneId","fetchOptions","prepareOptions","encryptData","methodOrOptions","fetchJson","fetchRaw","cbid","toLocaleUpperCase","urlAndParams","urlParts","MetadataTargetTypes","SxcPart","SxcDataServiceBase","webApi","nameInError","SxcData","getAll","getInternal","getOne","getMany","criteria","fields","path","metadataFor","Target","Entity","Guid","For","idOrGuid","SxcQuery","urlParams","getStream","stream","getStreams","streams","SxcCms","runParams","SxcGlobalHttp","fHeaders","pageId","blockId","_noContextInHttpHeaders","endpointName","appApiRoot","baseUrl","startsWith","DomTools","htmlElement","editContextTag","getContainerTag","getTag","getContextOfTag","htmlTag","closest","sxci","Sxc","cacheKey","_isSxcInstance","manage","_manage","initInstance","envAndHttp","loadEnv","warning","_translateInit","context","app","currentLanguage","localEnv","editContext","jsApi","getContext","rootEnv","final","thing","query","resolveServiceUrl","virtualPath","infoText","srvResp","Message","msgDet","MessageDetail","ExceptionMessage","isEditMode","_isEditMode","recreate","resetCache","_controllers","SxcTools","DialogPaths","IDs","cls","scMenu","toolbar","toolbarData","settingsData","publishAllowed","sel","tagScMenu","ContentBlock","AttrNames","ClsNames","UnInitialized","UnAvailable","Toolbar","attrToMarkInitalized","full","hover","classes","oldHover","selectors","ofOldHover","eventNames","onInit","Cb","ofName","ContextOfInstance","isEditable","allowPublish","sxcVersion","parameters","sxcRootUrl","editCtx","Environment","IsEditable","SxcRootUrl","contentBlockReference","publishingMode","ContextOfPage","PageId","ContextOfSystem","problems","ContextOfTenant","ContentBlockReference","parentGuid","parentField","parentIndex","partOfPage","ContextOfUser","CanDevelop","CanAdmin","canSwitchEdition","User","ContextOfApp","appName","isContent","settingsId","resourcesId","appPath","hasContent","supportsAjax","primaryLanguage","allLanguages","contentBlock","cb","AppId","IsContent","AppResourcesId","AppSettingsId","AppUrl","HasContent","SupportsAjax","ZoneId","Language","Current","Primary","All","ContextOfUi","autoToolbar","Ui","AutoToolbar","ContextBundleInstance","ui","system","tenant","user","_isContext","maybeButton","ContextOfContentBlock","templateIsShared","viewName","renderMs","renderLightspeed","viewSwitchDisabled","isCreated","isList","queryId","queryName","queryInfo","templateId","contentTypeId","contentGroupId","templatePath","edition","editions","IsCreated","IsList","QueryId","TemplateId","TemplatePath","Edition","ContentTypeName","ContextOfItem","ContextBundleContent","ContextBundleToolbar","forButton","button","ContextComplete","_isCtxComplete","_rules","commandWorkflow","tagOrSxc","containerTag","is","contextOfButton","getContextInstance","htmlElementOrId","expandContext","copyOfContext","getEditContext","iconPrefix","tlbI18nPrefix","debugTippy","Command","buttonDefaults","mergeDefaults","translateKey","icon","uiOnly","more","title","uiActionOnly","color","tag","getRule","note","notes","allowHtml","asHtml","tippyProps","linger","isSystem","background","tippyMakeInteractive","tippyAddLinks","links","l","primary","label","cmd","command","Commands","addCommand","build","SharedLogic","useModuleList","CmdParHlp","getIndex","isPartOfBlockList","isFieldList","isBlockReference","HtmlTools","name1","name2","tryGetAttrText","item1","getNamedItem","classessArray","c","Selection","field","ModifierBase","iconPre","QuickEditOverlay","setButtonActivationClasses","buttons","linkTags","QuickEditConfigButtons","remove","btn","i18N","invisible","unavailable","selectedOverlay","domFromString","toggleOverlay","coords","Positioning","yh","positionAndAlign","display","QuickEditConfigEnableAuto","addContent","addApp","select","paste","move","QuickEditConfig","QuickEditConfigRoot","innerBlocks","modules","ContextForLists","guid","apps","appList","QeSelectors","blocks","TLB_MORE_END","TLB_MORE_START","TLB_MORE_AUTO","TLB_MORE_NEVER","TLB_HOV_RIGHT","TLB_HOV_LEFT","TLB_SHOW_HOVER","followDefault","TLB_FOLLOW_ALWAYS","TLB_FOLLOW_SCROLL","ToolbarSettings","autoAddMore","delayShow","follow","class","kd","toolbarSettings","partialSettings","dummyWorkflowManager","WorkflowHelper","getDummyManager","parentCount","cmdWf","ToolbarWorkflowManager","currentArgs","_isCancelled","cancel","isDummy","steps","addOne","step","WorkflowStepHelper","initDefaults","errorMsg","wfArgs","emptyWorkflow","stepsForCommand","WorkflowCommands","all","WorkflowPhases","code","priority","promiseChain","stepCount","nextStep","resultingArgs","runNextPromiseIfNotCancelled","finalArgs","catch","attach","prevArgs","nextFactory","isCancelled","WorkflowStepCodeArguments","before","ToolbarLifecycle","toolbarElement","anchoredElement","detail","workflow","TagToolbar","hoverTag","translator","initialized","alwaysShow","addMouseEvents","showPermanently","delayShowTimeout","initializeIfNecessary","nextFreeId","TagToolbarManager","getNextToolbarId","toolbarId","ToolbarRenderer","generate","TagToolbarForAttr","TagToolbarAttr","toolbarStyle","autoTranslateMenus","raiseToolbarInitEvent","updatePosition","initial","viewportOffset","bodyOffset","getBodyScrollOffset","tagScrollOffset","tagOffset","tagWidth","tagHeight","mousePos","mousePosition","trackMouse","tagClasses","TlbHoverPrefix","tlbStyle","disableScrollWatcher","activateScrollWatcher","updateFn","watcherActive","lastMenuId","posNoJq","realParams","sortOrder","ButtonCommand","additionalParams","Button","splitName","TypeSafeAssign","configureLinkGenerator","tweakGeneratedUrlParameters","dialog","fullScreen","disabled","dynamicClasses","inlineWindow","newWindow","showCondition","noItems","ButtonSafe","getVal","propOrGen","fallback","isPropGen","groups","debug","createIdentifier","RenderPart","RenderButton","groupIndex","btnSafe","rule","mergeAdditionalParams","group","groupName","btnLink","runJs","generateRunJs","addClasses","setTitle","divTag","iconTag","processColorRules","callLog","uiTitle","i18nTitle","correctColorCodes","modifyContext","complete","targetContext","cleanParams","newP","symbol","firstChild","RenderButtonGroups","tags","btnGroups","generateGroup","groupNumber","btns","h","btnContext","outerHTML","tlbTag","_typeof","_classCallCheck","Constructor","_defineProperties","descriptor","configurable","writable","_createClass","protoProps","staticProps","_assertThisInitialized","ReferenceError","_setPrototypeOf","setPrototypeOf","bind","__proto__","_inherits","subClass","superClass","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","_arrayLikeToArray","arr2","ownKeys","object","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","_objectSpread","getOwnPropertyDescriptors","defineProperties","consoleLogger","output","baseLogger","Logger","concreteLogger","prefix","logger","bool","forward","_len2","_key2","_len3","_key3","_len4","_key4","lvl","debugOnly","moduleName","EventEmitter","observers","events","_this","cloned","_cloned","defer","res","rej","makeString","getLastOfPath","Empty","cleanKey","canNotTraverseDeeper","setPath","newValue","_getLastOfPath","getPath","_getLastOfPath3","getPathWithDefaults","defaultData","deepExtend","overwrite","regexEscape","_entityMap","isIE10","ownKeys$1","_objectSpread$1","deepFind","keySeparator","paths","mix","joinedPath","ResourceStore","_EventEmitter","Derived","hasNativeReflectConstruct","_super","Reflect","construct","sham","Proxy","valueOf","_isNativeReflectConstruct","Super","NewTarget","defaultNS","ignoreJSONStructure","splice","silent","addNamespaces","emit","resources","addResource","deep","pack","hasResourceBundle","removeNamespaces","getResource","compatibilityAPI","getDataByLanguage","postProcessor","processors","addPostProcessor","processor","process","ownKeys$2","_objectSpread$2","checkedLoadedFor","Translator","_isNativeReflectConstruct$1","services","language","interpolation","resolved","nsSeparator","namespaces","wouldCheckForNsInKey","seemsNaturalLanguage","userDefinedKeySeparator","userDefinedNsSeparator","possibleChars","RegExp","ki","looksLikeObjectPath","interpolator","nestingRegexp","lastKey","_this2","overloadTranslationOptionHandler","returnDetails","_this$extractFromKey","extractFromKey","namespace","appendNamespaceToCIMode","resUsedKey","usedKey","resExactUsedKey","exactUsedKey","resType","noObject","joinArrays","handleAsObjectInI18nFormat","i18nFormat","handleAsObject","returnObjects","returnedObjectHandler","resTypeIsArray","newKeyToUse","deepKey","translate","extendTranslation","usedDefault","needsPluralHandling","hasDefaultValue","defaultValueSuffix","pluralResolver","getSuffix","isValidLookup","missingKeyNoValueFallbackToKey","resForMissing","updateMissing","fk","lngs","fallbackLngs","languageUtils","getFallbackCodes","fallbackLng","saveMissingTo","toResolveHierarchy","specificDefaultValue","defaultForMissing","missingKeyHandler","backendConnector","saveMissing","saveMissingPlurals","getSuffixes","suffix","appendNamespaceToMissingKey","parseMissingKeyHandler","_this3","defaultVariables","usedLng","usedNS","skipInterpolation","nestBef","skipOnVariables","nb","interpolate","na","nest","postProcess","postProcessorNames","applyPostProcessor","postProcessPassResolved","i18nResolved","found","_this4","extracted","fallbackNS","needsZeroSuffixLookup","ordinal","shouldUseIntlApi","needsContextHandling","codes","utils","hasLoadedNamespace","possibleKey","finalKeys","addLookupKeys","pluralSuffix","zeroSuffix","pluralSeparator","contextKey","contextSeparator","returnNull","returnEmptyString","resourceStore","option","capitalize","charAt","LanguageUtil","supportedLngs","formatLanguageCode","specialCases","lowerCaseLng","cleanCode","nonExplicitSupportedLngs","getLanguagePartFromCode","cleanedLng","isSupportedCode","lngOnly","supportedLng","fallbacks","getScriptPartFromCode","fallbackCode","fallbackCodes","addCode","fc","sets","nr","_rulesPluralsTypes","Number","deprecatedJsonVersions","suffixesOrder","zero","two","few","many","other","createRules","rules","numbers","plurals","PluralResolver","compatibilityJSON","Intl","PluralRules","_unused","resolvedOptions","pluralCategories","pluralCategory1","pluralCategory2","pluralCategory","prepend","number","getSuffixRetroCompatible","idx","noAbs","simplifyPluralSuffix","returnSuffix","ownKeys$3","_objectSpread$3","Interpolator","format","escapeValue","iOpts","escape","useRawValueToEscape","prefixEscaped","suffixEscaped","formatSeparator","unescapePrefix","unescapeSuffix","nestingPrefix","nestingPrefixEscaped","nestingSuffix","nestingSuffixEscaped","nestingOptionsSeparator","maxReplaces","alwaysFormat","resetRegExp","regexpStr","regexp","regexpUnescapeStr","regexpUnescape","nestingRegexpStr","replaces","regexSafe","handleFormat","interpolationkey","missingInterpolationHandler","regex","safeValue","todo","exec","matchedVar","temp","lastIndex","clonedOptions","handleHasOptions","inheritedOptions","sep","optionsString","formatters","doReduce","ownKeys$4","_objectSpread$4","Formatter","formats","NumberFormat","currency","datetime","DateTimeFormat","relativetime","RelativeTimeFormat","range","ListFormat","_format","mem","_parseFormatStr","formatStr","formatName","formatOptions","optStr","opt","_opt$split2","iter","_toArray","isNaN","parseFormatStr","formatted","valOptions","formatParams","locale","ownKeys$5","_objectSpread$5","Connector","_isNativeReflectConstruct$2","backend","store","waitingReads","maxParallelReads","readingCalls","maxRetries","retryTimeout","queue","languages","toLoad","toLoadLanguages","toLoadNamespaces","hasAllNamespaces","reload","pendingCount","loaded","errors","addResourceBundle","q","_getLastOfPath2","removePending","loadedKeys","fcName","tried","wait","read","queueLoad","loadOne","prepareLoading","_this5","fallbackValue","isUpdate","initImmediate","preload","partialBundledLanguages","ret","tDescription","transformOptions","ownKeys$6","_objectSpread$6","noop","bindMemberFunctions","inst","I18n","_isNativeReflectConstruct$3","external","isInitialized","isClone","defOpts","createClassOnDemand","ClassOrObject","formatter","lu","languageDetector","detection","storeApi","_this2$store","storeApiChained","_this2$store2","deferred","finish","initializedStoreOnce","changeLanguage","usedCallback","resolvedLanguage","setResolvedLanguage","li","lngInLngs","hasLanguageSomeTranslations","isLanguageChangingTo","setLngProps","setLng","getBestMatchFromCodes","cacheUserLanguage","loadResources","detect","keyPrefix","fixedT","resultKey","_this$translator","_this$translator2","exists","_this6","lastLng","loadNotPending","loadState","precheck","preResult","_this7","preloaded","newLngs","_this8","mergedOptions","membersToCopy","createInstance","reloadResources","use","getFixedT","setDefaultNamespace","loadNamespaces","loadLanguages","each","hasXMLHttpRequest","XmlHttpRequestApi","ActiveXObjectApi","ActiveXObject","addQueryString","queryString","paramName","payload","queryStringParams","customHeaders","requestOptions","requestWithFetch","crossDomain","overrideMimeType","requestWithXmlHttpRequest","getDefaults","loadPath","addPath","allowMultiLoading","parsePayload","reloadInterval","cache","Backend","allOptions","setInterval","_readAny","loadUrlLanguages","loadUrlNamespaces","maybePromise","isPromise","resolvedLoadPath","loadUrl","parseErr","finished","dataArray","resArray","_this$services","localize","i18n","locReady","initManager","tryToFindAContext","realRootPath","initLoc","menus","quickEButtons","toolbarSelector","ToolbarConfigFinderAndInitializer","tlbManager","buildDnnModule","parentTag","toolbars","findChildTagsWithConfig","contentTag","getForEmptyAsRule","addDefaultToolbarConfigToTag","loadConfigAndInitialize","matches","newConfigFormat","at","getFirstAttribute","loadFromTag","convertConfigToToolbars","err2","loadConfig","tagToolbar","addHoverAttributeToTag","hoverParent","InPageButtonJson","_expanded","oldFormat","evalPropOrFun","propOrFunction","InPageCommandJson","entityId","modify","ButtonConfigLoader","normalize","asBtnConfig","btnConfigStructure","hasActions","removeDisableButtons","wrapLog","removeUnfitButtons","addDefaultBtnSettings","groupDefaults","tlbDefaults","actions","btnProperties","fallbackBtnSetting","removals","toolbarV10","overrideShow","toolbarDefaults","propName","CommandConfigLoader","updateToV9","actDef","entity","_2sxcEditInformation","editInfo","EntityId","TemplateConstants","ButtonGroupConfigLoader","expandButtonGroups","fullToolbar","expandButtonList","buttonConfigs","convertToButton","dropMoreIfOnlyOneGroup","sharedParams","sharedDefaults","btnCommand","noAction","newButtonConfig","toButton","buttonsWip","newButtons","actionNames","expandButtonAndAddToList","addMoreButton","names","commandPart","addMore","bestAddMorePos","moreButton","unshift","findIndex","RuleConstants","Operations","BuildSteps","prefillPrefix","filterPrefix","RuleParamsHelper","prefill","extractSubKeys","filters","formParams","metadata","for","processMetadata","mdFor","targetType","keyType","prefixLen","filterValues","prefillValues","probablyArray","guidCount","prefixBase64","prefixJson64","ToolbarTemplateEmpty","_isToolbarTemplate","ToolbarTemplateDefault","ToolbarTemplateSublist","ToolbarTemplateManager","_singleton","configTemplateList","findOrShowError","template","ToolbarTemplate","_insertCursor","ToolbarTemplateGroup","TemplateEditor","addButton","pos","fromStart","findGroupOrDefault","addGroup","buttonId","posStartEnd","correctPosStartEnd","posInsert","findInsertPosition","ensureGroups","alreadyExists","findGroup","newGroup","removeGroup","BuildRule","ruleString","operator","setIdBasedOnOperation","splitUrlSections","loadHeader","processed","loadParamsAndPrefill","splitParamsArray","knownOperatorFound","knowStepFound","leadHeaderAndUi","forKey","dicToArray","parms","splitParamsDic","processParams","keyValues","afterPrefix","Note","insightsUrl","ripButton","codeObsolete","appCodeObsolete","createButtonForObsolete","Create","ruleManagerId","rawList","raw","addDeveloperInfos","debugAdded","remaining","newRules","addStandardObsoleteButtons","severity","link","getSettings","getSystemRuleS","tlbPart","getToolbar","getParams","getSystemRule","getAdd","br","getRemoveGroups","ToolbarConfigLoaderV09","configLoader","loadV9","getForEmpty","draftToolbar","getTemplateIfNoButtonsSpecified","buildFullDefinition","hasGroups","defToolbarname","templates","addRules","templateEditor","toolbarContext","unstructuredConfig","configWip","ensureDefinitionTree","buildTreeAndModifyAccordingToRules","newToolbar","findGroups","probablyTemplate","dropEmptyProperties","loadV10","settingRule","settingsUiRule","toolbarRule","toolbarTemplateName","rg","ToolbarConfigLoader","toolbarV09","_owner","setLoggingAndCreateHelpers","debugLog","tlbConfig","ToolbarManager","toolbarFinder","buildModule","getLoader","instanceName","loader","ModifierContentBlockInstance","sxcInstance","parentId","container","cBlockList","newTag","after","indexFrom","indexTo","toIndex","selection","confirm","ModifierContentBlock","getInstanceModifier","clip","listIndex","appOrContent","newGuid","oldClip","newClip","findClipListIndex","to","isRealMove","findListIndex","blockTag","QuickE","main","activeContentBlock","findClosestList","listItems","actionConfig","getFromDom","domIndex","cbAction","QuickEClipboard","do","modCb","PositionCoordinates","w","ModifierDnnModule","modInternal","ModifierDnnModuleInternal","modId","getModuleId","pane","getPaneName","showSendToPane","quickE","mod","activeModule","pl","selected","empty","getMoveButtons","dnnMod","modManage","modDnn","dnnSF","tabId","sendDnnAjax","success","paneName","desktopModules","moduleToFind","ModuleName","postData","Module","Page","Pane","Position","Sort","Visibility","AddExistingModule","CopyModule","createMod","ModuleID","dataVar","TabId","ModuleId","ModuleOrder","pns","cachedPanes","pName","clipboard","newPane","req","dnnHeaders","fakeXhr","setModuleHeaders","resText","resData","refresh","eitherCbOrMod","bodyPos","lastCall","highlightClass","newDate","getBodyPosition","lists","findAllLists","singleItem","contentBlocks","panes","refreshDomObjects","currentCoords","nearestCb","findNearest","nearestMod","modActions","toggle","cbActions","oldParent","_parentNode","alignTo","parentPane","parentContainer","listSettings","showContent","showApps","provideCorrectAddButtons","nearestItem","nearestDistance","posX","posY","mods","initializeSecondaryButtons","qem","createSpecs","mark","clearUi","newData","removeSelectionMarker","selectedItem","previousElementSibling","setSecondaryActionsState","btnConfig","currentItem","contextInfo","contentBlockAndModuleSelectors","configAttr","$quickE","getDefault","onModuleButtonClick","onCbButtonClick","loadPageConfig","initWatchMouse","logConfig","configs","confJ","finalConfig","confO","defConfig","detectWhichMenusToActivate","conf","innerCBs","hasInnerCBs","prepareToolbarInDom","initPanes","refreshTimeout","ContentBlockEditor","prepareToAddContent","updateTemplate","updateTemplateFromDia","wasShowingPreview","renderer","reloadAndReInitialize","getPreviewWithTemplate","lang","originalparameters","forceCreate","saveTemplate","forceCreateContentGroup","newTemplateChooserState","showMessage","newContent","triggeredBy","forceAjax","preview","fullPageReload","winForOqt","ToSic","Oqtane","reloadModule","reloaded","ajaxLoad","dnn_tabVersioningEnabled","dnn","ContentEditorManager","triggerChangeOnPageContentEvent","alternateTemplateId","justPreview","replaceContentBlock","newContentObj","newHeadHtml","Resources","resource","Type","Url","newHead","newDom","Html","asset","Actions","addItem","doAndReload","removeFromList","changeOrder","publish","publishId","verb","linkGenerator","Add","Index","Parent","Field","topItem","createContentTypeParams","itemUrlParameters","originalId","typeName","DuplicateEntity","errPrefix","errNoCode","errCodeNotString","errAndResolve","clean","cleanest","fnNew","actPar","customCode","editionInNote","showToAll","entityGuid","entityTitle","itemId","itemGuid","itemTitle","msgJs","contentItems","pars","save","editionButton","stats","i18nKeys","info","help","icons","colors","getNote","CmsEngine","applyLinkToButton","attrSel","listSpecs","specs","openDialog","lightspeed","renderTime","_event","_resolve","_reject","MetadataCommand","itm","Metadata","ImageMetadataCommand","fullMenu2","oldState2","newState2","preventDefault","scElement","opacity","screenX","screenY","isPublished","isReferencedItem","Path","isshared","pipelineId","linkGen","ContentListActionParams","ContextIdentifier","origAsContextId","ensureCompleteOrThrow","RunParamsHelpers","getParamsFromNameOrParams","nameOrSettings","nameIsString","expandParamsWithDefaults","isRunParamsInstance","maybeRunParams","typed","runContextInstanceMinimalRequirements","QuickDialogConfig","isInnerContent","IFrameBridge","sxcCacheKey","dialogName","instanceSxc","tagModule","uncachedSxc","getAdditionalDashboardConfig","fromContext","QuickDialog","setVisible","scrollToTarget","reloadAndReInit","changed","setTemplate","templateName","setup","isConfiguredFor","instanceId","SessionStateHandler","sessionStorage","setItem","removeItem","getItem","getItemValue","cancelled","containerClass","iframeTag","containerTemplate","QuickDialogContainer","quickDialog","isFullscreen","resizeWatcher","getOrCreate","buildContainerAndIFrame","newIFrame","cssText","extendedIFrame","iFrame","iFrameExtended","bridge","convertIFrameToQuickDialog","watchForResize","getIFrame","setSize","minHeight","frm","contentDocument","previousHeight","cont","rememberDialogState","showOrToggleFromToolbar","togglePromise","dialogUrl","setUrlToQuickDialog","contentWindow","reboot","promiseRestart","resolvePromise","iframe","cbId","DialogCoreParams","mid","publishing","CommandLinkGenerator","buttonSafe","otherParams","getLink","urlItems","ngDialogParams","rootUrl","debugUrlParam","customParams","ct","attributeSetName","itemIdentifier","Prefill","uifields","UiFields","Parameters","withPresentation","isAdd","groupId","runParamsHelper","detectParamsAndRun","nameOrParams","eventOrParams","cmdParams","thirdParamIsEvent","altKey","wipParamsWithWorkflow","origEvent","wf","workflows","getWorkflow","wrapperPromise","finalPromise","commandPromise","promiseWithAfterEffects","completePromise","isChanged","isNewWindow","ctrlKey","shiftKey","totalPopup","aTag","oldLink","href","oldTarget","viewBoxAttribute","BootstrapInPage","initializedInstances","openedTemplatePickerOnce","diagCancelStateOnStart","initialize","initAllInstances","watchDomChanges","svg","xMin","xMax","yMin","yMax","getBBox","viewbox","setSvgViewBox","isFirstRun","noModuleToolbars","modToolbars","tryShowTemplatePicker","addedNodes","cleanupOrphanedToolbars","openDialogId","uninitializedModules","wasEmpty","showGlassesButtonIfUninitialized","editManager","isAppInSkin","logId","SxcGlobalCms","resetLog","eventOrSettings","runInternal","cmsEngine","is$sxcRunParams","contextGiver","contextClean","runClean","realCtx","runParamsWithCtx","ctxComplete","innerCall","SxcCmsReal","ensureRunParamsInstanceOrError","EditManager","cntx","getButton","tbConfig","moreSettings","typedConfig","toolbarConfig","_updateContentGroupGuid","wasLoaded","myContext","_toolbarManager","finishUpgrade","domElement"],"sourceRoot":""}