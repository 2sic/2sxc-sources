/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var e,t,n,i,r,o,a,s={568:(e,t,n)=>{function i(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]}n.d(t,{i:()=>i}),n(655)},54:(e,t,n)=>{n.d(t,{o:()=>i,b:()=>r});var i={lat:47.17465989999999,lng:9.469142499999975};function r(){var e="https://maps.googleapis.com/maps/api/js?key=";return e&&(e+="AIzaSyDPhn"),e&&(e+="NKpEg8FmY8nooE7Zwnue6SusxEnHE"),e}},241:(e,t,n)=>{n.d(t,{R$:()=>r,eC:()=>i,uT:()=>o,vY:()=>a});var i={mapMarker:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-marker-alt" class="svg-inline--fa fa-map-marker-alt fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"></path></svg>'};function r(e,t){return e+"<style>\n"+t+"\n</style>"}function o(e){return JSON.parse(e.replace("latitude","lat").replace("longitude","lng"))}function a(e){return JSON.stringify(e).replace("lat","latitude").replace("lng","longitude")}},655:(e,t,n)=>{n.d(t,{ZT:()=>r,CR:()=>o,ev:()=>a});var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function a(e,t){for(var n=0,i=t.length,r=e.length;n<i;n++,r++)e[r]=t[n];return e}Object.create,Object.create}},l={};function c(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={exports:{}};return s[e](n,n.exports,c),n.exports}c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=c(655),t=function(){function e(e,t,n,i,r){this.changeEvent=n,this.eavConfig=r,this.fields=[],this.findFields=/\[.*?\]/gi,this.unwrapField=/[\[\]]/gi,this.subscriptions=[],this.mask=e,this.model=t,this.fields=this.fieldList(),i&&(this.preClean=i),t&&n&&this.watchAllFields()}return e.prototype.resolve=function(){var e=this,t=this.mask;return null!=this.eavConfig&&null!=t&&(t=(t=t.replace("[App:AppId]",this.eavConfig.appId)).replace("[App:ZoneId]",this.eavConfig.zoneId)),this.fields.forEach((function(n,i){var r=e.model.hasOwnProperty(n)&&e.model[n]&&e.model[n].value?e.model[n].value:"",o=e.preClean(n,r);t=t.replace("["+n+"]",o)})),t},e.prototype.fieldList=function(){var e=this,t=[];if(!this.mask)return t;var n=this.mask.match(this.findFields);return n?n.forEach((function(n,i){var r=n.replace(e.unwrapField,"");t.push(r)})):t.push(this.mask),t},e.prototype.preClean=function(e,t){return t},e.prototype.onChange=function(){var e=this.resolve();this.value!==e&&this.changeEvent(e),this.value=e},e.prototype.watchAllFields=function(){var e=this;this.fields.forEach((function(t){if(e.model[t]){var n=e.model[t].valueChanges.subscribe((function(t){return e.onChange()}));e.subscriptions.push(n)}}))},e.prototype.destroy=function(){this.subscriptions.forEach((function(e){e.unsubscribe()}))},e}(),n=c(568),i=c(54),r=c(241),o="field-custom-gps-dialog",a=function(a){function s(){var e=a.call(this)||this;return(0,n.i)(o+" constructor called"),e.fieldInitialized=!1,e}return(0,e.ZT)(s,a),s.prototype.connectedCallback=function(){var e=this;if(!this.fieldInitialized){this.fieldInitialized=!0,(0,n.i)(o+" connectedCallback called"),this.eventListeners=[],this.mapApiUrl=(0,i.b)(),this.innerHTML=(0,r.R$)('<div class="custom-gps-container">\r\n  <div class="map-info">\r\n    <div class="input-component">\r\n      <label for="lat">Lat:</label>\r\n      <input id="lat" type="number" step="0.001" />\r\n    </div>\r\n    &nbsp;\r\n    <div class="input-component">\r\n      <label for="lng">Lng:</label>\r\n      <input id="lng" type="number" step="0.001" />\r\n    </div>\r\n  </div>\r\n\r\n  <div id="address-mask-container" class="map-info address-mask-container hidden">\r\n    <a id="icon-search" class="btn">\r\n      <i class="material-icons-outlined">search</i>\r\n    </a>\r\n    <span id="formatted-address-container"></span>\r\n  </div>\r\n\r\n  <div id="map" class="map-info__map"></div>\r\n</div>\r\n',".custom-gps-container{display:flex;flex-direction:column;height:100%}.map-info{flex:0 0 32px;display:flex;flex-wrap:wrap;align-items:center;padding:4px;padding-left:14px;border-bottom:1px solid #e1e1e1;background:#fff}.map-info label,.map-info #icon-search{margin-right:8px;display:flex;justify-content:center;align-items:center;font-size:12px;text-transform:uppercase;padding:4px}.map-info #icon-search i{font-size:14px;width:14px;height:14px;font-weight:bold}.map-info input{margin-right:8px;padding:4px 16px;border:none;background:transparent;outline:none !important}.address-mask-container{flex-wrap:nowrap}.map-info__map{flex:1 1 auto;width:100%;display:block}.hidden{display:none}.btn{border:1px solid silver;border-radius:4px}.btn:hover{background-color:rgba(69,79,99,.08);cursor:pointer}.input-component{display:flex;background-color:rgba(69,79,99,.08);padding:4px;border-radius:4px 4px 0 0;border-bottom:1px solid silver;margin:8px 0}.input-component:hover{border-bottom:1px solid #002753}"),this.latInput=this.querySelector("#lat"),this.lngInput=this.querySelector("#lng");var a=this.querySelector("#address-mask-container");this.iconSearch=this.querySelector("#icon-search");var s=this.querySelector("#formatted-address-container");this.mapContainer=this.querySelector("#map");var l=this.connector._experimental.allInputTypeNames.map((function(e){return e.name}));l.includes(this.connector.field.settings.LatField)&&(this.latFieldName=this.connector.field.settings.LatField),l.includes(this.connector.field.settings.LongField)&&(this.lngFieldName=this.connector.field.settings.LongField);var c=this.connector.field.settings.AddressMask||this.connector.field.settings["Address Mask"];this.addressMask=new t(c,this.connector._experimental.formGroup.controls,null,null),(0,n.i)(o+" addressMask:",c),c&&(a.classList.remove("hidden"),s.innerText=this.addressMask.resolve()),this.connector.loadScript("google",this.mapApiUrl,(function(){e.mapScriptLoaded()}))}},s.prototype.mapScriptLoaded=function(){var e=this;(0,n.i)(o+" mapScriptLoaded called"),this.map=new google.maps.Map(this.mapContainer,{zoom:15,center:i.o,gestureHandling:"greedy"}),this.marker=new google.maps.Marker({position:i.o,map:this.map,draggable:!0}),this.geocoder=new google.maps.Geocoder,this.connector.data.value?this.updateHtml((0,r.uT)(this.connector.data.value)):this.updateHtml(i.o);var t=function(){e.onLatLngInputChange()};this.latInput.addEventListener("change",t),this.lngInput.addEventListener("change",t);var a=function(){e.autoSelect()};this.iconSearch.addEventListener("click",a),this.eventListeners.push({element:this.latInput,type:"change",listener:t},{element:this.lngInput,type:"change",listener:t},{element:this.iconSearch,type:"click",listener:a}),this.marker.addListener("dragend",(function(t){e.onMarkerDragend(t)}))},s.prototype.updateHtml=function(e){var t,n,i,r;this.latInput.value=null!==(n=null===(t=e.lat)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",this.lngInput.value=null!==(r=null===(i=e.lng)||void 0===i?void 0:i.toString())&&void 0!==r?r:"",this.map.setCenter(e),this.marker.setPosition(e)},s.prototype.updateForm=function(e){this.connector.data.update((0,r.vY)(e)),this.latFieldName&&this.connector._experimental.updateField(this.latFieldName,e.lat),this.lngFieldName&&this.connector._experimental.updateField(this.lngFieldName,e.lng)},s.prototype.onLatLngInputChange=function(){(0,n.i)(o+" input changed");var e={lat:this.latInput.value.length>0?parseFloat(this.latInput.value):null,lng:this.lngInput.value.length>0?parseFloat(this.lngInput.value):null};this.updateHtml(e),this.updateForm(e)},s.prototype.autoSelect=function(){var e=this;(0,n.i)(o+" geocoder called");var t=this.addressMask.resolve();this.geocoder.geocode({address:t},(function(n,i){if(i===google.maps.GeocoderStatus.OK){var r=n[0].geometry.location,o={lat:r.lat(),lng:r.lng()};e.updateHtml(o),e.updateForm(o)}else alert("Could not locate address: "+t)}))},s.prototype.onMarkerDragend=function(e){(0,n.i)(o+" marker changed");var t={lat:e.latLng.lat(),lng:e.latLng.lng()};this.updateHtml(t),this.updateForm(t)},s.prototype.disconnectedCallback=function(){(0,n.i)(o+" disconnectedCallback called"),null===google||void 0===google||google.maps.event.clearInstanceListeners(this.marker),null===google||void 0===google||google.maps.event.clearInstanceListeners(this.map),this.eventListeners.forEach((function(e){var t=e.element,n=e.type,i=e.listener;t.removeEventListener(n,i)})),this.addressMask.destroy()},s}(HTMLElement),customElements.get(o)||customElements.define(o,a),(()=>{var e=c(655),t=c(568),n=c(54),i=c(241),r="field-custom-gps",o=function(o){function a(){var e=o.call(this)||this;return(0,t.i)(r+" constructor called"),e.fieldInitialized=!1,e}return(0,e.ZT)(a,o),a.prototype.connectedCallback=function(){var e=this;if(!this.fieldInitialized){this.fieldInitialized=!0,(0,t.i)(r+" connectedCallback called"),this.innerHTML=(0,i.R$)('<div class="custom-gps-preview">\r\n  <div class="custom-gps-preview__text">\r\n    Lat: <span id="lat-container"></span>, Lng: <span id="lng-container"></span>\r\n  </div>\r\n  <div class="custom-gps-preview__spacer"></div>\r\n  <div id="map-icon-container" class="custom-gps-preview__map-icon"></div>\r\n</div>\r\n',".custom-gps-preview{width:100%;display:flex;align-items:center;position:absolute;top:0;bottom:0;font-size:16px;line-height:20px;margin-bottom:-2px;cursor:pointer}.custom-gps-preview__text{flex-shrink:0;max-width:80%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.custom-gps-preview__spacer{flex-grow:1}.custom-gps-preview__map-icon{flex-shrink:0;margin-right:4px;display:flex;align-items:center;justify-content:center}.custom-gps-preview__map-icon svg{width:20px;height:20px;line-height:20px}"),this.querySelector("#map-icon-container").innerHTML=i.eC.mapMarker,this.latContainer=this.querySelector("#lat-container"),this.lngContainer=this.querySelector("#lng-container"),this.eventListeners=[];var o=function(){e.expand()};this.addEventListener("click",o),this.eventListeners.push({element:this,type:"click",listener:o}),this.connector.data.value?this.updateHtml((0,i.uT)(this.connector.data.value)):this.updateHtml(n.o),this.connector.data.onValueChange((function(t){if(t){var r=(0,i.uT)(t);e.updateHtml(r)}else e.updateHtml(n.o)}))}},a.prototype.updateHtml=function(e){var t,n,i,r;this.latContainer.innerText=null!==(n=null===(t=e.lat)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",this.lngContainer.innerText=null!==(r=null===(i=e.lng)||void 0===i?void 0:i.toString())&&void 0!==r?r:""},a.prototype.expand=function(){this.connector.dialog.open()},a.prototype.disconnectedCallback=function(){(0,t.i)(r+" disconnectedCallback called"),this.eventListeners.forEach((function(e){var t=e.element,n=e.type,i=e.listener;t.removeEventListener(n,i)}))},a}(HTMLElement);customElements.get(r)||customElements.define(r,o)})()})();
//# sourceMappingURL=https://sources.2sxc.org/13.00.00/system/field-custom-gps/index.js.map