{"version":3,"sources":["./src/app/content-type-fields/ag-grid-components/content-type-fields-actions/content-type-fields-actions.component.html","./src/app/content-type-fields/ag-grid-components/content-type-fields-actions/content-type-fields-actions.component.ts","./src/app/content-type-fields/ag-grid-components/content-type-fields-input-type/content-type-fields-input-type.component.ts","./src/app/content-type-fields/ag-grid-components/content-type-fields-input-type/content-type-fields-input-type.component.html","./src/app/content-type-fields/ag-grid-components/content-type-fields-title/content-type-fields-title.component.html","./src/app/content-type-fields/ag-grid-components/content-type-fields-title/content-type-fields-title.component.ts","./src/app/content-type-fields/ag-grid-components/content-type-fields-type/content-type-fields-type.component.ts","./src/app/content-type-fields/ag-grid-components/content-type-fields-type/content-type-fields-type.component.html","./src/app/content-type-fields/content-type-fields.component.ts","./src/app/content-type-fields/assets/star-24px.svg","./src/app/content-type-fields/content-type-fields.component.html"],"names":["agInit","params","this","field","data","enablePermissions","InputType","StringWysiwyg","Type","Hyperlink","refresh","rename","onRename","openPermissions","onOpenPermissions","deleteField","onDelete","ContentTypeFieldsActionsComponent","value","ContentTypeFieldsInputTypeComponent","isTitle","ContentTypeFieldsTitleComponent","icon","ContentTypeFieldsTypeComponent","dialogRef","route","router","contentTypesService","contentTypesFieldsService","snackBar","matIconRegistry","domSanitizer","contentType$","BehaviorSubject","fields$","modules","gridOptions","getRowClass","EmptyDefault","frameworkComponents","contentTypeFieldsTitleComponent","contentTypeFieldsTypeComponent","contentTypeFieldsInputTypeComponent","contentTypeFieldsActionsComponent","columnDefs","rowDrag","width","cellClass","headerName","cellRenderer","onCellClicked","setTitle","bind","flex","minWidth","sortable","filter","editFieldMetadata","headerClass","changeInputType","valueGetter","inputTypeValueGetter","pinned","cellRendererParams","delete","sortApplied","filterApplied","rowDragSuppressed","contentTypeStaticName","snapshot","paramMap","get","subscription","Subscription","addSvgIconLiteral","bypassSecurityTrustHtml","ngOnInit","fetchFields","refreshOnChildClosed","ngOnDestroy","complete","unsubscribe","closeDialog","close","onGridReady","gridApi","api","onRowDragEnter","event","setEnableCellTextSelection","onRowDragEnd","setSuppressRowDrag","idArray","map","Id","reOrder","subscribe","res","onRowDragMove","movingNode","node","overNode","movingData","overData","newFields","fromIndex","indexOf","toIndex","moveInArray","next","clearFocusedCell","arr","element","splice","onSortChanged","sortModel","getSortModel","length","suppressRowDrag","onFilterChanged","filterModel","getFilterModel","fieldsFiltered","Object","keys","shouldSuppress","add","navigate","relativeTo","substring","callback","retrieveContentType","pipe","share","mergeMap","contentType","getFields","forkJoin","fields","form","items","createItemDefinition","formUrl","metadataType","Metadata","EntityId","ContentTypeName","For","Target","metadata","attribute","target","Number","Prefill","Name","StaticName","open","duration","newName","prompt","trim","replace","match","confirm","goAttribute","events","startWith","firstChild","pairwise","ContentTypeFieldsComponent"],"mappings":"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","file":"content-type-fields-component.5c72c026f92d9041f177.js","sourcesContent":["<div class=\"actions-component\">\r\n  <div class=\"like-button highlight\" matRipple matTooltip=\"Permissions\" *ngIf=\"enablePermissions\"\r\n    (click)=\"openPermissions()\">\r\n    <mat-icon [matBadge]=\"field.Permissions.Count\" matBadgePosition=\"after\" matBadgeColor=\"accent\" matBadgeSize=\"small\"\r\n      *ngIf=\"field.Permissions.Count\">\r\n      person\r\n    </mat-icon>\r\n    <mat-icon *ngIf=\"!field.Permissions.Count\">person</mat-icon>\r\n  </div>\r\n  <div class=\"like-button disabled\" *ngIf=\"!enablePermissions\">\r\n    <mat-icon>person</mat-icon>\r\n  </div>\r\n\r\n  <div class=\"like-button highlight\" matRipple matTooltip=\"More\" [matMenuTriggerFor]=\"menu\">\r\n    <mat-icon>more_horiz</mat-icon>\r\n  </div>\r\n</div>\r\n\r\n<mat-menu #menu=\"matMenu\" class=\"grid-more-menu\">\r\n  <button mat-menu-item (click)=\"rename()\">\r\n    <mat-icon>text_fields</mat-icon>\r\n    <span>Rename</span>\r\n  </button>\r\n\r\n  <button mat-menu-item [disabled]=\"field.IsTitle\" (click)=\"deleteField()\">\r\n    <mat-icon>delete</mat-icon>\r\n    <span>Delete</span>\r\n  </button>\r\n</mat-menu>\r\n","import { ICellRendererAngularComp } from '@ag-grid-community/angular';\r\nimport { ChangeDetectionStrategy, Component } from '@angular/core';\r\nimport { DataTypeConstants } from '../../constants/data-type.constants';\r\nimport { InputTypeConstants } from '../../constants/input-type.constants';\r\nimport { Field } from '../../models/field.model';\r\nimport { ContentTypeFieldsActionsParams } from './content-type-fields-actions.models';\r\n\r\n@Component({\r\n  selector: 'app-content-type-fields-actions',\r\n  templateUrl: './content-type-fields-actions.component.html',\r\n  styleUrls: ['./content-type-fields-actions.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContentTypeFieldsActionsComponent implements ICellRendererAngularComp {\r\n  field: Field;\r\n  enablePermissions: boolean;\r\n  private params: ContentTypeFieldsActionsParams;\r\n\r\n  constructor() { }\r\n\r\n  agInit(params: ContentTypeFieldsActionsParams) {\r\n    this.params = params;\r\n    this.field = this.params.data;\r\n    this.enablePermissions = this.field.InputType === InputTypeConstants.StringWysiwyg || this.field.Type === DataTypeConstants.Hyperlink;\r\n  }\r\n\r\n  refresh(params?: any): boolean {\r\n    return true;\r\n  }\r\n\r\n  rename() {\r\n    this.params.onRename(this.field);\r\n  }\r\n\r\n  openPermissions() {\r\n    this.params.onOpenPermissions(this.field);\r\n  }\r\n\r\n  deleteField() {\r\n    this.params.onDelete(this.field);\r\n  }\r\n}\r\n","import { ICellRendererParams } from '@ag-grid-community/all-modules';\r\nimport { ICellRendererAngularComp } from '@ag-grid-community/angular';\r\nimport { ChangeDetectionStrategy, Component } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-content-type-fields-input-type',\r\n  templateUrl: './content-type-fields-input-type.component.html',\r\n  styleUrls: ['./content-type-fields-input-type.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContentTypeFieldsInputTypeComponent implements ICellRendererAngularComp {\r\n  value: string;\r\n\r\n  agInit(params: ICellRendererParams) {\r\n    this.value = params.value;\r\n  }\r\n\r\n  refresh(params?: any): boolean {\r\n    return true;\r\n  }\r\n}\r\n","<div matRipple class=\"input-component highlight\">\r\n  <div class=\"text\">{{ value }}</div>\r\n  <div class=\"like-button\">\r\n    <mat-icon>arrow_drop_down</mat-icon>\r\n  </div>\r\n</div>\r\n","<div class=\"actions-component\">\r\n  <div class=\"like-button highlight\" matRipple matTooltip=\"Use as title field\">\r\n    <mat-icon *ngIf=\"isTitle\" svgIcon=\"star\"></mat-icon>\r\n    <mat-icon *ngIf=\"!isTitle\">star_outline</mat-icon>\r\n  </div>\r\n</div>\r\n","import { ICellRendererParams } from '@ag-grid-community/all-modules';\r\nimport { ICellRendererAngularComp } from '@ag-grid-community/angular';\r\nimport { ChangeDetectionStrategy, Component } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-content-type-fields-title',\r\n  templateUrl: './content-type-fields-title.component.html',\r\n  styleUrls: ['./content-type-fields-title.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContentTypeFieldsTitleComponent implements ICellRendererAngularComp {\r\n  isTitle: boolean;\r\n\r\n  agInit(params: ICellRendererParams) {\r\n    this.isTitle = params.value;\r\n  }\r\n\r\n  refresh(params?: any): boolean {\r\n    return true;\r\n  }\r\n}\r\n","import { ICellRendererParams } from '@ag-grid-community/all-modules';\r\nimport { ICellRendererAngularComp } from '@ag-grid-community/angular';\r\nimport { ChangeDetectionStrategy, Component } from '@angular/core';\r\nimport { calculateTypeIcon } from '../../content-type-fields.helpers';\r\n\r\n@Component({\r\n  selector: 'app-content-type-fields-type',\r\n  templateUrl: './content-type-fields-type.component.html',\r\n  styleUrls: ['./content-type-fields-type.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContentTypeFieldsTypeComponent implements ICellRendererAngularComp {\r\n  value: string;\r\n  icon: string;\r\n\r\n  agInit(params: ICellRendererParams) {\r\n    this.value = params.value;\r\n    this.icon = calculateTypeIcon(this.value);\r\n  }\r\n\r\n  refresh(params?: any): boolean {\r\n    return true;\r\n  }\r\n}\r\n","<div class=\"icon-container\" [matTooltip]=\"value\">\r\n  <mat-icon>{{ icon }}</mat-icon>\r\n</div>\r\n","import star from '!raw-loader!./assets/star-24px.svg';\r\n// tslint:disable-next-line:max-line-length\r\nimport { AllCommunityModules, CellClickedEvent, FilterChangedEvent, GridApi, GridOptions, GridReadyEvent, RowDragEvent, SortChangedEvent, ValueGetterParams } from '@ag-grid-community/all-modules';\r\nimport { ChangeDetectionStrategy, Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport { BehaviorSubject, forkJoin, Subscription } from 'rxjs';\r\nimport { filter, map, mergeMap, pairwise, share, startWith } from 'rxjs/operators';\r\nimport { fieldNameError, fieldNamePattern } from '../app-administration/constants/field-name.patterns';\r\nimport { ContentType } from '../app-administration/models/content-type.model';\r\nimport { ContentTypesService } from '../app-administration/services/content-types.service';\r\nimport { GoToPermissions } from '../permissions/go-to-permissions';\r\nimport { defaultGridOptions } from '../shared/constants/default-grid-options.constants';\r\nimport { eavConstants } from '../shared/constants/eav.constants';\r\nimport { convertFormToUrl } from '../shared/helpers/url-prep.helper';\r\nimport { AddItem, EditForm, EditItem } from '../shared/models/edit-form.model';\r\nimport { ContentTypeFieldsActionsComponent } from './ag-grid-components/content-type-fields-actions/content-type-fields-actions.component';\r\nimport { ContentTypeFieldsActionsParams } from './ag-grid-components/content-type-fields-actions/content-type-fields-actions.models';\r\nimport { ContentTypeFieldsInputTypeComponent } from './ag-grid-components/content-type-fields-input-type/content-type-fields-input-type.component';\r\nimport { ContentTypeFieldsTitleComponent } from './ag-grid-components/content-type-fields-title/content-type-fields-title.component';\r\nimport { ContentTypeFieldsTypeComponent } from './ag-grid-components/content-type-fields-type/content-type-fields-type.component';\r\nimport { InputTypeConstants } from './constants/input-type.constants';\r\nimport { Field } from './models/field.model';\r\nimport { ContentTypesFieldsService } from './services/content-types-fields.service';\r\n\r\n@Component({\r\n  selector: 'app-content-type-fields',\r\n  templateUrl: './content-type-fields.component.html',\r\n  styleUrls: ['./content-type-fields.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ContentTypeFieldsComponent implements OnInit, OnDestroy {\r\n  contentType$ = new BehaviorSubject<ContentType>(null);\r\n  fields$ = new BehaviorSubject<Field[]>(null);\r\n\r\n  modules = AllCommunityModules;\r\n  gridOptions: GridOptions = {\r\n    ...defaultGridOptions,\r\n    getRowClass(params: any) {\r\n      const field: Field = params.data;\r\n      return field.InputType === InputTypeConstants.EmptyDefault ? 'group-row' : '';\r\n    },\r\n    frameworkComponents: {\r\n      contentTypeFieldsTitleComponent: ContentTypeFieldsTitleComponent,\r\n      contentTypeFieldsTypeComponent: ContentTypeFieldsTypeComponent,\r\n      contentTypeFieldsInputTypeComponent: ContentTypeFieldsInputTypeComponent,\r\n      contentTypeFieldsActionsComponent: ContentTypeFieldsActionsComponent,\r\n    },\r\n    columnDefs: [\r\n      { rowDrag: true, width: 18, cellClass: 'no-select no-padding no-outline' },\r\n      {\r\n        headerName: 'Title', field: 'IsTitle', width: 42, cellClass: 'secondary-action no-padding no-outline',\r\n        cellRenderer: 'contentTypeFieldsTitleComponent', onCellClicked: this.setTitle.bind(this),\r\n      },\r\n      {\r\n        headerName: 'Name', field: 'StaticName', flex: 2, minWidth: 250, cellClass: 'primary-action highlight',\r\n        sortable: true, filter: 'agTextColumnFilter', onCellClicked: this.editFieldMetadata.bind(this),\r\n      },\r\n      {\r\n        headerName: 'Type', field: 'Type', width: 70, headerClass: 'dense', cellClass: 'no-outline', sortable: true,\r\n        filter: 'agTextColumnFilter', cellRenderer: 'contentTypeFieldsTypeComponent',\r\n      },\r\n      {\r\n        headerName: 'Input', field: 'InputType', width: 160, cellClass: 'secondary-action no-padding',\r\n        sortable: true, filter: 'agTextColumnFilter', cellRenderer: 'contentTypeFieldsInputTypeComponent',\r\n        onCellClicked: this.changeInputType.bind(this), valueGetter: this.inputTypeValueGetter,\r\n      },\r\n      {\r\n        headerName: 'Label', field: 'Metadata.All.Name', flex: 2, minWidth: 250, cellClass: 'no-outline',\r\n        sortable: true, filter: 'agTextColumnFilter',\r\n      },\r\n      {\r\n        headerName: 'Notes', field: 'Metadata.All.Notes', flex: 2, minWidth: 250, cellClass: 'no-outline',\r\n        sortable: true, filter: 'agTextColumnFilter',\r\n      },\r\n      {\r\n        width: 80, cellClass: 'secondary-action no-padding', cellRenderer: 'contentTypeFieldsActionsComponent', pinned: 'right',\r\n        cellRendererParams: {\r\n          onRename: this.rename.bind(this),\r\n          onDelete: this.delete.bind(this),\r\n          onOpenPermissions: this.openPermissions.bind(this),\r\n        } as ContentTypeFieldsActionsParams,\r\n      },\r\n    ],\r\n  };\r\n\r\n  private gridApi: GridApi;\r\n  private sortApplied = false;\r\n  private filterApplied = false;\r\n  private rowDragSuppressed = false;\r\n  private contentTypeStaticName = this.route.snapshot.paramMap.get('contentTypeStaticName');\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private dialogRef: MatDialogRef<ContentTypeFieldsComponent>,\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private contentTypesService: ContentTypesService,\r\n    private contentTypesFieldsService: ContentTypesFieldsService,\r\n    private snackBar: MatSnackBar,\r\n    private matIconRegistry: MatIconRegistry,\r\n    private domSanitizer: DomSanitizer,\r\n  ) {\r\n    this.matIconRegistry.addSvgIconLiteral('star', this.domSanitizer.bypassSecurityTrustHtml(star));\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.fetchFields();\r\n    this.refreshOnChildClosed();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.contentType$.complete();\r\n    this.fields$.complete();\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  onGridReady(params: GridReadyEvent) {\r\n    this.gridApi = params.api;\r\n  }\r\n\r\n  onRowDragEnter(event: RowDragEvent) {\r\n    this.gridApi.setEnableCellTextSelection(false);\r\n  }\r\n\r\n  onRowDragEnd(event: RowDragEvent) {\r\n    this.gridApi.setSuppressRowDrag(true);\r\n    const idArray = this.fields$.value.map(field => field.Id);\r\n    this.contentTypesFieldsService.reOrder(idArray, this.contentType$.value).subscribe(res => {\r\n      this.fetchFields(() => {\r\n        this.gridApi.setEnableCellTextSelection(true);\r\n        this.gridApi.setSuppressRowDrag(false);\r\n      });\r\n    });\r\n  }\r\n\r\n  onRowDragMove(event: RowDragEvent) {\r\n    const movingNode = event.node;\r\n    const overNode = event.overNode;\r\n    if (!overNode) { return; }\r\n    const rowNeedsToMove = movingNode !== overNode;\r\n    if (rowNeedsToMove) {\r\n      const movingData: Field = movingNode.data;\r\n      const overData: Field = overNode.data;\r\n      const newFields = [...this.fields$.value];\r\n      const fromIndex = newFields.indexOf(movingData);\r\n      const toIndex = newFields.indexOf(overData);\r\n      this.moveInArray(newFields, fromIndex, toIndex);\r\n      this.fields$.next(newFields);\r\n      this.gridApi.clearFocusedCell();\r\n    }\r\n  }\r\n\r\n  private moveInArray(arr: Field[], fromIndex: number, toIndex: number) {\r\n    const element = arr[fromIndex];\r\n    arr.splice(fromIndex, 1);\r\n    arr.splice(toIndex, 0, element);\r\n  }\r\n\r\n  onSortChanged(params: SortChangedEvent) {\r\n    const sortModel = this.gridApi.getSortModel();\r\n    this.sortApplied = sortModel.length > 0;\r\n    this.suppressRowDrag();\r\n  }\r\n\r\n  onFilterChanged(params: FilterChangedEvent) {\r\n    const filterModel = this.gridApi.getFilterModel();\r\n    const fieldsFiltered = Object.keys(filterModel);\r\n    this.filterApplied = fieldsFiltered.length > 0;\r\n    this.suppressRowDrag();\r\n  }\r\n\r\n  private suppressRowDrag() {\r\n    const shouldSuppress = this.sortApplied || this.filterApplied;\r\n    if (shouldSuppress && !this.rowDragSuppressed) {\r\n      this.rowDragSuppressed = true;\r\n      this.gridApi.setSuppressRowDrag(true);\r\n    } else if (!shouldSuppress && this.rowDragSuppressed) {\r\n      this.rowDragSuppressed = false;\r\n      this.gridApi.setSuppressRowDrag(false);\r\n    }\r\n  }\r\n\r\n  add() {\r\n    this.router.navigate([`add/${this.contentTypeStaticName}`], { relativeTo: this.route });\r\n  }\r\n\r\n  private inputTypeValueGetter(params: ValueGetterParams) {\r\n    const field: Field = params.data;\r\n    const inputType = field.InputType.substring(field.InputType.indexOf('-') + 1);\r\n    return inputType;\r\n  }\r\n\r\n  private fetchFields(callback?: () => void) {\r\n    if (this.contentType$.value == null) {\r\n      const contentType$ = this.contentTypesService.retrieveContentType(this.contentTypeStaticName).pipe(share());\r\n      const fields$ = contentType$.pipe(mergeMap(contentType => this.contentTypesFieldsService.getFields(contentType)));\r\n      forkJoin([contentType$, fields$]).subscribe(([contentType, fields]) => {\r\n        this.contentType$.next(contentType);\r\n        this.fields$.next(fields);\r\n        if (callback != null) { callback(); }\r\n      });\r\n    } else {\r\n      this.contentTypesFieldsService.getFields(this.contentType$.value).subscribe(fields => {\r\n        this.fields$.next(fields);\r\n        if (callback != null) { callback(); }\r\n      });\r\n    }\r\n  }\r\n\r\n  private editFieldMetadata(params: CellClickedEvent) {\r\n    const field: Field = params.data;\r\n    const form: EditForm = {\r\n      items: [\r\n        this.createItemDefinition(field, 'All'),\r\n        this.createItemDefinition(field, field.Type),\r\n        this.createItemDefinition(field, field.InputType),\r\n      ],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  private createItemDefinition(field: Field, metadataType: string): AddItem | EditItem {\r\n    return field.Metadata[metadataType] != null\r\n      ? { EntityId: field.Metadata[metadataType].Id } // if defined, return the entity-number to edit\r\n      : {\r\n        ContentTypeName: '@' + metadataType, // otherwise the content type for new-assignment\r\n        For: {\r\n          Target: eavConstants.metadata.attribute.target,\r\n          Number: field.Id,\r\n        },\r\n        Prefill: { Name: field.StaticName },\r\n      };\r\n  }\r\n\r\n  private setTitle(params: CellClickedEvent) {\r\n    const field: Field = params.data;\r\n    this.snackBar.open('Setting title...');\r\n    this.contentTypesFieldsService.setTitle(field, this.contentType$.value).subscribe(() => {\r\n      this.snackBar.open('Title set', null, { duration: 2000 });\r\n      this.fetchFields();\r\n    });\r\n  }\r\n\r\n  private changeInputType(params: CellClickedEvent) {\r\n    const field: Field = params.data;\r\n    this.router.navigate([`update/${this.contentTypeStaticName}/${field.Id}`], { relativeTo: this.route });\r\n  }\r\n\r\n  private rename(field: Field) {\r\n    let newName = prompt(`What new name would you like for '${field.StaticName}' (${field.Id})?`, field.StaticName);\r\n    if (newName === null) { return; }\r\n    newName = newName.trim().replace(/\\s\\s+/g, ' '); // remove multiple white spaces and tabs\r\n    if (newName === field.StaticName) { return; }\r\n    while (!newName.match(fieldNamePattern)) {\r\n      newName = prompt(`What new name would you like for '${field.StaticName}' (${field.Id})?\\n${fieldNameError}`, newName);\r\n      if (newName === null) { return; }\r\n      newName = newName.trim().replace(/\\s\\s+/g, ' '); // remove multiple white spaces and tabs\r\n      if (newName === field.StaticName) { return; }\r\n    }\r\n    this.snackBar.open('Saving...');\r\n    this.contentTypesFieldsService.rename(field, this.contentType$.value, newName).subscribe(() => {\r\n      this.snackBar.open('Saved', null, { duration: 2000 });\r\n      this.fetchFields();\r\n    });\r\n  }\r\n\r\n  private delete(field: Field) {\r\n    if (!confirm(`Are you sure you want to delete '${field.StaticName}' (${field.Id})?`)) { return; }\r\n    this.snackBar.open('Deleting...');\r\n    this.contentTypesFieldsService.delete(field, this.contentType$.value).subscribe(res => {\r\n      this.snackBar.open('Deleted', null, { duration: 2000 });\r\n      this.fetchFields();\r\n    });\r\n  }\r\n\r\n  private openPermissions(field: Field) {\r\n    this.router.navigate([GoToPermissions.goAttribute(field.Id)], { relativeTo: this.route });\r\n  }\r\n\r\n  private refreshOnChildClosed() {\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        startWith(!!this.route.snapshot.firstChild),\r\n        map(() => !!this.route.snapshot.firstChild),\r\n        pairwise(),\r\n        filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n      ).subscribe(() => {\r\n        this.fetchFields();\r\n      })\r\n    );\r\n  }\r\n\r\n}\r\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" width=\\\"24\\\"><path d=\\\"M0 0h24v24H0z\\\" fill=\\\"none\\\"/><path d=\\\"M0 0h24v24H0z\\\" fill=\\\"none\\\"/><path d=\\\"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z\\\"/></svg>\";","<div class=\"nav-component-wrapper\">\r\n  <div mat-dialog-title>\r\n    <div class=\"dialog-title-box\">\r\n      <div>{{ (contentType$ | async)?.Name }} Fields</div>\r\n      <button mat-icon-button matTooltip=\"Close dialog\" (click)=\"closeDialog()\">\r\n        <mat-icon>close</mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n  <router-outlet></router-outlet>\r\n\r\n  <div class=\"grid-wrapper\">\r\n    <ag-grid-angular class=\"ag-theme-material\" [rowData]=\"fields$ | async\" [modules]=\"modules\"\r\n      [gridOptions]=\"gridOptions\" (rowDragEnter)=\"onRowDragEnter($event)\" (rowDragEnd)=\"onRowDragEnd($event)\"\r\n      (rowDragMove)=\"onRowDragMove($event)\" (gridReady)=\"onGridReady($event)\" (sortChanged)=\"onSortChanged($event)\"\r\n      (filterChanged)=\"onFilterChanged($event)\">\r\n    </ag-grid-angular>\r\n\r\n    <button mat-fab mat-elevation-z24 class=\"grid-fab\" matTooltip=\"Add fields\" (click)=\"add()\">\r\n      <mat-icon>add</mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n"],"sourceRoot":"webpack:///"}