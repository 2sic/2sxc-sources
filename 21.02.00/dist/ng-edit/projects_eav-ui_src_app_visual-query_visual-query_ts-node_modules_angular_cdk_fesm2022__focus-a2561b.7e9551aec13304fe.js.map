{"version":3,"file":"projects_eav-ui_src_app_visual-query_visual-query_ts-node_modules_angular_cdk_fesm2022__focus-a2561b.7e9551aec13304fe.js","mappings":"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","names":["ExportAppService","HttpServiceBaseSignal","getAppInfo","httpResource","url","this","apiUrl","params","appid","appId","zoneId","exportAppUrl","webApiAppRoot","exportForVersionControl","_x","_this","_asyncToGenerator","includeContentGroups","resetAppGuid","withFiles","getStatusPromise","toString","withPortalFiles","apply","arguments","__ngFactoryType__","factory","fac","webApiViews","Polymorphism_DS_ID","ViewsService","getAllOnce","getAllLive","refresh","delete","id","Id","import","file","formData","FormData","append","http","post","export","window","open","getUsage","guid","newHttpResource","FocusKeyManager","ListKeyManager","_origin","setFocusOrigin","origin","setActiveItem","item","super","activeItem","focus","ArrayHelpers","toggleInArray","array","index","indexOf","push","splice","webApiTypeRoot","webApiTypeGet","webApiTypes","webApiTypeScopes","ContentTypesService","HttpServiceBase","retrieveContentType","nameId","getHttpApiUrl","contentTypeId","getType","getTypes","scope","defaultValue","retrieveContentTypesPromise","fetchPromise","getScopesPromise","then","scopesData","scopes","old","Object","keys","map","key","name","value","getScopesSig","scopesSignal","computed","getScopesV2Promise","save","contentType","staticName","NameId","files","createGhost","sourceNameId","MousedownStopPropagationDirective","onMousedown","event","stopPropagation","selectors","hostBindings","rf","ctx","i0","$event","__WEBPACK_DEFAULT_EXPORT__","getPrototype","overArg","getPrototypeOf","arrayEach","iteratee","length","objectCreate","create","object","proto","isObject","prototype","result","undefined","webApiAppPartsRoot","ImportAppPartsService","importAppParts","resetApp","findDefByType","dataSources","partAssemblyAndType","find","ds","PartAssemblyAndType","getEndpointLabel","endpoint","getOverlay","label","guiTypes","App","Name","Label","Icon","UiHint","Cache","Filter","Logic","Lookup","Modify","Security","Sort","Source","Target","Unknown","Debug","System","QueryDefinitionService","fetchPipelinePromise","pipelineEntityId","webApiQueryGet","pipelineModel","DataSources","#buildDefaultModel","#fixPipelineDataSources","templateDataSources","eavConstants","pipelineDesigner","defaultPipeline","templateDS","dataSource","Description","EntityGuid","EntityId","VisualDesignerData","Pipeline","StreamWiring","streamWiring","pipelineDataSources","some","pipelineDS","outDataSource","outDs","pipelineDataSource","Top","Left","fetchDataSourcesPromise","webApiQueryDataSources","outFinalTarget","typeNameFilter","input","format","globalParts","split","classFullNameParts","savePipeline","pipeline","webApiQuerySave","pipe","newPipelineModel","runPipelinePromise","top","webApiQueryRun","debugStreamPromise","source","sourceOut","webApiQueryDebugStream","from","out","ctx_r0","debugStream","sourceName","option_r3","_r2","$implicit","show","QueryResultComponent_For_21_Conditional_2_Template","QueryResultComponent_For_21_Conditional_3_Template","res_r4","QueryResultComponent_For_24_div_1_Template","data","param_r5","QueryResultComponent_Conditional_25_div_1_Template","QueryResultComponent_Conditional_25_For_5_Template","parameters","source_r6","Definition","config_r7","QueryResultComponent_For_40_Conditional_2_Template","QueryResultComponent_For_40_For_10_Template","Guid","Type","Configuration","Error","stream_r8","SourceOut","TargetIn","Count","QueryResultComponent","constructor","dialogData","dialog","visualQueryService","ngOnInit","Params","filter","el","testParams","TestParameters","concat","timeUsed","QueryTimer","Milliseconds","ticksUsed","Ticks","optionsForTop","Query","streamTabs","d","sources","Sources","streams","Streams","closeDialog","close","original","runPipeline","MAT_DIALOG_DATA","i1","i2","decls","vars","consts","template","QueryResultComponent_Conditional_4_Template","QueryResultComponent_div_13_Template","QueryResultComponent_Conditional_17_Template","QueryResultComponent_Conditional_18_Template","QueryResultComponent_For_21_Template","QueryResultComponent_For_24_Template","QueryResultComponent_Conditional_25_Template","QueryResultComponent_div_27_Template","QueryResultComponent_For_40_Template","QueryResultComponent_div_43_Template","QueryResultComponent_For_56_Template","MatButtonModule","i3","MatIconModule","i4","MatTabsModule","i5","JsonPipe","KeyValuePipe","styles","StreamErrorResultComponent","errorData","openInsights","$2sxc","MatDialogActions","VisualQueryStateService","ServiceBase","#contentTypesSvc","#metadataSvc","#queryDefSvc","#dialogRoute","#titleSvc","#pipelineId","#refreshPipeline","#refreshDataSourceConfigs","snackBar","matDialog","viewContainerRef","zone","changeDetectorRef","transient","MetadataService","DialogRoutingService","Title","signal","dataSourceConfigs","putEntityCountOnConnections$","Subject","parseInt","getParam","ngOnDestroy","complete","init","#fetchDataSources","#fetchPipeline","#attachKeyboardSave","doOnDialogClosed","editPipelineEntity","#savePipeline","form","items","ItemIdHelper","editId","formUrl","convertFormToUrl","navRelative","saveAndRun","run","showDataSourceDetails","showDetails","query","cloneDeep","designerData","JsonHelpers","tryParse","ShowDataSourceDetails","JSON","stringify","set","addDataSource","removeDataSource","pipelineDataSourceGuid","connections","streamsOut","StreamsOut","renameDataSource","changeDataSourceDescription","description","changeConnections","changeDataSourcePosition","position","#calculateDataSourceConfigs","forEach","Metadata","metadataItem","entries","attributeName","attributeValue","includes","Array","isArray","editDataSource","contentTypeName","ContentType","targetType","keyType","metadata","entity","getMetadataPromise","Items","subscribe","next","duration","newMetadata","error","callback","pipelineResult","queryResult","#showQueryResult","console","warn","setTimeout","catch","stream","#showStreamErrorResult","pipelineId","streamResult","_error","refreshPipeline","refreshDataSourceConfigs","showSnackBar","setTitle","autoFocus","backdropClass","closeOnNavigation","panelClass","markForCheck","ErrorData","runOutsideAngular","subscriptions","add","fromEvent","snapshot","firstChild","isCtrlS","preventDefault","dataSource_r6","_r5","ctx_r1","AddExplorerComponent_Conditional_0_For_6_Conditional_5_For_2_Template","trackDataSources","group_r4","_r3","toggleItem","AddExplorerComponent_Conditional_0_For_6_Conditional_5_Template","toggledItems","_r1","toggleDifficulty","AddExplorerComponent_Conditional_0_For_6_Template","trackGroups","sorted","AddExplorerComponent","#difficulties","#difficulty","dataSourceDifficulties","default","filterAndSortDataSources","maxDifficulty","filtered","Difficulty","sort","a","b","toLocaleLowerCase","localeCompare","type","PrimaryType","difficulty","checked","advanced","AddExplorerComponent_Conditional_0_Template","MatSlideToggleModule","TippyDirective","dataSrcIdPrefix","domIdOfGuid","guidOfDomId","domId","replace","logSpecs","all","ConnectionLineColors","log","classLog","#lineCount","#linePaintDefault","stroke","strokeWidth","outlineStroke","outlineWidth","#lineColors","#maxCols","#uuidColorMap","nextLinePaintStyle","uuid","#nextLineColor","eventConnectionDetached","eventConnectionAttached","ConnectionsManager","instance","endpointsSvc","onConnectionsChanged","bulkDelete","setup","bind","info","handleDetached","handleAttached","getAll","getAllConnections","connection","From","sourceId","Out","endpoints","To","targetId","In","l","fnIf","end","domDataSource","target","targetEndpoint","getInfo","deleteEndpoint","deleteConnection","fireEvent","targetEndpointOverlay","targetLabel","getLabel","targetHasSameLabel","getEndpoints","ep","canvas","classList","contains","setLabel","Math","floor","random","RenameStreamComponent_Conditional_9_Conditional_4_Template","RenameStreamComponent_Conditional_9_Conditional_5_Template","isSource","pipelineResultExists","controls","touched","errors","required","scopeOption_r3","RenameStreamComponent_Conditional_10_Conditional_0_For_5_Template","scopeOptions","labelOption_r4","RenameStreamComponent_Conditional_10_Conditional_4_For_2_Template","labelOptions","RenameStreamComponent_Conditional_10_Conditional_0_Template","RenameStreamComponent_Conditional_10_Conditional_4_Template","RenameStreamComponent_Conditional_10_Conditional_5_Template","toggleGuidedLabel","RenameStreamComponent_Conditional_10_Conditional_13_Template","advancedMode","guidedLabel","_c0","toggleAdvancedMode","RenameStreamComponent","BaseComponent","hostClass","#buildForm","#watchKeyboardShortcuts","saveAndClose","formValue","getRawValue","UntypedFormGroup","UntypedFormControl","Validators","valueChanges","startWith","distinctUntilChanged","values","Scope","patchValue","s","o","keydownEvents","isCtrlEnter","valid","hostVars","RenameStreamComponent_Conditional_9_Template","RenameStreamComponent_Conditional_10_Template","RenameStreamComponent_Conditional_13_Template","FormsModule","ReactiveFormsModule","MatFormFieldModule","i6","MatInputModule","i7","MatSelectModule","i8","i9","MatOptionModule","NgClass","i10","FieldHintComponent","ClickStopPropagationDirective","SaveCloseButtonFabComponent","encapsulation","getEndpointOverlays","getEndpointInfo","buildSourceDef","buildTargetDef","EndpointDefinitionsService","renameDialogParts","#getEndpointOverlays","r","location","cssClass","endpointName","isDynamic","customLabel","trimmed","trim","isAsterisk","endsWith","substring","dsGuid","style","sourceEndpoint","paintStyle","fill","radius","maxConnections","anchor","faces","overlays","events","click","endpointOrOverlay","onChangeLabel","isTarget","dropOptions","hoverClass","activeClass","AllowEdit","overlay","width","afterClosed","newLabel","addEndpoint","reOrientAllLabels","updateAfterChanges","wireHasConnection","mirrorEndpoints","fields","EndpointsManager","endpointDefs","queryData","#isDoingUpdate","endpointLabel","isIn","queryDs","extraStyling","fnIfInFields","dsDefinition","connectionList","endpointInfo","hasDynamic","#wireHasConnection","model","enabled","wireExists","wire","isDoing","#mirrorEndpoints","#reOrientAllLabels","repaintEverything","def","OutMode","inPoints","outPoints","#getEndpointsByType","inLabels","p","point","outLabels","missingInOut","inP","outP","outWithoutIn","findDataSourceAndDom","selectEndpoints","element","each","#reorientListOfEndpoints","countExceeded","labels","join","addClass","removeClass","removeAllEndpoints","dataSourceGuid","elementId","batch","JsPlumbInstanceManager","jsPlumbRoot","lineColors","jsPlumb","getInstance","createInstanceDefaults","container","Container","Connector","curviness","PaintStyle","HoverPaintStyle","destroy","reset","unbindContainer","putEntityCountOnConnections","LinesDecorator","onDebugStream","addEntityCount","outDomId","inDomId","fromUuid","toUuid","getEndpoint","getUuid","QueryDataManager","findDomAndDef","dsSet","dsDef","definition","sourceElementId","querySelector","pipeDs","initWirings","ensureWireEndpointExists","findDataSourceInDom","connect","WiringsHelper","plumber","classLogEnabled","getWireEndpointName","endpointId","wiringsRaw","wirings","outDsDomId","outTargetName","outPointDomId","inDsDomId","inTargetName","inPointDomId","wireDetails","w","#ensureWireEndpointExists","#connect","uuids","message","to","sourceGuid","#findDataSourceInDom","initDomDataSources","Plumber","#instance","#endpointDefs","#instanceManager","onConnectionsChangedParent","onDragend","#onConnectionsChanged","lineDecorator","#initDomDataSources","getStreamsOut","domDs","draggable","grid","stop","queryDsGuid","finalPos","outCount","dynOut","makeSource","inCount","in","targetEndpointUnlimited","makeTarget","dataSource_r3","ctx_r3","configureDataSource","openHelp","typeInfos","HelpLink","_r6","remove","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Conditional_21_For_3_Template","visQuerySvc","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Conditional_5_Template","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Conditional_6_Template","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Conditional_8_Template","editName","editDescription","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Conditional_21_Template","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Conditional_24_Template","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Conditional_25_Template","_c2","Width","_c3","tmp_16_0","EnableConfig","isOutDataSource","tmp_24_0","getTypeName","DynamicOut","DynamicIn","PlumbEditorComponent_Conditional_0_Conditional_2_For_1_Template","PlumbEditorComponent_Conditional_0_Conditional_2_Template","hardReset","ngAfterViewInit","PlumbEditorComponent","#plumber","#scriptLoaded$","#queryDefinitionSvc","BehaviorSubject","calculateTypeInfos","typeInfo","outMode","loadScripts","test","src","domDataSourcesLoaded$","domDataSourcesRef","changes","combineLatest","scriptLoaded","domDataSourcesLoaded","domRootRef","nativeElement","TypeNameForUi","confirm","newName","prompt","newDescription","viewQuery","PlumbEditorComponent_Conditional_0_Template","NgStyle","param_r3","RunExplorerComponent_Conditional_0_Conditional_20_For_2_Template","tmp_2_0","vsSvc","param_r4","RunExplorerComponent_Conditional_0_Conditional_24_For_2_Template","visualDesignerDataSig","RunExplorerComponent_Conditional_0_Conditional_26_Conditional_0_For_8_Template","warningSig","RunExplorerComponent_Conditional_0_Conditional_26_Conditional_0_Template","saveAndRunQuery","editPipeline","openParamsHelp","RunExplorerComponent_Conditional_0_Conditional_20_Template","RunExplorerComponent_Conditional_0_Conditional_24_Template","RunExplorerComponent_Conditional_0_Conditional_25_Template","RunExplorerComponent_Conditional_0_Conditional_26_Template","RunExplorerComponent_Conditional_0_Conditional_27_Template","openRestApi","tmp_1_0","RunExplorerComponent","#dialogRouter","context","calculateWarnings","warnings","queryParams","param","midMatch","exec","testMid","urlMid","moduleId","queryGuid","GoToDevRest","getUrlQueryDialog","RunExplorerComponent_Conditional_0_Template","VisualQueryComponent","route","explorer","activeExplorer","toggleExplorer","RouterOutlet","toBase64","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","onerror","readAsText","ExportAppPartsService","getContentInfoLiveParam","exportParts","contentTypeIds","entityIds","templateIds","ImportAppService","importApp","changedName","retryOnDuplicate","switchMap","Messages","MessageType","FileUploadMessageTypes","Warning","folderName","Text","of","getAllSig","getAllRes","importQuery","clonePipeline","update","PipelinesService","webApiEntityList","initial","res","obs","fileBase64","AppId","ContentBase64","success","Success","clonePipelinePromise"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/services/export-app.service.ts","./projects/eav-ui/src/app/app-administration/services/views.service.ts","./node_modules/@angular/cdk/fesm2022/_focus-key-manager-chunk.mjs","./projects/eav-ui/src/app/shared/helpers/array.helpers.ts","./projects/eav-ui/src/app/app-administration/services/content-types.service.ts","./projects/eav-ui/src/app/shared/directives/mousedown-stop-propagation.directive.ts","./node_modules/lodash-es/_getPrototype.js","./node_modules/lodash-es/_arrayEach.js","./node_modules/lodash-es/_baseCreate.js","./projects/eav-ui/src/app/app-administration/services/import-app-parts.service.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/datasource.helpers.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.helpers.ts","./projects/eav-ui/src/app/visual-query/services/query-definition.service.ts","./projects/eav-ui/src/app/visual-query/query-result/query-result.html","./projects/eav-ui/src/app/visual-query/query-result/query-result.ts","./projects/eav-ui/src/app/visual-query/stream-error-result/stream-error-result.ts","./projects/eav-ui/src/app/visual-query/stream-error-result/stream-error-result.html","./projects/eav-ui/src/app/visual-query/services/visual-query.service.ts","./projects/eav-ui/src/app/visual-query/add-explorer/add-explorer.html","./projects/eav-ui/src/app/visual-query/add-explorer/add-explorer.ts","./projects/eav-ui/src/app/visual-query/add-explorer/add-explorer.helpers.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/plumber-constants.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/connection-line-colors.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/connections-manager.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/rename-stream/rename-stream.html","./projects/eav-ui/src/app/visual-query/plumb-editor/rename-stream/rename-stream.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/endpoint-definitions.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/endpoints-manager.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/jsplumb-instance-manager.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/lines-decorator.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/query-data-manager.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/wirings.helper.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/plumber.helper.ts","./projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.html","./projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.ts","./projects/eav-ui/src/app/visual-query/run-explorer/run-explorer.html","./projects/eav-ui/src/app/visual-query/run-explorer/run-explorer.ts","./projects/eav-ui/src/app/visual-query/run-explorer/run-explorer.helpers.ts","./projects/eav-ui/src/app/visual-query/visual-query.ts","./projects/eav-ui/src/app/visual-query/visual-query.html","./projects/eav-ui/src/app/shared/helpers/file-to-base64.helper.ts","./projects/eav-ui/src/app/app-administration/services/export-app-parts.service.ts","./projects/eav-ui/src/app/import-app/services/import-app.service.ts","./projects/eav-ui/src/app/app-administration/services/pipelines.service.ts"],"sourcesContent":["import { httpResource } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { webApiAppRoot } from '../../import-app/services/import-app.service';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { AppInfo } from '../models/app-info.model';\r\n\r\nconst webApiAppRootStatistics = 'admin/app/Statistics';\r\nconst webApiAppRootSaveData = 'admin/app/SaveData';\r\n\r\n\r\n@Injectable()\r\nexport class ExportAppService extends HttpServiceBaseSignal {\r\n\r\n  getAppInfo() {\r\n    return httpResource<AppInfo>(() => ({\r\n      url: this.apiUrl(webApiAppRootStatistics),\r\n      params: { appid: this.appId, zoneId: this.zoneId },\r\n    }));\r\n  }\r\n\r\n  /** Generate the export app path. It can be extended with additional parameters */\r\n  exportAppUrl() {\r\n    return `${this.apiUrl(`${webApiAppRoot}Export`)}?appId=${this.appId}&zoneId=${this.zoneId}`;\r\n  }\r\n  async exportForVersionControl({ includeContentGroups, resetAppGuid, withFiles }:\r\n    { includeContentGroups: boolean; resetAppGuid: boolean; withFiles: boolean; }): Promise<number> {\r\n    return this.getStatusPromise(webApiAppRootSaveData, {\r\n      params: {\r\n        appid: this.appId,\r\n        zoneId: this.zoneId,\r\n        includeContentGroups: includeContentGroups.toString(),\r\n        resetAppGuid: resetAppGuid.toString(),\r\n        withPortalFiles: withFiles.toString(),\r\n      },\r\n    });\r\n  }\r\n\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { ViewUsage } from '../models/view-usage.model';\r\nimport { View } from '../models/view.model';\r\n\r\nconst webApiViews = 'admin/view/all';\r\nconst webApiViewDelete = 'admin/view/delete';\r\nconst webApiViewImport = 'admin/view/import';\r\n// const webApiViewPolymorph = 'admin/view/polymorphism';\r\nconst webApiViewUsage = 'admin/view/usage';\r\nconst webApiJson = 'admin/view/json';\r\n\r\nexport const Polymorphism_DS_ID = 'a495b51f-44e7-4335-81db-b8a7e33120f0'; // Polymorphism DataSource internal ID\r\n@Injectable()\r\nexport class ViewsService extends HttpServiceBaseSignal {\r\n\r\n  getAllOnce() {\r\n    return httpResource<View[]>(() => {\r\n      return ({\r\n        url: this.apiUrl(webApiViews),\r\n        params: { appId: this.appId }\r\n      });\r\n    });\r\n  }\r\n\r\n  getAllLive(refresh: Signal<unknown>) {\r\n    return httpResource<View[]>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiViews),\r\n        params: { appId: this.appId }\r\n      });\r\n    });\r\n  }\r\n\r\n  async delete(id: number): Promise<number> {\r\n    return this.getStatusPromise(webApiViewDelete, {\r\n      params: { appId: this.appId, Id: id.toString() },\r\n    });\r\n  }\r\n\r\n  import(file: File) {\r\n    const formData = new FormData();\r\n    formData.append('File', file);\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiViewImport), formData, {\r\n      params: { appId: this.appId, zoneId: this.zoneId }\r\n    });\r\n  }\r\n\r\n  export(id: number) {\r\n    const url = this.apiUrl(webApiJson)\r\n      + '?appId=' + this.appId\r\n      + '&viewId=' + id;\r\n    window.open(url, '_blank', '');\r\n  }\r\n\r\n  getUsage(guid: string) {\r\n    return this.newHttpResource<ViewUsage[]>(() => ({\r\n      url: this.apiUrl(webApiViewUsage),\r\n      params: { appId: this.appId, guid: guid }\r\n    }));\r\n  }\r\n}\r\n","import { ListKeyManager } from './_list-key-manager-chunk.mjs';\n\nclass FocusKeyManager extends ListKeyManager {\n  _origin = 'program';\n  setFocusOrigin(origin) {\n    this._origin = origin;\n    return this;\n  }\n  setActiveItem(item) {\n    super.setActiveItem(item);\n    if (this.activeItem) {\n      this.activeItem.focus(this._origin);\n    }\n  }\n}\n\nexport { FocusKeyManager };\n","export class ArrayHelpers {\r\n  /**\r\n   * Toggles an item in an array. If the item is not in the array, it is added. If it is in the array, it is removed.\r\n   * @param item The item to toggle\r\n   * @param array The array to toggle the item in\r\n   */\r\n  static toggleInArray<T>(item: T, array: T[]): T[] {\r\n    const index = array.indexOf(item);\r\n    if (index === -1) {\r\n      array.push(item);\r\n    } else {\r\n      array.splice(index, 1);\r\n    }\r\n    return array;\r\n  }\r\n\r\n  // probably better: Array.from(new Set(merged));\r\n  // static distinct<T extends unknown>(array: T[]): T[] {\r\n  //   return array.filter(onlyUnique);\r\n  // }\r\n\r\n}\r\n\r\n// function onlyUnique<T extends unknown>(value: T, index: number, array: T[]): boolean {\r\n//   return array.indexOf(value) === index;\r\n// }","import { httpResource } from '@angular/common/http';\r\nimport { computed, Injectable, Signal } from '@angular/core';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { ScopeOption } from '../../shared/constants/eav.constants';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { ContentType, ContentTypeEdit } from '../models/content-type.model';\r\nimport { ScopeDetailsDto } from '../models/scopedetails.dto';\r\n\r\n// We should list all the \"full\" paths here, so it's easier to find when searching for API calls\r\nexport const webApiTypeRoot = 'admin/type/';\r\nconst webApiTypeGet = 'admin/type/get';\r\nconst webApiTypes = 'admin/type/list';\r\nconst webApiTypeScopes = 'admin/type/scopes';\r\nconst webApiTypeSave = 'admin/type/save';\r\nconst webApiTypeDelete = 'admin/type/delete';\r\nconst webApiTypeImport = 'admin/type/import';\r\nconst webApiTypeAddGhost = 'admin/type/addghost';\r\n@Injectable()\r\nexport class ContentTypesService extends HttpServiceBase {\r\n\r\n  // TODO: @2dg, ask 2dm \r\n  // content-export.component.ts\r\n  // content-import.component.ts\r\n  // data.component.ts\r\n  retrieveContentType(nameId: string) {\r\n    return this.getHttpApiUrl<ContentType>(webApiTypeGet, {\r\n      params: { appId: this.appId, contentTypeId: nameId }\r\n    });\r\n  }\r\n\r\n  getType(nameId: string) {\r\n    return httpResource<ContentType>(() => ({\r\n      url: this.apiUrl(webApiTypeGet),\r\n      params: { appId: this.appId, contentTypeId: nameId }\r\n    }));\r\n  }\r\n\r\n  getTypes(scope: Signal<string>) {\r\n    return httpResource<ContentType[]>(() => ({\r\n      url: this.apiUrl(webApiTypes),\r\n      params: { appId: this.appId, scope: scope() }\r\n    }), {defaultValue: []});\r\n  }\r\n\r\n  retrieveContentTypesPromise(scope: string): Promise<ContentType[]> {\r\n    return this.fetchPromise<ContentType[]>(webApiTypes, {\r\n      params: { appId: this.appId, scope }\r\n    });\r\n  }\r\n\r\n  getScopesPromise(): Promise<ScopeOption[]> {\r\n    return this.fetchPromise<{ old: Record<string, string>, scopes: ScopeDetailsDto[] }>(webApiTypeScopes, {\r\n      params: { appId: this.appId }\r\n    }).then(scopesData => {\r\n      const scopes = scopesData.old;\r\n      const scopeOptions: ScopeOption[] = Object.keys(scopes).map(key => ({\r\n        name: scopes[key],\r\n        value: key,\r\n      }));\r\n      return scopeOptions;\r\n    });\r\n  }\r\n\r\n  getScopesSig() {\r\n    const scopesSignal = httpResource<{ old: Record<string, string>, scopes: ScopeDetailsDto[] }>(() => ({\r\n      url: this.apiUrl(webApiTypeScopes),\r\n      params: { appid: this.appId },\r\n    }));\r\n\r\n    const scopeOptionsSignal = computed(() => {\r\n      // Access the value property directly without calling scopesSignal as a function\r\n      const value = scopesSignal.value;\r\n      const scopesData = value();\r\n\r\n      // Add null/undefined check here\r\n      if (!scopesData || !scopesData.old) {\r\n        return []; // Return an empty array or handle this case as appropriate\r\n      }\r\n\r\n      const scopes = scopesData.old;\r\n      return Object.keys(scopes).map(key => ({ name: scopes[key], value: key }));\r\n    });\r\n\r\n    return scopeOptionsSignal;\r\n  }\r\n\r\n  getScopesV2Promise(): Promise<ScopeDetailsDto[]> {\r\n    return this.fetchPromise<{ old: Record<string, string>, scopes: ScopeDetailsDto[] }>(webApiTypeScopes, {\r\n      params: { appId: this.appId }\r\n    }).then(scopesData => scopesData.scopes);\r\n  }\r\n\r\n  save(contentType: ContentTypeEdit) {\r\n    return this.http.post<boolean>(this.apiUrl(webApiTypeSave), contentType, {\r\n      params: { appid: this.appId },\r\n    });\r\n  }\r\n\r\n  delete(contentType: ContentType) {\r\n    return this.http.delete<boolean>(this.apiUrl(webApiTypeDelete), {\r\n      params: { appid: this.appId, staticName: contentType.NameId }, // TODO: @2pp - replace staticName with NameId\r\n    });\r\n  }\r\n\r\n  import(files: File[]) {\r\n    const formData = new FormData();\r\n    for (const file of files) {\r\n      formData.append('File', file);\r\n    }\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiTypeImport), formData, {\r\n      params: { appId: this.appId, zoneId: this.zoneId },\r\n    });\r\n  }\r\n\r\n  createGhost(sourceNameId: string) {\r\n    return this.http.post<boolean>(this.apiUrl(webApiTypeAddGhost), null, {\r\n      params: { appid: this.appId, sourceNameId },\r\n    });\r\n  }\r\n}\r\n","import { Directive, HostListener } from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[appMousedownStopPropagation]',\r\n})\r\nexport class MousedownStopPropagationDirective {\r\n  @HostListener('mousedown', ['$event'])\r\n  onMousedown(event: MouseEvent): void {\r\n    event.stopPropagation();\r\n  }\r\n}\r\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\nexport default arrayEach;\n","import isObject from './isObject.js';\n\n/** Built-in value references. */\nvar objectCreate = Object.create;\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} proto The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nvar baseCreate = (function() {\n  function object() {}\n  return function(proto) {\n    if (!isObject(proto)) {\n      return {};\n    }\n    if (objectCreate) {\n      return objectCreate(proto);\n    }\n    object.prototype = proto;\n    var result = new object;\n    object.prototype = undefined;\n    return result;\n  };\n}());\n\nexport default baseCreate;\n","import { Injectable } from '@angular/core';\r\nimport { webApiAppRoot } from '../../import-app/services/import-app.service';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\n\r\nexport const webApiAppPartsRoot = 'admin/appParts/';\r\n\r\n@Injectable()\r\nexport class ImportAppPartsService extends HttpServiceBaseSignal {\r\n\r\n  importAppParts(file: File) {\r\n    const formData = new FormData();\r\n    formData.append('File', file);\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiAppPartsRoot + 'Import'), formData, {\r\n      params: { appId: this.appId, zoneId: this.zoneId }\r\n    });\r\n  }\r\n\r\n  /** Reset the App back to the state it was in the last xml export */\r\n  resetApp(withFiles: boolean) {\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiAppRoot + 'Reset'), {}, {\r\n      params: {\r\n        appId: this.appId,\r\n        zoneId: this.zoneId,\r\n        withPortalFiles: withFiles.toString(),\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { JsPlumbEndpoint } from './jsplumb.models';\r\n\r\nexport function findDefByType(dataSources: DataSourceInstance [], partAssemblyAndType: string): DataSourceInstance | undefined {\r\n  return dataSources.find(ds => ds.PartAssemblyAndType === partAssemblyAndType)\r\n}\r\n\r\nexport function getEndpointLabel(endpoint: JsPlumbEndpoint) : string {\r\n  return endpoint.getOverlay('endpointLabel').label\r\n}","import { DataSourceDefinition } from '../models/data-source-definition';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { findDefByType } from './datasource.helpers';\r\nimport { GuiTypes, TypeInfo, TypeInfos } from './plumb-editor.models';\r\n\r\nexport const guiTypes: GuiTypes = {\r\n  App: { Name: 'App', Label: 'App DataSources', Icon: 'star', UiHint: 'DataSources from the current App' },\r\n  Cache: { Name: 'Cache', Icon: 'history', UiHint: 'Caching of data' },\r\n  Filter: { Name: 'Filter', Icon: 'filter_list', UiHint: 'Filter data - usually returning less items than came in' },\r\n  Logic: { Name: 'Logic', Icon: 'share', UiHint: 'Logic operations - usually choosing between different streams' },\r\n  Lookup: { Name: 'Lookup', Icon: 'search', UiHint: 'Lookup operation - usually looking for other data based on a criteria' },\r\n  Modify: { Name: 'Modify', Icon: 'edit_attributes', UiHint: 'Modify data - usually changing, adding or removing values' },\r\n  Security: { Name: 'Security', Icon: 'account_circle', UiHint: 'Security - usually limit what the user sees based on his identity' },\r\n  Sort: { Name: 'Sort', Icon: 'sort', UiHint: 'Sort the items' },\r\n  Source: { Name: 'Source', Icon: 'cloud_upload', UiHint: 'Source of new data - usually SQL, CSV or similar' },\r\n  Target: { Name: 'Target', Icon: 'adjust', UiHint: 'Target - usually just a destination of data' },\r\n  Unknown: { Name: 'Unknown', Icon: 'fiber_manual_record', UiHint: 'Unknown type' },\r\n  Debug: { Name: 'Debug', Icon: 'bug_report', UiHint: 'Debugging Tools' },\r\n  System: { Name: 'System', Icon: 'military_tech', UiHint: 'System Data' },\r\n};\r\n\r\nexport function calculateTypeInfos(pipelineDataSources: DataSourceDefinition[], dataSources: DataSourceInstance[]) {\r\n  const typeInfos: TypeInfos = {};\r\n\r\n  for (const pipelineDataSource of pipelineDataSources) {\r\n    const ds = findDefByType(dataSources, pipelineDataSource.PartAssemblyAndType);\r\n    const typeInfo: TypeInfo = (ds)\r\n      ? {\r\n        ...(ds.PrimaryType ? guiTypes[ds.PrimaryType] : guiTypes.Unknown),\r\n\r\n        DynamicIn: ds.DynamicIn ?? false,\r\n        DynamicOut: ds.OutMode != 'static',\r\n        Icon: ds.Icon,\r\n        UiHint: ds.UiHint,\r\n        HelpLink: ds.HelpLink,\r\n        outMode: ds.OutMode,\r\n        // ...(ds.Icon ? { Icon: ds.Icon } : {}),\r\n        // ...(ds.UiHint ? { UiHint: ds.UiHint } : {}),\r\n        // ...(ds.OutMode != null ? { OutMode: ds.OutMode } : {}),\r\n        // ...(ds.HelpLink != null ? { HelpLink: ds.HelpLink } : {}),\r\n        ...(ds.EnableConfig != null ? { EnableConfig: ds.EnableConfig } : {}),\r\n      } satisfies TypeInfo\r\n      : {\r\n        ...guiTypes.Unknown,\r\n        DynamicOut: false,\r\n        DynamicIn: false,\r\n        outMode: 'static',\r\n      };\r\n      // console.log(\"2dm test\", pipelineDataSource, ds, typeInfo);\r\n    \r\n    typeInfos[pipelineDataSource.EntityGuid] = typeInfo;\r\n  }\r\n\r\n  return typeInfos;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { map } from 'rxjs';\r\nimport { webApiQueryDataSources, webApiQueryDebugStream, webApiQueryGet, webApiQueryRun, webApiQuerySave } from '../../app-administration/services';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { DataSourceDefinition } from '../models/data-source-definition';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { QueryResult } from '../models/result/pipeline-result';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\nimport { findDefByType } from '../plumb-editor/datasource.helpers';\r\n\r\n@Injectable()\r\nexport class QueryDefinitionService extends HttpServiceBaseSignal {\r\n\r\n  fetchPipelinePromise(pipelineEntityId: number, dataSources: DataSourceInstance[]): Promise<VisualQueryModel> {\r\n    return this.fetchPromise<VisualQueryModel>(webApiQueryGet, {\r\n      params: { appId: this.appId, id: pipelineEntityId.toString() }\r\n    }).then(pipelineModel => {\r\n      // if pipeline is new, populate it with default model\r\n      if (!pipelineModel.DataSources.length) {\r\n        this.#buildDefaultModel(pipelineModel, dataSources);\r\n      }\r\n      this.#fixPipelineDataSources(pipelineModel.DataSources);\r\n      return pipelineModel;\r\n    })\r\n  }\r\n\r\n  #buildDefaultModel(pipelineModel: VisualQueryModel, dataSources: DataSourceInstance[]) {\r\n    const templateDataSources = eavConstants.pipelineDesigner.defaultPipeline.dataSources;\r\n    for (const templateDS of templateDataSources) {\r\n      const dataSource = findDefByType(dataSources, templateDS.PartAssemblyAndType);\r\n      const pipelineDataSource: DataSourceDefinition = {\r\n        Description: '',\r\n        EntityGuid: templateDS.EntityGuid,\r\n        EntityId: undefined,\r\n        Name: dataSource.Name,\r\n        PartAssemblyAndType: templateDS.PartAssemblyAndType,\r\n        VisualDesignerData: templateDS.VisualDesignerData,\r\n      };\r\n      pipelineModel.DataSources.push(pipelineDataSource);\r\n    }\r\n\r\n    pipelineModel.Pipeline.StreamWiring = eavConstants.pipelineDesigner.defaultPipeline.streamWiring;\r\n  }\r\n\r\n  #fixPipelineDataSources(pipelineDataSources: DataSourceDefinition[]) {\r\n    const outDataSourceExists = pipelineDataSources.some(\r\n      pipelineDS => pipelineDS.EntityGuid === eavConstants.pipelineDesigner.outDataSource.EntityGuid\r\n    );\r\n    if (!outDataSourceExists) {\r\n      const outDs = eavConstants.pipelineDesigner.outDataSource;\r\n      const outDsConst: DataSourceDefinition = {\r\n        Description: outDs.Description,\r\n        EntityGuid: outDs.EntityGuid,\r\n        EntityId: undefined,\r\n        Name: outDs.Name,\r\n        PartAssemblyAndType: outDs.PartAssemblyAndType,\r\n        VisualDesignerData: outDs.VisualDesignerData,\r\n      };\r\n      pipelineDataSources.push(outDsConst);\r\n    }\r\n\r\n    for (const pipelineDataSource of pipelineDataSources) {\r\n      pipelineDataSource.VisualDesignerData ??= { Top: 50, Left: 50 };\r\n    }\r\n  }\r\n\r\n  fetchDataSourcesPromise(): Promise<DataSourceInstance[]> {\r\n    return this.fetchPromise<DataSourceInstance[]>(webApiQueryDataSources, {\r\n      params: {\r\n        appid: this.appId,\r\n        zoneId: this.zoneId,\r\n      },\r\n    }).then(dataSources => {\r\n      // Add the final target DataSource to the list of DataSources\r\n      dataSources.push(eavConstants.pipelineDesigner.outFinalTarget);\r\n      return dataSources;\r\n    })\r\n  };\r\n\r\n  typeNameFilter(input: string, format: 'className' | 'classFullName') {\r\n    const globalParts = input.split(', ');\r\n\r\n    switch (format) {\r\n      case 'classFullName':\r\n        const classFullName = globalParts[0];\r\n        return classFullName;\r\n      case 'className':\r\n        const classFullNameParts = globalParts[0].split('.');\r\n        const className = classFullNameParts[classFullNameParts.length - 1];\r\n        return className;\r\n      default:\r\n        return input;\r\n    }\r\n  }\r\n\r\n  /** Save the current query and reload entire definition as returned from server */\r\n  savePipeline(pipelineModel: VisualQueryModel) {\r\n    const pipeline = pipelineModel.Pipeline;\r\n    const dataSources = pipelineModel.DataSources;\r\n\r\n    return this.http.post<VisualQueryModel>(\r\n      webApiQuerySave,\r\n      { pipeline, dataSources },\r\n      { params: { appId: this.appId, Id: pipeline.EntityId.toString() } }\r\n    ).pipe(\r\n      map(newPipelineModel => {\r\n        this.#fixPipelineDataSources(newPipelineModel.DataSources);\r\n        return newPipelineModel;\r\n      }),\r\n    );\r\n  }\r\n\r\n  /** `top` - fetch first X items */\r\n  runPipelinePromise(id: number, top: number): Promise<QueryResult> {\r\n    return this.fetchPromise<QueryResult>(webApiQueryRun, {\r\n      params: { appId: this.appId, id: id.toString(), top: top.toString() }\r\n    });\r\n  }\r\n\r\n  /** `top` - fetch first X items */\r\n  debugStreamPromise(id: number, source: string, sourceOut: string, top: number): Promise<QueryResult> {\r\n    return this.fetchPromise<QueryResult>(webApiQueryDebugStream, {\r\n      params: { appId: this.appId, id: id.toString(), from: source, out: sourceOut, top: top.toString() }\r\n    });\r\n  }\r\n\r\n}\r\n","<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">\r\n      Query Results\r\n      @if (debugStream) {\r\n        for Stream: \"{{ debugStream.name }}\" on Source: \"{{ debugStream.sourceName }}\"\r\n      }\r\n    </div>\r\n    <button mat-icon-button tippy=\"Close dialog\" (click)=\"closeDialog()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"eav-dialog-content\">\r\n    <p>\r\n      The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in {{ timeUsed }}ms ({{\r\n        ticksUsed\r\n      }}\r\n      ticks)\r\n    </p>\r\n\r\n    <mat-tab-group dynamicHeight color=\"accent\" class=\"eav-tab-group\">\r\n      <!-- Results -->\r\n      <mat-tab>\r\n        <div *matTabLabel class=\"mat-tab-label-box\" tippy=\"Results\">\r\n          <span>Results</span>\r\n        </div>\r\n        <div class=\"eav-tab-content\">\r\n          <div class=\"eav-tab-description\">\r\n            <div>\r\n              @if (top === 0) {\r\n                Showing All results\r\n              }\r\n              @if (top !== 0) {\r\n                Showing top {{ top }} results\r\n              }\r\n            </div>\r\n            <div>\r\n              @for (option of optionsForTop; track option) {\r\n                <button mat-button (click)=\"show(option)\">\r\n                  Show\r\n                  @if (option === 0) {\r\n                    All\r\n                  }\r\n                  @if (option !== 0) {\r\n                    {{ option }}\r\n                  }\r\n                </button>\r\n              }\r\n            </div>\r\n          </div>\r\n\r\n          <mat-tab-group dynamicHeight color=\"accent\" class=\"eav-tab-group\">\r\n            @for (res of result; track res)\r\n            {\r\n              <mat-tab>\r\n                <div *matTabLabel class=\"mat-tab-label-box\" tippy=\"Result as JSON\">\r\n                  <span>{{ res.name }}</span>\r\n                </div>\r\n\r\n                <div class=\"eav-tab-inner-content\">\r\n                  <pre>{{ res.data | json }}</pre>\r\n                </div>\r\n              </mat-tab>\r\n            }\r\n          </mat-tab-group>\r\n        </div>\r\n      </mat-tab>\r\n\r\n      @if (parameters?.length) {\r\n        <!-- Parameters -->\r\n        <mat-tab>\r\n          <div *matTabLabel class=\"mat-tab-label-box\" tippy=\"Parameters\">\r\n            <span>Parameters</span>\r\n          </div>\r\n\r\n          <div class=\"eav-tab-content\">\r\n            <ul>\r\n              @for (param of parameters; track param) {\r\n                <li>{{ param }}</li>\r\n              }\r\n            </ul>\r\n          </div>\r\n        </mat-tab>\r\n      }\r\n\r\n      <!-- Sources -->\r\n      <mat-tab>\r\n        <div *matTabLabel class=\"mat-tab-label-box\" tippy=\"Sources\">\r\n          <span>Sources</span>\r\n        </div>\r\n\r\n        <div class=\"eav-tab-content\">\r\n          <table>\r\n            <tr>\r\n              <th>Name and Guid</th>\r\n              <th>Type</th>\r\n              <th>Configuration</th>\r\n              <th>Error</th>\r\n            </tr>\r\n            @for (source of sources | keyvalue; track source) {\r\n              <tr>\r\n                <td>\r\n                  @if (source.value.Definition?.Name) {\r\n                    <div>{{ source.value.Definition?.Name }}</div>\r\n                  }\r\n                  <pre>{{ source.value.Guid }}</pre>\r\n                </td>\r\n                <td>{{ source.value.Type }}</td>\r\n                <td>\r\n                  <ol>\r\n                    @for (config of source.value.Configuration | keyvalue; track config) {\r\n                      <li>\r\n                        <b>{{ config.key }}</b\r\n                        >=<em>{{ config.value }}</em>\r\n                      </li>\r\n                    }\r\n                  </ol>\r\n                </td>\r\n                <td>{{ source.value.Error }}</td>\r\n              </tr>\r\n            }\r\n          </table>\r\n        </div>\r\n      </mat-tab>\r\n\r\n      <!-- Streams -->\r\n      <mat-tab>\r\n        <div *matTabLabel class=\"mat-tab-label-box\" tippy=\"Streams\">\r\n          <span>Streams</span>\r\n        </div>\r\n\r\n        <div class=\"eav-tab-content\">\r\n          <table>\r\n            <tr>\r\n              <th>Source</th>\r\n              <th>Target</th>\r\n              <th>Items</th>\r\n              <th>Error</th>\r\n            </tr>\r\n            @for (stream of streams; track stream) {\r\n              <tr>\r\n                <td>\r\n                  <pre>{{ stream.Source + ':' + stream.SourceOut }}</pre>\r\n                </td>\r\n                <td>\r\n                  <pre>{{ stream.Target + ':' + stream.TargetIn }}</pre>\r\n                </td>\r\n                <td>{{ stream.Count }}</td>\r\n                <td>{{ stream.Error }}</td>\r\n              </tr>\r\n            }\r\n          </table>\r\n        </div>\r\n      </mat-tab>\r\n    </mat-tab-group>\r\n  </div>\r\n</div>\r\n","import { JsonPipe, KeyValuePipe } from '@angular/common';\r\nimport { Component, Inject, OnInit } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { DebugStreamInfo } from '../models/debug-stream-info.model';\r\nimport { QueryResult } from '../models/result/pipeline-result';\r\nimport { VisualQueryStateService } from '../services/visual-query.service';\r\nimport { QueryResultDialogData } from './query-result.models';\r\n\r\n@Component({\r\n    selector: 'app-query-result',\r\n    templateUrl: './query-result.html',\r\n    styleUrls: ['./query-result.scss'],\r\n    imports: [\r\n        MatButtonModule,\r\n        MatIconModule,\r\n        MatTabsModule,\r\n        JsonPipe,\r\n        KeyValuePipe,\r\n    ]\r\n})\r\nexport class QueryResultComponent implements OnInit {\r\n  parameters: string[];\r\n  timeUsed: number;\r\n  ticksUsed: number;\r\n  top: number;\r\n  optionsForTop: number[];\r\n  result: Record<string, unknown>[];\r\n  debugStream: DebugStreamInfo;\r\n  sources: QueryResult[\"Sources\"];\r\n  streams: QueryResult[\"Streams\"];\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) private dialogData: QueryResultDialogData,\r\n    private dialog: MatDialogRef<QueryResultComponent>,\r\n    private visualQueryService: VisualQueryStateService,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    const pipeline = this.visualQueryService.pipelineModel().Pipeline;\r\n    const params = (pipeline.Params?.split('\\n') ?? []).filter(el => !!el);\r\n    const testParams = (pipeline.TestParameters?.split('\\n') ?? []).filter(el => !!el);\r\n    this.parameters = [].concat(params, testParams);\r\n    this.timeUsed = this.dialogData.result.QueryTimer.Milliseconds;\r\n    this.ticksUsed = this.dialogData.result.QueryTimer.Ticks;\r\n    this.top = this.dialogData.top;\r\n    this.optionsForTop = [25, 100, 1000, 0];\r\n\r\n    const result = this.dialogData.result.Query;\r\n    const streamTabs = Object.keys(result).map(key => ({\r\n      name: key + ' (' + Object.keys(result[key]).length + ')',\r\n      data: { [key]: result[key] }\r\n    }));\r\n    this.result = [\r\n      { name: 'All Data', data: result },\r\n      ...streamTabs\r\n    ];\r\n\r\n    this.debugStream = this.dialogData.debugStream;\r\n    this.sources = this.dialogData.result.Sources;\r\n    this.streams = this.dialogData.result.Streams;\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialog.close();\r\n  }\r\n\r\n  show(top: number) {\r\n    if (top === this.top) return;\r\n\r\n    if (this.debugStream) {\r\n      this.visualQueryService.debugStream(this.debugStream.original, top);\r\n    } else {\r\n      this.visualQueryService.runPipeline(top);\r\n    }\r\n\r\n    this.closeDialog();\r\n  }\r\n}\r\n","import { JsonPipe } from '@angular/common';\r\nimport { Component, Inject, OnInit } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MAT_DIALOG_DATA, MatDialogActions, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { EavWindow } from '../../shared/models/eav-window.model';\r\nimport { StreamErrorData } from '../models/result/StreamErrorData';\r\nimport { StreamErrorResultDialogData } from './stream-error-result.models';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n@Component({\r\n    selector: 'app-stream-error-result',\r\n    templateUrl: './stream-error-result.html',\r\n    styleUrls: ['./stream-error-result.scss'],\r\n    imports: [\r\n        MatButtonModule,\r\n        MatIconModule,\r\n        MatDialogActions,\r\n        JsonPipe,\r\n    ]\r\n})\r\nexport class StreamErrorResultComponent implements OnInit {\r\n  errorData: StreamErrorData;\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) private dialogData: StreamErrorResultDialogData,\r\n    private dialog: MatDialogRef<StreamErrorResultComponent>,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.errorData = this.dialogData.errorData;\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialog.close();\r\n  }\r\n\r\n  openInsights() {\r\n    window.open(window.$2sxc.http.apiUrl('sys/insights/logs?key=web-api-query'), '_blank');\r\n  }\r\n}\r\n","<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">Stream Error Results</div>\r\n    <button mat-icon-button tippy=\"Close dialog\" (click)=\"closeDialog()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n  <div class=\"eav-dialog-content\">\r\n    <pre>{{ errorData | json }}</pre>\r\n  </div>\r\n  <mat-dialog-actions align=\"end\">\r\n    <button mat-button class=\"eav-button__with-icon\" tippy=\"Open 2sxc Insights\" (click)=\"openInsights()\">\r\n      <mat-icon class=\"eav-icon\">speed</mat-icon>\r\n      <span>Insights</span>\r\n    </button>\r\n  </mat-dialog-actions>\r\n</div>\r\n","import { HttpErrorResponse } from '@angular/common/http';\r\nimport { ChangeDetectorRef, Injectable, NgZone, OnDestroy, signal, ViewContainerRef } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { Title } from '@angular/platform-browser';\r\nimport cloneDeep from 'lodash-es/cloneDeep';\r\nimport { filter, fromEvent, Subject } from 'rxjs';\r\nimport { ContentTypesService } from '../../app-administration/services/content-types.service';\r\nimport { MetadataService } from '../../permissions/services/metadata.service';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { convertFormToUrl } from '../../shared/helpers/url-prep.helper';\r\nimport { EditForm } from '../../shared/models/edit-form.model';\r\nimport { ItemIdHelper } from '../../shared/models/item-id-helper';\r\nimport { QueryDefinitionService } from './query-definition.service';\r\n// tslint:disable-next-line:max-line-length\r\nimport { transient } from '../../../../../core';\r\nimport { isCtrlS } from '../../edit/dialog/main/keyboard-shortcuts';\r\nimport { JsonHelpers } from '../../shared/helpers/json.helpers';\r\nimport { DialogRoutingService } from '../../shared/routing/dialog-routing.service';\r\nimport { ServiceBase } from '../../shared/services/service-base';\r\nimport { DataSourceConfig } from '../models/data-source-configs.model';\r\nimport { DataSourceDefinition } from '../models/data-source-definition';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { DebugStreamInfo } from '../models/debug-stream-info.model';\r\nimport { QueryResult } from '../models/result/pipeline-result';\r\nimport { QueryStreamResult } from '../models/result/PipelineResultStream';\r\nimport { StreamWire } from '../models/stream-wire';\r\nimport { VisualDesignerData } from '../models/visual-designer-data';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\nimport { findDefByType } from '../plumb-editor/datasource.helpers';\r\nimport { QueryResultComponent } from '../query-result/query-result';\r\nimport { QueryResultDialogData } from '../query-result/query-result.models';\r\nimport { StreamErrorResultComponent } from '../stream-error-result/stream-error-result';\r\nimport { StreamErrorResultDialogData } from '../stream-error-result/stream-error-result.models';\r\n\r\n/**\r\n * Service containing the state for the visual query.\r\n * It's shared, so should not be used with transient(...);\r\n */\r\n@Injectable()\r\nexport class VisualQueryStateService extends ServiceBase implements OnDestroy {\r\n\r\n  #contentTypesSvc = transient(ContentTypesService);\r\n  #metadataSvc = transient(MetadataService);\r\n  #queryDefSvc = transient(QueryDefinitionService);\r\n  #dialogRoute = transient(DialogRoutingService);\r\n  #titleSvc = transient(Title);\r\n\r\n  pipelineModel = signal<VisualQueryModel>(null);\r\n  dataSources = signal<DataSourceInstance[]>(null);\r\n  dataSourceConfigs = signal<Record<number, DataSourceConfig[]>>({});\r\n\r\n  putEntityCountOnConnections$ = new Subject<QueryResult>();\r\n\r\n  queryResult?: QueryResult;\r\n\r\n  #pipelineId = parseInt(this.#dialogRoute.getParam('pipelineId'), 10);\r\n  #refreshPipeline = false;\r\n  #refreshDataSourceConfigs = false;\r\n\r\n  constructor(\r\n    private snackBar: MatSnackBar,\r\n    private matDialog: MatDialog,\r\n    private viewContainerRef: ViewContainerRef,\r\n    private zone: NgZone,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.putEntityCountOnConnections$.complete();\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  init() {\r\n    this.#fetchDataSources(() => this.#fetchPipeline(true, true, false));\r\n    this.#attachKeyboardSave();\r\n    this.#dialogRoute.doOnDialogClosed(() => {\r\n      if (this.#refreshPipeline || this.#refreshDataSourceConfigs)\r\n        this.#fetchPipeline(this.#refreshPipeline, this.#refreshDataSourceConfigs, this.#refreshPipeline);\r\n      this.#refreshPipeline = false;\r\n      this.#refreshDataSourceConfigs = false;\r\n    });\r\n  }\r\n\r\n  public editPipelineEntity() {\r\n    // save Pipeline, then open Edit Dialog\r\n    this.#savePipeline(() => {\r\n      const form: EditForm = {\r\n        items: [ItemIdHelper.editId(this.pipelineModel().Pipeline.EntityId)],\r\n      };\r\n      const formUrl = convertFormToUrl(form);\r\n      this.#dialogRoute.navRelative([`edit/${formUrl}`]);\r\n      this.#refreshPipeline = true;\r\n    });\r\n  }\r\n\r\n  public saveAndRun(save: boolean, run: boolean): void {\r\n    if (save && run)\r\n      return this.#savePipeline(() => this.runPipeline());\r\n\r\n    if (save)\r\n      return this.#savePipeline();\r\n\r\n    if (run)\r\n      return this.runPipeline();\r\n  }\r\n\r\n  showDataSourceDetails(showDetails: boolean) {\r\n    const query = cloneDeep(this.pipelineModel());\r\n    const designerData: Record<string, any> = JsonHelpers.tryParse(query.Pipeline.VisualDesignerData) ?? {};\r\n    designerData.ShowDataSourceDetails = showDetails;\r\n    query.Pipeline.VisualDesignerData = JSON.stringify(designerData);\r\n    this.pipelineModel.set(query);\r\n  }\r\n\r\n  addDataSource(dataSource: DataSourceInstance) {\r\n    const query = cloneDeep(this.pipelineModel());\r\n    const newSource: DataSourceDefinition = {\r\n      Description: '',\r\n      EntityGuid: 'unsaved' + (query.DataSources.length + 1),\r\n      EntityId: undefined,\r\n      Name: dataSource.Name,\r\n      PartAssemblyAndType: dataSource.PartAssemblyAndType,\r\n      VisualDesignerData: { Top: 100, Left: 100 },\r\n    };\r\n    query.DataSources.push(newSource);\r\n    this.pipelineModel.set(query);\r\n    this.#savePipeline();\r\n  }\r\n\r\n  removeDataSource(pipelineDataSourceGuid: string, connections: StreamWire[], streamsOut: string) {\r\n    const query = cloneDeep(this.pipelineModel());\r\n    query.DataSources = query.DataSources.filter(pipelineDS => pipelineDS.EntityGuid !== pipelineDataSourceGuid);\r\n    query.Pipeline.StreamWiring = connections;\r\n    query.Pipeline.StreamsOut = streamsOut;\r\n    this.pipelineModel.set(query);\r\n  }\r\n\r\n  renameDataSource(pipelineDataSourceGuid: string, name: string) {\r\n    const query = cloneDeep(this.pipelineModel());\r\n    const dataSource = query.DataSources.find(pipelineDS => pipelineDS.EntityGuid === pipelineDataSourceGuid);\r\n    dataSource.Name = name;\r\n    this.pipelineModel.set(query);\r\n  }\r\n\r\n  changeDataSourceDescription(pipelineDataSourceGuid: string, description: string) {\r\n    const query = cloneDeep(this.pipelineModel());\r\n    const dataSource = query.DataSources.find(pipelineDS => pipelineDS.EntityGuid === pipelineDataSourceGuid);\r\n    dataSource.Description = description;\r\n    this.pipelineModel.set(query);\r\n  }\r\n\r\n  changeConnections(connections: StreamWire[], streamsOut: string) {\r\n    const query = cloneDeep(this.pipelineModel());\r\n    query.Pipeline.StreamWiring = connections;\r\n    query.Pipeline.StreamsOut = streamsOut;\r\n    this.pipelineModel.set(query);\r\n  }\r\n\r\n  changeDataSourcePosition(pipelineDataSourceGuid: string, position: VisualDesignerData) {\r\n    const query = cloneDeep(this.pipelineModel());\r\n    const dataSource = query.DataSources.find(pipelineDS => pipelineDS.EntityGuid === pipelineDataSourceGuid);\r\n    if (!dataSource) {\r\n      // spm NOTE: fixes problem where dataSource position can't be updated if dataSource with guid unsavedXX gets saved while dragging.\r\n      // Can happen if dataSource is just added and user drags it and save happens.\r\n      return;\r\n    }\r\n    dataSource.VisualDesignerData = { ...dataSource.VisualDesignerData, ...position };\r\n    this.pipelineModel.set(query);\r\n  }\r\n\r\n  #calculateDataSourceConfigs(dataSources: DataSourceDefinition[]) {\r\n    const dataSourceConfigs: Record<number, DataSourceConfig[]> = {};\r\n    dataSources.forEach(dataSource => {\r\n      if (dataSource.EntityId == null)\r\n        return;\r\n      dataSourceConfigs[dataSource.EntityId] = [];\r\n      dataSource.Metadata?.forEach(metadataItem => {\r\n        Object.entries(metadataItem).forEach(([attributeName, attributeValue]) => {\r\n          if (attributeValue == null || attributeValue === '')\r\n            return;\r\n          if (['Created', 'Guid', 'Id', 'Modified', 'Title', '_Type'].includes(attributeName))\r\n            return;\r\n          if (Array.isArray(attributeValue) && attributeValue[0]?.Title !== null && attributeValue[0]?.Id !== null) {\r\n            attributeValue = `${attributeValue[0].Title} (${attributeValue[0].Id})`;\r\n          }\r\n          const dataSourceConfig: DataSourceConfig = {\r\n            name: attributeName,\r\n            value: attributeValue,\r\n          };\r\n          dataSourceConfigs[dataSource.EntityId].push(dataSourceConfig);\r\n        });\r\n      });\r\n    });\r\n    this.dataSourceConfigs.set(dataSourceConfigs);\r\n  }\r\n\r\n  editDataSource(pipelineDataSource: DataSourceDefinition) {\r\n    const dataSource = findDefByType(this.dataSources(), pipelineDataSource.PartAssemblyAndType);\r\n    const contentTypeName = dataSource.ContentType;\r\n    const { targetType, keyType } = eavConstants.metadata.entity;\r\n    const key = pipelineDataSource.EntityGuid;\r\n\r\n    // query for existing Entity\r\n    this.#metadataSvc.getMetadataPromise(targetType, keyType, key, contentTypeName).then(metadata => {\r\n      // edit existing Entity\r\n      if (metadata.Items.length) {\r\n        const form: EditForm = {\r\n          items: [ItemIdHelper.editId(metadata.Items[0].Id)],\r\n        };\r\n        const formUrl = convertFormToUrl(form);\r\n        this.#dialogRoute.navRelative([`edit/${formUrl}`]);\r\n        this.#refreshDataSourceConfigs = true;\r\n        return;\r\n      }\r\n\r\n      // Check if the type exists, and if yes, create new Entity\r\n      this.#contentTypesSvc.retrieveContentType(contentTypeName).subscribe({\r\n        next: contentType => {\r\n          if (contentType == null) {\r\n            this.snackBar.open('DataSource doesn\\'t have any configuration', undefined, { duration: 3000 });\r\n            return;\r\n          }\r\n          const form: EditForm = {\r\n            items: [ItemIdHelper.newMetadata(key, contentTypeName, eavConstants.metadata.entity)],\r\n          };\r\n          const formUrl = convertFormToUrl(form);\r\n          this.#dialogRoute.navRelative([`edit/${formUrl}`]);\r\n          this.#refreshDataSourceConfigs = true;\r\n        },\r\n        error: (error: HttpErrorResponse) => {\r\n          const message = 'Server reports error - this usually means that this DataSource doesn\\'t have any configuration';\r\n          this.snackBar.open(message, undefined, { duration: 3000 });\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  #savePipeline(callback?: () => void) {\r\n    this.snackBar.open('Saving...');\r\n    this.#queryDefSvc.savePipeline(this.pipelineModel()).subscribe({\r\n      next: pipelineModel => {\r\n        this.snackBar.open('Saved', null, { duration: 2000 });\r\n        this.pipelineModel.set(pipelineModel);\r\n        if (callback != null) { callback(); }\r\n      },\r\n      error: (error: HttpErrorResponse) => {\r\n        this.snackBar.open('Save Pipeline failed', null, { duration: 2000 });\r\n      }\r\n    });\r\n  }\r\n\r\n  runPipeline(top = 25) {\r\n    this.snackBar.open('Running query...');\r\n    this.#queryDefSvc.runPipelinePromise(this.pipelineModel().Pipeline.EntityId, top)\r\n      .then(pipelineResult => {\r\n        this.snackBar.open('Query worked', null, { duration: 2000 });\r\n        this.queryResult = pipelineResult;\r\n        this.#showQueryResult(pipelineResult, top);\r\n        console.warn(pipelineResult);\r\n        this.pipelineModel.set(cloneDeep(this.pipelineModel()));\r\n        setTimeout(() => { this.putEntityCountOnConnections$.next(pipelineResult); });\r\n      })\r\n      .catch((error: HttpErrorResponse) => {\r\n        this.snackBar.open('Query failed', null, { duration: 2000 });\r\n      });\r\n  }\r\n\r\n  debugStream(stream: QueryStreamResult, top = 25): void {\r\n    if (stream.Error)\r\n      return this.#showStreamErrorResult(stream);\r\n\r\n    if (stream.Count === 0)\r\n      return;\r\n\r\n    this.snackBar.open('Running stream...');\r\n    const pipelineId = this.pipelineModel().Pipeline.EntityId;\r\n\r\n    this.#queryDefSvc.debugStreamPromise(pipelineId, stream.Source, stream.SourceOut, top)\r\n      .then(streamResult => {\r\n        this.snackBar.open('Stream worked', null, { duration: 2000 });\r\n        const pipelineDataSource = this.pipelineModel().DataSources.find(ds => ds.EntityGuid === stream.Source);\r\n        const debugStream: DebugStreamInfo = {\r\n          name: stream.SourceOut,\r\n          source: stream.Source,\r\n          sourceName: pipelineDataSource?.Name,\r\n          original: stream,\r\n        };\r\n        this.#showQueryResult(streamResult, top, debugStream);\r\n        console.warn(streamResult);\r\n      })\r\n      .catch((_error: HttpErrorResponse) => {\r\n        this.snackBar.open('Stream failed', null, { duration: 2000 });\r\n      });\r\n  }\r\n\r\n\r\n  #fetchPipeline(refreshPipeline: boolean, refreshDataSourceConfigs: boolean, showSnackBar: boolean) {\r\n    if (showSnackBar)\r\n      this.snackBar.open('Reloading query, please wait...');\r\n\r\n    this.#queryDefSvc.fetchPipelinePromise(this.#pipelineId, this.dataSources()).then(pipelineModel => {\r\n      if (showSnackBar)\r\n        this.snackBar.open('Query reloaded', null, { duration: 2000 });\r\n\r\n      this.#titleSvc.setTitle(`${pipelineModel.Pipeline.Name} - Visual Query`);\r\n\r\n      if (refreshPipeline)\r\n        this.pipelineModel.set(pipelineModel);\r\n\r\n      if (refreshDataSourceConfigs)\r\n        this.#calculateDataSourceConfigs(pipelineModel.DataSources);\r\n    });\r\n  }\r\n\r\n  #showQueryResult(result: QueryResult, top: number, debugStream?: DebugStreamInfo) {\r\n    const dialogData: QueryResultDialogData = {\r\n      result,\r\n      debugStream,\r\n      top,\r\n    };\r\n    this.matDialog.open(QueryResultComponent, {\r\n      autoFocus: false,\r\n      backdropClass: 'dialog-backdrop',\r\n      closeOnNavigation: false,\r\n      data: dialogData,\r\n      panelClass: ['dialog-panel', `dialog-panel-medium`, 'no-scrollbar'],\r\n      // spm NOTE: position used to force align-items: flex-start; on cdk-global-overlay-wrapper.\r\n      // Real top margin is overwritten in css e.g. dialog-panel-large\r\n      position: { top: '0' },\r\n      viewContainerRef: this.viewContainerRef,\r\n    });\r\n    this.changeDetectorRef.markForCheck();\r\n  }\r\n\r\n  #showStreamErrorResult(stream: QueryStreamResult) {\r\n    const dialogData: StreamErrorResultDialogData = {\r\n      errorData: stream.ErrorData,\r\n    };\r\n    this.matDialog.open(StreamErrorResultComponent, {\r\n      autoFocus: false,\r\n      backdropClass: 'dialog-backdrop',\r\n      closeOnNavigation: false,\r\n      data: dialogData,\r\n      panelClass: ['dialog-panel', `dialog-panel-medium`, 'no-scrollbar'],\r\n      // spm NOTE: position used to force align-items: flex-start; on cdk-global-overlay-wrapper.\r\n      // Real top margin is overwritten in css e.g. dialog-panel-large\r\n      position: { top: '0' },\r\n      viewContainerRef: this.viewContainerRef,\r\n    });\r\n    this.changeDetectorRef.markForCheck();\r\n  }\r\n\r\n  #fetchDataSources(callback?: () => void) {\r\n    this.#queryDefSvc.fetchDataSourcesPromise().then(dataSources => {\r\n      this.dataSources.set(dataSources);\r\n      callback();\r\n    });\r\n  }\r\n\r\n  #attachKeyboardSave() {\r\n    this.zone.runOutsideAngular(() => {\r\n      this.subscriptions.add(\r\n        fromEvent<KeyboardEvent>(window, 'keydown').pipe(\r\n          filter(() => !this.#dialogRoute.snapshot.firstChild),\r\n          filter(event => isCtrlS(event)),\r\n        ).subscribe(event => {\r\n          event.preventDefault();\r\n          this.zone.run(() => { this.#savePipeline(); });\r\n        })\r\n      );\r\n    });\r\n  }\r\n}\r\n","@if (sorted()) {\r\n  <div class=\"editor-active-explorer fancy-scrollbar-dark\">\r\n    <div class=\"eav-show-advanced\">\r\n      <span class=\"eav-slide-toggle-label\">Show Advanced</span>\r\n      <mat-slide-toggle color=\"primary\" (change)=\"toggleDifficulty($event)\" />\r\n    </div>\r\n    @for (group of sorted() | keyvalue; track trackGroups($index, group)) {\r\n      <div class=\"collapsible\" [tippy]=\"guiTypes[group.key].UiHint || group.key\" tippyShowDelay=\"750\"\r\n        (click)=\"toggleItem(group.key)\">\r\n        <mat-icon>{{ guiTypes[group.key].Icon || guiTypes.Unknown.Icon }}</mat-icon>\r\n        <span>{{ guiTypes[group.key].Label ?? guiTypes[group.key].Name ?? group.key }}</span>\r\n      </div>\r\n      @if (toggledItems.includes(group.key)) {\r\n        <div class=\"list\">\r\n          @for (dataSource of group.value; track trackDataSources($index, dataSource)) {\r\n            <div class=\"list-item\"\r\n              [tippy]=\"dataSource.UiHint || dataSource.Name\" tippyShowDelay=\"750\" (click)=\"addDataSource(dataSource)\">\r\n              <mat-icon>{{ dataSource.Icon || guiTypes.Unknown.Icon }}</mat-icon>\r\n              <span>{{ dataSource.Name }}</span>\r\n            </div>\r\n          }\r\n        </div>\r\n      }\r\n    }\r\n  </div>\r\n}\r\n","import { KeyValue, KeyValuePipe } from '@angular/common';\r\nimport { Component, computed, signal } from '@angular/core';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSlideToggleChange, MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { TippyDirective } from '../../shared/directives/tippy.directive';\r\nimport { ArrayHelpers } from '../../shared/helpers/array.helpers';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { guiTypes } from '../plumb-editor/plumb-editor.helpers';\r\nimport { VisualQueryStateService } from '../services/visual-query.service';\r\nimport { filterAndSortDataSources } from './add-explorer.helpers';\r\n\r\n@Component({\r\n    selector: 'app-add-explorer',\r\n    templateUrl: './add-explorer.html',\r\n    styleUrls: ['./add-explorer.scss'],\r\n    imports: [\r\n        MatSlideToggleModule,\r\n        MatIconModule,\r\n        KeyValuePipe,\r\n        TippyDirective,\r\n    ]\r\n})\r\nexport class AddExplorerComponent {\r\n  toggledItems: string[] = [];\r\n  guiTypes = guiTypes;\r\n\r\n  #difficulties = eavConstants.pipelineDesigner.dataSourceDifficulties;\r\n\r\n  #difficulty = signal(this.#difficulties.default);\r\n\r\n  sorted = computed(() => filterAndSortDataSources(this.visualQueryService.dataSources(), this.#difficulty()));\r\n\r\n  constructor(private visualQueryService: VisualQueryStateService) { }\r\n\r\n  toggleDifficulty(event: MatSlideToggleChange) {\r\n    const difficulty = event.checked ? this.#difficulties.advanced : this.#difficulties.default;\r\n    this.#difficulty.set(difficulty);\r\n  }\r\n\r\n  addDataSource(dataSource: DataSourceInstance) {\r\n    this.visualQueryService.addDataSource(dataSource);\r\n  }\r\n\r\n  toggleItem(item: string) {\r\n    ArrayHelpers.toggleInArray(item, this.toggledItems);\r\n  }\r\n\r\n  trackGroups(index: number, type: KeyValue<string, DataSourceInstance[]>) {\r\n    return type.key;\r\n  }\r\n\r\n  trackDataSources(index: number, dataSource: DataSourceInstance) {\r\n    return dataSource.PartAssemblyAndType;\r\n  }\r\n}\r\n","import cloneDeep from 'lodash-es/cloneDeep';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\n\r\nexport function filterAndSortDataSources(dataSources: DataSourceInstance[], maxDifficulty: number) {\r\n  if (!dataSources)\r\n    return;\r\n\r\n  const cloned = cloneDeep(dataSources);\r\n\r\n  const filtered = cloned.filter(dataSource =>\r\n    dataSource.Difficulty <= maxDifficulty\r\n    && dataSource.PartAssemblyAndType !== eavConstants.pipelineDesigner.outDataSource.PartAssemblyAndType\r\n  );\r\n\r\n  filtered.sort((a, b) => a.Name.toLocaleLowerCase().localeCompare(b.Name.toLocaleLowerCase()));\r\n\r\n  const sorted: Record<string, DataSourceInstance[]> = {};\r\n  for (const dataSource of filtered) {\r\n    const type = dataSource.PrimaryType;\r\n    if (sorted[type]) {\r\n      sorted[type].push(dataSource);\r\n    } else {\r\n      sorted[type] = [dataSource];\r\n    }\r\n  }\r\n\r\n  return sorted;\r\n}\r\n","\r\nexport const dataSrcIdPrefix = 'dataSource_';\r\n\r\nexport function domIdOfGuid(guid: string): string {\r\n  return dataSrcIdPrefix + guid;\r\n}\r\n\r\nexport function guidOfDomId(domId: string): string {\r\n  return domId.replace(dataSrcIdPrefix, '');\r\n}","import { classLog } from '../../shared/logging';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n}\r\n\r\n/**\r\n * Helper to manage the line colors on each connection\r\n */\r\nexport class ConnectionLineColors {\r\n  log = classLog({ConnectionLineColors}, logSpecs);\r\n\r\n  constructor() { }\r\n\r\n  #lineCount = 0;\r\n  #linePaintDefault = {\r\n    stroke: '#61B7CF',\r\n    strokeWidth: 4,\r\n    outlineStroke: 'white',\r\n    outlineWidth: 2,\r\n  };\r\n  #lineColors = [\r\n    '#009688', '#00bcd4', '#3f51b5', '#9c27b0', '#e91e63',\r\n    '#db4437', '#ff9800', '#60a917', '#60a917', '#008a00',\r\n    '#00aba9', '#1ba1e2', '#0050ef', '#6a00ff', '#aa00ff',\r\n    '#f472d0', '#d80073', '#a20025', '#e51400', '#fa6800',\r\n    '#f0a30a', '#e3c800', '#825a2c', '#6d8764', '#647687',\r\n    '#76608a', '#a0522d',\r\n  ];\r\n  #maxCols = this.#lineColors.length - 1;\r\n  #uuidColorMap: Record<string, any> = {};\r\n\r\n\r\n  nextLinePaintStyle(uuid: string) {\r\n    return this.#uuidColorMap[uuid] ??= this.#nextLineColor();\r\n  }\r\n\r\n  #nextLineColor() {\r\n    return {\r\n      ...this.#linePaintDefault,\r\n      stroke: this.#lineColors[this.#lineCount++ % this.#maxCols],\r\n    };\r\n  }\r\n\r\n}","import { classLog } from '../../shared/logging';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { StreamWire } from '../models/stream-wire';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\nimport { findDefByType, getEndpointLabel } from './datasource.helpers';\r\nimport { EndpointDefinitionsService } from './endpoint-definitions';\r\nimport { JsPlumbConnection, JsPlumbInstance } from './jsplumb.models';\r\nimport { guidOfDomId } from './plumber-constants';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  eventConnectionDetached: false,\r\n  eventConnectionAttached: false,\r\n}\r\n\r\nexport class ConnectionsManager {\r\n  log = classLog({ConnectionsManager}, logSpecs);\r\n  bulkDelete: boolean = false;\r\n\r\n  constructor(\r\n    private instance: JsPlumbInstance, \r\n    private pipelineModel: VisualQueryModel,\r\n    private dataSources: DataSourceInstance[],\r\n    private endpointsSvc: EndpointDefinitionsService,\r\n    private onConnectionsChanged: () => void,\r\n  ) { }\r\n\r\n  /**\r\n   * Handle attach/detach of connections\r\n   */\r\n  setup(): void{\r\n    this.instance.bind('connectionDetached', (info: JsPlumbConnection) => this.handleDetached(info));\r\n    this.instance.bind('connection', (info: JsPlumbConnection) => this.handleAttached(info));\r\n  }\r\n\r\n  getAll(): StreamWire[] {\r\n    const connectionInfos: StreamWire[] = this.instance.getAllConnections()\r\n      .map((connection: JsPlumbConnection) => ({\r\n        From: guidOfDomId(connection.sourceId),\r\n        Out: getEndpointLabel(connection.endpoints[0]),\r\n        To: guidOfDomId(connection.targetId),\r\n        In: getEndpointLabel(connection.endpoints[1]),\r\n      } satisfies StreamWire)\r\n    );\r\n    return connectionInfos;\r\n  }\r\n  \r\n  \r\n  handleDetached(info: JsPlumbConnection) {\r\n    const l = this.log.fnIf('eventConnectionDetached');\r\n    if (this.bulkDelete)\r\n      return l.end('in bulk-delete mode, exit');\r\n\r\n    const domDataSource = info.target;\r\n    const pipelineDataSource = this.pipelineModel.DataSources.find(\r\n      pipelineDS => pipelineDS.EntityGuid === guidOfDomId(domDataSource.id)\r\n    );\r\n    const dataSource = findDefByType(this.dataSources, pipelineDataSource.PartAssemblyAndType);\r\n    const label = getEndpointLabel(info.targetEndpoint);\r\n    const isDynamic = !dataSource.In.some(name => this.endpointsSvc.getInfo(name, false).name === label);\r\n    if (isDynamic)\r\n      this.instance.deleteEndpoint(info.targetEndpoint);\r\n    setTimeout(() => this.onConnectionsChanged());\r\n    l.end('done');\r\n  }\r\n\r\n  handleAttached(info: JsPlumbConnection) {\r\n    const l = this.log.fnIf('eventConnectionAttached');\r\n    // This seems to handle a special detach case, but ATM 2025-04-03 I can't see where it would ever hit\r\n    if (info.sourceId === info.targetId) {\r\n      setTimeout(() => {\r\n        this.instance.deleteConnection(info.connection, { fireEvent: false });\r\n        setTimeout(() => this.onConnectionsChanged());\r\n      });\r\n      return l.end('self-connection, will delete and exit');\r\n    }\r\n    const targetEndpointOverlay = info.targetEndpoint.getOverlay('endpointLabel');\r\n    const targetLabel = targetEndpointOverlay.getLabel();\r\n    const endpoints = this.instance.getEndpoints(info.target.id);\r\n    const targetHasSameLabel = endpoints.some(ep => {\r\n      const label = getEndpointLabel(ep);\r\n      return label === targetLabel && info.targetEndpoint.id !== ep.id && ep.canvas.classList.contains('targetEndpoint');\r\n    });\r\n\r\n    // If label already exists, create a PleaseRename label\r\n    if (targetHasSameLabel)\r\n      targetEndpointOverlay.setLabel(`PleaseRename${Math.floor(Math.random() * 99999)}`);\r\n    setTimeout(() => this.onConnectionsChanged());\r\n    l.end('done', { targetLabel, targetHasSameLabel });\r\n  }\r\n\r\n\r\n}\r\n\r\n","<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">Rename stream</div>\r\n    <button\r\n      mat-icon-button\r\n      tippy=\"Close dialog\"\r\n      (click)=\"closeDialog()\"\r\n    >\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n  <div class=\"eav-dialog-content\">\r\n    <form [formGroup]=\"form\">\r\n      <!-- Simple form -->\r\n      @if (!isSource || !pipelineResultExists) {\r\n        <!-- Label -->\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Label</mat-label>\r\n          <input matInput type=\"text\" formControlName=\"label\" required>\r\n        </mat-form-field>\r\n        @if (isSource && !pipelineResultExists) {\r\n          <app-field-hint>\r\n            You will get suggestions for out-streams after you run query\r\n          </app-field-hint>\r\n        }\r\n        @if (controls.label.touched && controls.label.errors?.required) {\r\n          <app-field-hint [isError]=\"true\">\r\n            This field is required\r\n          </app-field-hint>\r\n        }\r\n      }\r\n\r\n      <!-- Rich form -->\r\n      @if (isSource && pipelineResultExists) {\r\n        <!-- Scope -->\r\n        @if (advancedMode && guidedLabel) {\r\n          <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n            <mat-label>Scope</mat-label>\r\n            <mat-select\r\n              formControlName=\"scope\"\r\n              [placeholder]=\"!scopeOptions.length\r\n                ? 'No items found'\r\n                : ''\"\r\n            >\r\n              @for (scopeOption of scopeOptions; track scopeOption) {\r\n                <mat-option [value]=\"scopeOption.value\">\r\n                  {{ scopeOption.name }}\r\n                </mat-option>\r\n              }\r\n            </mat-select>\r\n          </mat-form-field>\r\n          <app-field-hint>\r\n            The scope should almost never be changed -\r\n            <a href=\"https://2sxc.org/help?tag=scope\" target=\"_blank\" appClickStopPropagation>see help</a>\r\n          </app-field-hint>\r\n        }\r\n        <!-- Label -->\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Label</mat-label>\r\n          @if (guidedLabel) {\r\n            <mat-select formControlName=\"label\" required\r\n              [placeholder]=\"!labelOptions.length ? 'No items found' : ''\">\r\n              @for (labelOption of labelOptions; track labelOption) {\r\n                <mat-option [value]=\"labelOption\">\r\n                  {{ labelOption }}\r\n                </mat-option>\r\n              }\r\n            </mat-select>\r\n          }\r\n          @if (!guidedLabel) {\r\n            <input matInput type=\"text\" formControlName=\"label\" required>\r\n          }\r\n          <div matTextSuffix class=\"eav-selection-suffix\">\r\n            <button\r\n              mat-icon-button\r\n              class=\"eav-selection-suffix-button\"\r\n              type=\"button\"\r\n              [ngClass]=\"{ 'active': guidedLabel }\"\r\n              tippy=\"Pick existing value\"\r\n              (click)=\"toggleGuidedLabel(true)\"\r\n            >\r\n              <mat-icon class=\"eav-icon\">\r\n                search\r\n              </mat-icon>\r\n            </button>\r\n            <button\r\n              mat-icon-button\r\n              class=\"eav-selection-suffix-button\"\r\n              type=\"button\"\r\n              [ngClass]=\"{ 'active': !guidedLabel }\"\r\n              tippy=\"Manual entry\"\r\n              (click)=\"toggleGuidedLabel(false)\"\r\n              >\r\n                <mat-icon class=\"eav-icon\">\r\n                  text_fields\r\n                </mat-icon>\r\n            </button>\r\n          </div>\r\n        </mat-form-field>\r\n        @if (controls.label.touched && controls.label.errors?.required) {\r\n          <app-field-hint [isError]=\"true\">\r\n            This field is required\r\n          </app-field-hint>\r\n        }\r\n      }\r\n    </form>\r\n  </div>\r\n  <mat-dialog-actions class=\"eav-dialog-actions\">\r\n    <!-- Extra button for rich form -->\r\n    <div>\r\n      @if (isSource && pipelineResultExists) {\r\n        <mat-slide-toggle\r\n          color=\"accent\"\r\n          [checked]=\"advancedMode\"\r\n          (change)=\"toggleAdvancedMode($event)\"\r\n        >\r\n          {{ advancedMode ? 'Advanced' : 'Simple' }}\r\n        </mat-slide-toggle>\r\n      }\r\n    </div>\r\n    <app-save-close-button-fab\r\n      [label]=\"'Rename and close (ctrl + enter)'\"\r\n      (action)=\"saveAndClose()\"\r\n      [disabled]=\"!form.valid\"\r\n      [ngClass]=\"!form.valid ? 'disabled' : ''\"\r\n    />\r\n  </mat-dialog-actions>\r\n</div>\r\n","import { NgClass } from '@angular/common';\r\nimport { ChangeDetectorRef, Component, HostBinding, Inject, OnInit } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule, UntypedFormControl, UntypedFormGroup, Validators } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MAT_DIALOG_DATA, MatDialogActions, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleChange, MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { distinctUntilChanged, startWith } from 'rxjs';\r\nimport { transient } from '../../../../../../core';\r\nimport { ContentTypesService } from '../../../app-administration/services';\r\nimport { isCtrlEnter } from '../../../edit/dialog/main/keyboard-shortcuts';\r\nimport { BaseComponent } from '../../../shared/components/base';\r\nimport { FieldHintComponent } from '../../../shared/components/field-hint/field-hint';\r\nimport { eavConstants, ScopeOption } from '../../../shared/constants/eav.constants';\r\nimport { ClickStopPropagationDirective } from '../../../shared/directives/click-stop-propagation.directive';\r\nimport { SaveCloseButtonFabComponent } from '../../../shared/modules/save-close-button-fab/save-close-button-fab';\r\nimport { VisualQueryStateService } from '../../services/visual-query.service';\r\nimport { RenameStreamDialogControls, RenameStreamDialogData, RenameStreamDialogFormValue } from './rename-stream.models';\r\n\r\n@Component({\r\n  selector: 'app-rename-stream',\r\n  templateUrl: './rename-stream.html',\r\n  imports: [\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    NgClass,\r\n    MatDialogActions,\r\n    MatSlideToggleModule,\r\n    FieldHintComponent,\r\n    ClickStopPropagationDirective,\r\n    SaveCloseButtonFabComponent,\r\n  ]\r\n})\r\nexport class RenameStreamComponent extends BaseComponent implements OnInit {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  form: UntypedFormGroup;\r\n  controls: RenameStreamDialogControls;\r\n  isSource = this.dialogData.isSource;\r\n  pipelineResultExists = this.visualQueryService.queryResult != null;\r\n  scopeOptions: ScopeOption[] = [];\r\n  labelOptions: string[] = [];\r\n  guidedLabel = true;\r\n  advancedMode = false;\r\n\r\n  #contentTypesSvc = transient(ContentTypesService);\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) private dialogData: RenameStreamDialogData,\r\n    private dialog: MatDialogRef<RenameStreamComponent>,\r\n    private visualQueryService: VisualQueryStateService,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.#buildForm();\r\n    this.#watchKeyboardShortcuts();\r\n  }\r\n\r\n  closeDialog(label?: string): void {\r\n    this.dialog.close(label);\r\n  }\r\n\r\n  toggleGuidedLabel(guidedLabel: boolean): void {\r\n    this.guidedLabel = guidedLabel;\r\n  }\r\n\r\n  toggleAdvancedMode(event: MatSlideToggleChange): void {\r\n    this.advancedMode = event.checked;\r\n  }\r\n\r\n  saveAndClose(): void {\r\n    const formValue: RenameStreamDialogFormValue = this.form.getRawValue();\r\n    this.closeDialog(formValue.label);\r\n  }\r\n\r\n  #buildForm(): void {\r\n    this.form = new UntypedFormGroup({\r\n      label: new UntypedFormControl(this.dialogData.label, Validators.required),\r\n      scope: new UntypedFormControl(eavConstants.scopes.default.value),\r\n    });\r\n    this.controls = this.form.controls as any;\r\n\r\n    if (!this.isSource || !this.pipelineResultExists)\r\n      return;\r\n\r\n    this.subscriptions.add(\r\n      this.controls.scope.valueChanges.pipe(\r\n        startWith<string>(this.controls.scope.value),\r\n        distinctUntilChanged(),\r\n      ).subscribe(scope => {\r\n        this.labelOptions = Object.values(this.visualQueryService.queryResult.Sources)\r\n          .find(source => source.Guid === this.dialogData.pipelineDataSourceGuid).Out\r\n          .filter(out => out.Scope === scope)\r\n          .map(out => out.Name);\r\n\r\n        if (!this.labelOptions.includes(this.controls.label.value) && this.controls.label.value != null)\r\n          this.controls.label.patchValue(null);\r\n      })\r\n    );\r\n\r\n    this.#contentTypesSvc.getScopesPromise().then(scopes => {\r\n      const sourceOut = Object.values(this.visualQueryService.queryResult.Sources)\r\n        .find(source => source.Guid === this.dialogData.pipelineDataSourceGuid).Out;\r\n      const filtered = scopes.filter(s => sourceOut.some(o => o.Scope === s.value));\r\n      this.scopeOptions = filtered;\r\n      this.changeDetectorRef.markForCheck();\r\n    });\r\n  }\r\n  \r\n  #watchKeyboardShortcuts(): void {\r\n    this.dialog.keydownEvents().subscribe(event => {\r\n      if (isCtrlEnter(event) && this.form.valid) {\r\n        event.preventDefault();\r\n        this.saveAndClose();\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { classLog } from '../../shared/logging';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\nimport { EndpointLabelRenameParts } from './endpoint-label-rename.model';\r\nimport { JsPlumbEndpoint, JsPlumbOverlay } from './jsplumb.models';\r\nimport { EndpointInfo } from './plumb-editor.models';\r\nimport { RenameStreamComponent } from './rename-stream/rename-stream';\r\nimport { RenameStreamDialogData } from './rename-stream/rename-stream.models';\r\n\r\nconst logSpecs = {\r\n  all: true,\r\n  getEndpointOverlays: true,\r\n  getEndpointInfo: true,\r\n  buildSourceDef: true,\r\n  buildTargetDef: true,\r\n}\r\n\r\n/**\r\n * Trivial helper to get endpoint definitions and similar things\r\n */\r\nexport class EndpointDefinitionsService {\r\n\r\n  log = classLog({EndpointDefinitionsService}, logSpecs);\r\n\r\n  constructor(\r\n    private pipelineModel: VisualQueryModel,\r\n    private renameDialogParts: EndpointLabelRenameParts,\r\n  ) { }\r\n\r\n  #getEndpointOverlays(isSource: boolean) {\r\n    const l = this.log.fnIf('getEndpointOverlays', {isSource});\r\n    const result = [\r\n      [\r\n        'Label', {\r\n          id: 'endpointLabel',\r\n          location: [0.5, isSource ? 0 : 1],\r\n          label: 'Default',\r\n          cssClass: isSource ? 'endpointSourceLabel' : 'endpointTargetLabel',\r\n        },\r\n      ],\r\n    ];\r\n    return l.r(result);\r\n  }\r\n\r\n  getInfo(endpointName: string, isDynamic: boolean, customLabel?: string): EndpointInfo {\r\n    const l = this.log.fnIf('getEndpointInfo', {endpointName, isDynamic});\r\n\r\n    // Trim name and see if it's required - marked with a trailing '*'\r\n    const trimmed = endpointName.trim();\r\n    const isAsterisk = trimmed === '*';\r\n    const required = !isAsterisk && trimmed.endsWith('*');\r\n    const name = !required\r\n      ? trimmed\r\n      : trimmed.substring(0, trimmed.length - 1);\r\n\r\n    if (isDynamic)\r\n      return l.r({\r\n        name,\r\n        required: false,\r\n        label: customLabel ?? (isAsterisk ? '*' : name),\r\n      } satisfies EndpointInfo, 'isDynamic');\r\n\r\n    return l.r({ name, required, label: customLabel ?? (isAsterisk ? '*' : name) } satisfies EndpointInfo, 'notDynamic');\r\n  }\r\n\r\n  buildSourceDef(dsGuid: string, style?: string) {\r\n    const l = this.log.fnIf('buildSourceDef', {pipelineDataSourceGuid: dsGuid, style});\r\n    const isSource = true;\r\n    const sourceEndpoint = {\r\n      paintStyle: { fill: 'transparent', radius: 10 },\r\n      cssClass: 'sourceEndpoint ' + (style ?? ''),\r\n      maxConnections: -1,\r\n      isSource,\r\n      anchor: ['Continuous', { faces: ['top'] }],\r\n      overlays: this.#getEndpointOverlays(isSource),\r\n      events: {\r\n        click: (endpointOrOverlay: JsPlumbOverlay) => this.onChangeLabel(endpointOrOverlay, isSource, dsGuid),\r\n      },\r\n    };\r\n    return l.r(sourceEndpoint);\r\n  }\r\n\r\n  buildTargetDef(dsGuid: string, style?: string) {\r\n    const l = this.log.fnIf('buildTargetDef', {pipelineDataSourceGuid: dsGuid, style});\r\n    const isSource = false;\r\n    const targetEndpoint = {\r\n      paintStyle: { fill: 'transparent', radius: 10 },\r\n      cssClass: 'targetEndpoint ' + (style ?? ' '), // + (angled ? 'angled' : ''),\r\n      maxConnections: 1,\r\n      isTarget: !isSource,\r\n      anchor: ['Continuous', { faces: ['bottom'] }],\r\n      overlays: this.#getEndpointOverlays(isSource),\r\n      dropOptions: { hoverClass: 'hover', activeClass: 'active' },\r\n      events: {\r\n        click: (endpointOrOverlay: JsPlumbOverlay) => this.onChangeLabel(endpointOrOverlay, isSource, dsGuid),\r\n      },\r\n    };\r\n    return l.r(targetEndpoint);\r\n  }\r\n\r\n\r\n  onChangeLabel(endpointOrOverlay: JsPlumbEndpoint | JsPlumbOverlay, isSource: boolean, pipelineDataSourceGuid: string) {\r\n    if (!this.pipelineModel.Pipeline.AllowEdit)\r\n      return;\r\n\r\n    debugger;\r\n    const overlay: JsPlumbOverlay = (endpointOrOverlay as JsPlumbEndpoint)?.getOverlay?.('endpointLabel')\r\n      ?? endpointOrOverlay as JsPlumbOverlay;\r\n\r\n    this.renameDialogParts.matDialog\r\n      .open(RenameStreamComponent, {\r\n        autoFocus: false,\r\n        data: {\r\n          pipelineDataSourceGuid,\r\n          isSource,\r\n          label: overlay.label,\r\n        } satisfies RenameStreamDialogData,\r\n        viewContainerRef: this.renameDialogParts.viewContainerRef,\r\n        width: '650px',\r\n      })\r\n      .afterClosed().subscribe(newLabel => {\r\n        if (!newLabel)\r\n          return;\r\n        overlay.setLabel(newLabel);\r\n        setTimeout(() => this.renameDialogParts.onConnectionsChanged());\r\n      });\r\n\r\n    this.renameDialogParts.changeDetectorRef.markForCheck();\r\n  }\r\n\r\n\r\n  // public onChangeLabel(endpointOrOverlay: JsPlumbEndpoint | JsPlumbOverlay, isSource: boolean, pipelineDataSourceGuid: string) {\r\n  //   if (!this.pipelineModel.Pipeline.AllowEdit)\r\n  //     return;\r\n\r\n  //   const overlay: JsPlumbOverlay = (endpointOrOverlay as JsPlumbEndpoint)?.getOverlay('endpointLabel')\r\n  //     ?? endpointOrOverlay as JsPlumbOverlay;\r\n\r\n  //   this.matDialog\r\n  //     .open(RenameStreamComponent, {\r\n  //       autoFocus: false,\r\n  //       data: {\r\n  //         pipelineDataSourceGuid,\r\n  //         isSource,\r\n  //         label: overlay.label,\r\n  //       } satisfies RenameStreamDialogData,\r\n  //       viewContainerRef: this.viewContainerRef,\r\n  //       width: '650px',\r\n  //     })\r\n  //     .afterClosed().subscribe(newLabel => {\r\n  //       if (!newLabel)\r\n  //         return;\r\n  //       overlay.setLabel(newLabel);\r\n  //       setTimeout(() => this.onConnectionsChanged());\r\n  //     });\r\n\r\n  //   this.changeDetectorRef.markForCheck();\r\n  // }\r\n\r\n}\r\n","import { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { classLog } from '../../shared/logging';\r\nimport { DataSourceDefinition } from '../models/data-source-definition';\r\nimport { ConnectionsManager } from './connections-manager';\r\nimport { findDefByType, getEndpointLabel } from './datasource.helpers';\r\nimport { EndpointDefinitionsService } from './endpoint-definitions';\r\nimport { JsPlumbEndpoint, JsPlumbInstance } from './jsplumb.models';\r\nimport { domIdOfGuid } from './plumber-constants';\r\nimport { QueryDataManager } from './query-data-manager';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  addEndpoint: true,\r\n  reOrientAllLabels: false,\r\n  updateAfterChanges: false,\r\n  wireHasConnection: false,\r\n  mirrorEndpoints: false,\r\n  fields: ['*', 'Default'],\r\n}\r\n\r\nconst endPointsWhereWeRotate = 3;\r\nconst maxLabelLengthToRotate = 30;\r\n\r\nexport class EndpointsManager {\r\n  log = classLog({EndpointsManager}, logSpecs);\r\n\r\n  constructor(\r\n    private instance: JsPlumbInstance, \r\n    private endpointDefs: EndpointDefinitionsService,\r\n    private connections: ConnectionsManager,\r\n    private queryData: QueryDataManager,\r\n  ) { }\r\n\r\n  \r\n  addEndpoint(domDataSource: HTMLElement, endpointName: string, endpointLabel: string, isIn: boolean, queryDs: DataSourceDefinition, extraStyling?: string) {\r\n    const l = this.log.fnIfInFields('addEndpoint', endpointName, { endpointName, endpointLabel, isIn, queryDs });\r\n    const dsDefinition = findDefByType(this.queryData.dataSources, queryDs.PartAssemblyAndType);\r\n    const connectionList = isIn\r\n      ? dsDefinition.In\r\n      : dsDefinition.Out;\r\n    const isDynamic = connectionList?.some(name => this.endpointDefs.getInfo(name, false).required === false);\r\n    const endpointInfo = this.endpointDefs.getInfo(endpointName, isDynamic, endpointLabel);\r\n\r\n    l.a(`endpointInfo`, { dataSource: dsDefinition, connectionList, hasDynamic: isDynamic, endpointInfo });\r\n\r\n    // if (endpointName === \"DEBUG\") debugger;\r\n\r\n    // Figure out additional styling based on the endpoint type\r\n    const style = isDynamic\r\n      ? 'dynamic' // dynamic endpoints are not required\r\n      : !endpointInfo.required\r\n        ? ''      // not required\r\n        : this.#wireHasConnection(domDataSource, endpointInfo.name, isIn) ? '' : 'required'; // required - check if it's populated; otherwise make red\r\n\r\n\r\n    const uuid = domDataSource.id + (isIn ? '_in_' : '_out_') + endpointInfo.name;\r\n    const model = isIn\r\n      ? this.endpointDefs.buildTargetDef(queryDs.EntityGuid, `${style} ${extraStyling}`)\r\n      : this.endpointDefs.buildSourceDef(queryDs.EntityGuid, `${style} ${extraStyling}`);\r\n    // Endpoints on Out-DataSource must be always enabled\r\n    const params = {\r\n      uuid,\r\n      enabled: this.queryData.query.Pipeline.AllowEdit\r\n        || queryDs.EntityGuid === eavConstants.pipelineDesigner.outDataSource.EntityGuid\r\n    };\r\n\r\n    // Add endpoint and add label and css in case it must be angled\r\n    const endpoint = this.instance.addEndpoint(domDataSource, model, params);\r\n    const overlay = endpoint.getOverlay('endpointLabel');\r\n    overlay.setLabel(endpointInfo.label);\r\n    l.end(\"end\", {overlay});\r\n  }\r\n\r\n  /**\r\n   * Check if a specific endpoint has a connection\r\n   * Note that it uses the query model to check, not the DOM.\r\n   * So in certain cases where a change is just being made, it could be wrong.\r\n   */\r\n  #wireHasConnection(domDataSource: HTMLElement, name: string, isIn: boolean = true) {\r\n    const l = this.log.fnIf('wireHasConnection', { domDataSource, name, isIn });\r\n    const wireExists = this.queryData.query.Pipeline.StreamWiring?.some(wire => isIn\r\n        ? domIdOfGuid(wire.To) === domDataSource.id && wire.In === name\r\n        : domIdOfGuid(wire.From) === domDataSource.id && wire.Out === name\r\n    );\r\n    return l.r(wireExists, 'wireExists' + wireExists);\r\n  }\r\n\r\n  #isDoingUpdate = false;\r\n\r\n  updateAfterChanges() {\r\n    const l = this.log.fnIf('updateAfterChanges', { query: this.queryData.query, isDoing: this.#isDoingUpdate });\r\n\r\n    // Prevent loops\r\n    if (this.#isDoingUpdate)\r\n      return l.end('already doing update, exit');\r\n    this.#isDoingUpdate = true;\r\n\r\n    this.#mirrorEndpoints();\r\n\r\n    this.#reOrientAllLabels();\r\n\r\n    this.#isDoingUpdate = false;\r\n    this.instance.repaintEverything();\r\n    l.end('done');\r\n  }\r\n\r\n  #mirrorEndpoints() {\r\n    const l = this.log.fnIf('mirrorEndpoints', { query: this.queryData.query });\r\n    // Get all parts which have mirror-in mode\r\n    const partsMirrorIn = this.queryData.query.DataSources\r\n    .map(ds => {\r\n      const def = findDefByType(this.queryData.dataSources, ds.PartAssemblyAndType);\r\n      return (def.OutMode === 'mirror-in') ? { def, guid: ds.EntityGuid } : null;\r\n    })\r\n    .filter(d => d !== null);\r\n    \r\n    // Check if we need to mirror anything\r\n    partsMirrorIn.forEach(ds => {\r\n      const { inPoints, outPoints } = this.#getEndpointsByType(ds.guid);\r\n\r\n      const inLabels = inPoints.map(p => ({ point: p, label: getEndpointLabel(p)}));\r\n      const outLabels = outPoints.map(p => ({ point: p, label: getEndpointLabel(p)}));\r\n\r\n      // Get mismatching lists of out and in\r\n      const missingInOut = inLabels.filter(inP => !outLabels.some(outP => outP.label === inP.label));\r\n      const outWithoutIn = outLabels.filter(outP => !inLabels.some(inP => inP.label === outP.label));\r\n      l.a('inMissingInOut', { inPoints, outPoints, missingInOut, outWithoutIn });\r\n\r\n      // Add missing labels to out\r\n      const { domDataSource, dataSource } = this.queryData.findDataSourceAndDom(ds.guid);\r\n      if (missingInOut.length) {\r\n        missingInOut.forEach(p => this.addEndpoint(domDataSource, p.label, p.label, false, dataSource, 'mirror-in'));\r\n      }\r\n\r\n      // Remove excessive labels\r\n      // Only consider the ones which have a `mirror-in` class and remove them\r\n      outWithoutIn.forEach(p => {\r\n        if (p.point.canvas.classList.contains('mirror-in')) {\r\n          const hasConnection = p.point.connections?.length;\r\n          if (!hasConnection)\r\n            this.instance.deleteEndpoint(p.point);\r\n        }\r\n      });\r\n    });  \r\n  }\r\n\r\n  /**\r\n   * Ugly way to get the endpoints by type in/out. Not elegant, but don't know a better method ATM\r\n   */\r\n  #getEndpointsByType(guid: string) {\r\n    const endpoints = this.instance.selectEndpoints({ element: domIdOfGuid(guid) });\r\n    const inPoints: JsPlumbEndpoint[] = [];\r\n    const outPoints: JsPlumbEndpoint[] = [];\r\n    endpoints.each((ep: JsPlumbEndpoint) => (ep.isTarget ? inPoints : outPoints).push(ep));\r\n    return { inPoints, outPoints };\r\n  }\r\n\r\n  /**\r\n   * Check all labels and if there are too many, rotate them at an angle\r\n   */\r\n  #reOrientAllLabels() {\r\n    const l = this.log.fnIf('reOrientAllLabels');\r\n    const parts = this.queryData.query.DataSources.map(ds => ds.EntityGuid);\r\n\r\n    parts.forEach(guid => {\r\n      const {inPoints, outPoints} = this.#getEndpointsByType(guid);\r\n      this.#reorientListOfEndpoints(inPoints);\r\n      this.#reorientListOfEndpoints(outPoints);\r\n    });\r\n    l.end();\r\n  }\r\n\r\n  #reorientListOfEndpoints(endpoints: JsPlumbEndpoint[]) {\r\n    const countExceeded = endpoints.length > endPointsWhereWeRotate;\r\n\r\n    const labels = endpoints.map(endpoint => getEndpointLabel(endpoint)).join(',');\r\n\r\n    if (countExceeded || labels.length > maxLabelLengthToRotate)\r\n      endpoints.forEach(element => element.addClass('angled'));\r\n    else\r\n      endpoints.forEach(element => element.removeClass('angled'));\r\n  }\r\n\r\n\r\n  removeAllEndpoints(dataSourceGuid: string) {\r\n    const elementId = domIdOfGuid(dataSourceGuid);\r\n    this.connections.bulkDelete = true;\r\n    this.instance.batch(() => {\r\n      this.instance.selectEndpoints({ element: elementId }).delete();\r\n    });\r\n    this.connections.bulkDelete = false;\r\n  }\r\n\r\n}\r\n\r\n","import { WindowWithJsPlumb } from '../window';\r\nimport { ConnectionLineColors } from './connection-line-colors';\r\nimport { JsPlumbInstance } from './jsplumb.models';\r\n\r\ndeclare const window: WindowWithJsPlumb;\r\n\r\nexport class JsPlumbInstanceManager {\r\n  constructor(private jsPlumbRoot: HTMLElement, private lineColors: ConnectionLineColors) {\r\n    this.instance = window.jsPlumb.getInstance(this.createInstanceDefaults(this.jsPlumbRoot));\r\n  }\r\n\r\n  instance: JsPlumbInstance;\r\n\r\n  createInstanceDefaults(container: HTMLElement) {\r\n    const defaults = {\r\n      Container: container,\r\n      Connector: ['Bezier', { curviness: 70 }],\r\n      PaintStyle: this.lineColors.nextLinePaintStyle('dummy'),\r\n      HoverPaintStyle: {\r\n        stroke: '#216477',\r\n        strokeWidth: 4,\r\n        outlineStroke: 'white',\r\n        outlineWidth: 2,\r\n      },\r\n    };\r\n    return defaults;\r\n  }\r\n\r\n  destroy() {\r\n    this.instance.reset();\r\n    this.instance.unbindContainer();\r\n    this.instance = null;\r\n  }\r\n}","import { classLog } from '../../shared/logging';\r\nimport { QueryResult } from '../models/result/pipeline-result';\r\nimport { QueryStreamResult } from '../models/result/PipelineResultStream';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\nimport { JsPlumbEndpoint, JsPlumbInstance } from './jsplumb.models';\r\nimport { domIdOfGuid } from './plumber-constants';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  putEntityCountOnConnections: false,\r\n}\r\n\r\nexport class LinesDecorator {\r\n  log = classLog({LinesDecorator}, logSpecs);\r\n\r\n  constructor(\r\n    private instance: JsPlumbInstance, \r\n    private pipelineModel: VisualQueryModel,\r\n    private onDebugStream: (stream: QueryStreamResult) => void,\r\n  ) { }\r\n  \r\n  /**\r\n   * Updates the entity count on each connections based on the provided result.\r\n   * @param result PipelineResult\r\n   */\r\n  addEntityCount(result: QueryResult) {\r\n    const l = this.log.fnIf('putEntityCountOnConnections');\r\n    result.Streams?.forEach(stream => {\r\n      const outDomId = domIdOfGuid(stream.Source);\r\n      const outTargets = ['00000000-0000-0000-0000-000000000000', this.pipelineModel.Pipeline.EntityGuid];\r\n      const inDomId = outTargets.includes(stream.Target)\r\n        ? domIdOfGuid('Out')\r\n        : domIdOfGuid(stream.Target);\r\n\r\n      const fromUuid = outDomId + '_out_' + stream.SourceOut;\r\n      const toUuid = inDomId + '_in_' + stream.TargetIn;\r\n\r\n      const endpoint: JsPlumbEndpoint = this.instance.getEndpoint(fromUuid);\r\n      endpoint?.connections\r\n        ?.filter((connection) => connection.endpoints[1].getUuid() === toUuid)\r\n        ?.forEach((connection) => {\r\n          const label = !stream.Error ? stream.Count.toString() : '';\r\n          const cssClass = 'streamEntitiesCount ' + (!stream.Error ? '' : 'streamEntitiesError');\r\n          connection.setLabel({\r\n            label,\r\n            cssClass,\r\n            events: {\r\n              click: () => {\r\n                if (!this.pipelineModel.Pipeline.AllowEdit)\r\n                  return;\r\n                this.onDebugStream(stream);\r\n              },\r\n            },\r\n          });\r\n        });\r\n    });\r\n    l.end('done');\r\n  }\r\n}","import { classLog } from '../../shared/logging';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\nimport { DataSourceSet } from './data-source-set.model';\r\nimport { findDefByType } from './datasource.helpers';\r\nimport { domIdOfGuid, guidOfDomId } from './plumber-constants';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  findDataSourceAndDom: false,\r\n  // fields: ['TestIn2', 'Default'],\r\n}\r\n\r\nexport class QueryDataManager {\r\n  log = classLog({QueryDataManager}, logSpecs);\r\n\r\n  constructor(\r\n    private jsPlumbRoot: HTMLElement, \r\n    public query: VisualQueryModel,\r\n    public dataSources: DataSourceInstance[]\r\n  ) { }\r\n\r\n  findDomAndDef(guid: string, partAssemblyAndType: string): (DataSourceSet & { definition: DataSourceInstance }) | null {\r\n    const dsSet = this.findDataSourceAndDom(guid);\r\n    if (!dsSet)\r\n      return null;\r\n    const dsDef = findDefByType(this.dataSources, partAssemblyAndType);\r\n    if (!dsDef)\r\n      return null;\r\n    return { ...dsSet, definition: dsDef };\r\n  }\r\n\r\n  findDataSourceAndDom(sourceElementId: string) : DataSourceSet | null {\r\n    const l = this.log.fnIf('findDataSourceAndDom', { sourceElementId });\r\n\r\n    // if DOM doesn't exist, do nothing\r\n    const domDataSource = this.jsPlumbRoot.querySelector<HTMLElement>('#' + domIdOfGuid(sourceElementId));\r\n    if (!domDataSource)\r\n      return l.r(null, \"DOM not found, exit\");\r\n\r\n    const guid = guidOfDomId(domDataSource.id);\r\n    const dataSource = this.query.DataSources.find(pipeDs => pipeDs.EntityGuid === guid);\r\n    return l.r({ domDataSource, dataSource }, \"returning data source\");\r\n  }\r\n}\r\n\r\n","import { classLogEnabled } from '../../shared/logging';\r\nimport { DataSourceSet } from './data-source-set.model';\r\nimport { JsPlumbInstance } from './jsplumb.models';\r\nimport { domIdOfGuid } from './plumber-constants';\r\nimport { Plumber } from './plumber.helper';\r\nimport { QueryDataManager } from './query-data-manager';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  initWirings: true,\r\n  ensureWireEndpointExists: false,\r\n  findDataSourceInDom: false,\r\n  connect: true,\r\n  fields: ['TestIn2', '*'],\r\n}\r\n\r\nexport class WiringsHelper {\r\n  log = classLogEnabled({WiringsHelper}, logSpecs);\r\n\r\n  constructor(\r\n    private plumber: Plumber,\r\n    private instance: JsPlumbInstance,\r\n    private queryData: QueryDataManager,\r\n  ) { }\r\n\r\n  getWireEndpointName(endpointId: string): string {\r\n    if (endpointId == '*')\r\n      return 'asterisk';\r\n    return endpointId;\r\n  }\r\n\r\n  initWirings() {\r\n    const l = this.log.fnIf('initWirings');\r\n    const wiringsRaw = this.queryData.query.Pipeline.StreamWiring;\r\n    if (!wiringsRaw)\r\n      return l.end('no wirings');\r\n\r\n    const wirings = wiringsRaw.map(wire => {\r\n      // read connections from Pipeline\r\n      const outDsDomId = domIdOfGuid(wire.From);\r\n      const outTargetName = this.getWireEndpointName(wire.Out);\r\n      const outPointDomId = outDsDomId + '_out_' + outTargetName;\r\n      const inDsDomId = domIdOfGuid(wire.To);\r\n      const inTargetName = this.getWireEndpointName(wire.In);\r\n      const inPointDomId = inDsDomId + '_in_' + inTargetName;\r\n      return {\r\n        outPointDomId,\r\n        inPointDomId,\r\n        outTargetName,\r\n        inTargetName,\r\n        wire\r\n      };\r\n    });\r\n\r\n    l.a('wirings', { wireDetails: wirings });\r\n\r\n    // Build all the Endpoints which don't exist yet based on the wirings\r\n    wirings.forEach(w => {\r\n      // Ensure Out-Endpoint exist\r\n      this.#ensureWireEndpointExists(w.outPointDomId, w.wire.From, w.outTargetName, w.wire.Out, false);\r\n\r\n      // Ensure In-Endpoint exist\r\n      this.#ensureWireEndpointExists(w.inPointDomId, w.wire.To, w.inTargetName, w.wire.In, true);\r\n    });\r\n\r\n    // Connect all the wirings\r\n    wirings.forEach(w => this.#connect(w.outPointDomId, w.inPointDomId));\r\n\r\n    this.instance.repaintEverything();\r\n\r\n    l.end();\r\n  }\r\n\r\n  #connect(outDomId: string, inDomId: string) {\r\n    const l = this.log.fnIf('connect', { outDomId, inDomId });\r\n    try {\r\n      this.instance.connect({\r\n        uuids: [outDomId, inDomId],\r\n        paintStyle: this.plumber.lineColors.nextLinePaintStyle(outDomId),\r\n      });\r\n    } catch (e) {\r\n      console.error({ message: 'Connection failed', from: outDomId, to: inDomId });\r\n    }\r\n    l.end();\r\n  }\r\n  \r\n\r\n  #ensureWireEndpointExists(endpointId: string, sourceGuid: string, name: string, label: string, isIn: boolean) : DataSourceSet | null {\r\n    const l = this.log.fnIfInFields('ensureWireEndpointExists', name, { endpointId, sourceGuid, name, label, isIn });\r\n    // Find data source infos & DOM, if not found, do nothing\r\n    const set = this.#findDataSourceInDom(endpointId, sourceGuid, name);\r\n    if (set == null)\r\n      return l.r(set, \"set null\");\r\n\r\n    // const name = isIn ? wire.In : wire.Out;\r\n    this.plumber.endpoints.addEndpoint(set.domDataSource, name, label, isIn, set.dataSource);\r\n    return l.r(set, 'ok');\r\n  }\r\n\r\n  #findDataSourceInDom(endpointId: string, sourceGuid: string, name: string) : DataSourceSet | null {\r\n    const l = this.log.fnIfInFields('findDataSourceInDom', name, { endpointId, sourceGuid, name });\r\n    // if exists, do nothing\r\n    if (this.instance.getEndpoint(endpointId))\r\n      return l.r(null, \"endpoint exists, exit\");\r\n\r\n    const result = this.queryData.findDataSourceAndDom(sourceGuid);\r\n    return l.r(result, `found: ${result != null}`);\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n// https://stackoverflow.com/questions/14446511/most-efficient-method-to-groupby-on-an-array-of-objects\r\nconst groupBy = <T, K extends keyof any>(arr: T[], key: (i: T) => K) =>\r\n  arr.reduce((groups, item) => {\r\n    (groups[key(item)] ||= []).push(item);\r\n    return groups;\r\n  }, {} as Record<K, T[]>);\r\n\r\n\r\n      // 2025-04-02 2dm standardized / reduced the code old\r\n      // leave commented out portions in for a few weeks, to ensure we know what happened if something breaks\r\n      // Ensure In-Endpoint exist\r\n      // if (!this.#instance.getEndpoint(fromUuid)) {\r\n      //   const domDataSource = this.jsPlumbRoot.querySelector<HTMLElement>('#' + sourceElementId);\r\n      //   if (!domDataSource)\r\n      //     return;\r\n      //   const guid: string = domDataSource.id.replace(dataSrcIdPrefix, '');\r\n      //   const dataSource = this.pipelineModel.DataSources.find(pipeDataSource => pipeDataSource.EntityGuid === guid);\r\n      //   this.#addEndpoint(domDataSource, wire.Out, false, dataSource, outGroups[wire.From].length);\r\n      // }\r\n      // Ensure Out-Endpoint exist\r\n      // if (!this.#instance.getEndpoint(toUuid)) {\r\n      //   const domDataSource = this.jsPlumbRoot.querySelector<HTMLElement>('#' + targetElementId);\r\n      //   if (!domDataSource)\r\n      //     return;\r\n      //   const guid: string = domDataSource.id.replace(dataSrcIdPrefix, '');\r\n      //   const dataSource = this.pipelineModel.DataSources.find(pipeDataSource => pipeDataSource.EntityGuid === guid);\r\n      //   // if (wire.In === \"DEBUG\") debugger;\r\n      //   this.#addEndpoint(domDataSource, wire.In, true, dataSource, inGroups[wire.To].length);\r\n      // }\r\n\r\n      // this.#connect(w.outPointDomId, w.inPointDomId);\r\n","import { classLog } from '../../shared/logging';\r\nimport { DataSourceInstance } from '../models/data-source-instance.model';\r\nimport { QueryStreamResult } from '../models/result/PipelineResultStream';\r\nimport { VisualDesignerData } from '../models/visual-designer-data';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\nimport { ConnectionLineColors } from './connection-line-colors';\r\nimport { ConnectionsManager } from './connections-manager';\r\nimport { getEndpointLabel } from './datasource.helpers';\r\nimport { EndpointDefinitionsService } from './endpoint-definitions';\r\nimport { EndpointLabelRenameParts } from './endpoint-label-rename.model';\r\nimport { EndpointsManager } from './endpoints-manager';\r\nimport { JsPlumbInstanceManager } from './jsplumb-instance-manager';\r\nimport { JsPlumbEndpoint, JsPlumbInstance } from './jsplumb.models';\r\nimport { LinesDecorator } from './lines-decorator';\r\nimport { domIdOfGuid, guidOfDomId } from './plumber-constants';\r\nimport { QueryDataManager } from './query-data-manager';\r\nimport { WiringsHelper } from './wirings.helper';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  addEndpoint: true,\r\n  initDomDataSources: false,\r\n  eventConnectionDetached: true,\r\n  eventConnectionAttached: true,\r\n  fields: ['TestIn2'],\r\n}\r\n\r\nexport class Plumber {\r\n\r\n  log = classLog({Plumber}, logSpecs);\r\n\r\n  #instance: JsPlumbInstance;\r\n\r\n  lineColors = new ConnectionLineColors();\r\n\r\n  #endpointDefs: EndpointDefinitionsService;\r\n\r\n  lineDecorator: LinesDecorator;\r\n\r\n  connections: ConnectionsManager;\r\n\r\n  #instanceManager: JsPlumbInstanceManager;\r\n\r\n  endpoints: EndpointsManager;\r\n\r\n  queryData: QueryDataManager;\r\n\r\n  constructor(\r\n    private jsPlumbRoot: HTMLElement,\r\n    private query: VisualQueryModel,\r\n    private dataSources: DataSourceInstance[],\r\n    private onConnectionsChangedParent: () => void,\r\n    private onDragend: (pipelineDataSourceGuid: string, position: VisualDesignerData) => void,\r\n    private onDebugStream: (stream: QueryStreamResult) => void,\r\n    renameDialogParts: EndpointLabelRenameParts,\r\n  ) {\r\n    this.queryData = new QueryDataManager(this.jsPlumbRoot, this.query, this.dataSources);\r\n    this.#endpointDefs = new EndpointDefinitionsService(query, { ...renameDialogParts, onConnectionsChanged: () => this.#onConnectionsChanged() });\r\n    this.#instanceManager = new JsPlumbInstanceManager(this.jsPlumbRoot, this.lineColors);\r\n    this.#instance = this.#instanceManager.instance;\r\n    // requires instance, so must happen after that\r\n    this.lineDecorator = new LinesDecorator(this.#instance, this.query, this.onDebugStream);\r\n    this.connections = new ConnectionsManager(this.#instance, this.query, this.dataSources, this.#endpointDefs, () => this.#onConnectionsChanged());\r\n    this.endpoints = new EndpointsManager(this.#instance, this.#endpointDefs, this.connections, this.queryData);\r\n\r\n    // Suspend drawing while initializing\r\n    this.#instance.batch(() => {\r\n      this.#initDomDataSources();\r\n      new WiringsHelper(this, this.#instance, this.queryData).initWirings();\r\n      this.connections.setup();\r\n      this.endpoints.updateAfterChanges();\r\n    });\r\n\r\n    // spm NOTE: repaint after initial paint fixes:\r\n    // Error: <svg> attribute width: Expected length, \"-Infinity\".\r\n    this.#instance.repaintEverything();\r\n\r\n  }\r\n  #onConnectionsChanged() {\r\n    // After connection changes, re-check if we need to slant the labels\r\n    this.endpoints.updateAfterChanges();\r\n    // call the parent for storing the data etc.\r\n    this.onConnectionsChangedParent();\r\n  }\r\n\r\n  destroy() {\r\n    this.#instanceManager.destroy();\r\n  }\r\n\r\n  removeAllEndpoints(pipelineDataSourceGuid: string) {\r\n    const elementId = domIdOfGuid(pipelineDataSourceGuid);\r\n    this.connections.bulkDelete = true;\r\n    this.#instance.batch(() => {\r\n      this.#instance.selectEndpoints({ element: elementId }).delete();\r\n    });\r\n    this.connections.bulkDelete = false;\r\n  }\r\n\r\n  getStreamsOut() {\r\n    const streamsOut: string[] = [];\r\n    this.#instance\r\n      .selectEndpoints({ target: domIdOfGuid('Out') })\r\n      .each((endpoint: JsPlumbEndpoint) => {\r\n        streamsOut.push(getEndpointLabel(endpoint));\r\n      });\r\n    const streamsOutStr = streamsOut.join(',');\r\n    return streamsOutStr;\r\n  }\r\n\r\n  /** Create sources, targets and endpoints */\r\n  #initDomDataSources() {\r\n    const l = this.log.fnIf('initDomDataSources');\r\n    for (const queryDs of this.query.DataSources) {\r\n      const { domDataSource: domDs, definition: dataSource } = this.queryData.findDomAndDef(queryDs.EntityGuid, queryDs.PartAssemblyAndType);\r\n      if (!domDs)\r\n        continue;\r\n\r\n      if (this.query.Pipeline.AllowEdit) {\r\n        // WARNING! Must happen before instance.makeSource()\r\n        this.#instance.draggable(domDs, {\r\n          grid: [20, 20],\r\n          stop: (event: { el: HTMLElement, finalPos: number[] }) => {\r\n            const element: HTMLElement = event.el;\r\n            const queryDsGuid: string = guidOfDomId(element.id);\r\n            const position: VisualDesignerData = {\r\n              Top: event.finalPos[1],\r\n              Left: event.finalPos[0],\r\n            };\r\n            setTimeout(() => this.onDragend(queryDsGuid, position));\r\n          }\r\n        });\r\n      }\r\n\r\n      // Add Out-Endpoints from Definition\r\n      const outCount = dataSource.Out?.length ?? 0;\r\n      l.a('dataSource.Out', { outCount, out: dataSource.Out });\r\n      dataSource.Out?.forEach(name => {\r\n        this.endpoints.addEndpoint(domDs, name, name, false, queryDs);\r\n      });\r\n\r\n      // Add dynamic Out-Endpoints (if .OutMode is not static)\r\n      if (dataSource.OutMode != 'static') {\r\n        const dynOut = this.#endpointDefs.buildSourceDef(queryDs.EntityGuid);\r\n        this.#instance.makeSource(domDs, dynOut, { filter: '.add-endpoint' });\r\n      }\r\n\r\n      // Add In-Endpoints from Definition\r\n      const inCount = dataSource.In?.length ?? 0;\r\n      l.a('dataSource.In', { inCount, in: dataSource.In });\r\n      dataSource.In?.forEach(name => {\r\n        this.endpoints.addEndpoint(domDs, name, name, true, queryDs);\r\n      });\r\n\r\n      // Make DataSource a Target for new Endpoints (if .In is an Array)\r\n      if (dataSource.In) {\r\n        const targetEndpointUnlimited = this.#endpointDefs.buildTargetDef(queryDs.EntityGuid);\r\n        targetEndpointUnlimited.maxConnections = -1;\r\n        this.#instance.makeTarget(domDs, targetEndpointUnlimited);\r\n      }\r\n\r\n    }\r\n    l.end();\r\n  }\r\n\r\n\r\n}\r\n","@if (visQuerySvc.pipelineModel()) {\r\n  <div #domRoot id=\"pipeline-root\">\r\n    <!-- do not use trackBy, jsPlumb drag stops working properly after delete -->\r\n    @if (!hardReset) {\r\n      @for (dataSource of visQuerySvc.pipelineModel().DataSources; track dataSource) {\r\n        <div\r\n          #domDataSource\r\n          [id]=\"domIdOfGuid(dataSource.EntityGuid)\"\r\n          class=\"dataSource\"\r\n          [ngStyle]=\"{\r\n            top: dataSource.VisualDesignerData.Top + 'px',\r\n            left: dataSource.VisualDesignerData.Left + 'px',\r\n            'min-width': dataSource.VisualDesignerData.Width ? dataSource.VisualDesignerData.Width + 'px' : null,\r\n          }\"\r\n          [ngClass]=\"{\r\n            'show-details': showDataSourceDetails() && visQuerySvc.dataSourceConfigs()[dataSource.EntityId]?.length,\r\n          }\"\r\n        >\r\n          <div class=\"actions left\">\r\n            <mat-icon class=\"type-info\" [title]=\"typeInfos()[dataSource.EntityGuid].UiHint\">\r\n              {{ typeInfos()[dataSource.EntityGuid].Icon }}\r\n            </mat-icon>\r\n            @if (visQuerySvc.pipelineModel().Pipeline.AllowEdit && typeInfos()[dataSource.EntityGuid].EnableConfig) {\r\n              <mat-icon\r\n                class=\"configure\"\r\n                title=\"Configure data source\"\r\n                appMousedownStopPropagation\r\n                (click)=\"configureDataSource(dataSource)\"\r\n              >\r\n                settings\r\n              </mat-icon>\r\n            }\r\n            @if (typeInfos()[dataSource.EntityGuid].HelpLink) {\r\n              <mat-icon\r\n                class=\"help\"\r\n                title=\"Help for this data source\"\r\n                appMousedownStopPropagation\r\n                (click)=\"openHelp(typeInfos()[dataSource.EntityGuid].HelpLink)\"\r\n              >\r\n                help_outline\r\n              </mat-icon>\r\n            }\r\n          </div>\r\n          <div class=\"actions right\">\r\n            @if (visQuerySvc.pipelineModel().Pipeline.AllowEdit && !isOutDataSource(dataSource)) {\r\n              <mat-icon class=\"delete\" title=\"Delete\" appMousedownStopPropagation (click)=\"remove(dataSource)\"> delete </mat-icon>\r\n            }\r\n          </div>\r\n          <div\r\n            class=\"name\"\r\n            title=\"Click to edit name\"\r\n            appMousedownStopPropagation\r\n            (click)=\"visQuerySvc.pipelineModel().Pipeline.AllowEdit && editName(dataSource)\"\r\n          >\r\n            <span>{{ dataSource.Name || '(no name)' }}</span>\r\n            <mat-icon class=\"show-hover-inline\">edit</mat-icon>\r\n          </div>\r\n          <br />\r\n          <div\r\n            class=\"description\"\r\n            title=\"Click to edit description\"\r\n            appMousedownStopPropagation\r\n            (click)=\"visQuerySvc.pipelineModel().Pipeline.AllowEdit && editDescription(dataSource)\"\r\n          >\r\n            <span>{{ dataSource.Description }}</span>\r\n            <mat-icon class=\"show-hover-inline\">edit</mat-icon>\r\n          </div>\r\n          <br />\r\n          @if (showDataSourceDetails() && visQuerySvc.dataSourceConfigs()[dataSource.EntityId]?.length) {\r\n            <hr style=\"margin: 0\" />\r\n            <table class=\"configs\">\r\n              @for (config of visQuerySvc.dataSourceConfigs()[dataSource.EntityId]; track config) {\r\n                <tr class=\"config\">\r\n                  <td class=\"config-name\" [title]=\"config.name\">{{ config.name }}</td>\r\n                  <td class=\"config-value\" [title]=\"config.value\">{{ config.value }}</td>\r\n                </tr>\r\n              }\r\n            </table>\r\n          }\r\n          <div class=\"typename\" [title]=\"dataSource.PartAssemblyAndType\">Type: {{ getTypeName(dataSource.PartAssemblyAndType) }}</div>\r\n          @if (visQuerySvc.pipelineModel().Pipeline.AllowEdit && typeInfos()[dataSource.EntityGuid].DynamicOut) {\r\n            <div class=\"add-endpoint sourceEndpoint dynamic\" title=\"Drag a new Out-Connection\"></div>\r\n          }\r\n          @if (visQuerySvc.pipelineModel().Pipeline.AllowEdit && typeInfos()[dataSource.EntityGuid].DynamicIn) {\r\n            <div class=\"many-in targetEndpoint dynamic\" title=\"This data source supports multiple In-Connections\"></div>\r\n          }\r\n        </div>\r\n      }\r\n    }\r\n  </div>\r\n}\r\n","// tslint:disable-next-line:max-line-length\r\nimport { NgClass, NgStyle } from '@angular/common';\r\nimport { AfterViewInit, ChangeDetectorRef, Component, computed, ElementRef, OnDestroy, OnInit, QueryList, ViewChild, ViewChildren, ViewContainerRef } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { BehaviorSubject, combineLatest, map } from 'rxjs';\r\nimport { transient } from '../../../../../core';\r\nimport { BaseComponent } from '../../shared/components/base';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { MousedownStopPropagationDirective } from '../../shared/directives/mousedown-stop-propagation.directive';\r\nimport { JsonHelpers } from '../../shared/helpers/json.helpers';\r\nimport { loadScripts } from '../../shared/helpers/load-scripts.helper';\r\nimport { classLog } from '../../shared/logging';\r\nimport { DataSourceDefinition } from '../models/data-source-definition';\r\nimport { QueryStreamResult } from '../models/result/PipelineResultStream';\r\nimport { VisualDesignerData } from '../models/visual-designer-data';\r\nimport { QueryDefinitionService } from '../services/query-definition.service';\r\nimport { VisualQueryStateService } from '../services/visual-query.service';\r\nimport { findDefByType } from './datasource.helpers';\r\nimport { calculateTypeInfos } from './plumb-editor.helpers';\r\nimport { domIdOfGuid } from './plumber-constants';\r\nimport { Plumber } from './plumber.helper';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  ngAfterViewInit: false,\r\n}\r\n\r\nconst jsPlumbUrl = 'https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js';\r\n\r\n@Component({\r\n    selector: 'app-plumb-editor',\r\n    templateUrl: './plumb-editor.html',\r\n    styles: [':host { display: block; width: 100%; height: 100%; }'],\r\n    imports: [\r\n        NgStyle,\r\n        NgClass,\r\n        MatIconModule,\r\n        MousedownStopPropagationDirective,\r\n    ]\r\n})\r\nexport class PlumbEditorComponent extends BaseComponent implements OnInit, AfterViewInit, OnDestroy {\r\n\r\n  log = classLog({ PlumbEditorComponent }, logSpecs);\r\n\r\n  @ViewChild('domRoot') private domRootRef: ElementRef<HTMLDivElement>;\r\n  @ViewChildren('domDataSource') private domDataSourcesRef: QueryList<ElementRef<HTMLDivElement>>;\r\n\r\n  /** provide this fn to the UI */\r\n  domIdOfGuid = domIdOfGuid;\r\n  hardReset = false;\r\n\r\n  #plumber: Plumber;\r\n  #scriptLoaded$ = new BehaviorSubject(false);\r\n\r\n\r\n  #queryDefinitionSvc = transient(QueryDefinitionService);\r\n\r\n  showDataSourceDetails = computed(() => {\r\n    const result = JsonHelpers.tryParse(this.visQuerySvc.pipelineModel()?.Pipeline.VisualDesignerData) ?? {};\r\n    return result.ShowDataSourceDetails ?? false;\r\n  });\r\n\r\n  typeInfos = computed(() =>\r\n    calculateTypeInfos(this.visQuerySvc.pipelineModel()?.DataSources ?? [], this.visQuerySvc.dataSources()\r\n    ));\r\n\r\n  constructor(\r\n    public visQuerySvc: VisualQueryStateService, // Check if this not with transient better\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n    private matDialog: MatDialog,\r\n    private viewContainerRef: ViewContainerRef,\r\n  ) { super(); }\r\n\r\n  ngOnInit() {\r\n    loadScripts([{ test: 'jsPlumb', src: jsPlumbUrl }], () => {\r\n      this.#scriptLoaded$.next(true);\r\n    });\r\n\r\n    this.subscriptions.add(\r\n      this.visQuerySvc.putEntityCountOnConnections$.subscribe(result => {\r\n        this.#plumber.lineDecorator.addEntityCount(result);\r\n      })\r\n    );\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    const l = this.log.fnIf('ngAfterViewInit');\r\n    // https://stackoverflow.com/questions/37087864/execute-a-function-when-ngfor-finished-in-angular-2/37088348#37088348\r\n    const domDataSourcesLoaded$ = this.domDataSourcesRef.changes.pipe(map(() => true));\r\n\r\n    this.subscriptions.add(\r\n      combineLatest([this.#scriptLoaded$, domDataSourcesLoaded$]).subscribe(([scriptLoaded, domDataSourcesLoaded]) => {\r\n        if (!scriptLoaded || !domDataSourcesLoaded)\r\n          return;\r\n\r\n        l.a('scriptLoaded and domDataSourcesLoaded', { scriptLoaded, domDataSourcesLoaded });\r\n\r\n        this.#plumber?.destroy();\r\n        this.#plumber = new Plumber(\r\n          this.domRootRef.nativeElement,\r\n          this.visQuerySvc.pipelineModel(),\r\n          this.visQuerySvc.dataSources(),\r\n          () => this.onConnectionsChanged(),\r\n          this.onDragend.bind(this),\r\n          this.onDebugStream.bind(this),\r\n          {\r\n            matDialog: this.matDialog,\r\n            viewContainerRef: this.viewContainerRef,\r\n            changeDetectorRef: this.changeDetectorRef,\r\n            onConnectionsChanged: () => this.onConnectionsChanged(),\r\n          },\r\n        );\r\n      })\r\n    );\r\n    l.end();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.#plumber?.destroy();\r\n    this.#scriptLoaded$.complete();\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  onConnectionsChanged() {\r\n    const connections = this.#plumber.connections.getAll();\r\n    const streamsOut = this.#plumber.getStreamsOut();\r\n    this.visQuerySvc.changeConnections(connections, streamsOut);\r\n  }\r\n\r\n  onDragend(pipelineDataSourceGuid: string, position: VisualDesignerData) {\r\n    this.visQuerySvc.changeDataSourcePosition(pipelineDataSourceGuid, position);\r\n  }\r\n\r\n  onDebugStream(stream: QueryStreamResult) {\r\n    this.visQuerySvc.debugStream(stream);\r\n  }\r\n\r\n  configureDataSource(dataSource: DataSourceDefinition): void {\r\n    // ensure dataSource entity is saved\r\n    if (dataSource.EntityGuid.includes('unsaved'))\r\n      return this.visQuerySvc.saveAndRun(true, false);\r\n\r\n    this.visQuerySvc.editDataSource(dataSource);\r\n  }\r\n\r\n  getTypeName(partAssemblyAndType: string) {\r\n    const dataSource = findDefByType(this.visQuerySvc.dataSources(), partAssemblyAndType);\r\n    return this.#queryDefinitionSvc.typeNameFilter(dataSource?.TypeNameForUi || partAssemblyAndType, 'className');\r\n  }\r\n\r\n  isOutDataSource(pipelineDataSource: DataSourceDefinition) {\r\n    return pipelineDataSource.PartAssemblyAndType === eavConstants.pipelineDesigner.outDataSource.PartAssemblyAndType;\r\n  }\r\n\r\n  remove(pipelineDataSource: DataSourceDefinition) {\r\n    if (!confirm(`Delete ${pipelineDataSource.Name} data source?`))\r\n      return;\r\n\r\n    // Update UI\r\n    this.#plumber.removeAllEndpoints(pipelineDataSource.EntityGuid);\r\n\r\n    // Tell backend to clean up\r\n    const connections = this.#plumber.connections.getAll();\r\n    const streamsOut = this.#plumber.getStreamsOut();\r\n    this.visQuerySvc.removeDataSource(pipelineDataSource.EntityGuid, connections, streamsOut);\r\n  }\r\n\r\n  openHelp(url: string) {\r\n    window.open(url, '_blank');\r\n  }\r\n\r\n  editName(dataSource: DataSourceDefinition) {\r\n    const newName = prompt('Rename data source', dataSource.Name)?.trim();\r\n    if (newName == null || newName === '')\r\n      return;\r\n\r\n    this.visQuerySvc.renameDataSource(dataSource.EntityGuid, newName);\r\n  }\r\n\r\n  editDescription(dataSource: DataSourceDefinition) {\r\n    const newDescription = prompt('Edit description', dataSource.Description)?.trim();\r\n    if (newDescription == null)\r\n      return;\r\n\r\n    this.visQuerySvc.changeDataSourceDescription(dataSource.EntityGuid, newDescription);\r\n  }\r\n\r\n}\r\n","@if (vsSvc.pipelineModel()) {\r\n  <div class=\"editor-active-explorer fancy-scrollbar-dark\">\r\n    <div class=\"wrapper\">\r\n      <div class=\"actions\">\r\n        <button\r\n          mat-raised-button\r\n          class=\"eav-action-button action\"\r\n          style=\"border: 1px #adadad solid\"\r\n          (click)=\"saveAndRunQuery(true, true)\"\r\n          >\r\n            Save and run\r\n          </button>\r\n        <button\r\n          mat-raised-button\r\n          class=\"action\"\r\n          (click)=\"saveAndRunQuery(false, true)\"\r\n        >\r\n            Run\r\n        </button>\r\n        <button\r\n          mat-raised-button\r\n          class=\"action\"\r\n          (click)=\"saveAndRunQuery(true, false)\"\r\n        >\r\n        Save\r\n        </button>\r\n      </div>\r\n      <div class=\"parameters\">\r\n        <div class=\"title\">\r\n          <div>Query Parameters</div>\r\n          <div>\r\n            <button mat-icon-button tippy=\"Edit parameters\" (click)=\"editPipeline()\">\r\n              <mat-icon>edit</mat-icon>\r\n            </button>\r\n            <button mat-icon-button tippy=\"Query Params Docs\" (click)=\"openParamsHelp()\">\r\n              <mat-icon>info</mat-icon>\r\n            </button>\r\n          </div>\r\n        </div>\r\n        @if (vsSvc.pipelineModel().Pipeline.Params?.length) {\r\n          <ul class=\"values\">\r\n            @for (\r\n              param of vsSvc.pipelineModel().Pipeline.Params?.split('\\n');\r\n              track param;\r\n            ) {\r\n              <li>\r\n                {{ param }}\r\n              </li>\r\n            }\r\n          </ul>\r\n        }\r\n      </div>\r\n      <div class=\"parameters\">\r\n        <div class=\"title\">Test Parameters</div>\r\n        @if (vsSvc.pipelineModel().Pipeline.TestParameters?.length) {\r\n          <ul class=\"values\">\r\n            @for (\r\n              param of vsSvc.pipelineModel().Pipeline.TestParameters?.split('\\n');\r\n              track param;\r\n            ) {\r\n              <li>\r\n                {{ param }}\r\n              </li>\r\n            }\r\n          </ul>\r\n        }\r\n      </div>\r\n      @if (visualDesignerDataSig()) {\r\n        <div class=\"parameters\">\r\n          <span class=\"eav-slide-toggle-label\">Show DataSource Params</span>\r\n          <mat-slide-toggle\r\n            color=\"primary\"\r\n            [checked]=\"visualDesignerDataSig().ShowDataSourceDetails\"\r\n            (change)=\"showDataSourceDetails($event)\"\r\n          />\r\n        </div>\r\n      }\r\n      @if (warningSig()) {\r\n        @if (warningSig().length) {\r\n          <div class=\"warnings\">\r\n            <div class=\"title\">\r\n              <span>Warnings</span>\r\n              <mat-icon style=\"color: red\">warning</mat-icon>\r\n            </div>\r\n            <ol class=\"values\">\r\n              @for (warning of warningSig(); track warning) {\r\n                <li [innerHTML]=\"warning\"></li>\r\n              }\r\n            </ol>\r\n          </div>\r\n        }\r\n      }\r\n      @if (vsSvc.pipelineModel().Pipeline.Description) {\r\n        <div class=\"description\">\r\n          <div class=\"title\">Query Description</div>\r\n          <div>{{ vsSvc.pipelineModel().Pipeline.Description }}</div>\r\n        </div>\r\n      }\r\n      <div class=\"footer-actions\">\r\n        <button mat-raised-button class=\"action\" (click)=\"openRestApi()\">\r\n          <span>Use in JSON / REST API</span>\r\n          <mat-icon>code_curly</mat-icon>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n}\r\n","import { Component, signal } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSlideToggleChange, MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { transient } from '../../../../../core';\r\nimport { GoToDevRest } from '../../dev-rest';\r\nimport { JsonHelpers } from '../../shared/helpers/json.helpers';\r\nimport { DialogRoutingService } from '../../shared/routing/dialog-routing.service';\r\nimport { Context } from '../../shared/services/context';\r\nimport { VisualQueryStateService } from '../services/visual-query.service';\r\nimport { calculateWarnings } from './run-explorer.helpers';\r\n\r\n@Component({\r\n    selector: 'app-run-explorer',\r\n    templateUrl: './run-explorer.html',\r\n    styleUrls: ['./run-explorer.scss'],\r\n    imports: [\r\n        MatButtonModule,\r\n        MatIconModule,\r\n        MatSlideToggleModule,\r\n    ]\r\n})\r\nexport class RunExplorerComponent {\r\n\r\n  warningSig = signal<string[]>(\r\n    calculateWarnings(this.vsSvc?.pipelineModel() ?? null, this.context)\r\n  );\r\n\r\n  visualDesignerDataSig = signal<Record<string, any>>(\r\n    JsonHelpers.tryParse(this.vsSvc?.pipelineModel()?.Pipeline.VisualDesignerData) ?? {}\r\n  );\r\n\r\n  #dialogRouter = transient(DialogRoutingService);\r\n\r\n  constructor(\r\n    private context: Context,\r\n    public vsSvc: VisualQueryStateService,\r\n  ) { }\r\n\r\n  editPipeline() {\r\n    this.vsSvc.editPipelineEntity();\r\n  }\r\n\r\n  openParamsHelp() {\r\n    window.open('https://go.2sxc.org/QueryParams', '_blank');\r\n  }\r\n\r\n  saveAndRunQuery(save: boolean, run: boolean) {\r\n    this.vsSvc.saveAndRun(save, run);\r\n  }\r\n\r\n  showDataSourceDetails(event: MatSlideToggleChange): void {\r\n    this.vsSvc.showDataSourceDetails(event.checked);\r\n  }\r\n\r\n  openRestApi() {\r\n    const queryGuid = this.vsSvc.pipelineModel().Pipeline.EntityGuid;\r\n    this.#dialogRouter.navRelative([GoToDevRest.getUrlQueryDialog(queryGuid)]);\r\n  }\r\n}\r\n","import { Context } from '../../shared/services/context';\r\nimport { VisualQueryModel } from '../models/visual-query.model';\r\n\r\n/**\r\n * Check if there are special warnings the developer should know.\r\n * Typically when the test ModuleId is different from the one we're currently working on\r\n */\r\nexport function calculateWarnings(pipelineModel: VisualQueryModel, context: Context) {\r\n  if(!pipelineModel) return [];\r\n  const warnings: string[] = [];\r\n\r\n  try {\r\n    const queryParams = pipelineModel.Pipeline.Params?.split(/\\r?\\n/) || [];\r\n    const testParams = pipelineModel.Pipeline.TestParameters?.split(/\\r?\\n/) || [];\r\n\r\n    queryParams.forEach(param => {\r\n      param = param?.trim();\r\n      if (!param) return;\r\n\r\n      // Check if the syntax on Query Parameters is off.\r\n      // It should contain [...]=...\r\n      // But it's easy to forget the [ and ] brackets\r\n      const paramSyntax = /^[a-zA-Z0-9]+=(.*)$/gmi;\r\n      const matched = paramSyntax.test(param);\r\n      if (!matched) {\r\n        warnings.push(`\r\n          A <em>Query Parameter</em> seems wrong: <br>\r\n          <code>${param}</code> <br>\r\n          It should use the syntax: <br>\r\n          <code>key=value</code> <br>\r\n          or resolve to a token like: <br>\r\n          <code>key=[source:key]</code>\r\n        `);\r\n      }\r\n    });\r\n\r\n    testParams.forEach(param => {\r\n      param = param?.trim();\r\n      if (!param) return;\r\n\r\n      // Check if the syntax on Test Parameters is off.\r\n      // It should contain [...]=...\r\n      // But it's easy to forget the [ and ] brackets\r\n      const testParamSyntax = /^\\[[a-zA-Z]+:[a-zA-Z0-9]+\\]=(.*)$/gmi;\r\n      const matched = testParamSyntax.test(param);\r\n      if (!matched) {\r\n        warnings.push(`\r\n          A <em>Test Parameter</em> seems wrong: <br>\r\n          <code>${param}</code> <br>\r\n          It should use the syntax: <br>\r\n          <code>[source:key]=value</code>\r\n        `);\r\n      }\r\n\r\n      // Check if we should show the warning about the test ModuleId.\r\n      // This is because in the old days, the ModuleId wasn't auto-filled, so people had to add it as a test value.\r\n      // Now it's not necessary any more\r\n      const midRegex = /^\\[module:id\\]=([0-9]*)$/gmi;\r\n      const midMatch = midRegex.exec(param);\r\n      if (midMatch) {\r\n        const testMid = midMatch[1];\r\n        const urlMid = context.moduleId?.toString();\r\n        if (testMid !== urlMid) {\r\n          warnings.push(`\r\n            Your test ModuleId (${testMid}) is different from the current ModuleId (${urlMid}).<br>\r\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\r\n          `);\r\n        }\r\n      }\r\n\r\n      const oldMidRegex = /^\\[module:moduleid\\]=([0-9]*)$/gmi;\r\n      const oldMidMatch = oldMidRegex.exec(param);\r\n      if (oldMidMatch) {\r\n        warnings.push(`\r\n          You are using deprecated [Module:ModuleId] test parameter.<br>\r\n          Please use [Module:Id]\r\n        `);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Something went wrong in calculateWarnings for params', error);\r\n  }\r\n\r\n  return warnings;\r\n}\r\n","import { NgClass } from '@angular/common';\r\nimport { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { ActivatedRoute, RouterOutlet } from '@angular/router';\r\nimport { Context } from '../shared/services/context';\r\nimport { AddExplorerComponent } from './add-explorer/add-explorer';\r\nimport { PlumbEditorComponent } from './plumb-editor/plumb-editor';\r\nimport { RunExplorerComponent } from './run-explorer/run-explorer';\r\nimport { VisualQueryStateService } from './services/visual-query.service';\r\n\r\n@Component({\r\n    selector: 'app-visual-query',\r\n    templateUrl: './visual-query.html',\r\n    styleUrls: ['./visual-query.scss'],\r\n    imports: [\r\n        RouterOutlet,\r\n        NgClass,\r\n        MatIconModule,\r\n        RunExplorerComponent,\r\n        AddExplorerComponent,\r\n        PlumbEditorComponent,\r\n    ],\r\n    providers: [\r\n        VisualQueryStateService, // Shared State for the entire Visual Query, - init run here\r\n    ]\r\n})\r\nexport class VisualQueryComponent implements OnInit {\r\n  @ViewChild(PlumbEditorComponent) plumbEditor: PlumbEditorComponent;\r\n\r\n  explorer = {\r\n    run: 'run',\r\n    add: 'add'\r\n  };\r\n  activeExplorer = this.explorer.run;\r\n\r\n  constructor(\r\n    private context: Context,\r\n    private route: ActivatedRoute,\r\n    private visualQueryService: VisualQueryStateService\r\n  ) {\r\n    this.context.init(this.route);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.visualQueryService.init();\r\n  }\r\n\r\n  toggleExplorer(explorer: string) {\r\n    this.activeExplorer = (this.activeExplorer === explorer) ? null : explorer;\r\n  }\r\n\r\n  openHelp() {\r\n    window.open('https://go.2sxc.org/visual-query', '_blank');\r\n  }\r\n\r\n}\r\n","<router-outlet></router-outlet>\r\n\r\n<div class=\"editor-root\">\r\n  <div class=\"editor-side-toolbar\">\r\n    <div class=\"button\" tippy=\"Run\" [ngClass]=\"{ 'active': activeExplorer === explorer.run }\"\r\n      (click)=\"toggleExplorer(explorer.run)\">\r\n      <mat-icon>play_arrow</mat-icon>\r\n    </div>\r\n    <div class=\"button\" tippy=\"Add\" [ngClass]=\"{ 'active': activeExplorer === explorer.add }\"\r\n      (click)=\"toggleExplorer(explorer.add)\">\r\n      <mat-icon>add</mat-icon>\r\n    </div>\r\n    <div class=\"spacer\"></div>\r\n    <div class=\"button\" tippy=\"Help\" (click)=\"openHelp()\">\r\n      <mat-icon>help_outline</mat-icon>\r\n    </div>\r\n  </div>\r\n\r\n  <app-run-explorer [hidden]=\"activeExplorer !== explorer.run\"></app-run-explorer>\r\n\r\n  <app-add-explorer [hidden]=\"activeExplorer !== explorer.add\"></app-add-explorer>\r\n\r\n  <app-plumb-editor></app-plumb-editor>\r\n</div>\r\n","export function toBase64(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => {\r\n      resolve((reader.result as string).split(',')[1]);\r\n    };\r\n    reader.onerror = error => {\r\n      reject(error);\r\n    };\r\n  });\r\n}\r\n\r\nexport function toString(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsText(file);\r\n    reader.onload = () => {\r\n      resolve(reader.result as string);\r\n    };\r\n    reader.onerror = error => {\r\n      reject(error);\r\n    };\r\n  });\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { ContentInfo } from '../models/content-info.model';\r\nimport { webApiAppPartsRoot } from './import-app-parts.service';\r\n\r\nconst webApiAppPartsGet = 'admin/appParts/get';\r\n@Injectable()\r\nexport class ExportAppPartsService extends HttpServiceBaseSignal {\r\n\r\n  getContentInfoLiveParam(scope: Signal<string>) {\r\n    return httpResource<ContentInfo>(() => {\r\n      return {\r\n        url: this.apiUrl(webApiAppPartsGet),\r\n        params: {\r\n          appid: this.appId,\r\n          zoneId: this.zoneId,\r\n          scope: scope()\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  exportParts(contentTypeIds: number[], entityIds: number[], templateIds: number[]) {\r\n    const url = this.apiUrl(webApiAppPartsRoot + 'Export')\r\n      + '?appId=' + this.appId\r\n      + '&zoneId=' + this.zoneId\r\n      + '&contentTypeIdsString=' + contentTypeIds.join(';')\r\n      + '&entityIdsString=' + entityIds.join(';')\r\n      + '&templateIdsString=' + templateIds.join(';');\r\n\r\n    window.open(url, '_blank', '');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, switchMap } from 'rxjs';\r\nimport { FileUploadMessageTypes, FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\n\r\nexport const webApiAppRoot = 'admin/app/';\r\n\r\n@Injectable()\r\nexport class ImportAppService extends HttpServiceBaseSignal {\r\n\r\n  importApp(file: File, changedName: string, retryOnDuplicate = false): Observable<FileUploadResult> {\r\n    const formData = new FormData();\r\n    formData.append('File', file);\r\n    formData.append('Name', changedName ?? '');\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiAppRoot + 'Import'), formData, {\r\n      params: { zoneId: this.zoneId }\r\n    }).pipe(\r\n      switchMap(result => {\r\n        if (retryOnDuplicate && result.Messages[0]?.MessageType === FileUploadMessageTypes.Warning) {\r\n          const folderName = prompt(result.Messages[0].Text + ' Would you like to install it using another folder name?');\r\n          if (folderName) {\r\n            return this.importApp(file, folderName, true);\r\n          }\r\n        }\r\n        return of(result);\r\n      }),\r\n    );\r\n  }\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { from, map, switchMap } from 'rxjs';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { toBase64 } from '../../shared/helpers/file-to-base64.helper';\r\nimport { classLog } from '../../shared/logging';\r\nimport { webApiEntityList } from '../../shared/services/entity.service';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { Query } from '../models/query.model';\r\n\r\nconst logSpecs = {\r\n  all: true,\r\n  getAll: false,\r\n  getAllSig: true,\r\n  getAllLive: false,\r\n  getAllRes: true,\r\n  importQuery: false,\r\n  clonePipeline: false,\r\n  delete: false,\r\n  update: false,\r\n};\r\n\r\nconst webApiQueryImport = 'admin/query/import';\r\nconst webApiQueryClone = 'admin/query/Clone';\r\nconst webApiQueryDelete = 'admin/query/Delete';\r\nexport const webApiQueryRun = 'admin/query/RunDev';\r\nexport const webApiQueryDebugStream = 'admin/query/DebugStream';\r\nexport const webApiQuerySave = 'admin/query/Save';\r\nexport const webApiQueryGet = 'admin/query/Get';\r\nexport const webApiQueryDataSources = 'admin/query/DataSources';\r\n\r\n@Injectable()\r\nexport class PipelinesService extends HttpServiceBase {\r\n\r\n  log = classLog({ PipelinesService }, logSpecs);\r\n  // TODO: @2dg, ask 2dm \r\n  getAll(contentType: string) {\r\n    const l = this.log.fnIf('getAll');\r\n    return l.r(this.getHttpApiUrl<Query[]>(webApiEntityList, {\r\n      params: { appId: this.appId, contentType }\r\n    }));\r\n  }\r\n\r\n  // Full Code, repated x times\r\n  getAllLive(contentType: string, refresh: Signal<unknown>) {\r\n    this.log.fnIf('getAllLive', { contentType, refresh });\r\n    return httpResource<Query[]>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiEntityList),\r\n        params: { appId: this.appId, contentType: contentType }\r\n      });\r\n    });\r\n  }\r\n\r\n  /** Experimental httpResource use! */\r\n  getAllRes(contentType: string, initial?: Query[]) {\r\n    const l = this.log.fnIf('getAllRes');\r\n    const res = httpResource<Query[]>(() => ({\r\n      url: webApiEntityList,\r\n      params: { appId: this.appId, contentType },\r\n    }), { defaultValue: initial });\r\n    return l.r(res);\r\n  }\r\n\r\n  importQuery(file: File) {\r\n    const l = this.log.fnIf('importQuery');\r\n    const obs = from(toBase64(file)).pipe(\r\n      switchMap(fileBase64 => {\r\n        return this.http.post<boolean>(this.apiUrl(webApiQueryImport), {\r\n          AppId: this.appId,\r\n          ContentBase64: fileBase64,\r\n        });\r\n      }),\r\n      map(success => {\r\n        const result: FileUploadResult = {\r\n          Success: success,\r\n          Messages: [],\r\n        };\r\n        return result;\r\n      }),\r\n    );\r\n    return l.r(obs);\r\n  }\r\n\r\n  clonePipelinePromise(id: number): Promise<null> {\r\n    const l = this.log.fnIf('clonePipeline');\r\n    const obs = this.fetchPromise<null>(webApiQueryClone, {\r\n      params: { Id: id.toString(), appId: this.appId }\r\n    });\r\n    return l.r(obs);\r\n  }\r\n\r\n  delete(id: number) {\r\n    const l = this.log.fnIf('delete');\r\n    const obs = this.http.delete<boolean>(this.apiUrl(webApiQueryDelete), {\r\n      params: { appId: this.appId, Id: id.toString() },\r\n    });\r\n    return l.r(obs);\r\n  }\r\n}\r\n"],"x_google_ignoreList":[2,6,7,8]}