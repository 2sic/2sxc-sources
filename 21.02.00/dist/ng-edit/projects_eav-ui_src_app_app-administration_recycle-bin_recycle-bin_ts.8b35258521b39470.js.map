{"version":3,"file":"projects_eav-ui_src_app_app-administration_recycle-bin_recycle-bin_ts.8b35258521b39470.js","mappings":"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","names":["i0","type_r2","name","title","ctx_r2","selectedHistoryItem","_c0","AppRecycleBin","constructor","this","gridOptions","buildGridOptions","selectedDeletedEntity","dataSourceData","computed","deletedEntities","#dataSvc","transient","SysDataService","#context","inject","Context","#http","HttpClient","#refresh","signal","#defaultRangeEnd","dayjs","endOf","#defaultRangeStart","subtract","startOf","dateRangeStart","model","dateRangeEnd","selectedContentType","#data","getMany","source","refresh","streams","params","start","end","DateFrom","toISOString","DateTo","ContentType","value","default","contentTypes","displayedColumns","defaultGridOptions","columnDefs","ColumnDefinitions","TextWideMin100","headerName","field","flex","ActionsPinnedRight3","cellRenderer","onCellClicked","event","colDef","target","dataset","action","restore","data","onRowSelected","item","json","JSON","parse","confirm","url","appId","deletedTransactionId","post","responseType","subscribe","next","alert","update","v","error","console","message","selectors","inputs","outputs","decls","vars","consts","template","rf","ctx","$event","_r1","AppRecycleBin_For_23_Template","_forTrack0","AppRecycleBin_div_35_Template","length","dateRangePicker_r4","CommonModule","i1","RouterOutlet","FormsModule","i2","MatButtonModule","MatCardModule","i3","MatDatepickerModule","i4","MatFormFieldModule","i5","MatIconModule","MatInputModule","MatSelectModule","i6","i7","MatExpansionModule","MatTooltipModule","MatDayjsModule","FeatureIconComponent","SxcGridModule","i8","HistoryItemComponent","styles"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/recycle-bin/recycle-bin.html","./projects/eav-ui/src/app/app-administration/recycle-bin/recycle-bin.ts"],"sourcesContent":["<mat-card>\r\n  <mat-card-header>\r\n    <mat-card-title>\r\n      <span class=\"mat-headline\">Recycle Bin (Beta)</span>\r\n    </mat-card-title>\r\n  </mat-card-header>\r\n  <mat-card-content>\r\n    <p class=\"mat-body-1\">Here you can see and restore deleted items within this app.</p>\r\n    <p class=\"mat-caption\"><strong>Note:</strong> This feature is currently in beta and may not be fully stable. Use with caution.</p>\r\n\r\n    <h3 class=\"mat-subtitle-1\">\r\n      Deleted Items ({{ deletedEntities().length }} total)\r\n\r\n      <!-- Indicator if feature is not active -->\r\n      <app-feature-icon [featureNameId]=\"'EntityUndelete'\"></app-feature-icon>\r\n    </h3>\r\n    \r\n    <div class=\"recycle-bin-filters\">\r\n      <mat-form-field appearance=\"outline\" color=\"accent\" class=\"recycle-bin-filter\">\r\n        <mat-label>Filter by Content Type</mat-label>\r\n        <mat-select [(value)]=\"selectedContentType\">\r\n          <mat-option value=\"\">All Types</mat-option>\r\n          @for (type of contentTypes(); track type.staticName) {\r\n            <mat-option [value]=\"type.name\">{{ type.title }}</mat-option>\r\n          }\r\n        </mat-select>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field appearance=\"outline\" color=\"accent\" class=\"recycle-bin-filter\">\r\n        <mat-label>Date range</mat-label>\r\n        <mat-date-range-input [rangePicker]=\"dateRangePicker\">\r\n          <input matStartDate [(ngModel)]=\"dateRangeStart\" placeholder=\"Start date\" />\r\n          <input matEndDate [(ngModel)]=\"dateRangeEnd\" placeholder=\"End date\" />\r\n        </mat-date-range-input>\r\n        <mat-datepicker-toggle matSuffix [for]=\"dateRangePicker\"></mat-datepicker-toggle>\r\n        <mat-date-range-picker #dateRangePicker></mat-date-range-picker>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div>\r\n      <ag-grid-angular\r\n        class=\"ag-theme-material\"\r\n        style=\"width: 100%; min-height: 300px;\"\r\n        [rowData]=\"dataSourceData()\"\r\n        [gridOptions]=\"gridOptions\"\r\n        domLayout=\"autoHeight\"\r\n      ></ag-grid-angular>\r\n    </div>\r\n\r\n    <div *ngIf=\"selectedHistoryItem\" class=\"recycle-bin-details\" style=\"margin-top: 2rem;\">\r\n      <h4>Deleted Item Details</h4>\r\n      <app-history-item\r\n        [historyItem]=\"selectedHistoryItem\"\r\n        [isExpanded]=\"true\"\r\n        [expandedAttributes]=\"{}\"\r\n      ></app-history-item>\r\n    </div>\r\n  </mat-card-content>\r\n</mat-card>\r\n<router-outlet></router-outlet>\r\n","import { GridOptions } from '@ag-grid-community/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Component, computed, inject, model, signal } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatDatepickerModule } from '@angular/material/datepicker';\r\nimport { MatExpansionModule } from '@angular/material/expansion';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { RouterOutlet } from '@angular/router';\r\nimport dayjs, { Dayjs } from 'dayjs';\r\nimport { transient } from 'projects/core';\r\nimport { MatDayjsModule } from '../../edit/shared/date-adapters/date-adapter-api';\r\nimport { FeatureIconComponent } from '../../features/feature-icon/feature-icon';\r\nimport { FeatureSummary } from '../../features/models';\r\nimport { HistoryItemComponent } from '../../item-history/history-item';\r\nimport { ColumnDefinitions } from '../../shared/ag-grid/column-definitions';\r\nimport { defaultGridOptions } from '../../shared/constants/default-grid-options.constants';\r\nimport { SxcGridModule } from '../../shared/modules/sxc-grid-module/sxc-grid.module';\r\nimport { Context } from '../../shared/services/context';\r\nimport { SysDataService } from '../../shared/services/sys-data.service';\r\n\r\n\r\n\r\nconst RECYCLE_BIN_DATASOURCE_ID = 'f890bec1-dee8-4ed6-9f2e-8ad412d2f4dc';\r\n\r\n@Component({\r\n  selector: 'recycle-bin',\r\n  templateUrl: './recycle-bin.html',\r\n  styleUrls: ['./recycle-bin.scss'],\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    RouterOutlet,\r\n    FormsModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatDatepickerModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatExpansionModule,\r\n    MatTooltipModule,\r\n    MatDayjsModule,\r\n    FeatureIconComponent,\r\n    SxcGridModule,\r\n    HistoryItemComponent,\r\n  ]\r\n})\r\nexport class AppRecycleBin {\r\n  // ag-Grid integration\r\n  gridOptions: GridOptions = this.buildGridOptions();\r\n\r\n  selectedDeletedEntity: DeletedEntity | null = null;\r\n  selectedHistoryItem: any = null; // Will be set to the parsed history item\r\n\r\n  dataSourceData = computed(() => {\r\n    return this.deletedEntities();\r\n  });\r\n\r\n  private buildGridOptions(): GridOptions {\r\n    return {\r\n      ...defaultGridOptions,\r\n      columnDefs: [\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Title',\r\n          field: 'title',\r\n          flex: 2,\r\n        },\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Content Type',\r\n          field: 'contentTypeStaticName',\r\n        },\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Deleted By',\r\n          field: 'deletedBy',\r\n        },\r\n        {\r\n          ...ColumnDefinitions.TextWideMin100,\r\n          headerName: 'Item ID',\r\n          field: 'id',\r\n        },\r\n        {\r\n          ...ColumnDefinitions.ActionsPinnedRight3,\r\n          headerName: 'Actions',\r\n          cellRenderer: (params: any) => {\r\n            return `<button class='ag-btn ag-btn-primary' data-action='restore'>Restore</button>`;\r\n          },\r\n        },\r\n      ],\r\n      onCellClicked: (event: any) => {\r\n        if (event.colDef.headerName === 'Actions' && event.event.target?.dataset?.action === 'restore') {\r\n          this.restore(event.data);\r\n        } else if (event.colDef.headerName !== 'Actions') {\r\n          this.onRowSelected(event.data);\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  onRowSelected(item: DeletedEntity) {\r\n    this.selectedDeletedEntity = item;\r\n    // Try to parse the JSON field (assuming it's called 'json' on the item)\r\n    if (item && (item as any).json) {\r\n      try {\r\n        this.selectedHistoryItem = JSON.parse((item as any).json);\r\n      } catch (e) {\r\n        this.selectedHistoryItem = null;\r\n      }\r\n    } else {\r\n      this.selectedHistoryItem = null;\r\n    }\r\n  }\r\n\r\n  #dataSvc = transient(SysDataService);\r\n  #context = inject(Context);\r\n  #http = inject(HttpClient);\r\n\r\n  #refresh = signal(0);\r\n\r\n  #defaultRangeEnd = dayjs().endOf('day');\r\n  #defaultRangeStart = dayjs().subtract(6, 'day').startOf('day');\r\n\r\n  dateRangeStart = model<Dayjs | null>(this.#defaultRangeStart);\r\n  dateRangeEnd = model<Dayjs | null>(this.#defaultRangeEnd);\r\n\r\n  selectedContentType = model('');\r\n\r\n  #data = this.#dataSvc.getMany<{ default: DeletedEntity[], feature: FeatureSummary[], contentTypes: ContentTypeInfo[] }>({\r\n    source: RECYCLE_BIN_DATASOURCE_ID,\r\n    refresh: this.#refresh,\r\n    streams: 'Default,Feature,ContentTypes',\r\n    params: computed(() => {\r\n      const start = this.dateRangeStart();\r\n      const end = this.dateRangeEnd();\r\n      return {\r\n        ...(start ? { DateFrom: start.startOf('day').toISOString() } : {}),\r\n        ...(end ? { DateTo: end.endOf('day').toISOString() } : {}),\r\n        ...(this.selectedContentType() ? { ContentType: this.selectedContentType() } : {}),\r\n      };\r\n    }),\r\n  });\r\n\r\n  deletedEntities = computed(() => this.#data.value()?.default ?? []);\r\n\r\n  contentTypes = computed(() => this.#data.value()?.contentTypes ?? []);\r\n\r\n  displayedColumns: string[] = ['Title', 'ContentTypeName', 'DeletedBy', 'DeletedUtc', 'actions'];\r\n\r\n  // expandedItems: Record<number, boolean> = {};\r\n\r\n  restore(item: DeletedEntity): void {\r\n    if (!confirm(`Are you sure you want to restore \"${item.title || '(no title)'}\"?`)) {\r\n      return;\r\n    }\r\n\r\n    const url = `admin/data/recycle?appid=${this.#context.appId}&transactionid=${item.deletedTransactionId}`;\r\n    \r\n    this.#http.post(url, {}, { responseType: 'text' }).subscribe({\r\n      next: () => {\r\n        alert('Data restored successfully');\r\n        this.#refresh.update(v => v + 1);\r\n      },\r\n      error: (error) => {\r\n        console.error('Error restoring data:', error);\r\n        alert(`Error restoring data: ${error.message || 'Unknown error'}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  // toggleExpandItem(expanded: boolean, itemId: number): void {\r\n  //   this.expandedItems[itemId] = expanded;\r\n  // }\r\n\r\n}\r\n\r\ntype DeletedEntity = {\r\n  parentRef: string;\r\n  appId: number;\r\n  guid: string | null;\r\n  id: number;\r\n  deletedTransactionId: number;\r\n  contentTypeStaticName: string;\r\n  deletedBy: string;\r\n  title: string | null;\r\n};\r\n\r\ntype ContentTypeInfo = {\r\n  name: string;\r\n  staticName: string;\r\n  count: number;\r\n  title: string;\r\n};"],"x_google_ignoreList":[]}