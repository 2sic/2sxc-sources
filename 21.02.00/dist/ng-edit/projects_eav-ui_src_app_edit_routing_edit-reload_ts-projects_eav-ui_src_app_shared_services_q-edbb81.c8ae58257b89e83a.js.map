{"version":3,"file":"projects_eav-ui_src_app_edit_routing_edit-reload_ts-projects_eav-ui_src_app_shared_services_q-edbb81.c8ae58257b89e83a.js","mappings":"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","names":["ServiceBase","constructor","this","subscriptions","Subscription","ngOnDestroy","destroy","unsubscribe","factory","…µfac","MatFormFieldModule","static","__ngFactoryType__","i0","type","imports","ObserversModule","MatFormField","BidiModule","ErrorStateMatcher","isErrorState","control","form","invalid","touched","submitted","token","providedIn","_ErrorStateTracker","_defaultMatcher","ngControl","_parentFormGroup","_parentForm","_stateChanges","errorState","matcher","updateErrorState","oldState","parent","newState","next","logSpecs","all","getAvailableEntities","getEntities","QueryService","http","context","log","classLog","getFromQuery","queryUrl","params","fields","entitiesFilter","fnIf","hasParams","urlParams","toLocaleLowerCase","includes","appId","substring","post","Guids","contentTypes","itemIds","join","i1","i2","EditReloadComponent","router","route","l","fn","p","snapshot","url","UrlHelpers","newUrlIfCurrentContainsOldUrl","items","rNull","navigate","r","selectors","decls","vars","template","rf","ctx","encapsulation"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/shared/services/service-base.ts","./node_modules/@angular/material/fesm2022/form-field.mjs","./node_modules/@angular/material/fesm2022/_error-options-chunk.mjs","./node_modules/@angular/material/fesm2022/_error-state-chunk.mjs","./projects/eav-ui/src/app/shared/services/query.service.ts","./projects/eav-ui/src/app/edit/routing/edit-reload.ts"],"sourcesContent":["import { Injectable, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\n/**\r\n * Base class for services - just to standardize use of subscriptions.\r\n * Has @Injectable() just to allow it ot use the standard OnDestroy interface.\r\n */\r\n@Injectable()\r\nexport abstract class ServiceBase implements OnDestroy {\r\n\r\n  protected subscriptions = new Subscription();\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroy();\r\n  }\r\n\r\n  // TODO: TRY TO GET RID OF THIS. AFAIK it's just used in the mask, which should switch over to signals.\r\n  destroy() {\r\n    this.subscriptions.unsubscribe();\r\n  }\r\n}\r\n","import { MatFormField, MatLabel, MatError, MatHint, MatPrefix, MatSuffix } from './_form-field-chunk.mjs';\nexport { MAT_ERROR, MAT_FORM_FIELD, MAT_FORM_FIELD_DEFAULT_OPTIONS, MAT_PREFIX, MAT_SUFFIX, MatFormFieldControl, getMatFormFieldDuplicatedHintError, getMatFormFieldMissingControlError, getMatFormFieldPlaceholderConflictError } from './_form-field-chunk.mjs';\nimport { BidiModule } from '@angular/cdk/bidi';\nimport { ObserversModule } from '@angular/cdk/observers';\nimport * as i0 from '@angular/core';\nimport { NgModule } from '@angular/core';\nimport '@angular/cdk/a11y';\nimport '@angular/cdk/coercion';\nimport '@angular/cdk/platform';\nimport '@angular/common';\nimport 'rxjs';\nimport 'rxjs/operators';\nimport '@angular/cdk/observers/private';\nimport './_animation-chunk.mjs';\nimport '@angular/cdk/layout';\n\nclass MatFormFieldModule {\n  static …µfac = i0.…µ…µngDeclareFactory({\n    minVersion: \"12.0.0\",\n    version: \"21.0.3\",\n    ngImport: i0,\n    type: MatFormFieldModule,\n    deps: [],\n    target: i0.…µ…µFactoryTarget.NgModule\n  });\n  static …µmod = i0.…µ…µngDeclareNgModule({\n    minVersion: \"14.0.0\",\n    version: \"21.0.3\",\n    ngImport: i0,\n    type: MatFormFieldModule,\n    imports: [ObserversModule, MatFormField, MatLabel, MatError, MatHint, MatPrefix, MatSuffix],\n    exports: [MatFormField, MatLabel, MatHint, MatError, MatPrefix, MatSuffix, BidiModule]\n  });\n  static …µinj = i0.…µ…µngDeclareInjector({\n    minVersion: \"12.0.0\",\n    version: \"21.0.3\",\n    ngImport: i0,\n    type: MatFormFieldModule,\n    imports: [ObserversModule, MatFormField, BidiModule]\n  });\n}\ni0.…µ…µngDeclareClassMetadata({\n  minVersion: \"12.0.0\",\n  version: \"21.0.3\",\n  ngImport: i0,\n  type: MatFormFieldModule,\n  decorators: [{\n    type: NgModule,\n    args: [{\n      imports: [ObserversModule, MatFormField, MatLabel, MatError, MatHint, MatPrefix, MatSuffix],\n      exports: [MatFormField, MatLabel, MatHint, MatError, MatPrefix, MatSuffix, BidiModule]\n    }]\n  }]\n});\n\nexport { MatError, MatFormField, MatFormFieldModule, MatHint, MatLabel, MatPrefix, MatSuffix };\n","import * as i0 from '@angular/core';\nimport { Injectable } from '@angular/core';\n\nclass ShowOnDirtyErrorStateMatcher {\n  isErrorState(control, form) {\n    return !!(control && control.invalid && (control.dirty || form && form.submitted));\n  }\n  static …µfac = i0.…µ…µngDeclareFactory({\n    minVersion: \"12.0.0\",\n    version: \"21.0.3\",\n    ngImport: i0,\n    type: ShowOnDirtyErrorStateMatcher,\n    deps: [],\n    target: i0.…µ…µFactoryTarget.Injectable\n  });\n  static …µprov = i0.…µ…µngDeclareInjectable({\n    minVersion: \"12.0.0\",\n    version: \"21.0.3\",\n    ngImport: i0,\n    type: ShowOnDirtyErrorStateMatcher\n  });\n}\ni0.…µ…µngDeclareClassMetadata({\n  minVersion: \"12.0.0\",\n  version: \"21.0.3\",\n  ngImport: i0,\n  type: ShowOnDirtyErrorStateMatcher,\n  decorators: [{\n    type: Injectable\n  }]\n});\nclass ErrorStateMatcher {\n  isErrorState(control, form) {\n    return !!(control && control.invalid && (control.touched || form && form.submitted));\n  }\n  static …µfac = i0.…µ…µngDeclareFactory({\n    minVersion: \"12.0.0\",\n    version: \"21.0.3\",\n    ngImport: i0,\n    type: ErrorStateMatcher,\n    deps: [],\n    target: i0.…µ…µFactoryTarget.Injectable\n  });\n  static …µprov = i0.…µ…µngDeclareInjectable({\n    minVersion: \"12.0.0\",\n    version: \"21.0.3\",\n    ngImport: i0,\n    type: ErrorStateMatcher,\n    providedIn: 'root'\n  });\n}\ni0.…µ…µngDeclareClassMetadata({\n  minVersion: \"12.0.0\",\n  version: \"21.0.3\",\n  ngImport: i0,\n  type: ErrorStateMatcher,\n  decorators: [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }]\n});\n\nexport { ErrorStateMatcher, ShowOnDirtyErrorStateMatcher };\n","class _ErrorStateTracker {\n  _defaultMatcher;\n  ngControl;\n  _parentFormGroup;\n  _parentForm;\n  _stateChanges;\n  errorState = false;\n  matcher;\n  constructor(_defaultMatcher, ngControl, _parentFormGroup, _parentForm, _stateChanges) {\n    this._defaultMatcher = _defaultMatcher;\n    this.ngControl = ngControl;\n    this._parentFormGroup = _parentFormGroup;\n    this._parentForm = _parentForm;\n    this._stateChanges = _stateChanges;\n  }\n  updateErrorState() {\n    const oldState = this.errorState;\n    const parent = this._parentFormGroup || this._parentForm;\n    const matcher = this.matcher || this._defaultMatcher;\n    const control = this.ngControl ? this.ngControl.control : null;\n    const newState = matcher?.isErrorState(control, parent) ?? false;\n    if (newState !== oldState) {\n      this.errorState = newState;\n      this._stateChanges.next();\n    }\n  }\n}\n\nexport { _ErrorStateTracker };\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { classLog } from '../logging';\r\nimport { QueryStreams } from '../models/query-stream.model';\r\nimport { Context } from './context';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  getAvailableEntities: false,\r\n  getEntities: false,\r\n};\r\n\r\n@Injectable()\r\nexport class QueryService {\r\n\r\n  log = classLog({QueryService}, logSpecs);\r\n\r\n  constructor(private http: HttpClient, private context: Context) { }\r\n\r\n  getFromQuery(queryUrl: string, params: string, fields: string, entitiesFilter?: string[]): Observable<QueryStreams> {\r\n    this.log.fnIf('getAvailableEntities', { queryUrl, params, fields, entitiesFilter });\r\n    // Check if any params we should auto-add are already set (like in a query which has these params set in the configuration)\r\n    const hasParams = !!params;\r\n    const paramsLower = params?.toLocaleLowerCase() ?? '';\r\n    const hasAppId = paramsLower.includes('appid=') ?? false;\r\n    const allParams = ''\r\n      + (hasAppId ? '' : `&appId=${this.context.appId}`)\r\n      + (hasParams ? `&${params}` : '')\r\n      + '&$select=' + (fields ?? '' /* special catch to avoid the word \"null\" */);\r\n    // trim initial & because it will always start with an & and it should't\r\n    const urlParams = allParams.substring(1);\r\n    return this.http.post<QueryStreams>(`app/auto/query/${queryUrl}?${urlParams}`,\r\n      {\r\n        Guids: entitiesFilter,\r\n      },\r\n    );\r\n  }\r\n\r\n  getEntities({ contentTypes, itemIds, fields, log }: { contentTypes: string[]; itemIds: string[]; fields: string; log: string }): Observable<QueryStreams> {\r\n    this.log.fnIf(`getEntities`, { log, contentTypes, itemIds, fields });\r\n    const allParams =\r\n      '&typeNames=' + (contentTypes?.join(',') ?? '')\r\n      + `&appId=${this.context.appId}`\r\n      + '&$select=' + (fields ?? '' /* special catch to avoid the word \"null\" */);\r\n    // trim initial & because it will always start with an & and it should't\r\n    const urlParams = allParams.substring(1);\r\n    return this.http.post<QueryStreams>(\r\n      `app/auto/query/System.EntityPicker/Default?${urlParams}`,\r\n      { Guids: itemIds} // 2dg Guids must be in the body as an array (API filter & too many IDs for URL parameters).\r\n    );\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { classLog } from '../../shared/logging';\r\nimport { UrlHelpers } from '../shared/helpers';\r\nimport { EditUrlParams } from './edit-url-params.model';\r\n\r\n/**\r\n * The purpose of this component is to refresh the edit dialog completely.\r\n * It works as follows:\r\n * 1. A close event of the child which requests a full refresh (probably just the history?)\r\n *    will cause the router to replace the Path to a url going to this control. This flushes the previous edit.\r\n * 2. This component will then navigate to the original edit dialog, restoring the original parameters. \r\n * \r\n * TODO: not sure if this is the best way to do this...\r\n */\r\n@Component({\r\n  selector: 'app-edit-reload',\r\n  template: '',\r\n})\r\nexport class EditReloadComponent {\r\n\r\n  log = classLog({EditReloadComponent});\r\n\r\n  constructor(router: Router, route: ActivatedRoute) {\r\n    const l = this.log.fn('constructor', null, 'üîÑÔ∏è');\r\n    const p = route.snapshot.params as EditUrlParams;\r\n    const url = UrlHelpers.newUrlIfCurrentContainsOldUrl(route, `edit/refresh/${p.items}`, `edit/${p.items}`);\r\n    if (!url) return l.rNull('No URL to navigate to');\r\n    router.navigate([url]);\r\n    l.r('‚úÖ refresh complete');\r\n  }\r\n}\r\n"],"x_google_ignoreList":[1,2,3]}