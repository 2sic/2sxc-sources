"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_app-administration_recycle-bin_recycle-bin_ts"],{5051(J,R,t){t.d(R,{AppRecycleBin:()=>k});var h=t(79748),O=t(50698),p=t(37580),s=t(56884),g=t(36664),E=t(34456),f=t(84175),_=t(53777),l=t(61977),C=t(90353),P=t(24950),T=t(93840),I=t(59791),y=t(25175),v=t(80640),A=t(69393),B=t(49645),D=t.n(B),W=t(12938),U=t(30709),x=t(58534),L=t(45444),c=t(11828),S=t(60251),K=t(67037),N=t(68873),b=t(14513),e=t(36124),u=t(80423),j=t(96462),F=t(58857);const G=()=>({}),H=(d,m)=>m.staticName;function $(d,m){if(1&d&&(e.j41(0,"mat-option",10),e.EFF(1),e.k0s()),2&d){const a=m.$implicit;e.Y8G("value",a.name),e.R7$(),e.JRh(a.title)}}function Y(d,m){if(1&d&&(e.j41(0,"div",17)(1,"h4"),e.EFF(2,"Deleted Item Details"),e.k0s(),e.nrm(3,"app-history-item",18),e.k0s()),2&d){const a=e.XpG();e.R7$(3),e.Y8G("historyItem",a.selectedHistoryItem)("isExpanded",!0)("expandedAttributes",e.lJ4(3,G))}}let k=(()=>{class d{constructor(){this.gridOptions=this.buildGridOptions(),this.selectedDeletedEntity=null,this.selectedHistoryItem=null,this.dataSourceData=(0,g.EW)(()=>this.deletedEntities()),this.#a=(0,W.d)(b.t),this.#n=(0,s.WQX)(N.o),this.#d=(0,s.WQX)(O.Qq),this.#e=(0,s.vPA)(0),this.#i=D()().endOf("day"),this.#r=D()().subtract(6,"day").startOf("day"),this.dateRangeStart=(0,p.geq)(this.#r),this.dateRangeEnd=(0,p.geq)(this.#i),this.selectedContentType=(0,p.geq)(""),this.#t=this.#a.getMany({source:"f890bec1-dee8-4ed6-9f2e-8ad412d2f4dc",refresh:this.#e,streams:"Default,Feature,ContentTypes",params:(0,g.EW)(()=>{const a=this.dateRangeStart(),r=this.dateRangeEnd();return{...a?{DateFrom:a.startOf("day").toISOString()}:{},...r?{DateTo:r.endOf("day").toISOString()}:{},...this.selectedContentType()?{ContentType:this.selectedContentType()}:{}}})}),this.deletedEntities=(0,g.EW)(()=>this.#t.value()?.default??[]),this.contentTypes=(0,g.EW)(()=>this.#t.value()?.contentTypes??[]),this.displayedColumns=["Title","ContentTypeName","DeletedBy","DeletedUtc","actions"]}buildGridOptions(){return{...S.C,columnDefs:[{...c.r.TextWideMin100,headerName:"Title",field:"title",flex:2},{...c.r.TextWideMin100,headerName:"Content Type",field:"contentTypeStaticName"},{...c.r.TextWideMin100,headerName:"Deleted By",field:"deletedBy"},{...c.r.TextWideMin100,headerName:"Item ID",field:"id"},{...c.r.ActionsPinnedRight3,headerName:"Actions",cellRenderer:a=>"<button class='ag-btn ag-btn-primary' data-action='restore'>Restore</button>"}],onCellClicked:a=>{"Actions"===a.colDef.headerName&&"restore"===a.event.target?.dataset?.action?this.restore(a.data):"Actions"!==a.colDef.headerName&&this.onRowSelected(a.data)}}}onRowSelected(a){if(this.selectedDeletedEntity=a,a&&a.json)try{this.selectedHistoryItem=JSON.parse(a.json)}catch{this.selectedHistoryItem=null}else this.selectedHistoryItem=null}#a;#n;#d;#e;#i;#r;#t;restore(a){if(!confirm(`Are you sure you want to restore "${a.title||"(no title)"}"?`))return;const r=`admin/data/recycle?appid=${this.#n.appId}&transactionid=${a.deletedTransactionId}`;this.#d.post(r,{},{responseType:"text"}).subscribe({next:()=>{alert("Data restored successfully"),this.#e.update(n=>n+1)},error:n=>{console.error("Error restoring data:",n),alert(`Error restoring data: ${n.message||"Unknown error"}`)}})}static{this.\u0275fac=function(r){return new(r||d)}}static{this.\u0275cmp=e.VBU({type:d,selectors:[["recycle-bin"]],inputs:{dateRangeStart:[1,"dateRangeStart"],dateRangeEnd:[1,"dateRangeEnd"],selectedContentType:[1,"selectedContentType"]},outputs:{dateRangeStart:"dateRangeStartChange",dateRangeEnd:"dateRangeEndChange",selectedContentType:"selectedContentTypeChange"},decls:37,vars:10,consts:[["dateRangePicker",""],[1,"mat-headline"],[1,"mat-body-1"],[1,"mat-caption"],[1,"mat-subtitle-1"],[3,"featureNameId"],[1,"recycle-bin-filters"],["appearance","outline","color","accent",1,"recycle-bin-filter"],[3,"valueChange","value"],["value",""],[3,"value"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModelChange","ngModel"],["matEndDate","","placeholder","End date",3,"ngModelChange","ngModel"],["matSuffix","",3,"for"],["domLayout","autoHeight",1,"ag-theme-material",2,"width","100%","min-height","300px",3,"rowData","gridOptions"],["class","recycle-bin-details","style","margin-top: 2rem;",4,"ngIf"],[1,"recycle-bin-details",2,"margin-top","2rem"],[3,"historyItem","isExpanded","expandedAttributes"]],template:function(r,n){if(1&r){const o=e.RV6();e.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title")(3,"span",1),e.EFF(4,"Recycle Bin (Beta)"),e.k0s()()(),e.j41(5,"mat-card-content")(6,"p",2),e.EFF(7,"Here you can see and restore deleted items within this app."),e.k0s(),e.j41(8,"p",3)(9,"strong"),e.EFF(10,"Note:"),e.k0s(),e.EFF(11," This feature is currently in beta and may not be fully stable. Use with caution."),e.k0s(),e.j41(12,"h3",4),e.EFF(13),e.nrm(14,"app-feature-icon",5),e.k0s(),e.j41(15,"div",6)(16,"mat-form-field",7)(17,"mat-label"),e.EFF(18,"Filter by Content Type"),e.k0s(),e.j41(19,"mat-select",8),e.mxI("valueChange",function(i){return s.eBV(o),e.DH7(n.selectedContentType,i)||(n.selectedContentType=i),s.Njj(i)}),e.j41(20,"mat-option",9),e.EFF(21,"All Types"),e.k0s(),e.Z7z(22,$,2,2,"mat-option",10,H),e.k0s()(),e.j41(24,"mat-form-field",7)(25,"mat-label"),e.EFF(26,"Date range"),e.k0s(),e.j41(27,"mat-date-range-input",11)(28,"input",12),e.mxI("ngModelChange",function(i){return s.eBV(o),e.DH7(n.dateRangeStart,i)||(n.dateRangeStart=i),s.Njj(i)}),e.k0s(),e.j41(29,"input",13),e.mxI("ngModelChange",function(i){return s.eBV(o),e.DH7(n.dateRangeEnd,i)||(n.dateRangeEnd=i),s.Njj(i)}),e.k0s()(),e.nrm(30,"mat-datepicker-toggle",14)(31,"mat-date-range-picker",null,0),e.k0s()(),e.j41(33,"div"),e.nrm(34,"ag-grid-angular",15),e.k0s(),e.DNE(35,Y,4,4,"div",16),e.k0s()(),e.nrm(36,"router-outlet")}if(2&r){const o=e.sdS(32);e.R7$(13),e.SpI(" Deleted Items (",n.deletedEntities().length," total) "),e.R7$(),e.Y8G("featureNameId","EntityUndelete"),e.R7$(5),e.R50("value",n.selectedContentType),e.R7$(3),e.Dyx(n.contentTypes()),e.R7$(5),e.Y8G("rangePicker",o),e.R7$(),e.R50("ngModel",n.dateRangeStart),e.R7$(),e.R50("ngModel",n.dateRangeEnd),e.R7$(),e.Y8G("for",o),e.R7$(4),e.Y8G("rowData",n.dataSourceData())("gridOptions",n.gridOptions),e.R7$(),e.Y8G("ngIf",n.selectedHistoryItem)}},dependencies:[h.MD,h.bT,A.n3,E.YN,E.me,E.BC,E.vS,f.Hl,_.Hu,_.RN,_.m2,_.MM,_.dh,l.X6,l.bU,l.el,l.xR,l.IG,l.SG,P.RG,u.rl,u.nJ,u.yw,T.m_,I.fS,y.Ve,y.VO,j.wT,C.MY,v.uc,U.uf,x.Z,K.p,F.xs,L.J],styles:[".recycle-bin-filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;flex-wrap:wrap;margin-bottom:8px}.recycle-bin-filter[_ngcontent-%COMP%]{min-width:240px;max-width:320px}.recycle-bin-list[_ngcontent-%COMP%]{display:block;padding:4px 0}.recycle-bin-details[_ngcontent-%COMP%]{display:block;padding:16px 0;font-size:14px}.recycle-bin-detail-row[_ngcontent-%COMP%]{display:flex;padding-bottom:8px;gap:16px}.recycle-bin-detail-row[_ngcontent-%COMP%]:last-child{padding-bottom:0}.recycle-bin-detail-label[_ngcontent-%COMP%]{flex:0 0 auto;width:120px;font-weight:500}.recycle-bin-detail-value[_ngcontent-%COMP%]{flex:1 1 auto;word-break:break-word}.recycle-bin-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"]})}}return d})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.02.00/dist/ng-edit/projects_eav-ui_src_app_app-administration_recycle-bin_recycle-bin_ts.8b35258521b39470.js.map