"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_app-administration_app-extensions_delete_delete-extension_ts"],{31598(O,D,e){e.r(D),e.d(D,{DeleteExtensionComponent:()=>L});var h=e(56884),f=e(36664),g=e(34456),I=e(84175),m=e(87941),c=e(90353),r=e(93840),P=e(8827),a=e(3347),n=e(12938),o=e(32760),p=e(34601),E=e(63628),x=e(97480),v=e(37650),t=e(36124),R=e(69393),T=e(55326);function U(d,B){if(1&d){const s=t.RV6();t.j41(0,"p"),t.EFF(1),t.k0s(),t.j41(2,"p")(3,"mat-slide-toggle",10),t.mxI("ngModelChange",function(i){h.eBV(s);const l=t.XpG();return t.DH7(l.withData,i)||(l.withData=i),h.Njj(i)}),t.EFF(4," With Data "),t.k0s()()}if(2&d){const s=t.XpG();t.R7$(),t.SpI(" Caution: This app has ",s.totalLocalEntities()," local entities which were created using content-types of this extension. You may want to also delete these entities. "),t.R7$(2),t.R50("ngModel",s.withData)}}function F(d,B){if(1&d){const s=t.RV6();t.j41(0,"mat-slide-toggle",10),t.mxI("ngModelChange",function(i){h.eBV(s);const l=t.XpG();return t.DH7(l.forceDelete,i)||(l.forceDelete=i),h.Njj(i)}),t.EFF(1," Force Delete "),t.k0s()}if(2&d){const s=t.XpG();t.R50("ngModel",s.forceDelete)}}let L=(()=>{class d{#t;#e;constructor(s,_,i){this.route=s,this.dialogData=_,this.dialog=i,this.#t=(0,h.WQX)(a.UG),this.#e=(0,n.d)(x.h),this.extensionFolder=this.route.snapshot.paramMap.get("extension"),this.edition=this.route.snapshot.queryParamMap.get("edition")||"",this.withData=!1,this.forceDelete=!1,this.preflightResult=this.#e.preflightExtension(this.extensionFolder,this.edition).value,this.totalLocalEntities=(0,f.EW)(()=>{const l=this.preflightResult();return l?.data?.contentTypes?l.data.contentTypes.map(u=>u.localEntities).reduce((u,M)=>u+M,0):0}),this.mustForceDelete=(0,f.EW)(()=>{const l=this.preflightResult();if(!l)return!1;const u=l.summary,M=u.changed+u.added+u.missing;return!l.files.some(C=>C.path.endsWith("App_Data/extension.json")&&"missing"!==C.status)||(l.foundLock?M>0?(this.askForce(`The extension has file changes (${M}).`),!0):this.totalLocalEntities()>0&&(this.askForce(`The extension has ${this.totalLocalEntities()} local entities.`),!0):(this.showError("Missing extension.lock.json. Deletion not allowed."),!0))})}ngOnInit(){this.#n()}#n(){this.dialog.keydownEvents().subscribe(s=>{(0,o.YU)(s)&&(s.preventDefault(),this.deleteAndClose())})}closeDialog(s){this.#t.dismiss(),s?this.dialog.close(s):this.dialog.close()}deleteAndClose(){!this.mustForceDelete()||this.forceDelete?this.executeDelete(this.forceDelete):this.showError('Deletion requires force. Please enable "Force Delete" and try again.')}askForce(s){this.#t.open(`${s}`,"",{duration:1e4})}executeDelete(s){this.#e.deleteExtension(this.extensionFolder,this.edition,s,this.withData).subscribe({next:()=>{this.#t.open("Extension deleted successfully","OK",{duration:3e3}),this.dialog.close(!0)},error:_=>{this.showError(_?.error?.exceptionMessage??"Delete failed.")}})}showError(s){this.#t.open(s,"OK",{duration:8e3})}static{this.\u0275fac=function(_){return new(_||d)(t.rXU(R.nX),t.rXU(m.Vh),t.rXU(m.CP))}}static{this.\u0275cmp=t.VBU({type:d,selectors:[["ng-component"]],decls:18,vars:6,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"expanded"],[3,"data"],[3,"ngModel"],["align","end"],["icon","delete",3,"action","label"],[3,"ngModelChange","ngModel"]],template:function(_,i){1&_&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return i.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"mat-accordion")(9,"mat-expansion-panel",5)(10,"mat-expansion-panel-header")(11,"mat-panel-title"),t.EFF(12,"Extension Details"),t.k0s()(),t.nrm(13,"app-inspect-extension",6),t.k0s()(),t.nVh(14,U,5,2),t.nVh(15,F,2,1,"mat-slide-toggle",7),t.k0s(),t.j41(16,"mat-dialog-actions",8)(17,"app-save-close-button-fab",9),t.bIt("action",function(){return i.deleteAndClose()}),t.k0s()()()),2&_&&(t.R7$(3),t.SpI("Delete ",i.extensionFolder),t.R7$(6),t.Y8G("expanded",!0),t.R7$(4),t.Y8G("data",i.preflightResult()),t.R7$(),t.vxM(i.totalLocalEntities()>0?14:-1),t.R7$(),t.vxM(i.mustForceDelete()?15:-1),t.R7$(2),t.Y8G("label","Delete and close (ctrl + enter)"))},dependencies:[I.Hl,T.iY,r.m_,r.An,m.E7,E.i,P.mV,P.sG,g.YN,g.BC,g.vS,c.MY,c.BS,c.GK,c.Z2,c.WN,v.H,p.e],styles:["mat-dialog-actions[_ngcontent-%COMP%]{gap:16px}"]})}}return d})()},97480(O,D,e){e.d(D,{h:()=>c});var h=e(70271),f=e(34435),g=e(96474),I=e(56884),m=e(36124);let c=(()=>{class r extends g.D{constructor(){super(...arguments),this.log=(0,f.Tq)({AppExtensionsService:r})}getAllLive(a){return this.newHttpResource(()=>(a(),{url:this.apiUrl("admin/appExtensions/extensions"),params:{appId:this.appId},method:"GET"}))}getAll(){return this.http.get(this.apiUrl("admin/appExtensions/extensions"),{params:{appId:this.appId}})}updateConfiguration(a,n){const o=JSON.parse(n);return this.http.post(this.apiUrl("admin/appExtensions/configuration"),o,{params:{zoneId:this.zoneId,appId:this.appId,name:a}})}downloadExtension(a){const n=new URLSearchParams({appId:this.appId,zoneId:this.zoneId,name:a}),o=`${this.apiUrl("admin/appExtensions/download")}?${n.toString()}`;window.open(o,"_blank","")}installRemoteExtension(a,n,o){const p=[a],E={appId:this.appId,zoneId:this.zoneId,...n?{editions:n}:{},...o?{overwrite:o}:{}};return this.http.post(this.apiUrl("admin/appExtensions/InstallFrom"),p,{params:E})}installPreflightExtensionFromUrl(a,n){const o=[a],p={appId:this.appId,...n?{editions:n}:{}};return this.http.post(this.apiUrl("admin/appExtensions/InstallPreflightFrom"),o,{params:p})}uploadExtensions(a,n,o){const p=new FormData;p.append("files",a);const E={appId:this.appId,zoneId:this.zoneId,...n?{editions:n}:{},...o?{overwrite:o}:{}};return this.http.post(this.apiUrl("admin/appExtensions/install"),p,{params:E}).pipe((0,h.T)(x=>({Success:x,Messages:x?[{MessageType:1,Text:"Extension uploaded successfully"}]:[{MessageType:2,Text:"Extension upload failed"}]})))}installPreflightExtension(a){const n=new FormData;return a.forEach(o=>n.append("files",o)),this.http.post(this.apiUrl("admin/appExtensions/installPreflight"),n,{params:{appId:this.appId,zoneId:this.zoneId}})}preflightExtension(a,n){const o={appId:this.appId,name:a};return n&&(o.edition=n),this.newHttpResource(()=>({url:this.apiUrl("admin/appExtensions/inspect"),params:o,method:"GET"}))}deleteExtension(a,n,o=!1,p=!1){const E={appId:this.appId,name:a,force:o,withData:p,...n?{edition:n}:{}};return this.http.delete(this.apiUrl("admin/appExtensions/delete"),{params:E})}static{this.\u0275fac=(()=>{let a;return function(o){return(a||(a=m.xGo(r)))(o||r)}})()}static{this.\u0275prov=I.jDH({token:r,factory:r.\u0275fac})}}return r})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.02.00/dist/ng-edit/projects_eav-ui_src_app_app-administration_app-extensions_delete_delete-extension_ts.d5c1d273ffd76f69.js.map