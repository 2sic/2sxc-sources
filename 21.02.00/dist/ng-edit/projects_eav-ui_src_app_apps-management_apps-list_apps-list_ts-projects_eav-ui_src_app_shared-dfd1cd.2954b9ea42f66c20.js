"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_apps-management_apps-list_apps-list_ts-projects_eav-ui_src_app_shared-dfd1cd"],{3140(y,E,e){e.d(E,{J:()=>v});var u=e(27092),m=e(36124);let v=(()=>{class p{constructor(){this.subscriptions=new u.yU}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(C){return new(C||p)}}static{this.\u0275dir=m.FsC({type:p})}}return p})()},4979(y,E,e){e.d(E,{V:()=>v});var u=e(27092),m=e(56884);let v=(()=>{class p{constructor(){this.subscriptions=new u.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(C){return new(C||p)}}static{this.\u0275prov=m.jDH({token:p,factory:p.\u0275fac})}}return p})()},18537(y,E,e){e.d(E,{R:()=>l});var u=e(82645),m=e(43942),v=e(1365),p=e(88830),d=e(81530),D=e(38067);const C=["addListener","removeListener"],P=["addEventListener","removeEventListener"],I=["on","off"];function l(s,o,h,_){if((0,d.T)(h)&&(_=h,h=void 0),_)return l(s,o,h).pipe((0,D.I)(_));const[M,U]=function a(s){return(0,d.T)(s.addEventListener)&&(0,d.T)(s.removeEventListener)}(s)?P.map(b=>O=>s[b](o,O,h)):function c(s){return(0,d.T)(s.addListener)&&(0,d.T)(s.removeListener)}(s)?C.map(g(s,o)):function A(s){return(0,d.T)(s.on)&&(0,d.T)(s.off)}(s)?I.map(g(s,o)):[];if(!M&&(0,p.X)(s))return(0,v.Z)(b=>l(b,o,h))((0,u.Tg)(s));if(!M)throw new TypeError("Invalid event target");return new m.c(b=>{const O=(...L)=>b.next(1<L.length?L:L[0]);return M(O),()=>U(O)})}function g(s,o){return h=>_=>s[h](o,_)}},28136(y,E,e){e.d(E,{T:()=>u});const u={AppSyncWithSiteFiles:"AppSyncWithSiteFiles",WysiwygPasteFormatted:"WysiwygPasteFormatted",PasteImageFromClipboard:"PasteImageFromClipboard",EditUiShowNotes:"EditUiShowNotes",EditUiShowMetadataFor:"EditUiShowMetadataFor",NoSponsoredByToSic:"NoSponsoredByToSic",EditUiTranslateWithGoogle:"EditUiTranslateWithGoogle",LightSpeed:"LightSpeedOutputCache",ContentSecurityPolicy:"ContentSecurityPolicy",PermissionsByLanguage:"PermissionsByLanguage",ContentTypeFieldsReuseDefinitions:"ContentTypeFieldsReuseDefinitions",AppExportAssetsAdvanced:"AppExportAssetsAdvanced",DataExportImportBundles:"DataExportImportBundles",PickerUiCheckbox:"PickerUiCheckbox",PickerUiRadio:"PickerUiRadio",PickerSourceCsv:"PickerSourceCsv",PickerSourceAppAssets:"PickerSourceAppAssets",PickerFormulas:"PickerFormulas",PickerUiMoreInfo:"PickerUiMoreInfo"}},34575(y,E,e){e.d(E,{S:()=>C});var u=e(37580),m=e(56884),v=e(18537),p=e(3140),d=e(36124),D=e(3347);let C=(()=>{class P extends p.J{constructor(l,g,c){super(),this.zone=g,this.snackBar=c,this.markStyle=(0,u.hFB)("outline"),this.allowedFileTypes=(0,u.hFB)(""),this.filesDropped=(0,u.CGW)(),this.dropAreaClass="eav-droparea",this.markStyleClass=(0,m.vPA)(""),this.dragClass="eav-dragover",this.timeouts=[],this.element=l.nativeElement}ngOnInit(){this.markStyleClass.set(`eav-droparea-${this.markStyle()}`),this.element.classList.add(this.dropAreaClass,this.markStyleClass()),this.zone.runOutsideAngular(()=>{this.subscriptions.add((0,v.R)(this.element,"dragover").subscribe(l=>{l.preventDefault(),l.stopPropagation(),this.clearTimeouts(),this.element.classList.add(this.dragClass)})),this.subscriptions.add((0,v.R)(this.element,"dragleave").subscribe(l=>{l.preventDefault(),l.stopPropagation(),this.timeouts.push(window.setTimeout(()=>{this.element.classList.remove(this.dragClass)},50))}))})}ngOnDestroy(){this.clearTimeouts(),this.element.classList.remove(this.dropAreaClass,this.markStyleClass(),this.dragClass),super.ngOnDestroy()}onDrop(l){l.preventDefault(),l.stopPropagation(),this.clearTimeouts(),this.element.classList.remove(this.dragClass);let c=Array.from(l.dataTransfer.files);c=this.filterTypes(c,this.allowedFileTypes()),c.length>0&&this.filesDropped.emit(c)}clearTimeouts(){for(const l of this.timeouts)clearTimeout(l);this.timeouts=[]}filterTypes(l,g){if(""===g)return l;const c=g.split(",").map(a=>a.toLocaleLowerCase()),A=l.filter(a=>{const s=a.name.lastIndexOf(".");if(s<=0)return!1;const o=a.name.substring(s+1).toLocaleLowerCase();return c.includes(o)});if(l.length!==A.length){const a=this.allowedFileTypes().replace(/\,/g,", ");this.snackBar.open(A.length?"Some files were filtered out. This drop location only accepts file types: "+a:"This drop location only accepts file types: "+a,null,{duration:5e3})}return A}static{this.\u0275fac=function(g){return new(g||P)(d.rXU(d.aKT),d.rXU(m.SKi),d.rXU(D.UG))}}static{this.\u0275dir=d.FsC({type:P,selectors:[["","appDragAndDrop",""]],hostBindings:function(g,c){1&g&&d.bIt("drop",function(a){return c.onDrop(a)})},inputs:{markStyle:[1,"markStyle"],allowedFileTypes:[1,"allowedFileTypes"]},outputs:{filesDropped:"filesDropped"},features:[d.Vt3]})}}return P})()},60852(y,E,e){e.d(E,{c:()=>g});var u=e(69393),m=e(51567),v=e(70271),p=e(5057),d=e(63037),D=e(98764),C=e(34435),P=e(4979),I=e(56884);const l={doOnDialogClosed:!1,doOnDialogClosedWithData:!0};let g=(()=>{class c extends P.V{constructor(a,s){super(),this.router=a,this.route=s,this.log=(0,C.Tq)({DialogRoutingService:c},l)}get snapshot(){return this.route.snapshot}get url(){return this.router.url}get urlSegments(){return this.router.url.split("/")}getParam(a){return this.route.snapshot.paramMap.get(a)}getParams(a){const s=this.route.snapshot.paramMap;return a.reduce((o,h)=>(o[h]=s.get(h),o),{})}getQueryParam(a){return this.route.snapshot.queryParamMap.get(a)}getQueryParams(a){const s=this.route.snapshot.queryParamMap;return a.reduce((o,h)=>(o[h]=s.get(h),o),{})}state(){return this.router.currentNavigation().extras?.state}doOnDialogClosed(a){const s=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.childDialogClosed$().subscribe(o=>(s.a("Dialog closed",{data:o}),a()))),s.end()}doOnDialogClosedWithData(a){const s=this.log.fnIf("doOnDialogClosedWithData");this.subscriptions.add(this.#e().subscribe(({state:o})=>{s.a("Dialog closed",{state:o}),a(o)})),s.end()}urlSubRoute(a){const s=this.router.createUrlTree([a],{relativeTo:this.route});return this.router.serializeUrl(s)}navPath(a,s){return this.router.navigate([a],s)}navRelative(a,s){return this.router.navigate(a,{...s,relativeTo:this.route})}childDialogClosed$(){return this.router.events.pipe((0,m.p)(a=>a instanceof u.wF),(0,d.Z)(!!this.route.snapshot.firstChild),(0,v.T)(()=>!!this.route.snapshot.firstChild),(0,p.J)(),(0,m.p)(([a,s])=>a&&!s))}#e(){return this.router.events.pipe((0,m.p)(a=>a instanceof u.wF),(0,D.M)(a=>{const s=this.log.fn("childDialogClosed$",{event:a,firstChild:this.route.snapshot.firstChild,snapShot:this.route.snapshot,state:this.router.currentNavigation()?.extras.state});s.a("NavigationEnd",{event:a}),s.end()}),(0,d.Z)(!!this.route.snapshot.firstChild),(0,v.T)(()=>({hasChildNow:!!this.route.snapshot.firstChild,state:this.router.currentNavigation()?.extras.state})),(0,p.J)(),(0,m.p)(([a,s])=>a.hasChildNow&&!s.hasChildNow),(0,v.T)(([a,s])=>({hadChildBefore:a.hasChildNow,hasChildNow:s.hasChildNow,state:s.state})))}static{this.\u0275fac=function(s){return new(s||c)(I.KVO(u.Ix),I.KVO(u.nX))}}static{this.\u0275prov=I.jDH({token:c,factory:c.\u0275fac})}}return c})()},69914(y,E,e){e.d(E,{$:()=>v});var u=e(36124),m=e(80436);let v=(()=>{class p{constructor(D){this.sanitizer=D}transform(D){return this.sanitizer.bypassSecurityTrustHtml(D)}static{this.\u0275fac=function(C){return new(C||p)(u.rXU(m.up,16))}}static{this.\u0275pipe=u.EJ8({name:"safeHtml",type:p,pure:!0})}}return p})()},80938(y,E,e){e.d(E,{AppsListComponent:()=>tt});var u=e(89204),m=e(1937),v=e(60184),p=e(79748),d=e(56884),D=e(16256),C=e(84175),P=e(87941),I=e(93840),l=e(69393),g=e(23183),c=e(12938),A=e(58713),a=e(28136),s=e(9001),o=e(58767),h=e(22646),_=e(11828),M=e(17401),U=e(60251),b=e(34575),O=e(59339),L=e(92324),B=e(34435),W=e(67037),j=e(60852),k=e(68873),K=e(83583);const x={states:{true:{tooltip:"Show this app to users",icon:"visibility"},false:{tooltip:"Hide this app from users",icon:"visibility_off"}}},$={states:{true:{clickable:!0,tooltip:"This App uses obsolete code which will cause problems on future upgrades. Click to see details.",icon:"bug_report",getUrl:f=>window.$2sxc.http.apiUrl("sys/insights/logs?key=warnings-obsolete&filter=AppId="+f.Id)},false:{tooltip:"Hide this app from users",icon:""}}};var N=e(85309),F=e(31034),G=e(5816),z=e(34601),t=e(36124),w=e(17828);function H(f,S){1&f&&(t.j41(0,"mat-icon"),t.EFF(1,"foundation"),t.k0s())}function X(f,S){1&f&&(t.j41(0,"mat-icon"),t.EFF(1,"holiday_village"),t.k0s())}function V(f,S){if(1&f){const n=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){d.eBV(n);const i=t.XpG();return d.Njj(i.do("flushCache"))}),t.j41(1,"mat-icon"),t.EFF(2,"cached"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Flush cache"),t.k0s()(),t.j41(5,"button",8),t.bIt("click",function(){d.eBV(n);const i=t.XpG();return d.Njj(i.do("deleteApp"))}),t.j41(6,"mat-icon"),t.EFF(7,"delete"),t.k0s(),t.j41(8,"span"),t.EFF(9,"Delete"),t.k0s()()}if(2&f){const n=t.XpG();t.R7$(5),t.Y8G("disabled",!n.app.IsApp)}}let Y=(()=>{class f{agInit(n){this.params=n,this.app=n.data}refresh(n){return!0}do(n){this.params.do(n,this.app)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275cmp=t.VBU({type:f,selectors:[["app-apps-list-actions"]],decls:11,vars:8,consts:[["menu","matMenu"],[1,"actions-component"],[1,"eav-grid-action-button","icon",3,"tippy","tippyDisabled"],[3,"lightSpeedOwner","params","lightSpeed"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["matMenuContent",""],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"]],template:function(r,i){if(1&r&&(t.j41(0,"div",1)(1,"div",2),t.nVh(2,H,2,0,"mat-icon"),t.nVh(3,X,2,0,"mat-icon"),t.k0s(),t.nrm(4,"app-lightspeed-action",3),t.j41(5,"div",4)(6,"mat-icon"),t.EFF(7,"more_horiz"),t.k0s()()(),t.j41(8,"mat-menu",5,0),t.DNE(10,V,10,1,"ng-template",6),t.k0s()),2&r){const T=t.sdS(9);t.R7$(),t.Y8G("tippy",i.app.IsGlobal?"This app is global":i.app.IsInherited?"This app is inherited":"")("tippyDisabled",!i.app.IsGlobal&&!i.app.IsInherited),t.R7$(),t.vxM(i.app.IsGlobal?2:-1),t.R7$(),t.vxM(i.app.IsInherited?3:-1),t.R7$(),t.Y8G("lightSpeedOwner",i.app)("params",i.params)("lightSpeed",i.app.lightSpeed),t.R7$(),t.Y8G("matMenuTriggerFor",T)}},dependencies:[z.e,I.m_,I.An,D.Y,N.p,w.r6,F.Cn,F.kk,F.fb,F.z8,F.Cp,G.V],encapsulation:2})}}return f})();var J=e(37580),Q=e(3347),Z=e(58857);const q=f=>({"fab-opened":f});let tt=(()=>{class f{#e;#t;constructor(n,r,i,T,R){this.snackBar=n,this.context=r,this.matDialog=i,this.viewContainerRef=T,this.changeDetectorRef=R,this.log=(0,B.Tq)({AppsListComponent:f}),this.gridOptions=this.#r(),this.features=(0,d.WQX)(s.D),this.isAddFromFolderEnabled=this.features.isEnabled[a.T.AppSyncWithSiteFiles],this.#e=(0,c.d)(K.U),this.#t=(0,c.d)(j.c),this.fabOpen=(0,d.vPA)(!1),this.#s=(0,d.vPA)(0),this.apps=this.#e.getAllLive(this.#s).value,v.syG.registerModules([m.Q])}#s;ngOnInit(){this.#t.doOnDialogClosed(()=>this.#a())}openChange(n){this.fabOpen.set(n)}browseCatalog(){window.open("https://2sxc.org/apps","_blank")}createApp(){this.#t.navRelative(["create"])}createInheritedApp(){this.#t.navRelative(["create-inherited"])}addFromFolder(){this.#t.navRelative(["add-app-from-folder"])}importApp(n){this.#t.navRelative(["import"],{state:{files:n}})}#i(n){const r=prompt(`This cannot be undone. To really delete this app, type 'yes!' or type/paste the app-name here. Are you sure want to delete '${n.Name}' (${n.Id})?`);null!==r&&(r===n.Name||"yes!"===r?(this.snackBar.open("Deleting..."),this.#e.delete(n.Id).subscribe({error:()=>{this.snackBar.open("Delete failed. Please check console for more information",void 0,{duration:3e3}),this.#a()},next:()=>{this.snackBar.open("Deleted",void 0,{duration:2e3}),this.#a()}})):alert("Input did not match - will not delete"))}#n(n){var r=this;return(0,u.A)(function*(){if(confirm(`Flush the App Cache for ${n.Name} (${n.Id})?`)){r.snackBar.open("Flushing cache...");try{const i=yield r.#e.flushCache(n.Id);i>=200&&i<300&&r.snackBar.open("Cache flushed",void 0,{duration:2e3})}catch(i){r.snackBar.open("Cache flush failed. Please check console.",void 0,{duration:3e3}),console.error("Export error:",i)}}})()}#o(n){const r=(0,L.s)(A.g.getLightSpeedEditParams(n.Id));return this.#t.urlSubRoute(`${this.context.zoneId}/${n.Id}/edit/${r}`)}openLightSpeedFeatInfo(){(0,o.j)(this.matDialog,a.T.LightSpeed,this.viewContainerRef,this.changeDetectorRef)}#r(){return{...U.C,columnDefs:[{..._.r.IdWithDefaultRenderer,cellRendererParams:_.r.idFieldParamsTooltipGetter()},{..._.r.IconShow,cellRendererParams:{settings:()=>x}},{..._.r.TextWide,field:"Name",cellClass:"apps-list-primary-action highlight".split(" "),sort:"asc",cellRenderer:r=>{const i=r.data;return`\n              <a class="default-link fill-cell" href="#${this.#t.urlSubRoute(i.Id.toString())}">\n                <div class="container">\n                  ${i.Thumbnail?`<img class="image logo" src="${i.Thumbnail}?w=40&h=40&mode=crop"></img>`:'<div class="image logo"><span class="material-symbols-outlined">star</span></div>'}\n                  ${r.value}\n                </div>\n              </a>\n            `}},{..._.r.TextWide,field:"Folder"},{..._.r.Character,field:"Version",width:78},{..._.r.Number,field:"Items"},{..._.r.Boolean,field:"HasCodeWarnings",headerName:"Code",filter:M.y,cellRenderer:h.N,cellRendererParams:{settings:()=>$}},{..._.r.ActionsPinnedRight3,cellRenderer:Y,cellRendererParams:{lightSpeedLink:r=>this.#o(r),openLightspeedFeatureInfo:()=>this.openLightSpeedFeatInfo(),do:(r,i)=>{switch(r){case"deleteApp":this.#i(i);break;case"flushCache":this.#n(i)}}}}]}}#a(){this.#s.update(n=>++n)}static{this.\u0275fac=function(r){return new(r||f)(t.rXU(Q.UG),t.rXU(k.o),t.rXU(P.bZ),t.rXU(t.c1b),t.rXU(J.gRc))}}static{this.\u0275cmp=t.VBU({type:f,selectors:[["app-apps-list"]],decls:25,vars:9,consts:[[1,"grid-wrapper","mat-tab-grid-wrapper"],["appDragAndDrop","",1,"ag-theme-material",3,"filesDropped","rowData","gridOptions","allowedFileTypes"],["align","end"],[1,"eav-eco-fab-speed-dial",3,"openChange","ngClass"],[3,"spin"],["mat-fab","",1,"grid-fab"],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Find more apps",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","","label","Create inherited app",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","","label","Add from folder",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadgeIcon","diamond","matBadgePosition","below after","aria-hidden","false",3,"matBadgeHidden"],["mat-mini-fab","","label","Import app",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","","label","Create app",1,"eav-eco-fab-speed-dial-action-button",3,"click"]],template:function(r,i){1&r&&(t.j41(0,"div",0)(1,"ag-grid-angular",1),t.bIt("filesDropped",function(R){return i.importApp(R)}),t.k0s(),t.j41(2,"mat-dialog-actions",2)(3,"eco-fab-speed-dial",3),t.bIt("openChange",function(R){return i.openChange(R)}),t.j41(4,"eco-fab-speed-dial-trigger",4)(5,"button",5)(6,"mat-icon",6),t.EFF(7),t.k0s()()(),t.j41(8,"eco-fab-speed-dial-actions",7)(9,"button",8),t.bIt("click",function(){return i.browseCatalog()}),t.j41(10,"mat-icon"),t.EFF(11,"search"),t.k0s()(),t.j41(12,"button",9),t.bIt("click",function(){return i.createInheritedApp()}),t.j41(13,"mat-icon"),t.EFF(14,"holiday_village"),t.k0s()(),t.j41(15,"button",10),t.bIt("click",function(){return i.addFromFolder()}),t.j41(16,"mat-icon",11),t.EFF(17," add "),t.k0s()(),t.j41(18,"button",12),t.bIt("click",function(){return i.importApp()}),t.j41(19,"mat-icon"),t.EFF(20,"cloud_upload"),t.k0s()(),t.j41(21,"button",13),t.bIt("click",function(){return i.createApp()}),t.j41(22,"mat-icon"),t.EFF(23,"add"),t.k0s()()()()()(),t.nrm(24,"router-outlet")),2&r&&(t.R7$(),t.Y8G("rowData",i.apps())("gridOptions",i.gridOptions)("allowedFileTypes","zip"),t.R7$(2),t.Y8G("ngClass",t.eq3(7,q,i.fabOpen())),t.R7$(),t.Y8G("spin",!0),t.R7$(3),t.SpI(" ",i.fabOpen()?"close":"add"," "),t.R7$(9),t.Y8G("matBadgeHidden",i.isAddFromFolderEnabled()))},dependencies:[W.p,Z.xs,P.E7,g.TE,p.YU,g.p1,C.Hl,C.$0,C.Sr,I.m_,I.An,g.yf,D.Y,O.A,l.n3,b.S],styles:["[_nghost-%COMP%]     .ag-row-hover .ag-cell a, [_nghost-%COMP%]     .ag-row-hover .ag-cell .id-box *, [_nghost-%COMP%]     .ag-row-hover .ag-cell .eav-grid-action-button{color:#85283b!important}"]})}}return f})()},83583(y,E,e){e.d(E,{U:()=>c});var u=e(89204),m=e(46443),v=e(24467),p=e(56884),d=e(36124);const I="admin/app/app";let c=(()=>{class A extends v.B{getAllLive(s){return(0,m.fx)(()=>(s(),{url:this.apiUrl("admin/app/list"),params:{zoneId:this.zoneId}}))}getInheritable(){return(0,m.fx)(()=>({url:this.apiUrl("admin/app/InheritableApps"),params:{zoneId:this.zoneId}}))}getPendingApps(){return(0,m.fx)(()=>({url:this.apiUrl("admin/app/GetPendingApps"),params:{zoneId:this.zoneId}}))}create(s,o,h){return this.http.post(this.apiUrl(I),{},{params:{zoneId:this.zoneId,name:s,...null!=o&&{inheritAppId:o},...null!=h&&{templateId:h}}})}createTemplate(s,o){const h=encodeURIComponent(o);return this.http.post(`sys/install/RemotePackage?packageUrl=${s}&newName=${h}`,{})}installPendingApps(s){return this.http.post(this.apiUrl("admin/app/InstallPendingApps"),s,{params:{zoneId:this.zoneId}})}delete(s){return this.http.delete(this.apiUrl(I),{params:{zoneId:this.zoneId,appId:s.toString()}})}flushCache(s){var o=this;return(0,u.A)(function*(){return o.getStatusPromise("admin/app/flushcache",{params:{zoneId:o.zoneId,appId:s.toString()}})})()}static{this.\u0275fac=(()=>{let s;return function(h){return(s||(s=d.xGo(A)))(h||A)}})()}static{this.\u0275prov=p.jDH({token:A,factory:A.\u0275fac})}}return A})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.02.00/dist/ng-edit/projects_eav-ui_src_app_apps-management_apps-list_apps-list_ts-projects_eav-ui_src_app_shared-dfd1cd.2954b9ea42f66c20.js.map