(()=>{"use strict";var t={416:(t,e,n)=>{n.d(e,{B:()=>P});const r=!1,i={always:!0,dev:!1,store:!1,editForm:!1},o={};function s(t,e){!function({segment:t,message:e,callStack:n,data:s=null}){if(r)return;const a=`[${t?.toUpperCase()}]`;if(!i[t]){if(o[t])return;return console.log(`${a}-logging disabled, no further messages will show for this segment.`),void(o[t]=!0)}const l="always"===t?"":a;if(0!=n)console.groupCollapsed(`${l} ${e}`,s),console.trace(),console.groupEnd();else{if(!s)return console.log(`${l} ${e}`);const t=Object.keys(s);if(0===t.length)return console.log(`${l} ${e}`);if(1===t.length){const n=t[0],r=s[n];return"string"==typeof r?console.log(`${l} ${e} [string:${r.length}] '${n}'='${r}'`):console.log(`${l} ${e} [${typeof r}}] '${n}'=`,r)}console.log(`${l} ${e} [${t.length} data-items]`,s)}}({segment:"always",message:t,callStack:!1,data:e})}class a{constructor(t,e,n,r){this.parent=t,this.fnName=e,this.parent.a(e+"() "+(n??""),r)}values(t,e){t&&this.parent.enabled&&(e=e?` ${e} `:"",s(`[${this.parent.nameWithSvcId}.${this.fnName}()] ${e} values:`,t))}a(t,e){this.parent.a(`${this.fnName}/${t}`,e)}r(t,e){return this.parent.a(`${this.fnName}/return${e?" "+e:""}`,{result:t}),t}rNull(t){return this.parent.a(`${this.fnName}/return NULL ${t}`),null}end(t,e){this.parent.a(`${this.fnName}/end${e?" "+e:""}`,t)}}function l(t){return"function"==typeof t}var c=function(t,e){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},c(t,e)};function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function d(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function h(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var f,g=((f=function(t){var e;e=this,Error.call(e),e.stack=(new Error).stack,this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}).prototype=Object.create(Error.prototype),f.prototype.constructor=f,f);function m(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var v=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=d(o),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else o.remove(this);var c=this.initialTeardown;if(l(c))try{c()}catch(t){i=t instanceof g?t.errors:[t]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var f=d(p),m=f.next();!m.done;m=f.next()){var v=m.value;try{y(v)}catch(t){i=null!=i?i:[],t instanceof g?i=h(h([],u(i)),u(t.errors)):i.push(t)}}}catch(t){n={error:t}}finally{try{m&&!m.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}}if(i)throw new g(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)y(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&m(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&m(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}();function y(t){l(t)?t():t.unsubscribe()}v.EMPTY;var b=null,x=null,w=!1,_=!1,$={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=$.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,h([t,e],u(n))):setTimeout.apply(void 0,h([t,e],u(n)))},clearTimeout:function(t){var e=$.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function S(){}var k=C("C",void 0,void 0);function C(t,e,n){return{kind:t,value:e,error:n}}var L=function(t){function e(e){var n,r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,((n=e)instanceof v||n&&"closed"in n&&l(n.remove)&&l(n.add)&&l(n.unsubscribe))&&e.add(r)):r.destination=z,r}return p(e,t),e.create=function(t,e,n){return new T(t,e,n)},e.prototype.next=function(t){this.isStopped?O(function(t){return C("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?O(C("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?O(k,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(v),F=Function.prototype.bind;function I(t,e){return F.call(t,e)}var E=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){M(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){M(t)}else M(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){M(t)}},t}(),T=function(t){function e(e,n,r){var i,o,s=t.call(this)||this;return l(e)||!e?i={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&_?((o=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},i={next:e.next&&I(e.next,o),error:e.error&&I(e.error,o),complete:e.complete&&I(e.complete,o)}):i=e,s.destination=new E(i),s}return p(e,t),e}(L);function M(t){w||function(t){$.setTimeout((function(){if(!b)throw t;b(t)}))}(t)}function O(t,e){var n=x;n&&$.setTimeout((function(){return n(t,e)}))}var z={closed:!0,next:S,error:function(t){throw t},complete:S},N=function(t){function e(e,n,r,i,o,s){var a=t.call(this,e)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=i?function(t){try{i(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return p(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(L);function j(t){return t}function A(t,e,n){var r,i=l(t)||e||n?{next:t,error:e,complete:n}:t;return i?(r=function(t,e){var n;null===(n=i.subscribe)||void 0===n||n.call(i);var r,o,s,a,l=!0;t.subscribe((r=function(t){var n;null===(n=i.next)||void 0===n||n.call(i,t),e.next(t)},o=function(){var t;l=!1,null===(t=i.complete)||void 0===t||t.call(i),e.complete()},s=function(t){var n;l=!1,null===(n=i.error)||void 0===n||n.call(i,t),e.error(t)},a=function(){var t,e;l&&(null===(t=i.unsubscribe)||void 0===t||t.call(i)),null===(e=i.finalize)||void 0===e||e.call(i)},new N(e,r,o,s,a)))},function(t){if(function(t){return l(null==t?void 0:t.lift)}(t))return t.lift((function(t){try{return r(t,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}):j}class H{constructor(t,e,n=!0,r=!0){this.logger=t,this.name=e,this.enabled=n,this.jsonify=r}generateFn(t,e,n){if(!this.enabled||!this.logger.enabled)return t=>t;const r=`${this.name}/${t}${e?`-${e}`:""}`;let i=0;return t=>t.pipe(A((t=>{const e=null==t?t:this.jsonify?JSON.parse(JSON.stringify(t)):t;return this.logger.a(r+" #"+i++,{showData:e})})))}rxTap(t,{enabled:e=!0,jsonify:n=!0}={enabled:!0,jsonify:!0}){return new H(this.logger,`${this.name}-${t}`,e,n)}pipe(t){return this.generateFn("pipe",t)}map(t){return this.generateFn("map",t)}filter(t){return this.generateFn("filter",t)}shareReplay(t){return this.generateFn("shareReplay",t)}distinctUntilChanged(t){return this.generateFn("distinctUntilChanged",t)}start(){return this.generateFn("start")}end(){return this.generateFn("end")}step(t){return this.generateFn("step"+t)}part(t){return this.generateFn("part",t)}read(t){return this.generateFn("read",t)}}class P{constructor(t,e,n){this.name=t,this.enabled=e,this.svcId=Math.random().toString(36).substring(7),this.enableChildren=n??!1,this.nameWithSvcId=`${t}-${this.svcId}`}rename(t){this.name=t,this.nameWithSvcId=`${t}-${this.svcId}`}inherit(t){this.enabled=this.enabled||t.enabled,t.enabled&&this.a(`Enabled: Inheriting log settings from parent ${t.nameWithSvcId}`)}a(t,e){this.enabled&&s(`[${this.nameWithSvcId}] ${t}`,e)}rxTap(t,{enabled:e=!0,jsonify:n=!0}={enabled:!0,jsonify:!0}){return new H(this,t,e,n)}val(t,e){this.enabled&&s(`[${this.nameWithSvcId}] value of ${t}:`,{value:e})}values(t){this.enabled&&s(`[${this.nameWithSvcId}] values:`,t)}fn(t,e,n){return new a(this,t,n,e)}fnCond(t,e,n,r){return t||!this.enabled?this.fn(e,n,r):new P("noop",!1).fn("noop",{condition:t})}}},721:(t,e,n)=>{n.d(e,{Z:()=>i,Ul:()=>r,Af:()=>o,m5:()=>s});const r={mapMarker:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-marker-alt" class="svg-inline--fa fa-map-marker-alt fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"></path></svg>'};function i(t,e){return`${t}<style>\n${e}\n</style>`}function o(t){return JSON.parse(t.replace("latitude","lat").replace("longitude","lng"))}function s(t){return JSON.stringify(t).replace("lat","latitude").replace("lng","longitude")}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t=n(721);var e=n(416);const r="field-custom-gps-dialog";class i extends HTMLElement{constructor(){super(),this.log=new e.B("FieldCustomGpsDialog",!1),this.log.a(`${r} constructor called`),this.fieldInitialized=!1}connectedCallback(){if(this.fieldInitialized)return;this.fieldInitialized=!0,this.log.a(`${r} connectedCallback called`),this.eventListeners=[],this.innerHTML=(0,t.Z)('<div class="custom-gps-container">\r\n  <div class="map-info">\r\n    <div class="input-component">\r\n      <label for="lat">Lat:</label>\r\n      <input id="lat" type="number" step="0.001" />\r\n    </div>\r\n    &nbsp;\r\n    <div class="input-component">\r\n      <label for="lng">Lng:</label>\r\n      <input id="lng" type="number" step="0.001" />\r\n    </div>\r\n  </div>\r\n\r\n  <div id="address-mask-container" class="map-info address-mask-container hidden">\r\n    <a id="icon-search" class="btn">\r\n      <i class="material-icons-outlined">search</i>\r\n    </a>\r\n    <span id="formatted-address-container"></span>\r\n  </div>\r\n\r\n  <div id="map" class="map-info__map"></div>\r\n</div>\r\n',".custom-gps-container{display:flex;flex-direction:column;height:100%}.map-info{flex:0 0 32px;display:flex;flex-wrap:wrap;align-items:center;padding:4px;padding-left:14px;border-bottom:1px solid #e1e1e1;background:#fff}.map-info label,.map-info #icon-search{margin-right:8px;display:flex;justify-content:center;align-items:center;font-size:12px;text-transform:uppercase;padding:4px}.map-info #icon-search i{font-size:14px;width:14px;height:14px;font-weight:bold}.map-info input{margin-right:8px;padding:4px 16px;border:none;background:rgba(0,0,0,0);outline:none !important}.address-mask-container{flex-wrap:nowrap}.map-info__map{flex:1 1 auto;width:100%;display:block}.hidden{display:none}.btn{border:1px solid silver;border-radius:4px}.btn:hover{background-color:rgba(69,79,99,.08);cursor:pointer}.input-component{display:flex;background-color:rgba(69,79,99,.08);padding:4px;border-radius:4px 4px 0 0;border-bottom:1px solid silver;margin:8px 0}.input-component:hover{border-bottom:1px solid #002753}"),this.latInput=this.querySelector("#lat"),this.lngInput=this.querySelector("#lng");const e=this.querySelector("#address-mask-container");this.iconSearch=this.querySelector("#icon-search");const n=this.querySelector("#formatted-address-container");this.mapContainer=this.querySelector("#map");const i=this.connector._experimental,o=i.allInputTypeNames.map((t=>t.name));o.includes(this.connector.field.settings.LatField)&&(this.latFieldName=this.connector.field.settings.LatField),o.includes(this.connector.field.settings.LongField)&&(this.lngFieldName=this.connector.field.settings.LongField);const s=this.connector.field.settings.AddressMask||this.connector.field.settings["Address Mask"];this.addressMask=i.getFieldMask(s,"Gps",!1),this.log.a(`${r} addressMask:`,{addressMaskSetting:s}),s&&(e.classList.remove("hidden"),n.innerText=this.addressMask.resolve());const a=i.getSettings("Settings.GoogleMaps.DefaultCoordinates");this.defaultCoordinates={lat:a.Latitude,lng:a.Longitude};const l=i.getSettings("Settings.GoogleMaps.ApiKey").ApiKey;this.connector.loadScript("google",`https://maps.googleapis.com/maps/api/js?key=${l}&callback=Function.prototype`,(()=>{this.mapScriptLoaded()}))}mapScriptLoaded(){this.log.a(`${r} mapScriptLoaded called`),this.map=new google.maps.Map(this.mapContainer,{zoom:15,center:this.defaultCoordinates,gestureHandling:"greedy",streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}),this.marker=new google.maps.Marker({position:this.defaultCoordinates,map:this.map,draggable:!0}),this.geocoder=new google.maps.Geocoder,this.connector.data.value?this.updateHtml((0,t.Af)(this.connector.data.value)):this.updateHtml(this.defaultCoordinates);const e=()=>{this.onLatLngInputChange()};this.latInput.addEventListener("change",e),this.lngInput.addEventListener("change",e);const n=()=>{this.autoSelect()};this.iconSearch.addEventListener("click",n),this.eventListeners.push({element:this.latInput,type:"change",listener:e},{element:this.lngInput,type:"change",listener:e},{element:this.iconSearch,type:"click",listener:n}),this.marker.addListener("dragend",(t=>{this.onMarkerDragend(t)}))}updateHtml(t){this.latInput.value=t.lat?.toString()??"",this.lngInput.value=t.lng?.toString()??"",this.map.setCenter(t),this.marker.setPosition(t)}updateForm(e){this.connector.data.update((0,t.m5)(e)),this.latFieldName&&this.connector._experimental.updateField(this.latFieldName,e.lat),this.lngFieldName&&this.connector._experimental.updateField(this.lngFieldName,e.lng)}onLatLngInputChange(){this.log.a(`${r} input changed`);const t={lat:this.latInput.value.length>0?parseFloat(this.latInput.value):null,lng:this.lngInput.value.length>0?parseFloat(this.lngInput.value):null};this.updateHtml(t),this.updateForm(t)}autoSelect(){this.log.a(`${r} geocoder called`);const t=this.addressMask.resolve();this.geocoder.geocode({address:t},((e,n)=>{if(n===google.maps.GeocoderStatus.OK){const t=e[0].geometry.location,n={lat:t.lat(),lng:t.lng()};this.updateHtml(n),this.updateForm(n)}else alert(`Could not locate address: ${t}`)}))}onMarkerDragend(t){this.log.a(`${r} marker changed`);const e={lat:t.latLng.lat(),lng:t.latLng.lng()};this.updateHtml(e),this.updateForm(e)}disconnectedCallback(){this.log.a(`${r} disconnectedCallback called`),google?.maps.event.clearInstanceListeners(this.marker),google?.maps.event.clearInstanceListeners(this.map),this.eventListeners.forEach((({element:t,type:e,listener:n})=>{t.removeEventListener(e,n)})),this.addressMask.destroy()}}customElements.get(r)||customElements.define(r,i)})(),(()=>{var t=n(721),e=n(416);const r="field-custom-gps";class i extends HTMLElement{constructor(){super(),this.log=new e.B("FieldCustomGps",!1),this.log.a(`${r} constructor called`),this.fieldInitialized=!1}connectedCallback(){if(this.fieldInitialized)return;this.fieldInitialized=!0,this.log.a(`${r} connectedCallback called`),this.innerHTML=(0,t.Z)('<div class="custom-gps-preview">\r\n  <div class="custom-gps-preview__text">\r\n    Lat: <span id="lat-container"></span>, Lng: <span id="lng-container"></span>\r\n  </div>\r\n  <div class="custom-gps-preview__spacer"></div>\r\n  <div id="map-icon-container" class="custom-gps-preview__map-icon"></div>\r\n</div>\r\n',".custom-gps-preview{width:100%;display:flex;align-items:center;position:absolute;top:0;bottom:0;font-size:16px;line-height:20px;margin-bottom:-2px;cursor:pointer}.custom-gps-preview__text{flex-shrink:0;max-width:80%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.custom-gps-preview__spacer{flex-grow:1}.custom-gps-preview__map-icon{flex-shrink:0;margin-right:4px;display:flex;align-items:center;justify-content:center}.custom-gps-preview__map-icon svg{width:20px;height:20px;line-height:20px}"),this.querySelector("#map-icon-container").innerHTML=t.Ul.mapMarker,this.latContainer=this.querySelector("#lat-container"),this.lngContainer=this.querySelector("#lng-container"),this.eventListeners=[];const e=()=>{this.expand()};this.addEventListener("click",e),this.eventListeners.push({element:this,type:"click",listener:e});const n=this.connector._experimental.getSettings("Settings.GoogleMaps.DefaultCoordinates");this.defaultCoordinates={lat:n.Latitude,lng:n.Longitude},this.connector.data.value?this.updateHtml((0,t.Af)(this.connector.data.value)):this.updateHtml(this.defaultCoordinates),this.connector.data.onValueChange((e=>{if(e){const n=(0,t.Af)(e);this.updateHtml(n)}else this.updateHtml(this.defaultCoordinates)}))}updateHtml(t){this.latContainer.innerText=t.lat?.toString()??"",this.lngContainer.innerText=t.lng?.toString()??""}expand(){this.connector.dialog.open()}disconnectedCallback(){this.log.a(`${r} disconnectedCallback called`),this.eventListeners.forEach((({element:t,type:e,listener:n})=>{t.removeEventListener(e,n)}))}}customElements.get(r)||customElements.define(r,i)})()})();
//# sourceMappingURL=https://sources.2sxc.org/18.00.01/system/field-custom-gps/index.js.map