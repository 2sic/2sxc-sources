"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_permissions_permissions_component_ts"],{401:(M,g,t)=>{t.d(g,{T:()=>r});var s=t(6474),p=t(1659);let r=(()=>{class d extends s.D{getMetadata(i,n,l,o){return this.getHttp("admin/metadata/get",{params:{appId:this.appId,targetType:i.toString(),keyType:n,key:l.toString(),...o&&{contentType:o}}})}static{this.\u0275fac=(()=>{let i;return function(l){return(i||(i=p.xGo(d)))(l||d)}})()}static{this.\u0275prov=p.jDH({token:d,factory:d.\u0275fac})}}return d})()},2458:(M,g,t)=>{t.r(g),t.d(g,{PermissionsComponent:()=>C});var s=t(1659),p=t(4175),c=t(7941),r=t(3840),d=t(2159),f=t(2938),i=t(3620),n=t(1828),l=t(251),o=t(52),u=t(3216),D=t(334),e=t(7037),a=t(8471),_=t(4646),m=t(4601);let P=(()=>{class O{agInit(h){this.params=h}refresh(h){return!0}deletePermission(){this.params.onDelete(this.params.data)}static{this.\u0275fac=function(E){return new(E||O)}}static{this.\u0275cmp=s.VBU({type:O,selectors:[["app-permissions-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(E,v){1&E&&(s.j41(0,"div",0)(1,"div",1),s.bIt("click",function(){return v.deletePermission()}),s.j41(2,"mat-icon"),s.EFF(3,"delete"),s.k0s()()())},dependencies:[_.pZ,_.r6,r.m_,r.An,m.e],encapsulation:2})}}return O})();var T=t(4900),y=t(3347),I=t(9841);let C=(()=>{class O{#e;#s;#t;#i;constructor(h,E){this.dialog=h,this.snackBar=E,this.gridOptions=this.buildGridOptions(),this.permissions=(0,s.vPA)([]),this.#e=(0,f.d)(T.K),this.#s=(0,f.d)(a.c),this.#t=(0,i.C)(this.#s.getParams(["targetType","keyType","key"]),v=>({targetType:parseInt(v.targetType,10),keyType:v.keyType,key:v.key})),this.#i={[o.YX.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.#a(),this.#s.doOnDialogClosed(()=>this.#a())}closeDialog(){this.dialog.close()}#a(){this.#e.getAll(this.#t.targetType,this.#t.keyType,this.#t.key).subscribe(h=>{this.permissions.set(h)})}editPermission(h){let E;E=null==h?{items:[{...D.c.newMetadataFromInfo(o.YX.contentTypes.permissions,D.c.constructMetadataInfo(this.#t.targetType,this.#t.keyType,this.#t.key)),...this.#i[this.#t.targetType]&&{Prefill:this.#i[this.#t.targetType]}}]}:{items:[D.c.editId(h.Id)]};const v=(0,u.s)(E);this.#s.navRelative([`edit/${v}`])}deletePermission(h){confirm(`Delete '${h.Title}' (${h.Id})?`)&&(this.snackBar.open("Deleting..."),this.#e.delete(h.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#a()}))}buildGridOptions(){return{...l.C,columnDefs:[{...n.r.Id,cellRendererParams:n.r.idFieldParamsTooltipGetter()},{...n.r.TextWide,headerName:"Name",field:"Title",sort:"asc",onCellClicked:E=>{this.editPermission(E.data)}},{...n.r.TextWide,field:"Identity"},{...n.r.TextWide,field:"Condition"},{...n.r.Character,field:"Grant"},{...n.r.ActionsPinnedRight1,cellRenderer:P,cellRendererParams:{onDelete:v=>this.deletePermission(v)}}]}}static{this.\u0275fac=function(E){return new(E||O)(s.rXU(c.CP),s.rXU(y.UG))}}static{this.\u0275cmp=s.VBU({type:O,selectors:[["app-permissions"]],decls:15,vars:2,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(E,v){1&E&&(s.j41(0,"div",0)(1,"div",1)(2,"div",2),s.EFF(3,"Permissions"),s.k0s(),s.j41(4,"button",3),s.bIt("click",function(){return v.closeDialog()}),s.j41(5,"mat-icon"),s.EFF(6,"close"),s.k0s()()(),s.j41(7,"div",4),s.nrm(8,"router-outlet"),s.j41(9,"div",5),s.nrm(10,"ag-grid-angular",6),s.k0s(),s.j41(11,"mat-dialog-actions",7)(12,"button",8),s.bIt("click",function(){return v.editPermission(null)}),s.j41(13,"mat-icon"),s.EFF(14,"add"),s.k0s()()()()()),2&E&&(s.R7$(10),s.Y8G("rowData",v.permissions())("gridOptions",v.gridOptions))},dependencies:[p.Hl,p.iY,p.Sr,r.m_,r.An,d.n3,c.E7,e.p,I.xs],encapsulation:2})}}return O})()},3620:(M,g,t)=>{function s(c,r){return r(c)}function p(c,r){return r(c)}t.d(g,{C:()=>s,z:()=>p})},4839:(M,g,t)=>{t.d(g,{c:()=>f});var s=t(4435),p=t(8873),c=t(1659),r=t(6443);const d={all:!1,getAvailableEntities:!1,getEntities:!1};let f=(()=>{class i{constructor(l,o){this.http=l,this.context=o,this.log=(0,s.Tq)({QueryService:i},d)}getFromQuery(l,o,u,D){this.log.fnIf("getAvailableEntities",{queryUrl:l,params:o,fields:u,entitiesFilter:D});const e=!!o,P=(((o?.toLocaleLowerCase()??"").includes("appid=")?"":`&appId=${this.context.appId}`)+(e?`&${o}`:"")+"&$select="+(u??"")).substring(1);return this.http.post(`app/auto/query/${l}?${P}`,{Guids:D})}getEntities({contentTypes:l,itemIds:o,fields:u,log:D}){this.log.fnIf("getEntities",{log:D,contentTypes:l,itemIds:o,fields:u});const a=("&typeNames="+(l?.join(",")??"")+`&appId=${this.context.appId}&itemIds=`+(o?.join(",")??"")+"&$select="+(u??"")).substring(1);return this.http.post(`app/auto/query/System.EntityPicker/Default?${a}`,{})}static{this.\u0275fac=function(o){return new(o||i)(c.KVO(r.Qq),c.KVO(p.o))}}static{this.\u0275prov=c.jDH({token:i,factory:i.\u0275fac})}}return i})()},4900:(M,g,t)=>{t.d(g,{K:()=>i});var s=t(271),p=t(2938),c=t(52),r=t(6817),d=t(401),f=t(1659);let i=(()=>{class n{constructor(){this.metadataService=(0,p.d)(d.T),this.entitiesService=(0,p.d)(r.R)}getAll(o,u,D){return this.metadataService.getMetadata(o,u,D,c.YX.contentTypes.permissions).pipe((0,s.T)(e=>e.Items))}delete(o){return this.entitiesService.delete(c.YX.contentTypes.permissions,o,!1)}static{this.\u0275fac=function(u){return new(u||n)}}static{this.\u0275prov=f.jDH({token:n,factory:n.\u0275fac})}}return n})()},4979:(M,g,t)=>{t.d(g,{V:()=>c});var s=t(7092),p=t(1659);let c=(()=>{class r{constructor(){this.subscriptions=new s.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275prov=p.jDH({token:r,factory:r.\u0275fac})}}return r})()},6817:(M,g,t)=>{t.d(g,{R:()=>r});var s=t(9234),p=t(6474),c=t(1659);let r=(()=>{class d extends p.D{create(i,n){return this.http.post(`app/auto/data/${i}`,n,{params:{appId:this.appId,zoneId:this.zoneId}})}update(i,n,l){return this.http.post(`app/auto/data/${i}/${n}`,l,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(i,n,l){return this.http.delete(this.apiUrl(s.gb+"delete"),{params:{contentType:i,id:n.toString(),appId:this.appId,force:l.toString()}})}static{this.\u0275fac=(()=>{let i;return function(l){return(i||(i=c.xGo(d)))(l||d)}})()}static{this.\u0275prov=c.jDH({token:d,factory:d.\u0275fac})}}return d})()},8471:(M,g,t)=>{t.d(g,{c:()=>o});var s=t(2159),p=t(1567),c=t(3037),r=t(271),d=t(5057),f=t(4435),i=t(4979),n=t(1659);const l={doOnDialogClosed:!0};let o=(()=>{class u extends i.V{constructor(e,a){super(),this.router=e,this.route=a,this.log=(0,f.Tq)({DialogRoutingService:u},l)}get snapshot(){return this.route.snapshot}get url(){return this.router.url}get urlSegments(){return this.router.url.split("/")}getParam(e){return this.route.snapshot.paramMap.get(e)}getParams(e){const a=this.route.snapshot.paramMap;return e.reduce((_,m)=>(_[m]=a.get(m),_),{})}getQueryParam(e){return this.route.snapshot.queryParamMap.get(e)}getQueryParams(e){const a=this.route.snapshot.queryParamMap;return e.reduce((_,m)=>(_[m]=a.get(m),_),{})}state(){return this.router.getCurrentNavigation().extras?.state}doOnDialogClosed(e){const a=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.childDialogClosed$().subscribe(()=>e())),a.end()}urlSubRoute(e){const a=this.router.createUrlTree([e],{relativeTo:this.route});return this.router.serializeUrl(a)}navPath(e,a){return this.router.navigate([e],a)}navRelative(e,a){return this.router.navigate(e,{...a,relativeTo:this.route})}childDialogClosed$(){return this.router.events.pipe((0,p.p)(e=>e instanceof s.wF),(0,c.Z)(!!this.route.snapshot.firstChild),(0,r.T)(()=>!!this.route.snapshot.firstChild),(0,d.J)(),(0,p.p)(([e,a])=>e&&!a))}static{this.\u0275fac=function(a){return new(a||u)(n.KVO(s.Ix),n.KVO(s.nX))}}static{this.\u0275prov=n.jDH({token:u,factory:u.\u0275fac})}}return u})()},9234:(M,g,t)=>{t.d(g,{Gg:()=>D,Tr:()=>e,gb:()=>u});var s=t(1567),p=t(6647),c=t(6301),r=t(271),d=t(2938),f=t(4435),i=t(6474),n=t(4839),l=t(1659);const o={all:!1,getEntities:!1,getAvailableEntities:!1,delete:!1},u="admin/entity/",D="admin/entity/list";let e=(()=>{class a extends i.D{constructor(){super(...arguments),this.log=(0,f.Tq)({EntityService:a},o),this.queryService=(0,d.d)(n.c)}getEntities$(m){return this.log.fnIf("getEntities"),m.pipe((0,s.p)(P=>null!=P),(0,p.n)(P=>this.getAvailableEntities(P.contentTypeName).pipe((0,c.t)(1))))}getAvailableEntities(m,P){return this.log.fnIf("getAvailableEntities"),this.queryService.getEntities({contentTypes:[m],itemIds:P,fields:"Id,Guid,Title",log:"getAvailableEntities"}).pipe((0,r.T)(y=>y.Default))}delete(m,P,T,y,I,C){return this.log.fnIf("delete",{appId:m,contentType:P,entityId:T,force:y,parentId:I,parent}),this.http.delete(this.apiUrl(u+"delete"),{params:{contentType:P,id:T.toString(),appId:m,force:y.toString(),...I&&{parentId:I.toString()},...I&&C&&{parentField:C}}})}static{this.\u0275fac=(()=>{let m;return function(T){return(m||(m=l.xGo(a)))(T||a)}})()}static{this.\u0275prov=l.jDH({token:a,factory:a.\u0275fac})}}return a})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/19.03.05/dist/ng-edit/projects_eav-ui_src_app_permissions_permissions_component_ts.ac091ce0bd7b60d6.js.map