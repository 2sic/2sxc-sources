"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts"],{5026:(K,M,a)=>{a.r(M),a.d(M,{ManageContentListComponent:()=>S});var p=a(6571),m=a(7941),u=a(9184),E=a(5797),b=a(9999),L=a(271),h=a(3216),f=a(9669),x=a(5445),g=a(852),D=a(1735),P=a(316),I=a(3840),v=a(4175),T=a(2275),O=a(4522),$=a(4601),R=a(1459),t=a(8559),F=a(3347);function j(o,r){if(1&o){const e=t.RV6();t.j41(0,"span"),t.EFF(1),t.k0s(),t.j41(2,"button",13),t.bIt("click",function(){t.eBV(e);const i=t.XpG(3);return t.Njj(i.editHeader())}),t.j41(3,"mat-icon"),t.EFF(4,"edit"),t.k0s()()}if(2&o){const e=t.XpG(2);t.R7$(),t.JRh(e.header.Title)}}function k(o,r){1&o&&(t.EFF(0),t.nI1(1,"translate")),2&o&&t.SpI(" ",t.bMT(1,1,"ManageContentList.NoHeader")," ")}function B(o,r){if(1&o&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.j41(3,"p"),t.DNE(4,j,5,1)(5,k,2,3),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,3,"ManageContentList.Description")," "),t.R7$(3),t.vxM(4,e.header.Type?4:-1),t.R7$(),t.vxM(5,e.header.Type?-1:5)}}function G(o,r){1&o&&(t.j41(0,"p",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"ManageContentList.SortItems")," "))}function y(o,r){1&o&&(t.j41(0,"p",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"ManageContentList.SortLotsOfItems")," "))}function U(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",7)(1,"div",14)(2,"mat-icon",15),t.EFF(3,"drag_handle"),t.k0s(),t.j41(4,"span",16),t.EFF(5),t.k0s()(),t.j41(6,"div")(7,"button",17),t.nI1(8,"translate"),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.addFromExisting(i.Index))}),t.j41(9,"mat-icon"),t.EFF(10,"playlist_add"),t.k0s()(),t.j41(11,"button",17),t.nI1(12,"translate"),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.addBelow(i.Index))}),t.j41(13,"mat-icon"),t.EFF(14,"add"),t.k0s()(),t.j41(15,"button",17),t.nI1(16,"translate"),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.remove(i))}),t.j41(17,"mat-icon"),t.EFF(18,"remove"),t.k0s()(),t.j41(19,"button",17),t.nI1(20,"translate"),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.editItem(i.Id))}),t.j41(21,"mat-icon"),t.EFF(22,"edit"),t.k0s()()()()}if(2&o){const e=r.$implicit,n=t.XpG(2);t.R7$(4),t.FCK("tippy","",e.Title," (",e.Id,")"),t.R7$(),t.Lme(" ",e.Title," (",e.Id,") "),t.R7$(2),t.Y8G("tippy",t.bMT(8,13,"Fields.Picker.AddExistingItem"))("disabled",0===e.Id),t.R7$(4),t.Y8G("tippy",t.bMT(12,15,"Fields.Picker.AddItemBelow"))("disabled",0===e.Id||n.reordered),t.R7$(4),t.Y8G("tippy",t.bMT(16,17,"Fields.Picker.Remove"))("disabled",n.reordered),t.R7$(4),t.Y8G("tippy",t.bMT(20,19,"Fields.Picker.Edit"))("disabled",0===e.Id)}}function A(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3),t.nrm(6,"router-outlet"),t.j41(7,"div",4),t.DNE(8,B,6,5)(9,G,3,3,"p",5)(10,y,3,3,"p",5),t.j41(11,"div",6),t.bIt("cdkDropListDropped",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.drop(i))}),t.Z7z(12,U,23,21,"div",7,t.BUC().trackByFn,!0),t.k0s()()(),t.j41(14,"mat-dialog-actions",8)(15,"button",9),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.closeDialog())}),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.saveList())}),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"button",11),t.nI1(22,"translate"),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.saveAndCloseList())}),t.j41(23,"mat-icon",12),t.EFF(24,"done"),t.k0s()()()()}if(2&o){const e=r;t.R7$(3),t.JRh(t.bMT(4,7,"ManageContentList.Title")),t.R7$(5),t.vxM(8,e.header?8:-1),t.R7$(),t.vxM(9,e.items&&(null==e.items?null:e.items.length)<25?9:-1),t.R7$(),t.vxM(10,(null==e.items?null:e.items.length)>=25?10:-1),t.R7$(2),t.Dyx(e.items),t.R7$(4),t.JRh(t.bMT(17,9,"General.Buttons.Cancel")),t.R7$(3),t.JRh(t.bMT(20,11,"General.Buttons.Save")),t.R7$(2),t.Y8G("tippy",t.bMT(22,13,"Form.Buttons.SaveAndClose"))}}let S=(()=>{class o extends D.V{constructor(e,n,i,s,d,l,C){super(e,n),this.router=e,this.route=n,this.dialogRef=i,this.contentGroupService=s,this.snackBar=d,this.translate=l,this.appDialogConfigService=C,this.hostClass="dialog-component",this.items$=new E.t(null),this.header$=new E.t(null),this.viewModel$=(0,b.z)([this.items$,this.header$]).pipe((0,L.T)(([c,_])=>({items:c,header:_}))),this.contentGroup={id:null,guid:this.route.snapshot.paramMap.get("guid"),part:this.route.snapshot.paramMap.get("part"),index:parseInt(this.route.snapshot.paramMap.get("index"),10)},this.reordered=!1}ngOnInit(){this.fetchList(),this.fetchHeader(),this.fetchDialogSettings(),this.subscriptions.add(this.childDialogClosed$().subscribe(()=>{this.fetchList(!0),this.fetchHeader()}))}ngOnDestroy(){this.items$.complete(),this.header$.complete(),super.ngOnDestroy()}fetchDialogSettings(){this.appDialogConfigService.getCurrent$().subscribe(e=>{this.translate.setDefaultLang(e.Context.Language.Primary.split("-")[0]),this.translate.use(e.Context.Language.Current.split("-")[0])})}closeDialog(){this.dialogRef.close()}saveList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.fetchList(),this.fetchHeader()})}saveAndCloseList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()})}editHeader(){const n=(0,h.s)({items:[{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listcontent"},{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listpresentation"}]});this.router.navigate([`edit/${n}`],{relativeTo:this.route})}editItem(e){const i=(0,h.s)({items:[{EntityId:e}]});this.router.navigate([`edit/${i}`],{relativeTo:this.route})}addFromExisting(e){this.router.navigate([`${this.contentGroup.guid}/${this.contentGroup.part}/${e+1}/replace`],{relativeTo:this.route,queryParams:{add:!0}})}addBelow(e){const i=(0,h.s)({items:[{Add:!0,Index:e+1,Parent:this.contentGroup.guid,Field:this.contentGroup.part}]});this.router.navigate([`edit/${i}`],{relativeTo:this.route})}remove(e){confirm(this.translate.instant("ManageContentList.ConfirmRemove"))&&(this.snackBar.open("Removing..."),this.contentGroupService.removeItem(this.contentGroup,e.Index).subscribe(()=>{this.snackBar.open("Removed",null,{duration:2e3}),this.fetchList()}))}drop(e){const n=[...this.items$.value];(0,p.HD)(n,e.previousIndex,e.currentIndex),this.items$.next(n),this.reordered=!0}trackByFn(e,n){return`${n.Index}+${n.Id}`}fetchList(e=!1){this.contentGroupService.getList(this.contentGroup).subscribe(n=>{if(this.reordered){const i=this.items$.value.map(d=>d.Id);if(this.items$.value.length===n.length&&!n.some(d=>!i.includes(d.Id))&&e){const d=this.items$.value.map(l=>l.Index);n.sort((l,C)=>{const c=d.indexOf(l.Index),_=d.indexOf(C.Index);return-1===c||-1===_?0:c-_})}else e&&this.snackBar.open("List was changed from somewhere else. Order of items is reset",null,{duration:5e3})}this.items$.next(n),this.reordered=!1})}fetchHeader(){this.contentGroupService.getHeader(this.contentGroup).subscribe(e=>{this.header$.next(e)})}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(u.Ix),t.rXU(u.nX),t.rXU(m.CP),t.rXU(f.y),t.rXU(F.UG),t.rXU(g.c$),t.rXU(x.bd))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-manage-content-list"]],hostVars:1,hostBindings:function(n,i){2&n&&t.Mr5("className",i.hostClass)},standalone:!0,features:[t.Jv_([f.y,x.bd,O.Sy]),t.Vt3,t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-content"],["cdkScrollable","",1,"dialog-component-content","fancy-scrollbar-light"],[1,"eav-sort-title"],["cdkDropList","",1,"eav-dnd-list",3,"cdkDropListDropped"],["cdkDrag","",1,"eav-dnd-item"],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent",3,"click","tippy"],[1,"eav-raised-button-icon"],["mat-icon-button","","tippy","Edit header",3,"click"],[1,"eav-dnd-item__title"],["tippy","Drag to reorder the list",1,"eav-dnd-item__title-icon"],[1,"eav-dnd-item__title-text",3,"tippy"],["mat-icon-button","","appMousedownStopPropagation","",3,"click","tippy","disabled"]],template:function(n,i){if(1&n&&(t.DNE(0,A,25,15,"div",0),t.nI1(1,"async")),2&n){let s;t.vxM(0,(s=t.bMT(1,1,i.viewModel$))?0:-1,s)}},dependencies:[u.n3,T.uv,v.Hl,v.$z,v.iY,I.m_,I.An,p.O7,p.T1,m.E7,P.Jj,g.h,g.D9,m.hM,$.e,R.z],styles:[".eav-sort-title[_ngcontent-%COMP%]{padding-top:16px}.eav-dnd-list[_ngcontent-%COMP%]{margin:16px 0;border:1px solid #ccc;border-radius:4px;overflow:hidden}.eav-dnd-item[_ngcontent-%COMP%]{cursor:move;height:40px;border-bottom:1px solid #ccc;padding:0 8px;display:flex;align-items:center;justify-content:space-between;background:#fff;box-sizing:border-box;font-size:14px}.eav-dnd-item[_ngcontent-%COMP%]:last-child{border:none}.eav-dnd-item__title[_ngcontent-%COMP%]{display:flex;align-items:center;overflow:hidden;max-width:80%}.eav-dnd-item__title-icon[_ngcontent-%COMP%]{margin-right:8px;opacity:.4}.eav-dnd-item__title-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dnd-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dnd-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.00/dist/ng-edit/projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts.565a6fffd38b6776.js.map