{"version":3,"file":"projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts.25b95162aba2ad38.js","mappings":"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","names":["i0","_r9","ctx_r8","editHeader","vm_r1","header","Title","ManageContentListComponent_ng_container_0_ng_container_9_ng_container_5_Template","ManageContentListComponent_ng_container_0_ng_container_9_ng_container_6_Template","Type","item_r12","_r14","$implicit","ctx_r13","addFromExisting","Index","ctx_r15","addBelow","ctx_r16","remove","ctx_r17","editItem","Id","ctx_r5","reordered","ManageContentListComponent_ng_container_0_ng_container_9_Template","ManageContentListComponent_ng_container_0_p_10_Template","ManageContentListComponent_ng_container_0_p_11_Template","$event","_r19","ctx_r18","drop","ManageContentListComponent_ng_container_0_div_13_Template","ctx_r20","closeDialog","ctx_r21","saveList","ctx_r22","saveAndCloseList","items","length","ctx_r0","trackByFn","ManageContentListComponent","_class","BaseComponent","constructor","router","route","dialogRef","contentGroupService","snackBar","translate","appDialogConfigService","super","this","hostClass","items$","BehaviorSubject","header$","viewModel$","combineLatest","pipe","map","contentGroup","id","guid","snapshot","paramMap","get","part","index","parseInt","ngOnInit","fetchList","fetchHeader","fetchDialogSettings","subscription","add","refreshOnChildClosedShallow","subscribe","ngOnDestroy","complete","getShared$","tap","dialogSettings","setDefaultLang","Context","Language","Primary","split","use","Current","close","open","value","duration","formUrl","convertFormToUrl","Add","Parent","Field","navigate","relativeTo","EntityId","queryParams","item","confirm","instant","removeItem","event","moveItemInArray","previousIndex","currentIndex","next","keepOrder","getList","oldIds","some","includes","sortOrder","sort","a","b","aIndex","indexOf","bIndex","getHeader","i1","i2","i3","i4","i5","i6","selectors","hostVars","hostBindings","rf","ctx","ManageContentListComponent_ng_container_0_Template","BaseSubsinkComponent","refreshOnChildClosedDeep","events","filter","NavigationEnd","startWith","firstChild","pairwise","hadChild","hasChild","features"],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/manage-content-list/manage-content-list.component.html","./projects/eav-ui/src/app/manage-content-list/manage-content-list.component.ts","./projects/eav-ui/src/app/shared/components/base-component/base.component.ts"],"sourcesContent":["<ng-container *ngIf=\"viewModel$ | async as vm\">\r\n  <div class=\"eav-dialog eav-no-scrollbar\">\r\n    <div class=\"eav-dialog-header\">\r\n      <div class=\"eav-dialog-header__title\">{{'ManageContentList.Title' | translate}}</div>\r\n    </div>\r\n    <div class=\"eav-dialog-content\">\r\n      <router-outlet></router-outlet>\r\n      \r\n      <div class=\"dialog-component-content fancy-scrollbar-light\" cdkScrollable>\r\n        <ng-container *ngIf=\"vm.header\">\r\n          <p>\r\n            {{'ManageContentList.Description' | translate}}\r\n          </p>\r\n      \r\n          <p>\r\n            <ng-container *ngIf=\"vm.header.Type\">\r\n              <span>{{ vm.header.Title }}</span>\r\n              <button mat-icon-button tippy=\"Edit header\" (click)=\"editHeader()\">\r\n                <mat-icon>edit</mat-icon>\r\n              </button>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"!vm.header.Type\">{{'ManageContentList.NoHeader' | translate}}</ng-container>\r\n          </p>\r\n        </ng-container>\r\n      \r\n        <p class=\"eav-sort-title\" *ngIf=\"vm.items && vm.items?.length < 25 \">\r\n          {{'ManageContentList.SortItems' | translate}}\r\n        </p>\r\n        <p class=\"eav-sort-title\" *ngIf=\"vm.items?.length >= 25 \">\r\n          {{'ManageContentList.SortLotsOfItems' | translate}}\r\n        </p>\r\n      \r\n        <div class=\"eav-dnd-list\" cdkDropList (cdkDropListDropped)=\"drop($event)\">\r\n          <div *ngFor=\"let item of vm.items; trackBy: trackByFn\" class=\"eav-dnd-item\" cdkDrag>\r\n            <div class=\"eav-dnd-item__title\">\r\n              <mat-icon class=\"eav-dnd-item__title-icon\" tippy=\"Drag to reorder the list\">drag_handle</mat-icon>\r\n              <span class=\"eav-dnd-item__title-text\" tippy=\"{{ item.Title }} ({{ item.Id }})\">\r\n                {{ item.Title }} ({{ item.Id }})\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <!-- most buttons should only exist if it has a real ID, except for remove - which should also remove null-entries -->\r\n              <button mat-icon-button [tippy]=\"'Fields.Entity.AddExistingItem' | translate\" appMousedownStopPropagation\r\n                [disabled]=\"item.Id === 0\" (click)=\"addFromExisting(item.Index)\">\r\n                <mat-icon>playlist_add</mat-icon>\r\n              </button>\r\n              <button mat-icon-button [tippy]=\"'Fields.Entity.AddItemBelow' | translate\" appMousedownStopPropagation\r\n                [disabled]=\"item.Id === 0 || reordered\" (click)=\"addBelow(item.Index)\">\r\n                <mat-icon>add</mat-icon>\r\n              </button>\r\n              <button mat-icon-button [tippy]=\"'Fields.Entity.Remove' | translate\" appMousedownStopPropagation\r\n                [disabled]=\"reordered\" (click)=\"remove(item)\">\r\n                <mat-icon>remove</mat-icon>\r\n              </button>\r\n              <button mat-icon-button [tippy]=\"'Fields.Entity.Edit' | translate\" appMousedownStopPropagation\r\n                [disabled]=\"item.Id === 0\" (click)=\"editItem(item.Id)\">\r\n                <mat-icon>edit</mat-icon>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <mat-dialog-actions align=\"end\">\r\n      <button mat-raised-button (click)=\"closeDialog()\">{{'General.Buttons.Cancel' | translate}}</button>\r\n      <button mat-raised-button color=\"accent\" (click)=\"saveList()\">{{'General.Buttons.Save' | translate}}</button>\r\n      <button mat-raised-button color=\"accent\" (click)=\"saveAndCloseList()\" [tippy]=\"'Form.Buttons.SaveAndClose' | translate\">\r\n        <mat-icon class=\"eav-raised-button-icon\">done</mat-icon>\r\n      </button>\r\n    </mat-dialog-actions>\r\n  </div>\r\n</ng-container>","import { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\r\nimport { Component, HostBinding, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { BehaviorSubject, combineLatest, map, tap } from 'rxjs';\r\nimport { convertFormToUrl } from '../shared/helpers/url-prep.helper';\r\nimport { EditForm } from '../shared/models/edit-form.model';\r\nimport { ContentGroup } from './models/content-group.model';\r\nimport { GroupHeader } from './models/group-header.model';\r\nimport { ContentGroupService } from './services/content-group.service';\r\nimport { AppDialogConfigService } from '../app-administration/services';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BaseComponent } from '../shared/components/base-component/base.component';\r\n\r\n@Component({\r\n  selector: 'app-manage-content-list',\r\n  templateUrl: './manage-content-list.component.html',\r\n  styleUrls: ['./manage-content-list.component.scss'],\r\n})\r\nexport class ManageContentListComponent extends BaseComponent implements OnInit, OnDestroy {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  private items$ = new BehaviorSubject<GroupHeader[]>(null);\r\n  private header$ = new BehaviorSubject<GroupHeader>(null);\r\n  viewModel$ = combineLatest([this.items$, this.header$]).pipe(\r\n    map(([items, header]) => ({ items, header })),\r\n  );\r\n\r\n  private contentGroup: ContentGroup = {\r\n    id: null,\r\n    guid: this.route.snapshot.paramMap.get('guid'),\r\n    part: this.route.snapshot.paramMap.get('part'),\r\n    index: parseInt(this.route.snapshot.paramMap.get('index'), 10),\r\n  };\r\n  reordered = false;\r\n\r\n  constructor(\r\n    protected router: Router,\r\n    protected route: ActivatedRoute,\r\n    private dialogRef: MatDialogRef<ManageContentListComponent>,\r\n    private contentGroupService: ContentGroupService,\r\n\r\n    private snackBar: MatSnackBar,\r\n    private translate: TranslateService,\r\n    private appDialogConfigService: AppDialogConfigService,\r\n  ) {\r\n    super(router, route);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.fetchList();\r\n    this.fetchHeader();\r\n    this.fetchDialogSettings();\r\n    this.subscription.add(this.refreshOnChildClosedShallow().subscribe(() => { \r\n      this.fetchList(true);\r\n      this.fetchHeader();\r\n    }));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.items$.complete();\r\n    this.header$.complete();\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  private fetchDialogSettings() {\r\n    this.appDialogConfigService.getShared$() /*.getDialogSettings() */.pipe(\r\n      tap(\r\n        dialogSettings => {\r\n          this.translate.setDefaultLang(dialogSettings.Context.Language.Primary.split('-')[0]);\r\n          this.translate.use(dialogSettings.Context.Language.Current.split('-')[0]);\r\n        })\r\n    ).subscribe();\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  saveList() {\r\n    this.snackBar.open('Saving...');\r\n    this.contentGroupService.saveList(this.contentGroup, this.items$.value).subscribe(() => {\r\n      this.snackBar.open('Saved', null, { duration: 2000 });\r\n      this.fetchList();\r\n      this.fetchHeader();\r\n    });\r\n  }\r\n\r\n  saveAndCloseList() {\r\n    this.snackBar.open('Saving...');\r\n    this.contentGroupService.saveList(this.contentGroup, this.items$.value).subscribe(() => {\r\n      this.snackBar.open('Saved', null, { duration: 2000 });\r\n      this.closeDialog();\r\n    });\r\n  }\r\n\r\n  editHeader() {\r\n    const form: EditForm = {\r\n      items: [\r\n        {\r\n          Add: this.header$.value.Id === 0,\r\n          Index: 0,\r\n          Parent: this.contentGroup.guid,\r\n          Field: 'listcontent',\r\n        },\r\n        {\r\n          Add: this.header$.value.Id === 0,\r\n          Index: 0,\r\n          Parent: this.contentGroup.guid,\r\n          Field: 'listpresentation',\r\n        },\r\n      ],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  editItem(id: number) {\r\n    const form: EditForm = {\r\n      items: [{ EntityId: id }],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  addFromExisting(index: number) {\r\n    const queryParams = { add: true };\r\n    this.router.navigate([`${this.contentGroup.guid}/${this.contentGroup.part}/${index + 1}/replace`], { relativeTo: this.route, queryParams });\r\n  }\r\n\r\n  addBelow(index: number) {\r\n    const form: EditForm = {\r\n      items: [{ Add: true, Index: index + 1, Parent: this.contentGroup.guid, Field: this.contentGroup.part }],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  remove(item: GroupHeader) {\r\n    if (!confirm(this.translate.instant('ManageContentList.ConfirmRemove'))) { return; }\r\n    this.snackBar.open('Removing...');\r\n    this.contentGroupService.removeItem(this.contentGroup, item.Index).subscribe(() => { \r\n      this.snackBar.open('Removed', null, { duration: 2000 });\r\n      this.fetchList();\r\n    });\r\n  }\r\n\r\n  drop(event: CdkDragDrop<GroupHeader[]>) {\r\n    const items = [...this.items$.value];\r\n    moveItemInArray(items, event.previousIndex, event.currentIndex);\r\n    this.items$.next(items);\r\n    this.reordered = true;\r\n  }\r\n\r\n  trackByFn(index: number, item: GroupHeader) {\r\n    // we use both Index and Id because all demo items have Id=0\r\n    return `${item.Index}+${item.Id}`;\r\n  }\r\n\r\n  private fetchList(keepOrder = false) {\r\n    this.contentGroupService.getList(this.contentGroup).subscribe(items => {\r\n      if (this.reordered) {\r\n        const oldIds = this.items$.value.map(item => item.Id);\r\n        const idsChanged = this.items$.value.length !== items.length || items.some(item => !oldIds.includes(item.Id));\r\n        // for usecase where list is fetched on child closed and wasn't changed in the meantime keeps the order before child was opened\r\n        if (!idsChanged && keepOrder) {\r\n          const sortOrder = this.items$.value.map(item => item.Index);\r\n          items.sort((a, b) => {\r\n            const aIndex = sortOrder.indexOf(a.Index);\r\n            const bIndex = sortOrder.indexOf(b.Index);\r\n            if (aIndex === -1 || bIndex === -1) { return 0; }\r\n            return aIndex - bIndex;\r\n          });\r\n        } else if (keepOrder) {\r\n          this.snackBar.open('List was changed from somewhere else. Order of items is reset', null, { duration: 5000 });\r\n        }\r\n      }\r\n      this.items$.next(items);\r\n      this.reordered = false;\r\n    });\r\n  }\r\n\r\n  private fetchHeader() {\r\n    this.contentGroupService.getHeader(this.contentGroup).subscribe(header => {\r\n      this.header$.next(header);\r\n    });\r\n  }\r\n}\r\n","import { Directive, OnDestroy } from '@angular/core';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport { filter, map, pairwise, startWith, Subscription } from 'rxjs';\r\nimport { BaseSubsinkComponent } from '../base-subsink-component/base-subsink.component';\r\n\r\n@Directive()\r\n// tslint:disable-next-line:directive-class-suffix\r\nexport class BaseComponent extends BaseSubsinkComponent implements OnDestroy {\r\n  \r\n  constructor(\r\n    protected router: Router,\r\n    protected route: ActivatedRoute,\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  protected refreshOnChildClosedDeep() {\r\n    return this.router.events.pipe(\r\n      filter(event => event instanceof NavigationEnd),\r\n      startWith(!!this.route.snapshot.firstChild.firstChild),\r\n      map(() => !!this.route.snapshot.firstChild.firstChild),\r\n      pairwise(),\r\n      filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n    )\r\n  }\r\n\r\n  protected refreshOnChildClosedShallow() {\r\n    return this.router.events.pipe(\r\n      filter(event => event instanceof NavigationEnd),\r\n      startWith(!!this.route.snapshot.firstChild),\r\n      map(() => !!this.route.snapshot.firstChild),\r\n      pairwise(),\r\n      filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n    )\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}