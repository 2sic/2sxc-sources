"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fields-f4d799"],{7305:(P,v,s)=>{s.r(v),s.d(v,{EditContentTypeFieldsComponent:()=>ut});var o=s(587),g=s(4382),T=s(1944);const M=(n,l)=>(n.push(l),n);var _=s(6317),N=s(7714),I=s(1203),E=s(2673),b=s(635),p=s(1640),m=s(745),u=s(116),y=s(3853),Z=s(3158);const Y=/^[A-Za-z][A-Za-z0-9]+$/;var L=s(7066),w=s(6386),S=s(3789),A=s(1282),R=s(898);const J={Boolean:{label:"Boolean (yes/no)",description:"Yes/no or true/false values"},Custom:{label:"Custom - ui-tools or custom types",description:"Use for things like gps-pickers (which writes into multiple fields) or for custom-data which serializes something exotic into the db like an array, a custom json or anything"},DateTime:{label:"Date and/or time",description:"For date, time or combined values"},Empty:{label:"Empty - for form-titles etc.",description:"Use to structure your form"},Entity:{label:"Entity (other content-items)",description:"One or more other content-items"},Hyperlink:{label:"Link / file reference",description:"Hyperlink or reference to a picture / file"},Number:{label:"Number",description:"Any kind of number"},String:{label:"Text / string",description:"Any kind of text"}};var t=s(3184),Q=s(5758),k=s(2977),z=s(2528),C=s(6362),H=s(4770),K=s(4683);let V=(()=>{class n{constructor(){this.reservedNames={}}validate(e){if(!e.value)return null;const i=e.value.toLocaleLowerCase(),r=Object.keys(this.reservedNames).find(a=>a.toLocaleLowerCase()===i);return r?{reservedNames:this.reservedNames[r]}:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=t.lG2({type:n,selectors:[["","appReservedNames",""]],inputs:{reservedNames:["appReservedNames","reservedNames"]},features:[t._Bn([{provide:o.Cf,useExisting:n,multi:!0}])]}),n})();var G=s(8352),U=s(1434),W=s(5590),X=s(1130),q=s(7317);const tt=["ngForm"];function et(n,l){1&n&&(t.ynx(0),t._uU(1,"Fields"),t.BQk())}function nt(n,l){1&n&&(t.ynx(0),t._uU(1,"Add Fields"),t.BQk())}function it(n,l){1&n&&(t.ynx(0),t._uU(1,"Edit Field"),t.BQk())}function ot(n,l){if(1&n&&(t.TgZ(0,"app-field-hint",22),t._uU(1),t.qZA()),2&n){const e=t.oxw(4);t.Q6J("isError",!0),t.xp6(1),t.Oqu(e.fieldNameError)}}function st(n,l){if(1&n&&(t.TgZ(0,"app-field-hint",22),t._uU(1),t.qZA()),2&n){t.oxw(2);const e=t.MAs(6);t.Q6J("isError",!0),t.xp6(1),t.hij(" ",e.errors.reservedNames," ")}}function at(n,l){if(1&n&&(t.ynx(0),t.YNc(1,ot,2,2,"app-field-hint",21),t.YNc(2,st,2,2,"app-field-hint",21),t.BQk()),2&n){t.oxw();const e=t.MAs(6);t.xp6(1),t.Q6J("ngIf",e.errors.pattern),t.xp6(1),t.Q6J("ngIf",e.errors.reservedNames)}}function lt(n,l){if(1&n&&(t.TgZ(0,"mat-option",23),t._UZ(1,"mat-icon",17),t.TgZ(2,"span"),t._uU(3),t.qZA()()),2&n){const e=l.$implicit;t.Q6J("value",e.name),t.xp6(1),t.Q6J("svgIcon",e.icon),t.xp6(2),t.Oqu(e.label)}}function rt(n,l){if(1&n&&t._UZ(0,"mat-icon",19),2&n){const e=t.oxw().$implicit;t.Q6J("svgIcon",e.icon)}}const ct=function(n){return{"input-obsolete":n}};function pt(n,l){if(1&n&&(t.TgZ(0,"mat-option",24)(1,"span"),t._uU(2),t.qZA(),t.YNc(3,rt,1,1,"mat-icon",25),t.qZA()),2&n){const e=l.$implicit;t.Q6J("value",e.inputType)("ngClass",t.VKq(4,ct,e.isObsolete)),t.xp6(2),t.Oqu(e.label),t.xp6(1),t.Q6J("ngIf",e.icon)}}function dt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",11)(1,"div",12)(2,"mat-form-field",13)(3,"mat-label"),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"input",14,15),t.NdJ("ngModelChange",function(r){return t.CHM(e).$implicit.StaticName=r}),t.qZA()(),t.YNc(7,at,3,2,"ng-container",2),t.qZA(),t.TgZ(8,"div",12)(9,"mat-form-field",13)(10,"mat-label"),t._uU(11,"Data Type"),t.qZA(),t.TgZ(12,"mat-select",16),t.NdJ("selectionChange",function(){const a=t.CHM(e).index,c=t.oxw(2);return c.filterInputTypeOptions(a),c.resetInputType(a),c.calculateHints(a)})("ngModelChange",function(r){return t.CHM(e).$implicit.Type=r}),t.TgZ(13,"mat-select-trigger"),t._UZ(14,"mat-icon",17),t.TgZ(15,"span"),t._uU(16),t.qZA()(),t.YNc(17,lt,4,3,"mat-option",18),t.qZA()(),t.TgZ(18,"app-field-hint"),t._uU(19),t.qZA()(),t.TgZ(20,"div",12)(21,"mat-form-field",13)(22,"mat-label"),t._uU(23,"Input Type"),t.qZA(),t.TgZ(24,"mat-select",16),t.NdJ("selectionChange",function(){const a=t.CHM(e).index;return t.oxw(2).calculateHints(a)})("ngModelChange",function(r){return t.CHM(e).$implicit.InputType=r}),t.TgZ(25,"mat-select-trigger")(26,"span"),t._uU(27),t.qZA(),t._UZ(28,"mat-icon",19),t.qZA(),t.YNc(29,pt,4,6,"mat-option",20),t.qZA()(),t.TgZ(30,"app-field-hint"),t._uU(31),t.qZA()()()}if(2&n){const e=l.$implicit,i=l.index,r=t.MAs(6),a=t.oxw(2);let c,f;t.xp6(5),t.Q6J("pattern",a.fieldNamePattern)("appReservedNames",a.reservedNames)("ngModel",e.StaticName)("name","StaticName"+i)("disabled","inputType"===a.editMode),t.xp6(2),t.Q6J("ngIf",r.touched&&r.errors),t.xp6(5),t.Q6J("ngModel",e.Type)("name","Type"+i)("disabled",null!=a.editMode),t.xp6(2),t.Q6J("svgIcon",a.findIcon(e.Type)),t.xp6(2),t.Oqu(e.Type),t.xp6(1),t.Q6J("ngForOf",a.dataTypes),t.xp6(2),t.Oqu(a.dataTypeHints[i]),t.xp6(5),t.Q6J("ngModel",e.InputType)("name","InputType"+i)("disabled","name"===a.editMode),t.xp6(3),t.Oqu(null==(c=a.getInputTypeOption(e.InputType))?null:c.label),t.xp6(1),t.Q6J("svgIcon",null==(f=a.getInputTypeOption(e.InputType))?null:f.icon),t.xp6(1),t.Q6J("ngForOf",a.filteredInputTypeOptions[i]),t.xp6(2),t.Oqu(a.inputTypeHints[i])}}function mt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"form",4,5),t.NdJ("ngSubmit",function(){return t.CHM(e),t.oxw().save()}),t.TgZ(2,"div",6),t.YNc(3,dt,32,20,"div",7),t.qZA(),t.TgZ(4,"div",8)(5,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeDialog()}),t._uU(6,"Cancel"),t.qZA(),t.TgZ(7,"button",10),t.ALo(8,"async"),t._uU(9," Save "),t.qZA()()()}if(2&n){const e=t.MAs(1),i=t.oxw();t.xp6(3),t.Q6J("ngForOf",i.fields),t.xp6(4),t.Q6J("disabled",!e.form.valid||t.lcZ(8,2,i.saving$))}}let ut=(()=>{class n{constructor(e,i,r,a,c){this.dialogRef=e,this.route=i,this.contentTypesService=r,this.contentTypesFieldsService=a,this.snackBar=c,this.hostClass="dialog-component",this.fields=[],this.filteredInputTypeOptions=[],this.dataTypeHints=[],this.inputTypeHints=[],this.fieldNamePattern=Y,this.fieldNameError="Standard letters and numbers are allowed. Must start with a letter.",this.findIcon=A.x,this.loading$=new _.X(!0),this.saving$=new _.X(!1),this.subscription=new N.w0,this.dialogRef.disableClose=!0,this.subscription.add(this.dialogRef.backdropClick().subscribe(f=>{this.form.dirty&&!confirm("You have unsaved changes. Are you sure you want to close this dialog?")||this.closeDialog()}))}ngOnInit(){this.editMode=this.route.snapshot.paramMap.get("editMode");const e=this.route.snapshot.paramMap.get("contentTypeStaticName"),i=this.contentTypesService.retrieveContentType(e).pipe((0,I.B)()),r=i.pipe((0,E.w)(h=>this.contentTypesFieldsService.getFields(h.StaticName))),a=this.contentTypesFieldsService.typeListRetrieve().pipe((0,b.U)(h=>function j(n){const l=[];for(const e of n)l.push({name:e,label:J[e].label,icon:(0,A.x)(e),description:J[e].description});return l}(h))),c=this.contentTypesFieldsService.getInputTypesList(),f=this.contentTypesFieldsService.getReservedNames();(0,p.D)([i,r,a,c,f]).subscribe(([h,x,ft,gt,ht])=>{this.contentType=h,this.dataTypes=ft,this.inputTypeOptions=gt;const $={};if(x.forEach(d=>{$[d.StaticName]="Field with this name already exists"}),this.reservedNames=Object.assign(Object.assign({},ht),$),null!=this.editMode){const d=this.route.snapshot.paramMap.get("id")?parseInt(this.route.snapshot.paramMap.get("id"),10):null,D=x.find(Tt=>Tt.Id===d);"name"===this.editMode&&delete this.reservedNames[D.StaticName],this.fields.push(D)}else for(let d=1;d<=8;d++)this.fields.push({Id:0,Type:w.Q.String,InputType:S.v.StringDefault,StaticName:"",IsTitle:0===x.length,SortOrder:x.length+d});for(let d=0;d<this.fields.length;d++)this.filterInputTypeOptions(d),this.calculateHints(d);this.loading$.next(!1)})}ngOnDestroy(){this.loading$.complete(),this.saving$.complete(),this.subscription.unsubscribe()}closeDialog(){this.dialogRef.close()}filterInputTypeOptions(e){this.filteredInputTypeOptions[e]=this.inputTypeOptions.filter(i=>i.dataType===this.fields[e].Type.toLocaleLowerCase())}resetInputType(e){let i=this.fields[e].Type.toLocaleLowerCase()+S.v.DefaultSuffix;this.filteredInputTypeOptions[e].some(a=>a.inputType===i)||(i=this.filteredInputTypeOptions[e][0].inputType),this.fields[e].InputType=i}calculateHints(e){var i,r;const a=this.dataTypes.find(f=>f.name===this.fields[e].Type),c=this.inputTypeOptions.find(f=>f.inputType===this.fields[e].InputType);this.dataTypeHints[e]=null!==(i=null==a?void 0:a.description)&&void 0!==i?i:"",this.inputTypeHints[e]=(null==c?void 0:c.isObsolete)?`OBSOLETE - ${c.obsoleteMessage}`:null!==(r=null==c?void 0:c.description)&&void 0!==r?r:""}getInputTypeOption(e){return this.inputTypeOptions.find(i=>i.inputType===e)}save(){if(this.saving$.next(!0),this.snackBar.open("Saving..."),null!=this.editMode){const e=this.fields[0];"name"===this.editMode?this.contentTypesFieldsService.rename(e.Id,this.contentType.Id,e.StaticName).subscribe(()=>{this.saving$.next(!1),this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()}):"inputType"===this.editMode&&this.contentTypesFieldsService.updateInputType(e.Id,e.StaticName,e.InputType).subscribe(()=>{this.saving$.next(!1),this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()})}else(0,m.of)(...this.fields).pipe((0,u.h)(e=>!!e.StaticName),(0,y.b)(e=>this.contentTypesFieldsService.add(e,this.contentType.Id).pipe((0,Z.K)(i=>(0,m.of)(null)))),function O(){return(0,T.e)((n,l)=>{(function F(n,l){return(0,T.e)((0,g.U)(n,l,arguments.length>=2,!1,!0))})(M,[])(n).subscribe(l)})}()).subscribe(e=>{this.saving$.next(!1),this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Q.so),t.Y36(k.gz),t.Y36(L.s),t.Y36(R.Mr),t.Y36(z.ux))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-edit-content-type-fields"]],viewQuery:function(e,i){if(1&e&&t.Gf(tt,5,o.F),2&e){let r;t.iGM(r=t.CRH())&&(i.form=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&t.Ikx("className",i.hostClass)},decls:7,vars:6,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["class","dialog-form custom-svg-styles",3,"ngSubmit",4,"ngIf"],[1,"dialog-form","custom-svg-styles",3,"ngSubmit"],["ngForm","ngForm"],[1,"dialog-form-content","fancy-scrollbar-light"],["class","row-container",4,"ngFor","ngForOf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","submit","color","accent",3,"disabled"],[1,"row-container"],[1,"edit-input"],["appearance","standard","color","accent"],["matInput","",3,"pattern","appReservedNames","ngModel","name","disabled","ngModelChange"],["staticName","ngModel"],[3,"ngModel","name","disabled","selectionChange","ngModelChange"],[1,"type-icon",3,"svgIcon"],[3,"value",4,"ngFor","ngForOf"],[1,"input-icon",3,"svgIcon"],[3,"value","ngClass",4,"ngFor","ngForOf"],[3,"isError",4,"ngIf"],[3,"isError"],[3,"value"],[3,"value","ngClass"],["class","input-icon",3,"svgIcon",4,"ngIf"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,et,2,0,"ng-container",2),t.YNc(3,nt,2,0,"ng-container",2),t.YNc(4,it,2,0,"ng-container",2),t.qZA()(),t.YNc(5,mt,10,4,"form",3),t.ALo(6,"async")),2&e&&(t.xp6(2),t.Q6J("ngIf",void 0===i.editMode),t.xp6(1),t.Q6J("ngIf",null===i.editMode),t.xp6(1),t.Q6J("ngIf",null!=i.editMode),t.xp6(1),t.Q6J("ngIf",!1===t.lcZ(6,4,i.loading$)))},directives:[Q.uh,C.O5,o._Y,o.JL,o.F,C.sg,H.KE,H.hX,K.Nt,o.Fj,o.c5,V,o.JJ,o.On,G.Y,U.gD,U.$L,W.Hw,X.ey,C.mk,q.lW],pipes:[C.Ov],styles:[".row-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.edit-input[_ngcontent-%COMP%]{padding-bottom:8px;width:30%}.type-icon[_ngcontent-%COMP%]{margin-right:6px;font-size:inherit;vertical-align:middle;line-height:inherit}.input-icon[_ngcontent-%COMP%]{margin-left:6px;font-size:inherit;vertical-align:middle;line-height:inherit}[_nghost-%COMP%]     .custom-svg-styles .type-icon svg, [_nghost-%COMP%]     .custom-svg-styles .input-icon svg{transform:scale(.75)}.input-obsolete[_ngcontent-%COMP%]{-webkit-text-decoration:black line-through;text-decoration:black line-through;color:#696969}"]}),n})()},8352:(P,v,s)=>{s.d(v,{Y:()=>b});var o=s(3184),g=s(6362),T=s(4770);function F(p,m){1&p&&o.GkF(0)}function M(p,m){if(1&p&&(o.TgZ(0,"mat-hint"),o.YNc(1,F,1,0,"ng-container",3),o.qZA()),2&p){o.oxw();const u=o.MAs(4);o.xp6(1),o.Q6J("ngTemplateOutlet",u)}}function O(p,m){1&p&&o.GkF(0)}function _(p,m){if(1&p&&(o.TgZ(0,"mat-error"),o.YNc(1,O,1,0,"ng-container",3),o.qZA()),2&p){o.oxw();const u=o.MAs(4);o.xp6(1),o.Q6J("ngTemplateOutlet",u)}}function N(p,m){1&p&&o.Hsn(0)}const I=function(p){return{"hint-box__short":p}},E=["*"];let b=(()=>{class p{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=o.Xpm({type:p,selectors:[["app-field-hint"]],inputs:{isError:"isError"},ngContentSelectors:E,decls:5,vars:6,consts:[[1,"hint-box",3,"ngClass","ngSwitch","click"],[4,"ngSwitchCase"],["content",""],[4,"ngTemplateOutlet"]],template:function(u,y){1&u&&(o.F$t(),o.TgZ(0,"div",0),o.NdJ("click",function(){return y.toggleIsShort()}),o.YNc(1,M,2,1,"mat-hint",1),o.YNc(2,_,2,1,"mat-error",1),o.qZA(),o.YNc(3,N,1,0,"ng-template",null,2,o.W1O)),2&u&&(o.Q6J("ngClass",o.VKq(4,I,y.isShort))("ngSwitch",y.isError),o.xp6(1),o.Q6J("ngSwitchCase",!1),o.xp6(1),o.Q6J("ngSwitchCase",!0))},directives:[g.mk,g.RF,g.n9,T.bx,g.tP,T.TO],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}),p})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/14.10.00/ng-edit/projects_eav-ui_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fields-f4d799.d31518fe1eee9488.js.map