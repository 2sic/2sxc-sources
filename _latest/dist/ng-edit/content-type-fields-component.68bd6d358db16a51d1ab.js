(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{u8xq:function(e,t,i){"use strict";i.r(t);var n=i("D57K"),o=i("5/c3"),s=i("LiEJ"),r=i("LR82"),a=i("cQOC"),c=i("fa4O"),l=i("4HYP"),p=i("z5yO"),d=i("W/Ou"),u=i("Jg5f"),h=i("QagP"),f=i("KLQV"),b=i("o9tz"),m=i("ZHmz"),g=i("1C3z"),y=i("OeRG"),v=i("Qc/f"),T=i("r4gC"),w=function(){function e(){}return e.prototype.agInit=function(e){this.icon=e.value?"star":"star_border"},e.prototype.refresh=function(e){return!0},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=g.Jb({type:e,selectors:[["app-content-type-fields-title"]],decls:4,vars:1,consts:[[1,"actions-component"],["matRipple","","matTooltip","Use as title field",1,"like-button","highlight"]],template:function(e,t){1&e&&(g.Vb(0,"div",0),g.Vb(1,"div",1),g.Vb(2,"mat-icon"),g.Oc(3),g.Ub(),g.Ub(),g.Ub()),2&e&&(g.Bb(3),g.Pc(t.icon))},directives:[y.q,v.a,T.a],styles:[""],changeDetection:0}),e}(),C=function(){function e(){}return e.prototype.agInit=function(e){this.value=e.value},e.prototype.refresh=function(e){return!0},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=g.Jb({type:e,selectors:[["app-content-type-fields-input-type"]],decls:6,vars:1,consts:[["matRipple","",1,"input-component","highlight"],[1,"text"],[1,"like-button"]],template:function(e,t){1&e&&(g.Vb(0,"div",0),g.Vb(1,"div",1),g.Oc(2),g.Ub(),g.Vb(3,"div",2),g.Vb(4,"mat-icon"),g.Oc(5,"arrow_drop_down"),g.Ub(),g.Ub(),g.Ub()),2&e&&(g.Bb(2),g.Pc(t.value))},directives:[y.q,T.a],styles:[""],changeDetection:0}),e}(),D=i("nsG0"),O=i("DGvA"),S=i("8AiQ");function k(e,t){if(1&e){var i=g.Wb();g.Vb(0,"div",5),g.dc("click",(function(){return g.Dc(i),g.hc().delete()})),g.Vb(1,"mat-icon"),g.Oc(2,"delete"),g.Ub(),g.Ub()}}function I(e,t){1&e&&(g.Vb(0,"div",6),g.Vb(1,"mat-icon"),g.Oc(2,"delete"),g.Ub(),g.Ub())}function F(e,t){if(1&e){var i=g.Wb();g.Vb(0,"div",7),g.dc("click",(function(){return g.Dc(i),g.hc().openPermissions()})),g.Vb(1,"mat-icon"),g.Oc(2,"person"),g.Ub(),g.Ub()}}var R=function(){function e(){}return e.prototype.agInit=function(e){this.params=e,this.field=this.params.data,this.showPermissions=this.field.InputType===D.a.StringWysiwyg||this.field.Type===O.a.Hyperlink},e.prototype.refresh=function(e){return!0},e.prototype.rename=function(){this.params.onRename(this.field)},e.prototype.delete=function(){this.params.onDelete(this.field)},e.prototype.openPermissions=function(){this.params.onOpenPermissions(this.field)},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=g.Jb({type:e,selectors:[["app-content-type-fields-actions"]],decls:7,vars:3,consts:[[1,"actions-component"],["matRipple","","matTooltip","Rename",1,"like-button","highlight",3,"click"],["class","like-button highlight","matRipple","","matTooltip","Delete",3,"click",4,"ngIf"],["class","like-button disabled",4,"ngIf"],["class","like-button highlight","matRipple","","matTooltip","Permissions",3,"click",4,"ngIf"],["matRipple","","matTooltip","Delete",1,"like-button","highlight",3,"click"],[1,"like-button","disabled"],["matRipple","","matTooltip","Permissions",1,"like-button","highlight",3,"click"]],template:function(e,t){1&e&&(g.Vb(0,"div",0),g.Vb(1,"div",1),g.dc("click",(function(){return t.rename()})),g.Vb(2,"mat-icon"),g.Oc(3,"settings"),g.Ub(),g.Ub(),g.Mc(4,k,3,0,"div",2),g.Mc(5,I,3,0,"div",3),g.Mc(6,F,3,0,"div",4),g.Ub()),2&e&&(g.Bb(4),g.nc("ngIf",!t.field.IsTitle),g.Bb(1),g.nc("ngIf",t.field.IsTitle),g.Bb(1),g.nc("ngIf",t.showPermissions))},directives:[y.q,v.a,T.a,S.m],styles:[""],changeDetection:0}),e}(),V=i("DOM6"),U=function(){function e(){}return e.prototype.agInit=function(e){this.value=e.value,this.icon=Object(V.a)(this.value)},e.prototype.refresh=function(e){return!0},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=g.Jb({type:e,selectors:[["app-content-type-fields-type"]],decls:3,vars:2,consts:[[1,"icon-container",3,"matTooltip"]],template:function(e,t){1&e&&(g.Vb(0,"div",0),g.Vb(1,"mat-icon"),g.Oc(2),g.Ub(),g.Ub()),2&e&&(g.nc("matTooltip",t.value),g.Bb(2),g.Pc(t.icon))},directives:[v.a,T.a],styles:[""],changeDetection:0}),e}(),N=i("QjRa"),A=i("uuTa"),P=i("BLjT"),j=i("S36y"),x=i("/Foi"),M=i("2pW/"),$=i("9HSk"),B=i("G6Ml");i.d(t,"ContentTypeFieldsComponent",(function(){return E}));var E=function(){function e(e,t,i,o,a,c){this.dialogRef=e,this.route=t,this.router=i,this.contentTypesService=o,this.contentTypesFieldsService=a,this.snackBar=c,this.contentType$=new s.a(null),this.fields$=new s.a(null),this.modules=f.a,this.gridOptions=Object(n.a)(Object(n.a)({},N.a),{getRowClass:function(e){return e.data.InputType===D.a.EmptyDefault?"group-row":""},frameworkComponents:{contentTypeFieldsTitleComponent:w,contentTypeFieldsTypeComponent:U,contentTypeFieldsInputTypeComponent:C,contentTypeFieldsActionsComponent:R},columnDefs:[{rowDrag:!0,width:18,cellClass:"no-select no-padding no-outline"},{headerName:"Title",field:"IsTitle",width:42,cellClass:"secondary-action no-padding no-outline",cellRenderer:"contentTypeFieldsTitleComponent",onCellClicked:this.setTitle.bind(this)},{headerName:"Name",field:"StaticName",flex:2,minWidth:250,cellClass:"primary-action highlight",sortable:!0,filter:"agTextColumnFilter",onCellClicked:this.editFieldMetadata.bind(this)},{headerName:"Type",field:"Type",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",cellRenderer:"contentTypeFieldsTypeComponent"},{headerName:"Input",field:"InputType",width:160,cellClass:"secondary-action no-padding",sortable:!0,filter:"agTextColumnFilter",cellRenderer:"contentTypeFieldsInputTypeComponent",onCellClicked:this.changeInputType.bind(this),valueGetter:this.inputTypeValueGetter},{width:120,cellClass:"secondary-action no-padding",cellRenderer:"contentTypeFieldsActionsComponent",cellRendererParams:{onRename:this.rename.bind(this),onDelete:this.delete.bind(this),onOpenPermissions:this.openPermissions.bind(this)}},{headerName:"Label",field:"Metadata.All.Name",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter"},{headerName:"Notes",field:"Metadata.All.Notes",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter"}]}),this.sortApplied=!1,this.filterApplied=!1,this.rowDragSuppressed=!1,this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName"),this.subscription=new r.a}return e.prototype.ngOnInit=function(){this.fetchFields(),this.refreshOnChildClosed()},e.prototype.ngOnDestroy=function(){this.contentType$.complete(),this.fields$.complete(),this.subscription.unsubscribe()},e.prototype.onGridReady=function(e){this.gridApi=e.api},e.prototype.onRowDragEnter=function(e){this.gridApi.setEnableCellTextSelection(!1)},e.prototype.onRowDragEnd=function(e){var t=this;this.gridApi.setSuppressRowDrag(!0);var i=this.fields$.value.map((function(e){return e.Id}));this.contentTypesFieldsService.reOrder(i,this.contentType$.value).subscribe((function(e){t.fetchFields((function(){t.gridApi.setEnableCellTextSelection(!0),t.gridApi.setSuppressRowDrag(!1)}))}))},e.prototype.onRowDragMove=function(e){var t=e.node,i=e.overNode;if(i&&t!==i){var o=t.data,s=i.data,r=Object(n.g)(this.fields$.value),a=r.indexOf(o),c=r.indexOf(s);this.moveInArray(r,a,c),this.fields$.next(r),this.gridApi.clearFocusedCell()}},e.prototype.moveInArray=function(e,t,i){var n=e[t];e.splice(t,1),e.splice(i,0,n)},e.prototype.onSortChanged=function(e){var t=this.gridApi.getSortModel();this.sortApplied=t.length>0,this.suppressRowDrag()},e.prototype.onFilterChanged=function(e){var t=this.gridApi.getFilterModel(),i=Object.keys(t);this.filterApplied=i.length>0,this.suppressRowDrag()},e.prototype.suppressRowDrag=function(){var e=this.sortApplied||this.filterApplied;e&&!this.rowDragSuppressed?(this.rowDragSuppressed=!0,this.gridApi.setSuppressRowDrag(!0)):!e&&this.rowDragSuppressed&&(this.rowDragSuppressed=!1,this.gridApi.setSuppressRowDrag(!1))},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.add=function(){this.router.navigate(["add/"+this.contentTypeStaticName],{relativeTo:this.route})},e.prototype.inputTypeValueGetter=function(e){var t=e.data;return t.InputType.substring(t.InputType.indexOf("-")+1)},e.prototype.fetchFields=function(e){var t=this;if(null==this.contentType$.value){var i=this.contentTypesService.retrieveContentType(this.contentTypeStaticName).pipe(Object(c.a)()),o=i.pipe(Object(l.a)((function(e){return t.contentTypesFieldsService.getFields(e)})));Object(a.a)([i,o]).subscribe((function(i){var o=Object(n.f)(i,2),s=o[1];t.contentType$.next(o[0]),t.fields$.next(s),null!=e&&e()}))}else this.contentTypesFieldsService.getFields(this.contentType$.value).subscribe((function(i){t.fields$.next(i),null!=e&&e()}))},e.prototype.editFieldMetadata=function(e){var t=e.data,i={items:[this.createItemDefinition(t,"All"),this.createItemDefinition(t,t.Type),this.createItemDefinition(t,t.InputType)]},n=Object(A.a)(i);this.router.navigate(["edit/"+n],{relativeTo:this.route})},e.prototype.createItemDefinition=function(e,t){return null!=e.Metadata[t]?{EntityId:e.Metadata[t].Id}:{ContentTypeName:"@"+t,For:{Target:b.a.metadata.attribute.target,Number:e.Id},Prefill:{Name:e.StaticName}}},e.prototype.setTitle=function(e){var t=this,i=e.data;this.snackBar.open("Setting title..."),this.contentTypesFieldsService.setTitle(i,this.contentType$.value).subscribe((function(){t.snackBar.open("Title set",null,{duration:2e3}),t.fetchFields()}))},e.prototype.changeInputType=function(e){this.router.navigate(["update/"+this.contentTypeStaticName+"/"+e.data.Id],{relativeTo:this.route})},e.prototype.rename=function(e){var t=this,i=prompt("What new name would you like for '"+e.StaticName+"' ("+e.Id+")?",e.StaticName);if(null!==i&&(i=i.trim().replace(/\s\s+/g," "))!==e.StaticName){for(;!i.match(m.b);){if(null===(i=prompt("What new name would you like for '"+e.StaticName+"' ("+e.Id+")?\n"+m.a,i)))return;if((i=i.trim().replace(/\s\s+/g," "))===e.StaticName)return}this.snackBar.open("Saving..."),this.contentTypesFieldsService.rename(e,this.contentType$.value,i).subscribe((function(){t.snackBar.open("Saved",null,{duration:2e3}),t.fetchFields()}))}},e.prototype.delete=function(e){var t=this;confirm("Are you sure you want to delete '"+e.StaticName+"' ("+e.Id+")?")&&(this.snackBar.open("Deleting..."),this.contentTypesFieldsService.delete(e,this.contentType$.value).subscribe((function(e){t.snackBar.open("Deleted",null,{duration:2e3}),t.fetchFields()})))},e.prototype.openPermissions=function(e){this.router.navigate(["permissions/"+b.a.metadata.attribute.type+"/"+b.a.keyTypes.number+"/"+e.Id],{relativeTo:this.route})},e.prototype.refreshOnChildClosed=function(){var e=this;this.subscription.add(this.router.events.pipe(Object(p.a)((function(e){return e instanceof o.b})),Object(d.a)(!!this.route.snapshot.firstChild),Object(u.a)((function(){return!!e.route.snapshot.firstChild})),Object(h.a)(),Object(p.a)((function(e){var t=Object(n.f)(e,2);return t[0]&&!t[1]}))).subscribe((function(){e.fetchFields()})))},e.\u0275fac=function(t){return new(t||e)(g.Pb(P.g),g.Pb(o.a),g.Pb(o.c),g.Pb(j.a),g.Pb(x.a),g.Pb(M.b))},e.\u0275cmp=g.Jb({type:e,selectors:[["app-content-type-fields"]],decls:16,vars:8,consts:[[1,"nav-component-wrapper"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","matTooltip","Close dialog",3,"click"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","modules","gridOptions","rowDragEnter","rowDragEnd","rowDragMove","gridReady","sortChanged","filterChanged"],["mat-fab","","mat-elevation-z24","","matTooltip","Add fields",1,"grid-fab",3,"click"]],template:function(e,t){var i;1&e&&(g.Vb(0,"div",0),g.Vb(1,"div",1),g.Vb(2,"div",2),g.Vb(3,"div"),g.Oc(4),g.ic(5,"async"),g.Ub(),g.Vb(6,"button",3),g.dc("click",(function(){return t.closeDialog()})),g.Vb(7,"mat-icon"),g.Oc(8,"close"),g.Ub(),g.Ub(),g.Ub(),g.Ub(),g.Qb(9,"router-outlet"),g.Vb(10,"div",4),g.Vb(11,"ag-grid-angular",5),g.dc("rowDragEnter",(function(e){return t.onRowDragEnter(e)}))("rowDragEnd",(function(e){return t.onRowDragEnd(e)}))("rowDragMove",(function(e){return t.onRowDragMove(e)}))("gridReady",(function(e){return t.onGridReady(e)}))("sortChanged",(function(e){return t.onSortChanged(e)}))("filterChanged",(function(e){return t.onFilterChanged(e)})),g.ic(12,"async"),g.Ub(),g.Vb(13,"button",6),g.dc("click",(function(){return t.add()})),g.Vb(14,"mat-icon"),g.Oc(15,"add"),g.Ub(),g.Ub(),g.Ub(),g.Ub()),2&e&&(g.Bb(4),g.Qc("",null==(i=g.jc(5,4,t.contentType$))?null:i.Name," Fields"),g.Bb(7),g.nc("rowData",g.jc(12,6,t.fields$))("modules",t.modules)("gridOptions",t.gridOptions))},directives:[P.h,$.a,v.a,T.a,o.e,B.a],pipes:[S.b],styles:[""]}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/11.05.01/ng-edit/content-type-fields-component.68bd6d358db16a51d1ab.js.map