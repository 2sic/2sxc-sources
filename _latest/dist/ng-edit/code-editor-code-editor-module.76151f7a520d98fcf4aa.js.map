{"version":3,"sources":["../edit/eav-material-controls/adam/sanitize.service.ts","./src/app/content-type-fields/services/content-types-fields.service.ts","./src/app/app-administration/services/content-types.service.ts","./src/app/code-editor/ace-editor/ace-options.ts","./src/app/code-editor/ace-editor/ace-editor.component.ts","./src/app/shared/services/snack-bar-stack.service.ts","./src/app/code-editor/services/source.service.ts","./src/app/code-editor/services/snippets.service.ts","./src/app/code-editor/code-templates/order-items.pipe.ts","./src/app/code-editor/code-templates/depth-padding.pipe.ts","./src/app/code-editor/code-templates/code-templates.component.html","./src/app/code-editor/code-templates/code-templates.component.ts","./src/app/code-editor/code-templates/code-templates.helpers.ts","./src/app/code-editor/code-snippets/code-snippets.helpers.ts","./src/app/code-editor/code-snippets/object-to-array.pipe.ts","./src/app/code-editor/code-snippets/code-snippets.component.html","./src/app/code-editor/code-snippets/code-snippets.component.ts","./src/app/code-editor/code-editor.component.html","./src/app/code-editor/code-editor.component.ts","./src/app/code-editor/code-editor-routing.module.ts","./src/app/code-editor/code-editor.module.ts"],"names":["cleanBadPath","sanitized","goodChar","replace","removeFromStart","charToRemove","substring","removeFromEnd","length","sanitizePath","this","sanitizeName","SanitizeService","webApiFieldsAll","webApiFieldsRoot","http","context","dnnContext","apiUrl","name","$2sxc","typeListRetrieve","get","params","appid","appId","toString","getInputTypesList","pipe","inputConfigs","map","config","dataType","Type","indexOf","inputType","label","Label","description","Description","getFields","contentType","staticName","StaticName","fields","fld","Metadata","md","allMd","All","typeMd","inputMd","InputType","merged","reOrder","idArray","post","contentTypeId","Id","order","JSON","stringify","setTitle","item","attributeId","rename","newName","delete","IsTitle","Error","add","newField","AppId","ContentTypeId","Index","SortOrder","updateInputType","id","field","ContentTypesFieldsService","webApiTypeRoot","retrieveContentType","retrieveContentTypes","scope","getScopes","scopes","Object","keys","key","value","save","import","files","formData","FormData","append","zoneId","createGhost","sourceStaticName","ContentTypesService","aceOptions","mode","wrap","useSoftTabs","theme","fontSize","fontFamily","showGutter","enableBasicAutocompletion","enableLiveAutocompletion","enableSnippets","zone","propagateChange","propagateTouched","ngOnInit","test","src","aceLoaded","bind","ngOnChanges","changes","filename","currentValue","snippets","updateValues","editor","toggleResize","previousValue","runOutsideAngular","setTimeout","resize","insertSnippet","snippet","ace","require","snippetManager","focus","writeValue","p","getCursorPosition","setValue","moveCursorToPosition","registerOnChange","fn","registerOnTouched","ngOnDestroy","destroy","container","remove","set","edit","editorRef","nativeElement","$blockScrolling","Infinity","session","on","onEditorValueChange","onEditorBlurred","run","getValue","getModeForPath","setMode","register","AceEditorComponent","provide","useExisting","multi","snackBar","defaultDuration","processingMessage","messageQueue","message","action","duration","triggered$","Subject","push","showSnackBar","asObservable","nextMsg","shift","snackBarRef","open","afterDismissed","subscribe","complete","onAction","next","SnackBarStackService","templateIdOrPath","view","toLowerCase","Extension","getTemplates","global","withSubfolders","createTemplate","path","templateId","SourceService","translate","keyPrefixes","keyPrefixIndex","getSnippets","toPromise","res","relevant","filterAwayNotNeededSnippetsList","standAndInputSnips","extractInputTypeSnippets","sets","initSnippetsWithConfig","standardArray","inputTypeSnippets","list","newList","itm","setHasPrefix","substr","inputTypeArray","catalogInputTypeSnippets","inputTypeList","undefined","subset","templateConfiguration","makeTree","Content","assign","Fields","PresentationFields","TypeContent","loadContentType","TypeContentPresentation","HasList","List","TypeList","TypeListPresentation","HasApp","App","Resources","Settings","tree","o","reformatted","snip","content","help","links","linksList","getHelpKey","result","instant","addition","linksString","llist","split","pair","trim","url","target","type","prefix","then","fieldname","valuePlaceholder","Notes","snipDefaults","cloneDeep","attachSnippets","std","i","obj","val","filter","Empty","genericSnippet","fieldType","typeSnips","concat","more","fieldSnips","g","localizeGenericSnippet","collapse","objName","fieldName","SnippetsService","transform","items","sort","item1","item2","isFolder","SortItemsPipe","sanitizer","depth","bypassSecurityTrustStyle","DepthPaddingPipe","dialogService","toggledItems","templates","paths","last","pathFromRoot","existing","find","children","calculateTree","showFileInTree","FileName","openTemplate","openCodeFile","toggleItem","array","index","splice","addFile","folder","emit","file","includes","CodeTemplatesComponent","ObjectToArrayPipe","toggledSections","toggledFolders","toggledInfos","toggledMores","addSnippet","toggleSection","toggleFolder","toggleInfo","info","toggleMore","CodeSnippetsComponent","routes","component","route","snackBarStack","sourceService","snippetsService","titleService","sanitizeService","explorer","activeExplorer","view$","BehaviorSubject","templates$","explorerSnipps$","editorSnipps$","templateVars$","combineLatest","explorerSnipps","editorSnipps","subscription","Subscription","init","calculateViewKey","attachListeners","viewKey","forkJoin","savedCode","Code","showCodeAndEditionWarnings","unsubscribe","toggleExplorer","question","suggestion","startsWith","prompt","changeInsertSnipp","aceEditorRef","codeChanged","code","codeToSave","error","itemsRaw","sessionStorage","getItem","parse","EntityId","Path","pathAndName","pathSeparator","lastIndexOf","pathWithSlash","fullName","nameCode","codeFile","otherEditions","endsWith","window","fromEvent","event","preventDefault","returnValue","keyCode","navigator","platform","match","metaKey","ctrlKey","CodeEditorComponent","CodeEditorRoutingModule","forChild","translateLoaderFactory","sxcVersion","CodeEditorModule","loader","useFactory","deps","defaultLanguage","isolate"],"mappings":"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","file":"code-editor-code-editor-module.76151f7a520d98fcf4aa.js","sourcesContent":["import { Injectable } from '@angular/core';\r\n\r\n@Injectable()\r\nexport class SanitizeService {\r\n\r\n  constructor() { }\r\n\r\n  private removeFromStart(sanitized: string, charToRemove: string) {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    while (sanitized.substring(0, 1) === charToRemove) {\r\n      sanitized = sanitized.substring(1);\r\n    }\r\n    return sanitized;\r\n  }\r\n\r\n  private removeFromEnd(sanitized: string, charToRemove: string) {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    while (sanitized.substring(sanitized.length - 1, sanitized.length) === charToRemove) {\r\n      sanitized = sanitized.substring(0, sanitized.length - 1);\r\n    }\r\n    return sanitized;\r\n  }\r\n\r\n  private cleanBadPath = (sanitized: string) => {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    const goodChar = '_';\r\n    const illegalRe = /[\\?<>\\\\:\\*\\|\":]/g;\r\n    const controlRe = /[\\x00-\\x1f\\x80-\\x9f]/g;\r\n    const reservedRe = /^\\.+$/;\r\n    const windowsReservedRe = /^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\\..*)?$/i;\r\n    const windowsTrailingRe = /[\\. ]+$/;\r\n    return sanitized\r\n      .replace(illegalRe, goodChar)\r\n      .replace(controlRe, goodChar)\r\n      .replace(reservedRe, goodChar)\r\n      .replace(windowsReservedRe, goodChar)\r\n      .replace(windowsTrailingRe, goodChar);\r\n  }\r\n\r\n  // sanitize path\r\n  public sanitizePath(sanitized: string) {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    // remove slashes form start of path\r\n    sanitized = this.removeFromStart(sanitized, '\\/');\r\n\r\n    // remove slashed form end of path\r\n    sanitized = this.removeFromEnd(sanitized, '\\/');\r\n\r\n    // remove backslashes form start of path\r\n    sanitized = this.removeFromStart(sanitized, '\\\\');\r\n\r\n    // remove backslashes form end of path\r\n    sanitized = this.removeFromEnd(sanitized, '\\\\');\r\n\r\n    // replace bad\r\n    sanitized = this.cleanBadPath(sanitized);\r\n\r\n    return sanitized;\r\n  }\r\n\r\n  // sanitize file or folder name\r\n  public sanitizeName(sanitized: string) {\r\n    // check for undefined\r\n    if (!sanitized) { return sanitized; }\r\n\r\n    // in addition to all path validation rules\r\n    // slashes are not valid in file or folder name\r\n    const replacement = '_';\r\n    const illegalRe = /\\//g;\r\n    return this.sanitizePath(sanitized)\r\n      .replace(illegalRe, replacement);\r\n  }\r\n\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { ContentType } from '../../app-administration/models/content-type.model';\r\nimport { webApiTypeRoot } from '../../app-administration/services/content-types.service';\r\nimport { Context } from '../../shared/services/context';\r\nimport { Field, FieldInputTypeConfig, FieldInputTypeOption } from '../models/field.model';\r\n\r\nexport const webApiFieldsRoot = 'admin/field/';\r\nexport const webApiFieldsAll = webApiFieldsRoot + 'all';\r\n\r\n@Injectable()\r\nexport class ContentTypesFieldsService {\r\n  constructor(private http: HttpClient, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  private apiUrl(name: string) {\r\n    return this.dnnContext.$2sxc.http.apiUrl(name);\r\n  }\r\n\r\n  typeListRetrieve() {\r\n    return this.http.get(this.apiUrl(webApiFieldsRoot + 'DataTypes'), {\r\n      params: { appid: this.context.appId.toString() }\r\n    }) as Observable<string[]>;\r\n  }\r\n\r\n  getInputTypesList() {\r\n    return this.http\r\n      .get(this.apiUrl(webApiFieldsRoot + 'InputTypes'), { params: { appid: this.context.appId.toString() } })\r\n      .pipe(\r\n        map((inputConfigs: FieldInputTypeConfig[]) => {\r\n          const inputTypeOptions = inputConfigs.map(config => {\r\n            const option: FieldInputTypeOption = {\r\n              dataType: config.Type.substring(0, config.Type.indexOf('-')),\r\n              inputType: config.Type,\r\n              label: config.Label,\r\n              description: config.Description,\r\n            };\r\n            return option;\r\n          });\r\n          return inputTypeOptions;\r\n        }),\r\n      ) as Observable<FieldInputTypeOption[]>;\r\n  }\r\n\r\n  getFields(contentType: ContentType) {\r\n    return this.http\r\n      .get(this.apiUrl(webApiFieldsAll), {\r\n        params: { appid: this.context.appId.toString(), staticName: contentType.StaticName },\r\n      })\r\n      .pipe(\r\n        map((fields: Field[]) => {\r\n          if (fields) {\r\n            for (const fld of fields) {\r\n              if (!fld.Metadata) { continue; }\r\n              const md = fld.Metadata;\r\n              const allMd = md.All;\r\n              const typeMd = md[fld.Type];\r\n              const inputMd = md[fld.InputType];\r\n              md.merged = { ...allMd, ...typeMd, ...inputMd };\r\n            }\r\n          }\r\n          return fields;\r\n        }),\r\n      ) as Observable<Field[]>;\r\n  }\r\n\r\n  reOrder(idArray: number[], contentType: ContentType) {\r\n    return this.http.post(this.apiUrl(webApiFieldsRoot + 'Sort'), null, {\r\n      params: {\r\n        appid: this.context.appId.toString(),\r\n        contentTypeId: contentType.Id.toString(),\r\n        order: JSON.stringify(idArray),\r\n      },\r\n    }) as Observable<boolean>;\r\n  }\r\n\r\n  setTitle(item: Field, contentType: ContentType) {\r\n    return this.http.post(this.apiUrl(webApiTypeRoot + 'SetTitle'), null, {\r\n      params: {\r\n        appid: this.context.appId.toString(),\r\n        contentTypeId: contentType.Id.toString(),\r\n        attributeId: item.Id.toString(),\r\n      },\r\n    }) as Observable<null>;\r\n  }\r\n\r\n  rename(item: Field, contentType: ContentType, newName: string) {\r\n    return this.http.post(this.apiUrl(webApiFieldsRoot + 'Rename'), null, {\r\n      params: {\r\n        appid: this.context.appId.toString(),\r\n        contentTypeId: contentType.Id.toString(),\r\n        attributeId: item.Id.toString(),\r\n        newName,\r\n      },\r\n    }) as Observable<null>;\r\n  }\r\n\r\n  delete(item: Field, contentType: ContentType) {\r\n    if (item.IsTitle) {\r\n      throw new Error('Can\\'t delete Title');\r\n    }\r\n\r\n    return this.http.delete(this.apiUrl(webApiFieldsRoot + 'Delete'), {\r\n      params: {\r\n        appid: this.context.appId.toString(),\r\n        contentTypeId: contentType.Id.toString(),\r\n        attributeId: item.Id.toString(),\r\n      },\r\n    }) as Observable<boolean>;\r\n  }\r\n\r\n  add(newField: Partial<Field>, contentTypeId: number) {\r\n    return this.http.post(this.apiUrl(webApiFieldsRoot + 'Add'), null, {\r\n      params: {\r\n        AppId: this.context.appId.toString(),\r\n        ContentTypeId: contentTypeId.toString(),\r\n        Id: newField.Id.toString(),\r\n        Type: newField.Type,\r\n        InputType: newField.InputType,\r\n        StaticName: newField.StaticName,\r\n        IsTitle: newField.IsTitle.toString(),\r\n        Index: newField.SortOrder.toString(),\r\n      }\r\n    }) as Observable<number>;\r\n  }\r\n\r\n  updateInputType(id: number, staticName: string, inputType: string) {\r\n    return this.http.post(this.apiUrl(webApiFieldsRoot + 'InputType'), null, {\r\n      params: { appId: this.context.appId.toString(), attributeId: id.toString(), field: staticName, inputType }\r\n    }) as Observable<boolean>;\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { ImportAppResult } from '../../import-app/models/import-app-result.model';\r\nimport { EavScopeOption } from '../../shared/constants/eav.constants';\r\nimport { Context } from '../../shared/services/context';\r\nimport { ContentType, ContentTypeEdit } from '../models/content-type.model';\r\n\r\nexport const webApiTypeRoot = 'admin/type/';\r\n\r\n@Injectable()\r\nexport class ContentTypesService {\r\n  constructor(private http: HttpClient, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  private apiUrl(name: string) {\r\n    return this.dnnContext.$2sxc.http.apiUrl(name);\r\n  }\r\n\r\n  retrieveContentType(staticName: string) {\r\n    return this.http.get(this.apiUrl(webApiTypeRoot + 'get'), {\r\n      params: { appId: this.context.appId.toString(), contentTypeId: staticName }\r\n    }) as Observable<ContentType>;\r\n  }\r\n\r\n  retrieveContentTypes(scope: string) {\r\n    return this.http.get(this.apiUrl(webApiTypeRoot + 'list'), {\r\n      params: { appId: this.context.appId.toString(), scope }\r\n    }) as Observable<ContentType[]>;\r\n  }\r\n\r\n  getScopes() {\r\n    return this.http.get(this.apiUrl(webApiTypeRoot + 'scopes'), {\r\n      params: { appId: this.context.appId.toString() }\r\n    }).pipe(\r\n      map((scopes: { [key: string]: string }) => {\r\n        const scopeOptions: EavScopeOption[] = Object.keys(scopes).map(key => ({ name: scopes[key], value: key }));\r\n        return scopeOptions;\r\n      }),\r\n    );\r\n  }\r\n\r\n  save(contentType: ContentTypeEdit) {\r\n    return this.http.post(this.apiUrl(webApiTypeRoot + 'save'), contentType, {\r\n      params: { appid: this.context.appId.toString() },\r\n    }) as Observable<boolean>;\r\n  }\r\n\r\n  delete(contentType: ContentType) {\r\n    return this.http.delete(this.apiUrl(webApiTypeRoot + 'delete'), {\r\n      params: { appid: this.context.appId.toString(), staticName: contentType.StaticName },\r\n    }) as Observable<boolean>;\r\n  }\r\n\r\n  import(files: File[]) {\r\n    const formData = new FormData();\r\n    for (const file of files) {\r\n      formData.append('File', file);\r\n    }\r\n    return this.http.post(this.apiUrl(webApiTypeRoot + 'import'), formData, {\r\n      params: { appId: this.context.appId.toString(), zoneId: this.context.zoneId.toString() }\r\n    }) as Observable<ImportAppResult>;\r\n  }\r\n\r\n  createGhost(sourceStaticName: string) {\r\n    return this.http.post(this.apiUrl(webApiTypeRoot + 'addghost'), null, {\r\n      params: { appid: this.context.appId.toString(), sourceStaticName },\r\n    }) as Observable<boolean>;\r\n  }\r\n\r\n}\r\n","import { EditorOptions } from './ace.model';\r\n\r\nexport const aceOptions: Partial<EditorOptions> & EditorPluginsOptions = {\r\n  mode: 'ace/mode/razor',\r\n  wrap: true,\r\n  useSoftTabs: true,\r\n  theme: 'ace/theme/sqlserver',\r\n  fontSize: 14,\r\n  fontFamily: 'Consolas, Courier New, monospace',\r\n  showGutter: true,\r\n  enableBasicAutocompletion: true,\r\n  enableLiveAutocompletion: true,\r\n  enableSnippets: true,\r\n};\r\n\r\ninterface EditorPluginsOptions {\r\n  enableBasicAutocompletion: boolean;\r\n  enableLiveAutocompletion: boolean;\r\n  enableSnippets: boolean;\r\n}\r\n","// tslint:disable-next-line:max-line-length\r\nimport { ChangeDetectionStrategy, Component, ElementRef, forwardRef, Input, NgZone, OnChanges, OnDestroy, OnInit, SimpleChanges, ViewChild } from '@angular/core';\r\nimport { NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport { loadScripts } from '../../shared/helpers/load-scripts.helper';\r\nimport { aceOptions } from './ace-options';\r\nimport { Ace, Editor } from './ace.model';\r\n\r\ndeclare const ace: Ace;\r\n\r\n@Component({\r\n  selector: 'app-ace-editor',\r\n  template: `<div style=\"width: 100%; height: 100%;\" #editor></div>`,\r\n  styles: [':host {display: block; width: 100%; height: 100%}'],\r\n  providers: [{\r\n    provide: NG_VALUE_ACCESSOR,\r\n    useExisting: forwardRef(() => AceEditorComponent),\r\n    multi: true\r\n  }],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AceEditorComponent implements OnInit, OnChanges, OnDestroy {\r\n  @ViewChild('editor') editorRef: ElementRef;\r\n  @Input() filename: string;\r\n  @Input() snippets: any[];\r\n  /** If value changes editor will be resized */\r\n  @Input() toggleResize: boolean;\r\n\r\n  private value = '';\r\n  private editor: Editor;\r\n\r\n  propagateChange: (_: any) => void = () => { };\r\n  propagateTouched: (_: any) => void = () => { };\r\n\r\n  constructor(private zone: NgZone) { }\r\n\r\n  ngOnInit() {\r\n    loadScripts(\r\n      [\r\n        { test: 'ace', src: 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/ace.min.js' },\r\n        { test: null, src: 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/ext-modelist.min.js' },\r\n        { test: null, src: 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/ext-language_tools.min.js' },\r\n      ],\r\n      this.aceLoaded.bind(this)\r\n    );\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    const filename = changes.filename?.currentValue;\r\n    const snippets = changes.snippets?.currentValue;\r\n    this.updateValues(filename, snippets);\r\n\r\n    if (!this.editor) { return; }\r\n    const resize = changes.toggleResize?.currentValue !== changes.toggleResize?.previousValue;\r\n    if (resize) {\r\n      this.zone.runOutsideAngular(() => {\r\n        // wait for Angular to update DOM to be able to get proper size of the container\r\n        setTimeout(() => { this.editor.resize(); }, 50);\r\n      });\r\n    }\r\n  }\r\n\r\n  insertSnippet(snippet: any) {\r\n    this.zone.runOutsideAngular(() => {\r\n      const snippetManager = ace.require('ace/snippets').snippetManager;\r\n      snippetManager.insertSnippet(this.editor, snippet);\r\n      this.editor.focus();\r\n    });\r\n  }\r\n\r\n  writeValue(value: string) {\r\n    this.value = value || '';\r\n    if (!this.editor) { return; }\r\n    this.zone.runOutsideAngular(() => {\r\n      const p = this.editor.getCursorPosition();\r\n      this.editor.setValue(this.value, -1);\r\n      this.editor.moveCursorToPosition(p);\r\n    });\r\n  }\r\n\r\n  registerOnChange(fn: (_: any) => void) {\r\n    this.propagateChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: (_: any) => void) {\r\n    this.propagateTouched = fn;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.zone.runOutsideAngular(() => {\r\n      this.editor.destroy();\r\n      this.editor.container.remove();\r\n      this.editor = null;\r\n    });\r\n  }\r\n\r\n  private aceLoaded() {\r\n    this.zone.runOutsideAngular(() => {\r\n      ace.config.set('basePath', 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11');\r\n      this.editor = ace.edit(this.editorRef.nativeElement, aceOptions);\r\n      (this.editor as any).$blockScrolling = Infinity;\r\n      this.editor.session.setValue(this.value); // set value and reset undo history\r\n      this.updateValues(this.filename, this.snippets);\r\n      this.editor.on('change', this.onEditorValueChange.bind(this));\r\n      this.editor.on('blur', this.onEditorBlurred.bind(this));\r\n      this.editor.focus();\r\n    });\r\n  }\r\n\r\n  private onEditorValueChange() {\r\n    this.zone.run(() => {\r\n      this.propagateChange(this.editor.getValue());\r\n    });\r\n  }\r\n\r\n  private onEditorBlurred() {\r\n    this.zone.run(() => {\r\n      this.propagateTouched(this.editor.getValue());\r\n    });\r\n  }\r\n\r\n  private updateValues(filename: string, snippets: any[]) {\r\n    if (!this.editor) { return; }\r\n    this.zone.runOutsideAngular(() => {\r\n      if (filename) {\r\n        const modelist = ace.require('ace/ext/modelist');\r\n        const mode = modelist.getModeForPath(filename).mode;\r\n        this.editor.session.setMode(mode);\r\n      }\r\n      if (snippets) {\r\n        const snippetManager = ace.require('ace/snippets').snippetManager;\r\n        snippetManager.register(this.snippets);\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';\r\nimport { Subject } from 'rxjs';\r\n\r\n/** This service ensures that multiple SnackBars are shown one after another. */\r\n@Injectable({ providedIn: 'root' })\r\nexport class SnackBarStackService implements OnDestroy {\r\n  private defaultDuration = 3000;\r\n  private processingMessage = false;\r\n  private messageQueue: SnackBarData[] = [];\r\n\r\n  constructor(private snackBar: MatSnackBar) { }\r\n\r\n  /**\r\n   * Add a message to the stack queue.\r\n   * @returns observable that fires if the action is triggered.\r\n   * Service will complete the observable\r\n   */\r\n  add(message: string, action?: string, config: MatSnackBarConfig<any> = { duration: this.defaultDuration }) {\r\n    const triggered$ = new Subject<void>();\r\n    this.messageQueue.push({ message, action, config, triggered$ });\r\n    if (!this.processingMessage) {\r\n      this.showSnackBar();\r\n    }\r\n    return triggered$.asObservable();\r\n  }\r\n\r\n  private showSnackBar() {\r\n    const nextMsg = this.messageQueue.shift();\r\n\r\n    if (nextMsg == null) {\r\n      this.processingMessage = false;\r\n      return;\r\n    }\r\n\r\n    this.processingMessage = true;\r\n\r\n    const snackBarRef = this.snackBar.open(nextMsg.message, nextMsg.action, nextMsg.config);\r\n    snackBarRef.afterDismissed().subscribe(() => {\r\n      nextMsg.triggered$.complete();\r\n      this.showSnackBar();\r\n    });\r\n    snackBarRef.onAction().subscribe(() => {\r\n      nextMsg.triggered$.next();\r\n    });\r\n  }\r\n\r\n  // spm TODO: ngOnDestroy only fires in services provided in component\r\n  ngOnDestroy() {\r\n    for (const message of this.messageQueue) {\r\n      message.triggered$.complete();\r\n    }\r\n    this.messageQueue = null;\r\n  }\r\n}\r\n\r\nclass SnackBarData {\r\n  message: string;\r\n  action: string;\r\n  config: MatSnackBarConfig<any>;\r\n  triggered$: Subject<void>;\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { webApiAppFile, webApiAppFileCreate, webApiAppFilesAll } from 'projects/edit';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Context } from '../../shared/services/context';\r\nimport { SourceView } from '../models/source-view.model';\r\n\r\n@Injectable()\r\nexport class SourceService {\r\n  constructor(private http: HttpClient, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  /** Key is templateId or path */\r\n  get(key: number | string) {\r\n    return this.http.get(this.dnnContext.$2sxc.http.apiUrl(webApiAppFile), {\r\n      params: { appId: this.context.appId.toString(), ...this.templateIdOrPath(key) }\r\n    }).pipe(\r\n      map((view: SourceView) => {\r\n        if (view.Type.toLowerCase() === 'auto') {\r\n          switch (view.Extension.toLowerCase()) {\r\n            case '.cs':\r\n            case '.cshtml':\r\n              view.Type = 'Razor';\r\n              break;\r\n            case '.html':\r\n            case '.css':\r\n            case '.js':\r\n              view.Type = 'Token';\r\n              break;\r\n          }\r\n        }\r\n        return view;\r\n      })\r\n    ) as Observable<SourceView>;\r\n  }\r\n\r\n  /** Key is templateId or path */\r\n  save(key: number | string, view: SourceView) {\r\n    return this.http.post(this.dnnContext.$2sxc.http.apiUrl(webApiAppFile), view, {\r\n      params: { appId: this.context.appId.toString(), ...this.templateIdOrPath(key) },\r\n    }) as Observable<boolean>;\r\n  }\r\n\r\n  getTemplates() {\r\n    return this.http.get(this.dnnContext.$2sxc.http.apiUrl(webApiAppFilesAll), {\r\n      params: { appId: this.context.appId.toString(), global: 'false', withSubfolders: 'true' },\r\n    }) as Observable<string[]>;\r\n  }\r\n\r\n  createTemplate(name: string) {\r\n    return this.http.post(this.dnnContext.$2sxc.http.apiUrl(webApiAppFileCreate), {}, {\r\n      params: { appId: this.context.appId.toString(), global: 'false', path: name },\r\n    }) as Observable<boolean>;\r\n  }\r\n\r\n  private templateIdOrPath(key: number | string) {\r\n    if (typeof key === typeof 0) {\r\n      return { templateId: key.toString() };\r\n    } else {\r\n      return { path: key as string };\r\n    }\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport cloneDeep from 'lodash-es/cloneDeep';\r\nimport { DataTypeConstants } from '../../content-type-fields/constants/data-type.constants';\r\nimport { Field } from '../../content-type-fields/models/field.model';\r\nimport { webApiFieldsAll } from '../../content-type-fields/services/content-types-fields.service';\r\nimport { Snippet } from '../models/snippet.model';\r\nimport { SourceView } from '../models/source-view.model';\r\n\r\n@Injectable()\r\nexport class SnippetsService {\r\n  private keyPrefixes = ['@', '['];\r\n  private keyPrefixIndex = (view: SourceView) => (view.Type.indexOf('Razor') > -1) ? 0 : 1;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private dnnContext: DnnContext,\r\n    private translate: TranslateService,\r\n  ) { }\r\n\r\n  async getSnippets(view: SourceView) {\r\n    const res: any = await this.http.get('../ng-assets/snippets.json.js').toPromise();\r\n    const snippets: Snippet[] = res.snippets;\r\n    const relevant = this.filterAwayNotNeededSnippetsList(snippets, view);\r\n    const standAndInputSnips = this.extractInputTypeSnippets(relevant);\r\n    const sets = this.initSnippetsWithConfig(standAndInputSnips.standardArray, view, standAndInputSnips.inputTypeSnippets);\r\n    return { sets, list: standAndInputSnips.standardArray };\r\n  }\r\n\r\n  // scan the list for sets starting with @ or [ and filter if not needed right now\r\n  private filterAwayNotNeededSnippetsList(list: Snippet[], view: SourceView) {\r\n    const newList = [];\r\n    for (const itm of list) {\r\n      const setHasPrefix = this.keyPrefixes.indexOf(itm.set[0]);\r\n      if (setHasPrefix === -1 || (setHasPrefix === this.keyPrefixIndex(view))) {\r\n        // if necessary, remove first char\r\n        if (setHasPrefix === this.keyPrefixIndex(view)) {\r\n          itm.set = itm.set.substr(1);\r\n        }\r\n        newList.push(itm);\r\n      }\r\n    }\r\n    return newList;\r\n  }\r\n\r\n  private extractInputTypeSnippets(list: Snippet[]) {\r\n    const standardArray: Snippet[] = [];\r\n    const inputTypeArray: Snippet[] = [];\r\n\r\n    for (const itm of list) {\r\n      const systemSnippet = itm.set[0] === '\\\\';\r\n      if (!systemSnippet) {\r\n        standardArray.push(itm);\r\n      } else {\r\n        itm.set = itm.set.substr(1);\r\n        inputTypeArray.push(itm);\r\n      }\r\n    }\r\n    const inputTypeSnippets = this.catalogInputTypeSnippets(inputTypeArray);\r\n    return {\r\n      standardArray,\r\n      inputTypeSnippets,\r\n    };\r\n  }\r\n\r\n  private catalogInputTypeSnippets(list: Snippet[]) {\r\n    const inputTypeList: any = {};\r\n    for (const itm of list) {\r\n      if (inputTypeList[itm.subset] === undefined) {\r\n        inputTypeList[itm.subset] = [];\r\n      }\r\n      inputTypeList[itm.subset].push(itm);\r\n    }\r\n    return inputTypeList;\r\n  }\r\n\r\n  private initSnippetsWithConfig(sets: any, templateConfiguration: SourceView, inputTypeSnippets: any) {\r\n    sets = this.makeTree(sets);\r\n\r\n    // retrieve all relevant content-types and infos\r\n    sets.Content = Object.assign({}, sets.Content, { Fields: {}, PresentationFields: {} });\r\n    if (templateConfiguration.TypeContent) {\r\n      this.loadContentType(sets.Content.Fields, templateConfiguration.TypeContent, 'Content', templateConfiguration, inputTypeSnippets);\r\n    }\r\n    if (templateConfiguration.TypeContentPresentation) {\r\n      this.loadContentType(\r\n        sets.Content.PresentationFields, templateConfiguration.TypeContentPresentation,\r\n        'Content.Presentation', templateConfiguration, inputTypeSnippets,\r\n      );\r\n    }\r\n\r\n    if (templateConfiguration.HasList) {\r\n      sets.List = Object.assign({}, sets.List, { Fields: {}, PresentationFields: {} });\r\n      if (templateConfiguration.TypeList) {\r\n        this.loadContentType(sets.List.Fields, templateConfiguration.TypeList, 'Header', templateConfiguration, inputTypeSnippets);\r\n      }\r\n      if (templateConfiguration.TypeListPresentation) {\r\n        this.loadContentType(\r\n          sets.List.PresentationFields, templateConfiguration.TypeListPresentation,\r\n          'Header.Presentation', templateConfiguration, inputTypeSnippets,\r\n        );\r\n      }\r\n    } else {\r\n      delete sets.List;\r\n    }\r\n\r\n    // maybe App-infos\r\n    if (templateConfiguration.HasApp) {\r\n      sets.App.Resources = {};\r\n      sets.App.Settings = {};\r\n      this.loadContentType(sets.App.Resources, 'App-Resources', 'App.Resources', templateConfiguration, inputTypeSnippets);\r\n      this.loadContentType(sets.App.Settings, 'App-Settings', 'App.Settings', templateConfiguration, inputTypeSnippets);\r\n    }\r\n\r\n    return sets;\r\n  }\r\n\r\n  // Convert the list into a tree with set/subset/item\r\n  private makeTree(list: Snippet[]) {\r\n    const tree: any = {};\r\n    for (const o of list) {\r\n      if (tree[o.set] === undefined) {\r\n        tree[o.set] = {};\r\n      }\r\n      if (tree[o.set][o.subset] === undefined) {\r\n        tree[o.set][o.subset] = [];\r\n      }\r\n      const reformatted = {\r\n        key: o.name,\r\n        label: this.label(o.set, o.subset, o.name),\r\n        snip: o.content,\r\n        help: o.help || this.help(o.set, o.subset, o.name),\r\n        links: this.linksList(o.links)\r\n      };\r\n\r\n      tree[o.set][o.subset].push(reformatted);\r\n    }\r\n    return tree;\r\n  }\r\n\r\n  private label(set: any, subset: any, snip: any) {\r\n    const key = this.getHelpKey(set, subset, snip, '.Key');\r\n\r\n    let result = this.translate.instant(key);\r\n    if (result === key) {\r\n      result = snip;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private getHelpKey(set: any, subset: any, snip: any, addition: any) {\r\n    return 'SourceEditorSnippets' + '.' + set + '.' + subset + '.' + snip + addition;\r\n  }\r\n\r\n  private help(set: any, subset: any, snip: any) {\r\n    const key = this.getHelpKey(set, subset, snip, '.Help');\r\n\r\n    let result = this.translate.instant(key);\r\n    if (result === key) {\r\n      result = '';\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private linksList(linksString: any) {\r\n    if (!linksString) {\r\n      return null;\r\n    }\r\n    const links = [];\r\n    const llist = linksString.split('\\n');\r\n    for (const l of llist) {\r\n      const pair = l.split(':');\r\n      if (pair.length === 3) {\r\n        links.push({ name: pair[0].trim(), url: pair[1].trim() + ':' + pair[2].trim() });\r\n      }\r\n    }\r\n    if (links.length === 0) { return null; }\r\n    return links;\r\n  }\r\n\r\n  // get fields in content types\r\n  private loadContentType(target: any, type: any, prefix: any, templateConfiguration: SourceView, inputTypeSnippets: any) {\r\n    this.getFields(templateConfiguration.AppId, type)\r\n      .then(fields => {\r\n        // first add common items if the content-type actually exists\r\n        for (const value of fields) {\r\n          const fieldname = value.StaticName;\r\n          target[fieldname] = {\r\n            key: fieldname,\r\n            label: fieldname,\r\n            snip: this.valuePlaceholder(prefix, fieldname, templateConfiguration),\r\n            help: value.Metadata.merged.Notes || '' + ' (' + value.Type.toLowerCase() + ') '\r\n          };\r\n          // try to add generic snippets specific to this input-type\r\n          const snipDefaults = cloneDeep(target[fieldname]); // must be a copy, because target[fieldname] will grow\r\n\r\n          this.attachSnippets(target, prefix, fieldname, value.InputType, snipDefaults, inputTypeSnippets);\r\n        }\r\n\r\n        const std = ['EntityId', 'EntityTitle', 'EntityGuid', 'EntityType', 'IsPublished', 'Modified'];\r\n        if (fields.length) {\r\n          // tslint:disable-next-line:prefer-for-of\r\n          for (let i = 0; i < std.length; i++) {\r\n            target[std[i]] = {\r\n              key: std[i],\r\n              label: std[i],\r\n              snip: this.valuePlaceholder(prefix, std[i], templateConfiguration),\r\n              help: this.translate.instant('SourceEditorSnippets.StandardFields.' + std[i] + '.Help'),\r\n            };\r\n          }\r\n        }\r\n      });\r\n  }\r\n\r\n  private valuePlaceholder(obj: any, val: any, templateConfiguration: any) {\r\n    return (templateConfiguration.Type.indexOf('Razor') > -1)\r\n      ? '@' + obj + '.' + val\r\n      : '[' + obj.replace('.', ':') + ':' + val + ']';\r\n  }\r\n\r\n  private getFields(appId: number, staticName: string) {\r\n    return this.http.get(this.dnnContext.$2sxc.http.apiUrl(webApiFieldsAll), {\r\n      params: { appid: appId.toString(), staticName },\r\n    })\r\n      .toPromise()\r\n      .then((fields: Field[]) => {\r\n        fields = fields.filter(field => field.Type !== DataTypeConstants.Empty);\r\n        if (fields) {\r\n          for (const fld of fields) {\r\n            if (!fld.Metadata) { continue; }\r\n            const md = fld.Metadata;\r\n            const allMd = md.All;\r\n            const typeMd = md[fld.Type];\r\n            const inputMd = md[fld.InputType];\r\n            md.merged = { ...allMd, ...typeMd, ...inputMd };\r\n          }\r\n        }\r\n        return fields;\r\n      });\r\n  }\r\n\r\n  private attachSnippets(target: any, prefix: any, fieldname: any, inputType: any, snipDefaults: any, inputTypeSnippets: any) {\r\n    let genericSnippet = inputTypeSnippets[inputType];\r\n    if (inputType.indexOf('-')) {   // if it's a sub-type, let's also get the master-type\r\n      const fieldType = inputType.substr(0, inputType.indexOf('-'));\r\n      if (fieldType) {\r\n        const typeSnips = inputTypeSnippets[fieldType];\r\n        if (typeSnips) {\r\n          genericSnippet = genericSnippet ? genericSnippet.concat(typeSnips) : typeSnips;\r\n        }\r\n      }\r\n    }\r\n    if (!genericSnippet) {\r\n      return;\r\n    }\r\n\r\n    if (target[fieldname].more === undefined) {\r\n      target[fieldname].more = [];\r\n    }\r\n    const fieldSnips = target[fieldname].more;\r\n    // tslint:disable-next-line:prefer-for-of\r\n    for (let g = 0; g < genericSnippet.length; g++) {\r\n      try {\r\n        fieldSnips[fieldname + '-' + genericSnippet[g].name] = Object.assign({}, snipDefaults, {\r\n          key: fieldname + ' - ' + genericSnippet[g].name,\r\n          label: genericSnippet[g].name,\r\n          snip: this.localizeGenericSnippet(genericSnippet[g].content, prefix, fieldname),\r\n          collapse: true\r\n        });\r\n      } finally { }\r\n    }\r\n  }\r\n\r\n  private localizeGenericSnippet(snip: any, objName: any, fieldName: any) {\r\n    snip = snip.replace(/(\\$\\{[0-9]+\\:)var(\\})/gi, '$1' + objName + '$2')\r\n      .replace(/(\\$\\{[0-9]+\\:)prop(\\})/gi, '$1' + fieldName + '$2');\r\n    return snip;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { TreeItem } from '../models/tree-item.model';\r\n\r\n/** Sorts folders before files */\r\n@Pipe({ name: 'sortItems' })\r\nexport class SortItemsPipe implements PipeTransform {\r\n\r\n  transform(items: TreeItem[]) {\r\n    if (items == null) { return items; }\r\n\r\n    items.sort((item1, item2) => {\r\n      if (item1.isFolder < item2.isFolder) {\r\n        return 1;\r\n      } else if (item1.isFolder > item2.isFolder) {\r\n        return -1;\r\n      } else {\r\n        return 0;\r\n      }\r\n    });\r\n    return items;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\n\r\n@Pipe({ name: 'depthPadding' })\r\nexport class DepthPaddingPipe implements PipeTransform {\r\n\r\n  constructor(private sanitizer: DomSanitizer) { }\r\n\r\n  transform(depth: number, isFolder: boolean) {\r\n    let padding: number;\r\n    if (isFolder) {\r\n      padding = depth * 8;\r\n    } else {\r\n      padding = (depth === 0) ? 8 : (depth * 8 + 16);\r\n    }\r\n    return this.sanitizer.bypassSecurityTrustStyle(`padding-left: ${padding}px;`);\r\n  }\r\n}\r\n","<div class=\"editor-active-explorer fancy-scrollbar-dark explorer-wrapper\">\r\n\r\n  <div>\r\n    <ng-container *ngFor=\"let item of (tree | sortItems)\">\r\n      <ng-container *ngTemplateOutlet=\"fileOrFolder; context: {item: item}\"></ng-container>\r\n    </ng-container>\r\n\r\n    <ng-template #fileOrFolder let-item=\"item\">\r\n\r\n      <div class=\"file\" *ngIf=\"!item.isFolder\" [style]=\"item.depth | depthPadding: item.isFolder\"\r\n        [ngClass]=\"{'active': toggledItems.includes(item.pathFromRoot) }\" matTooltipShowDelay=\"750\"\r\n        [matTooltip]=\"item.name\" (click)=\"openTemplate(item.pathFromRoot)\">\r\n        {{ item.name }}\r\n      </div>\r\n\r\n      <div *ngIf=\"item.isFolder\">\r\n        <div class=\"folder-name-wrapper\" [style]=\"item.depth | depthPadding: item.isFolder\"\r\n          (click)=\"toggleItem(item.pathFromRoot)\">\r\n          <div class=\"folder-name\" matTooltipShowDelay=\"750\" [matTooltip]=\"item.name\">\r\n            <mat-icon>\r\n              {{ toggledItems.includes(item.pathFromRoot) ? 'keyboard_arrow_down' : 'keyboard_arrow_right' }}\r\n            </mat-icon>\r\n            <span>{{ item.name }}</span>\r\n          </div>\r\n          <div class=\"add-item\" matTooltipShowDelay=\"750\" matTooltip=\"Create file in this folder\"\r\n            appClickStopPropagation (click)=\"addFile(item.pathFromRoot)\">\r\n            <mat-icon>add</mat-icon>\r\n          </div>\r\n        </div>\r\n\r\n        <ng-container *ngIf=\"toggledItems.includes(item.pathFromRoot)\">\r\n          <ng-container *ngFor=\"let item1 of (item.children | sortItems)\">\r\n            <ng-container *ngTemplateOutlet=\"fileOrFolder; context: {item: item1}\"></ng-container>\r\n          </ng-container>\r\n        </ng-container>\r\n      </div>\r\n\r\n    </ng-template>\r\n  </div>\r\n\r\n  <div class=\"create-button-wrapper\">\r\n    <button mat-icon-button matTooltip=\"Create file\" (click)=\"addFile()\">\r\n      <mat-icon>add</mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnChanges, OnInit, Output, SimpleChanges } from '@angular/core';\r\nimport { DialogService } from '../../shared/services/dialog.service';\r\nimport { SourceView } from '../models/source-view.model';\r\nimport { TreeItem } from '../models/tree-item.model';\r\nimport { calculateTree, toggleInArray } from './code-templates.helpers';\r\n\r\n@Component({\r\n  selector: 'app-code-templates',\r\n  templateUrl: './code-templates.component.html',\r\n  styleUrls: ['./code-templates.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CodeTemplatesComponent implements OnInit, OnChanges {\r\n  @Input() view: SourceView;\r\n  @Input() templates: string[];\r\n  @Output() createTemplate: EventEmitter<string> = new EventEmitter();\r\n  tree: TreeItem[];\r\n  toggledItems: string[] = [];\r\n\r\n  constructor(private dialogService: DialogService) { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    if (changes.templates?.currentValue) {\r\n      this.tree = calculateTree(this.templates);\r\n    }\r\n    if (changes.view?.currentValue) {\r\n      this.showFileInTree(this.view.FileName);\r\n    }\r\n  }\r\n\r\n  openTemplate(path: string) {\r\n    this.dialogService.openCodeFile(path);\r\n  }\r\n\r\n  toggleItem(path: string) {\r\n    toggleInArray(path, this.toggledItems);\r\n  }\r\n\r\n  addFile(folder?: string) {\r\n    this.createTemplate.emit(folder);\r\n  }\r\n\r\n  private showFileInTree(file: string) {\r\n    if (file == null) { return; }\r\n    if (this.toggledItems.includes(file)) { return; }\r\n\r\n    const paths = file.split('/');\r\n    let pathFromRoot = '';\r\n    for (const path of paths) {\r\n      pathFromRoot = !pathFromRoot ? path : `${pathFromRoot}/${path}`;\r\n      if (this.toggledItems.includes(pathFromRoot)) { continue; }\r\n      this.toggleItem(pathFromRoot);\r\n    }\r\n  }\r\n\r\n}\r\n","import { TreeItem } from '../models/tree-item.model';\r\n\r\nexport function calculateTree(templates: string[]): TreeItem[] {\r\n  if (!templates) { return []; }\r\n\r\n  const tree: TreeItem[] = [];\r\n  for (const template of templates) {\r\n    let parent: TreeItem[] = tree;\r\n    const paths = template.split('/');\r\n    const last = paths[paths.length - 1];\r\n    let pathFromRoot = '';\r\n    for (let i = 0; i < paths.length; i++) {\r\n      const path = paths[i];\r\n      pathFromRoot += i ? `/${path}` : path;\r\n      const existing = parent.find(item => item.name === path);\r\n      if (existing) {\r\n        parent = existing.children;\r\n      } else {\r\n        const item: TreeItem = {\r\n          depth: i,\r\n          name: path,\r\n          pathFromRoot,\r\n          isFolder: path !== last,\r\n          ...(path !== last && { children: [] }),\r\n        };\r\n        parent.push(item);\r\n        parent = item.children;\r\n      }\r\n    }\r\n  }\r\n\r\n  return tree;\r\n}\r\n\r\nexport function toggleInArray<T>(item: T, array: T[]) {\r\n  const index = array.indexOf(item);\r\n  if (index === -1) {\r\n    array.push(item);\r\n  } else {\r\n    array.splice(index, 1);\r\n  }\r\n}\r\n","export function toggleInArray(item: any, array: any[]) {\r\n  const index = array.indexOf(item);\r\n  if (index === -1) {\r\n    array.push(item);\r\n  } else {\r\n    array.splice(index, 1);\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\n@Pipe({ name: 'objectToArray' })\r\nexport class ObjectToArrayPipe implements PipeTransform {\r\n  transform(obj: object | Array<any>): Array<any> {\r\n    if (typeof obj !== typeof {}) { return obj as Array<any>; }\r\n    return Object.keys(obj).map(key => {\r\n      return (obj as any)[key];\r\n    });\r\n  }\r\n}\r\n","<div class=\"editor-active-explorer fancy-scrollbar-dark\">\r\n  <div *ngFor=\"let section of snippets | keyvalue\">\r\n\r\n    <div class=\"collapsible-header section\" [matTooltip]=\"'SourceEditorSnippets.' + section.key + '.Help' | translate\"\r\n      matTooltipShowDelay=\"750\" (click)=\"toggleSection(section)\">\r\n      <mat-icon>{{ toggledSections.includes(section) ? 'keyboard_arrow_down' : 'keyboard_arrow_right' }}</mat-icon>\r\n      <span>{{ 'SourceEditorSnippets.' + section.key + '.Title' | translate }}</span>\r\n    </div>\r\n\r\n    <ng-container *ngIf=\"toggledSections.includes(section)\">\r\n      <div *ngFor=\"let folder of section.value | keyvalue\">\r\n\r\n        <div class=\"collapsible-header folder\"\r\n          [matTooltip]=\"'SourceEditorSnippets.' + section.key + '.' + folder.key + '.Help' | translate\"\r\n          matTooltipShowDelay=\"750\" (click)=\"toggleFolder(folder)\">\r\n          <mat-icon>{{ toggledFolders.includes(folder) ? 'keyboard_arrow_down' : 'keyboard_arrow_right' }}</mat-icon>\r\n          <span>{{ 'SourceEditorSnippets.' + section.key + '.' + folder.key + '.Title' | translate }}</span>\r\n        </div>\r\n\r\n        <ng-container *ngIf=\"toggledFolders.includes(folder)\">\r\n          <div class=\"snippet\" *ngFor=\"let snippet of (folder.value | objectToArray)\">\r\n\r\n            <div class=\"snippet-label\">\r\n              <div matRipple class=\"text\" [matTooltip]=\"snippet.snip\" matTooltipShowDelay=\"750\"\r\n                (click)=\"addSnippet(snippet.snip)\">\r\n                {{ snippet.label }}\r\n              </div>\r\n              <mat-icon *ngIf=\"snippet.more\" matTooltip=\"Show More\" matTooltipShowDelay=\"750\"\r\n                (click)=\"toggleMore(snippet)\">\r\n                {{ toggledMores.includes(snippet) ? 'more_vert' : 'more_horiz' }}\r\n              </mat-icon>\r\n              <mat-icon matTooltip=\"Show Help\" matTooltipShowDelay=\"750\" appClickStopPropagation\r\n                (click)=\"toggleInfo(snippet)\">\r\n                info\r\n              </mat-icon>\r\n            </div>\r\n\r\n            <div class=\"snippet-help\" *ngIf=\"toggledInfos.includes(snippet)\">\r\n              <div class=\"text\" [innerHTML]=\"snippet.help | safeHtml\"></div>\r\n              <div *ngFor=\"let link of snippet.links\">\r\n                <a [href]=\"link.url\" target=\"_blank\">{{ link.name }}</a>\r\n              </div>\r\n            </div>\r\n\r\n            <ng-container *ngIf=\"toggledMores.includes(snippet)\">\r\n              <div *ngFor=\"let more of (snippet.more | objectToArray)\">\r\n\r\n                <div class=\"snippet-label\">\r\n                  <div matRipple class=\"text text-more\" [matTooltip]=\"more.snip\" matTooltipShowDelay=\"750\"\r\n                    (click)=\"addSnippet(more.snip)\">\r\n                    {{ more.label }}\r\n                  </div>\r\n                  <mat-icon matTooltip=\"Show Help\" matTooltipShowDelay=\"750\" appClickStopPropagation\r\n                    (click)=\"toggleInfo(more)\">\r\n                    info\r\n                  </mat-icon>\r\n                </div>\r\n\r\n                <div class=\"snippet-help snippet-help-more\" *ngIf=\"toggledInfos.includes(more)\">\r\n                  <div class=\"text\" [innerHTML]=\"more.help | safeHtml\"></div>\r\n                  <div *ngFor=\"let link of more.links\">\r\n                    <a [href]=\"link.url\" target=\"_blank\">{{ link.name }}</a>\r\n                  </div>\r\n                </div>\r\n\r\n              </div>\r\n            </ng-container>\r\n\r\n          </div>\r\n        </ng-container>\r\n\r\n      </div>\r\n    </ng-container>\r\n\r\n  </div>\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\r\nimport { toggleInArray } from './code-snippets.helpers';\r\n\r\n@Component({\r\n  selector: 'app-code-snippets',\r\n  templateUrl: './code-snippets.component.html',\r\n  styleUrls: ['./code-snippets.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CodeSnippetsComponent implements OnInit {\r\n  @Input() snippets: any;\r\n  @Output() insertSnippet: EventEmitter<any> = new EventEmitter();\r\n  toggledSections: any[] = [];\r\n  toggledFolders: any[] = [];\r\n  toggledInfos: any[] = [];\r\n  toggledMores: any[] = [];\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  addSnippet(snippet: string) {\r\n    this.insertSnippet.emit(snippet);\r\n  }\r\n\r\n  toggleSection(set: any) {\r\n    toggleInArray(set, this.toggledSections);\r\n  }\r\n\r\n  toggleFolder(item: any) {\r\n    toggleInArray(item, this.toggledFolders);\r\n  }\r\n\r\n  toggleInfo(info: any) {\r\n    toggleInArray(info, this.toggledInfos);\r\n  }\r\n\r\n  toggleMore(more: any) {\r\n    toggleInArray(more, this.toggledMores);\r\n  }\r\n\r\n}\r\n","<div class=\"editor-root\" *ngIf=\"(templateVars$ | async) as data\">\r\n  <div class=\"editor-side-toolbar\">\r\n    <div class=\"button\" [ngClass]=\"{ 'active': activeExplorer === explorer.templates }\" matTooltip=\"Templates\"\r\n      (click)=\"toggleExplorer(explorer.templates)\">\r\n      <mat-icon>file_copy</mat-icon>\r\n    </div>\r\n    <div class=\"button\" [ngClass]=\"{ 'active': activeExplorer === explorer.snippets }\" matTooltip=\"Snippets\"\r\n      (click)=\"toggleExplorer(explorer.snippets)\">\r\n      <mat-icon>code</mat-icon>\r\n    </div>\r\n  </div>\r\n\r\n  <app-code-templates [hidden]=\"activeExplorer !== explorer.templates\" [view]=\"data.view\" [templates]=\"data.templates\"\r\n    (createTemplate)=\"createTemplate($event)\">\r\n  </app-code-templates>\r\n  <app-code-snippets [hidden]=\"activeExplorer !== explorer.snippets\" [snippets]=\"data.explorerSnipps\"\r\n    (insertSnippet)=\"changeInsertSnipp($event)\">\r\n  </app-code-snippets>\r\n\r\n  <app-ace-editor *ngIf=\"data.view\" [filename]=\"data.view.FileName\" [ngModel]=\"data.view.Code\"\r\n    (ngModelChange)=\"codeChanged($event)\" [snippets]=\"data.editorSnipps\" [toggleResize]=\"!this.activeExplorer\">\r\n  </app-ace-editor>\r\n\r\n  <button mat-fab mat-elevation-z24 matTooltip=\"Click to save or CTRL + S\" (click)=\"save()\">\r\n    <mat-icon>done</mat-icon>\r\n  </button>\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, NgZone, OnDestroy, OnInit, ViewChild } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { Title } from '@angular/platform-browser';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { BehaviorSubject, combineLatest, forkJoin, fromEvent, Subscription } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { SanitizeService } from '../../../../edit/eav-material-controls/adam/sanitize.service';\r\nimport { defaultControllerName, defaultTemplateName } from '../shared/constants/file-names.constants';\r\nimport { keyItems } from '../shared/constants/session.constants';\r\nimport { EditItem, SourceItem, } from '../shared/models/edit-form.model';\r\nimport { Context } from '../shared/services/context';\r\nimport { DialogService } from '../shared/services/dialog.service';\r\nimport { SnackBarStackService } from '../shared/services/snack-bar-stack.service';\r\nimport { AceEditorComponent } from './ace-editor/ace-editor.component';\r\nimport { SourceView } from './models/source-view.model';\r\nimport { SnippetsService } from './services/snippets.service';\r\nimport { SourceService } from './services/source.service';\r\n\r\n@Component({\r\n  selector: 'app-code-editor',\r\n  templateUrl: './code-editor.component.html',\r\n  styleUrls: ['./code-editor.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CodeEditorComponent implements OnInit, OnDestroy {\r\n  @ViewChild(AceEditorComponent) private aceEditorRef: AceEditorComponent;\r\n\r\n  explorer = {\r\n    templates: 'templates',\r\n    snippets: 'snippets'\r\n  };\r\n  activeExplorer = this.explorer.templates;\r\n  private view$ = new BehaviorSubject<SourceView>(null);\r\n  private templates$ = new BehaviorSubject<string[]>(null);\r\n  private explorerSnipps$ = new BehaviorSubject<any>(null);\r\n  private editorSnipps$ = new BehaviorSubject<any>(null);\r\n  templateVars$ = combineLatest([this.view$, this.templates$, this.explorerSnipps$, this.editorSnipps$]).pipe(\r\n    map(([view, templates, explorerSnipps, editorSnipps]) => ({ view, templates, explorerSnipps, editorSnipps })),\r\n  );\r\n\r\n  private viewKey: number | string; // templateId or path\r\n  private savedCode: string;\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private context: Context,\r\n    private route: ActivatedRoute,\r\n    private snackBar: MatSnackBar,\r\n    private snackBarStack: SnackBarStackService,\r\n    private sourceService: SourceService,\r\n    private snippetsService: SnippetsService,\r\n    private zone: NgZone,\r\n    private titleService: Title,\r\n    private dialogService: DialogService,\r\n    private sanitizeService: SanitizeService,\r\n  ) {\r\n    this.context.init(this.route);\r\n    this.calculateViewKey();\r\n    this.attachListeners();\r\n  }\r\n\r\n  ngOnInit() {\r\n    const view$ = this.sourceService.get(this.viewKey);\r\n    const templates$ = this.sourceService.getTemplates();\r\n    forkJoin([view$, templates$]).subscribe(([view, templates]) => {\r\n      this.view$.next(view);\r\n      this.savedCode = this.view$.value.Code;\r\n      this.titleService.setTitle(`${this.view$.value.FileName} - Code Editor`);\r\n      this.templates$.next(templates);\r\n      this.showCodeAndEditionWarnings(view, templates);\r\n\r\n      this.snippetsService.getSnippets(this.view$.value).then(res => {\r\n        this.explorerSnipps$.next(res.sets);\r\n        this.editorSnipps$.next(res.list);\r\n      });\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.view$.complete();\r\n    this.templates$.complete();\r\n    this.explorerSnipps$.complete();\r\n    this.editorSnipps$.complete();\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  toggleExplorer(explorer: string) {\r\n    if (this.activeExplorer === explorer) {\r\n      this.activeExplorer = null;\r\n    } else {\r\n      this.activeExplorer = explorer;\r\n    }\r\n  }\r\n\r\n  createTemplate(folder?: string) {\r\n    let question = 'File name:';\r\n    let suggestion = defaultTemplateName;\r\n    if (folder === 'api' || folder?.startsWith('api/')) {\r\n      question = 'Controller name:';\r\n      suggestion = defaultControllerName;\r\n    }\r\n    let name = prompt(question, suggestion);\r\n    if (name === null || name.length === 0) { return; }\r\n\r\n    name = this.sanitizeService.sanitizePath(name);\r\n    if (folder != null) {\r\n      name = `${folder}/${name}`;\r\n    }\r\n    this.sourceService.createTemplate(name).subscribe(res => {\r\n      this.sourceService.getTemplates().subscribe(files => {\r\n        this.templates$.next(files);\r\n      });\r\n    });\r\n  }\r\n\r\n  changeInsertSnipp(snippet: any) {\r\n    this.aceEditorRef.insertSnippet(snippet);\r\n  }\r\n\r\n  codeChanged(code: string) {\r\n    this.view$.next({ ...this.view$.value, Code: code });\r\n  }\r\n\r\n  save() {\r\n    this.snackBar.open('Saving...');\r\n    let codeToSave = this.view$.value.Code;\r\n    this.sourceService.save(this.viewKey, this.view$.value).subscribe({\r\n      next: res => {\r\n        if (!res) {\r\n          this.snackBar.open('Failed', null, { duration: 2000 });\r\n          return;\r\n        }\r\n        this.savedCode = codeToSave;\r\n        codeToSave = null;\r\n        this.snackBar.open('Saved', null, { duration: 2000 });\r\n      },\r\n      error: () => {\r\n        this.snackBar.open('Failed', null, { duration: 2000 });\r\n      }\r\n    });\r\n  }\r\n\r\n  private calculateViewKey() {\r\n    // spm TODO: Move items for code-editor to the url?\r\n    const itemsRaw = sessionStorage.getItem(keyItems);\r\n    const editItems: EditItem[] | SourceItem[] = JSON.parse(itemsRaw);\r\n    const item = editItems[0];\r\n    this.viewKey = (item as EditItem).EntityId || (item as SourceItem).Path;\r\n  }\r\n\r\n  /** Show info about editions if other files with the same name exist */\r\n  private showCodeAndEditionWarnings(view: SourceView, files: string[]) {\r\n    const pathAndName = view.FileName;\r\n    const pathSeparator = pathAndName.indexOf('/') > -1 ? pathAndName.lastIndexOf('/') + 1 : 0;\r\n    const pathWithSlash = pathSeparator === 0 ? '' : pathAndName.substring(0, pathSeparator);\r\n    const fullName = pathAndName.substring(pathSeparator);\r\n    const name = fullName.substring(0, fullName.length - view.Extension.length);\r\n    const nameCode = name + '.code' + view.Extension;\r\n    // find out if we also have a code file\r\n    const codeFile = files.find(file => file === pathWithSlash + nameCode);\r\n    const otherEditions = files.filter(file => file.endsWith(fullName)).length - 1;\r\n\r\n    if (codeFile) {\r\n      this.snackBarStack\r\n        .add(`This template also has a code-behind file '${codeFile}'.`, 'Open')\r\n        .subscribe(() => {\r\n          this.dialogService.openCodeFile(codeFile);\r\n        });\r\n    }\r\n    if (otherEditions) {\r\n      this.snackBarStack\r\n        .add(`There are ${otherEditions} other editions of this. You may be editing an edition which is not the one you see.`, 'Help')\r\n        .subscribe(() => {\r\n          window.open('https://r.2sxc.org/polymorphism', '_blank');\r\n        });\r\n    }\r\n  }\r\n\r\n  private attachListeners() {\r\n    this.zone.runOutsideAngular(() => {\r\n      this.subscription.add(\r\n        fromEvent(window, 'beforeunload').subscribe((event: BeforeUnloadEvent) => {\r\n          if (this.savedCode === this.view$.value.Code) { return; }\r\n          event.preventDefault();\r\n          event.returnValue = ''; // fix for Chrome\r\n        })\r\n      );\r\n      this.subscription.add(\r\n        fromEvent(window, 'keydown').subscribe((event: KeyboardEvent) => {\r\n          const CTRL_S = event.keyCode === 83 && (navigator.platform.match('Mac') ? event.metaKey : event.ctrlKey);\r\n          if (!CTRL_S) { return; }\r\n          event.preventDefault();\r\n          this.zone.run(() => { this.save(); });\r\n        })\r\n      );\r\n    });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { CodeEditorComponent } from './code-editor.component';\r\n\r\nconst routes: Routes = [\r\n  { path: '', component: CodeEditorComponent },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class CodeEditorRoutingModule { }\r\n","import { CommonModule } from '@angular/common';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatRippleModule } from '@angular/material/core';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { TranslateLoader, TranslateModule, TranslateService } from '@ngx-translate/core';\r\nimport { TranslateHttpLoader } from '@ngx-translate/http-loader';\r\nimport { SanitizeService } from '../../../../edit/eav-material-controls/adam/sanitize.service';\r\nimport { Context } from '../shared/services/context';\r\nimport { DialogService } from '../shared/services/dialog.service';\r\nimport { SharedComponentsModule } from '../shared/shared-components.module';\r\nimport { AceEditorComponent } from './ace-editor/ace-editor.component';\r\nimport { CodeEditorRoutingModule } from './code-editor-routing.module';\r\nimport { CodeEditorComponent } from './code-editor.component';\r\nimport { CodeSnippetsComponent } from './code-snippets/code-snippets.component';\r\nimport { ObjectToArrayPipe } from './code-snippets/object-to-array.pipe';\r\nimport { CodeTemplatesComponent } from './code-templates/code-templates.component';\r\nimport { DepthPaddingPipe } from './code-templates/depth-padding.pipe';\r\nimport { SortItemsPipe } from './code-templates/order-items.pipe';\r\nimport { SnippetsService } from './services/snippets.service';\r\nimport { SourceService } from './services/source.service';\r\n\r\ndeclare const sxcVersion: string;\r\n\r\nexport function translateLoaderFactory(http: HttpClient) {\r\n  return new TranslateHttpLoader(http, './i18n/code-editor.', `.js?${sxcVersion}`);\r\n}\r\n\r\n@NgModule({\r\n  declarations: [\r\n    CodeEditorComponent,\r\n    CodeSnippetsComponent,\r\n    ObjectToArrayPipe,\r\n    CodeTemplatesComponent,\r\n    AceEditorComponent,\r\n    DepthPaddingPipe,\r\n    SortItemsPipe,\r\n  ],\r\n  entryComponents: [\r\n    CodeEditorComponent,\r\n    CodeSnippetsComponent,\r\n    CodeTemplatesComponent,\r\n    AceEditorComponent,\r\n  ],\r\n  imports: [\r\n    CodeEditorRoutingModule,\r\n    SharedComponentsModule,\r\n    CommonModule,\r\n    MatDialogModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatSnackBarModule,\r\n    FormsModule,\r\n    MatSelectModule,\r\n    MatRippleModule,\r\n    TranslateModule.forChild({\r\n      loader: {\r\n        provide: TranslateLoader,\r\n        useFactory: (translateLoaderFactory),\r\n        deps: [HttpClient],\r\n      },\r\n      defaultLanguage: 'en',\r\n      isolate: true,\r\n    }),\r\n  ],\r\n  providers: [\r\n    Context,\r\n    SourceService,\r\n    DialogService,\r\n    SnippetsService,\r\n    SanitizeService,\r\n    TranslateService,\r\n  ]\r\n})\r\nexport class CodeEditorModule { }\r\n"],"sourceRoot":"webpack:///"}