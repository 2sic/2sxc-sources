(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_ng-dialogs_src_app_visual-query_visual-query_module_ts"],{6041:function(t,e,n){"use strict";n.r(e),n.d(e,{VisualQueryModule:function(){return Qt}});var i=n(1116),o=n(4369),r=n(2935),a=n(7307),s=n(9572),u=n(3589),l=n(7173),c=n(2832),p=n(3584),d=n(3582),f=n(2677),g=n(4762),h=n(9996),y=n(5151),m=n(5803),v=n(1785),b=n(2693),Z=n(2837),_=function(){function t(t,e,n){this.http=t,this.context=e,this.dnnContext=n}return t.prototype.fetchPipeline=function(t,e){var n=this;return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y.TB),{params:{appId:this.context.appId.toString(),id:t.toString()}}).pipe((0,h.U)(function(t){return t.DataSources.length||n.buildDefaultModel(t,e),n.fixPipelineDataSources(t.DataSources),t}))},t.prototype.buildDefaultModel=function(t,e){var n,i,o=m.Z.pipelineDesigner.defaultPipeline.dataSources,r=function(n){var i=e.find(function(t){return t.PartAssemblyAndType===n.PartAssemblyAndType});t.DataSources.push({Description:"",EntityGuid:n.EntityGuid,EntityId:void 0,Name:i.Name,PartAssemblyAndType:n.PartAssemblyAndType,VisualDesignerData:n.VisualDesignerData})};try{for(var a=(0,g.XA)(o),s=a.next();!s.done;s=a.next())r(s.value)}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}t.Pipeline.StreamWiring=m.Z.pipelineDesigner.defaultPipeline.streamWiring},t.prototype.fixPipelineDataSources=function(t){var e,n,i;if(!t.some(function(t){return t.EntityGuid===m.Z.pipelineDesigner.outDataSource.EntityGuid})){var o=m.Z.pipelineDesigner.outDataSource;t.push({Description:o.Description,EntityGuid:o.EntityGuid,EntityId:void 0,Name:o.Name,PartAssemblyAndType:o.PartAssemblyAndType,VisualDesignerData:o.VisualDesignerData})}try{for(var r=(0,g.XA)(t),a=r.next();!a.done;a=r.next()){var s=a.value;null!==(i=s.VisualDesignerData)&&void 0!==i||(s.VisualDesignerData={Top:50,Left:50})}}catch(u){e={error:u}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.fetchDataSources=function(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y.bf)).pipe((0,h.U)(function(t){var e=m.Z.pipelineDesigner.outDataSource;return t.push({ContentType:void 0,Difficulty:m.Z.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:e.In,Name:e.Name,Out:void 0,PartAssemblyAndType:e.PartAssemblyAndType,PrimaryType:e.PrimaryType,UiHint:void 0}),t}))},t.prototype.typeNameFilter=function(t,e){var n=t.split(", ");switch(e){case"classFullName":return n[0];case"className":var i=n[0].split(".");return i[i.length-1];default:return t}},t.prototype.savePipeline=function(t){var e=this,n=t.Pipeline,i=t.DataSources;return this.http.post(this.dnnContext.$2sxc.http.apiUrl(y.nt),{pipeline:n,dataSources:i},{params:{appId:this.context.appId.toString(),Id:n.EntityId.toString()}}).pipe((0,h.U)(function(t){return e.fixPipelineDataSources(t.DataSources),t}))},t.prototype.runPipeline=function(t,e){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y.cv),{params:{appId:this.context.appId.toString(),id:t.toString(),top:e.toString()}})},t.prototype.debugStream=function(t,e,n,i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y.Az),{params:{appId:this.context.appId.toString(),id:t.toString(),from:e,out:n,top:i.toString()}})},t.\u0275fac=function(e){return new(e||t)(v.LFG(b.eN),v.LFG(d._),v.LFG(Z._y))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac}),t}(),x=n(1282),S=n(5788),T=n(7860),A=n(8512),P=n(7570),C=n(1305),D=n(7983),w={Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function k(t,e){var n,i,o={},r=function(t){var n=void 0,i=e.find(function(e){return e.PartAssemblyAndType===t.PartAssemblyAndType});i&&(n=(0,g.pi)({},i.PrimaryType?w[i.PrimaryType]:w.Unknown),null!=i.Icon&&(n.Icon=i.Icon),null!=i.DynamicIn&&(n.DynamicIn=i.DynamicIn),null!=i.DynamicOut&&(n.DynamicOut=i.DynamicOut),null!=i.HelpLink&&(n.HelpLink=i.HelpLink),null!=i.EnableConfig&&(n.EnableConfig=i.EnableConfig),null!=i.UiHint&&(n.UiHint=i.UiHint)),n||(n=(0,g.pi)({},w.Unknown)),o[t.EntityGuid]=n};try{for(var a=(0,g.XA)(t),s=a.next();!s.done;s=a.next())r(s.value)}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o}var q="dataSource_",O=function(){function t(t,e,n,i,o,r){var a=this;this.jsPlumbRoot=t,this.pipelineModel=e,this.dataSources=n,this.onConnectionsChanged=i,this.onDragend=o,this.onDebugStream=r,this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(function(){a.initDomDataSources(),a.initWirings(),a.bindEvents()}),this.instance.repaintEverything()}return t.prototype.destroy=function(){this.instance.reset(),this.instance.unbindContainer()},t.prototype.removeEndpointsOnDataSource=function(t){var e=this,n=q+t;this.bulkDelete=!0,this.instance.batch(function(){e.instance.selectEndpoints({element:n}).delete()}),this.bulkDelete=!1},t.prototype.getAllConnections=function(){return this.instance.getAllConnections().map(function(t){return{From:t.sourceId.replace(q,""),Out:t.endpoints[0].getOverlay("endpointLabel").label,To:t.targetId.replace(q,""),In:t.endpoints[1].getOverlay("endpointLabel").label}})},t.prototype.getStreamsOut=function(){var t=[];return this.instance.selectEndpoints({target:"dataSource_Out"}).each(function(e){t.push(e.getOverlay("endpointLabel").label)}),t.join(",")},t.prototype.putEntityCountOnConnections=function(t){var e,n=this;null===(e=t.Streams)||void 0===e||e.forEach(function(t){var e,i,o=q+t.Source,r=(["00000000-0000-0000-0000-000000000000",n.pipelineModel.Pipeline.EntityGuid].includes(t.Target)?"dataSource_Out":q+t.Target)+"_in_"+t.TargetIn,a=n.instance.getEndpoint(o+"_out_"+t.SourceOut);null===(i=null===(e=null==a?void 0:a.connections)||void 0===e?void 0:e.filter(function(t){return t.endpoints[1].getUuid()===r}))||void 0===i||i.forEach(function(e){var i=t.Error?"":t.Count.toString();e.setLabel({label:i,cssClass:"streamEntitiesCount "+(t.Error?"streamEntitiesError":""),events:{click:function(e){n.pipelineModel.Pipeline.AllowEdit&&n.onDebugStream(t)}}})})})},t.prototype.nextLinePaintStyle=function(t){return this.uuidColorMap[t]||(this.uuidColorMap[t]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))},t.prototype.getInstanceDefaults=function(t){return{Container:t,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}},t.prototype.initDomDataSources=function(){var t,e,n,i,o=this,r=function(t){var e=a.jsPlumbRoot.querySelector("#dataSource_"+t.EntityGuid);if(!e)return"continue";var r=a.dataSources.find(function(e){return e.PartAssemblyAndType===t.PartAssemblyAndType});if(!r)return"continue";if(a.pipelineModel.Pipeline.AllowEdit&&a.instance.draggable(e,{grid:[20,20],stop:function(t){var e=t.el.id.replace(q,""),n={Top:t.finalPos[1],Left:t.finalPos[0]};setTimeout(function(){o.onDragend(e,n)})}}),null===(n=r.Out)||void 0===n||n.forEach(function(n){o.addEndpoint(e,n,!1,t)}),null===(i=r.In)||void 0===i||i.forEach(function(n){o.addEndpoint(e,n,!0,t)}),r.In){var s=a.buildTargetEndpoint();s.maxConnections=-1,a.instance.makeTarget(e,s)}r.DynamicOut&&a.instance.makeSource(e,a.buildSourceEndpoint(),{filter:".add-endpoint"})},a=this;try{for(var s=(0,g.XA)(this.pipelineModel.DataSources),u=s.next();!u.done;u=s.next())r(u.value)}catch(l){t={error:l}}finally{try{u&&!u.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}},t.prototype.initWirings=function(){var t,e=this;null===(t=this.pipelineModel.Pipeline.StreamWiring)||void 0===t||t.forEach(function(t){var n=q+t.From,i=n+"_out_"+t.Out,o=q+t.To,r=o+"_in_"+t.In;if(!e.instance.getEndpoint(i)){if(!(u=e.jsPlumbRoot.querySelector("#"+n)))return;var a=u.id.replace(q,""),s=e.pipelineModel.DataSources.find(function(t){return t.EntityGuid===a});e.addEndpoint(u,t.Out,!1,s)}if(!e.instance.getEndpoint(r)){var u;if(!(u=e.jsPlumbRoot.querySelector("#"+o)))return;var l=u.id.replace(q,"");s=e.pipelineModel.DataSources.find(function(t){return t.EntityGuid===l}),e.addEndpoint(u,t.In,!0,s)}try{e.instance.connect({uuids:[i,r],paintStyle:e.nextLinePaintStyle(i)})}catch(c){console.error({message:"Connection failed",from:i,to:r})}})},t.prototype.addEndpoint=function(t,e,n,i){var o,r,a,s,u=this,l=this.dataSources.find(function(t){return t.PartAssemblyAndType===i.PartAssemblyAndType}),c=n?!(null===(o=l.In)||void 0===o?void 0:o.some(function(t){return u.getEndpointInfo(t,!1)})):!(null===(r=l.Out)||void 0===r?void 0:r.some(function(t){return u.getEndpointInfo(t,!1)})),p=this.getEndpointInfo(e,c);s=c?"dynamic":p.required?(null===(a=this.pipelineModel.Pipeline.StreamWiring)||void 0===a?void 0:a.some(function(e){return q+e.To===t.id&&e.In===p.name}))?"":"required":"";var d=t.id+(n?"_in_":"_out_")+p.name,f=n?this.buildTargetEndpoint(s):this.buildSourceEndpoint(s);this.instance.addEndpoint(t,f,{uuid:d,enabled:this.pipelineModel.Pipeline.AllowEdit||i.EntityGuid===m.Z.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel").setLabel(p.name)},t.prototype.buildSourceEndpoint=function(t){var e;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(e="sourceEndpoint "+t)&&void 0!==e?e:"",maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(!0)}},t.prototype.buildTargetEndpoint=function(t){var e;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(e="targetEndpoint "+t)&&void 0!==e?e:"",maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"}}},t.prototype.getEndpointOverlays=function(t){var e=this;return[["Label",{id:"endpointLabel",location:[.5,t?0:1],label:"Default",cssClass:t?"endpointSourceLabel":"endpointTargetLabel",events:{click:function(t){if(e.pipelineModel.Pipeline.AllowEdit){var n=prompt("Rename stream",t.label);n&&(t.setLabel(n),setTimeout(function(){e.onConnectionsChanged()}))}}}}]]},t.prototype.bindEvents=function(){var t=this;this.instance.bind("connectionDetached",function(e){if(!t.bulkDelete){var n=e.target,i=t.pipelineModel.DataSources.find(function(t){return t.EntityGuid===n.id.replace(q,"")}),o=t.dataSources.find(function(t){return t.PartAssemblyAndType===i.PartAssemblyAndType}),r=e.targetEndpoint.getOverlay("endpointLabel").label;o.In.some(function(e){return t.getEndpointInfo(e,!1).name===r})||t.instance.deleteEndpoint(e.targetEndpoint),setTimeout(function(){t.onConnectionsChanged()})}}),this.instance.bind("connection",function(e){if(e.sourceId!==e.targetId){var n=e.targetEndpoint.getOverlay("endpointLabel"),i=n.getLabel();t.instance.getEndpoints(e.target.id).some(function(t){return t.getOverlay("endpointLabel").getLabel()===i&&e.targetEndpoint.id!==t.id&&t.canvas.classList.contains("targetEndpoint")})&&n.setLabel("PleaseRename"+Math.floor(99999*Math.random())),setTimeout(function(){t.onConnectionsChanged()})}else setTimeout(function(){t.instance.deleteConnection(e.connection,{fireEvent:!1}),setTimeout(function(){t.onConnectionsChanged()})})})},t.prototype.getEndpointInfo=function(t,e){var n,i;if(e)n=t,i=!1;else{var o=t.trim();n=(i=o.endsWith("*"))?o.substring(0,o.length-1):o}return{name:n,required:i}},t}(),I=n(2417),E=n(5959),M=n(7254),U=n(3835),N=n(6238),Q=n(2855),$=n(2420),L=n(7512);function R(t,e){if(1&t&&(v.ynx(0),v._uU(1),v.BQk()),2&t){var n=v.oxw();v.xp6(1),v.AsE(' for Stream: "',n.debugStream.name,'" on Source: "',n.debugStream.sourceName,'" ')}}function F(t,e){1&t&&(v.TgZ(0,"div",12),v.TgZ(1,"span"),v._uU(2,"Results"),v.qZA(),v.qZA())}function J(t,e){1&t&&(v.ynx(0),v._uU(1,"Showing All results"),v.BQk())}function H(t,e){if(1&t&&(v.ynx(0),v._uU(1),v.BQk()),2&t){var n=v.oxw();v.xp6(1),v.hij("Showing top ",n.top," results")}}function G(t,e){1&t&&(v.ynx(0),v._uU(1,"All"),v.BQk())}function Y(t,e){if(1&t&&(v.ynx(0),v._uU(1),v.BQk()),2&t){var n=v.oxw().$implicit;v.xp6(1),v.Oqu(n)}}function j(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"button",13),v.NdJ("click",function(){var t=v.CHM(n).$implicit;return v.oxw().show(t)}),v._uU(1," Show "),v.YNc(2,G,2,0,"ng-container",2),v.YNc(3,Y,2,1,"ng-container",2),v.qZA()}if(2&t){var i=e.$implicit;v.xp6(2),v.Q6J("ngIf",0===i),v.xp6(1),v.Q6J("ngIf",0!==i)}}function B(t,e){1&t&&(v.TgZ(0,"div",15),v.TgZ(1,"span"),v._uU(2,"Parameters"),v.qZA(),v.qZA())}function z(t,e){if(1&t&&(v.TgZ(0,"li"),v._uU(1),v.qZA()),2&t){var n=e.$implicit;v.xp6(1),v.Oqu(n)}}function W(t,e){if(1&t&&(v.TgZ(0,"mat-tab"),v.YNc(1,B,3,0,"div",14),v._UZ(2,"br"),v.TgZ(3,"ul",7),v.YNc(4,z,2,1,"li",10),v.qZA(),v.qZA()),2&t){var n=v.oxw();v.xp6(4),v.Q6J("ngForOf",n.parameters)}}function V(t,e){1&t&&(v.TgZ(0,"div",16),v.TgZ(1,"span"),v._uU(2,"Sources"),v.qZA(),v.qZA())}function X(t,e){if(1&t&&(v.TgZ(0,"li"),v.TgZ(1,"b"),v._uU(2),v.qZA(),v._uU(3,"="),v.TgZ(4,"em"),v._uU(5),v.qZA(),v.qZA()),2&t){var n=e.$implicit;v.xp6(2),v.Oqu(n.key),v.xp6(3),v.Oqu(n.value)}}function K(t,e){if(1&t&&(v.TgZ(0,"tr"),v.TgZ(1,"td"),v.TgZ(2,"pre"),v._uU(3),v.qZA(),v.qZA(),v.TgZ(4,"td"),v._uU(5),v.qZA(),v.TgZ(6,"td"),v.TgZ(7,"ol"),v.YNc(8,X,6,2,"li",10),v.ALo(9,"keyvalue"),v.qZA(),v.qZA(),v.TgZ(10,"td"),v._uU(11),v.qZA(),v.qZA()),2&t){var n=e.$implicit;v.xp6(3),v.Oqu(n.value.Guid),v.xp6(2),v.Oqu(n.value.Type),v.xp6(3),v.Q6J("ngForOf",v.lcZ(9,4,n.value.Configuration)),v.xp6(3),v.Oqu(n.value.Error)}}function tt(t,e){1&t&&(v.TgZ(0,"div",17),v.TgZ(1,"span"),v._uU(2,"Streams"),v.qZA(),v.qZA())}function et(t,e){if(1&t&&(v.TgZ(0,"tr"),v.TgZ(1,"td"),v.TgZ(2,"pre"),v._uU(3),v.qZA(),v.qZA(),v.TgZ(4,"td"),v.TgZ(5,"pre"),v._uU(6),v.qZA(),v.qZA(),v.TgZ(7,"td"),v._uU(8),v.qZA(),v.TgZ(9,"td"),v._uU(10),v.qZA(),v.qZA()),2&t){var n=e.$implicit;v.xp6(3),v.Oqu(n.Source+":"+n.SourceOut),v.xp6(3),v.Oqu(n.Target+":"+n.TargetIn),v.xp6(2),v.Oqu(n.Count),v.xp6(2),v.Oqu(n.Error)}}var nt=function(){function t(t,e,n){this.dialogData=t,this.dialogRef=e,this.visualQueryService=n}return t.prototype.ngOnInit=function(){var t,e,n,i,o=this.visualQueryService.pipelineModel$.value.Pipeline,r=(null!==(e=null===(t=o.Params)||void 0===t?void 0:t.split("\n"))&&void 0!==e?e:[]).filter(function(t){return!!t}),a=(null!==(i=null===(n=o.TestParameters)||void 0===n?void 0:n.split("\n"))&&void 0!==i?i:[]).filter(function(t){return!!t});this.parameters=[].concat(r,a),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams},t.prototype.closeDialog=function(){this.dialogRef.close()},t.prototype.show=function(t){t!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,t):this.visualQueryService.runPipeline(t),this.closeDialog())},t.\u0275fac=function(e){return new(e||t)(v.Y36(r.WI),v.Y36(r.so),v.Y36(rt))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-query-result"]],decls:50,vars:14,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-description"],["dynamicHeight","","color","accent"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"description"],["mat-button","",3,"click",4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],[4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(t,e){1&t&&(v.TgZ(0,"div",0),v.TgZ(1,"div",1),v.TgZ(2,"div"),v._uU(3," Query Results "),v.YNc(4,R,2,2,"ng-container",2),v.qZA(),v.TgZ(5,"button",3),v.NdJ("click",function(){return e.closeDialog()}),v.TgZ(6,"mat-icon"),v._uU(7,"close"),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v.TgZ(8,"p",4),v._uU(9),v.qZA(),v.TgZ(10,"mat-tab-group",5),v.TgZ(11,"mat-tab"),v.YNc(12,F,3,0,"div",6),v.TgZ(13,"p",7),v.YNc(14,J,2,0,"ng-container",2),v.YNc(15,H,2,1,"ng-container",2),v.YNc(16,j,4,2,"button",8),v.qZA(),v.TgZ(17,"pre"),v._uU(18),v.ALo(19,"json"),v.qZA(),v.qZA(),v.YNc(20,W,5,1,"mat-tab",2),v.TgZ(21,"mat-tab"),v.YNc(22,V,3,0,"div",9),v._UZ(23,"br"),v.TgZ(24,"table",7),v.TgZ(25,"tr"),v.TgZ(26,"th"),v._uU(27,"Guid"),v.qZA(),v.TgZ(28,"th"),v._uU(29,"Type"),v.qZA(),v.TgZ(30,"th"),v._uU(31,"Configuration"),v.qZA(),v.TgZ(32,"th"),v._uU(33,"Error"),v.qZA(),v.qZA(),v.YNc(34,K,12,6,"tr",10),v.ALo(35,"keyvalue"),v.qZA(),v.qZA(),v.TgZ(36,"mat-tab"),v.YNc(37,tt,3,0,"div",11),v._UZ(38,"br"),v.TgZ(39,"table",7),v.TgZ(40,"tr"),v.TgZ(41,"th"),v._uU(42,"Source"),v.qZA(),v.TgZ(43,"th"),v._uU(44,"Target"),v.qZA(),v.TgZ(45,"th"),v._uU(46,"Items"),v.qZA(),v.TgZ(47,"th"),v._uU(48,"Error"),v.qZA(),v.qZA(),v.YNc(49,et,11,4,"tr",10),v.qZA(),v.qZA(),v.qZA()),2&t&&(v.xp6(4),v.Q6J("ngIf",e.debugStream),v.xp6(5),v.AsE(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",e.timeUsed,"ms (",e.ticksUsed," ticks)\n"),v.xp6(5),v.Q6J("ngIf",0===e.top),v.xp6(1),v.Q6J("ngIf",0!==e.top),v.xp6(1),v.Q6J("ngForOf",e.optionsForTop),v.xp6(2),v.Oqu(v.lcZ(19,10,e.result)),v.xp6(2),v.Q6J("ngIf",null==e.parameters?null:e.parameters.length),v.xp6(14),v.Q6J("ngForOf",v.lcZ(35,12,e.sources)),v.xp6(15),v.Q6J("ngForOf",e.streams))},directives:[r.uh,i.O5,o.lW,L.$,a.Hw,l.SP,l.uX,l.uD,i.sg],pipes:[i.Ts,i.Nd],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]}),t}(),it=function(){function t(t,e){this.dialogData=t,this.dialogRef=e}return t.prototype.ngOnInit=function(){this.errorData=this.dialogData.errorData},t.prototype.closeDialog=function(){this.dialogRef.close()},t.prototype.openInsights=function(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api"),"_blank")},t.\u0275fac=function(e){return new(e||t)(v.Y36(r.WI),v.Y36(r.so))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],["mat-button","","tippy","Open 2sxc Insights",3,"click"]],template:function(t,e){1&t&&(v.TgZ(0,"div",0),v.TgZ(1,"div",1),v.TgZ(2,"div"),v._uU(3,"Stream Error Results"),v.qZA(),v.TgZ(4,"button",2),v.NdJ("click",function(){return e.closeDialog()}),v.TgZ(5,"mat-icon"),v._uU(6,"close"),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v._UZ(7,"br"),v.TgZ(8,"pre"),v._uU(9),v.ALo(10,"json"),v.qZA(),v.TgZ(11,"div"),v.TgZ(12,"button",3),v.NdJ("click",function(){return e.openInsights()}),v.TgZ(13,"mat-icon"),v._uU(14,"speed"),v.qZA(),v.TgZ(15,"span"),v._uU(16,"Insights"),v.qZA(),v.qZA(),v.qZA()),2&t&&(v.xp6(9),v.Oqu(v.lcZ(10,1,e.errorData)))},directives:[r.uh,o.lW,L.$,a.Hw],pipes:[i.Ts],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]}),t}(),ot=n(9624),rt=function(){function t(t,e,n,i,o,r,a,s,u,l,c){this.router=t,this.route=e,this.queryDefinitionService=n,this.titleService=i,this.snackBar=o,this.dialog=r,this.viewContainerRef=a,this.zone=s,this.metadataService=u,this.contentTypesService=l,this.changeDetectorRef=c,this.pipelineModel$=new A.X(null),this.dataSources$=new A.X(null),this.putEntityCountOnConnections$=new E.xQ,this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.doRefresh=!1,this.subscription=new P.w}return t.prototype.ngOnDestroy=function(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),this.subscription.unsubscribe()},t.prototype.init=function(){var t=this;this.fetchDataSources(function(){return t.fetchPipeline()}),this.attachKeyboardSave(),this.refreshOnChildClosed()},t.prototype.editPipelineEntity=function(){var t=this;this.savePipeline(function(){var e=(0,$.f)({items:[{EntityId:t.pipelineModel$.value.Pipeline.EntityId}]});t.doRefresh=!0,t.router.navigate(["edit/"+e],{relativeTo:t.route})})},t.prototype.saveAndRun=function(t,e){var n=this;t&&e?this.savePipeline(function(){n.runPipeline()}):t?this.savePipeline():e&&this.runPipeline()},t.prototype.addDataSource=function(t){var e=(0,I.Z)(this.pipelineModel$.value);e.DataSources.push({Description:"",EntityGuid:"unsaved"+(e.DataSources.length+1),EntityId:void 0,Name:t.Name,PartAssemblyAndType:t.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(e),this.savePipeline()},t.prototype.removeDataSource=function(t,e,n){var i=(0,I.Z)(this.pipelineModel$.value);i.DataSources=i.DataSources.filter(function(e){return e.EntityGuid!==t}),i.Pipeline.StreamWiring=e,i.Pipeline.StreamsOut=n,this.pipelineModel$.next(i)},t.prototype.renameDataSource=function(t,e){var n=(0,I.Z)(this.pipelineModel$.value);n.DataSources.find(function(e){return e.EntityGuid===t}).Name=e,this.pipelineModel$.next(n)},t.prototype.changeDataSourceDescription=function(t,e){var n=(0,I.Z)(this.pipelineModel$.value);n.DataSources.find(function(e){return e.EntityGuid===t}).Description=e,this.pipelineModel$.next(n)},t.prototype.changeConnections=function(t,e){var n=(0,I.Z)(this.pipelineModel$.value);n.Pipeline.StreamWiring=t,n.Pipeline.StreamsOut=e,this.pipelineModel$.next(n)},t.prototype.changeDataSourcePosition=function(t,e){var n=(0,I.Z)(this.pipelineModel$.value),i=n.DataSources.find(function(e){return e.EntityGuid===t});i&&(i.VisualDesignerData=(0,g.pi)((0,g.pi)({},i.VisualDesignerData),e),this.pipelineModel$.next(n))},t.prototype.editDataSource=function(t){var e=this,n=this.dataSources$.value.find(function(e){return e.PartAssemblyAndType===t.PartAssemblyAndType}).ContentType,i=t.EntityGuid;this.metadataService.getMetadata(m.Z.metadata.entity.type,m.Z.keyTypes.guid,i,n).subscribe(function(t){if(t.length){var o=(0,$.f)({items:[{EntityId:t[0].Id}]});e.router.navigate(["edit/"+o],{relativeTo:e.route})}else e.contentTypesService.retrieveContentType(n).subscribe({next:function(t){var o=(0,$.f)({items:[{ContentTypeName:n,For:{Target:m.Z.metadata.entity.target,Guid:i}}]});e.router.navigate(["edit/"+o],{relativeTo:e.route})},error:function(t){alert("Server reports error - this usually means that this data-source doesn't have any configuration")}})})},t.prototype.savePipeline=function(t){var e=this;this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:function(n){e.snackBar.open("Saved",null,{duration:2e3}),e.pipelineModel$.next(n),null!=t&&t()},error:function(t){e.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})},t.prototype.runPipeline=function(t){var e=this;void 0===t&&(t=25),this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,t).subscribe({next:function(n){e.snackBar.open("Query worked",null,{duration:2e3}),e.showQueryResult(n,t),console.warn(n),e.pipelineModel$.next((0,I.Z)(e.pipelineModel$.value)),setTimeout(function(){e.putEntityCountOnConnections$.next(n)})},error:function(t){e.snackBar.open("Query failed",null,{duration:2e3})}})},t.prototype.debugStream=function(t,e){var n=this;void 0===e&&(e=25),t.Error?this.showStreamErrorResult(t):0!==t.Count&&(this.snackBar.open("Running stream..."),this.queryDefinitionService.debugStream(this.pipelineModel$.value.Pipeline.EntityId,t.Source,t.SourceOut,e).subscribe({next:function(i){n.snackBar.open("Stream worked",null,{duration:2e3});var o=n.pipelineModel$.value.DataSources.find(function(e){return e.EntityGuid===t.Source});n.showQueryResult(i,e,{name:t.SourceOut,source:t.Source,sourceName:o.Name,original:t}),console.warn(i)},error:function(t){n.snackBar.open("Stream failed",null,{duration:2e3})}}))},t.prototype.fetchPipeline=function(t){var e=this;void 0===t&&(t=!1),t&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId,this.dataSources$.value).subscribe(function(n){t&&e.snackBar.open("Query reloaded",null,{duration:2e3}),e.pipelineModel$.next(n),e.titleService.setTitle(n.Pipeline.Name+" - Visual Query")})},t.prototype.showQueryResult=function(t,e,n){this.dialog.open(nt,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:t,debugStream:n,top:e},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()},t.prototype.showStreamErrorResult=function(t){this.dialog.open(it,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:t.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()},t.prototype.fetchDataSources=function(t){var e=this;this.queryDefinitionService.fetchDataSources().subscribe(function(n){e.dataSources$.next(n),t()})},t.prototype.attachKeyboardSave=function(){var t=this;this.zone.runOutsideAngular(function(){t.subscription.add((0,M.R)(window,"keydown").pipe((0,U.h)(function(){return!t.route.snapshot.firstChild}),(0,U.h)(function(t){return(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83===t.keyCode})).subscribe(function(e){e.preventDefault(),t.zone.run(function(){t.savePipeline()})}))})},t.prototype.refreshOnChildClosed=function(){var t=this;this.subscription.add(this.router.events.pipe((0,U.h)(function(t){return t instanceof x.m2}),(0,N.O)(!!this.route.snapshot.firstChild),(0,h.U)(function(){return!!t.route.snapshot.firstChild}),(0,Q.G)(),(0,U.h)(function(t){var e=(0,g.CR)(t,2);return e[0]&&!e[1]}),(0,U.h)(function(){var e=t.doRefresh;return t.doRefresh=!1,e})).subscribe(function(){t.fetchPipeline(!0)}))},t.\u0275fac=function(e){return new(e||t)(v.LFG(x.F0),v.LFG(x.gz),v.LFG(_),v.LFG(ot.Dx),v.LFG(u.ux),v.LFG(r.uw),v.LFG(v.s_b),v.LFG(v.R0b),v.LFG(p.D),v.LFG(c.s),v.LFG(v.sBO))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac}),t}(),at=n(2636),st=["domRoot"],ut=["domDataSource"];function lt(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"mat-icon",19),v.NdJ("click",function(){v.CHM(n);var t=v.oxw().$implicit;return v.oxw(3).configureDataSource(t)}),v._uU(1," settings "),v.qZA()}}function ct(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"mat-icon",20),v.NdJ("click",function(){v.CHM(n);var t=v.oxw().$implicit,e=v.oxw(2).ngIf;return v.oxw().openHelp(e.typeInfos[t.EntityGuid].HelpLink)}),v._uU(1," help_outline "),v.qZA()}}function pt(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"mat-icon",21),v.NdJ("click",function(){v.CHM(n);var t=v.oxw().$implicit;return v.oxw(3).remove(t)}),v._uU(1," delete "),v.qZA()}}function dt(t,e){1&t&&(v.TgZ(0,"mat-icon",22),v._uU(1," arrow_drop_up "),v.qZA())}function ft(t,e){1&t&&(v.TgZ(0,"mat-icon",23),v._uU(1," arrow_drop_up "),v.qZA())}var gt=function(t,e,n){return{top:t,left:e,"min-width":n}};function ht(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"div",5,6),v.TgZ(2,"div",7),v.TgZ(3,"mat-icon",8),v._uU(4),v.qZA(),v.YNc(5,lt,2,0,"mat-icon",9),v.YNc(6,ct,2,0,"mat-icon",10),v.qZA(),v.TgZ(7,"div",11),v.YNc(8,pt,2,0,"mat-icon",12),v.qZA(),v.TgZ(9,"div",13),v.NdJ("click",function(){var t=v.CHM(n).$implicit,e=v.oxw(2).ngIf,i=v.oxw();return e.allowEdit&&i.editName(t)}),v.TgZ(10,"span"),v._uU(11),v.qZA(),v.TgZ(12,"mat-icon",14),v._uU(13,"edit"),v.qZA(),v.qZA(),v._UZ(14,"br"),v.TgZ(15,"div",15),v.NdJ("click",function(){var t=v.CHM(n).$implicit,e=v.oxw(2).ngIf,i=v.oxw();return e.allowEdit&&i.editDescription(t)}),v.TgZ(16,"span"),v._uU(17),v.qZA(),v.TgZ(18,"mat-icon",14),v._uU(19,"edit"),v.qZA(),v.qZA(),v._UZ(20,"br"),v.TgZ(21,"div",16),v._uU(22),v.qZA(),v.YNc(23,dt,2,0,"mat-icon",17),v.YNc(24,ft,2,0,"mat-icon",18),v.qZA()}if(2&t){var i=e.$implicit,o=v.oxw(2).ngIf,r=v.oxw();v.Q6J("id",r.dataSrcIdPrefix+i.EntityGuid)("ngStyle",v.kEZ(13,gt,i.VisualDesignerData.Top+"px",i.VisualDesignerData.Left+"px",i.VisualDesignerData.Width?i.VisualDesignerData.Width+"px":null)),v.xp6(3),v.Q6J("title",o.typeInfos[i.EntityGuid].UiHint),v.xp6(1),v.hij(" ",o.typeInfos[i.EntityGuid].Icon," "),v.xp6(1),v.Q6J("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].EnableConfig),v.xp6(1),v.Q6J("ngIf",o.typeInfos[i.EntityGuid].HelpLink),v.xp6(2),v.Q6J("ngIf",o.allowEdit&&!r.isOutDataSource(i)),v.xp6(3),v.Oqu(i.Name||"(no name)"),v.xp6(6),v.Oqu(i.Description),v.xp6(4),v.Q6J("title",i.PartAssemblyAndType),v.xp6(1),v.hij(" Type: ",r.getTypeName(i.PartAssemblyAndType)," "),v.xp6(1),v.Q6J("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].DynamicOut),v.xp6(1),v.Q6J("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].DynamicIn)}}function yt(t,e){if(1&t&&(v.ynx(0),v.YNc(1,ht,25,17,"div",4),v.BQk()),2&t){var n=v.oxw().ngIf;v.xp6(1),v.Q6J("ngForOf",n.pipelineDataSources)}}function mt(t,e){if(1&t&&(v.TgZ(0,"div",1,2),v.YNc(2,yt,2,1,"ng-container",3),v.qZA()),2&t){var n=v.oxw();v.xp6(2),v.Q6J("ngIf",!n.hardReset)}}var vt=function(){function t(t,e,n){this.visualQueryService=t,this.queryDefinitionService=e,this.changeDetectorRef=n,this.dataSrcIdPrefix=q,this.hardReset=!1,this.scriptLoaded$=new A.X(!1),this.subscription=new P.w}return t.prototype.ngOnInit=function(){var t=this;(0,D.y)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],function(){t.scriptLoaded$.next(!0)}),this.subscription.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(function(e){t.plumber.putEntityCountOnConnections(e)})),this.templateModel$=(0,C.aj)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$]).pipe((0,h.U)(function(e){var n=(0,g.CR)(e,2),i=n[0],o=n[1];if(null!=i&&null!=o)return t.hardReset=!0,t.changeDetectorRef.detectChanges(),t.hardReset=!1,{pipelineDataSources:i.DataSources,typeInfos:k(i.DataSources,o),allowEdit:i.Pipeline.AllowEdit}}))},t.prototype.ngAfterViewInit=function(){var t=this,e=this.domDataSourcesRef.changes.pipe((0,h.U)(function(){return!0}));this.subscription.add((0,C.aj)([this.scriptLoaded$,e]).subscribe(function(e){var n,i=(0,g.CR)(e,2);i[0]&&i[1]&&(null===(n=t.plumber)||void 0===n||n.destroy(),t.plumber=new O(t.domRootRef.nativeElement,t.visualQueryService.pipelineModel$.value,t.visualQueryService.dataSources$.value,t.onConnectionsChanged.bind(t),t.onDragend.bind(t),t.onDebugStream.bind(t)))}))},t.prototype.ngOnDestroy=function(){var t;null===(t=this.plumber)||void 0===t||t.destroy(),this.scriptLoaded$.complete(),this.subscription.unsubscribe()},t.prototype.onConnectionsChanged=function(){var t=this.plumber.getAllConnections(),e=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(t,e)},t.prototype.onDragend=function(t,e){this.visualQueryService.changeDataSourcePosition(t,e)},t.prototype.onDebugStream=function(t){this.visualQueryService.debugStream(t)},t.prototype.configureDataSource=function(t){t.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(t)},t.prototype.getTypeName=function(t){return 36===t.length&&t.split("-").length-1==4?t.substring(0,10)+"\u2026":this.queryDefinitionService.typeNameFilter(t,"className")},t.prototype.isOutDataSource=function(t){return t.PartAssemblyAndType===m.Z.pipelineDesigner.outDataSource.PartAssemblyAndType},t.prototype.remove=function(t){if(confirm("Delete "+t.Name+" data source?")){this.plumber.removeEndpointsOnDataSource(t.EntityGuid);var e=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(t.EntityGuid,e,n)}},t.prototype.openHelp=function(t){window.open(t,"_blank")},t.prototype.editName=function(t){var e,n=null===(e=prompt("Rename data source",t.Name))||void 0===e?void 0:e.trim();null!=n&&""!==n&&this.visualQueryService.renameDataSource(t.EntityGuid,n)},t.prototype.editDescription=function(t){var e,n=null===(e=prompt("Edit description",t.Description))||void 0===e?void 0:e.trim();null!=n&&this.visualQueryService.changeDataSourceDescription(t.EntityGuid,n)},t.\u0275fac=function(e){return new(e||t)(v.Y36(rt),v.Y36(_),v.Y36(v.sBO))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-plumb-editor"]],viewQuery:function(t,e){if(1&t&&(v.Gf(st,5),v.Gf(ut,5)),2&t){var n=void 0;v.iGM(n=v.CRH())&&(e.domRootRef=n.first),v.iGM(n=v.CRH())&&(e.domDataSourcesRef=n)}},decls:2,vars:3,consts:[["id","pipeline-root",4,"ngIf"],["id","pipeline-root"],["domRoot",""],[4,"ngIf"],["class","dataSource",3,"id","ngStyle",4,"ngFor","ngForOf"],[1,"dataSource",3,"id","ngStyle"],["domDataSource",""],[1,"actions","left"],[1,"type-info",3,"title"],["class","configure","title","Configure data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],["class","help","title","Help for this data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],[1,"actions","right"],["class","delete","title","Delete","appMousedownStopPropagation","",3,"click",4,"ngIf"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["class","add-endpoint","title","Drag a new Out-Connection",4,"ngIf"],["class","many-in","title","This data source supports multiple In-Connections",4,"ngIf"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],["title","Drag a new Out-Connection",1,"add-endpoint"],["title","This data source supports multiple In-Connections",1,"many-in"]],template:function(t,e){1&t&&(v.YNc(0,mt,3,1,"div",0),v.ALo(1,"async")),2&t&&v.Q6J("ngIf",v.lcZ(1,1,e.templateModel$))},directives:[i.O5,i.sg,i.PC,a.Hw,at.d],pipes:[i.Ov],styles:["","[_nghost-%COMP%]{display:block;width:100%;height:100%}"]}),t}();function bt(t,e){if(1&t&&(v.TgZ(0,"li"),v._uU(1),v.qZA()),2&t){var n=e.$implicit;v.xp6(1),v.hij(" ",n," ")}}function Zt(t,e){if(1&t&&(v.TgZ(0,"ul",15),v.YNc(1,bt,2,1,"li",16),v.qZA()),2&t){var n=v.oxw().ngIf;v.xp6(1),v.Q6J("ngForOf",null==n.Pipeline.Params?null:n.Pipeline.Params.split("\n"))}}function _t(t,e){if(1&t&&(v.TgZ(0,"li"),v._uU(1),v.qZA()),2&t){var n=e.$implicit;v.xp6(1),v.hij(" ",n," ")}}function xt(t,e){if(1&t&&(v.TgZ(0,"ul",15),v.YNc(1,_t,2,1,"li",16),v.qZA()),2&t){var n=v.oxw().ngIf;v.xp6(1),v.Q6J("ngForOf",null==n.Pipeline.TestParameters?null:n.Pipeline.TestParameters.split("\n"))}}function St(t,e){1&t&&v._UZ(0,"li",21),2&t&&v.Q6J("innerHTML",e.$implicit,v.oJD)}function Tt(t,e){if(1&t&&(v.TgZ(0,"div",18),v.TgZ(1,"div",7),v.TgZ(2,"span"),v._uU(3,"Warnings"),v.qZA(),v.TgZ(4,"mat-icon",19),v._uU(5,"warning"),v.qZA(),v.qZA(),v.TgZ(6,"ol",15),v.YNc(7,St,1,1,"li",20),v.qZA(),v.qZA()),2&t){var n=v.oxw().ngIf;v.xp6(7),v.Q6J("ngForOf",n)}}function At(t,e){if(1&t&&(v.ynx(0),v.YNc(1,Tt,8,1,"div",17),v.BQk()),2&t){var n=e.ngIf;v.xp6(1),v.Q6J("ngIf",n.length)}}function Pt(t,e){if(1&t&&(v.TgZ(0,"div",22),v.TgZ(1,"div",7),v._uU(2,"Query Description"),v.qZA(),v.TgZ(3,"div"),v._uU(4),v.qZA(),v.qZA()),2&t){var n=v.oxw().ngIf;v.xp6(4),v.Oqu(n.Pipeline.Description)}}function Ct(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"div",1),v.TgZ(1,"div",2),v.TgZ(2,"div",3),v.TgZ(3,"button",4),v.NdJ("click",function(){return v.CHM(n),v.oxw().saveAndRunQuery(!0,!0)}),v._uU(4," Save and run "),v.qZA(),v.TgZ(5,"button",5),v.NdJ("click",function(){return v.CHM(n),v.oxw().saveAndRunQuery(!1,!0)}),v._uU(6," Run "),v.qZA(),v.TgZ(7,"button",5),v.NdJ("click",function(){return v.CHM(n),v.oxw().saveAndRunQuery(!0,!1)}),v._uU(8," Save "),v.qZA(),v.qZA(),v.TgZ(9,"div",6),v.TgZ(10,"div",7),v.TgZ(11,"div"),v._uU(12,"Query Parameters"),v.qZA(),v.TgZ(13,"div"),v.TgZ(14,"button",8),v.NdJ("click",function(){return v.CHM(n),v.oxw().editPipeline()}),v.TgZ(15,"mat-icon"),v._uU(16,"edit"),v.qZA(),v.qZA(),v.TgZ(17,"button",9),v.NdJ("click",function(){return v.CHM(n),v.oxw().openParamsHelp()}),v.TgZ(18,"mat-icon"),v._uU(19,"info"),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v.YNc(20,Zt,2,1,"ul",10),v.qZA(),v.TgZ(21,"div",6),v.TgZ(22,"div",7),v._uU(23,"Test Parameters"),v.qZA(),v.YNc(24,xt,2,1,"ul",10),v.qZA(),v.YNc(25,At,2,1,"ng-container",11),v.ALo(26,"async"),v.YNc(27,Pt,5,1,"div",12),v.TgZ(28,"div",13),v.TgZ(29,"button",5),v.NdJ("click",function(){return v.CHM(n),v.oxw().openRestApi()}),v.TgZ(30,"span"),v._uU(31,"Use in JSON / REST API"),v.qZA(),v._UZ(32,"mat-icon",14),v.qZA(),v.qZA(),v.qZA(),v.qZA()}if(2&t){var i=e.ngIf,o=v.oxw();v.xp6(20),v.Q6J("ngIf",null==i.Pipeline.Params?null:i.Pipeline.Params.length),v.xp6(4),v.Q6J("ngIf",null==i.Pipeline.TestParameters?null:i.Pipeline.TestParameters.length),v.xp6(1),v.Q6J("ngIf",v.lcZ(26,4,o.warnings$)),v.xp6(2),v.Q6J("ngIf",i.Pipeline.Description)}}var Dt=function(){function t(t,e,n,i){this.router=t,this.route=e,this.context=n,this.visualQueryService=i}return t.prototype.ngOnInit=function(){var t=this;this.pipelineModel$=this.visualQueryService.pipelineModel$,this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,h.U)(function(e){return function(t,e){var n,i,o=[];try{var r=(null===(n=t.Pipeline.Params)||void 0===n?void 0:n.split(/\r?\n/))||[],a=(null===(i=t.Pipeline.TestParameters)||void 0===i?void 0:i.split(/\r?\n/))||[];r.forEach(function(t){(t=null==t?void 0:t.trim())&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(t)||o.push("\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>"+t+"</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        "))}),a.forEach(function(t){if(t=null==t?void 0:t.trim()){/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(t)||o.push("\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>"+t+"</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        ");var n=/^\[module:moduleid\]=([0-9]*)$/gim.exec(t);if(n){var i=n[1],r=e.moduleId.toString();i!==r&&o.push("\n            Your test ModuleId ("+i+") is different from the current ModuleId ("+r+").\n            Note that 2sxc 9.33 automatically provides the ModuleId - so you usually do not need to set it any more.\n          ")}}})}catch(s){console.error("Something went wrong in calculateWarnings for params",s)}return o}(e,t.context)}))},t.prototype.editPipeline=function(){this.visualQueryService.editPipelineEntity()},t.prototype.openParamsHelp=function(){window.open("https://r.2sxc.org/QueryParams","_blank")},t.prototype.saveAndRunQuery=function(t,e){this.visualQueryService.saveAndRun(t,e)},t.prototype.openRestApi=function(){this.router.navigate([T.ii.goToQuery(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)],{relativeTo:this.route})},t.\u0275fac=function(e){return new(e||t)(v.Y36(x.F0),v.Y36(x.gz),v.Y36(d._),v.Y36(rt))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-run-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],["class","values",4,"ngIf"],[4,"ngIf"],["class","description",4,"ngIf"],[1,"footer-actions"],["svgIcon","code-curly"],[1,"values"],[4,"ngFor","ngForOf"],["class","warnings",4,"ngIf"],[1,"warnings"],[2,"color","red"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"description"]],template:function(t,e){1&t&&(v.YNc(0,Ct,33,6,"div",0),v.ALo(1,"async")),2&t&&v.Q6J("ngIf",v.lcZ(1,1,e.pipelineModel$))},directives:[i.O5,o.lW,L.$,a.Hw,i.sg],pipes:[i.Ov],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.description[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]{margin:16px 0}.description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}"]}),t}(),wt=n(447);function kt(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"div",8),v.NdJ("click",function(){var t=v.CHM(n).$implicit;return v.oxw(4).addDataSource(t)}),v.TgZ(1,"mat-icon"),v._uU(2),v.qZA(),v.TgZ(3,"span"),v._uU(4),v.qZA(),v.qZA()}if(2&t){var i=e.$implicit,o=v.oxw(4);v.Q6J("tippy",i.UiHint||i.Name),v.xp6(2),v.Oqu(i.Icon||o.guiTypes.Unknown.Icon),v.xp6(2),v.Oqu(i.Name)}}function qt(t,e){if(1&t&&(v.TgZ(0,"div",6),v.YNc(1,kt,5,3,"div",7),v.qZA()),2&t){var n=v.oxw().$implicit,i=v.oxw(2);v.xp6(1),v.Q6J("ngForOf",n.value)("ngForTrackBy",i.trackDataSources)}}function Ot(t,e){if(1&t){var n=v.EpF();v.ynx(0),v.TgZ(1,"div",4),v.NdJ("click",function(){var t=v.CHM(n).$implicit;return v.oxw(2).toggleItem(t.key)}),v.TgZ(2,"mat-icon"),v._uU(3),v.qZA(),v.TgZ(4,"span"),v._uU(5),v.qZA(),v.qZA(),v.YNc(6,qt,2,2,"div",5),v.BQk()}if(2&t){var i=e.$implicit,o=v.oxw(2);v.xp6(1),v.Q6J("tippy",o.guiTypes[i.key].UiHint||i.key),v.xp6(2),v.Oqu(o.guiTypes[i.key].Icon||o.guiTypes.Unknown.Icon),v.xp6(2),v.Oqu(i.key),v.xp6(1),v.Q6J("ngIf",o.toggledItems.includes(i.key))}}function It(t,e){if(1&t){var n=v.EpF();v.TgZ(0,"div",1),v.TgZ(1,"mat-slide-toggle",2),v.NdJ("change",function(t){return v.CHM(n),v.oxw().toggleDifficulty(t)}),v._uU(2," Show Advanced "),v.qZA(),v.YNc(3,Ot,7,4,"ng-container",3),v.ALo(4,"keyvalue"),v.qZA()}if(2&t){var i=e.ngIf,o=v.oxw();v.xp6(3),v.Q6J("ngForOf",v.lcZ(4,2,i))("ngForTrackBy",o.trackGroups)}}var Et=function(){function t(t){this.visualQueryService=t,this.toggledItems=[],this.guiTypes=w,this.difficulties=m.Z.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new A.X(this.difficulties.default)}return t.prototype.ngOnInit=function(){this.sorted$=(0,C.aj)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,h.U)(function(t){var e=(0,g.CR)(t,2);return function(t,e){var n,i;if(t){var o=(0,I.Z)(t).filter(function(t){return t.Difficulty<=e&&t.PartAssemblyAndType!==m.Z.pipelineDesigner.outDataSource.PartAssemblyAndType});o.sort(function(t,e){return t.Name.toLocaleLowerCase().localeCompare(e.Name.toLocaleLowerCase())});var r={};try{for(var a=(0,g.XA)(o),s=a.next();!s.done;s=a.next()){var u=s.value,l=u.PrimaryType;r[l]?r[l].push(u):r[l]=[u]}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return r}}(e[0],e[1])}))},t.prototype.ngOnDestroy=function(){this.difficulty$.complete()},t.prototype.toggleDifficulty=function(t){this.difficulty$.next(t.checked?this.difficulties.advanced:this.difficulties.default)},t.prototype.addDataSource=function(t){this.visualQueryService.addDataSource(t)},t.prototype.toggleItem=function(t){wt.iX.toggleInArray(t,this.toggledItems)},t.prototype.trackGroups=function(t,e){return e.key},t.prototype.trackDataSources=function(t,e){return e.PartAssemblyAndType},t.\u0275fac=function(e){return new(e||t)(v.Y36(rt))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-add-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],["labelPosition","before",3,"change"],[4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"collapsible",3,"tippy","click"],["class","list",4,"ngIf"],[1,"list"],["class","list-item","tippyShowDelay","750",3,"tippy","click",4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"list-item",3,"tippy","click"]],template:function(t,e){1&t&&(v.YNc(0,It,5,4,"div",0),v.ALo(1,"async")),2&t&&v.Q6J("ngIf",v.lcZ(1,1,e.sorted$))},directives:[i.O5,s.Rr,i.sg,L.$,a.Hw],pipes:[i.Ov,i.Nd],styles:[".mat-slide-toggle[_ngcontent-%COMP%]{margin:6px}.collapsible[_ngcontent-%COMP%], .mat-slide-toggle[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}"]}),t}(),Mt=function(t){return{active:t}},Ut=[{path:"",component:function(){function t(t,e,n){this.context=t,this.route=e,this.visualQueryService=n,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}return t.prototype.ngOnInit=function(){this.visualQueryService.init()},t.prototype.toggleExplorer=function(t){this.activeExplorer=this.activeExplorer===t?null:t},t.prototype.openHelp=function(){window.open("https://r.2sxc.org/visual-query","_blank")},t.\u0275fac=function(e){return new(e||t)(v.Y36(d._),v.Y36(x.gz),v.Y36(rt))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-visual-query"]],viewQuery:function(t,e){var n;1&t&&v.Gf(vt,5),2&t&&v.iGM(n=v.CRH())&&(e.plumbEditor=n.first)},features:[v._Bn([rt])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"ngClass","click"],["tippy","Add",1,"button",3,"ngClass","click"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(t,e){1&t&&(v._UZ(0,"router-outlet"),v.TgZ(1,"div",0),v.TgZ(2,"div",1),v.TgZ(3,"div",2),v.NdJ("click",function(){return e.toggleExplorer(e.explorer.run)}),v.TgZ(4,"mat-icon"),v._uU(5,"play_arrow"),v.qZA(),v.qZA(),v.TgZ(6,"div",3),v.NdJ("click",function(){return e.toggleExplorer(e.explorer.add)}),v.TgZ(7,"mat-icon"),v._uU(8,"add"),v.qZA(),v.qZA(),v._UZ(9,"div",4),v.TgZ(10,"div",5),v.NdJ("click",function(){return e.openHelp()}),v.TgZ(11,"mat-icon"),v._uU(12,"help_outline"),v.qZA(),v.qZA(),v.qZA(),v._UZ(13,"app-run-explorer",6),v._UZ(14,"app-add-explorer",6),v._UZ(15,"app-plumb-editor"),v.qZA()),2&t&&(v.xp6(3),v.Q6J("ngClass",v.VKq(4,Mt,e.activeExplorer===e.explorer.run)),v.xp6(3),v.Q6J("ngClass",v.VKq(6,Mt,e.activeExplorer===e.explorer.add)),v.xp6(7),v.Q6J("hidden",e.activeExplorer!==e.explorer.run),v.xp6(1),v.Q6J("hidden",e.activeExplorer!==e.explorer.add))},directives:[x.lC,L.$,i.mk,a.Hw,Dt,Et,vt],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}.editor-side-toolbar[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{flex-grow:1}"]}),t}(),children:[T.ii.route,{matcher:S.eP,loadChildren:function(){return Promise.all([n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_progress-spinner_js"),n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_menu_js"),n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_list_js"),n.e("default-projects_edit_edit_module_ts"),n.e("default-node_modules_angular_cdk___ivy_ngcc___fesm2015_drag-drop_js"),n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_autocomplete_js"),n.e("node_modules_angular_material___ivy_ngcc___fesm2015_card_js")]).then(n.bind(n,99)).then(function(t){return t.EditModule})},data:{history:!1}}]}],Nt=function(){function t(){}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=v.oAB({type:t}),t.\u0275inj=v.cJS({imports:[[x.Bz.forChild(Ut)],x.Bz]}),t}(),Qt=function(){function t(){}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=v.oAB({type:t}),t.\u0275inj=v.cJS({providers:[d._,_,p.D,c.s],imports:[[i.ez,f.q,Nt,a.Ps,o.ot,s.rP,u.ZX,r.Is,l.Nh]]}),t}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/12.10.00/ng-edit/projects_ng-dialogs_src_app_visual-query_visual-query_module_ts.e6037c9f2cde1a2c1090.js.map