"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts"],{2743:(x,M,n)=>{n.d(M,{b:()=>p});var a=n(8873),C=n(5506),b=n(6163),v=n(7580);let p=(()=>{class l{constructor(o,c){this.contextSvcShared=o,this.context=c,this.log=new C.B("DialogConfigService",!1)}getCurrent$(){const o=this.context.appId;return this.log.a(`getCurrent$ - appId:${o}`),this.contextSvcShared.getShared$(o)}static#e=this.\u0275fac=function(c){return new(c||l)(v.KVO(b.t),v.KVO(a.o))};static#t=this.\u0275prov=v.jDH({token:l,factory:l.\u0275fac})}return l})()},6163:(x,M,n)=>{n.d(M,{t:()=>g});var a=n(6301),C=n(271),b=n(8764),v=n(8873),f=n(5506),m=n(9431),p=n(7580),l=n(6443);let g=(()=>{class u{constructor(_,P,E){this.http=_,this.context=P,this.globalConfigService=E,this.log=new f.B("GlobalDialogConfigService",!1),this.dialogSettings$={},this.log.a(`using context #${this.context.log.svcId}`)}getShared$(_){return this.log.a("getShared$ appId: "+_),this.dialogSettings$[_]??=this.getDialogSettings(_,"getShared$").pipe((0,a.t)({refCount:!1})),this.dialogSettings$[_]}getDialogSettings(_,P){return this.log.a("getDialogSettings",{appId:_,reqBy:P}),this.http.get("admin/dialog/settings",{params:{appId:_??this.context.appId.toString()}}).pipe((0,C.T)(E=>(E.Context.Language.List=E.Context.Language.List.filter(L=>L.IsEnabled),E)),(0,b.M)(E=>{this.globalConfigService.allowDebug(E.Context.Enable.DebugMode)}))}static#e=this.\u0275fac=function(P){return new(P||u)(p.KVO(l.Qq),p.KVO(v.o),p.KVO(m.B))};static#t=this.\u0275prov=p.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},5026:(x,M,n)=>{n.r(M),n.d(M,{ManageContentListComponent:()=>W});var a=n(6571),C=n(7941),b=n(2159),v=n(5797),f=n(9999),m=n(271),p=n(3216),l=n(334),r=n(9669),o=n(852),c=n(316),g=n(3840),u=n(4175),I=n(2275),_=n(7896),P=n(1459),E=n(5437),L=n(2743),j=n(8471),t=n(7580),y=n(3347);function F(d,D){if(1&d){const e=t.RV6();t.j41(0,"span"),t.EFF(1),t.k0s(),t.j41(2,"button",13),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.editHeader())}),t.j41(3,"mat-icon"),t.EFF(4,"edit"),t.k0s()()}if(2&d){const e=t.XpG(2);t.R7$(),t.JRh(e.header.Title)}}function S(d,D){1&d&&(t.EFF(0),t.nI1(1,"translate")),2&d&&t.SpI(" ",t.bMT(1,1,"ManageContentList.NoHeader")," ")}function U(d,D){if(1&d&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.j41(3,"p"),t.DNE(4,F,5,1)(5,S,2,3),t.k0s()),2&d){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,2,"ManageContentList.Description")," "),t.R7$(3),t.vxM(4,e.header.Type?4:5)}}function A(d,D){1&d&&(t.j41(0,"p",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&d&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"ManageContentList.SortItems")," "))}function $(d,D){1&d&&(t.j41(0,"p",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&d&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"ManageContentList.SortLotsOfItems")," "))}function k(d,D){if(1&d){const e=t.RV6();t.j41(0,"div",7)(1,"div",14)(2,"mat-icon",15),t.EFF(3,"drag_handle"),t.k0s(),t.j41(4,"span",16),t.EFF(5),t.k0s()(),t.j41(6,"div")(7,"button",17),t.nI1(8,"translate"),t.bIt("click",function(){const s=t.eBV(e).$implicit,h=t.XpG(2);return t.Njj(h.addFromExisting(s.Index))}),t.j41(9,"mat-icon"),t.EFF(10,"playlist_add"),t.k0s()(),t.j41(11,"button",17),t.nI1(12,"translate"),t.bIt("click",function(){const s=t.eBV(e).$implicit,h=t.XpG(2);return t.Njj(h.addBelow(s.Index))}),t.j41(13,"mat-icon"),t.EFF(14,"add"),t.k0s()(),t.j41(15,"button",17),t.nI1(16,"translate"),t.bIt("click",function(){const s=t.eBV(e).$implicit,h=t.XpG(2);return t.Njj(h.remove(s))}),t.j41(17,"mat-icon"),t.EFF(18,"remove"),t.k0s()(),t.j41(19,"button",17),t.nI1(20,"translate"),t.bIt("click",function(){const s=t.eBV(e).$implicit,h=t.XpG(2);return t.Njj(h.editItem(s.Id))}),t.j41(21,"mat-icon"),t.EFF(22,"edit"),t.k0s()()()()}if(2&d){const e=D.$implicit,i=t.XpG(2);t.R7$(4),t.FCK("tippy","",e.Title," (",e.Id,")"),t.R7$(),t.Lme(" ",e.Title," (",e.Id,") "),t.R7$(2),t.Y8G("tippy",t.bMT(8,13,"Fields.Picker.AddExistingItem"))("disabled",0===e.Id),t.R7$(4),t.Y8G("tippy",t.bMT(12,15,"Fields.Picker.AddItemBelow"))("disabled",0===e.Id||i.reordered),t.R7$(4),t.Y8G("tippy",t.bMT(16,17,"Fields.Picker.Remove"))("disabled",i.reordered),t.R7$(4),t.Y8G("tippy",t.bMT(20,19,"Fields.Picker.Edit"))("disabled",0===e.Id)}}function K(d,D){if(1&d){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3),t.nrm(6,"router-outlet"),t.j41(7,"div",4),t.DNE(8,U,6,4)(9,A,3,3,"p",5)(10,$,3,3,"p",5),t.j41(11,"div",6),t.bIt("cdkDropListDropped",function(s){t.eBV(e);const h=t.XpG();return t.Njj(h.drop(s))}),t.Z7z(12,k,23,21,"div",7,t.BUC().trackByFn,!0),t.k0s()()(),t.j41(14,"mat-dialog-actions",8)(15,"button",9),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.closeDialog())}),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.j41(18,"button",10),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.saveList())}),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"button",11),t.nI1(22,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.saveAndCloseList())}),t.j41(23,"mat-icon",12),t.EFF(24,"done"),t.k0s()()()()}if(2&d){const e=D;t.R7$(3),t.JRh(t.bMT(4,7,"ManageContentList.Title")),t.R7$(5),t.vxM(8,e.header?8:-1),t.R7$(),t.vxM(9,e.items&&(null==e.items?null:e.items.length)<25?9:-1),t.R7$(),t.vxM(10,(null==e.items?null:e.items.length)>=25?10:-1),t.R7$(2),t.Dyx(e.items),t.R7$(4),t.JRh(t.bMT(17,9,"General.Buttons.Cancel")),t.R7$(3),t.JRh(t.bMT(20,11,"General.Buttons.Save")),t.R7$(2),t.Y8G("tippy",t.bMT(22,13,"Form.Buttons.SaveAndClose"))}}let W=(()=>{class d{#e;#t;#i;#n;#o;#s;constructor(e,i,s){this.dialogRef=e,this.snackBar=i,this.translate=s,this.hostClass="dialog-component",this.#e=(0,E.d)(j.c),this.#t=new v.t(null),this.#i=new v.t(null),this.viewModel$=(0,f.z)([this.#t,this.#i]).pipe((0,m.T)(([h,O])=>({items:h,header:O}))),this.#n={id:null,guid:this.#e.snapshot.paramMap.get("guid"),part:this.#e.snapshot.paramMap.get("part"),index:parseInt(this.#e.snapshot.paramMap.get("index"),10)},this.reordered=!1,this.#o=(0,E.d)(r.y),this.#s=(0,E.d)(L.b)}ngOnInit(){this.fetchList(),this.fetchHeader(),this.fetchDialogSettings(),this.#e.doOnDialogClosed(()=>{this.fetchList(!0),this.fetchHeader()})}ngOnDestroy(){this.#t.complete(),this.#i.complete()}fetchDialogSettings(){this.#s.getCurrent$().subscribe(e=>{this.translate.setDefaultLang(e.Context.Language.Primary.split("-")[0]),this.translate.use(e.Context.Language.Current.split("-")[0])})}closeDialog(){this.dialogRef.close()}saveList(){this.snackBar.open("Saving..."),this.#o.saveList(this.#n,this.#t.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.fetchList(),this.fetchHeader()})}saveAndCloseList(){this.snackBar.open("Saving..."),this.#o.saveList(this.#n,this.#t.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()})}editHeader(){const e={items:[l.c.relationship(this.#n.guid,"listcontent",0,0===this.#i.value.Id),l.c.relationship(this.#n.guid,"listpresentation",0,0===this.#i.value.Id)]},i=(0,p.s)(e);this.#e.navRelative([`edit/${i}`])}editItem(e){const i={items:[l.c.editId(e)]},s=(0,p.s)(i);this.#e.navRelative([`edit/${s}`])}addFromExisting(e){this.#e.navRelative([`${this.#n.guid}/${this.#n.part}/${e+1}/replace`],{queryParams:{add:!0}})}addBelow(e){const i={items:[l.c.relationship(this.#n.guid,this.#n.part,e+1,!0)]},s=(0,p.s)(i);this.#e.navRelative([`edit/${s}`])}remove(e){confirm(this.translate.instant("ManageContentList.ConfirmRemove"))&&(this.snackBar.open("Removing..."),this.#o.removeItem(this.#n,e.Index).subscribe(()=>{this.snackBar.open("Removed",null,{duration:2e3}),this.fetchList()}))}drop(e){const i=[...this.#t.value];(0,a.HD)(i,e.previousIndex,e.currentIndex),this.#t.next(i),this.reordered=!0}trackByFn(e,i){return`${i.Index}+${i.Id}`}fetchList(e=!1){this.#o.getList(this.#n).subscribe(i=>{if(this.reordered){const s=this.#t.value.map(O=>O.Id);if(this.#t.value.length===i.length&&!i.some(O=>!s.includes(O.Id))&&e){const O=this.#t.value.map(R=>R.Index);i.sort((R,w)=>{const T=O.indexOf(R.Index),B=O.indexOf(w.Index);return-1===T||-1===B?0:T-B})}else e&&this.snackBar.open("List was changed from somewhere else. Order of items is reset",null,{duration:5e3})}this.#t.next(i),this.reordered=!1})}fetchHeader(){this.#o.getHeader(this.#n).subscribe(e=>{this.#i.next(e)})}static#a=this.\u0275fac=function(i){return new(i||d)(t.rXU(C.CP),t.rXU(y.UG),t.rXU(o.c$))};static#r=this.\u0275cmp=t.VBU({type:d,selectors:[["app-manage-content-list"]],hostVars:1,hostBindings:function(i,s){2&i&&t.Mr5("className",s.hostClass)},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-content"],["cdkScrollable","",1,"dialog-component-content","fancy-scrollbar-light"],[1,"eav-sort-title"],["cdkDropList","",1,"eav-dnd-list",3,"cdkDropListDropped"],["cdkDrag","",1,"eav-dnd-item"],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent",3,"click","tippy"],[1,"eav-raised-button-icon"],["mat-icon-button","","tippy","Edit header",3,"click"],[1,"eav-dnd-item__title"],["tippy","Drag to reorder the list",1,"eav-dnd-item__title-icon"],[1,"eav-dnd-item__title-text",3,"tippy"],["mat-icon-button","","appMousedownStopPropagation","",3,"click","tippy","disabled"]],template:function(i,s){if(1&i&&(t.DNE(0,K,25,15,"div",0),t.nI1(1,"async")),2&i){let h;t.vxM(0,(h=t.bMT(1,1,s.viewModel$))?0:-1,h)}},dependencies:[b.n3,I.uv,u.Hl,u.$z,u.iY,g.m_,g.An,a.O7,a.T1,C.E7,c.Jj,o.h,o.D9,C.hM,_.e,P.z],styles:[".eav-sort-title[_ngcontent-%COMP%]{padding-top:16px}.eav-dnd-list[_ngcontent-%COMP%]{margin:16px 0;border:1px solid #ccc;border-radius:4px;overflow:hidden}.eav-dnd-item[_ngcontent-%COMP%]{cursor:move;height:40px;border-bottom:1px solid #ccc;padding:0 8px;display:flex;align-items:center;justify-content:space-between;background:#fff;box-sizing:border-box;font-size:14px}.eav-dnd-item[_ngcontent-%COMP%]:last-child{border:none}.eav-dnd-item__title[_ngcontent-%COMP%]{display:flex;align-items:center;overflow:hidden;max-width:80%}.eav-dnd-item__title-icon[_ngcontent-%COMP%]{margin-right:8px;opacity:.4}.eav-dnd-item__title-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dnd-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dnd-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return d})()},9431:(x,M,n)=>{n.d(M,{B:()=>f});var a=n(7580),C=n(9074),b=n(8172),v=n(3347);let f=(()=>{class m{constructor(l){this.snackBar=l,this.debugState=(0,a.vPA)(null),this.isDebug=(0,a.EWP)(()=>!!this.debugState()?.allowDebugMode&&!!this.debugState()?.debugEnabled),this.debugEnabled$=(0,C.br)(this.isDebug);const r={id:0,debugEnabled:"true"===sessionStorage.getItem(b.tn),allowDebugMode:!1};this.debugState.set(r)}allowDebug(l){const r=this.debugState();if(r.allowDebugMode===l)return;const o={...r,allowDebugMode:l};this.debugState.set(o)}toggleDebugEnabled(){const l=this.debugState();if(!l.allowDebugMode)return void this.snackBar.open("You do not have permissions to enter developer mode",null,{duration:3e3});const r={...l,debugEnabled:!l.debugEnabled};this.debugState.set(r),this.snackBar.open(r.debugEnabled?"developer mode on":"developer mode off",null,{duration:3e3})}static#e=this.\u0275fac=function(r){return new(r||m)(a.KVO(v.UG))};static#t=this.\u0275prov=a.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()},9074:(x,M,n)=>{n.d(M,{br:()=>p,ot:()=>l});var a=n(7580),C=n(6042);function p(r,o){!o?.injector&&(0,a.Af3)(p);const c=o?.injector??(0,a.WQX)(a.zZn),g=new C.m(1),u=(0,a.QZP)(()=>{let I;try{I=r()}catch(_){return void(0,a.O8t)(()=>g.error(_))}(0,a.O8t)(()=>g.next(I))},{injector:c,manualCleanup:!0});return c.get(a.abz).onDestroy(()=>{u.destroy(),g.complete()}),g.asObservable()}function l(r,o){const c=!o?.manualCleanup;c&&!o?.injector&&(0,a.Af3)(l);const g=c?o?.injector?.get(a.abz)??(0,a.WQX)(a.abz):null;let u;u=(0,a.vPA)(o?.requireSync?{kind:0}:{kind:1,value:o?.initialValue});const I=r.subscribe({next:_=>u.set({kind:1,value:_}),error:_=>{if(o?.rejectErrors)throw _;u.set({kind:2,error:_})}});return g?.onDestroy(I.unsubscribe.bind(I)),(0,a.EWP)(()=>{const _=u();switch(_.kind){case 1:return _.value;case 2:throw _.error;case 0:throw new a.wOt(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.02/dist/ng-edit/projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts.d0c8963e3b7c6e4c.js.map