"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_apps-management_apps-list_apps-list_component_ts"],{3140:(O,v,e)=>{e.d(v,{J:()=>E});var m=e(27092),C=e(99293);let E=(()=>{class f{constructor(){this.subscriptions=new m.yU}ngOnDestroy(){this.subscriptions.unsubscribe()}static#e=this.\u0275fac=function(D){return new(D||f)};static#t=this.\u0275dir=C.FsC({type:f})}return f})()},18537:(O,v,e)=>{e.d(v,{R:()=>l});var m=e(82645),C=e(43942),E=e(1365),f=e(88830),r=e(81530),y=e(38067);const D=["addListener","removeListener"],A=["addEventListener","removeEventListener"],P=["on","off"];function l(s,d,u,g){if((0,r.T)(u)&&(g=u,u=void 0),g)return l(s,d,u).pipe((0,y.I)(g));const[L,S]=function i(s){return(0,r.T)(s.addEventListener)&&(0,r.T)(s.removeEventListener)}(s)?A.map(I=>F=>s[I](d,F,u)):function p(s){return(0,r.T)(s.addListener)&&(0,r.T)(s.removeListener)}(s)?D.map(h(s,d)):function b(s){return(0,r.T)(s.on)&&(0,r.T)(s.off)}(s)?P.map(h(s,d)):[];if(!L&&(0,f.X)(s))return(0,E.Z)(I=>l(I,d,u))((0,m.Tg)(s));if(!L)throw new TypeError("Invalid event target");return new C.c(I=>{const F=(...M)=>I.next(1<M.length?M:M[0]);return L(F),()=>S(F)})}function h(s,d){return u=>g=>s[u](d,g)}},28136:(O,v,e)=>{e.d(v,{T:()=>m});const m={AppSyncWithSiteFiles:"AppSyncWithSiteFiles",WysiwygPasteFormatted:"WysiwygPasteFormatted",PasteImageFromClipboard:"PasteImageFromClipboard",EditUiShowNotes:"EditUiShowNotes",EditUiShowMetadataFor:"EditUiShowMetadataFor",NoSponsoredByToSic:"NoSponsoredByToSic",EditUiTranslateWithGoogle:"EditUiTranslateWithGoogle",LightSpeed:"LightSpeedOutputCache",ContentSecurityPolicy:"ContentSecurityPolicy",PermissionsByLanguage:"PermissionsByLanguage",ContentTypeFieldsReuseDefinitions:"ContentTypeFieldsReuseDefinitions",AppExportAssetsAdvanced:"AppExportAssetsAdvanced",DataExportImportBundles:"DataExportImportBundles",PickerUiCheckbox:"PickerUiCheckbox",PickerUiRadio:"PickerUiRadio",PickerSourceCsv:"PickerSourceCsv",PickerSourceAppAssets:"PickerSourceAppAssets",PickerFormulas:"PickerFormulas",PickerUiMoreInfo:"PickerUiMoreInfo"}},34575:(O,v,e)=>{e.d(v,{S:()=>D});var m=e(37580),C=e(44444),E=e(18537),f=e(3140),r=e(99293),y=e(3347);let D=(()=>{class A extends f.J{constructor(l,h,p){super(),this.zone=h,this.snackBar=p,this.markStyle=(0,m.hFB)("outline"),this.allowedFileTypes=(0,m.hFB)(""),this.filesDropped=(0,m.CGW)(),this.dropAreaClass="eav-droparea",this.markStyleClass=(0,C.vPA)(""),this.dragClass="eav-dragover",this.timeouts=[],this.element=l.nativeElement}ngOnInit(){this.markStyleClass.set(`eav-droparea-${this.markStyle()}`),this.element.classList.add(this.dropAreaClass,this.markStyleClass()),this.zone.runOutsideAngular(()=>{this.subscriptions.add((0,E.R)(this.element,"dragover").subscribe(l=>{l.preventDefault(),l.stopPropagation(),this.clearTimeouts(),this.element.classList.add(this.dragClass)})),this.subscriptions.add((0,E.R)(this.element,"dragleave").subscribe(l=>{l.preventDefault(),l.stopPropagation(),this.timeouts.push(window.setTimeout(()=>{this.element.classList.remove(this.dragClass)},50))}))})}ngOnDestroy(){this.clearTimeouts(),this.element.classList.remove(this.dropAreaClass,this.markStyleClass(),this.dragClass),super.ngOnDestroy()}onDrop(l){l.preventDefault(),l.stopPropagation(),this.clearTimeouts(),this.element.classList.remove(this.dragClass);let p=Array.from(l.dataTransfer.files);p=this.filterTypes(p,this.allowedFileTypes()),p.length>0&&this.filesDropped.emit(p)}clearTimeouts(){for(const l of this.timeouts)clearTimeout(l);this.timeouts=[]}filterTypes(l,h){if(""===h)return l;const p=h.split(",").map(i=>i.toLocaleLowerCase()),b=l.filter(i=>{const s=i.name.lastIndexOf(".");if(s<=0)return!1;const d=i.name.substring(s+1).toLocaleLowerCase();return p.includes(d)});if(l.length!==b.length){const i=this.allowedFileTypes().replace(/\,/g,", ");this.snackBar.open(b.length?"Some files were filtered out. This drop location only accepts file types: "+i:"This drop location only accepts file types: "+i,null,{duration:5e3})}return b}static#e=this.\u0275fac=function(h){return new(h||A)(r.rXU(r.aKT),r.rXU(r.SKi),r.rXU(y.UG))};static#t=this.\u0275dir=r.FsC({type:A,selectors:[["","appDragAndDrop",""]],hostBindings:function(h,p){1&h&&r.bIt("drop",function(i){return p.onDrop(i)})},inputs:{markStyle:[1,"markStyle"],allowedFileTypes:[1,"allowedFileTypes"]},outputs:{filesDropped:"filesDropped"},features:[r.Vt3]})}return A})()},60852:(O,v,e)=>{e.d(v,{c:()=>h});var m=e(29658),C=e(51567),E=e(63037),f=e(70271),r=e(5057),y=e(98764),D=e(34435),A=e(4979),P=e(44444);const l={doOnDialogClosed:!0};let h=(()=>{class p extends A.V{constructor(i,s){super(),this.router=i,this.route=s,this.log=(0,D.Tq)({DialogRoutingService:p},l)}get snapshot(){return this.route.snapshot}get url(){return this.router.url}get urlSegments(){return this.router.url.split("/")}getParam(i){return this.route.snapshot.paramMap.get(i)}getParams(i){const s=this.route.snapshot.paramMap;return i.reduce((d,u)=>(d[u]=s.get(u),d),{})}getQueryParam(i){return this.route.snapshot.queryParamMap.get(i)}getQueryParams(i){const s=this.route.snapshot.queryParamMap;return i.reduce((d,u)=>(d[u]=s.get(u),d),{})}state(){return this.router.getCurrentNavigation().extras?.state}doOnDialogClosed(i){const s=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.childDialogClosed$().subscribe(d=>(s.a("Dialog closed",{data:d}),i()))),s.end()}doOnDialogClosedWithData(i){const s=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.#e().subscribe(({state:d})=>{s.a("Dialog closed",{state:d}),i(d)})),s.end()}urlSubRoute(i){const s=this.router.createUrlTree([i],{relativeTo:this.route});return this.router.serializeUrl(s)}navPath(i,s){return this.router.navigate([i],s)}navRelative(i,s){return this.router.navigate(i,{...s,relativeTo:this.route})}childDialogClosed$(){return this.router.events.pipe((0,C.p)(i=>i instanceof m.wF),(0,E.Z)(!!this.route.snapshot.firstChild),(0,f.T)(()=>!!this.route.snapshot.firstChild),(0,r.J)(),(0,C.p)(([i,s])=>i&&!s))}#e(){return this.router.events.pipe((0,C.p)(i=>i instanceof m.wF),(0,y.M)(i=>{const s=this.log.fn("childDialogClosed$",{event:i,firstChild:this.route.snapshot.firstChild,snapShot:this.route.snapshot,state:this.router.getCurrentNavigation()?.extras.state});s.a("NavigationEnd",{event:i}),s.end()}),(0,E.Z)(!!this.route.snapshot.firstChild),(0,f.T)(()=>({hasChildNow:!!this.route.snapshot.firstChild,state:this.router.getCurrentNavigation()?.extras.state})),(0,r.J)(),(0,C.p)(([i,s])=>i.hasChildNow&&!s.hasChildNow),(0,f.T)(([i,s])=>({hadChildBefore:i.hasChildNow,hasChildNow:s.hasChildNow,state:s.state})))}static#t=this.\u0275fac=function(s){return new(s||p)(P.KVO(m.Ix),P.KVO(m.nX))};static#s=this.\u0275prov=P.jDH({token:p,factory:p.\u0275fac})}return p})()},81609:(O,v,e)=>{e.r(v),e.d(v,{AppsListComponent:()=>q});var m=e(89204),C=e(39509),E=e(26443),f=e(87945),r=e(44444),y=e(16256),D=e(84175),A=e(81863),P=e(93840),l=e(29658),h=e(23183),p=e(12938),b=e(58713),i=e(28136),s=e(9001),d=e(9006),u=e(48991),g=e(11828),L=e(91960),S=e(60251),I=e(34575),F=e(43216),M=e(34435),U=e(67037),j=e(60852),W=e(68873),k=e(83583);const $={states:{true:{tooltip:"Show this app to users",icon:"visibility"},false:{tooltip:"Hide this app from users",icon:"visibility_off"}}},K={states:{true:{clickable:!0,tooltip:"This App uses obsolete code which will cause problems on future upgrades. Click to see details.",icon:"bug_report",getUrl:c=>window.$2sxc.http.apiUrl("sys/insights/logs?key=warnings-obsolete&filter=AppId="+c.Id)},false:{tooltip:"Hide this app from users",icon:""}}};var R=e(31034),x=e(89061),G=e(41657),N=e(34601),t=e(99293),X=e(29968);function V(c,B){1&c&&(t.j41(0,"mat-icon"),t.EFF(1,"foundation"),t.k0s())}function Y(c,B){1&c&&(t.j41(0,"mat-icon"),t.EFF(1,"holiday_village"),t.k0s())}function H(c,B){if(1&c){const n=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.do("flushCache"))}),t.j41(1,"mat-icon"),t.EFF(2,"cached"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Flush cache"),t.k0s()(),t.j41(5,"button",8),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.do("deleteApp"))}),t.j41(6,"mat-icon"),t.EFF(7,"delete"),t.k0s(),t.j41(8,"span"),t.EFF(9,"Delete"),t.k0s()()}if(2&c){const n=t.XpG();t.R7$(5),t.Y8G("disabled",!n.app.IsApp)}}let w=(()=>{class c{agInit(n){this.params=n,this.app=this.params.data}refresh(n){return!0}do(n){this.params.do(n,this.app)}static#e=this.\u0275fac=function(o){return new(o||c)};static#t=this.\u0275cmp=t.VBU({type:c,selectors:[["app-apps-list-actions"]],decls:11,vars:8,consts:[["menu","matMenu"],[1,"actions-component"],[1,"eav-grid-action-button","icon",3,"tippy","tippyDisabled"],[3,"lightSpeedOwner","params","lightSpeed"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["matMenuContent",""],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"]],template:function(o,a){if(1&o&&(t.j41(0,"div",1)(1,"div",2),t.nVh(2,V,2,0,"mat-icon"),t.nVh(3,Y,2,0,"mat-icon"),t.k0s(),t.nrm(4,"app-lightspeed-action",3),t.j41(5,"div",4)(6,"mat-icon"),t.EFF(7,"more_horiz"),t.k0s()()(),t.j41(8,"mat-menu",5,0),t.DNE(10,H,10,1,"ng-template",6),t.k0s()),2&o){const T=t.sdS(9);t.R7$(),t.Y8G("tippy",a.app.IsGlobal?"This app is global":a.app.IsInherited?"This app is inherited":"")("tippyDisabled",!a.app.IsGlobal&&!a.app.IsInherited),t.R7$(),t.vxM(a.app.IsGlobal?2:-1),t.R7$(),t.vxM(a.app.IsInherited?3:-1),t.R7$(),t.Y8G("lightSpeedOwner",a.app)("params",a.params)("lightSpeed",a.app.lightSpeed),t.R7$(),t.Y8G("matMenuTriggerFor",T)}},dependencies:[N.e,P.m_,P.An,y.Y,x.M,X.M,R.Cn,R.kk,R.fb,R.z8,R.Cp,G.E],encapsulation:2})}return c})();var z=e(37580),J=e(3347),Q=e(29841);const Z=c=>({"fab-opened":c});let q=(()=>{class c{#e;#t;constructor(n,o,a,T,_){this.snackBar=n,this.context=o,this.matDialog=a,this.viewContainerRef=T,this.changeDetectorRef=_,this.log=(0,M.Tq)({AppsListComponent:c}),this.gridOptions=this.#r(),this.features=(0,r.WQX)(s.D),this.isAddFromFolderEnabled=this.features.isEnabled[i.T.AppSyncWithSiteFiles],this.#e=(0,p.d)(k.U),this.#t=(0,p.d)(j.c),this.fabOpen=(0,r.vPA)(!1),this.#s=(0,r.vPA)(0),this.apps=this.#e.getAllLive(this.#s).value,E.syG.registerModules([C.Q])}#s;ngOnInit(){this.#t.doOnDialogClosed(()=>this.#i())}openChange(n){this.fabOpen.set(n)}browseCatalog(){window.open("https://2sxc.org/apps","_blank")}createApp(){this.#t.navRelative(["create"])}createInheritedApp(){this.#t.navRelative(["create-inherited"])}addFromFolder(){this.#t.navRelative(["add-app-from-folder"])}importApp(n){this.#t.navRelative(["import"],{state:{files:n}})}#a(n){const o=prompt(`This cannot be undone. To really delete this app, type 'yes!' or type/paste the app-name here. Are you sure want to delete '${n.Name}' (${n.Id})?`);null!==o&&(o===n.Name||"yes!"===o?(this.snackBar.open("Deleting..."),this.#e.delete(n.Id).subscribe({error:()=>{this.snackBar.open("Delete failed. Please check console for more information",void 0,{duration:3e3}),this.#i()},next:()=>{this.snackBar.open("Deleted",void 0,{duration:2e3}),this.#i()}})):alert("Input did not match - will not delete"))}#n(n){var o=this;return(0,m.A)(function*(){if(confirm(`Flush the App Cache for ${n.Name} (${n.Id})?`)){o.snackBar.open("Flushing cache...");try{const a=yield o.#e.flushCache(n.Id);a>=200&&a<300&&o.snackBar.open("Cache flushed",void 0,{duration:2e3})}catch(a){o.snackBar.open("Cache flush failed. Please check console.",void 0,{duration:3e3}),console.error("Export error:",a)}}})()}#o(n){const o=(0,F.s)(b.g.getLightSpeedEditParams(n.Id));return this.#t.urlSubRoute(`${this.context.zoneId}/${n.Id}/edit/${o}`)}openLightSpeedFeatInfo(){(0,d.j)(this.matDialog,i.T.LightSpeed,this.viewContainerRef,this.changeDetectorRef)}#r(){return{...S.C,columnDefs:[{...g.r.IdWithDefaultRenderer,cellRendererParams:g.r.idFieldParamsTooltipGetter()},{...g.r.IconShow,cellRendererParams:{settings:()=>$}},{...g.r.TextWide,field:"Name",cellClass:"apps-list-primary-action highlight".split(" "),sort:"asc",cellRenderer:o=>{const a=o.data;return`\n              <a class="default-link fill-cell" href="#${this.#t.urlSubRoute(a.Id.toString())}">\n                <div class="container">\n                  ${a.Thumbnail?`<img class="image logo" src="${a.Thumbnail}?w=40&h=40&mode=crop"></img>`:'<div class="image logo"><span class="material-symbols-outlined">star</span></div>'}\n                  ${o.value}\n                </div>\n              </a>\n            `}},{...g.r.TextWide,field:"Folder"},{...g.r.Character,field:"Version",width:78},{...g.r.Number,field:"Items"},{...g.r.Boolean,field:"HasCodeWarnings",headerName:"Code",filter:L.y,cellRenderer:u.N,cellRendererParams:{settings:()=>K}},{...g.r.ActionsPinnedRight3,cellRenderer:w,cellRendererParams:{lightSpeedLink:o=>this.#o(o),openLightspeedFeatureInfo:()=>this.openLightSpeedFeatInfo(),do:(o,a)=>{switch(o){case"deleteApp":this.#a(a);break;case"flushCache":this.#n(a)}}}}]}}#i(){this.#s.update(n=>++n)}static#l=this.\u0275fac=function(o){return new(o||c)(t.rXU(J.UG),t.rXU(W.o),t.rXU(A.h),t.rXU(t.c1b),t.rXU(z.gRc))};static#d=this.\u0275cmp=t.VBU({type:c,selectors:[["app-apps-list"]],decls:25,vars:9,consts:[[1,"grid-wrapper","mat-tab-grid-wrapper"],["appDragAndDrop","",1,"ag-theme-material",3,"filesDropped","rowData","gridOptions","allowedFileTypes"],["align","end"],[1,"eav-eco-fab-speed-dial",3,"openChange","ngClass"],[3,"spin"],["mat-fab",""],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Find more apps",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","","label","Create inherited app",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","","label","Add from folder",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadge","\u{1f48e}","matBadgePosition","below after","aria-hidden","false",3,"matBadgeHidden"],["mat-mini-fab","","label","Import app",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","","label","Create app",1,"eav-eco-fab-speed-dial-action-button",3,"click"]],template:function(o,a){1&o&&(t.j41(0,"div",0)(1,"ag-grid-angular",1),t.bIt("filesDropped",function(_){return a.importApp(_)}),t.k0s(),t.j41(2,"mat-dialog-actions",2)(3,"eco-fab-speed-dial",3),t.bIt("openChange",function(_){return a.openChange(_)}),t.j41(4,"eco-fab-speed-dial-trigger",4)(5,"button",5)(6,"mat-icon",6),t.EFF(7),t.k0s()()(),t.j41(8,"eco-fab-speed-dial-actions",7)(9,"button",8),t.bIt("click",function(){return a.browseCatalog()}),t.j41(10,"mat-icon"),t.EFF(11,"search"),t.k0s()(),t.j41(12,"button",9),t.bIt("click",function(){return a.createInheritedApp()}),t.j41(13,"mat-icon"),t.EFF(14,"holiday_village"),t.k0s()(),t.j41(15,"button",10),t.bIt("click",function(){return a.addFromFolder()}),t.j41(16,"mat-icon",11),t.EFF(17," add "),t.k0s()(),t.j41(18,"button",12),t.bIt("click",function(){return a.importApp()}),t.j41(19,"mat-icon"),t.EFF(20,"cloud_upload"),t.k0s()(),t.j41(21,"button",13),t.bIt("click",function(){return a.createApp()}),t.j41(22,"mat-icon"),t.EFF(23,"add"),t.k0s()()()()()(),t.nrm(24,"router-outlet")),2&o&&(t.R7$(),t.Y8G("rowData",a.apps())("gridOptions",a.gridOptions)("allowedFileTypes","zip"),t.R7$(2),t.Y8G("ngClass",t.eq3(7,Z,a.fabOpen())),t.R7$(),t.Y8G("spin",!0),t.R7$(3),t.JRh(a.fabOpen()?"close":"add"),t.R7$(9),t.Y8G("matBadgeHidden",a.isAddFromFolderEnabled()))},dependencies:[U.p,Q.xs,A.M,h.TE,f.YU,h.p1,D.Hl,D.$0,D.Sr,P.m_,P.An,h.yf,y.Y,y.k,l.n3,I.S],encapsulation:2})}return c})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.00/dist/ng-edit/projects_eav-ui_src_app_apps-management_apps-list_apps-list_component_ts.3ccb68c2192c7e25.js.map