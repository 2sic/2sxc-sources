"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_visual-query_visual-query_module_ts"],{5653:(At,q,c)=>{c.r(q),c.d(q,{VisualQueryModule:()=>Zt});var d=c(6575),f=c(8849),S=c(895),_=c(6861),A=c(1268),C=c(6515),J=c(9674),U=c(6355),I=c(9293),F=c(9409),M=c(989),L=c(5530),G=c(7477),w=c(2611),X=c(7138),x=c(9736),E=c(1217),g=c(196),e=c(1699),ee=c(4860),te=c(6232);let N=(()=>{var o;class s{constructor(t,n,a){this.http=t,this.context=n,this.dnnContext=a}fetchPipeline(t,n){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(E.TB),{params:{appId:this.context.appId.toString(),id:t.toString()}}).pipe((0,x.U)(a=>(a.DataSources.length||this.buildDefaultModel(a,n),this.fixPipelineDataSources(a.DataSources),a)))}buildDefaultModel(t,n){const a=g.Zy.pipelineDesigner.defaultPipeline.dataSources;for(const r of a){const l=n.find(p=>p.PartAssemblyAndType===r.PartAssemblyAndType);t.DataSources.push({Description:"",EntityGuid:r.EntityGuid,EntityId:void 0,Name:l.Name,PartAssemblyAndType:r.PartAssemblyAndType,VisualDesignerData:r.VisualDesignerData})}t.Pipeline.StreamWiring=g.Zy.pipelineDesigner.defaultPipeline.streamWiring}fixPipelineDataSources(t){if(!t.some(a=>a.EntityGuid===g.Zy.pipelineDesigner.outDataSource.EntityGuid)){const a=g.Zy.pipelineDesigner.outDataSource;t.push({Description:a.Description,EntityGuid:a.EntityGuid,EntityId:void 0,Name:a.Name,PartAssemblyAndType:a.PartAssemblyAndType,VisualDesignerData:a.VisualDesignerData})}for(const a of t)a.VisualDesignerData??={Top:50,Left:50}}fetchDataSources(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(E.bf),{params:{appid:this.context.appId,zoneId:this.context.zoneId}}).pipe((0,x.U)(t=>{const n=g.Zy.pipelineDesigner.outDataSource;return t.push({ContentType:void 0,Difficulty:g.Zy.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:n.In,Name:n.Name,Out:void 0,PartAssemblyAndType:n.PartAssemblyAndType,PrimaryType:n.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),t}))}typeNameFilter(t,n){const a=t.split(", ");switch(n){case"classFullName":return a[0];case"className":const l=a[0].split(".");return l[l.length-1];default:return t}}savePipeline(t){const n=t.Pipeline,a=t.DataSources;return this.http.post(this.dnnContext.$2sxc.http.apiUrl(E.nt),{pipeline:n,dataSources:a},{params:{appId:this.context.appId.toString(),Id:n.EntityId.toString()}}).pipe((0,x.U)(r=>(this.fixPipelineDataSources(r.DataSources),r)))}runPipeline(t,n){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(E.cv),{params:{appId:this.context.appId.toString(),id:t.toString(),top:n.toString()}})}debugStream(t,n,a,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(E.Az),{params:{appId:this.context.appId.toString(),id:t.toString(),from:n,out:a,top:r.toString()}})}}return(o=s).\u0275fac=function(t){return new(t||o)(e.LFG(ee.eN),e.LFG(w._),e.LFG(te._y))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),s})();var T=c(91),Y=c(2968),ne=c(8226),O=c(8071),H=c(3317),k=c(3839),Q=c(2110),j=c(9097),ie=c(1632),b=c(3704),oe=c(9877),ae=c(9016),B=c(4520),se=c(6041),$=c(2957),P=c(9498);function re(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const i=e.oxw();e.xp6(1),e.AsE(' for Stream: "',i.debugStream.name,'" on Source: "',i.debugStream.sourceName,'" ')}}function le(o,s){1&o&&(e.TgZ(0,"div",13)(1,"span"),e._uU(2,"Results"),e.qZA()())}function ce(o,s){1&o&&(e.ynx(0),e._uU(1,"Showing All results"),e.BQk())}function ue(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const i=e.oxw();e.xp6(1),e.hij("Showing top ",i.top," results")}}function pe(o,s){1&o&&(e.ynx(0),e._uU(1,"All"),e.BQk())}function de(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i)}}function me(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){const a=e.CHM(i).$implicit,r=e.oxw();return e.KtG(r.show(a))}),e._uU(1," Show "),e.YNc(2,pe,2,0,"ng-container",3),e.YNc(3,de,2,1,"ng-container",3),e.qZA()}if(2&o){const i=s.$implicit;e.xp6(2),e.Q6J("ngIf",0===i),e.xp6(1),e.Q6J("ngIf",0!==i)}}function ge(o,s){1&o&&(e.TgZ(0,"div",16)(1,"span"),e._uU(2,"Parameters"),e.qZA()())}function fe(o,s){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const i=s.$implicit;e.xp6(1),e.Oqu(i)}}function he(o,s){if(1&o&&(e.TgZ(0,"mat-tab"),e.YNc(1,ge,3,0,"div",15),e._UZ(2,"br"),e.TgZ(3,"ul"),e.YNc(4,fe,2,1,"li",11),e.qZA()()),2&o){const i=e.oxw();e.xp6(4),e.Q6J("ngForOf",i.parameters)}}function _e(o,s){1&o&&(e.TgZ(0,"div",17)(1,"span"),e._uU(2,"Sources"),e.qZA()())}function ye(o,s){if(1&o&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&o){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(null==i.value.Definition?null:i.value.Definition.Name)}}function ve(o,s){if(1&o&&(e.TgZ(0,"li")(1,"b"),e._uU(2),e.qZA(),e._uU(3,"="),e.TgZ(4,"em"),e._uU(5),e.qZA()()),2&o){const i=s.$implicit;e.xp6(2),e.Oqu(i.key),e.xp6(3),e.Oqu(i.value)}}function xe(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,ye,2,1,"div",3),e.TgZ(3,"pre"),e._uU(4),e.qZA()(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"ol"),e.YNc(9,ve,6,2,"li",11),e.ALo(10,"keyvalue"),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA()()),2&o){const i=s.$implicit;e.xp6(2),e.Q6J("ngIf",null==i.value.Definition?null:i.value.Definition.Name),e.xp6(2),e.Oqu(i.value.Guid),e.xp6(2),e.Oqu(i.value.Type),e.xp6(3),e.Q6J("ngForOf",e.lcZ(10,5,i.value.Configuration)),e.xp6(3),e.Oqu(i.value.Error)}}function Se(o,s){1&o&&(e.TgZ(0,"div",18)(1,"span"),e._uU(2,"Streams"),e.qZA()())}function be(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td")(2,"pre"),e._uU(3),e.qZA()(),e.TgZ(4,"td")(5,"pre"),e._uU(6),e.qZA()(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA()()),2&o){const i=s.$implicit;e.xp6(3),e.Oqu(i.Source+":"+i.SourceOut),e.xp6(3),e.Oqu(i.Target+":"+i.TargetIn),e.xp6(2),e.Oqu(i.Count),e.xp6(2),e.Oqu(i.Error)}}let Ce=(()=>{var o;class s{constructor(t,n,a){this.dialogData=t,this.dialogRef=n,this.visualQueryService=a}ngOnInit(){const t=this.visualQueryService.pipelineModel$.value.Pipeline,n=(t.Params?.split("\n")??[]).filter(r=>!!r),a=(t.TestParameters?.split("\n")??[]).filter(r=>!!r);this.parameters=[].concat(n,a),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialogRef.close()}show(t){t!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,t):this.visualQueryService.runPipeline(t),this.closeDialog())}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(_.WI),e.Y36(_.so),e.Y36(Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-query-result"]],decls:51,vars:14,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[4,"ngIf"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["dynamicHeight","","color","accent",1,"eav-tab-group"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"eav-tab-description"],["mat-button","",3,"click",4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],[4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3," Query Results "),e.YNc(4,re,2,2,"ng-container",3),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return n.closeDialog()}),e.TgZ(6,"mat-icon"),e._uU(7,"close"),e.qZA()()(),e.TgZ(8,"div",5)(9,"p"),e._uU(10),e.qZA(),e.TgZ(11,"mat-tab-group",6)(12,"mat-tab"),e.YNc(13,le,3,0,"div",7),e.TgZ(14,"p",8),e.YNc(15,ce,2,0,"ng-container",3),e.YNc(16,ue,2,1,"ng-container",3),e.YNc(17,me,4,2,"button",9),e.qZA(),e.TgZ(18,"pre"),e._uU(19),e.ALo(20,"json"),e.qZA()(),e.YNc(21,he,5,1,"mat-tab",3),e.TgZ(22,"mat-tab"),e.YNc(23,_e,3,0,"div",10),e._UZ(24,"br"),e.TgZ(25,"table")(26,"tr")(27,"th"),e._uU(28,"Name and Guid"),e.qZA(),e.TgZ(29,"th"),e._uU(30,"Type"),e.qZA(),e.TgZ(31,"th"),e._uU(32,"Configuration"),e.qZA(),e.TgZ(33,"th"),e._uU(34,"Error"),e.qZA()(),e.YNc(35,xe,13,7,"tr",11),e.ALo(36,"keyvalue"),e.qZA()(),e.TgZ(37,"mat-tab"),e.YNc(38,Se,3,0,"div",12),e._UZ(39,"br"),e.TgZ(40,"table")(41,"tr")(42,"th"),e._uU(43,"Source"),e.qZA(),e.TgZ(44,"th"),e._uU(45,"Target"),e.qZA(),e.TgZ(46,"th"),e._uU(47,"Items"),e.qZA(),e.TgZ(48,"th"),e._uU(49,"Error"),e.qZA()(),e.YNc(50,be,11,4,"tr",11),e.qZA()()()()()),2&t&&(e.xp6(4),e.Q6J("ngIf",n.debugStream),e.xp6(6),e.AsE(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",n.timeUsed,"ms (",n.ticksUsed," ticks) "),e.xp6(5),e.Q6J("ngIf",0===n.top),e.xp6(1),e.Q6J("ngIf",0!==n.top),e.xp6(1),e.Q6J("ngForOf",n.optionsForTop),e.xp6(2),e.Oqu(e.lcZ(20,10,n.result)),e.xp6(2),e.Q6J("ngIf",null==n.parameters?null:n.parameters.length),e.xp6(14),e.Q6J("ngForOf",e.lcZ(36,12,n.sources)),e.xp6(15),e.Q6J("ngForOf",n.streams))},dependencies:[d.sg,d.O5,P.$,C.Hw,S.lW,S.RK,M.uD,M.uX,M.SP,d.Ts,d.Nd],styles:[".eav-tab-group[_ngcontent-%COMP%]{padding:0}.eav-tab-description[_ngcontent-%COMP%]{display:flex;align-items:baseline}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]}),s})(),Te=(()=>{var o;class s{constructor(t,n){this.dialogData=t,this.dialogRef=n}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialogRef.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api"),"_blank")}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(_.WI),e.Y36(_.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["align","end"],["mat-button","","tippy","Open 2sxc Insights",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3,"Stream Error Results"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return n.closeDialog()}),e.TgZ(5,"mat-icon"),e._uU(6,"close"),e.qZA()()(),e.TgZ(7,"div",4)(8,"pre"),e._uU(9),e.ALo(10,"json"),e.qZA()(),e.TgZ(11,"mat-dialog-actions",5)(12,"button",6),e.NdJ("click",function(){return n.openInsights()}),e.TgZ(13,"mat-icon",7),e._uU(14,"speed"),e.qZA(),e.TgZ(15,"span"),e._uU(16,"Insights"),e.qZA()()()()),2&t&&(e.xp6(9),e.Oqu(e.lcZ(10,1,n.errorData)))},dependencies:[P.$,C.Hw,S.lW,S.RK,_.H8,d.Ts],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]}),s})();var De=c(6480);let Z=(()=>{var o;class s extends se.H{constructor(t,n,a,r,l,u,p,y,h,D,v){super(t,n),this.router=t,this.route=n,this.queryDefinitionService=a,this.titleService=r,this.snackBar=l,this.dialog=u,this.viewContainerRef=p,this.zone=y,this.metadataService=h,this.contentTypesService=D,this.changeDetectorRef=v,this.pipelineModel$=new O.X(null),this.dataSources$=new O.X(null),this.putEntityCountOnConnections$=new oe.x,this.dataSourceConfigs$=new O.X({}),this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1}ngOnDestroy(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),super.ngOnDestroy()}init(){this.fetchDataSources(()=>this.fetchPipeline(!0,!0,!1)),this.attachKeyboardSave(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{(this.refreshPipeline||this.refreshDataSourceConfigs)&&this.fetchPipeline(this.refreshPipeline,this.refreshDataSourceConfigs,this.refreshPipeline),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1}))}editPipelineEntity(){this.savePipeline(()=>{const n=(0,$.f)({items:[{EntityId:this.pipelineModel$.value.Pipeline.EntityId}]});this.router.navigate([`edit/${n}`],{relativeTo:this.route}),this.refreshPipeline=!0})}saveAndRun(t,n){t&&n?this.savePipeline(()=>{this.runPipeline()}):t?this.savePipeline():n&&this.runPipeline()}showDataSourceDetails(t){const n=(0,b.Z)(this.pipelineModel$.value),a=Q.iX.tryParse(n.Pipeline.VisualDesignerData)??{};a.ShowDataSourceDetails=t,n.Pipeline.VisualDesignerData=JSON.stringify(a),this.pipelineModel$.next(n)}addDataSource(t){const n=(0,b.Z)(this.pipelineModel$.value);n.DataSources.push({Description:"",EntityGuid:"unsaved"+(n.DataSources.length+1),EntityId:void 0,Name:t.Name,PartAssemblyAndType:t.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(n),this.savePipeline()}removeDataSource(t,n,a){const r=(0,b.Z)(this.pipelineModel$.value);r.DataSources=r.DataSources.filter(l=>l.EntityGuid!==t),r.Pipeline.StreamWiring=n,r.Pipeline.StreamsOut=a,this.pipelineModel$.next(r)}renameDataSource(t,n){const a=(0,b.Z)(this.pipelineModel$.value);a.DataSources.find(l=>l.EntityGuid===t).Name=n,this.pipelineModel$.next(a)}changeDataSourceDescription(t,n){const a=(0,b.Z)(this.pipelineModel$.value);a.DataSources.find(l=>l.EntityGuid===t).Description=n,this.pipelineModel$.next(a)}changeConnections(t,n){const a=(0,b.Z)(this.pipelineModel$.value);a.Pipeline.StreamWiring=t,a.Pipeline.StreamsOut=n,this.pipelineModel$.next(a)}changeDataSourcePosition(t,n){const a=(0,b.Z)(this.pipelineModel$.value),r=a.DataSources.find(l=>l.EntityGuid===t);r&&(r.VisualDesignerData={...r.VisualDesignerData,...n},this.pipelineModel$.next(a))}calculateDataSourceConfigs(t){const n={};t.forEach(a=>{null!=a.EntityId&&(n[a.EntityId]=[],a.Metadata?.forEach(r=>{Object.entries(r).forEach(([l,u])=>{null==u||""===u||["Created","Guid","Id","Modified","Title","_Type"].includes(l)||(Array.isArray(u)&&null!=u[0]?.Title&&null!=u[0]?.Id&&(u=`${u[0].Title} (${u[0].Id})`),n[a.EntityId].push({name:l,value:u}))})}))}),this.dataSourceConfigs$.next(n)}editDataSource(t){const a=this.dataSources$.value.find(p=>p.PartAssemblyAndType===t.PartAssemblyAndType).ContentType,u=t.EntityGuid;this.metadataService.getMetadata(g.Zy.metadata.entity.targetType,g.Zy.metadata.entity.keyType,u,a).subscribe(p=>{if(p.Items.length){const h=(0,$.f)({items:[{EntityId:p.Items[0].Id}]});return this.router.navigate([`edit/${h}`],{relativeTo:this.route}),void(this.refreshDataSourceConfigs=!0)}this.contentTypesService.retrieveContentType(a).subscribe({next:y=>{if(null==y)return void this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});const D=(0,$.f)({items:[{ContentTypeName:a,For:{Target:g.Zy.metadata.entity.target,TargetType:g.Zy.metadata.entity.targetType,Guid:u}}]});this.router.navigate([`edit/${D}`],{relativeTo:this.route}),this.refreshDataSourceConfigs=!0},error:y=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}savePipeline(t){this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:n=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel$.next(n),t?.()},error:n=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(t=25){this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,t).subscribe({next:n=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.pipelineResult=n,this.showQueryResult(n,t),console.warn(n),this.pipelineModel$.next((0,b.Z)(this.pipelineModel$.value)),setTimeout(()=>{this.putEntityCountOnConnections$.next(n)})},error:n=>{this.snackBar.open("Query failed",null,{duration:2e3})}})}debugStream(t,n=25){t.Error?this.showStreamErrorResult(t):0!==t.Count&&(this.snackBar.open("Running stream..."),this.queryDefinitionService.debugStream(this.pipelineModel$.value.Pipeline.EntityId,t.Source,t.SourceOut,n).subscribe({next:r=>{this.snackBar.open("Stream worked",null,{duration:2e3});const l=this.pipelineModel$.value.DataSources.find(p=>p.EntityGuid===t.Source);this.showQueryResult(r,n,{name:t.SourceOut,source:t.Source,sourceName:l.Name,original:t}),console.warn(r)},error:r=>{this.snackBar.open("Stream failed",null,{duration:2e3})}}))}fetchPipeline(t,n,a){a&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId,this.dataSources$.value).subscribe(r=>{a&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.titleService.setTitle(`${r.Pipeline.Name} - Visual Query`),t&&this.pipelineModel$.next(r),n&&this.calculateDataSourceConfigs(r.DataSources)})}showQueryResult(t,n,a){this.dialog.open(Ce,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:t,debugStream:a,top:n},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}showStreamErrorResult(t){this.dialog.open(Te,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:t.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}fetchDataSources(t){this.queryDefinitionService.fetchDataSources().subscribe(n=>{this.dataSources$.next(n),t()})}attachKeyboardSave(){this.zone.runOutsideAngular(()=>{this.subscription.add((0,ae.R)(window,"keydown").pipe((0,B.h)(()=>!this.route.snapshot.firstChild),(0,B.h)(t=>(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83===t.keyCode)).subscribe(t=>{t.preventDefault(),this.zone.run(()=>{this.savePipeline()})}))})}}return(o=s).\u0275fac=function(t){return new(t||o)(e.LFG(T.F0),e.LFG(T.gz),e.LFG(N),e.LFG(De.Dx),e.LFG(F.ux),e.LFG(_.uw),e.LFG(e.s_b),e.LFG(e.R0b),e.LFG(G.D),e.LFG(L.s),e.LFG(e.sBO))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),s})();const R={App:{Name:"App",Label:"App DataSources",Icon:"star",UiHint:"DataSources from the current App"},Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function Ze(o,s){const i={};for(const t of o){let n;const a=s.find(r=>r.PartAssemblyAndType===t.PartAssemblyAndType);a&&(n={...a.PrimaryType?R[a.PrimaryType]:R.Unknown},null!=a.Icon&&(n.Icon=a.Icon),null!=a.DynamicIn&&(n.DynamicIn=a.DynamicIn),null!=a.DynamicOut&&(n.DynamicOut=a.DynamicOut),null!=a.HelpLink&&(n.HelpLink=a.HelpLink),null!=a.EnableConfig&&(n.EnableConfig=a.EnableConfig),null!=a.UiHint&&(n.UiHint=a.UiHint)),n||(n={...R.Unknown}),i[t.EntityGuid]=n}return i}var Ee=c(5043),Pe=c(9851),Ae=c(131),Ie=c(257);function Oe(o,s){1&o&&(e.TgZ(0,"app-field-hint"),e._uU(1," You will get suggestions for out-streams after you run query "),e.qZA())}function Qe(o,s){1&o&&(e.TgZ(0,"app-field-hint",13),e._uU(1," This field is required "),e.qZA()),2&o&&e.Q6J("isError",!0)}function Me(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"mat-form-field",10)(2,"mat-label"),e._uU(3,"Label"),e.qZA(),e._UZ(4,"input",11),e.qZA(),e.YNc(5,Oe,2,0,"app-field-hint",6),e.YNc(6,Qe,2,1,"app-field-hint",12),e.BQk()),2&o){const i=e.oxw();e.xp6(5),e.Q6J("ngIf",i.isSource&&!i.pipelineResultExists),e.xp6(1),e.Q6J("ngIf",i.controls.label.touched&&(null==i.controls.label.errors?null:i.controls.label.errors.required))}}function we(o,s){if(1&o&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&o){const i=s.$implicit;e.Q6J("value",i.value),e.xp6(1),e.hij(" ",i.name," ")}}function ke(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"mat-form-field",10)(2,"mat-label"),e._uU(3,"Scope"),e.qZA(),e.TgZ(4,"mat-select",20),e.YNc(5,we,2,2,"mat-option",21),e.qZA()(),e.TgZ(6,"app-field-hint"),e._uU(7," The scope should almost never be changed - "),e.TgZ(8,"a",22),e._uU(9,"see help"),e.qZA()(),e.BQk()),2&o){const i=e.oxw(2);e.xp6(4),e.Q6J("placeholder",i.scopeOptions.length?"":"No items found"),e.xp6(1),e.Q6J("ngForOf",i.scopeOptions)}}function Re(o,s){if(1&o&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&o){const i=s.$implicit;e.Q6J("value",i),e.xp6(1),e.hij(" ",i," ")}}function Ue(o,s){if(1&o&&(e.TgZ(0,"mat-select",24),e.YNc(1,Re,2,2,"mat-option",21),e.qZA()),2&o){const i=e.oxw(2);e.Q6J("placeholder",i.labelOptions.length?"":"No items found"),e.xp6(1),e.Q6J("ngForOf",i.labelOptions)}}function Ne(o,s){1&o&&e._UZ(0,"input",11)}function $e(o,s){1&o&&(e.TgZ(0,"app-field-hint",13),e._uU(1," This field is required "),e.qZA()),2&o&&e.Q6J("isError",!0)}const V=function(o){return{active:o}};function qe(o,s){if(1&o){const i=e.EpF();e.ynx(0),e.YNc(1,ke,10,2,"ng-container",6),e.TgZ(2,"mat-form-field",10)(3,"mat-label"),e._uU(4,"Label"),e.qZA(),e.YNc(5,Ue,2,2,"mat-select",14),e.YNc(6,Ne,1,0,"input",15),e.TgZ(7,"div",16)(8,"button",17),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.toggleGuidedLabel(!0))}),e.TgZ(9,"mat-icon",18),e._uU(10,"search"),e.qZA()(),e.TgZ(11,"button",19),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.toggleGuidedLabel(!1))}),e.TgZ(12,"mat-icon",18),e._uU(13,"text_fields"),e.qZA()()()(),e.YNc(14,$e,2,1,"app-field-hint",12),e.BQk()}if(2&o){const i=e.oxw();e.xp6(1),e.Q6J("ngIf",i.advancedMode&&i.guidedLabel),e.xp6(4),e.Q6J("ngIf",i.guidedLabel),e.xp6(1),e.Q6J("ngIf",!i.guidedLabel),e.xp6(2),e.Q6J("ngClass",e.VKq(6,V,i.guidedLabel)),e.xp6(3),e.Q6J("ngClass",e.VKq(8,V,!i.guidedLabel)),e.xp6(3),e.Q6J("ngIf",i.controls.label.touched&&(null==i.controls.label.errors?null:i.controls.label.errors.required))}}function Je(o,s){if(1&o){const i=e.EpF();e.ynx(0),e.TgZ(1,"mat-slide-toggle",25),e.NdJ("change",function(n){e.CHM(i);const a=e.oxw();return e.KtG(a.toggleAdvancedMode(n))}),e._uU(2),e.qZA(),e.BQk()}if(2&o){const i=e.oxw();e.xp6(1),e.Q6J("checked",i.advancedMode),e.xp6(1),e.hij(" ",i.advancedMode?"Advanced":"Simple"," ")}}let Fe=(()=>{var o;class s extends j.f{constructor(t,n,a,r,l){super(),this.dialogData=t,this.dialogRef=n,this.visualQueryService=a,this.contentTypesService=r,this.changeDetectorRef=l,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.pipelineResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1}ngOnInit(){this.buildForm()}ngOnDestroy(){super.ngOnDestroy()}closeDialog(t){this.dialogRef.close(t)}toggleGuidedLabel(t){this.guidedLabel=t}toggleAdvancedMode(t){this.advancedMode=t.checked}rename(){const t=this.form.getRawValue();this.closeDialog(t.label)}buildForm(){this.form=new f.nJ({label:new f.p4(this.dialogData.label,f.kI.required),scope:new f.p4(g.Zy.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscription.add(this.controls.scope.valueChanges.pipe((0,Ee.O)(this.controls.scope.value),(0,H.x)()).subscribe(t=>{this.labelOptions=Object.values(this.visualQueryService.pipelineResult.Sources).find(n=>n.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(n=>n.Scope===t).map(n=>n.Name),!this.labelOptions.includes(this.controls.label.value)&&null!=this.controls.label.value&&this.controls.label.patchValue(null)})),this.contentTypesService.getScopes().subscribe(t=>{const n=Object.values(this.visualQueryService.pipelineResult.Sources).find(r=>r.Guid===this.dialogData.pipelineDataSourceGuid).Out,a=t.filter(r=>n.some(l=>l.Scope===r.value));this.scopeOptions=a,this.changeDetectorRef.markForCheck()}))}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(_.WI),e.Y36(_.so),e.Y36(Z),e.Y36(E.sF),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(t,n){2&t&&e.Ikx("className",n.hostClass)},features:[e.qOj],decls:19,vars:5,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"formGroup"],[4,"ngIf"],[1,"eav-dialog-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["color","accent",1,"eav-form-field"],["matInput","","type","text","formControlName","label","required",""],[3,"isError",4,"ngIf"],[3,"isError"],["formControlName","label","required","",3,"placeholder",4,"ngIf"],["matInput","","type","text","formControlName","label","required","",4,"ngIf"],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"ngClass","click"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"ngClass","click"],["formControlName","scope",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],[3,"value"],["formControlName","label","required","",3,"placeholder"],["color","accent",3,"checked","change"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3,"Rename stream"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return n.closeDialog()}),e.TgZ(5,"mat-icon"),e._uU(6,"close"),e.qZA()()(),e.TgZ(7,"div",4)(8,"form",5),e.YNc(9,Me,7,2,"ng-container",6),e.YNc(10,qe,15,10,"ng-container",6),e.qZA()(),e.TgZ(11,"mat-dialog-actions",7)(12,"div"),e.YNc(13,Je,3,2,"ng-container",6),e.qZA(),e.TgZ(14,"div")(15,"button",8),e.NdJ("click",function(){return n.closeDialog()}),e._uU(16,"Cancel"),e.qZA(),e.TgZ(17,"button",9),e.NdJ("click",function(){return n.rename()}),e._uU(18," Rename "),e.qZA()()()()),2&t&&(e.xp6(8),e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("ngIf",!n.isSource||!n.pipelineResultExists),e.xp6(1),e.Q6J("ngIf",n.isSource&&n.pipelineResultExists),e.xp6(3),e.Q6J("ngIf",n.isSource&&n.pipelineResultExists),e.xp6(4),e.Q6J("disabled",!n.form.valid))},dependencies:[d.mk,d.sg,d.O5,Pe.Y,Ae.E,P.$,C.Hw,S.lW,S.RK,I.Rr,_.H8,A.KE,A.hX,A.R9,f._Y,f.Fj,f.JJ,f.JL,f.Q7,f.sg,f.u,U.gD,Ie.ey,J.Nt]}),s})();const m="dataSource_";class Le{constructor(s,i,t,n,a,r,l,u,p){this.jsPlumbRoot=s,this.pipelineModel=i,this.dataSources=t,this.onConnectionsChanged=n,this.onDragend=a,this.onDebugStream=r,this.dialog=l,this.viewContainerRef=u,this.changeDetectorRef=p,this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(()=>{this.initDomDataSources(),this.initWirings(),this.bindEvents()}),this.instance.repaintEverything()}destroy(){this.dialogRef?.close(),this.instance.reset(),this.instance.unbindContainer()}removeEndpointsOnDataSource(s){const i=m+s;this.bulkDelete=!0,this.instance.batch(()=>{this.instance.selectEndpoints({element:i}).delete()}),this.bulkDelete=!1}getAllConnections(){return this.instance.getAllConnections().map(i=>({From:i.sourceId.replace(m,""),Out:i.endpoints[0].getOverlay("endpointLabel").label,To:i.targetId.replace(m,""),In:i.endpoints[1].getOverlay("endpointLabel").label}))}getStreamsOut(){const s=[];return this.instance.selectEndpoints({target:m+"Out"}).each(t=>{s.push(t.getOverlay("endpointLabel").label)}),s.join(",")}putEntityCountOnConnections(s){s.Streams?.forEach(i=>{const t=m+i.Source,a=["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(i.Target)?m+"Out":m+i.Target,r=t+"_out_"+i.SourceOut,l=a+"_in_"+i.TargetIn;this.instance.getEndpoint(r)?.connections?.filter(p=>p.endpoints[1].getUuid()===l)?.forEach(p=>{const y=i.Error?"":i.Count.toString();p.setLabel({label:y,cssClass:"streamEntitiesCount "+(i.Error?"streamEntitiesError":""),events:{click:D=>{this.pipelineModel.Pipeline.AllowEdit&&this.onDebugStream(i)}}})})})}nextLinePaintStyle(s){return this.uuidColorMap[s]||(this.uuidColorMap[s]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))}getInstanceDefaults(s){return{Container:s,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}initDomDataSources(){for(const s of this.pipelineModel.DataSources){const i=this.jsPlumbRoot.querySelector("#"+m+s.EntityGuid);if(!i)continue;const t=this.dataSources.find(n=>n.PartAssemblyAndType===s.PartAssemblyAndType);if(t){if(this.pipelineModel.Pipeline.AllowEdit&&this.instance.draggable(i,{grid:[20,20],stop:n=>{const r=n.el.id.replace(m,""),l={Top:n.finalPos[1],Left:n.finalPos[0]};setTimeout(()=>{this.onDragend(r,l)})}}),t.Out?.forEach(n=>{this.addEndpoint(i,n,!1,s)}),t.In?.forEach(n=>{this.addEndpoint(i,n,!0,s)}),t.In){const n=this.buildTargetEndpoint(s.EntityGuid);n.maxConnections=-1,this.instance.makeTarget(i,n)}t.DynamicOut&&this.instance.makeSource(i,this.buildSourceEndpoint(s.EntityGuid),{filter:".add-endpoint"})}}}initWirings(){this.pipelineModel.Pipeline.StreamWiring?.forEach(s=>{const i=m+s.From,t=i+"_out_"+s.Out,n=m+s.To,a=n+"_in_"+s.In;if(!this.instance.getEndpoint(t)){const r=this.jsPlumbRoot.querySelector("#"+i);if(!r)return;const l=r.id.replace(m,""),u=this.pipelineModel.DataSources.find(p=>p.EntityGuid===l);this.addEndpoint(r,s.Out,!1,u)}if(!this.instance.getEndpoint(a)){const r=this.jsPlumbRoot.querySelector("#"+n);if(!r)return;const l=r.id.replace(m,""),u=this.pipelineModel.DataSources.find(p=>p.EntityGuid===l);this.addEndpoint(r,s.In,!0,u)}try{this.instance.connect({uuids:[t,a],paintStyle:this.nextLinePaintStyle(t)})}catch{console.error({message:"Connection failed",from:t,to:a})}})}addEndpoint(s,i,t,n){const a=this.dataSources.find(v=>v.PartAssemblyAndType===n.PartAssemblyAndType),r=t?!a.In?.some(v=>this.getEndpointInfo(v,!1)):!a.Out?.some(v=>this.getEndpointInfo(v,!1)),l=this.getEndpointInfo(i,r);let u;u=r?"dynamic":l.required?this.pipelineModel.Pipeline.StreamWiring?.some(W=>m+W.To===s.id&&W.In===l.name)?"":"required":"";const p=s.id+(t?"_in_":"_out_")+l.name,y=t?this.buildTargetEndpoint(n.EntityGuid,u):this.buildSourceEndpoint(n.EntityGuid,u);this.instance.addEndpoint(s,y,{uuid:p,enabled:this.pipelineModel.Pipeline.AllowEdit||n.EntityGuid===g.Zy.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel").setLabel(l.name)}buildSourceEndpoint(s,i){return{paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint "+i,maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(!0),events:{click:a=>{this.onChangeLabel(a,!0,s)}}}}buildTargetEndpoint(s,i){return{paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint "+i,maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:a=>{this.onChangeLabel(a,!1,s)}}}}getEndpointOverlays(s){return[["Label",{id:"endpointLabel",location:[.5,s?0:1],label:"Default",cssClass:s?"endpointSourceLabel":"endpointTargetLabel"}]]}onChangeLabel(s,i,t){if(!this.pipelineModel.Pipeline.AllowEdit)return;const n=s.getOverlay?s.getOverlay("endpointLabel"):s;this.dialogRef=this.dialog.open(Fe,{autoFocus:!1,data:{pipelineDataSourceGuid:t,isSource:i,label:n.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.dialogRef.afterClosed().subscribe(r=>{r&&(n.setLabel(r),setTimeout(()=>{this.onConnectionsChanged()}))}),this.changeDetectorRef.markForCheck()}bindEvents(){this.instance.bind("connectionDetached",s=>{if(this.bulkDelete)return;const i=s.target,t=this.pipelineModel.DataSources.find(l=>l.EntityGuid===i.id.replace(m,"")),n=this.dataSources.find(l=>l.PartAssemblyAndType===t.PartAssemblyAndType),a=s.targetEndpoint.getOverlay("endpointLabel").label;n.In.some(l=>this.getEndpointInfo(l,!1).name===a)||this.instance.deleteEndpoint(s.targetEndpoint),setTimeout(()=>{this.onConnectionsChanged()})}),this.instance.bind("connection",s=>{if(s.sourceId===s.targetId)return void setTimeout(()=>{this.instance.deleteConnection(s.connection,{fireEvent:!1}),setTimeout(()=>{this.onConnectionsChanged()})});const i=s.targetEndpoint.getOverlay("endpointLabel"),t=i.getLabel();this.instance.getEndpoints(s.target.id).some(r=>r.getOverlay("endpointLabel").getLabel()===t&&s.targetEndpoint.id!==r.id&&r.canvas.classList.contains("targetEndpoint"))&&i.setLabel(`PleaseRename${Math.floor(99999*Math.random())}`),setTimeout(()=>{this.onConnectionsChanged()})})}getEndpointInfo(s,i){let t,n;if(i)t=s,n=!1;else{const r=s.trim();n=r.endsWith("*"),t=n?r.substring(0,r.length-1):r}return{name:t,required:n}}}var Ge=c(5941);const Ye=["domRoot"],He=["domDataSource"];function je(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"mat-icon",19),e.NdJ("click",function(){e.CHM(i);const n=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.configureDataSource(n))}),e._uU(1," settings "),e.qZA()}}function Be(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"mat-icon",20),e.NdJ("click",function(){e.CHM(i);const n=e.oxw().$implicit,a=e.oxw(2).ngIf,r=e.oxw();return e.KtG(r.openHelp(a.typeInfos[n.EntityGuid].HelpLink))}),e._uU(1," help_outline "),e.qZA()}}function Ve(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"mat-icon",21),e.NdJ("click",function(){e.CHM(i);const n=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.remove(n))}),e._uU(1," delete "),e.qZA()}}function Ke(o,s){if(1&o&&(e.TgZ(0,"tr",25)(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",27),e._uU(4),e.qZA()()),2&o){const i=s.$implicit;e.xp6(1),e.Q6J("title",i.name),e.xp6(1),e.Oqu(i.name),e.xp6(1),e.Q6J("title",i.value),e.xp6(1),e.Oqu(i.value)}}function ze(o,s){if(1&o&&(e.ynx(0),e._UZ(1,"hr",22),e.TgZ(2,"table",23),e.YNc(3,Ke,5,4,"tr",24),e.qZA(),e.BQk()),2&o){const i=e.oxw().$implicit,t=e.oxw(2).ngIf;e.xp6(3),e.Q6J("ngForOf",t.dataSourceConfigs[i.EntityId])}}function We(o,s){1&o&&e._UZ(0,"div",28)}function Xe(o,s){1&o&&e._UZ(0,"div",29)}const et=function(o,s,i){return{top:o,left:s,"min-width":i}},tt=function(o){return{"show-details":o}};function nt(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",5,6)(2,"div",7)(3,"mat-icon",8),e._uU(4),e.qZA(),e.YNc(5,je,2,0,"mat-icon",9),e.YNc(6,Be,2,0,"mat-icon",10),e.qZA(),e.TgZ(7,"div",11),e.YNc(8,Ve,2,0,"mat-icon",12),e.qZA(),e.TgZ(9,"div",13),e.NdJ("click",function(){const a=e.CHM(i).$implicit,r=e.oxw(2).ngIf,l=e.oxw();return e.KtG(r.allowEdit&&l.editName(a))}),e.TgZ(10,"span"),e._uU(11),e.qZA(),e.TgZ(12,"mat-icon",14),e._uU(13,"edit"),e.qZA()(),e._UZ(14,"br"),e.TgZ(15,"div",15),e.NdJ("click",function(){const a=e.CHM(i).$implicit,r=e.oxw(2).ngIf,l=e.oxw();return e.KtG(r.allowEdit&&l.editDescription(a))}),e.TgZ(16,"span"),e._uU(17),e.qZA(),e.TgZ(18,"mat-icon",14),e._uU(19,"edit"),e.qZA()(),e._UZ(20,"br"),e.YNc(21,ze,4,1,"ng-container",3),e.TgZ(22,"div",16),e._uU(23),e.qZA(),e.YNc(24,We,1,0,"div",17),e.YNc(25,Xe,1,0,"div",18),e.qZA()}if(2&o){const i=s.$implicit,t=e.oxw(2).ngIf,n=e.oxw();e.Q6J("id",n.dataSrcIdPrefix+i.EntityGuid)("ngStyle",e.kEZ(15,et,i.VisualDesignerData.Top+"px",i.VisualDesignerData.Left+"px",i.VisualDesignerData.Width?i.VisualDesignerData.Width+"px":null))("ngClass",e.VKq(19,tt,t.showDataSourceDetails&&(null==t.dataSourceConfigs[i.EntityId]?null:t.dataSourceConfigs[i.EntityId].length))),e.xp6(3),e.Q6J("title",t.typeInfos[i.EntityGuid].UiHint),e.xp6(1),e.hij(" ",t.typeInfos[i.EntityGuid].Icon," "),e.xp6(1),e.Q6J("ngIf",t.allowEdit&&t.typeInfos[i.EntityGuid].EnableConfig),e.xp6(1),e.Q6J("ngIf",t.typeInfos[i.EntityGuid].HelpLink),e.xp6(2),e.Q6J("ngIf",t.allowEdit&&!n.isOutDataSource(i)),e.xp6(3),e.Oqu(i.Name||"(no name)"),e.xp6(6),e.Oqu(i.Description),e.xp6(4),e.Q6J("ngIf",t.showDataSourceDetails&&(null==t.dataSourceConfigs[i.EntityId]?null:t.dataSourceConfigs[i.EntityId].length)),e.xp6(1),e.Q6J("title",i.PartAssemblyAndType),e.xp6(1),e.hij(" Type: ",n.getTypeName(i.PartAssemblyAndType)," "),e.xp6(1),e.Q6J("ngIf",t.allowEdit&&t.typeInfos[i.EntityGuid].DynamicOut),e.xp6(1),e.Q6J("ngIf",t.allowEdit&&t.typeInfos[i.EntityGuid].DynamicIn)}}function it(o,s){if(1&o&&(e.ynx(0),e.YNc(1,nt,26,21,"div",4),e.BQk()),2&o){const i=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",i.pipelineDataSources)}}function ot(o,s){if(1&o&&(e.TgZ(0,"div",1,2),e.YNc(2,it,2,1,"ng-container",3),e.qZA()),2&o){const i=e.oxw();e.xp6(2),e.Q6J("ngIf",!i.hardReset)}}let K=(()=>{var o;class s extends j.f{constructor(t,n,a,r,l){super(),this.visualQueryService=t,this.queryDefinitionService=n,this.changeDetectorRef=a,this.dialog=r,this.viewContainerRef=l,this.dataSrcIdPrefix=m,this.hardReset=!1,this.scriptLoaded$=new O.X(!1)}ngOnInit(){(0,ie.y)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],()=>{this.scriptLoaded$.next(!0)}),this.subscription.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(n=>{this.plumber.putEntityCountOnConnections(n)}));const t=this.visualQueryService.pipelineModel$.pipe((0,x.U)(n=>Q.iX.tryParse(n?.Pipeline.VisualDesignerData)??{}),(0,H.x)(Q.iX.objectsEqual));this.viewModel$=(0,k.a)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$,t,this.visualQueryService.dataSourceConfigs$]).pipe((0,x.U)(([n,a,r,l])=>null==n||null==a?void 0:(this.hardReset=!0,this.changeDetectorRef.detectChanges(),this.hardReset=!1,{pipelineDataSources:n.DataSources,typeInfos:Ze(n.DataSources,a),allowEdit:n.Pipeline.AllowEdit,showDataSourceDetails:r.ShowDataSourceDetails??!1,dataSourceConfigs:l})))}ngAfterViewInit(){const t=this.domDataSourcesRef.changes.pipe((0,x.U)(()=>!0));this.subscription.add((0,k.a)([this.scriptLoaded$,t]).subscribe(([n,a])=>{!n||!a||(this.plumber?.destroy(),this.plumber=new Le(this.domRootRef.nativeElement,this.visualQueryService.pipelineModel$.value,this.visualQueryService.dataSources$.value,this.onConnectionsChanged.bind(this),this.onDragend.bind(this),this.onDebugStream.bind(this),this.dialog,this.viewContainerRef,this.changeDetectorRef))}))}ngOnDestroy(){this.plumber?.destroy(),this.scriptLoaded$.complete(),super.ngOnDestroy()}onConnectionsChanged(){const t=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(t,n)}onDragend(t,n){this.visualQueryService.changeDataSourcePosition(t,n)}onDebugStream(t){this.visualQueryService.debugStream(t)}configureDataSource(t){t.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(t)}getTypeName(t){const n=this.visualQueryService.dataSources$.value.find(a=>a.PartAssemblyAndType===t);return this.queryDefinitionService.typeNameFilter(n?.TypeNameForUi||t,"className")}isOutDataSource(t){return t.PartAssemblyAndType===g.Zy.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(t){if(!confirm(`Delete ${t.Name} data source?`))return;this.plumber.removeEndpointsOnDataSource(t.EntityGuid);const n=this.plumber.getAllConnections(),a=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(t.EntityGuid,n,a)}openHelp(t){window.open(t,"_blank")}editName(t){const n=prompt("Rename data source",t.Name)?.trim();null==n||""===n||this.visualQueryService.renameDataSource(t.EntityGuid,n)}editDescription(t){const n=prompt("Edit description",t.Description)?.trim();null!=n&&this.visualQueryService.changeDataSourceDescription(t.EntityGuid,n)}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(Z),e.Y36(N),e.Y36(e.sBO),e.Y36(_.uw),e.Y36(e.s_b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-plumb-editor"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Ye,5),e.Gf(He,5)),2&t){let a;e.iGM(a=e.CRH())&&(n.domRootRef=a.first),e.iGM(a=e.CRH())&&(n.domDataSourcesRef=a)}},features:[e.qOj],decls:2,vars:3,consts:[["id","pipeline-root",4,"ngIf"],["id","pipeline-root"],["domRoot",""],[4,"ngIf"],["class","dataSource",3,"id","ngStyle","ngClass",4,"ngFor","ngForOf"],[1,"dataSource",3,"id","ngStyle","ngClass"],["domDataSource",""],[1,"actions","left"],[1,"type-info",3,"title"],["class","configure","title","Configure data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],["class","help","title","Help for this data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],[1,"actions","right"],["class","delete","title","Delete","appMousedownStopPropagation","",3,"click",4,"ngIf"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["class","add-endpoint sourceEndpoint dynamic","title","Drag a new Out-Connection",4,"ngIf"],["class","many-in targetEndpoint dynamic","title","This data source supports multiple In-Connections",4,"ngIf"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],["class","config",4,"ngFor","ngForOf"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"]],template:function(t,n){1&t&&(e.YNc(0,ot,3,1,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.viewModel$))},dependencies:[d.mk,d.sg,d.O5,d.PC,Ge.d,C.Hw,d.Ov],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}\n\n/*# sourceMappingURL=https://sources.2sxc.org/16.17.00/dist/ng-edit/C:/Projects/2sxc/eav-ui/projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.component.ts-angular-inline--1.css.map*/"]}),s})();function rt(o,s){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const i=s.$implicit;e.xp6(1),e.hij(" ",i," ")}}function lt(o,s){if(1&o&&(e.TgZ(0,"ul",15),e.YNc(1,rt,2,1,"li",16),e.qZA()),2&o){const i=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",null==i.Pipeline.Params?null:i.Pipeline.Params.split("\n"))}}function ct(o,s){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const i=s.$implicit;e.xp6(1),e.hij(" ",i," ")}}function ut(o,s){if(1&o&&(e.TgZ(0,"ul",15),e.YNc(1,ct,2,1,"li",16),e.qZA()),2&o){const i=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",null==i.Pipeline.TestParameters?null:i.Pipeline.TestParameters.split("\n"))}}function pt(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",6)(1,"span",17),e._uU(2,"Show DataSource Params"),e.qZA(),e.TgZ(3,"mat-slide-toggle",18),e.NdJ("change",function(n){e.CHM(i);const a=e.oxw(2);return e.KtG(a.showDataSourceDetails(n))}),e.qZA()()}if(2&o){const i=s.ngIf;e.xp6(3),e.Q6J("checked",i.ShowDataSourceDetails)}}function dt(o,s){1&o&&e._UZ(0,"li",23),2&o&&e.Q6J("innerHTML",s.$implicit,e.oJD)}function mt(o,s){if(1&o&&(e.TgZ(0,"div",20)(1,"div",7)(2,"span"),e._uU(3,"Warnings"),e.qZA(),e.TgZ(4,"mat-icon",21),e._uU(5,"warning"),e.qZA()(),e.TgZ(6,"ol",15),e.YNc(7,dt,1,1,"li",22),e.qZA()()),2&o){const i=e.oxw().ngIf;e.xp6(7),e.Q6J("ngForOf",i)}}function gt(o,s){if(1&o&&(e.ynx(0),e.YNc(1,mt,8,1,"div",19),e.BQk()),2&o){const i=s.ngIf;e.xp6(1),e.Q6J("ngIf",i.length)}}function ft(o,s){if(1&o&&(e.TgZ(0,"div",24)(1,"div",7),e._uU(2,"Query Description"),e.qZA(),e.TgZ(3,"div"),e._uU(4),e.qZA()()),2&o){const i=e.oxw().ngIf;e.xp6(4),e.Oqu(i.Pipeline.Description)}}function ht(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.saveAndRunQuery(!0,!0))}),e._uU(4," Save and run "),e.qZA(),e.TgZ(5,"button",5),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.saveAndRunQuery(!1,!0))}),e._uU(6," Run "),e.qZA(),e.TgZ(7,"button",5),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.saveAndRunQuery(!0,!1))}),e._uU(8," Save "),e.qZA()(),e.TgZ(9,"div",6)(10,"div",7)(11,"div"),e._uU(12,"Query Parameters"),e.qZA(),e.TgZ(13,"div")(14,"button",8),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.editPipeline())}),e.TgZ(15,"mat-icon"),e._uU(16,"edit"),e.qZA()(),e.TgZ(17,"button",9),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.openParamsHelp())}),e.TgZ(18,"mat-icon"),e._uU(19,"info"),e.qZA()()()(),e.YNc(20,lt,2,1,"ul",10),e.qZA(),e.TgZ(21,"div",6)(22,"div",7),e._uU(23,"Test Parameters"),e.qZA(),e.YNc(24,ut,2,1,"ul",10),e.qZA(),e.YNc(25,pt,4,1,"div",11),e.ALo(26,"async"),e.YNc(27,gt,2,1,"ng-container",12),e.ALo(28,"async"),e.YNc(29,ft,5,1,"div",13),e.TgZ(30,"div",14)(31,"button",5),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.openRestApi())}),e.TgZ(32,"span"),e._uU(33,"Use in JSON / REST API"),e.qZA(),e.TgZ(34,"mat-icon"),e._uU(35,"code_curly"),e.qZA()()()()()}if(2&o){const i=s.ngIf,t=e.oxw();e.xp6(20),e.Q6J("ngIf",null==i.Pipeline.Params?null:i.Pipeline.Params.length),e.xp6(4),e.Q6J("ngIf",null==i.Pipeline.TestParameters?null:i.Pipeline.TestParameters.length),e.xp6(1),e.Q6J("ngIf",e.lcZ(26,5,t.visualDesignerData$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(28,7,t.warnings$)),e.xp6(2),e.Q6J("ngIf",i.Pipeline.Description)}}let _t=(()=>{var o;class s{constructor(t,n,a,r){this.router=t,this.route=n,this.context=a,this.visualQueryService=r}ngOnInit(){this.pipelineModel$=this.visualQueryService.pipelineModel$.asObservable(),this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,x.U)(t=>function st(o,s){const i=[];try{const t=o.Pipeline.Params?.split(/\r?\n/)||[],n=o.Pipeline.TestParameters?.split(/\r?\n/)||[];t.forEach(a=>{a=a?.trim(),a&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(a)||i.push(`\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>${a}</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        `))}),n.forEach(a=>{if(a=a?.trim(),!a)return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(a)||i.push(`\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>${a}</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        `);const p=/^\[module:id\]=([0-9]*)$/gim.exec(a);if(p){const D=p[1],v=s.moduleId?.toString();D!==v&&i.push(`\n            Your test ModuleId (${D}) is different from the current ModuleId (${v}).<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          `)}/^\[module:moduleid\]=([0-9]*)$/gim.exec(a)&&i.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")})}catch(t){console.error("Something went wrong in calculateWarnings for params",t)}return i}(t,this.context))),this.visualDesignerData$=this.visualQueryService.pipelineModel$.pipe((0,x.U)(t=>Q.iX.tryParse(t.Pipeline.VisualDesignerData)??{}))}editPipeline(){this.visualQueryService.editPipelineEntity()}openParamsHelp(){window.open("https://go.2sxc.org/QueryParams","_blank")}saveAndRunQuery(t,n){this.visualQueryService.saveAndRun(t,n)}showDataSourceDetails(t){this.visualQueryService.showDataSourceDetails(t.checked)}openRestApi(){this.router.navigate([Y.ii.getUrlQuery(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)],{relativeTo:this.route})}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(T.F0),e.Y36(T.gz),e.Y36(w._),e.Y36(Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-run-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],["class","values",4,"ngIf"],["class","parameters",4,"ngIf"],[4,"ngIf"],["class","description",4,"ngIf"],[1,"footer-actions"],[1,"values"],[4,"ngFor","ngForOf"],[1,"eav-slide-toggle-label"],["color","primary","labelPosition","before",3,"checked","change"],["class","warnings",4,"ngIf"],[1,"warnings"],[2,"color","red"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"description"]],template:function(t,n){1&t&&(e.YNc(0,ht,36,9,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.pipelineModel$))},dependencies:[d.sg,d.O5,P.$,C.Hw,S.lW,S.RK,I.Rr,d.Ov],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}.eav-slide-toggle-label[_ngcontent-%COMP%]{margin-right:4px;font-size:14px}"]}),s})();function vt(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",8),e.NdJ("click",function(){const a=e.CHM(i).$implicit,r=e.oxw(4);return e.KtG(r.addDataSource(a))}),e.TgZ(1,"mat-icon"),e._uU(2),e.qZA(),e.TgZ(3,"span"),e._uU(4),e.qZA()()}if(2&o){const i=s.$implicit,t=e.oxw(4);e.Q6J("tippy",i.UiHint||i.Name),e.xp6(2),e.Oqu(i.Icon||t.guiTypes.Unknown.Icon),e.xp6(2),e.Oqu(i.Name)}}function xt(o,s){if(1&o&&(e.TgZ(0,"div",6),e.YNc(1,vt,5,3,"div",7),e.qZA()),2&o){const i=e.oxw().$implicit,t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",i.value)("ngForTrackBy",t.trackDataSources)}}function St(o,s){if(1&o){const i=e.EpF();e.ynx(0),e.TgZ(1,"div",4),e.NdJ("click",function(){const a=e.CHM(i).$implicit,r=e.oxw(2);return e.KtG(r.toggleItem(a.key))}),e.TgZ(2,"mat-icon"),e._uU(3),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA()(),e.YNc(6,xt,2,2,"div",5),e.BQk()}if(2&o){const i=s.$implicit,t=e.oxw(2);let n;e.xp6(1),e.Q6J("tippy",t.guiTypes[i.key].UiHint||i.key),e.xp6(2),e.Oqu(t.guiTypes[i.key].Icon||t.guiTypes.Unknown.Icon),e.xp6(2),e.Oqu(null!==(n=null!==(n=t.guiTypes[i.key].Label)&&void 0!==n?n:t.guiTypes[i.key].Name)&&void 0!==n?n:i.key),e.xp6(1),e.Q6J("ngIf",t.toggledItems.includes(i.key))}}function bt(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"div",1)(1,"mat-slide-toggle",2),e.NdJ("change",function(n){e.CHM(i);const a=e.oxw();return e.KtG(a.toggleDifficulty(n))}),e._uU(2," Show Advanced "),e.qZA(),e.YNc(3,St,7,4,"ng-container",3),e.ALo(4,"keyvalue"),e.qZA()}if(2&o){const i=s.ngIf,t=e.oxw();e.xp6(3),e.Q6J("ngForOf",e.lcZ(4,2,i.sorted))("ngForTrackBy",t.trackGroups)}}let Ct=(()=>{var o;class s{constructor(t){this.visualQueryService=t,this.toggledItems=[],this.guiTypes=R,this.difficulties=g.Zy.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new O.X(this.difficulties.default)}ngOnInit(){this.viewModel$=(0,k.a)([(0,k.a)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,x.U)(([t,n])=>function yt(o,s){if(!o)return;const t=(0,b.Z)(o).filter(a=>a.Difficulty<=s&&a.PartAssemblyAndType!==g.Zy.pipelineDesigner.outDataSource.PartAssemblyAndType);t.sort((a,r)=>a.Name.toLocaleLowerCase().localeCompare(r.Name.toLocaleLowerCase()));const n={};for(const a of t){const r=a.PrimaryType;n[r]?n[r].push(a):n[r]=[a]}return n}(t,n)))]).pipe((0,x.U)(([t])=>({sorted:t})))}ngOnDestroy(){this.difficulty$.complete()}toggleDifficulty(t){this.difficulty$.next(t.checked?this.difficulties.advanced:this.difficulties.default)}addDataSource(t){this.visualQueryService.addDataSource(t)}toggleItem(t){Q.iX.toggleInArray(t,this.toggledItems)}trackGroups(t,n){return n.key}trackDataSources(t,n){return n.PartAssemblyAndType}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],["labelPosition","before","color","primary",3,"change"],[4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"collapsible",3,"tippy","click"],["class","list",4,"ngIf"],[1,"list"],["class","list-item","tippyShowDelay","750",3,"tippy","click",4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"list-item",3,"tippy","click"]],template:function(t,n){1&t&&(e.YNc(0,bt,5,4,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.viewModel$))},dependencies:[d.sg,d.O5,P.$,C.Hw,I.Rr,d.Ov,d.Nd],styles:[".mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}"]}),s})();const z=function(o){return{active:o}},Tt=[{path:"",component:(()=>{var o;class s{constructor(t,n,a){this.context=t,this.route=n,this.visualQueryService=a,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(t){this.activeExplorer=this.activeExplorer===t?null:t}openHelp(){window.open("https://go.2sxc.org/visual-query","_blank")}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(w._),e.Y36(T.gz),e.Y36(Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-visual-query"]],viewQuery:function(t,n){if(1&t&&e.Gf(K,5),2&t){let a;e.iGM(a=e.CRH())&&(n.plumbEditor=a.first)}},features:[e._Bn([Z])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"ngClass","click"],["tippy","Add",1,"button",3,"ngClass","click"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(t,n){1&t&&(e._UZ(0,"router-outlet"),e.TgZ(1,"div",0)(2,"div",1)(3,"div",2),e.NdJ("click",function(){return n.toggleExplorer(n.explorer.run)}),e.TgZ(4,"mat-icon"),e._uU(5,"play_arrow"),e.qZA()(),e.TgZ(6,"div",3),e.NdJ("click",function(){return n.toggleExplorer(n.explorer.add)}),e.TgZ(7,"mat-icon"),e._uU(8,"add"),e.qZA()(),e._UZ(9,"div",4),e.TgZ(10,"div",5),e.NdJ("click",function(){return n.openHelp()}),e.TgZ(11,"mat-icon"),e._uU(12,"help_outline"),e.qZA()()(),e._UZ(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngClass",e.VKq(4,z,n.activeExplorer===n.explorer.run)),e.xp6(3),e.Q6J("ngClass",e.VKq(6,z,n.activeExplorer===n.explorer.add)),e.xp6(7),e.Q6J("hidden",n.activeExplorer!==n.explorer.run),e.xp6(1),e.Q6J("hidden",n.activeExplorer!==n.explorer.add))},dependencies:[d.mk,P.$,T.lC,C.Hw,_t,Ct,K],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),s})(),children:[Y.ii.route,{matcher:ne.eP,loadChildren:()=>Promise.all([c.e("default-projects_eav-ui_src_app_create-file-dialog_index_ts"),c.e("default-node_modules_angular_material_fesm2022_list_mjs"),c.e("default-node_modules_angular_material_fesm2022_autocomplete_mjs"),c.e("default-node_modules_angular_material_fesm2022_card_mjs"),c.e("default-projects_eav-ui_src_app_edit_edit_module_ts"),c.e("default-node_modules_angular_cdk_fesm2022_drag-drop_mjs"),c.e("default-node_modules_angular_material_fesm2022_menu_mjs"),c.e("projects_eav-ui_src_app_features_features_module_ts-node_modules_angular_material_fesm2022_ba-6782aa")]).then(c.bind(c,9154)).then(o=>o.EditModule),data:{history:!1}}]}];let Dt=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[T.Bz.forChild(Tt),T.Bz]}),s})(),Zt=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[w._,N,G.D,L.s,{provide:A.o2,useValue:{subscriptSizing:"dynamic"}},{provide:U.PG,useValue:{hideSingleSelectionIndicator:!0}},{provide:I.HT,useValue:{hideIcon:!0}}],imports:[d.ez,X.q,Dt,C.Ps,S.ot,I.rP,F.ZX,_.Is,M.Nh,A.lN,f.UX,U.LD,J.c]}),s})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/16.17.00/dist/ng-edit/projects_eav-ui_src_app_visual-query_visual-query_module_ts.24f9e37f80b699ce.js.map