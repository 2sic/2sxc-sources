(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_ng-dialogs_src_app_visual-query_visual-query_module_ts"],{9006:function(e,t,n){"use strict";n.r(t),n.d(t,{VisualQueryModule:function(){return ct}});var i=n(1116),o=n(1041),r=n(4369),a=n(2935),s=n(3070),l=n(7307),u=n(9550),c=n(3841),p=n(9572),d=n(3589),f=n(7173),g=n(2832),h=n(3584),v=n(3582),m=n(2677),y=n(4762),b=n(9996),Z=n(5151),x=n(5803),S=n(1785),_=n(2693),T=n(2837),A=function(){function e(e,t,n){this.http=e,this.context=t,this.dnnContext=n}return e.prototype.fetchPipeline=function(e,t){var n=this;return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.TB),{params:{appId:this.context.appId.toString(),id:e.toString()}}).pipe((0,b.U)(function(e){return e.DataSources.length||n.buildDefaultModel(e,t),n.fixPipelineDataSources(e.DataSources),e}))},e.prototype.buildDefaultModel=function(e,t){var n,i,o=x.Z.pipelineDesigner.defaultPipeline.dataSources,r=function(n){var i=t.find(function(e){return e.PartAssemblyAndType===n.PartAssemblyAndType});e.DataSources.push({Description:"",EntityGuid:n.EntityGuid,EntityId:void 0,Name:i.Name,PartAssemblyAndType:n.PartAssemblyAndType,VisualDesignerData:n.VisualDesignerData})};try{for(var a=(0,y.XA)(o),s=a.next();!s.done;s=a.next())r(s.value)}catch(l){n={error:l}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}e.Pipeline.StreamWiring=x.Z.pipelineDesigner.defaultPipeline.streamWiring},e.prototype.fixPipelineDataSources=function(e){var t,n,i;if(!e.some(function(e){return e.EntityGuid===x.Z.pipelineDesigner.outDataSource.EntityGuid})){var o=x.Z.pipelineDesigner.outDataSource;e.push({Description:o.Description,EntityGuid:o.EntityGuid,EntityId:void 0,Name:o.Name,PartAssemblyAndType:o.PartAssemblyAndType,VisualDesignerData:o.VisualDesignerData})}try{for(var r=(0,y.XA)(e),a=r.next();!a.done;a=r.next()){var s=a.value;null!==(i=s.VisualDesignerData)&&void 0!==i||(s.VisualDesignerData={Top:50,Left:50})}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.fetchDataSources=function(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.bf)).pipe((0,b.U)(function(e){var t=x.Z.pipelineDesigner.outDataSource;return e.push({ContentType:void 0,Difficulty:x.Z.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:t.In,Name:t.Name,Out:void 0,PartAssemblyAndType:t.PartAssemblyAndType,PrimaryType:t.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),e}))},e.prototype.typeNameFilter=function(e,t){var n=e.split(", ");switch(t){case"classFullName":return n[0];case"className":var i=n[0].split(".");return i[i.length-1];default:return e}},e.prototype.savePipeline=function(e){var t=this,n=e.Pipeline,i=e.DataSources;return this.http.post(this.dnnContext.$2sxc.http.apiUrl(Z.nt),{pipeline:n,dataSources:i},{params:{appId:this.context.appId.toString(),Id:n.EntityId.toString()}}).pipe((0,b.U)(function(e){return t.fixPipelineDataSources(e.DataSources),e}))},e.prototype.runPipeline=function(e,t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.cv),{params:{appId:this.context.appId.toString(),id:e.toString(),top:t.toString()}})},e.prototype.debugStream=function(e,t,n,i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.Az),{params:{appId:this.context.appId.toString(),id:e.toString(),from:t,out:n,top:i.toString()}})},e.\u0275fac=function(t){return new(t||e)(S.LFG(_.eN),S.LFG(v._),S.LFG(T._y))},e.\u0275prov=S.Yz7({token:e,factory:e.\u0275fac}),e}(),D=n(1282),C=n(5788),w=n(7860),P=n(8512),q=n(7570),k=n(1305),I=n(8720),O=n(447),E=n(7983),M={Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function U(e,t){var n,i,o={},r=function(e){var n=void 0,i=t.find(function(t){return t.PartAssemblyAndType===e.PartAssemblyAndType});i&&(n=(0,y.pi)({},i.PrimaryType?M[i.PrimaryType]:M.Unknown),null!=i.Icon&&(n.Icon=i.Icon),null!=i.DynamicIn&&(n.DynamicIn=i.DynamicIn),null!=i.DynamicOut&&(n.DynamicOut=i.DynamicOut),null!=i.HelpLink&&(n.HelpLink=i.HelpLink),null!=i.EnableConfig&&(n.EnableConfig=i.EnableConfig),null!=i.UiHint&&(n.UiHint=i.UiHint)),n||(n=(0,y.pi)({},M.Unknown)),o[e.EntityGuid]=n};try{for(var a=(0,y.XA)(e),s=a.next();!s.done;s=a.next())r(s.value)}catch(l){n={error:l}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o}var Q=n(6238),N=n(2417),$=n(5959),J=n(7254),R=n(3835),L=n(2855),F=n(2420),Y=n(7512);function G(e,t){if(1&e&&(S.ynx(0),S._uU(1),S.BQk()),2&e){var n=S.oxw();S.xp6(1),S.AsE(' for Stream: "',n.debugStream.name,'" on Source: "',n.debugStream.sourceName,'" ')}}function H(e,t){1&e&&(S.TgZ(0,"div",12),S.TgZ(1,"span"),S._uU(2,"Results"),S.qZA(),S.qZA())}function j(e,t){1&e&&(S.ynx(0),S._uU(1,"Showing All results"),S.BQk())}function B(e,t){if(1&e&&(S.ynx(0),S._uU(1),S.BQk()),2&e){var n=S.oxw();S.xp6(1),S.hij("Showing top ",n.top," results")}}function V(e,t){1&e&&(S.ynx(0),S._uU(1,"All"),S.BQk())}function X(e,t){if(1&e&&(S.ynx(0),S._uU(1),S.BQk()),2&e){var n=S.oxw().$implicit;S.xp6(1),S.Oqu(n)}}function W(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"button",13),S.NdJ("click",function(){var e=S.CHM(n).$implicit;return S.oxw().show(e)}),S._uU(1," Show "),S.YNc(2,V,2,0,"ng-container",2),S.YNc(3,X,2,1,"ng-container",2),S.qZA()}if(2&e){var i=t.$implicit;S.xp6(2),S.Q6J("ngIf",0===i),S.xp6(1),S.Q6J("ngIf",0!==i)}}function z(e,t){1&e&&(S.TgZ(0,"div",15),S.TgZ(1,"span"),S._uU(2,"Parameters"),S.qZA(),S.qZA())}function K(e,t){if(1&e&&(S.TgZ(0,"li"),S._uU(1),S.qZA()),2&e){var n=t.$implicit;S.xp6(1),S.Oqu(n)}}function ee(e,t){if(1&e&&(S.TgZ(0,"mat-tab"),S.YNc(1,z,3,0,"div",14),S._UZ(2,"br"),S.TgZ(3,"ul",7),S.YNc(4,K,2,1,"li",10),S.qZA(),S.qZA()),2&e){var n=S.oxw();S.xp6(4),S.Q6J("ngForOf",n.parameters)}}function te(e,t){1&e&&(S.TgZ(0,"div",16),S.TgZ(1,"span"),S._uU(2,"Sources"),S.qZA(),S.qZA())}function ne(e,t){if(1&e&&(S.TgZ(0,"div"),S._uU(1),S.qZA()),2&e){var n=S.oxw().$implicit;S.xp6(1),S.Oqu(null==n.value.Definition?null:n.value.Definition.Name)}}function ie(e,t){if(1&e&&(S.TgZ(0,"li"),S.TgZ(1,"b"),S._uU(2),S.qZA(),S._uU(3,"="),S.TgZ(4,"em"),S._uU(5),S.qZA(),S.qZA()),2&e){var n=t.$implicit;S.xp6(2),S.Oqu(n.key),S.xp6(3),S.Oqu(n.value)}}function oe(e,t){if(1&e&&(S.TgZ(0,"tr"),S.TgZ(1,"td"),S.YNc(2,ne,2,1,"div",2),S.TgZ(3,"pre"),S._uU(4),S.qZA(),S.qZA(),S.TgZ(5,"td"),S._uU(6),S.qZA(),S.TgZ(7,"td"),S.TgZ(8,"ol"),S.YNc(9,ie,6,2,"li",10),S.ALo(10,"keyvalue"),S.qZA(),S.qZA(),S.TgZ(11,"td"),S._uU(12),S.qZA(),S.qZA()),2&e){var n=t.$implicit;S.xp6(2),S.Q6J("ngIf",null==n.value.Definition?null:n.value.Definition.Name),S.xp6(2),S.Oqu(n.value.Guid),S.xp6(2),S.Oqu(n.value.Type),S.xp6(3),S.Q6J("ngForOf",S.lcZ(10,5,n.value.Configuration)),S.xp6(3),S.Oqu(n.value.Error)}}function re(e,t){1&e&&(S.TgZ(0,"div",17),S.TgZ(1,"span"),S._uU(2,"Streams"),S.qZA(),S.qZA())}function ae(e,t){if(1&e&&(S.TgZ(0,"tr"),S.TgZ(1,"td"),S.TgZ(2,"pre"),S._uU(3),S.qZA(),S.qZA(),S.TgZ(4,"td"),S.TgZ(5,"pre"),S._uU(6),S.qZA(),S.qZA(),S.TgZ(7,"td"),S._uU(8),S.qZA(),S.TgZ(9,"td"),S._uU(10),S.qZA(),S.qZA()),2&e){var n=t.$implicit;S.xp6(3),S.Oqu(n.Source+":"+n.SourceOut),S.xp6(3),S.Oqu(n.Target+":"+n.TargetIn),S.xp6(2),S.Oqu(n.Count),S.xp6(2),S.Oqu(n.Error)}}var se=function(){function e(e,t,n){this.dialogData=e,this.dialogRef=t,this.visualQueryService=n}return e.prototype.ngOnInit=function(){var e,t,n,i,o=this.visualQueryService.pipelineModel$.value.Pipeline,r=(null!==(t=null===(e=o.Params)||void 0===e?void 0:e.split("\n"))&&void 0!==t?t:[]).filter(function(e){return!!e}),a=(null!==(i=null===(n=o.TestParameters)||void 0===n?void 0:n.split("\n"))&&void 0!==i?i:[]).filter(function(e){return!!e});this.parameters=[].concat(r,a),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.show=function(e){e!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,e):this.visualQueryService.runPipeline(e),this.closeDialog())},e.\u0275fac=function(t){return new(t||e)(S.Y36(a.WI),S.Y36(a.so),S.Y36(ce))},e.\u0275cmp=S.Xpm({type:e,selectors:[["app-query-result"]],decls:50,vars:14,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-description"],["dynamicHeight","","color","accent"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"description"],["mat-button","",3,"click",4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],[4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(e,t){1&e&&(S.TgZ(0,"div",0),S.TgZ(1,"div",1),S.TgZ(2,"div"),S._uU(3," Query Results "),S.YNc(4,G,2,2,"ng-container",2),S.qZA(),S.TgZ(5,"button",3),S.NdJ("click",function(){return t.closeDialog()}),S.TgZ(6,"mat-icon"),S._uU(7,"close"),S.qZA(),S.qZA(),S.qZA(),S.qZA(),S.TgZ(8,"p",4),S._uU(9),S.qZA(),S.TgZ(10,"mat-tab-group",5),S.TgZ(11,"mat-tab"),S.YNc(12,H,3,0,"div",6),S.TgZ(13,"p",7),S.YNc(14,j,2,0,"ng-container",2),S.YNc(15,B,2,1,"ng-container",2),S.YNc(16,W,4,2,"button",8),S.qZA(),S.TgZ(17,"pre"),S._uU(18),S.ALo(19,"json"),S.qZA(),S.qZA(),S.YNc(20,ee,5,1,"mat-tab",2),S.TgZ(21,"mat-tab"),S.YNc(22,te,3,0,"div",9),S._UZ(23,"br"),S.TgZ(24,"table",7),S.TgZ(25,"tr"),S.TgZ(26,"th"),S._uU(27,"Name and Guid"),S.qZA(),S.TgZ(28,"th"),S._uU(29,"Type"),S.qZA(),S.TgZ(30,"th"),S._uU(31,"Configuration"),S.qZA(),S.TgZ(32,"th"),S._uU(33,"Error"),S.qZA(),S.qZA(),S.YNc(34,oe,13,7,"tr",10),S.ALo(35,"keyvalue"),S.qZA(),S.qZA(),S.TgZ(36,"mat-tab"),S.YNc(37,re,3,0,"div",11),S._UZ(38,"br"),S.TgZ(39,"table",7),S.TgZ(40,"tr"),S.TgZ(41,"th"),S._uU(42,"Source"),S.qZA(),S.TgZ(43,"th"),S._uU(44,"Target"),S.qZA(),S.TgZ(45,"th"),S._uU(46,"Items"),S.qZA(),S.TgZ(47,"th"),S._uU(48,"Error"),S.qZA(),S.qZA(),S.YNc(49,ae,11,4,"tr",10),S.qZA(),S.qZA(),S.qZA()),2&e&&(S.xp6(4),S.Q6J("ngIf",t.debugStream),S.xp6(5),S.AsE(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",t.timeUsed,"ms (",t.ticksUsed," ticks)\n"),S.xp6(5),S.Q6J("ngIf",0===t.top),S.xp6(1),S.Q6J("ngIf",0!==t.top),S.xp6(1),S.Q6J("ngForOf",t.optionsForTop),S.xp6(2),S.Oqu(S.lcZ(19,10,t.result)),S.xp6(2),S.Q6J("ngIf",null==t.parameters?null:t.parameters.length),S.xp6(14),S.Q6J("ngForOf",S.lcZ(35,12,t.sources)),S.xp6(15),S.Q6J("ngForOf",t.streams))},directives:[a.uh,i.O5,r.lW,Y.$,l.Hw,f.SP,f.uX,f.uD,i.sg],pipes:[i.Ts,i.Nd],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]}),e}(),le=function(){function e(e,t){this.dialogData=e,this.dialogRef=t}return e.prototype.ngOnInit=function(){this.errorData=this.dialogData.errorData},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.openInsights=function(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api"),"_blank")},e.\u0275fac=function(t){return new(t||e)(S.Y36(a.WI),S.Y36(a.so))},e.\u0275cmp=S.Xpm({type:e,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],["mat-button","","tippy","Open 2sxc Insights",3,"click"]],template:function(e,t){1&e&&(S.TgZ(0,"div",0),S.TgZ(1,"div",1),S.TgZ(2,"div"),S._uU(3,"Stream Error Results"),S.qZA(),S.TgZ(4,"button",2),S.NdJ("click",function(){return t.closeDialog()}),S.TgZ(5,"mat-icon"),S._uU(6,"close"),S.qZA(),S.qZA(),S.qZA(),S.qZA(),S._UZ(7,"br"),S.TgZ(8,"pre"),S._uU(9),S.ALo(10,"json"),S.qZA(),S.TgZ(11,"div"),S.TgZ(12,"button",3),S.NdJ("click",function(){return t.openInsights()}),S.TgZ(13,"mat-icon"),S._uU(14,"speed"),S.qZA(),S.TgZ(15,"span"),S._uU(16,"Insights"),S.qZA(),S.qZA(),S.qZA()),2&e&&(S.xp6(9),S.Oqu(S.lcZ(10,1,t.errorData)))},directives:[a.uh,r.lW,Y.$,l.Hw],pipes:[i.Ts],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]}),e}(),ue=n(9624),ce=function(){function e(e,t,n,i,o,r,a,s,l,u,c){this.router=e,this.route=t,this.queryDefinitionService=n,this.titleService=i,this.snackBar=o,this.dialog=r,this.viewContainerRef=a,this.zone=s,this.metadataService=l,this.contentTypesService=u,this.changeDetectorRef=c,this.pipelineModel$=new P.X(null),this.dataSources$=new P.X(null),this.putEntityCountOnConnections$=new $.xQ,this.dataSourceConfigs$=new P.X({}),this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1,this.subscription=new q.w}return e.prototype.ngOnDestroy=function(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),this.subscription.unsubscribe()},e.prototype.init=function(){var e=this;this.fetchDataSources(function(){return e.fetchPipeline(!0,!0,!1)}),this.attachKeyboardSave(),this.refreshOnChildClosed()},e.prototype.editPipelineEntity=function(){var e=this;this.savePipeline(function(){var t=(0,F.f)({items:[{EntityId:e.pipelineModel$.value.Pipeline.EntityId}]});e.router.navigate(["edit/"+t],{relativeTo:e.route}),e.refreshPipeline=!0})},e.prototype.saveAndRun=function(e,t){var n=this;e&&t?this.savePipeline(function(){n.runPipeline()}):e?this.savePipeline():t&&this.runPipeline()},e.prototype.showDataSourceDetails=function(e){var t,n=(0,N.Z)(this.pipelineModel$.value),i=null!==(t=O.iX.tryParse(n.Pipeline.VisualDesignerData))&&void 0!==t?t:{};i.ShowDataSourceDetails=e,n.Pipeline.VisualDesignerData=JSON.stringify(i),this.pipelineModel$.next(n)},e.prototype.addDataSource=function(e){var t=(0,N.Z)(this.pipelineModel$.value);t.DataSources.push({Description:"",EntityGuid:"unsaved"+(t.DataSources.length+1),EntityId:void 0,Name:e.Name,PartAssemblyAndType:e.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(t),this.savePipeline()},e.prototype.removeDataSource=function(e,t,n){var i=(0,N.Z)(this.pipelineModel$.value);i.DataSources=i.DataSources.filter(function(t){return t.EntityGuid!==e}),i.Pipeline.StreamWiring=t,i.Pipeline.StreamsOut=n,this.pipelineModel$.next(i)},e.prototype.renameDataSource=function(e,t){var n=(0,N.Z)(this.pipelineModel$.value);n.DataSources.find(function(t){return t.EntityGuid===e}).Name=t,this.pipelineModel$.next(n)},e.prototype.changeDataSourceDescription=function(e,t){var n=(0,N.Z)(this.pipelineModel$.value);n.DataSources.find(function(t){return t.EntityGuid===e}).Description=t,this.pipelineModel$.next(n)},e.prototype.changeConnections=function(e,t){var n=(0,N.Z)(this.pipelineModel$.value);n.Pipeline.StreamWiring=e,n.Pipeline.StreamsOut=t,this.pipelineModel$.next(n)},e.prototype.changeDataSourcePosition=function(e,t){var n=(0,N.Z)(this.pipelineModel$.value),i=n.DataSources.find(function(t){return t.EntityGuid===e});i&&(i.VisualDesignerData=(0,y.pi)((0,y.pi)({},i.VisualDesignerData),t),this.pipelineModel$.next(n))},e.prototype.calculateDataSourceConfigs=function(e){var t={};e.forEach(function(e){var n;null!=e.EntityId&&(t[e.EntityId]=[],null===(n=e.Metadata)||void 0===n||n.forEach(function(n){Object.entries(n).forEach(function(n){var i,o,r=(0,y.CR)(n,2),a=r[0],s=r[1];null!=s&&""!==s&&(["Created","Guid","Id","Modified","Title","_Type"].includes(a)||(Array.isArray(s)&&null!=(null===(i=s[0])||void 0===i?void 0:i.Title)&&null!=(null===(o=s[0])||void 0===o?void 0:o.Id)&&(s=s[0].Title+" ("+s[0].Id+")"),t[e.EntityId].push({name:a,value:s})))})}))}),this.dataSourceConfigs$.next(t)},e.prototype.editDataSource=function(e){var t=this,n=this.dataSources$.value.find(function(t){return t.PartAssemblyAndType===e.PartAssemblyAndType}).ContentType,i=e.EntityGuid;this.metadataService.getMetadata(x.Z.metadata.entity.type,x.Z.metadata.entity.keyType,i,n).subscribe(function(e){if(e.Items.length){var o=(0,F.f)({items:[{EntityId:e.Items[0].Id}]});return t.router.navigate(["edit/"+o],{relativeTo:t.route}),void(t.refreshDataSourceConfigs=!0)}t.contentTypesService.retrieveContentType(n).subscribe({next:function(e){var o=(0,F.f)({items:[{ContentTypeName:n,For:{Target:x.Z.metadata.entity.target,Guid:i}}]});t.router.navigate(["edit/"+o],{relativeTo:t.route}),t.refreshDataSourceConfigs=!0},error:function(e){alert("Server reports error - this usually means that this data-source doesn't have any configuration")}})})},e.prototype.savePipeline=function(e){var t=this;this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:function(n){t.snackBar.open("Saved",null,{duration:2e3}),t.pipelineModel$.next(n),null!=e&&e()},error:function(e){t.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})},e.prototype.runPipeline=function(e){var t=this;void 0===e&&(e=25),this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,e).subscribe({next:function(n){t.snackBar.open("Query worked",null,{duration:2e3}),t.pipelineResult=n,t.showQueryResult(n,e),console.warn(n),t.pipelineModel$.next((0,N.Z)(t.pipelineModel$.value)),setTimeout(function(){t.putEntityCountOnConnections$.next(n)})},error:function(e){t.snackBar.open("Query failed",null,{duration:2e3})}})},e.prototype.debugStream=function(e,t){var n=this;void 0===t&&(t=25),e.Error?this.showStreamErrorResult(e):0!==e.Count&&(this.snackBar.open("Running stream..."),this.queryDefinitionService.debugStream(this.pipelineModel$.value.Pipeline.EntityId,e.Source,e.SourceOut,t).subscribe({next:function(i){n.snackBar.open("Stream worked",null,{duration:2e3});var o=n.pipelineModel$.value.DataSources.find(function(t){return t.EntityGuid===e.Source});n.showQueryResult(i,t,{name:e.SourceOut,source:e.Source,sourceName:o.Name,original:e}),console.warn(i)},error:function(e){n.snackBar.open("Stream failed",null,{duration:2e3})}}))},e.prototype.fetchPipeline=function(e,t,n){var i=this;n&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId,this.dataSources$.value).subscribe(function(o){n&&i.snackBar.open("Query reloaded",null,{duration:2e3}),i.titleService.setTitle(o.Pipeline.Name+" - Visual Query"),e&&i.pipelineModel$.next(o),t&&i.calculateDataSourceConfigs(o.DataSources)})},e.prototype.showQueryResult=function(e,t,n){this.dialog.open(se,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:e,debugStream:n,top:t},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()},e.prototype.showStreamErrorResult=function(e){this.dialog.open(le,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:e.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()},e.prototype.fetchDataSources=function(e){var t=this;this.queryDefinitionService.fetchDataSources().subscribe(function(n){t.dataSources$.next(n),e()})},e.prototype.attachKeyboardSave=function(){var e=this;this.zone.runOutsideAngular(function(){e.subscription.add((0,J.R)(window,"keydown").pipe((0,R.h)(function(){return!e.route.snapshot.firstChild}),(0,R.h)(function(e){return(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&83===e.keyCode})).subscribe(function(t){t.preventDefault(),e.zone.run(function(){e.savePipeline()})}))})},e.prototype.refreshOnChildClosed=function(){var e=this;this.subscription.add(this.router.events.pipe((0,R.h)(function(e){return e instanceof D.m2}),(0,Q.O)(!!this.route.snapshot.firstChild),(0,b.U)(function(){return!!e.route.snapshot.firstChild}),(0,L.G)(),(0,R.h)(function(e){var t=(0,y.CR)(e,2);return t[0]&&!t[1]})).subscribe(function(){(e.refreshPipeline||e.refreshDataSourceConfigs)&&e.fetchPipeline(e.refreshPipeline,e.refreshDataSourceConfigs,e.refreshPipeline),e.refreshPipeline=!1,e.refreshDataSourceConfigs=!1}))},e.\u0275fac=function(t){return new(t||e)(S.LFG(D.F0),S.LFG(D.gz),S.LFG(A),S.LFG(ue.Dx),S.LFG(d.ux),S.LFG(a.uw),S.LFG(S.s_b),S.LFG(S.R0b),S.LFG(h.D),S.LFG(g.s),S.LFG(S.sBO))},e.\u0275prov=S.Yz7({token:e,factory:e.\u0275fac}),e}(),pe=n(7110),de=n(1271),fe=n(7064);function ge(e,t){1&e&&(S.TgZ(0,"app-field-hint"),S._uU(1," You will get suggestions for out-streams after you run query "),S.qZA())}function he(e,t){1&e&&(S.TgZ(0,"app-field-hint",12),S._uU(1," This field is required "),S.qZA()),2&e&&S.Q6J("isError",!0)}function ve(e,t){if(1&e&&(S.ynx(0),S.TgZ(1,"mat-form-field",9),S.TgZ(2,"mat-label"),S._uU(3,"Label"),S.qZA(),S._UZ(4,"input",10),S.qZA(),S.YNc(5,ge,2,0,"app-field-hint",5),S.YNc(6,he,2,1,"app-field-hint",11),S.BQk()),2&e){var n=S.oxw();S.xp6(5),S.Q6J("ngIf",n.isSource&&!n.pipelineResultExists),S.xp6(1),S.Q6J("ngIf",n.controls.label.touched&&(null==n.controls.label.errors?null:n.controls.label.errors.required))}}function me(e,t){if(1&e&&(S.TgZ(0,"mat-option",21),S._uU(1),S.qZA()),2&e){var n=t.$implicit;S.Q6J("value",n.value),S.xp6(1),S.hij(" ",n.name," ")}}function ye(e,t){if(1&e&&(S.ynx(0),S.TgZ(1,"mat-form-field",9),S.TgZ(2,"mat-label"),S._uU(3,"Scope"),S.qZA(),S.TgZ(4,"mat-select",18),S.YNc(5,me,2,2,"mat-option",19),S.qZA(),S.qZA(),S.TgZ(6,"app-field-hint"),S._uU(7," The scope should almost never be changed - "),S.TgZ(8,"a",20),S._uU(9,"see help"),S.qZA(),S.qZA(),S.BQk()),2&e){var n=S.oxw(2);S.xp6(4),S.Q6J("placeholder",n.scopeOptions.length?"":"No items found"),S.xp6(1),S.Q6J("ngForOf",n.scopeOptions)}}function be(e,t){if(1&e&&(S.TgZ(0,"mat-option",21),S._uU(1),S.qZA()),2&e){var n=t.$implicit;S.Q6J("value",n),S.xp6(1),S.hij(" ",n," ")}}function Ze(e,t){if(1&e&&(S.TgZ(0,"mat-select",22),S.YNc(1,be,2,2,"mat-option",19),S.qZA()),2&e){var n=S.oxw(2);S.Q6J("placeholder",n.labelOptions.length?"":"No items found"),S.xp6(1),S.Q6J("ngForOf",n.labelOptions)}}function xe(e,t){1&e&&S._UZ(0,"input",10)}function Se(e,t){1&e&&(S.TgZ(0,"app-field-hint",12),S._uU(1," This field is required "),S.qZA()),2&e&&S.Q6J("isError",!0)}var _e=function(e){return{active:e}};function Te(e,t){if(1&e){var n=S.EpF();S.ynx(0),S.YNc(1,ye,10,2,"ng-container",5),S.TgZ(2,"mat-form-field",9),S.TgZ(3,"mat-label"),S._uU(4,"Label"),S.qZA(),S.YNc(5,Ze,2,2,"mat-select",13),S.YNc(6,xe,1,0,"input",14),S.TgZ(7,"div",15),S.TgZ(8,"button",16),S.NdJ("click",function(){return S.CHM(n),S.oxw().toggleGuidedLabel(!0)}),S.TgZ(9,"mat-icon"),S._uU(10,"search"),S.qZA(),S.qZA(),S.TgZ(11,"button",17),S.NdJ("click",function(){return S.CHM(n),S.oxw().toggleGuidedLabel(!1)}),S.TgZ(12,"mat-icon"),S._uU(13,"text_fields"),S.qZA(),S.qZA(),S.qZA(),S.qZA(),S.YNc(14,Se,2,1,"app-field-hint",11),S.BQk()}if(2&e){var i=S.oxw();S.xp6(1),S.Q6J("ngIf",i.advancedMode&&i.guidedLabel),S.xp6(4),S.Q6J("ngIf",i.guidedLabel),S.xp6(1),S.Q6J("ngIf",!i.guidedLabel),S.xp6(2),S.Q6J("ngClass",S.VKq(6,_e,i.guidedLabel)),S.xp6(3),S.Q6J("ngClass",S.VKq(8,_e,!i.guidedLabel)),S.xp6(3),S.Q6J("ngIf",i.controls.label.touched&&(null==i.controls.label.errors?null:i.controls.label.errors.required))}}function Ae(e,t){if(1&e){var n=S.EpF();S.ynx(0),S.TgZ(1,"mat-slide-toggle",23),S.NdJ("change",function(e){return S.CHM(n),S.oxw().toggleAdvancedMode(e)}),S._uU(2),S.qZA(),S._UZ(3,"div",24),S.BQk()}if(2&e){var i=S.oxw();S.xp6(1),S.Q6J("checked",i.advancedMode),S.xp6(1),S.hij(" ",i.advancedMode?"Advanced":"Simple"," ")}}var De=function(){function e(e,t,n,i,o){this.dialogData=e,this.dialogRef=t,this.visualQueryService=n,this.contentTypesService=i,this.changeDetectorRef=o,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.pipelineResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1,this.subscription=new q.w}return e.prototype.ngOnInit=function(){this.buildForm()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.closeDialog=function(e){this.dialogRef.close(e)},e.prototype.toggleGuidedLabel=function(e){this.guidedLabel=e},e.prototype.toggleAdvancedMode=function(e){this.advancedMode=e.checked},e.prototype.rename=function(){var e=this.form.getRawValue();this.closeDialog(e.label)},e.prototype.buildForm=function(){var e=this;this.form=new o.cw({label:new o.NI(this.dialogData.label,o.kI.required),scope:new o.NI(x.Z.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscription.add(this.controls.scope.valueChanges.pipe((0,Q.O)(this.controls.scope.value),(0,I.x)()).subscribe(function(t){e.labelOptions=Object.values(e.visualQueryService.pipelineResult.Sources).find(function(t){return t.Guid===e.dialogData.pipelineDataSourceGuid}).Out.filter(function(e){return e.Scope===t}).map(function(e){return e.Name}),e.labelOptions.includes(e.controls.label.value)||null==e.controls.label.value||e.controls.label.patchValue(null)})),this.contentTypesService.getScopes().subscribe(function(t){var n=Object.values(e.visualQueryService.pipelineResult.Sources).find(function(t){return t.Guid===e.dialogData.pipelineDataSourceGuid}).Out,i=t.filter(function(e){return n.some(function(t){return t.Scope===e.value})});e.scopeOptions=i,e.changeDetectorRef.markForCheck()}))},e.\u0275fac=function(t){return new(t||e)(S.Y36(a.WI),S.Y36(a.so),S.Y36(ce),S.Y36(Z.sF),S.Y36(S.sBO))},e.\u0275cmp=S.Xpm({type:e,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(e,t){2&e&&S.Ikx("className",t.hostClass)},decls:17,vars:5,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],[4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["appearance","standard","color","accent"],["matInput","","type","text","formControlName","label","required",""],[3,"isError",4,"ngIf"],[3,"isError"],["formControlName","label","required","",3,"placeholder",4,"ngIf"],["matInput","","type","text","formControlName","label","required","",4,"ngIf"],["matSuffix","",1,"selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",3,"ngClass","click"],["mat-icon-button","","type","button","tippy","Manual entry",3,"ngClass","click"],["formControlName","scope",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],[3,"value"],["formControlName","label","required","",3,"placeholder"],["color","accent",3,"checked","change"],[1,"spacer"]],template:function(e,t){1&e&&(S.TgZ(0,"div",0),S.TgZ(1,"div",1),S.TgZ(2,"div"),S._uU(3,"Rename stream"),S.qZA(),S.TgZ(4,"button",2),S.NdJ("click",function(){return t.closeDialog()}),S.TgZ(5,"mat-icon"),S._uU(6,"close"),S.qZA(),S.qZA(),S.qZA(),S.qZA(),S.TgZ(7,"form",3),S.TgZ(8,"div",4),S.YNc(9,ve,7,2,"ng-container",5),S.YNc(10,Te,15,10,"ng-container",5),S.qZA(),S.TgZ(11,"div",6),S.YNc(12,Ae,4,2,"ng-container",5),S.TgZ(13,"button",7),S.NdJ("click",function(){return t.closeDialog()}),S._uU(14,"Cancel"),S.qZA(),S.TgZ(15,"button",8),S.NdJ("click",function(){return t.rename()}),S._uU(16," Rename "),S.qZA(),S.qZA(),S.qZA()),2&e&&(S.xp6(7),S.Q6J("formGroup",t.form),S.xp6(2),S.Q6J("ngIf",!t.isSource||!t.pipelineResultExists),S.xp6(1),S.Q6J("ngIf",t.isSource&&t.pipelineResultExists),S.xp6(2),S.Q6J("ngIf",t.isSource&&t.pipelineResultExists),S.xp6(3),S.Q6J("disabled",!t.form.valid))},directives:[a.uh,r.lW,Y.$,l.Hw,o._Y,o.JL,o.sg,i.O5,s.KE,s.hX,u.Nt,o.Fj,o.JJ,o.u,o.Q7,pe.Y,s.R9,i.mk,c.gD,i.sg,de.E,fe.ey,p.Rr],styles:[""]}),e}(),Ce="dataSource_",we=function(){function e(e,t,n,i,o,r,a,s,l){var u=this;this.jsPlumbRoot=e,this.pipelineModel=t,this.dataSources=n,this.onConnectionsChanged=i,this.onDragend=o,this.onDebugStream=r,this.dialog=a,this.viewContainerRef=s,this.changeDetectorRef=l,this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(function(){u.initDomDataSources(),u.initWirings(),u.bindEvents()}),this.instance.repaintEverything()}return e.prototype.destroy=function(){var e;null===(e=this.dialogRef)||void 0===e||e.close(),this.instance.reset(),this.instance.unbindContainer()},e.prototype.removeEndpointsOnDataSource=function(e){var t=this,n=Ce+e;this.bulkDelete=!0,this.instance.batch(function(){t.instance.selectEndpoints({element:n}).delete()}),this.bulkDelete=!1},e.prototype.getAllConnections=function(){return this.instance.getAllConnections().map(function(e){return{From:e.sourceId.replace(Ce,""),Out:e.endpoints[0].getOverlay("endpointLabel").label,To:e.targetId.replace(Ce,""),In:e.endpoints[1].getOverlay("endpointLabel").label}})},e.prototype.getStreamsOut=function(){var e=[];return this.instance.selectEndpoints({target:"dataSource_Out"}).each(function(t){e.push(t.getOverlay("endpointLabel").label)}),e.join(",")},e.prototype.putEntityCountOnConnections=function(e){var t,n=this;null===(t=e.Streams)||void 0===t||t.forEach(function(e){var t,i,o=Ce+e.Source,r=(["00000000-0000-0000-0000-000000000000",n.pipelineModel.Pipeline.EntityGuid].includes(e.Target)?"dataSource_Out":Ce+e.Target)+"_in_"+e.TargetIn,a=n.instance.getEndpoint(o+"_out_"+e.SourceOut);null===(i=null===(t=null==a?void 0:a.connections)||void 0===t?void 0:t.filter(function(e){return e.endpoints[1].getUuid()===r}))||void 0===i||i.forEach(function(t){var i=e.Error?"":e.Count.toString();t.setLabel({label:i,cssClass:"streamEntitiesCount "+(e.Error?"streamEntitiesError":""),events:{click:function(t){n.pipelineModel.Pipeline.AllowEdit&&n.onDebugStream(e)}}})})})},e.prototype.nextLinePaintStyle=function(e){return this.uuidColorMap[e]||(this.uuidColorMap[e]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))},e.prototype.getInstanceDefaults=function(e){return{Container:e,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}},e.prototype.initDomDataSources=function(){var e,t,n,i,o=this,r=function(e){var t=a.jsPlumbRoot.querySelector("#dataSource_"+e.EntityGuid);if(!t)return"continue";var r=a.dataSources.find(function(t){return t.PartAssemblyAndType===e.PartAssemblyAndType});if(!r)return"continue";if(a.pipelineModel.Pipeline.AllowEdit&&a.instance.draggable(t,{grid:[20,20],stop:function(e){var t=e.el.id.replace(Ce,""),n={Top:e.finalPos[1],Left:e.finalPos[0]};setTimeout(function(){o.onDragend(t,n)})}}),null===(n=r.Out)||void 0===n||n.forEach(function(n){o.addEndpoint(t,n,!1,e)}),null===(i=r.In)||void 0===i||i.forEach(function(n){o.addEndpoint(t,n,!0,e)}),r.In){var s=a.buildTargetEndpoint(e.EntityGuid);s.maxConnections=-1,a.instance.makeTarget(t,s)}r.DynamicOut&&a.instance.makeSource(t,a.buildSourceEndpoint(e.EntityGuid),{filter:".add-endpoint"})},a=this;try{for(var s=(0,y.XA)(this.pipelineModel.DataSources),l=s.next();!l.done;l=s.next())r(l.value)}catch(u){e={error:u}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},e.prototype.initWirings=function(){var e,t=this;null===(e=this.pipelineModel.Pipeline.StreamWiring)||void 0===e||e.forEach(function(e){var n=Ce+e.From,i=n+"_out_"+e.Out,o=Ce+e.To,r=o+"_in_"+e.In;if(!t.instance.getEndpoint(i)){if(!(l=t.jsPlumbRoot.querySelector("#"+n)))return;var a=l.id.replace(Ce,""),s=t.pipelineModel.DataSources.find(function(e){return e.EntityGuid===a});t.addEndpoint(l,e.Out,!1,s)}if(!t.instance.getEndpoint(r)){var l;if(!(l=t.jsPlumbRoot.querySelector("#"+o)))return;var u=l.id.replace(Ce,"");s=t.pipelineModel.DataSources.find(function(e){return e.EntityGuid===u}),t.addEndpoint(l,e.In,!0,s)}try{t.instance.connect({uuids:[i,r],paintStyle:t.nextLinePaintStyle(i)})}catch(c){console.error({message:"Connection failed",from:i,to:r})}})},e.prototype.addEndpoint=function(e,t,n,i){var o,r,a,s,l=this,u=this.dataSources.find(function(e){return e.PartAssemblyAndType===i.PartAssemblyAndType}),c=n?!(null===(o=u.In)||void 0===o?void 0:o.some(function(e){return l.getEndpointInfo(e,!1)})):!(null===(r=u.Out)||void 0===r?void 0:r.some(function(e){return l.getEndpointInfo(e,!1)})),p=this.getEndpointInfo(t,c);s=c?"dynamic":p.required?(null===(a=this.pipelineModel.Pipeline.StreamWiring)||void 0===a?void 0:a.some(function(t){return Ce+t.To===e.id&&t.In===p.name}))?"":"required":"";var d=e.id+(n?"_in_":"_out_")+p.name,f=n?this.buildTargetEndpoint(i.EntityGuid,s):this.buildSourceEndpoint(i.EntityGuid,s);this.instance.addEndpoint(e,f,{uuid:d,enabled:this.pipelineModel.Pipeline.AllowEdit||i.EntityGuid===x.Z.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel").setLabel(p.name)},e.prototype.buildSourceEndpoint=function(e,t){var n,i=this,o=!0;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(n="sourceEndpoint "+t)&&void 0!==n?n:"",maxConnections:-1,isSource:o,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(o),events:{click:function(t){i.onChangeLabel(t,o,e)}}}},e.prototype.buildTargetEndpoint=function(e,t){var n,i=this;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(n="targetEndpoint "+t)&&void 0!==n?n:"",maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:function(t){i.onChangeLabel(t,!1,e)}}}},e.prototype.getEndpointOverlays=function(e){return[["Label",{id:"endpointLabel",location:[.5,e?0:1],label:"Default",cssClass:e?"endpointSourceLabel":"endpointTargetLabel"}]]},e.prototype.onChangeLabel=function(e,t,n){var i=this;if(this.pipelineModel.Pipeline.AllowEdit){var o=e.getOverlay?e.getOverlay("endpointLabel"):e;this.dialogRef=this.dialog.open(De,{autoFocus:!1,data:{pipelineDataSourceGuid:n,isSource:t,label:o.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.dialogRef.afterClosed().subscribe(function(e){e&&(o.setLabel(e),setTimeout(function(){i.onConnectionsChanged()}))}),this.changeDetectorRef.markForCheck()}},e.prototype.bindEvents=function(){var e=this;this.instance.bind("connectionDetached",function(t){if(!e.bulkDelete){var n=t.target,i=e.pipelineModel.DataSources.find(function(e){return e.EntityGuid===n.id.replace(Ce,"")}),o=e.dataSources.find(function(e){return e.PartAssemblyAndType===i.PartAssemblyAndType}),r=t.targetEndpoint.getOverlay("endpointLabel").label;o.In.some(function(t){return e.getEndpointInfo(t,!1).name===r})||e.instance.deleteEndpoint(t.targetEndpoint),setTimeout(function(){e.onConnectionsChanged()})}}),this.instance.bind("connection",function(t){if(t.sourceId!==t.targetId){var n=t.targetEndpoint.getOverlay("endpointLabel"),i=n.getLabel();e.instance.getEndpoints(t.target.id).some(function(e){return e.getOverlay("endpointLabel").getLabel()===i&&t.targetEndpoint.id!==e.id&&e.canvas.classList.contains("targetEndpoint")})&&n.setLabel("PleaseRename"+Math.floor(99999*Math.random())),setTimeout(function(){e.onConnectionsChanged()})}else setTimeout(function(){e.instance.deleteConnection(t.connection,{fireEvent:!1}),setTimeout(function(){e.onConnectionsChanged()})})})},e.prototype.getEndpointInfo=function(e,t){var n,i;if(t)n=e,i=!1;else{var o=e.trim();n=(i=o.endsWith("*"))?o.substring(0,o.length-1):o}return{name:n,required:i}},e}(),Pe=n(2636),qe=["domRoot"],ke=["domDataSource"];function Ie(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"mat-icon",19),S.NdJ("click",function(){S.CHM(n);var e=S.oxw().$implicit;return S.oxw(3).configureDataSource(e)}),S._uU(1," settings "),S.qZA()}}function Oe(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"mat-icon",20),S.NdJ("click",function(){S.CHM(n);var e=S.oxw().$implicit,t=S.oxw(2).ngIf;return S.oxw().openHelp(t.typeInfos[e.EntityGuid].HelpLink)}),S._uU(1," help_outline "),S.qZA()}}function Ee(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"mat-icon",21),S.NdJ("click",function(){S.CHM(n);var e=S.oxw().$implicit;return S.oxw(3).remove(e)}),S._uU(1," delete "),S.qZA()}}function Me(e,t){if(1&e&&(S.TgZ(0,"tr",25),S.TgZ(1,"td",26),S._uU(2),S.qZA(),S.TgZ(3,"td",27),S._uU(4),S.qZA(),S.qZA()),2&e){var n=t.$implicit;S.xp6(1),S.Q6J("title",n.name),S.xp6(1),S.Oqu(n.name),S.xp6(1),S.Q6J("title",n.value),S.xp6(1),S.Oqu(n.value)}}function Ue(e,t){if(1&e&&(S.ynx(0),S._UZ(1,"hr",22),S.TgZ(2,"table",23),S.YNc(3,Me,5,4,"tr",24),S.qZA(),S.BQk()),2&e){var n=S.oxw().$implicit,i=S.oxw(2).ngIf;S.xp6(3),S.Q6J("ngForOf",i.dataSourceConfigs[n.EntityId])}}function Qe(e,t){1&e&&(S.TgZ(0,"mat-icon",28),S._uU(1," arrow_drop_up "),S.qZA())}function Ne(e,t){1&e&&(S.TgZ(0,"mat-icon",29),S._uU(1," arrow_drop_up "),S.qZA())}var $e=function(e,t,n){return{top:e,left:t,"min-width":n}},Je=function(e){return{"show-details":e}};function Re(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"div",5,6),S.TgZ(2,"div",7),S.TgZ(3,"mat-icon",8),S._uU(4),S.qZA(),S.YNc(5,Ie,2,0,"mat-icon",9),S.YNc(6,Oe,2,0,"mat-icon",10),S.qZA(),S.TgZ(7,"div",11),S.YNc(8,Ee,2,0,"mat-icon",12),S.qZA(),S.TgZ(9,"div",13),S.NdJ("click",function(){var e=S.CHM(n).$implicit,t=S.oxw(2).ngIf,i=S.oxw();return t.allowEdit&&i.editName(e)}),S.TgZ(10,"span"),S._uU(11),S.qZA(),S.TgZ(12,"mat-icon",14),S._uU(13,"edit"),S.qZA(),S.qZA(),S._UZ(14,"br"),S.TgZ(15,"div",15),S.NdJ("click",function(){var e=S.CHM(n).$implicit,t=S.oxw(2).ngIf,i=S.oxw();return t.allowEdit&&i.editDescription(e)}),S.TgZ(16,"span"),S._uU(17),S.qZA(),S.TgZ(18,"mat-icon",14),S._uU(19,"edit"),S.qZA(),S.qZA(),S._UZ(20,"br"),S.YNc(21,Ue,4,1,"ng-container",3),S.TgZ(22,"div",16),S._uU(23),S.qZA(),S.YNc(24,Qe,2,0,"mat-icon",17),S.YNc(25,Ne,2,0,"mat-icon",18),S.qZA()}if(2&e){var i=t.$implicit,o=S.oxw(2).ngIf,r=S.oxw();S.Q6J("id",r.dataSrcIdPrefix+i.EntityGuid)("ngStyle",S.kEZ(15,$e,i.VisualDesignerData.Top+"px",i.VisualDesignerData.Left+"px",i.VisualDesignerData.Width?i.VisualDesignerData.Width+"px":null))("ngClass",S.VKq(19,Je,o.showDataSourceDetails&&(null==o.dataSourceConfigs[i.EntityId]?null:o.dataSourceConfigs[i.EntityId].length))),S.xp6(3),S.Q6J("title",o.typeInfos[i.EntityGuid].UiHint),S.xp6(1),S.hij(" ",o.typeInfos[i.EntityGuid].Icon," "),S.xp6(1),S.Q6J("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].EnableConfig),S.xp6(1),S.Q6J("ngIf",o.typeInfos[i.EntityGuid].HelpLink),S.xp6(2),S.Q6J("ngIf",o.allowEdit&&!r.isOutDataSource(i)),S.xp6(3),S.Oqu(i.Name||"(no name)"),S.xp6(6),S.Oqu(i.Description),S.xp6(4),S.Q6J("ngIf",o.showDataSourceDetails&&(null==o.dataSourceConfigs[i.EntityId]?null:o.dataSourceConfigs[i.EntityId].length)),S.xp6(1),S.Q6J("title",i.PartAssemblyAndType),S.xp6(1),S.hij(" Type: ",r.getTypeName(i.PartAssemblyAndType)," "),S.xp6(1),S.Q6J("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].DynamicOut),S.xp6(1),S.Q6J("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].DynamicIn)}}function Le(e,t){if(1&e&&(S.ynx(0),S.YNc(1,Re,26,21,"div",4),S.BQk()),2&e){var n=S.oxw().ngIf;S.xp6(1),S.Q6J("ngForOf",n.pipelineDataSources)}}function Fe(e,t){if(1&e&&(S.TgZ(0,"div",1,2),S.YNc(2,Le,2,1,"ng-container",3),S.qZA()),2&e){var n=S.oxw();S.xp6(2),S.Q6J("ngIf",!n.hardReset)}}var Ye=function(){function e(e,t,n,i,o){this.visualQueryService=e,this.queryDefinitionService=t,this.changeDetectorRef=n,this.dialog=i,this.viewContainerRef=o,this.dataSrcIdPrefix=Ce,this.hardReset=!1,this.scriptLoaded$=new P.X(!1),this.subscription=new q.w}return e.prototype.ngOnInit=function(){var e=this;(0,E.y)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],function(){e.scriptLoaded$.next(!0)}),this.subscription.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(function(t){e.plumber.putEntityCountOnConnections(t)}));var t=this.visualQueryService.pipelineModel$.pipe((0,b.U)(function(e){var t;return null!==(t=O.iX.tryParse(null==e?void 0:e.Pipeline.VisualDesignerData))&&void 0!==t?t:{}}),(0,I.x)(O.iX.objectsEqual));this.templateModel$=(0,k.aj)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$,t,this.visualQueryService.dataSourceConfigs$]).pipe((0,b.U)(function(t){var n,i=(0,y.CR)(t,4),o=i[0],r=i[1],a=i[2],s=i[3];if(null!=o&&null!=r)return e.hardReset=!0,e.changeDetectorRef.detectChanges(),e.hardReset=!1,{pipelineDataSources:o.DataSources,typeInfos:U(o.DataSources,r),allowEdit:o.Pipeline.AllowEdit,showDataSourceDetails:null!==(n=a.ShowDataSourceDetails)&&void 0!==n&&n,dataSourceConfigs:s}}))},e.prototype.ngAfterViewInit=function(){var e=this,t=this.domDataSourcesRef.changes.pipe((0,b.U)(function(){return!0}));this.subscription.add((0,k.aj)([this.scriptLoaded$,t]).subscribe(function(t){var n,i=(0,y.CR)(t,2);i[0]&&i[1]&&(null===(n=e.plumber)||void 0===n||n.destroy(),e.plumber=new we(e.domRootRef.nativeElement,e.visualQueryService.pipelineModel$.value,e.visualQueryService.dataSources$.value,e.onConnectionsChanged.bind(e),e.onDragend.bind(e),e.onDebugStream.bind(e),e.dialog,e.viewContainerRef,e.changeDetectorRef))}))},e.prototype.ngOnDestroy=function(){var e;null===(e=this.plumber)||void 0===e||e.destroy(),this.scriptLoaded$.complete(),this.subscription.unsubscribe()},e.prototype.onConnectionsChanged=function(){var e=this.plumber.getAllConnections(),t=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(e,t)},e.prototype.onDragend=function(e,t){this.visualQueryService.changeDataSourcePosition(e,t)},e.prototype.onDebugStream=function(e){this.visualQueryService.debugStream(e)},e.prototype.configureDataSource=function(e){e.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(e)},e.prototype.getTypeName=function(e){var t=this.visualQueryService.dataSources$.value.find(function(t){return t.PartAssemblyAndType===e});return this.queryDefinitionService.typeNameFilter((null==t?void 0:t.TypeNameForUi)||e,"className")},e.prototype.isOutDataSource=function(e){return e.PartAssemblyAndType===x.Z.pipelineDesigner.outDataSource.PartAssemblyAndType},e.prototype.remove=function(e){if(confirm("Delete "+e.Name+" data source?")){this.plumber.removeEndpointsOnDataSource(e.EntityGuid);var t=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(e.EntityGuid,t,n)}},e.prototype.openHelp=function(e){window.open(e,"_blank")},e.prototype.editName=function(e){var t,n=null===(t=prompt("Rename data source",e.Name))||void 0===t?void 0:t.trim();null!=n&&""!==n&&this.visualQueryService.renameDataSource(e.EntityGuid,n)},e.prototype.editDescription=function(e){var t,n=null===(t=prompt("Edit description",e.Description))||void 0===t?void 0:t.trim();null!=n&&this.visualQueryService.changeDataSourceDescription(e.EntityGuid,n)},e.\u0275fac=function(t){return new(t||e)(S.Y36(ce),S.Y36(A),S.Y36(S.sBO),S.Y36(a.uw),S.Y36(S.s_b))},e.\u0275cmp=S.Xpm({type:e,selectors:[["app-plumb-editor"]],viewQuery:function(e,t){if(1&e&&(S.Gf(qe,5),S.Gf(ke,5)),2&e){var n=void 0;S.iGM(n=S.CRH())&&(t.domRootRef=n.first),S.iGM(n=S.CRH())&&(t.domDataSourcesRef=n)}},decls:2,vars:3,consts:[["id","pipeline-root",4,"ngIf"],["id","pipeline-root"],["domRoot",""],[4,"ngIf"],["class","dataSource",3,"id","ngStyle","ngClass",4,"ngFor","ngForOf"],[1,"dataSource",3,"id","ngStyle","ngClass"],["domDataSource",""],[1,"actions","left"],[1,"type-info",3,"title"],["class","configure","title","Configure data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],["class","help","title","Help for this data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],[1,"actions","right"],["class","delete","title","Delete","appMousedownStopPropagation","",3,"click",4,"ngIf"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["class","add-endpoint","title","Drag a new Out-Connection",4,"ngIf"],["class","many-in","title","This data source supports multiple In-Connections",4,"ngIf"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],["class","config",4,"ngFor","ngForOf"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint"],["title","This data source supports multiple In-Connections",1,"many-in"]],template:function(e,t){1&e&&(S.YNc(0,Fe,3,1,"div",0),S.ALo(1,"async")),2&e&&S.Q6J("ngIf",S.lcZ(1,1,t.templateModel$))},directives:[i.O5,i.sg,i.PC,i.mk,l.Hw,Pe.d],pipes:[i.Ov],styles:["","[_nghost-%COMP%]{display:block;width:100%;height:100%}"]}),e}();function Ge(e,t){if(1&e&&(S.TgZ(0,"li"),S._uU(1),S.qZA()),2&e){var n=t.$implicit;S.xp6(1),S.hij(" ",n," ")}}function He(e,t){if(1&e&&(S.TgZ(0,"ul",16),S.YNc(1,Ge,2,1,"li",17),S.qZA()),2&e){var n=S.oxw().ngIf;S.xp6(1),S.Q6J("ngForOf",null==n.Pipeline.Params?null:n.Pipeline.Params.split("\n"))}}function je(e,t){if(1&e&&(S.TgZ(0,"li"),S._uU(1),S.qZA()),2&e){var n=t.$implicit;S.xp6(1),S.hij(" ",n," ")}}function Be(e,t){if(1&e&&(S.TgZ(0,"ul",16),S.YNc(1,je,2,1,"li",17),S.qZA()),2&e){var n=S.oxw().ngIf;S.xp6(1),S.Q6J("ngForOf",null==n.Pipeline.TestParameters?null:n.Pipeline.TestParameters.split("\n"))}}function Ve(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"div",6),S.TgZ(1,"mat-slide-toggle",18),S.NdJ("change",function(e){return S.CHM(n),S.oxw(2).showDataSourceDetails(e)}),S._uU(2," Show DataSource Params "),S.qZA(),S.qZA()}if(2&e){var i=t.ngIf;S.xp6(1),S.Q6J("checked",i.ShowDataSourceDetails)}}function Xe(e,t){1&e&&S._UZ(0,"li",23),2&e&&S.Q6J("innerHTML",t.$implicit,S.oJD)}function We(e,t){if(1&e&&(S.TgZ(0,"div",20),S.TgZ(1,"div",7),S.TgZ(2,"span"),S._uU(3,"Warnings"),S.qZA(),S.TgZ(4,"mat-icon",21),S._uU(5,"warning"),S.qZA(),S.qZA(),S.TgZ(6,"ol",16),S.YNc(7,Xe,1,1,"li",22),S.qZA(),S.qZA()),2&e){var n=S.oxw().ngIf;S.xp6(7),S.Q6J("ngForOf",n)}}function ze(e,t){if(1&e&&(S.ynx(0),S.YNc(1,We,8,1,"div",19),S.BQk()),2&e){var n=t.ngIf;S.xp6(1),S.Q6J("ngIf",n.length)}}function Ke(e,t){if(1&e&&(S.TgZ(0,"div",24),S.TgZ(1,"div",7),S._uU(2,"Query Description"),S.qZA(),S.TgZ(3,"div"),S._uU(4),S.qZA(),S.qZA()),2&e){var n=S.oxw().ngIf;S.xp6(4),S.Oqu(n.Pipeline.Description)}}function et(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"div",1),S.TgZ(1,"div",2),S.TgZ(2,"div",3),S.TgZ(3,"button",4),S.NdJ("click",function(){return S.CHM(n),S.oxw().saveAndRunQuery(!0,!0)}),S._uU(4," Save and run "),S.qZA(),S.TgZ(5,"button",5),S.NdJ("click",function(){return S.CHM(n),S.oxw().saveAndRunQuery(!1,!0)}),S._uU(6," Run "),S.qZA(),S.TgZ(7,"button",5),S.NdJ("click",function(){return S.CHM(n),S.oxw().saveAndRunQuery(!0,!1)}),S._uU(8," Save "),S.qZA(),S.qZA(),S.TgZ(9,"div",6),S.TgZ(10,"div",7),S.TgZ(11,"div"),S._uU(12,"Query Parameters"),S.qZA(),S.TgZ(13,"div"),S.TgZ(14,"button",8),S.NdJ("click",function(){return S.CHM(n),S.oxw().editPipeline()}),S.TgZ(15,"mat-icon"),S._uU(16,"edit"),S.qZA(),S.qZA(),S.TgZ(17,"button",9),S.NdJ("click",function(){return S.CHM(n),S.oxw().openParamsHelp()}),S.TgZ(18,"mat-icon"),S._uU(19,"info"),S.qZA(),S.qZA(),S.qZA(),S.qZA(),S.YNc(20,He,2,1,"ul",10),S.qZA(),S.TgZ(21,"div",6),S.TgZ(22,"div",7),S._uU(23,"Test Parameters"),S.qZA(),S.YNc(24,Be,2,1,"ul",10),S.qZA(),S.YNc(25,Ve,3,1,"div",11),S.ALo(26,"async"),S.YNc(27,ze,2,1,"ng-container",12),S.ALo(28,"async"),S.YNc(29,Ke,5,1,"div",13),S.TgZ(30,"div",14),S.TgZ(31,"button",5),S.NdJ("click",function(){return S.CHM(n),S.oxw().openRestApi()}),S.TgZ(32,"span"),S._uU(33,"Use in JSON / REST API"),S.qZA(),S._UZ(34,"mat-icon",15),S.qZA(),S.qZA(),S.qZA(),S.qZA()}if(2&e){var i=t.ngIf,o=S.oxw();S.xp6(20),S.Q6J("ngIf",null==i.Pipeline.Params?null:i.Pipeline.Params.length),S.xp6(4),S.Q6J("ngIf",null==i.Pipeline.TestParameters?null:i.Pipeline.TestParameters.length),S.xp6(1),S.Q6J("ngIf",S.lcZ(26,5,o.visualDesignerData$)),S.xp6(2),S.Q6J("ngIf",S.lcZ(28,7,o.warnings$)),S.xp6(2),S.Q6J("ngIf",i.Pipeline.Description)}}var tt=function(){function e(e,t,n,i){this.router=e,this.route=t,this.context=n,this.visualQueryService=i}return e.prototype.ngOnInit=function(){var e=this;this.pipelineModel$=this.visualQueryService.pipelineModel$.asObservable(),this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,b.U)(function(t){return function(e,t){var n,i,o=[];try{var r=(null===(n=e.Pipeline.Params)||void 0===n?void 0:n.split(/\r?\n/))||[],a=(null===(i=e.Pipeline.TestParameters)||void 0===i?void 0:i.split(/\r?\n/))||[];r.forEach(function(e){(e=null==e?void 0:e.trim())&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(e)||o.push("\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>"+e+"</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        "))}),a.forEach(function(e){if(e=null==e?void 0:e.trim()){/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(e)||o.push("\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>"+e+"</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        ");var n=/^\[module:id\]=([0-9]*)$/gim.exec(e);if(n){var i=n[1],r=t.moduleId.toString();i!==r&&o.push("\n            Your test ModuleId ("+i+") is different from the current ModuleId ("+r+").<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          ")}/^\[module:moduleid\]=([0-9]*)$/gim.exec(e)&&o.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")}})}catch(s){console.error("Something went wrong in calculateWarnings for params",s)}return o}(t,e.context)})),this.visualDesignerData$=this.visualQueryService.pipelineModel$.pipe((0,b.U)(function(e){var t;return null!==(t=O.iX.tryParse(e.Pipeline.VisualDesignerData))&&void 0!==t?t:{}}))},e.prototype.editPipeline=function(){this.visualQueryService.editPipelineEntity()},e.prototype.openParamsHelp=function(){window.open("http://r.2sxc.org/QueryParams","_blank")},e.prototype.saveAndRunQuery=function(e,t){this.visualQueryService.saveAndRun(e,t)},e.prototype.showDataSourceDetails=function(e){this.visualQueryService.showDataSourceDetails(e.checked)},e.prototype.openRestApi=function(){this.router.navigate([w.ii.getUrlQuery(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)],{relativeTo:this.route})},e.\u0275fac=function(t){return new(t||e)(S.Y36(D.F0),S.Y36(D.gz),S.Y36(v._),S.Y36(ce))},e.\u0275cmp=S.Xpm({type:e,selectors:[["app-run-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],["class","values",4,"ngIf"],["class","parameters",4,"ngIf"],[4,"ngIf"],["class","description",4,"ngIf"],[1,"footer-actions"],["svgIcon","code-curly"],[1,"values"],[4,"ngFor","ngForOf"],["color","primary","labelPosition","before",3,"checked","change"],["class","warnings",4,"ngIf"],[1,"warnings"],[2,"color","red"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"description"]],template:function(e,t){1&e&&(S.YNc(0,et,35,9,"div",0),S.ALo(1,"async")),2&e&&S.Q6J("ngIf",S.lcZ(1,1,t.pipelineModel$))},directives:[i.O5,r.lW,Y.$,l.Hw,i.sg,p.Rr],pipes:[i.Ov],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.description[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]{margin:16px 0}.description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}"]}),e}();function nt(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"div",8),S.NdJ("click",function(){var e=S.CHM(n).$implicit;return S.oxw(4).addDataSource(e)}),S.TgZ(1,"mat-icon"),S._uU(2),S.qZA(),S.TgZ(3,"span"),S._uU(4),S.qZA(),S.qZA()}if(2&e){var i=t.$implicit,o=S.oxw(4);S.Q6J("tippy",i.UiHint||i.Name),S.xp6(2),S.Oqu(i.Icon||o.guiTypes.Unknown.Icon),S.xp6(2),S.Oqu(i.Name)}}function it(e,t){if(1&e&&(S.TgZ(0,"div",6),S.YNc(1,nt,5,3,"div",7),S.qZA()),2&e){var n=S.oxw().$implicit,i=S.oxw(2);S.xp6(1),S.Q6J("ngForOf",n.value)("ngForTrackBy",i.trackDataSources)}}function ot(e,t){if(1&e){var n=S.EpF();S.ynx(0),S.TgZ(1,"div",4),S.NdJ("click",function(){var e=S.CHM(n).$implicit;return S.oxw(2).toggleItem(e.key)}),S.TgZ(2,"mat-icon"),S._uU(3),S.qZA(),S.TgZ(4,"span"),S._uU(5),S.qZA(),S.qZA(),S.YNc(6,it,2,2,"div",5),S.BQk()}if(2&e){var i=t.$implicit,o=S.oxw(2);S.xp6(1),S.Q6J("tippy",o.guiTypes[i.key].UiHint||i.key),S.xp6(2),S.Oqu(o.guiTypes[i.key].Icon||o.guiTypes.Unknown.Icon),S.xp6(2),S.Oqu(i.key),S.xp6(1),S.Q6J("ngIf",o.toggledItems.includes(i.key))}}function rt(e,t){if(1&e){var n=S.EpF();S.TgZ(0,"div",1),S.TgZ(1,"mat-slide-toggle",2),S.NdJ("change",function(e){return S.CHM(n),S.oxw().toggleDifficulty(e)}),S._uU(2," Show Advanced "),S.qZA(),S.YNc(3,ot,7,4,"ng-container",3),S.ALo(4,"keyvalue"),S.qZA()}if(2&e){var i=t.ngIf,o=S.oxw();S.xp6(3),S.Q6J("ngForOf",S.lcZ(4,2,i))("ngForTrackBy",o.trackGroups)}}var at=function(){function e(e){this.visualQueryService=e,this.toggledItems=[],this.guiTypes=M,this.difficulties=x.Z.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new P.X(this.difficulties.default)}return e.prototype.ngOnInit=function(){this.sorted$=(0,k.aj)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,b.U)(function(e){var t=(0,y.CR)(e,2);return function(e,t){var n,i;if(e){var o=(0,N.Z)(e).filter(function(e){return e.Difficulty<=t&&e.PartAssemblyAndType!==x.Z.pipelineDesigner.outDataSource.PartAssemblyAndType});o.sort(function(e,t){return e.Name.toLocaleLowerCase().localeCompare(t.Name.toLocaleLowerCase())});var r={};try{for(var a=(0,y.XA)(o),s=a.next();!s.done;s=a.next()){var l=s.value,u=l.PrimaryType;r[u]?r[u].push(l):r[u]=[l]}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return r}}(t[0],t[1])}))},e.prototype.ngOnDestroy=function(){this.difficulty$.complete()},e.prototype.toggleDifficulty=function(e){this.difficulty$.next(e.checked?this.difficulties.advanced:this.difficulties.default)},e.prototype.addDataSource=function(e){this.visualQueryService.addDataSource(e)},e.prototype.toggleItem=function(e){O.iX.toggleInArray(e,this.toggledItems)},e.prototype.trackGroups=function(e,t){return t.key},e.prototype.trackDataSources=function(e,t){return t.PartAssemblyAndType},e.\u0275fac=function(t){return new(t||e)(S.Y36(ce))},e.\u0275cmp=S.Xpm({type:e,selectors:[["app-add-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],["labelPosition","before","color","primary",3,"change"],[4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"collapsible",3,"tippy","click"],["class","list",4,"ngIf"],[1,"list"],["class","list-item","tippyShowDelay","750",3,"tippy","click",4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"list-item",3,"tippy","click"]],template:function(e,t){1&e&&(S.YNc(0,rt,5,4,"div",0),S.ALo(1,"async")),2&e&&S.Q6J("ngIf",S.lcZ(1,1,t.sorted$))},directives:[i.O5,p.Rr,i.sg,Y.$,l.Hw],pipes:[i.Ov,i.Nd],styles:[".mat-slide-toggle[_ngcontent-%COMP%]{margin:6px}.collapsible[_ngcontent-%COMP%], .mat-slide-toggle[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}"]}),e}(),st=function(e){return{active:e}},lt=[{path:"",component:function(){function e(e,t,n){this.context=e,this.route=t,this.visualQueryService=n,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}return e.prototype.ngOnInit=function(){this.visualQueryService.init()},e.prototype.toggleExplorer=function(e){this.activeExplorer=this.activeExplorer===e?null:e},e.prototype.openHelp=function(){window.open("http://r.2sxc.org/visual-query","_blank")},e.\u0275fac=function(t){return new(t||e)(S.Y36(v._),S.Y36(D.gz),S.Y36(ce))},e.\u0275cmp=S.Xpm({type:e,selectors:[["app-visual-query"]],viewQuery:function(e,t){var n;1&e&&S.Gf(Ye,5),2&e&&S.iGM(n=S.CRH())&&(t.plumbEditor=n.first)},features:[S._Bn([ce])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"ngClass","click"],["tippy","Add",1,"button",3,"ngClass","click"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(e,t){1&e&&(S._UZ(0,"router-outlet"),S.TgZ(1,"div",0),S.TgZ(2,"div",1),S.TgZ(3,"div",2),S.NdJ("click",function(){return t.toggleExplorer(t.explorer.run)}),S.TgZ(4,"mat-icon"),S._uU(5,"play_arrow"),S.qZA(),S.qZA(),S.TgZ(6,"div",3),S.NdJ("click",function(){return t.toggleExplorer(t.explorer.add)}),S.TgZ(7,"mat-icon"),S._uU(8,"add"),S.qZA(),S.qZA(),S._UZ(9,"div",4),S.TgZ(10,"div",5),S.NdJ("click",function(){return t.openHelp()}),S.TgZ(11,"mat-icon"),S._uU(12,"help_outline"),S.qZA(),S.qZA(),S.qZA(),S._UZ(13,"app-run-explorer",6),S._UZ(14,"app-add-explorer",6),S._UZ(15,"app-plumb-editor"),S.qZA()),2&e&&(S.xp6(3),S.Q6J("ngClass",S.VKq(4,st,t.activeExplorer===t.explorer.run)),S.xp6(3),S.Q6J("ngClass",S.VKq(6,st,t.activeExplorer===t.explorer.add)),S.xp6(7),S.Q6J("hidden",t.activeExplorer!==t.explorer.run),S.xp6(1),S.Q6J("hidden",t.activeExplorer!==t.explorer.add))},directives:[D.lC,Y.$,i.mk,l.Hw,tt,at,Ye],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),e}(),children:[w.ii.route,{matcher:C.eP,loadChildren:function(){return Promise.all([n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_progress-spinner_js"),n.e("default-projects_ng-dialogs_src_app_create-file-dialog_index_ts"),n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_list_js"),n.e("default-projects_ng-dialogs_src_app_monaco-editor_monaco-editor_component_ts-projects_ng-dial-aa5eee"),n.e("default-projects_edit_edit_module_ts"),n.e("default-node_modules_angular_cdk___ivy_ngcc___fesm2015_drag-drop_js"),n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_menu_js"),n.e("default-node_modules_angular_material___ivy_ngcc___fesm2015_autocomplete_js"),n.e("node_modules_angular_material___ivy_ngcc___fesm2015_card_js")]).then(n.bind(n,99)).then(function(e){return e.EditModule})},data:{history:!1}}]}],ut=function(){function e(){}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=S.oAB({type:e}),e.\u0275inj=S.cJS({imports:[[D.Bz.forChild(lt)],D.Bz]}),e}(),ct=function(){function e(){}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=S.oAB({type:e}),e.\u0275inj=S.cJS({providers:[v._,A,h.D,g.s],imports:[[i.ez,m.q,ut,l.Ps,r.ot,p.rP,d.ZX,a.Is,f.Nh,s.lN,o.UX,c.LD,u.c,p.rP]]}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.01.00/ng-edit/projects_ng-dialogs_src_app_visual-query_visual-query_module_ts.ed94338d43fd454af921.js.map