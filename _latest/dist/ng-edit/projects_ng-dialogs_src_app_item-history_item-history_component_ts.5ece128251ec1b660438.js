(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_ng-dialogs_src_app_item-history_item-history_component_ts"],{6152:function(e,t,n){"use strict";n.r(t),n.d(t,{ItemHistoryComponent:function(){return U}});var i=n(4762),o=n(8512),a=n(1305),r=n(9996);function s(e,t,n){var o=JSON.parse(e.Json).Entity.Attributes,a="live"===n?function(e){var t,n,o=e[0];try{for(var a=(0,i.XA)(e),r=a.next();!r.done;r=a.next()){var s=r.value;s.VersionNumber<=o.VersionNumber||(o=s)}}catch(l){t={error:l}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o}(t):t.find(function(t){return t.VersionNumber===e.VersionNumber-1}),r=a?JSON.parse(a.Json).Entity.Attributes:null,s=[];return null!=o&&Object.entries(o).forEach(function(e){var t=(0,i.CR)(e,2),n=t[0];Object.keys(t[1]).forEach(function(e){null==s.find(function(t){return t.name===e&&t.dataType===n})&&s.push({name:e,dataType:n})})}),null!=r&&Object.entries(r).forEach(function(e){var t=(0,i.CR)(e,2),n=t[0];Object.keys(t[1]).forEach(function(e){null==s.find(function(t){return t.name===e&&t.dataType===n})&&s.push({name:e,dataType:n})})}),s.map(function(e){var t,n,i=null===(t=null==o?void 0:o[e.dataType])||void 0===t?void 0:t[e.name],a=null===(n=null==r?void 0:r[e.dataType])||void 0===n?void 0:n[e.name];return{name:e.name,dataType:e.dataType,change:c(i,a,!0),values:l(i,a)}})}function l(e,t){var n=[];return null!=e&&Object.keys(e).forEach(function(e){n.includes(e)||n.push(e)}),null!=t&&Object.keys(t).forEach(function(e){n.includes(e)||n.push(e)}),n.map(function(n){var i=null==e?void 0:e[n],o=null==t?void 0:t[n];return{langKey:n,value:i,oldValue:o,change:c(i,o)}})}function c(e,t,n){return void 0===n&&(n=!1),n&&("object"==typeof e&&(e=p(e)),"object"==typeof t&&(t=p(t))),null!=e&&null!=t?JSON.stringify(e)!==JSON.stringify(t)?"changed":"none":null!=e?"new":"deleted"}function p(e){return"object"!=typeof e?e:Object.keys(e).sort().reduce(function(t,n){var o;return(0,i.pi)((0,i.pi)({},t),((o={})[n]=e[n],o))},{})}var u=n(1785),d=n(2935),g=n(1282),h=n(4931),f=n(3589),m=n(1116),v=n(4369),x=n(7512),y=n(7307),_=n(3070),b=n(3841),Z=n(7064),w=n(6489),I=n(8150);function C(e,t){if(1&e){var n=u.EpF();u.TgZ(0,"div",9),u.TgZ(1,"mat-form-field",10),u.TgZ(2,"mat-select",11),u.NdJ("selectionChange",function(e){return u.CHM(n),u.oxw(2).compareChange(e.value)}),u.TgZ(3,"mat-option",12),u._uU(4,"Compare with: Previous"),u.qZA(),u.TgZ(5,"mat-option",13),u._uU(6,"Compare with: Live"),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&e){var i=u.oxw().ngIf;u.xp6(2),u.Q6J("value",i.compareWith)}}function O(e,t){1&e&&(u.TgZ(0,"div"),u._uU(1,"Loading..."),u.qZA())}function T(e,t){1&e&&(u.TgZ(0,"div"),u._uU(1,"No previous versions of this item found"),u.qZA())}function A(e,t){if(1&e&&(u.ynx(0),u._uU(1),u.BQk()),2&e){var n=u.oxw().$implicit;u.xp6(1),u.hij(" ",null==n.values[0]?null:n.values[0].value," ")}}function N(e,t){if(1&e&&(u.TgZ(0,"div"),u._uU(1),u.qZA()),2&e){var n=u.oxw().$implicit;u.Gre("history-",n.change,""),u.xp6(1),u.hij(" ","deleted"===n.change?n.oldValue:n.value," ")}}function $(e,t){if(1&e&&(u.ynx(0),u.TgZ(1,"div",29),u._uU(2),u.qZA(),u.TgZ(3,"div",30),u._uU(4),u.qZA(),u.BQk()),2&e){var n=u.oxw().$implicit;u.xp6(2),u.Oqu(n.value),u.xp6(2),u.Oqu(n.oldValue)}}function q(e,t){if(1&e&&(u.TgZ(0,"div",26),u.TgZ(1,"div"),u._uU(2),u.qZA(),u.TgZ(3,"div",27),u.YNc(4,N,2,4,"div",28),u.YNc(5,$,5,2,"ng-container",0),u.qZA(),u.qZA()),2&e){var n=t.$implicit;u.xp6(1),u.Gre("detail-row__label history-",n.change,""),u.xp6(1),u.hij("",n.langKey,":"),u.xp6(2),u.Q6J("ngIf","changed"!==n.change),u.xp6(1),u.Q6J("ngIf","changed"===n.change)}}function S(e,t){if(1&e&&(u.TgZ(0,"div",24),u.YNc(1,q,6,6,"div",25),u.qZA()),2&e){var n=u.oxw().$implicit;u.xp6(1),u.Q6J("ngForOf",n.values)}}function J(e,t){if(1&e){var n=u.EpF();u.TgZ(0,"div",20),u.TgZ(1,"div",21),u.NdJ("click",function(){var e=u.CHM(n).$implicit,t=u.oxw(2).$implicit;return u.oxw(3).attributeExpandedToggle(t.versionNumber,e.name)}),u.TgZ(2,"div"),u._uU(3),u.qZA(),u.TgZ(4,"div"),u.YNc(5,A,2,1,"ng-container",0),u.qZA(),u.TgZ(6,"div",22),u.TgZ(7,"i"),u._uU(8),u.qZA(),u.qZA(),u.qZA(),u.YNc(9,S,2,1,"div",23),u.qZA()}if(2&e){var i=t.$implicit,o=u.oxw(2).$implicit,a=u.oxw(3);u.xp6(2),u.Gre("row-main__label history-",i.change,""),u.xp6(1),u.hij(" ",i.name," "),u.xp6(1),u.Gre("row-main__value history-",i.change,""),u.xp6(1),u.Q6J("ngIf",!a.expandedAttributes[o.versionNumber+i.name]),u.xp6(3),u.hij("[",i.dataType,"]"),u.xp6(1),u.Q6J("ngIf",a.expandedAttributes[o.versionNumber+i.name])}}function k(e,t){if(1&e){var n=u.EpF();u.TgZ(0,"button",31),u.NdJ("click",function(){u.CHM(n);var e=u.oxw(2).$implicit;return u.oxw(3).restore(e.changeSetId)}),u._uU(1," Restore "),u.qZA()}}function M(e,t){if(1&e&&(u.ynx(0),u.YNc(1,J,10,10,"div",17),u.TgZ(2,"div",18),u.YNc(3,k,2,0,"button",19),u.qZA(),u.BQk()),2&e){var n=u.oxw().$implicit;u.xp6(1),u.Q6J("ngForOf",n.attributes),u.xp6(2),u.Q6J("ngIf",!n.isLastVersion)}}function P(e,t){if(1&e){var n=u.EpF();u.TgZ(0,"mat-expansion-panel",16),u.NdJ("expandedChange",function(e){var t=u.CHM(n).$implicit;return u.oxw(3).panelExpandedChange(e,t.versionNumber)}),u.TgZ(1,"mat-expansion-panel-header"),u.TgZ(2,"mat-panel-title"),u._uU(3),u.qZA(),u.TgZ(4,"mat-panel-description"),u._uU(5),u.ALo(6,"date"),u.qZA(),u.qZA(),u.YNc(7,M,4,2,"ng-container",0),u.qZA()}if(2&e){var i=t.$implicit,o=u.oxw(3);u.Q6J("expanded",o.expandedPanels[i.versionNumber]),u.xp6(3),u.hij("Version ",i.versionNumber,""),u.xp6(2),u.Oqu(u.xi3(6,4,i.timeStamp,"yyyy-MM-dd hh:mm")),u.xp6(2),u.Q6J("ngIf",o.expandedPanels[i.versionNumber])}}function z(e,t){if(1&e&&(u.TgZ(0,"mat-accordion",14),u.YNc(1,P,8,7,"mat-expansion-panel",15),u.qZA()),2&e){var n=u.oxw().ngIf;u.xp6(1),u.Q6J("ngForOf",n.historyItems)}}function Q(e,t){if(1&e){var n=u.EpF();u.TgZ(0,"mat-paginator",32),u.NdJ("page",function(e){return u.CHM(n),u.oxw(2).pageChange(e)}),u.qZA()}if(2&e){var i=u.oxw().ngIf,o=u.oxw();u.Q6J("length",i.length)("pageSize",i.pageSize)("pageSizeOptions",o.pageSizeOptions)}}function j(e,t){if(1&e){var n=u.EpF();u.ynx(0),u.TgZ(1,"div",1),u.TgZ(2,"div",2),u.TgZ(3,"div"),u._uU(4,"Item History"),u.qZA(),u.TgZ(5,"button",3),u.NdJ("click",function(){return u.CHM(n),u.oxw().closeDialog()}),u.TgZ(6,"mat-icon"),u._uU(7,"close"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(8,"p",4),u._uU(9,"Check version history for this item and restore the version you need."),u.qZA(),u.YNc(10,C,7,1,"div",5),u.TgZ(11,"div",6),u.YNc(12,O,2,0,"div",0),u.YNc(13,T,2,0,"div",0),u.YNc(14,z,2,1,"mat-accordion",7),u.qZA(),u.YNc(15,Q,1,3,"mat-paginator",8),u.BQk()}if(2&e){var i=t.ngIf;u.xp6(10),u.Q6J("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),u.xp6(2),u.Q6J("ngIf",null===i.historyItems),u.xp6(1),u.Q6J("ngIf",0===(null==i.historyItems?null:i.historyItems.length)),u.xp6(1),u.Q6J("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),u.xp6(1),u.Q6J("ngIf",(null==i.historyItems?null:i.historyItems.length)>0)}}var U=function(){function e(e,t,n,l){this.dialogRef=e,this.route=t,this.versionsService=n,this.snackBar=l,this.hostClass="dialog-component",this.pageSizeOptions=[10,20,50],this.expandedPanels={},this.expandedAttributes={},this.itemId=parseInt(this.route.snapshot.paramMap.get("itemId"),10),this.versions$=new o.X(null),this.page$=new o.X(1),this.pageSize$=new o.X(this.pageSizeOptions[0]),this.compareWith$=new o.X("live"),this.historyItems$=(0,a.aj)([this.versions$,this.page$,this.pageSize$,this.compareWith$]).pipe((0,r.U)(function(e){var t,n,o,a,r=(0,i.CR)(e,4);return n=r[1],o=r[2],a=r[3],null==(t=r[0])||null==n||null==o||null==a?null:function(e,t,n){return e.map(function(e){return{changeSetId:e.ChangeSetId,attributes:s(e,t,n),historyId:e.HistoryId,timeStamp:e.TimeStamp,user:e.User,versionNumber:e.VersionNumber,isLastVersion:!t.some(function(t){return t.VersionNumber===e.VersionNumber+1})}})}(t.slice((n-1)*o,n*o),t,a)})),this.templateVars$=(0,a.aj)([this.versions$,this.historyItems$,this.pageSize$,this.compareWith$]).pipe((0,r.U)(function(e){var t=(0,i.CR)(e,4),n=t[0];return{length:null==n?void 0:n.length,historyItems:t[1],pageSize:t[2],compareWith:t[3]}}))}return e.prototype.ngOnInit=function(){var e=this;this.versionsService.fetchVersions(this.itemId).subscribe(function(t){e.versions$.next(t)})},e.prototype.ngOnDestroy=function(){this.versions$.complete(),this.page$.complete(),this.pageSize$.complete(),this.compareWith$.complete()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.compareChange=function(e){this.compareWith$.next(e)},e.prototype.panelExpandedChange=function(e,t){this.expandedPanels[t]=e},e.prototype.attributeExpandedToggle=function(e,t){this.expandedAttributes[e+t]=!this.expandedAttributes[e+t]},e.prototype.pageChange=function(e){var t=e.pageIndex+1;t!==this.page$.value&&(this.expandedPanels={},this.expandedAttributes={},this.page$.next(t));var n=e.pageSize;n!==this.pageSize$.value&&this.pageSize$.next(n)},e.prototype.restore=function(e){var t=this;this.snackBar.open("Restoring previous version..."),this.versionsService.restore(this.itemId,e).subscribe(function(e){t.snackBar.open("Previous version restored. Will reload edit dialog",null,{duration:3e3}),t.dialogRef.close({refreshEdit:!0})})},e.\u0275fac=function(t){return new(t||e)(u.Y36(d.so),u.Y36(g.gz),u.Y36(h.Z),u.Y36(f.ux))},e.\u0275cmp=u.Xpm({type:e,selectors:[["app-item-history"]],hostVars:1,hostBindings:function(e,t){2&e&&u.Ikx("className",t.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-description"],["class","compare-box",4,"ngIf"],[1,"dialog-component-content","fancy-scrollbar-light"],["multi","","class","history-tables",4,"ngIf"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],[1,"compare-box"],["appearance","standard","color","accent",1,"compare-box__dropdown"],["name","Scope",3,"value","selectionChange"],["value","previous"],["value","live"],["multi","",1,"history-tables"],[3,"expanded","expandedChange",4,"ngFor","ngForOf"],[3,"expanded","expandedChange"],["class","table-row",4,"ngFor","ngForOf"],[1,"row-actions"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"table-row"],[1,"table-row__main","row-main",3,"click"],[1,"row-main__type"],["class","table-row__details",4,"ngIf"],[1,"table-row__details"],["class","detail-row",4,"ngFor","ngForOf"],[1,"detail-row"],[1,"detail-row__value"],[3,"class",4,"ngIf"],[1,"history-new"],[1,"history-deleted","history-deleted__value"],["mat-raised-button","","color","accent",3,"click"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page"]],template:function(e,t){1&e&&(u.YNc(0,j,16,5,"ng-container",0),u.ALo(1,"async")),2&e&&u.Q6J("ngIf",u.lcZ(1,1,t.templateVars$))},directives:[m.O5,d.uh,v.lW,x.$,y.Hw,_.KE,b.gD,Z.ey,w.pp,m.sg,w.ib,w.yz,w.yK,w.u4,I.NW],pipes:[m.Ov,m.uU],styles:[".compare-box[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-end;height:40px}.compare-box__dropdown[_ngcontent-%COMP%]{width:192px;margin-top:-14px;font-size:14px;height:auto}.mat-accordion[_ngcontent-%COMP%]{display:block;padding:4px 0}.mat-expansion-panel-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{font-size:14px}.table-row__main[_ngcontent-%COMP%]{display:flex}.table-row__details[_ngcontent-%COMP%]{display:block}.row-main[_ngcontent-%COMP%]{cursor:pointer;padding:4px 0}.row-main__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.row-main__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-main__type[_ngcontent-%COMP%]{flex:0 0 auto;font-size:12px}.row-main__type[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:not(:last-of-type){margin-right:2px}.detail-row[_ngcontent-%COMP%]{display:flex;padding-bottom:4px;cursor:default}.detail-row__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.detail-row__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"]}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/12.07.00/ng-edit/projects_ng-dialogs_src_app_item-history_item-history_component_ts.5ece128251ec1b660438.js.map