"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts"],{9996:(U,N,n)=>{n.d(N,{F:()=>P});var m=n(9148),x=n(271),w=n(6474);const I="admin/AppFiles/asset",$="admin/ApiExplorer/AppApiFiles";let P=(()=>{class f extends w.D{get(i,r,l){return this.getHttpApiUrl(I,{params:{appId:this.appId,global:r,...this.templateIdOrPath(i,r,l)}}).pipe((0,x.T)(s=>{if("auto"===s.Type.toLocaleLowerCase())switch(s.Extension.toLocaleLowerCase()){case".cs":case".cshtml":s.Type="Razor";break;case".html":case".css":case".js":s.Type="Token"}return s}))}save(i,r,l,s){return this.http.post(this.apiUrl(I),l,{params:{appId:this.appId,global:r,...this.templateIdOrPath(i,r,s)}})}getAll(i){return this.getHttpApiUrl("admin/AppFiles/AppFiles",{params:{appId:this.appId,...i&&{mask:i}}}).pipe((0,x.T)(({Files:r})=>(r.forEach(l=>{l.Shared??=!1}),r)))}getWebApis(){return this.getHttpApiUrl($,{params:{appId:this.appId}}).pipe((0,x.T)(({files:i})=>(i.forEach(r=>{r.isShared??=!1,r.isCompiled??=!1}),i))).pipe((0,x.T)(i=>i.map(l=>{const s=l.path.lastIndexOf("/"),C=l.path.lastIndexOf("."),D=l.path.substring(0,s),T=l.path.substring(s+1,C);return{path:l.path,folder:D,name:T,isShared:l.isShared,endpointPath:l.endpointPath,isCompiled:l.isCompiled,edition:l.edition}})))}getWebApisSig(){const i=this.getSignal($,{params:{appId:this.appId}});return(0,m.EWP)(()=>{const l=i()?.files;return l?(l.forEach(s=>{s.isShared??=!1,s.isCompiled??=!1}),l.map(s=>{const C=s.path.lastIndexOf("/"),D=s.path.lastIndexOf("."),T=s.path.substring(0,C),O=s.path.substring(C+1,D);return{path:s.path,folder:T,name:O,isShared:s.isShared,endpointPath:s.endpointPath,isCompiled:s.isCompiled,edition:s.edition}})):[]})}getWebApiDetails(i){return this.getHttpApiUrl("admin/ApiExplorer/inspect",{params:{appId:this.appId,zoneId:this.zoneId,path:i}})}getPredefinedTemplates(i,r){return this.getHttpApiUrl("admin/AppFiles/GetTemplates",{params:{...i&&{purpose:i},...r&&{type:r}}})}getPreview(i,r,l){return this.getHttpApiUrl("admin/AppFiles/preview",{params:{appId:this.appId,path:i,templateKey:l,global:r}})}create(i,r,l){return this.http.post(this.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.appId,global:r,purpose:"auto",path:i,templateKey:l}})}templateIdOrPath(i,r,l){if(/^[0-9]*$/g.test(i)){const s=l.find(C=>C.EntityId?.toString()===i&&C.IsShared===r)?.Path;return{templateId:i,...null!=s&&{path:s}}}return{path:i}}static{this.\u0275fac=(()=>{let i;return function(l){return(i||(i=m.xGo(f)))(l||f)}})()}static{this.\u0275prov=m.jDH({token:f,factory:f.\u0275fac})}}return f})()},4029:(U,N,n)=>{n.d(N,{g:()=>nt});var m=n(4456),x=n(7941),w=n(316),A=n(4175),I=n(5060),y=n(4950),M=n(7984),$=n(1134),S=n(5175),j=n(5797),P=n(9999),f=n(3037),F=n(1817),i=n(271),r=n(8764),l=n(8473),s=n(819),C=n(1687),D=n(2645),O=n(4581);var z=n(6647),B=n(9452),X=n(1873),L=n(2938),Y=n(9996),Z=n(3050),H=n(3176),W=n(3758),t=n(9148);let J=(()=>{class o{constructor(e,a){this.matInput=e,this.elementRef=a,this.autofocusSelectValue=(0,t.hFB)(!1)}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue())&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const a=e.toLocaleLowerCase();return"true"===a||"false"!==a&&void 0}return null==e?e:void 0}static{this.\u0275fac=function(a){return new(a||o)(t.rXU(M.fg),t.rXU(t.aKT))}}static{this.\u0275dir=t.FsC({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:[1,"autofocusSelectValue"]},standalone:!0})}}return o})();const K=o=>({disabled:o});function Q(o,h){if(1&o&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&o){const e=h.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function _(o,h){if(1&o&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&o){const e=h.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function q(o,h){if(1&o&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&o){const e=h.$implicit;t.Y8G("value",e.Key),t.R7$(),t.SpI(" ",e.Name," ")}}function tt(o,h){1&o&&(t.j41(0,"app-field-hint",16),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function et(o,h){1&o&&t.nrm(0,"mat-spinner",21)(1,"div",22)}function at(o,h){if(1&o&&(t.j41(0,"div",23)(1,"label",24),t.EFF(2,"Preview"),t.k0s()(),t.j41(3,"pre",25),t.EFF(4),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(3,K,e.loadingPreview)),t.R7$(2),t.Y8G("ngClass",t.eq3(5,K,e.loadingPreview)),t.R7$(),t.JRh(e.preview)}}function ot(o,h){if(1&o&&(t.j41(0,"div",20),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.SpI(" ",e.previewError," ")}}function it(o,h){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),t.EFF(4,"Create"),t.k0s(),t.j41(5,"span",3),t.EFF(6),t.k0s()()(),t.j41(7,"div",4)(8,"form",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"mat-form-field",9)(13,"mat-label"),t.EFF(14,"Platform"),t.k0s(),t.j41(15,"mat-select",10),t.Z7z(16,Q,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),t.EFF(21,"Purpose"),t.k0s(),t.j41(22,"mat-select",12),t.Z7z(23,_,2,2,"mat-option",11,t.fX1),t.k0s()()()(),t.j41(25,"div",13)(26,"mat-form-field",9)(27,"mat-label"),t.EFF(28,"Template"),t.k0s(),t.j41(29,"mat-select",14),t.Z7z(30,q,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(32,"div",13)(33,"mat-form-field",9)(34,"mat-label"),t.EFF(35,"Name"),t.k0s(),t.nrm(36,"input",15),t.k0s(),t.DNE(37,tt,2,1,"app-field-hint",16),t.k0s()(),t.j41(38,"div",17),t.DNE(39,et,2,0),t.j41(40,"button",18),t.bIt("click",function(){t.eBV(e);const u=t.XpG();return t.Njj(u.closeDialog())}),t.EFF(41,"Cancel"),t.k0s(),t.j41(42,"button",19),t.bIt("click",function(){t.eBV(e);const u=t.XpG();return t.Njj(u.confirm())}),t.EFF(43," Create "),t.k0s()(),t.DNE(44,at,5,7)(45,ot,2,1,"div",20),t.k0s()()()}if(2&o){const e=h,a=t.XpG();t.R7$(6),t.JRh(a.controls.finalName.value||(a.controls.folder.value?a.controls.folder.value.trim()+"/":"")),t.R7$(2),t.Y8G("formGroup",a.form),t.R7$(8),t.Dyx(e.platforms),t.R7$(7),t.Dyx(e.purposes),t.R7$(7),t.Dyx(e.templates),t.R7$(7),t.vxM(a.controls.name.touched&&null!=a.controls.name.errors&&a.controls.name.errors.required?37:-1),t.R7$(2),t.vxM(e.loadingPreview?39:-1),t.R7$(3),t.Y8G("disabled",!a.form.valid||e.loadingPreview||!e.previewValid),t.R7$(2),t.vxM(e.preview?44:-1),t.R7$(),t.vxM(!e.loadingPreview&&e.previewError?45:-1)}}let nt=(()=>{class o extends H.${constructor(e,a){super(),this.dialogData=e,this.dialog=a,this.hostClass="dialog-component",this.all="All",this.sourceService=(0,L.d)(Y.F)}ngOnInit(){this.templates$=new j.t([]),this.loadingPreview$=new j.t(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialog.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new m.J3({platform:new m.hs(this.all),purpose:new m.hs({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new m.hs(null,m.k0.required),name:new m.hs(this.dialogData.name??null,m.k0.required),finalName:new m.hs({value:null,disabled:!0}),folder:new m.hs({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscriptions.add((0,P.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,f.Z)(this.controls.templateKey.value),(0,F.F)())]).subscribe(([e,a])=>{const u=e.find(c=>c.Key===a),v=this.dialogData.name?this.controls.name.value||this.dialogData.name:u?.SuggestedFileName??null;this.controls.name.value!==v&&this.controls.name.patchValue(v)})),this.subscriptions.add((0,P.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,f.Z)(this.controls.templateKey.value),(0,F.F)()),this.controls.name.valueChanges.pipe((0,f.Z)(this.controls.name.value),(0,F.F)()),this.controls.folder.valueChanges.pipe((0,f.Z)(this.controls.folder.value),(0,F.F)())]).subscribe(([e,a,u,v])=>{const c=e.find(d=>d.Key===a);let p=null;u&&(v=v.trim(),u=Z.SX.sanitizePath(u.trim()),p=`${v?`${v}/`:""}${u=`${c?.Prefix??""}${u}${c?.Suffix??""}${c?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==p&&this.controls.finalName.patchValue(p)}))}buildViewModel(){const e=this.templates$.pipe((0,i.T)(c=>{const p={[this.all]:this.all};return c.forEach(d=>{d.Platforms?.forEach(g=>{p[g]=g})}),Object.keys(p)})),a=this.templates$.pipe((0,i.T)(c=>{const p={[this.all]:this.all};return c.forEach(d=>{p[d.Purpose]=d.Purpose}),Object.keys(p)})),u=(0,P.z)([this.templates$,this.controls.platform.valueChanges.pipe((0,f.Z)(this.controls.platform.value),(0,F.F)()),this.controls.purpose.valueChanges.pipe((0,f.Z)(this.controls.purpose.value),(0,F.F)())]).pipe((0,i.T)(([c,p,d])=>c.filter(E=>(p===this.all||(E.Platforms?.includes(p)??!1))&&(d===this.all||E.Purpose===d))),(0,r.M)(c=>{if(!c.some(p=>p.Key===this.controls.templateKey.value)){const p=c[0]?.Key??null;this.controls.templateKey.value!==p&&this.controls.templateKey.patchValue(p)}})),v=(0,P.z)([this.controls.finalName.valueChanges.pipe((0,f.Z)(this.controls.finalName.value),(0,F.F)()),this.controls.templateKey.valueChanges.pipe((0,f.Z)(this.controls.templateKey.value),(0,F.F)())]).pipe(function k(o,h=l.E,e){const a=(0,O.O)(o,h);return function T(o,h){return(0,s.N)((e,a)=>{const{leading:u=!0,trailing:v=!1}=h??{};let c=!1,p=null,d=null,g=!1;const E=()=>{d?.unsubscribe(),d=null,v&&(G(),g&&a.complete())},R=()=>{d=null,g&&a.complete()},V=b=>d=(0,D.Tg)(o(b)).subscribe((0,C._)(a,E,R)),G=()=>{if(c){c=!1;const b=p;p=null,a.next(b),!g&&V(b)}};e.subscribe((0,C._)(a,b=>{c=!0,p=b,(!d||d.closed)&&(u?G():V(b))},()=>{g=!0,(!(v&&c&&d)||d.closed)&&a.complete()}))})}(()=>a,e)}(100,l.E,{leading:!0,trailing:!0}),(0,r.M)(()=>{this.loadingPreview$.next(!0)}),(0,z.n)(([c,p])=>c&&p?(0,X.p)([this.sourceService.getPreview(c,this.dialogData.global,p),(0,O.O)(500)]).pipe((0,i.T)(([d])=>d)):(0,B.of)(void 0)),(0,r.M)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,P.z)([e,a,u,v,this.loadingPreview$]).pipe((0,i.T)(([c,p,d,g,E])=>({platforms:c,purposes:p,templates:d,loadingPreview:E,preview:g?.Preview,previewValid:g?.IsValid??!1,previewError:g?.Error})))}static{this.\u0275fac=function(a){return new(a||o)(t.rXU(x.Vh),t.rXU(x.CP))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(a,u){2&a&&t.Mr5("className",u.hostClass)},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-mat-form-field"],["formControlName","platform"],[3,"value"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],[1,"eav-preview-error"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"]],template:function(a,u){if(1&a&&(t.DNE(0,it,46,7,"div",0),t.nI1(1,"async")),2&a){let v;t.vxM((v=t.bMT(1,1,u.viewModel$))?0:-1,v)}},dependencies:[m.YN,m.qT,m.me,m.BC,m.cb,m.YS,m.X1,m.j4,m.JD,y.RG,y.rl,y.nJ,S.Ve,S.VO,I.wT,I.Sy,M.fS,M.fg,$.D6,$.LG,A.Hl,A.$z,w.YU,w.Jj,W.F,J],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.03.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts.eb41ea254b642bed.js.map