{"version":3,"file":"projects_eav-ui_src_app_app-administration_copilot_page_copilot-page_component_ts.b947bca719cee6c9.js","mappings":"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","names":["CopilotService","static","this","webApiEditions","webApiGeneratedCode","constructor","http","context","log","classLog","specs","#getCopilotSpecs","getEditions","pipe","map","data","editions","getDefaultEdition","find","e","isDefault","getGenerators","generators","get","_a","params","appId","toString","defaultOrFirst","#findDefaultEdition","d","description","label","name","replace","shareReplay","__ngFactoryType__","i0","i1","i2","root_effect_scheduler_DCy1y1b8","jDH","factory","ɵfac","generator_r3","version","ctx","descriptionHtml","$event","_r1","ctx_r1","selectedGenerator","CopilotGeneratorComponent_Conditional_9_For_7_Template","CopilotGeneratorComponent_Conditional_9_Conditional_8_Template","sort","tmp_5_0","selectedGenerator$","edition_r5","_r4","selectedEdition","CopilotGeneratorComponent_Conditional_12_For_5_Template","entity_r7","Title","CopilotGeneratorComponent_Conditional_15_Conditional_8_For_1_Template","_forTrack0","_r8","deleteConfiguration","_r6","selectedEntity","CopilotGeneratorComponent_Conditional_15_Conditional_8_Template","editConfig","CopilotGeneratorComponent_Conditional_15_Conditional_15_Template","undefined","tmp_3_0","entities$","CopilotGeneratorComponent","outputType","input","title","#copilotSvc","transient","#entitySvc","EntityService","#dialogRouter","DialogRoutingService","#matDialog","MatDialog","#snackBar","MatSnackBar","#context","Context","#http","HttpClient","#viewContainerRef","inject","ViewContainerRef","#copilotConfigurationGuid","editions$","showConfigurationDropdown","signal","generators$","gens","filter","g","ngOnInit","take","subscribe","fetchEntities","doOnDialogClosed","getEntities$","of","contentTypeName","form","items","EditPrep","editId","Id","newFromType","url","convertFormToUrl","navRelative","selected","open","ConfirmDeleteDialogComponent","autoFocus","entityId","entityTitle","message","hasDeleteSnackbar","viewContainerRef","width","afterClosed","isConfirmed","delete","next","duration","error","console","toggleConfigurationDropdown","set","autoGeneratedCode","edition","generator","configurationId","timeTaken","debug_node_JnOYh9kg","VBU","selectors","inputs","decls","vars","consts","template","rf","CopilotGeneratorComponent_Conditional_9_Template","CopilotGeneratorComponent_Conditional_12_Template","CopilotGeneratorComponent_Conditional_15_Template","tmp_2_0","MatSelectModule","MatButtonModule","i3","MatCardModule","i4","MatIconModule","i5","CommonModule","i6","styles","CopilotPageComponent","activatedRoute","snapshot","heading","intro","RouterOutlet"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/copilot/copilot-service.ts","./projects/eav-ui/src/app/app-administration/copilot/copilot-generator.component.html","./projects/eav-ui/src/app/app-administration/copilot/copilot-generator.component.ts","./projects/eav-ui/src/app/app-administration/copilot/page/copilot-page.component.ts","./projects/eav-ui/src/app/app-administration/copilot/page/copilot-page.component.html"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Context } from '../../shared/services/context';\r\nimport { EditionData, EditionDataDto } from './edition-data';\r\nimport { map, shareReplay } from 'rxjs';\r\nimport { Edition, EditionDto } from './edition';\r\nimport { classLog } from '../../shared/logging';\r\n\r\n@Injectable()\r\nexport class CopilotService {\r\n  \r\n  log = classLog({CopilotService});\r\n\r\n  static webApiEditions: string = 'admin/code/getEditions';\r\n  static webApiGeneratedCode: string = 'admin/code/generateDataModels';\r\n\r\n  public specs = this.#getCopilotSpecs();\r\n\r\n  constructor(private http: HttpClient, private context: Context) { }\r\n\r\n  getEditions() {\r\n    return this.specs.pipe(map(data => data.editions));\r\n  }\r\n\r\n  getDefaultEdition() {\r\n    return this.specs.pipe(map(data => data.editions.find(e => e.isDefault)));\r\n  }\r\n\r\n  getGenerators() {\r\n    return this.specs.pipe(map(data => data.generators));\r\n  }\r\n\r\n  #getCopilotSpecs() {\r\n    return this.http.get<EditionDataDto>(CopilotService.webApiEditions, {\r\n      params: {\r\n        appId: this.context.appId.toString()\r\n      }\r\n    }).pipe(\r\n      map((data) => {\r\n        const defaultOrFirst = this.#findDefaultEdition(data.editions);\r\n        const editions = data.editions.map(d => {\r\n          const isDefault = d == defaultOrFirst;\r\n          return {\r\n            ...d,\r\n            isDefault,\r\n            description: (d.description || \"no description provided\") + (isDefault ? ' ✅' : ''),\r\n            label: `/${d.name}/AppCode/Data`.replace(/\\/\\//g, '/'),\r\n          } as Edition;\r\n        });\r\n\r\n        return { ...data, editions } as EditionData;\r\n      }),\r\n      shareReplay(1),\r\n    );\r\n  }\r\n\r\n  #findDefaultEdition(editions: EditionDto[]): EditionDto {\r\n    return editions.find(d => d.isDefault) ?? editions.find(d => d.name === '') ?? editions[0];\r\n  }\r\n\r\n}","<div class=\"eav-cards-box\" [class.eav-cards-box-expanded]=\"showConfigurationDropdown()\">\r\n  <mat-card class=\"eav-card\">\r\n    <mat-card-header class=\"eav-card-header\">\r\n      <mat-card-title>{{ title() }}</mat-card-title>\r\n      <mat-icon>support_agent</mat-icon>\r\n    </mat-card-header>\r\n    <mat-card-content>\r\n      <br />\r\n      <!-- Generator select -->\r\n      @if (generators$ | async; as generators) {\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Generator</mat-label>\r\n          <mat-select required [(value)]=\"selectedGenerator\">\r\n            <mat-select-trigger>\r\n              {{ selectedGenerator }}\r\n            </mat-select-trigger>\r\n            @for (generator of generators.sort(); track generator) {\r\n              <mat-option [value]=\"generator.name\">\r\n                <strong>{{ generator.name }} v{{ generator.version }}</strong\r\n                ><br />\r\n                {{ generator.description }}\r\n              </mat-option>\r\n            }\r\n          </mat-select>\r\n          @if (selectedGenerator$ | async; as selectedGenerator) {\r\n            <mat-hint [innerHTML]=\"selectedGenerator.descriptionHtml\"></mat-hint>\r\n          }\r\n        </mat-form-field>\r\n        <br />\r\n      }\r\n\r\n      <br />\r\n      <!-- Edition select -->\r\n      @if (editions$ | async; as editions) {\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Select an Edition to generate code for</mat-label>\r\n          <mat-select required [(value)]=\"selectedEdition\">\r\n            @for (edition of editions.sort(); track edition) {\r\n              <mat-option [value]=\"edition.name\">\r\n                <strong>{{ edition.label }}</strong> ({{ edition.description }})\r\n              </mat-option>\r\n            }\r\n          </mat-select>\r\n          <mat-hint>\r\n            Editions are managed in the <code>/App_Data/app.json</code> file. See\r\n            <a href=\"https://go.2sxc.org/app-json\" target=\"_blank\">docs</a>.\r\n          </mat-hint>\r\n        </mat-form-field>\r\n      }\r\n\r\n      <br />\r\n      <!-- Configurations select -->\r\n      @if (showConfigurationDropdown()) {\r\n        <br />\r\n\r\n        <div class=\"configuration-select\">\r\n          <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n            <mat-label>Select a Configuration</mat-label>\r\n            <mat-select [(value)]=\"selectedEntity\">\r\n              <mat-option [value]=\"undefined\">\r\n                Empty (press + to create new)\r\n              </mat-option>\r\n              @if (entities$ | async; as entities)\r\n              {\r\n                @for (entity of entities; track entity.Id)\r\n                {\r\n                  <mat-option [value]=\"entity\">\r\n                    {{ entity.Title }}\r\n                  </mat-option>\r\n                }\r\n              }\r\n            </mat-select>\r\n            <mat-hint>\r\n              Reusable configuration for the Data Copilot generator.\r\n            </mat-hint>\r\n          </mat-form-field>\r\n\r\n          <!-- Add / edit button -->\r\n          <button\r\n            mat-icon-button\r\n            class=\"eav-icon\"\r\n            aria-label=\"Create\"\r\n            (click)=\"editConfig()\"\r\n          >\r\n            <mat-icon>{{ selectedEntity ? \"edit\" : \"add\" }}</mat-icon>\r\n          </button>\r\n          \r\n          <!-- Delete button -->\r\n          @if (selectedEntity)\r\n          {\r\n            <button\r\n              mat-icon-button\r\n              class=\"eav-icon\"\r\n              aria-label=\"Delete\"\r\n              (click)=\"deleteConfiguration()\"\r\n            >\r\n              <mat-icon>delete</mat-icon>\r\n            </button>\r\n          }\r\n\r\n        </div>\r\n      }\r\n\r\n    </mat-card-content>\r\n    <div class=\"eav-card-space-div\"></div>\r\n    <mat-card-actions align=\"end\">\r\n      <button mat-button class=\"eav-button__with-icon\" (click)=\"toggleConfigurationDropdown()\">\r\n        <mat-icon class=\"eav-icon\">discover_tune</mat-icon>\r\n        <span>Use Configuration</span>\r\n      </button>\r\n      <button mat-button class=\"eav-button__with-icon\" (click)=\"autoGeneratedCode()\">\r\n        <mat-icon class=\"eav-icon\">code</mat-icon>\r\n        <span>Generate Code</span>\r\n      </button>\r\n    </mat-card-actions>\r\n  </mat-card>\r\n</div>\r\n","import { CommonModule } from '@angular/common';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Component, inject, input, signal, ViewContainerRef } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { EntityLightIdentifier } from 'projects/edit-types/src/EntityLight';\r\nimport { Guid } from 'projects/field-string-wysiwyg/src/shared/guid';\r\nimport { map, Observable, of, take } from 'rxjs';\r\nimport { transient } from '../../../../../core';\r\nimport { convertFormToUrl } from '../../shared/helpers/url-prep.helper';\r\nimport { EditForm, EditPrep } from '../../shared/models/edit-form.model';\r\nimport { RichResult } from '../../shared/models/rich-result';\r\nimport { DialogRoutingService } from '../../shared/routing/dialog-routing.service';\r\nimport { Context } from '../../shared/services/context';\r\nimport { EntityService } from '../../shared/services/entity.service';\r\nimport { ConfirmDeleteDialogComponent } from '../sub-dialogs/confirm-delete-dialog/confirm-delete-dialog.component';\r\nimport { ConfirmDeleteDialogData } from '../sub-dialogs/confirm-delete-dialog/confirm-delete-dialog.models';\r\nimport { CopilotService } from './copilot-service';\r\n\r\ntype DataCopilotConfiguration = {\r\n  Guid: Guid;\r\n  Id: number;\r\n  Title?: string;\r\n};\r\n\r\n@Component({\r\n  selector: 'app-copilot-generator',\r\n  templateUrl: './copilot-generator.component.html',\r\n  styleUrls: ['./copilot-generator.component.scss'],\r\n  imports: [\r\n    MatSelectModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatIconModule,\r\n    CommonModule,\r\n  ]\r\n})\r\nexport class CopilotGeneratorComponent {\r\n\r\n  outputType = input<string>();\r\n  title? = input<string>('Copilot Generator');\r\n\r\n  #copilotSvc = transient(CopilotService);\r\n  #entitySvc = transient(EntityService);\r\n  #dialogRouter = transient(DialogRoutingService);\r\n  #matDialog = transient(MatDialog);\r\n  #snackBar = transient(MatSnackBar);\r\n  #context = transient(Context);\r\n  #http = transient(HttpClient);\r\n\r\n  #viewContainerRef = inject(ViewContainerRef);\r\n\r\n  readonly #copilotConfigurationGuid = 'b08dcd23-2eb0-4a5e-a3d0-3178d2aae451';\r\n\r\n  webApiGeneratedCode: string = 'admin/code/generateDataModels';\r\n  editions$ = this.#copilotSvc.getEditions();\r\n\r\n  showConfigurationDropdown = signal(false);\r\n\r\n  entities$: Observable<EntityLightIdentifier[]>;\r\n  selectedEntity?: DataCopilotConfiguration;\r\n\r\n  generators$ = this.#copilotSvc.getGenerators()\r\n    .pipe(\r\n      map((gens) => gens.filter(g => g.outputType === this.outputType()))\r\n    );\r\n\r\n  selectedGenerator$ = this.generators$.pipe(map(gens => gens.find(g => g.name === this.selectedGenerator)));\r\n\r\n  selectedGenerator = '';\r\n  selectedEdition = '';\r\n\r\n  ngOnInit(): void {\r\n    this.generators$.pipe(take(1)).subscribe(gens => {\r\n      this.selectedGenerator = gens[0]?.name ?? '';\r\n    });\r\n    this.#copilotSvc.specs.pipe(take(1)).subscribe(specs => {\r\n      this.selectedEdition = specs.editions.find(e => e.isDefault)?.name ?? '';\r\n    });\r\n    this.fetchEntities();\r\n\r\n    // Subscribe to route changes to refresh entities when dialog closes\r\n    this.#dialogRouter.doOnDialogClosed(() => this.fetchEntities());\r\n  }\r\n\r\n  fetchEntities() {\r\n    this.entities$ = this.#entitySvc.getEntities$(of({ contentTypeName: this.#copilotConfigurationGuid }));\r\n  }\r\n\r\n\r\n  editConfig() {\r\n    const form: EditForm = {\r\n      items: [this.selectedEntity\r\n        ? EditPrep.editId(this.selectedEntity.Id)\r\n        : EditPrep.newFromType(this.#copilotConfigurationGuid)\r\n      ]\r\n    };\r\n\r\n    const url = convertFormToUrl(form);\r\n    this.#dialogRouter.navRelative([`edit/${url}`]); //\r\n  }\r\n\r\n  deleteConfiguration() {\r\n    const selected = this.selectedEntity;\r\n    const data: ConfirmDeleteDialogData = {\r\n      entityId: selected.Id,\r\n      entityTitle: selected.Title,\r\n      message: \"Are you sure you want to delete?  \",\r\n      hasDeleteSnackbar: true\r\n    };\r\n\r\n    const confirmationDialogRef = this.#matDialog.open(ConfirmDeleteDialogComponent, {\r\n      autoFocus: false,\r\n      data,\r\n      viewContainerRef: this.#viewContainerRef,\r\n      width: '400px',\r\n    });\r\n\r\n    confirmationDialogRef.afterClosed().subscribe((isConfirmed: boolean) => {\r\n      if (isConfirmed) {\r\n        this.#entitySvc.delete(\r\n          this.#context.appId,           // appId: number\r\n          this.#copilotConfigurationGuid,// contentType: string\r\n          selected.Id,                   // entityId: number\r\n          false                          // force: boolean\r\n        ).subscribe({\r\n          next: () => {\r\n            this.#snackBar.open('Deleted', null, { duration: 2000 });\r\n            this.fetchEntities();\r\n          },\r\n          error: (error) => {\r\n            console.error('Error deleting configuration:', error);\r\n            this.#snackBar.open('Error deleting configuration', null, { duration: 3000 });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  toggleConfigurationDropdown() {\r\n    this.showConfigurationDropdown.set(!this.showConfigurationDropdown());\r\n  }\r\n\r\n  autoGeneratedCode() {\r\n    this.#http.get<RichResult>(this.webApiGeneratedCode, {\r\n      params: {\r\n        appId: this.#context.appId,\r\n        edition: this.selectedEdition,\r\n        generator: this.selectedGenerator,\r\n        ...(this.selectedEntity ? { configurationId: this.selectedEntity.Id } : {}),\r\n      }\r\n    }).subscribe(d => {\r\n      this.#snackBar.open(d.message + `\\n (this took ${d.timeTaken}ms)`, null, { duration: 5000, });\r\n    });\r\n  }\r\n}\r\n","import { Component } from '@angular/core';\r\nimport { ActivatedRoute, RouterOutlet } from '@angular/router';\r\nimport { CopilotGeneratorComponent } from '../copilot-generator.component';\r\nimport { CopilotSpec } from '../copilot-specs';\r\n\r\n@Component({\r\n  selector: 'app-data-copilot',\r\n  templateUrl: './copilot-page.component.html',\r\n  styleUrl: './copilot-page.component.scss',\r\n  imports: [\r\n    CopilotGeneratorComponent,\r\n    RouterOutlet,\r\n  ]\r\n})\r\nexport class CopilotPageComponent {\r\n\r\n  data: CopilotSpec;\r\n\r\n  constructor(activatedRoute: ActivatedRoute) {\r\n    this.data = activatedRoute.snapshot.data as CopilotSpec;\r\n  }\r\n}\r\n","<div class=\"outer-container\">\r\n  <h1>{{ data.heading }}</h1>\r\n  <p>\r\n    {{ data.intro }}\r\n  </p>\r\n</div>\r\n\r\n<app-copilot-generator\r\n  [outputType]=\"data.outputType\"\r\n  [title]=\"data.title\"\r\n></app-copilot-generator>\r\n\r\n<router-outlet></router-outlet>"],"x_google_ignoreList":[]}