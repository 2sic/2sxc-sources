"use strict";(self.webpackChunkng_dialogs=self.webpackChunkng_dialogs||[]).push([["projects_ng-dialogs_src_app_item-history_item-history_component_ts"],{2754:function(cn,y,s){s.r(y),s.d(y,{ItemHistoryComponent:function(){return sn}});var f=s(2090),O=s(8069),A=s(8047),h=s(6317),I=s(6562),C=s(635),w=s(7797),H=s(5106);function S(t,o,e){var i=JSON.parse(t.Json).Entity.Attributes,a="live"===e?function J(t){var i,o=t[0],e=(0,H.Z)(t);try{for(e.s();!(i=e.n()).done;){var a=i.value;a.VersionNumber<=o.VersionNumber||(o=a)}}catch(r){e.e(r)}finally{e.f()}return o}(o):o.find(function(c){return c.VersionNumber===t.VersionNumber-1}),r=a?JSON.parse(a.Json).Entity.Attributes:null,l=[];return null!=i&&Object.entries(i).forEach(function(c){var m=(0,f.Z)(c,2),g=m[0];Object.keys(m[1]).forEach(function(_){null==l.find(function(u){return u.name===_&&u.dataType===g})&&l.push({name:_,dataType:g})})}),null!=r&&Object.entries(r).forEach(function(c){var m=(0,f.Z)(c,2),g=m[0];Object.keys(m[1]).forEach(function(_){null==l.find(function(u){return u.name===_&&u.dataType===g})&&l.push({name:_,dataType:g})})}),l.map(function(c){var m,g,d=null===(m=null==i?void 0:i[c.dataType])||void 0===m?void 0:m[c.name],_=null===(g=null==r?void 0:r[c.dataType])||void 0===g?void 0:g[c.name];return{name:c.name,dataType:c.dataType,change:Z(d,_,!0),values:P(d,_)}})}function P(t,o){var e=[];return null!=t&&Object.keys(t).forEach(function(a){e.includes(a)||e.push(a)}),null!=o&&Object.keys(o).forEach(function(a){e.includes(a)||e.push(a)}),e.map(function(a){var r=null==t?void 0:t[a],l=null==o?void 0:o[a];return{langKey:a,value:r,oldValue:l,change:Z(r,l)}})}function Z(t,o){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&("object"==typeof t&&(t=T(t)),"object"==typeof o&&(o=T(o))),null!=t&&null!=o?JSON.stringify(t)!==JSON.stringify(o)?"changed":"none":null!=t?"new":"deleted"}function T(t){return"object"!=typeof t?t:Object.keys(t).sort().reduce(function(o,e){return Object.assign(Object.assign({},o),(0,w.Z)({},e,t[e]))},{})}var M=s(9819),n=s(7133),b=s(5758),z=s(2977),E=s(2528),x=s(6362),Q=s(7317),U=s(785),j=s(5590),F=s(4770),Y=s(1434),k=s(1130),v=s(6531),q=s(1967);function B(t,o){if(1&t){var e=n.EpF();n.TgZ(0,"div",9),n.TgZ(1,"mat-form-field",10),n.TgZ(2,"mat-select",11),n.NdJ("selectionChange",function(r){return n.CHM(e),n.oxw(2).compareChange(r.value)}),n.TgZ(3,"mat-option",12),n._uU(4,"Compare with: Previous"),n.qZA(),n.TgZ(5,"mat-option",13),n._uU(6,"Compare with: Live"),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&t){var i=n.oxw().ngIf;n.xp6(2),n.Q6J("value",i.compareWith)}}function V(t,o){1&t&&(n.TgZ(0,"div"),n._uU(1,"Loading..."),n.qZA())}function L(t,o){1&t&&(n.TgZ(0,"div"),n._uU(1,"No previous versions of this item found"),n.qZA())}function W(t,o){if(1&t&&(n.ynx(0),n._uU(1),n.BQk()),2&t){var e=n.oxw().$implicit;n.xp6(1),n.hij(" ",null==e.values[0]?null:e.values[0].value," ")}}function D(t,o){if(1&t&&(n.TgZ(0,"div"),n._uU(1),n.qZA()),2&t){var e=n.oxw().$implicit;n.Gre("history-",e.change,""),n.xp6(1),n.hij(" ","deleted"===e.change?e.oldValue:e.value," ")}}function K(t,o){if(1&t&&(n.ynx(0),n.TgZ(1,"div",29),n._uU(2),n.qZA(),n.TgZ(3,"div",30),n._uU(4),n.qZA(),n.BQk()),2&t){var e=n.oxw().$implicit;n.xp6(2),n.Oqu(e.value),n.xp6(2),n.Oqu(e.oldValue)}}function R(t,o){if(1&t&&(n.TgZ(0,"div",26),n.TgZ(1,"div"),n._uU(2),n.qZA(),n.TgZ(3,"div",27),n.YNc(4,D,2,4,"div",28),n.YNc(5,K,5,2,"ng-container",0),n.qZA(),n.qZA()),2&t){var e=o.$implicit;n.xp6(1),n.Gre("detail-row__label history-",e.change,""),n.xp6(1),n.hij("",e.langKey,":"),n.xp6(2),n.Q6J("ngIf","changed"!==e.change),n.xp6(1),n.Q6J("ngIf","changed"===e.change)}}function X(t,o){if(1&t&&(n.TgZ(0,"div",24),n.YNc(1,R,6,6,"div",25),n.qZA()),2&t){var e=n.oxw().$implicit;n.xp6(1),n.Q6J("ngForOf",e.values)}}function G(t,o){if(1&t){var e=n.EpF();n.TgZ(0,"div",20),n.TgZ(1,"div",21),n.NdJ("click",function(){var c=n.CHM(e).$implicit,m=n.oxw(2).$implicit;return n.oxw(3).attributeExpandedToggle(m.versionNumber,c.name)}),n.TgZ(2,"div"),n._uU(3),n.qZA(),n.TgZ(4,"div"),n.YNc(5,W,2,1,"ng-container",0),n.qZA(),n.TgZ(6,"div",22),n.TgZ(7,"i"),n._uU(8),n.qZA(),n.qZA(),n.qZA(),n.YNc(9,X,2,1,"div",23),n.qZA()}if(2&t){var i=o.$implicit,a=n.oxw(2).$implicit,r=n.oxw(3);n.xp6(2),n.Gre("row-main__label history-",i.change,""),n.xp6(1),n.hij(" ",i.name," "),n.xp6(1),n.Gre("row-main__value history-",i.change,""),n.xp6(1),n.Q6J("ngIf",!r.expandedAttributes[a.versionNumber+i.name]),n.xp6(3),n.hij("[",i.dataType,"]"),n.xp6(1),n.Q6J("ngIf",r.expandedAttributes[a.versionNumber+i.name])}}function nn(t,o){if(1&t){var e=n.EpF();n.TgZ(0,"button",31),n.NdJ("click",function(){n.CHM(e);var a=n.oxw(2).$implicit;return n.oxw(3).restore(a.changeSetId)}),n._uU(1," Restore "),n.qZA()}}function tn(t,o){if(1&t&&(n.ynx(0),n.YNc(1,G,10,10,"div",17),n.TgZ(2,"div",18),n.YNc(3,nn,2,0,"button",19),n.qZA(),n.BQk()),2&t){var e=n.oxw().$implicit;n.xp6(1),n.Q6J("ngForOf",e.attributes),n.xp6(2),n.Q6J("ngIf",!e.isLastVersion)}}function en(t,o){if(1&t){var e=n.EpF();n.TgZ(0,"mat-expansion-panel",16),n.NdJ("expandedChange",function(l){var c=n.CHM(e).$implicit;return n.oxw(3).panelExpandedChange(l,c.versionNumber)}),n.TgZ(1,"mat-expansion-panel-header"),n.TgZ(2,"mat-panel-title"),n._uU(3),n.qZA(),n.TgZ(4,"mat-panel-description"),n._uU(5),n.ALo(6,"date"),n.qZA(),n.qZA(),n.YNc(7,tn,4,2,"ng-container",0),n.qZA()}if(2&t){var i=o.$implicit,a=n.oxw(3);n.Q6J("expanded",a.expandedPanels[i.versionNumber]),n.xp6(3),n.hij("Version ",i.versionNumber,""),n.xp6(2),n.Oqu(n.xi3(6,4,i.timeStamp,"yyyy-MM-dd hh:mm")),n.xp6(2),n.Q6J("ngIf",a.expandedPanels[i.versionNumber])}}function on(t,o){if(1&t&&(n.TgZ(0,"mat-accordion",14),n.YNc(1,en,8,7,"mat-expansion-panel",15),n.qZA()),2&t){var e=n.oxw().ngIf;n.xp6(1),n.Q6J("ngForOf",e.historyItems)}}function an(t,o){if(1&t){var e=n.EpF();n.TgZ(0,"mat-paginator",32),n.NdJ("page",function(l){return n.CHM(e),n.oxw(2).pageChange(l)}),n.qZA()}if(2&t){var i=n.oxw().ngIf,a=n.oxw();n.Q6J("length",i.length)("pageSize",i.pageSize)("pageSizeOptions",a.pageSizeOptions)}}function rn(t,o){if(1&t){var e=n.EpF();n.ynx(0),n.TgZ(1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div"),n._uU(4,"Item History"),n.qZA(),n.TgZ(5,"button",3),n.NdJ("click",function(){return n.CHM(e),n.oxw().closeDialog()}),n.TgZ(6,"mat-icon"),n._uU(7,"close"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(8,"p",4),n._uU(9,"Check version history for this item and restore the version you need."),n.qZA(),n.YNc(10,B,7,1,"div",5),n.TgZ(11,"div",6),n.YNc(12,V,2,0,"div",0),n.YNc(13,L,2,0,"div",0),n.YNc(14,on,2,1,"mat-accordion",7),n.qZA(),n.YNc(15,an,1,3,"mat-paginator",8),n.BQk()}if(2&t){var i=o.ngIf;n.xp6(10),n.Q6J("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),n.xp6(2),n.Q6J("ngIf",null===i.historyItems),n.xp6(1),n.Q6J("ngIf",0===(null==i.historyItems?null:i.historyItems.length)),n.xp6(1),n.Q6J("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),n.xp6(1),n.Q6J("ngIf",(null==i.historyItems?null:i.historyItems.length)>0)}}var sn=function(){var t=function(){function o(e,i,a,r){(0,O.Z)(this,o),this.dialogRef=e,this.route=i,this.versionsService=a,this.snackBar=r,this.hostClass="dialog-component",this.pageSizeOptions=[10,20,50],this.expandedPanels={},this.expandedAttributes={},this.itemId=parseInt(this.route.snapshot.paramMap.get("itemId"),10),this.versions$=new h.X(null),this.page$=new h.X(1),this.pageSize$=new h.X(this.pageSizeOptions[0]),this.compareWith$=new h.X("live"),this.historyItems$=(0,I.a)([this.versions$,this.page$,this.pageSize$,this.compareWith$]).pipe((0,C.U)(function(l){var p=(0,f.Z)(l,4);return function N(t,o,e,i){if(null==t||null==o||null==e||null==i)return null;var r=function $(t,o,e){return t.map(function(i){var a={changeSetId:i.ChangeSetId,attributes:S(i,o,e),historyId:i.HistoryId,timeStamp:i.TimeStamp,user:i.User,versionNumber:i.VersionNumber,isLastVersion:!o.some(function(r){return r.VersionNumber===i.VersionNumber+1})};return a})}(t.slice((o-1)*e,o*e),t,i);return r}(p[0],p[1],p[2],p[3])})),this.templateVars$=(0,I.a)([this.versions$,this.historyItems$,this.pageSize$,this.compareWith$]).pipe((0,C.U)(function(l){var p=(0,f.Z)(l,4),c=p[0];return{length:null==c?void 0:c.length,historyItems:p[1],pageSize:p[2],compareWith:p[3]}}))}return(0,A.Z)(o,[{key:"ngOnInit",value:function(){var i=this;this.versionsService.fetchVersions(this.itemId).subscribe(function(a){i.versions$.next(a)})}},{key:"ngOnDestroy",value:function(){this.versions$.complete(),this.page$.complete(),this.pageSize$.complete(),this.compareWith$.complete()}},{key:"closeDialog",value:function(){this.dialogRef.close()}},{key:"compareChange",value:function(i){this.compareWith$.next(i)}},{key:"panelExpandedChange",value:function(i,a){this.expandedPanels[a]=i}},{key:"attributeExpandedToggle",value:function(i,a){this.expandedAttributes[i+a]=!this.expandedAttributes[i+a]}},{key:"pageChange",value:function(i){var a=i.pageIndex+1;a!==this.page$.value&&(this.expandedPanels={},this.expandedAttributes={},this.page$.next(a));var r=i.pageSize;r!==this.pageSize$.value&&this.pageSize$.next(r)}},{key:"restore",value:function(i){var a=this;this.snackBar.open("Restoring previous version..."),this.versionsService.restore(this.itemId,i).subscribe(function(r){a.snackBar.open("Previous version restored. Will reload edit dialog",null,{duration:3e3}),a.dialogRef.close({refreshEdit:!0})})}}]),o}();return t.\u0275fac=function(e){return new(e||t)(n.Y36(b.so),n.Y36(z.gz),n.Y36(M.Z),n.Y36(E.ux))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-item-history"]],hostVars:1,hostBindings:function(e,i){2&e&&n.Ikx("className",i.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-description"],["class","compare-box",4,"ngIf"],[1,"dialog-component-content","fancy-scrollbar-light"],["multi","","class","history-tables",4,"ngIf"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],[1,"compare-box"],["appearance","standard","color","accent",1,"compare-box__dropdown"],["name","Scope",3,"value","selectionChange"],["value","previous"],["value","live"],["multi","",1,"history-tables"],[3,"expanded","expandedChange",4,"ngFor","ngForOf"],[3,"expanded","expandedChange"],["class","table-row",4,"ngFor","ngForOf"],[1,"row-actions"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"table-row"],[1,"table-row__main","row-main",3,"click"],[1,"row-main__type"],["class","table-row__details",4,"ngIf"],[1,"table-row__details"],["class","detail-row",4,"ngFor","ngForOf"],[1,"detail-row"],[1,"detail-row__value"],[3,"class",4,"ngIf"],[1,"history-new"],[1,"history-deleted","history-deleted__value"],["mat-raised-button","","color","accent",3,"click"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page"]],template:function(e,i){1&e&&(n.YNc(0,rn,16,5,"ng-container",0),n.ALo(1,"async")),2&e&&n.Q6J("ngIf",n.lcZ(1,1,i.templateVars$))},directives:[x.O5,b.uh,Q.lW,U.$,j.Hw,F.KE,Y.gD,k.ey,v.pp,x.sg,v.ib,v.yz,v.yK,v.u4,q.NW],pipes:[x.Ov,x.uU],styles:[".compare-box[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-end;height:40px}.compare-box__dropdown[_ngcontent-%COMP%]{width:192px;margin-top:-14px;font-size:14px;height:auto}.mat-accordion[_ngcontent-%COMP%]{display:block;padding:4px 0}.mat-expansion-panel-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{font-size:14px}.table-row__main[_ngcontent-%COMP%]{display:flex}.table-row__details[_ngcontent-%COMP%]{display:block}.row-main[_ngcontent-%COMP%]{cursor:pointer;padding:4px 0}.row-main__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.row-main__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-main__type[_ngcontent-%COMP%]{flex:0 0 auto;font-size:12px}.row-main__type[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:not(:last-of-type){margin-right:2px}.detail-row[_ngcontent-%COMP%]{display:flex;padding-bottom:4px;cursor:default}.detail-row__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.detail-row__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"]}),t}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.03.00/ng-edit/projects_ng-dialogs_src_app_item-history_item-history_component_ts.d527cc54057c24f3.js.map