"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts"],{9996:(Y,j,n)=>{n.d(j,{F:()=>S});var d=n(271),I=n(8873),P=n(7580),$=n(6443),g=n(4821);const x="admin/AppFiles/asset";let S=(()=>{class F{constructor(i,l,r){this.http=i,this.context=l,this.dnnContext=r}get(i,l,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(x),{params:{appId:this.context.appId,global:l,...this.templateIdOrPath(i,l,r)}}).pipe((0,d.T)(u=>{if("auto"===u.Type.toLocaleLowerCase())switch(u.Extension.toLocaleLowerCase()){case".cs":case".cshtml":u.Type="Razor";break;case".html":case".css":case".js":u.Type="Token"}return u}))}save(i,l,r,u){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(x),r,{params:{appId:this.context.appId,global:l,...this.templateIdOrPath(i,l,u)}})}getAll(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.context.appId,...i&&{mask:i}}}).pipe((0,d.T)(({Files:l})=>(l.forEach(r=>{r.Shared??=!1}),l)))}getWebApis(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/AppApiFiles"),{params:{appId:this.context.appId}}).pipe((0,d.T)(({files:i})=>(i.forEach(l=>{l.isShared??=!1,l.isCompiled??=!1}),i))).pipe((0,d.T)(i=>i.map(r=>{const u=r.path.lastIndexOf("/"),M=r.path.lastIndexOf("."),K=r.path.substring(0,u),O=r.path.substring(u+1,M);return{path:r.path,folder:K,name:O,isShared:r.isShared,endpointPath:r.endpointPath,isCompiled:r.isCompiled,edition:r.edition}})))}getWebApiDetails(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:i}})}getPredefinedTemplates(i,l){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:{...i&&{purpose:i},...l&&{type:l}}})}getPreview(i,l,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:i,templateKey:r,global:l}})}create(i,l,r){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:l,purpose:"auto",path:i,templateKey:r}})}templateIdOrPath(i,l,r){if(/^[0-9]*$/g.test(i)){const u=r.find(M=>M.EntityId?.toString()===i&&M.IsShared===l)?.Path;return{templateId:i,...null!=u&&{path:u}}}return{path:i}}static#t=this.\u0275fac=function(l){return new(l||F)(P.KVO($.Qq),P.KVO(I.o),P.KVO(g.ob))};static#e=this.\u0275prov=P.jDH({token:F,factory:F.\u0275fac})}return F})()},4029:(Y,j,n)=>{n.d(j,{g:()=>it});var d=n(4456),I=n(7941),P=n(5797),$=n(9999),g=n(3037),C=n(1817),x=n(271),y=n(8764),T=n(8473),A=n(819),b=n(1687),V=n(2645),F=n(4581);var i=n(6647),l=n(9452),r=n(1873),u=n(9996),M=n(3050),K=n(3176),O=n(316),N=n(4175),z=n(1134),U=n(7984),k=n(5060),B=n(5175),G=n(5944),W=n(3758),t=n(7580);let J=(()=>{class a{constructor(e,o){this.matInput=e,this.elementRef=o,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const o=e.toLocaleLowerCase();return"true"===o||"false"!==o&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU(U.fg),t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:a,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"},standalone:!0})}return a})();var H=n(5437);const L=a=>({disabled:a});function Q(a,h){if(1&a&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&a){const e=h.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function _(a,h){if(1&a&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&a){const e=h.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function q(a,h){if(1&a&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&a){const e=h.$implicit;t.Y8G("value",e.Key),t.R7$(),t.SpI(" ",e.Name," ")}}function tt(a,h){1&a&&(t.j41(0,"app-field-hint",16),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function et(a,h){1&a&&t.nrm(0,"mat-spinner",21)(1,"div",22)}function ot(a,h){if(1&a&&(t.j41(0,"div",23)(1,"label",24),t.EFF(2,"Preview"),t.k0s()(),t.j41(3,"pre",25),t.EFF(4),t.k0s()),2&a){const e=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(3,L,e.loadingPreview)),t.R7$(2),t.Y8G("ngClass",t.eq3(5,L,e.loadingPreview)),t.R7$(),t.JRh(e.preview)}}function at(a,h){if(1&a&&(t.j41(0,"div",20),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.R7$(),t.SpI(" ",e.previewError," ")}}function nt(a,h){if(1&a){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),t.EFF(4,"Create"),t.k0s(),t.j41(5,"span",3),t.EFF(6),t.k0s()()(),t.j41(7,"div",4)(8,"form",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"mat-form-field",9)(13,"mat-label"),t.EFF(14,"Platform"),t.k0s(),t.j41(15,"mat-select",10),t.Z7z(16,Q,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),t.EFF(21,"Purpose"),t.k0s(),t.j41(22,"mat-select",12),t.Z7z(23,_,2,2,"mat-option",11,t.fX1),t.k0s()()()(),t.j41(25,"div",13)(26,"mat-form-field",9)(27,"mat-label"),t.EFF(28,"Template"),t.k0s(),t.j41(29,"mat-select",14),t.Z7z(30,q,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(32,"div",13)(33,"mat-form-field",9)(34,"mat-label"),t.EFF(35,"Name"),t.k0s(),t.nrm(36,"input",15),t.k0s(),t.DNE(37,tt,2,1,"app-field-hint",16),t.k0s()(),t.j41(38,"div",17),t.DNE(39,et,2,0),t.j41(40,"button",18),t.bIt("click",function(){t.eBV(e);const m=t.XpG();return t.Njj(m.closeDialog())}),t.EFF(41,"Cancel"),t.k0s(),t.j41(42,"button",19),t.bIt("click",function(){t.eBV(e);const m=t.XpG();return t.Njj(m.confirm())}),t.EFF(43," Create "),t.k0s()(),t.DNE(44,ot,5,7)(45,at,2,1,"div",20),t.k0s()()()}if(2&a){const e=h,o=t.XpG();t.R7$(6),t.JRh(o.controls.finalName.value||(o.controls.folder.value?o.controls.folder.value.trim()+"/":"")),t.R7$(2),t.Y8G("formGroup",o.form),t.R7$(8),t.Dyx(e.platforms),t.R7$(7),t.Dyx(e.purposes),t.R7$(7),t.Dyx(e.templates),t.R7$(7),t.vxM(37,o.controls.name.touched&&null!=o.controls.name.errors&&o.controls.name.errors.required?37:-1),t.R7$(2),t.vxM(39,e.loadingPreview?39:-1),t.R7$(3),t.Y8G("disabled",!o.form.valid||e.loadingPreview||!e.previewValid),t.R7$(2),t.vxM(44,e.preview?44:-1),t.R7$(),t.vxM(45,!e.loadingPreview&&e.previewError?45:-1)}}let it=(()=>{class a extends K.${constructor(e,o){super(),this.dialogData=e,this.dialogRef=o,this.hostClass="dialog-component",this.all="All",this.sourceService=(0,H.d)(u.F)}ngOnInit(){this.templates$=new P.t([]),this.loadingPreview$=new P.t(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new d.J3({platform:new d.hs(this.all),purpose:new d.hs({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new d.hs(null,d.k0.required),name:new d.hs(this.dialogData.name??null,d.k0.required),finalName:new d.hs({value:null,disabled:!0}),folder:new d.hs({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscriptions.add((0,$.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,C.F)())]).subscribe(([e,o])=>{const m=e.find(p=>p.Key===o),f=this.dialogData.name?this.controls.name.value||this.dialogData.name:m?.SuggestedFileName??null;this.controls.name.value!==f&&this.controls.name.patchValue(f)})),this.subscriptions.add((0,$.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,C.F)()),this.controls.name.valueChanges.pipe((0,g.Z)(this.controls.name.value),(0,C.F)()),this.controls.folder.valueChanges.pipe((0,g.Z)(this.controls.folder.value),(0,C.F)())]).subscribe(([e,o,m,f])=>{const p=e.find(c=>c.Key===o);let s=null;m&&(f=f.trim(),m=M.SX.sanitizePath(m.trim()),s=`${f?`${f}/`:""}${m=`${p?.Prefix??""}${m}${p?.Suffix??""}${p?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==s&&this.controls.finalName.patchValue(s)}))}buildViewModel(){const e=this.templates$.pipe((0,x.T)(p=>{const s={[this.all]:this.all};return p.forEach(c=>{c.Platforms?.forEach(v=>{s[v]=v})}),Object.keys(s)})),o=this.templates$.pipe((0,x.T)(p=>{const s={[this.all]:this.all};return p.forEach(c=>{s[c.Purpose]=c.Purpose}),Object.keys(s)})),m=(0,$.z)([this.templates$,this.controls.platform.valueChanges.pipe((0,g.Z)(this.controls.platform.value),(0,C.F)()),this.controls.purpose.valueChanges.pipe((0,g.Z)(this.controls.purpose.value),(0,C.F)())]).pipe((0,x.T)(([p,s,c])=>p.filter(D=>(s===this.all||(D.Platforms?.includes(s)??!1))&&(c===this.all||D.Purpose===c))),(0,y.M)(p=>{if(!p.some(s=>s.Key===this.controls.templateKey.value)){const s=p[0]?.Key??null;this.controls.templateKey.value!==s&&this.controls.templateKey.patchValue(s)}})),f=(0,$.z)([this.controls.finalName.valueChanges.pipe((0,g.Z)(this.controls.finalName.value),(0,C.F)()),this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,C.F)())]).pipe(function Z(a,h=T.E,e){const o=(0,F.O)(a,h);return function S(a,h){return(0,A.N)((e,o)=>{const{leading:m=!0,trailing:f=!1}=h??{};let p=!1,s=null,c=null,v=!1;const D=()=>{c?.unsubscribe(),c=null,f&&(X(),v&&o.complete())},w=()=>{c=null,v&&o.complete()},R=E=>c=(0,V.Tg)(a(E)).subscribe((0,b._)(o,D,w)),X=()=>{if(p){p=!1;const E=s;s=null,o.next(E),!v&&R(E)}};e.subscribe((0,b._)(o,E=>{p=!0,s=E,(!c||c.closed)&&(m?X():R(E))},()=>{v=!0,(!(f&&p&&c)||c.closed)&&o.complete()}))})}(()=>o,e)}(100,T.E,{leading:!0,trailing:!0}),(0,y.M)(()=>{this.loadingPreview$.next(!0)}),(0,i.n)(([p,s])=>p&&s?(0,r.p)([this.sourceService.getPreview(p,this.dialogData.global,s),(0,F.O)(500)]).pipe((0,x.T)(([c])=>c)):(0,l.of)(void 0)),(0,y.M)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,$.z)([e,o,m,f,this.loadingPreview$]).pipe((0,x.T)(([p,s,c,v,D])=>({platforms:p,purposes:s,templates:c,loadingPreview:D,preview:v?.Preview,previewValid:v?.IsValid??!1,previewError:v?.Error})))}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU(I.Vh),t.rXU(I.CP))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(o,m){2&o&&t.Mr5("className",m.hostClass)},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-mat-form-field"],["formControlName","platform"],[3,"value"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],[1,"eav-preview-error"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"]],template:function(o,m){if(1&o&&(t.DNE(0,nt,46,7,"div",0),t.nI1(1,"async")),2&o){let f;t.vxM(0,(f=t.bMT(1,1,m.viewModel$))?0:-1,f)}},dependencies:[d.YN,d.qT,d.me,d.BC,d.cb,d.YS,d.X1,d.j4,d.JD,G.RG,G.rl,G.nJ,B.Ve,B.VO,k.wT,k.Sy,U.fS,U.fg,z.D6,z.LG,N.Hl,N.$z,O.YU,O.Jj,W.F,J],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}return a})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.02/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts.6b85cb3d7b1a46ee.js.map