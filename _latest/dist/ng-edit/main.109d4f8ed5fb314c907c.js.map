{"version":3,"sources":["../edit/shared/store/ngrx-data/base-data.service.ts","../edit/shared/store/ngrx-data/adam-cache.service.ts","../edit/shared/store/ngrx-data/content-type-item.service.ts","../edit/shared/store/ngrx-data/content-type.service.ts","../edit/shared/store/ngrx-data/entity-cache.service.ts","../edit/shared/store/ngrx-data/entity-metadata.ts","../edit/shared/store/ngrx-data/feature.service.ts","../edit/shared/store/ngrx-data/global-config.service.ts","../edit/shared/store/ngrx-data/input-type.service.ts","../edit/shared/store/ngrx-data/item.service.ts","../edit/shared/store/ngrx-data/language-instance.service.ts","../edit/shared/store/ngrx-data/language.service.ts","../edit/shared/store/ngrx-data/link-cache.service.ts","../edit/shared/store/ngrx-data/publish-status.service.ts","../edit/shared/store/ngrx-data/string-query-cache.service.ts","./src/app/shared/constants/session.constants.ts","../edit/eav-material-controls/localization/translate-menu/translate-menu.helpers.ts","./src/environments/environment.ts","../edit/field-logic/field-logic-manager.ts","../edit/shared/models/eav/eav-content-type-attribute.ts","../edit/shared/models/eav/eav-content-type.ts","../edit/shared/models/eav/eav-dimension.ts","../edit/shared/models/eav/eav-entity-attributes.ts","../edit/shared/models/eav/eav-entity.ts","../edit/shared/models/eav/eav-item.ts","../edit/shared/models/eav/eav-value.ts","../edit/shared/models/eav/eav-values.ts","./src/app/shared/constants/dialog-types.constants.ts","./src/app/shared/services/context.ts","../edit/shared/constants/component-metadata.constants.ts","../edit/shared/constants/features-guids.constants.ts","../edit/shared/constants/translation-link.constants.ts","../edit/shared/constants/localization.constants.ts","../edit/shared/helpers/url.helpers.ts","./src/app/shared/helpers/update-env-vars-from-dialog-settings.helper.ts","../edit/shared/constants/wrappers.constants.ts","../edit/edit.matcher.ts","../edit/shared/helpers/dropzone-dragging.helper.ts","../edit/shared/helpers/field-mask.helper.ts","../edit/shared/helpers/fields-settings.helpers.ts","../edit/shared/helpers/formula.helpers.ts","../edit/shared/helpers/general.helpers.ts","../edit/shared/helpers/input-field.helpers.ts","../edit/shared/helpers/localization.helpers.ts","../edit/eav-material-controls/page-picker/page-picker.component.html","../edit/eav-material-controls/page-picker/page-picker.component.ts","../edit/eav-material-controls/page-picker/page-picker.helpers.ts","../edit/shared/helpers/page-picker.helper.ts","../edit/shared/services/assets.service.ts","../edit/shared/services/eav.service.ts","../edit/eav-item-dialog/multi-item-edit-form/multi-item-edit-form.helpers.ts","../edit/shared/services/edit-initializer.service.ts","../edit/shared/services/edit-routing.service.ts","../edit/shared/services/entity.service.ts","../edit/eav-material-controls/validators/validation-helper.ts","../edit/shared/services/formula-designer.service.ts","../edit/shared/services/fields-settings.service.ts","../edit/shared/services/fields-translate.service.ts","../edit/shared/services/file-type.service.ts","../edit/shared/services/forms-state.service.ts","../edit/shared/services/load-icons.service.ts","../edit/assets/icons/2sxc/Material-Icon-Adam-48.svg","../edit/assets/icons/2sxc/Material-Icon-Adam-48-filled.svg","../edit/assets/icons/font-awesome/draft-branch.svg","../edit/assets/icons/font-awesome/file.svg","../edit/assets/icons/font-awesome/file-archive.svg","../edit/assets/icons/font-awesome/file-audio.svg","../edit/assets/icons/font-awesome/file-code.svg","../edit/assets/icons/font-awesome/file-excel.svg","../edit/assets/icons/font-awesome/file-image.svg","../edit/assets/icons/font-awesome/file-pdf.svg","../edit/assets/icons/font-awesome/file-powerpoint.svg","../edit/assets/icons/font-awesome/file-text.svg","../edit/assets/icons/font-awesome/file-video.svg","../edit/assets/icons/font-awesome/file-word.svg","../edit/assets/icons/font-awesome/folder.svg","../edit/assets/icons/font-awesome/folder-plus.svg","../edit/assets/icons/font-awesome/sitemap.svg","../edit/shared/services/query.service.ts","../edit/shared/services/scripts-loader.service.ts","../edit/eav-material-controls/validators/custom-validators.ts","./src/app/content-type-fields/constants/input-type.constants.ts","./src/app/shared/constants/eav.constants.ts","./src/app/shared/helpers/console-log-angular.helper.ts","../edit/shared/models/formula.models.ts","../edit/shared/models/publish-mode.models.ts","./src/app/shared/helpers/url-prep.helper.ts","../edit/shared/store/reducers/index.ts","./src/app/app-routing.module.ts","./src/app/app.component.ts","./src/app/assets/icons/star-24px.svg","./src/app/assets/icons/code-curly.svg","./src/app/app.component.html","./src/app/params-init.factory.ts","./src/app/shared/interceptors/handle-errors.interceptor.ts","./src/app/shared/interceptors/set-headers.interceptor.ts","./src/app/app.module.ts","./src/main.ts","./$_lazy_route_resource lazy namespace object"],"names":["cacheName","serviceElementsFactory","cache$","BehaviorSubject","entities$","subscribe","items","next","loadPrefetch","prefetchAdams","snapshots","Object","entries","map","Guid","Attributes","this","upsertManyInCache","getAdamSnapshot","entityGuid","fieldName","value","find","adamSnapshot","AdamCacheService","addContentTypeItems","contentTypeItems1","contentTypeItems","convertMany","getContentTypeItem","guid","contentTypeItem","getContentTypeItems","guids","filter","includes","ContentTypeItemService","addContentTypes","contentTypes1","contentTypes","contentType1","convert","addManyToCache","getContentType","id","contentType","Id","getContentType$","pipe","distinctUntilChanged","ContentTypeService","loadEntities","entities","getEntities$","asObservable","entity","Value","arraysEqual","getEntities","getEntity","EntityCacheService","entityConfig","entityMetadata","GlobalConfig","Item","selectId","item","Entity","Feature","Language","language","key","LanguageInstance","languageInstance","formId","ContentType","ContentTypeItem","InputType","inputType","Type","PublishStatus","publishStatus","Prefetch","_guid","EntityCache","AdamCache","LinkCache","link","StringQueryCache","pluralNames","loadFeatures","features","addAllToCache","isFeatureEnabled","feature","enabled","FeatureService","snackBar","initial","debugEnabled","sessionStorage","getItem","addOneToCache","getDebugEnabled$","configs","toggleDebugEnabled","oldConfig","newConfig","updateOneInCache","open","duration","GlobalConfigService","addInputTypes","inputTypes","getInputType","type","getInputTypes","getInputTypes$","InputTypeService","loadItems","items1","item1","updateItemId","itemData","keys","entityId","oldItem","Header","EntityId","newItem","addItemAttributeValue","attributeKey","newValue","currentLanguage","isReadOnly","attributeType","isTransaction","transactionItem","newEavValue","create","addAttributeValue","updateItemAttributeValue","defaultLanguage","updateAttributeValue","updateItemAttributesValues","newValues","oldValues","values","hasOwnProperty","translate","changes","getFormChanges","updateAttributesValues","addItemAttributeDimension","shareWithLanguage","addAttributeDimension","removeItemAttributeDimension","removeAttributeDimension","updateItemHeader","header","getItemAttributes","getItemAttributes$","getItem$","getItemHeader$","getItems","entityGuids","getItems$","setDefaultValue","ctAttribute","settings","languages","defaultValue","parseDefaultValue","Name","undefined","getBestValue","Strict","length","DisableI18n","ItemService","addLanguageInstance","uiLanguage","hideHeader","removeLanguageInstance","removeOneFromCache","setCurrentLanguage","newLanguage","getCurrentLanguage","getCurrentLanguage$","languageInstances","getDefaultLanguage","getDefaultLanguage$","getHideHeader$","updateHideHeader","LanguageInstanceService","loadLanguages","getLanguages","getLanguages$","LanguageService","prefetchLinks","prefetchAdam","links","push","linkInfo","prefetchFields","adamLinks","adamToLinks","loadAdam","loadLink","trim","toLocaleLowerCase","Adam","upsertOneInCache","getLinkInfo","linkCache","IsFolder","ReferenceId","Url","LinkCacheService","setPublishStatus","removePublishStatus","getPublishStatus","getPublishStatus$","publishStatuses","setPublishMode","publishMode","eavService","eavConfig","versioningOptions","DraftShouldBranch","Branch","IsPublished","Show","getPublishMode$","Hide","PublishStatusService","StringQueryCacheService","prefix","keyZoneId","keyRequestToken","keyTabId","keyContentBlockId","keyModuleId","keyAppId","keyDebug","keyDialog","keyContentType","keyItems","keyPartOfPage","keyPublishing","keyFilters","keyPipelineId","keyApi","keyUrl","keyIsShared","getTranslationStateClass","linkType","MissingDefaultLangValue","Translate","LinkCopyFrom","DontTranslate","LinkReadOnly","LinkReadWrite","calculateSharedInfoMessage","dimensions","TranslateMenuHelpers","calculateShortDimensions","result","calculateEditAndReadDimensions","editableDimensions","readOnlyDimensions","infoMessage","editableExist","readOnlyExist","join","dimensionsMap","shortCurrentLanguage","slice","indexOf","forEach","dimension","shortNoReadOnly","replace","shortDimension","environment","production","logics","singleton","window","eavFieldLogicManager","FieldLogicManager","add","logic","name","get","inputTypeName","convertOne","attribute1","metadata","Metadata","mergeSettings","IsTitle","Settings","attributes1","EavContentTypeAttribute","attributes","Description","Scope","atributes","type1","metadataItems","merged","copy","Values","entity1","Owner","Version","For","entities1","EavEntity","Dimensions","value1","split","lang","EavDimension","Zone","AppImport","App","ContentItems","Edit","ItemHistory","Develop","PipelineDesigner","Replace","InstanceList","parentContext","ready","parent","contextId","_zoneId","routeNum","zoneId","_appId","appId","_rvt","requestToken","_tabId","tabId","_contentBlockId","contentBlockId","_moduleId","moduleId","init","route","routeSnapshot","snapshot","clearCachedValues","initRoot","sessionNumber","Error","num","parseInt","isNaN","paramName","substring","paramMap","Context","componentMetadataKey","FeaturesConstants","TranslationLinkConstants","BestValueModes","stripNonUrlCharacters","controlValue","allowPath","trimEnd","rexSeparators","latinizeText","toLowerCase","input","latinMap","Á","Ă","Ắ","Ặ","Ằ","Ẳ","Ẵ","Ǎ","Â","Ấ","Ậ","Ầ","Ẩ","Ẫ","Ä","Ǟ","Ȧ","Ǡ","Ạ","Ȁ","À","Ả","Ȃ","Ā","Ą","Å","Ǻ","Ḁ","Ⱥ","Ã","Ꜳ","Æ","Ǽ","Ǣ","Ꜵ","Ꜷ","Ꜹ","Ꜻ","Ꜽ","Ḃ","Ḅ","Ɓ","Ḇ","Ƀ","Ƃ","Ć","Č","Ç","Ḉ","Ĉ","Ċ","Ƈ","Ȼ","Ď","Ḑ","Ḓ","Ḋ","Ḍ","Ɗ","Ḏ","ǲ","ǅ","Đ","Ƌ","Ǳ","Ǆ","É","Ĕ","Ě","Ȩ","Ḝ","Ê","Ế","Ệ","Ề","Ể","Ễ","Ḙ","Ë","Ė","Ẹ","Ȅ","È","Ẻ","Ȇ","Ē","Ḗ","Ḕ","Ę","Ɇ","Ẽ","Ḛ","Ꝫ","Ḟ","Ƒ","Ǵ","Ğ","Ǧ","Ģ","Ĝ","Ġ","Ɠ","Ḡ","Ǥ","Ḫ","Ȟ","Ḩ","Ĥ","Ⱨ","Ḧ","Ḣ","Ḥ","Ħ","Í","Ĭ","Ǐ","Î","Ï","Ḯ","İ","Ị","Ȉ","Ì","Ỉ","Ȋ","Ī","Į","Ɨ","Ĩ","Ḭ","Ꝺ","Ꝼ","Ᵹ","Ꞃ","Ꞅ","Ꞇ","Ꝭ","Ĵ","Ɉ","Ḱ","Ǩ","Ķ","Ⱪ","Ꝃ","Ḳ","Ƙ","Ḵ","Ꝁ","Ꝅ","Ĺ","Ƚ","Ľ","Ļ","Ḽ","Ḷ","Ḹ","Ⱡ","Ꝉ","Ḻ","Ŀ","Ɫ","ǈ","Ł","Ǉ","Ḿ","Ṁ","Ṃ","Ɱ","Ń","Ň","Ņ","Ṋ","Ṅ","Ṇ","Ǹ","Ɲ","Ṉ","Ƞ","ǋ","Ñ","Ǌ","Ó","Ŏ","Ǒ","Ô","Ố","Ộ","Ồ","Ổ","Ỗ","Öe","Ȫ","Ȯ","Ȱ","Ọ","Ő","Ȍ","Ò","Ỏ","Ơ","Ớ","Ợ","Ờ","Ở","Ỡ","Ȏ","Ꝋ","Ꝍ","Ō","Ṓ","Ṑ","Ɵ","Ǫ","Ǭ","Ø","Ǿ","Õ","Ṍ","Ṏ","Ȭ","Ƣ","Ꝏ","Ɛ","Ɔ","Ȣ","Ṕ","Ṗ","Ꝓ","Ƥ","Ꝕ","Ᵽ","Ꝑ","Ꝙ","Ꝗ","Ŕ","Ř","Ŗ","Ṙ","Ṛ","Ṝ","Ȑ","Ȓ","Ṟ","Ɍ","Ɽ","Ꜿ","Ǝ","Ś","Ṥ","Š","Ṧ","Ş","Ŝ","Ș","Ṡ","Ṣ","Ṩ","Ť","Ţ","Ṱ","Ț","Ⱦ","Ṫ","Ṭ","Ƭ","Ṯ","Ʈ","Ŧ","Ɐ","Ꞁ","Ɯ","Ʌ","Ꜩ","Ú","Ŭ","Ǔ","Û","Ṷ","Ü","Ǘ","Ǚ","Ǜ","Ǖ","Ṳ","Ụ","Ű","Ȕ","Ù","Ủ","Ư","Ứ","Ự","Ừ","Ử","Ữ","Ȗ","Ū","Ṻ","Ų","Ů","Ũ","Ṹ","Ṵ","Ꝟ","Ṿ","Ʋ","Ṽ","Ꝡ","Ẃ","Ŵ","Ẅ","Ẇ","Ẉ","Ẁ","Ⱳ","Ẍ","Ẋ","Ý","Ŷ","Ÿ","Ẏ","Ỵ","Ỳ","Ƴ","Ỷ","Ỿ","Ȳ","Ɏ","Ỹ","Ź","Ž","Ẑ","Ⱬ","Ż","Ẓ","Ȥ","Ẕ","Ƶ","Ĳ","Œ","ᴀ","ᴁ","ʙ","ᴃ","ᴄ","ᴅ","ᴇ","ꜰ","ɢ","ʛ","ʜ","ɪ","ʁ","ᴊ","ᴋ","ʟ","ᴌ","ᴍ","ɴ","ᴏ","ɶ","ᴐ","ᴕ","ᴘ","ʀ","ᴎ","ᴙ","ꜱ","ᴛ","ⱻ","ᴚ","ᴜ","ᴠ","ᴡ","ʏ","ᴢ","á","ă","ắ","ặ","ằ","ẳ","ẵ","ǎ","â","ấ","ậ","ầ","ẩ","ẫ","ä","ǟ","ȧ","ǡ","ạ","ȁ","à","ả","ȃ","ā","ą","ᶏ","ẚ","å","ǻ","ḁ","ⱥ","ã","ꜳ","æ","ǽ","ǣ","ꜵ","ꜷ","ꜹ","ꜻ","ꜽ","ḃ","ḅ","ɓ","ḇ","ᵬ","ᶀ","ƀ","ƃ","ɵ","ć","č","ç","ḉ","ĉ","ɕ","ċ","ƈ","ȼ","ď","ḑ","ḓ","ȡ","ḋ","ḍ","ɗ","ᶑ","ḏ","ᵭ","ᶁ","đ","ɖ","ƌ","ı","ȷ","ɟ","ʄ","ǳ","ǆ","é","ĕ","ě","ȩ","ḝ","ê","ế","ệ","ề","ể","ễ","ḙ","ë","ė","ẹ","ȅ","è","ẻ","ȇ","ē","ḗ","ḕ","ⱸ","ę","ᶒ","ɇ","ẽ","ḛ","ꝫ","ḟ","ƒ","ᵮ","ᶂ","ǵ","ğ","ǧ","ģ","ĝ","ġ","ɠ","ḡ","ᶃ","ǥ","ḫ","ȟ","ḩ","ĥ","ⱨ","ḧ","ḣ","ḥ","ɦ","ẖ","ħ","ƕ","í","ĭ","ǐ","î","ï","ḯ","ị","ȉ","ì","ỉ","ȋ","ī","į","ᶖ","ɨ","ĩ","ḭ","ꝺ","ꝼ","ᵹ","ꞃ","ꞅ","ꞇ","ꝭ","ǰ","ĵ","ʝ","ɉ","ḱ","ǩ","ķ","ⱪ","ꝃ","ḳ","ƙ","ḵ","ᶄ","ꝁ","ꝅ","ĺ","ƚ","ɬ","ľ","ļ","ḽ","ȴ","ḷ","ḹ","ⱡ","ꝉ","ḻ","ŀ","ɫ","ᶅ","ɭ","ł","ǉ","ſ","ẜ","ẛ","ẝ","ḿ","ṁ","ṃ","ɱ","ᵯ","ᶆ","ń","ň","ņ","ṋ","ȵ","ṅ","ṇ","ǹ","ɲ","ṉ","ƞ","ᵰ","ᶇ","ɳ","ñ","ǌ","ó","ŏ","ǒ","ô","ố","ộ","ồ","ổ","ỗ","ö","ȫ","ȯ","ȱ","ọ","ő","ȍ","ò","ỏ","ơ","ớ","ợ","ờ","ở","ỡ","ȏ","ꝋ","ꝍ","ⱺ","ō","ṓ","ṑ","ǫ","ǭ","ø","ǿ","õ","ṍ","ṏ","ȭ","ƣ","ꝏ","ɛ","ᶓ","ɔ","ᶗ","ȣ","ṕ","ṗ","ꝓ","ƥ","ᵱ","ᶈ","ꝕ","ᵽ","ꝑ","ꝙ","ʠ","ɋ","ꝗ","ŕ","ř","ŗ","ṙ","ṛ","ṝ","ȑ","ɾ","ᵳ","ȓ","ṟ","ɼ","ᵲ","ᶉ","ɍ","ɽ","ↄ","ꜿ","ɘ","ɿ","ß","ś","ṥ","š","ṧ","ş","ŝ","ș","ṡ","ṣ","ṩ","ʂ","ᵴ","ᶊ","ȿ","ɡ","ᴑ","ᴓ","ᴝ","ť","ţ","ṱ","ț","ȶ","ẗ","ⱦ","ṫ","ṭ","ƭ","ṯ","ᵵ","ƫ","ʈ","ŧ","ᵺ","ɐ","ᴂ","ǝ","ᵷ","ɥ","ʮ","ʯ","ᴉ","ʞ","ꞁ","ɯ","ɰ","ᴔ","ɹ","ɻ","ɺ","ⱹ","ʇ","ʌ","ʍ","ʎ","ꜩ","ú","ŭ","ǔ","û","ṷ","ü","ǘ","ǚ","ǜ","ǖ","ṳ","ụ","ű","ȕ","ù","ủ","ư","ứ","ự","ừ","ử","ữ","ȗ","ū","ṻ","ų","ᶙ","ů","ũ","ṹ","ṵ","ᵫ","ꝸ","ⱴ","ꝟ","ṿ","ʋ","ᶌ","ⱱ","ṽ","ꝡ","ẃ","ŵ","ẅ","ẇ","ẉ","ẁ","ⱳ","ẘ","ẍ","ẋ","ᶍ","ý","ŷ","ÿ","ẏ","ỵ","ỳ","ƴ","ỷ","ỿ","ȳ","ẙ","ɏ","ỹ","ź","ž","ẑ","ʑ","ⱬ","ż","ẓ","ȥ","ẕ","ᵶ","ᶎ","ʐ","ƶ","ɀ","ﬀ","ﬃ","ﬄ","ﬁ","ﬂ","ĳ","œ","ﬆ","ₐ","ₑ","ᵢ","ⱼ","ₒ","ᵣ","ᵤ","ᵥ","ₓ","a","readQueryStringParameters","url","queryParams","f","decodeURIComponent","getUrlParams","qs","tokens","params","re","exec","replaceUrlParam","paramValue","pattern","RegExp","search","getUrlPrefix","area","systemRoot","portalRoot","appRoot","endsWith","calculatePathFromRoot","lastChild","firstChild","pathFromRoot","path","urlSegment","UpdateEnvVarsFromDialogSettings","appContext","includedApiRoot","Api","old2sxcHeader","$2sxc","env","new2sxcHeader","appApi","load","WrappersConstants","editRoot","hasDetails","hasUpdate","posParams","detailsEntityGuid","detailsFieldId","updateEntityGuid","updateFieldId","consumed","refreshEditRoot","edit","refreshEdit","zone","eventListeners","attach","htmlEl","runOutsideAngular","dragoverListener","timeoutsArray","clearTimeout","splice","clearTimeouts","windowBodyTimeouts","document","body","classList","draggingClass","dropListener","remove","addEventListener","passive","element","listener","detach","removeEventListener","mask","model","changeEvent","overloadPreCleanValues","fields","findFields","unwrapField","subscriptions","fieldList","preClean","watchAllFields","resolve","e","i","replaceValue","cleaned","matches","match","staticName","onChange","maybeNew","field","valueSub","valueChanges","destroy","subscription","unsubscribe","findDisableTranslation","attributeValues","translationExistsInDefault","eavValues","getContentTypeTitle","label","getValueOrDefault","Label","error","findIsLastInGroup","attribute","index","findIndex","EmptyDefault","getDisabledBecauseTranslations","disableTranslation","isEditableTranslationExist","isReadonlyTranslationExist","getTranslationState","infoLabel","editableTranslationExists","readonlyTranslationExists","getValueTranslation","state","getTranslationStateCore","editableElements","buildFormulaFunction","formula","cleanFormula","startsWith","Function","objectsEqual","x","y","obj1","obj2","keys1","keys2","every","key1","oldValue","Array","isArray","GeneralHelpers","toggleInArray","array","getContentTypeId","ContentTypeName","getInputTypeNames","calculatedInputType","calculateInputType","isExternal","AngularAssets","getWrappers","CollapsibleWrapper","wrappers","HiddenWrapper","EntityDefault","StringDropdownQuery","EntityQuery","EntityContentBlocks","LocalizationWrapper","AllowMultiValue","EntityExpandableWrapper","DropzoneWrapper","ExpandableWrapper","AdamAttachWrapper","DefaultValue","Prefill","BooleanDefault","BooleanTristate","DatetimeDefault","Date","toJSON","NumberDefault","Number","JSON","stringify","parse","isValueEmpty","emptyEntityField","createMode","translation","translationDefault","allAttributesValues","languageKey","LocalizationHelpers","eavValue","d","isEditableOrReadonlyTranslationExist","c","updateAttribute","oldAttributes","newAttributes","attributeCopy","allAttributes","updateValues","eavAttributes","newItemValue","newAttribute","updateValue","existingLanguageKey","newLanguageValue","attributeValue","newDimensionValue","existingDimensionValue","concat","validDimensions","some","mode","bestDimensions","bestValue","findValueForDimensions","dialogData","dialogRef","queryService","ngOnInit","selected","parseSelectedPageId","toggled","filterText$","searchItems$","tree$","filteredSearch$","combineLatest","filterText","templateVars$","filteredSearch","tree","fetchPages","ngOnDestroy","complete","setFilter","select","pageId","closeDialog","toggle","page","toString","close","getAvailableEntities","query","data","pages","searchItems","Path","buildPageSearch","children","parentId","ParentId","broken","buildPageTree","console","instant","fieldValue","group","controls","config","PagePickerComponent","dialog","viewContainerRef","changeDetectorRef","callback","autoFocus","width","afterClosed","take","markForCheck","webApiAppFilesAll","webApiAppFilesRoot","webApiAppFile","webApiAppFileCreate","webApiExplorer","http","dnnContext","getAll","global","apiUrl","withSubfolders","post","AssetsService","webApiEditRoot","context","setEavConfig","editDialogContext","isParentDialog","itemGuids","isCopy","enableHistory","Current","langPri","Primary","langs","All","partOfPage","Site","location","pathname","getVersioningOptions","fetchFormData","saveFormData","publishing","show","hide","branch","publish","EavService","alphabetCompare","b","itemService","inputTypeService","contentTypeItemService","contentTypeService","featureService","publishStatusService","languageService","languageInstanceService","entityCacheService","adamCacheService","linkCacheService","loaded$","form","editItems","formData","setMissingValues","Math","floor","random","editDialogCount","calculateIsParentDialog","Items","InputTypes","ContentTypeItems","ContentTypes","Features","Entities","Links","DuplicateEntity","history","isoLangCode","use","sortedLanguages","primaryLangKey","primaryLang","sameLangs","otherLangs","sort","sortLanguages","switchToDefault","contentTypeId","fieldSettings","firstValue","Default","noLanguageValue","defaultLanguageValue","message","EditInitializerService","router","childFormResult$","Subscription","Subject","initHideHeader","initChildFormResult","refreshOnChildVersionsClosed","isExpanded","fieldId","fieldIndex","isExpanded$","childFormResult","childResult","childFormClosed","expand","componentTag","oldEditUrl","newEditUrl","currentUrl","lastIndex","lastIndexOf","newUrl","navigate","formUrl","relativeTo","events","event","startWith","pairwise","editResult","getCurrentNavigation","extras","formResult","versionsResult","navigateUrl","EditRoutingService","webApiEntityRoot","webApiEntityList","contentTypeName","entitiesFilter","reactiveEntities","p","switchMap","share","delete","force","EntityService","isRequired","VisibleInEditUI","Required","getValidators","validators","HyperlinkLibrary","required","ValidationRegExJavaScript","Decimals","validateDecimals","Max","max","Min","min","customFormulas","customFormulaResults$","getFormula","upsertFormula","existing","deleteFormula","formulaIndex","results","resultIndex","r","newResults","upsertFormulaResult","isError","newResult","getFormulaResult$","FormulaDesignerService","formulaDesignerService","valueFormulaCounter","maxValueFormulaCycles","formulaErrorCounters","maxFormulaErrors","contentTypeSettings$","fieldsProps$","forceSettings$","contentType$","itemHeader$","currentLanguage$","defaultLanguage$","itemHeader","ctSettings","EditInstructions","ListInstructions","Notes","Icon","Link","_itemTitle","_slotCanBeEmpty","Group","SlotCanBeEmpty","_slotIsEmpty","SlotIsEmpty","itemAttributes$","inputTypes$","itemAttributes","formValues","fieldsProps","formulaUpdates","Placeholder","Disabled","DisableTranslation","getFormulaContext","formulaItems","Calculations","formulaVisible","runFormula","Visible","formulaRequired","formulaEnabled","Enabled","slotIsEmpty","fixed","update","formulaValue","valuesNotEqual","initialSettings","initialDisabled","fieldTranslation","constants","angularAssets","isLastInGroup","translationState","getContentTypeSettings","getContentTypeSettings$","getFieldsProps","getFieldsProps$","getFieldSettings","getFieldSettings$","fieldsSettings","getFieldValidation$","getTranslationState$","forceSettings","ctAttributes","languageName","l","culture","code","current","customFormula","formulaFn","formulaItem","Target","Formula","counter","count","FieldsSettingsService","fieldsSettingsService","isTranslationDisabled","dontTranslate","copyFrom","copyFromLanguageKey","attributeValueTranslation","linkReadOnly","linkWithLanguageKey","linkReadWrite","translateMany","translateable","dontTranslateMany","FieldsTranslateService","defaultIcon","checkImgRegEx","customExtensions","doc","docx","xls","xlsx","ppt","pptx","pdf","mp3","avi","mpg","mpeg","mov","mp4","zip","rar","txt","html","css","xml","xsl","matExtensions","vcf","getExtension","filename","getIconClass","ext","isKnownType","isImage","test","FileTypeService","formsValid$","formsDirty$","formsValid","formsDirty","getFormValid","setFormValid","isValid","allValid","valid","setFormDirty","isDirty","anyDirty","dirty","FormsStateService","matIconRegistry","domSanitizer","icons","apple","appleFilled","file","folder","sitemap","addSvgIconLiteral","bypassSecurityTrustHtml","LoadIconsService","queryUrl","includeGuid","hasParams","paramsLower","hasAppId","urlParams","Guids","QueryService","FileTypeConstants","loadedFiles","scripts","sortedFiles","sortByType","insertToDom","cssFiles","jsFiles","script","resolveSpecialPaths","loaded","domEl","CSS","JS","files","increment","sxcVersion","loadedFile","createElement","rel","href","src","querySelector","appendChild","ScriptsLoaderService","onlySimpleUrlChars","control","decimals","validateAdam","adamItems","StringDefault","StringUrlPath","StringDropdown","StringFontIconPicker","StringTemplatePicker","StringWysiwyg","HyperlinkDefault","ExternalWebComponent","CustomGPS","CustomJsonEditor","CustomDefault","OldTypeDropdown","OldTypeWysiwyg","OldTypeDefault","StringWysiwygTinymce","StringWysiwygAdv","StringWysiwygDnn","DefaultSuffix","eavConstants","target","app","cmsObject","keyTypes","string","number","scopes","default","template","permissions","resources","pipelineDesigner","dataSourceDifficulties","advanced","outDataSource","EntityGuid","In","PartAssemblyAndType","PrimaryType","VisualDesignerData","Top","Left","Width","defaultPipeline","dataSources","streamWiring","From","Out","To","testParameters","consoleLogAngular","groupCollapsed","optionalParams","trace","groupEnd","FormulaTypes","PublishModeConstants","convertFormToUrl","Parent","innerItem","Field","Add","Index","paramEncode","createForSuffix","mdFor","Singleton","String","keyType","metaValue","targetType","groupItem","Part","convertUrlToForm","options","option","innerItemParams","prefillParams","paramDecode","editItem","addItem","newParams","forParams","forIntro","forValue","forTarget","copyParams","groupParams","text","metaReducers","reducer","action","reducers","appRoutes","loadChildren","then","m","AppsManagementModule","title","ImportAppModule","AppAdministrationModule","CodeEditorModule","VisualQueryModule","ReplaceContentModule","ManageContentListModule","ContentItemsModule","ContentTypeFieldsModule","ItemHistoryModule","matcher","EditModule","RefreshEditModule","ContentExportModule","ContentImportModule","PermissionsModule","AppRoutingModule","forRoot","el","titleService","activatedRoute","preConfigure","loadFonts","appTitle","getTitle","child","setTitle","setDefaultFontSetClass","star","AppComponent","paramsInitFactory","injector","log","jsInfo","eavKeys","hash","alert","removeItem","setItem","urlHash","queryParametersFromUrl","historyItems","pipelineId","replaceItems","groupItems","totalPopup","rvt","api","excludedUrls","intercept","req","handle","catchError","checkIfExcluded","showDetailedHttpError","throwError","infoText","status","srvResp","msg","Message","msgDet","MessageDetail","ExceptionMessage","HandleErrorsInterceptor","modified","FormData","clone","setHeaders","SetHeadersInterceptor","AppModule","provide","useFactory","deps","multi","useClass","runtimeChecks","strictStateImmutability","strictActionImmutability","instrument","maxAge","bootstrapModule","catch","err","webpackEmptyAsyncContext","Promise","module","exports"],"mappings":"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,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,KAAMC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,QAAI,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,KAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,OAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC7FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,KAAMC,SAAG,IAAKC,SAAG,KAC7FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC7FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,OAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IACnBC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,KAAMC,OAAG,KAAMC,SAAG,KAAMC,SAAG,KAAMC,SAAG,KAAMC,SAAG,KAAMC,SAAG,KAAMC,SAAG,KAC1FC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,KAAMC,SAAG,KAAMC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC7FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,OAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,OAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,KAAMC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,KAAMC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC9FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC7FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC5FC,SAAG,KAAMC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,OAAG,KAAMC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC7FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,OAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAC3FC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC,SAAG,IAAKC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","file":"main.109d4f8ed5fb314c907c.js","sourcesContent":["import { EntityCollectionServiceBase, EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n/**\r\n * Creates BehaviorSubject for cached data to be accessible in both synchronous and asynchronous manner with cache$.\r\n * WARNING! Do not use entities$\r\n */\r\nexport class BaseDataService<T> extends EntityCollectionServiceBase<T> {\r\n  cache$: BehaviorSubject<T[]>;\r\n\r\n  constructor(cacheName: string, serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super(cacheName, serviceElementsFactory);\r\n\r\n    this.cache$ = new BehaviorSubject<T[]>([]);\r\n    // doesn't need to be completed because store services are singletons that live as long as the browser tab is open\r\n    this.entities$.subscribe(items => {\r\n      this.cache$.next(items);\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { AdamItem } from '../../../../edit-types';\r\nimport { PrefetchAdams } from '../../../eav-item-dialog/multi-item-edit-form/multi-item-edit-form.models';\r\nimport { AdamSnapshot } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AdamCacheService extends BaseDataService<AdamSnapshot> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('AdamCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadPrefetch(prefetchAdams: PrefetchAdams): void {\r\n    if (prefetchAdams == null) { return; }\r\n\r\n    const snapshots = Object.entries(prefetchAdams).map(([entityGuid, attributes]) => {\r\n      const snapshot: AdamSnapshot = {\r\n        Guid: entityGuid,\r\n        Attributes: attributes,\r\n      };\r\n      return snapshot;\r\n    });\r\n    this.upsertManyInCache(snapshots);\r\n  }\r\n\r\n  getAdamSnapshot(entityGuid: string, fieldName: string): AdamItem[] {\r\n    return this.cache$.value.find(adamSnapshot => adamSnapshot.Guid === entityGuid)?.Attributes[fieldName];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { EavEntity } from '../../models/eav';\r\nimport { Entity1 } from '../../models/json-format-v1';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ContentTypeItemService extends BaseDataService<EavEntity> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('ContentTypeItem', serviceElementsFactory);\r\n  }\r\n\r\n  addContentTypeItems(contentTypeItems1: Entity1[]): void {\r\n    const contentTypeItems = EavEntity.convertMany(contentTypeItems1);\r\n    this.upsertManyInCache(contentTypeItems);\r\n  }\r\n\r\n  getContentTypeItem(guid: string): EavEntity {\r\n    return this.cache$.value.find(contentTypeItem => contentTypeItem.Guid === guid);\r\n  }\r\n\r\n  getContentTypeItems(guids: string[]): EavEntity[] {\r\n    return this.cache$.value.filter(contentTypeItem => guids.includes(contentTypeItem.Guid));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map } from 'rxjs/operators';\r\nimport { EavContentType } from '../../models/eav';\r\nimport { ContentType1 } from '../../models/json-format-v1';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ContentTypeService extends BaseDataService<EavContentType> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('ContentType', serviceElementsFactory);\r\n  }\r\n\r\n  addContentTypes(contentTypes1: ContentType1[]): void {\r\n    const contentTypes = contentTypes1.map(contentType1 => EavContentType.convert(contentType1));\r\n    this.addManyToCache(contentTypes);\r\n  }\r\n\r\n  getContentType(id: string): EavContentType {\r\n    return this.cache$.value.find(contentType => contentType.Id === id);\r\n  }\r\n\r\n  getContentType$(id: string): Observable<EavContentType> {\r\n    return this.cache$.pipe(\r\n      map(contentTypes => contentTypes.find(contentType => contentType.Id === id)),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map } from 'rxjs/operators';\r\nimport { EntityInfo } from '../../../../edit-types';\r\nimport { GeneralHelpers } from '../../helpers';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class EntityCacheService extends BaseDataService<EntityInfo> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('EntityCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadEntities(entities: EntityInfo[]): void {\r\n    if (entities == null) { return; }\r\n    this.upsertManyInCache(entities);\r\n  }\r\n\r\n  getEntities$(guids?: string[]): Observable<EntityInfo[]> {\r\n    if (guids == null) {\r\n      return this.cache$.asObservable();\r\n    }\r\n\r\n    return this.cache$.pipe(\r\n      map(entities => entities.filter(entity => guids.includes(entity.Value))),\r\n      distinctUntilChanged(GeneralHelpers.arraysEqual),\r\n    );\r\n  }\r\n\r\n  getEntities(guids?: string[]): EntityInfo[] {\r\n    if (guids == null) {\r\n      return this.cache$.value;\r\n    }\r\n\r\n    return this.cache$.value.filter(entity => guids.includes(entity.Value));\r\n  }\r\n\r\n  getEntity(guid: string): EntityInfo {\r\n    return this.cache$.value.find(entity => entity.Value === guid);\r\n  }\r\n}\r\n","import { EntityMetadataMap } from '@ngrx/data';\r\nimport { EntityInfo } from '../../../../edit-types';\r\nimport { InputType } from '../../../../ng-dialogs/src/app/content-type-fields/models/input-type.model';\r\nimport { Prefetch } from '../../../eav-item-dialog/multi-item-edit-form/multi-item-edit-form.models';\r\nimport { QueryEntity } from '../../../eav-material-controls/input-types/entity/entity-query/entity-query.models';\r\nimport { AdamSnapshot, Language, LanguageInstance, LinkCache, PublishStatus } from '../../models';\r\nimport { EavContentType, EavEntity, EavItem } from '../../models/eav';\r\n\r\nexport const entityMetadata: EntityMetadataMap = {\r\n  GlobalConfig: {},\r\n  Item: {\r\n    selectId: itemSelectId,\r\n  },\r\n  Feature: {},\r\n  Language: {\r\n    selectId: languageSelectId,\r\n  },\r\n  LanguageInstance: {\r\n    selectId: languageInstanceSelectId,\r\n  },\r\n  ContentType: {\r\n    selectId: contentTypeSelectId,\r\n  },\r\n  ContentTypeItem: {\r\n    selectId: contentTypeItemSelectId,\r\n  },\r\n  InputType: {\r\n    selectId: inputTypeSelectId,\r\n  },\r\n  PublishStatus: {\r\n    selectId: publishStatusSelectId,\r\n  },\r\n  Prefetch: {\r\n    selectId: prefetchSelectId,\r\n  },\r\n  EntityCache: {\r\n    selectId: entityCacheSelectId,\r\n  },\r\n  AdamCache: {\r\n    selectId: adamCacheSelectId,\r\n  },\r\n  LinkCache: {\r\n    selectId: linkCacheSelectId,\r\n  },\r\n  StringQueryCache: {\r\n    selectId: stringQueryCacheSelectId,\r\n  },\r\n};\r\n\r\nexport const pluralNames = {\r\n  Feature: 'Features', // example\r\n  PublishStatus: 'PublishStatuses',\r\n};\r\n\r\nexport const entityConfig = {\r\n  entityMetadata,\r\n  pluralNames,\r\n};\r\n\r\nexport function itemSelectId(item: EavItem): string {\r\n  return item?.Entity?.Guid;\r\n}\r\n\r\nexport function languageSelectId(language: Language): string {\r\n  return language?.key;\r\n}\r\n\r\nexport function languageInstanceSelectId(languageInstance: LanguageInstance): number {\r\n  return languageInstance?.formId;\r\n}\r\n\r\nexport function contentTypeSelectId(contentType: EavContentType): string {\r\n  return contentType?.Id;\r\n}\r\n\r\nexport function contentTypeItemSelectId(contentTypeItem: EavEntity): string {\r\n  return contentTypeItem?.Guid;\r\n}\r\n\r\nexport function inputTypeSelectId(inputType: InputType): string {\r\n  return inputType?.Type;\r\n}\r\n\r\nexport function publishStatusSelectId(publishStatus: PublishStatus): number {\r\n  return publishStatus?.formId;\r\n}\r\n\r\nexport function prefetchSelectId(entity: Prefetch): string {\r\n  return entity?._guid;\r\n}\r\n\r\nexport function entityCacheSelectId(entity: EntityInfo): number {\r\n  return entity?.Id;\r\n}\r\n\r\nexport function adamCacheSelectId(adamSnapshot: AdamSnapshot): string {\r\n  return adamSnapshot?.Guid;\r\n}\r\n\r\nexport function linkCacheSelectId(link: LinkCache): string {\r\n  return link?.key;\r\n}\r\n\r\nexport function stringQueryCacheSelectId(entity: QueryEntity): string {\r\n  return entity?.Guid;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { BaseDataService } from '.';\r\nimport { Feature } from '../../../../ng-dialogs/src/app/apps-management/models/feature.model';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class FeatureService extends BaseDataService<Feature> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('Feature', serviceElementsFactory);\r\n  }\r\n\r\n  loadFeatures(features: Feature[]): void {\r\n    this.addAllToCache(features);\r\n  }\r\n\r\n  isFeatureEnabled(guid: string): boolean {\r\n    return this.cache$.value.find(feature => feature.id === guid)?.enabled ?? false;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { keyDebug } from '../../../../ng-dialogs/src/app/shared/constants/session.constants';\r\nimport { GlobalConfig } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class GlobalConfigService extends BaseDataService<GlobalConfig> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory, private snackBar: MatSnackBar) {\r\n    super('GlobalConfig', serviceElementsFactory);\r\n\r\n    const initial: GlobalConfig = {\r\n      id: 0,\r\n      debugEnabled: sessionStorage.getItem(keyDebug) === 'true',\r\n    };\r\n    this.addOneToCache(initial);\r\n  }\r\n\r\n  getDebugEnabled$(): Observable<boolean> {\r\n    return this.cache$.pipe(map(configs => configs[0].debugEnabled));\r\n  }\r\n\r\n  toggleDebugEnabled(): void {\r\n    const oldConfig = this.cache$.value[0];\r\n    const newConfig: GlobalConfig = {\r\n      ...oldConfig,\r\n      debugEnabled: !oldConfig.debugEnabled,\r\n    };\r\n    this.updateOneInCache(newConfig);\r\n\r\n    if (newConfig.debugEnabled) {\r\n      this.snackBar.open('debug mode enabled', null, { duration: 3000 });\r\n    } else {\r\n      this.snackBar.open('debug mode disabled', null, { duration: 3000 });\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { InputType } from '../../../../ng-dialogs/src/app/content-type-fields/models/input-type.model';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class InputTypeService extends BaseDataService<InputType> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('InputType', serviceElementsFactory);\r\n  }\r\n\r\n  addInputTypes(inputTypes: InputType[]): void {\r\n    this.addManyToCache(inputTypes);\r\n  }\r\n\r\n  getInputType(type: string): InputType {\r\n    return this.cache$.value.find(inputType => inputType.Type === type);\r\n  }\r\n\r\n  getInputTypes(): InputType[] {\r\n    return this.cache$.value;\r\n  }\r\n\r\n  getInputTypes$(): Observable<InputType[]> {\r\n    return this.cache$.asObservable();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map } from 'rxjs/operators';\r\nimport { FieldSettings, FieldValue } from '../../../../edit-types';\r\nimport { InputType } from '../../../../ng-dialogs/src/app/content-type-fields/models/input-type.model';\r\nimport { FormValues } from '../../../eav-item-dialog/item-edit-form/item-edit-form.models';\r\nimport { BestValueModes } from '../../constants/localization.constants';\r\nimport { GeneralHelpers, InputFieldHelpers, LocalizationHelpers } from '../../helpers';\r\nimport { Language, SaveResult } from '../../models';\r\nimport { EavContentTypeAttribute, EavDimension, EavEntityAttributes, EavHeader, EavItem, EavValue } from '../../models/eav';\r\nimport { Item1 } from '../../models/json-format-v1';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ItemService extends BaseDataService<EavItem> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('Item', serviceElementsFactory);\r\n  }\r\n\r\n  loadItems(items1: Item1[]): void {\r\n    const items = items1.map(item1 => EavItem.convert(item1));\r\n    this.upsertManyInCache(items);\r\n  }\r\n\r\n  updateItemId(itemData: SaveResult): void {\r\n    const entityGuid = Object.keys(itemData)[0];\r\n    const entityId = itemData[entityGuid];\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem || (oldItem.Header.EntityId !== 0 && oldItem.Entity.Id !== 0)) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Header: {\r\n        ...oldItem.Header,\r\n        EntityId: entityId,\r\n      },\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Id: entityId,\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  addItemAttributeValue(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    newValue: FieldValue,\r\n    currentLanguage: string,\r\n    isReadOnly: boolean,\r\n    attributeType: string,\r\n    isTransaction = false,\r\n    transactionItem?: EavItem,\r\n  ): EavItem {\r\n    const newValueDimension = isReadOnly ? `~${currentLanguage}` : currentLanguage;\r\n    const newEavValue = EavValue.create(newValue, [EavDimension.create(newValueDimension)]);\r\n    const oldItem = transactionItem ?? this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.addAttributeValue(oldItem.Entity.Attributes, newEavValue, attributeKey, attributeType),\r\n      }\r\n    };\r\n\r\n    if (!isTransaction) { this.updateOneInCache(newItem); }\r\n    return newItem;\r\n  }\r\n\r\n  updateItemAttributeValue(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    newValue: FieldValue,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n  ): void {\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.updateAttributeValue(\r\n          oldItem.Entity.Attributes, attributeKey, newValue, currentLanguage, defaultLanguage, isReadOnly,\r\n        ),\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  updateItemAttributesValues(entityGuid: string, newValues: FormValues, currentLanguage: string, defaultLanguage: string): void {\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem) { return; }\r\n\r\n    const oldValues: FormValues = {};\r\n    for (const [name, values] of Object.entries(oldItem.Entity.Attributes)) {\r\n      if (!newValues.hasOwnProperty(name)) { continue; }\r\n      oldValues[name] = LocalizationHelpers.translate(currentLanguage, defaultLanguage, values, null);\r\n    }\r\n    const changes = GeneralHelpers.getFormChanges(oldValues, newValues);\r\n    if (changes == null) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.updateAttributesValues(oldItem.Entity.Attributes, changes, currentLanguage, defaultLanguage),\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  /**\r\n   * Update entity attribute dimension. Add readonly languageKey to existing useFromLanguageKey.\r\n   * Example to useFrom en-us add fr-fr = \"en-us,-fr-fr\"\r\n   */\r\n  addItemAttributeDimension(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    currentLanguage: string,\r\n    shareWithLanguage: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n    transactionItem?: EavItem,\r\n  ): void {\r\n    const oldItem = transactionItem ?? this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.addAttributeDimension(\r\n          oldItem.Entity.Attributes, attributeKey, currentLanguage, shareWithLanguage, defaultLanguage, isReadOnly,\r\n        ),\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  removeItemAttributeDimension(\r\n    entityGuid: string,\r\n    attributeKey: string,\r\n    currentLanguage: string,\r\n    isTransaction = false,\r\n    transactionItem?: EavItem,\r\n  ): EavItem {\r\n    const oldItem = transactionItem ?? this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Entity: {\r\n        ...oldItem.Entity,\r\n        Attributes: LocalizationHelpers.removeAttributeDimension(oldItem.Entity.Attributes, attributeKey, currentLanguage),\r\n      }\r\n    };\r\n\r\n    if (!isTransaction) { this.updateOneInCache(newItem); }\r\n    return newItem;\r\n  }\r\n\r\n  updateItemHeader(entityGuid: string, header: EavHeader): void {\r\n    const oldItem = this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n    if (!oldItem) { return; }\r\n\r\n    const newItem: EavItem = {\r\n      ...oldItem,\r\n      Header: {\r\n        ...header\r\n      }\r\n    };\r\n    this.updateOneInCache(newItem);\r\n  }\r\n\r\n  getItemAttributes(entityGuid: string): EavEntityAttributes {\r\n    return this.cache$.value.find(item => item.Entity.Guid === entityGuid)?.Entity.Attributes;\r\n  }\r\n\r\n  getItemAttributes$(entityGuid: string): Observable<EavEntityAttributes> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.Entity.Guid === entityGuid)?.Entity.Attributes),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItem(entityGuid: string): EavItem {\r\n    return this.cache$.value.find(item => item.Entity.Guid === entityGuid);\r\n  }\r\n\r\n  getItem$(entityGuid: string): Observable<EavItem> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.Entity.Guid === entityGuid)),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItemHeader$(entityGuid: string): Observable<EavHeader> {\r\n    return this.cache$.pipe(\r\n      map(items => items.find(item => item.Entity.Guid === entityGuid)?.Header),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getItems(entityGuids?: string[]): EavItem[] {\r\n    if (entityGuids == null) { return this.cache$.value; }\r\n\r\n    return this.cache$.value.filter(item => entityGuids.includes(item.Entity.Guid));\r\n  }\r\n\r\n  getItems$(entityGuids?: string[]): Observable<EavItem[]> {\r\n    if (entityGuids == null) { return this.cache$.asObservable(); }\r\n\r\n    return this.cache$.pipe(\r\n      map(items => items.filter(item => entityGuids.includes(item.Entity.Guid))),\r\n      distinctUntilChanged(GeneralHelpers.arraysEqual),\r\n    );\r\n  }\r\n\r\n  setDefaultValue(\r\n    item: EavItem,\r\n    ctAttribute: EavContentTypeAttribute,\r\n    inputType: InputType,\r\n    settings: FieldSettings,\r\n    languages: Language[],\r\n    defaultLanguage: string,\r\n  ): void {\r\n    const defaultValue = InputFieldHelpers.parseDefaultValue(ctAttribute.Name, inputType, settings, item.Header);\r\n\r\n    const defaultLanguageValue = LocalizationHelpers.getBestValue(\r\n      item.Entity.Attributes[ctAttribute.Name],\r\n      defaultLanguage,\r\n      defaultLanguage,\r\n      BestValueModes.Strict,\r\n    );\r\n    if (defaultLanguageValue === undefined) {\r\n      if (languages.length === 0 || inputType?.DisableI18n) {\r\n        this.addItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, '*', false, ctAttribute.Type);\r\n      } else {\r\n        this.addItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, defaultLanguage, false, ctAttribute.Type);\r\n      }\r\n    } else {\r\n      // most likely used only for entity fields because we can never know if they were cleaned out or brand new\r\n      if (languages.length === 0 || inputType?.DisableI18n) {\r\n        this.updateItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, '*', defaultLanguage, false);\r\n      } else {\r\n        this.updateItemAttributeValue(item.Entity.Guid, ctAttribute.Name, defaultValue, defaultLanguage, defaultLanguage, false);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map } from 'rxjs/operators';\r\nimport { LanguageInstance } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LanguageInstanceService extends BaseDataService<LanguageInstance> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('LanguageInstance', serviceElementsFactory);\r\n  }\r\n\r\n  addLanguageInstance(formId: number, currentLanguage: string, defaultLanguage: string, uiLanguage: string, hideHeader: boolean): void {\r\n    const languageInstance: LanguageInstance = { formId, currentLanguage, defaultLanguage, uiLanguage, hideHeader };\r\n    this.addOneToCache(languageInstance);\r\n  }\r\n\r\n  removeLanguageInstance(formId: number): void {\r\n    this.removeOneFromCache(formId);\r\n  }\r\n\r\n  setCurrentLanguage(formId: number, newLanguage: string): void {\r\n    const languageInstance: Partial<LanguageInstance> = { formId, currentLanguage: newLanguage };\r\n    this.updateOneInCache(languageInstance);\r\n  }\r\n\r\n  getCurrentLanguage(formId: number): string {\r\n    return this.cache$.value.find(languageInstance => languageInstance.formId === formId)?.currentLanguage;\r\n  }\r\n\r\n  getCurrentLanguage$(formId: number): Observable<string> {\r\n    return this.cache$.pipe(\r\n      map(languageInstances => languageInstances.find(languageInstance => languageInstance.formId === formId)?.currentLanguage),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  getDefaultLanguage(formId: number): string {\r\n    return this.cache$.value.find(languageInstance => languageInstance.formId === formId)?.defaultLanguage;\r\n  }\r\n\r\n  getDefaultLanguage$(formId: number): Observable<string> {\r\n    return this.cache$.pipe(\r\n      map(languageInstances => languageInstances.find(languageInstance => languageInstance.formId === formId)?.defaultLanguage),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  /** Get hideHeader for the form. Fix for safari and mobile browsers */\r\n  getHideHeader$(formId: number): Observable<boolean> {\r\n    return this.cache$.pipe(\r\n      map(languageInstances => languageInstances.find(languageInstance => languageInstance.formId === formId)?.hideHeader),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  /** Update hideHeader for the form. Fix for safari and mobile browsers */\r\n  updateHideHeader(formId: number, hideHeader: boolean): void {\r\n    const languageInstance: Partial<LanguageInstance> = { formId, hideHeader };\r\n    this.updateOneInCache(languageInstance);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { BaseDataService } from '.';\r\nimport { Language } from '../../models';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LanguageService extends BaseDataService<Language> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('Language', serviceElementsFactory);\r\n  }\r\n\r\n  loadLanguages(languages: Language[]): void {\r\n    this.addAllToCache(languages);\r\n  }\r\n\r\n  getLanguages(): Language[] {\r\n    return this.cache$.value;\r\n  }\r\n\r\n  getLanguages$(): Observable<Language[]> {\r\n    return this.cache$.asObservable();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { AdamItem } from '../../../../edit-types';\r\nimport { PrefetchAdams, PrefetchLinks } from '../../../eav-item-dialog/multi-item-edit-form/multi-item-edit-form.models';\r\nimport { LinkCache, LinkInfo } from '../../models';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LinkCacheService extends BaseDataService<LinkCache> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('LinkCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadPrefetch(prefetchLinks: PrefetchLinks, prefetchAdam: PrefetchAdams): void {\r\n    const links: LinkCache[] = [];\r\n\r\n    if (prefetchLinks != null) {\r\n      for (const [key, linkInfo] of Object.entries(prefetchLinks)) {\r\n        const link: LinkCache = {\r\n          key,\r\n          linkInfo,\r\n        };\r\n        links.push(link);\r\n      }\r\n    }\r\n\r\n    if (prefetchAdam != null) {\r\n      for (const [entityGuid, prefetchFields] of Object.entries(prefetchAdam)) {\r\n        for (const [fieldName, items] of Object.entries(prefetchFields)) {\r\n          const adamLinks = this.adamToLinks(items);\r\n          links.push(...adamLinks);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.upsertManyInCache(links);\r\n  }\r\n\r\n  loadAdam(items: AdamItem[]): void {\r\n    const adamLinks = this.adamToLinks(items);\r\n    this.upsertManyInCache(adamLinks);\r\n  }\r\n\r\n  loadLink(key: string, linkInfo: LinkInfo): void {\r\n    key = key.trim().toLocaleLowerCase();\r\n    const link: LinkCache = {\r\n      key,\r\n      linkInfo: {\r\n        ...linkInfo,\r\n        Adam: {\r\n          ...linkInfo.Adam,\r\n        },\r\n      },\r\n    };\r\n    this.upsertOneInCache(link);\r\n  }\r\n\r\n  getLinkInfo(key: string): LinkInfo {\r\n    key = key.trim().toLocaleLowerCase();\r\n    return this.cache$.value.find(linkCache => linkCache.key.trim().toLocaleLowerCase() === key)?.linkInfo;\r\n  }\r\n\r\n  private adamToLinks(items: AdamItem[]): LinkCache[] {\r\n    const links: LinkCache[] = [];\r\n\r\n    for (const item of items) {\r\n      if (item.IsFolder) { continue; }\r\n\r\n      const link: LinkCache = {\r\n        key: item.ReferenceId,\r\n        linkInfo: {\r\n          Adam: { ...item },\r\n          Value: item.Url,\r\n        },\r\n      };\r\n      links.push(link);\r\n    }\r\n\r\n    return links;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map } from 'rxjs/operators';\r\nimport { PublishMode, PublishModeConstants, PublishStatus } from '../../models';\r\nimport { EavService } from '../../services';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class PublishStatusService extends BaseDataService<PublishStatus> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('PublishStatus', serviceElementsFactory);\r\n  }\r\n\r\n  setPublishStatus(publishStatus: PublishStatus): void {\r\n    this.upsertOneInCache(publishStatus);\r\n  }\r\n\r\n  removePublishStatus(formId: number): void {\r\n    this.removeOneFromCache(formId);\r\n  }\r\n\r\n  getPublishStatus(formId: number): PublishStatus {\r\n    return this.cache$.value.find(publishStatus => publishStatus.formId === formId);\r\n  }\r\n\r\n  private getPublishStatus$(formId: number): Observable<PublishStatus> {\r\n    return this.cache$.pipe(\r\n      map(publishStatuses => publishStatuses.find(publishStatus => publishStatus.formId === formId)),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n\r\n  setPublishMode(publishMode: PublishMode, formId: number, eavService: EavService): void {\r\n    // if publish mode is prohibited, set default\r\n    if (eavService.eavConfig.versioningOptions[publishMode] == null) {\r\n      publishMode = Object.keys(eavService.eavConfig.versioningOptions)[0] as PublishMode;\r\n    }\r\n    const publishStatus: PublishStatus = {\r\n      formId,\r\n      DraftShouldBranch: publishMode === PublishModeConstants.Branch,\r\n      IsPublished: publishMode === PublishModeConstants.Show,\r\n    };\r\n    this.setPublishStatus(publishStatus);\r\n  }\r\n\r\n  getPublishMode$(formId: number): Observable<PublishMode> {\r\n    return this.getPublishStatus$(formId).pipe(\r\n      map(publishStatus => {\r\n        const publishMode: PublishMode = publishStatus.DraftShouldBranch\r\n          ? PublishModeConstants.Branch\r\n          : publishStatus.IsPublished ? PublishModeConstants.Show : PublishModeConstants.Hide;\r\n        return publishMode;\r\n      }),\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EntityCollectionServiceElementsFactory } from '@ngrx/data';\r\nimport { Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map } from 'rxjs/operators';\r\nimport { QueryEntity } from '../../../eav-material-controls/input-types/entity/entity-query/entity-query.models';\r\nimport { GeneralHelpers } from '../../helpers';\r\nimport { BaseDataService } from './base-data.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class StringQueryCacheService extends BaseDataService<QueryEntity> {\r\n  constructor(serviceElementsFactory: EntityCollectionServiceElementsFactory) {\r\n    super('StringQueryCache', serviceElementsFactory);\r\n  }\r\n\r\n  loadEntities(entities: QueryEntity[]): void {\r\n    if (entities == null) { return; }\r\n    this.upsertManyInCache(entities);\r\n  }\r\n\r\n  getEntities$(guids?: string[]): Observable<QueryEntity[]> {\r\n    if (guids == null) {\r\n      return this.cache$.asObservable();\r\n    }\r\n\r\n    return this.cache$.pipe(\r\n      map(entities => entities.filter(entity => guids.includes(entity.Guid))),\r\n      distinctUntilChanged(GeneralHelpers.arraysEqual),\r\n    );\r\n  }\r\n}\r\n","export const prefix = 'eav-';\r\nexport const keyZoneId = prefix + 'zoneId';\r\nexport const keyRequestToken = prefix + 'rvt';\r\nexport const keyTabId = prefix + 'tid';\r\nexport const keyContentBlockId = prefix + 'cbid';\r\nexport const keyModuleId = prefix + 'mid';\r\nexport const keyAppId = prefix + 'appId';\r\nexport const keyDebug = prefix + 'debug';\r\nexport const keyDialog = prefix + 'dialog';\r\nexport const keyContentType = prefix + 'contentType';\r\nexport const keyItems = prefix + 'items';\r\nexport const keyPartOfPage = prefix + 'partOfPage';\r\n// 2020-12-01 2dm - not in url any more in 2sxc 11.10.02+, remove this\r\n// Keep in this comment in till January 2021 in case something breaks\r\n// the commit where this was added contains all the changes related to this\r\n// export const keyPortalRoot = prefix + 'portalroot';\r\nexport const keyPublishing = prefix + 'publishing';\r\nexport const keyFilters = prefix + 'filters';\r\nexport const keyPipelineId = prefix + 'pipelineId';\r\nexport const keyApi = prefix + 'api';\r\n\r\n/** Url which opened the dialog. Used for debugging */\r\nexport const keyUrl = prefix + 'url';\r\n\r\n/** This is used by file editor to determine if it's editing shared files or of that portal only */\r\nexport const keyIsShared = prefix + 'isshared';\r\n","import { Dictionary } from '../../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\nimport { TranslationLinkConstants } from '../../../shared/constants';\r\n\r\nexport class TranslateMenuHelpers {\r\n\r\n  static getTranslationStateClass(linkType: string) {\r\n    switch (linkType) {\r\n      case TranslationLinkConstants.MissingDefaultLangValue:\r\n        return 'localization-missing-default-lang-value';\r\n      case TranslationLinkConstants.Translate:\r\n      case TranslationLinkConstants.LinkCopyFrom:\r\n        return 'localization-translate';\r\n      case TranslationLinkConstants.DontTranslate:\r\n        return '';\r\n      case TranslationLinkConstants.LinkReadOnly:\r\n        return 'localization-link-read-only';\r\n      case TranslationLinkConstants.LinkReadWrite:\r\n        return 'localization-link-read-write';\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  static calculateSharedInfoMessage(dimensions: string[], currentLanguage: string): string {\r\n    dimensions = TranslateMenuHelpers.calculateShortDimensions(dimensions, currentLanguage);\r\n    const result = TranslateMenuHelpers.calculateEditAndReadDimensions(dimensions);\r\n    const editableDimensions = result.editableDimensions;\r\n    const readOnlyDimensions = result.readOnlyDimensions;\r\n    let infoMessage = '';\r\n\r\n    const editableExist = editableDimensions.length > 0;\r\n    const readOnlyExist = readOnlyDimensions.length > 0;\r\n    if (editableExist && readOnlyExist) {\r\n      infoMessage = `${editableDimensions.join(', ')}, (${readOnlyDimensions.join(', ')})`;\r\n    } else if (editableExist) {\r\n      infoMessage = editableDimensions.join(', ');\r\n    } else if (readOnlyExist) {\r\n      infoMessage = `(${readOnlyDimensions.join(', ')})`;\r\n    }\r\n\r\n    return infoMessage;\r\n  }\r\n\r\n  private static calculateShortDimensions(dimensions: string[], currentLanguage: string): string[] {\r\n    const dimensionsMap: Dictionary<string[]> = {};\r\n    const shortCurrentLanguage = currentLanguage.slice(0, currentLanguage.indexOf('-'));\r\n\r\n    dimensionsMap[shortCurrentLanguage] = [];\r\n    dimensionsMap[shortCurrentLanguage].push(shortCurrentLanguage);\r\n\r\n    dimensions.forEach(dimension => {\r\n      const shortDimension = dimension.slice(0, dimension.indexOf('-'));\r\n      const shortNoReadOnly = shortDimension.replace('~', '');\r\n\r\n      if (!dimensionsMap[shortNoReadOnly]) {\r\n        dimensionsMap[shortNoReadOnly] = [];\r\n        dimensionsMap[shortNoReadOnly].push(dimension);\r\n      } else {\r\n        dimensionsMap[shortNoReadOnly].push(dimension);\r\n      }\r\n    });\r\n\r\n    dimensions = dimensions.map(dimension => {\r\n      const shortDimension = dimension.slice(0, dimension.indexOf('-'));\r\n      const shortNoReadOnly = shortDimension.replace('~', '');\r\n\r\n      if (dimensionsMap[shortNoReadOnly].length > 1) {\r\n        return dimension;\r\n      } else {\r\n        return shortDimension;\r\n      }\r\n    });\r\n\r\n    return dimensions;\r\n  }\r\n\r\n  private static calculateEditAndReadDimensions(dimensions: string[]) {\r\n    const editableDimensions: string[] = [];\r\n    const readOnlyDimensions: string[] = [];\r\n\r\n    dimensions.forEach(dimension => {\r\n      if (!dimension.includes('~')) {\r\n        editableDimensions.push(dimension);\r\n      } else {\r\n        readOnlyDimensions.push(dimension.replace('~', ''));\r\n      }\r\n    });\r\n\r\n    return {\r\n      editableDimensions,\r\n      readOnlyDimensions\r\n    };\r\n  }\r\n}\r\n","export const environment = {\r\n  production: true\r\n};\r\n","import { Dictionary } from '../../ng-dialogs/src/app/shared/models/dictionary.model';\r\nimport { EavWindow } from '../../ng-dialogs/src/app/shared/models/eav-window.model';\r\nimport { FieldLogicBase } from './field-logic-base';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport class FieldLogicManager {\r\n  private logics: Dictionary<FieldLogicBase> = {};\r\n\r\n  private constructor() { }\r\n\r\n  static singleton(): FieldLogicManager {\r\n    if (window.eavFieldLogicManager == null) {\r\n      window.eavFieldLogicManager = new FieldLogicManager();\r\n    }\r\n    return window.eavFieldLogicManager;\r\n  }\r\n\r\n  /** Add settings logic */\r\n  add(logic: FieldLogicBase): void {\r\n    this.logics[logic.name] = logic;\r\n  }\r\n\r\n  /** Get settings logic for input type */\r\n  get(inputTypeName: string): FieldLogicBase {\r\n    return this.logics[inputTypeName] ?? null;\r\n  }\r\n}\r\n","import { EavEntity, EavEntityAttributes } from '.';\r\nimport { ContentTypeAttribute1 } from '../json-format-v1';\r\n\r\nexport class EavContentTypeAttribute {\r\n  InputType: string;\r\n  IsTitle: boolean;\r\n  Metadata: EavEntity[];\r\n  Name: string;\r\n  Settings: EavEntityAttributes;\r\n  Type: string;\r\n\r\n  private static convertOne(attribute1: ContentTypeAttribute1): EavContentTypeAttribute {\r\n    const metadata = EavEntity.convertMany(attribute1.Metadata);\r\n    const settings = EavEntityAttributes.mergeSettings(metadata);\r\n\r\n    const attribute: EavContentTypeAttribute = {\r\n      InputType: attribute1.InputType,\r\n      IsTitle: attribute1.IsTitle,\r\n      Metadata: metadata,\r\n      Name: attribute1.Name,\r\n      Settings: settings,\r\n      Type: attribute1.Type,\r\n    };\r\n    return attribute;\r\n  }\r\n\r\n  static convertMany(attributes1: ContentTypeAttribute1[]): EavContentTypeAttribute[] {\r\n    if (attributes1 == null) { return []; }\r\n\r\n    const attributes = attributes1.map(attribute1 => EavContentTypeAttribute.convertOne(attribute1));\r\n    return attributes;\r\n  }\r\n}\r\n","import { EavContentTypeAttribute, EavEntity, EavEntityAttributes } from '.';\r\nimport { ContentType1 } from '../json-format-v1';\r\n\r\nexport class EavContentType {\r\n  Attributes: EavContentTypeAttribute[];\r\n  Description: string;\r\n  Id: string;\r\n  Metadata: EavEntity[];\r\n  Name: string;\r\n  Scope: string;\r\n  Settings: EavEntityAttributes;\r\n\r\n  static convert(contentType1: ContentType1): EavContentType {\r\n    const attributes = EavContentTypeAttribute.convertMany(contentType1.Attributes);\r\n    const metadata = EavEntity.convertMany(contentType1.Metadata);\r\n    const settings = EavEntityAttributes.mergeSettings(metadata);\r\n\r\n    const contentType: EavContentType = {\r\n      Attributes: attributes,\r\n      Description: contentType1.Description,\r\n      Id: contentType1.Id,\r\n      Metadata: metadata,\r\n      Name: contentType1.Name,\r\n      Scope: contentType1.Scope,\r\n      Settings: settings,\r\n    };\r\n    return contentType;\r\n  }\r\n}\r\n","export class EavDimension {\r\n  Value: string;\r\n\r\n  static create(value: string): EavDimension {\r\n    const dimension: EavDimension = {\r\n      Value: value,\r\n    };\r\n    return dimension;\r\n  }\r\n}\r\n","import { EavEntity, EavValues } from '.';\r\nimport { EntityAttributes1 } from '../json-format-v1';\r\n\r\nexport class EavEntityAttributes {\r\n  [attributeName: string]: EavValues<any>;\r\n\r\n  static convert(attributes1: EntityAttributes1): EavEntityAttributes {\r\n    const atributes: EavEntityAttributes = {};\r\n\r\n    // loop attribute types - String, Boolean, ...\r\n    for (const [type1, attribute1] of Object.entries(attributes1)) {\r\n      // loop attribute names - Description, Name, ...\r\n      for (const [name1, value1] of Object.entries(attribute1)) {\r\n        atributes[name1] = EavValues.convert(value1, type1);\r\n      }\r\n    }\r\n    return atributes;\r\n  }\r\n\r\n  static mergeSettings(metadataItems: EavEntity[]): EavEntityAttributes {\r\n    if (metadataItems == null) { return {}; }\r\n\r\n    const merged: EavEntityAttributes = {};\r\n    // copy metadata settings which are not @All\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id === '@All') { continue; }\r\n\r\n      for (const [name, value] of Object.entries(item.Attributes)) {\r\n        const copy: EavValues<any> = { ...value };\r\n        merged[name] = copy;\r\n      }\r\n    }\r\n\r\n    // copy @All metadata settings, overwriting previous settings\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id !== '@All') { continue; }\r\n\r\n      for (const [name, value] of Object.entries(item.Attributes)) {\r\n        // do not overwrite previous settings if @All is empty\r\n        const exists = merged[name] != null;\r\n        const emptyAll = value.Values[0].Value === '';\r\n        if (exists && emptyAll) { continue; }\r\n\r\n        const copy: EavValues<any> = { ...value };\r\n        merged[name] = copy;\r\n      }\r\n    }\r\n    return merged;\r\n  }\r\n}\r\n","import { EavEntityAttributes, EavFor, EavType } from '.';\r\nimport { Entity1 } from '../json-format-v1';\r\n\r\nexport class EavEntity {\r\n  Attributes: EavEntityAttributes;\r\n  Guid: string;\r\n  Id: number;\r\n  Owner: string;\r\n  Type: EavType;\r\n  Version: number;\r\n  For?: EavFor;\r\n  Metadata?: EavEntity[];\r\n\r\n  static convertOne(entity1: Entity1): EavEntity {\r\n    // spm 2021.01.26. is empty entity ever used?\r\n    if (entity1 == null) {\r\n      const defaultEntity: EavEntity = {\r\n        Attributes: {},\r\n        Guid: '00000000-0000-0000-0000-000000000000',\r\n        Id: 0,\r\n        Owner: '',\r\n        Type: null,\r\n        Version: 1,\r\n        For: null,\r\n        Metadata: null,\r\n      };\r\n      return defaultEntity;\r\n    }\r\n\r\n    const attributes = EavEntityAttributes.convert(entity1.Attributes);\r\n    const metadata = this.convertMany(entity1.Metadata);\r\n\r\n    const entity: EavEntity = {\r\n      Attributes: attributes,\r\n      Guid: entity1.Guid,\r\n      Id: entity1.Id,\r\n      Owner: entity1.Owner,\r\n      Type: entity1.Type,\r\n      Version: entity1.Version,\r\n      For: entity1.For,\r\n      Metadata: metadata,\r\n    };\r\n    return entity;\r\n  }\r\n\r\n  static convertMany(entities1: Entity1[]): EavEntity[] {\r\n    if (entities1 == null) { return null; }\r\n\r\n    const entities = entities1.map(entity1 => EavEntity.convertOne(entity1));\r\n    return entities;\r\n  }\r\n}\r\n","import { EavEntity, EavHeader } from '.';\r\nimport { Item1 } from '../json-format-v1';\r\n\r\nexport class EavItem {\r\n  Entity: EavEntity;\r\n  Header: EavHeader;\r\n\r\n  static convert(item1: Item1): EavItem {\r\n    const entity = EavEntity.convertOne(item1.Entity);\r\n\r\n    const item: EavItem = {\r\n      Entity: entity,\r\n      Header: item1.Header,\r\n    };\r\n    return item;\r\n  }\r\n}\r\n","import { EavDimension } from '.';\r\nimport { Value1 } from '../json-format-v1';\r\n\r\nexport class EavValue<T> {\r\n  Value: T;\r\n  Dimensions: EavDimension[];\r\n\r\n  static create<T>(value: T, dimensions: EavDimension[]): EavValue<T> {\r\n    const eavValue: EavValue<T> = {\r\n      Value: value,\r\n      Dimensions: dimensions,\r\n    };\r\n    return eavValue;\r\n  }\r\n\r\n  static convert<T>(value1: Value1<T>): EavValue<T>[] {\r\n    const values = Object.entries(value1).map(([langs, value]) => {\r\n      const dimensions = langs.split(',').map(lang => EavDimension.create(lang));\r\n      return this.create(value, dimensions);\r\n    });\r\n    return values;\r\n  }\r\n}\r\n","import { EavValue } from '.';\r\nimport { Value1 } from '../json-format-v1';\r\n\r\nexport class EavValues<T> {\r\n  Values: EavValue<T>[];\r\n  Type: string;\r\n\r\n  static convert<T>(value1: Value1<T>, type: string): EavValues<T> {\r\n    const values = EavValue.convert(value1);\r\n\r\n    const eavValues: EavValues<T> = {\r\n      Values: values,\r\n      Type: type,\r\n    };\r\n    return eavValues;\r\n  }\r\n}\r\n","export class DialogTypeConstants {\r\n  public static readonly Zone = 'zone';\r\n  public static readonly AppImport = 'app-import';\r\n  public static readonly App = 'app';\r\n  public static readonly ContentType = 'contenttype';\r\n  public static readonly ContentItems = 'contentitems';\r\n  public static readonly Edit = 'edit';\r\n  public static readonly ItemHistory = 'item-history';\r\n  public static readonly Develop = 'develop';\r\n  public static readonly PipelineDesigner = 'pipeline-designer';\r\n  public static readonly Replace = 'replace';\r\n  public static readonly InstanceList = 'instance-list';\r\n}\r\n","import { Injectable, Optional, SkipSelf } from '@angular/core';\r\nimport { ActivatedRoute, ActivatedRouteSnapshot } from '@angular/router';\r\nimport { keyAppId, keyContentBlockId, keyModuleId, keyRequestToken, keyTabId, keyZoneId, prefix } from '../constants/session.constants';\r\nimport { consoleLogAngular } from '../helpers/console-log-angular.helper';\r\nimport { EavWindow } from '../models/eav-window.model';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n/** The context provides information */\r\n@Injectable()\r\nexport class Context {\r\n\r\n  /** Id of current context */\r\n  public id: number;\r\n\r\n  /** Determines if the context is ready to use, and everything is initialized */\r\n  public ready = false;\r\n\r\n  /** The parent, for hierarchical lookup */\r\n  private parent: Context;\r\n\r\n  private routeSnapshot: ActivatedRouteSnapshot;\r\n\r\n  /** The current Zone ID */\r\n  get zoneId(): number {\r\n    return this._zoneId || (this._zoneId = this.routeNum(keyZoneId) || this.parent.zoneId);\r\n  }\r\n  private _zoneId: number;\r\n\r\n  /** The current App ID */\r\n  get appId(): number {\r\n    return (this._appId != null) ? this._appId : (this._appId = this.routeNum(keyAppId) || this.parent.appId);\r\n  }\r\n  private _appId: number;\r\n\r\n  /**\r\n   * The request verification token for http requests.\r\n   * It's only loaded from the root, never from sub-contexts\r\n   */\r\n  get requestToken(): string { return this._rvt || (this._rvt = this.parent.requestToken); }\r\n  private _rvt: string;\r\n\r\n  /** Tab Id is global */\r\n  get tabId(): number {\r\n    return this._tabId || (this._tabId = this.routeNum(keyTabId) || this.parent.tabId);\r\n  }\r\n  private _tabId: number;\r\n\r\n  /** Content Block Id is global */\r\n  get contentBlockId(): number {\r\n    return this._contentBlockId || (this._contentBlockId = this.routeNum(keyContentBlockId) || this.parent.contentBlockId);\r\n  }\r\n  private _contentBlockId: number;\r\n\r\n  /** Module Id is global */\r\n  get moduleId(): number {\r\n    return this._moduleId || (this._moduleId = this.routeNum(keyModuleId) || this.parent.moduleId);\r\n  }\r\n  private _moduleId: number;\r\n\r\n  constructor(@Optional() @SkipSelf() parentContext: Context) {\r\n    this.parent = parentContext;\r\n\r\n    // spm NOTE: I've given id to every context to make it easier to follow how things work\r\n    if (!window.contextId) { window.contextId = 0; }\r\n    this.id = window.contextId++;\r\n    consoleLogAngular('Context.constructor', this);\r\n  }\r\n\r\n  /**\r\n   * This is the initializer at entry-componets of modules.\r\n   * It ensures that within that module, the context has the values given by the route\r\n   */\r\n  init(route: ActivatedRoute) {\r\n    this.routeSnapshot = route && route.snapshot;\r\n    this.clearCachedValues();\r\n    this.ready = route != null;\r\n    consoleLogAngular('Context.init', this, route);\r\n  }\r\n\r\n  initRoot() {\r\n    // required, global things\r\n    this._rvt = sessionStorage.getItem(keyRequestToken);\r\n    this._zoneId = this.sessionNumber(keyZoneId);\r\n    this._tabId = this.sessionNumber(keyTabId);\r\n    this._contentBlockId = this.sessionNumber(keyContentBlockId);\r\n    this._moduleId = this.sessionNumber(keyModuleId);\r\n\r\n    if (!this._rvt || !this._zoneId || !this._tabId || !this._contentBlockId || !this._moduleId) {\r\n      throw new Error('Context is missing some of the required parameters');\r\n    }\r\n\r\n    // optional global things\r\n    this._appId = this.sessionNumber(keyAppId);\r\n\r\n    this.ready = true;\r\n    consoleLogAngular('Context.initRoot', this);\r\n  }\r\n\r\n  private sessionNumber(name: string): number {\r\n    const result = sessionStorage.getItem(name);\r\n    if (result !== null) {\r\n      const num = parseInt(result, 10);\r\n      return isNaN(num) ? null : num;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get a number from the route, or optionally its parents.\r\n   * Returns value in route or null\r\n   */\r\n  private routeNum(name: string): number {\r\n    // catch case where state is null, like when the recursive parent is in use\r\n    if (this.routeSnapshot == null) { return null; }\r\n\r\n    const paramName = name.substring(prefix.length);\r\n    const result = this.routeSnapshot.paramMap.get(paramName);\r\n    if (result !== null) {\r\n      const num = parseInt(result, 10);\r\n      return isNaN(num) ? null : num;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears cached values. Required when one module instance is opened multiple times,\r\n   * e.g. Apps Management -> App Admin for appId 2 -> back -> App Admin for appId 17.\r\n   * Module is reused, and so is context and it contains values for previous appId.\r\n   */\r\n  private clearCachedValues() {\r\n    this._zoneId = null;\r\n    this._appId = null;\r\n    this._rvt = null;\r\n    this._tabId = null;\r\n    this._contentBlockId = null;\r\n    this._moduleId = null;\r\n  }\r\n}\r\n","export const componentMetadataKey = 'componentMetadata';\r\n","export enum FeaturesConstants {\r\n  PasteWithFormatting = '1b13e0e6-a346-4454-a1e6-2fb18c047d20',\r\n  PasteImageFromClipboard = 'f6b8d6da-4744-453b-9543-0de499aa2352',\r\n}\r\n","export enum TranslationLinkConstants {\r\n  Translate = 'Translate',\r\n  DontTranslate = 'DontTranslate',\r\n  MissingDefaultLangValue = 'MissingDefaultLangValue',\r\n  LinkReadOnly = 'LinkReadOnly',\r\n  LinkReadWrite = 'LinkReadWrite',\r\n  LinkCopyFrom = 'LinkCopyFrom',\r\n}\r\n","export enum BestValueModes {\r\n  Default = 'Default',\r\n  Strict = 'Strict',\r\n}\r\n\r\nexport type BestValueMode = keyof typeof BestValueModes;\r\n","import { ActivatedRoute } from '@angular/router';\r\nimport { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\nimport { EavConfig } from '../models';\r\n\r\nexport class UrlHelpers {\r\n\r\n  static stripNonUrlCharacters(controlValue: string, allowPath: boolean, trimEnd: boolean) {\r\n    if (!controlValue) { return ''; }\r\n\r\n    const rexSeparators = allowPath ? /[^a-z0-9-_/]+/gi : /[^a-z0-9-_]+/gi;\r\n    const latinized = this.latinizeText(controlValue.toLowerCase());\r\n    const cleanInputValue = latinized\r\n      .replace(`'s `, 's ') // neutralize it's, daniel's etc. but only if followed by a space, to ensure we don't kill quotes\r\n      .replace('\\\\', '/') // neutralize slash representation\r\n      .replace(rexSeparators, '-') // replace everything we don't want with a -\r\n      .replace(/-+/gi, '-') // reduce multiple '-'\r\n      .replace(/\\/+/gi, '/') // reduce multiple slashes\r\n      .replace(/-*\\/-*/gi, '/') // reduce '-/' or '/-' combinations to a simple '/'\r\n      .replace(trimEnd ? /^-|-+$/gi : /^-/gi, ''); // trim front and maybe end '-'\r\n    return cleanInputValue;\r\n  }\r\n\r\n  static latinizeText(input: string) {\r\n    const latinMap: Dictionary<string> = {\r\n      Á: 'A', Ă: 'A', Ắ: 'A', Ặ: 'A', Ằ: 'A', Ẳ: 'A', Ẵ: 'A', Ǎ: 'A', Â: 'A', Ấ: 'A', Ậ: 'A',\r\n      Ầ: 'A', Ẩ: 'A', Ẫ: 'A', Ä: 'Ae', Ǟ: 'A', Ȧ: 'A', Ǡ: 'A', Ạ: 'A', Ȁ: 'A', À: 'A', Ả: 'A', Ȃ: 'A',\r\n      Ā: 'A', Ą: 'A', Å: 'A', Ǻ: 'A', Ḁ: 'A', Ⱥ: 'A', Ã: 'A', Ꜳ: 'AA', Æ: 'AE', Ǽ: 'AE', Ǣ: 'AE',\r\n      Ꜵ: 'AO', Ꜷ: 'AU', Ꜹ: 'AV', Ꜻ: 'AV', Ꜽ: 'AY', Ḃ: 'B', Ḅ: 'B', Ɓ: 'B', Ḇ: 'B', Ƀ: 'B',\r\n      Ƃ: 'B', Ć: 'C', Č: 'C', Ç: 'C', Ḉ: 'C', Ĉ: 'C', Ċ: 'C', Ƈ: 'C', Ȼ: 'C', Ď: 'D', Ḑ: 'D',\r\n      Ḓ: 'D', Ḋ: 'D', Ḍ: 'D', Ɗ: 'D', Ḏ: 'D', ǲ: 'D', ǅ: 'D', Đ: 'D', Ƌ: 'D', Ǳ: 'DZ', Ǆ: 'DZ',\r\n      É: 'E', Ĕ: 'E', Ě: 'E', Ȩ: 'E', Ḝ: 'E', Ê: 'E', Ế: 'E', Ệ: 'E', Ề: 'E', Ể: 'E', Ễ: 'E', Ḙ: 'E',\r\n      Ë: 'E', Ė: 'E', Ẹ: 'E', Ȅ: 'E', È: 'E', Ẻ: 'E', Ȇ: 'E', Ē: 'E', Ḗ: 'E', Ḕ: 'E', Ę: 'E', Ɇ: 'E',\r\n      Ẽ: 'E', Ḛ: 'E', Ꝫ: 'ET', Ḟ: 'F', Ƒ: 'F', Ǵ: 'G', Ğ: 'G', Ǧ: 'G', Ģ: 'G', Ĝ: 'G', Ġ: 'G', Ɠ: 'G',\r\n      Ḡ: 'G', Ǥ: 'G', Ḫ: 'H', Ȟ: 'H', Ḩ: 'H', Ĥ: 'H', Ⱨ: 'H', Ḧ: 'H', Ḣ: 'H', Ḥ: 'H', Ħ: 'H', Í: 'I',\r\n      Ĭ: 'I', Ǐ: 'I', Î: 'I', Ï: 'I', Ḯ: 'I', İ: 'I', Ị: 'I', Ȉ: 'I', Ì: 'I', Ỉ: 'I', Ȋ: 'I', Ī: 'I',\r\n      Į: 'I', Ɨ: 'I', Ĩ: 'I', Ḭ: 'I', Ꝺ: 'D', Ꝼ: 'F', Ᵹ: 'G', Ꞃ: 'R', Ꞅ: 'S', Ꞇ: 'T', Ꝭ: 'IS', Ĵ: 'J',\r\n      Ɉ: 'J', Ḱ: 'K', Ǩ: 'K', Ķ: 'K', Ⱪ: 'K', Ꝃ: 'K', Ḳ: 'K', Ƙ: 'K', Ḵ: 'K', Ꝁ: 'K', Ꝅ: 'K', Ĺ: 'L',\r\n      Ƚ: 'L', Ľ: 'L', Ļ: 'L', Ḽ: 'L', Ḷ: 'L', Ḹ: 'L', Ⱡ: 'L', Ꝉ: 'L', Ḻ: 'L', Ŀ: 'L', Ɫ: 'L', ǈ: 'L',\r\n      Ł: 'L', Ǉ: 'LJ', Ḿ: 'M', Ṁ: 'M', Ṃ: 'M', Ɱ: 'M', Ń: 'N', Ň: 'N', Ņ: 'N', Ṋ: 'N', Ṅ: 'N', Ṇ: 'N',\r\n      Ǹ: 'N', Ɲ: 'N', Ṉ: 'N', Ƞ: 'N', ǋ: 'N', Ñ: 'N', Ǌ: 'NJ', Ó: 'O', Ŏ: 'O', Ǒ: 'O', Ô: 'O', Ố: 'O',\r\n      Ộ: 'O', Ồ: 'O', Ổ: 'O', Ỗ: 'O', Öe: 'O', Ȫ: 'O', Ȯ: 'O', Ȱ: 'O', Ọ: 'O', Ő: 'O', Ȍ: 'O', Ò: 'O',\r\n      Ỏ: 'O', Ơ: 'O', Ớ: 'O', Ợ: 'O', Ờ: 'O', Ở: 'O', Ỡ: 'O', Ȏ: 'O', Ꝋ: 'O', Ꝍ: 'O', Ō: 'O', Ṓ: 'O',\r\n      Ṑ: 'O', Ɵ: 'O', Ǫ: 'O', Ǭ: 'O', Ø: 'O', Ǿ: 'O', Õ: 'O', Ṍ: 'O', Ṏ: 'O', Ȭ: 'O', Ƣ: 'OI', Ꝏ: 'OO',\r\n      Ɛ: 'E', Ɔ: 'O', Ȣ: 'OU', Ṕ: 'P', Ṗ: 'P', Ꝓ: 'P', Ƥ: 'P', Ꝕ: 'P', Ᵽ: 'P', Ꝑ: 'P', Ꝙ: 'Q', Ꝗ: 'Q',\r\n      Ŕ: 'R', Ř: 'R', Ŗ: 'R', Ṙ: 'R', Ṛ: 'R', Ṝ: 'R', Ȑ: 'R', Ȓ: 'R', Ṟ: 'R', Ɍ: 'R', Ɽ: 'R', Ꜿ: 'C',\r\n      Ǝ: 'E', Ś: 'S', Ṥ: 'S', Š: 'S', Ṧ: 'S', Ş: 'S', Ŝ: 'S', Ș: 'S', Ṡ: 'S', Ṣ: 'S', Ṩ: 'S', Ť: 'T',\r\n      Ţ: 'T', Ṱ: 'T', Ț: 'T', Ⱦ: 'T', Ṫ: 'T', Ṭ: 'T', Ƭ: 'T', Ṯ: 'T', Ʈ: 'T', Ŧ: 'T', Ɐ: 'A', Ꞁ: 'L',\r\n      Ɯ: 'M', Ʌ: 'V', Ꜩ: 'TZ', Ú: 'U', Ŭ: 'U', Ǔ: 'U', Û: 'U', Ṷ: 'U', Ü: 'Ue', Ǘ: 'U', Ǚ: 'U', Ǜ: 'U',\r\n      Ǖ: 'U', Ṳ: 'U', Ụ: 'U', Ű: 'U', Ȕ: 'U', Ù: 'U', Ủ: 'U', Ư: 'U', Ứ: 'U', Ự: 'U', Ừ: 'U', Ử: 'U',\r\n      Ữ: 'U', Ȗ: 'U', Ū: 'U', Ṻ: 'U', Ų: 'U', Ů: 'U', Ũ: 'U', Ṹ: 'U', Ṵ: 'U', Ꝟ: 'V', Ṿ: 'V', Ʋ: 'V',\r\n      Ṽ: 'V', Ꝡ: 'VY', Ẃ: 'W', Ŵ: 'W', Ẅ: 'W', Ẇ: 'W', Ẉ: 'W', Ẁ: 'W', Ⱳ: 'W', Ẍ: 'X', Ẋ: 'X', Ý: 'Y',\r\n      Ŷ: 'Y', Ÿ: 'Y', Ẏ: 'Y', Ỵ: 'Y', Ỳ: 'Y', Ƴ: 'Y', Ỷ: 'Y', Ỿ: 'Y', Ȳ: 'Y', Ɏ: 'Y', Ỹ: 'Y', Ź: 'Z',\r\n      Ž: 'Z', Ẑ: 'Z', Ⱬ: 'Z', Ż: 'Z', Ẓ: 'Z', Ȥ: 'Z', Ẕ: 'Z', Ƶ: 'Z', Ĳ: 'IJ', Œ: 'OE', ᴀ: 'A', ᴁ: 'AE',\r\n      ʙ: 'B', ᴃ: 'B', ᴄ: 'C', ᴅ: 'D', ᴇ: 'E', ꜰ: 'F', ɢ: 'G', ʛ: 'G', ʜ: 'H', ɪ: 'I', ʁ: 'R', ᴊ: 'J',\r\n      ᴋ: 'K', ʟ: 'L', ᴌ: 'L', ᴍ: 'M', ɴ: 'N', ᴏ: 'O', ɶ: 'OE', ᴐ: 'O', ᴕ: 'OU', ᴘ: 'P', ʀ: 'R', ᴎ: 'N',\r\n      ᴙ: 'R', ꜱ: 'S', ᴛ: 'T', ⱻ: 'E', ᴚ: 'R', ᴜ: 'U', ᴠ: 'V', ᴡ: 'W', ʏ: 'Y', ᴢ: 'Z', á: 'a', ă: 'a',\r\n      ắ: 'a', ặ: 'a', ằ: 'a', ẳ: 'a', ẵ: 'a', ǎ: 'a', â: 'a', ấ: 'a', ậ: 'a', ầ: 'a', ẩ: 'a', ẫ: 'a',\r\n      ä: 'ae', ǟ: 'a', ȧ: 'a', ǡ: 'a', ạ: 'a', ȁ: 'a', à: 'a', ả: 'a', ȃ: 'a', ā: 'a', ą: 'a', ᶏ: 'a',\r\n      ẚ: 'a', å: 'a', ǻ: 'a',\r\n      ḁ: 'a', ⱥ: 'a', ã: 'a', ꜳ: 'aa', æ: 'ae', ǽ: 'ae', ǣ: 'ae', ꜵ: 'ao', ꜷ: 'au', ꜹ: 'av', ꜻ: 'av',\r\n      ꜽ: 'ay', ḃ: 'b', ḅ: 'b', ɓ: 'b', ḇ: 'b', ᵬ: 'b', ᶀ: 'b', ƀ: 'b', ƃ: 'b', ɵ: 'o', ć: 'c', č: 'c',\r\n      ç: 'c', ḉ: 'c', ĉ: 'c', ɕ: 'c', ċ: 'c', ƈ: 'c', ȼ: 'c', ď: 'd', ḑ: 'd', ḓ: 'd', ȡ: 'd', ḋ: 'd',\r\n      ḍ: 'd', ɗ: 'd', ᶑ: 'd', ḏ: 'd', ᵭ: 'd', ᶁ: 'd', đ: 'd', ɖ: 'd', ƌ: 'd', ı: 'i', ȷ: 'j', ɟ: 'j',\r\n      ʄ: 'j', ǳ: 'dz', ǆ: 'dz', é: 'e', ĕ: 'e', ě: 'e', ȩ: 'e', ḝ: 'e', ê: 'e', ế: 'e', ệ: 'e', ề: 'e',\r\n      ể: 'e', ễ: 'e', ḙ: 'e', ë: 'e', ė: 'e', ẹ: 'e', ȅ: 'e', è: 'e', ẻ: 'e', ȇ: 'e', ē: 'e', ḗ: 'e',\r\n      ḕ: 'e', ⱸ: 'e', ę: 'e', ᶒ: 'e', ɇ: 'e', ẽ: 'e', ḛ: 'e', ꝫ: 'et', ḟ: 'f', ƒ: 'f', ᵮ: 'f', ᶂ: 'f',\r\n      ǵ: 'g', ğ: 'g', ǧ: 'g', ģ: 'g', ĝ: 'g', ġ: 'g', ɠ: 'g', ḡ: 'g', ᶃ: 'g', ǥ: 'g', ḫ: 'h', ȟ: 'h',\r\n      ḩ: 'h', ĥ: 'h', ⱨ: 'h', ḧ: 'h', ḣ: 'h', ḥ: 'h', ɦ: 'h', ẖ: 'h', ħ: 'h', ƕ: 'hv', í: 'i', ĭ: 'i',\r\n      ǐ: 'i', î: 'i', ï: 'i', ḯ: 'i', ị: 'i', ȉ: 'i', ì: 'i', ỉ: 'i', ȋ: 'i', ī: 'i', į: 'i', ᶖ: 'i',\r\n      ɨ: 'i', ĩ: 'i', ḭ: 'i', ꝺ: 'd', ꝼ: 'f', ᵹ: 'g', ꞃ: 'r', ꞅ: 's', ꞇ: 't', ꝭ: 'is', ǰ: 'j', ĵ: 'j',\r\n      ʝ: 'j', ɉ: 'j', ḱ: 'k', ǩ: 'k', ķ: 'k', ⱪ: 'k', ꝃ: 'k', ḳ: 'k', ƙ: 'k', ḵ: 'k', ᶄ: 'k', ꝁ: 'k',\r\n      ꝅ: 'k', ĺ: 'l', ƚ: 'l', ɬ: 'l', ľ: 'l', ļ: 'l', ḽ: 'l', ȴ: 'l', ḷ: 'l', ḹ: 'l', ⱡ: 'l', ꝉ: 'l',\r\n      ḻ: 'l', ŀ: 'l', ɫ: 'l', ᶅ: 'l', ɭ: 'l', ł: 'l', ǉ: 'lj', ſ: 's', ẜ: 's', ẛ: 's', ẝ: 's', ḿ: 'm',\r\n      ṁ: 'm', ṃ: 'm', ɱ: 'm', ᵯ: 'm', ᶆ: 'm', ń: 'n', ň: 'n', ņ: 'n', ṋ: 'n', ȵ: 'n', ṅ: 'n', ṇ: 'n',\r\n      ǹ: 'n', ɲ: 'n', ṉ: 'n', ƞ: 'n', ᵰ: 'n', ᶇ: 'n', ɳ: 'n', ñ: 'n', ǌ: 'nj', ó: 'o', ŏ: 'o', ǒ: 'o',\r\n      ô: 'o', ố: 'o', ộ: 'o', ồ: 'o', ổ: 'o', ỗ: 'o', ö: 'oe', ȫ: 'o', ȯ: 'o', ȱ: 'o', ọ: 'o', ő: 'o',\r\n      ȍ: 'o', ò: 'o', ỏ: 'o', ơ: 'o', ớ: 'o', ợ: 'o', ờ: 'o', ở: 'o', ỡ: 'o', ȏ: 'o', ꝋ: 'o', ꝍ: 'o',\r\n      ⱺ: 'o', ō: 'o', ṓ: 'o', ṑ: 'o', ǫ: 'o', ǭ: 'o', ø: 'o', ǿ: 'o', õ: 'o', ṍ: 'o', ṏ: 'o', ȭ: 'o',\r\n      ƣ: 'oi', ꝏ: 'oo', ɛ: 'e', ᶓ: 'e', ɔ: 'o', ᶗ: 'o', ȣ: 'ou', ṕ: 'p', ṗ: 'p', ꝓ: 'p', ƥ: 'p', ᵱ: 'p',\r\n      ᶈ: 'p', ꝕ: 'p', ᵽ: 'p', ꝑ: 'p', ꝙ: 'q', ʠ: 'q', ɋ: 'q', ꝗ: 'q', ŕ: 'r', ř: 'r', ŗ: 'r', ṙ: 'r',\r\n      ṛ: 'r', ṝ: 'r', ȑ: 'r', ɾ: 'r', ᵳ: 'r', ȓ: 'r', ṟ: 'r', ɼ: 'r', ᵲ: 'r', ᶉ: 'r', ɍ: 'r', ɽ: 'r',\r\n      ↄ: 'c', ꜿ: 'c', ɘ: 'e', ɿ: 'r', ß: 'ss', ś: 's', ṥ: 's', š: 's', ṧ: 's', ş: 's', ŝ: 's', ș: 's',\r\n      ṡ: 's', ṣ: 's', ṩ: 's', ʂ: 's', ᵴ: 's', ᶊ: 's', ȿ: 's', ɡ: 'g', ᴑ: 'o', ᴓ: 'o', ᴝ: 'u', ť: 't',\r\n      ţ: 't', ṱ: 't', ț: 't', ȶ: 't', ẗ: 't', ⱦ: 't', ṫ: 't', ṭ: 't', ƭ: 't', ṯ: 't', ᵵ: 't', ƫ: 't',\r\n      ʈ: 't', ŧ: 't', ᵺ: 'th', ɐ: 'a', ᴂ: 'ae', ǝ: 'e', ᵷ: 'g', ɥ: 'h', ʮ: 'h', ʯ: 'h', ᴉ: 'i', ʞ: 'k',\r\n      ꞁ: 'l', ɯ: 'm', ɰ: 'm', ᴔ: 'oe', ɹ: 'r', ɻ: 'r', ɺ: 'r', ⱹ: 'r', ʇ: 't', ʌ: 'v', ʍ: 'w', ʎ: 'y',\r\n      ꜩ: 'tz', ú: 'u', ŭ: 'u', ǔ: 'u', û: 'u', ṷ: 'u', ü: 'ue', ǘ: 'u', ǚ: 'u', ǜ: 'u', ǖ: 'u', ṳ: 'u',\r\n      ụ: 'u', ű: 'u', ȕ: 'u', ù: 'u', ủ: 'u', ư: 'u', ứ: 'u', ự: 'u', ừ: 'u', ử: 'u', ữ: 'u', ȗ: 'u',\r\n      ū: 'u', ṻ: 'u', ų: 'u', ᶙ: 'u', ů: 'u', ũ: 'u', ṹ: 'u', ṵ: 'u', ᵫ: 'ue', ꝸ: 'um', ⱴ: 'v', ꝟ: 'v',\r\n      ṿ: 'v', ʋ: 'v', ᶌ: 'v', ⱱ: 'v', ṽ: 'v', ꝡ: 'vy', ẃ: 'w', ŵ: 'w', ẅ: 'w', ẇ: 'w', ẉ: 'w', ẁ: 'w',\r\n      ⱳ: 'w', ẘ: 'w', ẍ: 'x', ẋ: 'x', ᶍ: 'x', ý: 'y', ŷ: 'y', ÿ: 'y', ẏ: 'y', ỵ: 'y', ỳ: 'y', ƴ: 'y',\r\n      ỷ: 'y', ỿ: 'y', ȳ: 'y', ẙ: 'y', ɏ: 'y', ỹ: 'y', ź: 'z', ž: 'z', ẑ: 'z', ʑ: 'z', ⱬ: 'z', ż: 'z',\r\n      ẓ: 'z', ȥ: 'z', ẕ: 'z', ᵶ: 'z', ᶎ: 'z', ʐ: 'z', ƶ: 'z', ɀ: 'z', ﬀ: 'ff', ﬃ: 'ffi', ﬄ: 'ffl', ﬁ: 'fi',\r\n      ﬂ: 'fl', ĳ: 'ij', œ: 'oe', ﬆ: 'st', ₐ: 'a', ₑ: 'e', ᵢ: 'i', ⱼ: 'j', ₒ: 'o', ᵣ: 'r', ᵤ: 'u', ᵥ: 'v',\r\n      ₓ: 'x',\r\n    };\r\n    return input.replace(/[^A-Za-z0-9\\[\\] ]/g, (a) => (latinMap[a] || a));\r\n  }\r\n\r\n  static readQueryStringParameters(url: string): Dictionary<string> {\r\n    const queryParams: Dictionary<string> = {};\r\n    url.split('&').forEach(f => {\r\n      if (f.split('=').length === 2) {\r\n        queryParams[f.split('=')[0]] = decodeURIComponent(f.split('=')[1].replace(/\\+/g, ' '));\r\n      }\r\n    });\r\n    return queryParams;\r\n  }\r\n\r\n  /** https://stackoverflow.com/questions/979975/how-to-get-the-value-from-the-get-parameters/1099670#1099670 */\r\n  static getUrlParams(qs: string) {\r\n    qs = qs.split('+').join(' ');\r\n\r\n    const params: Dictionary<string> = {};\r\n    let tokens;\r\n    const re = /[?&]?([^=]+)=([^&]*)/g;\r\n\r\n    // tslint:disable-next-line:no-conditional-assignment\r\n    while (tokens = re.exec(qs)) {\r\n      params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\r\n    }\r\n\r\n    return params;\r\n  }\r\n\r\n  static replaceUrlParam(url: string, paramName: string, paramValue: string) {\r\n    if (paramValue === null) { paramValue = ''; }\r\n\r\n    const pattern = new RegExp('\\\\b(' + paramName + '=).*?(&|#|$)');\r\n    if (url.search(pattern) >= 0) { return url.replace(pattern, '$1' + paramValue + '$2'); }\r\n\r\n    url = url.replace(/[?#]$/, '');\r\n    return url + (url.indexOf('?') > 0 ? '&' : '?') + paramName + '=' + paramValue;\r\n  }\r\n\r\n  static getUrlPrefix(area: string, eavConfig: EavConfig) {\r\n    let result = '';\r\n\r\n    if (area === 'system') { result = eavConfig.systemRoot; } // used to link to JS-stuff and similar\r\n    if (area === 'zone') { result = eavConfig.portalRoot; } // used to link to the site-root (like an image)\r\n    if (area === 'app') { result = eavConfig.appRoot; } // used to find the app-root of something inside an app\r\n    if (result.endsWith('/')) { result = result.substring(0, result.length - 1); }\r\n\r\n    return result;\r\n  }\r\n\r\n  static calculatePathFromRoot(route: ActivatedRoute) {\r\n    let lastChild = route;\r\n    while (lastChild.firstChild) {\r\n      lastChild = lastChild.firstChild;\r\n    }\r\n    let pathFromRoot = '';\r\n    for (const path of lastChild.snapshot.pathFromRoot) {\r\n      if (path.url.length <= 0) { continue; }\r\n      for (const urlSegment of path.url) {\r\n        if (!urlSegment.path) { continue; }\r\n        pathFromRoot += '/' + urlSegment.path;\r\n      }\r\n    }\r\n    return pathFromRoot;\r\n  }\r\n}\r\n","import { JsInfo } from '@2sic.com/2sxc-typings';\r\nimport { DialogContextApp } from '../models/dialog-context.models';\r\nimport { EavWindow } from '../models/eav-window.model';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n/**\r\n * This ensures that $2sxc is fully initialized with parameters which are provided later on\r\n * The appApi is being added in v12\r\n * It's important because in Oqtane the app-api root is different in from the normal admin-apis\r\n */\r\nexport function UpdateEnvVarsFromDialogSettings(appContext: DialogContextApp): void {\r\n  try {\r\n    const includedApiRoot = appContext?.Api;\r\n    if (!includedApiRoot) { return; }\r\n\r\n    const old2sxcHeader = (window.$2sxc.env as any).header as JsInfo;\r\n    const new2sxcHeader = { ...old2sxcHeader, appApi: includedApiRoot } as JsInfo;\r\n    window.$2sxc.env.load(new2sxcHeader);\r\n  } catch { /* ignore */ }\r\n}\r\n","export enum WrappersConstants {\r\n  // Empty specific\r\n  CollapsibleWrapper = 'app-collapsible-wrapper',\r\n  // Default wrappers\r\n  HiddenWrapper = 'app-hidden-wrapper',\r\n  DropzoneWrapper = 'app-dropzone-wrapper',\r\n  LocalizationWrapper = 'app-localization-wrapper',\r\n  ExpandableWrapper = 'app-expandable-wrapper',\r\n  AdamAttachWrapper = 'app-adam-attach-wrapper',\r\n  // Entity specific\r\n  EntityExpandableWrapper = 'app-entity-expandable-wrapper',\r\n  // Hyperlink specific\r\n  HyperlinkDefaultExpandableWrapper = 'app-hyperlink-default-expandable-wrapper',\r\n  HyperlinkLibraryExpandableWrapper = 'app-hyperlink-library-expandable-wrapper',\r\n}\r\n","import { UrlMatchResult, UrlSegment } from '@angular/router';\r\nimport { EditPosParams } from './edit-matcher.models';\r\n\r\n/**\r\n * ':zoneId/:appId/edit/:items'\r\n * ':zoneId/:appId/edit/:items/details/:detailsEntityGuid/:detailsFieldId'\r\n * ':zoneId/:appId/edit/:items/update/:updateEntityGuid/:updateFieldId'\r\n */\r\nexport function editRoot(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 4) { return null; }\r\n  if (url[2].path !== 'edit') { return null; }\r\n  const hasDetails = url[4] != null && url[4].path === 'details' && url[5] != null && url[6] != null;\r\n  const hasUpdate = url[4] != null && url[4].path === 'update' && url[5] != null && url[6] != null;\r\n  const posParams: EditPosParams = {\r\n    zoneId: url[0],\r\n    appId: url[1],\r\n    items: url[3],\r\n    ...(hasDetails && { detailsEntityGuid: url[5], detailsFieldId: url[6] }),\r\n    ...(hasUpdate && { updateEntityGuid: url[5], updateFieldId: url[6] }),\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, (hasDetails || hasUpdate) ? 7 : 4),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n\r\n/** ':zoneId/:appId/edit/refresh/:items' */\r\nexport function refreshEditRoot(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 5) { return null; }\r\n  if (url[2].path !== 'edit' || url[3].path !== 'refresh') { return null; }\r\n  const posParams: EditPosParams = {\r\n    zoneId: url[0],\r\n    appId: url[1],\r\n    items: url[4],\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, 5),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n\r\n/**\r\n * 'edit/:items'\r\n * 'edit/:items/details/:detailsEntityGuid/:detailsFieldId'\r\n * 'edit/:items/update/:updateEntityGuid/:updateFieldId'\r\n */\r\nexport function edit(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 2) { return null; }\r\n  if (url[0].path !== 'edit') { return null; }\r\n  const hasDetails = url[2] != null && url[2].path === 'details' && url[3] != null && url[4] != null;\r\n  const hasUpdate = url[2] != null && url[2].path === 'update' && url[3] != null && url[4] != null;\r\n  const posParams: EditPosParams = {\r\n    items: url[1],\r\n    ...(hasDetails && { detailsEntityGuid: url[3], detailsFieldId: url[4] }),\r\n    ...(hasUpdate && { updateEntityGuid: url[3], updateFieldId: url[4] }),\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, (hasDetails || hasUpdate) ? 5 : 2),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n\r\n/** 'edit/refresh/:items' */\r\nexport function refreshEdit(url: UrlSegment[]): UrlMatchResult {\r\n  if (url.length < 3) { return null; }\r\n  if (url[0].path !== 'edit' || url[1].path !== 'refresh') { return null; }\r\n  const posParams: EditPosParams = {\r\n    items: url[2],\r\n  };\r\n  const match: UrlMatchResult = {\r\n    consumed: url.slice(0, 3),\r\n    posParams: posParams as any,\r\n  };\r\n  return match;\r\n}\r\n","import { NgZone } from '@angular/core';\r\nimport { EavWindow } from '../../../ng-dialogs/src/app/shared/models/eav-window.model';\r\nimport { ElementEventListener } from '../models';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport class DropzoneDraggingHelper {\r\n  private eventListeners: ElementEventListener[] = [];\r\n\r\n  constructor(private zone: NgZone) { }\r\n\r\n  /** Starts listening for dragover and drop events on a given element */\r\n  attach(htmlEl: HTMLElement) {\r\n    this.zone.runOutsideAngular(() => {\r\n      htmlEl.addEventListener('dragover', dragoverListener, { passive: true });\r\n      htmlEl.addEventListener('drop', dropListener, { passive: true });\r\n\r\n      this.eventListeners.push(\r\n        { element: htmlEl, type: 'dragover', listener: dragoverListener },\r\n        { element: htmlEl, type: 'drop', listener: dropListener },\r\n      );\r\n\r\n      function dragoverListener() {\r\n        clearTimeouts(window.windowBodyTimeouts); // clear timeouts from global array of timeouts which clear draggingClass from body\r\n        document.body.classList.add(window.draggingClass);\r\n      }\r\n      function dropListener() {\r\n        document.body.classList.remove(window.draggingClass);\r\n      }\r\n      function clearTimeouts(timeoutsArray: number[]) {\r\n        for (const timeout of timeoutsArray) {\r\n          clearTimeout(timeout);\r\n        }\r\n        timeoutsArray.splice(0, timeoutsArray.length);\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Removes event listeners from registered elements */\r\n  detach() {\r\n    this.zone.runOutsideAngular(() => {\r\n      this.eventListeners.forEach(({ element, type, listener }) => {\r\n        element.removeEventListener(type, listener);\r\n      });\r\n    });\r\n  }\r\n}\r\n","import { AbstractControl } from '@angular/forms';\r\nimport { Subscription } from 'rxjs';\r\nimport { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\nimport { EavConfig } from '../models';\r\n\r\n/**\r\n * Create a new FieldMask instance and access result with resolve\r\n * @example\r\n * const mask = new FieldMask(\"[FirstName]\", formGroup.controls);\r\n * const maskValue = mask.resolve();\r\n *\r\n * @param mask a string like \"[FirstName] [LastName]\"\r\n * @param model usually FormGroup controls, passed into here\r\n * @param overloadPreCleanValues a function which will \"scrub\" the found field-values\r\n */\r\nexport class FieldMask {\r\n  private mask: string;\r\n  private model: Dictionary<AbstractControl>;\r\n  private fields: string[] = [];\r\n  private value: string;\r\n  private findFields = /\\[.*?\\]/ig;\r\n  private unwrapField = /[\\[\\]]/ig;\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  constructor(\r\n    mask: string,\r\n    model: Dictionary<AbstractControl>,\r\n    private changeEvent: (newValue: string) => void,\r\n    overloadPreCleanValues: (key: string, value: string) => string,\r\n    private eavConfig?: EavConfig,\r\n  ) {\r\n    this.mask = mask;\r\n    this.model = model;\r\n    this.fields = this.fieldList();\r\n\r\n    if (overloadPreCleanValues) {\r\n      this.preClean = overloadPreCleanValues;\r\n    }\r\n\r\n    // bind auto-watch only if needed...\r\n    if (model && changeEvent) {\r\n      this.watchAllFields();\r\n    }\r\n  }\r\n\r\n  /** Resolves a mask to the final value */\r\n  resolve(): string {\r\n    let value = this.mask;\r\n    if (this.eavConfig != null && value != null) {\r\n      value = value.replace('[App:AppId]', this.eavConfig.appId);\r\n      value = value.replace('[App:ZoneId]', this.eavConfig.zoneId);\r\n    }\r\n    this.fields.forEach((e, i) => {\r\n      const replaceValue = this.model.hasOwnProperty(e) && this.model[e] && this.model[e].value ? this.model[e].value : '';\r\n      const cleaned = this.preClean(e, replaceValue);\r\n      value = value.replace('[' + e + ']', cleaned);\r\n    });\r\n\r\n    return value;\r\n  }\r\n\r\n  /** Retrieves a list of all fields used in the mask */\r\n  fieldList(): string[] {\r\n    const result: string[] = [];\r\n    if (!this.mask) { return result; }\r\n    const matches = this.mask.match(this.findFields);\r\n    if (matches) {\r\n      matches.forEach((e, i) => {\r\n        const staticName = e.replace(this.unwrapField, '');\r\n        result.push(staticName);\r\n      });\r\n    } else { // TODO: ask is this good\r\n      result.push(this.mask);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /** Default preClean function */\r\n  private preClean(key: string, value: string): string {\r\n    return value;\r\n  }\r\n\r\n  /** Change-event - will only fire if it really changes */\r\n  private onChange() {\r\n    const maybeNew = this.resolve();\r\n    if (this.value !== maybeNew) {\r\n      this.changeEvent(maybeNew);\r\n    }\r\n    this.value = maybeNew;\r\n  }\r\n\r\n  /** Add watcher and execute onChange */\r\n  private watchAllFields() {\r\n    // add a watch for each field in the field-mask\r\n    this.fields.forEach(field => {\r\n      if (!this.model[field]) { return; }\r\n      const valueSub = this.model[field].valueChanges.subscribe(value => this.onChange());\r\n      this.subscriptions.push(valueSub);\r\n    });\r\n  }\r\n\r\n  destroy() {\r\n    this.subscriptions.forEach(subscription => { subscription.unsubscribe(); });\r\n  }\r\n}\r\n","import { LocalizationHelpers } from '.';\r\nimport { InputTypeConstants } from '../../../ng-dialogs/src/app/content-type-fields/constants/input-type.constants';\r\nimport { InputType } from '../../../ng-dialogs/src/app/content-type-fields/models/input-type.model';\r\nimport { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\nimport { TranslateMenuHelpers } from '../../eav-material-controls/localization/translate-menu/translate-menu.helpers';\r\nimport { TranslationStateCore } from '../../eav-material-controls/localization/translate-menu/translate-menu.models';\r\nimport { TranslationLinkConstants } from '../constants';\r\nimport { TranslationState } from '../models';\r\nimport { EavContentType, EavContentTypeAttribute, EavEntity, EavValues } from '../models/eav';\r\n\r\nexport class FieldsSettingsHelpers {\r\n\r\n  static mergeSettings<T>(metadataItems: EavEntity[], currentLanguage: string, defaultLanguage: string): T {\r\n    if (metadataItems == null) { return {} as T; }\r\n\r\n    const merged: Dictionary = {};\r\n    // copy metadata settings which are not @All\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id === '@All') { continue; }\r\n\r\n      for (const [name, values] of Object.entries(item.Attributes)) {\r\n        const value = LocalizationHelpers.translate(currentLanguage, defaultLanguage, values, null);\r\n        merged[name] = value;\r\n      }\r\n    }\r\n\r\n    // copy @All metadata settings, overwriting previous settings\r\n    for (const item of metadataItems) {\r\n      if (item.Type.Id !== '@All') { continue; }\r\n\r\n      for (const [name, values] of Object.entries(item.Attributes)) {\r\n        const value = LocalizationHelpers.translate(currentLanguage, defaultLanguage, values, null);\r\n        // do not overwrite previous settings if @All is empty\r\n        const exists = merged[name] != null;\r\n        const emptyAll = value == null || value === '';\r\n        if (exists && emptyAll) { continue; }\r\n\r\n        merged[name] = value;\r\n      }\r\n    }\r\n\r\n    return merged as T;\r\n  }\r\n\r\n  /** Find if DisableTranslation is true in any setting and in any language */\r\n  static findDisableTranslation(\r\n    inputType: InputType,\r\n    attributeValues: EavValues<any>,\r\n    defaultLanguage: string,\r\n    metadataItems: EavEntity[],\r\n  ): boolean {\r\n    if (inputType?.DisableI18n) { return true; }\r\n    if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) { return true; }\r\n    if (metadataItems == null) { return false; }\r\n\r\n    // find DisableTranslation in @All, @String, @string-default, etc...\r\n    for (const item of metadataItems) {\r\n      const eavValues = item.Attributes['DisableTranslation'];\r\n      if (eavValues == null) { continue; }\r\n\r\n      // if true in any language, it is true for all cases\r\n      for (const eavValue of eavValues.Values) {\r\n        if (eavValue.Value === true) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  static getContentTypeTitle(contentType: EavContentType, currentLanguage: string, defaultLanguage: string): string {\r\n    let label: string;\r\n    try {\r\n      // xx ContentType is a historic bug and should be fixed when JSONs are rechecked\r\n      const type = contentType.Metadata.find(metadata => metadata.Type.Name === 'ContentType' || metadata.Type.Name === 'xx ContentType');\r\n      if (type) {\r\n        label = LocalizationHelpers.getValueOrDefault(type.Attributes.Label, currentLanguage, defaultLanguage)?.Value;\r\n      }\r\n      label = label || contentType.Name;\r\n    } catch (error) {\r\n      label = contentType.Name;\r\n    }\r\n    return label;\r\n  }\r\n\r\n  static findIsLastInGroup(contentType: EavContentType, attribute: EavContentTypeAttribute): boolean {\r\n    const index = contentType.Attributes.indexOf(attribute);\r\n    if (contentType.Attributes[index + 1] == null) { return true; }\r\n\r\n    const indexOfFirstEmpty = contentType.Attributes.findIndex(a => a.InputType === InputTypeConstants.EmptyDefault);\r\n    if (index < indexOfFirstEmpty) { return false; }\r\n\r\n    const isNotEmpty = attribute.InputType !== InputTypeConstants.EmptyDefault;\r\n    const nextIsEmpty = contentType.Attributes[index + 1].InputType === InputTypeConstants.EmptyDefault;\r\n    if (isNotEmpty && nextIsEmpty) { return true; }\r\n\r\n    return false;\r\n  }\r\n\r\n  static getDisabledBecauseTranslations(\r\n    attributeValues: EavValues<any>,\r\n    disableTranslation: boolean,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n  ): boolean {\r\n    if (currentLanguage === defaultLanguage) { return false; }\r\n    if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) { return true; }\r\n    if (disableTranslation) { return true; }\r\n    if (LocalizationHelpers.isEditableTranslationExist(attributeValues, currentLanguage, defaultLanguage)) { return false; }\r\n    if (LocalizationHelpers.isReadonlyTranslationExist(attributeValues, currentLanguage)) { return true; }\r\n    return true;\r\n  }\r\n\r\n  static getTranslationState(\r\n    attributeValues: EavValues<any>,\r\n    disableTranslation: boolean,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n  ): TranslationState {\r\n    let infoLabel: string;\r\n    let infoMessage: string;\r\n\r\n    if (disableTranslation) {\r\n      infoLabel = 'LangMenu.InAllLanguages';\r\n      infoMessage = '';\r\n    } else if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) {\r\n      infoLabel = 'LangMenu.MissingDefaultLangValue';\r\n      infoMessage = defaultLanguage;\r\n    } else {\r\n      const editableTranslationExists = LocalizationHelpers.isEditableTranslationExist(attributeValues, currentLanguage, defaultLanguage);\r\n      const readonlyTranslationExists = LocalizationHelpers.isReadonlyTranslationExist(attributeValues, currentLanguage);\r\n\r\n      if (editableTranslationExists || readonlyTranslationExists) {\r\n        const dimensions = LocalizationHelpers.getValueTranslation(attributeValues, currentLanguage, defaultLanguage)\r\n          .Dimensions.map(dimension => dimension.Value)\r\n          .filter(dimension => !dimension.includes(currentLanguage));\r\n\r\n        const isShared = dimensions.length > 0;\r\n        if (isShared) {\r\n          if (editableTranslationExists) {\r\n            infoLabel = 'LangMenu.In';\r\n          } else if (readonlyTranslationExists) {\r\n            infoLabel = 'LangMenu.From';\r\n          }\r\n          infoMessage = TranslateMenuHelpers.calculateSharedInfoMessage(dimensions, currentLanguage);\r\n        } else {\r\n          infoLabel = '';\r\n          infoMessage = '';\r\n        }\r\n      } else {\r\n        infoLabel = 'LangMenu.UseDefault';\r\n        infoMessage = '';\r\n      }\r\n    }\r\n    const state = this.getTranslationStateCore(attributeValues, disableTranslation, currentLanguage, defaultLanguage);\r\n    const translationState: TranslationState = {\r\n      infoLabel,\r\n      infoMessage,\r\n      language: state.language,\r\n      linkType: state.linkType,\r\n    };\r\n    return translationState;\r\n  }\r\n\r\n  private static getTranslationStateCore(\r\n    attributeValues: EavValues<any>,\r\n    disableTranslation: boolean,\r\n    currentLanguage: string,\r\n    defaultLanguage: string,\r\n  ): TranslationStateCore {\r\n    let language: string;\r\n    let linkType: string;\r\n\r\n    // Determine is control disabled or enabled and info message\r\n    if (!LocalizationHelpers.translationExistsInDefault(attributeValues, defaultLanguage)) {\r\n      language = '';\r\n      linkType = TranslationLinkConstants.MissingDefaultLangValue;\r\n    } else if (disableTranslation) {\r\n      language = '';\r\n      linkType = TranslationLinkConstants.DontTranslate;\r\n    } else if (LocalizationHelpers.isEditableTranslationExist(attributeValues, currentLanguage, defaultLanguage)) {\r\n      const editableElements = LocalizationHelpers.getValueTranslation(attributeValues, currentLanguage, defaultLanguage)\r\n        .Dimensions.filter(dimension => dimension.Value !== currentLanguage);\r\n\r\n      if (editableElements.length > 0) {\r\n        language = editableElements[0].Value;\r\n        linkType = TranslationLinkConstants.LinkReadWrite;\r\n      } else {\r\n        language = '';\r\n        linkType = TranslationLinkConstants.Translate;\r\n      }\r\n    } else if (LocalizationHelpers.isReadonlyTranslationExist(attributeValues, currentLanguage)) {\r\n      const readOnlyElements = LocalizationHelpers.getValueTranslation(attributeValues, currentLanguage, defaultLanguage)\r\n        .Dimensions.filter(dimension => dimension.Value !== currentLanguage);\r\n\r\n      language = readOnlyElements[0].Value;\r\n      linkType = TranslationLinkConstants.LinkReadOnly;\r\n    } else {\r\n      language = '';\r\n      linkType = TranslationLinkConstants.DontTranslate;\r\n    }\r\n\r\n    const translationState: TranslationStateCore = {\r\n      language,\r\n      linkType,\r\n    };\r\n    return translationState;\r\n  }\r\n}\r\n","import { FormulaFunction } from '../models';\r\n\r\nexport class FormulaHelpers {\r\n\r\n  static buildFormulaFunction(formula: string): FormulaFunction {\r\n    let cleanFormula = formula.trim();\r\n\r\n    // V1 cleanup\r\n    if (cleanFormula.startsWith('v1')) {\r\n      cleanFormula = cleanFormula.replace('v1', 'function');\r\n    } else if (cleanFormula.startsWith('V1')) {\r\n      cleanFormula = cleanFormula.replace('V1', 'function');\r\n    }\r\n    const formulaFn: FormulaFunction = new Function('return ' + cleanFormula)();\r\n    return formulaFn;\r\n  }\r\n}\r\n","import { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\nimport { FormValues } from '../../eav-item-dialog/item-edit-form/item-edit-form.models';\r\n\r\nexport class GeneralHelpers {\r\n\r\n  static objectsEqual<T>(x: T, y: T): boolean {\r\n    const obj1 = x as Dictionary;\r\n    const obj2 = y as Dictionary;\r\n\r\n    const keys1 = Object.keys(obj1);\r\n    const keys2 = Object.keys(obj2);\r\n    if (keys1.length !== keys2.length) { return false; }\r\n\r\n    const equal = keys1.every(key1 => {\r\n      if (!obj2.hasOwnProperty(key1)) { return false; }\r\n\r\n      return obj1[key1] === obj2[key1];\r\n    });\r\n\r\n    return equal;\r\n  }\r\n\r\n  static arraysEqual<T>(x: T[], y: T[]): boolean {\r\n    if (x.length !== y.length) { return false; }\r\n\r\n    const equal = x.every((item, index) => {\r\n      return x[index] === y[index];\r\n    });\r\n\r\n    return equal;\r\n  }\r\n\r\n  /** Searches where newValues has values different from oldValues */\r\n  static getFormChanges(oldValues: FormValues, newValues: FormValues): FormValues {\r\n    const changes: FormValues = {};\r\n    for (const key of Object.keys(newValues)) {\r\n      const newValue = newValues[key];\r\n      const oldValue = oldValues[key];\r\n      if (newValue === oldValue) { continue; }\r\n      if (Array.isArray(newValue) && Array.isArray(oldValue) && GeneralHelpers.arraysEqual(newValue, oldValue)) { continue; }\r\n\r\n      changes[key] = newValue;\r\n    }\r\n    return Object.keys(changes).length === 0 ? undefined : changes;\r\n  }\r\n\r\n  static toggleInArray<T>(item: T, array: T[]): void {\r\n    const index = array.indexOf(item);\r\n    if (index === -1) {\r\n      array.push(item);\r\n    } else {\r\n      array.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n","import { FieldSettings, FieldValue, InputTypeName } from '../../../edit-types';\r\nimport { InputTypeConstants } from '../../../ng-dialogs/src/app/content-type-fields/constants/input-type.constants';\r\nimport { InputType } from '../../../ng-dialogs/src/app/content-type-fields/models/input-type.model';\r\nimport { WrappersConstants } from '../constants/wrappers.constants';\r\nimport { CalculatedInputType } from '../models';\r\nimport { EavContentTypeAttribute, EavHeader, EavItem } from '../models/eav';\r\nimport { EavService } from '../services';\r\n\r\nexport class InputFieldHelpers {\r\n\r\n  static getContentTypeId(item: EavItem): string {\r\n    return item.Entity.Type?.Id ?? item.Header.ContentTypeName;\r\n  }\r\n\r\n  static getInputTypeNames(attributes: EavContentTypeAttribute[], inputTypes: InputType[]): InputTypeName[] {\r\n    return attributes.map(attribute => {\r\n      const calculatedInputType = this.calculateInputType(attribute, inputTypes);\r\n      const inputTypeName: InputTypeName = {\r\n        name: attribute.Name,\r\n        inputType: calculatedInputType.inputType,\r\n      };\r\n      return inputTypeName;\r\n    });\r\n  }\r\n\r\n  static calculateInputType(attribute: EavContentTypeAttribute, inputTypes: InputType[]): CalculatedInputType {\r\n    const inputType = inputTypes.find(i => i.Type === attribute.InputType);\r\n    const calculated: CalculatedInputType = {\r\n      inputType: attribute.InputType,\r\n      isExternal: inputType ? !!inputType.AngularAssets : false,\r\n    };\r\n    return calculated;\r\n  }\r\n\r\n  static getWrappers(settings: FieldSettings, calculatedInputType: CalculatedInputType) {\r\n    const inputType = calculatedInputType.inputType;\r\n    const isExternal = calculatedInputType.isExternal;\r\n\r\n    // empty inputtype wrappers\r\n    if (inputType === InputTypeConstants.EmptyDefault) { return [WrappersConstants.CollapsibleWrapper]; }\r\n\r\n    // default wrappers\r\n    const wrappers = [WrappersConstants.HiddenWrapper];\r\n\r\n    // entity-default wrappers\r\n    const isEntityType = (inputType === InputTypeConstants.EntityDefault)\r\n      || (inputType === InputTypeConstants.StringDropdownQuery)\r\n      || (inputType === InputTypeConstants.EntityQuery)\r\n      || (inputType === InputTypeConstants.EntityContentBlocks);\r\n\r\n    if (isEntityType) {\r\n      wrappers.push(WrappersConstants.LocalizationWrapper);\r\n      const allowMultiValue = settings.AllowMultiValue ?? false;\r\n      if (allowMultiValue || inputType === InputTypeConstants.EntityContentBlocks) {\r\n        wrappers.push(WrappersConstants.EntityExpandableWrapper);\r\n      }\r\n    }\r\n\r\n    if (isExternal) {\r\n      wrappers.push(\r\n        WrappersConstants.DropzoneWrapper,\r\n        WrappersConstants.LocalizationWrapper,\r\n        WrappersConstants.ExpandableWrapper,\r\n        WrappersConstants.AdamAttachWrapper,\r\n      );\r\n    }\r\n\r\n    return wrappers;\r\n  }\r\n\r\n  static parseDefaultValue(attributeKey: string, inputType: InputType, settings: FieldSettings, header: EavHeader): FieldValue {\r\n    let defaultValue = settings.DefaultValue;\r\n\r\n    if (header.Prefill?.[attributeKey]) {\r\n      defaultValue = header.Prefill[attributeKey];\r\n    }\r\n\r\n    switch (inputType?.Type) {\r\n      case InputTypeConstants.BooleanDefault:\r\n        return defaultValue != null\r\n          ? defaultValue.toLowerCase() === 'true'\r\n          : false;\r\n      case InputTypeConstants.BooleanTristate:\r\n        return defaultValue != null && defaultValue !== ''\r\n          ? defaultValue.toLowerCase() === 'true'\r\n          : null;\r\n      case InputTypeConstants.DatetimeDefault:\r\n        return defaultValue != null && defaultValue !== ''\r\n          ? new Date(defaultValue).toJSON()\r\n          : null;\r\n      case InputTypeConstants.NumberDefault:\r\n        return defaultValue != null && defaultValue !== ''\r\n          ? Number(defaultValue)\r\n          : '';\r\n      case InputTypeConstants.EntityDefault:\r\n      case InputTypeConstants.EntityQuery:\r\n      case InputTypeConstants.EntityContentBlocks:\r\n        if (defaultValue == null || defaultValue === '') { return []; }\r\n        // string has { } characters, we must switch them to quotes\r\n        if (defaultValue.includes('{')) {\r\n          defaultValue = defaultValue.replace(/[\\{\\}]/g, '\\\"');\r\n        }\r\n        // list but no array, add brackets\r\n        if (defaultValue.includes(',') && !defaultValue.includes('[')) {\r\n          const guids = defaultValue.split(',').map(guid => guid.trim());\r\n          defaultValue = JSON.stringify(guids);\r\n        }\r\n        return defaultValue.startsWith('[') // an array with guid strings\r\n          ? JSON.parse(defaultValue) // if it's a string containing an array\r\n          : [defaultValue.replace(/\"/g, '')]; // just a guid string, but might have quotes\r\n      default:\r\n        return defaultValue ?? '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Entity fields for empty items are prefilled on the backend with []\r\n   * so I can never know if entity field is brand new, or just emptied out by the user\r\n   */\r\n  static isValueEmpty(value: FieldValue, eavService: EavService) {\r\n    const emptyEntityField = Array.isArray(value) && value.length === 0 && eavService.eavConfig.createMode;\r\n    return value === undefined || emptyEntityField;\r\n  }\r\n}\r\n","import { FieldValue } from '../../../edit-types';\r\nimport { consoleLogAngular } from '../../../ng-dialogs/src/app/shared/helpers/console-log-angular.helper';\r\nimport { FormValues } from '../../eav-item-dialog/item-edit-form/item-edit-form.models';\r\nimport { BestValueMode, BestValueModes } from '../constants/localization.constants';\r\nimport { EavDimension, EavEntityAttributes, EavValue, EavValues } from '../models/eav';\r\n\r\nexport class LocalizationHelpers {\r\n  /**\r\n   * Get translated value for currentLanguage,\r\n   * if not exist return default language translation,\r\n   * if default language also not exist return first value\r\n   */\r\n  static translate(currentLanguage: string, defaultLanguage: string, attributeValues: EavValues<any>, defaultValue: any): any {\r\n    if (!attributeValues) { return defaultValue; }\r\n\r\n    const translation: EavValue<any> = this.getValueTranslation(attributeValues, currentLanguage, defaultLanguage);\r\n    if (translation) { return translation.Value; }\r\n\r\n    const translationDefault: EavValue<any> = this.getValueTranslation(attributeValues, defaultLanguage, defaultLanguage);\r\n    if (translationDefault) { return translationDefault.Value; }\r\n\r\n    // TODO: maybe return value with *\r\n    return attributeValues.Values[0]?.Value ?? null;\r\n  }\r\n\r\n  static getValueOrDefault(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): EavValue<any> {\r\n    let translation = LocalizationHelpers.getValueTranslation(allAttributesValues, languageKey, defaultLanguage);\r\n    if (translation == null) {\r\n      translation = LocalizationHelpers.getValueTranslation(allAttributesValues, defaultLanguage, defaultLanguage);\r\n    }\r\n    return translation;\r\n  }\r\n\r\n  static getValueTranslation(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): EavValue<any> {\r\n    return allAttributesValues.Values.find(eavValue =>\r\n      eavValue.Dimensions.find(d => d.Value === languageKey\r\n        || d.Value === `~${languageKey}`\r\n        || (languageKey === defaultLanguage && d.Value === '*')) !== undefined);\r\n  }\r\n\r\n  static isEditableOrReadonlyTranslationExist(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(c =>\r\n      c.Dimensions.find(d =>\r\n        d.Value === languageKey\r\n        || d.Value === `~${languageKey}`\r\n        || (languageKey === defaultLanguage && d.Value === '*'))).length > 0 : false;\r\n  }\r\n\r\n  /** Language is editable if langageKey exist or on default language * exist */\r\n  static isEditableTranslationExist(allAttributesValues: EavValues<any>, languageKey: string, defaultLanguage: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => (d.Value === languageKey)\r\n        || (languageKey === defaultLanguage && d.Value === '*'))).length > 0 : false;\r\n  }\r\n\r\n  static isReadonlyTranslationExist(allAttributesValues: EavValues<any>, languageKey: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => d.Value === `~${languageKey}`)).length > 0 : false;\r\n  }\r\n\r\n  static translationExistsInDefault(allAttributesValues: EavValues<any>, defaultLanguage: string): boolean {\r\n    return allAttributesValues ? allAttributesValues.Values.filter(eavValue =>\r\n      eavValue.Dimensions.find(d => d.Value === defaultLanguage || d.Value === '*')).length > 0 : false;\r\n  }\r\n\r\n  /** Copy attributes from item */\r\n  private static updateAttribute(\r\n    oldAttributes: EavEntityAttributes,\r\n    attributeKey: string,\r\n    attribute: EavValues<any>,\r\n  ): EavEntityAttributes {\r\n    const newAttributes: EavEntityAttributes = {};\r\n    if (Object.keys(oldAttributes).length === 0) {\r\n      const attributeCopy: EavValues<any> = { ...attribute };\r\n      newAttributes[attributeKey] = attributeCopy;\r\n      return newAttributes;\r\n    }\r\n\r\n    for (const key of Object.keys(oldAttributes)) {\r\n      if (key === attributeKey) {\r\n        const attributeCopy: EavValues<any> = { ...attribute };\r\n        newAttributes[key] = attributeCopy;\r\n      } else {\r\n        const attributeCopy: EavValues<any> = { ...oldAttributes[key] };\r\n        newAttributes[key] = attributeCopy;\r\n      }\r\n    }\r\n\r\n    if (oldAttributes[attributeKey] == null) {\r\n      const attributeCopy: EavValues<any> = { ...attribute };\r\n      newAttributes[attributeKey] = attributeCopy;\r\n    }\r\n    return newAttributes;\r\n  }\r\n\r\n  /** Update values for languageKey */\r\n  static updateAttributesValues(\r\n    allAttributes: EavEntityAttributes,\r\n    updateValues: FormValues,\r\n    languageKey: string,\r\n    defaultLanguage: string,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    const eavAttributes: EavEntityAttributes = {};\r\n    Object.keys(allAttributes).forEach(attributeKey => {\r\n      const newItemValue = updateValues[attributeKey];\r\n      // if new value exist update attribute for languageKey\r\n      // if (newItemValue !== null && newItemValue !== undefined) {\r\n      if (newItemValue !== undefined) {\r\n        const valueWithLanguageExist = this.isEditableOrReadonlyTranslationExist(\r\n          allAttributes[attributeKey], languageKey, defaultLanguage);\r\n\r\n        // if valueWithLanguageExist update value for languageKey\r\n        if (valueWithLanguageExist) {\r\n          const newValues: EavValues<any> = {\r\n            ...allAttributes[attributeKey], Values: allAttributes[attributeKey].Values.map(eavValue => {\r\n              const newValue: EavValue<any> = eavValue.Dimensions.find(d => d.Value === languageKey\r\n                || d.Value === `~${languageKey}`\r\n                || (languageKey === defaultLanguage && d.Value === '*'))\r\n                // Update value for languageKey\r\n                ? {\r\n                  ...eavValue,\r\n                  Value: newItemValue,\r\n                }\r\n                : eavValue;\r\n              return newValue;\r\n            })\r\n          };\r\n          eavAttributes[attributeKey] = newValues;\r\n        } else { // else add new value with dimension languageKey\r\n          consoleLogAngular('saveAttributeValues add values ', newItemValue);\r\n          const newEavValue = EavValue.create(newItemValue, [EavDimension.create(languageKey)]);\r\n          const newAttribute: EavValues<any> = {\r\n            ...allAttributes[attributeKey],\r\n            Values: [...allAttributes[attributeKey].Values, newEavValue]\r\n          };\r\n          eavAttributes[attributeKey] = newAttribute;\r\n        }\r\n      } else { // else copy item attributes\r\n        const attributeCopy: EavValues<any> = { ...allAttributes[attributeKey] };\r\n        eavAttributes[attributeKey] = attributeCopy;\r\n      }\r\n    });\r\n    return eavAttributes;\r\n  }\r\n\r\n  /** update attribute value, and change language readonly state if needed */\r\n  static updateAttributeValue(\r\n    allAttributes: EavEntityAttributes,\r\n    attributeKey: string,\r\n    updateValue: FieldValue,\r\n    existingLanguageKey: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    let eavAttributes: EavEntityAttributes = {};\r\n    let newLanguageValue = existingLanguageKey;\r\n\r\n    if (isReadOnly) {\r\n      newLanguageValue = `~${existingLanguageKey}`;\r\n    }\r\n\r\n    const attribute: EavValues<any> = {\r\n      ...allAttributes[attributeKey], Values: allAttributes[attributeKey].Values.map(eavValue => {\r\n        const newValue: EavValue<any> = eavValue.Dimensions.find(d => d.Value === existingLanguageKey\r\n          || d.Value === `~${existingLanguageKey}`\r\n          || (existingLanguageKey === defaultLanguage && d.Value === '*')\r\n        )\r\n          // Update value and dimension\r\n          ? {\r\n            ...eavValue,\r\n            // update value\r\n            Value: updateValue,\r\n            // update languageKey with newLanguageValue\r\n            Dimensions: eavValue.Dimensions.map(dimension => {\r\n              const newDimensions: EavDimension = (dimension.Value === existingLanguageKey\r\n                || dimension.Value === `~${existingLanguageKey}`\r\n                || (existingLanguageKey === defaultLanguage && dimension.Value === '*'))\r\n                ? { Value: newLanguageValue }\r\n                : dimension;\r\n              return newDimensions;\r\n            })\r\n          }\r\n          : eavValue;\r\n        return newValue;\r\n      })\r\n    };\r\n    eavAttributes = this.updateAttribute(allAttributes, attributeKey, attribute);\r\n    return eavAttributes;\r\n  }\r\n\r\n  static addAttributeValue(\r\n    allAttributes: EavEntityAttributes,\r\n    attributeValue: EavValue<any>,\r\n    attributeKey: string,\r\n    attributeType: string,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    let eavAttributes: EavEntityAttributes = {};\r\n    const attribute: EavValues<any> =\r\n      Object.keys(allAttributes).length === 0\r\n        || !allAttributes[attributeKey] ?\r\n        {\r\n          // Add attribute\r\n          ...allAttributes[attributeKey], Values: [attributeValue], Type: attributeType\r\n        }\r\n        : {\r\n          // Add attribute\r\n          ...allAttributes[attributeKey], Values: [...allAttributes[attributeKey].Values, attributeValue], Type: attributeType\r\n        };\r\n    eavAttributes = this.updateAttribute(allAttributes, attributeKey, attribute);\r\n    return eavAttributes;\r\n  }\r\n\r\n  /** Add dimension to value with existing dimension */\r\n  static addAttributeDimension(\r\n    allAttributes: EavEntityAttributes,\r\n    attributeKey: string,\r\n    newDimensionValue: string,\r\n    existingDimensionValue: string,\r\n    defaultLanguage: string,\r\n    isReadOnly: boolean,\r\n  ): EavEntityAttributes {\r\n    // copy attributes from item\r\n    let eavAttributes: EavEntityAttributes = {};\r\n    let newLanguageValue = newDimensionValue;\r\n\r\n    if (isReadOnly) {\r\n      newLanguageValue = `~${newDimensionValue}`;\r\n    }\r\n\r\n    const attribute: EavValues<any> = {\r\n      ...allAttributes[attributeKey], Values: allAttributes[attributeKey].Values.map(eavValue => {\r\n        const newValue: EavValue<any> = eavValue.Dimensions.find(d => d.Value === existingDimensionValue\r\n          || (existingDimensionValue === defaultLanguage && d.Value === '*'))\r\n          // Update dimension for current language\r\n          ? {\r\n            ...eavValue,\r\n            // if languageKey already exist\r\n            Dimensions: eavValue.Dimensions.concat({ Value: newLanguageValue })\r\n          }\r\n          : eavValue;\r\n        return newValue;\r\n      })\r\n    };\r\n    eavAttributes = this.updateAttribute(allAttributes, attributeKey, attribute);\r\n    return eavAttributes;\r\n  }\r\n\r\n  /** Removes dimension (language) from attribute. If multiple dimensions exist, delete only dimension, else delete value and dimension */\r\n  static removeAttributeDimension(attributes: EavEntityAttributes, attributeKey: string, language: string): EavEntityAttributes {\r\n    const oldAttributes = attributes;\r\n    const validDimensions = [language, `~${language}`];\r\n\r\n    const value = oldAttributes[attributeKey].Values.find(eavValue => {\r\n      const dimensionExists = eavValue.Dimensions.some(dimension => validDimensions.includes(dimension.Value));\r\n      return dimensionExists;\r\n    });\r\n\r\n    // given dimension doesn't exist for this attribute so no change is needed\r\n    if (!value) {\r\n      const attributesCopy: EavEntityAttributes = { ...oldAttributes };\r\n      return attributesCopy;\r\n    }\r\n\r\n    let newAttribute: EavValues<any>;\r\n    if (value.Dimensions.length > 1) {\r\n      // if multiple dimensions exist delete only dimension\r\n      newAttribute = {\r\n        ...oldAttributes[attributeKey],\r\n        Values: oldAttributes[attributeKey].Values.map(eavValue => {\r\n          const dimensionExists = eavValue.Dimensions.some(dimension => validDimensions.includes(dimension.Value));\r\n          if (!dimensionExists) { return eavValue; }\r\n\r\n          const newValue: EavValue<any> = {\r\n            ...eavValue,\r\n            Dimensions: eavValue.Dimensions.filter(dimension => !validDimensions.includes(dimension.Value)),\r\n          };\r\n          return newValue;\r\n        })\r\n      };\r\n    } else if (value.Dimensions.length === 1) {\r\n      // if only one dimension exists delete value and dimension\r\n      newAttribute = {\r\n        ...oldAttributes[attributeKey],\r\n        Values: oldAttributes[attributeKey].Values.filter(eavValue => {\r\n          const dimensionExists = eavValue.Dimensions.some(dimension => validDimensions.includes(dimension.Value));\r\n          return !dimensionExists;\r\n        })\r\n      };\r\n    }\r\n\r\n    const newAttributes = this.updateAttribute(oldAttributes, attributeKey, newAttribute);\r\n    return newAttributes;\r\n  }\r\n\r\n  /**\r\n   * Default mode priority:\r\n   * 1. value for current language\r\n   * 2. value for all languages\r\n   * 3. value for default language\r\n   * 4. first value\r\n   *\r\n   * Strict mode priority:\r\n   * 1. value for current language\r\n   * 2. value for all languages\r\n   * 3. value for default language\r\n   *\r\n   * Very strict mode priority:\r\n   * 1. value for current language\r\n   * 2. value for all languages\r\n   */\r\n  static getBestValue(eavValues: EavValues<any>, currentLanguage: string, defaultLanguage: string, mode: BestValueMode): FieldValue {\r\n    if (eavValues == null) { return; }\r\n\r\n    let bestDimensions = [currentLanguage, `~${currentLanguage}`];\r\n    let bestValue = this.findValueForDimensions(eavValues, bestDimensions);\r\n    if (bestValue !== undefined) { return bestValue; }\r\n\r\n    bestDimensions = ['*'];\r\n    bestValue = this.findValueForDimensions(eavValues, bestDimensions);\r\n    if (bestValue !== undefined) { return bestValue; }\r\n\r\n    if (mode === BestValueModes.Strict) { return; }\r\n\r\n    bestDimensions = [defaultLanguage, `~${defaultLanguage}`];\r\n    bestValue = this.findValueForDimensions(eavValues, bestDimensions);\r\n    if (bestValue !== undefined) { return bestValue; }\r\n\r\n    bestValue = eavValues.Values[0]?.Value;\r\n    return bestValue;\r\n  }\r\n\r\n  private static findValueForDimensions(eavValues: EavValues<any>, dimensions: string[]): FieldValue {\r\n    const value = eavValues.Values.find(\r\n      eavValue => !!eavValue.Dimensions.find(dimension => dimensions.includes(dimension.Value)),\r\n    )?.Value;\r\n    return value;\r\n  }\r\n}\r\n","<ng-container *ngIf=\"templateVars$ | async as data\">\r\n\r\n  <h3 class=\"page-picker-title\">\r\n    {{ 'Fields.Hyperlink.PagePicker.Title' | translate }}\r\n  </h3>\r\n\r\n  <div class=\"page-search-box\">\r\n    <mat-form-field appearance=\"standard\" color=\"accent\">\r\n      <mat-label>Search</mat-label>\r\n      <input matInput [ngModel]=\"data.filterText\" (ngModelChange)=\"setFilter($event)\">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class=\"page-tree-box\">\r\n    <ul *ngIf=\"!data.filterText\">\r\n      <ng-container *ngFor=\"let page of data.tree\">\r\n        <ng-container *ngTemplateOutlet=\"pageAndChildren; context: {page: page}\"></ng-container>\r\n      </ng-container>\r\n    </ul>\r\n\r\n    <ul *ngIf=\"data.filterText\">\r\n      <li *ngIf=\"data.filteredSearch.length === 0\">\r\n        <div class=\"page-row\">\r\n          <div class=\"no-toggle\"></div>\r\n          <div>No results</div>\r\n        </div>\r\n      </li>\r\n      <li *ngFor=\"let page of data.filteredSearch\">\r\n        <div class=\"page-row\">\r\n          <div class=\"no-toggle\"></div>\r\n          <div class=\"page-label\" [ngClass]=\"page.id === selected ? 'selected' : ''\" (click)=\"select(page.id)\">\r\n            <mat-icon svgIcon=\"file\" class=\"page-icon\"></mat-icon>\r\n            <span class=\"page-path\" *ngIf=\"page.path\">{{ page.path }}&nbsp;>&nbsp;</span>\r\n            <span>{{ page.name }}</span>\r\n          </div>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n\r\n  <ng-template #pageAndChildren let-page=\"page\">\r\n    <li>\r\n      <div class=\"page-row\">\r\n        <div class=\"no-toggle\" *ngIf=\"page.children.length === 0\"></div>\r\n        <mat-icon class=\"page-toggle\" *ngIf=\"page.children.length > 0\" (click)=\"toggle(page.id)\">\r\n          {{ toggled.includes(page.id) ? 'keyboard_arrow_down' : 'keyboard_arrow_right' }}\r\n        </mat-icon>\r\n        <div class=\"page-label\" [ngClass]=\"page.id === selected ? 'selected' : ''\" (click)=\"select(page.id)\">\r\n          <mat-icon svgIcon=\"file\" class=\"page-icon\"></mat-icon>\r\n          <span>{{ page.name }}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <ul *ngIf=\"page.children.length > 0 && toggled.includes(page.id)\">\r\n        <ng-container *ngFor=\"let child of page.children\">\r\n          <ng-container *ngTemplateOutlet=\"pageAndChildren; context: {page: child}\"></ng-container>\r\n        </ng-container>\r\n      </ul>\r\n    </li>\r\n  </ng-template>\r\n</ng-container>\r\n","import { ChangeDetectionStrategy, Component, Inject, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BehaviorSubject, combineLatest, Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { FieldValue, PagePickerResult } from '../../../edit-types';\r\nimport { GeneralHelpers } from '../../shared/helpers';\r\nimport { QueryService } from '../../shared/services';\r\nimport { buildPageSearch, buildPageTree } from './page-picker.helpers';\r\nimport { PageEntity, PagePickerDialogData, PagePickerTemplateVars, PageSearchItem, PageTreeItem } from './page-picker.models';\r\n\r\n@Component({\r\n  selector: 'app-page-picker',\r\n  templateUrl: './page-picker.component.html',\r\n  styleUrls: ['./page-picker.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class PagePickerComponent implements OnInit, OnDestroy {\r\n  selected: number;\r\n  toggled: number[];\r\n  templateVars$: Observable<PagePickerTemplateVars>;\r\n\r\n  private filterText$: BehaviorSubject<string>;\r\n  private searchItems$: BehaviorSubject<PageSearchItem[]>;\r\n  private tree$: BehaviorSubject<PageTreeItem[]>;\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) private dialogData: PagePickerDialogData,\r\n    private dialogRef: MatDialogRef<PagePickerComponent>,\r\n    private queryService: QueryService,\r\n    private translate: TranslateService,\r\n  ) { }\r\n\r\n  ngOnInit(): void {\r\n    this.selected = this.parseSelectedPageId();\r\n    this.toggled = [];\r\n    this.filterText$ = new BehaviorSubject('');\r\n    this.searchItems$ = new BehaviorSubject([]);\r\n    this.tree$ = new BehaviorSubject([]);\r\n\r\n    const filteredSearch$ = combineLatest([this.filterText$, this.searchItems$]).pipe(\r\n      map(([filterText, searchItems]) =>\r\n        searchItems.filter(item => item.name.toLocaleLowerCase().includes(filterText.toLocaleLowerCase()))\r\n      ),\r\n    );\r\n    this.templateVars$ = combineLatest([this.filterText$, filteredSearch$, this.tree$]).pipe(\r\n      map(([filterText, filteredSearch, tree]) => {\r\n        const templateVars: PagePickerTemplateVars = {\r\n          filterText,\r\n          filteredSearch,\r\n          tree,\r\n        };\r\n        return templateVars;\r\n      }),\r\n    );\r\n\r\n    this.fetchPages();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.filterText$.complete();\r\n    this.searchItems$.complete();\r\n    this.tree$.complete();\r\n  }\r\n\r\n  setFilter(filterText: string): void {\r\n    this.filterText$.next(filterText);\r\n  }\r\n\r\n  select(pageId: number): void {\r\n    // filters out pages without parent (broken)\r\n    if (pageId == null) { return; }\r\n    this.closeDialog(pageId);\r\n  }\r\n\r\n  toggle(pageId: number): void {\r\n    GeneralHelpers.toggleInArray(pageId, this.toggled);\r\n  }\r\n\r\n  private closeDialog(pageId?: number): void {\r\n    if (pageId == null) {\r\n      this.dialogRef.close();\r\n      return;\r\n    }\r\n\r\n    const page = this.searchItems$.value.find(i => i.id === pageId);\r\n    const result: PagePickerResult = {\r\n      id: page.id.toString(),\r\n      name: page.name,\r\n    };\r\n    this.dialogRef.close(result);\r\n  }\r\n\r\n  private fetchPages(): void {\r\n    const query = 'Eav.Queries.Global.Pages';\r\n    const stream = 'Default';\r\n    this.queryService.getAvailableEntities(`${query}/${stream}`, true, null, null).subscribe({\r\n      next: (data) => {\r\n        if (!data) {\r\n          console.error(this.translate.instant('Fields.EntityQuery.QueryError'));\r\n          return;\r\n        }\r\n        if (!data[stream]) {\r\n          console.error(this.translate.instant('Fields.EntityQuery.QueryStreamNotFound') + stream);\r\n          return;\r\n        }\r\n        const pages = data[stream] as PageEntity[];\r\n        const searchItems = buildPageSearch(pages);\r\n        this.searchItems$.next(searchItems);\r\n        const tree = buildPageTree(pages);\r\n        this.tree$.next(tree);\r\n      },\r\n      error: (error) => {\r\n        console.error(error);\r\n        console.error(`${this.translate.instant('Fields.EntityQuery.QueryError')} - ${error.data}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  private parseSelectedPageId(): number {\r\n    const prefix = 'page:';\r\n    let fieldValue: FieldValue = this.dialogData.group.controls[this.dialogData.config.fieldName].value;\r\n    if (typeof fieldValue !== 'string') { return; }\r\n\r\n    fieldValue = fieldValue.trim().toLocaleLowerCase();\r\n    if (!fieldValue.startsWith(prefix)) { return; }\r\n\r\n    try {\r\n      const id = parseInt(fieldValue.split(prefix)[1], 10);\r\n      return id;\r\n    } catch {\r\n      return;\r\n    }\r\n  }\r\n}\r\n","import { PageEntity, PageSearchItem, PageTreeItem } from './page-picker.models';\r\n\r\nexport function buildPageSearch(pages: PageEntity[]): PageSearchItem[] {\r\n  if (!pages) { return []; }\r\n\r\n  const items = pages.map(page => {\r\n    let path = page.Path.trim().replace(/\\\\/g, '/').replace(/\\/\\//g, '/');\r\n    if (path.startsWith('/')) {\r\n      path = path.substring(1);\r\n    }\r\n    path = path.split('/').slice(0, -1).join(' > ');\r\n\r\n    const item: PageSearchItem = {\r\n      id: page.Id,\r\n      name: page.Name,\r\n      path,\r\n    };\r\n    return item;\r\n  });\r\n\r\n  return items;\r\n}\r\n\r\nexport function buildPageTree(pages: PageEntity[]): PageTreeItem[] {\r\n  if (!pages) { return []; }\r\n\r\n  const items = pages.map(page => {\r\n    const item: PageTreeItem = {\r\n      children: [],\r\n      id: page.Id,\r\n      name: page.Name,\r\n      parentId: page.ParentId,\r\n    };\r\n    return item;\r\n  });\r\n\r\n  const tree: PageTreeItem[] = [];\r\n  const broken: PageTreeItem[] = [];\r\n  for (const item of items) {\r\n    if (item.parentId === -1) {\r\n      tree.push(item);\r\n      continue;\r\n    }\r\n\r\n    const parent = items.find(i => i.id === item.parentId);\r\n    if (!parent) {\r\n      broken.push(item);\r\n    } else {\r\n      parent.children.push(item);\r\n    }\r\n  }\r\n\r\n  if (broken.length > 0) {\r\n    /** Fake entry to place all pages which are missing parent */\r\n    const item: PageTreeItem = {\r\n      children: broken,\r\n      id: null,\r\n      name: 'Missing Parent',\r\n      parentId: null,\r\n    };\r\n    tree.push(item);\r\n  }\r\n\r\n  return tree;\r\n}\r\n","import { ChangeDetectorRef, ViewContainerRef } from '@angular/core';\r\nimport { FormGroup } from '@angular/forms';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { take } from 'rxjs/operators';\r\nimport { PagePickerResult } from '../../../edit-types';\r\nimport { FieldConfigSet } from '../../eav-dynamic-form/model/field-config';\r\nimport { PagePickerComponent } from '../../eav-material-controls/page-picker/page-picker.component';\r\nimport { PagePickerDialogData } from '../../eav-material-controls/page-picker/page-picker.models';\r\n\r\nexport class PagePicker {\r\n  static open(\r\n    config: FieldConfigSet,\r\n    group: FormGroup,\r\n    dialog: MatDialog,\r\n    viewContainerRef: ViewContainerRef,\r\n    changeDetectorRef: ChangeDetectorRef,\r\n    callback: (value: PagePickerResult) => void,\r\n  ): void {\r\n    const data: PagePickerDialogData = {\r\n      config,\r\n      group,\r\n    };\r\n    const dialogRef = dialog.open(PagePickerComponent, {\r\n      autoFocus: false,\r\n      data,\r\n      viewContainerRef,\r\n      width: '650px',\r\n    });\r\n\r\n    dialogRef.afterClosed().pipe(take(1)).subscribe((value: PagePickerResult) => {\r\n      callback(value);\r\n    });\r\n\r\n    changeDetectorRef.markForCheck();\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { EavService } from '.';\r\n\r\nconst webApiAppFilesRoot = 'admin/appfiles/';\r\nexport const webApiAppFilesAll = webApiAppFilesRoot + 'all';\r\nexport const webApiAppFile = webApiAppFilesRoot + 'asset';\r\nexport const webApiAppFileCreate = webApiAppFilesRoot + 'create';\r\nexport const webApiExplorer = 'admin/ApiExplorer/inspect'\r\n@Injectable()\r\nexport class AssetsService {\r\n  constructor(private http: HttpClient, private eavService: EavService, private dnnContext: DnnContext) { }\r\n\r\n  getAll(global: boolean) {\r\n    return this.http.get<string[]>(this.dnnContext.$2sxc.http.apiUrl(webApiAppFilesAll), {\r\n      params: { appId: this.eavService.eavConfig.appId, global: global.toString(), withSubfolders: 'true' },\r\n    });\r\n  }\r\n\r\n  create(path: string, global: boolean) {\r\n    return this.http.post<boolean>(this.dnnContext.$2sxc.http.apiUrl(webApiAppFileCreate), {}, {\r\n      params: { appId: this.eavService.eavConfig.appId, global: global.toString(), path }\r\n    });\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { keyPartOfPage, keyPublishing } from '../../../ng-dialogs/src/app/shared/constants/session.constants';\r\nimport { Context } from '../../../ng-dialogs/src/app/shared/services/context';\r\nimport { EavFormData, EditDialogContext, SaveEavFormData } from '../../eav-item-dialog/multi-item-edit-form/multi-item-edit-form.models';\r\nimport { EavConfig, SaveResult, VersioningOptions } from '../models';\r\n\r\nexport const webApiEditRoot = 'cms/edit/';\r\n\r\n@Injectable()\r\nexport class EavService {\r\n  /** WARNING! These are constants that form was loaded with. They do not change while form is running */\r\n  eavConfig: EavConfig;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private dnnContext: DnnContext,\r\n    /** Used to fetch form data and fill up eavConfig. Do not use anywhere else */\r\n    private context: Context,\r\n  ) { }\r\n\r\n  /** Create EavConfiguration from sessionStorage */\r\n  setEavConfig(\r\n    editDialogContext: EditDialogContext,\r\n    formId: number,\r\n    isParentDialog: boolean,\r\n    itemGuids: string[],\r\n    createMode: boolean,\r\n    isCopy: boolean,\r\n    enableHistory: boolean,\r\n  ) {\r\n    this.eavConfig = {\r\n      zoneId: this.context.zoneId.toString(),\r\n      appId: this.context.appId.toString(),\r\n      appRoot: editDialogContext.App.Url,\r\n      lang: editDialogContext.Language.Current,\r\n      langPri: editDialogContext.Language.Primary,\r\n      langs: editDialogContext.Language.All,\r\n      moduleId: this.context.moduleId.toString(),\r\n      partOfPage: sessionStorage.getItem(keyPartOfPage),\r\n      portalRoot: editDialogContext.Site.Url,\r\n      tabId: this.context.tabId.toString(),\r\n      systemRoot: window.location.pathname.split('/dist/')[0] + '/',\r\n      versioningOptions: this.getVersioningOptions(\r\n        sessionStorage.getItem(keyPartOfPage) === 'true',\r\n        sessionStorage.getItem(keyPublishing),\r\n      ),\r\n      formId,\r\n      isParentDialog,\r\n      itemGuids,\r\n      createMode,\r\n      isCopy,\r\n      enableHistory,\r\n    };\r\n  }\r\n\r\n  fetchFormData(items: string) {\r\n    return this.http.post<EavFormData>(this.dnnContext.$2sxc.http.apiUrl(webApiEditRoot + 'load'), items, {\r\n      params: { appId: this.context.appId.toString() }\r\n    });\r\n  }\r\n\r\n  saveFormData(result: SaveEavFormData) {\r\n    return this.http.post<SaveResult>(this.dnnContext.$2sxc.http.apiUrl(webApiEditRoot + 'save'), result, {\r\n      params: { appId: this.eavConfig.appId, partOfPage: this.eavConfig.partOfPage }\r\n    });\r\n  }\r\n\r\n  private getVersioningOptions(partOfPage: boolean, publishing: string): VersioningOptions {\r\n    if (!partOfPage) {\r\n      return { show: true, hide: true, branch: true };\r\n    }\r\n\r\n    const publish = publishing || '';\r\n    switch (publish) {\r\n      case '':\r\n      case 'DraftOptional':\r\n        return { show: true, hide: true, branch: true };\r\n      case 'DraftRequired':\r\n        return { branch: true, hide: true };\r\n      default: {\r\n        console.error('invalid versioning requiremenets: ' + publish);\r\n        return {};\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { ActivatedRoute } from '@angular/router';\r\nimport { Language } from '../../shared/models';\r\n\r\nexport function calculateIsParentDialog(route: ActivatedRoute) {\r\n  let editDialogCount = 0;\r\n  for (const path of route.snapshot.pathFromRoot) {\r\n    if (path.url.length <= 0) { continue; }\r\n    for (const urlSegment of path.url) {\r\n      if (urlSegment.path !== 'edit') { continue; }\r\n      editDialogCount++;\r\n    }\r\n  }\r\n  return editDialogCount === 1;\r\n}\r\n\r\nexport function sortLanguages(primaryLangKey: string, languages: Language[]) {\r\n  if (languages.length === 0) { return languages; }\r\n\r\n  let primaryLang: Language;\r\n  const sameLangs: Language[] = [];\r\n  const otherLangs: Language[] = [];\r\n  for (const language of languages) {\r\n    if (language.key === primaryLangKey) {\r\n      primaryLang = language;\r\n    } else if (language.key.startsWith(primaryLangKey.split('-')[0])) {\r\n      sameLangs.push(language);\r\n    } else {\r\n      otherLangs.push(language);\r\n    }\r\n  }\r\n  sameLangs.sort(alphabetCompare);\r\n  otherLangs.sort(alphabetCompare);\r\n\r\n  const allLangsSorted: Language[] = !primaryLang ? [...sameLangs, ...otherLangs] : [primaryLang, ...sameLangs, ...otherLangs];\r\n  return allLangsSorted;\r\n}\r\n\r\nfunction alphabetCompare(a: Language, b: Language) {\r\n  if (a.key < b.key) { return -1; }\r\n  if (a.key > b.key) { return 1; }\r\n  return 0;\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { EavService } from '.';\r\nimport { FieldSettings } from '../../../edit-types';\r\nimport { InputTypeConstants } from '../../../ng-dialogs/src/app/content-type-fields/constants/input-type.constants';\r\nimport { UpdateEnvVarsFromDialogSettings } from '../../../ng-dialogs/src/app/shared/helpers/update-env-vars-from-dialog-settings.helper';\r\nimport { convertUrlToForm } from '../../../ng-dialogs/src/app/shared/helpers/url-prep.helper';\r\nimport { calculateIsParentDialog, sortLanguages } from '../../eav-item-dialog/multi-item-edit-form/multi-item-edit-form.helpers';\r\nimport { EavFormData } from '../../eav-item-dialog/multi-item-edit-form/multi-item-edit-form.models';\r\nimport { EditParams } from '../../edit-matcher.models';\r\nimport { BestValueModes } from '../constants/localization.constants';\r\nimport { FieldsSettingsHelpers, InputFieldHelpers, LocalizationHelpers } from '../helpers';\r\nimport { Language, PublishStatus } from '../models';\r\n// tslint:disable-next-line:max-line-length\r\nimport { AdamCacheService, ContentTypeItemService, ContentTypeService, EntityCacheService, FeatureService, InputTypeService, ItemService, LanguageInstanceService, LanguageService, LinkCacheService, PublishStatusService } from '../store/ngrx-data';\r\n\r\n@Injectable()\r\nexport class EditInitializerService implements OnDestroy {\r\n  loaded$ = new BehaviorSubject(false);\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private eavService: EavService,\r\n    private itemService: ItemService,\r\n    private inputTypeService: InputTypeService,\r\n    private contentTypeItemService: ContentTypeItemService,\r\n    private contentTypeService: ContentTypeService,\r\n    private featureService: FeatureService,\r\n    private publishStatusService: PublishStatusService,\r\n    private translate: TranslateService,\r\n    private languageService: LanguageService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private snackBar: MatSnackBar,\r\n    private entityCacheService: EntityCacheService,\r\n    private adamCacheService: AdamCacheService,\r\n    private linkCacheService: LinkCacheService,\r\n  ) { }\r\n\r\n  ngOnDestroy(): void {\r\n    this.loaded$.complete();\r\n  }\r\n\r\n  fetchFormData(): void {\r\n    const form = convertUrlToForm((this.route.snapshot.params as EditParams).items);\r\n    const editItems = JSON.stringify(form.items);\r\n    this.eavService.fetchFormData(editItems).subscribe(formData => {\r\n      UpdateEnvVarsFromDialogSettings(formData.Context.App);\r\n      this.saveFormData(formData);\r\n      this.setMissingValues();\r\n\r\n      this.loaded$.next(true);\r\n    });\r\n  }\r\n\r\n  private saveFormData(formData: EavFormData): void {\r\n    const formId = Math.floor(Math.random() * 99999);\r\n    const isParentDialog = calculateIsParentDialog(this.route);\r\n    const itemGuids = formData.Items.map(item => item.Entity.Guid);\r\n\r\n    this.itemService.loadItems(formData.Items);\r\n    // we assume that input type and content type data won't change between loading parent and child forms\r\n    this.inputTypeService.addInputTypes(formData.InputTypes);\r\n    this.contentTypeItemService.addContentTypeItems(formData.ContentTypeItems);\r\n    this.contentTypeService.addContentTypes(formData.ContentTypes);\r\n    this.featureService.loadFeatures(formData.Features);\r\n    this.adamCacheService.loadPrefetch(formData.Prefetch?.Adam);\r\n    this.entityCacheService.loadEntities(formData.Prefetch?.Entities);\r\n    this.linkCacheService.loadPrefetch(formData.Prefetch?.Links, formData.Prefetch?.Adam);\r\n\r\n    const items = this.itemService.getItems(itemGuids);\r\n    const createMode = items[0].Entity.Id === 0;\r\n    const isCopy = items[0].Header.DuplicateEntity != null;\r\n    const enableHistory = !createMode && this.route.snapshot.data.history !== false;\r\n    this.eavService.setEavConfig(formData.Context, formId, isParentDialog, itemGuids, createMode, isCopy, enableHistory);\r\n\r\n    const currentLanguage = this.eavService.eavConfig.lang;\r\n    const defaultLanguage = this.eavService.eavConfig.langPri;\r\n    const languages = this.eavService.eavConfig.langs;\r\n    // WARNING! TranslateService is a new instance for every form and language must be set for every one of them\r\n    const isoLangCode = currentLanguage.split('-')[0];\r\n    this.translate.use(isoLangCode);\r\n\r\n    // load language data only for parent dialog to not overwrite languages when opening child dialogs\r\n    if (isParentDialog) {\r\n      const eavLangs: Language[] = Object.entries(languages).map(([key, name]) => ({ key, name }));\r\n      const sortedLanguages = sortLanguages(defaultLanguage, eavLangs);\r\n      this.languageService.loadLanguages(sortedLanguages);\r\n    }\r\n    this.languageInstanceService.addLanguageInstance(formId, currentLanguage, defaultLanguage, currentLanguage, false);\r\n\r\n    const publishStatus: PublishStatus = {\r\n      formId,\r\n      DraftShouldBranch: formData.DraftShouldBranch,\r\n      IsPublished: formData.IsPublished,\r\n    };\r\n    this.publishStatusService.setPublishStatus(publishStatus);\r\n  }\r\n\r\n  private setMissingValues(): void {\r\n    const items = this.itemService.getItems(this.eavService.eavConfig.itemGuids);\r\n    const inputTypes = this.inputTypeService.getInputTypes();\r\n    const languages = this.languageService.getLanguages();\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    let switchToDefault = false;\r\n\r\n    for (const item of items) {\r\n      const contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n      const contentType = this.contentTypeService.getContentType(contentTypeId);\r\n\r\n      for (const ctAttribute of contentType.Attributes) {\r\n        const inputType = inputTypes.find(i => i.Type === ctAttribute.InputType);\r\n        // 'custom-default' doesn't have inputType\r\n        if (inputType?.Type === InputTypeConstants.EmptyDefault) { continue; }\r\n\r\n        const attributeValues = item.Entity.Attributes[ctAttribute.Name];\r\n        const fieldSettings = FieldsSettingsHelpers.mergeSettings<FieldSettings>(ctAttribute.Metadata, defaultLanguage, defaultLanguage);\r\n\r\n        if (languages.length === 0) {\r\n          const firstValue = LocalizationHelpers.getBestValue(attributeValues, '*', '*', BestValueModes.Default);\r\n          if (InputFieldHelpers.isValueEmpty(firstValue, this.eavService)) {\r\n            this.itemService.setDefaultValue(item, ctAttribute, inputType, fieldSettings, languages, defaultLanguage);\r\n          }\r\n        } else {\r\n          const noLanguageValue = LocalizationHelpers.getBestValue(attributeValues, '*', '*', BestValueModes.Strict);\r\n          if (!inputType?.DisableI18n && noLanguageValue !== undefined) {\r\n            // move * value to defaultLanguage\r\n            const transactionItem = this.itemService.removeItemAttributeDimension(item.Entity.Guid, ctAttribute.Name, '*', true);\r\n            this.itemService.addItemAttributeValue(\r\n              item.Entity.Guid,\r\n              ctAttribute.Name,\r\n              noLanguageValue,\r\n              defaultLanguage,\r\n              false,\r\n              ctAttribute.Type,\r\n              false,\r\n              transactionItem,\r\n            );\r\n            continue;\r\n          }\r\n\r\n          const defaultLanguageValue = LocalizationHelpers.getBestValue(\r\n            attributeValues,\r\n            defaultLanguage,\r\n            defaultLanguage,\r\n            BestValueModes.Strict,\r\n          );\r\n          if (InputFieldHelpers.isValueEmpty(defaultLanguageValue, this.eavService)) {\r\n            this.itemService.setDefaultValue(item, ctAttribute, inputType, fieldSettings, languages, defaultLanguage);\r\n            switchToDefault = true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    if (switchToDefault && currentLanguage !== defaultLanguage) {\r\n      this.languageInstanceService.setCurrentLanguage(this.eavService.eavConfig.formId, defaultLanguage);\r\n      const message = this.translate.instant('Message.SwitchedLanguageToDefault', { language: defaultLanguage });\r\n      this.snackBar.open(message, null, { duration: 5000 });\r\n    }\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged, filter, map, pairwise, startWith } from 'rxjs/operators';\r\nimport { EavService } from '.';\r\nimport { ItemHistoryResult } from '../../../ng-dialogs/src/app/item-history/models/item-history-result.model';\r\nimport { convertFormToUrl } from '../../../ng-dialogs/src/app/shared/helpers/url-prep.helper';\r\nimport { EditForm } from '../../../ng-dialogs/src/app/shared/models/edit-form.model';\r\nimport { EditEntryComponent } from '../../edit-entry/edit-entry.component';\r\nimport { EditParams } from '../../edit-matcher.models';\r\nimport { UrlHelpers } from '../helpers';\r\nimport { ChildFormResult, NavigateFormResult } from '../models';\r\nimport { LanguageInstanceService } from '../store/ngrx-data';\r\n\r\n@Injectable()\r\nexport class EditRoutingService implements OnDestroy {\r\n  private subscription: Subscription;\r\n  private childFormResult$: Subject<ChildFormResult>;\r\n\r\n  constructor(\r\n    private dialogRef: MatDialogRef<EditEntryComponent>,\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private eavService: EavService,\r\n  ) { }\r\n\r\n  ngOnDestroy() {\r\n    this.childFormResult$.complete();\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  init() {\r\n    this.subscription = new Subscription();\r\n    this.childFormResult$ = new Subject<ChildFormResult>();\r\n    this.initHideHeader();\r\n    this.initChildFormResult();\r\n    this.refreshOnChildVersionsClosed();\r\n  }\r\n\r\n  /** Tells if field with this index should be expanded */\r\n  isExpanded(fieldId: number, entityGuid: string) {\r\n    const fieldIndex = fieldId.toString();\r\n    const params = this.route.snapshot.params as EditParams;\r\n    const isExpanded = params.detailsEntityGuid === entityGuid && params.detailsFieldId === fieldIndex;\r\n    return isExpanded;\r\n  }\r\n\r\n  /** Tells if field with this index should be expanded */\r\n  isExpanded$(fieldId: number, entityGuid: string) {\r\n    const fieldIndex = fieldId.toString();\r\n    return this.route.params.pipe(\r\n      map((params: EditParams) => params.detailsEntityGuid === entityGuid && params.detailsFieldId === fieldIndex),\r\n      distinctUntilChanged()\r\n    );\r\n  }\r\n\r\n  /** Fires when child form is closed and has a result, new entity was added */\r\n  childFormResult(fieldId: number, entityGuid: string) {\r\n    return this.childFormResult$.pipe(\r\n      filter(\r\n        childResult => childResult.updateEntityGuid === entityGuid && childResult.updateFieldId === fieldId && childResult.result != null\r\n      ),\r\n      map(childResult => childResult.result)\r\n    );\r\n  }\r\n\r\n  /** Fires when child form is closed */\r\n  childFormClosed() {\r\n    return this.childFormResult$.pipe(map(childResult => null));\r\n  }\r\n\r\n  expand(expand: boolean, fieldId: number, entityGuid: string, componentTag?: string) {\r\n    const params = this.route.snapshot.params as EditParams;\r\n    const oldHasDetails = params.detailsEntityGuid != null && params.detailsFieldId != null;\r\n    const oldEditUrl = `edit/${params.items}` + (oldHasDetails ? `/details/${params.detailsEntityGuid}/${params.detailsFieldId}` : '');\r\n    const newEditUrl = `edit/${params.items}` + (expand ? `/details/${entityGuid}/${fieldId}` : '');\r\n\r\n    const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n    const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n    if (lastIndex <= 0) { return; }\r\n    const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n    this.router.navigate([newUrl], { state: componentTag && { componentTag } });\r\n  }\r\n\r\n  /** Opens child dialog and stores update entityGuid and fieldId in the url, if field is not expanded already */\r\n  open(fieldId: number, entityGuid: string, form: EditForm) {\r\n    const formUrl = convertFormToUrl(form);\r\n    const params = this.route.snapshot.params as EditParams;\r\n    const hasDetails = params.detailsEntityGuid != null && params.detailsFieldId != null;\r\n    // if field is expanded, just open child because that info will be used for field update\r\n    if (hasDetails) {\r\n      this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n      return;\r\n    }\r\n\r\n    // otherwise add /update/:entityGuid/:fieldId to the url\r\n    const oldEditUrl = `edit/${params.items}`;\r\n    const newEditUrl = `edit/${params.items}/update/${entityGuid}/${fieldId}/edit/${formUrl}`;\r\n\r\n    const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n    const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n    if (lastIndex <= 0) { return; }\r\n    const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n    this.router.navigate([newUrl]);\r\n  }\r\n\r\n  /** Update hideHeader for the form. Fix for safari and mobile browsers */\r\n  private initHideHeader() {\r\n    this.subscription.add(\r\n      this.route.params\r\n        .pipe(\r\n          map((params: EditParams) => params.detailsEntityGuid != null && params.detailsFieldId != null),\r\n          distinctUntilChanged(),\r\n        )\r\n        .subscribe(hasDetails => {\r\n          this.languageInstanceService.updateHideHeader(this.eavService.eavConfig.formId, hasDetails);\r\n        })\r\n    );\r\n  }\r\n\r\n  private initChildFormResult() {\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        startWith(!!this.route.snapshot.firstChild),\r\n        map(() => !!this.route.snapshot.firstChild),\r\n        pairwise(),\r\n        filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n        map(() => {\r\n          const params = this.route.snapshot.params as EditParams;\r\n          const hasDetails = params.detailsEntityGuid != null && params.detailsFieldId != null;\r\n          const updateEntityGuid = hasDetails ? params.detailsEntityGuid : params.updateEntityGuid;\r\n          const updateFieldId = hasDetails ? params.detailsFieldId : params.updateFieldId;\r\n          const navigation = this.router.getCurrentNavigation();\r\n          const editResult = navigation.extras?.state;\r\n          const formResult: ChildFormResult = {\r\n            updateEntityGuid,\r\n            updateFieldId: parseInt(updateFieldId, 10),\r\n            result: editResult,\r\n          };\r\n          return formResult;\r\n        }),\r\n      ).subscribe(formResult => {\r\n        // alert subscribers that child form closed\r\n        this.childFormResult$.next(formResult);\r\n\r\n        // clear update ids from url (leave expanded/details)\r\n        const params = this.route.snapshot.params as EditParams;\r\n        const hasUpdate = params.updateEntityGuid != null && params.updateFieldId != null;\r\n        if (!hasUpdate) { return; }\r\n\r\n        const oldEditUrl = `edit/${params.items}/update/${params.updateEntityGuid}/${params.updateFieldId}`;\r\n        const newEditUrl = `edit/${params.items}`;\r\n\r\n        const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n        const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n        if (lastIndex <= 0) { return; }\r\n        const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n        this.router.navigate([newUrl]);\r\n      })\r\n    );\r\n  }\r\n\r\n  private refreshOnChildVersionsClosed() {\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        startWith(!!this.route.snapshot.firstChild),\r\n        map(() => !!this.route.snapshot.firstChild),\r\n        pairwise(),\r\n        filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n        map(() => {\r\n          const navigation = this.router.getCurrentNavigation();\r\n          const versionsResult = navigation.extras?.state as ItemHistoryResult;\r\n          return versionsResult;\r\n        }),\r\n        filter(versionsResult => versionsResult?.refreshEdit != null),\r\n      ).subscribe(result => {\r\n        if (!result.refreshEdit) { return; }\r\n        const params = this.route.snapshot.params as EditParams;\r\n        const oldEditUrl = `edit/${params.items}`;\r\n        const newEditUrl = `edit/refresh/${params.items}`;\r\n\r\n        const currentUrl = UrlHelpers.calculatePathFromRoot(this.route);\r\n        const lastIndex = currentUrl.lastIndexOf(oldEditUrl);\r\n        if (lastIndex <= 0) { return; }\r\n        const newUrl = currentUrl.substring(0, lastIndex) + currentUrl.substring(lastIndex).replace(oldEditUrl, newEditUrl);\r\n        const navRes: NavigateFormResult = {\r\n          navigateUrl: newUrl,\r\n        };\r\n        this.dialogRef.close(navRes);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Context } from 'projects/ng-dialogs/src/app/shared/services/context';\r\nimport { Observable } from 'rxjs';\r\nimport { filter, share, switchMap } from 'rxjs/operators';\r\nimport { EavService, webApiEditRoot } from '.';\r\nimport { EntityInfo } from '../../../edit-types';\r\n\r\nexport const webApiEntityRoot = 'admin/entity/';\r\nexport const webApiEntityList = 'admin/entity/list';\r\n\r\n@Injectable()\r\nexport class EntityService {\r\n  constructor(private http: HttpClient, private eavService: EavService, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  getAvailableEntities(contentTypeName: string, entitiesFilter?: string[]): Observable<EntityInfo[]> {\r\n    // eavConfig for edit ui and context for other calls\r\n    const context = this.eavService.eavConfig ?? this.context;\r\n    return this.http.post<EntityInfo[]>(this.dnnContext.$2sxc.http.apiUrl(webApiEditRoot + 'EntityPicker'), entitiesFilter, {\r\n      params: { contentTypeName, appId: context.appId.toString() },\r\n    });\r\n  }\r\n\r\n  // Experimental 2dm\r\n  reactiveEntities(params: Observable<{ contentTypeName: string }>): Observable<EntityInfo[]> {\r\n    return params.pipe(\r\n      filter(p => p != null),\r\n      switchMap(p => this.getAvailableEntities(p.contentTypeName).pipe(share())),\r\n    );\r\n  }\r\n\r\n  delete(contentType: string, entityId: number, force: boolean): Observable<null> {\r\n    return this.http.delete<null>(this.dnnContext.$2sxc.http.apiUrl(webApiEntityRoot + 'delete'), {\r\n      params: { contentType, id: entityId.toString(), appId: this.eavService.eavConfig.appId, force: force.toString() },\r\n    });\r\n  }\r\n}\r\n","import { ValidatorFn, Validators } from '@angular/forms';\r\nimport { FieldSettings } from '../../../edit-types';\r\nimport { InputTypeConstants } from '../../../ng-dialogs/src/app/content-type-fields/constants/input-type.constants';\r\nimport { EavContentTypeAttribute } from '../../shared/models/eav';\r\nimport { CustomValidators } from './custom-validators';\r\n\r\nexport class ValidationHelper {\r\n\r\n  static isRequired(settings: FieldSettings): boolean {\r\n    // hidden field can't be required\r\n    const visible = settings.VisibleInEditUI ?? true;\r\n    if (!visible) { return false; }\r\n\r\n    const required = settings.Required ?? false;\r\n    return required;\r\n  }\r\n\r\n  static getValidators(settings: FieldSettings, attribute: EavContentTypeAttribute): ValidatorFn[] {\r\n    // hidden field can't have validators\r\n    const visible = settings.VisibleInEditUI ?? true;\r\n    if (!visible) { return []; }\r\n\r\n    const validators: ValidatorFn[] = [];\r\n\r\n    // hyperlink-library field will set custom required validator\r\n    const required = settings.Required ?? false;\r\n    const isHyperlinkLibrary = attribute.InputType === InputTypeConstants.HyperlinkLibrary;\r\n    if (required && !isHyperlinkLibrary) {\r\n      validators.push(Validators.required);\r\n    }\r\n\r\n    if (settings.ValidationRegExJavaScript) {\r\n      validators.push(Validators.pattern(settings.ValidationRegExJavaScript));\r\n    }\r\n\r\n    if (settings.Decimals) {\r\n      validators.push(CustomValidators.validateDecimals(settings.Decimals));\r\n    }\r\n\r\n    if (settings.Max > 0) {\r\n      validators.push(Validators.max(settings.Max));\r\n    }\r\n\r\n    if (settings.Min > 0) {\r\n      validators.push(Validators.min(settings.Min));\r\n    }\r\n\r\n    return validators;\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map } from 'rxjs/operators';\r\nimport { FieldValue } from '../../../edit-types';\r\nimport { CustomFormula, CustomFormulaResult, FormulaType } from '../models';\r\n\r\n@Injectable()\r\nexport class FormulaDesignerService implements OnDestroy {\r\n  private customFormulas: CustomFormula[] = [];\r\n  private customFormulaResults$ = new BehaviorSubject<CustomFormulaResult[]>([]);\r\n\r\n  constructor() { }\r\n\r\n  ngOnDestroy(): void {\r\n    this.customFormulaResults$.complete();\r\n  }\r\n\r\n  getFormula(entityGuid: string, fieldName: string, type: FormulaType): string {\r\n    return this.customFormulas.find(c => c.entityGuid === entityGuid && c.fieldName === fieldName && c.type === type)?.formula;\r\n  }\r\n\r\n  upsertFormula(entityGuid: string, fieldName: string, type: FormulaType, formula: string): void {\r\n    const existing = this.customFormulas.find(c => c.entityGuid === entityGuid && c.fieldName === fieldName && c.type === type);\r\n    if (existing != null) {\r\n      existing.formula = formula;\r\n      return;\r\n    }\r\n\r\n    const newFormula: CustomFormula = {\r\n      entityGuid,\r\n      fieldName,\r\n      type,\r\n      formula,\r\n    };\r\n    this.customFormulas.push(newFormula);\r\n  }\r\n\r\n  deleteFormula(entityGuid: string, fieldName: string, type: FormulaType): void {\r\n    const formulaIndex = this.customFormulas.findIndex(c => c.entityGuid === entityGuid && c.fieldName === fieldName && c.type === type);\r\n    if (formulaIndex >= 0) {\r\n      this.customFormulas.splice(formulaIndex, 1);\r\n    }\r\n\r\n    const results = this.customFormulaResults$.value;\r\n    const resultIndex = results.findIndex(r => r.entityGuid === entityGuid && r.fieldName === fieldName && r.type === type);\r\n    if (resultIndex >= 0) {\r\n      const newResults = [...results.slice(0, resultIndex), ...results.slice(resultIndex + 1)];\r\n      this.customFormulaResults$.next(newResults);\r\n    }\r\n  }\r\n\r\n  upsertFormulaResult(entityGuid: string, fieldName: string, type: FormulaType, value: FieldValue, isError: boolean): void {\r\n    const newResult: CustomFormulaResult = {\r\n      entityGuid,\r\n      fieldName,\r\n      type,\r\n      value,\r\n      isError,\r\n    };\r\n\r\n    const results = this.customFormulaResults$.value;\r\n    const index = results.findIndex(r => r.entityGuid === entityGuid && r.fieldName === fieldName && r.type === type);\r\n    if (index >= 0) {\r\n      const newResults = [...results.slice(0, index), newResult, ...results.slice(index + 1)];\r\n      this.customFormulaResults$.next(newResults);\r\n      return;\r\n    }\r\n\r\n    this.customFormulaResults$.next([...results, newResult]);\r\n  }\r\n\r\n  getFormulaResult$(entityGuid: string, fieldName: string, type: FormulaType): Observable<CustomFormulaResult> {\r\n    return this.customFormulaResults$.pipe(\r\n      map(results => results.find(r => r.entityGuid === entityGuid && r.fieldName === fieldName && r.type === type)),\r\n      distinctUntilChanged(),\r\n    );\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { ValidatorFn } from '@angular/forms';\r\nimport { BehaviorSubject, combineLatest, Observable, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged, filter, map } from 'rxjs/operators';\r\nimport { EavService } from '.';\r\nimport { FieldSettings, FieldValue } from '../../../edit-types';\r\nimport { InputType } from '../../../ng-dialogs/src/app/content-type-fields/models/input-type.model';\r\nimport { FormValues } from '../../eav-item-dialog/item-edit-form/item-edit-form.models';\r\nimport { ValidationHelper } from '../../eav-material-controls/validators/validation-helper';\r\nimport { FieldLogicManager } from '../../field-logic/field-logic-manager';\r\nimport { FieldsSettingsHelpers, FormulaHelpers, GeneralHelpers, InputFieldHelpers, LocalizationHelpers } from '../helpers';\r\n// tslint:disable-next-line:max-line-length\r\nimport { ContentTypeSettings, FieldsProps, FormulaContext, FormulaCtxField, FormulaErrorCounter, FormulaType, FormulaTypes, TranslationState } from '../models';\r\nimport { EavContentTypeAttribute, EavEntity } from '../models/eav';\r\nimport { ContentTypeItemService, ContentTypeService, InputTypeService, ItemService, LanguageInstanceService, LanguageService } from '../store/ngrx-data';\r\nimport { FormulaDesignerService } from './formula-designer.service';\r\n\r\n@Injectable()\r\nexport class FieldsSettingsService implements OnDestroy {\r\n  private contentTypeSettings$: BehaviorSubject<ContentTypeSettings>;\r\n  private fieldsProps$: BehaviorSubject<FieldsProps>;\r\n  private forceSettings$: BehaviorSubject<void>;\r\n  private subscription: Subscription;\r\n  private valueFormulaCounter = 0;\r\n  private maxValueFormulaCycles = 5;\r\n  private formulaErrorCounters: FormulaErrorCounter[] = [];\r\n  private maxFormulaErrors = 10;\r\n\r\n  constructor(\r\n    private contentTypeService: ContentTypeService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private eavService: EavService,\r\n    private itemService: ItemService,\r\n    private inputTypeService: InputTypeService,\r\n    private contentTypeItemService: ContentTypeItemService,\r\n    private languageService: LanguageService,\r\n    private formulaDesignerService: FormulaDesignerService,\r\n  ) { }\r\n\r\n  ngOnDestroy(): void {\r\n    this.contentTypeSettings$?.complete();\r\n    this.fieldsProps$?.complete();\r\n    this.forceSettings$?.complete();\r\n    this.subscription?.unsubscribe();\r\n  }\r\n\r\n  init(entityGuid: string): void {\r\n    this.subscription = new Subscription();\r\n    this.contentTypeSettings$ = new BehaviorSubject(null);\r\n    this.fieldsProps$ = new BehaviorSubject(null);\r\n    this.forceSettings$ = new BehaviorSubject(null);\r\n\r\n    const item = this.itemService.getItem(entityGuid);\r\n    const contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n    const contentType$ = this.contentTypeService.getContentType$(contentTypeId);\r\n    const itemHeader$ = this.itemService.getItemHeader$(entityGuid);\r\n    const currentLanguage$ = this.languageInstanceService.getCurrentLanguage$(this.eavService.eavConfig.formId);\r\n    const defaultLanguage$ = this.languageInstanceService.getDefaultLanguage$(this.eavService.eavConfig.formId);\r\n\r\n    this.subscription.add(\r\n      combineLatest([contentType$, itemHeader$, currentLanguage$, defaultLanguage$]).pipe(\r\n        map(([contentType, itemHeader, currentLanguage, defaultLanguage]) => {\r\n          const ctSettings = FieldsSettingsHelpers.mergeSettings<ContentTypeSettings>(\r\n            contentType.Metadata, currentLanguage, defaultLanguage,\r\n          );\r\n          ctSettings.Description ??= '';\r\n          ctSettings.EditInstructions ??= '';\r\n          ctSettings.Label ??= '';\r\n          ctSettings.ListInstructions ??= '';\r\n          ctSettings.Notes ??= '';\r\n          ctSettings.Icon ??= '';\r\n          ctSettings.Link ??= '';\r\n          ctSettings._itemTitle = FieldsSettingsHelpers.getContentTypeTitle(contentType, currentLanguage, defaultLanguage);\r\n          ctSettings._slotCanBeEmpty = itemHeader.Group?.SlotCanBeEmpty ?? false;\r\n          ctSettings._slotIsEmpty = itemHeader.Group?.SlotIsEmpty ?? false;\r\n          return ctSettings;\r\n        }),\r\n      ).subscribe(ctSettings => {\r\n        this.contentTypeSettings$.next(ctSettings);\r\n      })\r\n    );\r\n\r\n    const itemAttributes$ = this.itemService.getItemAttributes$(entityGuid);\r\n    const inputTypes$ = this.inputTypeService.getInputTypes$();\r\n    this.subscription.add(\r\n      combineLatest([\r\n        combineLatest([contentType$, currentLanguage$, defaultLanguage$, itemAttributes$, itemHeader$, inputTypes$]),\r\n        combineLatest([this.forceSettings$]),\r\n      ]).pipe(\r\n        map(([\r\n          [contentType, currentLanguage, defaultLanguage, itemAttributes, itemHeader, inputTypes],\r\n          [forceSettings],\r\n        ]) => {\r\n          const formValues: FormValues = {};\r\n          for (const [fieldName, fieldValues] of Object.entries(itemAttributes)) {\r\n            formValues[fieldName] = LocalizationHelpers.translate(currentLanguage, defaultLanguage, fieldValues, null);\r\n          }\r\n\r\n          const fieldsProps: FieldsProps = {};\r\n          const formulaUpdates: FormValues = {};\r\n          for (const attribute of contentType.Attributes) {\r\n            const attributeValues = itemAttributes[attribute.Name];\r\n            // empty-default has no value\r\n            const value = formValues[attribute.Name];\r\n            // custom-default has no inputType\r\n            const inputType = inputTypes.find(i => i.Type === attribute.InputType);\r\n\r\n            const merged = FieldsSettingsHelpers.mergeSettings<FieldSettings>(attribute.Metadata, currentLanguage, defaultLanguage);\r\n            // update @All settings\r\n            merged.Name ??= '';\r\n            merged.Placeholder ??= '';\r\n            merged.Notes ??= '';\r\n            merged.VisibleInEditUI ??= true;\r\n            merged.Required ??= false;\r\n            merged.Disabled ??= false;\r\n            merged.DisableTranslation ??= false;\r\n            // formulas - visible, required, enabled\r\n            const context = this.getFormulaContext(entityGuid, attribute.Name, formValues, contentType.Attributes, inputType, merged);\r\n            const formulaItems = this.contentTypeItemService.getContentTypeItems(merged.Calculations);\r\n            const formulaVisible = this.runFormula(entityGuid, attribute.Name, FormulaTypes.Visible, context, formulaItems);\r\n            merged.VisibleInEditUI = formulaVisible === false ? false : merged.VisibleInEditUI;\r\n            const formulaRequired = this.runFormula(entityGuid, attribute.Name, FormulaTypes.Required, context, formulaItems);\r\n            merged.Required = formulaRequired === true ? true : merged.Required;\r\n            const formulaEnabled = this.runFormula(entityGuid, attribute.Name, FormulaTypes.Enabled, context, formulaItems);\r\n            merged.Disabled = formulaEnabled === false ? true : merged.Disabled;\r\n            // special fixes\r\n            merged.Name = merged.Name || attribute.Name;\r\n            merged.Required = ValidationHelper.isRequired(merged);\r\n            const slotIsEmpty = itemHeader.Group?.SlotCanBeEmpty && itemHeader.Group?.SlotIsEmpty;\r\n            merged.DisableTranslation = FieldsSettingsHelpers.findDisableTranslation(\r\n              inputType, attributeValues, defaultLanguage, attribute.Metadata,\r\n            );\r\n            merged.DisableTranslation = slotIsEmpty || merged.DisableTranslation;\r\n            merged.Disabled = slotIsEmpty || merged.Disabled;\r\n            merged.Disabled = FieldsSettingsHelpers.getDisabledBecauseTranslations(\r\n              attributeValues, merged.DisableTranslation, currentLanguage, defaultLanguage,\r\n            ) || merged.Disabled;\r\n            // update settings with respective FieldLogics\r\n            const logic = FieldLogicManager.singleton().get(attribute.InputType);\r\n            const fixed = logic?.update(merged, value) ?? merged;\r\n\r\n            // formulas - value\r\n            const formulaValue = this.runFormula(entityGuid, attribute.Name, FormulaTypes.Value, context, formulaItems);\r\n            // important to compare with undefined because null is allowed value\r\n            if (value !== undefined && formulaValue !== undefined) {\r\n              let valuesNotEqual = value !== formulaValue;\r\n              // do a more in depth comparisson in case of calculated entity fields\r\n              if (valuesNotEqual && Array.isArray(value) && Array.isArray(formulaValue)) {\r\n                valuesNotEqual = !GeneralHelpers.arraysEqual(value as string[], formulaValue as string[]);\r\n              }\r\n              if (!fixed.Disabled && valuesNotEqual) {\r\n                formulaUpdates[attribute.Name] = formulaValue;\r\n              }\r\n            }\r\n\r\n            const validators = ValidationHelper.getValidators(fixed, attribute);\r\n            const calculatedInputType = InputFieldHelpers.calculateInputType(attribute, inputTypes);\r\n            const wrappers = InputFieldHelpers.getWrappers(fixed, calculatedInputType);\r\n            const initialSettings = FieldsSettingsHelpers.mergeSettings<FieldSettings>(\r\n              attribute.Metadata, this.eavService.eavConfig.lang, defaultLanguage,\r\n            );\r\n            const initialDisabled = initialSettings.Disabled ?? false;\r\n            const fieldTranslation = FieldsSettingsHelpers.getTranslationState(\r\n              attributeValues, fixed.DisableTranslation, currentLanguage, defaultLanguage,\r\n            );\r\n\r\n            fieldsProps[attribute.Name] = {\r\n              calculatedInputType,\r\n              constants: {\r\n                angularAssets: inputType?.AngularAssets,\r\n                contentTypeId,\r\n                entityGuid,\r\n                fieldName: attribute.Name,\r\n                index: contentType.Attributes.indexOf(attribute),\r\n                initialDisabled,\r\n                inputType: calculatedInputType.inputType,\r\n                isExternal: calculatedInputType.isExternal,\r\n                isLastInGroup: FieldsSettingsHelpers.findIsLastInGroup(contentType, attribute),\r\n                type: attribute.Type,\r\n              },\r\n              settings: fixed,\r\n              translationState: fieldTranslation,\r\n              validators,\r\n              value,\r\n              wrappers,\r\n            };\r\n          }\r\n\r\n          if (Object.keys(formulaUpdates).length > 0 && this.maxValueFormulaCycles > this.valueFormulaCounter) {\r\n            this.valueFormulaCounter++;\r\n            this.itemService.updateItemAttributesValues(entityGuid, formulaUpdates, currentLanguage, defaultLanguage);\r\n            return;\r\n          }\r\n          this.valueFormulaCounter = 0;\r\n          return fieldsProps;\r\n        }),\r\n        filter(fieldsProps => !!fieldsProps),\r\n      ).subscribe(fieldsProps => {\r\n        this.fieldsProps$.next(fieldsProps);\r\n      })\r\n    );\r\n  }\r\n\r\n  getContentTypeSettings(): ContentTypeSettings {\r\n    return this.contentTypeSettings$.value;\r\n  }\r\n\r\n  getContentTypeSettings$(): Observable<ContentTypeSettings> {\r\n    return this.contentTypeSettings$.asObservable();\r\n  }\r\n\r\n  getFieldsProps(): FieldsProps {\r\n    return this.fieldsProps$.value;\r\n  }\r\n\r\n  getFieldsProps$(): Observable<FieldsProps> {\r\n    return this.fieldsProps$.asObservable();\r\n  }\r\n\r\n  getFieldSettings(fieldName: string): FieldSettings {\r\n    return this.fieldsProps$.value[fieldName].settings;\r\n  }\r\n\r\n  getFieldSettings$(fieldName: string): Observable<FieldSettings> {\r\n    return this.fieldsProps$.pipe(\r\n      map(fieldsSettings => fieldsSettings[fieldName].settings),\r\n      distinctUntilChanged(GeneralHelpers.objectsEqual),\r\n    );\r\n  }\r\n\r\n  getFieldValidation$(fieldName: string): Observable<ValidatorFn[]> {\r\n    return this.fieldsProps$.pipe(\r\n      map(fieldsSettings => fieldsSettings[fieldName].validators),\r\n      distinctUntilChanged(GeneralHelpers.arraysEqual),\r\n    );\r\n  }\r\n\r\n  getTranslationState$(fieldName: string): Observable<TranslationState> {\r\n    return this.fieldsProps$.pipe(\r\n      map(fieldsSettings => fieldsSettings[fieldName].translationState),\r\n      distinctUntilChanged(GeneralHelpers.objectsEqual),\r\n    );\r\n  }\r\n\r\n  forceSettings(): void {\r\n    this.forceSettings$.next();\r\n  }\r\n\r\n  private getFormulaContext(\r\n    entityGuid: string,\r\n    fieldName: string,\r\n    formValues: FormValues,\r\n    ctAttributes: EavContentTypeAttribute[],\r\n    inputType: InputType,\r\n    settings: FieldSettings,\r\n  ): FormulaContext {\r\n    const languageKey = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const languages = this.languageService.getLanguages();\r\n    const languageName = languages.find(l => l.key === languageKey)?.name;\r\n    const item = this.itemService.getItem(entityGuid);\r\n\r\n    const fields: Record<string, FormulaCtxField> = {};\r\n    for (const [name, value] of Object.entries(formValues)) {\r\n      fields[name] = {\r\n        name,\r\n        type: ctAttributes.find(a => a.Name === name)?.Type,\r\n        value,\r\n      };\r\n    }\r\n\r\n    const context: FormulaContext = {\r\n      culture: {\r\n        code: languageKey,\r\n        name: languageName,\r\n      },\r\n      entity: {\r\n        guid: item.Entity.Guid,\r\n        id: item.Entity.Id,\r\n      },\r\n      field: {\r\n        name: fieldName,\r\n        type: ctAttributes.find(a => a.Name === fieldName)?.Type,\r\n        value: formValues[fieldName],\r\n      },\r\n      fields,\r\n      value: {\r\n        current: formValues[fieldName],\r\n        get default() {\r\n          return InputFieldHelpers.parseDefaultValue(fieldName, inputType, settings, item.Header);\r\n        },\r\n      },\r\n    };\r\n    return context;\r\n  }\r\n\r\n  private runFormula(\r\n    entityGuid: string,\r\n    fieldName: string,\r\n    type: FormulaType,\r\n    context: FormulaContext,\r\n    formulaItems: EavEntity[],\r\n  ): FieldValue {\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n\r\n    const customFormula = this.formulaDesignerService.getFormula(entityGuid, fieldName, type);\r\n    if (customFormula) {\r\n      try {\r\n        const formulaFn = FormulaHelpers.buildFormulaFunction(customFormula);\r\n        const value = formulaFn(context);\r\n        this.formulaDesignerService.upsertFormulaResult(entityGuid, fieldName, type, value, false);\r\n        return value;\r\n      } catch (error) {\r\n        console.error(`Error while calculating designed formula \"${type}\" for field \"${context.field.name}\"`, error);\r\n        this.formulaDesignerService.upsertFormulaResult(entityGuid, fieldName, type, undefined, true);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const formulaItem = formulaItems.find(item => {\r\n      const target: string = LocalizationHelpers.translate(currentLanguage, defaultLanguage, item.Attributes.Target, null);\r\n      return target === type;\r\n    });\r\n    if (formulaItem == null) { return; }\r\n\r\n    const formula = LocalizationHelpers.translate(currentLanguage, defaultLanguage, formulaItem.Attributes.Formula, null);\r\n    if (formula == null) { return; }\r\n\r\n    const counter = this.formulaErrorCounters.find(c => c.entityGuid === entityGuid && c.fieldName === fieldName && c.type === type);\r\n    if (counter?.count >= this.maxFormulaErrors) { return; }\r\n\r\n    try {\r\n      const formulaFn = FormulaHelpers.buildFormulaFunction(formula);\r\n      const value = formulaFn(context);\r\n      return value;\r\n    } catch (error) {\r\n      if (!counter) {\r\n        const newCounter: FormulaErrorCounter = {\r\n          count: 1,\r\n          entityGuid,\r\n          fieldName,\r\n          type,\r\n        };\r\n        this.formulaErrorCounters.push(newCounter);\r\n        return;\r\n      }\r\n\r\n      counter.count++;\r\n      if (counter.count >= this.maxFormulaErrors) {\r\n        const ctSettings = this.getContentTypeSettings();\r\n        console.error(`Error while calculating formula \"${type}\" for field \"${fieldName}\" for entity \"${ctSettings._itemTitle}\". It will now be ignored.\\n\\n`, error);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EavService, FieldsSettingsService } from '.';\r\nimport { consoleLogAngular } from '../../../ng-dialogs/src/app/shared/helpers/console-log-angular.helper';\r\nimport { InputFieldHelpers, LocalizationHelpers } from '../helpers';\r\nimport { EavItem } from '../models/eav';\r\nimport { ContentTypeService, ItemService, LanguageInstanceService } from '../store/ngrx-data';\r\n\r\n@Injectable()\r\nexport class FieldsTranslateService {\r\n  private entityGuid: string;\r\n  private contentTypeId: string;\r\n\r\n  constructor(\r\n    private itemService: ItemService,\r\n    private languageInstanceService: LanguageInstanceService,\r\n    private eavService: EavService,\r\n    private contentTypeService: ContentTypeService,\r\n    private fieldsSettingsService: FieldsSettingsService,\r\n  ) { }\r\n\r\n  init(entityGuid: string): void {\r\n    this.entityGuid = entityGuid;\r\n    const item = this.itemService.getItem(entityGuid);\r\n    this.contentTypeId = InputFieldHelpers.getContentTypeId(item);\r\n  }\r\n\r\n  translate(fieldName: string, isTransaction = false, transactionItem?: EavItem): EavItem {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n\r\n    transactionItem = this.itemService.removeItemAttributeDimension(this.entityGuid, fieldName, currentLanguage, true, transactionItem);\r\n\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    const values = attributes[fieldName];\r\n    const defaultValue = LocalizationHelpers.getValueTranslation(values, defaultLanguage, defaultLanguage);\r\n    const contentType = this.contentTypeService.getContentType(this.contentTypeId);\r\n    const ctAttribute = contentType.Attributes.find(a => a.Name === fieldName);\r\n    transactionItem = this.itemService.addItemAttributeValue(\r\n      this.entityGuid, fieldName, defaultValue.Value, currentLanguage, false, ctAttribute.Type, isTransaction, transactionItem,\r\n    );\r\n    return transactionItem;\r\n  }\r\n\r\n  dontTranslate(fieldName: string, isTransaction = false, transactionItem?: EavItem): EavItem {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    transactionItem = this.itemService.removeItemAttributeDimension(\r\n      this.entityGuid, fieldName, currentLanguage, isTransaction, transactionItem,\r\n    );\r\n    return transactionItem;\r\n  }\r\n\r\n  copyFrom(fieldName: string, copyFromLanguageKey: string): void {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    const values = attributes[fieldName];\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const attributeValueTranslation = LocalizationHelpers.getValueTranslation(values, copyFromLanguageKey, defaultLanguage);\r\n    if (attributeValueTranslation) {\r\n      const valueAlreadyExists = values\r\n        ? LocalizationHelpers.isEditableOrReadonlyTranslationExist(values, currentLanguage, defaultLanguage)\r\n        : false;\r\n\r\n      if (valueAlreadyExists) {\r\n        // Copy attribute value where language is languageKey to value where language is current language\r\n        this.itemService.updateItemAttributeValue(\r\n          this.entityGuid, fieldName, attributeValueTranslation.Value, currentLanguage, defaultLanguage, false,\r\n        );\r\n      } else {\r\n        // Copy attribute value where language is languageKey to new attribute with current language\r\n        const contentType = this.contentTypeService.getContentType(this.contentTypeId);\r\n        const ctAttribute = contentType.Attributes.find(a => a.Name === fieldName);\r\n        this.itemService.addItemAttributeValue(\r\n          this.entityGuid, fieldName, attributeValueTranslation.Value, currentLanguage, false, ctAttribute.Type,\r\n        );\r\n      }\r\n    } else {\r\n      consoleLogAngular(`${currentLanguage}: Cant copy value from ${copyFromLanguageKey} because that value does not exist.`);\r\n    }\r\n  }\r\n\r\n  linkReadOnly(fieldName: string, linkWithLanguageKey: string): void {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const transactionItem = this.itemService.removeItemAttributeDimension(this.entityGuid, fieldName, currentLanguage, true);\r\n    this.itemService.addItemAttributeDimension(\r\n      this.entityGuid, fieldName, currentLanguage, linkWithLanguageKey, defaultLanguage, true, transactionItem,\r\n    );\r\n  }\r\n\r\n  linkReadWrite(fieldName: string, linkWithLanguageKey: string): void {\r\n    if (this.isTranslationDisabled(fieldName)) { return; }\r\n\r\n    const currentLanguage = this.languageInstanceService.getCurrentLanguage(this.eavService.eavConfig.formId);\r\n    const defaultLanguage = this.languageInstanceService.getDefaultLanguage(this.eavService.eavConfig.formId);\r\n    const transactionItem = this.itemService.removeItemAttributeDimension(this.entityGuid, fieldName, currentLanguage, true);\r\n    this.itemService.addItemAttributeDimension(\r\n      this.entityGuid, fieldName, currentLanguage, linkWithLanguageKey, defaultLanguage, false, transactionItem,\r\n    );\r\n  }\r\n\r\n  translateMany(): void {\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    const translateable = Object.keys(attributes).filter(fieldName => !this.isTranslationDisabled(fieldName));\r\n\r\n    let transactionItem: EavItem;\r\n    for (const fieldName of translateable) {\r\n      // will finish the transaction when last field is being translated\r\n      const isTransaction = fieldName !== translateable[translateable.length - 1];\r\n      transactionItem = this.translate(fieldName, isTransaction, transactionItem);\r\n    }\r\n  }\r\n\r\n  dontTranslateMany(): void {\r\n    const attributes = this.itemService.getItemAttributes(this.entityGuid);\r\n    const translateable = Object.keys(attributes).filter(fieldName => !this.isTranslationDisabled(fieldName));\r\n\r\n    let transactionItem: EavItem;\r\n    for (const fieldName of translateable) {\r\n      // will finish the transaction when last field is being translated\r\n      const isTransaction = fieldName !== translateable[translateable.length - 1];\r\n      transactionItem = this.dontTranslate(fieldName, isTransaction, transactionItem);\r\n    }\r\n  }\r\n\r\n  private isTranslationDisabled(fieldName: string) {\r\n    const fieldsProps = this.fieldsSettingsService.getFieldsProps();\r\n    return fieldsProps[fieldName].settings.DisableTranslation;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\n\r\n@Injectable()\r\nexport class FileTypeService {\r\n  private defaultIcon = 'file';\r\n  private checkImgRegEx = /(?:([^:\\/?#]+):)?(?:\\/\\/([^\\/?#]*))?([^?#]*\\.(?:jpg|jpeg|gif|png))(?:\\?([^#]*))?(?:#(.*))?/i;\r\n  private customExtensions: Dictionary<string> = {\r\n    doc: 'file-word',\r\n    docx: 'file-word',\r\n    xls: 'file-excel',\r\n    xlsx: 'file-excel',\r\n    ppt: 'file-powerpoint',\r\n    pptx: 'file-powerpoint',\r\n    pdf: 'file-pdf',\r\n    mp3: 'file-audio',\r\n    avi: 'file-video',\r\n    mpg: 'file-video',\r\n    mpeg: 'file-video',\r\n    mov: 'file-video',\r\n    mp4: 'file-video',\r\n    zip: 'file-archive',\r\n    rar: 'file-archive',\r\n    txt: 'file-text',\r\n    html: 'file-code',\r\n    css: 'file-code',\r\n    xml: 'file-code',\r\n    xsl: 'file-code',\r\n  };\r\n\r\n  private matExtensions: Dictionary<string> = {\r\n    vcf: 'person',\r\n  };\r\n\r\n  constructor() { }\r\n\r\n  getExtension(filename: string) {\r\n    return filename.substring(filename.lastIndexOf('.') + 1).toLocaleLowerCase();\r\n  }\r\n\r\n  getIconClass(filename: string) {\r\n    const ext = this.getExtension(filename);\r\n    return this.matExtensions[ext] || this.customExtensions[ext] || this.defaultIcon;\r\n  }\r\n\r\n  isKnownType(filename: string) {\r\n    return this.matExtensions[this.getExtension(filename)] != null;\r\n  }\r\n\r\n  isImage(filename: string) {\r\n    return this.checkImgRegEx.test(filename);\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { EavService } from '.';\r\nimport { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\n\r\n@Injectable()\r\nexport class FormsStateService implements OnDestroy {\r\n  formsValid$: BehaviorSubject<boolean>;\r\n  formsDirty$: BehaviorSubject<boolean>;\r\n\r\n  private formsValid: Dictionary<boolean>;\r\n  private formsDirty: Dictionary<boolean>;\r\n\r\n  constructor(private eavService: EavService) { }\r\n\r\n  ngOnDestroy() {\r\n    this.formsValid$?.complete();\r\n    this.formsDirty$?.complete();\r\n  }\r\n\r\n  init() {\r\n    this.formsValid$ = new BehaviorSubject(false);\r\n    this.formsDirty$ = new BehaviorSubject(false);\r\n    this.formsValid = {};\r\n    this.formsDirty = {};\r\n    for (const entityGuid of this.eavService.eavConfig.itemGuids) {\r\n      this.formsValid[entityGuid] = false;\r\n      this.formsDirty[entityGuid] = false;\r\n    }\r\n  }\r\n\r\n  getFormValid(entityGuid: string) {\r\n    return this.formsValid[entityGuid];\r\n  }\r\n\r\n  setFormValid(entityGuid: string, isValid: boolean) {\r\n    this.formsValid[entityGuid] = isValid;\r\n\r\n    const allValid = !Object.values(this.formsValid).some(valid => valid === false);\r\n    if (allValid !== this.formsValid$.value) {\r\n      this.formsValid$.next(allValid);\r\n    }\r\n  }\r\n\r\n  setFormDirty(entityGuid: string, isDirty: boolean) {\r\n    this.formsDirty[entityGuid] = isDirty;\r\n\r\n    const anyDirty = Object.values(this.formsDirty).some(dirty => dirty === true);\r\n    if (anyDirty !== this.formsDirty$.value) {\r\n      this.formsDirty$.next(anyDirty);\r\n    }\r\n  }\r\n}\r\n","import appleFilled from '!raw-loader!../../assets/icons/2sxc/Material-Icon-Adam-48-filled.svg';\r\nimport apple from '!raw-loader!../../assets/icons/2sxc/Material-Icon-Adam-48.svg';\r\nimport draftBranch from '!raw-loader!../../assets/icons/font-awesome/draft-branch.svg';\r\nimport fileArchive from '!raw-loader!../../assets/icons/font-awesome/file-archive.svg';\r\nimport fileAudio from '!raw-loader!../../assets/icons/font-awesome/file-audio.svg';\r\nimport fileCode from '!raw-loader!../../assets/icons/font-awesome/file-code.svg';\r\nimport fileExcel from '!raw-loader!../../assets/icons/font-awesome/file-excel.svg';\r\nimport fileImage from '!raw-loader!../../assets/icons/font-awesome/file-image.svg';\r\nimport filePdf from '!raw-loader!../../assets/icons/font-awesome/file-pdf.svg';\r\nimport filePowerpoint from '!raw-loader!../../assets/icons/font-awesome/file-powerpoint.svg';\r\nimport fileText from '!raw-loader!../../assets/icons/font-awesome/file-text.svg';\r\nimport fileVideo from '!raw-loader!../../assets/icons/font-awesome/file-video.svg';\r\nimport fileWord from '!raw-loader!../../assets/icons/font-awesome/file-word.svg';\r\nimport file from '!raw-loader!../../assets/icons/font-awesome/file.svg';\r\nimport folderPlus from '!raw-loader!../../assets/icons/font-awesome/folder-plus.svg';\r\nimport folder from '!raw-loader!../../assets/icons/font-awesome/folder.svg';\r\nimport sitemap from '!raw-loader!../../assets/icons/font-awesome/sitemap.svg';\r\nimport { Injectable } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\n\r\n@Injectable()\r\nexport class LoadIconsService {\r\n  private icons: Dictionary<string> = {\r\n    apple,\r\n    appleFilled,\r\n    'draft-branch': draftBranch,\r\n    file,\r\n    'file-archive': fileArchive,\r\n    'file-audio': fileAudio,\r\n    'file-code': fileCode,\r\n    'file-excel': fileExcel,\r\n    'file-image': fileImage,\r\n    'file-pdf': filePdf,\r\n    'file-powerpoint': filePowerpoint,\r\n    'file-text': fileText,\r\n    'file-video': fileVideo,\r\n    'file-word': fileWord,\r\n    folder,\r\n    'folder-plus': folderPlus,\r\n    sitemap,\r\n  };\r\n\r\n  constructor(private matIconRegistry: MatIconRegistry, private domSanitizer: DomSanitizer) { }\r\n\r\n  load() {\r\n    Object.entries(this.icons).forEach(([name, svg]) => {\r\n      this.matIconRegistry.addSvgIconLiteral(name, this.domSanitizer.bypassSecurityTrustHtml(svg));\r\n    });\r\n  }\r\n}\r\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 48 48\\\">\\r\\n<style type=\\\"text/css\\\">\\r\\n\\t.st0{display:none;}\\r\\n\\t.st1{display:inline;}\\r\\n</style>\\r\\n<g id=\\\"Layer_1\\\">\\r\\n\\t<path d=\\\"M32,4c-6,0-10,4-10,10C28,14,32,10,32,4z\\\"/>\\r\\n</g>\\r\\n<g id=\\\"Layer_3\\\" class=\\\"st0\\\">\\r\\n</g>\\r\\n<g id=\\\"Icon\\\">\\r\\n\\t<path d=\\\"M32,20c3.7,0,6,2.1,6,5.47C38,33.21,33.01,40,30.06,40c-0.25-0.04-0.93-0.35-1.38-0.56c-1.25-0.58-2.8-1.3-4.68-1.3\\r\\n\\t\\ts-3.43,0.72-4.68,1.3C18.87,39.65,18.19,39.97,18,40c-3.01,0-8-6.79-8-14.53C10,22.1,12.3,20,16,20c2.44,0,5.29,1.17,6.17,1.62\\r\\n\\t\\tL24,22.56l1.83-0.94C26.64,21.2,29.53,20,32,20 M32,16c-4,0-8,2.06-8,2.06S20,16,16,16c-6,0-10,4.01-10,9.47C6,34.74,12,44,18,44\\r\\n\\t\\tc2,0,4-1.85,6-1.85S28,44,30,44c6,0,12-9.26,12-18.53C42,20.01,38,16,32,16L32,16z\\\"/>\\r\\n</g>\\r\\n</svg>\\r\\n\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 48 48\\\">\\r\\n<style type=\\\"text/css\\\">\\r\\n\\t.st0{display:none;}\\r\\n\\t.st1{display:inline;}\\r\\n</style>\\r\\n<g id=\\\"Layer_1\\\">\\r\\n\\t<path d=\\\"M32,4c-6,0-10,4-10,10C28,14,32,10,32,4z\\\"/>\\r\\n</g>\\r\\n<g id=\\\"Layer_3\\\" class=\\\"st0\\\">\\r\\n</g>\\r\\n<g id=\\\"Icon\\\">\\r\\n\\t<path d=\\\"M32,16c-4,0-8,2.06-8,2.06S20,16,16,16c-6,0-10,4.01-10,9.47C6,34.74,12,44,18,44c2,0,4-1.85,6-1.85S28,44,30,44\\r\\n\\t\\tc6,0,12-9.26,12-18.53C42,20.01,38,16,32,16L32,16z\\\"/>\\r\\n</g>\\r\\n</svg>\\r\\n\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 39.2 28.2 71.8 65.5 78.7-.8 17.2-5 30.4-12.7 40-17.5 21.8-53.1 25.2-90.7 28.7-28.2 2.6-57.4 5.4-80.4 16.9-3.4 1.7-6.7 3.6-9.7 5.7V158.4c36.5-7.4 64-39.7 64-78.4 0-44.2-35.8-80-80-80S0 35.8 0 80c0 38.7 27.5 71 64 78.4v195.2C27.5 361 0 393.3 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-36.9-24.9-67.9-58.9-77.2 5-9.6 12.3-14.6 19-18 17.5-8.8 42.5-11.2 68.9-13.7 42.6-4 86.7-8.1 112.7-40.5 12.4-15.5 19-35.5 19.8-60.7C357.3 214 384 182.1 384 144zM32 80c0-26.5 21.5-48 48-48s48 21.5 48 48-21.5 48-48 48-48-21.5-48-48zm96 352c0 26.5-21.5 48-48 48s-48-21.5-48-48c0-26.4 21.4-47.9 47.8-48h.6c26.3.2 47.6 21.7 47.6 48zm187.8-241.5L304 192c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48c0 22.4-15.4 41.2-36.2 46.5z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M128 96v32h32V96zm65.9 169.6c-1.1-5.6-6-9.6-11.8-9.6H160v-32h-32v32l-19.4 97.2c-6.5 32.5 18.3 62.8 51.4 62.8s57.9-30.3 51.4-62.8zm-33.6 124.5c-17.9 0-32.4-12.1-32.4-27s14.5-27 32.4-27 32.4 12.1 32.4 27-14.5 27-32.4 27zM128 160v32h32v-32zm64-96h-32v32h32zm177.9 33.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM256 32.5c2.8.7 5.4 2.1 7.4 4.2l83.9 83.9c2 2 3.5 4.6 4.2 7.4H256zM352 464c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h79.7v32h32V32H224v104c0 13.3 10.7 24 24 24h104zM192 192h-32v32h32zm0-64h-32v32h32z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-77.6-66.6c38.5-26 61.6-69.3 61.6-115.7 0-24.7-6.5-48.9-18.9-70.1-12-20.6-29.1-37.8-49.6-50-7.1-4.2-16.3-1.9-20.6 5.2-4.2 7.1-1.9 16.3 5.2 20.6 33.1 19.7 53.7 55.8 53.7 94.3 0 36.5-18.1 70.4-48.3 90.9-6.9 4.6-8.7 14-4 20.8 2.9 4.3 7.6 6.6 12.4 6.6 3.1 0 6-.8 8.5-2.6zm-26.6-38.3c26-17.3 41.5-46.2 41.5-77.4 0-32.9-17.7-63.7-46.2-80.3-7.2-4.2-16.3-1.7-20.5 5.4-4.2 7.2-1.7 16.3 5.4 20.5 19.3 11.2 31.3 32 31.3 54.3 0 21.1-10.5 40.7-28.1 52.4-6.9 4.6-8.8 13.9-4.2 20.8 2.9 4.4 7.7 6.7 12.5 6.7 2.8.1 5.7-.7 8.3-2.4zm-27-38.2c13.7-8.5 21.8-23.1 21.8-39.2 0-17-9.3-32.5-24.2-40.6-7.3-3.9-16.4-1.2-20.3 6.1-3.9 7.3-1.2 16.4 6.1 20.3 5.2 2.8 8.5 8.3 8.5 14.2 0 5.6-2.9 10.8-7.6 13.7-7 4.4-9.2 13.6-4.8 20.7 2.8 4.6 7.7 7.1 12.8 7.1 2.5 0 5.2-.7 7.7-2.3zM138 266.7v74.7L112 322H94v-36h18l26-19.3m17.9-50.7c-2.9 0-6 1.1-8.4 3.5L104 256H76c-6.6 0-12 5.4-12 12v72c0 6.6 5.4 12 12 12h28l43.5 36.5c2.4 2.4 5.4 3.5 8.4 3.5 6.2 0 12.1-4.8 12.1-12V228c0-7.2-5.9-12-12.1-12z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.941 97.941l-83.882-83.882A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v416c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48V131.882a48 48 0 0 0-14.059-33.941zm-22.627 22.628a15.89 15.89 0 0 1 4.195 7.431H256V32.491a15.88 15.88 0 0 1 7.431 4.195l83.883 83.883zM336 480H48c-8.837 0-16-7.163-16-16V48c0-8.837 7.163-16 16-16h176v104c0 13.255 10.745 24 24 24h104v304c0 8.837-7.163 16-16 16zm-161.471-67.404l-25.928-7.527a5.1 5.1 0 0 1-3.476-6.32l58.027-199.869a5.1 5.1 0 0 1 6.32-3.476l25.927 7.527a5.1 5.1 0 0 1 3.476 6.32L180.849 409.12a5.1 5.1 0 0 1-6.32 3.476zm-48.446-47.674l18.492-19.724a5.101 5.101 0 0 0-.351-7.317L105.725 304l38.498-33.881a5.1 5.1 0 0 0 .351-7.317l-18.492-19.724a5.1 5.1 0 0 0-7.209-.233L57.61 300.279a5.1 5.1 0 0 0 0 7.441l61.263 57.434a5.1 5.1 0 0 0 7.21-.232zm139.043.232l61.262-57.434a5.1 5.1 0 0 0 0-7.441l-61.262-57.434a5.1 5.1 0 0 0-7.209.233l-18.492 19.724a5.101 5.101 0 0 0 .351 7.317L278.275 304l-38.499 33.881a5.1 5.1 0 0 0-.351 7.317l18.492 19.724a5.1 5.1 0 0 0 7.209.232z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zM211.7 308l50.5-81.8c4.8-8-.9-18.2-10.3-18.2h-4.1c-4.1 0-7.9 2.1-10.1 5.5-31 48.5-36.4 53.5-45.7 74.5-17.2-32.2-8.4-16-45.8-74.5-2.2-3.4-6-5.5-10.1-5.5H132c-9.4 0-15.1 10.3-10.2 18.2L173 308l-59.1 89.5c-5.1 8 .6 18.5 10.1 18.5h3.5c4.1 0 7.9-2.1 10.1-5.5 37.2-58 45.3-62.5 54.4-82.5 31.5 56.7 44.3 67.2 54.4 82.6 2.2 3.4 6 5.4 10 5.4h3.6c9.5 0 15.2-10.4 10.1-18.4L211.7 308z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M159 336l-39.5-39.5c-4.7-4.7-12.3-4.7-17 0l-39 39L63 448h256V304l-55.5-55.5c-4.7-4.7-12.3-4.7-17 0L159 336zm96-50.7l32 32V416H95.1l.3-67.2 15.6-15.6 48 48c20.3-20.3 77.7-77.6 96-95.9zM127 256c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm0-96c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm242.9-62.1L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM256 32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5zM352 464c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-22-171.2c-13.5-13.3-55-9.2-73.7-6.7-21.2-12.8-35.2-30.4-45.1-56.6 4.3-18 12-47.2 6.4-64.9-4.4-28.1-39.7-24.7-44.6-6.8-5 18.3-.3 44.4 8.4 77.8-11.9 28.4-29.7 66.9-42.1 88.6-20.8 10.7-54.1 29.3-58.8 52.4-3.5 16.8 22.9 39.4 53.1 6.4 9.1-9.9 19.3-24.8 31.3-45.5 26.7-8.8 56.1-19.8 82-24 21.9 12 47.6 19.9 64.6 19.9 27.7.1 28.9-30.2 18.5-40.6zm-229.2 89c5.9-15.9 28.6-34.4 35.5-40.8-22.1 35.3-35.5 41.5-35.5 40.8zM180 175.5c8.7 0 7.8 37.5 2.1 47.6-5.2-16.3-5-47.6-2.1-47.6zm-28.4 159.3c11.3-19.8 21-43.2 28.8-63.7 9.7 17.7 22.1 31.7 35.1 41.5-24.3 4.7-45.4 15.1-63.9 22.2zm153.4-5.9s-5.8 7-43.5-9.1c41-3 47.7 6.4 43.5 9.1z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zM204.3 208H140c-6.6 0-12 5.4-12 12v184c0 6.6 5.4 12 12 12h8c6.6 0 12-5.4 12-12v-60.4h44.3c38.7 0 67.7-27.3 67.7-69 0-38.6-23.8-66.6-67.7-66.6zm26 97.7c-7.5 7.6-17.8 11.4-31 11.4H160V233h39.7c12.9 0 23.1 3.7 30.6 11.1 15.3 15.1 15 46.5 0 61.6z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-48-244v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm0 64v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm0 64v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M224 280.593C224 267.01 212.989 256 199.407 256H88.593C75.011 256 64 267.01 64 280.593v110.815C64 404.99 75.011 416 88.593 416h110.814C212.989 416 224 404.99 224 391.407V381l27.971 27.971a23.998 23.998 0 0 0 16.97 7.029H296c13.255 0 24-10.745 24-24V280c0-13.255-10.745-24-24-24h-27.059a24.003 24.003 0 0 0-16.97 7.029L224 291v-10.407zM192 384H96v-96h96v96zm80.255-96H288v96h-15.745L224 342.826v-13.652L272.255 288zm97.686-190.059l-83.883-83.882A47.996 47.996 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v416c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48V131.882a48 48 0 0 0-14.059-33.941zM256 32.491a15.888 15.888 0 0 1 7.432 4.195l83.882 83.882a15.882 15.882 0 0 1 4.195 7.431H256V32.491zM352 464c0 8.837-7.164 16-16 16H48c-8.836 0-16-7.163-16-16V48c0-8.837 7.164-16 16-16h176v104c0 13.255 10.745 24 24 24h104v304z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 384 512\\\"><path d=\\\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16zm-53.6-246.5c-6.8 32.8-32.5 139.7-33.4 150.3-5.8-29.1-.7 1.6-41.8-150.9-1.4-5.2-6.2-8.9-11.6-8.9h-6.4c-5.4 0-10.2 3.6-11.6 8.9-38.3 142.3-37.4 140.6-39.4 154.7-4.1-23.9 2.1-2.9-34.4-154.4-1.3-5.4-6.1-9.2-11.7-9.2h-7.2c-7.8 0-13.5 7.3-11.6 14.9 9.5 38 34.5 137.4 42.2 168 1.3 5.3 6.1 9.1 11.6 9.1h17c5.4 0 10.2-3.7 11.6-8.9 34.2-127.7 33.5-123.4 36.7-142.9 6.5 31.1.2 7 36.7 142.9 1.4 5.2 6.2 8.9 11.6 8.9h14c5.5 0 13.7-3.7 15.1-9l42.8-168c1.9-7.6-3.8-15-11.6-15h-6.8c-5.7 0-10.6 4-11.8 9.5z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path d=\\\"M194.74 96l54.63 54.63c6 6 14.14 9.37 22.63 9.37h192c8.84 0 16 7.16 16 16v224c0 8.84-7.16 16-16 16H48c-8.84 0-16-7.16-16-16V112c0-8.84 7.16-16 16-16h146.74M48 64C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 512 512\\\"><path d=\\\"M344 272h-72v-72c0-4.42-3.58-8-8-8h-16c-4.42 0-8 3.58-8 8v72h-72c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8h72v72c0 4.42 3.58 8 8 8h16c4.42 0 8-3.58 8-8v-72h72c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zM194.74 96l54.63 54.63c6 6 14.14 9.37 22.63 9.37h192c8.84 0 16 7.16 16 16v224c0 8.84-7.16 16-16 16H48c-8.84 0-16-7.16-16-16V112c0-8.84 7.16-16 16-16h146.74M48 64C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48z\\\"/></svg>\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 640 512\\\"><path d=\\\"M608 352h-32v-97.59c0-16.77-13.62-30.41-30.41-30.41H336v-64h48c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H256c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h48v64H94.41C77.62 224 64 237.64 64 254.41V352H32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32H96v-96h208v96h-32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32h-32v-96h208v96h-32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zm-480 32v96H32v-96h96zm240 0v96h-96v-96h96zM256 128V32h128v96H256zm352 352h-96v-96h96v96z\\\"/></svg>\";","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { Context } from '../../../ng-dialogs/src/app/shared/services/context';\r\nimport { QueryStreams } from '../../eav-material-controls/input-types/entity/entity-query/entity-query.models';\r\n\r\n@Injectable()\r\nexport class QueryService {\r\n  constructor(private http: HttpClient, private dnnContext: DnnContext, private context: Context) { }\r\n\r\n  getAvailableEntities(queryUrl: string, includeGuid: boolean, params: string, entitiesFilter?: string[]): Observable<QueryStreams> {\r\n    // Check if any params we should auto-add are already set (like in a query which has these params set in the configuration)\r\n    const hasParams = !!params;\r\n    const paramsLower = params?.toLocaleLowerCase() ?? '';\r\n    const hasAppId = paramsLower.includes('appid=') ?? false;\r\n    const hasGuid = paramsLower.includes('includeguid=') ?? false;\r\n    const allParams =\r\n      (hasGuid ? '' : `&includeGuid=${includeGuid}`)\r\n      + (hasAppId ? '' : `&appId=${this.context.appId}`)\r\n      + (hasParams ? `&${params}` : '');\r\n    // trim initial & because it will always start with an & and it should't\r\n    const urlParams = allParams.substring(1);\r\n    return this.http.post<QueryStreams>(\r\n      this.dnnContext.$2sxc.http.apiUrl(`app/auto/query/${queryUrl}?${urlParams}`),\r\n      { Guids: entitiesFilter },\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EavService } from '.';\r\nimport { EavWindow } from '../../../ng-dialogs/src/app/shared/models/eav-window.model';\r\nimport { UrlHelpers } from '../helpers';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport enum FileTypeConstants {\r\n  CSS = '.css',\r\n  JS = '.js',\r\n}\r\n\r\nexport interface LoadFile {\r\n  path: string;\r\n  type: string;\r\n  loaded: boolean;\r\n  domEl: HTMLLinkElement | HTMLScriptElement;\r\n}\r\n\r\n@Injectable()\r\nexport class ScriptsLoaderService {\r\n  private loadedFiles: LoadFile[] = [];\r\n\r\n  constructor(private eavService: EavService) { }\r\n\r\n  /** Loads CSS and JS files in order (CSS first) and calls callback function when finished */\r\n  load(scripts: string[], callback: () => void) {\r\n    const sortedFiles = this.sortByType(scripts);\r\n    this.insertToDom(sortedFiles, callback, 0); // async, called again and again after each script is loaded\r\n  }\r\n\r\n  private sortByType(scripts: string[]): LoadFile[] {\r\n    const cssFiles: LoadFile[] = [];\r\n    const jsFiles: LoadFile[] = [];\r\n    scripts.forEach(script => {\r\n      const file: LoadFile = {\r\n        path: this.resolveSpecialPaths(script),\r\n        type: null,\r\n        loaded: false,\r\n        domEl: null\r\n      };\r\n      if (file.path.endsWith(FileTypeConstants.CSS)) {\r\n        file.type = FileTypeConstants.CSS;\r\n        cssFiles.push(file);\r\n      } else if (file.path.endsWith(FileTypeConstants.JS)) {\r\n        file.type = FileTypeConstants.JS;\r\n        jsFiles.push(file);\r\n      }\r\n    });\r\n    return cssFiles.concat(jsFiles);\r\n  }\r\n\r\n  private insertToDom(files: LoadFile[], callback: () => void, increment: number) {\r\n    const file = files[increment];\r\n    increment++;\r\n    if (!file) {\r\n      callback();\r\n      return;\r\n    }\r\n    file.path = file.path + '?sxcver=' + window.sxcVersion; // break cache\r\n\r\n    const existing = this.loadedFiles.find(loadedFile => loadedFile.path === file.path);\r\n    if (existing) {\r\n      if (existing.loaded) {\r\n        this.insertToDom(files, callback, increment);\r\n      } else {\r\n        const _listener = () => {\r\n          file.loaded = true;\r\n          this.insertToDom(files, callback, increment);\r\n          existing.domEl.removeEventListener('load', _listener);\r\n          existing.domEl.removeEventListener('error', _listener);\r\n        };\r\n        existing.domEl.addEventListener('load', _listener);\r\n        existing.domEl.addEventListener('error', _listener);\r\n      }\r\n    } else {\r\n      if (file.type === FileTypeConstants.CSS) {\r\n        file.domEl = document.createElement('link');\r\n        file.domEl.rel = 'stylesheet';\r\n        file.domEl.href = file.path;\r\n      } else if (file.type === FileTypeConstants.JS) {\r\n        file.domEl = document.createElement('script');\r\n        file.domEl.type = 'module';\r\n        file.domEl.src = file.path;\r\n      }\r\n\r\n      const _listener = () => {\r\n        file.loaded = true;\r\n        this.insertToDom(files, callback, increment);\r\n        file.domEl.removeEventListener('load', _listener);\r\n        file.domEl.removeEventListener('error', _listener);\r\n      };\r\n      file.domEl.addEventListener('load', _listener);\r\n      file.domEl.addEventListener('error', _listener);\r\n\r\n      document.querySelector('head').appendChild(file.domEl);\r\n      this.loadedFiles.push(file);\r\n    }\r\n  }\r\n\r\n  private resolveSpecialPaths(url: string) {\r\n    return url.replace(/\\[System:Path\\]/i, UrlHelpers.getUrlPrefix('system', this.eavService.eavConfig))\r\n      .replace(/\\[Zone:Path\\]/i, UrlHelpers.getUrlPrefix('zone', this.eavService.eavConfig))\r\n      .replace(/\\[App:Path\\]/i, UrlHelpers.getUrlPrefix('app', this.eavService.eavConfig));\r\n  }\r\n}\r\n","import { FormControl, ValidationErrors, ValidatorFn } from '@angular/forms';\r\nimport { Dictionary } from '../../../ng-dialogs/src/app/shared/models/dictionary.model';\r\nimport { UrlHelpers } from '../../shared/helpers';\r\nimport { AdamControl } from '../input-types/hyperlink/hyperlink-library/hyperlink-library.models';\r\n\r\nexport class CustomValidators {\r\n\r\n  /** Validate url chars */\r\n  static onlySimpleUrlChars(allowPath: boolean, trimEnd: boolean): ValidationErrors {\r\n    return (control: FormControl): Dictionary<boolean> => {\r\n      const cleanInputValue = UrlHelpers.stripNonUrlCharacters(control.value, allowPath, trimEnd);\r\n      return (cleanInputValue === control.value) ? null : { onlySimpleUrlChars: true };\r\n    };\r\n  }\r\n\r\n  // create a static method for your validation\r\n  static validateDecimals(decimals: number): ValidatorFn {\r\n    return (control: FormControl): Dictionary<boolean> => {\r\n      if (!control.value) {\r\n        return null;\r\n      }\r\n\r\n      const matches = control.value.toString().match(`^-?[0-9]+(\\.[0-9]{1,${decimals}})?$`);\r\n      return !matches ? { decimals: true } : null;\r\n    };\r\n  }\r\n\r\n  static validateAdam(): ValidatorFn {\r\n    return (control: FormControl & AdamControl): Dictionary<boolean> => {\r\n      if (control.adamItems == null || control.adamItems === 0) {\r\n        return { required: true };\r\n      }\r\n\r\n      return null;\r\n    };\r\n  }\r\n}\r\n","export class InputTypeConstants {\r\n    // String\r\n    public static readonly StringDefault = 'string-default';\r\n    public static readonly StringUrlPath = 'string-url-path';\r\n    public static readonly StringDropdown = 'string-dropdown';\r\n    public static readonly StringDropdownQuery = 'string-dropdown-query';\r\n    public static readonly StringFontIconPicker = 'string-font-icon-picker';\r\n    public static readonly StringTemplatePicker = 'string-template-picker';\r\n    public static readonly StringWysiwyg = 'string-wysiwyg';\r\n    // Boolean\r\n    public static readonly BooleanDefault = 'boolean-default';\r\n    public static readonly BooleanTristate = 'boolean-tristate';\r\n    // DateTime\r\n    public static readonly DatetimeDefault = 'datetime-default';\r\n    // Empty\r\n    public static readonly EmptyDefault = 'empty-default';\r\n    // Number\r\n    public static readonly NumberDefault = 'number-default';\r\n    // Entity\r\n    public static readonly EntityDefault = 'entity-default';\r\n    public static readonly EntityQuery = 'entity-query';\r\n    public static readonly EntityContentBlocks = 'entity-content-blocks';\r\n    // Hyperlink\r\n    public static readonly HyperlinkDefault = 'hyperlink-default';\r\n    public static readonly HyperlinkLibrary = 'hyperlink-library';\r\n    // Custom\r\n    public static readonly ExternalWebComponent = 'external-web-component';\r\n    public static readonly CustomGPS = 'custom-gps';\r\n    public static readonly CustomJsonEditor = 'custom-json-editor';\r\n    public static readonly CustomDefault = 'custom-default';\r\n    // Old\r\n    public static readonly OldTypeDropdown = 'dropdown';\r\n    public static readonly OldTypeWysiwyg = 'wysiwyg';\r\n    public static readonly OldTypeDefault = 'default';\r\n    public static readonly StringWysiwygTinymce = 'string-wysiwyg-tinymce';\r\n    public static readonly StringWysiwygAdv = 'string-wysiwyg-adv';\r\n    public static readonly StringWysiwygDnn = 'string-wysiwyg-dnn';\r\n    // Default\r\n    public static readonly DefaultSuffix = '-default';\r\n}\r\n","export type EavMetadataKey = 'attribute' | 'app' | 'entity' | 'contentType' | 'zone' | 'cmsObject';\r\nexport type EavKeyTypeKey = 'guid' | 'string' | 'number';\r\nexport interface EavScopeOption { name: string; value: string; }\r\n\r\nexport const eavConstants = {\r\n  metadata: {\r\n    /** metadataOfAttribute */\r\n    attribute: { type: 2, target: 'EAV Field Properties' },\r\n    /** metadataOfApp */\r\n    app: { type: 3, target: 'App' },\r\n    /** metadataOfEntity */\r\n    entity: { type: 4, target: 'Entity' },\r\n    /** metadataOfContentType */\r\n    contentType: { type: 5, target: 'ContentType' },\r\n    /** metadataOfZone */\r\n    zone: { type: 6, target: 'Zone' },\r\n    /** metadataOfCmsObject */\r\n    cmsObject: { type: 10, target: 'CmsObject' },\r\n  },\r\n\r\n  /** Loopup type for the metadata, e.g. key=80adb152-efad-4aa4-855e-74c5ef230e1f is keyType=guid */\r\n  keyTypes: {\r\n    guid: 'guid',\r\n    string: 'string',\r\n    number: 'number',\r\n  },\r\n\r\n  /** Scopes */\r\n  scopes: {\r\n    /** This is the main schema and the data you usually see is from here */\r\n    default: { name: 'Default', value: '2SexyContent' },\r\n    /** This contains content-types for configuration, settings and resources of the app */\r\n    app: { name: 'System: App', value: '2SexyContent-App' },\r\n  },\r\n\r\n  /** Content types where templates, permissions, etc. are stored */\r\n  contentTypes: {\r\n    /** Content type containing app templates (views) */\r\n    template: '2SexyContent-Template',\r\n    /** Content type containing permissions */\r\n    permissions: 'PermissionConfiguration',\r\n    /** Content type containing queries */\r\n    query: 'DataPipeline',\r\n    /** Content type containing content type metadata (app administration > data > metadata) */\r\n    contentType: 'ContentType',\r\n    /** Content type containing app settings */\r\n    settings: 'App-Settings',\r\n    /** Content type containing app resources */\r\n    resources: 'App-Resources',\r\n  },\r\n\r\n  pipelineDesigner: {\r\n    dataSourceDifficulties: {\r\n      default: 100,\r\n      advanced: 200,\r\n    },\r\n    outDataSource: {\r\n      Description: 'The template/script which will show this data',\r\n      EntityGuid: 'Out',\r\n      In: ['Default', 'Header'],\r\n      Name: '2sxc Target (View or API)',\r\n      PartAssemblyAndType: 'SexyContentTemplate',\r\n      PrimaryType: 'Target',\r\n      VisualDesignerData: { Top: 20, Left: 200, Width: 700 },\r\n    },\r\n    defaultPipeline: {\r\n      dataSources: [\r\n        // disable for https://github.com/2sic/2sxc/issues/2388 - remove in a few iterations ca. 2021-05\r\n        // {\r\n        //   EntityGuid: 'unsaved3',\r\n        //   PartAssemblyAndType: 'ToSic.Eav.DataSources.IAppRoot, ToSic.Eav.DataSources',\r\n        //   VisualDesignerData: { Top: 440, Left: 440 },\r\n        // }, {\r\n        //   EntityGuid: 'unsaved2',\r\n        //   PartAssemblyAndType: 'ToSic.Eav.DataSources.PublishingFilter, ToSic.Eav.DataSources',\r\n        //   VisualDesignerData: { Top: 300, Left: 440 },\r\n        // },\r\n        {\r\n          EntityGuid: 'unsaved1',\r\n          PartAssemblyAndType: 'ToSic.Sxc.DataSources.CmsBlock, ToSic.Sxc',\r\n          VisualDesignerData: { Top: 170, Left: 440 },\r\n        }\r\n      ],\r\n      streamWiring: [\r\n        // disable for https://github.com/2sic/2sxc/issues/2388 - remove in a few iterations ca. 2021-05\r\n        // { From: 'unsaved3', Out: 'Default', To: 'unsaved2', In: 'Default' },\r\n        // { From: 'unsaved3', Out: 'Drafts', To: 'unsaved2', In: 'Drafts' },\r\n        // { From: 'unsaved3', Out: 'Published', To: 'unsaved2', In: 'Published' },\r\n        // { From: 'unsaved2', Out: 'Default', To: 'unsaved1', In: 'Default' },\r\n        { From: 'unsaved1', Out: 'Header', To: 'Out', In: 'Header' },\r\n        { From: 'unsaved1', Out: 'Default', To: 'Out', In: 'Default' },\r\n      ],\r\n    },\r\n    testParameters: '[Demo:Demo]=true',\r\n  },\r\n};\r\n","import { environment } from '../../../environments/environment';\r\n\r\n/** Console log that doesn't show in Angular production mode */\r\nexport function consoleLogAngular(message?: any, ...optionalParams: any[]) {\r\n  if (environment.production) { return; }\r\n\r\n  console.groupCollapsed(message, ...optionalParams);\r\n  // tslint:disable-next-line:no-console\r\n  console.trace();\r\n  console.groupEnd();\r\n}\r\n","import { FieldValue } from '../../../edit-types';\r\n\r\nexport interface FormulaContext {\r\n  culture: FormulaCtxCulture;\r\n  entity: FormulaCtxEntity;\r\n  field: FormulaCtxField;\r\n  fields: Record<string, FormulaCtxField>;\r\n  value: FormulaCtxValue;\r\n}\r\n\r\nexport interface FormulaCtxCulture {\r\n  code: string;\r\n  name: string;\r\n}\r\n\r\nexport interface FormulaCtxEntity {\r\n  guid: string;\r\n  id: number;\r\n}\r\n\r\nexport interface FormulaCtxField {\r\n  name: string;\r\n  type: string;\r\n  value: FieldValue;\r\n}\r\n\r\nexport interface FormulaCtxValue {\r\n  current: FieldValue;\r\n  default: FieldValue;\r\n  // initial: FieldValue;\r\n}\r\n\r\nexport interface FormulaErrorCounter {\r\n  count: number;\r\n  entityGuid: string;\r\n  fieldName: string;\r\n  type: FormulaType;\r\n}\r\n\r\nexport type FormulaFunction = (context: FormulaContext) => FieldValue;\r\n\r\nexport const FormulaTypes = {\r\n  Value: 'value',\r\n  Visible: 'visible',\r\n  Required: 'required',\r\n  Enabled: 'enabled',\r\n} as const;\r\n\r\nexport type FormulaType = typeof FormulaTypes[keyof typeof FormulaTypes];\r\n\r\nexport interface CustomFormula {\r\n  entityGuid: string;\r\n  fieldName: string;\r\n  type: FormulaType;\r\n  formula: string;\r\n}\r\n\r\nexport interface CustomFormulaResult {\r\n  entityGuid: string;\r\n  fieldName: string;\r\n  type: FormulaType;\r\n  value: FieldValue;\r\n  isError: boolean;\r\n}\r\n","/** PublishMode is short version of PublishStatus */\r\nexport type PublishMode = 'branch' | 'show' | 'hide';\r\n\r\n/** PublishMode is short version of PublishStatus */\r\nexport enum PublishModeConstants {\r\n  Show = 'show',\r\n  Hide = 'hide',\r\n  Branch = 'branch',\r\n}\r\n","import { EavFor } from '../../../../../edit/shared/models/eav';\r\nimport { eavConstants } from '../constants/eav.constants';\r\nimport { AddItem, EditForm, EditItem, GroupItem, InnerItem } from '../models/edit-form.model';\r\n\r\nexport function convertFormToUrl(form: EditForm) {\r\n  let formUrl = '';\r\n\r\n  for (const item of form.items) {\r\n    if (formUrl) { formUrl += ','; }\r\n\r\n    if ((item as InnerItem).Parent) {\r\n      // Inner Item\r\n      const innerItem = item as InnerItem;\r\n      formUrl += 'inner:' + innerItem.EntityId + ':' + innerItem.Field\r\n        + ':' + innerItem.Parent + ':' + innerItem.Add + ':' + innerItem.Index;\r\n      if (innerItem.Prefill) {\r\n        for (const [key, prefill] of Object.entries(innerItem.Prefill)) {\r\n          formUrl += '&prefill:' + key + '~' + paramEncode(prefill.toString());\r\n        }\r\n      }\r\n    } else if ((item as EditItem).EntityId) {\r\n      // Edit Item\r\n      const editItem = item as EditItem;\r\n      formUrl += editItem.EntityId;\r\n    } else if ((item as AddItem).ContentTypeName) {\r\n      // Add Item\r\n      const addItem = item as AddItem;\r\n      formUrl += 'new:' + addItem.ContentTypeName;\r\n\r\n      // new v11.11 - support Singleton\r\n      const createForSuffix = (mdFor: EavFor) => ':' + mdFor.Target\r\n        + (mdFor.Singleton ? ':' + mdFor.Singleton.toString().toLowerCase() : '');\r\n\r\n      if (addItem.For?.String) {\r\n        formUrl += '&for:s~' + paramEncode(addItem.For.String) + createForSuffix(addItem.For);\r\n      } else if (addItem.For?.Number) {\r\n        formUrl += '&for:n~' + addItem.For.Number + createForSuffix(addItem.For);\r\n      } else if (addItem.For?.Guid) {\r\n        formUrl += '&for:g~' + addItem.For.Guid + createForSuffix(addItem.For);\r\n      } else if (addItem.Metadata) {\r\n        let keyType: string;\r\n        switch (addItem.Metadata.keyType.toLocaleLowerCase()) {\r\n          case eavConstants.keyTypes.string:\r\n            keyType = 's';\r\n            break;\r\n          case eavConstants.keyTypes.number:\r\n            keyType = 'n';\r\n            break;\r\n          case eavConstants.keyTypes.guid:\r\n            keyType = 'g';\r\n            break;\r\n        }\r\n        const target = Object.values(eavConstants.metadata).find(metaValue => metaValue.type === addItem.Metadata.targetType)?.target;\r\n        formUrl += '&for:' + keyType + '~' + paramEncode(addItem.Metadata.key) + ':' + target;\r\n      }\r\n\r\n      if (addItem.Prefill) {\r\n        for (const [key, prefill] of Object.entries(addItem.Prefill)) {\r\n          formUrl += '&prefill:' + key + '~' + paramEncode(prefill.toString());\r\n        }\r\n      }\r\n\r\n      if (addItem.DuplicateEntity) {\r\n        formUrl += '&copy:' + addItem.DuplicateEntity;\r\n      }\r\n    } else if ((item as GroupItem).Group) {\r\n      // Group Item\r\n      const groupItem = item as GroupItem;\r\n      formUrl += 'group:' + groupItem.Group.Guid + ':' + groupItem.Group.Index + ':' + groupItem.Group.Part + ':' + groupItem.Group.Add;\r\n      if (groupItem.Prefill) {\r\n        for (const [key, prefill] of Object.entries(groupItem.Prefill)) {\r\n          formUrl += '&prefill:' + key + '~' + paramEncode(prefill.toString());\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return formUrl;\r\n}\r\n\r\nexport function convertUrlToForm(formUrl: string) {\r\n  const form: EditForm = { items: [] };\r\n  const items = formUrl.split(',');\r\n\r\n  for (const item of items) {\r\n    const isNumber = /^[0-9]*$/g;\r\n    if (item.startsWith('inner:')) {\r\n      // Inner Item\r\n      const innerItem = {} as InnerItem;\r\n      const options = item.split('&');\r\n\r\n      for (const option of options) {\r\n        if (option.startsWith('inner:')) {\r\n          const innerItemParams = item.split(':');\r\n          innerItem.EntityId = parseInt(innerItemParams[1], 10);\r\n          innerItem.Field = innerItemParams[2];\r\n          innerItem.Parent = innerItemParams[3];\r\n          innerItem.Add = innerItemParams[4] === 'true';\r\n          innerItem.Index = parseInt(innerItemParams[5], 10);\r\n        } else if (option.startsWith('prefill:')) {\r\n          if (innerItem.Prefill == null) {\r\n            innerItem.Prefill = {};\r\n          }\r\n          const prefillParams = option.split(':');\r\n          const key = prefillParams[1].split('~')[0];\r\n          const value = paramDecode(prefillParams[1].split('~')[1]);\r\n          innerItem.Prefill[key] = value;\r\n        }\r\n      }\r\n      form.items.push(innerItem);\r\n    } else if (isNumber.test(item)) {\r\n      // Edit Item\r\n      const editItem: EditItem = { EntityId: parseInt(item, 10) };\r\n      form.items.push(editItem);\r\n    } else if (item.startsWith('new:')) {\r\n      // Add Item\r\n      const addItem = {} as AddItem;\r\n      const options = item.split('&');\r\n\r\n      for (const option of options) {\r\n        if (option.startsWith('new:')) {\r\n          // Add Item ContentType\r\n          const newParams = option.split(':');\r\n          addItem.ContentTypeName = newParams[1];\r\n        } else if (option.startsWith('for:')) {\r\n          // Add Item For\r\n          addItem.For = {} as EavFor;\r\n          const forParams = option.split(':');\r\n          const forIntro = forParams[1].split('~');\r\n          const forType = forIntro[0];\r\n          const forValue = forIntro[1];\r\n          const forTarget = forParams[2];\r\n\r\n          switch (forType) {\r\n            case 's':\r\n              addItem.For.String = paramDecode(forValue);\r\n              break;\r\n            case 'n':\r\n              addItem.For.Number = parseInt(forValue, 10);\r\n              break;\r\n            case 'g':\r\n              addItem.For.Guid = forValue;\r\n              break;\r\n          }\r\n          // new v11.11 - Singleton Metadata\r\n          if (forParams.length > 3) {\r\n            addItem.For.Singleton = forParams[3] === 'true';\r\n          }\r\n          addItem.For.Target = forTarget;\r\n        } else if (option.startsWith('prefill:')) {\r\n          // Add Item Prefill\r\n          if (addItem.Prefill == null) {\r\n            addItem.Prefill = {};\r\n          }\r\n          const prefillParams = option.split(':');\r\n          const key = prefillParams[1].split('~')[0];\r\n          const value = paramDecode(prefillParams[1].split('~')[1]);\r\n          addItem.Prefill[key] = value;\r\n        } else if (option.startsWith('copy:')) {\r\n          // Add Item Copy\r\n          const copyParams = option.split(':');\r\n          addItem.DuplicateEntity = parseInt(copyParams[1], 10);\r\n        }\r\n      }\r\n      form.items.push(addItem);\r\n    } else if (item.startsWith('group:')) {\r\n      // Group Item\r\n      const groupItem = {} as GroupItem;\r\n      const options = item.split('&');\r\n\r\n      for (const option of options) {\r\n        if (option.startsWith('group:')) {\r\n          // Group Item Group\r\n          const groupParams = option.split(':');\r\n          groupItem.Group = {\r\n            Guid: groupParams[1],\r\n            Index: parseInt(groupParams[2], 10),\r\n            Part: groupParams[3],\r\n            Add: groupParams[4] === 'true',\r\n          };\r\n        } else if (option.startsWith('prefill:')) {\r\n          // Group Item Prefill\r\n          if (groupItem.Prefill == null) {\r\n            groupItem.Prefill = {};\r\n          }\r\n          const prefillParams = option.split(':');\r\n          const key = prefillParams[1].split('~')[0];\r\n          const value = paramDecode(prefillParams[1].split('~')[1]);\r\n          groupItem.Prefill[key] = value;\r\n        }\r\n      }\r\n      form.items.push(groupItem);\r\n    }\r\n  }\r\n\r\n  return form;\r\n}\r\n\r\n/** Encodes characters in URL parameter to not mess up routing. Don't forget to decode it! :) */\r\nfunction paramEncode(text: string) {\r\n  text = text.replace(/\\//g, '%2F');\r\n  text = text.replace(/\\:/g, '%3A');\r\n  text = text.replace(/\\&/g, '%26');\r\n  text = text.replace(/\\~/g, '%7E');\r\n  text = text.replace(/\\,/g, '%2C');\r\n  return text;\r\n}\r\n\r\n/** Decodes characters in URL parameter */\r\nfunction paramDecode(text: string) {\r\n  text = text.replace(/%2F/g, '/');\r\n  text = text.replace(/%3A/g, ':');\r\n  text = text.replace(/%26/g, '&');\r\n  text = text.replace(/%7E/g, '~');\r\n  text = text.replace(/%2C/g, ',');\r\n  return text;\r\n}\r\n","import { Action, ActionReducer, ActionReducerMap, MetaReducer, } from '@ngrx/store';\r\nimport { consoleLogAngular } from '../../../../ng-dialogs/src/app/shared/helpers/console-log-angular.helper';\r\nimport { environment } from '../../../../ng-dialogs/src/environments/environment';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface EavState {\r\n}\r\n\r\n/** Console log all actions */\r\nexport function logger(reducer: ActionReducer<EavState>): ActionReducer<EavState> {\r\n  return (state: EavState, action: Action): EavState => {\r\n    consoleLogAngular('[STORE] state:', state, 'action:', action);\r\n    return reducer(state, action);\r\n  };\r\n}\r\n\r\n/**\r\n * By default, @ngrx/store uses combineReducers with the reducer map to compose\r\n * the root meta-reducer. To add more meta-reducers, provide an array of meta-reducers\r\n * that will be composed to form the root meta-reducer.\r\n */\r\nexport const metaReducers: MetaReducer[] = !environment.production\r\n  ? [logger]\r\n  : [];\r\n\r\nexport const reducers: ActionReducerMap<EavState> = {\r\n};\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { editRoot, refreshEditRoot } from '../../../edit/edit.matcher';\r\n\r\nconst appRoutes: Routes = [\r\n  {\r\n    path: ':zoneId/apps',\r\n    loadChildren: () => import('./apps-management/apps-management.module').then(m => m.AppsManagementModule),\r\n    data: { title: 'Apps' },\r\n  },\r\n  {\r\n    path: ':zoneId/import',\r\n    loadChildren: () => import('./import-app/import-app.module').then(m => m.ImportAppModule),\r\n    data: { title: 'Import App' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/app',\r\n    loadChildren: () => import('./app-administration/app-administration.module').then(m => m.AppAdministrationModule),\r\n    data: { title: 'App' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/code',\r\n    loadChildren: () => import('./code-editor/code-editor.module').then(m => m.CodeEditorModule),\r\n    data: { title: 'Code Editor' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/query/:pipelineId',\r\n    loadChildren: () => import('./visual-query/visual-query.module').then(m => m.VisualQueryModule),\r\n    data: { title: 'Visual Query' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/:guid/:part/:index/replace',\r\n    loadChildren: () => import('./replace-content/replace-content.module').then(m => m.ReplaceContentModule),\r\n    data: { title: 'Apps' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/:guid/:part/:index/reorder',\r\n    loadChildren: () => import('./manage-content-list/manage-content-list.module').then(m => m.ManageContentListModule),\r\n    data: { title: 'Reorder Items' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/items/:contentTypeStaticName',\r\n    loadChildren: () => import('./content-items/content-items.module').then(m => m.ContentItemsModule),\r\n    data: { title: 'Items' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/fields/:contentTypeStaticName',\r\n    loadChildren: () => import('./content-type-fields/content-type-fields.module').then(m => m.ContentTypeFieldsModule),\r\n    data: { title: 'Fields' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/versions/:itemId',\r\n    loadChildren: () => import('./item-history/item-history.module').then(m => m.ItemHistoryModule),\r\n  },\r\n  {\r\n    matcher: editRoot,\r\n    loadChildren: () => import('../../../edit/edit.module').then(m => m.EditModule),\r\n    data: { title: 'Edit Item' },\r\n  },\r\n  {\r\n    matcher: refreshEditRoot,\r\n    loadChildren: () => import('../../../edit/refresh-edit.module').then(m => m.RefreshEditModule)\r\n  },\r\n  // routes below are not linked directly from the initializer and are used for testing\r\n  // to make sure each module contains enough data to be self sustainable\r\n  {\r\n    path: ':zoneId/:appId/export/:contentTypeStaticName',\r\n    loadChildren: () => import('./content-export/content-export.module').then(m => m.ContentExportModule),\r\n    data: { title: 'Export Items' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/export/:contentTypeStaticName/:selectedIds',\r\n    loadChildren: () => import('./content-export/content-export.module').then(m => m.ContentExportModule),\r\n    data: { title: 'Export Items' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/import/:contentTypeStaticName',\r\n    loadChildren: () => import('./content-import/content-import.module').then(m => m.ContentImportModule),\r\n    data: { title: 'Import Items' },\r\n  },\r\n  {\r\n    path: ':zoneId/:appId/permissions/:type/:keyType/:key',\r\n    loadChildren: () => import('./permissions/permissions.module').then(m => m.PermissionsModule),\r\n    data: { title: 'Permissions' },\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(appRoutes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class AppRoutingModule { }\r\n","import codeCurly from '!raw-loader!./assets/icons/code-curly.svg';\r\nimport star from '!raw-loader!./assets/icons/star-24px.svg';\r\nimport { Context as DnnContext, DnnAppComponent } from '@2sic.com/dnn-sxc-angular';\r\nimport { ChangeDetectionStrategy, Component, ElementRef, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatIconRegistry } from '@angular/material/icon';\r\nimport { DomSanitizer, Title } from '@angular/platform-browser';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport { Subscription } from 'rxjs';\r\nimport { filter, map } from 'rxjs/operators';\r\nimport { keyContentBlockId, keyModuleId } from './shared/constants/session.constants';\r\nimport { Dictionary } from './shared/models/dictionary.model';\r\nimport { Context } from './shared/services/context';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AppComponent extends DnnAppComponent implements OnInit, OnDestroy {\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    el: ElementRef,\r\n    dnnContext: DnnContext,\r\n    private context: Context,\r\n    private titleService: Title,\r\n    private router: Router,\r\n    private activatedRoute: ActivatedRoute,\r\n    private matIconRegistry: MatIconRegistry,\r\n    private domSanitizer: DomSanitizer,\r\n  ) {\r\n    super(\r\n      el,\r\n      dnnContext.preConfigure({\r\n        moduleId: parseInt(sessionStorage.getItem(keyModuleId), 10),\r\n        contentBlockId: parseInt(sessionStorage.getItem(keyContentBlockId), 10),\r\n      }),\r\n    );\r\n    this.context.initRoot();\r\n    this.loadFonts();\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Mostly copied from https://blog.bitsrc.io/dynamic-page-titles-in-angular-98ce20b5c334\r\n    // Routes need a data: { title: '...' } for this to work\r\n    const appTitle = this.titleService.getTitle(); // initial title when loading the page\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        map(() => {\r\n          let child = this.activatedRoute.firstChild;\r\n          while (child.firstChild) {\r\n            child = child.firstChild;\r\n          }\r\n          if (child.snapshot.data['title']) {\r\n            return child.snapshot.data['title'];\r\n          }\r\n          return appTitle;\r\n        }),\r\n      ).subscribe((title: string) => {\r\n        this.titleService.setTitle(title);\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  private loadFonts() {\r\n    this.matIconRegistry.setDefaultFontSetClass('material-icons-outlined');\r\n\r\n    const icons: Dictionary<string> = {\r\n      star,\r\n      'code-curly': codeCurly,\r\n    };\r\n    Object.entries(icons).forEach(([name, svg]) => {\r\n      this.matIconRegistry.addSvgIconLiteral(name, this.domSanitizer.bypassSecurityTrustHtml(svg));\r\n    });\r\n  }\r\n}\r\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" width=\\\"24\\\"><path d=\\\"M0 0h24v24H0z\\\" fill=\\\"none\\\"/><path d=\\\"M0 0h24v24H0z\\\" fill=\\\"none\\\"/><path d=\\\"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z\\\"/></svg>\";","export default \"<svg width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\r\\n<path d=\\\"M2.98187 13.2188C3.38292 13.2083 3.70844 13.1016 3.95844 12.8984C4.21365 12.6901 4.38292 12.4062 4.46625 12.0469C4.54958 11.6875 4.59385 11.0729 4.59906 10.2031C4.60427 9.33333 4.6199 8.76042 4.64594 8.48438C4.69281 8.04688 4.77875 7.69531 4.90375 7.42969C5.03396 7.16406 5.19281 6.95312 5.38031 6.79688C5.56781 6.63542 5.8074 6.51302 6.09906 6.42969C6.29698 6.3776 6.6199 6.35156 7.06781 6.35156H7.50531V7.57812H7.26312C6.72146 7.57812 6.36208 7.67708 6.185 7.875C6.00792 8.06771 5.91937 8.5026 5.91937 9.17969C5.91937 10.5443 5.89073 11.4062 5.83344 11.7656C5.73969 12.3229 5.57823 12.7526 5.34906 13.0547C5.1251 13.3568 4.77094 13.625 4.28656 13.8594C4.85948 14.099 5.27354 14.4661 5.52875 14.9609C5.78917 15.4505 5.91937 16.2552 5.91937 17.375C5.91937 18.3906 5.92979 18.9948 5.95062 19.1875C5.99229 19.5417 6.09646 19.7891 6.26312 19.9297C6.435 20.0703 6.76833 20.1406 7.26312 20.1406H7.50531V21.3672H7.06781C6.5574 21.3672 6.1876 21.3255 5.95844 21.2422C5.6251 21.1224 5.34906 20.9271 5.13031 20.6562C4.91156 20.3906 4.76833 20.0521 4.70062 19.6406C4.63812 19.2292 4.60427 18.5547 4.59906 17.6172C4.59385 16.6797 4.54958 16.0312 4.46625 15.6719C4.38292 15.3125 4.21365 15.0286 3.95844 14.8203C3.70844 14.612 3.38292 14.5026 2.98187 14.4922V13.2188ZM8.05344 18V16.3984H9.655V18H8.05344ZM11.2266 18V16.3984H12.8281V18H11.2266ZM14.3997 18V16.3984H16.0012V18H14.3997ZM21.0103 13.2188V14.4922C20.6093 14.5026 20.2811 14.612 20.0259 14.8203C19.7759 15.0286 19.6093 15.3125 19.5259 15.6719C19.4426 16.026 19.3983 16.638 19.3931 17.5078C19.3879 18.3776 19.3723 18.9505 19.3462 19.2266C19.2994 19.6693 19.2108 20.0208 19.0806 20.2812C18.9556 20.5469 18.7994 20.7578 18.6119 20.9141C18.4244 21.0755 18.1848 21.1979 17.8931 21.2812C17.6952 21.3385 17.3723 21.3672 16.9244 21.3672H16.4869V20.1406H16.7291C17.2707 20.1406 17.6301 20.0417 17.8072 19.8438C17.9843 19.651 18.0728 19.2135 18.0728 18.5312C18.0728 17.2292 18.0962 16.4036 18.1431 16.0547C18.2265 15.4766 18.3931 15.0156 18.6431 14.6719C18.8931 14.3229 19.2473 14.0521 19.7056 13.8594C19.1067 13.5729 18.6848 13.1953 18.44 12.7266C18.1952 12.2526 18.0728 11.4557 18.0728 10.3359C18.0728 9.32031 18.0598 8.71354 18.0337 8.51562C17.9973 8.16667 17.8931 7.92448 17.7212 7.78906C17.5546 7.64844 17.2239 7.57812 16.7291 7.57812H16.4869V6.35156H16.9244C17.4348 6.35156 17.8046 6.39323 18.0337 6.47656C18.3671 6.59115 18.6431 6.78385 18.8619 7.05469C19.0806 7.32552 19.2212 7.66667 19.2837 8.07812C19.3515 8.48958 19.3879 9.16406 19.3931 10.1016C19.3983 11.0391 19.4426 11.6875 19.5259 12.0469C19.6093 12.401 19.7759 12.6823 20.0259 12.8906C20.2811 13.099 20.6093 13.2083 21.0103 13.2188Z\\\"/>\\r\\n</svg>\\r\\n\";","<router-outlet></router-outlet>\r\n","import { JsInfo } from '@2sic.com/2sxc-typings';\r\nimport { Injector } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { UrlHelpers } from '../../../edit/shared/helpers/url.helpers';\r\nimport { DialogTypeConstants } from './shared/constants/dialog-types.constants';\r\n// tslint:disable-next-line:max-line-length\r\nimport { keyApi, keyAppId, keyContentType, keyDialog, keyItems, keyPipelineId, keyRequestToken, keyTabId, keyUrl, keyZoneId, prefix } from './shared/constants/session.constants';\r\nimport { convertFormToUrl } from './shared/helpers/url-prep.helper';\r\nimport { EavWindow } from './shared/models/eav-window.model';\r\nimport { EditForm, EditItem, GroupItem } from './shared/models/edit-form.model';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport function paramsInitFactory(injector: Injector): () => void {\r\n  return () => {\r\n    console.log('Setting parameters config and clearing route');\r\n    const eavKeys = Object.keys(sessionStorage).filter(key => key.startsWith(prefix));\r\n    const isParamsRoute = !window.location.hash.startsWith('#/');\r\n    if (isParamsRoute) {\r\n      console.log('Initial route:', window.location.href);\r\n      // clear our part of the session\r\n      for (const key of eavKeys) {\r\n        sessionStorage.removeItem(key);\r\n      }\r\n      sessionStorage.setItem(keyUrl, window.location.href); // save url which opened the dialog\r\n      sessionStorage.setItem(keyDialog, DialogTypeConstants.Edit); // set edit dialog as the default\r\n\r\n      // save params\r\n      const urlHash = window.location.hash.substring(1); // substring removes first # char\r\n      const queryParametersFromUrl = UrlHelpers.readQueryStringParameters(urlHash);\r\n\r\n      for (const [paramKey, paramValue] of Object.entries(queryParametersFromUrl)) {\r\n        if (paramValue == null) { continue; }\r\n        sessionStorage.setItem(prefix + paramKey, paramValue);\r\n      }\r\n\r\n      // redirect\r\n      const router = injector.get(Router);\r\n      const zoneId = sessionStorage.getItem(keyZoneId);\r\n      const appId = sessionStorage.getItem(keyAppId);\r\n      const dialog = sessionStorage.getItem(keyDialog);\r\n      const contentType = sessionStorage.getItem(keyContentType);\r\n      const items = sessionStorage.getItem(keyItems);\r\n      switch (dialog) {\r\n        case DialogTypeConstants.Zone:\r\n          router.navigate([`${zoneId}/apps`]);\r\n          break;\r\n        case DialogTypeConstants.AppImport:\r\n          router.navigate([`${zoneId}/import`]);\r\n          break;\r\n        case DialogTypeConstants.App:\r\n          router.navigate([`${zoneId}/${appId}/app`]);\r\n          break;\r\n        case DialogTypeConstants.ContentType:\r\n          router.navigate([`${zoneId}/${appId}/fields/${contentType}`]);\r\n          break;\r\n        case DialogTypeConstants.ContentItems:\r\n          router.navigate([`${zoneId}/${appId}/items/${contentType}`]);\r\n          break;\r\n        case DialogTypeConstants.Edit:\r\n          const editItems: EditItem[] = JSON.parse(items);\r\n          const form: EditForm = { items: editItems };\r\n          const formUrl = convertFormToUrl(form);\r\n          router.navigate([`${zoneId}/${appId}/edit/${formUrl}`]);\r\n          break;\r\n        case DialogTypeConstants.ItemHistory:\r\n          const historyItems: EditItem[] = JSON.parse(items);\r\n          router.navigate([`${zoneId}/${appId}/versions/${historyItems[0].EntityId}`]);\r\n          break;\r\n        case DialogTypeConstants.Develop:\r\n          router.navigate([`${zoneId}/${appId}/code`]);\r\n          break;\r\n        case DialogTypeConstants.PipelineDesigner:\r\n          const pipelineId = sessionStorage.getItem(keyPipelineId);\r\n          router.navigate([`${zoneId}/${appId}/query/${pipelineId}`]);\r\n          break;\r\n        case DialogTypeConstants.Replace:\r\n          const replaceItems: GroupItem[] = JSON.parse(items);\r\n          const rGuid = replaceItems[0].Group.Guid;\r\n          const rPart = replaceItems[0].Group.Part;\r\n          const rIndex = replaceItems[0].Group.Index;\r\n          const add = replaceItems[0].Group.Add;\r\n          const queryParams = add ? { add: true } : {};\r\n          router.navigate([`${zoneId}/${appId}/${rGuid}/${rPart}/${rIndex}/replace`], { queryParams });\r\n          break;\r\n        case DialogTypeConstants.InstanceList:\r\n          const groupItems: GroupItem[] = JSON.parse(items);\r\n          const gGuid = groupItems[0].Group.Guid;\r\n          const gPart = groupItems[0].Group.Part;\r\n          const gIndex = groupItems[0].Group.Index;\r\n          router.navigate([`${zoneId}/${appId}/${gGuid}/${gPart}/${gIndex}/reorder`]);\r\n          break;\r\n        default:\r\n          alert(`Cannot open unknown dialog \"${dialog}\"`);\r\n          try {\r\n            window.parent.$2sxc.totalPopup.close();\r\n          } catch (error) { }\r\n      }\r\n    } else if (eavKeys.length === 0) {\r\n      // if not params route and no params are saved, e.g. browser was reopened, throw error\r\n      alert('Missing required url parameters. Please reopen dialog.');\r\n      throw new Error('Missing required url parameters. Please reopen dialog.');\r\n    } else {\r\n      console.log('Initial route:', sessionStorage.getItem(keyUrl));\r\n    }\r\n\r\n    loadEnvironment();\r\n  };\r\n}\r\n\r\nfunction loadEnvironment() {\r\n  const jsInfo: Partial<JsInfo> = {\r\n    page: parseInt(sessionStorage.getItem(keyTabId), 10),\r\n    rvt: sessionStorage.getItem(keyRequestToken),\r\n    api: sessionStorage.getItem(keyApi),\r\n  };\r\n  window.$2sxc.env.load(jsInfo as JsInfo);\r\n}\r\n","import { HttpErrorResponse, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\n@Injectable()\r\nexport class HandleErrorsInterceptor implements HttpInterceptor {\r\n  /** URLs excluded from detailed error alert  */\r\n  private excludedUrls = [\r\n    'dist/ng-edit/i18n',\r\n  ];\r\n\r\n  constructor() { }\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    return next.handle(req).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        if (!this.checkIfExcluded(error.url)) {\r\n          this.showDetailedHttpError(error);\r\n        }\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n\r\n  private checkIfExcluded(url: string) {\r\n    for (const excludedUrl of this.excludedUrls) {\r\n      if (url.includes(excludedUrl)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private showDetailedHttpError(error: HttpErrorResponse) {\r\n    let infoText = 'Had an error talking to the server (status ' + error.status + ').';\r\n    const srvResp = error.error;\r\n    if (srvResp) {\r\n      const msg = srvResp.Message;\r\n      if (msg) { infoText += '\\nMessage: ' + msg; }\r\n      const msgDet = srvResp.MessageDetail || srvResp.ExceptionMessage;\r\n      if (msgDet) { infoText += '\\nDetail: ' + msgDet; }\r\n\r\n      if (msgDet && msgDet.indexOf('No action was found') === 0) {\r\n        if (msgDet.indexOf('that matches the name') > 0) {\r\n          infoText += '\\n\\nTip from 2sxc: you probably got the action-name wrong in your JS.';\r\n        } else if (msgDet.indexOf('that matches the request.') > 0) {\r\n          infoText += '\\n\\nTip from 2sxc: Seems like the parameters are the wrong amount or type.';\r\n        }\r\n      }\r\n\r\n      if (msg && msg.indexOf('Controller') === 0 && msg.indexOf('not found') > 0) {\r\n        infoText += '\\n\\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word \\'controller\\' from the call in JS. To call a controller called \\'DemoController\\' only use \\'Demo\\'.';\r\n      }\r\n      infoText += '\\n\\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug';\r\n    }\r\n\r\n    alert(infoText);\r\n  }\r\n}\r\n","import { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class SetHeadersInterceptor implements HttpInterceptor {\r\n\r\n  constructor() { }\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    let modified: HttpRequest<any>;\r\n    if (req.body instanceof FormData) {\r\n      // sending files. Do not set content type so browser can add delimiter boundary automatically\r\n      return next.handle(req);\r\n    } else {\r\n      modified = req.clone({\r\n        setHeaders: {\r\n          'Content-Type': 'application/json;charset=UTF-8',\r\n        }\r\n      });\r\n      return next.handle(modified);\r\n    }\r\n  }\r\n}\r\n","import { DnnInterceptor } from '@2sic.com/dnn-sxc-angular';\r\nimport { HashLocationStrategy, LocationStrategy } from '@angular/common';\r\nimport { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { APP_INITIALIZER, Injector, NgModule } from '@angular/core';\r\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\r\nimport { BrowserModule, Title } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { EntityDataModule } from '@ngrx/data';\r\nimport { EffectsModule } from '@ngrx/effects';\r\nimport { StoreModule } from '@ngrx/store';\r\nimport { StoreDevtoolsModule } from '@ngrx/store-devtools';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { metaReducers, reducers } from '../../../edit/shared/store';\r\nimport { entityConfig } from '../../../edit/shared/store/ngrx-data';\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\nimport { paramsInitFactory } from './params-init.factory';\r\nimport { HandleErrorsInterceptor } from './shared/interceptors/handle-errors.interceptor';\r\nimport { SetHeadersInterceptor } from './shared/interceptors/set-headers.interceptor';\r\nimport { Context } from './shared/services/context';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppComponent,\r\n  ],\r\n  entryComponents: [\r\n  ],\r\n  imports: [\r\n    AppRoutingModule,\r\n    BrowserModule,\r\n    HttpClientModule,\r\n    BrowserAnimationsModule,\r\n    StoreModule.forRoot(reducers, { metaReducers, runtimeChecks: { strictStateImmutability: true, strictActionImmutability: true } }),\r\n    EffectsModule.forRoot([]),\r\n    StoreDevtoolsModule.instrument({ maxAge: 25 }),\r\n    EntityDataModule.forRoot(entityConfig),\r\n    TranslateModule.forRoot(),\r\n    MatSnackBarModule,\r\n  ],\r\n  providers: [\r\n    { provide: APP_INITIALIZER, useFactory: paramsInitFactory, deps: [Injector], multi: true },\r\n    { provide: LocationStrategy, useClass: HashLocationStrategy },\r\n    DnnInterceptor,\r\n    { provide: HTTP_INTERCEPTORS, useClass: SetHeadersInterceptor, multi: true },\r\n    { provide: HTTP_INTERCEPTORS, useClass: HandleErrorsInterceptor, multi: true },\r\n    Context,\r\n    Title\r\n  ],\r\n  bootstrap: [AppComponent]\r\n})\r\nexport class AppModule { }\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic().bootstrapModule(AppModule)\r\n  .catch(err => console.error(err));\r\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"zn8P\";"],"sourceRoot":"webpack:///"}