(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{dMuk:function(e,n,t){"use strict";t.r(n),t.d(n,"ItemHistoryComponent",function(){return A});var i=t("mrSG"),a=t("2Vo4"),o=t("itXk"),c=t("lJxs");function r(e,n,t){var a=JSON.parse(e.Json).Entity.Attributes,o="live"===t?function(e){var n,t,a=e[0];try{for(var o=Object(i.i)(e),c=o.next();!c.done;c=o.next()){var r=c.value;r.VersionNumber<=a.VersionNumber||(a=r)}}catch(s){n={error:s}}finally{try{c&&!c.done&&(t=o.return)&&t.call(o)}finally{if(n)throw n.error}}return a}(n):n.find(function(n){return n.VersionNumber===e.VersionNumber-1}),c=o?JSON.parse(o.Json).Entity.Attributes:null,r=[];return null!=a&&Object.entries(a).forEach(function(e){var n=Object(i.g)(e,2),t=n[0];Object.keys(n[1]).forEach(function(e){null==r.find(function(n){return n.name===e&&n.dataType===t})&&r.push({name:e,dataType:t})})}),null!=c&&Object.entries(c).forEach(function(e){var n=Object(i.g)(e,2),t=n[0];Object.keys(n[1]).forEach(function(e){null==r.find(function(n){return n.name===e&&n.dataType===t})&&r.push({name:e,dataType:t})})}),r.map(function(e){var n,t,i=null===(n=null==a?void 0:a[e.dataType])||void 0===n?void 0:n[e.name],o=null===(t=null==c?void 0:c[e.dataType])||void 0===t?void 0:t[e.name];return{name:e.name,dataType:e.dataType,change:l(i,o,!0),values:s(i,o)}})}function s(e,n){var t=[];return null!=e&&Object.keys(e).forEach(function(e){t.includes(e)||t.push(e)}),null!=n&&Object.keys(n).forEach(function(e){t.includes(e)||t.push(e)}),t.map(function(t){var i=null==e?void 0:e[t],a=null==n?void 0:n[t];return{langKey:t,value:i,oldValue:a,change:l(i,a)}})}function l(e,n,t){return void 0===t&&(t=!1),t&&("object"==typeof e&&(e=u(e)),"object"==typeof n&&(n=u(n))),null!=e&&null!=n?JSON.stringify(e)!==JSON.stringify(n)?"changed":"none":null!=e?"new":"deleted"}function u(e){return"object"!=typeof e?e:Object.keys(e).sort().reduce(function(n,t){var a;return Object(i.a)(Object(i.a)({},n),((a={})[t]=e[t],a))},{})}var p=t("fXoL"),b=t("0IaG"),d=t("tyNb"),h=t("0zO3"),g=t("dNgK"),f=t("ofXK"),m=t("bTqV"),v=t("Qu3c"),y=t("NFeN"),x=t("kmnG"),O=t("d3UM"),_=t("FKr1"),V=t("7EHt"),I=t("M9IT");function w(e,n){if(1&e){var t=p.Wb();p.Vb(0,"div",9),p.Vb(1,"mat-form-field",10),p.Vb(2,"mat-select",11),p.dc("selectionChange",function(e){return p.Ac(t),p.hc(2).compareChange(e.value)}),p.Vb(3,"mat-option",12),p.Mc(4,"Compare with: Previous"),p.Ub(),p.Vb(5,"mat-option",13),p.Mc(6,"Compare with: Live"),p.Ub(),p.Ub(),p.Ub(),p.Ub()}if(2&e){var i=p.hc().ngIf;p.Db(2),p.nc("value",i.compareWith)}}function M(e,n){1&e&&(p.Vb(0,"div"),p.Mc(1,"Loading..."),p.Ub())}function $(e,n){1&e&&(p.Vb(0,"div"),p.Mc(1,"No previous versions of this item found"),p.Ub())}function S(e,n){if(1&e&&(p.Tb(0),p.Mc(1),p.Sb()),2&e){var t=p.hc().$implicit;p.Db(1),p.Oc(" ",null==t.values[0]?null:t.values[0].value," ")}}function U(e,n){if(1&e&&(p.Vb(0,"div"),p.Mc(1),p.Ub()),2&e){var t=p.hc().$implicit;p.Fb("history-",t.change,""),p.Db(1),p.Oc(" ","deleted"===t.change?t.oldValue:t.value," ")}}function C(e,n){if(1&e&&(p.Tb(0),p.Vb(1,"div",29),p.Mc(2),p.Ub(),p.Vb(3,"div",30),p.Mc(4),p.Ub(),p.Sb()),2&e){var t=p.hc().$implicit;p.Db(2),p.Nc(t.value),p.Db(2),p.Nc(t.oldValue)}}function D(e,n){if(1&e&&(p.Vb(0,"div",26),p.Vb(1,"div"),p.Mc(2),p.Ub(),p.Vb(3,"div",27),p.Kc(4,U,2,4,"div",28),p.Kc(5,C,5,2,"ng-container",0),p.Ub(),p.Ub()),2&e){var t=n.$implicit;p.Db(1),p.Fb("detail-row__label history-",t.change,""),p.Db(1),p.Oc("",t.langKey,":"),p.Db(2),p.nc("ngIf","changed"!==t.change),p.Db(1),p.nc("ngIf","changed"===t.change)}}function N(e,n){if(1&e&&(p.Vb(0,"div",24),p.Kc(1,D,6,6,"div",25),p.Ub()),2&e){var t=p.hc().$implicit;p.Db(1),p.nc("ngForOf",t.values)}}function P(e,n){if(1&e){var t=p.Wb();p.Vb(0,"div",20),p.Vb(1,"div",21),p.dc("click",function(){p.Ac(t);var e=n.$implicit,i=p.hc(2).$implicit;return p.hc(3).attributeExpandedToggle(i.versionNumber,e.name)}),p.Vb(2,"div"),p.Mc(3),p.Ub(),p.Vb(4,"div"),p.Kc(5,S,2,1,"ng-container",0),p.Ub(),p.Vb(6,"div",22),p.Vb(7,"i"),p.Mc(8),p.Ub(),p.Ub(),p.Ub(),p.Kc(9,N,2,1,"div",23),p.Ub()}if(2&e){var i=n.$implicit,a=p.hc(2).$implicit,o=p.hc(3);p.Db(2),p.Fb("row-main__label history-",i.change,""),p.Db(1),p.Oc(" ",i.name," "),p.Db(1),p.Fb("row-main__value history-",i.change,""),p.Db(1),p.nc("ngIf",!o.expandedAttributes[a.versionNumber+i.name]),p.Db(3),p.Oc("[",i.dataType,"]"),p.Db(1),p.nc("ngIf",o.expandedAttributes[a.versionNumber+i.name])}}function k(e,n){if(1&e){var t=p.Wb();p.Vb(0,"button",31),p.dc("click",function(){p.Ac(t);var e=p.hc(2).$implicit;return p.hc(3).restore(e.changeSetId)}),p.Mc(1," Restore "),p.Ub()}}function j(e,n){if(1&e&&(p.Tb(0),p.Kc(1,P,10,10,"div",17),p.Vb(2,"div",18),p.Kc(3,k,2,0,"button",19),p.Ub(),p.Sb()),2&e){var t=p.hc().$implicit;p.Db(1),p.nc("ngForOf",t.attributes),p.Db(2),p.nc("ngIf",!t.isLastVersion)}}function z(e,n){if(1&e){var t=p.Wb();p.Vb(0,"mat-expansion-panel",16),p.dc("expandedChange",function(e){p.Ac(t);var i=n.$implicit;return p.hc(3).panelExpandedChange(e,i.versionNumber)}),p.Vb(1,"mat-expansion-panel-header"),p.Vb(2,"mat-panel-title"),p.Mc(3),p.Ub(),p.Vb(4,"mat-panel-description"),p.Mc(5),p.ic(6,"date"),p.Ub(),p.Ub(),p.Kc(7,j,4,2,"ng-container",0),p.Ub()}if(2&e){var i=n.$implicit,a=p.hc(3);p.nc("expanded",a.expandedPanels[i.versionNumber]),p.Db(3),p.Oc("Version ",i.versionNumber,""),p.Db(2),p.Nc(p.kc(6,4,i.timeStamp,"yyyy-MM-dd hh:mm")),p.Db(2),p.nc("ngIf",a.expandedPanels[i.versionNumber])}}function K(e,n){if(1&e&&(p.Vb(0,"mat-accordion",14),p.Kc(1,z,8,7,"mat-expansion-panel",15),p.Ub()),2&e){var t=p.hc().ngIf;p.Db(1),p.nc("ngForOf",t.historyItems)}}function T(e,n){if(1&e){var t=p.Wb();p.Vb(0,"mat-paginator",32),p.dc("page",function(e){return p.Ac(t),p.hc(2).pageChange(e)}),p.Ub()}if(2&e){var i=p.hc().ngIf,a=p.hc();p.nc("length",i.length)("pageSize",i.pageSize)("pageSizeOptions",a.pageSizeOptions)}}function F(e,n){if(1&e){var t=p.Wb();p.Tb(0),p.Vb(1,"div",1),p.Vb(2,"div",2),p.Vb(3,"div"),p.Mc(4,"Item History"),p.Ub(),p.Vb(5,"button",3),p.dc("click",function(){return p.Ac(t),p.hc().closeDialog()}),p.Vb(6,"mat-icon"),p.Mc(7,"close"),p.Ub(),p.Ub(),p.Ub(),p.Ub(),p.Vb(8,"p",4),p.Mc(9,"Check version history for this item and restore the version you need."),p.Ub(),p.Kc(10,w,7,1,"div",5),p.Vb(11,"div",6),p.Kc(12,M,2,0,"div",0),p.Kc(13,$,2,0,"div",0),p.Kc(14,K,2,1,"mat-accordion",7),p.Ub(),p.Kc(15,T,1,3,"mat-paginator",8),p.Sb()}if(2&e){var i=n.ngIf;p.Db(10),p.nc("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),p.Db(2),p.nc("ngIf",null===i.historyItems),p.Db(1),p.nc("ngIf",0===(null==i.historyItems?null:i.historyItems.length)),p.Db(1),p.nc("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),p.Db(1),p.nc("ngIf",(null==i.historyItems?null:i.historyItems.length)>0)}}var A=function(){function e(e,n,t,s){this.dialogRef=e,this.route=n,this.versionsService=t,this.snackBar=s,this.hostClass="dialog-component",this.pageSizeOptions=[10,20,50],this.expandedPanels={},this.expandedAttributes={},this.itemId=parseInt(this.route.snapshot.paramMap.get("itemId"),10),this.versions$=new a.a(null),this.page$=new a.a(1),this.pageSize$=new a.a(this.pageSizeOptions[0]),this.compareWith$=new a.a("live"),this.historyItems$=Object(o.a)([this.versions$,this.page$,this.pageSize$,this.compareWith$]).pipe(Object(c.a)(function(e){var n,t,a,o,c=Object(i.g)(e,4);return t=c[1],a=c[2],o=c[3],null==(n=c[0])||null==t||null==a||null==o?null:function(e,n,t){return e.map(function(e){return{changeSetId:e.ChangeSetId,attributes:r(e,n,t),historyId:e.HistoryId,timeStamp:e.TimeStamp,user:e.User,versionNumber:e.VersionNumber,isLastVersion:!n.some(function(n){return n.VersionNumber===e.VersionNumber+1})}})}(n.slice((t-1)*a,t*a),n,o)})),this.templateVars$=Object(o.a)([this.versions$,this.historyItems$,this.pageSize$,this.compareWith$]).pipe(Object(c.a)(function(e){var n=Object(i.g)(e,4),t=n[0];return{length:null==t?void 0:t.length,historyItems:n[1],pageSize:n[2],compareWith:n[3]}}))}return e.prototype.ngOnInit=function(){var e=this;this.versionsService.fetchVersions(this.itemId).subscribe(function(n){e.versions$.next(n)})},e.prototype.ngOnDestroy=function(){this.versions$.complete(),this.page$.complete(),this.pageSize$.complete(),this.compareWith$.complete()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.compareChange=function(e){this.compareWith$.next(e)},e.prototype.panelExpandedChange=function(e,n){this.expandedPanels[n]=e},e.prototype.attributeExpandedToggle=function(e,n){this.expandedAttributes[e+n]=!this.expandedAttributes[e+n]},e.prototype.pageChange=function(e){var n=e.pageIndex+1;n!==this.page$.value&&(this.expandedPanels={},this.expandedAttributes={},this.page$.next(n));var t=e.pageSize;t!==this.pageSize$.value&&this.pageSize$.next(t)},e.prototype.restore=function(e){var n=this;this.snackBar.open("Restoring previous version..."),this.versionsService.restore(this.itemId,e).subscribe(function(e){n.snackBar.open("Previous version restored. Will reload edit dialog",null,{duration:3e3}),n.dialogRef.close({refreshEdit:!0})})},e.\u0275fac=function(n){return new(n||e)(p.Pb(b.f),p.Pb(d.a),p.Pb(h.a),p.Pb(g.b))},e.\u0275cmp=p.Jb({type:e,selectors:[["app-item-history"]],hostVars:1,hostBindings:function(e,n){2&e&&p.Yb("className",n.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","matTooltip","Close dialog",3,"click"],[1,"dialog-description"],["class","compare-box",4,"ngIf"],[1,"dialog-component-content","fancy-scrollbar-light"],["multi","","class","history-tables",4,"ngIf"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],[1,"compare-box"],["appearance","standard","color","accent",1,"compare-box__dropdown"],["name","Scope",3,"value","selectionChange"],["value","previous"],["value","live"],["multi","",1,"history-tables"],[3,"expanded","expandedChange",4,"ngFor","ngForOf"],[3,"expanded","expandedChange"],["class","table-row",4,"ngFor","ngForOf"],[1,"row-actions"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"table-row"],[1,"table-row__main","row-main",3,"click"],[1,"row-main__type"],["class","table-row__details",4,"ngIf"],[1,"table-row__details"],["class","detail-row",4,"ngFor","ngForOf"],[1,"detail-row"],[1,"detail-row__value"],[3,"class",4,"ngIf"],[1,"history-new"],[1,"history-deleted","history-deleted__value"],["mat-raised-button","","color","accent",3,"click"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page"]],template:function(e,n){1&e&&(p.Kc(0,F,16,5,"ng-container",0),p.ic(1,"async")),2&e&&p.nc("ngIf",p.jc(1,1,n.templateVars$))},directives:[f.n,b.g,m.a,v.a,y.a,x.c,O.a,_.k,V.a,f.m,V.c,V.e,V.f,V.d,I.a],pipes:[f.b,f.e],styles:[".compare-box[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-end;height:40px}.compare-box__dropdown[_ngcontent-%COMP%]{width:192px;margin-top:-14px;font-size:14px;height:auto}.mat-accordion[_ngcontent-%COMP%]{display:block;padding:4px 0}.mat-expansion-panel-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{font-size:14px}.table-row__main[_ngcontent-%COMP%]{display:flex}.table-row__details[_ngcontent-%COMP%]{display:block}.row-main[_ngcontent-%COMP%]{cursor:pointer;padding:4px 0}.row-main__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.row-main__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-main__type[_ngcontent-%COMP%]{flex:0 0 auto;font-size:12px}.row-main__type[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:not(:last-of-type){margin-right:2px}.detail-row[_ngcontent-%COMP%]{display:flex;padding-bottom:4px;cursor:default}.detail-row__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.detail-row__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"],changeDetection:0}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/12.02.01/ng-edit/item-history-component.91a09eed10a2bd773fcc.js.map