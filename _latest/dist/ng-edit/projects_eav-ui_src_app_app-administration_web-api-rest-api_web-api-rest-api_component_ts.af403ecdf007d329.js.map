{"version":3,"file":"projects_eav-ui_src_app_app-administration_web-api-rest-api_web-api-rest-api_component_ts.af403ecdf007d329.js","mappings":"kbAMUA,MAAA,kBACEA,MAAA,GACFA,kCAFYA,MAAA,QAAAC,EAAAC,MACVF,cAAA,IAAAC,EAAAE,KAAA,8BAFJH,MAAA,EAAAI,EAAA,mBAAAJ,kCAAAK,EAAAC,eAAcC,SCQtB,MAAMC,EAAW,CACfC,KAAK,EACLH,cAAc,EACdI,SAAS,GAgBJ,IAAMC,EAAsB,MAA7B,MAAOA,EAEXC,GACAC,GAEAC,GAEAC,cANAC,KAAAC,OAAMC,MAAS,CAAEP,0BAA0BH,GAC3CQ,MAAAJ,KAAaO,KAAUC,KACvBJ,MAAAH,KAAgBM,KAAUE,KAE1BL,MAAAF,KAAeQ,OAAOC,MAqBtBP,MAAAQ,KAAWC,OAAO,GAClBT,MAAAU,EAAiBV,MAAKJ,EAAWe,eAAeX,MAAKQ,GAErDR,KAAAV,gBAAesB,MAAS,IACNZ,MAAKU,KAIvBV,KAAAa,eAA4Bb,MAAKF,EAAagB,MAAM,CAClDC,WAAY,CAAC,OACd,EA3BCC,MAAO,KACL,MAAMC,EAAIjB,KAAKC,IAAIiB,KAAK,WAClBC,EAAUnB,KAAKV,eACrB,GAAuB,IAAnB6B,EAAQC,OACV,OAAOH,EAAEI,MACX,MAAMC,EAAUtB,MAAKH,EAAc0B,YAAYC,IAAG,GAElD,IAAIC,EAAiBH,EAAQI,QAAQ,SAAU,KAE/C,MAAMC,EAASR,EAAQS,KAAKC,GAAKA,EAAE3C,OAASuC,GAC5CR,EAAEa,EAAE,UAAW,CAAEX,UAASQ,SAAQL,UAASG,mBACvCE,GACF3B,KAAKa,eAAekB,IAAI,cAAcC,SAASL,EAAOzC,MACxD+B,EAAEI,KAAG,EAET,CAEAb,GACAE,GAWAuB,YAAYC,GACLA,GACLlC,MAAKH,EAAcsC,YAAY,CAACC,mBAAmBF,IACrD,CAACG,SAAArC,KAAA,mBAAAsC,iBAzCU3C,EAAsB,EAAA0C,SAAArC,KAAA,UAAAuC,EAAAC,IAAA,MAAtB7C,EAAsB8C,UAAA,2BAAAC,MAAA,EAAAC,KAAA,EAAAC,OAAA,yHAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID9B/B9D,MAFJ,WAEIA,CAF+B,qBAE/BA,CADwD,eAC7CA,MAAA,cAAQA,QACnBA,MAAA,kBAAyCA,MAAA,uBAAAgE,GAAA,OAAeD,EAAAd,YAAAe,EAAmB,GACzEhE,MAAA,EAAAiE,EAAA,KASNjE,YAEAA,MAAA,0BAfMA,MAAA,YAAA+D,EAAAlC,gBAIA7B,MAAA,GAAAA,MAAA+D,EAAAzD,eAAA,sBCkBF4D,IAAeC,QAAAC,QACfC,KACAC,KACAC,KACAC,KAAmBC,yBACnBC,KACAC,KAAaC,cAAA,WAIJjE,CAAsB,6GCrBnC,MACMkE,EAAgB,uBAGhBC,EAAyB,gCAKxB,IAAM1D,EAAc,MAArB,MAAOA,UAAsB2D,IAIjChC,IAAIiC,EAAiBC,EAAiBC,GACpC,OAAOlE,KAAKmE,cAA0BN,EAAe,CACnDO,OAAQ,CACNC,MAAOrE,KAAKqE,MACZJ,YACGjE,KAAKsE,iBAAiBN,EAASC,EAAQC,MAE3CK,QACDC,KAAIC,IACF,GAAsC,SAAlCA,EAAKC,KAAKC,oBACZ,OAAQF,EAAKG,UAAUD,qBACrB,IAAK,MACL,IAAK,UACHF,EAAKC,KAAO,QACZ,MACF,IAAK,QACL,IAAK,OACL,IAAK,MACHD,EAAKC,KAAO,QAIlB,OAAOD,IAGb,CAmCAI,KAAKb,EAAiBC,EAAiBQ,EAAkBP,GACvD,OAAOlE,KAAK8E,KAAKC,KAAc/E,KAAKgF,OAAOnB,GAAgBY,EAAM,CAC/DL,OAAQ,CACNC,MAAOrE,KAAKqE,MACZJ,YACGjE,KAAKsE,iBAAiBN,EAASC,EAAQC,KAGhD,CAEAe,cAAcC,GACZ,OAAOlF,KAAKmF,aApFI,0BAoF8C,CAC5Df,OAAQ,CACNC,MAAOrE,KAAKqE,SACRa,GAAQ,CAAEA,WAEfE,KAAK,EAAGC,YACTA,EAAMC,QAAQC,IACZA,EAAKC,UAAW,IAEXH,GAEX,CAGAI,aACE,OAAOzF,KAAKmE,cAAmCL,EAAwB,CACrEM,OAAQ,CACNC,MAAOrE,KAAKqE,SAEbE,QACDC,KAAI,EAAGkB,YACLA,EAAMJ,QAAQC,IACZA,EAAKI,YAAa,EAClBJ,EAAKK,cAAe,IAEfF,KAETnB,QACAC,KAAIkB,GACwBA,EAAMlB,IAAIe,IAClC,MAAMM,EAAaN,EAAKrG,KAAK4G,YAAY,KACnCC,EAAeR,EAAKrG,KAAK4G,YAAY,KACrCE,EAAST,EAAKrG,KAAK+G,UAAU,EAAGJ,GAChC1G,EAAOoG,EAAKrG,KAAK+G,UAAUJ,EAAa,EAAGE,GAEjD,MADuB,CAAE7G,KAAMqG,EAAKrG,KAAM8G,SAAQ7G,OAAMwG,SAAUJ,EAAKI,SAAUO,aAAcX,EAAKW,aAAcN,WAAYL,EAAKK,WAAYO,QAASZ,EAAKY,QAAO,IAM5K,CAGAxF,eAAeyF,GACb,MAAMC,KAAcC,MAAkC,KACpDF,IACO,CACLG,IAAKvG,KAAKgF,OAAOlB,GACjBM,OAAQ,CAAEC,MAAOrE,KAAKqE,UAK1B,SAAOzD,MAAS,KAEd,MAAM8E,EADWW,EAAYG,SACLd,MAExB,OAAKA,GAGLA,EAAMJ,QAAQC,IACZA,EAAKI,YAAa,EAClBJ,EAAKK,cAAe,IAIfF,EAAMlB,IAAIe,IACf,MAAMM,EAAaN,EAAKrG,KAAK4G,YAAY,KACnCC,EAAeR,EAAKrG,KAAK4G,YAAY,KACrCE,EAAST,EAAKrG,KAAK+G,UAAU,EAAGJ,GAChC1G,EAAOoG,EAAKrG,KAAK+G,UAAUJ,EAAa,EAAGE,GAEjD,MAAO,CACL7G,KAAMqG,EAAKrG,KACX8G,SACA7G,OACAwG,SAAUJ,EAAKI,SACfO,aAAcX,EAAKW,aACnBN,WAAYL,EAAKK,WACjBO,QAASZ,EAAKY,YAtBC,IA0BvB,CAIAM,iBAAiBC,GACf,OAAO1G,KAAKmE,cAzKW,4BAyKsC,CAC3DC,OAAQ,CAAEC,MAAOrE,KAAKqE,MAAOsC,OAAQ3G,KAAK2G,OAAQzH,KAAMwH,IAE5D,CAEAE,uBAAuBC,EAAyCC,GAC9D,OAAO9G,KAAKmF,aA7KoB,8BA6KmD,CACjFf,OAAQ,IACFyC,GAAW,CAAEA,cACbC,GAAQ,CAAEA,UAGpB,CAGAC,WAAW7H,EAAc+E,EAAiB+C,GACxC,OAAOhH,KAAKmE,cAtLQ,yBAsLgC,CAClDC,OAAQ,CACNC,MAAOrE,KAAKqE,MACZnF,OACA8H,cACA/C,WAGN,CAEAgD,OAAO/H,EAAc+E,EAAiB+C,GACpC,OAAOhH,KAAK8E,KAAKC,KAAc/E,KAAKgF,OArMjB,yBAqMyC,GAAI,CAC9DZ,OAAQ,CACNC,MAAOrE,KAAKqE,MACZJ,SACA4C,QAAS,OACT3H,OACA8H,gBAGN,CAEQ1C,iBAAiBN,EAAiBC,EAAiBC,GACzD,GAAI,YAAYgD,KAAKlD,GAAU,CAC7B,MAAM9E,EAAOgF,EAAStC,KAAKuF,GAAKA,EAAEC,UAAUC,aAAerD,GAAWmD,EAAEG,WAAarD,IAASsD,KAC9F,MAAO,CACLC,WAAYxD,KACA,MAAR9E,GAAgB,CAAEA,QAE1B,CACE,MAAO,CAAEA,KAAM8E,EAEnB,CAAC3B,SAAArC,KAAA,4DAnNUI,KAAakC,GAAblC,EAAa,GAmNvB,GAnNuBiC,SAAArC,KAAA,WAAAyH,EAAAC,IAAA,OAAbtH,EAAauH,QAAbvH,EAAawH,mBAAbxH,CAAc","names":["i0","endpoint_r1","path","name","WebApiRestApiComponent_Conditional_5_For_1_Template","ctx_r1","webApisTypes","sort","logSpecs","all","syncUrl","WebApiRestApiComponent","#sourceSvc","#dialogRouter","#formBuilder","constructor","this","log","classLog","transient","SourceService","DialogRoutingService","inject","FormBuilder","#refresh","signal","#getAllWebApis","getWebApisLive","computed","webApiTypeForm","group","webApiType","effect","l","fnIf","webApis","length","end","urlPath","urlSegments","at","encodedUrlPath","replace","webApi","find","w","a","get","setValue","openRestApi","apiRoute","navRelative","encodeURIComponent","static","__ngFactoryType__","_angular_core__WEBPACK_IMPORTED_MODULE_4__","VBU","selectors","decls","vars","consts","template","rf","ctx","$event","WebApiRestApiComponent_Conditional_5_Template","MatSelectModule","i1","i2","MatButtonModule","MatCardModule","MatIconModule","ReactiveFormsModule","i3","RouterOutlet","SxcGridModule","encapsulation","appFilesAsset","apiExplorerAppApiFiles","HttpServiceBase","viewKey","global","urlItems","getHttpApiUrl","params","appId","templateIdOrPath","pipe","map","view","Type","toLocaleLowerCase","Extension","save","http","post","apiUrl","getAllPromise","mask","fetchPromise","then","Files","forEach","file","Shared","getWebApis","files","isShared","isCompiled","splitIndex","lastIndexOf","fileExtIndex","folder","substring","endpointPath","edition","refresh","apiResource","httpResource","url","value","getWebApiDetails","apiPath","zoneId","getPredefinedTemplates","purpose","type","getPreview","templateKey","create","test","i","EntityId","toString","IsShared","Path","templateId","_angular_core__WEBPACK_IMPORTED_MODULE_5__","jDH","factory","Éµfac"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/web-api-rest-api/web-api-rest-api.component.html","./projects/eav-ui/src/app/app-administration/web-api-rest-api/web-api-rest-api.component.ts","./projects/eav-ui/src/app/code-editor/services/source.service.ts"],"sourcesContent":["<form [formGroup]=\"webApiTypeForm\">\r\n  <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n    <mat-label>Endpoint</mat-label>\r\n    <mat-select formControlName=\"webApiType\" (valueChange)=\"openRestApi($event)\">\r\n      @if (webApisTypes()) {\r\n        @for (endpoint of webApisTypes().sort(); track endpoint) {\r\n          <mat-option [value]=\"endpoint.path\">\r\n            {{ endpoint.name }}\r\n          </mat-option>\r\n        }\r\n      }\r\n    </mat-select>\r\n  </mat-form-field>\r\n</form>\r\n\r\n<router-outlet></router-outlet>\r\n","import { Component, computed, effect, inject, signal } from '@angular/core';\r\nimport { FormBuilder, FormGroup, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { RouterOutlet } from '@angular/router';\r\nimport { transient } from '../../../../../core';\r\nimport { SourceService } from '../../code-editor/services/source.service';\r\nimport { classLog } from '../../shared/logging';\r\nimport { SxcGridModule } from '../../shared/modules/sxc-grid-module/sxc-grid.module';\r\nimport { DialogRoutingService } from '../../shared/routing/dialog-routing.service';\r\n\r\nconst logSpecs = {\r\n  all: false,\r\n  webApisTypes: true,\r\n  syncUrl: true,\r\n};\r\n\r\n@Component({\r\n  selector: 'app-web-api-rest-api',\r\n  imports: [\r\n    MatSelectModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatIconModule,\r\n    ReactiveFormsModule,\r\n    RouterOutlet,\r\n    SxcGridModule,\r\n  ],\r\n  templateUrl: './web-api-rest-api.component.html'\r\n})\r\nexport class WebApiRestApiComponent {\r\n  log = classLog({ WebApiRestApiComponent }, logSpecs);\r\n  #sourceSvc = transient(SourceService);\r\n  #dialogRouter = transient(DialogRoutingService);\r\n\r\n  #formBuilder = inject(FormBuilder);\r\n\r\n  constructor() {\r\n    // Update form if the url changes and the item is found\r\n    effect(() => {\r\n      const l = this.log.fnIf('syncUrl');\r\n      const webApis = this.webApisTypes();\r\n      if (webApis.length === 0)\r\n        return l.end();\r\n      const urlPath = this.#dialogRouter.urlSegments.at(-1);\r\n\r\n      var encodedUrlPath = urlPath.replace(/%252F/g, \"/\");\r\n\r\n      const webApi = webApis.find(w => w.path === encodedUrlPath);\r\n      l.a('status:', { webApis, webApi, urlPath, encodedUrlPath });\r\n      if (webApi)\r\n        this.webApiTypeForm.get('webApiType').setValue(webApi.path);\r\n      l.end();\r\n    });\r\n  }\r\n\r\n  #refresh = signal(0);\r\n  #getAllWebApis = this.#sourceSvc.getWebApisLive(this.#refresh)\r\n\r\n  webApisTypes = computed(() => {\r\n    const webApis = this.#getAllWebApis();\r\n    return webApis;\r\n  });\r\n\r\n  webApiTypeForm: FormGroup = this.#formBuilder.group({\r\n    webApiType: ['']\r\n  });\r\n\r\n  openRestApi(apiRoute: string): void {\r\n    if (!apiRoute) return;\r\n    this.#dialogRouter.navRelative([encodeURIComponent(apiRoute)]);\r\n  }\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { computed, Injectable, Signal } from '@angular/core';\r\nimport { map, Observable } from 'rxjs';\r\nimport { WebApi, WebApiDetails } from '../../app-administration/models';\r\nimport { ViewOrFileIdentifier } from '../../shared/models/edit-form.model';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { FileAsset } from '../models/file-asset.model';\r\nimport { PredefinedTemplatesResponse } from '../models/predefined-template.model';\r\nimport { Preview } from '../models/preview.models';\r\nimport { SourceView } from '../models/source-view.model';\r\n\r\nconst appFilesAll = 'admin/AppFiles/AppFiles';\r\nconst appFilesAsset = 'admin/AppFiles/asset';\r\nconst appFilesCreate = 'admin/AppFiles/create';\r\nconst apiExplorerInspect = 'admin/ApiExplorer/inspect';\r\nconst apiExplorerAppApiFiles = 'admin/ApiExplorer/AppApiFiles';\r\nconst appFilesPredefinedTemplates = 'admin/AppFiles/GetTemplates';\r\nconst appFilesPreview = 'admin/AppFiles/preview';\r\n\r\n@Injectable()\r\nexport class SourceService extends HttpServiceBase {\r\n\r\n  // TODO: @2dg, ask 2dm \r\n  /** ViewKey is templateId or path */\r\n  get(viewKey: string, global: boolean, urlItems: ViewOrFileIdentifier[]): Observable<SourceView> {\r\n    return this.getHttpApiUrl<SourceView>(appFilesAsset, {\r\n      params: {\r\n        appId: this.appId,\r\n        global,\r\n        ...this.templateIdOrPath(viewKey, global, urlItems),\r\n      },\r\n    }).pipe(\r\n      map(view => {\r\n        if (view.Type.toLocaleLowerCase() === 'auto') {\r\n          switch (view.Extension.toLocaleLowerCase()) {\r\n            case '.cs':\r\n            case '.cshtml':\r\n              view.Type = 'Razor';\r\n              break;\r\n            case '.html':\r\n            case '.css':\r\n            case '.js':\r\n              view.Type = 'Token';\r\n              break;\r\n          }\r\n        }\r\n        return view;\r\n      })\r\n    );\r\n  }\r\n\r\n  // TODO: @2dg, ask 2dm \r\n  // getSig(viewKey: string, global: boolean, urlItems: ViewOrFileIdentifier[], initial: undefined): Signal<SourceView> {\r\n  //   // Signal fÃ¼r die SourceView erstellen\r\n  //   const temp = this.getSignal<SourceView>(appFilesAsset, {\r\n  //     params: {\r\n  //       appId: this.appId,\r\n  //       global,\r\n  //       ...this.templateIdOrPath(viewKey, global, urlItems),\r\n  //     },\r\n  //   }, initial);\r\n  //   return computed(() => {\r\n  //     const result = temp();\r\n\r\n  //     if (result && result.Type.toLocaleLowerCase() === 'auto') {\r\n  //       switch (result.Extension.toLocaleLowerCase()) {\r\n  //         case '.cs':\r\n  //         case '.cshtml':\r\n  //           result.Type = 'Razor';\r\n  //           break;\r\n  //         case '.html':\r\n  //         case '.css':\r\n  //         case '.js':\r\n  //           result.Type = 'Token';\r\n  //           break;\r\n  //       }\r\n  //     }\r\n\r\n  //     return result;\r\n  //   });\r\n  // }\r\n\r\n\r\n  /** ViewKey is templateId or path */\r\n  save(viewKey: string, global: boolean, view: SourceView, urlItems: ViewOrFileIdentifier[]): Observable<boolean> {\r\n    return this.http.post<boolean>(this.apiUrl(appFilesAsset), view, {\r\n      params: {\r\n        appId: this.appId,\r\n        global,\r\n        ...this.templateIdOrPath(viewKey, global, urlItems),\r\n      },\r\n    });\r\n  }\r\n\r\n  getAllPromise(mask?: string): Promise<FileAsset[]> {\r\n    return this.fetchPromise<{ Files: FileAsset[] }>(appFilesAll, {\r\n      params: {\r\n        appId: this.appId,\r\n        ...(mask && { mask }),\r\n      },\r\n    }).then(({ Files }) => {\r\n      Files.forEach(file => {\r\n        file.Shared ??= false;\r\n      });\r\n      return Files;\r\n    });\r\n  }\r\n\r\n  // TODO: @2dg, ask 2dm\r\n  getWebApis(): Observable<WebApi[]> {\r\n    return this.getHttpApiUrl<{ files: WebApi[] }>(apiExplorerAppApiFiles, {\r\n      params: {\r\n        appId: this.appId,\r\n      },\r\n    }).pipe(\r\n      map(({ files }) => {\r\n        files.forEach(file => {\r\n          file.isShared ??= false;\r\n          file.isCompiled ??= false;\r\n        });\r\n        return files;\r\n      }),\r\n    ).pipe(\r\n      map(files => {\r\n        const webApis: WebApi[] = files.map(file => {\r\n          const splitIndex = file.path.lastIndexOf('/');\r\n          const fileExtIndex = file.path.lastIndexOf('.');\r\n          const folder = file.path.substring(0, splitIndex);\r\n          const name = file.path.substring(splitIndex + 1, fileExtIndex);\r\n          const webApi: WebApi = { path: file.path, folder, name, isShared: file.isShared, endpointPath: file.endpointPath, isCompiled: file.isCompiled, edition: file.edition };\r\n          return webApi;\r\n        });\r\n        return webApis;\r\n      }),\r\n    );\r\n  }\r\n\r\n\r\n  getWebApisLive(refresh: Signal<unknown>) {\r\n    const apiResource = httpResource<{ files: WebApi[] }>(() => {\r\n      refresh();\r\n      return {\r\n        url: this.apiUrl(apiExplorerAppApiFiles),\r\n        params: { appId: this.appId },\r\n      };\r\n    });\r\n\r\n    // Return a computed signal that transforms the data\r\n    return computed(() => {\r\n      const response = apiResource.value();\r\n      const files = response?.files;\r\n\r\n      if (!files) return [];\r\n\r\n      // Set default values for isShared and isCompiled if they are undefined\r\n      files.forEach(file => {\r\n        file.isShared ??= false;\r\n        file.isCompiled ??= false;\r\n      });\r\n\r\n      // Transform the raw files into the desired WebApi format\r\n      return files.map(file => {\r\n        const splitIndex = file.path.lastIndexOf('/');\r\n        const fileExtIndex = file.path.lastIndexOf('.');\r\n        const folder = file.path.substring(0, splitIndex);\r\n        const name = file.path.substring(splitIndex + 1, fileExtIndex);\r\n\r\n        return {\r\n          path: file.path,\r\n          folder,\r\n          name,\r\n          isShared: file.isShared,\r\n          endpointPath: file.endpointPath,\r\n          isCompiled: file.isCompiled,\r\n          edition: file.edition,\r\n        } as WebApi;\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  // TODO: @2dg, ask 2dm \r\n  getWebApiDetails(apiPath: string): Observable<WebApiDetails> {\r\n    return this.getHttpApiUrl<WebApiDetails>(apiExplorerInspect, {\r\n      params: { appId: this.appId, zoneId: this.zoneId, path: apiPath },\r\n    });\r\n  }\r\n\r\n  getPredefinedTemplates(purpose?: 'Template' | 'Search' | 'Api', type?: 'Token' | 'Razor'): Promise<PredefinedTemplatesResponse> {\r\n    return this.fetchPromise<PredefinedTemplatesResponse>(appFilesPredefinedTemplates, {\r\n      params: {\r\n        ...(purpose && { purpose }),\r\n        ...(type && { type }),\r\n      },\r\n    });\r\n  }\r\n\r\n  // TODO: @2dg, ask 2dm \r\n  getPreview(path: string, global: boolean, templateKey: string): Observable<Preview> {\r\n    return this.getHttpApiUrl<Preview>(appFilesPreview, {\r\n      params: {\r\n        appId: this.appId,\r\n        path,\r\n        templateKey,\r\n        global,\r\n      },\r\n    });\r\n  }\r\n\r\n  create(path: string, global: boolean, templateKey: string): Observable<boolean> {\r\n    return this.http.post<boolean>(this.apiUrl(appFilesCreate), {}, {\r\n      params: {\r\n        appId: this.appId,\r\n        global,\r\n        purpose: 'auto',\r\n        path,\r\n        templateKey,\r\n      },\r\n    });\r\n  }\r\n\r\n  private templateIdOrPath(viewKey: string, global: boolean, urlItems: ViewOrFileIdentifier[]) {\r\n    if (/^[0-9]*$/g.test(viewKey)) {\r\n      const path = urlItems.find(i => i.EntityId?.toString() === viewKey && i.IsShared === global)?.Path;\r\n      return {\r\n        templateId: viewKey,\r\n        ...(path != null && { path }),\r\n      };\r\n    } else {\r\n      return { path: viewKey };\r\n    }\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}