(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_ng-dialogs_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fi-2daed6"],{3726:function(e,t,n){"use strict";n.r(t),n.d(t,{EditContentTypeFieldsComponent:function(){return W}});var i=n(4762),o=n(1041),r=n(8512),s=n(7570),a=n(3148),p=n(878),c=n(2023),l=n(4991),u=n(7768),d=n(6541);function f(e,t,n){return 0===n?[t]:(e.push(t),e)}var g=n(1055),h=n(3982),m=n(9996),y=n(3835),v=n(436),T=n(7727),x=/^[A-Za-z][A-Za-z0-9]+$/,Z=n(3667),b=n(2542),O=n(3269),N={Boolean:{label:"Boolean (yes/no)",description:"Yes/no or true/false values"},Custom:{label:"Custom - ui-tools or custom types",description:"Use for things like gps-pickers (which writes into multiple fields) or for custom-data which serializes something exotic into the db like an array, a custom json or anything"},DateTime:{label:"Date and/or time",description:"For date, time or combined values"},Empty:{label:"Empty - for form-titles etc.",description:"Use to structure your form"},Entity:{label:"Entity (other content-items)",description:"One or more other content-items"},Hyperlink:{label:"Link / file reference",description:"Hyperlink or reference to a picture / file"},Number:{label:"Number",description:"Any kind of number"},String:{label:"Text / string",description:"Any kind of text"}},M=n(1785),C=n(2935),A=n(1282),q=n(2832),I=n(7093),_=n(3589),w=n(1116),S=n(4369),F=n(3070),k=n(9550),J=function(){function e(){this.reservedNames={}}return e.prototype.validate=function(e){if(!e.value)return null;var t=e.value.toLocaleLowerCase(),n=Object.keys(this.reservedNames).find(function(e){return e.toLocaleLowerCase()===t});return n?{reservedNames:this.reservedNames[n]}:null},e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=M.lG2({type:e,selectors:[["","appReservedNames",""]],inputs:{reservedNames:["appReservedNames","reservedNames"]},features:[M._Bn([{provide:o.Cf,useExisting:e,multi:!0}])]}),e}(),Q=n(3841),Y=n(7307),E=n(7110),U=n(7064),$=["ngForm"];function H(e,t){1&e&&(M.ynx(0),M._uU(1,"Fields"),M.BQk())}function P(e,t){1&e&&(M.ynx(0),M._uU(1,"Add Fields"),M.BQk())}function L(e,t){1&e&&(M.ynx(0),M._uU(1,"Edit Field"),M.BQk())}function R(e,t){if(1&e&&(M.TgZ(0,"app-field-hint",22),M._uU(1),M.qZA()),2&e){var n=M.oxw(4);M.Q6J("isError",!0),M.xp6(1),M.Oqu(n.fieldNameError)}}function B(e,t){if(1&e&&(M.TgZ(0,"app-field-hint",22),M._uU(1),M.qZA()),2&e){M.oxw(2);var n=M.MAs(6);M.Q6J("isError",!0),M.xp6(1),M.hij(" ",n.errors.reservedNames," ")}}function D(e,t){if(1&e&&(M.ynx(0),M.YNc(1,R,2,2,"app-field-hint",21),M.YNc(2,B,2,2,"app-field-hint",21),M.BQk()),2&e){M.oxw();var n=M.MAs(6);M.xp6(1),M.Q6J("ngIf",n.errors.pattern),M.xp6(1),M.Q6J("ngIf",n.errors.reservedNames)}}function z(e,t){if(1&e&&(M.TgZ(0,"mat-option",23),M.TgZ(1,"mat-icon"),M._uU(2),M.qZA(),M.TgZ(3,"span"),M._uU(4),M.qZA(),M.qZA()),2&e){var n=t.$implicit;M.Q6J("value",n.name),M.xp6(2),M.Oqu(n.icon),M.xp6(2),M.Oqu(n.label)}}function j(e,t){if(1&e&&(M.TgZ(0,"mat-icon",19),M._uU(1),M.qZA()),2&e){var n=M.oxw().$implicit;M.xp6(1),M.Oqu(n.icon)}}var X=function(e){return{"input-obsolete":e}};function G(e,t){if(1&e&&(M.TgZ(0,"mat-option",24),M.TgZ(1,"span"),M._uU(2),M.qZA(),M.YNc(3,j,2,1,"mat-icon",25),M.qZA()),2&e){var n=t.$implicit;M.Q6J("value",n.inputType)("ngClass",M.VKq(4,X,n.isObsolete)),M.xp6(2),M.Oqu(n.label),M.xp6(1),M.Q6J("ngIf",n.icon)}}function K(e,t){if(1&e){var n=M.EpF();M.TgZ(0,"div",11),M.TgZ(1,"div",12),M.TgZ(2,"mat-form-field",13),M.TgZ(3,"mat-label"),M._uU(4,"Name"),M.qZA(),M.TgZ(5,"input",14,15),M.NdJ("ngModelChange",function(e){return t.$implicit.StaticName=e}),M.qZA(),M.qZA(),M.YNc(7,D,3,2,"ng-container",2),M.qZA(),M.TgZ(8,"div",12),M.TgZ(9,"mat-form-field",13),M.TgZ(10,"mat-label"),M._uU(11,"Data Type"),M.qZA(),M.TgZ(12,"mat-select",16),M.NdJ("selectionChange",function(){var e=M.CHM(n).index,t=M.oxw(2);return t.filterInputTypeOptions(e),t.resetInputType(e),t.calculateHints(e)})("ngModelChange",function(e){return t.$implicit.Type=e}),M.TgZ(13,"mat-select-trigger"),M.TgZ(14,"mat-icon",17),M._uU(15),M.qZA(),M.TgZ(16,"span"),M._uU(17),M.qZA(),M.qZA(),M.YNc(18,z,5,3,"mat-option",18),M.qZA(),M.qZA(),M.TgZ(19,"app-field-hint"),M._uU(20),M.qZA(),M.qZA(),M.TgZ(21,"div",12),M.TgZ(22,"mat-form-field",13),M.TgZ(23,"mat-label"),M._uU(24,"Input Type"),M.qZA(),M.TgZ(25,"mat-select",16),M.NdJ("selectionChange",function(){var e=M.CHM(n).index;return M.oxw(2).calculateHints(e)})("ngModelChange",function(e){return t.$implicit.InputType=e}),M.TgZ(26,"mat-select-trigger"),M.TgZ(27,"span"),M._uU(28),M.qZA(),M.TgZ(29,"mat-icon",19),M._uU(30),M.qZA(),M.qZA(),M.YNc(31,G,4,6,"mat-option",20),M.qZA(),M.qZA(),M.TgZ(32,"app-field-hint"),M._uU(33),M.qZA(),M.qZA(),M.qZA()}if(2&e){var i,o,r=t.$implicit,s=t.index,a=M.MAs(6),p=M.oxw(2);M.xp6(5),M.Q6J("pattern",p.fieldNamePattern)("appReservedNames",p.reservedNames)("ngModel",r.StaticName)("name","StaticName"+s)("disabled","inputType"===p.editMode),M.xp6(2),M.Q6J("ngIf",a.touched&&a.errors),M.xp6(5),M.Q6J("ngModel",r.Type)("name","Type"+s)("disabled",null!=p.editMode),M.xp6(3),M.Oqu(p.findIcon(r.Type)),M.xp6(2),M.Oqu(r.Type),M.xp6(1),M.Q6J("ngForOf",p.dataTypes),M.xp6(2),M.Oqu(p.dataTypeHints[s]),M.xp6(5),M.Q6J("ngModel",r.InputType)("name","InputType"+s)("disabled","name"===p.editMode),M.xp6(3),M.Oqu(null==(i=p.getInputTypeOption(r.InputType))?null:i.label),M.xp6(2),M.Oqu(null==(o=p.getInputTypeOption(r.InputType))?null:o.icon),M.xp6(1),M.Q6J("ngForOf",p.filteredInputTypeOptions[s]),M.xp6(2),M.Oqu(p.inputTypeHints[s])}}function V(e,t){if(1&e){var n=M.EpF();M.TgZ(0,"form",4,5),M.NdJ("ngSubmit",function(){return M.CHM(n),M.oxw().save()}),M.TgZ(2,"div",6),M.YNc(3,K,34,20,"div",7),M.qZA(),M.TgZ(4,"div",8),M.TgZ(5,"button",9),M.NdJ("click",function(){return M.CHM(n),M.oxw().closeDialog()}),M._uU(6,"Cancel"),M.qZA(),M.TgZ(7,"button",10),M.ALo(8,"async"),M._uU(9," Save "),M.qZA(),M.qZA(),M.qZA()}if(2&e){var i=M.MAs(1),o=M.oxw();M.xp6(3),M.Q6J("ngForOf",o.fields),M.xp6(4),M.Q6J("disabled",!i.form.valid||M.lcZ(8,2,o.saving$))}}var W=function(){function e(e,t,n,i,o){var a=this;this.dialogRef=e,this.route=t,this.contentTypesService=n,this.contentTypesFieldsService=i,this.snackBar=o,this.hostClass="dialog-component",this.fields=[],this.filteredInputTypeOptions=[],this.dataTypeHints=[],this.inputTypeHints=[],this.fieldNamePattern=x,this.fieldNameError="Standard letters and numbers are allowed. Must start with a letter.",this.findIcon=O.x,this.loading$=new r.X(!0),this.saving$=new r.X(!1),this.subscription=new s.w,this.dialogRef.disableClose=!0,this.subscription.add(this.dialogRef.backdropClick().subscribe(function(e){a.form.dirty&&!confirm("You have unsaved changes. Are you sure you want to close this dialog?")||a.closeDialog()}))}return e.prototype.ngOnInit=function(){var e=this;this.editMode=this.route.snapshot.paramMap.get("editMode");var t=this.route.snapshot.paramMap.get("contentTypeStaticName"),n=this.contentTypesService.retrieveContentType(t).pipe((0,g.B)()),o=n.pipe((0,h.zg)(function(t){return e.contentTypesFieldsService.getFields(t.StaticName)})),r=this.contentTypesFieldsService.typeListRetrieve().pipe((0,m.U)(function(e){return function(e){var t,n,o=[];try{for(var r=(0,i.XA)(e),s=r.next();!s.done;s=r.next()){var a=s.value;o.push({name:a,label:N[a].label,icon:(0,O.x)(a),description:N[a].description})}}catch(p){t={error:p}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return o}(e)})),s=this.contentTypesFieldsService.getInputTypesList(),p=this.contentTypesFieldsService.getReservedNames();(0,a.D)([n,o,r,s,p]).subscribe(function(t){var n=(0,i.CR)(t,5),o=n[1],r=n[2],s=n[3],a=n[4];e.contentType=n[0],e.dataTypes=r,e.inputTypeOptions=s;var p={};if(o.forEach(function(e){p[e.StaticName]="Field with this name already exists"}),e.reservedNames=(0,i.pi)((0,i.pi)({},a),p),null!=e.editMode){var c=e.route.snapshot.paramMap.get("id")?parseInt(e.route.snapshot.paramMap.get("id"),10):null,l=o.find(function(e){return e.Id===c});"name"===e.editMode&&delete e.reservedNames[l.StaticName],e.fields.push(l)}else for(var u=1;u<=8;u++)e.fields.push({Id:0,Type:Z.Q.String,InputType:b.v.StringDefault,StaticName:"",IsTitle:0===o.length,SortOrder:o.length+u});for(u=0;u<e.fields.length;u++)e.filterInputTypeOptions(u),e.calculateHints(u);e.loading$.next(!1)})},e.prototype.ngOnDestroy=function(){this.loading$.complete(),this.saving$.complete(),this.subscription.unsubscribe()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.filterInputTypeOptions=function(e){var t=this;this.filteredInputTypeOptions[e]=this.inputTypeOptions.filter(function(n){return n.dataType===t.fields[e].Type.toLocaleLowerCase()})},e.prototype.resetInputType=function(e){var t=this.fields[e].Type.toLocaleLowerCase()+b.v.DefaultSuffix;this.filteredInputTypeOptions[e].some(function(e){return e.inputType===t})||(t=this.filteredInputTypeOptions[e][0].inputType),this.fields[e].InputType=t},e.prototype.calculateHints=function(e){var t,n,i=this,o=this.dataTypes.find(function(t){return t.name===i.fields[e].Type}),r=this.inputTypeOptions.find(function(t){return t.inputType===i.fields[e].InputType});this.dataTypeHints[e]=null!==(t=null==o?void 0:o.description)&&void 0!==t?t:"",this.inputTypeHints[e]=(null==r?void 0:r.isObsolete)?"OBSOLETE - "+r.obsoleteMessage:null!==(n=null==r?void 0:r.description)&&void 0!==n?n:""},e.prototype.getInputTypeOption=function(e){return this.inputTypeOptions.find(function(t){return t.inputType===e})},e.prototype.save=function(){var e=this;if(this.saving$.next(!0),this.snackBar.open("Saving..."),null!=this.editMode){var t=this.fields[0];"name"===this.editMode?this.contentTypesFieldsService.rename(t.Id,this.contentType.Id,t.StaticName).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()}):"inputType"===this.editMode&&this.contentTypesFieldsService.updateInputType(t.Id,t.StaticName,t.InputType).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})}else p.of.apply(void 0,(0,i.ev)([],(0,i.CR)(this.fields))).pipe((0,y.h)(function(e){return!!e.StaticName}),(0,v.b)(function(t){return e.contentTypesFieldsService.add(t,e.contentType.Id).pipe((0,T.K)(function(e){return(0,p.of)(null)}))}),function(e,t){return arguments.length>=2?function(n){return(0,d.z)((0,c.R)(e,t),(0,l.h)(1),(0,u.d)(t))(n)}:function(t){return(0,d.z)((0,c.R)(function(t,n,i){return e(t,n,i+1)}),(0,l.h)(1))(t)}}(f,[])).subscribe(function(t){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})},e.\u0275fac=function(t){return new(t||e)(M.Y36(C.so),M.Y36(A.gz),M.Y36(q.s),M.Y36(I.Mr),M.Y36(_.ux))},e.\u0275cmp=M.Xpm({type:e,selectors:[["app-edit-content-type-fields"]],viewQuery:function(e,t){var n;1&e&&M.Gf($,5,o.F),2&e&&M.iGM(n=M.CRH())&&(t.form=n.first)},hostVars:1,hostBindings:function(e,t){2&e&&M.Ikx("className",t.hostClass)},decls:7,vars:6,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["class","dialog-form",3,"ngSubmit",4,"ngIf"],[1,"dialog-form",3,"ngSubmit"],["ngForm","ngForm"],[1,"dialog-form-content","fancy-scrollbar-light"],["class","row-container",4,"ngFor","ngForOf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","submit","color","accent",3,"disabled"],[1,"row-container"],[1,"edit-input"],["appearance","standard","color","accent"],["matInput","",3,"pattern","appReservedNames","ngModel","name","disabled","ngModelChange"],["staticName","ngModel"],[3,"ngModel","name","disabled","selectionChange","ngModelChange"],[1,"type-icon"],[3,"value",4,"ngFor","ngForOf"],[1,"input-icon"],[3,"value","ngClass",4,"ngFor","ngForOf"],[3,"isError",4,"ngIf"],[3,"isError"],[3,"value"],[3,"value","ngClass"],["class","input-icon",4,"ngIf"]],template:function(e,t){1&e&&(M.TgZ(0,"div",0),M.TgZ(1,"div",1),M.YNc(2,H,2,0,"ng-container",2),M.YNc(3,P,2,0,"ng-container",2),M.YNc(4,L,2,0,"ng-container",2),M.qZA(),M.qZA(),M.YNc(5,V,10,4,"form",3),M.ALo(6,"async")),2&e&&(M.xp6(2),M.Q6J("ngIf",void 0===t.editMode),M.xp6(1),M.Q6J("ngIf",null===t.editMode),M.xp6(1),M.Q6J("ngIf",null!=t.editMode),M.xp6(1),M.Q6J("ngIf",!1===M.lcZ(6,4,t.loading$)))},directives:[C.uh,w.O5,o._Y,o.JL,o.F,w.sg,S.lW,F.KE,F.hX,k.Nt,o.Fj,o.c5,J,o.JJ,o.On,Q.gD,Q.$L,Y.Hw,E.Y,U.ey,w.mk],pipes:[w.Ov],styles:[".row-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.edit-input[_ngcontent-%COMP%]{padding-bottom:8px;width:30%}.type-icon[_ngcontent-%COMP%]{margin-right:8px}.input-icon[_ngcontent-%COMP%], .type-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;font-size:inherit;vertical-align:top;line-height:inherit}.input-icon[_ngcontent-%COMP%]{margin-left:8px}.input-obsolete[_ngcontent-%COMP%]{-webkit-text-decoration:#000 line-through;text-decoration:#000 line-through;color:dimgray}"]}),e}()},7110:function(e,t,n){"use strict";n.d(t,{Y:function(){return f}});var i=n(1785),o=n(1116),r=n(3070);function s(e,t){1&e&&i.GkF(0)}function a(e,t){if(1&e&&(i.TgZ(0,"mat-hint"),i.YNc(1,s,1,0,"ng-container",3),i.qZA()),2&e){i.oxw();var n=i.MAs(4);i.xp6(1),i.Q6J("ngTemplateOutlet",n)}}function p(e,t){1&e&&i.GkF(0)}function c(e,t){if(1&e&&(i.TgZ(0,"mat-error"),i.YNc(1,p,1,0,"ng-container",3),i.qZA()),2&e){i.oxw();var n=i.MAs(4);i.xp6(1),i.Q6J("ngTemplateOutlet",n)}}function l(e,t){1&e&&i.Hsn(0)}var u=function(e){return{"hint-box__short":e}},d=["*"],f=function(){function e(){this.isError=!1,this.isShort=!0}return e.prototype.toggleIsShort=function(){this.isShort=!this.isShort},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Xpm({type:e,selectors:[["app-field-hint"]],inputs:{isError:"isError"},ngContentSelectors:d,decls:5,vars:6,consts:[[1,"hint-box",3,"ngClass","ngSwitch","click"],[4,"ngSwitchCase"],["content",""],[4,"ngTemplateOutlet"]],template:function(e,t){1&e&&(i.F$t(),i.TgZ(0,"div",0),i.NdJ("click",function(){return t.toggleIsShort()}),i.YNc(1,a,2,1,"mat-hint",1),i.YNc(2,c,2,1,"mat-error",1),i.qZA(),i.YNc(3,l,1,0,"ng-template",null,2,i.W1O)),2&e&&(i.Q6J("ngClass",i.VKq(4,u,t.isShort))("ngSwitch",t.isError),i.xp6(1),i.Q6J("ngSwitchCase",!1),i.xp6(1),i.Q6J("ngSwitchCase",!0))},directives:[o.mk,o.RF,o.n9,r.bx,o.tP,r.TO],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-error[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-hint[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-error[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-hint[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.01.00/ng-edit/projects_ng-dialogs_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fi-2daed6.8c4521b63c93d5f2d163.js.map