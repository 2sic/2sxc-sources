{"version":3,"mappings":"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","names":["ContentItemsService","constructor","http","context","dnnContext","this","getAll","contentTypeStaticName","get","$2sxc","apiUrl","webApiEntityList","params","appId","toString","contentType","getColumns","webApiFieldsAll","staticName","importItem","file","from","toBase64","pipe","switchMap","fileBase64","post","webApiEntityRoot","AppId","ContentBase64","map","success","Success","Messages","i0","factory","FeatureDetailService","getFeatureDetails","featureNameId","webApiRoot","nameId","ctx_r5","oxw","ctx_r8","ctx_r10","FeatureInfoDialogComponent","dialogData","dialogRef","snackBar","featureDetailService","feature$","ngOnInit","copyToClipboard","text","open","duration","findOutMore","link","window","closeDialog","close","MAT_DIALOG_DATA","selectors","FeatureComponentBase","dialog","viewContainerRef","changeDetectorRef","featuresService","BehaviorSubject","featureNameId$","featName","get$","show$","combineLatest","showIf$","feat","showIf","U","F","Enabled","_a","value","next","openDialog","featureId","autoFocus","data","width","markForCheck","inputs","ConfirmDeleteDialogComponent","confirm","ctx","MetadataActionsComponent","agInit","refresh","deleteMetadata","onDelete","MetadataContentTypeComponent","metadata","ctx_r12","ctx_r14","ctx_r15","ctx_r16","ctx_r17","MetadataSaveDialogComponent","contentTypesService","dropdownInsertValue","contentTypes$","scopeOptions$","buildForm","fetchScopes","templateVars$","contentTypes","scopeOptions","ngOnDestroy","complete","toggleGuidedContentType","guidedContentType","toggleAdvancedMode","event","advancedMode","checked","formValues","form","getRawValue","FormGroup","addControl","FormControl","Validators","eavConstants","controls","scope","valueChanges","startWith","distinctUntilChanged","subscribe","newScope","patchValue","prompt","some","option","name","fetchContentTypes","retrieveContentTypes","getScopes","scopes","ctx_r25","ctx_r27","ctx_r29","ctx_r31","MetadataComponent","BaseComponent","router","route","metadataService","entitiesService","contentItemsService","super","buildGridOptions","undefined","parseInt","snapshot","paramMap","decodeURIComponent","Q","fetchFor","fetchMetadata","subscription","add","refreshOnChildClosedShallow","filteredRecommendations$","metadata$","recommendations$","metadataItems","recommendations","filter","r","i","_Type","Id","length","Count","itemFor$","fabOpen$","itemFor","fabOpen","openChange","createMetadata","recommendation","CreateEmpty","Name","create","For","calculateItemFor","error","createMetadataForm","MissingFeature","afterClosed","items","ContentTypeName","formUrl","convertFormToUrl","navigate","relativeTo","Object","Target","a","e","values","find","m","targetType","target","_b","TargetType","keyType","Guid","key","Number","String","item","getMetadata","Recommendations","forEach","s","Icon","startsWith","replace","atob","tap","Items","editMetadata","EntityId","confirmed","delete","entityId","entityTitle","Title","message","DeleteWarning","isConfirmed","defaultGridOptions","columnDefs","headerName","field","headerClass","cellClass","split","sortable","valueGetter","cellRenderer","IdFieldComponent","cellRendererParams","tooltipGetter","flex","minWidth","sort","onCellClicked","pinned","FieldHintComponent","toggleIsShort","isShort","ClickStopPropagationDirective","onClick","stopPropagation","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","readAsText"],"sources":["./projects/eav-ui/src/app/content-items/services/content-items.service.ts","./projects/eav-ui/src/app/features/services/feature-detail.service.ts","./projects/eav-ui/src/app/features/feature-info-dialog/feature-info-dialog.component.html","./projects/eav-ui/src/app/features/feature-info-dialog/feature-info-dialog.component.ts","./projects/eav-ui/src/app/features/shared/base-feature.component.ts","./projects/eav-ui/src/app/metadata/confirm-delete-dialog/confirm-delete-dialog.component.html","./projects/eav-ui/src/app/metadata/confirm-delete-dialog/confirm-delete-dialog.component.ts","./projects/eav-ui/src/app/metadata/metadata-actions/metadata-actions.component.ts","./projects/eav-ui/src/app/metadata/metadata-actions/metadata-actions.component.html","./projects/eav-ui/src/app/metadata/metadata-content-type/metadata-content-type.component.ts","./projects/eav-ui/src/app/metadata/metadata-content-type/metadata-content-type.component.html","./projects/eav-ui/src/app/metadata/metadata-save-dialog/metadata-save-dialog.component.html","./projects/eav-ui/src/app/metadata/metadata-save-dialog/metadata-save-dialog.component.ts","./projects/eav-ui/src/app/metadata/metadata.component.html","./projects/eav-ui/src/app/metadata/metadata.component.ts","./projects/eav-ui/src/app/shared/components/field-hint/field-hint.component.html","./projects/eav-ui/src/app/shared/components/field-hint/field-hint.component.ts","./projects/eav-ui/src/app/shared/directives/click-stop-propagation.directive.ts","./projects/eav-ui/src/app/shared/helpers/file-to-base64.helper.ts"],"sourcesContent":["import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { from, map, switchMap } from 'rxjs';\r\nimport { Field } from '../../content-type-fields/models/field.model';\r\nimport { webApiFieldsAll } from '../../content-type-fields/services/content-types-fields.service';\r\nimport { webApiEntityList, webApiEntityRoot } from '../../edit/shared/services';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { toBase64 } from '../../shared/helpers/file-to-base64.helper';\r\nimport { Context } from '../../shared/services/context';\r\nimport { ContentItem } from '../models/content-item.model';\r\n\r\n@Injectable()\r\nexport class ContentItemsService {\r\n  constructor(private http: HttpClient, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  getAll(contentTypeStaticName: string) {\r\n    return this.http.get<ContentItem[]>(this.dnnContext.$2sxc.http.apiUrl(webApiEntityList), {\r\n      params: { appId: this.context.appId.toString(), contentType: contentTypeStaticName }\r\n    });\r\n  }\r\n\r\n  getColumns(contentTypeStaticName: string) {\r\n    return this.http.get<Field[]>(this.dnnContext.$2sxc.http.apiUrl(webApiFieldsAll), {\r\n      params: { appId: this.context.appId.toString(), staticName: contentTypeStaticName }\r\n    });\r\n  }\r\n\r\n  importItem(file: File) {\r\n    return from(toBase64(file)).pipe(\r\n      switchMap(fileBase64 => {\r\n        return this.http.post<boolean>(this.dnnContext.$2sxc.http.apiUrl(webApiEntityRoot + 'upload'), {\r\n          AppId: this.context.appId.toString(),\r\n          ContentBase64: fileBase64,\r\n        });\r\n      }),\r\n      map(success => {\r\n        const result: FileUploadResult = {\r\n          Success: success,\r\n          Messages: [],\r\n        };\r\n        return result;\r\n      }),\r\n    );\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { Feature } from '../models';\r\n\r\nexport const webApiRoot = \"admin/feature/\";\r\n\r\n@Injectable()\r\nexport class FeatureDetailService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private dnnContext: DnnContext\r\n  ) { }\r\n\r\n  getFeatureDetails(featureNameId: string): Observable<Feature> {\r\n    return this.http.get<Feature>(this.dnnContext.$2sxc.http.apiUrl(webApiRoot + 'details'), {\r\n      params: { nameId: featureNameId }\r\n    });\r\n  }\r\n}\r\n","<div *ngIf=\"(feature$ | async) as feature\">\r\n  <div mat-dialog-title>\r\n    <div class=\"dialog-title-box\">\r\n      <div>{{ feature.Name }}</div>\r\n    </div>\r\n  </div>\r\n\r\n  <p class=\"dialog-description\" [innerHtml]=\"feature.Description | safeHtml\"></p>\r\n\r\n  <div class=\"info-box\">\r\n    <div class=\"info-row\">\r\n      <div class=\"info-row__label\">{{ \"Features.Status\" | translate }}</div>\r\n      <div class=\"info-row__value\">\r\n        <span>{{ (feature.Enabled ? \"Features.Active\" : \"Features.NotActive\") | translate }}</span>\r\n      </div>\r\n    </div>\r\n    <div class=\"info-row\" *ngIf=\"feature.NameId as id\">\r\n      <div class=\"info-row__label\">ID</div>\r\n      <div class=\"info-row__value click\">\r\n        <span [tippy]=\"id\" (click)=\"copyToClipboard(id)\">{{ id }}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"dialog-component-actions\">\r\n    <button *ngIf=\"feature.Link as link\" mat-raised-button class=\"dialog-component-button\" color=\"accent\" (click)=\"findOutMore(link)\">\r\n      <mat-icon>open_in_new</mat-icon>\r\n      {{ \"Features.FindOutMore\" | translate }}\r\n    </button>\r\n    <button mat-raised-button class=\"dialog-component-button\" (click)=\"closeDialog()\">\r\n      {{ \"Features.Close\" | translate }}\r\n    </button>\r\n  </div>\r\n\r\n</div>","import { Component, Inject, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { Observable } from 'rxjs';\r\nimport { copyToClipboard } from '../../shared/helpers/copy-to-clipboard.helper';\r\nimport { Feature } from '../models';\r\nimport { FeatureDetailService } from '../services/feature-detail.service';\r\n\r\n@Component({\r\n  selector: 'app-feature-info-dialog',\r\n  templateUrl: './feature-info-dialog.component.html',\r\n  styleUrls: ['./feature-info-dialog.component.scss']\r\n})\r\nexport class FeatureInfoDialogComponent implements OnInit {\r\n  feature$: Observable<Feature>;\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) public dialogData: string,\r\n    private dialogRef: MatDialogRef<FeatureInfoDialogComponent>,\r\n    private snackBar: MatSnackBar,\r\n    private featureDetailService: FeatureDetailService,\r\n  ) {\r\n    this.feature$ = this.featureDetailService.getFeatureDetails(dialogData);\r\n   }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n  copyToClipboard(text: string): void {\r\n    copyToClipboard(text);\r\n    this.snackBar.open('Copied to clipboard', null, { duration: 2000 });\r\n  }\r\n\r\n  findOutMore(link: string): void { \r\n    window.open(link, '_blank');\r\n  }\r\n\r\n  closeDialog(): void {\r\n    this.dialogRef.close();\r\n  }\r\n}\r\n","import { ChangeDetectorRef, Directive, Input, ViewContainerRef } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { FeaturesService } from '../../shared/services/features.service';\r\nimport { FeatureInfoDialogComponent } from '../feature-info-dialog/feature-info-dialog.component';\r\nimport { BehaviorSubject, switchMap, Observable, map, combineLatest } from 'rxjs';\r\nimport { FeatureSummary } from '../models';\r\n\r\n@Directive()\r\nexport class FeatureComponentBase {\r\n  /** Feature NameId to check */\r\n  @Input()\r\n  public set featureNameId(value: string) { this.featureNameId$.next(value); }\r\n  protected featureNameId$ = new BehaviorSubject<string>(null);\r\n\r\n  /** By default, it will show if it's false - here we can change it to show if true */\r\n  @Input()\r\n  public set showIf(value: boolean) { this.showIf$.next(value == true); }\r\n  protected showIf$ = new BehaviorSubject<boolean>(false);\r\n\r\n  // TODO: @SDV - MAKE REACTIVE - SEE text-info-component example\r\n  // featureOn: boolean = true;\r\n  feature$: Observable<FeatureSummary>;\r\n  show$: Observable<boolean>;\r\n\r\n  constructor(\r\n    private dialog: MatDialog,\r\n    private viewContainerRef: ViewContainerRef,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n    protected featuresService: FeaturesService\r\n  ) {\r\n    this.feature$ = this.featureNameId$.pipe(\r\n      switchMap(featName => this.featuresService.get$(featName)\r\n    ));\r\n    this.show$ = combineLatest([this.feature$, this.showIf$]).pipe(\r\n      // tap(data => console.log('2dm - show$', data)),\r\n      map(([feat,showIf]) => showIf == (feat?.Enabled ?? false))\r\n    );\r\n  }\r\n\r\n  openDialog() {\r\n    FeatureComponentBase.openDialog(this.dialog, this.featureNameId$.value, this.viewContainerRef, this.changeDetectorRef);\r\n  }\r\n\r\n  /** Public/Static so it can be called from elsewhere */\r\n  public static openDialog(dialog: MatDialog, featureId: string, viewContainerRef: ViewContainerRef, changeDetectorRef: ChangeDetectorRef) {\r\n    dialog.open(FeatureInfoDialogComponent, {\r\n      autoFocus: false,\r\n      data: featureId,\r\n      viewContainerRef: viewContainerRef,\r\n      // TODO: this looks wrong. I believe we have some way to standardize dialog sizes...\r\n      width: '600px',\r\n    });\r\n\r\n    changeDetectorRef.markForCheck();\r\n  }\r\n}\r\n","<div mat-dialog-title>\r\n  <div class=\"dialog-title-box\">Delete {{ dialogData.entityTitle }} ({{ dialogData.entityId }})?</div>\r\n</div>\r\n\r\n<div class=\"dialog-component-content fancy-scrollbar-light\" *ngIf=\"dialogData.message\"\r\n  [innerHtml]=\"dialogData.message | safeHtml\">\r\n</div>\r\n\r\n<div class=\"dialog-component-actions\">\r\n  <button mat-raised-button (click)=\"closeDialog()\">Cancel</button>\r\n  <button mat-raised-button (click)=\"closeDialog(true)\">Delete</button>\r\n</div>\r\n","import { Component, HostBinding, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { ConfirmDeleteDialogData } from './confirm-delete-dialog.models';\r\n\r\n@Component({\r\n  selector: 'app-confirm-delete-dialog',\r\n  templateUrl: './confirm-delete-dialog.component.html',\r\n  styleUrls: ['./confirm-delete-dialog.component.scss'],\r\n})\r\nexport class ConfirmDeleteDialogComponent {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) public dialogData: ConfirmDeleteDialogData,\r\n    private dialogRef: MatDialogRef<ConfirmDeleteDialogComponent>,\r\n  ) { }\r\n\r\n  closeDialog(confirm?: boolean) {\r\n    this.dialogRef.close(confirm);\r\n  }\r\n}\r\n","import { ICellRendererAngularComp } from '@ag-grid-community/angular';\r\nimport { ICellRendererParams } from '@ag-grid-community/core';\r\nimport { Component } from '@angular/core';\r\nimport { MetadataItem } from '../models/metadata.model';\r\nimport { MetadataActionsParams } from './metadata-actions.models';\r\n\r\n@Component({\r\n  selector: 'app-metadata-actions',\r\n  templateUrl: './metadata-actions.component.html',\r\n  styleUrls: ['./metadata-actions.component.scss'],\r\n})\r\nexport class MetadataActionsComponent implements ICellRendererAngularComp {\r\n  private params: ICellRendererParams & MetadataActionsParams;\r\n\r\n  agInit(params: ICellRendererParams & MetadataActionsParams): void {\r\n    this.params = params;\r\n  }\r\n\r\n  refresh(params?: any): boolean {\r\n    return true;\r\n  }\r\n\r\n  deleteMetadata(): void {\r\n    const metadata: MetadataItem = this.params.data;\r\n    this.params.onDelete(metadata);\r\n  }\r\n}\r\n","<div class=\"actions-component\">\r\n  <div class=\"like-button highlight\" matRipple tippy=\"Delete\" (click)=\"deleteMetadata()\">\r\n    <mat-icon>delete</mat-icon>\r\n  </div>\r\n</div>","import { ICellRendererAngularComp } from '@ag-grid-community/angular';\r\nimport { ICellRendererParams } from '@ag-grid-community/core';\r\nimport { Component } from '@angular/core';\r\nimport { MetadataItem } from '../models/metadata.model';\r\n\r\n@Component({\r\n  selector: 'app-metadata-content-type',\r\n  templateUrl: './metadata-content-type.component.html',\r\n  styleUrls: ['./metadata-content-type.component.scss'],\r\n})\r\nexport class MetadataContentTypeComponent implements ICellRendererAngularComp {\r\n  value: string;\r\n  metadata: MetadataItem;\r\n\r\n  agInit(params: ICellRendererParams) {\r\n    this.value = params.value;\r\n    this.metadata = params.data;\r\n  }\r\n\r\n  refresh(params?: any): boolean {\r\n    return true;\r\n  }\r\n}\r\n","<div class=\"container\" [tippy]=\"metadata._Type.Description\" [tippyDisabled]=\"!metadata._Type.Description\">\r\n  {{ value }}\r\n</div>\r\n","<ng-container *ngIf=\"templateVars$ | async as data\">\r\n  <div mat-dialog-title>\r\n    <div class=\"dialog-title-box\">Create Metadata</div>\r\n  </div>\r\n\r\n  <p class=\"dialog-description\">\r\n    This is a special operation to add an item which is metadata for another item,\r\n    see <a href=\"http://r.2sxc.org/metadata\" target=\"_blank\">docs</a>.\r\n  </p>\r\n\r\n  <form [formGroup]=\"form\" class=\"dialog-form\">\r\n    <div class=\"dialog-form-content fancy-scrollbar-light\">\r\n\r\n      <!-- Scope -->\r\n      <ng-container *ngIf=\"advancedMode && guidedContentType\">\r\n        <mat-form-field appearance=\"standard\" color=\"accent\">\r\n          <mat-label>Scope</mat-label>\r\n          <mat-select formControlName=\"scope\" [placeholder]=\"!data.scopeOptions.length ? 'No items found' : ''\">\r\n            <mat-option *ngFor=\"let scopeOption of data.scopeOptions\" [value]=\"scopeOption.value\">\r\n              {{ scopeOption.name }}\r\n            </mat-option>\r\n            <mat-option [value]=\"dropdownInsertValue\">Other...</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n        <app-field-hint>\r\n          The scope should almost never be changed -\r\n          <a href=\"https://2sxc.org/help?tag=scope\" target=\"_blank\" appClickStopPropagation>see help</a>\r\n        </app-field-hint>\r\n      </ng-container>\r\n\r\n      <!-- Content Type of metadata item -->\r\n      <mat-form-field appearance=\"standard\" color=\"accent\">\r\n        <mat-label>Content Type</mat-label>\r\n        <mat-select *ngIf=\"guidedContentType\" formControlName=\"contentType\" required\r\n          [placeholder]=\"!data.contentTypes.length ? 'No items found' : ''\">\r\n          <mat-option *ngFor=\"let contentType of data.contentTypes\" [value]=\"contentType.StaticName\">\r\n            {{ contentType.Label }}\r\n          </mat-option>\r\n        </mat-select>\r\n\r\n        <input matInput type=\"text\" *ngIf=\"!guidedContentType\" formControlName=\"contentType\" required>\r\n\r\n        <div matSuffix class=\"selection-suffix\">\r\n          <button mat-icon-button type=\"button\" [ngClass]=\"{ 'active': guidedContentType }\" tippy=\"Pick existing value\"\r\n            (click)=\"toggleGuidedContentType(true)\">\r\n            <mat-icon>search</mat-icon>\r\n          </button>\r\n          <button mat-icon-button type=\"button\" [ngClass]=\"{ 'active': !guidedContentType }\" tippy=\"Manual entry\"\r\n            (click)=\"toggleGuidedContentType(false)\">\r\n            <mat-icon>text_fields</mat-icon>\r\n          </button>\r\n        </div>\r\n      </mat-form-field>\r\n      <app-field-hint *ngIf=\"form.controls.contentType.touched && form.controls.contentType.errors?.required\"\r\n        [isError]=\"true\">\r\n        This field is required\r\n      </app-field-hint>\r\n    </div>\r\n\r\n    <div class=\"dialog-form-actions\">\r\n      <mat-slide-toggle color=\"accent\" [checked]=\"advancedMode\" (change)=\"toggleAdvancedMode($event)\">\r\n        {{ advancedMode ? 'Advanced' : 'Simple' }}\r\n      </mat-slide-toggle>\r\n      <div class=\"spacer\"></div>\r\n      <button mat-raised-button type=\"button\" (click)=\"closeDialog()\">Cancel</button>\r\n      <button mat-raised-button type=\"button\" color=\"accent\" [disabled]=\"!form.valid\" (click)=\"confirm()\">\r\n        Confirm\r\n      </button>\r\n    </div>\r\n  </form>\r\n</ng-container>","import { Component, HostBinding, OnDestroy, OnInit } from '@angular/core';\r\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\r\nimport { BehaviorSubject, combineLatest, distinctUntilChanged, map, Observable, startWith } from 'rxjs';\r\nimport { ContentType } from '../../app-administration/models';\r\nimport { ContentTypesService } from '../../app-administration/services';\r\nimport { dropdownInsertValue } from '../../shared/constants/dropdown-insert-value.constant';\r\nimport { eavConstants, ScopeOption } from '../../shared/constants/eav.constants';\r\nimport { MetadataSaveDialogTemplateVars, MetadataSaveFormValues } from './metadata-save-dialog.models';\r\n\r\n@Component({\r\n  selector: 'app-metadata-save-dialog',\r\n  templateUrl: './metadata-save-dialog.component.html',\r\n  styleUrls: ['./metadata-save-dialog.component.scss']\r\n})\r\nexport class MetadataSaveDialogComponent implements OnInit, OnDestroy {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  form: FormGroup;\r\n  dropdownInsertValue = dropdownInsertValue;\r\n  templateVars$: Observable<MetadataSaveDialogTemplateVars>;\r\n  guidedContentType = true;\r\n  advancedMode = false;\r\n\r\n  private contentTypes$: BehaviorSubject<ContentType[]>;\r\n  private scopeOptions$: BehaviorSubject<ScopeOption[]>;\r\n\r\n  constructor(\r\n    private dialogRef: MatDialogRef<MetadataSaveDialogComponent>,\r\n    private contentTypesService: ContentTypesService,\r\n  ) { }\r\n\r\n  ngOnInit(): void {\r\n    this.contentTypes$ = new BehaviorSubject<ContentType[]>([]);\r\n    this.scopeOptions$ = new BehaviorSubject<ScopeOption[]>([]);\r\n\r\n    this.buildForm();\r\n    this.fetchScopes();\r\n\r\n    this.templateVars$ = combineLatest([this.contentTypes$, this.scopeOptions$]).pipe(\r\n      map(([contentTypes, scopeOptions]) => {\r\n        const templateVars: MetadataSaveDialogTemplateVars = {\r\n          contentTypes,\r\n          scopeOptions,\r\n        };\r\n        return templateVars;\r\n      }),\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.contentTypes$.complete();\r\n    this.scopeOptions$.complete();\r\n  }\r\n\r\n  closeDialog(contentType?: string): void {\r\n    this.dialogRef.close(contentType);\r\n  }\r\n\r\n  toggleGuidedContentType(guidedContentType: boolean): void {\r\n    this.guidedContentType = guidedContentType;\r\n  }\r\n\r\n  toggleAdvancedMode(event: MatSlideToggleChange): void {\r\n    this.advancedMode = event.checked;\r\n  }\r\n\r\n  confirm(): void {\r\n    const formValues: MetadataSaveFormValues = this.form.getRawValue();\r\n    this.closeDialog(formValues.contentType);\r\n  }\r\n\r\n  private buildForm(): void {\r\n    this.form = new FormGroup({});\r\n    this.form.addControl('contentType', new FormControl(null, [Validators.required]));\r\n    this.form.addControl('scope', new FormControl(eavConstants.scopes.default.value));\r\n\r\n    this.form.controls.scope.valueChanges.pipe(\r\n      startWith(this.form.controls.scope.value),\r\n      distinctUntilChanged(),\r\n    ).subscribe((newScope: string) => {\r\n      // reset content types when scope changes\r\n      if (this.form.controls.contentType.value != null) {\r\n        this.form.controls.contentType.patchValue(null);\r\n      }\r\n\r\n      // add new scope on manual entry\r\n      if (newScope === dropdownInsertValue) {\r\n        newScope = prompt('This is an advanced feature to show content-types of another scope. Don\\'t use this if you don\\'t know what you\\'re doing, as content-types of other scopes are usually hidden for a good reason.') || eavConstants.scopes.default.value;\r\n        if (!this.scopeOptions$.value.some(option => option.value === newScope)) {\r\n          const newScopeOption: ScopeOption = {\r\n            name: newScope,\r\n            value: newScope,\r\n          };\r\n          this.scopeOptions$.next([newScopeOption, ...this.scopeOptions$.value]);\r\n        }\r\n        this.form.controls.scope.patchValue(newScope);\r\n      } else {\r\n        this.fetchContentTypes(newScope);\r\n      }\r\n    });\r\n  }\r\n\r\n  private fetchContentTypes(scope: string): void {\r\n    this.contentTypesService.retrieveContentTypes(scope).subscribe(contentTypes => {\r\n      this.contentTypes$.next(contentTypes);\r\n    });\r\n  }\r\n\r\n  private fetchScopes(): void {\r\n    this.contentTypesService.getScopes().subscribe(scopes => {\r\n      this.scopeOptions$.next(scopes);\r\n    });\r\n  }\r\n}\r\n","<ng-container *ngIf=\"templateVars$ | async as data\">\r\n  <div class=\"nav-component-wrapper\">\r\n    <div mat-dialog-title>\r\n      <div class=\"dialog-title-box\">\r\n        <div>{{ title || 'Metadata' }}</div>\r\n        <button mat-icon-button tippy=\"Close dialog\" (click)=\"closeDialog()\">\r\n          <mat-icon>close</mat-icon>\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <p class=\"dialog-description\">\r\n      <ng-container *ngIf=\"!data.itemFor\">This item is not metadata for anything else.</ng-container>\r\n      <ng-container *ngIf=\"data.itemFor\">\r\n        This item is metadata for:\r\n        <br>Target: {{ data.itemFor.Target }}\r\n        <br>TargetType: {{ data.itemFor.TargetType }}\r\n        <ng-container *ngIf=\"data.itemFor.Number\"><br>Number: {{ data.itemFor.Number }}</ng-container>\r\n        <ng-container *ngIf=\"data.itemFor.Guid\"><br>Guid: {{ data.itemFor.Guid }}</ng-container>\r\n        <ng-container *ngIf=\"data.itemFor.String\"><br>String: {{ data.itemFor.String }}</ng-container>\r\n        <ng-container *ngIf=\"data.itemFor.Title\"><br>Title: {{ data.itemFor.String }}</ng-container>\r\n      </ng-container>\r\n    </p>\r\n\r\n    <router-outlet></router-outlet>\r\n\r\n    <div class=\"grid-wrapper\">\r\n      <ag-grid-angular class=\"ag-theme-material\" [rowData]=\"data.metadata\" [gridOptions]=\"gridOptions\">\r\n      </ag-grid-angular>\r\n\r\n      <div class=\"grid-more-actions-box\"></div>\r\n\r\n      <button mat-fab mat-elevation-z24 class=\"grid-fab\" *ngIf=\"data.recommendations.length === 0\"\r\n        tippy=\"Create a new metadata for this item\" (click)=\"createMetadata()\">\r\n        <mat-icon>add</mat-icon>\r\n      </button>\r\n\r\n      <eco-fab-speed-dial class=\"grid-fab\" [ngClass]=\"{ 'fab-opened': data.fabOpen }\"\r\n        *ngIf=\"data.recommendations.length > 0\" (openChange)=\"openChange($event)\">\r\n        <eco-fab-speed-dial-trigger [spin]=\"true\">\r\n          <button mat-fab>\r\n            <mat-icon class=\"spin180\">{{ data.fabOpen ? 'close' : 'add' }}</mat-icon>\r\n          </button>\r\n        </eco-fab-speed-dial-trigger>\r\n\r\n        <eco-fab-speed-dial-actions>\r\n          <button mat-mini-fab label=\"Other Content Type\" (click)=\"createMetadata()\">\r\n            <mat-icon>search</mat-icon>\r\n          </button>\r\n          <button mat-mini-fab *ngFor=\"let recommendation of data.recommendations\" [attr.label]=\"recommendation.Title\"\r\n            (click)=\"createMetadata(recommendation)\">\r\n            <div *ngIf=\"recommendation.Icon; then svgIcon else matIcon\"></div>\r\n            <ng-template #svgIcon>\r\n              <div\r\n                [innerHTML]=\"recommendation.Icon | safeHtml\"\r\n                [matBadgeHidden]=\"recommendation.Enabled\" matBadgeColor=\"accent\" matBadgeSize=\"small\" matBadge=\"ðŸ’Ž\" matBadgePosition=\"below after\"\r\n              ></div>\r\n            </ng-template>\r\n            <!-- this is for all recommendations which don't have an own icon - they use the standard add-icon -->\r\n            <ng-template #matIcon>\r\n              <mat-icon>add</mat-icon>\r\n            </ng-template>\r\n          </button>\r\n        </eco-fab-speed-dial-actions>\r\n      </eco-fab-speed-dial>\r\n    </div>\r\n  </div>\r\n</ng-container>","import { GridOptions } from '@ag-grid-community/core';\r\nimport { ChangeDetectorRef, Component, OnDestroy, OnInit, ViewContainerRef } from '@angular/core';\r\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { BehaviorSubject, combineLatest, map, Observable, tap } from 'rxjs';\r\nimport { ContentItemsService } from '../content-items/services/content-items.service';\r\nimport { EntitiesService } from '../content-items/services/entities.service';\r\nimport { EavFor } from '../edit/shared/models/eav';\r\nimport { MetadataService } from '../permissions';\r\nimport { BaseComponent } from '../shared/components/base-component/base.component';\r\nimport { IdFieldComponent } from '../shared/components/id-field/id-field.component';\r\nimport { IdFieldParams } from '../shared/components/id-field/id-field.models';\r\nimport { defaultGridOptions } from '../shared/constants/default-grid-options.constants';\r\nimport { eavConstants, MetadataKeyType } from '../shared/constants/eav.constants';\r\nimport { convertFormToUrl } from '../shared/helpers/url-prep.helper';\r\nimport { EditForm } from '../shared/models/edit-form.model';\r\nimport { ConfirmDeleteDialogComponent } from './confirm-delete-dialog/confirm-delete-dialog.component';\r\nimport { ConfirmDeleteDialogData } from './confirm-delete-dialog/confirm-delete-dialog.models';\r\nimport { MetadataActionsComponent } from './metadata-actions/metadata-actions.component';\r\nimport { MetadataActionsParams } from './metadata-actions/metadata-actions.models';\r\nimport { MetadataContentTypeComponent } from './metadata-content-type/metadata-content-type.component';\r\nimport { MetadataSaveDialogComponent } from './metadata-save-dialog/metadata-save-dialog.component';\r\nimport { MetadataItem, MetadataRecommendation, MetadataTemplateVars } from './models/metadata.model';\r\nimport { FeatureComponentBase } from '../features/shared/base-feature.component';\r\n\r\n@Component({\r\n  selector: 'app-metadata',\r\n  templateUrl: './metadata.component.html',\r\n  styleUrls: ['./metadata.component.scss'],\r\n})\r\nexport class MetadataComponent extends BaseComponent implements OnInit, OnDestroy {\r\n  gridOptions = this.buildGridOptions();\r\n\r\n  private metadata$ = new BehaviorSubject<MetadataItem[]>([]);\r\n  private recommendations$ = new BehaviorSubject<MetadataRecommendation[]>([]);\r\n  private itemFor$ = new BehaviorSubject<EavFor | undefined>(undefined);\r\n  private fabOpen$ = new BehaviorSubject(false);\r\n  private targetType = parseInt(this.route.snapshot.paramMap.get('targetType'), 10);\r\n  private keyType = this.route.snapshot.paramMap.get('keyType') as MetadataKeyType;\r\n  private key = this.route.snapshot.paramMap.get('key');\r\n  title = decodeURIComponent(this.route.snapshot.paramMap.get('title') ?? '');\r\n  private contentTypeStaticName = this.route.snapshot.paramMap.get('contentTypeStaticName');\r\n  templateVars$: Observable<MetadataTemplateVars>;\r\n\r\n  constructor(\r\n    protected router: Router,\r\n    protected route: ActivatedRoute,\r\n    private dialogRef: MatDialogRef<MetadataComponent>,\r\n\r\n    private metadataService: MetadataService,\r\n    private snackBar: MatSnackBar,\r\n    private entitiesService: EntitiesService,\r\n    private contentItemsService: ContentItemsService,\r\n    private dialog: MatDialog,\r\n    private viewContainerRef: ViewContainerRef,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n  ) { \r\n    super(router, route);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.fetchFor();\r\n    this.fetchMetadata();\r\n    this.subscription.add(this.refreshOnChildClosedShallow().subscribe(() => { this.fetchMetadata(); }));\r\n\r\n    const filteredRecommendations$ = combineLatest([this.metadata$, this.recommendations$]).pipe(\r\n      map(([metadataItems, recommendations]) =>\r\n        recommendations.filter(r => metadataItems.filter(i => i._Type.Id === r.Id).length < r.Count)),\r\n    );\r\n    this.templateVars$ = combineLatest([this.metadata$, filteredRecommendations$, this.itemFor$, this.fabOpen$]).pipe(\r\n      map(([metadata, recommendations, itemFor, fabOpen]) => {\r\n        const templateVars: MetadataTemplateVars = {\r\n          metadata,\r\n          recommendations,\r\n          itemFor,\r\n          fabOpen,\r\n        };\r\n        return templateVars;\r\n      }),\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.metadata$.complete();\r\n    this.recommendations$.complete();\r\n    this.itemFor$.complete();\r\n    this.fabOpen$.complete();\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  openChange(open: boolean) {\r\n    this.fabOpen$.next(open);\r\n  }\r\n\r\n  createMetadata(recommendation?: MetadataRecommendation) {\r\n    if (recommendation) {\r\n      // If the feature is not enabled, open the info dialog instead of metadata\r\n      if (!recommendation.Enabled) {\r\n        FeatureComponentBase.openDialog(this.dialog, recommendation.MissingFeature, this.viewContainerRef, this.changeDetectorRef);\r\n        return;\r\n      }\r\n      // Feature is enabled, check if it's an empty metadata\r\n      if (recommendation.CreateEmpty) {\r\n        this.snackBar.open(`Creating ${recommendation.Name}...`);\r\n        this.entitiesService.create(recommendation.Id, { For: this.calculateItemFor() }).subscribe({\r\n          error: () => {\r\n            this.snackBar.open(`Creating ${recommendation.Name} failed. Please check console for more info`, undefined, { duration: 3000 });\r\n            this.fetchMetadata();\r\n          },\r\n          next: () => {\r\n            this.snackBar.open(`Created ${recommendation.Name}`, undefined, { duration: 3000 });\r\n            this.fetchMetadata();\r\n          },\r\n        });\r\n      } else {\r\n        // Default case - open new-metadata dialog\r\n        this.createMetadataForm(recommendation.Id);\r\n      }\r\n      return;\r\n    }\r\n    const metadataDialogRef = this.dialog.open(MetadataSaveDialogComponent, {\r\n      autoFocus: false,\r\n      viewContainerRef: this.viewContainerRef,\r\n      width: '650px',\r\n    });\r\n    metadataDialogRef.afterClosed().subscribe((contentType?: string) => {\r\n      if (contentType == null) { return; }\r\n      this.createMetadataForm(contentType);\r\n    });\r\n  }\r\n\r\n  private createMetadataForm(contentType: string) {\r\n    const form: EditForm = {\r\n      items: [{\r\n        ContentTypeName: contentType,\r\n        For: this.calculateItemFor(),\r\n      }],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n    this.changeDetectorRef.markForCheck();\r\n  }\r\n\r\n  private calculateItemFor(): EavFor {\r\n    const itemFor: EavFor = {\r\n      Target: Object.values(eavConstants.metadata).find(m => m.targetType === this.targetType)?.target ?? this.targetType.toString(),\r\n      TargetType: this.targetType,\r\n      ...(this.keyType === eavConstants.keyTypes.guid && { Guid: this.key }),\r\n      ...(this.keyType === eavConstants.keyTypes.number && { Number: parseInt(this.key, 10) }),\r\n      ...(this.keyType === eavConstants.keyTypes.string && { String: this.key }),\r\n    };\r\n    return itemFor;\r\n  }\r\n\r\n  private fetchFor() {\r\n    if (!this.contentTypeStaticName) { return; }\r\n\r\n    this.contentItemsService.getAll(this.contentTypeStaticName).subscribe(items => {\r\n      const item = items.find(i => i.Guid === this.key);\r\n      if (item?.For) {\r\n        this.itemFor$.next(item.For);\r\n      }\r\n    });\r\n  }\r\n\r\n  private fetchMetadata() {\r\n    this.metadataService.getMetadata(this.targetType, this.keyType, this.key).pipe(\r\n      map(metadata => {\r\n        metadata.Recommendations.forEach(recommendation => {\r\n          if (recommendation.Icon?.startsWith('base64:')) {\r\n            recommendation.Icon = recommendation.Icon.replace('base64:', '');\r\n            recommendation.Icon = window.atob(recommendation.Icon);\r\n          }\r\n        });\r\n        return metadata;\r\n      }),\r\n      tap(metadata => {\r\n        this.metadata$.next(metadata.Items);\r\n        this.recommendations$.next(metadata.Recommendations);\r\n      })).subscribe();\r\n  }\r\n\r\n  private editMetadata(metadata: MetadataItem) {\r\n    const form: EditForm = {\r\n      items: [{ EntityId: metadata.Id }],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  private deleteMetadata(metadata: MetadataItem, confirmed = false) {\r\n    if (!confirmed) {\r\n      const data: ConfirmDeleteDialogData = {\r\n        entityId: metadata.Id,\r\n        entityTitle: metadata.Title,\r\n        message: this.recommendations$.value.find(r => r.Id === metadata._Type.Id)?.DeleteWarning,\r\n      };\r\n      const confirmationDialogRef = this.dialog.open(ConfirmDeleteDialogComponent, {\r\n        autoFocus: false,\r\n        data,\r\n        viewContainerRef: this.viewContainerRef,\r\n        width: '650px',\r\n      });\r\n      confirmationDialogRef.afterClosed().subscribe((isConfirmed: boolean) => {\r\n        if (isConfirmed) {\r\n          this.deleteMetadata(metadata, true);\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    this.snackBar.open('Deleting...');\r\n    this.entitiesService.delete(metadata._Type.Id, metadata.Id, false).subscribe({\r\n      next: () => {\r\n        this.snackBar.open('Deleted', null, { duration: 2000 });\r\n        this.fetchMetadata();\r\n      },\r\n      error: () => {\r\n        this.snackBar.open('Delete failed. Please check console for more information', null, { duration: 3000 });\r\n      }\r\n    });\r\n  }\r\n\r\n  private buildGridOptions(): GridOptions {\r\n    const gridOptions: GridOptions = {\r\n      ...defaultGridOptions,\r\n      columnDefs: [\r\n        {\r\n          headerName: 'ID',\r\n          field: 'Id',\r\n          width: 70,\r\n          headerClass: 'dense',\r\n          cellClass: 'id-action no-padding no-outline'.split(' '),\r\n          sortable: true,\r\n          filter: 'agNumberColumnFilter',\r\n          valueGetter: (params) => {\r\n            const metadata: MetadataItem = params.data;\r\n            return metadata.Id;\r\n          },\r\n          cellRenderer: IdFieldComponent,\r\n          cellRendererParams: (() => {\r\n            const params: IdFieldParams<MetadataItem> = {\r\n              tooltipGetter: (metadata: MetadataItem) => `ID: ${metadata.Id}\\nGUID: ${metadata.Guid}`,\r\n            };\r\n            return params;\r\n          })(),\r\n        },\r\n        {\r\n          field: 'Title',\r\n          flex: 2,\r\n          minWidth: 250,\r\n          cellClass: 'primary-action highlight'.split(' '),\r\n          sortable: true,\r\n          sort: 'asc',\r\n          filter: 'agTextColumnFilter',\r\n          valueGetter: (params) => {\r\n            const metadata: MetadataItem = params.data;\r\n            return metadata.Title;\r\n          },\r\n          onCellClicked: (params) => {\r\n            const metadata: MetadataItem = params.data;\r\n            this.editMetadata(metadata);\r\n          },\r\n        },\r\n        {\r\n          headerName: 'Content Type',\r\n          field: 'ContentType',\r\n          flex: 2,\r\n          minWidth: 250,\r\n          cellClass: 'no-outline',\r\n          sortable: true,\r\n          filter: 'agTextColumnFilter',\r\n          valueGetter: (params) => {\r\n            const metadata: MetadataItem = params.data;\r\n            return `${metadata._Type.Name}${metadata._Type.Title !== metadata._Type.Name ? ` (${metadata._Type.Title})` : ''}`;\r\n          },\r\n          cellRenderer: MetadataContentTypeComponent,\r\n        },\r\n        {\r\n          width: 42,\r\n          cellClass: 'secondary-action no-padding'.split(' '),\r\n          pinned: 'right',\r\n          cellRenderer: MetadataActionsComponent,\r\n          cellRendererParams: (() => {\r\n            const params: MetadataActionsParams = {\r\n              onDelete: (metadata) => this.deleteMetadata(metadata),\r\n            };\r\n            return params;\r\n          })(),\r\n        },\r\n      ],\r\n    };\r\n    return gridOptions;\r\n  }\r\n}\r\n","<div class=\"hint-box\" (click)=\"toggleIsShort()\" [ngClass]=\"{ 'hint-box__short': isShort }\" [ngSwitch]=\"isError\">\r\n  <mat-hint *ngSwitchCase=\"false\">\r\n    <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n  </mat-hint>\r\n\r\n  <mat-error *ngSwitchCase=\"true\">\r\n    <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n  </mat-error>\r\n</div>\r\n\r\n<ng-template #content>\r\n  <ng-content></ng-content>\r\n</ng-template>\r\n","import { Component, Input } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-field-hint',\r\n  templateUrl: './field-hint.component.html',\r\n  styleUrls: ['./field-hint.component.scss'],\r\n})\r\nexport class FieldHintComponent {\r\n  @Input() isError = false;\r\n  isShort = true;\r\n\r\n  constructor() { }\r\n\r\n  toggleIsShort() {\r\n    this.isShort = !this.isShort;\r\n  }\r\n}\r\n","import { Directive, HostListener } from '@angular/core';\r\n\r\n@Directive({ selector: '[appClickStopPropagation]' })\r\nexport class ClickStopPropagationDirective {\r\n  @HostListener('click', ['$event'])\r\n  onClick(event: MouseEvent): void {\r\n    event.stopPropagation();\r\n  }\r\n}\r\n","export function toBase64(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => {\r\n      resolve((reader.result as string).split(',')[1]);\r\n    };\r\n    reader.onerror = error => {\r\n      reject(error);\r\n    };\r\n  });\r\n}\r\n\r\nexport function toString(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsText(file);\r\n    reader.onload = () => {\r\n      resolve(reader.result as string);\r\n    };\r\n    reader.onerror = error => {\r\n      reject(error);\r\n    };\r\n  });\r\n}\r\n"],"sourceRoot":"webpack:///","file":"projects_eav-ui_src_app_metadata_metadata_component_ts.b298a1cf2d84592e.js"}