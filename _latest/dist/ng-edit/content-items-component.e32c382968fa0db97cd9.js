(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{gur7:function(t,e,n){"use strict";n.r(e);var i=n("D57K"),a=n("5/c3"),o=n("LiEJ"),r=n("LR82"),l=n("G2Mx"),c=n("z5yO"),s=n("W/Ou"),u=n("Jg5f"),p=n("QagP"),d=n("KLQV"),m=n("o9tz"),b=n("1C3z"),f=n("+raR"),h=n("ZSGP"),y=function(){function t(){this.published="",this.metadata=""}return t.prototype.agInit=function(t){this.params=t},t.prototype.isFilterActive=function(){return""!==this.published||""!==this.metadata},t.prototype.doesFilterPass=function(t){var e,n,i=this.params.valueGetter(t.node);return e=""===this.published||null!=i.published&&i.published.toString()===this.published,n=""===this.metadata||null!=i.metadata&&i.metadata.toString()===this.metadata,e&&n},t.prototype.getModel=function(){if(this.isFilterActive())return{filterType:"pub-meta",published:this.published,metadata:this.metadata}},t.prototype.setModel=function(t){this.published=t?t.published:"",this.metadata=t?t.metadata:""},t.prototype.afterGuiAttached=function(t){},t.prototype.filterChanged=function(){this.params.filterChangedCallback()},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Jb({type:t,selectors:[["app-pub-meta-filter"]],decls:18,vars:2,consts:[[1,"title"],[3,"ngModel","ngModelChange"],["value",""],["value","true"],["value","false"]],template:function(t,e){1&t&&(b.Vb(0,"div",0),b.Oc(1,"Published"),b.Ub(),b.Vb(2,"mat-radio-group",1),b.dc("ngModelChange",(function(t){return e.published=t}))("ngModelChange",(function(){return e.filterChanged()})),b.Vb(3,"mat-radio-button",2),b.Oc(4,"All"),b.Ub(),b.Vb(5,"mat-radio-button",3),b.Oc(6,"Published"),b.Ub(),b.Vb(7,"mat-radio-button",4),b.Oc(8,"Not published"),b.Ub(),b.Ub(),b.Vb(9,"div",0),b.Oc(10,"Metadata"),b.Ub(),b.Vb(11,"mat-radio-group",1),b.dc("ngModelChange",(function(t){return e.metadata=t}))("ngModelChange",(function(){return e.filterChanged()})),b.Vb(12,"mat-radio-button",2),b.Oc(13,"All"),b.Ub(),b.Vb(14,"mat-radio-button",3),b.Oc(15,"Is metadata"),b.Ub(),b.Vb(16,"mat-radio-button",4),b.Oc(17,"Is not metadata"),b.Ub(),b.Ub()),2&t&&(b.Bb(2),b.nc("ngModel",e.published),b.Bb(9),b.nc("ngModel",e.metadata))},directives:[f.b,h.l,h.o,f.a],styles:[".title[_ngcontent-%COMP%]{padding:12px 12px 0}.mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;overflow:hidden;padding:12px;width:160px;height:104px}"],changeDetection:0}),t}(),g=n("8AiQ"),v=n("r4gC"),T=n("Qc/f");function C(t,e){1&t&&(b.Vb(0,"mat-icon",4),b.Oc(1,"visibility"),b.Ub())}function I(t,e){1&t&&(b.Vb(0,"mat-icon",5),b.Oc(1,"visibility_off"),b.Ub())}function O(t,e){if(1&t&&(b.Vb(0,"mat-icon",6),b.Oc(1,"local_offer"),b.Ub()),2&t){var n=b.hc();b.nc("matTooltip",n.metadataTooltip)}}var k=function(){function t(){}return t.prototype.agInit=function(t){this.value=t.value;var e=t.data;e.Metadata&&(this.metadataTooltip="Metadata\nType: "+e.Metadata.TargetType+(e.Metadata.KeyNumber?"\nNumber: "+e.Metadata.KeyNumber:"")+(e.Metadata.KeyString?"\nString: "+e.Metadata.KeyString:"")+(e.Metadata.KeyGuid?"\nGuid: "+e.Metadata.KeyGuid:""))},t.prototype.refresh=function(t){return!0},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Jb({type:t,selectors:[["app-content-items-status"]],decls:4,vars:3,consts:[[1,"icon-container"],["matTooltip","Published",4,"ngIf"],["matTooltip","Not published",4,"ngIf"],["class","meta-icon",3,"matTooltip",4,"ngIf"],["matTooltip","Published"],["matTooltip","Not published"],[1,"meta-icon",3,"matTooltip"]],template:function(t,e){1&t&&(b.Vb(0,"div",0),b.Mc(1,C,2,0,"mat-icon",1),b.Mc(2,I,2,0,"mat-icon",2),b.Mc(3,O,2,1,"mat-icon",3),b.Ub()),2&t&&(b.Bb(1),b.nc("ngIf",e.value.published),b.Bb(1),b.nc("ngIf",!e.value.published),b.Bb(1),b.nc("ngIf",e.value.metadata))},directives:[g.m,v.a,T.a],styles:[".meta-icon[_ngcontent-%COMP%]{margin-left:8px}"],changeDetection:0}),t}(),x=n("OeRG"),V=function(){function t(){}return t.prototype.agInit=function(t){this.params=t,this.item=t.data},t.prototype.refresh=function(t){return!0},t.prototype.clone=function(){this.params.onClone(this.item)},t.prototype.export=function(){this.params.onExport(this.item)},t.prototype.deleteItem=function(){this.params.onDelete(this.item)},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Jb({type:t,selectors:[["app-content-items-actions"]],decls:10,vars:0,consts:[[1,"actions-component"],["matRipple","","matTooltip","Copy",1,"like-button","highlight",3,"click"],["matRipple","","matTooltip","Export",1,"like-button","highlight",3,"click"],["matRipple","","matTooltip","Delete",1,"like-button","highlight",3,"click"]],template:function(t,e){1&t&&(b.Vb(0,"div",0),b.Vb(1,"div",1),b.dc("click",(function(){return e.clone()})),b.Vb(2,"mat-icon"),b.Oc(3,"file_copy"),b.Ub(),b.Ub(),b.Vb(4,"div",2),b.dc("click",(function(){return e.export()})),b.Vb(5,"mat-icon"),b.Oc(6,"cloud_download"),b.Ub(),b.Ub(),b.Vb(7,"div",3),b.dc("click",(function(){return e.deleteItem()})),b.Vb(8,"mat-icon"),b.Oc(9,"delete"),b.Ub(),b.Ub(),b.Ub())},directives:[x.q,T.a,v.a],styles:[""],changeDetection:0}),t}();function M(t,e){if(1&t&&(b.Vb(0,"span",2),b.Oc(1),b.Ub()),2&t){var n=b.hc();b.Bb(1),b.Pc(n.entities)}}var U=function(){function t(){}return t.prototype.agInit=function(t){Array.isArray(t.value)&&(this.encodedValue=this.htmlEncode(t.value.join(", ")),t.colDef.allowMultiValue&&(this.entities=t.value.length))},t.prototype.refresh=function(t){return!0},t.prototype.htmlEncode=function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Jb({type:t,selectors:[["app-content-items-entity"]],decls:3,vars:3,consts:[[3,"matTooltip"],["class","more-entities",4,"ngIf"],[1,"more-entities"]],template:function(t,e){1&t&&(b.Vb(0,"div",0),b.Mc(1,M,2,1,"span",1),b.Oc(2),b.Ub()),2&t&&(b.nc("matTooltip",e.encodedValue),b.Bb(1),b.nc("ngIf",e.entities),b.Bb(1),b.Qc(" ",e.encodedValue,"\n"))},directives:[T.a,g.m],styles:[".more-entities[_ngcontent-%COMP%]{padding:0 8px;border-radius:10px;border:1px solid rgba(29,39,61,.44);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}"],changeDetection:0}),t}(),S=n("CeOT"),w=n("0ELX"),D=n("JzAw"),N=n("50eG"),G=n("QjRa"),P=n("uuTa"),j=n("BLjT"),A=n("S36y"),F=n("55Ui"),R=n("GTfO"),_=n("Xi8o"),E=n("2pW/"),B=n("9HSk"),$=n("G6Ml"),J=n("8/3+");n.d(e,"ContentItemsComponent",(function(){return K}));var K=function(){function t(t,e,n,a,l,c,s,u){this.dialogRef=t,this.contentTypesService=e,this.router=n,this.route=a,this.contentItemsService=l,this.entitiesService=c,this.contentExportService=s,this.snackBar=u,this.contentType$=new o.a(null),this.items$=new o.a(null),this.modules=d.a,this.gridOptions=Object(i.a)(Object(i.a)({},G.a),{frameworkComponents:{pubMetaFilterComponent:y,booleanFilterComponent:S.a,idFieldComponent:D.a,contentItemsStatusComponent:k,contentItemsActionsComponent:V,contentItemsEntityComponent:U}}),this.gridApi$=new o.a(null),this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName"),this.subscription=new r.a}return t.prototype.ngOnInit=function(){this.fetchContentType(),this.fetchItems(),this.fetchColumns(),this.refreshOnChildClosed()},t.prototype.ngOnDestroy=function(){this.contentType$.complete(),this.items$.complete(),this.gridApi$.complete(),this.subscription.unsubscribe()},t.prototype.closeDialog=function(){this.dialogRef.close()},t.prototype.onGridReady=function(t){this.gridApi$.next(t.api)},t.prototype.fetchContentType=function(){var t=this;this.contentTypesService.retrieveContentType(this.contentTypeStaticName).subscribe((function(e){t.contentType$.next(e)}))},t.prototype.fetchItems=function(){var t=this;this.contentItemsService.getAll(this.contentTypeStaticName).subscribe((function(e){t.items$.next(e)}))},t.prototype.fetchColumns=function(){var t=this;this.contentItemsService.getColumns(this.contentTypeStaticName).subscribe((function(e){var n=t.buildColumnDefs(e),a=function(t){var e,n;if(t){var a;"="===t.charAt(t.length-1)&&(t=atob(t));try{a=JSON.parse(t)}catch(d){console.error("Can't parse JSON with filters from url:",t)}if(a){var o={};(a.IsPublished||a.IsMetadata)&&(o.Status=p={filterType:"pub-meta",published:a.IsPublished?a.IsPublished:"",metadata:a.IsMetadata?a.IsMetadata:""});var r=Object.keys(a);try{for(var l=Object(i.i)(r),c=l.next();!c.done;c=l.next()){var s=c.value;if("IsPublished"!==s&&"IsMetadata"!==s){var u=a[s];if("string"==typeof u)o[s]=p={filterType:"text",type:"equals",filter:u};else if("number"==typeof u)o[s]=p={filterType:"number",type:"equals",filter:u,filterTo:null};else if(typeof u==typeof!0){var p={filterType:"boolean",filter:u.toString()};o[s]=p}}}}catch(m){e={error:m}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return o}}}(sessionStorage.getItem(w.g));t.gridApi$.value?t.setColumnDefs(n,a):t.gridApi$.pipe(Object(l.a)(1)).subscribe((function(e){t.setColumnDefs(n,a)}))}))},t.prototype.setColumnDefs=function(t,e){this.gridApi$.value.setColumnDefs(t),e&&(Object(N.a)("Will try to apply filter:",e),this.gridApi$.value.setFilterModel(e))},t.prototype.editItem=function(t){var e=null==t?void 0:t.data,n={items:[null==e?{ContentTypeName:this.contentTypeStaticName}:{EntityId:e.Id}]},i=Object(P.a)(n);this.router.navigate(["edit/"+i],{relativeTo:this.route})},t.prototype.exportContent=function(){var t=this.gridApi$.value.getFilterModel(),e=Object.keys(t).length>0,n=[];e&&this.gridApi$.value.forEachNodeAfterFilterAndSort((function(t){n.push(t.data.Id)})),this.router.navigate(["export/"+this.contentTypeStaticName+(n.length>0?"/"+n:"")],{relativeTo:this.route})},t.prototype.importItem=function(t){this.router.navigate(["import"],{relativeTo:this.route,state:{files:t}})},t.prototype.addMetadata=function(){var t,e;if(confirm("This is a special operation to add an item which is metadata for another item. If you didn't understand that, this is not for you :). Continue?")){var n=Object.keys(m.a.metadata),a=n.map((function(t){return m.a.metadata[t].type})),o=parseInt(prompt("What kind of assignment do you want?"+n.map((function(t){return"\n"+m.a.metadata[t].type+": "+m.a.metadata[t].target})),m.a.metadata.entity.type.toString()),10);if(!o)return alert("No target type entered. Cancelled");if(!a.includes(o))return alert("Invalid target type. Cancelled");var r=prompt("What key do you want?");if(!r)return alert("No key entered. Cancelled");var l,c=Object.keys(m.a.keyTypes),s=c.map((function(t){return m.a.keyTypes[t]})),u=prompt("What key type do you want?"+c.map((function(t){return"\n"+m.a.keyTypes[t]})),m.a.keyTypes.number);if(!u)return alert("No key type entered. Cancelled");if(!s.includes(u))return alert("Invalid key type. Cancelled");if(u===m.a.keyTypes.number&&!parseInt(r,10))return alert("Key type number and key don't match. Cancelled");try{for(var p=Object(i.i)(n),d=p.next();!d.done;d=p.next()){var b=d.value;if(o===m.a.metadata[b].type){l=m.a.metadata[b].target;break}}}catch(y){t={error:y}}finally{try{d&&!d.done&&(e=p.return)&&e.call(p)}finally{if(t)throw t.error}}var f={items:[{ContentTypeName:this.contentTypeStaticName,For:Object(i.a)(Object(i.a)(Object(i.a)({Target:l},u===m.a.keyTypes.guid&&{Guid:r}),u===m.a.keyTypes.number&&{Number:parseInt(r,10)}),u===m.a.keyTypes.string&&{String:r})}]},h=Object(P.a)(f);this.router.navigate(["edit/"+h],{relativeTo:this.route})}},t.prototype.debugFilter=function(){console.warn("Current filter:",this.gridApi$.value.getFilterModel()),alert("Check console for filter information")},t.prototype.refreshOnChildClosed=function(){var t=this;this.subscription.add(this.router.events.pipe(Object(c.a)((function(t){return t instanceof a.b})),Object(s.a)(!!this.route.snapshot.firstChild),Object(u.a)((function(){return!!t.route.snapshot.firstChild})),Object(p.a)(),Object(c.a)((function(t){var e=Object(i.f)(t,2);return e[0]&&!e[1]}))).subscribe((function(){t.fetchItems()})))},t.prototype.buildColumnDefs=function(t){var e,n,a=[{headerName:"ID",field:"Id",width:70,headerClass:"dense",cellClass:"id-action no-padding no-outline",cellRenderer:"idFieldComponent",sortable:!0,filter:"agTextColumnFilter",valueGetter:this.idValueGetter},{headerName:"Status",field:"Status",width:80,headerClass:"dense",cellClass:"no-outline",filter:"pubMetaFilterComponent",cellRenderer:"contentItemsStatusComponent",valueGetter:this.valueGetterStatus},{headerName:"Item (Entity)",field:"_Title",flex:2,minWidth:250,cellClass:"primary-action highlight",sortable:!0,filter:"agTextColumnFilter",onCellClicked:this.editItem.bind(this)},{cellClass:"secondary-action no-padding",width:120,cellRenderer:"contentItemsActionsComponent",cellRendererParams:{onClone:this.clone.bind(this),onExport:this.export.bind(this),onDelete:this.delete.bind(this)}},{headerName:"Stats",headerTooltip:"Used by others / uses others",field:"_Used",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:this.valueGetterUsage}];try{for(var o=Object(i.i)(t),r=o.next();!r.done;r=o.next()){var l=r.value,c={headerName:l.StaticName,field:l.StaticName,flex:2,minWidth:250,cellClass:"no-outline",sortable:!0};switch(l.Type){case"Entity":try{c.allowMultiValue=l.Metadata.Entity.AllowMultiValue}catch(s){c.allowMultiValue=!0}c.cellRenderer="contentItemsEntityComponent",c.valueGetter=this.valueGetterEntityField,c.filter="agTextColumnFilter";break;case"DateTime":try{c.useTimePicker=l.Metadata.DateTime.UseTimePicker}catch(s){c.useTimePicker=!1}c.valueGetter=this.valueGetterDateTime,c.filter="agTextColumnFilter";break;case"Boolean":c.valueGetter=this.valueGetterBoolean,c.filter="booleanFilterComponent";break;case"Number":c.filter="agNumberColumnFilter";break;default:c.filter="agTextColumnFilter"}a.push(c)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return a},t.prototype.clone=function(t){var e={items:[{ContentTypeName:this.contentTypeStaticName,DuplicateEntity:t.Id}]},n=Object(P.a)(e);this.router.navigate(["edit/"+n],{relativeTo:this.route})},t.prototype.export=function(t){this.contentExportService.exportEntity(t.Id,this.contentTypeStaticName,!0)},t.prototype.delete=function(t){var e=this;confirm("Delete '"+t._Title+"' ("+t._RepositoryId+")?")&&(this.snackBar.open("Deleting..."),this.entitiesService.delete(this.contentTypeStaticName,t._RepositoryId,!1).subscribe({next:function(){e.snackBar.open("Deleted",null,{duration:2e3}),e.fetchItems()},error:function(n){e.snackBar.dismiss(),confirm(n.error.ExceptionMessage+"\n\nDo you want to force delete '"+t._Title+"' ("+t._RepositoryId+")?")&&(e.snackBar.open("Deleting..."),e.entitiesService.delete(e.contentTypeStaticName,t._RepositoryId,!0).subscribe((function(){e.snackBar.open("Deleted",null,{duration:2e3}),e.fetchItems()})))}}))},t.prototype.idValueGetter=function(t){var e=t.data;return"ID: "+e.Id+"\nRepoID: "+e._RepositoryId+"\nGUID: "+e.Guid},t.prototype.valueGetterStatus=function(t){var e=t.data;return{published:e.IsPublished,metadata:!!e.Metadata}},t.prototype.valueGetterUsage=function(t){var e=t.data;return e._Used+" / "+e._Uses},t.prototype.valueGetterEntityField=function(t){var e=t.data[t.colDef.field];return 0===e.length?null:e.map((function(t){return t.Title}))},t.prototype.valueGetterDateTime=function(t){var e=t.data[t.colDef.field];return e?t.colDef.useTimePicker?e.substring(0,19).replace("T"," "):e.substring(0,10):null},t.prototype.valueGetterBoolean=function(t){var e=t.data[t.colDef.field];return typeof e!=typeof!0?null:e.toString()},t.\u0275fac=function(e){return new(e||t)(b.Pb(j.g),b.Pb(A.a),b.Pb(a.c),b.Pb(a.a),b.Pb(F.a),b.Pb(R.a),b.Pb(_.a),b.Pb(E.b))},t.\u0275cmp=b.Jb({type:t,selectors:[["app-content-items"]],decls:29,vars:8,consts:[[1,"nav-component-wrapper"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","matTooltip","Close dialog",3,"click"],[1,"grid-wrapper"],["appDragAndDrop","",1,"ag-theme-material",3,"rowData","modules","gridOptions","gridReady","filesDropped"],[1,"actions-box"],["mat-icon-button","","matTooltip","Export",3,"click"],["mat-icon-button","","matTooltip","Import a single JSON Item (or drag and drop on the items list)",3,"click"],["mat-icon-button","","matTooltip","Add metadata",3,"click"],["mat-icon-button","","matTooltip","Debug filter",3,"click"],["mat-fab","","mat-elevation-z24","","matTooltip","Add item",1,"grid-fab",3,"click"]],template:function(t,e){var n;1&t&&(b.Vb(0,"div",0),b.Vb(1,"div",1),b.Vb(2,"div",2),b.Vb(3,"div"),b.Oc(4),b.ic(5,"async"),b.Ub(),b.Vb(6,"button",3),b.dc("click",(function(){return e.closeDialog()})),b.Vb(7,"mat-icon"),b.Oc(8,"close"),b.Ub(),b.Ub(),b.Ub(),b.Ub(),b.Qb(9,"router-outlet"),b.Vb(10,"div",4),b.Vb(11,"ag-grid-angular",5),b.dc("gridReady",(function(t){return e.onGridReady(t)}))("filesDropped",(function(t){return e.importItem(t)})),b.ic(12,"async"),b.Ub(),b.Vb(13,"div",6),b.Vb(14,"button",7),b.dc("click",(function(){return e.exportContent()})),b.Vb(15,"mat-icon"),b.Oc(16,"cloud_download"),b.Ub(),b.Ub(),b.Vb(17,"button",8),b.dc("click",(function(){return e.importItem()})),b.Vb(18,"mat-icon"),b.Oc(19,"cloud_upload"),b.Ub(),b.Ub(),b.Vb(20,"button",9),b.dc("click",(function(){return e.addMetadata()})),b.Vb(21,"mat-icon"),b.Oc(22,"local_offer"),b.Ub(),b.Ub(),b.Vb(23,"button",10),b.dc("click",(function(){return e.debugFilter()})),b.Vb(24,"mat-icon"),b.Oc(25,"filter_list"),b.Ub(),b.Ub(),b.Ub(),b.Vb(26,"button",11),b.dc("click",(function(){return e.editItem(null)})),b.Vb(27,"mat-icon"),b.Oc(28,"add"),b.Ub(),b.Ub(),b.Ub(),b.Ub()),2&t&&(b.Bb(4),b.Qc("",null==(n=b.jc(5,4,e.contentType$))?null:n.Name," Data"),b.Bb(7),b.nc("rowData",b.jc(12,6,e.items$))("modules",e.modules)("gridOptions",e.gridOptions))},directives:[j.h,B.a,T.a,v.a,a.e,$.a,J.a],pipes:[g.b],styles:[".actions-box[_ngcontent-%COMP%]{margin-right:66px;margin-left:8px;display:flex}"]}),t}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/11.07.00/ng-edit/content-items-component.e32c382968fa0db97cd9.js.map