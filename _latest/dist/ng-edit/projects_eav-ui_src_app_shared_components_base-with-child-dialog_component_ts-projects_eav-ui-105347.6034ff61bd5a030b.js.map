{"version":3,"file":"projects_eav-ui_src_app_shared_components_base-with-child-dialog_component_ts-projects_eav-ui-105347.6034ff61bd5a030b.js","mappings":"4RAkBM,MAAgBA,UAAqCC,IAEzDC,YACYC,EACAC,EACHC,GAEPC,QAJUC,KAAAJ,SACAI,KAAAH,QACHG,KAAAF,MAGPE,KAAKF,MAAQ,IAAIG,IAAU,iBApBf,EAqBd,CAOUC,qBACR,OAAOF,KAAKJ,OAAOO,OAAOC,QACxBC,KAAOC,GAASA,aAAiBC,OAAa,EAC9CC,OAAYR,KAAKH,MAAMY,SAASC,aAAU,EAC1CC,KAAI,MAAQX,KAAKH,MAAMY,SAASC,aAAU,EAC1CE,QAAQ,EACRP,KAAO,EAAEQ,EAAgBC,KAAiBD,IAAmBC,GAGjE,wKCjCF,MAEaC,EAAmB,gBACnBC,EAAmB,oBAIzB,IAAMC,EAAc,MAArB,MAAOA,UAAsBC,IACjCvB,YAAoBwB,EACVC,EACAC,EACAC,GAGRvB,MAAM,IAAIE,IAAU,iBAdR,IAQMD,KAAAmB,OACVnB,KAAAoB,aACApB,KAAAqB,aACArB,KAAAsB,cAIV,CAQAC,aAAaC,GACX,OAAOA,EAAOpB,QACZC,KAAOoB,GAAU,MAALA,IAAS,EACrBC,KAAUD,GAAKzB,KAAK2B,qBAAqBF,EAAEG,iBAAiBxB,QAAKyB,KAAY,KAEjF,CAEQF,qBAAqBC,EAAyBE,GACpD,IAAIhC,EAAME,KAAKF,IAAIiC,MAAM,cAAe,CAAEC,SAAS,IACnD,OAAOhC,KAAKsB,aAAaW,YAAY,CACnCC,aAAc,CAACN,GACfO,QAASL,EACTM,OAAQ,gBACRtC,IAAK,yBACJM,KACDN,EAAIM,QAAI,EACRO,KAAI0B,GAAQA,EAAKC,SAErB,CAEAC,OAAOC,EAAqBC,EAAkBC,EAAgBC,EAAmBC,GAC/E,OAAO5C,KAAKmB,KAAKoB,OAAavC,KAAKqB,WAAWwB,MAAM1B,KAAK2B,OAAO/B,EAAmB,UAAW,CAC5FS,OAAQ,CACNgB,cACAO,GAAIN,EAASO,WACbC,MAAOjD,KAAKoB,WAAW8B,OAAOD,MAC9BP,MAAOA,EAAMM,cACTL,GAAY,CAAEA,SAAUA,EAASK,eACjCL,GAAYC,GAAe,CAAEA,iBAGvC,CAACO,SAAAnD,KAAA,mBAAAoD,iBA/CUnC,GAAaoC,MAAAC,MAAAD,MAAAE,KAAAF,MAAAG,MAAAH,MAAAI,KAAA,EAAAN,SAAAnD,KAAA,WAAA0D,EAAAC,IAAA,OAAb1C,EAAa2C,QAAb3C,EAAa4C,mBAAb5C,CAAc","names":["BaseWithChildDialogComponent","BaseComponent","constructor","router","route","log","super","this","EavLogger","childDialogClosed$","events","pipe","filter","event","NavigationEnd","startWith","snapshot","firstChild","map","pairwise","hadChildBefore","hasChildNow","webApiEntityRoot","webApiEntityList","EntityService","ServiceBase","http","formConfig","dnnContext","queryService","getEntities$","params","p","switchMap","getAvailableEntities","contentTypeName","shareReplay","entitiesFilter","rxTap","enabled","getEntities","contentTypes","itemIds","fields","data","Default","delete","contentType","entityId","force","parentId","parentField","$2sxc","apiUrl","id","toString","appId","config","static","t","i0","i1","i2","i3","i4","_angular_core__WEBPACK_IMPORTED_MODULE_8__","jDH","factory","Éµfac"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/shared/components/base-with-child-dialog.component.ts","./projects/eav-ui/src/app/shared/services/entity.service.ts"],"sourcesContent":["import { Directive, OnDestroy } from '@angular/core';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport { filter, map, pairwise, startWith, tap } from 'rxjs';\r\nimport { BaseComponent } from './base.component';\r\nimport { EavLogger } from '../logging/eav-logger';\r\n\r\nconst logThis = false;\r\n\r\n// 2024-06-12 2dm experimental - remove comments if all is good mid of June\r\n// - previously had\r\n// @Directive()   // Needs the @Directive() so the compiler allows OnDestroy to be implemented\r\n// ...then tried this\r\n// @Component({\r\n//   selector: 'app-base-component-with-child',\r\n//   template: ''\r\n// })\r\n// ...but then added abstract, so I think it doesn't actually need all that\r\n// tslint:disable-next-line:directive-class-suffix\r\nexport abstract class BaseWithChildDialogComponent extends BaseComponent implements OnDestroy {\r\n\r\n  constructor(\r\n    protected router: Router,\r\n    protected route: ActivatedRoute,\r\n    public log?: EavLogger\r\n  ) {\r\n    super();\r\n    this.log ??= new EavLogger('BaseComponent', logThis);\r\n  }\r\n\r\n  // 2024-06-12 2dm - don't think this is needed since it's already on the base class\r\n  // ngOnDestroy() {\r\n  //   super.ngOnDestroy();\r\n  // }\r\n\r\n  protected childDialogClosed$() {\r\n    return this.router.events.pipe(\r\n      filter(event => event instanceof NavigationEnd),\r\n      startWith(!!this.route.snapshot.firstChild),\r\n      map(() => !!this.route.snapshot.firstChild),\r\n      pairwise(),\r\n      filter(([hadChildBefore, hasChildNow]) => hadChildBefore && !hasChildNow),\r\n      // tap(() => console.log('2dm ' + 'childDialogClosed$'))\r\n    )\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { filter, map, Observable, shareReplay, switchMap } from 'rxjs';\r\nimport { ServiceBase } from './service-base';\r\nimport { EavLogger } from '../logging/eav-logger';\r\nimport { EntityBasic } from '../../edit/shared/models/entity-basic';\r\nimport { QueryService } from './query.service';\r\nimport { FormConfigService } from '../../edit/state/form-config.service';\r\n\r\nconst logThis = false;\r\n\r\nexport const webApiEntityRoot = 'admin/entity/';\r\nexport const webApiEntityList = 'admin/entity/list';\r\n\r\n// TODO: @2dg also try to use transient only - should be possible\r\n@Injectable()\r\nexport class EntityService extends ServiceBase {\r\n  constructor(private http: HttpClient,\r\n    private formConfig: FormConfigService,\r\n    private dnnContext: DnnContext,\r\n    private queryService: QueryService,\r\n  )\r\n  {\r\n    super(new EavLogger('EntityService', logThis));\r\n  }\r\n\r\n  /**\r\n   * Get entities based on the content type name.\r\n   * As of 2024-04-29 only used in REST API.\r\n   * @param params\r\n   * @returns\r\n   */\r\n  getEntities$(params: Observable<{ contentTypeName: string }>): Observable<EntityBasic[]> {\r\n    return params.pipe(\r\n      filter(p => p != null),\r\n      switchMap(p => this.getAvailableEntities(p.contentTypeName).pipe(shareReplay(1))),\r\n    );\r\n  }\r\n\r\n  private getAvailableEntities(contentTypeName: string, entitiesFilter?: string[]): Observable<EntityBasic[]> {\r\n    var log = this.log.rxTap('getEntities', { enabled: true });\r\n    return this.queryService.getEntities({\r\n      contentTypes: [contentTypeName],\r\n      itemIds: entitiesFilter,\r\n      fields: 'Id,Guid,Title',\r\n      log: 'getAvailableEntities'\r\n    }).pipe(\r\n      log.pipe(),\r\n      map(data => data.Default)\r\n    );\r\n  }\r\n\r\n  delete(contentType: string, entityId: number, force: boolean, parentId?: number, parentField?: string): Observable<null> {\r\n    return this.http.delete<null>(this.dnnContext.$2sxc.http.apiUrl(webApiEntityRoot + 'delete'), {\r\n      params: {\r\n        contentType,\r\n        id: entityId.toString(),\r\n        appId: this.formConfig.config.appId,\r\n        force: force.toString(),\r\n        ...(parentId && { parentId: parentId.toString() }),\r\n        ...(parentId && parentField && { parentField }),\r\n      },\r\n    });\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}