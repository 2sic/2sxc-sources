"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_edit_dialog_footer_edit-dialog-footer_component_ts"],{6054:(L,x,l)=>{l.r(x),l.d(x,{EditDialogFooterComponent:()=>$t});var g=l(316),t=l(1659),p=l(4175),y=l(3777),d=l(3840),b=l(4601),u=l(4435),f=l(8656),_=l(8265),P=l(927);let N=(()=>{class o{constructor(e,n){this.itemService=e,this.formConfig=n,this.items=this.itemService.getManySignal(this.formConfig.config.itemGuids)}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(P.b),t.rXU(_.S))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-data-dump"]],decls:3,vars:3,consts:[["readonly","",1,"fancy-scrollbar-light"]],template:function(n,i){1&n&&(t.j41(0,"textarea",0),t.EFF(1),t.nI1(2,"json"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,i.items())))},dependencies:[g.TG],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex}textarea[_ngcontent-%COMP%]{flex:1 1 auto;margin:0;padding:10px 0 10px 10px;border:0px;box-sizing:border-box;resize:none;outline:none;background-color:#1d273d0a}"]})}}return o})();const X={Data:"data",Formulas:"formulas",Logs:"logs"};var B=l(4065),h=l(4456),F=l(4646),v=l(4950),T=l(7984),M=l(1034),k=l(5175),D=l(2938),j=l(7836),E=l(52),V=l(334),G=l(5081),Y=l(6817),w=l(3688),R=l(827),z=l(5970),A=l(6849);const O={Entity:"entityGuid",Field:"fieldValue",Target:"formulaTarget"};let U=(()=>{class o{constructor(){this.maxLength=24}transform(e){return e.length<=this.maxLength?e:`\u2026${e.substring(e.length-this.maxLength)}`}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275pipe=t.EJ8({name:"snippetLabelSize",type:o,pure:!0})}}return o})();var I=l(3347),H=l(852);const J=(o,a)=>({disabled:o,focused:a}),W=o=>({disabled:o}),S=o=>({"has-formula":o}),K=(o,a)=>a.entityGuid,Z=(o,a)=>a.fieldName,$=(o,a)=>a.code;function Q(o,a){if(1&o&&(t.j41(0,"mat-option",4)(1,"span",27),t.EFF(2),t.k0s()()),2&o){const e=a.$implicit;t.Y8G("value",e.entityGuid),t.R7$(),t.Y8G("ngClass",t.eq3(3,S,e.hasFormula)),t.R7$(),t.SpI(" ",e.label," ")}}function q(o,a){if(1&o&&(t.j41(0,"mat-option",4)(1,"span",27),t.EFF(2),t.k0s()()),2&o){const e=a.$implicit;t.Y8G("value",e.fieldName),t.R7$(),t.Y8G("ngClass",t.eq3(3,S,e.hasFormula)),t.R7$(),t.SpI(" ",e.fieldName," ")}}function tt(o,a){if(1&o&&(t.j41(0,"mat-option",4)(1,"span",27),t.EFF(2),t.k0s()()),2&o){const e=a.$implicit;t.Y8G("value",e.target),t.R7$(),t.Y8G("ngClass",t.eq3(3,S,e.hasFormula)),t.R7$(),t.SpI(" ",e.label," ")}}function et(o,a){if(1&o){const e=t.RV6();t.j41(0,"mat-select",5),t.bIt("ngModelChange",function(i){t.eBV(e);const s=t.XpG(2);return t.Njj(s.selectedChanged(s.SelectTargets.Target,i))}),t.Z7z(1,tt,3,5,"mat-option",4,t.fX1),t.k0s()}if(2&o){const e=t.XpG(2);t.Y8G("ngModel",e.state().target)("disabled",null==e.state().entityGuid||null==e.state().fieldName),t.R7$(),t.Dyx(e.targetOptions())}}function nt(o,a){if(1&o){const e=t.RV6();t.j41(0,"input",28),t.bIt("ngModelChange",function(i){t.eBV(e);const s=t.XpG(2);return t.Njj(s.selectedChanged(s.SelectTargets.Target,i))}),t.k0s()}if(2&o){const e=t.XpG(2);t.Y8G("ngModel",e.state().target)("disabled",null==e.state().entityGuid||null==e.state().fieldName)}}function ot(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",29),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.clipboard.copyToClipboard(i.code))}),t.EFF(1),t.nI1(2,"snippetLabelSize"),t.k0s()}if(2&o){const e=a.$implicit;t.Y8G("title",e.code),t.R7$(),t.SpI(" ",t.bMT(2,2,e.label)," ")}}function it(o,a){1&o&&t.nrm(0,"div",17)}function st(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",29),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.clipboard.copyToClipboard(i.code))}),t.EFF(1),t.nI1(2,"snippetLabelSize"),t.k0s()}if(2&o){const e=a.$implicit;t.Y8G("title",e.code),t.R7$(),t.SpI(" ",t.bMT(2,2,e.label)," ")}}function at(o,a){if(1&o&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"json"),t.k0s()),2&o){const e=t.XpG(4);t.R7$(),t.JRh(t.bMT(2,1,e.result().value))}}function lt(o,a){1&o&&(t.j41(0,"span",31),t.EFF(1,"undefined"),t.k0s())}function rt(o,a){1&o&&(t.j41(0,"span"),t.EFF(1,"promise(\u{1f91e}\u{1f3fd})"),t.k0s())}function ct(o,a){if(1&o&&t.DNE(0,at,3,3,"span")(1,lt,2,0,"span",31)(2,rt,2,0,"span"),2&o){const e=t.XpG(3);t.vxM(void 0!==e.result().value?0:e.result().isOnlyPromise?2:1)}}function dt(o,a){1&o&&(t.j41(0,"span",30),t.EFF(1," Calculation failed. Please check console for more info "),t.k0s())}function pt(o,a){if(1&o&&t.DNE(0,ct,3,1)(1,dt,2,0,"span",30),2&o){const e=t.XpG(2);t.vxM(e.result().isError?1:0)}}function gt(o,a){if(1&o){const e=t.RV6();t.j41(0,"button",32),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.save())}),t.j41(1,"mat-icon"),t.EFF(2,"save"),t.k0s()()}if(2&o){let e,n;const i=t.XpG(2);t.Y8G("tippyDisabled",!i.state().editMode||!(null!=(e=i.currentFormula())&&e.sourceCode))("disabled",!i.state().editMode||!(null!=(n=i.currentFormula())&&n.sourceCode)||i.saving())}}function ut(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",1)(1,"mat-form-field",2)(2,"mat-label"),t.EFF(3,"Entity"),t.k0s(),t.j41(4,"mat-select",3),t.bIt("ngModelChange",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.selectedChanged(s.SelectTargets.Entity,i))}),t.Z7z(5,Q,3,5,"mat-option",4,K),t.k0s()(),t.j41(7,"mat-form-field",2)(8,"mat-label"),t.EFF(9,"Attribute"),t.k0s(),t.j41(10,"mat-select",5),t.bIt("ngModelChange",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.selectedChanged(s.SelectTargets.Field,i))}),t.Z7z(11,q,3,5,"mat-option",4,Z),t.k0s()(),t.j41(13,"mat-form-field",2)(14,"mat-label"),t.EFF(15,"Target"),t.k0s(),t.DNE(16,et,3,2,"mat-select",6)(17,nt,1,2,"input",7),t.k0s(),t.j41(18,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleFreeText())}),t.j41(19,"mat-icon"),t.EFF(20,"text_fields"),t.k0s()(),t.nrm(21,"div",9),t.j41(22,"a",10)(23,"mat-icon"),t.EFF(24,"help"),t.k0s()()(),t.j41(25,"div",11)(26,"div",12)(27,"mat-label",13),t.EFF(28,"Function"),t.k0s(),t.j41(29,"app-monaco-editor",14),t.bIt("valueChanged",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.formulaChanged(i))})("focused",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onFocused(!0))})("blurred",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onFocused(!1))}),t.k0s()(),t.j41(30,"div",15),t.Z7z(31,ot,3,4,"div",16,$),t.DNE(33,it,1,0,"div",17),t.Z7z(34,st,3,4,"div",16,$),t.k0s()(),t.j41(36,"div",18)(37,"div",19)(38,"span",13),t.EFF(39,"Result:\xa0"),t.k0s(),t.DNE(40,pt,2,1),t.k0s(),t.j41(41,"div",20)(42,"button",21),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleEdit())}),t.j41(43,"mat-icon"),t.EFF(44,"edit"),t.k0s()(),t.j41(45,"button",22)(46,"mat-icon"),t.EFF(47,"more_vert"),t.k0s()(),t.j41(48,"mat-menu",null,0)(50,"button",23),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.deleteFormula())}),t.j41(51,"mat-icon"),t.EFF(52,"delete"),t.k0s(),t.j41(53,"span"),t.EFF(54,"Delete"),t.k0s()(),t.j41(55,"button",24),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.reset())}),t.j41(56,"mat-icon"),t.EFF(57,"history"),t.k0s(),t.j41(58,"span"),t.EFF(59,"Reset"),t.k0s()()(),t.DNE(60,gt,3,2,"button",25),t.j41(61,"button",26),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.run())}),t.j41(62,"mat-icon"),t.EFF(63,"play_arrow"),t.k0s()()()()}if(2&o){let e,n,i,s;const c=t.sdS(49),r=t.XpG();t.R7$(4),t.Y8G("ngModel",r.state().entityGuid),t.R7$(),t.Dyx(r.entityOptions()),t.R7$(5),t.Y8G("ngModel",r.state().fieldName)("disabled",null==r.state().entityGuid),t.R7$(),t.Dyx(r.fieldsOptions()),t.R7$(5),t.vxM(r.freeTextTarget?17:16),t.R7$(2),t.Y8G("disabled",null==r.state().entityGuid||null==r.state().fieldName),t.R7$(8),t.Y8G("ngClass",t.l_i(17,J,!r.state().editMode||null==r.state().entityGuid||null==r.state().fieldName||null==r.state().target,r.focused)),t.R7$(3),t.Y8G("filename",r.filename)("value",null!==(e=null==(e=r.currentFormula())?null:e.sourceCode)&&void 0!==e?e:r.template())("jsTypings",r.v2JsTypings())("options",r.monacoOptions),t.R7$(),t.Y8G("ngClass",t.eq3(20,W,!r.state().editMode)),t.R7$(),t.Dyx(r.v1DataSnippets()),t.R7$(2),t.vxM(null!=(n=r.v1DataSnippets())&&n.length&&r.v1ContextSnippets().length?33:-1),t.R7$(),t.Dyx(r.v1ContextSnippets()),t.R7$(6),t.vxM(null==r.result()||r.isDeleted()?-1:40),t.R7$(5),t.Y8G("matMenuTriggerFor",c),t.R7$(5),t.Y8G("disabled",!(null!=(i=r.currentFormula())&&i.sourceCodeId)),t.R7$(10),t.vxM(r.allowSaveFormula?60:-1),t.R7$(),t.Y8G("disabled",!r.state().editMode||!(null!=(s=r.currentFormula())&&s.sourceCode))}}let mt=(()=>{class o{#t;#e;constructor(e,n,i,s,c){this.snackBar=e,this.formConfig=n,this.itemService=i,this.contentTypeService=s,this.translate=c,this.log=(0,u.Tq)({FormulaDesignerComponent:o}),this.#t=(0,t.WQX)(w.f),this.#e=(0,D.d)(Y.R),this.clipboard=(0,D.d)(G.W),this.SelectTargets=O,this.loadError=!1,this.freeTextTarget=!1,this.allowSaveFormula=this.formConfig.config.enableFormulaSave,this.isDeleted=(0,t.vPA)(!1),this.saving=(0,t.vPA)(!1),this.monacoOptions={minimap:{enabled:!1},lineHeight:19,lineNumbers:"off",lineDecorationsWidth:0,folding:!1,scrollBeyondLastLine:!1,tabSize:2,fixedOverflowWidgets:!0},this.filename=`formula${this.formConfig.config.formId}.js`,this.focused=!1,this.state=this.#t.designerState,this.result=this.#t.formulaResult,this.targetOptions=this.#t.currentTargetOptions,this.entityOptions=this.#t.entityOptions,this.fieldsOptions=this.#t.fieldsOptions,this.currentFormula=this.#t.currentFormula,this.v2JsTypings=this.#t.v2JsTypings,this.v1ContextSnippets=this.#t.v1ContextSnippets,this.v1DataSnippets=this.#t.v1DataSnippets,this.template=(0,t.EWP)(()=>Object.values(z.jk).includes(this.state().target)?R.pk:R.OK)}ngOnInit(){this.loadError=!1,Object.keys(this.#t.itemSettingsServices).length<1?this.loadError=!0:(this.#t.setDesignerOpen(!0),this.#t.initAfterItemSettingsAreReady())}ngOnDestroy(){this.#t.setDesignerOpen(!1)}selectedChanged(e,n){const i={...this.#t.designerState(),editMode:!1};switch(e){case O.Entity:i.entityGuid=n;const s=this.#t.itemSettingsServices[i.entityGuid];i.fieldName=Object.keys(s.allProps())[0];break;case O.Field:i.fieldName=n;break;case O.Target:i.target=n}this.#t.designerState.set(i)}toggleFreeText(){this.freeTextTarget=!this.freeTextTarget}formulaChanged(e){this.#t.cache.updateFormulaFromEditor(this.#n,e,!1)}onFocused(e){this.focused=e}toggleEdit(){const e=this.#t.designerState(),n={...e,editMode:!e.editMode};this.#t.designerState.set(n),n.editMode&&null==this.#t.currentFormula()&&this.#t.cache.updateFormulaFromEditor(this.#n,this.template(),!1)}reset(){const e={...this.#t.designerState(),editMode:!1},n=this.#n;this.#t.designerState.set(e),this.#t.cache.resetFormula(n),this.#t.itemSettingsServices[n.entityGuid].retriggerFormulas("designer-reset")}run(){const e=this.#n,n=this.#t.currentFormula();this.#t.cache.updateFormulaFromEditor(e,n.sourceCode,!0),this.#t.itemSettingsServices[e.entityGuid].retriggerFormulas("designer-run"),this.isDeleted.set(!1)}get#n(){const e=this.#t.designerState();return{entityGuid:e.entityGuid,fieldName:e.fieldName,target:e.target}}save(){this.saving.set(!0);const e=this.#t.currentFormula();if(null==e.sourceCodeId){const n=this.itemService.get(e.entityGuid),s=this.contentTypeService.getAttributeOfItem(n,e.fieldName).Metadata.find(c=>"@All"===c.Type.Id);return s?void this.#e.create(E.YX.contentTypes.formulas,{Title:e.target,Target:e.target,Formula:e.sourceCode,Enabled:!0,ParentRelationship:V.c.relationship(s.Guid,"Formulas")}).subscribe(c=>{this.#t.cache.updateSaved(e,c.Guid,c.Id),this.snackBar.open("Formula saved",null,{duration:2e3}),this.saving.set(!1)}):(this.snackBar.open("Field configuration is missing. Please create formula in Administration",void 0,{duration:3e3}),void this.saving.set(!1))}this.#e.update(E.YX.contentTypes.formulas,e.sourceCodeId,{Formula:e.sourceCode}).subscribe(()=>{this.#t.cache.updateSaved(e,e.sourceCodeGuid,e.sourceCodeId),this.snackBar.open("Formula saved",null,{duration:2e3}),this.saving.set(!1)})}deleteFormula(){const e=this.#t.designerState(),n=this.#t.currentFormula();confirm(this.translate.instant("Data.Delete.Question",{title:n.fieldName+" - "+n.target,id:n.sourceCodeId}))&&this.#e.delete(E.YX.contentTypes.formulas,n.sourceCodeId,!0).subscribe({next:()=>{this.#t.cache.delete(n),this.snackBar.open(this.translate.instant("Message.Deleted"),null,{duration:2e3}),this.isDeleted.set(!0),e.editMode&&this.toggleEdit()},error:r=>{this.snackBar.open(this.translate.instant("Message.DeleteError"),null,{duration:2e3})}})}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(I.UG),t.rXU(_.S),t.rXU(P.b),t.rXU(A.n),t.rXU(H.c$))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-formula-designer"]],decls:1,vars:1,consts:[["menu","matMenu"],[1,"formula-context-box"],["color","accent",1,"eav-mat-form-field"],[3,"ngModelChange","ngModel"],[3,"value"],[3,"ngModelChange","ngModel","disabled"],[3,"ngModel","disabled"],["matInput","",3,"ngModel","disabled"],["mat-icon-button","","tippy","FreeText Target",1,"eav-formula-button",3,"click","disabled"],[1,"spacer"],["mat-icon-button","","tippy","Help","href","https://go.2sxc.org/formulas","target","_blank",1,"eav-formula-button"],[1,"formula-box"],[1,"formula-field",3,"ngClass"],[1,"label"],[1,"editor",3,"valueChanged","focused","blurred","filename","value","jsTypings","options"],[1,"formula-snippets","fancy-scrollbar-light",3,"ngClass"],[1,"snippet",3,"title"],[1,"separator"],[1,"formula-footer-box"],[1,"formula-result-box","hide-scrollbar"],[1,"formula-actions-box"],["mat-icon-button","","tippy","Edit",3,"click"],["mat-icon-button","","tippy","Menu",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"click"],["mat-icon-button","","tippy","Save",3,"tippyDisabled","disabled"],["mat-icon-button","","tippy","Run",3,"click","disabled"],[3,"ngClass"],["matInput","",3,"ngModelChange","ngModel","disabled"],[1,"snippet",3,"click","title"],[1,"result-error"],[1,"result-undefined"],["mat-icon-button","","tippy","Save",3,"click","tippyDisabled","disabled"]],template:function(n,i){1&n&&t.DNE(0,ut,64,22),2&n&&t.vxM(i.loadError?-1:0)},dependencies:[v.RG,v.rl,v.nJ,k.Ve,k.VO,F.wT,h.YN,h.me,h.BC,h.vS,F.Sy,g.YU,T.fS,T.fg,p.Hl,p.pQ,p.iY,d.m_,d.An,j.K,M.Cn,M.kk,M.fb,M.Cp,g.TG,U,b.e],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;box-sizing:border-box;overflow:hidden;border-top:1px solid lightgray;padding-top:8px}.formula-context-box[_ngcontent-%COMP%]{display:flex;align-items:center}.formula-context-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px}.formula-context-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.has-formula[_ngcontent-%COMP%]{font-weight:700}.formula-box[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;overflow:hidden}.formula-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{flex:0 1 auto;font-size:14px;width:100%}.formula-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-family:monospace}.formula-box[_ngcontent-%COMP%]   .formula-field[_ngcontent-%COMP%]{flex:0 1 auto;width:100%;overflow:hidden;margin-bottom:6px}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]{flex:0 0 auto;max-width:200px;max-height:194px;overflow:hidden auto;padding-left:2px}.formula-box[_ngcontent-%COMP%]   .formula-snippets.disabled[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]{pointer-events:none;color:#1d273d70}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;white-space:nowrap;padding-top:1px;padding-bottom:1px}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]:first-of-type{padding-top:0}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]:last-of-type{padding-bottom:0}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:.5em;margin-bottom:.5em;border-bottom:1px solid rgba(29,39,61,.44)}.formula-footer-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;overflow:hidden;height:min-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;height:fit-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .result-undefined[_ngcontent-%COMP%], .formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .result-error[_ngcontent-%COMP%]{color:red}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;height:fit-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]   .mdc-icon-button[_ngcontent-%COMP%]{margin-left:0;width:30px;height:30px;line-height:30px;padding:0;flex-shrink:0}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]   .mdc-icon-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-top:5px;font-size:20px;width:20px;height:20px;line-height:20px!important}.formula-field[_ngcontent-%COMP%]{padding-top:28px;border-bottom:1px solid rgba(0,0,0,.2);padding-bottom:12px;position:relative}.formula-field[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;color:#0009;cursor:default;font-size:12px;transition:none;position:absolute;left:0;top:0;-webkit-user-select:none;user-select:none}.formula-field[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]     .monaco-editor .scroll-decoration{display:none}.formula-field[_ngcontent-%COMP%]:hover{border-bottom:2px solid rgba(0,0,0,.4);padding-bottom:11px}.formula-field.focused[_ngcontent-%COMP%]{border-bottom:2px solid #002753;padding-bottom:11px}.formula-field.focused[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#002753}.formula-field.error[_ngcontent-%COMP%]{border-bottom:2px solid #b00030;padding-bottom:11px}.formula-field.error[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#b00030}.formula-field.disabled[_ngcontent-%COMP%]{border-bottom:none;padding-bottom:13px;background-image:linear-gradient(to right,rgba(0,0,0,.2) 0%,rgba(0,0,0,.2) 33%,transparent 0%);background-position:bottom;background-size:4px 1px;background-repeat:repeat-x}.formula-field.disabled[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]{pointer-events:none}.formula-field.disabled[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]     *{color:#00000061}"]})}}return o})();var C=l(7149),ft=l(5099);let _t=(()=>{class o{static \u0275fac=function(n){return new(n||o)};static \u0275mod=t.$C({type:o});static \u0275inj=t.G2t({})}return o})();var m=l(7941);let ht=(()=>{class o{constructor(e,n){this.dialog=e,this.data=n,this.hostClass="dialog-component",this.focused=!1,this.editorOptions={theme:"vs-light",language:"json",readOnly:!0,automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1},this.filename="exported-config.json",this.clipboard=(0,D.d)(G.W),this.selectedConfig=JSON.stringify(n.configData,null,2)}onFocused(e){this.focused=e}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(m.CP),t.rXU(m.Vh))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-monaco-editor-dialog"]],hostVars:1,hostBindings:function(n,i){2&n&&t.Mr5("className",i.hostClass)},decls:13,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","mat-dialog-close","","tippy","Close dialog"],[1,"eav-dialog-content",2,"padding-bottom","0"],[2,"height","350px","width","100%",3,"focused","blurred","filename","value","options"],["mat-icon-button","","tippy","Copy Config To Clipboard",3,"click"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Configs Exporter"),t.k0s(),t.j41(4,"button",3)(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"app-monaco-editor",5),t.bIt("focused",function(){return i.onFocused(!0)})("blurred",function(){return i.onFocused(!1)}),t.k0s()(),t.j41(9,"mat-dialog-actions")(10,"button",6),t.bIt("click",function(){return i.clipboard.copyToClipboard(i.selectedConfig)}),t.j41(11,"mat-icon"),t.EFF(12,"content_copy"),t.k0s()()()()),2&n&&(t.R7$(8),t.Y8G("filename",i.filename)("value",i.selectedConfig)("options",i.editorOptions))},dependencies:[m.hM,m.tx,m.E7,h.YN,j.K,p.Hl,p.iY,_t,d.m_,d.An,b.e],encapsulation:2})}}return o})(),Ct=(()=>{class o{constructor(e,n){this.dialog=e,this.data=n,this.hostClass="dialog-component",this.focused=!1,this.editorOptions={theme:"vs-light",language:"json",readOnly:!1,automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1},this.filename="log-specs.json",this.logSpecs=JSON.stringify(n.logSpecs,null,2)}onClose(){this.dialog.close()}onSave(){this.dialog.close(this.logSpecs)}onValueChanged(e){this.logSpecs=e}onFocused(e){this.focused=e}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(m.CP),t.rXU(m.Vh))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-monaco-editor-dialog"]],hostVars:1,hostBindings:function(n,i){2&n&&t.Mr5("className",i.hostClass)},decls:13,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","mat-dialog-close","","tippy","Close dialog"],[1,"eav-dialog-content",2,"padding-bottom","0"],[2,"height","350px","width","100%",3,"valueChanged","focused","blurred","filename","value","options"],["mat-icon-button","","tippy","Save Specs",3,"click"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Log Specs Editor"),t.k0s(),t.j41(4,"button",3)(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"app-monaco-editor",5),t.bIt("valueChanged",function(c){return i.onValueChanged(c)})("focused",function(){return i.onFocused(!0)})("blurred",function(){return i.onFocused(!1)}),t.k0s()(),t.j41(9,"mat-dialog-actions")(10,"button",6),t.bIt("click",function(){return i.onSave()}),t.j41(11,"mat-icon"),t.EFF(12,"save"),t.k0s()()()()),2&n&&(t.R7$(8),t.Y8G("filename",i.filename)("value",i.logSpecs)("options",i.editorOptions))},dependencies:[m.hM,m.tx,m.E7,h.YN,j.K,p.Hl,p.iY,d.m_,d.An,b.e],encapsulation:2})}}return o})();function bt(o,a){if(1&o&&(t.j41(0,"mat-option",9),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function vt(o,a){if(1&o){const e=t.RV6();t.j41(0,"button",12),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,s=t.XpG();return t.Njj(s.openLogSpecs(i.key))}),t.j41(1,"mat-icon",13),t.EFF(2,"data_object"),t.k0s()()}}function xt(o,a){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"label")(2,"input",10),t.bIt("change",function(){const i=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.toggleConfig(i.key))}),t.k0s(),t.EFF(3),t.DNE(4,vt,3,0,"button",11),t.k0s()()}if(2&o){const e=a.$implicit,n=t.XpG();t.R7$(2),t.Y8G("id",e.key)("name",e.key)("checked",n.isChecked(e.key)),t.R7$(),t.SpI(" ",e.key," "),t.R7$(),t.vxM(n.hasLogSpecs(e.key)?4:-1)}}let yt=(()=>{class o{constructor(e,n,i){this.loggingService=e,this.matDialog=n,this.snackBar=i,this.LogSeverities=C.E,this.logManager=ft.U.singleton(),this.allLogs=this.logManager.mergeAllSpecs,this.configs=[],this.selectedConfig=null,this.sessionPrefix="logSpecs",this.logs=this.loggingService.getLogsSignal(),this.loadConfigsFromStateManager()}checkAll(){if(Object.values(this.allLogs).every(n=>n.enabled))for(const n of Object.keys(this.allLogs))this.isChecked(n)&&this.toggleConfig(n);else for(const n of Object.keys(this.allLogs))this.isChecked(n)||this.toggleConfig(n);this.allLogs=this.logManager.mergeAllSpecs}isChecked(e){return this.allLogs[e]?.enabled??!1}toggleConfig(e){this.logManager.toggle(e),this.allLogs=this.logManager.mergeAllSpecs}loadConfigsFromStateManager(){const e=Object.keys(this.logManager.state.cache).filter(n=>n.startsWith(this.sessionPrefix));this.configs=e.map(n=>n.replace(`${this.sessionPrefix}.`,""))}onConfigSelected(e){if(e){Object.keys(this.allLogs).forEach(s=>{this.isChecked(s)&&this.toggleConfig(s)});const i=this.logManager.state.cache[`${this.sessionPrefix}.${e}`];i&&(Object.keys(i).forEach(s=>{i[s]?.enabled&&(this.isChecked(s)||this.toggleConfig(s))}),this.allLogs=this.logManager.mergeAllSpecs)}}saveConfig(){const e=prompt("Enter the config name:");if(e){const n=Object.fromEntries(Object.entries(this.allLogs).filter(([,s])=>s.enabled));this.logManager.state.add(`${this.sessionPrefix}.${e}`,n),this.snackBar.open(`Config "${e}" has been saved.`,null,{duration:2e3}),this.loadConfigsFromStateManager()}}exportConfig(){const n=this.logManager.state.cache[`${this.sessionPrefix}.${this.selectedConfig}`];n?this.matDialog.open(ht,{width:"800px",data:{configData:n}}):this.snackBar.open(`Config "${this.selectedConfig}" not found.`,null,{duration:2e3})}hasLogSpecs(e){const n=this.allLogs[e]?.specs;return!!n&&Object.keys(n).length>0}openLogSpecs(e){this.matDialog.open(Ct,{width:"800px",data:{logSpecs:this.allLogs[e].specs}}).afterClosed().subscribe(s=>{if(s){const c=JSON.parse(s);this.allLogs[e].specs=c,this.logManager.updateSpecs(this.allLogs)}})}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(C.J),t.rXU(m.bZ),t.rXU(I.UG))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-logs-config"]],decls:18,vars:6,consts:[[1,"log-content","fancy-scrollbar-light"],[1,"menu"],["mat-button","","tippy","Toggles All Logs",3,"click"],["mat-icon-button","","tippy","Save Configuration",3,"click"],["mat-icon-button","","tippy","Export configuration",3,"click","disabled"],["color","accent"],[3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"value"],["type","checkbox",3,"change","id","name","checked"],["tippy","Edit Log Specs"],["tippy","Edit Log Specs",3,"click"],[1,"specs-icon"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"button",2),t.bIt("click",function(){return i.checkAll()}),t.EFF(3," Toggle All "),t.k0s(),t.j41(4,"div")(5,"button",3),t.bIt("click",function(){return i.saveConfig()}),t.j41(6,"mat-icon"),t.EFF(7,"save"),t.k0s()(),t.j41(8,"button",4),t.bIt("click",function(){return i.exportConfig()}),t.j41(9,"mat-icon"),t.EFF(10,"ios_share"),t.k0s()(),t.j41(11,"mat-form-field",5)(12,"mat-label"),t.EFF(13,"Configurations"),t.k0s(),t.j41(14,"mat-select",6),t.mxI("valueChange",function(c){return t.DH7(i.selectedConfig,c)||(i.selectedConfig=c),c}),t.bIt("selectionChange",function(c){return i.onConfigSelected(c.value)}),t.DNE(15,bt,2,2,"mat-option",7),t.k0s()()()(),t.DNE(16,xt,5,5,"div",8),t.nI1(17,"keyvalue"),t.k0s()),2&n&&(t.R7$(8),t.Y8G("disabled",null===i.selectedConfig),t.R7$(6),t.R50("value",i.selectedConfig),t.R7$(),t.Y8G("ngForOf",i.configs),t.R7$(),t.Y8G("ngForOf",t.bMT(17,4,i.allLogs)))},dependencies:[g.MD,g.Sq,g.lG,d.m_,d.An,p.Hl,p.$z,p.iY,b.e,v.RG,v.rl,v.nJ,k.Ve,k.VO,F.wT,F.Sy,h.YN,T.fS],styles:["[_nghost-%COMP%]{height:100%;overflow:auto}.menu[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5rem;justify-content:space-between}mat-form-field[_ngcontent-%COMP%]{margin:0 1rem}button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:0;margin:0}.specs-icon[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;height:1rem;width:1rem;padding:0;margin:0}"]})}}return o})();const Ft=(o,a)=>({"log-error":o,"log-warn":a});function Mt(o,a){1&o&&(t.j41(0,"div"),t.EFF(1,"Logs are empty"),t.k0s())}function kt(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",4)(1,"span",5),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.j41(4,"span",6),t.EFF(5),t.k0s(),t.j41(6,"span",7),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.logToConsole(i))}),t.EFF(7," console "),t.k0s()()}if(2&o){const e=a.$implicit,n=t.XpG(2);t.Y8G("ngClass",t.l_i(6,Ft,e.severity===n.LogSeverities.Error,e.severity===n.LogSeverities.Warn)),t.R7$(2),t.SpI("",t.i5U(3,3,e.time,"HH:mm:ss"),":"),t.R7$(3),t.JRh(e.label)}}function Ot(o,a){if(1&o&&(t.DNE(0,Mt,2,0,"div"),t.Z7z(1,kt,8,9,"div",4,t.fX1)),2&o){const e=t.XpG();t.vxM(0===e.logs().length?0:-1),t.R7$(),t.Dyx(e.logs())}}function Tt(o,a){1&o&&t.nrm(0,"app-logs-config")}let Dt=(()=>{class o{constructor(e){this.loggingService=e,this.LogSeverities=C.E,this.showSettings=!1,this.logs=this.loggingService.getLogsSignal()}logToConsole(e){switch(e.severity){case C.E.Log:console.log(e.label,e.error);break;case C.E.Warn:console.warn(e.label,e.error);break;case C.E.Error:console.error(e.label,e.error)}}toggleDialog(){this.showSettings=!this.showSettings}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(C.J))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-logs-dump"]],decls:8,vars:1,consts:[[1,"logs-box","fancy-scrollbar-light"],[1,"logs-content"],[1,"log-button"],["mat-icon-button","","tippy","Enable Logs UI",3,"click"],[1,"log-entry",3,"ngClass"],[1,"log-entry-part","log-entry-time"],[1,"log-entry-part","log-entry-label"],["tippy","Log to console",1,"log-entry-part","log-entry-show",3,"click"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,Ot,3,1)(3,Tt,1,0,"app-logs-config"),t.k0s(),t.j41(4,"div",2)(5,"button",3),t.bIt("click",function(){return i.toggleDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"settings"),t.k0s()()()()),2&n&&(t.R7$(2),t.vxM(i.showSettings?3:2))},dependencies:[g.YU,g.vh,d.m_,d.An,p.Hl,p.iY,yt,b.e],styles:["[_nghost-%COMP%]{height:100%;width:100%}.logs-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.logs-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;overflow-x:hidden}.log-button[_ngcontent-%COMP%]{position:relative;padding-top:10px;background:#fff}.log-entry[_ngcontent-%COMP%]{display:flex;align-items:center;box-sizing:border-box;border-bottom:1px solid rgb(240,240,240);padding-top:2px;padding-bottom:2px}.log-entry[_ngcontent-%COMP%]   .log-entry-part[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.log-error[_ngcontent-%COMP%]{color:red;border-color:#ffd6d6;background-color:#fff0f0}.log-warn[_ngcontent-%COMP%]{color:#5c3c00;border-color:#fff5c2;background-color:#fffbe5}.log-entry-time[_ngcontent-%COMP%]{flex:0 0 auto}.log-entry-label[_ngcontent-%COMP%]{flex:1 1 auto}.log-entry-show[_ngcontent-%COMP%]{flex:0 0 auto;color:#06599a;font-size:12px;text-decoration:underline;cursor:pointer}"]})}}return o})();const jt=o=>({"debug-enabled":o});function Et(o,a){if(1&o){const e=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleSize())}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(2),t.JRh(e.preferences().expanded?"unfold_less":"expand")}}function St(o,a){if(1&o){const e=t.RV6();t.j41(0,"button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.prefManager.toggle("pinned"))}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s()()}if(2&o){const e=t.XpG();t.Y8G("tippy","Developer tools are only visible to developers. "+e.pinResource("status")),t.R7$(2),t.JRh(e.pinResource("icon"))}}function Pt(o,a){1&o&&t.nrm(0,"app-data-dump")}function Gt(o,a){1&o&&t.nrm(0,"app-formula-designer")}function Rt(o,a){1&o&&t.nrm(0,"app-logs-dump")}function It(o,a){if(1&o&&(t.j41(0,"div",9),t.DNE(1,Pt,1,0,"app-data-dump")(2,Gt,1,0,"app-formula-designer")(3,Rt,1,0,"app-logs-dump"),t.k0s()),2&o){let e;const n=t.XpG();t.Y8G("ngClass","size"+(n.preferences().expanded?"-xl":"")),t.R7$(),t.vxM((e=n.preferences().tab)===n.DebugTypes.Data?1:e===n.DebugTypes.Formulas?2:e===n.DebugTypes.Logs?3:-1)}}let $t=(()=>{class o{constructor(){this.log=(0,u.Tq)({EditDialogFooterComponent:o}),this.DebugTypes=X,this.sxcVer=window.sxcVersion.substring(0,window.sxcVersion.lastIndexOf(".")),this.prefManager=(0,t.WQX)(f.i).part(B.K),this.preferences=this.prefManager.data}toggleDialog(e){const n=this.preferences(),i=n.tab===e,c=!i&&n.expanded;this.prefManager.setMany({tab:i?null:e,expanded:c,size:i?0:c?2:1})}toggleSize(){const e=!this.preferences().expanded;this.prefManager.setMany({expanded:e,size:e?2:1})}pinResource(e){return Lt[`${e}-${this.preferences().pinned}`]}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-edit-dialog-footer"]],decls:23,vars:6,consts:[["appearance","raised",1,"mat-elevation-z4",3,"ngClass"],[1,"debug-buttons-container"],["mat-button","","tippy","Show Data JSON",3,"click"],["mat-button","","tippy","Show Formula Designer",3,"click"],["mat-button","","tippy","Show Logs",3,"click"],[1,"spacer"],["mat-icon-button","","tippy","expand/shrink"],["mat-icon-button","",3,"tippy"],[1,"sxc-version"],[1,"debug-info-container",3,"ngClass"],["mat-icon-button","","tippy","expand/shrink",3,"click"],["mat-icon-button","",3,"click","tippy"]],template:function(n,i){1&n&&(t.j41(0,"mat-card",0)(1,"div",1)(2,"button",2),t.bIt("click",function(){return i.toggleDialog(i.DebugTypes.Data)}),t.j41(3,"mat-icon"),t.EFF(4,"offline_bolt"),t.k0s(),t.j41(5,"span"),t.EFF(6,"Data"),t.k0s()(),t.j41(7,"button",3),t.bIt("click",function(){return i.toggleDialog(i.DebugTypes.Formulas)}),t.j41(8,"mat-icon"),t.EFF(9,"functions"),t.k0s(),t.j41(10,"span"),t.EFF(11,"Formulas"),t.k0s()(),t.j41(12,"button",4),t.bIt("click",function(){return i.toggleDialog(i.DebugTypes.Logs)}),t.j41(13,"mat-icon"),t.EFF(14,"speed"),t.k0s(),t.j41(15,"span"),t.EFF(16,"Logs"),t.k0s()(),t.nrm(17,"div",5),t.DNE(18,Et,3,1,"button",6)(19,St,3,2,"button",7),t.j41(20,"div",8),t.EFF(21),t.k0s()(),t.DNE(22,It,4,2,"div",9),t.k0s()),2&n&&(t.Y8G("ngClass",t.eq3(4,jt,null!=i.preferences().tab)),t.R7$(18),t.vxM(null!=i.preferences().tab?18:19),t.R7$(3),t.SpI(" 2sxc ",i.sxcVer," "),t.R7$(),t.vxM(null!=i.preferences().tab?22:-1))},dependencies:[y.Hu,y.RN,p.Hl,p.$z,p.iY,d.m_,d.An,g.YU,N,mt,Dt,b.e],styles:[".mat-mdc-card[_ngcontent-%COMP%]{padding:0;margin:0;border-top-left-radius:0;border-top-right-radius:0;height:var(--edit-footer-bar-height);z-index:1;width:100%;display:flex;flex-direction:column;box-sizing:border-box}@media (max-width: 600px){.mat-mdc-card[_ngcontent-%COMP%]{border-radius:0}}.mat-mdc-card.debug-enabled[_ngcontent-%COMP%]{height:auto}.debug-buttons-container[_ngcontent-%COMP%]{padding:17px 16px 15px;height:var(--edit-footer-bar-height);width:100%;display:flex;box-sizing:border-box;align-items:center}.debug-buttons-container[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{margin-left:0}.debug-buttons-container[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:4px}.debug-buttons-container[_ngcontent-%COMP%]   .sxc-version[_ngcontent-%COMP%]{cursor:default}.mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;line-height:20px!important}.debug-info-container[_ngcontent-%COMP%]{margin:var(--edit-footer-container-margin)!important;margin-top:0!important;width:calc(100% - 2 * var(--edit-footer-container-margin));height:var(--edit-footer-container-height);box-sizing:border-box;position:relative;overflow:auto}.debug-info-container.size-xl[_ngcontent-%COMP%]{height:calc(2 * var(--edit-footer-container-height))}"]})}}return o})();const Lt={"status-true":"pinned - will remain visible on reload","status-false":"not pinned - will hide on reload","icon-true":"keep_public","icon-false":"keep_off"}},6817:(L,x,l)=>{l.d(x,{R:()=>y});var g=l(9234),t=l(6474),p=l(1659);let y=(()=>{class d extends t.D{create(u,f){return this.http.post(`app/auto/data/${u}`,f,{params:{appId:this.appId,zoneId:this.zoneId}})}update(u,f,_){return this.http.post(`app/auto/data/${u}/${f}`,_,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(u,f,_){return this.http.delete(this.apiUrl(g.gb+"delete"),{params:{contentType:u,id:f.toString(),appId:this.appId,force:_.toString()}})}static{this.\u0275fac=(()=>{let u;return function(_){return(u||(u=p.xGo(d)))(_||d)}})()}static{this.\u0275prov=p.jDH({token:d,factory:d.\u0275fac})}}return d})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/19.03.04/dist/ng-edit/projects_eav-ui_src_app_edit_dialog_footer_edit-dialog-footer_component_ts.9a5ad65840ef1ee5.js.map