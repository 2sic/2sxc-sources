"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts"],{5546:(Z,x,i)=>{i.r(x),i.d(x,{ManageContentListComponent:()=>H});var d=i(3989),p=i(8071),f=i(3839),M=i(9736),E=i(3738),m=i(2957),h=i(712),T=i(1217),g=i(6041),t=i(1699),C=i(91),r=i(6861),u=i(9409),P=i(1916),D=i(6575),B=i(5941),b=i(9498),A=i(895),U=i(6515),y=i(5918);function K(s,c){if(1&s){const o=t.EpF();t.ynx(0),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"button",14),t.NdJ("click",function(){t.CHM(o);const e=t.oxw(3);return t.KtG(e.editHeader())}),t.TgZ(4,"mat-icon"),t._uU(5,"edit"),t.qZA()(),t.BQk()}if(2&s){const o=t.oxw(2).ngIf;t.xp6(2),t.Oqu(o.header.Title)}}function $(s,c){1&s&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&s&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"ManageContentList.NoHeader")))}function R(s,c){if(1&s&&(t.ynx(0),t.TgZ(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"p"),t.YNc(5,K,6,1,"ng-container",0),t.YNc(6,$,3,3,"ng-container",0),t.qZA(),t.BQk()),2&s){const o=t.oxw().ngIf;t.xp6(2),t.hij(" ",t.lcZ(3,3,"ManageContentList.Description")," "),t.xp6(3),t.Q6J("ngIf",o.header.Type),t.xp6(1),t.Q6J("ngIf",!o.header.Type)}}function k(s,c){1&s&&(t.TgZ(0,"p",15),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"ManageContentList.SortItems")," "))}function G(s,c){1&s&&(t.TgZ(0,"p",15),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"ManageContentList.SortLotsOfItems")," "))}function W(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",16)(1,"div",17)(2,"mat-icon",18),t._uU(3,"drag_handle"),t.qZA(),t.TgZ(4,"span",19),t._uU(5),t.qZA()(),t.TgZ(6,"div")(7,"button",20),t.NdJ("click",function(){const a=t.CHM(o).$implicit,_=t.oxw(2);return t.KtG(_.addFromExisting(a.Index))}),t.ALo(8,"translate"),t.TgZ(9,"mat-icon"),t._uU(10,"playlist_add"),t.qZA()(),t.TgZ(11,"button",20),t.NdJ("click",function(){const a=t.CHM(o).$implicit,_=t.oxw(2);return t.KtG(_.addBelow(a.Index))}),t.ALo(12,"translate"),t.TgZ(13,"mat-icon"),t._uU(14,"add"),t.qZA()(),t.TgZ(15,"button",20),t.NdJ("click",function(){const a=t.CHM(o).$implicit,_=t.oxw(2);return t.KtG(_.remove(a))}),t.ALo(16,"translate"),t.TgZ(17,"mat-icon"),t._uU(18,"remove"),t.qZA()(),t.TgZ(19,"button",20),t.NdJ("click",function(){const a=t.CHM(o).$implicit,_=t.oxw(2);return t.KtG(_.editItem(a.Id))}),t.ALo(20,"translate"),t.TgZ(21,"mat-icon"),t._uU(22,"edit"),t.qZA()()()()}if(2&s){const o=c.$implicit,n=t.oxw(2);t.xp6(4),t.hYB("tippy","",o.Title," (",o.Id,")"),t.xp6(1),t.AsE(" ",o.Title," (",o.Id,") "),t.xp6(2),t.Q6J("tippy",t.lcZ(8,12,"Fields.Entity.AddExistingItem"))("disabled",0===o.Id),t.xp6(4),t.Q6J("tippy",t.lcZ(12,14,"Fields.Entity.AddItemBelow"))("disabled",0===o.Id||n.reordered),t.xp6(4),t.Q6J("tippy",t.lcZ(16,16,"Fields.Entity.Remove"))("disabled",n.reordered),t.xp6(4),t.Q6J("tippy",t.lcZ(20,18,"Fields.Entity.Edit"))("disabled",0===o.Id)}}function F(s,c){if(1&s){const o=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"div",4),t._UZ(7,"router-outlet"),t.TgZ(8,"div",5),t.YNc(9,R,7,5,"ng-container",0),t.YNc(10,k,3,3,"p",6),t.YNc(11,G,3,3,"p",6),t.TgZ(12,"div",7),t.NdJ("cdkDropListDropped",function(e){t.CHM(o);const a=t.oxw();return t.KtG(a.drop(e))}),t.YNc(13,W,23,20,"div",8),t.qZA()()(),t.TgZ(14,"mat-dialog-actions",9)(15,"button",10),t.NdJ("click",function(){t.CHM(o);const e=t.oxw();return t.KtG(e.closeDialog())}),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"button",11),t.NdJ("click",function(){t.CHM(o);const e=t.oxw();return t.KtG(e.saveList())}),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"button",12),t.NdJ("click",function(){t.CHM(o);const e=t.oxw();return t.KtG(e.saveAndCloseList())}),t.ALo(22,"translate"),t.TgZ(23,"mat-icon",13),t._uU(24,"done"),t.qZA()()()(),t.BQk()}if(2&s){const o=c.ngIf,n=t.oxw();t.xp6(4),t.Oqu(t.lcZ(5,9,"ManageContentList.Title")),t.xp6(5),t.Q6J("ngIf",o.header),t.xp6(1),t.Q6J("ngIf",o.items&&(null==o.items?null:o.items.length)<25),t.xp6(1),t.Q6J("ngIf",(null==o.items?null:o.items.length)>=25),t.xp6(2),t.Q6J("ngForOf",o.items)("ngForTrackBy",n.trackByFn),t.xp6(3),t.Oqu(t.lcZ(17,11,"General.Buttons.Cancel")),t.xp6(3),t.Oqu(t.lcZ(20,13,"General.Buttons.Save")),t.xp6(2),t.Q6J("tippy",t.lcZ(22,15,"Form.Buttons.SaveAndClose"))}}let H=(()=>{var s;class c extends g.H{constructor(n,e,a,_,l,v,I){super(n,e),this.router=n,this.route=e,this.dialogRef=a,this.contentGroupService=_,this.snackBar=l,this.translate=v,this.appDialogConfigService=I,this.hostClass="dialog-component",this.items$=new p.X(null),this.header$=new p.X(null),this.viewModel$=(0,f.a)([this.items$,this.header$]).pipe((0,M.U)(([O,L])=>({items:O,header:L}))),this.contentGroup={id:null,guid:this.route.snapshot.paramMap.get("guid"),part:this.route.snapshot.paramMap.get("part"),index:parseInt(this.route.snapshot.paramMap.get("index"),10)},this.reordered=!1}ngOnInit(){this.fetchList(),this.fetchHeader(),this.fetchDialogSettings(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{this.fetchList(!0),this.fetchHeader()}))}ngOnDestroy(){this.items$.complete(),this.header$.complete(),super.ngOnDestroy()}fetchDialogSettings(){this.appDialogConfigService.getShared$().pipe((0,E.b)(n=>{this.translate.setDefaultLang(n.Context.Language.Primary.split("-")[0]),this.translate.use(n.Context.Language.Current.split("-")[0])})).subscribe()}closeDialog(){this.dialogRef.close()}saveList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.fetchList(),this.fetchHeader()})}saveAndCloseList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()})}editHeader(){const e=(0,m.f)({items:[{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listcontent"},{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listpresentation"}]});this.router.navigate([`edit/${e}`],{relativeTo:this.route})}editItem(n){const a=(0,m.f)({items:[{EntityId:n}]});this.router.navigate([`edit/${a}`],{relativeTo:this.route})}addFromExisting(n){this.router.navigate([`${this.contentGroup.guid}/${this.contentGroup.part}/${n+1}/replace`],{relativeTo:this.route,queryParams:{add:!0}})}addBelow(n){const a=(0,m.f)({items:[{Add:!0,Index:n+1,Parent:this.contentGroup.guid,Field:this.contentGroup.part}]});this.router.navigate([`edit/${a}`],{relativeTo:this.route})}remove(n){confirm(this.translate.instant("ManageContentList.ConfirmRemove"))&&(this.snackBar.open("Removing..."),this.contentGroupService.removeItem(this.contentGroup,n.Index).subscribe(()=>{this.snackBar.open("Removed",null,{duration:2e3}),this.fetchList()}))}drop(n){const e=[...this.items$.value];(0,d.bA)(e,n.previousIndex,n.currentIndex),this.items$.next(e),this.reordered=!0}trackByFn(n,e){return`${e.Index}+${e.Id}`}fetchList(n=!1){this.contentGroupService.getList(this.contentGroup).subscribe(e=>{if(this.reordered){const a=this.items$.value.map(l=>l.Id);if(this.items$.value.length===e.length&&!e.some(l=>!a.includes(l.Id))&&n){const l=this.items$.value.map(v=>v.Index);e.sort((v,I)=>{const O=l.indexOf(v.Index),L=l.indexOf(I.Index);return-1===O||-1===L?0:O-L})}else n&&this.snackBar.open("List was changed from somewhere else. Order of items is reset",null,{duration:5e3})}this.items$.next(e),this.reordered=!1})}fetchHeader(){this.contentGroupService.getHeader(this.contentGroup).subscribe(n=>{this.header$.next(n)})}}return(s=c).\u0275fac=function(n){return new(n||s)(t.Y36(C.F0),t.Y36(C.gz),t.Y36(r.so),t.Y36(h.e),t.Y36(u.ux),t.Y36(P.sK),t.Y36(T.Kw))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-manage-content-list"]],hostVars:1,hostBindings:function(n,e){2&n&&t.Ikx("className",e.hostClass)},features:[t.qOj],decls:2,vars:3,consts:[[4,"ngIf"],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-content"],["cdkScrollable","",1,"dialog-component-content","fancy-scrollbar-light"],["class","eav-sort-title",4,"ngIf"],["cdkDropList","",1,"eav-dnd-list",3,"cdkDropListDropped"],["class","eav-dnd-item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent",3,"tippy","click"],[1,"eav-raised-button-icon"],["mat-icon-button","","tippy","Edit header",3,"click"],[1,"eav-sort-title"],["cdkDrag","",1,"eav-dnd-item"],[1,"eav-dnd-item__title"],["tippy","Drag to reorder the list",1,"eav-dnd-item__title-icon"],[1,"eav-dnd-item__title-text",3,"tippy"],["mat-icon-button","","appMousedownStopPropagation","",3,"tippy","disabled","click"]],template:function(n,e){1&n&&(t.YNc(0,F,25,17,"ng-container",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,e.viewModel$))},dependencies:[D.sg,D.O5,C.lC,B.d,b.$,r.H8,A.lW,A.RK,U.Hw,y.PQ,d.Wj,d.Zt,D.Ov,P.X$],styles:[".eav-sort-title[_ngcontent-%COMP%]{padding-top:16px}.eav-dnd-list[_ngcontent-%COMP%]{margin:16px 0;border:1px solid #ccc;border-radius:4px;overflow:hidden}.eav-dnd-item[_ngcontent-%COMP%]{cursor:move;height:40px;border-bottom:1px solid #ccc;padding:0 8px;display:flex;align-items:center;justify-content:space-between;background:white;box-sizing:border-box;font-size:14px}.eav-dnd-item[_ngcontent-%COMP%]:last-child{border:none}.eav-dnd-item__title[_ngcontent-%COMP%]{display:flex;align-items:center;overflow:hidden;max-width:80%}.eav-dnd-item__title-icon[_ngcontent-%COMP%]{margin-right:8px;opacity:.4}.eav-dnd-item__title-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dnd-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dnd-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}),c})()},6041:(Z,x,i)=>{i.d(x,{H:()=>T});var d=i(91),p=i(4520),f=i(5043),M=i(9736),E=i(9422),m=i(9097),h=i(1699);let T=(()=>{var g;class t extends m.f{constructor(r,u){super(),this.router=r,this.route=u}ngOnDestroy(){super.ngOnDestroy()}refreshOnChildClosedDeep(){return this.router.events.pipe((0,p.h)(r=>r instanceof d.m2),(0,f.O)(!!this.route.snapshot.firstChild.firstChild),(0,M.U)(()=>!!this.route.snapshot.firstChild.firstChild),(0,E.G)(),(0,p.h)(([r,u])=>r&&!u))}refreshOnChildClosedShallow(){return this.router.events.pipe((0,p.h)(r=>r instanceof d.m2),(0,f.O)(!!this.route.snapshot.firstChild),(0,M.U)(()=>!!this.route.snapshot.firstChild),(0,E.G)(),(0,p.h)(([r,u])=>r&&!u))}}return(g=t).\u0275fac=function(r){return new(r||g)(h.Y36(d.F0),h.Y36(d.gz))},g.\u0275dir=h.lG2({type:g,features:[h.qOj]}),t})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/16.17.00/dist/ng-edit/projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts.25b95162aba2ad38.js.map