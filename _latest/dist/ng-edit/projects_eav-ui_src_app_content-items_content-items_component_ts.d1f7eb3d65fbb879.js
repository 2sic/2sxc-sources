"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-items_content-items_component_ts"],{336:(x,F,i)=>{i.d(F,{F:()=>b});var c=i(46443),v=i(14600),g=i(36647),l=i(70271),r=i(78742),y=i(70693),C=i(34435),M=i(9234),R=i(24467),_=i(99293),I=i(44444);const T={getAll:!0,getAllLive:!0,getAllOnce:!0};let b=(()=>{class p extends R.B{constructor(){super(...arguments),this.log=(0,C.Tq)({ContentItemsService:p},T)}getAllPromise(d){return this.log.fnIf("getAll",{contentTypeStaticName:d}),this.fetchPromise(M.Gg,{params:{appId:this.appId,contentType:d}})}getAllOnce(d){return this.log.fnIf("getAllOnce",{contentTypeStaticName:d}),(0,c.fx)(()=>({url:this.apiUrl(M.Gg),params:{appId:this.appId,contentType:d}}))}getAllLive(d,D){return this.log.fnIf("getAllLive",{contentTypeStaticName:d,refresh:D}),(0,c.fx)(()=>(D(),{url:this.apiUrl(M.Gg),params:{appId:this.appId,contentType:d}}))}getColumnsPromise(d){return this.fetchPromise(r.z,{params:{appId:this.appId,staticName:d}})}importItem(d){return(0,v.H)((0,y.n)(d)).pipe((0,g.n)(D=>this.http.post(this.apiUrl(M.gb+"upload"),{AppId:this.appId,ContentBase64:D})),(0,l.T)(D=>({Success:D,Messages:[]})))}static#t=this.\u0275fac=(()=>{let d;return function(O){return(d||(d=_.xGo(p)))(O||p)}})();static#e=this.\u0275prov=I.jDH({token:p,factory:p.\u0275fac})}return p})()},5858:(x,F,i)=>{i.d(F,{O:()=>c});const c="DROPDOWN_INSERT_VALUE"},6663:(x,F,i)=>{i.d(F,{F:()=>R});var c=i(84175),v=i(53777),g=i(81863),l=i(69914),r=i(99293);function y(_,I){if(1&_&&(r.nrm(0,"mat-card-subtitle",1),r.nI1(1,"safeHtml")),2&_){const T=r.XpG();r.Y8G("innerHtml",r.bMT(1,1,T.dialogData.message),r.npT)}}function C(_,I){if(1&_&&r.EFF(0),2&_){const T=r.XpG();r.SpI(" ",T.dialogData.confirmTranslateKey," ")}}function M(_,I){1&_&&r.EFF(0," Delete ")}let R=(()=>{class _{constructor(T,b){this.dialogData=T,this.dialog=b,this.hostClass="dialog-component"}static#t=this.\u0275fac=function(b){return new(b||_)(r.rXU(g.e),r.rXU(g.k))};static#e=this.\u0275cmp=r.VBU({type:_,selectors:[["app-confirm-delete-dialog"]],hostVars:1,hostBindings:function(b,p){2&b&&r.Avn("className",p.hostClass)},decls:12,vars:6,consts:[[2,"margin-bottom","12px"],[3,"innerHtml"],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","cdkFocusInitial","",1,"eav-card-action-button",3,"click","color"]],template:function(b,p){1&b&&(r.j41(0,"mat-card")(1,"mat-card-header",0)(2,"mat-card-title"),r.EFF(3),r.k0s()(),r.j41(4,"mat-card-content"),r.nVh(5,y,2,3,"mat-card-subtitle",1),r.k0s(),r.j41(6,"mat-card-actions",2)(7,"button",3),r.bIt("click",function(){return p.dialog.close()}),r.EFF(8,"Cancel"),r.k0s(),r.j41(9,"button",4),r.bIt("click",function(){return p.dialog.close(!0)}),r.nVh(10,C,1,1)(11,M,1,0),r.k0s()()()),2&b&&(r.R7$(3),r.E5c(" ",p.dialogData.title??"Delete"," ",p.dialogData.entityTitle," (",p.dialogData.entityId,")"),r.R7$(2),r.vxM(p.dialogData.message?5:-1),r.R7$(4),r.Y8G("color",p.dialogData.confirmColor??"warn"),r.R7$(),r.vxM(p.dialogData.confirmTranslateKey?10:11))},dependencies:[v.Hu,v.RN,v.YY,v.m2,v.MM,v.Lc,v.dh,c.Hl,c.$z,l.$],styles:[".eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}return _})()},21183:(x,F,i)=>{i.d(F,{f:()=>c});class c{static cellLink(g,l,r){return`<a class="default-link fill-cell ${r}" href="${g}">${l}</a>`}}},39333:(x,F,i)=>{i.d(F,{c:()=>g});var c=i(34435),v=i(99293);let g=(()=>{class l{constructor(){this.log=(0,c.Tq)({ClickStopPropagationDirective:l}),this.log.a("constructor")}onClick(y){this.log.a("onClick",{event:y}),y.stopPropagation()}static#t=this.\u0275fac=function(C){return new(C||l)};static#e=this.\u0275dir=v.FsC({type:l,selectors:[["","appClickStopPropagation",""]],hostBindings:function(C,M){1&C&&v.bIt("click",function(_){return M.onClick(_)})}})}return l})()},43758:(x,F,i)=>{i.d(F,{F:()=>p});var c=i(87945),v=i(37580),g=i(31016),l=i(99293),r=i(44444),y=i(87698);const C=["*"],M=u=>({"hint-box__short":u});function R(u,d){1&u&&l.eu8(0)}function _(u,d){if(1&u&&(l.j41(0,"mat-hint"),l.DNE(1,R,1,0,"ng-container",2),l.k0s()),2&u){l.XpG();const D=l.sdS(4);l.R7$(),l.Y8G("ngTemplateOutlet",D)}}function I(u,d){1&u&&l.eu8(0)}function T(u,d){if(1&u&&(l.j41(0,"mat-error"),l.DNE(1,I,1,0,"ng-container",2),l.k0s()),2&u){l.XpG();const D=l.sdS(4);l.R7$(),l.Y8G("ngTemplateOutlet",D)}}function b(u,d){1&u&&l.SdG(0)}let p=(()=>{class u{constructor(){this.isError=(0,v.hFB)(!1),this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(O){return new(O||u)};static#e=this.\u0275cmp=l.VBU({type:u,selectors:[["app-field-hint"]],inputs:{isError:[1,"isError"]},ngContentSelectors:C,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(O,j){if(1&O){const t=l.RV6();l.NAR(),l.j41(0,"div",1),l.bIt("click",function(){return r.eBV(t),r.Njj(j.toggleIsShort())}),l.nVh(1,_,2,1,"mat-hint")(2,T,2,1,"mat-error"),l.k0s(),l.DNE(3,b,1,0,"ng-template",null,0,l.C5r)}if(2&O){let t;l.Y8G("ngClass",l.eq3(2,M,j.isShort)),l.R7$(),l.vxM(!1===(t=j.isError())?1:!0===t?2:-1)}},dependencies:[g.M,y.c,y.b,c.YU,c.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return u})()},60852:(x,F,i)=>{i.d(F,{c:()=>I});var c=i(29658),v=i(51567),g=i(63037),l=i(70271),r=i(5057),y=i(98764),C=i(34435),M=i(4979),R=i(44444);const _={doOnDialogClosed:!0};let I=(()=>{class T extends M.V{constructor(p,u){super(),this.router=p,this.route=u,this.log=(0,C.Tq)({DialogRoutingService:T},_)}get snapshot(){return this.route.snapshot}get url(){return this.router.url}get urlSegments(){return this.router.url.split("/")}getParam(p){return this.route.snapshot.paramMap.get(p)}getParams(p){const u=this.route.snapshot.paramMap;return p.reduce((d,D)=>(d[D]=u.get(D),d),{})}getQueryParam(p){return this.route.snapshot.queryParamMap.get(p)}getQueryParams(p){const u=this.route.snapshot.queryParamMap;return p.reduce((d,D)=>(d[D]=u.get(D),d),{})}state(){return this.router.getCurrentNavigation().extras?.state}doOnDialogClosed(p){const u=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.childDialogClosed$().subscribe(d=>(u.a("Dialog closed",{data:d}),p()))),u.end()}doOnDialogClosedWithData(p){const u=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.#t().subscribe(({state:d})=>{u.a("Dialog closed",{state:d}),p(d)})),u.end()}urlSubRoute(p){const u=this.router.createUrlTree([p],{relativeTo:this.route});return this.router.serializeUrl(u)}navPath(p,u){return this.router.navigate([p],u)}navRelative(p,u){return this.router.navigate(p,{...u,relativeTo:this.route})}childDialogClosed$(){return this.router.events.pipe((0,v.p)(p=>p instanceof c.wF),(0,g.Z)(!!this.route.snapshot.firstChild),(0,l.T)(()=>!!this.route.snapshot.firstChild),(0,r.J)(),(0,v.p)(([p,u])=>p&&!u))}#t(){return this.router.events.pipe((0,v.p)(p=>p instanceof c.wF),(0,y.M)(p=>{const u=this.log.fn("childDialogClosed$",{event:p,firstChild:this.route.snapshot.firstChild,snapShot:this.route.snapshot,state:this.router.getCurrentNavigation()?.extras.state});u.a("NavigationEnd",{event:p}),u.end()}),(0,g.Z)(!!this.route.snapshot.firstChild),(0,l.T)(()=>({hasChildNow:!!this.route.snapshot.firstChild,state:this.router.getCurrentNavigation()?.extras.state})),(0,r.J)(),(0,v.p)(([p,u])=>p.hasChildNow&&!u.hasChildNow),(0,l.T)(([p,u])=>({hadChildBefore:p.hasChildNow,hasChildNow:u.hasChildNow,state:u.state})))}static#e=this.\u0275fac=function(u){return new(u||T)(R.KVO(c.Ix),R.KVO(c.nX))};static#s=this.\u0275prov=R.jDH({token:T,factory:T.\u0275fac})}return T})()},77730:(x,F,i)=>{i.r(F),i.d(F,{ContentItemsComponent:()=>xe});var c=i(44444),v=i(64173),g=i(84175),l=i(81863),r=i(93840),y=i(29658),C=i(12938),M=i(17693),R=i(6663),_=i(56360),I=i(93454),T=i(21183),b=i(11828),p=i(68163),u=i(91960),d=i(34456),D=i(53804),O=i(31016),j=i(59791),t=i(99293),G=i(87698);const it=["valueInput"];let H=(()=>{class a{constructor(){this.filter="",this.idFilterString="",this.idFilter=[]}agInit(e){this.filterParams=e}isFilterActive(){return""!==this.filter||this.idFilter.length>0}doesFilterPass(e){if(""!==this.filter){const o=this.filterParams.valueGetter({api:this.filterParams.api,colDef:this.filterParams.colDef,column:this.filterParams.column,columnApi:this.filterParams.columnApi,context:this.filterParams.context,data:e.node.data,getValue:s=>e.node.data[s],node:e.node});if(null==o||!o.some(s=>!!s&&s.includes(this.filter)))return!1}if(this.idFilter.length>0){const n=e.data[this.filterParams.colDef.headerName];if(null==n||!this.idFilter.some(o=>n.some(s=>s.Id===o)))return!1}return!0}getModel(){return this.isFilterActive()?{filterType:"entity",filter:this.filter,idFilter:this.idFilter}:void 0}setModel(e){this.filter=e?.filter??"",this.idFilter=e?.idFilter??[],this.idFilterString=e?.idFilter?.join(",")??""}afterGuiAttached(e){this.valueInputRef.nativeElement.focus()}updateIdFilter(){this.idFilter=this.idFilterString.split(",").map(e=>parseInt(e,10)).filter(e=>!isNaN(e))}filterChanged(){this.filterParams.filterChangedCallback()}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-entity-filter"]],viewQuery:function(n,o){if(1&n&&t.GBs(it,5),2&n){let s;t.mGM(s=t.lsd())&&(o.valueInputRef=s.first)}},decls:9,vars:2,consts:[["valueInput",""],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text",3,"ngModelChange","ngModel"]],template:function(n,o){if(1&n){const s=t.RV6();t.j41(0,"mat-form-field",1)(1,"mat-label"),t.EFF(2,"Value"),t.k0s(),t.j41(3,"input",2,0),t.mxI("ngModelChange",function(h){return c.eBV(s),t.DH7(o.filter,h)||(o.filter=h),c.Njj(h)}),t.bIt("ngModelChange",function(){return c.eBV(s),c.Njj(o.filterChanged())}),t.k0s()(),t.j41(5,"mat-form-field",1)(6,"mat-label"),t.EFF(7,"IDs (comma separated)"),t.k0s(),t.j41(8,"input",2),t.mxI("ngModelChange",function(h){return c.eBV(s),t.DH7(o.idFilterString,h)||(o.idFilterString=h),c.Njj(h)}),t.bIt("ngModelChange",function(){return c.eBV(s),o.updateIdFilter(),c.Njj(o.filterChanged())}),t.k0s()()}2&n&&(t.R7$(3),t.R50("ngModel",o.filter),t.R7$(5),t.R50("ngModel",o.idFilterString))},dependencies:[d.YN,d.me,d.BC,d.vS,D.Wk,O.M,G.j,G.M,j.fS,j.fg],styles:["[_nghost-%COMP%]{display:block;padding:16px 12px 2px}.mat-mdc-form-field[_ngcontent-%COMP%]{display:block;width:175px}"]})}return a})();var st=i(60251),lt=i(38172),rt=i(34575),V=i(34601),dt=i(95699),U=i(1726),A=i(43216),ct=i(34435),$=i(70334),pt=i(67037),mt=i(69914),ut=i(60852),ht=i(96817),ft=i(39431),gt=i(67993),w=i(89061),S=i(31034),z=i(29968);function _t(a,m){if(1&a){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){c.eBV(e);const o=t.XpG();return c.Njj(o.do("delete"))}),t.j41(1,"mat-icon"),t.EFF(2,"delete"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Delete"),t.k0s()()}if(2&a){const e=t.XpG();t.Y8G("disabled",e.item._EditInfo.DisableDelete)}}let Ct=(()=>{class a{agInit(e){this.params=e,this.item=e.data}refresh(e){return!0}do(e){this.params.do(e,this.item)}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-data-bundle-actions"]],decls:13,vars:2,consts:[["menu","matMenu"],[1,"actions-component"],["matRipple","","tippy","Clone",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","Export",1,"eav-grid-action-button","highlight",3,"click"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["matMenuContent",""],["mat-menu-item","",3,"click","disabled"]],template:function(n,o){if(1&n){const s=t.RV6();t.j41(0,"div",1)(1,"a",2)(2,"mat-icon"),t.EFF(3,"file_copy"),t.k0s()(),t.j41(4,"div",3),t.bIt("click",function(){return c.eBV(s),c.Njj(o.do("export"))}),t.j41(5,"mat-icon"),t.EFF(6,"cloud_download"),t.k0s()(),t.j41(7,"div",4)(8,"mat-icon"),t.EFF(9,"more_horiz"),t.k0s()()(),t.j41(10,"mat-menu",5,0),t.DNE(12,_t,5,1,"ng-template",6),t.k0s()}if(2&n){const s=t.sdS(11);t.R7$(),t.Y8G("href",o.params.urlTo("clone",o.item),t.B4B),t.R7$(6),t.Y8G("matMenuTriggerFor",s)}},dependencies:[w.M,z.M,r.m_,r.An,S.Cn,S.kk,S.fb,S.z8,S.Cp,V.e],encapsulation:2})}return a})();function yt(a,m){if(1&a&&(t.j41(0,"span",1),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.R7$(),t.JRh(e.entities)}}let vt=(()=>{class a{agInit(e){Array.isArray(e.value)&&(this.encodedValue=this.htmlEncode(e.value.join(", ")),e.colDef.allowMultiValue&&(this.entities=e.value.length))}refresh(e){return!0}htmlEncode(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-content-items-entity"]],decls:3,vars:3,consts:[[3,"tippy"],[1,"more-entities"]],template:function(n,o){1&n&&(t.j41(0,"div",0),t.nVh(1,yt,2,1,"span",1),t.EFF(2),t.k0s()),2&n&&(t.Y8G("tippy",o.encodedValue),t.R7$(),t.vxM(o.entities?1:-1),t.R7$(),t.SpI(" ",o.encodedValue,"\n"))},dependencies:[V.e],styles:[".more-entities[_ngcontent-%COMP%]{padding:0 8px;border-radius:10px;border:1px solid rgba(29,39,61,.44);-webkit-user-select:none;user-select:none}"]})}return a})();var N=i(87945),Z=i(16256);const Tt=a=>({"hide-until-row-hover":a});function Mt(a,m){if(1&a&&(t.j41(0,"a",2)(1,"mat-icon",4),t.EFF(2),t.k0s()()),2&a){const e=t.XpG();t.Y8G("tippy",e.metadataTooltip)("href",e.params.urlTo("openMetadata",e.item),t.B4B)("ngClass",t.eq3(6,Tt,!e.metadataCount&&!e.value.metadata)),t.R7$(),t.Y8G("matBadge",e.metadataCount)("matBadgeHidden",!e.metadataCount),t.R7$(),t.SpI("",e.value.metadata?"loyalty":"local_offer"," ")}}function Dt(a,m){if(1&a&&(t.j41(0,"div",3)(1,"mat-icon",5),t.EFF(2),t.k0s()()),2&a){const e=t.XpG();t.R7$(),t.Y8G("matBadge",e.metadataCount)("matBadgeHidden",!e.metadataCount),t.R7$(),t.SpI("",e.value.metadata?"loyalty":"local_offer"," ")}}let Ft=(()=>{class a{agInit(e){this.params=e,this.value=e.value,this.item=e.data,this.disableMetadata=this.item._EditInfo.DisableMetadata,this.metadataCount=this.item.Metadata?.length??0;const n=this.item.For;this.metadataTooltip=n?`This item is metadata for:\nTarget: ${n.Target}\nTargetType: ${n.TargetType}`+(n.KeyNumber?`\nNumber: ${n.KeyNumber}`:"")+(n.KeyString?`\nString: ${n.KeyString}`:"")+(n.KeyGuid?`\nGuid: ${n.KeyGuid}`:"")+(n.Title?`\nTitle: ${n.Title}`:""):"This item is not metadata.",this.metadataTooltip+=`\n\nThis item has ${this.metadataCount>0?this.metadataCount:"no"} other metadata ${1===this.metadataCount?"item":"items"} attached to it.`}refresh(e){return!0}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-content-items-status"]],decls:6,vars:3,consts:[[1,"actions-component"],[1,"eav-grid-action-button","icon",3,"tippy"],["matRipple","",1,"eav-grid-action-button","default-link","highlight",3,"tippy","href","ngClass"],[1,"eav-grid-action-button","disabled"],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"],["matBadgeColor","accent","matBadgeSize","small","matBadgeDisabled","true","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"mat-icon"),t.EFF(3),t.k0s()(),t.nVh(4,Mt,3,8,"a",2)(5,Dt,3,3,"div",3),t.k0s()),2&n&&(t.R7$(),t.Y8G("tippy",o.value.published?"Published":"Not published"),t.R7$(2),t.JRh(o.value.published?"visibility":"visibility_off"),t.R7$(),t.vxM(o.disableMetadata?o.disableMetadata&&(o.metadataCount||o.value.metadata)?5:-1:4))},dependencies:[r.m_,r.An,w.M,z.M,N.YU,Z.Y,Z.k,V.e],styles:[".hide-until-row-hover[_ngcontent-%COMP%]{visibility:hidden}  .ag-row-hover .hide-until-row-hover{visibility:visible}"]})}return a})();var Et=i(4038),bt=i(31403),J=i(64043),Q=i(8827),B=i(75797),L=i(63037),K=i(91817),Pt=i(63617),q=i(70271),Y=i(19999),Rt=i(75445),tt=i(88857),xt=i(43176),Ot=i(43758),et=i(5858),P=i(50052),kt=i(39333),jt=i(48021),$t=i(93826),Gt=i(68873),nt=i(336),Bt=i(49417);function Vt(a){return m=>{if(!m.value)return null;const e=a.controls.keyType.value,n=m.value.toString();switch(e){case P.YX.keyTypes.number:return/^[0-9]+$/.test(n)?null:{patternWholeNumber:!0};case P.YX.keyTypes.guid:const s=["{","}"].some(E=>n.includes(E)),f=n.substring(s?1:0,s?n.length-1:n.length);return(0,Bt.L)().test(f)?null:{patternGuid:!0};default:return null}}}var At=i(23731),at=i(88622);const ot=a=>({active:a});function St(a,m){if(1&a&&(t.j41(0,"mat-option",12),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.targetType),t.R7$(),t.SpI(" ",e.label," ")}}function Ut(a,m){if(1&a&&(t.j41(0,"mat-option",12),t.EFF(1),t.k0s()),2&a){const e=t.XpG(2);t.Y8G("value",e.formValues.targetType),t.R7$(),t.SpI(" ",e.formValues.targetType," ")}}function Nt(a,m){if(1&a&&(t.j41(0,"mat-select",8),t.Z7z(1,St,2,2,"mat-option",12,t.fX1),t.nVh(3,Ut,2,2,"mat-option",12),t.k0s()),2&a){const e=t.XpG(),n=t.XpG();t.R7$(),t.Dyx(n.targetTypeOptions),t.R7$(2),t.vxM(e.unknownTargetType?3:-1)}}function Kt(a,m){1&a&&t.nrm(0,"input",9)}function Yt(a,m){1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1," Warning: you entered an unknown target type. This may work or may not. Please be sure you know what you're doing "),t.k0s()),2&a&&t.Y8G("isError",!1)}function Xt(a,m){if(1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.Y8G("isError",!1),t.R7$(),t.JRh(e.targetTypeHint)}}function Lt(a,m){1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function Wt(a,m){1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1," Must be a whole number "),t.k0s()),2&a&&t.Y8G("isError",!0)}function Ht(a,m){if(1&a&&(t.j41(0,"mat-option",12),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function wt(a,m){1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function zt(a,m){if(1&a&&(t.j41(0,"mat-option",12),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.NameId),t.R7$(),t.SpI(" ",e.Label," ")}}function Zt(a,m){if(1&a&&(t.j41(0,"mat-form-field",7)(1,"mat-label"),t.EFF(2,"Content Type"),t.k0s(),t.j41(3,"mat-select",19),t.Z7z(4,zt,2,2,"mat-option",12,t.fX1),t.k0s()()),2&a){const e=t.XpG();t.R7$(3),t.Y8G("placeholder",e.contentTypes.length?"":"No items found"),t.R7$(),t.Dyx(e.contentTypes)}}function Jt(a,m){if(1&a&&(t.j41(0,"mat-option",12),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",e.name," ")}}function Qt(a,m){if(1&a&&(t.j41(0,"mat-form-field",7)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",20),t.Z7z(4,Jt,2,2,"mat-option",12,t.fX1),t.j41(6,"mat-option",12),t.EFF(7,"Other..."),t.k0s()()()),2&a){const e=t.XpG(),n=t.XpG();t.R7$(3),t.Y8G("placeholder",e.scopeOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.scopeOptions),t.R7$(2),t.Y8G("value",n.dropdownInsertValue)}}function qt(a,m){if(1&a&&(t.j41(0,"mat-option",12),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.Guid),t.R7$(),t.Lme(" ",e.Title," (",e.Id,") ")}}function te(a,m){if(1&a&&(t.j41(0,"mat-select",21),t.Z7z(1,qt,2,3,"mat-option",12,t.fX1),t.k0s()),2&a){const e=t.XpG(3);t.Y8G("placeholder",e.contentItems.length?"":"No items found"),t.R7$(),t.Dyx(e.contentItems)}}function ee(a,m){1&a&&t.nrm(0,"input",22)}function ne(a,m){if(1&a&&t.nVh(0,te,3,1,"mat-select",21)(1,ee,1,0,"input",22),2&a){const e=t.XpG(2);t.vxM(e.guidedKey?0:1)}}function ae(a,m){if(1&a&&(t.j41(0,"mat-option",12),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.NameId),t.R7$(),t.SpI(" ",e.Label," ")}}function oe(a,m){if(1&a&&(t.j41(0,"mat-select",21),t.Z7z(1,ae,2,2,"mat-option",12,t.fX1),t.k0s()),2&a){const e=t.XpG(3);t.Y8G("placeholder",e.contentTypes.length?"":"No items found"),t.R7$(),t.Dyx(e.contentTypes)}}function ie(a,m){1&a&&t.nrm(0,"input",22)}function se(a,m){if(1&a&&t.nVh(0,oe,3,1,"mat-select",21)(1,ie,1,0,"input",22),2&a){const e=t.XpG(2);t.vxM(e.guidedKey?0:1)}}function le(a,m){1&a&&t.eu8(0)}function re(a,m){if(1&a&&t.DNE(0,le,1,0,"ng-container",23),2&a){t.XpG(2);const e=t.sdS(39);t.Y8G("ngTemplateOutlet",e)}}function de(a,m){if(1&a&&t.nVh(0,ne,2,1)(1,se,2,1)(2,re,1,1,"ng-container"),2&a){let e;const n=t.XpG(),o=t.XpG();t.vxM((e=n.formValues.targetType)===o.eavConstants.metadata.entity.targetType?0:e===o.eavConstants.metadata.contentType.targetType?1:2)}}function ce(a,m){1&a&&t.nrm(0,"input",22)}function pe(a,m){1&a&&t.nrm(0,"input",24)}function me(a,m){if(1&a&&(t.nVh(0,ce,1,0,"input",22),t.nVh(1,pe,1,0,"input",24)),2&a){const e=t.XpG(),n=t.XpG();t.vxM(e.formValues.keyType!==n.eavConstants.keyTypes.number?0:-1),t.R7$(),t.vxM(e.formValues.keyType===n.eavConstants.keyTypes.number?1:-1)}}function ue(a,m){1&a&&t.nrm(0,"input",22)}function he(a,m){1&a&&t.nrm(0,"input",24)}function fe(a,m){if(1&a&&(t.nVh(0,ue,1,0,"input",22),t.nVh(1,he,1,0,"input",24)),2&a){const e=t.XpG(),n=t.XpG();t.vxM(e.formValues.keyType!==n.eavConstants.keyTypes.number?0:-1),t.R7$(),t.vxM(e.formValues.keyType===n.eavConstants.keyTypes.number?1:-1)}}function ge(a,m){if(1&a){const e=t.RV6();t.j41(0,"div",14)(1,"button",25),t.bIt("click",function(){c.eBV(e);const o=t.XpG(2);return c.Njj(o.toggleGuidedKey(!0))}),t.j41(2,"mat-icon",26),t.EFF(3,"search"),t.k0s()(),t.j41(4,"button",27),t.bIt("click",function(){c.eBV(e);const o=t.XpG(2);return c.Njj(o.toggleGuidedKey(!1))}),t.j41(5,"mat-icon",26),t.EFF(6,"text_fields"),t.k0s()()()}if(2&a){const e=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(2,ot,e.guidedKey)),t.R7$(3),t.Y8G("ngClass",t.eq3(4,ot,!e.guidedKey))}}function _e(a,m){1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function Ce(a,m){1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1," Must be a whole number "),t.k0s()),2&a&&t.Y8G("isError",!0)}function ye(a,m){1&a&&(t.j41(0,"app-field-hint",10),t.EFF(1," Must be a valid GUID "),t.k0s()),2&a&&t.Y8G("isError",!0)}function ve(a,m){if(1&a){const e=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3),t.EFF(3,"Create Metadata"),t.k0s()(),t.j41(4,"div",4)(5,"p"),t.EFF(6," This is a special operation to add an item which is metadata for another item, see "),t.j41(7,"a",5),t.EFF(8,"docs"),t.k0s(),t.EFF(9,". "),t.k0s(),t.j41(10,"form",6)(11,"mat-form-field",7)(12,"mat-label"),t.EFF(13,"Target"),t.k0s(),t.nVh(14,Nt,4,1,"mat-select",8),t.nVh(15,Kt,1,0,"input",9),t.k0s(),t.nVh(16,Yt,2,1,"app-field-hint",10),t.nVh(17,Xt,2,2,"app-field-hint",10),t.nVh(18,Lt,2,1,"app-field-hint",10),t.nVh(19,Wt,2,1,"app-field-hint",10),t.j41(20,"mat-form-field",7)(21,"mat-label"),t.EFF(22,"Key type"),t.k0s(),t.j41(23,"mat-select",11),t.Z7z(24,Ht,2,2,"mat-option",12,t.fX1),t.k0s()(),t.nVh(26,wt,2,1,"app-field-hint",10),t.nVh(27,Zt,6,1,"mat-form-field",7),t.nVh(28,Qt,8,2,"mat-form-field",7),t.j41(29,"app-field-hint"),t.EFF(30," The scope should almost never be changed - "),t.j41(31,"a",13),t.EFF(32,"see help"),t.k0s()(),t.j41(33,"mat-form-field",7)(34,"mat-label"),t.EFF(35,"Key"),t.k0s(),t.nVh(36,de,3,1)(37,me,2,2),t.DNE(38,fe,2,2,"ng-template",null,0,t.C5r),t.nVh(40,ge,7,6,"div",14),t.k0s(),t.nVh(41,_e,2,1,"app-field-hint",10),t.nVh(42,Ce,2,1,"app-field-hint",10),t.nVh(43,ye,2,1,"app-field-hint",10),t.k0s()(),t.j41(44,"mat-dialog-actions",15)(45,"mat-slide-toggle",16),t.bIt("change",function(o){c.eBV(e);const s=t.XpG();return c.Njj(s.toggleGuidedMode(o))}),t.EFF(46),t.k0s(),t.j41(47,"div")(48,"button",17),t.bIt("click",function(){c.eBV(e);const o=t.XpG();return c.Njj(o.closeDialog())}),t.EFF(49,"Cancel"),t.k0s(),t.j41(50,"button",18),t.bIt("click",function(){c.eBV(e);const o=t.XpG();return c.Njj(o.confirm())}),t.EFF(51,"Confirm"),t.k0s()()()()}if(2&a){const e=m,n=t.XpG();t.R7$(10),t.Y8G("formGroup",n.form),t.R7$(4),t.vxM(e.guidedMode?14:-1),t.R7$(),t.vxM(e.guidedMode?-1:15),t.R7$(),t.vxM(n.form.controls.targetType.touched&&!n.form.controls.targetType.invalid&&e.unknownTargetType?16:-1),t.R7$(),t.vxM(e.targetTypeHint?17:-1),t.R7$(),t.vxM(n.form.controls.targetType.touched&&null!=n.form.controls.targetType.errors&&n.form.controls.targetType.errors.required?18:-1),t.R7$(),t.vxM(n.form.controls.targetType.touched&&null!=n.form.controls.targetType.errors&&n.form.controls.targetType.errors.pattern?19:-1),t.R7$(5),t.Dyx(e.keyTypeOptions),t.R7$(2),t.vxM(n.form.controls.keyType.touched&&null!=n.form.controls.keyType.errors&&n.form.controls.keyType.errors.required?26:-1),t.R7$(),t.vxM(e.guidedMode&&e.formValues.targetType===n.eavConstants.metadata.entity.targetType?27:-1),t.R7$(),t.vxM(!e.guidedMode||e.formValues.targetType!==n.eavConstants.metadata.entity.targetType&&e.formValues.targetType!==n.eavConstants.metadata.contentType.targetType?-1:28),t.R7$(8),t.vxM(e.guidedMode?36:37),t.R7$(4),t.vxM(e.guidedMode&&e.guidedKeyExists?40:-1),t.R7$(),t.vxM(n.form.controls.key.touched&&null!=n.form.controls.key.errors&&n.form.controls.key.errors.required?41:-1),t.R7$(),t.vxM(n.form.controls.key.touched&&null!=n.form.controls.key.errors&&n.form.controls.key.errors.patternWholeNumber?42:-1),t.R7$(),t.vxM(n.form.controls.key.touched&&null!=n.form.controls.key.errors&&n.form.controls.key.errors.patternGuid?43:-1),t.R7$(2),t.Y8G("tippy",e.guidedMode?"Guided mode helps you select options that work":"Manual mode is for advanced uses and allows you to insert any values")("checked",e.guidedMode),t.R7$(),t.SpI(" ",e.guidedMode?"Guided":"Manual"," "),t.R7$(4),t.Y8G("disabled",!n.form.valid)}}let Te=(()=>{class a extends xt.${constructor(e,n){super(),this.dialog=e,this.context=n,this.hostClass="dialog-component",this.eavConstants=P.YX,this.dropdownInsertValue=et.O,this.contentItemsService=(0,C.d)(nt.F),this.contentTypesService=(0,C.d)(Rt.gs)}ngOnInit(){this.targetTypeOptions=Object.values(P.YX.metadata).map(n=>({...n})),this.keyTypeOptions=Object.values(P.YX.keyTypes),this.keyTypeOptions$=new B.t([]),this.scopeOptions$=new B.t([]),this.guidedMode$=new B.t(!0),this.contentItems$=new B.t([]),this.contentTypes$=new B.t([]),this.guidedKey$=new B.t(!0),this.fetchScopes(),this.form=new d.J3({}),this.form.addControl("targetType",new d.hs(P.YX.metadata.entity.targetType,[d.k0.required,d.k0.pattern(/^[0-9]+$/)])),this.form.addControl("keyType",new d.hs(P.YX.metadata.entity.keyType,[d.k0.required])),this.form.addControl("contentTypeForContentItems",new d.hs(null)),this.form.addControl("scopeForContentTypes",new d.hs(P.YX.scopes.default.value)),this.form.addControl("key",new d.hs(null,[d.k0.required,Vt(this.form)])),this.subscriptions.add(this.form.controls.scopeForContentTypes.valueChanges.pipe((0,L.Z)(this.form.controls.scopeForContentTypes.value),(0,K.F)()).subscribe(n=>{null!=this.form.controls.contentTypeForContentItems.value&&this.form.controls.contentTypeForContentItems.patchValue(null),n===et.O?(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||P.YX.scopes.default.value,this.scopeOptions$.value.some(o=>o.value===n)||this.scopeOptions$.next([{name:n,value:n},...this.scopeOptions$.value]),this.form.controls.scopeForContentTypes.patchValue(n)):this.fetchContentTypes(n)})),this.subscriptions.add((0,Pt.h)(this.form.controls.targetType.valueChanges.pipe((0,K.F)()),this.form.controls.keyType.valueChanges.pipe((0,K.F)())).subscribe(()=>{this.guidedKey$.next(!0),null!=this.form.getRawValue().key&&this.form.patchValue({key:null})})),this.subscriptions.add(this.form.controls.contentTypeForContentItems.valueChanges.pipe((0,L.Z)(this.form.controls.contentTypeForContentItems.value),(0,K.F)()).subscribe(n=>{const o=this.form.getRawValue();o.targetType===P.YX.metadata.entity.targetType&&null!=o.key&&this.form.patchValue({key:null}),this.contentItemsService.getAllPromise(n).then(s=>{this.contentItems$.next(s)})}));const e=this.form.valueChanges.pipe((0,L.Z)(this.form.getRawValue()),(0,q.T)(()=>this.form.getRawValue()),(0,jt.A)(n=>n));this.subscriptions.add((0,Y.z)([e,this.guidedMode$]).subscribe(([n,o])=>{const s=this.targetTypeOptions.find(X=>X.targetType===n.targetType),f=o&&s?[s.keyType]:[...this.keyTypeOptions];$t.a.arraysEqual(f,this.keyTypeOptions$.value)||this.keyTypeOptions$.next(f);const h={};this.keyTypeOptions$.value.includes(n.keyType)||(h.keyType=this.keyTypeOptions$.value[0]);const E=o&&n.targetType===P.YX.metadata.app.targetType;E&&n.key!==this.context.appId&&(h.key=this.context.appId),Object.keys(h).length&&this.form.patchValue(h),tt.a.disable(this.form.controls.keyType,o&&this.keyTypeOptions$.value.length<=1),tt.a.disable(this.form.controls.key,E)})),this.viewModel$=(0,Y.z)([(0,Y.z)([this.guidedMode$,this.keyTypeOptions$,this.scopeOptions$,this.contentItems$,this.contentTypes$]),(0,Y.z)([e,this.guidedKey$])]).pipe((0,q.T)(([[n,o,s,f,h],[E,k]])=>({guidedMode:n,unknownTargetType:!this.targetTypeOptions.some(W=>W.targetType===E.targetType),targetTypeHint:n&&this.targetTypeOptions.find(W=>W.targetType===E.targetType)?.hint,keyTypeOptions:o,scopeOptions:s,guidedKey:k,guidedKeyExists:[P.YX.metadata.entity.targetType,P.YX.metadata.contentType.targetType].includes(E.targetType),formValues:E,contentItems:f,contentTypes:h})))}ngOnDestroy(){this.guidedMode$.complete(),this.keyTypeOptions$.complete(),this.contentItems$.complete(),this.contentTypes$.complete(),this.guidedKey$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialog.close(e)}toggleGuidedKey(e){this.guidedKey$.next(e)}toggleGuidedMode(e){this.guidedMode$.next(e.checked)}confirm(){const e=this.form.getRawValue(),n={target:this.targetTypeOptions.find(o=>o.targetType===e.targetType)?.target,targetType:e.targetType,keyType:e.keyType,key:e.keyType===P.YX.keyTypes.guid?e.key.replace(/{|}/g,""):e.key.toString()};this.closeDialog(n)}fetchContentTypes(e){this.contentTypesService.retrieveContentTypesPromise(e).then(n=>{this.contentTypes$.next(n)})}fetchScopes(){this.contentTypesService.getScopesPromise().then(e=>{this.scopeOptions$.next(e)})}static#t=this.\u0275fac=function(n){return new(n||a)(t.rXU(l.k),t.rXU(Gt.o))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-create-metadata-dialog"]],hostVars:1,hostBindings:function(n,o){2&n&&t.Avn("className",o.hostClass)},features:[t.Vt3],decls:2,vars:3,consts:[["defaultKeyInput",""],[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-content"],["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",2,"width","100%","margin-bottom","8px"],["formControlName","targetType","required",""],["matInput","","type","number","min","0","formControlName","targetType","required",""],[3,"isError"],["formControlName","keyType","required",""],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["matTextSuffix","",1,"eav-selection-suffix"],[1,"eav-dialog-actions"],["color","accent",3,"change","tippy","checked"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],["formControlName","contentTypeForContentItems",3,"placeholder"],["formControlName","scopeForContentTypes",3,"placeholder"],["formControlName","key","required","",3,"placeholder"],["matInput","","type","text","formControlName","key","required",""],[4,"ngTemplateOutlet"],["matInput","","type","number","formControlName","key","required",""],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"click","ngClass"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"click","ngClass"]],template:function(n,o){if(1&n&&(t.nVh(0,ve,52,19,"div",1),t.nI1(1,"async")),2&n){let s;t.vxM((s=t.bMT(1,1,o.viewModel$))?0:-1,s)}},dependencies:[d.YN,d.qT,d.me,d.Q0,d.BC,d.cb,d.YS,d.VZ,d.X1,d.j4,d.JD,O.M,G.j,G.M,G.g,J.M,J.g,At.M,bt.M,j.fS,j.fg,N.T3,g.Hl,g.$z,at.M,N.YU,r.m_,r.An,l.M,Q.mV,Q.sG,N.Jj,Ot.F,kt.c,V.e],encapsulation:2})}return a})(),Me=(()=>{class a{constructor(){this.published="",this.metadata="",this.hasMetadata=""}agInit(e){this.filterParams=e}isFilterActive(){return""!==this.published||""!==this.metadata||""!==this.hasMetadata}doesFilterPass(e){let n=!1,o=!1,s=!1;const h=this.filterParams.valueGetter({api:this.filterParams.api,colDef:this.filterParams.colDef,column:this.filterParams.column,columnApi:this.filterParams.columnApi,context:this.filterParams.context,data:e.node.data,getValue:E=>e.node.data[E],node:e.node});return n=""===this.published||null!=h.published&&h.published.toString()===this.published,o=""===this.metadata||null!=h.metadata&&h.metadata.toString()===this.metadata,s=""===this.hasMetadata||null!=h.hasMetadata&&h.hasMetadata.toString()===this.hasMetadata,n&&o&&s}getModel(){return this.isFilterActive()?{filterType:"pub-meta",published:this.published,metadata:this.metadata,hasMetadata:this.hasMetadata}:void 0}setModel(e){this.published=e?e.published:"",this.metadata=e?e.metadata:"",this.hasMetadata=e?e.hasMetadata:""}afterGuiAttached(e){}filterChanged(){this.filterParams.filterChangedCallback()}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-pub-meta-filter"]],decls:27,vars:3,consts:[[1,"title"],[3,"ngModelChange","ngModel"],["value",""],["value","true"],["value","false"]],template:function(n,o){1&n&&(t.j41(0,"div",0),t.EFF(1,"Published"),t.k0s(),t.j41(2,"mat-radio-group",1),t.mxI("ngModelChange",function(f){return t.DH7(o.published,f)||(o.published=f),f}),t.bIt("ngModelChange",function(){return o.filterChanged()}),t.j41(3,"mat-radio-button",2),t.EFF(4,"All"),t.k0s(),t.j41(5,"mat-radio-button",3),t.EFF(6,"Published"),t.k0s(),t.j41(7,"mat-radio-button",4),t.EFF(8,"Not published"),t.k0s()(),t.j41(9,"div",0),t.EFF(10,"Is Metadata"),t.k0s(),t.j41(11,"mat-radio-group",1),t.mxI("ngModelChange",function(f){return t.DH7(o.metadata,f)||(o.metadata=f),f}),t.bIt("ngModelChange",function(){return o.filterChanged()}),t.j41(12,"mat-radio-button",2),t.EFF(13,"All"),t.k0s(),t.j41(14,"mat-radio-button",3),t.EFF(15,"Is metadata"),t.k0s(),t.j41(16,"mat-radio-button",4),t.EFF(17,"Is not metadata"),t.k0s()(),t.j41(18,"div",0),t.EFF(19,"Has Metadata"),t.k0s(),t.j41(20,"mat-radio-group",1),t.mxI("ngModelChange",function(f){return t.DH7(o.hasMetadata,f)||(o.hasMetadata=f),f}),t.bIt("ngModelChange",function(){return o.filterChanged()}),t.j41(21,"mat-radio-button",2),t.EFF(22,"All"),t.k0s(),t.j41(23,"mat-radio-button",3),t.EFF(24,"Has metadata"),t.k0s(),t.j41(25,"mat-radio-button",4),t.EFF(26,"Has no metadata"),t.k0s()()),2&n&&(t.R7$(2),t.R50("ngModel",o.published),t.R7$(9),t.R50("ngModel",o.metadata),t.R7$(9),t.R50("ngModel",o.hasMetadata))},dependencies:[D.Wk,D.VT,D._g,d.YN,d.BC,d.vS],styles:[".title[_ngcontent-%COMP%]{padding:12px 12px 0}.mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;overflow:hidden;padding:12px;width:160px;height:104px}"]})}return a})();var De=i(37580),Fe=i(3347),Ee=i(29841);function Ie(a,m){1&a&&(t.nrm(0,"div",6),t.nI1(1,"safeHtml")),2&a&&t.Y8G("innerHTML",t.bMT(1,1,m),t.npT)}function be(a,m){if(1&a){const e=t.RV6();t.j41(0,"ag-grid-angular",17),t.bIt("gridReady",function(o){c.eBV(e);const s=t.XpG();return c.Njj(s.onGridReady(o))})("filesDropped",function(o){c.eBV(e);const s=t.XpG();return c.Njj(s.filesDropped(o))}),t.k0s()}if(2&a){const e=t.XpG();t.Y8G("rowData",e.items())("gridOptions",e.gridOptions)("allowedFileTypes","xml,json")}}function Pe(a,m){if(1&a){const e=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){c.eBV(e);const o=t.XpG();return c.Njj(o.debugFilter())}),t.j41(1,"mat-icon",11),t.EFF(2,"filter_list"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Filter"),t.k0s()()}}const Re={all:!1,items:!0};let xe=(()=>{class a{#t;#e;#s;#d;#a;constructor(e,n,o,s,f){this.dialog=e,this.snackBar=n,this.matDialog=o,this.viewContainerRef=s,this.changeDetectorRef=f,this.log=(0,ct.Tq)({ContentItemsComponent:a},Re),this.isDebug=(0,c.WQX)(ft.B).isDebug,this.#t=(0,C.d)(ht.R),this.#e=(0,C.d)(_.D),this.#s=(0,C.d)(nt.F),this.#d=(0,C.d)(M.g),this.#a=(0,C.d)(ut.c),this.gridOptions={...st.C,onFilterChanged:h=>this.#l.update(E=>E+1)},this.#l=(0,c.vPA)(0),this.refresh=(0,c.vPA)(0),this.#r={empty:{description:"<p><b>This is where you manage data items</b></p>",hint:"<p>Click the (+) in the bottom right corner to create your first item (think: record / entity).</p>"},content:{description:"<p><b>Each row shows a data item</b> <br>They contain the data, similar to a database row.</p>",hint:"<p>Click on the title to edit. <br>You can also do much more - best hover over the row and icons to discover the possibilities. <br><br>You can also do data import/export (one or many), copy items, and do advanced stuff like assigning metadata.</p>"}},this.uxHelpText=(0,v.EW)(()=>0===this.items()?.length?this.#r.empty:this.#r.content),this.#o=(0,c.vPA)(null),this.#n=this.#a.getParam("contentTypeStaticName"),this.contentType=this.#d.getType(this.#n).value,this.#c=this.#s.getAllLive(this.#n,this.refresh).value,this.items=(0,v.EW)(()=>{const h=this.#c();return this.log.aIf("items",{data:h}),h}),this.urlToExportContent=(0,gt.bo)("urlToExportContent",()=>{const h=this.#o();if(!h)return"";this.#l();const E=Object.keys(h.getFilterModel()).length>0,k=[];return E&&h.forEachNodeAfterFilterAndSort(X=>k.push(X.data.Id)),this.#i(`export/${this.#n}${k.length>0?`/${k.join(",")}`:""}`)})}#l;#r;#o;#n;#c;ngOnInit(){this.urlToExportContent(),this.#a.doOnDialogClosed(()=>this.fetchItems())}closeDialog(){this.dialog.close()}onGridReady(e){this.#o.set(e.api),this.fetchColumns(),this.urlToExportContent()}fetchItems(){this.refresh.update(e=>++e)}fetchColumns(){this.#s.getColumnsPromise(this.#n).then(e=>{const n=e.filter(f=>!f.IsEphemeral),o=this.#h(n),s=function It(a,m){if(!a)return;let e;"="===a.charAt(a.length-1)&&(a=atob(a));try{e=JSON.parse(a)}catch{console.error("Can't parse JSON with filters from url:",a)}if(!e)return;const n={};return(e.IsPublished||e.IsMetadata)&&(n.Status={filterType:"pub-meta",published:e.IsPublished??"",metadata:e.IsMetadata??"",hasMetadata:""}),Object.entries(e).filter(([o,s])=>"IsPublished"!==o&&"IsMetadata"!==o).forEach(([o,s])=>{if(m.find(h=>h.headerName===o)?.filter!==H){if("string"==typeof s)n[o]={filterType:"text",type:"equals",filter:s};else if("number"==typeof s)n[o]={filterType:"number",type:"equals",filter:s,filterTo:null};else if("boolean"==typeof s){const h={filterType:"boolean",filter:s.toString()};n[o]=h}}else{const h={filterType:"entity",filter:"string"==typeof(s=Et.i.tryParse(s)??s)?s:void 0,idFilter:"number"==typeof s?[s]:Array.isArray(s)?s.filter(E=>"number"==typeof E):void 0};n[o]=h}}),n}(sessionStorage.getItem(lt.bo),o);this.#o()&&this.setColumnDefs(o,s)})}setColumnDefs(e,n){this.#o().setColumnDefs(e),n&&(this.log.a("Will try to apply filter:",n),this.#o().setFilterModel(n))}#i(e){return"#"+this.#a.urlSubRoute(e)}#m(e){return this.#a.urlSubRoute(I.H.getUrlEntity(e.Guid,`Metadata for Entity: ${e._Title} (${e.Id})`,this.#n))}editItem(e){const n={items:[null==e?$.c.newFromType(this.#n):$.c.editId(e.Id)]},o=(0,A.s)(n);this.#a.navRelative([`edit/${o}`])}#u(e){return this.#i(`edit/${(0,A.s)({items:[null==e?$.c.newFromType(this.#n):$.c.editId(e.Id)]})}`)}urlToNewItem(e){return this.#i(`edit/${(0,A.s)({items:[null==e?$.c.newFromType(this.#n):$.c.editId(e.Id)]})}`)}filesDropped(e){const n=e[0];switch(n.name.substring(n.name.lastIndexOf(".")+1).toLocaleLowerCase()){case"xml":this.urlToImportContent(e);break;case"json":this.importItem(e)}}urlToImportContent(e){return this.#i(`${this.#n}${e?`/${e.map(n=>n.name).join(",")}`:""}/import`)}importItem(e){this.#a.navRelative(["import"],{state:{files:e}})}urlToImportItem(){return this.#i("import")}createMetadata(){this.matDialog.open(Te,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(n=>{if(null==n)return;const o={items:[$.c.newMetadataFromInfo(this.#n,n)]},s=(0,A.s)(o);this.#a.navRelative([`edit/${s}`]),this.changeDetectorRef.markForCheck()})}debugFilter(){console.warn("Current filter:",this.#o().getFilterModel()),this.snackBar.open("Check console for filter information",void 0,{duration:3e3})}#h(e){const n=[{...b.r.IdWithDefaultRenderer,cellClass:o=>("id-action no-padding no-outline "+(o.data._EditInfo.ReadOnly?"disabled":"")).split(" "),cellRendererParams:b.r.idFieldParamsTooltipGetter()},{field:"Status",width:82,headerClass:"dense",cellClass:"secondary-action no-padding".split(" "),filter:Me,valueGetter:o=>{const s=o.data;return{published:s.IsPublished,metadata:!!s.For,hasMetadata:!!s.Metadata&&s.Metadata.length>0}},cellRenderer:Ft,cellRendererParams:{urlTo:(o,s)=>"#"+this.#m(s)}},{...b.r.TextWidePrimary,headerName:"Item (Entity)",field:"_Title",flex:2,cellRenderer:o=>T.f.cellLink(this.#u(o.data),o.data._Title)},{headerName:"Stats",headerTooltip:"Used by others / uses others",field:"_Used",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:o=>`${o.data._Used} / ${o.data._Uses}`},{...b.r.ActionsPinnedRight3,cellRenderer:Ct,cellRendererParams:{urlTo:(s,f)=>"#"+this.#f(f),do:(s,f)=>{switch(s){case"export":this.#g(f);break;case"delete":this.#_(f)}}}}];for(const o of e){const s={headerName:o.StaticName,field:o.StaticName,flex:2,minWidth:250,cellClass:"no-outline",sortable:!0};switch(o.Type){case U.O.Entity:s.allowMultiValue=o.Metadata?.Entity?.AllowMultiValue??!0,s.cellRenderer=vt,s.valueGetter=this.valueGetterEntityField,s.filter=H;break;case U.O.DateTime:s.useTimePicker=o.Metadata?.DateTime?.UseTimePicker??!1,s.valueGetter=this.valueGetterDateTime,s.filter="agTextColumnFilter";break;case U.O.Boolean:s.valueGetter=this.valueGetterBoolean,s.filter=u.y;break;case U.O.Number:s.filter="agNumberColumnFilter";break;default:s.filter="agTextColumnFilter"}n.push(s)}return n}#f(e){return this.#a.urlSubRoute(`edit/${(0,A.s)({items:[$.c.copy(this.#n,e.Id)]})}`)}#g(e){this.#e.exportEntity(e.Id,this.#n,!0)}#_(e){this.snackBar.open("Deleting..."),this.#p(e,"Delete Item?",!1)}#p(e,n,o,s,f){this.matDialog.open(R.F,{autoFocus:!1,data:{entityId:e._RepositoryId,entityTitle:e._Title,message:n,title:s,confirmTranslateKey:f},viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(E=>{this.snackBar.dismiss(),E&&(this.snackBar.open("Deleting..."),this.#t.delete(this.#n,e._RepositoryId,o).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchItems()},error:k=>{o||(this.snackBar.dismiss(),this.#p(e,`${k.error.ExceptionMessage} \n\nDo you want to force delete`,!0,"Force Delete","Force"))}}))})}valueGetterEntityField(e){const n=e.data[e.colDef.field];return 0===n.length?null:n.map(o=>o.Title)}valueGetterDateTime(e){const n=e.data[e.colDef.field];return n?e.colDef.useTimePicker?n.replace("T"," ").replace("Z",""):n.split("T")[0]:null}valueGetterBoolean(e){const n=e.data[e.colDef.field];return"boolean"!=typeof n?null:n.toString()}static#C=this.\u0275fac=function(n){return new(n||a)(t.rXU(l.k),t.rXU(Fe.UG),t.rXU(l.h),t.rXU(t.c1b),t.rXU(De.gRc))};static#y=this.\u0275cmp=t.VBU({type:a,selectors:[["app-content-items"]],decls:38,vars:11,consts:[["appToggleDebug","",1,"eav-dialog","nav-component-wrapper"],[2,"height","100%",3,"helpText","refresh","rowLength"],["eav-dialog-header","",1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],["eav-dialog-content","",1,"eav-dialog-content"],[3,"innerHTML"],["appDragAndDrop","",1,"ag-theme-material","eav-dialog-content",3,"rowData","gridOptions","allowedFileTypes"],[1,"eav-dialog-actions"],[1,"eav-dialog-actions-div"],["mat-button","","tippy","Export xml list","tippyPlacement","top",1,"eav-button__with-icon",3,"href"],[1,"eav-icon"],["mat-button","","tippy","Import xml list","tippyPlacement","top",1,"eav-button__with-icon",3,"href"],["mat-button","","tippy","Import single json item","tippyPlacement","top",1,"eav-button__with-icon",3,"href"],["mat-button","","tippy","Create metadata","tippyPlacement","top",1,"eav-button__with-icon",3,"click"],["mat-button","","color","accent","tippy","Print filter to console","tippyPlacement","top",1,"eav-button__with-icon"],["mat-fab","","mat-elevation-z24","","tippy","Add item",1,"grid-fab",3,"href"],["appDragAndDrop","",1,"ag-theme-material","eav-dialog-content",3,"gridReady","filesDropped","rowData","gridOptions","allowedFileTypes"],["mat-button","","color","accent","tippy","Print filter to console","tippyPlacement","top",1,"eav-button__with-icon",3,"click"]],template:function(n,o){if(1&n&&(t.j41(0,"div",0)(1,"app-grid-with-help",1)(2,"div",2)(3,"div",3),t.EFF(4),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){return o.closeDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",5),t.nVh(9,Ie,2,3,"div",6),t.k0s(),t.nVh(10,be,1,3,"ag-grid-angular",7),t.j41(11,"mat-dialog-actions",8)(12,"div",9)(13,"a",10)(14,"mat-icon",11),t.EFF(15,"cloud_download"),t.k0s(),t.j41(16,"span"),t.EFF(17,"Data"),t.k0s()(),t.j41(18,"a",12)(19,"mat-icon",11),t.EFF(20,"cloud_upload"),t.k0s(),t.j41(21,"span"),t.EFF(22,"Data"),t.k0s()(),t.j41(23,"a",13)(24,"mat-icon",11),t.EFF(25,"cloud_upload"),t.k0s(),t.j41(26,"span"),t.EFF(27,"Item"),t.k0s()(),t.j41(28,"button",14),t.bIt("click",function(){return o.createMetadata()}),t.j41(29,"mat-icon",11),t.EFF(30,"local_offer"),t.k0s(),t.j41(31,"span"),t.EFF(32,"Create Metadata"),t.k0s()(),t.nVh(33,Pe,5,0,"button",15),t.k0s(),t.j41(34,"a",16)(35,"mat-icon"),t.EFF(36,"add"),t.k0s()()()()(),t.nrm(37,"router-outlet")),2&n){let s,f,h,E;t.R7$(),t.Y8G("helpText",o.uxHelpText())("refresh",o.refresh())("rowLength",null==(s=o.items())?null:s.length),t.R7$(3),t.SpI("",(null==(f=o.contentType())?null:f.Label)||(null==(f=o.contentType())?null:f.Name)," Data"),t.R7$(5),t.vxM((h=null==(h=o.contentType())||null==h.Properties?null:h.Properties.ListInstructions)?9:-1,h),t.R7$(),t.vxM((null==(E=o.items())?null:E.length)>0?10:-1),t.R7$(3),t.Y8G("href",o.urlToExportContent(),t.B4B),t.R7$(5),t.Y8G("href",o.urlToImportContent(),t.B4B),t.R7$(5),t.Y8G("href",o.urlToImportItem(),t.B4B),t.R7$(10),t.vxM(o.isDebug()?33:-1),t.R7$(),t.Y8G("href",o.urlToNewItem(),t.B4B)}},dependencies:[g.Hl,g.$z,at.M,g.Sr,r.m_,r.An,y.n3,l.M,mt.$,rt.S,dt.V,pt.p,Ee.xs,V.e,p.v],encapsulation:2})}return a})()},93826:(x,F,i)=>{i.d(F,{a:()=>c});class c{static boolEquals(g,l){return g===l}static stringEquals(g,l){return g===l}static valueEquals(g,l){return g===l}static objectsEqual(g,l){if(null==g||null==l)return g===l;const r=g,y=l,C=Object.keys(r),M=Object.keys(y);return C.length===M.length&&C.every(_=>!!y.hasOwnProperty(_)&&r[_]===y[_])}static arraysEqual(g,l){return null==g||null==l?g===l:g.length===l.length&&g.every((y,C)=>g[C]===l[C])}static distinct(g,l,r){return r.indexOf(g)===l}}},95699:(x,F,i)=>{i.d(F,{V:()=>g});var c=i(99293),v=i(39431);let g=(()=>{class l{constructor(y){this.globalConfigService=y}onClick(y){(navigator.platform.match("Mac")?y.metaKey:y.ctrlKey)&&y.shiftKey&&y.altKey&&(this.globalConfigService.toggleDebugEnabled(),window.getSelection().removeAllRanges())}static#t=this.\u0275fac=function(C){return new(C||l)(c.rXU(v.B))};static#e=this.\u0275dir=c.FsC({type:l,selectors:[["","appToggleDebug",""]],hostBindings:function(C,M){1&C&&c.bIt("click",function(_){return M.onClick(_)})}})}return l})()},96817:(x,F,i)=>{i.d(F,{R:()=>C});var c=i(47215),v=i(85837),g=i(9234),l=i(24467),r=i(99293),y=i(44444);let C=(()=>{class M extends l.B{create(_,I){return this.http.post(`app/auto/data/${_}`,I,{params:{appId:this.appId,zoneId:this.zoneId}})}update(_,I,T){return this.http.post(`app/auto/data/${_}/${I}`,T,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(_,I,T){return this.http.delete(this.apiUrl(g.gb+"delete"),{params:{contentType:_,id:I.toString(),appId:this.appId,force:T.toString()},context:(new c._y).set(v.g,[400])})}static#t=this.\u0275fac=(()=>{let _;return function(T){return(_||(_=r.xGo(M)))(T||M)}})();static#e=this.\u0275prov=y.jDH({token:M,factory:M.\u0275fac})}return M})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.04/dist/ng-edit/projects_eav-ui_src_app_content-items_content-items_component_ts.d1f7eb3d65fbb879.js.map