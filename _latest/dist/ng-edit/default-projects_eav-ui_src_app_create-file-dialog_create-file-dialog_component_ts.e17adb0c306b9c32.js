"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts"],{9996:(Y,j,i)=>{i.d(j,{F:()=>T});var d=i(271),D=i(6474),M=i(7580);const g="admin/AppFiles/asset";let T=(()=>{class F extends D.D{get(n,r,s){return this.http.get(this.apiUrl(g),{params:{appId:this.appId,global:r,...this.templateIdOrPath(n,r,s)}}).pipe((0,d.T)(h=>{if("auto"===h.Type.toLocaleLowerCase())switch(h.Extension.toLocaleLowerCase()){case".cs":case".cshtml":h.Type="Razor";break;case".html":case".css":case".js":h.Type="Token"}return h}))}save(n,r,s,h){return this.http.post(this.apiUrl(g),s,{params:{appId:this.appId,global:r,...this.templateIdOrPath(n,r,h)}})}getAll(n){return this.http.get(this.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.appId,...n&&{mask:n}}}).pipe((0,d.T)(({Files:r})=>(r.forEach(s=>{s.Shared??=!1}),r)))}getWebApis(){return this.http.get(this.apiUrl("admin/ApiExplorer/AppApiFiles"),{params:{appId:this.appId}}).pipe((0,d.T)(({files:n})=>(n.forEach(r=>{r.isShared??=!1,r.isCompiled??=!1}),n))).pipe((0,d.T)(n=>n.map(s=>{const h=s.path.lastIndexOf("/"),y=s.path.lastIndexOf("."),A=s.path.substring(0,h),S=s.path.substring(h+1,y);return{path:s.path,folder:A,name:S,isShared:s.isShared,endpointPath:s.endpointPath,isCompiled:s.isCompiled,edition:s.edition}})))}getWebApiDetails(n){return this.http.get(this.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.appId,zoneId:this.zoneId,path:n}})}getPredefinedTemplates(n,r){return this.http.get(this.apiUrl("admin/AppFiles/GetTemplates"),{params:{...n&&{purpose:n},...r&&{type:r}}})}getPreview(n,r,s){return this.http.get(this.apiUrl("admin/AppFiles/preview"),{params:{appId:this.appId,path:n,templateKey:s,global:r}})}create(n,r,s){return this.http.post(this.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.appId,global:r,purpose:"auto",path:n,templateKey:s}})}templateIdOrPath(n,r,s){if(/^[0-9]*$/g.test(n)){const h=s.find(y=>y.EntityId?.toString()===n&&y.IsShared===r)?.Path;return{templateId:n,...null!=h&&{path:h}}}return{path:n}}static#t=this.\u0275fac=(()=>{let n;return function(s){return(n||(n=M.xGo(F)))(s||F)}})();static#e=this.\u0275prov=M.jDH({token:F,factory:F.\u0275fac})}return F})()},4029:(Y,j,i)=>{i.d(j,{g:()=>nt});var d=i(4456),D=i(7941),M=i(5797),x=i(9999),g=i(3037),C=i(1817),P=i(271),$=i(8764),I=i(8473),R=i(819),T=i(1687),F=i(2645),n=i(4581);var s=i(6647),h=i(9452),y=i(1873),A=i(9996),S=i(3050),K=i(3176),G=i(316),U=i(4175),k=i(1134),V=i(7984),z=i(5060),X=i(5175),N=i(5944),J=i(3758),t=i(7580);let W=(()=>{class o{constructor(e,a){this.matInput=e,this.elementRef=a,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const a=e.toLocaleLowerCase();return"true"===a||"false"!==a&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(a){return new(a||o)(t.rXU(V.fg),t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"},standalone:!0})}return o})();var H=i(5437);const B=o=>({disabled:o});function Q(o,u){if(1&o&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&o){const e=u.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function _(o,u){if(1&o&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&o){const e=u.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function q(o,u){if(1&o&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&o){const e=u.$implicit;t.Y8G("value",e.Key),t.R7$(),t.SpI(" ",e.Name," ")}}function tt(o,u){1&o&&(t.j41(0,"app-field-hint",16),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function et(o,u){1&o&&t.nrm(0,"mat-spinner",21)(1,"div",22)}function at(o,u){if(1&o&&(t.j41(0,"div",23)(1,"label",24),t.EFF(2,"Preview"),t.k0s()(),t.j41(3,"pre",25),t.EFF(4),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(3,B,e.loadingPreview)),t.R7$(2),t.Y8G("ngClass",t.eq3(5,B,e.loadingPreview)),t.R7$(),t.JRh(e.preview)}}function ot(o,u){if(1&o&&(t.j41(0,"div",20),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.SpI(" ",e.previewError," ")}}function it(o,u){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),t.EFF(4,"Create"),t.k0s(),t.j41(5,"span",3),t.EFF(6),t.k0s()()(),t.j41(7,"div",4)(8,"form",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"mat-form-field",9)(13,"mat-label"),t.EFF(14,"Platform"),t.k0s(),t.j41(15,"mat-select",10),t.Z7z(16,Q,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),t.EFF(21,"Purpose"),t.k0s(),t.j41(22,"mat-select",12),t.Z7z(23,_,2,2,"mat-option",11,t.fX1),t.k0s()()()(),t.j41(25,"div",13)(26,"mat-form-field",9)(27,"mat-label"),t.EFF(28,"Template"),t.k0s(),t.j41(29,"mat-select",14),t.Z7z(30,q,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(32,"div",13)(33,"mat-form-field",9)(34,"mat-label"),t.EFF(35,"Name"),t.k0s(),t.nrm(36,"input",15),t.k0s(),t.DNE(37,tt,2,1,"app-field-hint",16),t.k0s()(),t.j41(38,"div",17),t.DNE(39,et,2,0),t.j41(40,"button",18),t.bIt("click",function(){t.eBV(e);const m=t.XpG();return t.Njj(m.closeDialog())}),t.EFF(41,"Cancel"),t.k0s(),t.j41(42,"button",19),t.bIt("click",function(){t.eBV(e);const m=t.XpG();return t.Njj(m.confirm())}),t.EFF(43," Create "),t.k0s()(),t.DNE(44,at,5,7)(45,ot,2,1,"div",20),t.k0s()()()}if(2&o){const e=u,a=t.XpG();t.R7$(6),t.JRh(a.controls.finalName.value||(a.controls.folder.value?a.controls.folder.value.trim()+"/":"")),t.R7$(2),t.Y8G("formGroup",a.form),t.R7$(8),t.Dyx(e.platforms),t.R7$(7),t.Dyx(e.purposes),t.R7$(7),t.Dyx(e.templates),t.R7$(7),t.vxM(37,a.controls.name.touched&&null!=a.controls.name.errors&&a.controls.name.errors.required?37:-1),t.R7$(2),t.vxM(39,e.loadingPreview?39:-1),t.R7$(3),t.Y8G("disabled",!a.form.valid||e.loadingPreview||!e.previewValid),t.R7$(2),t.vxM(44,e.preview?44:-1),t.R7$(),t.vxM(45,!e.loadingPreview&&e.previewError?45:-1)}}let nt=(()=>{class o extends K.${constructor(e,a){super(),this.dialogData=e,this.dialogRef=a,this.hostClass="dialog-component",this.all="All",this.sourceService=(0,H.d)(A.F)}ngOnInit(){this.templates$=new M.t([]),this.loadingPreview$=new M.t(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new d.J3({platform:new d.hs(this.all),purpose:new d.hs({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new d.hs(null,d.k0.required),name:new d.hs(this.dialogData.name??null,d.k0.required),finalName:new d.hs({value:null,disabled:!0}),folder:new d.hs({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscriptions.add((0,x.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,C.F)())]).subscribe(([e,a])=>{const m=e.find(p=>p.Key===a),f=this.dialogData.name?this.controls.name.value||this.dialogData.name:m?.SuggestedFileName??null;this.controls.name.value!==f&&this.controls.name.patchValue(f)})),this.subscriptions.add((0,x.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,C.F)()),this.controls.name.valueChanges.pipe((0,g.Z)(this.controls.name.value),(0,C.F)()),this.controls.folder.valueChanges.pipe((0,g.Z)(this.controls.folder.value),(0,C.F)())]).subscribe(([e,a,m,f])=>{const p=e.find(c=>c.Key===a);let l=null;m&&(f=f.trim(),m=S.SX.sanitizePath(m.trim()),l=`${f?`${f}/`:""}${m=`${p?.Prefix??""}${m}${p?.Suffix??""}${p?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==l&&this.controls.finalName.patchValue(l)}))}buildViewModel(){const e=this.templates$.pipe((0,P.T)(p=>{const l={[this.all]:this.all};return p.forEach(c=>{c.Platforms?.forEach(v=>{l[v]=v})}),Object.keys(l)})),a=this.templates$.pipe((0,P.T)(p=>{const l={[this.all]:this.all};return p.forEach(c=>{l[c.Purpose]=c.Purpose}),Object.keys(l)})),m=(0,x.z)([this.templates$,this.controls.platform.valueChanges.pipe((0,g.Z)(this.controls.platform.value),(0,C.F)()),this.controls.purpose.valueChanges.pipe((0,g.Z)(this.controls.purpose.value),(0,C.F)())]).pipe((0,P.T)(([p,l,c])=>p.filter(E=>(l===this.all||(E.Platforms?.includes(l)??!1))&&(c===this.all||E.Purpose===c))),(0,$.M)(p=>{if(!p.some(l=>l.Key===this.controls.templateKey.value)){const l=p[0]?.Key??null;this.controls.templateKey.value!==l&&this.controls.templateKey.patchValue(l)}})),f=(0,x.z)([this.controls.finalName.valueChanges.pipe((0,g.Z)(this.controls.finalName.value),(0,C.F)()),this.controls.templateKey.valueChanges.pipe((0,g.Z)(this.controls.templateKey.value),(0,C.F)())]).pipe(function r(o,u=I.E,e){const a=(0,n.O)(o,u);return function Z(o,u){return(0,R.N)((e,a)=>{const{leading:m=!0,trailing:f=!1}=u??{};let p=!1,l=null,c=null,v=!1;const E=()=>{c?.unsubscribe(),c=null,f&&(L(),v&&a.complete())},O=()=>{c=null,v&&a.complete()},w=b=>c=(0,F.Tg)(o(b)).subscribe((0,T._)(a,E,O)),L=()=>{if(p){p=!1;const b=l;l=null,a.next(b),!v&&w(b)}};e.subscribe((0,T._)(a,b=>{p=!0,l=b,(!c||c.closed)&&(m?L():w(b))},()=>{v=!0,(!(f&&p&&c)||c.closed)&&a.complete()}))})}(()=>a,e)}(100,I.E,{leading:!0,trailing:!0}),(0,$.M)(()=>{this.loadingPreview$.next(!0)}),(0,s.n)(([p,l])=>p&&l?(0,y.p)([this.sourceService.getPreview(p,this.dialogData.global,l),(0,n.O)(500)]).pipe((0,P.T)(([c])=>c)):(0,h.of)(void 0)),(0,$.M)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,x.z)([e,a,m,f,this.loadingPreview$]).pipe((0,P.T)(([p,l,c,v,E])=>({platforms:p,purposes:l,templates:c,loadingPreview:E,preview:v?.Preview,previewValid:v?.IsValid??!1,previewError:v?.Error})))}static#t=this.\u0275fac=function(a){return new(a||o)(t.rXU(D.Vh),t.rXU(D.CP))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(a,m){2&a&&t.Mr5("className",m.hostClass)},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-mat-form-field"],["formControlName","platform"],[3,"value"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],[1,"eav-preview-error"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"]],template:function(a,m){if(1&a&&(t.DNE(0,it,46,7,"div",0),t.nI1(1,"async")),2&a){let f;t.vxM(0,(f=t.bMT(1,1,m.viewModel$))?0:-1,f)}},dependencies:[d.YN,d.qT,d.me,d.BC,d.cb,d.YS,d.X1,d.j4,d.JD,N.RG,N.rl,N.nJ,X.Ve,X.VO,z.wT,z.Sy,V.fS,V.fg,k.D6,k.LG,U.Hl,U.$z,G.YU,G.Jj,J.F,W],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.01.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_create-file-dialog_component_ts.e17adb0c306b9c32.js.map