"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_permissions_permissions_component_ts"],{1897:(M,g,t)=>{function s(c,d){return d(c)}function h(c,d){return d(c)}t.d(g,{C:()=>s,z:()=>h})},2458:(M,g,t)=>{t.r(g),t.d(g,{PermissionsComponent:()=>I});var s=t(7580),h=t(7941),c=t(2159),d=t(251),o=t(52),D=t(3216),a=t(334),n=t(3840),r=t(5060);let l=(()=>{class f{agInit(u){this.params=u}refresh(u){return!0}deletePermission(){this.params.onDelete(this.params.data)}static#s=this.\u0275fac=function(E){return new(E||f)};static#t=this.\u0275cmp=s.VBU({type:f,selectors:[["app-permissions-actions"]],standalone:!0,features:[s.aNF],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(E,P){1&E&&(s.j41(0,"div",0)(1,"div",1),s.bIt("click",function(){return P.deletePermission()}),s.j41(2,"mat-icon"),s.EFF(3,"delete"),s.k0s()()())},dependencies:[r.pZ,r.r6,n.m_,n.An]})}return f})();var p=t(4900),v=t(1828),e=t(4175),i=t(7037),O=t(5437),m=t(1897),_=t(8471),T=t(3347),y=t(9841);let I=(()=>{class f{#s;#t;#e;#a;constructor(u,E){this.dialogRef=u,this.snackBar=E,this.gridOptions=this.buildGridOptions(),this.permissions=(0,s.vPA)([]),this.#s=(0,O.d)(p.K),this.#t=(0,O.d)(_.c),this.#e=(0,m.C)(this.#t.getParams(["targetType","keyType","key"]),P=>({targetType:parseInt(P.targetType,10),keyType:P.keyType,key:P.key})),this.#a={[o.YX.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.#i(),this.#t.doOnDialogClosed(()=>this.#i())}closeDialog(){this.dialogRef.close()}#i(){this.#s.getAll(this.#e.targetType,this.#e.keyType,this.#e.key).subscribe(u=>{this.permissions.set(u)})}editPermission(u){let E;E=null==u?{items:[{...a.c.newMetadataFromInfo(o.YX.contentTypes.permissions,a.c.constructMetadataInfo(this.#e.targetType,this.#e.keyType,this.#e.key)),...this.#a[this.#e.targetType]&&{Prefill:this.#a[this.#e.targetType]}}]}:{items:[a.c.editId(u.Id)]};const P=(0,D.s)(E);this.#t.navRelative([`edit/${P}`])}deletePermission(u){confirm(`Delete '${u.Title}' (${u.Id})?`)&&(this.snackBar.open("Deleting..."),this.#s.delete(u.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#i()}))}buildGridOptions(){return{...d.C,columnDefs:[{...v.r.Id,cellRendererParams:v.r.idFieldParamsTooltipGetter()},{...v.r.TextWide,headerName:"Name",field:"Title",sort:"asc",onCellClicked:E=>{this.editPermission(E.data)}},{...v.r.TextWide,field:"Identity"},{...v.r.TextWide,field:"Condition"},{...v.r.Character,field:"Grant"},{...v.r.ActionsPinnedRight1,cellRenderer:l,cellRendererParams:{onDelete:P=>this.deletePermission(P)}}]}}static#n=this.\u0275fac=function(E){return new(E||f)(s.rXU(h.CP),s.rXU(T.UG))};static#r=this.\u0275cmp=s.VBU({type:f,selectors:[["app-permissions"]],standalone:!0,features:[s.aNF],decls:15,vars:2,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(E,P){1&E&&(s.j41(0,"div",0)(1,"div",1)(2,"div",2),s.EFF(3,"Permissions"),s.k0s(),s.j41(4,"button",3),s.bIt("click",function(){return P.closeDialog()}),s.j41(5,"mat-icon"),s.EFF(6,"close"),s.k0s()()(),s.j41(7,"div",4),s.nrm(8,"router-outlet"),s.j41(9,"div",5),s.nrm(10,"ag-grid-angular",6),s.k0s(),s.j41(11,"mat-dialog-actions",7)(12,"button",8),s.bIt("click",function(){return P.editPermission(null)}),s.j41(13,"mat-icon"),s.EFF(14,"add"),s.k0s()()()()()),2&E&&(s.R7$(10),s.Y8G("rowData",P.permissions())("gridOptions",P.gridOptions))},dependencies:[e.Hl,e.iY,e.Sr,n.m_,n.An,c.n3,h.E7,i.p,y.xs]})}return f})()},401:(M,g,t)=>{t.d(g,{T:()=>d});var s=t(6474),h=t(7580);let d=(()=>{class o extends s.D{getMetadata(a,n,r,l){return this.http.get(this.apiUrl("admin/metadata/get"),{params:{appId:this.appId,targetType:a.toString(),keyType:n,key:r.toString(),...l&&{contentType:l}}})}static#s=this.\u0275fac=(()=>{let a;return function(r){return(a||(a=h.xGo(o)))(r||o)}})();static#t=this.\u0275prov=h.jDH({token:o,factory:o.\u0275fac})}return o})()},4900:(M,g,t)=>{t.d(g,{K:()=>a});var s=t(271),h=t(6817),c=t(52),d=t(401),o=t(5437),D=t(7580);let a=(()=>{class n{constructor(){this.metadataService=(0,o.d)(d.T),this.entitiesService=(0,o.d)(h.R)}getAll(l,p,v){return this.metadataService.getMetadata(l,p,v,c.YX.contentTypes.permissions).pipe((0,s.T)(e=>e.Items))}delete(l){return this.entitiesService.delete(c.YX.contentTypes.permissions,l,!1)}static#s=this.\u0275fac=function(p){return new(p||n)};static#t=this.\u0275prov=D.jDH({token:n,factory:n.\u0275fac})}return n})()},8471:(M,g,t)=>{t.d(g,{c:()=>l});var s=t(2159),h=t(1567),c=t(3037),d=t(271),o=t(5057),D=t(4979),a=t(4435),n=t(7580);const r={doOnDialogClosed:!0};let l=(()=>{class p extends D.V{constructor(e,i){super(),this.router=e,this.route=i,this.log=(0,a.T)({DialogRoutingService:p},r)}get snapshot(){return this.route.snapshot}get url(){return this.router.url}getParam(e){return this.route.snapshot.paramMap.get(e)}getParams(e){const i=this.route.snapshot.paramMap;return e.reduce((O,m)=>(O[m]=i.get(m),O),{})}getQueryParam(e){return this.route.snapshot.queryParamMap.get(e)}getQueryParams(e){const i=this.route.snapshot.queryParamMap;return e.reduce((O,m)=>(O[m]=i.get(m),O),{})}state(){return this.router.getCurrentNavigation().extras?.state}doOnDialogClosed(e){const i=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.childDialogClosed$().subscribe(()=>e())),i.end()}navPath(e,i){return this.router.navigate([e],i)}navRelative(e,i){return this.router.navigate(e,{...i,relativeTo:this.route})}navParentFirstChild(e,i){return this.router.navigate(e,{...i,relativeTo:this.route.parent.firstChild})}childDialogClosed$(){return this.router.events.pipe((0,h.p)(e=>e instanceof s.wF),(0,c.Z)(!!this.route.snapshot.firstChild),(0,d.T)(()=>!!this.route.snapshot.firstChild),(0,o.J)(),(0,h.p)(([e,i])=>e&&!i))}static#s=this.\u0275fac=function(i){return new(i||p)(n.KVO(s.Ix),n.KVO(s.nX))};static#t=this.\u0275prov=n.jDH({token:p,factory:p.\u0275fac})}return p})()},6817:(M,g,t)=>{t.d(g,{R:()=>d});var s=t(9234),h=t(6474),c=t(7580);let d=(()=>{class o extends h.D{create(a,n){return this.http.post(`app/auto/data/${a}`,n,{params:{appId:this.appId,zoneId:this.zoneId}})}update(a,n,r){return this.http.post(`app/auto/data/${a}/${n}`,r,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(a,n,r){return this.http.delete(this.apiUrl(s.gb+"delete"),{params:{contentType:a,id:n.toString(),appId:this.appId,force:r.toString()}})}static#s=this.\u0275fac=(()=>{let a;return function(r){return(a||(a=c.xGo(o)))(r||o)}})();static#t=this.\u0275prov=c.jDH({token:o,factory:o.\u0275fac})}return o})()},9234:(M,g,t)=>{t.d(g,{Gg:()=>v,Tr:()=>e,gb:()=>p});var s=t(1567),h=t(6647),c=t(6301),d=t(271),o=t(4435),D=t(4839),a=t(5437),n=t(6474),r=t(7580);const l={all:!1,getEntities:!1,getAvailableEntities:!1,delete:!1},p="admin/entity/",v="admin/entity/list";let e=(()=>{class i extends n.D{constructor(){super(...arguments),this.log=(0,o.T)({EntityService:i},l),this.queryService=(0,a.d)(D.c)}getEntities$(m){return this.log.fnIf("getEntities"),m.pipe((0,s.p)(_=>null!=_),(0,h.n)(_=>this.getAvailableEntities(_.contentTypeName).pipe((0,c.t)(1))))}getAvailableEntities(m,_){return this.log.fnIf("getAvailableEntities"),this.queryService.getEntities({contentTypes:[m],itemIds:_,fields:"Id,Guid,Title",log:"getAvailableEntities"}).pipe((0,d.T)(y=>y.Default))}delete(m,_,T,y,I,f){return this.log.fnIf("delete",{appId:m,contentType:_,entityId:T,force:y,parentId:I,parent}),this.http.delete(this.apiUrl(p+"delete"),{params:{contentType:_,id:T.toString(),appId:m,force:y.toString(),...I&&{parentId:I.toString()},...I&&f&&{parentField:f}}})}static#s=this.\u0275fac=(()=>{let m;return function(T){return(m||(m=r.xGo(i)))(T||i)}})();static#t=this.\u0275prov=r.jDH({token:i,factory:i.\u0275fac})}return i})()},4839:(M,g,t)=>{t.d(g,{c:()=>D});var s=t(8873),h=t(4435),c=t(7580),d=t(6443);const o={all:!1,getAvailableEntities:!1,getEntities:!1};let D=(()=>{class a{constructor(r,l){this.http=r,this.context=l,this.log=(0,h.T)({QueryService:a},o)}getAvailableEntities(r,l,p,v){this.log.fnIf("getAvailableEntities",{queryUrl:r,params:l,fields:p,entitiesFilter:v});const e=!!l,_=(((l?.toLocaleLowerCase()??"").includes("appid=")?"":`&appId=${this.context.appId}`)+(e?`&${l}`:"")+"&$select="+(p??"")).substring(1);return this.http.post(`app/auto/query/${r}?${_}`,{Guids:v})}getEntities({contentTypes:r,itemIds:l,fields:p,log:v}){this.log.fnIf("getEntities",{log:v,contentTypes:r,itemIds:l,fields:p});const i=("&typeNames="+(r?.join(",")??"")+`&appId=${this.context.appId}&itemIds=`+(l?.join(",")??"")+"&$select="+(p??"")).substring(1);return this.http.post(`app/auto/query/System.EntityPicker/Default?${i}`,{})}static#s=this.\u0275fac=function(l){return new(l||a)(c.KVO(d.Qq),c.KVO(s.o))};static#t=this.\u0275prov=c.jDH({token:a,factory:a.\u0275fac})}return a})()},4979:(M,g,t)=>{t.d(g,{V:()=>c});var s=t(7092),h=t(7580);let c=(()=>{class d{constructor(){this.subscriptions=new s.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static#s=this.\u0275fac=function(a){return new(a||d)};static#t=this.\u0275prov=h.jDH({token:d,factory:d.\u0275fac})}return d})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.01.00/dist/ng-edit/default-projects_eav-ui_src_app_permissions_permissions_component_ts.2e5179c5f9b9d7a0.js.map