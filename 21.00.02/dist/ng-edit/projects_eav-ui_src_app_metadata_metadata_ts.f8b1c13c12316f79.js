"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_metadata_metadata_ts","projects_eav-ui_src_app_permissions_permissions_routing_ts"],{336(R,f,e){e.d(f,{F:()=>u});var d=e(46443),l=e(14600),g=e(70271),r=e(36647),s=e(78742),_=e(70693),C=e(34435),F=e(9234),P=e(24467),M=e(56884),U=e(36124);const y={getAll:!0,getAllLive:!0,getAllOnce:!0};let u=(()=>{class m extends P.B{constructor(){super(...arguments),this.log=(0,C.Tq)({ContentItemsService:m},y)}getAllPromise(p){return this.log.fnIf("getAll",{contentTypeStaticName:p}),this.fetchPromise(F.Gg,{params:{appId:this.appId,contentType:p}})}getAllOnce(p){return this.log.fnIf("getAllOnce",{contentTypeStaticName:p}),(0,d.fx)(()=>({url:this.apiUrl(F.Gg),params:{appId:this.appId,contentType:p}}))}getAllLive(p,c){return this.log.fnIf("getAllLive",{contentTypeStaticName:p,refresh:c}),(0,d.fx)(()=>(c(),{url:this.apiUrl(F.Gg),params:{appId:this.appId,contentType:p}}))}getColumnsPromise(p){return this.fetchPromise(s.z,{params:{appId:this.appId,staticName:p}})}importItem(p){return(0,l.H)((0,_.n)(p)).pipe((0,r.n)(c=>this.http.post(this.apiUrl(F.gb+"upload"),{AppId:this.appId,ContentBase64:c})),(0,g.T)(c=>({Success:c,Messages:[]})))}static{this.\u0275fac=(()=>{let p;return function(D){return(p||(p=U.xGo(m)))(D||m)}})()}static{this.\u0275prov=M.jDH({token:m,factory:m.\u0275fac})}}return m})()},4096(R,f,e){e.d(f,{Kn:()=>_.K,TI:()=>s.T,k4:()=>d.k});var d=e(72437),s=(e(40448),e(42365),e(43516),e(80401)),_=e(44900)},5858(R,f,e){e.d(f,{O:()=>d});const d="DROPDOWN_INSERT_VALUE"},11855(R,f,e){e.d(f,{F:()=>m});var d=e(79748),l=e(37580),g=e(24950),r=e(56884),s=e(36124),_=e(80423);const C=["*"],F=h=>({"hint-box__short":h});function P(h,p){1&h&&s.eu8(0)}function M(h,p){if(1&h&&(s.j41(0,"mat-hint"),s.DNE(1,P,1,0,"ng-container",2),s.k0s()),2&h){s.XpG();const c=s.sdS(4);s.R7$(),s.Y8G("ngTemplateOutlet",c)}}function U(h,p){1&h&&s.eu8(0)}function y(h,p){if(1&h&&(s.j41(0,"mat-error"),s.DNE(1,U,1,0,"ng-container",2),s.k0s()),2&h){s.XpG();const c=s.sdS(4);s.R7$(),s.Y8G("ngTemplateOutlet",c)}}function u(h,p){1&h&&s.SdG(0)}let m=(()=>{class h{constructor(){this.isError=(0,l.hFB)(!1),this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static{this.\u0275fac=function(D){return new(D||h)}}static{this.\u0275cmp=s.VBU({type:h,selectors:[["app-field-hint"]],inputs:{isError:[1,"isError"]},ngContentSelectors:C,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(D,x){if(1&D){const A=s.RV6();s.NAR(),s.j41(0,"div",1),s.bIt("click",function(){return r.eBV(A),r.Njj(x.toggleIsShort())}),s.nVh(1,M,2,1,"mat-hint")(2,y,2,1,"mat-error"),s.k0s(),s.DNE(3,u,1,0,"ng-template",null,0,s.C5r)}if(2&D){let A;s.Y8G("ngClass",s.eq3(2,F,x.isShort)),s.R7$(),s.vxM(!1===(A=x.isError())?1:!0===A?2:-1)}},dependencies:[g.RG,_.MV,_.TL,d.YU,d.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}}return h})()},17042(R,f,e){e.d(f,{v:()=>P});var d=e(58857),l=e(37580),g=e(56884),r=e(36124),s=e(87941);const _=["gridWrapper"],C=[[["","eav-dialog-header",""]],[["","eav-dialog-content",""]],[["ag-grid-angular"]],[["mat-dialog-actions"]]],F=["[eav-dialog-header]","[eav-dialog-content]","ag-grid-angular","mat-dialog-actions"];let P=(()=>{class M{constructor(){this.gridWrapper=(0,l.ebz)("gridWrapper",{read:r.aKT}),this.agGrid=(0,l.sbv)(d.xs,{read:r.aKT}),this.dialogAction=(0,l.sbv)(s.E7,{read:r.aKT}),this.helpText=l.hFB.required({}),this.refresh=l.hFB.required(),this.rowLength=l.hFB.required(),this.DEFAULT_ROW_HEIGHT=47,this.GRID_HEADER_HEIGHT=64,this.HELP_CARD_BUFFER=12,(0,g.QZP)(()=>{this.refresh();const u=this.rowLength(),m=this.gridWrapper()?.nativeElement;m&&(0,g.O8t)(()=>this.#t(m,u))})}#t(y,u){const m=this.agGrid()?.nativeElement,h=this.dialogAction()?.nativeElement,p=y.querySelector(".help-info-card");setTimeout(()=>{if(p.classList.toggle("center-center",0===u),!m||!h)return;p.style.flex="";const c=this.#a(y,m,h,p,u);m.style.flex=c.rowHeight?`0 0 ${c.agGridHeight}px`:"0px";const D=document.querySelector(".mat-sidenav-content"),x=document.querySelector(".mat-mdc-dialog-container"),j=(document.querySelector(".nav-component-wrapper")?x:D).clientHeight-c.dialogHeaderHeight-c.dialogActionHeight-2;m.style.maxHeight=`${j}px`;const G=c.helpCardHeight+c.agGridHeight+c.dialogActionHeight+c.dialogHeaderHeight>c.wrapperHeight;p.style.flex="1 1 auto",p?.classList.toggle("hidden-help-info-card",G)},0)}#a(y,u,m,h,p){const c=u.querySelector(".ag-row")?.clientHeight??this.DEFAULT_ROW_HEIGHT;return{rowHeight:c,agGridHeight:this.GRID_HEADER_HEIGHT+p*c,helpCardHeight:h.clientHeight+this.HELP_CARD_BUFFER,dialogActionHeight:m.offsetHeight,dialogHeaderHeight:y.querySelector(".eav-dialog-header")?.clientHeight??0,wrapperHeight:y.offsetHeight}}static{this.\u0275fac=function(u){return new(u||M)}}static{this.\u0275cmp=r.VBU({type:M,selectors:[["app-grid-with-help"]],contentQueries:function(u,m,h){1&u&&r.C6U(h,m.agGrid,d.xs,5,r.aKT)(h,m.dialogAction,s.E7,5,r.aKT),2&u&&r.NyB(2)},viewQuery:function(u,m){1&u&&r.wEZ(m.gridWrapper,_,5,r.aKT),2&u&&r.NyB()},inputs:{helpText:[1,"helpText"],refresh:[1,"refresh"],rowLength:[1,"rowLength"]},ngContentSelectors:F,decls:10,vars:2,consts:[["gridWrapper",""],[1,"grid-wrapper-dynamic"],[1,"help-info-card"],[1,"help-info-card-text"],[3,"innerHTML"]],template:function(u,m){1&u&&(r.NAR(C),r.rj2(0,"div",1,0),r.SdG(2),r.SdG(3,1),r.SdG(4,2),r.rj2(5,"div",2)(6,"div",3),r.Hgh(7,"span",4)(8,"span",4),r.eux()(),r.SdG(9,3),r.eux()),2&u&&(r.R7$(7),r.Avn("innerHTML",m.helpText().description,r.npT),r.R7$(),r.Avn("innerHTML",m.helpText().hint,r.npT))},styles:[".grid-wrapper-dynamic[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.grid-wrapper-dynamic[_ngcontent-%COMP%]     .ag-theme-material.grid-dynamic{flex-shrink:0;flex-grow:0}.grid-wrapper-dynamic[_ngcontent-%COMP%]     .hidden-help-info-card{visibility:hidden!important;position:absolute!important}.grid-wrapper-dynamic[_ngcontent-%COMP%]     mat-dialog-actions{flex-shrink:0;margin-top:auto}.grid-wrapper-dynamic[_ngcontent-%COMP%]     mat-dialog-actions .eav-scope-dropdown{margin-top:-14px;width:350px}.help-info-card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.help-info-card[_ngcontent-%COMP%]   .help-info-card-text[_ngcontent-%COMP%]{text-align:center;color:gray;width:30vw;max-width:400px;min-width:180px}.center-center[_ngcontent-%COMP%]{flex:1 1 auto}"]})}}return M})()},21183(R,f,e){e.d(f,{f:()=>d});class d{static cellLink(g,r,s){return`<a class="default-link fill-cell ${s}" href="${g}">${r}</a>`}}},39333(R,f,e){e.d(f,{c:()=>g});var d=e(34435),l=e(36124);let g=(()=>{class r{constructor(){this.log=(0,d.Tq)({ClickStopPropagationDirective:r}),this.log.a("constructor")}onClick(_){this.log.a("onClick",{event:_}),_.stopPropagation()}static{this.\u0275fac=function(C){return new(C||r)}}static{this.\u0275dir=l.FsC({type:r,selectors:[["","appClickStopPropagation",""]],hostBindings:function(C,F){1&C&&l.bIt("click",function(M){return F.onClick(M)})}})}}return r})()},42365(R,f,e){e.d(f,{v:()=>l});var d=e(89204);const l={name:"SET_PERMISSIONS_DIALOG",initContext:!0,panelSize:"large",panelClass:null,getComponent:()=>(0,d.A)(function*(){const{PermissionsComponent:g}=yield Promise.all([e.e("default-node_modules_angular_forms_fesm2022_forms_mjs-node_modules_angular_material_fesm2022_-c07bbe"),e.e("default-projects_eav-ui_src_app_shared_directives_tippy_directive_ts"),e.e("default-node_modules_angular_material_fesm2022_radio_mjs"),e.e("default-projects_eav-ui_src_app_shared_ag-grid_column-definitions_ts-projects_eav-ui_src_app_-3cb379"),e.e("default-projects_core_object-utilities_ts-projects_eav-ui_src_app_edit_dialog_main_keyboard-s-787ea4"),e.e("default-projects_eav-ui_src_app_permissions_permissions_ts"),e.e("projects_eav-ui_src_app_shared_components_base_ts-projects_eav-ui_src_app_shared_pipes_safe-h-6ce629")]).then(e.bind(e,40448));return g})()}},43516(R,f,e){e.d(f,{permissionRoutes:()=>r});var d=e(51195),l=e(88329),g=e(42365);const r=[{path:"",component:l.DialogEntryComponent,data:{dialog:g.v},children:d.RD}]},52304(R,f,e){e.r(f),e.d(f,{MetadataComponent:()=>Ut});var d=e(79748),l=e(56884),g=e(36664),r=e(16256),s=e(84175),_=e(87941),C=e(93840),F=e(69393),P=e(23183),M=e(12938),U=e(13620),y=e(25286),u=e(336),m=e(58767),h=e(4096),p=e(21183),c=e(11828),D=e(17042),x=e(60251),A=e(59339),S=e(92324),j=e(34435),G=e(30056),z=e(67037),Z=e(69914),Q=e(60852),J=e(96817),w=e(85309),W=e(34601),t=e(36124),q=e(17828);let tt=(()=>{class a{agInit(n){this.params=n}refresh(n){return!0}deleteMetadata(){this.params.onDelete(this.params.data)}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"div",1),t.bIt("click",function(){return o.deleteMetadata()}),t.j41(2,"mat-icon"),t.EFF(3,"delete"),t.k0s()()())},dependencies:[w.p,q.r6,C.m_,C.An,W.e],encapsulation:2})}}return a})(),et=(()=>{class a{agInit(n){this.value=n.value,this.metadata=n.data}refresh(n){return!0}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-content-type"]],decls:2,vars:2,consts:[[1,"container",3,"tippy"]],template:function(i,o){1&i&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&i&&(t.Y8G("tippy",o.metadata._Type.Description),t.R7$(),t.SpI(" ",o.value,"\n"))},dependencies:[W.e],styles:[".container[_ngcontent-%COMP%]{width:fit-content}"]})}}return a})();var O=e(34456),nt=e(20762),at=e(24950),K=e(59791),N=e(25175),k=e(8827),ot=e(63037),it=e(91817),st=e(75445),rt=e(32760),lt=e(11855),V=e(5858),$=e(50052),dt=e(39333),ct=e(63628),L=e(80423),pt=e(96462),Y=e(55326);const X=a=>({active:a});function mt(a,v){if(1&a&&(t.j41(0,"mat-option",18),t.EFF(1),t.k0s()),2&a){const n=v.$implicit;t.Y8G("value",n.value),t.R7$(),t.SpI(" ",n.name," ")}}function ht(a,v){if(1&a&&(t.j41(0,"mat-form-field",7)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",17),t.Z7z(4,mt,2,2,"mat-option",18,t.fX1),t.j41(6,"mat-option",18),t.EFF(7,"Other..."),t.k0s()()(),t.j41(8,"app-field-hint"),t.EFF(9," The scope should almost never be changed - "),t.j41(10,"a",19),t.EFF(11,"see help"),t.k0s()()),2&a){const n=t.XpG();t.R7$(3),t.Y8G("placeholder",n.scopeOptions().length?"":"No items found"),t.R7$(),t.Dyx(n.scopeOptions()),t.R7$(2),t.Y8G("value",n.dropdownInsertValue)}}function gt(a,v){if(1&a&&(t.j41(0,"mat-option",18),t.EFF(1),t.k0s()),2&a){const n=v.$implicit;t.Y8G("value",n.NameId),t.R7$(),t.SpI(" ",n.Label," ")}}function ut(a,v){if(1&a&&(t.j41(0,"mat-select",8),t.Z7z(1,gt,2,2,"mat-option",18,t.fX1),t.k0s()),2&a){let n;const i=t.XpG();t.Y8G("placeholder",null!=(n=i.contentTypes())&&n.length?"":"No items found"),t.R7$(),t.Dyx(i.contentTypes())}}function ft(a,v){1&a&&t.nrm(0,"input",9)}function _t(a,v){1&a&&(t.j41(0,"app-field-hint",13),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}let vt=(()=>{class a{#t;constructor(n){this.dialog=n,this.hostClass="dialog-component",this.formValid=(0,l.vPA)(!1),this.canSave=(0,g.EW)(()=>this.formValid()),this.dropdownInsertValue=V.O,this.guidedContentType=!0,this.advancedMode=!1,this.#t=(0,M.d)(st.gs),this.scope=(0,l.vPA)($.YX.scopes.default.value),this.scopeOptions=this.#t.getScopesSig(),this.contentTypes=this.#t.getTypes(this.scope).value}ngOnInit(){this.buildForm(),this.#a(),this.form.statusChanges.subscribe(()=>{this.formValid.set(this.form.valid)})}closeDialog(n){this.dialog.close(n)}toggleGuidedContentType(n){this.guidedContentType=n}toggleAdvancedMode(n){this.advancedMode=n.checked}saveAndClose(){const n=this.form.getRawValue();this.closeDialog(n.contentType)}#a(){this.dialog.keydownEvents().subscribe(n=>{(0,rt.YU)(n)&&this.canSave()&&(n.preventDefault(),this.saveAndClose())})}buildForm(){this.form=new O.J3({}),this.form.addControl("contentType",new O.hs(null,[O.k0.required])),this.form.addControl("scope",new O.hs($.YX.scopes.default.value)),this.form.controls.scope.valueChanges.pipe((0,ot.Z)(this.form.controls.scope.value),(0,it.F)()).subscribe(n=>{null!=this.form.controls.contentType.value&&this.form.controls.contentType.patchValue(null),n===V.O?(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||$.YX.scopes.default.value,this.scopeOptions().some(i=>i.value===n)||this.scopeOptions.set([{name:n,value:n},...this.scopeOptions()]),this.form.controls.scope.patchValue(n)):this.scope.set(n)})}static{this.\u0275fac=function(i){return new(i||a)(t.rXU(_.CP))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-save-dialog"]],hostVars:1,hostBindings:function(i,o){2&i&&t.Avn("className",o.hostClass)},decls:32,vars:15,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",1,"eav-mat-form-field"],["formControlName","contentType","required","",3,"placeholder"],["matInput","","type","text","formControlName","contentType","required",""],["matTextSuffix",""],["mat-icon-button","","type","button","tippy","Pick existing value",3,"click","ngClass"],["mat-icon-button","","type","button","tippy","Manual entry",3,"click","ngClass"],[3,"isError"],["color","accent",3,"change","checked"],["align","end"],[3,"action","ngClass","disabled"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3," Create Metadata "),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return o.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"p"),t.EFF(9," This is a special operation to add an item which as metadata for another item, see "),t.j41(10,"a",5),t.EFF(11,"docs"),t.k0s(),t.EFF(12,". "),t.k0s(),t.j41(13,"form",6),t.nVh(14,ht,12,2),t.j41(15,"mat-form-field",7)(16,"mat-label"),t.EFF(17,"Content Type"),t.k0s(),t.nVh(18,ut,3,1,"mat-select",8),t.nVh(19,ft,1,0,"input",9),t.j41(20,"div",10)(21,"button",11),t.bIt("click",function(){return o.toggleGuidedContentType(!0)}),t.j41(22,"mat-icon"),t.EFF(23,"search"),t.k0s()(),t.j41(24,"button",12),t.bIt("click",function(){return o.toggleGuidedContentType(!1)}),t.j41(25,"mat-icon"),t.EFF(26,"text_fields"),t.k0s()()()(),t.nVh(27,_t,2,1,"app-field-hint",13),t.j41(28,"mat-slide-toggle",14),t.bIt("change",function(I){return o.toggleAdvancedMode(I)}),t.EFF(29),t.k0s()()(),t.j41(30,"mat-dialog-actions",15)(31,"app-save-close-button-fab",16),t.bIt("action",function(){return o.saveAndClose()}),t.k0s()()()),2&i&&(t.R7$(13),t.Y8G("formGroup",o.form),t.R7$(),t.vxM(o.advancedMode&&o.guidedContentType?14:-1),t.R7$(4),t.vxM(o.guidedContentType?18:-1),t.R7$(),t.vxM(o.guidedContentType?-1:19),t.R7$(2),t.Y8G("ngClass",t.eq3(11,X,o.guidedContentType)),t.R7$(3),t.Y8G("ngClass",t.eq3(13,X,!o.guidedContentType)),t.R7$(3),t.vxM(o.form.controls.contentType.touched&&null!=o.form.controls.contentType.errors&&o.form.controls.contentType.errors.required?27:-1),t.R7$(),t.Y8G("checked",o.advancedMode),t.R7$(),t.SpI(" ",o.advancedMode?"Advanced":"Simple"," "),t.R7$(2),t.Y8G("ngClass",o.canSave()?"":"disabled")("disabled",!o.canSave()))},dependencies:[O.YN,O.qT,O.me,O.BC,O.cb,O.YS,O.X1,O.j4,O.JD,at.RG,L.rl,L.nJ,L.yw,N.Ve,N.VO,pt.wT,nt.S,K.fS,K.fg,s.Hl,Y.iY,d.YU,C.m_,C.An,k.mV,k.sG,lt.F,dt.c,_.E7,ct.i],styles:["mat-slide-toggle[_ngcontent-%COMP%]{margin-top:16px}"]})}}return a})();var Ct=e(37580),Tt=e(3347),Mt=e(58857);const yt=a=>({"fab-opened":a});function Et(a,v){1&a&&t.EFF(0," This item is not metadata for anything else. ")}function Dt(a,v){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Key Number: ",n.itemFor().KeyNumber," ")}}function Ot(a,v){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Key Guid: ",n.itemFor().KeyGuid," ")}}function Ft(a,v){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Key String: ",n.itemFor().KeyString," ")}}function Rt(a,v){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Title: ",n.itemFor().Title," ")}}function Pt(a,v){if(1&a&&(t.EFF(0," This item is metadata for: "),t.nrm(1,"br"),t.EFF(2),t.nrm(3,"br"),t.EFF(4),t.nVh(5,Dt,2,1),t.nVh(6,Ot,2,1),t.nVh(7,Ft,2,1),t.nVh(8,Rt,2,1)),2&a){const n=t.XpG();t.R7$(2),t.SpI("Target: ",n.itemFor().Target," "),t.R7$(2),t.SpI("TargetType: ",n.itemFor().TargetType," "),t.R7$(),t.vxM(n.itemFor().KeyNumber?5:-1),t.R7$(),t.vxM(n.itemFor().KeyGuid?6:-1),t.R7$(),t.vxM(n.itemFor().KeyString?7:-1),t.R7$(),t.vxM(n.itemFor().Title?8:-1)}}function It(a,v){if(1&a&&t.nrm(0,"ag-grid-angular",6),2&a){let n;const i=t.XpG();t.Y8G("rowData",null==(n=i.metadataSet())?null:n.Items)("gridOptions",i.gridOptions)}}function bt(a,v){if(1&a){const n=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){l.eBV(n);const o=t.XpG();return l.Njj(o.createMetadata())}),t.j41(1,"mat-icon"),t.EFF(2,"add"),t.k0s()()}}function xt(a,v){if(1&a&&(t.nrm(0,"div",19),t.nI1(1,"safeHtml")),2&a){const n=t.XpG().$implicit;t.Y8G("innerHTML",t.bMT(1,2,n.Icon),t.npT)("matBadgeIcon",n.Enabled?null:"diamond")}}function At(a,v){1&a&&(t.j41(0,"mat-icon"),t.EFF(1,"add"),t.k0s())}function St(a,v){if(1&a){const n=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){const o=l.eBV(n).$implicit,E=t.XpG(2);return l.Njj(E.createMetadata(o))}),t.nVh(1,xt,2,4,"div",19)(2,At,2,0,"mat-icon"),t.k0s()}if(2&a){const n=v.$implicit,i=t.XpG(2);t.BMQ("label",n.Title),t.R7$(),t.vxM(n.Icon&&i.fabOpen()?1:2)}}function Gt(a,v){if(1&a){const n=t.RV6();t.j41(0,"eco-fab-speed-dial",11),t.bIt("openChange",function(o){l.eBV(n);const E=t.XpG();return l.Njj(E.openChange(o))}),t.j41(1,"eco-fab-speed-dial-trigger",12)(2,"button",13)(3,"mat-icon",14),t.EFF(4),t.k0s()()(),t.j41(5,"eco-fab-speed-dial-actions",15)(6,"button",16),t.bIt("click",function(){l.eBV(n);const o=t.XpG();return l.Njj(o.createMetadata())}),t.j41(7,"mat-icon"),t.EFF(8,"search"),t.k0s()(),t.Z7z(9,St,3,2,"button",17,t.fX1),t.k0s()()}if(2&a){const n=t.XpG();t.Y8G("ngClass",t.eq3(3,yt,n.fabOpen())),t.R7$(),t.Y8G("spin",!0),t.R7$(3),t.JRh(n.fabOpen()?"close":"add"),t.R7$(5),t.Dyx(n.recommendations())}}let Ut=(()=>{class a{#t;#a;#i;#n;constructor(n,i,o,E,I){this.dialog=n,this.snackBar=i,this.matDialog=o,this.viewContainerRef=E,this.changeDetectorRef=I,this.log=(0,j.Tq)({MetadataComponent:a}),this.#t=(0,M.d)(J.R),this.#a=(0,M.d)(h.TI),this.#i=(0,M.d)(u.F),this.#n=(0,M.d)(Q.c),this.gridOptions=this.#p(),this.fabOpen=(0,l.vPA)(!1),this.#e=(0,U.C)(this.#n.getParams(["targetType","keyType","key","title","contentTypeStaticName"]),T=>({targetType:parseInt(T.targetType,10),keyType:T.keyType,key:T.key,contentTypeStaticName:T.contentTypeStaticName})),this.#s=this.#i.getAllOnce(this.#e.contentTypeStaticName).value,this.itemFor=(0,g.EW)(()=>{const T=this.#s()?.find(b=>b.Guid===this.#e.key);return T?.For?T.For:void 0}),this.refresh=(0,l.vPA)(0),this.#r=this.#a.getMetadataLive(this.refresh,this.#e.targetType,this.#e.keyType,this.#e.key).value,this.#o={empty:{description:"<p><b>This is where you manage Metadata</b></p>",hint:"<p>Click the (+) in the bottom right corner to create your first Metadata for the current item.</p>"},content:{description:"<p><b>Each row shows Metadata for the current item</b> <br>Metadata describes/configures something, similar to labels you could attach to clothes.</p>",hint:"<p>Click on the row to edit the Metadata. <br>You can also create new Metadata.</p>"}},this.uxHelpText=(0,g.EW)(()=>0===this.metadataSet()?.Items?.length?this.#o.empty:this.#o.content),this.metadataSet=(0,g.EW)(()=>{const T=this.#r();if(!T)return;const b=structuredClone(T);return b.Recommendations.forEach(H=>{if(H.Icon?.startsWith("base64:")){let B=H.Icon.replace("base64:","");B=window.atob(B),B=B.replace('fill="#000000"','fill="#ffffff"'),H.Icon=B}}),b}),this.recommendations=(0,g.EW)(()=>{const T=this.metadataSet();return T?.Recommendations.filter(b=>T?.Items.filter(H=>H._Type.Id===b.Id).length<b.Count)}),this.title=(()=>{try{return decodeURIComponent(this.#n.getParam("title")??"")}catch{return console.error("Couldn't properly decode title"),this.#n.getParam("title")??""}})()}#e;#s;#r;#o;ngOnInit(){this.#n.doOnDialogClosed(()=>this.refresh.update(n=>n+1))}closeDialog(){this.dialog.close()}openChange(n){this.fabOpen.set(n)}createMetadata(n){if(n)return n.Enabled?void(n.CreateEmpty?(this.snackBar.open(`Creating ${n.Name}...`),this.#t.create(n.Id,{For:this.calculateItemFor("dummy").For}).subscribe({error:()=>{this.snackBar.open(`Creating ${n.Name} failed. Please check console for more info`,void 0,{duration:3e3}),this.refresh.update(o=>o+1)},next:()=>{this.snackBar.open(`Created ${n.Name}`,void 0,{duration:3e3}),this.refresh.update(o=>o+1)}})):this.createMetadataForm(n.Id)):void(0,m.j)(this.matDialog,n.MissingFeature,this.viewContainerRef,this.changeDetectorRef);this.matDialog.open(vt,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(o=>{null!=o&&this.createMetadataForm(o)})}createMetadataForm(n){const i={items:[this.calculateItemFor(n)]},o=(0,S.s)(i);this.#n.navRelative([`edit/${o}`]),this.changeDetectorRef.markForCheck()}calculateItemFor(n){const i=G.H.constructMetadataInfo(this.#e.targetType,this.#e.keyType,this.#e.key);return G.H.newMetadataFromInfo(n,i)}#d(n){const i={items:[G.H.editId(n.Id)]},o=(0,S.s)(i);this.#n.navRelative([`edit/${o}`])}#l(n,i=!1){if(!i){const o={entityId:n.Id,entityTitle:n.Title,hasDeleteSnackbar:!0,message:this.metadataSet().Recommendations.find(I=>I.Id===n._Type.Id)?.DeleteWarning};return void this.matDialog.open(y.F,{autoFocus:!1,data:o,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(I=>{I&&this.#l(n,!0)})}this.#t.delete(n._Type.Id,n.Id,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.refresh.update(o=>o+1)},error:()=>{this.snackBar.open("Delete failed. Please check console for more information",null,{duration:3e3})}})}#c(n){const i={items:[G.H.editId(n.Id)]},o=(0,S.s)(i);return"#"+this.#n.urlSubRoute(`edit/${o}`)}#p(){return{...x.C,columnDefs:[{...c.r.IdWithDefaultRenderer,cellRendererParams:c.r.idFieldParamsTooltipGetter()},{...c.r.TextWide,field:"Title",cellRenderer:i=>p.f.cellLink(this.#c(i.data),i.value),onCellClicked:i=>this.#d(i.data)},{...c.r.TextWide,headerName:"Content Type",field:"ContentType",valueGetter:i=>`${i.data._Type.Name}${i.data._Type.Title!==i.data._Type.Name?` (${i.data._Type.Title})`:""}`,cellRenderer:et},{...c.r.ActionsPinnedRight1,cellRenderer:tt,cellRendererParams:{onDelete:i=>this.#l(i)}}]}}static{this.\u0275fac=function(i){return new(i||a)(t.rXU(_.CP),t.rXU(Tt.UG),t.rXU(_.bZ),t.rXU(t.c1b),t.rXU(Ct.gRc))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata"]],decls:17,vars:8,consts:[[1,"eav-dialog","nav-component-wrapper"],[2,"height","100%",3,"helpText","refresh","rowLength"],["eav-dialog-header","",1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],["eav-dialog-content","",1,"eav-dialog-content"],[1,"ag-theme-material","eav-dialog-content",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab"],[1,"eav-eco-fab-speed-dial",3,"ngClass"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab",3,"click"],[1,"eav-eco-fab-speed-dial",3,"openChange","ngClass"],[3,"spin"],["mat-fab","",1,"grid-fab"],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Other Content Type",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","aria-hidden","false",2,"color","white","fill","white",3,"innerHTML","matBadgeIcon"]],template:function(i,o){if(1&i&&(t.j41(0,"div",0)(1,"app-grid-with-help",1)(2,"div",2)(3,"div",3),t.EFF(4),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){return o.closeDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",5)(9,"p"),t.nVh(10,Et,1,0)(11,Pt,9,6),t.k0s()(),t.nVh(12,It,1,2,"ag-grid-angular",6),t.j41(13,"mat-dialog-actions",7),t.nVh(14,bt,3,0,"button",8),t.nVh(15,Gt,11,5,"eco-fab-speed-dial",9),t.k0s()()(),t.nrm(16,"router-outlet")),2&i){let E,I,T,b;t.R7$(),t.Y8G("helpText",o.uxHelpText())("refresh",o.refresh())("rowLength",null==(E=o.metadataSet())?null:E.Items.length),t.R7$(3),t.SpI(" ",o.title||"Metadata"," "),t.R7$(6),t.vxM(o.itemFor()?11:10),t.R7$(2),t.vxM((null==(I=o.metadataSet())?null:I.Items.length)>0?12:-1),t.R7$(2),t.vxM(0===(null==(T=o.recommendations())?null:T.length)?14:-1),t.R7$(),t.vxM((null==(b=o.recommendations())?null:b.length)>0?15:-1)}},dependencies:[s.Hl,s.$0,Y.iY,s.Sr,C.m_,C.An,F.n3,z.p,Mt.xs,_.E7,P.TE,d.YU,P.p1,P.yf,r.Y,A.A,D.v,Z.$],styles:["[_nghost-%COMP%]     .ag-row-hover .ag-cell a, [_nghost-%COMP%]     .ag-row-hover .ag-cell .id-box *, [_nghost-%COMP%]     .ag-row-hover .ag-cell mat-icon, .eav-button__with-icon[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:#85283b!important}[_nghost-%COMP%]     .mat-button-wrapper div svg *:not([fill]){fill:#fff}"]})}}return a})()},72437(R,f,e){e.d(f,{k:()=>l});var d=e(50052);let l=(()=>{class g{static{this.route={path:"permissions/:targetType/:keyType/:key",loadChildren:()=>e.e("projects_eav-ui_src_app_permissions_permissions_routing_ts").then(e.bind(e,43516)).then(s=>s.permissionRoutes),data:{title:"Permissions"}}}static getUrl(s,_,C){return`permissions/${s}/${_}/${C}`}static getUrlApp(s){return this.getUrl(d.YX.metadata.app.targetType,d.YX.metadata.app.keyType,s.toString())}static getUrlAttribute(s){return this.getUrl(d.YX.metadata.attribute.targetType,d.YX.metadata.attribute.keyType,s.toString())}static getUrlContentType(s){return this.getUrlEntity(s)}static getUrlEntity(s){return this.getUrl(d.YX.metadata.entity.targetType,d.YX.metadata.entity.keyType,s)}static getUrlLanguage(s){return this.getUrl(d.YX.metadata.language.targetType,d.YX.metadata.language.keyType,s)}}return g})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/21.00.02/dist/ng-edit/projects_eav-ui_src_app_metadata_metadata_ts.f8b1c13c12316f79.js.map