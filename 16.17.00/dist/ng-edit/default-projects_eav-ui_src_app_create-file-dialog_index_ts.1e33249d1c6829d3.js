"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_index_ts"],{1485:(z,_,o)=>{o.d(_,{t:()=>K});var d=o(9736),U=o(2611),I=o(1699),T=o(4860),v=o(6232);const P="admin/AppFiles/asset";let K=(()=>{var O;class F{constructor(l,c,u){this.http=l,this.context=c,this.dnnContext=u}get(l,c,u){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(P),{params:{appId:this.context.appId,global:c,...this.templateIdOrPath(l,c,u)}}).pipe((0,d.U)(f=>{if("auto"===f.Type.toLocaleLowerCase())switch(f.Extension.toLocaleLowerCase()){case".cs":case".cshtml":f.Type="Razor";break;case".html":case".css":case".js":f.Type="Token"}return f}))}save(l,c,u,f){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(P),u,{params:{appId:this.context.appId,global:c,...this.templateIdOrPath(l,c,f)}})}getAll(l){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.context.appId,...l&&{mask:l}}}).pipe((0,d.U)(({Files:c})=>(c.forEach(u=>{u.Shared??=!1}),c)))}getWebApis(){return this.getAll("*Controller.cs").pipe((0,d.U)(l=>l.map(u=>{const f=u.Path.lastIndexOf("/"),D=u.Path.lastIndexOf("."),V=u.Path.substring(0,f),t=u.Path.substring(f+1,D);return{path:u.Path,folder:V,name:t,isShared:u.Shared}})))}getWebApiDetails(l){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:l}})}getPredefinedTemplates(l,c){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:{...l&&{purpose:l},...c&&{type:c}}})}getPreview(l,c,u){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:l,templateKey:u,global:c}})}create(l,c,u){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:c,purpose:"auto",path:l,templateKey:u}})}templateIdOrPath(l,c,u){if(/^[0-9]*$/g.test(l)){const f=u.find(D=>D.EntityId?.toString()===l&&D.IsShared===c)?.Path;return{templateId:l,...null!=f&&{path:f}}}return{path:l}}}return(O=F).\u0275fac=function(l){return new(l||O)(I.LFG(T.eN),I.LFG(U._),I.LFG(v._y))},O.\u0275prov=I.Yz7({token:O,factory:O.\u0275fac}),F})()},7220:(z,_,o)=>{o.d(_,{UH:()=>at,qH:()=>rt});var d=o(8849),U=o(6861),I=o(8071),T=o(3839),v=o(5043),x=o(3317),P=o(9736),b=o(3738),w=o(7777),S=o(4114),$=o(5678),K=o(384),F=o(9378);var l=o(1891),c=o(4980),u=o(4300),f=o(1485),D=o(2110),V=o(9097),t=o(1699),A=o(6575),R=o(9851),Q=o(9674);let W=(()=>{var n;class s{constructor(e,r){this.matInput=e,this.elementRef=r,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const r=e.toLocaleLowerCase();return"true"===r||"false"!==r&&void 0}return null==e?e:void 0}}return(n=s).\u0275fac=function(e){return new(e||n)(t.Y36(Q.Nt),t.Y36(t.SBq))},n.\u0275dir=t.lG2({type:n,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}}),s})();var Y=o(895),E=o(1268),L=o(6355),G=o(257),B=o(3910);function H(n,s){if(1&n&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&n){const a=s.$implicit;t.Q6J("value",a),t.xp6(1),t.hij(" ",a," ")}}function X(n,s){if(1&n&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&n){const a=s.$implicit;t.Q6J("value",a),t.xp6(1),t.hij(" ",a," ")}}function q(n,s){if(1&n&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&n){const a=s.$implicit;t.Q6J("value",a.Key),t.xp6(1),t.hij(" ",a.Name," ")}}function k(n,s){1&n&&(t.TgZ(0,"app-field-hint",23),t._uU(1," This field is required "),t.qZA()),2&n&&t.Q6J("isError",!0)}function tt(n,s){1&n&&(t.ynx(0),t._UZ(1,"mat-spinner",24)(2,"div",25),t.BQk())}const j=function(n){return{disabled:n}};function et(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"div",26)(2,"label",27),t._uU(3,"Preview"),t.qZA()(),t.TgZ(4,"pre",28),t._uU(5),t.qZA(),t.BQk()),2&n){const a=t.oxw().ngIf;t.xp6(2),t.Q6J("ngClass",t.VKq(3,j,a.loadingPreview)),t.xp6(2),t.Q6J("ngClass",t.VKq(5,j,a.loadingPreview)),t.xp6(1),t.Oqu(a.preview)}}function nt(n,s){if(1&n&&(t.TgZ(0,"div",29),t._uU(1),t.qZA()),2&n){const a=t.oxw().ngIf;t.xp6(1),t.hij(" ",a.previewError," ")}}function ot(n,s){if(1&n){const a=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),t._uU(5,"Create"),t.qZA(),t.TgZ(6,"span",4),t._uU(7),t.qZA()()(),t.TgZ(8,"div",5)(9,"form",6)(10,"div",7)(11,"div",8)(12,"div",9)(13,"mat-form-field",10)(14,"mat-label"),t._uU(15,"Platform"),t.qZA(),t.TgZ(16,"mat-select",11),t.YNc(17,H,2,2,"mat-option",12),t.qZA()()(),t.TgZ(18,"div",9)(19,"mat-form-field",10)(20,"mat-label"),t._uU(21,"Purpose"),t.qZA(),t.TgZ(22,"mat-select",13),t.YNc(23,X,2,2,"mat-option",12),t.qZA()()()(),t.TgZ(24,"div",14)(25,"mat-form-field",10)(26,"mat-label"),t._uU(27,"Template"),t.qZA(),t.TgZ(28,"mat-select",15),t.YNc(29,q,2,2,"mat-option",12),t.qZA()()(),t.TgZ(30,"div",14)(31,"mat-form-field",10)(32,"mat-label"),t._uU(33,"Name"),t.qZA(),t._UZ(34,"input",16),t.qZA(),t.YNc(35,k,2,1,"app-field-hint",17),t.qZA()(),t.TgZ(36,"div",18),t.YNc(37,tt,3,0,"ng-container",0),t.TgZ(38,"button",19),t.NdJ("click",function(){t.CHM(a);const r=t.oxw();return t.KtG(r.closeDialog())}),t._uU(39,"Cancel"),t.qZA(),t.TgZ(40,"button",20),t.NdJ("click",function(){t.CHM(a);const r=t.oxw();return t.KtG(r.confirm())}),t._uU(41," Create "),t.qZA()(),t.YNc(42,et,6,7,"ng-container",0),t.YNc(43,nt,2,1,"div",21),t.qZA()()(),t.BQk()}if(2&n){const a=s.ngIf,e=t.oxw();t.xp6(7),t.Oqu(e.controls.finalName.value||(e.controls.folder.value?e.controls.folder.value.trim()+"/":"")),t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(8),t.Q6J("ngForOf",a.platforms),t.xp6(6),t.Q6J("ngForOf",a.purposes),t.xp6(6),t.Q6J("ngForOf",a.templates),t.xp6(6),t.Q6J("ngIf",e.controls.name.touched&&(null==e.controls.name.errors?null:e.controls.name.errors.required)),t.xp6(2),t.Q6J("ngIf",a.loadingPreview),t.xp6(3),t.Q6J("disabled",!e.form.valid||a.loadingPreview||!a.previewValid),t.xp6(2),t.Q6J("ngIf",a.preview),t.xp6(1),t.Q6J("ngIf",!a.loadingPreview&&a.previewError)}}let at=(()=>{var n;class s extends V.f{constructor(e,r,h){super(),this.dialogData=e,this.dialogRef=r,this.sourceService=h,this.hostClass="dialog-component",this.all="All"}ngOnInit(){this.templates$=new I.X([]),this.loadingPreview$=new I.X(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new d.nJ({platform:new d.p4(this.all),purpose:new d.p4({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new d.p4(null,d.kI.required),name:new d.p4(this.dialogData.name??null,d.kI.required),finalName:new d.p4({value:null,disabled:!0}),folder:new d.p4({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,T.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,v.O)(this.controls.templateKey.value),(0,x.x)())]).subscribe(([e,r])=>{const h=e.find(p=>p.Key===r),g=this.dialogData.name?this.controls.name.value||this.dialogData.name:h?.SuggestedFileName??null;this.controls.name.value!==g&&this.controls.name.patchValue(g)})),this.subscription.add((0,T.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,v.O)(this.controls.templateKey.value),(0,x.x)()),this.controls.name.valueChanges.pipe((0,v.O)(this.controls.name.value),(0,x.x)()),this.controls.folder.valueChanges.pipe((0,v.O)(this.controls.folder.value),(0,x.x)())]).subscribe(([e,r,h,g])=>{const p=e.find(m=>m.Key===r);let i=null;h&&(g=g.trim(),h=D.vl.sanitizePath(h.trim()),i=`${g?`${g}/`:""}${h=`${p?.Prefix??""}${h}${p?.Suffix??""}${p?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==i&&this.controls.finalName.patchValue(i)}))}buildViewModel(){const e=this.templates$.pipe((0,P.U)(p=>{const i={[this.all]:this.all};return p.forEach(m=>{m.Platforms?.forEach(C=>{i[C]=C})}),Object.keys(i)})),r=this.templates$.pipe((0,P.U)(p=>{const i={[this.all]:this.all};return p.forEach(m=>{i[m.Purpose]=m.Purpose}),Object.keys(i)})),h=(0,T.a)([this.templates$,this.controls.platform.valueChanges.pipe((0,v.O)(this.controls.platform.value),(0,x.x)()),this.controls.purpose.valueChanges.pipe((0,v.O)(this.controls.purpose.value),(0,x.x)())]).pipe((0,P.U)(([p,i,m])=>p.filter(M=>(i===this.all||(M.Platforms?.includes(i)??!1))&&(m===this.all||M.Purpose===m))),(0,b.b)(p=>{if(!p.some(i=>i.Key===this.controls.templateKey.value)){const i=p[0]?.Key??null;this.controls.templateKey.value!==i&&this.controls.templateKey.patchValue(i)}})),g=(0,T.a)([this.controls.finalName.valueChanges.pipe((0,v.O)(this.controls.finalName.value),(0,x.x)()),this.controls.templateKey.valueChanges.pipe((0,v.O)(this.controls.templateKey.value),(0,x.x)())]).pipe(function J(n,s=w.z,a){const e=(0,F.H)(n,s);return function O(n,s){return(0,S.e)((a,e)=>{const{leading:r=!0,trailing:h=!1}=s??{};let g=!1,p=null,i=null,m=!1;const C=()=>{i?.unsubscribe(),i=null,h&&(N(),m&&e.complete())},M=()=>{i=null,m&&e.complete()},Z=y=>i=(0,K.Xf)(n(y)).subscribe((0,$.x)(e,C,M)),N=()=>{if(g){g=!1;const y=p;p=null,e.next(y),!m&&Z(y)}};a.subscribe((0,$.x)(e,y=>{g=!0,p=y,(!i||i.closed)&&(r?N():Z(y))},()=>{m=!0,(!(h&&g&&i)||i.closed)&&e.complete()}))})}(()=>e,a)}(100,w.z,{leading:!0,trailing:!0}),(0,b.b)(()=>{this.loadingPreview$.next(!0)}),(0,l.w)(([p,i])=>p&&i?(0,u.D)([this.sourceService.getPreview(p,this.dialogData.global,i),(0,F.H)(500)]).pipe((0,P.U)(([m])=>m)):(0,c.of)(void 0)),(0,b.b)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,T.a)([e,r,h,g,this.loadingPreview$]).pipe((0,P.U)(([p,i,m,C,M])=>({platforms:p,purposes:i,templates:m,loadingPreview:M,preview:C?.Preview,previewValid:C?.IsValid??!1,previewError:C?.Error})))}}return(n=s).\u0275fac=function(e){return new(e||n)(t.Y36(U.WI),t.Y36(U.so),t.Y36(f.t))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(e,r){2&e&&t.Ikx("className",r.hostClass)},features:[t.qOj],decls:2,vars:3,consts:[[4,"ngIf"],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-form-field"],["formControlName","platform"],[3,"value",4,"ngFor","ngForOf"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","eav-preview-error",4,"ngIf"],[3,"value"],[3,"isError"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"eav-preview-error"]],template:function(e,r){1&e&&(t.YNc(0,ot,44,10,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,r.viewModel$))},dependencies:[A.mk,A.sg,A.O5,R.Y,W,Y.lW,E.KE,E.hX,L.gD,G.ey,d._Y,d.Fj,d.JJ,d.JL,d.Q7,d.sg,d.u,Q.Nt,B.Ou,A.Ov],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]}),s})();var it=o(2611),lt=o(7138),st=o(8497);let rt=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[it._,f.t,{provide:E.o2,useValue:{subscriptSizing:"dynamic"}},{provide:L.PG,useValue:{hideSingleSelectionIndicator:!0}}],imports:[A.ez,lt.q,Y.ot,L.LD,d.UX,E.lN,Q.c,B.Cq,st.QW]}),s})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/16.17.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_index_ts.1e33249d1c6829d3.js.map