"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_apps-management_licence-info_license-info_component_ts"],{8045:(P,v,a)=>{a.r(v),a.d(v,{LicenseInfoComponent:()=>q});var p=a(9841),x=a(9509),C=a(8824),d=a(316),y=a(4175),D=a(7941),u=a(353),h=a(3840),O=a(2159),R=a(5797),g=a(4205),L=a(3037),r=a(6647),o=a(1318),m=a(9452),f=a(8764),b=a(271),$=a(1870),w=a(1873),j=a(4581),I=a(2938);class E{static expandFeature(c){return{...c,...E.getExpiration(c?.expiration)}}static expandLicense(c){try{const e=c?.Features?.map(i=>i.expiration).sort()[0];return null==e?c:{...c,...E.getExpiration(e)}}catch{return c}}static getExpiration(c){const e=(l,tt)=>({ExpMessage:(null!=l?l+" ":"")+tt,ExpIcon:l,ExpWarningIcon:"\u2705"!=l?l:null}),n=c?.split("T")[0];if(null==n)return e(null,null);if(n.startsWith("9999"))return e("\u2705","never");const i=new Date(n);return i<new Date?e("\u{1f6d1}","expired"):i.toDateString()===(new Date).toDateString()?e("\u26a0\ufe0f","today"):i.toDateString()===new Date((new Date).setDate((new Date).getDate()+1)).toDateString()?e("\u26a0\ufe0f","tomorrow"):i<new Date((new Date).setDate((new Date).getDate()+30))?e("\u26a0\ufe0f",n):n.endsWith("12-31")?e("\u2705",`EOY ${n.split("-")[0]}`):e("\u2753",n)}}var F=a(1828),G=a(1960),U=a(6378),A=a(251),M=a(4601),B=a(7037),W=a(8471),N=a(3992),t=a(9148);let S=(()=>{class s{transform(e){return`${e.Features.filter(n=>n.isEnabled).length}/${e.Features.length}`}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275pipe=t.EJ8({name:"activeFeaturesCount",type:s,pure:!0,standalone:!0})}}return s})(),H=(()=>{class s{constructor(e){this.itemsCount=0,this.headerHeight=32,this.rowHeight=48,this.maxRows=100,this.extraHeight=2,this.element=e.nativeElement}ngOnChanges(e){null!=e.itemsCount&&(this.element.style.height=`${this.headerHeight+(0===this.itemsCount?2:this.itemsCount>this.maxRows?this.maxRows:this.itemsCount)*this.rowHeight+this.extraHeight}px`)}static{this.\u0275fac=function(n){return new(n||s)(t.rXU(t.aKT))}}static{this.\u0275dir=t.FsC({type:s,selectors:[["","appAgGridHeight",""]],inputs:{itemsCount:"itemsCount",headerHeight:"headerHeight",rowHeight:"rowHeight",maxRows:"maxRows"},standalone:!0,features:[t.OA$]})}}return s})();var K=a(1191);let V=(()=>{class s{agInit(e){this.value=e.value,this.feature=e.data}refresh(e){return!0}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-features-list-enabled-reason"]],standalone:!0,features:[t.aNF],decls:2,vars:2,consts:[[3,"tippy"]],template:function(n,i){1&n&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&n&&(t.Y8G("tippy",i.feature.enabledReasonDetailed),t.R7$(),t.JRh(i.value))},dependencies:[M.e],encapsulation:2})}}return s})(),J=(()=>{class s{agInit(e){this.value=e.value}refresh(e){return!0}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-features-list-enabled"]],standalone:!0,features:[t.aNF],decls:3,vars:1,consts:[[1,"icon-container"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"mat-icon"),t.EFF(2),t.k0s()()),2&n&&(t.R7$(2),t.JRh(i.value?"check_box":"check_box_outline_blank"))},dependencies:[h.m_,h.An],encapsulation:2})}}return s})();var T=a(8827);const Y=(s,c)=>({"toggle-false":s,"toggle-null":c});let z=(()=>{class s{agInit(e){this.params=e,this.value=e.value,this.disabled=e.isDisabled(e.data),this.tooltip=e.tooltipGetter(e.data)}refresh(e){return this.disabled=this.params.isDisabled(this.params.data),!0}toggle(){const e=this.params.data;let n;switch(this.value){case!1:n=null;break;case null:n=!0;break;case!0:n=!1}this.value=n,this.params.onToggle(e,n)}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-features-status"]],standalone:!0,features:[t.aNF],decls:1,vars:7,consts:[[3,"change","checked","tippy","disabled","ngClass"]],template:function(n,i){1&n&&(t.j41(0,"mat-slide-toggle",0),t.bIt("change",function(){return i.toggle()}),t.k0s()),2&n&&t.Y8G("checked",i.value)("tippy",i.tooltip)("disabled",i.disabled)("ngClass",t.l_i(4,Y,!1===i.value,null===i.value))},dependencies:[T.mV,T.sG,d.YU,M.e],styles:["[_nghost-%COMP%]{height:100%;display:flex;padding-left:12px;padding-right:12px;align-items:center}.mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding-top:0}  .toggle-false.mat-mdc-slide-toggle:not(.mat-mdc-slide-toggle-checked):not(.mat-disabled) .mdc-switch__track:before{background-color:orange!important}  .toggle-null .mdc-switch__handle{margin-left:8px}"]})}}return s})(),X=(()=>{class s{transform(e){return Array.isArray(e)?[...e].sort((i,l)=>i.Priority<l.Priority?-1:i.Priority>l.Priority?1:0):e}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275pipe=t.EJ8({name:"licensesOrder",type:s,pure:!0,standalone:!0})}}return s})();const Q=s=>({expanded:s});function Z(s,c){if(1&s&&t.nrm(0,"ag-grid-angular",9),2&s){const e=t.XpG().$implicit,n=t.XpG(2);t.Y8G("rowData",e.Features)("gridOptions",n.gridOptions)("itemsCount",null==e.Features?null:e.Features.length)}}function k(s,c){if(1&s&&(t.j41(0,"mat-expansion-panel",null,0)(2,"mat-expansion-panel-header")(3,"mat-panel-title")(4,"mat-icon",5),t.EFF(5),t.k0s(),t.j41(6,"div")(7,"div",6)(8,"span"),t.EFF(9),t.k0s(),t.j41(10,"span",7),t.EFF(11),t.nI1(12,"activeFeaturesCount"),t.k0s(),t.j41(13,"span"),t.EFF(14),t.k0s()(),t.j41(15,"div",8),t.EFF(16),t.k0s()()()(),t.DNE(17,Z,1,3,"ag-grid-angular",9),t.k0s()),2&s){const e=c.$implicit,n=t.sdS(1);t.R7$(4),t.Y8G("tippy",e.IsEnabled?"License is active":"License is not active"),t.R7$(),t.JRh(e.IsEnabled?"check_circle_outline":"cancel"),t.R7$(4),t.JRh(e.Name),t.R7$(2),t.JRh(t.bMT(12,8,e)),t.R7$(3),t.SpI(" ",e.ExpWarningIcon,""),t.R7$(),t.Y8G("ngClass",t.eq3(10,Q,n.expanded)),t.R7$(),t.SpI(" ",e.Description," "),t.R7$(),t.vxM(n.expanded?17:-1)}}function _(s,c){1&s&&(t.j41(0,"mat-accordion",1),t.Z7z(1,k,18,12,"mat-expansion-panel",null,t.BUC().trackLicenses,!0),t.nI1(3,"licensesOrder"),t.k0s()),2&s&&(t.R7$(),t.Dyx(t.bMT(3,0,c.licenses)))}let q=(()=>{class s{#t;#e;#n;constructor(e,n,i){this.matDialog=e,this.viewContainerRef=n,this.changeDetectorRef=i,this.disabled$=new R.t(!1),this.gridOptions=this.#i(),this.#t=new g.B,this.#e=(0,I.d)(N.b),this.#n=(0,I.d)(W.c),C.syG.registerModules([x.Q])}ngOnInit(){this.#n.doOnDialogClosed(()=>this.#t.next()),this.viewModel$=this.#t.pipe((0,L.Z)(void 0),(0,r.n)(()=>this.#e.getLicenses().pipe((0,o.W)(()=>(0,m.of)(void 0)))),(0,f.M)(()=>this.disabled$.next(!1)),(0,b.T)(e=>e.map(n=>({...E.expandLicense(n),Features:n.Features.map(i=>E.expandFeature(i))}))),(0,$.u)()).pipe((0,b.T)(e=>({licenses:e})))}ngOnDestroy(){this.disabled$.complete()}trackLicenses(e,n){return n.Guid}openRegistration(){const e=this.#n.router;e.navigate([e.url.replace("license","")+"/registration"])}#a(e){this.matDialog.open(K.O,{autoFocus:!1,data:{feature:e,showGuid:!0,showStatus:!0},viewContainerRef:this.viewContainerRef,width:"600px"}),this.changeDetectorRef.markForCheck()}#s(e,n){this.disabled$.next(!0),(0,w.p)([this.#e.saveFeatures([{FeatureGuid:e.guid,Enabled:n}]),(0,j.O)(100)]).subscribe({error:()=>{this.#t.next()},next:()=>{this.#t.next()}})}#i(){return{...A.C,columnDefs:[{...F.r.ItemsText,headerName:"ID",field:"nameId",width:200,cellClass:"no-outline",cellRenderer:U.L,cellRendererParams:{tooltipGetter:i=>i.nameId}},{...F.r.TextWideFlex3,headerName:"Name",field:"name",cellClass:"primary-action highlight".split(" "),onCellClicked:n=>{this.#a(n.data)}},{headerName:"Enabled",field:"isEnabled",width:80,cellClass:"no-outline",headerClass:"dense",sortable:!0,filter:G.y,cellRenderer:J},{...F.r.TextNarrow,headerName:"Reason",field:"enabledReason",cellRenderer:V},{...F.r.ItemsText,headerName:"Expiration",field:"ExpMessage",sortable:!1,width:120,tooltipValueGetter:n=>n.data?.expiration},{...F.r.ActionsPinnedRight7,headerName:"",field:"enabledInConfiguration",cellRenderer:z,cellRendererParams:()=>({isDisabled:i=>!i.isConfigurable||this.disabled$.value,onToggle:(i,l)=>this.#s(i,l),tooltipGetter:i=>i.isConfigurable?"Toggle off | default | on":"This feature can't be configured"})}]}}static{this.\u0275fac=function(n){return new(n||s)(t.rXU(D.bZ),t.rXU(t.c1b),t.rXU(t.gRc))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-license-info"]],viewQuery:function(n,i){if(1&n&&t.GBs(p.xs,5),2&n){let l;t.mGM(l=t.lsd())&&(i.gridRef=l.first)}},standalone:!0,features:[t.aNF],decls:9,vars:3,consts:[["panel",""],["multi",""],["align","start"],["mat-button","","tippy","Registration",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"],[1,"panel-icon",3,"tippy"],[1,"panel-title"],[1,"active-features-count"],[1,"panel-description",3,"ngClass"],["appAgGridHeight","",1,"ag-theme-material",3,"rowData","gridOptions","itemsCount"]],template:function(n,i){if(1&n&&(t.DNE(0,_,4,2,"mat-accordion",1),t.nI1(1,"async"),t.j41(2,"mat-dialog-actions",2)(3,"button",3),t.bIt("click",function(){return i.openRegistration()}),t.j41(4,"mat-icon",4),t.EFF(5,"app_registration"),t.k0s(),t.j41(6,"span"),t.EFF(7,"Registration"),t.k0s()()(),t.nrm(8,"router-outlet")),2&n){let l;t.vxM((l=t.bMT(1,1,i.viewModel$))?0:-1,l)}},dependencies:[u.MY,u.BS,u.GK,u.Z2,u.WN,h.m_,h.An,d.YU,B.p,p.xs,H,D.E7,y.Hl,y.$z,O.n3,d.Jj,X,S,M.e],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;padding-top:20px;box-sizing:border-box;position:relative}.mat-expansion-panel-header[_ngcontent-%COMP%]{padding-top:4px;padding-bottom:4px}.mat-expansion-panel-header[_ngcontent-%COMP%]     .mat-content{max-height:100%}.panel-icon[_ngcontent-%COMP%]{margin-right:16px}.panel-title[_ngcontent-%COMP%]{font-size:14px}.active-features-count[_ngcontent-%COMP%]{display:inline-block;margin-left:8px;color:#fff;font-size:12px;border-radius:12px;padding:2px 6px;background-color:#002753;border:1px solid rgba(29,39,61,.44);box-sizing:border-box;-webkit-user-select:none;user-select:none;white-space:nowrap}.panel-description[_ngcontent-%COMP%]{padding-top:4px;font-size:12px;color:#0000008a;overflow:hidden;text-overflow:ellipsis;max-height:1em;line-height:1em}.panel-description.expanded[_ngcontent-%COMP%]{max-height:3em}.eav-button__with-icon[_ngcontent-%COMP%]   .eav-icon[_ngcontent-%COMP%]{font-size:24px;height:24px;width:24px}"]})}}return s})()},8471:(P,v,a)=>{a.d(v,{c:()=>R});var p=a(2159),x=a(1567),C=a(3037),d=a(271),y=a(5057),D=a(4979),u=a(4435),h=a(9148);const O={doOnDialogClosed:!0};let R=(()=>{class g extends D.V{constructor(r,o){super(),this.router=r,this.route=o,this.log=(0,u.T)({DialogRoutingService:g},O)}get snapshot(){return this.route.snapshot}get url(){return this.router.url}getParam(r){return this.route.snapshot.paramMap.get(r)}getParams(r){const o=this.route.snapshot.paramMap;return r.reduce((m,f)=>(m[f]=o.get(f),m),{})}getQueryParam(r){return this.route.snapshot.queryParamMap.get(r)}getQueryParams(r){const o=this.route.snapshot.queryParamMap;return r.reduce((m,f)=>(m[f]=o.get(f),m),{})}state(){return this.router.getCurrentNavigation().extras?.state}doOnDialogClosed(r){const o=this.log.fnIf("doOnDialogClosed");this.subscriptions.add(this.childDialogClosed$().subscribe(()=>r())),o.end()}navPath(r,o){return this.router.navigate([r],o)}navRelative(r,o){return this.router.navigate(r,{...o,relativeTo:this.route})}navParentFirstChild(r,o){return this.router.navigate(r,{...o,relativeTo:this.route.parent.firstChild})}childDialogClosed$(){return this.router.events.pipe((0,x.p)(r=>r instanceof p.wF),(0,C.Z)(!!this.route.snapshot.firstChild),(0,d.T)(()=>!!this.route.snapshot.firstChild),(0,y.J)(),(0,x.p)(([r,o])=>r&&!o))}static{this.\u0275fac=function(o){return new(o||g)(h.KVO(p.Ix),h.KVO(p.nX))}}static{this.\u0275prov=h.jDH({token:g,factory:g.\u0275fac})}}return g})()},4979:(P,v,a)=>{a.d(v,{V:()=>C});var p=a(7092),x=a(9148);let C=(()=>{class d{constructor(){this.subscriptions=new p.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(u){return new(u||d)}}static{this.\u0275prov=x.jDH({token:d,factory:d.\u0275fac})}}return d})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.02.00/dist/ng-edit/projects_eav-ui_src_app_apps-management_licence-info_license-info_component_ts.1a9ac29678168cde.js.map