{"version":3,"file":"projects_eav-ui_src_app_apps-management_create-app_create-app_component_ts-projects_eav-ui_sr-6ada4b.0c7280f9b6895ae1.js","mappings":"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","names":["appNamePattern","i0","ctx_r1","appNameError","CreateAppComponent_Conditional_0_Conditional_13_Conditional_0_Template","CreateAppComponent_Conditional_0_Conditional_13_Conditional_1_Template","form","controls","name","errors","required","pattern","CreateAppComponent_Conditional_0_Conditional_13_Template","$event","_r1","appTemplateId","closeDialog","create","touched","vm_r3","loading","valid","CreateAppComponent","constructor","dialog","snackBar","this","hostClass","appsListService","transient","AppsListService","buildForm","loading$","BehaviorSubject","ngOnInit","viewModel$","pipe","map","ngOnDestroy","complete","close","disable","next","value","trim","replace","Number","open","subscribe","error","enable","undefined","duration","UntypedFormGroup","UntypedFormControl","Validators","i1","i2","selectors","hostVars","hostBindings","rf","ctx","CreateAppComponent_Conditional_0_Template","tmp_0_0","RouterOutlet","FormsModule","i3","ReactiveFormsModule","MatFormFieldModule","i4","MatInputModule","i5","MatSelectModule","i6","i7","MatOptionModule","MatDialogActions","MatButtonModule","i8","AsyncPipe","FieldHintComponent","encapsulation","webApiAppRoot","ImportAppService","HttpServiceBase","importApp","file","changedName","retryOnDuplicate","formData","FormData","append","http","post","apiUrl","params","zoneId","switchMap","result","Messages","MessageType","FileUploadMessageTypes","Warning","folderName","prompt","Text","of","__ngFactoryType__","factory","Éµfac","FieldHintComponent_Case_1_ng_container_1_Template","content_r2","FieldHintComponent_Case_2_ng_container_1_Template","isError","isShort","toggleIsShort","inputs","standalone","features","ngContentSelectors","_c0","decls","vars","consts","template","FieldHintComponent_Case_1_Template","FieldHintComponent_Case_2_Template","FieldHintComponent_ng_template_3_Template","_c1","tmp_2_0","NgClass","NgTemplateOutlet","styles"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/apps-management/constants/app.patterns.ts","./projects/eav-ui/src/app/apps-management/create-app/create-app.component.html","./projects/eav-ui/src/app/apps-management/create-app/create-app.component.ts","./projects/eav-ui/src/app/import-app/services/import-app.service.ts","./projects/eav-ui/src/app/shared/components/field-hint/field-hint.component.html","./projects/eav-ui/src/app/shared/components/field-hint/field-hint.component.ts"],"sourcesContent":["export const appNamePattern = /^[A-Za-z](?:[A-Za-z0-9\\s\\(\\)-]+)*$/;\r\nexport const appNameError = 'Standard letters, numbers, spaces, hyphens and round brackets are allowed. Must start with a letter.';\r\n","@if (viewModel$ | async; as vm) {\r\n  <div class=\"eav-dialog\">\r\n    <div class=\"eav-dialog-header\">\r\n      <div class=\"eav-dialog-header__title\">Create App</div>\r\n    </div>\r\n    <div class=\"eav-dialog-content\">\r\n      <router-outlet></router-outlet>\r\n      <form [formGroup]=\"form\">\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Name</mat-label>\r\n          <input matInput type=\"text\" formControlName=\"name\">\r\n        </mat-form-field>\r\n        <app-field-hint>\r\n          App name will also be used for the folder\r\n        </app-field-hint>\r\n        @if (form.controls.name.touched) {\r\n          @if (form.controls.name.errors?.required) {\r\n            <app-field-hint [isError]=\"true\">\r\n              Required\r\n            </app-field-hint>\r\n          }\r\n          @if (form.controls.name.errors?.pattern) {\r\n            <app-field-hint [isError]=\"true\">\r\n              {{ appNameError }}\r\n            </app-field-hint>\r\n          }\r\n        }\r\n        <br>\r\n\r\n        <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n          <mat-label>Template</mat-label>\r\n          <mat-select required=\"true\" [(value)]=\"appTemplateId\">\r\n            <mat-option value=\"0\">\r\n              Completely Naked / Raw App\r\n            </mat-option>\r\n            <mat-option value=\"1\">\r\n              App Template Empty with some instructions\r\n            </mat-option>\r\n            <mat-option value=\"2\">\r\n              App Template Basic with instructions and some data\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n      </form>\r\n    </div>\r\n    <mat-dialog-actions align=\"end\">\r\n      <button type=\"button\" mat-raised-button [disabled]=\"vm.loading\" (click)=\"closeDialog()\">\r\n        Cancel\r\n      </button>\r\n      <button type=\"button\" mat-raised-button color=\"accent\" [disabled]=\"vm.loading || !form.valid\" (click)=\"create()\">\r\n        Create\r\n      </button>\r\n    </mat-dialog-actions>\r\n  </div>\r\n}\r\n","import { AsyncPipe } from '@angular/common';\r\nimport { Component, HostBinding, OnDestroy, OnInit } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule, UntypedFormControl, UntypedFormGroup, Validators } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogActions, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { RouterOutlet } from '@angular/router';\r\nimport { BehaviorSubject, Observable, map } from 'rxjs';\r\nimport { transient } from '../../../../../core';\r\nimport { FieldHintComponent } from '../../shared/components/field-hint/field-hint.component';\r\nimport { appNameError, appNamePattern } from '../constants/app.patterns';\r\nimport { AppsListService } from '../services/apps-list.service';\r\n\r\n@Component({\r\n  selector: 'app-create-app',\r\n  templateUrl: './create-app.component.html',\r\n  standalone: true,\r\n  imports: [\r\n    RouterOutlet,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatDialogActions,\r\n    MatButtonModule,\r\n    AsyncPipe,\r\n    FieldHintComponent,\r\n  ],\r\n})\r\nexport class CreateAppComponent implements OnInit, OnDestroy {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  form: UntypedFormGroup;\r\n  loading$: BehaviorSubject<boolean>;\r\n  appNameError = appNameError;\r\n  appTemplateId = '1';\r\n\r\n  viewModel$: Observable<CreateAppViewModel>;\r\n\r\n  private appsListService = transient(AppsListService);\r\n\r\n  constructor(\r\n    private dialog: MatDialogRef<CreateAppComponent>,\r\n    private snackBar: MatSnackBar,\r\n  ) {\r\n    this.form = this.buildForm();\r\n    this.loading$ = new BehaviorSubject(false);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.viewModel$ = this.loading$.pipe(\r\n      map((loading) => ({ loading })),\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.loading$.complete();\r\n  }\r\n\r\n  closeDialog(): void {\r\n    this.dialog.close();\r\n  }\r\n\r\n  create(): void {\r\n    this.form.disable();\r\n    this.loading$.next(true);\r\n    const name = this.form.controls.name.value?.trim().replace(/\\s\\s+/g, ' '); // remove multiple white spaces and tabs;\r\n    const appTemplateId = Number(this.appTemplateId);\r\n    // console.warn('2dm: name', name, this.appTemplateId);\r\n    // return;\r\n\r\n    this.snackBar.open('Creating app...');\r\n    this.appsListService.create(name, null, appTemplateId).subscribe({\r\n      error: () => {\r\n        this.form.enable();\r\n        this.loading$.next(false);\r\n        this.snackBar.open('Failed to create app. Please check console for more information', undefined, { duration: 3000 });\r\n      },\r\n      next: () => {\r\n        this.form.enable();\r\n        this.snackBar.open('Created app', undefined, { duration: 2000 });\r\n        this.closeDialog();\r\n      },\r\n    });\r\n  }\r\n\r\n  private buildForm(): UntypedFormGroup {\r\n    const form = new UntypedFormGroup({\r\n      name: new UntypedFormControl(null, [Validators.required, Validators.pattern(appNamePattern)]),\r\n    });\r\n    return form;\r\n  }\r\n}\r\n\r\ninterface CreateAppViewModel {\r\n  loading: boolean;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, switchMap } from 'rxjs';\r\nimport { FileUploadMessageTypes, FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\n\r\nexport const webApiAppRoot = 'admin/app/';\r\n\r\n@Injectable()\r\nexport class ImportAppService extends HttpServiceBase {\r\n\r\n  importApp(file: File, changedName: string, retryOnDuplicate = false): Observable<FileUploadResult> {\r\n    const formData = new FormData();\r\n    formData.append('File', file);\r\n    formData.append('Name', changedName ?? '');\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiAppRoot + 'Import'), formData, {\r\n      params: { zoneId: this.zoneId }\r\n    }).pipe(\r\n      switchMap(result => {\r\n        if (retryOnDuplicate && result.Messages[0]?.MessageType === FileUploadMessageTypes.Warning) {\r\n          const folderName = prompt(result.Messages[0].Text + ' Would you like to install it using another folder name?');\r\n          if (folderName) {\r\n            return this.importApp(file, folderName, true);\r\n          }\r\n        }\r\n        return of(result);\r\n      }),\r\n    );\r\n  }\r\n}\r\n","<div class=\"hint-box\" (click)=\"toggleIsShort()\" [ngClass]=\"{ 'hint-box__short': isShort }\">\r\n  @switch (isError) {\r\n    @case (false) {\r\n      <mat-hint>\r\n        <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n      </mat-hint>\r\n    }\r\n    @case (true) {\r\n      <mat-error>\r\n        <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n      </mat-error>\r\n    }\r\n  }\r\n</div>\r\n\r\n<ng-template #content>\r\n  <ng-content></ng-content>\r\n</ng-template>\r\n","import { NgClass, NgTemplateOutlet } from '@angular/common';\r\nimport { Component, Input } from '@angular/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\n\r\n@Component({\r\n  selector: 'app-field-hint',\r\n  templateUrl: './field-hint.component.html',\r\n  styleUrls: ['./field-hint.component.scss'],\r\n  standalone: true,\r\n  imports: [\r\n    MatFormFieldModule,\r\n    NgClass,\r\n    NgTemplateOutlet\r\n  ]\r\n})\r\nexport class FieldHintComponent {\r\n  @Input() isError = false;\r\n  isShort = true;\r\n\r\n  constructor() { }\r\n\r\n  toggleIsShort() {\r\n    this.isShort = !this.isShort;\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}