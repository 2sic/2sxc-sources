"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fields-6790f5"],{4099:(P,T,n)=>{n.r(T),n.d(T,{EditContentTypeFieldsComponent:()=>rt});var v=n(316),d=n(4456),E=n(4175),_=n(5060),I=n(7941),O=n(4950),f=n(3840),S=n(7984),p=n(5175),r=n(852),g=n(5797),M=n(1870),R=n(6647),h=n(271),A=n(1873),m=n(9452),u=n(1567),D=n(1903),$=n(1318),N=n(3143),j=n(2938),L=n(7703),K=n(7693),X=n(3176),W=n(3758),J=n(5959),F=n(1726),G=n(4202),y=n(4007);const H={Boolean:{label:(0,y.D)(F.O.Boolean),description:"Yes/no or true/false values"},Custom:{label:(0,y.D)(F.O.Custom),description:"Use for things like gps-pickers (which writes into multiple fields) or for custom-data which serializes something exotic into the db like an array, a custom json or anything"},DateTime:{label:(0,y.D)(F.O.DateTime),description:"For date, time or combined values"},Empty:{label:(0,y.D)(F.O.Empty),description:"Use to structure your form"},Entity:{label:(0,y.D)(F.O.Entity),description:"One or more other content-items"},Hyperlink:{label:(0,y.D)(F.O.Hyperlink),description:"Hyperlink or reference to a picture / file"},Number:{label:(0,y.D)(F.O.Number),description:"Any kind of number"},String:{label:(0,y.D)(F.O.String),description:"Any kind of text"}};var U=n(5160),t=n(9148),k=n(2159),z=n(3347);const Q=["ngForm"],Z=["autoFocusInputField"],w=o=>({"eav-input-obsolete":o});function q(o,l){1&o&&t.EFF(0," Fields ")}function tt(o,l){1&o&&t.EFF(0," Add Fields ")}function et(o,l){1&o&&t.EFF(0," Edit Field ")}function nt(o,l){if(1&o&&(t.j41(0,"app-field-hint",19),t.EFF(1),t.k0s()),2&o){const e=t.XpG(4);t.Y8G("isError",!0),t.R7$(),t.JRh(e.fieldNameError)}}function it(o,l){if(1&o&&(t.j41(0,"app-field-hint",19),t.EFF(1),t.k0s()),2&o){t.XpG(2);const e=t.sdS(6);t.Y8G("isError",!0),t.R7$(),t.SpI(" ",e.errors.reservedNames," ")}}function st(o,l){if(1&o&&t.DNE(0,nt,2,2,"app-field-hint",19)(1,it,2,2,"app-field-hint",19),2&o){t.XpG();const e=t.sdS(6);t.vxM(e.errors.pattern?0:-1),t.R7$(),t.vxM(e.errors.reservedNames?1:-1)}}function ot(o,l){if(1&o&&(t.j41(0,"mat-option",16)(1,"mat-icon",15),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()),2&o){const e=l.$implicit;t.Y8G("value",e.name),t.R7$(2),t.JRh(e.icon),t.R7$(2),t.JRh(e.label)}}function at(o,l){if(1&o&&(t.j41(0,"mat-icon",17),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.icon)}}function lt(o,l){if(1&o&&(t.j41(0,"mat-option",18)(1,"div")(2,"span"),t.EFF(3),t.k0s(),t.DNE(4,at,2,1,"mat-icon",17),t.k0s()()),2&o){const e=l.$implicit;t.Y8G("value",e.inputType)("ngClass",t.eq3(4,w,e.isObsolete)),t.R7$(3),t.JRh(e.label),t.R7$(),t.vxM(e.icon?4:-1)}}function dt(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",7)(1,"div",11)(2,"mat-form-field",12)(3,"mat-label"),t.EFF(4,"Name"),t.k0s(),t.j41(5,"input",13,1),t.mxI("ngModelChange",function(s){const a=t.eBV(e).$implicit;return t.DH7(a.StaticName,s)||(a.StaticName=s),t.Njj(s)}),t.k0s()(),t.DNE(8,st,2,2),t.k0s(),t.j41(9,"div",11)(10,"mat-form-field",12)(11,"mat-label"),t.EFF(12,"Data Type"),t.k0s(),t.j41(13,"mat-select",14),t.bIt("selectionChange",function(){const s=t.eBV(e).$index,a=t.XpG(2);return a.filterInputTypeOptions(s),a.resetInputType(s),t.Njj(a.calculateHints(s))}),t.mxI("ngModelChange",function(s){const a=t.eBV(e).$implicit;return t.DH7(a.Type,s)||(a.Type=s),t.Njj(s)}),t.j41(14,"mat-select-trigger")(15,"mat-icon",15),t.EFF(16),t.k0s(),t.j41(17,"span"),t.EFF(18),t.k0s()(),t.Z7z(19,ot,5,3,"mat-option",16,t.fX1),t.k0s()(),t.j41(21,"app-field-hint"),t.EFF(22),t.k0s()(),t.j41(23,"div",11)(24,"mat-form-field",12)(25,"mat-label"),t.EFF(26,"Input Type"),t.k0s(),t.j41(27,"mat-select",14),t.bIt("selectionChange",function(){const s=t.eBV(e).$index,a=t.XpG(2);return t.Njj(a.calculateHints(s))}),t.mxI("ngModelChange",function(s){const a=t.eBV(e).$implicit;return t.DH7(a.InputType,s)||(a.InputType=s),t.Njj(s)}),t.j41(28,"mat-select-trigger")(29,"span"),t.EFF(30),t.k0s(),t.j41(31,"mat-icon",17),t.EFF(32),t.k0s()(),t.Z7z(33,lt,5,6,"mat-option",18,t.fX1),t.k0s()(),t.j41(35,"app-field-hint"),t.EFF(36),t.k0s()()()}if(2&o){let e,i;const s=l.$implicit,a=l.$index,x=t.sdS(6),c=t.XpG(2);t.R7$(5),t.Y8G("pattern",c.fieldNamePattern)("appReservedNames",c.reservedNames),t.R50("ngModel",s.StaticName),t.Y8G("name","StaticName"+a)("disabled","inputType"===c.editMode),t.R7$(3),t.vxM(x.touched&&x.errors?8:-1),t.R7$(5),t.R50("ngModel",s.Type),t.Y8G("name","Type"+a)("disabled",null!=c.editMode),t.R7$(3),t.JRh(c.findIcon(s.Type)),t.R7$(2),t.JRh(c.findLabel(s.Type)),t.R7$(),t.Dyx(c.dataTypes),t.R7$(3),t.JRh(c.dataTypeHints[a]),t.R7$(5),t.R50("ngModel",s.InputType),t.Y8G("name","InputType"+a)("disabled","name"===c.editMode),t.R7$(3),t.JRh(null==(e=c.getInputTypeOption(s.InputType))?null:e.label),t.R7$(2),t.JRh(null==(i=c.getInputTypeOption(s.InputType))?null:i.icon),t.R7$(),t.Dyx(c.filteredInputTypeOptions[a]),t.R7$(3),t.JRh(c.inputTypeHints[a])}}function pt(o,l){if(1&o){const e=t.RV6();t.j41(0,"form",5,0),t.bIt("ngSubmit",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.save())}),t.j41(2,"div",6),t.Z7z(3,dt,37,18,"div",7,t.fX1),t.k0s(),t.j41(5,"mat-dialog-actions"),t.nrm(6,"div",8),t.j41(7,"button",9),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.dialog.close())}),t.EFF(8,"Cancel"),t.k0s(),t.j41(9,"button",10),t.nI1(10,"async"),t.EFF(11,"Save"),t.k0s()()()}if(2&o){const e=t.sdS(1),i=t.XpG();t.R7$(3),t.Dyx(i.fields),t.R7$(6),t.Y8G("disabled",!e.form.valid||t.bMT(10,1,i.saving$))}}let rt=(()=>{class o extends X.${#n;#e;#i;#t;constructor(e,i,s){super(),this.dialog=e,this.route=i,this.snackBar=s,this.hostClass="dialog-component",this.fields=[],this.reservedNames={},this.filteredInputTypeOptions=[],this.dataTypeHints=[],this.inputTypeHints=[],this.fieldNamePattern=L.w,this.fieldNameError=L.s,this.findIcon=y.y,this.findLabel=y.D,this.loading$=new g.t(!0),this.saving$=new g.t(!1),this.#i=(0,j.d)(K.g),this.#t=(0,j.d)(J.h),this.dialog.disableClose=!0,this.subscriptions.add(this.dialog.backdropClick().subscribe(a=>{this.form.dirty&&!confirm("You have unsaved changes. Are you sure you want to close this dialog?")||this.dialog.close()}))}ngAfterViewInit(){this.autoFocusInputField&&setTimeout(()=>{this.autoFocusInputField.first.nativeElement.focus()},250)}trackField(e,i){return i.StaticName}ngOnInit(){this.editMode=this.route.snapshot.paramMap.get("editMode");const e=this.route.snapshot.paramMap.get("contentTypeStaticName"),i=this.#i.retrieveContentType(e).pipe((0,M.u)()),s=i.pipe((0,R.n)(b=>this.#t.getFields(b.StaticName))),a=this.#t.typeListRetrieve().pipe((0,h.T)(b=>function Y(o){const l=[];for(const e of o)l.push({name:e,label:H[e].label,icon:(0,y.y)(e),description:H[e].description});return l}(b))),x=this.#t.getInputTypesList(),c=this.#t.getReservedNames();(0,A.p)([i,s,a,x,c]).subscribe(([b,B,ct,mt,ut])=>{if(this.#n=b,this.dataTypes=ct,this.#e=mt,this.reservedNames=U.O.mergeReserved(ut,B),null!=this.editMode){const C=this.route.snapshot.paramMap.get("id")?parseInt(this.route.snapshot.paramMap.get("id"),10):null,V=B.find(ht=>ht.Id===C);"name"===this.editMode&&delete this.reservedNames[V.StaticName],this.fields.push(V)}else for(let C=1;C<=8;C++)this.fields.push({Id:0,Type:F.O.String,InputType:G.u.StringDefault,StaticName:"",IsTitle:0===B.length,SortOrder:B.length+C});for(let C=0;C<this.fields.length;C++)this.filterInputTypeOptions(C),this.calculateHints(C);this.loading$.next(!1)})}ngOnDestroy(){this.loading$.complete(),this.saving$.complete(),super.ngOnDestroy()}filterInputTypeOptions(e){this.filteredInputTypeOptions[e]=this.#e.filter(i=>i.dataType===this.fields[e].Type.toLocaleLowerCase())}resetInputType(e){let i=this.fields[e].Type.toLocaleLowerCase()+G.u.DefaultSuffix;this.filteredInputTypeOptions[e].some(a=>a.inputType===i)||(i=this.filteredInputTypeOptions[e][0].inputType),this.fields[e].InputType=i}calculateHints(e){const i=this.dataTypes.find(a=>a.name===this.fields[e].Type),s=this.#e.find(a=>a.inputType===this.fields[e].InputType);this.dataTypeHints[e]=i?.description??"",this.inputTypeHints[e]=s?.isObsolete?`OBSOLETE - ${s.obsoleteMessage}`:s?.description??""}getInputTypeOption(e){return this.#e.find(i=>i.inputType===e)}save(){this.saving$.next(!0),this.snackBar.open("Saving...");const e=()=>{this.saving$.next(!1),this.snackBar.open("Saved",null,{duration:2e3}),this.dialog.close()};if(null!=this.editMode){const i=this.fields[0];"name"===this.editMode?this.#t.rename(i.Id,this.#n.Id,i.StaticName).subscribe(()=>e()):"inputType"===this.editMode&&this.#t.updateInputType(i.Id,i.StaticName,i.InputType).subscribe(()=>e())}else(0,m.of)(...this.fields).pipe((0,u.p)(i=>!!i.StaticName),(0,D.H)(i=>this.#t.add(i,this.#n.Id).pipe((0,$.W)(s=>(0,m.of)(null)))),(0,N.$)()).subscribe(()=>e())}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(I.CP),t.rXU(k.nX),t.rXU(z.UG))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-edit-content-type-fields"]],viewQuery:function(i,s){if(1&i&&(t.GBs(Q,5,d.cV),t.GBs(Z,5)),2&i){let a;t.mGM(a=t.lsd())&&(s.form=a.first),t.mGM(a=t.lsd())&&(s.autoFocusInputField=a)}},hostVars:1,hostBindings:function(i,s){2&i&&t.Mr5("className",s.hostClass)},standalone:!0,features:[t.Vt3,t.aNF],decls:8,vars:6,consts:[["ngForm","ngForm"],["staticName","ngModel","autoFocusInputField",""],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[3,"ngSubmit"],[1,"eav-dialog-content"],[1,"eav-row-container"],[1,"spacer"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","submit","color","accent",3,"disabled"],[1,"eav-edit-input"],["color","accent",1,"eav-mat-form-field"],["matInput","",3,"ngModelChange","pattern","appReservedNames","ngModel","name","disabled"],[3,"selectionChange","ngModelChange","ngModel","name","disabled"],[1,"eav-type-icon"],[3,"value"],[1,"eav-input-icon"],[3,"value","ngClass"],[3,"isError"]],template:function(i,s){1&i&&(t.j41(0,"div",2)(1,"div",3)(2,"div",4),t.DNE(3,q,1,0)(4,tt,1,0)(5,et,1,0),t.k0s()(),t.DNE(6,pt,12,3,"form"),t.nI1(7,"async"),t.k0s()),2&i&&(t.R7$(3),t.vxM(void 0===s.editMode?3:-1),t.R7$(),t.vxM(null===s.editMode?4:-1),t.R7$(),t.vxM(null!=s.editMode?5:-1),t.R7$(),t.vxM(!1===t.bMT(7,4,s.loading$)?6:-1))},dependencies:[d.YN,d.qT,d.me,d.BC,d.cb,d.R_,d.vS,d.cV,O.RG,O.rl,O.nJ,S.fS,S.fg,U.O,p.Ve,p.VO,p.$2,_.wT,f.m_,f.An,_.Sy,v.YU,I.E7,E.Hl,E.$z,v.Jj,r.h,W.F],styles:[".eav-row-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.eav-edit-input[_ngcontent-%COMP%]{padding-bottom:8px;width:30%}.eav-type-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;margin-right:8px;font-size:inherit;vertical-align:top;line-height:inherit}.eav-input-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;margin-left:8px;font-size:inherit;vertical-align:top;line-height:inherit}.eav-input-obsolete[_ngcontent-%COMP%]{-webkit-text-decoration:black line-through;text-decoration:black line-through;color:#696969}"]})}}return o})()},1726:(P,T,n)=>{n.d(T,{O:()=>v});const v={Boolean:"Boolean",Custom:"Custom",DateTime:"DateTime",Empty:"Empty",Entity:"Entity",Hyperlink:"Hyperlink",Number:"Number",String:"String"}},9234:(P,T,n)=>{n.d(T,{Gg:()=>M,Tr:()=>R,gb:()=>g});var v=n(1567),d=n(6647),E=n(6301),_=n(271),I=n(2938),O=n(4435),f=n(6474),S=n(4839),p=n(9148);const r={all:!1,getEntities:!1,getAvailableEntities:!1,delete:!1},g="admin/entity/",M="admin/entity/list";let R=(()=>{class h extends f.D{constructor(){super(...arguments),this.log=(0,O.T)({EntityService:h},r),this.queryService=(0,I.d)(S.c)}getEntities$(m){return this.log.fnIf("getEntities"),m.pipe((0,v.p)(u=>null!=u),(0,d.n)(u=>this.getAvailableEntities(u.contentTypeName).pipe((0,E.t)(1))))}getAvailableEntities(m,u){return this.log.fnIf("getAvailableEntities"),this.queryService.getEntities({contentTypes:[m],itemIds:u,fields:"Id,Guid,Title",log:"getAvailableEntities"}).pipe((0,_.T)($=>$.Default))}delete(m,u,D,$,N,j){return this.log.fnIf("delete",{appId:m,contentType:u,entityId:D,force:$,parentId:N,parent}),this.http.delete(this.apiUrl(g+"delete"),{params:{contentType:u,id:D.toString(),appId:m,force:$.toString(),...N&&{parentId:N.toString()},...N&&j&&{parentField:j}}})}static{this.\u0275fac=(()=>{let m;return function(D){return(m||(m=p.xGo(h)))(D||h)}})()}static{this.\u0275prov=p.jDH({token:h,factory:h.\u0275fac})}}return h})()},4839:(P,T,n)=>{n.d(T,{c:()=>O});var v=n(4435),d=n(8873),E=n(9148),_=n(6443);const I={all:!1,getAvailableEntities:!1,getEntities:!1};let O=(()=>{class f{constructor(p,r){this.http=p,this.context=r,this.log=(0,v.T)({QueryService:f},I)}getFromQuery(p,r,g,M){this.log.fnIf("getAvailableEntities",{queryUrl:p,params:r,fields:g,entitiesFilter:M});const R=!!r,u=(((r?.toLocaleLowerCase()??"").includes("appid=")?"":`&appId=${this.context.appId}`)+(R?`&${r}`:"")+"&$select="+(g??"")).substring(1);return this.http.post(`app/auto/query/${p}?${u}`,{Guids:M})}getEntities({contentTypes:p,itemIds:r,fields:g,log:M}){this.log.fnIf("getEntities",{log:M,contentTypes:p,itemIds:r,fields:g});const h=("&typeNames="+(p?.join(",")??"")+`&appId=${this.context.appId}&itemIds=`+(r?.join(",")??"")+"&$select="+(g??"")).substring(1);return this.http.post(`app/auto/query/System.EntityPicker/Default?${h}`,{})}static{this.\u0275fac=function(r){return new(r||f)(E.KVO(_.Qq),E.KVO(d.o))}}static{this.\u0275prov=E.jDH({token:f,factory:f.\u0275fac})}}return f})()},9923:(P,T,n)=>{n.d(T,{T:()=>E});var v=n(5392),d=n(819);function E(_,I){return(0,d.N)((0,v.S)(_,I,arguments.length>=2,!1,!0))}}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.02.00/dist/ng-edit/projects_eav-ui_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fields-6790f5.465867e353da36ba.js.map