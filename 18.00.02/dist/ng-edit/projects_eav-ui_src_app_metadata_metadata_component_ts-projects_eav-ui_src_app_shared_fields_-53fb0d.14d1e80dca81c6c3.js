"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_metadata_metadata_component_ts-projects_eav-ui_src_app_shared_fields_-53fb0d","projects_eav-ui_src_app_permissions_permissions_routing_ts"],{7693:(y,g,n)=>{n.d(g,{X:()=>h,g:()=>p});var l=n(271),_=n(8873),o=n(7580),u=n(6443),m=n(4821);const h="admin/type/",T="admin/type/scopes";let p=(()=>{class r{constructor(t,x,R){this.http=t,this.context=x,this.dnnContext=R}apiUrl(t){return this.dnnContext.$2sxc.http.apiUrl(t)}retrieveContentType(t){return this.http.get(this.apiUrl("admin/type/get"),{params:{appId:this.context.appId.toString(),contentTypeId:t}})}retrieveContentTypes(t){return this.http.get(this.apiUrl("admin/type/list"),{params:{appId:this.context.appId.toString(),scope:t}})}getScopes(){return this.http.get(this.apiUrl(T),{params:{appId:this.context.appId.toString()}}).pipe((0,l.T)(t=>{const x=t.old;return Object.keys(x).map(F=>({name:x[F],value:F}))}))}getScopesV2(){return this.http.get(this.apiUrl(T),{params:{appId:this.context.appId.toString()}}).pipe((0,l.T)(t=>t.scopes))}save(t){return this.http.post(this.apiUrl("admin/type/save"),t,{params:{appid:this.context.appId.toString()}})}delete(t){return this.http.delete(this.apiUrl("admin/type/delete"),{params:{appid:this.context.appId.toString(),staticName:t.StaticName}})}import(t){const x=new FormData;for(const R of t)x.append("File",R);return this.http.post(this.apiUrl("admin/type/import"),x,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}createGhost(t){return this.http.post(this.apiUrl("admin/type/addghost"),null,{params:{appid:this.context.appId.toString(),sourceStaticName:t}})}static#t=this.\u0275fac=function(x){return new(x||r)(o.KVO(u.Qq),o.KVO(_.o),o.KVO(m.ob))};static#e=this.\u0275prov=o.jDH({token:r,factory:r.\u0275fac})}return r})()},1475:(y,g,n)=>{n.d(g,{j:()=>h});var l=n(8873),_=n(8624),o=n(7580),u=n(6443),m=n(4821);let h=(()=>{class c{constructor(T,C,v){this.http=T,this.context=C,this.dnnContext=v}getContentInfo(T){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(_.Q+"Get"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),scope:T}})}exportParts(T,C,v){const f=this.dnnContext.$2sxc.http.apiUrl(_.Q+"Export")+"?appId="+this.context.appId.toString()+"&zoneId="+this.context.zoneId.toString()+"&contentTypeIdsString="+T.join(";")+"&entityIdsString="+C.join(";")+"&templateIdsString="+v.join(";");window.open(f,"_blank","")}static#t=this.\u0275fac=function(C){return new(C||c)(o.KVO(u.Qq),o.KVO(l.o),o.KVO(m.ob))};static#e=this.\u0275prov=o.jDH({token:c,factory:c.\u0275fac})}return c})()},320:(y,g,n)=>{n.d(g,{t:()=>h});var l=n(1772),_=n(8873),o=n(7580),u=n(6443),m=n(4821);let h=(()=>{class c{constructor(T,C,v){this.http=T,this.context=C,this.dnnContext=v}getAppInfo(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(l.u+"Statistics"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}exportAppUrl(){return`${this.dnnContext.$2sxc.http.apiUrl(`${l.u}Export`)}?appId=${this.context.appId}&zoneId=${this.context.zoneId}`}exportForVersionControl({includeContentGroups:T,resetAppGuid:C,withFiles:v}){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(l.u+"SaveData"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),includeContentGroups:T.toString(),resetAppGuid:C.toString(),withPortalFiles:v.toString()}})}static#t=this.\u0275fac=function(C){return new(C||c)(o.KVO(u.Qq),o.KVO(_.o),o.KVO(m.ob))};static#e=this.\u0275prov=o.jDH({token:c,factory:c.\u0275fac})}return c})()},8624:(y,g,n)=>{n.d(g,{Q:()=>h,S:()=>c});var l=n(1772),_=n(8873),o=n(7580),u=n(6443),m=n(4821);const h="admin/appParts/";let c=(()=>{class E{constructor(C,v,f){this.http=C,this.context=v,this.dnnContext=f}importAppParts(C){const v=new FormData;return v.append("File",C),this.http.post(this.dnnContext.$2sxc.http.apiUrl(h+"Import"),v,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}resetApp(C){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(l.u+"Reset"),{},{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),withPortalFiles:C.toString()}})}static#t=this.\u0275fac=function(v){return new(v||E)(o.KVO(u.Qq),o.KVO(_.o),o.KVO(m.ob))};static#e=this.\u0275prov=o.jDH({token:E,factory:E.\u0275fac})}return E})()},5445:(y,g,n)=>{n.d(g,{Cu:()=>h.Cu,JL:()=>h.JL,Mk:()=>h.Mk,ei:()=>h.ei,gs:()=>_.g,tn:()=>l.t,vN:()=>h.vN,xR:()=>h.xR,y0:()=>c.y});var l=n(6163),_=n(7693),h=(n(1475),n(320),n(8624),n(6460)),c=n(2570)},6460:(y,g,n)=>{n.d(g,{Cu:()=>r,JL:()=>D,Mk:()=>d,ei:()=>p,vN:()=>t,xR:()=>x});var l=n(4600),_=n(6647),o=n(271),u=n(693),m=n(8873),h=n(9234),c=n(7580),E=n(6443),T=n(4821);const d="admin/query/Run",p="admin/query/DebugStream",r="admin/query/Save",D="admin/query/Get",t="admin/query/DataSources";let x=(()=>{class R{constructor(O,U,$){this.http=O,this.context=U,this.dnnContext=$}getAll(O){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(h.Gg),{params:{appId:this.context.appId.toString(),contentType:O}})}importQuery(O){return(0,l.H)((0,u.n)(O)).pipe((0,_.n)(U=>this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/query/import"),{AppId:this.context.appId.toString(),ContentBase64:U})),(0,o.T)(U=>({Success:U,Messages:[]})))}clonePipeline(O){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/query/Clone"),{params:{Id:O.toString(),appId:this.context.appId.toString()}})}delete(O){return this.http.delete(this.dnnContext.$2sxc.http.apiUrl("admin/query/Delete"),{params:{appId:this.context.appId.toString(),Id:O.toString()}})}static#t=this.\u0275fac=function(U){return new(U||R)(c.KVO(E.Qq),c.KVO(m.o),c.KVO(T.ob))};static#e=this.\u0275prov=c.jDH({token:R,factory:R.\u0275fac})}return R})()},2570:(y,g,n)=>{n.d(g,{y:()=>v});var l=n(8873),_=n(7580),o=n(6443),u=n(4821);const m="admin/view/",h=m+"all",c=m+"delete",E=m+"import",T=m+"polymorphism",C=m+"usage";let v=(()=>{class f{constructor(p,r,D){this.http=p,this.context=r,this.dnnContext=D}getAll(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(h),{params:{appId:this.context.appId.toString()}})}delete(p){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(c),{params:{appId:this.context.appId.toString(),Id:p.toString()}})}import(p){const r=new FormData;return r.append("File",p),this.http.post(this.dnnContext.$2sxc.http.apiUrl(E),r,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}export(p){const r=this.dnnContext.$2sxc.http.apiUrl(m+"json")+"?appId="+this.context.appId+"&viewId="+p;window.open(r,"_blank","")}getPolymorphism(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(T),{params:{appId:this.context.appId.toString()}})}getUsage(p){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(C),{params:{appId:this.context.appId.toString(),guid:p}})}static#t=this.\u0275fac=function(r){return new(r||f)(_.KVO(o.Qq),_.KVO(l.o),_.KVO(u.ob))};static#e=this.\u0275prov=_.jDH({token:f,factory:f.\u0275fac})}return f})()},4305:(y,g,n)=>{n.r(g),n.d(g,{MetadataComponent:()=>xt});var l=n(7941),_=n(2159),o=n(5797),u=n(271),m=n(9999),h=n(4334),c=n(336),E=n(6817),T=n(4096),C=n(251),v=n(52),f=n(3216),d=n(334),p=n(4175),r=n(3777),D=n(9914),t=n(7580);function x(a,M){if(1&a&&(t.nrm(0,"mat-card-subtitle",0),t.nI1(1,"safeHtml")),2&a){const e=t.XpG();t.Y8G("innerHtml",t.bMT(1,1,e.dialogData.message),t.npT)}}let R=(()=>{class a{constructor(e,i){this.dialogData=e,this.dialogRef=i,this.hostClass="dialog-component"}closeDialog(e){this.dialogRef.close(e)}static#t=this.\u0275fac=function(i){return new(i||a)(t.rXU(l.Vh),t.rXU(l.CP))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-confirm-delete-dialog"]],hostVars:1,hostBindings:function(i,s){2&i&&t.Mr5("className",s.hostClass)},standalone:!0,features:[t.aNF],decls:10,vars:3,consts:[[3,"innerHtml"],["align","end"],["mat-raised-button","",1,"eav-card-action-button",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3),t.k0s(),t.DNE(4,x,2,3,"mat-card-subtitle",0),t.k0s(),t.j41(5,"mat-card-actions",1)(6,"button",2),t.bIt("click",function(){return s.closeDialog()}),t.EFF(7,"Cancel"),t.k0s(),t.j41(8,"button",2),t.bIt("click",function(){return s.closeDialog(!0)}),t.EFF(9,"Delete"),t.k0s()()()),2&i&&(t.R7$(3),t.Lme("Delete ",s.dialogData.entityTitle," (",s.dialogData.entityId,")?"),t.R7$(),t.vxM(4,s.dialogData.message?4:-1))},dependencies:[r.Hu,r.RN,r.YY,r.MM,r.Lc,r.dh,p.Hl,p.$z,D.$],styles:[".eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}return a})();var F=n(3840),O=n(5060);let U=(()=>{class a{agInit(e){this.params=e}refresh(e){return!0}deleteMetadata(){this.params.onDelete(this.params.data)}static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-actions"]],standalone:!0,features:[t.aNF],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1),t.bIt("click",function(){return s.deleteMetadata()}),t.j41(2,"mat-icon"),t.EFF(3,"delete"),t.k0s()()())},dependencies:[O.pZ,O.r6,F.m_,F.An]})}return a})();var $=n(7896);let k=(()=>{class a{agInit(e){this.value=e.value,this.metadata=e.data}refresh(e){return!0}static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-content-type"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[1,"container",3,"tippy","tippyDisabled"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&i&&(t.Y8G("tippy",s.metadata._Type.Description)("tippyDisabled",!s.metadata._Type.Description),t.R7$(),t.SpI(" ",s.value,"\n"))},dependencies:[$.e],styles:[".container[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}"]})}return a})();var P=n(4456),L=n(8827),H=n(3037),z=n(1817),Q=n(5445),N=n(5858),B=n(316),V=n(7984),W=n(5175),j=n(5944),w=n(3758),J=n(9333),b=n(5437);const X=a=>({active:a});function Z(a,M){if(1&a&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&a){const e=M.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",e.name," ")}}function q(a,M){if(1&a&&(t.j41(0,"mat-form-field",2)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",13),t.Z7z(4,Z,2,2,"mat-option",14,t.fX1),t.j41(6,"mat-option",14),t.EFF(7,"Other..."),t.k0s()()(),t.j41(8,"app-field-hint"),t.EFF(9," The scope should almost never be changed - "),t.j41(10,"a",15),t.EFF(11,"see help"),t.k0s()()),2&a){const e=t.XpG(),i=t.XpG();t.R7$(3),t.Y8G("placeholder",e.scopeOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.scopeOptions),t.R7$(2),t.Y8G("value",i.dropdownInsertValue)}}function tt(a,M){if(1&a&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&a){const e=M.$implicit;t.Y8G("value",e.StaticName),t.R7$(),t.SpI(" ",e.Label," ")}}function et(a,M){if(1&a&&(t.j41(0,"mat-select",3),t.Z7z(1,tt,2,2,"mat-option",14,t.fX1),t.k0s()),2&a){const e=t.XpG();t.Y8G("placeholder",e.contentTypes.length?"":"No items found"),t.R7$(),t.Dyx(e.contentTypes)}}function nt(a,M){1&a&&t.nrm(0,"input",4)}function at(a,M){1&a&&(t.j41(0,"app-field-hint",8),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function ot(a,M){if(1&a){const e=t.RV6();t.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3,"Create Metadata"),t.k0s(),t.j41(4,"mat-card-subtitle"),t.EFF(5," This is a special operation to add an item which is metadata for another item, see "),t.j41(6,"a",0),t.EFF(7,"docs"),t.k0s(),t.EFF(8,". "),t.k0s()(),t.j41(9,"mat-card-content")(10,"form",1),t.DNE(11,q,12,2),t.j41(12,"mat-form-field",2)(13,"mat-label"),t.EFF(14,"Content Type"),t.k0s(),t.DNE(15,et,3,1,"mat-select",3)(16,nt,1,0,"input",4),t.j41(17,"div",5)(18,"button",6),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.toggleGuidedContentType(!0))}),t.j41(19,"mat-icon"),t.EFF(20,"search"),t.k0s()(),t.j41(21,"button",7),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.toggleGuidedContentType(!1))}),t.j41(22,"mat-icon"),t.EFF(23,"text_fields"),t.k0s()()()(),t.DNE(24,at,2,1,"app-field-hint",8),t.k0s()(),t.j41(25,"mat-card-actions",9)(26,"mat-slide-toggle",10),t.bIt("change",function(s){t.eBV(e);const I=t.XpG();return t.Njj(I.toggleAdvancedMode(s))}),t.EFF(27),t.k0s(),t.j41(28,"div")(29,"button",11),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.closeDialog())}),t.EFF(30,"Cancel"),t.k0s(),t.j41(31,"button",12),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.confirm())}),t.EFF(32," Confirm "),t.k0s()()()()}if(2&a){const e=t.XpG();t.R7$(10),t.Y8G("formGroup",e.form),t.R7$(),t.vxM(11,e.advancedMode&&e.guidedContentType?11:-1),t.R7$(4),t.vxM(15,e.guidedContentType?15:-1),t.R7$(),t.vxM(16,e.guidedContentType?-1:16),t.R7$(2),t.Y8G("ngClass",t.eq3(10,X,e.guidedContentType)),t.R7$(3),t.Y8G("ngClass",t.eq3(12,X,!e.guidedContentType)),t.R7$(3),t.vxM(24,e.form.controls.contentType.touched&&null!=e.form.controls.contentType.errors&&e.form.controls.contentType.errors.required?24:-1),t.R7$(2),t.Y8G("checked",e.advancedMode),t.R7$(),t.SpI(" ",e.advancedMode?"Advanced":"Simple"," "),t.R7$(4),t.Y8G("disabled",!e.form.valid)}}let it=(()=>{class a{constructor(e){this.dialogRef=e,this.hostClass="dialog-component",this.dropdownInsertValue=N.O,this.guidedContentType=!0,this.advancedMode=!1,this.contentTypesService=(0,b.d)(Q.gs)}ngOnInit(){this.contentTypes$=new o.t([]),this.scopeOptions$=new o.t([]),this.buildForm(),this.fetchScopes(),this.viewModel$=(0,m.z)([this.contentTypes$,this.scopeOptions$]).pipe((0,u.T)(([e,i])=>({contentTypes:e,scopeOptions:i})))}ngOnDestroy(){this.contentTypes$.complete(),this.scopeOptions$.complete()}closeDialog(e){this.dialogRef.close(e)}toggleGuidedContentType(e){this.guidedContentType=e}toggleAdvancedMode(e){this.advancedMode=e.checked}confirm(){const e=this.form.getRawValue();this.closeDialog(e.contentType)}buildForm(){this.form=new P.J3({}),this.form.addControl("contentType",new P.hs(null,[P.k0.required])),this.form.addControl("scope",new P.hs(v.YX.scopes.default.value)),this.form.controls.scope.valueChanges.pipe((0,H.Z)(this.form.controls.scope.value),(0,z.F)()).subscribe(e=>{null!=this.form.controls.contentType.value&&this.form.controls.contentType.patchValue(null),e===N.O?(e=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||v.YX.scopes.default.value,this.scopeOptions$.value.some(i=>i.value===e)||this.scopeOptions$.next([{name:e,value:e},...this.scopeOptions$.value]),this.form.controls.scope.patchValue(e)):this.fetchContentTypes(e)})}fetchContentTypes(e){this.contentTypesService.retrieveContentTypes(e).subscribe(i=>{this.contentTypes$.next(i)})}fetchScopes(){this.contentTypesService.getScopes().subscribe(e=>{this.scopeOptions$.next(e)})}static#t=this.\u0275fac=function(i){return new(i||a)(t.rXU(l.CP))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-save-dialog"]],hostVars:1,hostBindings:function(i,s){2&i&&t.Mr5("className",s.hostClass)},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",1,"eav-mat-form-field"],["formControlName","contentType","required","",3,"placeholder"],["matInput","","type","text","formControlName","contentType","required",""],["matTextSuffix",""],["mat-icon-button","","type","button","tippy","Pick existing value",3,"click","ngClass"],["mat-icon-button","","type","button","tippy","Manual entry",3,"click","ngClass"],[3,"isError"],[1,"eav-card-actions"],["color","accent",3,"change","checked"],["mat-raised-button","",1,"eav-card-action-button",3,"click"],["mat-raised-button","","color","accent",1,"eav-card-action-button",3,"click","disabled"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""]],template:function(i,s){if(1&i&&(t.DNE(0,ot,33,14,"mat-card"),t.nI1(1,"async")),2&i){let I;t.vxM(0,(I=t.bMT(1,1,s.viewModel$))?0:-1,I)}},dependencies:[r.Hu,r.RN,r.YY,r.m2,r.MM,r.Lc,r.dh,P.YN,P.qT,P.me,P.BC,P.cb,P.YS,P.X1,P.j4,P.JD,j.RG,j.rl,j.nJ,j.yw,W.Ve,W.VO,O.wT,O.Sy,V.fS,V.fg,p.Hl,p.$z,p.iY,B.YU,F.m_,F.An,L.mV,L.sG,B.Jj,w.F,J.c],styles:[".eav-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}return a})();var st=n(5541),Y=n(6256),K=n(3183),rt=n(7037),pt=n(5506),A=n(1828),lt=n(8471),ct=n(3347),dt=n(9841);const mt=a=>({"fab-opened":a});function ht(a,M){1&a&&t.EFF(0," This item is not metadata for anything else. ")}function _t(a,M){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Key Number: ",e.itemFor.KeyNumber," ")}}function ut(a,M){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Key Guid: ",e.itemFor.KeyGuid," ")}}function gt(a,M){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Key String: ",e.itemFor.KeyString," ")}}function ft(a,M){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Title: ",e.itemFor.Title," ")}}function Ct(a,M){if(1&a&&(t.EFF(0," This item is metadata for: "),t.nrm(1,"br"),t.EFF(2),t.nrm(3,"br"),t.EFF(4),t.DNE(5,_t,2,1)(6,ut,2,1)(7,gt,2,1)(8,ft,2,1)),2&a){const e=t.XpG();t.R7$(2),t.SpI("Target: ",e.itemFor.Target," "),t.R7$(2),t.SpI("TargetType: ",e.itemFor.TargetType," "),t.R7$(),t.vxM(5,e.itemFor.KeyNumber?5:-1),t.R7$(),t.vxM(6,e.itemFor.KeyGuid?6:-1),t.R7$(),t.vxM(7,e.itemFor.KeyString?7:-1),t.R7$(),t.vxM(8,e.itemFor.Title?8:-1)}}function vt(a,M){if(1&a){const e=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.createMetadata())}),t.j41(1,"mat-icon"),t.EFF(2,"add"),t.k0s()()}}function Tt(a,M){if(1&a&&(t.nrm(0,"div",19),t.nI1(1,"safeHtml")),2&a){const e=t.XpG().$implicit;t.Y8G("innerHTML",t.bMT(1,2,e.Icon),t.npT)("matBadgeHidden",e.Enabled)}}function It(a,M){1&a&&(t.j41(0,"mat-icon"),t.EFF(1,"add"),t.k0s())}function Mt(a,M){if(1&a){const e=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){const s=t.eBV(e).$implicit,I=t.XpG(3);return t.Njj(I.createMetadata(s))}),t.DNE(1,Tt,2,4,"div",19)(2,It,2,0),t.k0s()}if(2&a){const e=M.$implicit;t.BMQ("label",e.Title),t.R7$(),t.vxM(1,e.Icon?1:2)}}function Et(a,M){if(1&a){const e=t.RV6();t.j41(0,"eco-fab-speed-dial",11),t.bIt("openChange",function(s){t.eBV(e);const I=t.XpG(2);return t.Njj(I.openChange(s))}),t.j41(1,"eco-fab-speed-dial-trigger",12)(2,"button",13)(3,"mat-icon",14),t.EFF(4),t.k0s()()(),t.j41(5,"eco-fab-speed-dial-actions",15)(6,"button",16),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.createMetadata())}),t.j41(7,"mat-icon"),t.EFF(8,"search"),t.k0s()(),t.Z7z(9,Mt,3,2,"button",17,t.fX1),t.k0s()()}if(2&a){const e=t.XpG();t.Y8G("ngClass",t.eq3(3,mt,e.fabOpen)),t.R7$(),t.Y8G("spin",!0),t.R7$(3),t.JRh(e.fabOpen?"close":"add"),t.R7$(5),t.Dyx(e.recommendations)}}function Dt(a,M){if(1&a){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.closeDialog())}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"p"),t.DNE(9,ht,1,0)(10,Ct,9,6),t.k0s(),t.nrm(11,"router-outlet"),t.j41(12,"div",5),t.nrm(13,"ag-grid-angular",6),t.k0s()(),t.j41(14,"mat-dialog-actions",7),t.DNE(15,vt,3,0,"button",8)(16,Et,11,5,"eco-fab-speed-dial",9),t.k0s()()}if(2&a){const e=M,i=t.XpG();t.R7$(3),t.SpI(" ",i.title||"Metadata"," "),t.R7$(6),t.vxM(9,e.itemFor?10:9),t.R7$(4),t.Y8G("rowData",e.metadata)("gridOptions",i.gridOptions),t.R7$(2),t.vxM(15,0===e.recommendations.length?15:-1),t.R7$(),t.vxM(16,e.recommendations.length>0?16:-1)}}const yt={enabled:!1,name:"MetadataComponent"};let xt=(()=>{class a{#t;#e;#c;#n;#a;#o;#i;#r;#p;#s;#l;constructor(e,i,s,I,S){this.dialogRef=e,this.snackBar=i,this.dialog=s,this.viewContainerRef=I,this.changeDetectorRef=S,this.gridOptions=this.buildGridOptions(),this.#t=(0,b.d)(E.R),this.#e=(0,b.d)(T.TI),this.#c=(0,b.d)(c.F),this.#n=(0,b.d)(lt.c),this.#a=new o.t({Items:[],Recommendations:[]}),this.#o=new o.t(void 0),this.#i=new o.t(!1),this.#r=parseInt(this.#n.snapshot.paramMap.get("targetType"),10),this.#p=this.#n.snapshot.paramMap.get("keyType"),this.#s=this.#n.snapshot.paramMap.get("key"),this.title=decodeURIComponent(this.#n.snapshot.paramMap.get("title")??""),this.#l=this.#n.snapshot.paramMap.get("contentTypeStaticName"),this.log=new pt.B(yt)}ngOnInit(){this.fetchFor(),this.fetchMetadata(),this.#n.doOnDialogClosed(()=>this.fetchMetadata());const e=this.log.rxTap("filteredRecs$");this.#a.subscribe(I=>{this.log.a("test 2dm",{set:I})});const i=this.#a.pipe(e.pipe(),(0,u.T)(I=>I.Recommendations.filter(S=>I.Items.filter(G=>G._Type.Id===S.Id).length<S.Count)),e.map()),s=this.log.rxTap("viewModel$");this.viewModel$=(0,m.z)([this.#a,i,this.#o,this.#i]).pipe(s.pipe(),(0,u.T)(([I,S,G,Ot])=>({metadata:I.Items,recommendations:S,itemFor:G,fabOpen:Ot})),s.map())}ngOnDestroy(){this.log.a("destroying"),this.#a.complete(),this.#o.complete(),this.#i.complete()}closeDialog(){this.dialogRef.close()}openChange(e){this.#i.next(e)}createMetadata(e){if(e)return e.Enabled?void(e.CreateEmpty?(this.snackBar.open(`Creating ${e.Name}...`),this.#t.create(e.Id,{For:this.calculateItemFor("dummy").For}).subscribe({error:()=>{this.snackBar.open(`Creating ${e.Name} failed. Please check console for more info`,void 0,{duration:3e3}),this.fetchMetadata()},next:()=>{this.snackBar.open(`Created ${e.Name}`,void 0,{duration:3e3}),this.fetchMetadata()}})):this.createMetadataForm(e.Id)):void(0,st.j)(this.dialog,e.MissingFeature,this.viewContainerRef,this.changeDetectorRef);this.dialog.open(it,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(s=>{null!=s&&this.createMetadataForm(s)})}createMetadataForm(e){const i={items:[this.calculateItemFor(e)]},s=(0,f.s)(i);this.#n.navRelative([`edit/${s}`]),this.changeDetectorRef.markForCheck()}calculateItemFor(e){const i=d.c.constructMetadataInfo(this.#r,this.#p,this.#s);return d.c.newMetadataFromInfo(e,i)}fetchFor(){this.#l&&this.#c.getAll(this.#l).subscribe(e=>{const i=e.find(s=>s.Guid===this.#s);i?.For&&this.#o.next(i.For)})}fetchMetadata(){const e=this.log.rxTap("getMetadata");this.#e.getMetadata(this.#r,this.#p,this.#s).pipe(e.pipe(),(0,h.s)(1),(0,u.T)(i=>(i.Recommendations.forEach(s=>{s.Icon?.startsWith("base64:")&&(s.Icon=s.Icon.replace("base64:",""),s.Icon=window.atob(s.Icon),s.Icon=s.Icon.replace('fill="#000000"','fill="#ffffff"'))}),i)),e.map()).subscribe(i=>this.#a.next(i))}editMetadata(e){const i={items:[d.c.editId(e.Id)]},s=(0,f.s)(i);this.#n.navRelative([`edit/${s}`])}deleteMetadata(e,i=!1){if(i)this.snackBar.open("Deleting..."),this.#t.delete(e._Type.Id,e.Id,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchMetadata()},error:()=>{this.snackBar.open("Delete failed. Please check console for more information",null,{duration:3e3})}});else{const s={entityId:e.Id,entityTitle:e.Title,message:this.#a.value.Recommendations.find(S=>S.Id===e._Type.Id)?.DeleteWarning};this.dialog.open(R,{autoFocus:!1,data:s,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(S=>{S&&this.deleteMetadata(e,!0)})}}buildGridOptions(){return{...C.C,columnDefs:[{...A.r.IdWithDefaultRenderer,cellRendererParams:A.r.idFieldParamsTooltipGetter()},{...A.r.TextWide,field:"Title",onCellClicked:i=>{this.editMetadata(i.data)}},{...A.r.TextWide,headerName:"Content Type",field:"ContentType",valueGetter:i=>{const s=i.data;return`${s._Type.Name}${s._Type.Title!==s._Type.Name?` (${s._Type.Title})`:""}`},cellRenderer:k},{...A.r.ActionsPinnedRight1,cellRenderer:U,cellRendererParams:{onDelete:s=>this.deleteMetadata(s)}}]}}static#d=this.\u0275fac=function(i){return new(i||a)(t.rXU(l.CP),t.rXU(ct.UG),t.rXU(l.bZ),t.rXU(t.c1b),t.rXU(t.gRc))};static#m=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab"],[1,"eav-eco-fab-speed-dial",3,"ngClass"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab",3,"click"],[1,"eav-eco-fab-speed-dial",3,"openChange","ngClass"],[3,"spin"],["mat-fab",""],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Other Content Type",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadge","\u{1f48e}","matBadgePosition","below after","aria-hidden","false",2,"color","white","fill","white",3,"innerHTML","matBadgeHidden"]],template:function(i,s){if(1&i&&(t.DNE(0,Dt,17,6,"div",0),t.nI1(1,"async")),2&i){let I;t.vxM(0,(I=t.bMT(1,1,s.viewModel$))?0:-1,I)}},dependencies:[p.Hl,p.iY,p.$0,p.Sr,F.m_,F.An,_.n3,rt.p,dt.xs,l.E7,K.TE,B.YU,K.p1,K.yf,Y.Y,Y.k,B.Jj,D.$],styles:["[_nghost-%COMP%]     .mat-button-wrapper div svg *:not([fill]){fill:#fff}"]})}return a})()},2437:(y,g,n)=>{n.d(g,{k:()=>_});var l=n(52);let _=(()=>{class o{static#t=this.route={path:"permissions/:targetType/:keyType/:key",loadChildren:()=>n.e("projects_eav-ui_src_app_permissions_permissions_routing_ts").then(n.bind(n,3516)).then(m=>m.permissionRoutes),data:{title:"Permissions"}};static getUrl(m,h,c){return`permissions/${m}/${h}/${c}`}static getUrlApp(m){return this.getUrl(l.YX.metadata.app.targetType,l.YX.metadata.app.keyType,m.toString())}static getUrlAttribute(m){return this.getUrl(l.YX.metadata.attribute.targetType,l.YX.metadata.attribute.keyType,m.toString())}static getUrlContentType(m){return this.getUrlEntity(m)}static getUrlEntity(m){return this.getUrl(l.YX.metadata.entity.targetType,l.YX.metadata.entity.keyType,m)}static getUrlLanguage(m){return this.getUrl(l.YX.metadata.language.targetType,l.YX.metadata.language.keyType,m)}}return o})()},4096:(y,g,n)=>{n.d(g,{Kn:()=>h.K,TI:()=>m.T,k4:()=>l.k});var l=n(2437),m=(n(2365),n(3516),n(2458),n(401)),h=n(4900)},2365:(y,g,n)=>{n.d(g,{v:()=>_});var l=n(9204);const _={name:"SET_PERMISSIONS_DIALOG",initContext:!0,panelSize:"large",panelClass:null,getComponent:()=>(0,l.A)(function*(){const{PermissionsComponent:o}=yield Promise.all([n.e("default-node_modules_angular_material_fesm2022_snack-bar_mjs"),n.e("default-node_modules_angular_forms_fesm2022_forms_mjs"),n.e("default-projects_eav-ui_src_app_shared_directives_tippy_directive_ts"),n.e("default-node_modules_angular_material_fesm2022_radio_mjs"),n.e("default-projects_eav-ui_src_app_shared_constants_default-grid-options_constants_ts-projects_e-814394"),n.e("default-projects_eav-ui_src_app_permissions_permissions_component_ts")]).then(n.bind(n,2458));return o})()}},3516:(y,g,n)=>{n.r(g),n.d(g,{permissionRoutes:()=>u});var l=n(5544),_=n(2365),o=n(1195);const u=[{path:"",component:l.DialogEntryComponent,data:{dialog:_.v},children:o.RD}]},3758:(y,g,n)=>{n.d(g,{F:()=>v});var l=n(316),_=n(5944),o=n(7580);const u=["*"],m=f=>({"hint-box__short":f});function h(f,d){1&f&&o.eu8(0)}function c(f,d){if(1&f&&(o.j41(0,"mat-hint"),o.DNE(1,h,1,0,"ng-container",2),o.k0s()),2&f){o.XpG();const p=o.sdS(4);o.R7$(),o.Y8G("ngTemplateOutlet",p)}}function E(f,d){1&f&&o.eu8(0)}function T(f,d){if(1&f&&(o.j41(0,"mat-error"),o.DNE(1,E,1,0,"ng-container",2),o.k0s()),2&f){o.XpG();const p=o.sdS(4);o.R7$(),o.Y8G("ngTemplateOutlet",p)}}function C(f,d){1&f&&o.SdG(0)}let v=(()=>{class f{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(r){return new(r||f)};static#e=this.\u0275cmp=o.VBU({type:f,selectors:[["app-field-hint"]],inputs:{isError:"isError"},standalone:!0,features:[o.aNF],ngContentSelectors:u,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(r,D){if(1&r){const t=o.RV6();o.NAR(),o.j41(0,"div",1),o.bIt("click",function(){return o.eBV(t),o.Njj(D.toggleIsShort())}),o.DNE(1,c,2,1)(2,T,2,1),o.k0s(),o.DNE(3,C,1,0,"ng-template",null,0,o.C5r)}if(2&r){let t;o.Y8G("ngClass",o.eq3(2,m,D.isShort)),o.R7$(),o.vxM(1,!1===(t=D.isError)?1:!0===t?2:-1)}},dependencies:[_.RG,_.MV,_.TL,l.YU,l.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return f})()},5858:(y,g,n)=>{n.d(g,{O:()=>l});const l="DROPDOWN_INSERT_VALUE"},9333:(y,g,n)=>{n.d(g,{c:()=>o});var l=n(7580);let o=(()=>{class u{constructor(){}onClick(h){h.stopPropagation()}static#t=this.\u0275fac=function(c){return new(c||u)};static#e=this.\u0275dir=l.FsC({type:u,selectors:[["","appClickStopPropagation",""]],hostBindings:function(c,E){1&c&&l.bIt("click",function(C){return E.onClick(C)})},standalone:!0})}return u})()},5959:(y,g,n)=>{n.d(g,{h6:()=>C,zZ:()=>E});var l=n(271),_=n(7693),o=n(8873),u=n(7580),m=n(6443),h=n(4821);const c="admin/field/",E="admin/field/all",T="admin/field/GetSharedFields";let C=(()=>{class v{constructor(d,p,r){this.http=d,this.context=p,this.dnnContext=r}apiUrl(d){return this.dnnContext.$2sxc.http.apiUrl(d)}typeListRetrieve(){return this.http.get(this.apiUrl(c+"DataTypes"),{params:{appid:this.context.appId.toString()}})}getInputTypesList(){return this.http.get(this.apiUrl(c+"InputTypes"),{params:{appid:this.context.appId.toString()}}).pipe((0,l.T)(d=>d.map(r=>({dataType:r.Type.substring(0,r.Type.indexOf("-")),inputType:r.Type,label:r.Label,description:r.Description,isDefault:r.IsDefault,isObsolete:r.IsObsolete,isRecommended:r.IsRecommended,obsoleteMessage:r.ObsoleteMessage,icon:r.IsDefault?"star":r.IsRecommended?"star_outline":null}))))}getReservedNames(){return this.http.get(this.apiUrl(c+"ReservedNames"))}getFields(d){return this.http.get(this.apiUrl(E),{params:{appid:this.context.appId.toString(),staticName:d}}).pipe((0,l.T)(p=>{if(p)for(const r of p){if(!r.Metadata)continue;const D=r.Metadata;D.merged={...D.All,...D[r.Type],...D[r.InputType]}}return p}))}getShareableFields(){return this.http.get(this.apiUrl(T),{params:{appid:this.context.appId.toString()}})}getShareableFieldsFor(d){return this.http.get(this.apiUrl(T),{params:{appid:this.context.appId.toString(),attributeId:d.toString()}})}addInheritedField(d,p,r,D){return this.http.post(this.apiUrl(c+"AddInheritedField"),null,{params:{AppId:this.context.appId.toString(),ContentTypeId:d.toString(),SourceType:p,SourceField:r,name:D}})}share(d,p=!0){return this.http.post(this.apiUrl(c+"Share"),null,{params:{appid:this.context.appId.toString(),attributeId:d.toString(),share:p}})}inherit(d,p){return this.http.post(this.apiUrl(c+"Inherit"),null,{params:{appid:this.context.appId.toString(),attributeId:d.toString(),inheritMetadataOf:p}})}reOrder(d,p){return this.http.post(this.apiUrl(c+"Sort"),null,{params:{appid:this.context.appId.toString(),contentTypeId:p.Id.toString(),order:JSON.stringify(d)}})}setTitle(d,p){return this.http.post(this.apiUrl(_.X+"SetTitle"),null,{params:{appid:this.context.appId.toString(),contentTypeId:p.Id.toString(),attributeId:d.Id.toString()}})}rename(d,p,r){return this.http.post(this.apiUrl(c+"Rename"),null,{params:{appid:this.context.appId.toString(),contentTypeId:p.toString(),attributeId:d.toString(),newName:r}})}delete(d,p){if(d.IsTitle)throw new Error("Can't delete Title");return this.http.delete(this.apiUrl(c+"Delete"),{params:{appid:this.context.appId.toString(),contentTypeId:p.Id.toString(),attributeId:d.Id.toString()}})}add(d,p){return this.http.post(this.apiUrl(c+"Add"),null,{params:{AppId:this.context.appId.toString(),ContentTypeId:p.toString(),Id:d.Id.toString(),Type:d.Type,InputType:d.InputType,StaticName:d.StaticName,IsTitle:d.IsTitle.toString(),Index:d.SortOrder.toString()}})}updateInputType(d,p,r){return this.http.post(this.apiUrl(c+"InputType"),null,{params:{appId:this.context.appId.toString(),attributeId:d.toString(),field:p,inputType:r}})}static#t=this.\u0275fac=function(p){return new(p||v)(u.KVO(m.Qq),u.KVO(o.o),u.KVO(h.ob))};static#e=this.\u0275prov=u.jDH({token:v,factory:v.\u0275fac})}return v})()},693:(y,g,n)=>{function l(o){return new Promise((u,m)=>{const h=new FileReader;h.readAsDataURL(o),h.onload=()=>{u(h.result.split(",")[1])},h.onerror=c=>{m(c)}})}function _(o){return new Promise((u,m)=>{const h=new FileReader;h.readAsText(o),h.onload=()=>{u(h.result)},h.onerror=c=>{m(c)}})}n.d(g,{d:()=>_,n:()=>l})}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.02/dist/ng-edit/projects_eav-ui_src_app_metadata_metadata_component_ts-projects_eav-ui_src_app_shared_fields_-53fb0d.14d1e80dca81c6c3.js.map