"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_visual-query_visual-query_component_ts-node_modules_lodash-es__arrayE-ac6327"],{1475:(M,v,a)=>{a.d(v,{j:()=>u});var g=a(8873),h=a(8624),l=a(7580),_=a(6443),m=a(4821);let u=(()=>{class p{constructor(C,t,S){this.http=C,this.context=t,this.dnnContext=S}getContentInfo(C){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(h.Q+"Get"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),scope:C}})}exportParts(C,t,S){const f=this.dnnContext.$2sxc.http.apiUrl(h.Q+"Export")+"?appId="+this.context.appId.toString()+"&zoneId="+this.context.zoneId.toString()+"&contentTypeIdsString="+C.join(";")+"&entityIdsString="+t.join(";")+"&templateIdsString="+S.join(";");window.open(f,"_blank","")}static#t=this.\u0275fac=function(t){return new(t||p)(l.KVO(_.Qq),l.KVO(g.o),l.KVO(m.ob))};static#e=this.\u0275prov=l.jDH({token:p,factory:p.\u0275fac})}return p})()},320:(M,v,a)=>{a.d(v,{t:()=>u});var g=a(1772),h=a(8873),l=a(7580),_=a(6443),m=a(4821);let u=(()=>{class p{constructor(C,t,S){this.http=C,this.context=t,this.dnnContext=S}getAppInfo(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(g.u+"Statistics"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}exportAppUrl(){return`${this.dnnContext.$2sxc.http.apiUrl(`${g.u}Export`)}?appId=${this.context.appId}&zoneId=${this.context.zoneId}`}exportForVersionControl({includeContentGroups:C,resetAppGuid:t,withFiles:S}){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(g.u+"SaveData"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),includeContentGroups:C.toString(),resetAppGuid:t.toString(),withPortalFiles:S.toString()}})}static#t=this.\u0275fac=function(t){return new(t||p)(l.KVO(_.Qq),l.KVO(h.o),l.KVO(m.ob))};static#e=this.\u0275prov=l.jDH({token:p,factory:p.\u0275fac})}return p})()},8624:(M,v,a)=>{a.d(v,{Q:()=>u,S:()=>p});var g=a(1772),h=a(8873),l=a(7580),_=a(6443),m=a(4821);const u="admin/appParts/";let p=(()=>{class P{constructor(t,S,f){this.http=t,this.context=S,this.dnnContext=f}importAppParts(t){const S=new FormData;return S.append("File",t),this.http.post(this.dnnContext.$2sxc.http.apiUrl(u+"Import"),S,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}resetApp(t){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(g.u+"Reset"),{},{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),withPortalFiles:t.toString()}})}static#t=this.\u0275fac=function(S){return new(S||P)(l.KVO(_.Qq),l.KVO(h.o),l.KVO(m.ob))};static#e=this.\u0275prov=l.jDH({token:P,factory:P.\u0275fac})}return P})()},5445:(M,v,a)=>{a.d(v,{Cu:()=>u.Cu,JL:()=>u.JL,Mk:()=>u.Mk,ei:()=>u.ei,gs:()=>h.g,tn:()=>g.t,vN:()=>u.vN,xR:()=>u.xR,y0:()=>p.y});var g=a(6163),h=a(7693),u=(a(1475),a(320),a(8624),a(6460)),p=a(2570)},6460:(M,v,a)=>{a.d(v,{Cu:()=>b,JL:()=>$,Mk:()=>I,ei:()=>y,vN:()=>w,xR:()=>X});var g=a(4600),h=a(6647),l=a(271),_=a(693),m=a(8873),u=a(9234),p=a(7580),P=a(6443),C=a(4821);const I="admin/query/Run",y="admin/query/DebugStream",b="admin/query/Save",$="admin/query/Get",w="admin/query/DataSources";let X=(()=>{class B{constructor(F,R,O){this.http=F,this.context=R,this.dnnContext=O}getAll(F){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(u.Gg),{params:{appId:this.context.appId.toString(),contentType:F}})}importQuery(F){return(0,g.H)((0,_.n)(F)).pipe((0,h.n)(R=>this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/query/import"),{AppId:this.context.appId.toString(),ContentBase64:R})),(0,l.T)(R=>({Success:R,Messages:[]})))}clonePipeline(F){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/query/Clone"),{params:{Id:F.toString(),appId:this.context.appId.toString()}})}delete(F){return this.http.delete(this.dnnContext.$2sxc.http.apiUrl("admin/query/Delete"),{params:{appId:this.context.appId.toString(),Id:F.toString()}})}static#t=this.\u0275fac=function(R){return new(R||B)(p.KVO(P.Qq),p.KVO(m.o),p.KVO(C.ob))};static#e=this.\u0275prov=p.jDH({token:B,factory:B.\u0275fac})}return B})()},2570:(M,v,a)=>{a.d(v,{y:()=>S});var g=a(8873),h=a(7580),l=a(6443),_=a(4821);const m="admin/view/",u=m+"all",p=m+"delete",P=m+"import",C=m+"polymorphism",t=m+"usage";let S=(()=>{class f{constructor(y,b,$){this.http=y,this.context=b,this.dnnContext=$}getAll(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(u),{params:{appId:this.context.appId.toString()}})}delete(y){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(p),{params:{appId:this.context.appId.toString(),Id:y.toString()}})}import(y){const b=new FormData;return b.append("File",y),this.http.post(this.dnnContext.$2sxc.http.apiUrl(P),b,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}export(y){const b=this.dnnContext.$2sxc.http.apiUrl(m+"json")+"?appId="+this.context.appId+"&viewId="+y;window.open(b,"_blank","")}getPolymorphism(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(C),{params:{appId:this.context.appId.toString()}})}getUsage(y){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(t),{params:{appId:this.context.appId.toString(),guid:y}})}static#t=this.\u0275fac=function(b){return new(b||f)(h.KVO(l.Qq),h.KVO(g.o),h.KVO(_.ob))};static#e=this.\u0275prov=h.jDH({token:f,factory:f.\u0275fac})}return f})()},2760:(M,v,a)=>{function g(l){return"Escape"===l.key}function h(l){return"s"===l.key&&(l.ctrlKey||l.metaKey)}a.d(v,{J:()=>h,K:()=>g})},1772:(M,v,a)=>{a.d(v,{I:()=>C,u:()=>P});var g=a(6647),h=a(9452),l=a(3550),_=a(8873),m=a(7580),u=a(6443),p=a(4821);const P="admin/app/";let C=(()=>{class t{constructor(f,I,y){this.http=f,this.context=I,this.dnnContext=y}importApp(f,I,y=!1){const b=new FormData;return b.append("File",f),b.append("Name",I??""),this.http.post(this.dnnContext.$2sxc.http.apiUrl(P+"Import"),b,{params:{zoneId:this.context.zoneId.toString()}}).pipe((0,g.n)($=>{if(y&&$.Messages[0]?.MessageType===l.G1.Warning){const w=prompt($.Messages[0].Text+" Would you like to install it using another folder name?");if(w)return this.importApp(f,w,!0)}return(0,h.of)($)}))}static#t=this.\u0275fac=function(I){return new(I||t)(m.KVO(u.Qq),m.KVO(_.o),m.KVO(p.ob))};static#e=this.\u0275prov=m.jDH({token:t,factory:t.\u0275fac})}return t})()},3758:(M,v,a)=>{a.d(v,{F:()=>S});var g=a(316),h=a(5944),l=a(7580);const _=["*"],m=f=>({"hint-box__short":f});function u(f,I){1&f&&l.eu8(0)}function p(f,I){if(1&f&&(l.j41(0,"mat-hint"),l.DNE(1,u,1,0,"ng-container",2),l.k0s()),2&f){l.XpG();const y=l.sdS(4);l.R7$(),l.Y8G("ngTemplateOutlet",y)}}function P(f,I){1&f&&l.eu8(0)}function C(f,I){if(1&f&&(l.j41(0,"mat-error"),l.DNE(1,P,1,0,"ng-container",2),l.k0s()),2&f){l.XpG();const y=l.sdS(4);l.R7$(),l.Y8G("ngTemplateOutlet",y)}}function t(f,I){1&f&&l.SdG(0)}let S=(()=>{class f{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(b){return new(b||f)};static#e=this.\u0275cmp=l.VBU({type:f,selectors:[["app-field-hint"]],inputs:{isError:"isError"},standalone:!0,features:[l.aNF],ngContentSelectors:_,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(b,$){if(1&b){const w=l.RV6();l.NAR(),l.j41(0,"div",1),l.bIt("click",function(){return l.eBV(w),l.Njj($.toggleIsShort())}),l.DNE(1,p,2,1)(2,C,2,1),l.k0s(),l.DNE(3,t,1,0,"ng-template",null,0,l.C5r)}if(2&b){let w;l.Y8G("ngClass",l.eq3(2,m,$.isShort)),l.R7$(),l.vxM(1,!1===(w=$.isError)?1:!0===w?2:-1)}},dependencies:[h.RG,h.MV,h.TL,g.YU,g.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return f})()},9333:(M,v,a)=>{a.d(v,{c:()=>l});var g=a(7580);let l=(()=>{class _{constructor(){}onClick(u){u.stopPropagation()}static#t=this.\u0275fac=function(p){return new(p||_)};static#e=this.\u0275dir=g.FsC({type:_,selectors:[["","appClickStopPropagation",""]],hostBindings:function(p,P){1&p&&g.bIt("click",function(t){return P.onClick(t)})},standalone:!0})}return _})()},1459:(M,v,a)=>{a.d(v,{z:()=>h});var g=a(7580);let h=(()=>{class l{onMousedown(m){m.stopPropagation()}static#t=this.\u0275fac=function(u){return new(u||l)};static#e=this.\u0275dir=g.FsC({type:l,selectors:[["","appMousedownStopPropagation",""]],hostBindings:function(u,p){1&u&&g.bIt("mousedown",function(C){return p.onMousedown(C)})},standalone:!0})}return l})()},4981:(M,v,a)=>{a.d(v,{f:()=>g});class g{static toggleInArray(l,_){const m=_.indexOf(l);-1===m?_.push(l):_.splice(m,1)}}},693:(M,v,a)=>{function g(l){return new Promise((_,m)=>{const u=new FileReader;u.readAsDataURL(l),u.onload=()=>{_(u.result.split(",")[1])},u.onerror=p=>{m(p)}})}function h(l){return new Promise((_,m)=>{const u=new FileReader;u.readAsText(l),u.onload=()=>{_(u.result)},u.onerror=p=>{m(p)}})}a.d(v,{d:()=>h,n:()=>g})},8021:(M,v,a)=>{a.d(v,{A:()=>u,J:()=>m});var g=a(5682),h=a(1817),l=a(271),_=a(2434);function m(p){return(0,g.F)((0,h.F)(),(0,l.T)(p),(0,h.F)())}function u(p){return(0,g.F)((0,h.F)(),(0,l.T)(p),(0,h.F)(_.A))}},2897:(M,v,a)=>{a.r(v),a.d(v,{VisualQueryComponent:()=>Ae});var g=a(2159),h=a(8873),l=a(5797),_=a(271),m=a(9999),u=a(3176),p=a(52),P=a(3518),C=a(5445),t=a(7580),S=a(6443);let f=(()=>{class o{constructor(e,n){this.http=e,this.context=n}fetchPipeline(e,n){return this.http.get(C.JL,{params:{appId:this.context.appId.toString(),id:e.toString()}}).pipe((0,_.T)(i=>(i.DataSources.length||this.buildDefaultModel(i,n),this.fixPipelineDataSources(i.DataSources),i)))}buildDefaultModel(e,n){const i=p.YX.pipelineDesigner.defaultPipeline.dataSources;for(const s of i){const c=n.find(x=>x.PartAssemblyAndType===s.PartAssemblyAndType);e.DataSources.push({Description:"",EntityGuid:s.EntityGuid,EntityId:void 0,Name:c.Name,PartAssemblyAndType:s.PartAssemblyAndType,VisualDesignerData:s.VisualDesignerData})}e.Pipeline.StreamWiring=p.YX.pipelineDesigner.defaultPipeline.streamWiring}fixPipelineDataSources(e){if(!e.some(i=>i.EntityGuid===p.YX.pipelineDesigner.outDataSource.EntityGuid)){const i=p.YX.pipelineDesigner.outDataSource;e.push({Description:i.Description,EntityGuid:i.EntityGuid,EntityId:void 0,Name:i.Name,PartAssemblyAndType:i.PartAssemblyAndType,VisualDesignerData:i.VisualDesignerData})}for(const i of e)i.VisualDesignerData??={Top:50,Left:50}}fetchDataSources(){return this.http.get(C.vN,{params:{appid:this.context.appId,zoneId:this.context.zoneId}}).pipe((0,_.T)(e=>{const n=p.YX.pipelineDesigner.outDataSource;return e.push({ContentType:void 0,Difficulty:p.YX.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:n.In,Name:n.Name,Out:void 0,PartAssemblyAndType:n.PartAssemblyAndType,PrimaryType:n.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),e}))}typeNameFilter(e,n){const i=e.split(", ");switch(n){case"classFullName":return i[0];case"className":const c=i[0].split(".");return c[c.length-1];default:return e}}savePipeline(e){const n=e.Pipeline;return this.http.post(C.Cu,{pipeline:n,dataSources:e.DataSources},{params:{appId:this.context.appId.toString(),Id:n.EntityId.toString()}}).pipe((0,_.T)(s=>(this.fixPipelineDataSources(s.DataSources),s)))}runPipeline(e,n){return this.http.get(C.Mk,{params:{appId:this.context.appId.toString(),id:e.toString(),top:n.toString()}})}debugStream(e,n,i,s){return this.http.get(C.ei,{params:{appId:this.context.appId.toString(),id:e.toString(),from:n,out:i,top:s.toString()}})}static#t=this.\u0275fac=function(n){return new(n||o)(t.KVO(S.Qq),t.KVO(h.o))};static#e=this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac})}return o})();var I=a(436),y=a(2585),b=a(4205),$=a(8537),w=a(1567),X=a(7693),B=a(401),Y=a(3216),F=a(334),R=a(7941),O=a(316),K=a(8223),k=a(3840),U=a(4175);function ct(o,r){if(1&o&&t.EFF(0),2&o){const e=t.XpG();t.Lme(' for Stream: "',e.debugStream.name,'" on Source: "',e.debugStream.sourceName,'" ')}}function pt(o,r){1&o&&(t.j41(0,"div",11)(1,"span"),t.EFF(2,"Results"),t.k0s()())}function dt(o,r){1&o&&t.EFF(0," Showing All results ")}function ut(o,r){if(1&o&&t.EFF(0),2&o){const e=t.XpG();t.SpI(" Showing top ",e.top," results ")}}function mt(o,r){1&o&&t.EFF(0," All ")}function ht(o,r){if(1&o&&t.EFF(0),2&o){const e=t.XpG().$implicit;t.SpI(" ",e," ")}}function _t(o,r){if(1&o){const e=t.RV6();t.j41(0,"button",12),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.show(i))}),t.EFF(1," Show "),t.DNE(2,mt,1,0)(3,ht,1,1),t.k0s()}if(2&o){const e=r.$implicit;t.R7$(2),t.vxM(2,0===e?2:-1),t.R7$(),t.vxM(3,0!==e?3:-1)}}function gt(o,r){1&o&&(t.j41(0,"div",14)(1,"span"),t.EFF(2,"Parameters"),t.k0s()())}function ft(o,r){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=r.$implicit;t.R7$(),t.JRh(e)}}function vt(o,r){if(1&o&&(t.j41(0,"mat-tab"),t.DNE(1,gt,3,0,"div",13),t.nrm(2,"br"),t.j41(3,"ul"),t.Z7z(4,ft,2,1,"li",null,t.fX1),t.k0s()()),2&o){const e=t.XpG();t.R7$(4),t.Dyx(e.parameters)}}function yt(o,r){1&o&&(t.j41(0,"div",15)(1,"span"),t.EFF(2,"Sources"),t.k0s()())}function Ct(o,r){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(null==e.value.Definition?null:e.value.Definition.Name)}}function Et(o,r){if(1&o&&(t.j41(0,"li")(1,"b"),t.EFF(2),t.k0s(),t.EFF(3,"="),t.j41(4,"em"),t.EFF(5),t.k0s()()),2&o){const e=r.$implicit;t.R7$(2),t.JRh(e.key),t.R7$(3),t.JRh(e.value)}}function Dt(o,r){if(1&o&&(t.j41(0,"tr")(1,"td"),t.DNE(2,Ct,2,1,"div"),t.j41(3,"pre"),t.EFF(4),t.k0s()(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td")(8,"ol"),t.Z7z(9,Et,6,2,"li",null,t.fX1),t.nI1(11,"keyvalue"),t.k0s()(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&o){const e=r.$implicit;t.R7$(2),t.vxM(2,null!=e.value.Definition&&e.value.Definition.Name?2:-1),t.R7$(2),t.JRh(e.value.Guid),t.R7$(2),t.JRh(e.value.Type),t.R7$(3),t.Dyx(t.bMT(11,4,e.value.Configuration)),t.R7$(4),t.JRh(e.value.Error)}}function St(o,r){1&o&&(t.j41(0,"div",16)(1,"span"),t.EFF(2,"Streams"),t.k0s()())}function bt(o,r){if(1&o&&(t.j41(0,"tr")(1,"td")(2,"pre"),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"pre"),t.EFF(6),t.k0s()(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s()()),2&o){const e=r.$implicit;t.R7$(3),t.JRh(e.Source+":"+e.SourceOut),t.R7$(3),t.JRh(e.Target+":"+e.TargetIn),t.R7$(2),t.JRh(e.Count),t.R7$(2),t.JRh(e.Error)}}let xt=(()=>{class o{constructor(e,n,i){this.dialogData=e,this.dialogRef=n,this.visualQueryService=i}ngOnInit(){const e=this.visualQueryService.pipelineModel$.value.Pipeline,n=(e.Params?.split("\n")??[]).filter(s=>!!s),i=(e.TestParameters?.split("\n")??[]).filter(s=>!!s);this.parameters=[].concat(n,i),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialogRef.close()}show(e){e!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,e):this.visualQueryService.runPipeline(e),this.closeDialog())}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(R.Vh),t.rXU(R.CP),t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-query-result"]],standalone:!0,features:[t.aNF],decls:54,vars:11,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["dynamicHeight","","color","accent",1,"eav-tab-group"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"eav-tab-description"],["mat-button",""],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3," Query Results "),t.DNE(4,ct,1,2),t.k0s(),t.j41(5,"button",3),t.bIt("click",function(){return i.closeDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",4)(9,"p"),t.EFF(10),t.k0s(),t.j41(11,"mat-tab-group",5)(12,"mat-tab"),t.DNE(13,pt,3,0,"div",6),t.j41(14,"p",7),t.DNE(15,dt,1,0)(16,ut,1,1),t.Z7z(17,_t,4,2,"button",8,t.fX1),t.k0s(),t.j41(19,"pre"),t.EFF(20),t.nI1(21,"json"),t.k0s()(),t.DNE(22,vt,6,0,"mat-tab"),t.j41(23,"mat-tab"),t.DNE(24,yt,3,0,"div",9),t.nrm(25,"br"),t.j41(26,"table")(27,"tr")(28,"th"),t.EFF(29,"Name and Guid"),t.k0s(),t.j41(30,"th"),t.EFF(31,"Type"),t.k0s(),t.j41(32,"th"),t.EFF(33,"Configuration"),t.k0s(),t.j41(34,"th"),t.EFF(35,"Error"),t.k0s()(),t.Z7z(36,Dt,14,6,"tr",null,t.fX1),t.nI1(38,"keyvalue"),t.k0s()(),t.j41(39,"mat-tab"),t.DNE(40,St,3,0,"div",10),t.nrm(41,"br"),t.j41(42,"table")(43,"tr")(44,"th"),t.EFF(45,"Source"),t.k0s(),t.j41(46,"th"),t.EFF(47,"Target"),t.k0s(),t.j41(48,"th"),t.EFF(49,"Items"),t.k0s(),t.j41(50,"th"),t.EFF(51,"Error"),t.k0s()(),t.Z7z(52,bt,11,4,"tr",null,t.fX1),t.k0s()()()()()),2&n&&(t.R7$(4),t.vxM(4,i.debugStream?4:-1),t.R7$(6),t.Lme(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",i.timeUsed,"ms (",i.ticksUsed," ticks) "),t.R7$(5),t.vxM(15,0===i.top?15:-1),t.R7$(),t.vxM(16,0!==i.top?16:-1),t.R7$(),t.Dyx(i.optionsForTop),t.R7$(3),t.JRh(t.bMT(21,7,i.result)),t.R7$(2),t.vxM(22,null!=i.parameters&&i.parameters.length?22:-1),t.R7$(14),t.Dyx(t.bMT(38,9,i.sources)),t.R7$(16),t.Dyx(i.streams))},dependencies:[U.Hl,U.$z,U.iY,k.m_,k.An,K.RI,K.ES,K.mq,K.T8,O.TG,O.lG],styles:[".eav-tab-group[_ngcontent-%COMP%]{padding:0}.eav-tab-description[_ngcontent-%COMP%]{display:flex;align-items:baseline}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]})}return o})(),Pt=(()=>{class o{constructor(e,n){this.dialogData=e,this.dialogRef=n}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialogRef.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api-query"),"_blank")}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(R.Vh),t.rXU(R.CP))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-stream-error-result"]],standalone:!0,features:[t.aNF],decls:17,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["align","end"],["mat-button","","tippy","Open 2sxc Insights",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Stream Error Results"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return i.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"pre"),t.EFF(9),t.nI1(10,"json"),t.k0s()(),t.j41(11,"mat-dialog-actions",5)(12,"button",6),t.bIt("click",function(){return i.openInsights()}),t.j41(13,"mat-icon",7),t.EFF(14,"speed"),t.k0s(),t.j41(15,"span"),t.EFF(16,"Insights"),t.k0s()()()()),2&n&&(t.R7$(9),t.JRh(t.bMT(10,1,i.errorData)))},dependencies:[U.Hl,U.$z,U.iY,k.m_,k.An,R.E7,O.TG],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]})}return o})();var J=a(4038),N=a(5437),q=a(8471),Rt=a(4979),Mt=a(2760),Tt=a(3347);let Q=(()=>{class o extends Rt.V{#t;#e;#n;#i;#a;#r;#o;#s;constructor(e,n,i,s,c){super(),this.snackBar=e,this.dialog=n,this.viewContainerRef=i,this.zone=s,this.changeDetectorRef=c,this.#t=(0,N.d)(X.g),this.#e=(0,N.d)(B.T),this.#n=(0,N.d)(f),this.#i=(0,N.d)(q.c),this.#a=(0,N.d)(I.hE),this.pipelineModel$=new l.t(null),this.dataSources$=new l.t(null),this.putEntityCountOnConnections$=new b.B,this.dataSourceConfigs$=new l.t({}),this.#r=parseInt(this.#i.snapshot.paramMap.get("pipelineId"),10),this.#o=!1,this.#s=!1}ngOnDestroy(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),super.destroy()}init(){this.fetchDataSources(()=>this.fetchPipeline(!0,!0,!1)),this.attachKeyboardSave(),this.#i.doOnDialogClosed(()=>{(this.#o||this.#s)&&this.fetchPipeline(this.#o,this.#s,this.#o),this.#o=!1,this.#s=!1})}editPipelineEntity(){this.savePipeline(()=>{const e={items:[F.c.editId(this.pipelineModel$.value.Pipeline.EntityId)]},n=(0,Y.s)(e);this.#i.navRelative([`edit/${n}`]),this.#o=!0})}saveAndRun(e,n){e&&n?this.savePipeline(()=>{this.runPipeline()}):e?this.savePipeline():n&&this.runPipeline()}showDataSourceDetails(e){const n=(0,y.A)(this.pipelineModel$.value),i=J.i.tryParse(n.Pipeline.VisualDesignerData)??{};i.ShowDataSourceDetails=e,n.Pipeline.VisualDesignerData=JSON.stringify(i),this.pipelineModel$.next(n)}addDataSource(e){const n=(0,y.A)(this.pipelineModel$.value);n.DataSources.push({Description:"",EntityGuid:"unsaved"+(n.DataSources.length+1),EntityId:void 0,Name:e.Name,PartAssemblyAndType:e.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(n),this.savePipeline()}removeDataSource(e,n,i){const s=(0,y.A)(this.pipelineModel$.value);s.DataSources=s.DataSources.filter(c=>c.EntityGuid!==e),s.Pipeline.StreamWiring=n,s.Pipeline.StreamsOut=i,this.pipelineModel$.next(s)}renameDataSource(e,n){const i=(0,y.A)(this.pipelineModel$.value);i.DataSources.find(c=>c.EntityGuid===e).Name=n,this.pipelineModel$.next(i)}changeDataSourceDescription(e,n){const i=(0,y.A)(this.pipelineModel$.value);i.DataSources.find(c=>c.EntityGuid===e).Description=n,this.pipelineModel$.next(i)}changeConnections(e,n){const i=(0,y.A)(this.pipelineModel$.value);i.Pipeline.StreamWiring=e,i.Pipeline.StreamsOut=n,this.pipelineModel$.next(i)}changeDataSourcePosition(e,n){const i=(0,y.A)(this.pipelineModel$.value),s=i.DataSources.find(c=>c.EntityGuid===e);s&&(s.VisualDesignerData={...s.VisualDesignerData,...n},this.pipelineModel$.next(i))}calculateDataSourceConfigs(e){const n={};e.forEach(i=>{null!=i.EntityId&&(n[i.EntityId]=[],i.Metadata?.forEach(s=>{Object.entries(s).forEach(([c,d])=>{null==d||""===d||["Created","Guid","Id","Modified","Title","_Type"].includes(c)||(Array.isArray(d)&&null!=d[0]?.Title&&null!=d[0]?.Id&&(d=`${d[0].Title} (${d[0].Id})`),n[i.EntityId].push({name:c,value:d}))})}))}),this.dataSourceConfigs$.next(n)}editDataSource(e){const i=this.dataSources$.value.find(x=>x.PartAssemblyAndType===e.PartAssemblyAndType).ContentType,d=e.EntityGuid;this.#e.getMetadata(p.YX.metadata.entity.targetType,p.YX.metadata.entity.keyType,d,i).subscribe(x=>{if(x.Items.length){const D={items:[F.c.editId(x.Items[0].Id)]},E=(0,Y.s)(D);return this.#i.navRelative([`edit/${E}`]),void(this.#s=!0)}this.#t.retrieveContentType(i).subscribe({next:D=>{if(null==D)return void this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});const E={items:[F.c.newMetadata(d,i,p.YX.metadata.entity)]},j=(0,Y.s)(E);this.#i.navRelative([`edit/${j}`]),this.#s=!0},error:D=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}savePipeline(e){this.snackBar.open("Saving..."),this.#n.savePipeline(this.pipelineModel$.value).subscribe({next:n=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel$.next(n),e?.()},error:n=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(e=25){this.snackBar.open("Running query..."),this.#n.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,e).subscribe({next:n=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.pipelineResult=n,this.showQueryResult(n,e),console.warn(n),this.pipelineModel$.next((0,y.A)(this.pipelineModel$.value)),setTimeout(()=>{this.putEntityCountOnConnections$.next(n)})},error:n=>{this.snackBar.open("Query failed",null,{duration:2e3})}})}debugStream(e,n=25){e.Error?this.showStreamErrorResult(e):0!==e.Count&&(this.snackBar.open("Running stream..."),this.#n.debugStream(this.pipelineModel$.value.Pipeline.EntityId,e.Source,e.SourceOut,n).subscribe({next:s=>{this.snackBar.open("Stream worked",null,{duration:2e3});const c=this.pipelineModel$.value.DataSources.find(x=>x.EntityGuid===e.Source);this.showQueryResult(s,n,{name:e.SourceOut,source:e.Source,sourceName:c.Name,original:e}),console.warn(s)},error:s=>{this.snackBar.open("Stream failed",null,{duration:2e3})}}))}fetchPipeline(e,n,i){i&&this.snackBar.open("Reloading query, please wait..."),this.#n.fetchPipeline(this.#r,this.dataSources$.value).subscribe(s=>{i&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.#a.setTitle(`${s.Pipeline.Name} - Visual Query`),e&&this.pipelineModel$.next(s),n&&this.calculateDataSourceConfigs(s.DataSources)})}showQueryResult(e,n,i){this.dialog.open(xt,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:e,debugStream:i,top:n},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}showStreamErrorResult(e){this.dialog.open(Pt,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:e.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}fetchDataSources(e){this.#n.fetchDataSources().subscribe(n=>{this.dataSources$.next(n),e()})}attachKeyboardSave(){this.zone.runOutsideAngular(()=>{this.subscriptions.add((0,$.R)(window,"keydown").pipe((0,w.p)(()=>!this.#i.snapshot.firstChild),(0,w.p)(e=>(0,Mt.J)(e))).subscribe(e=>{e.preventDefault(),this.zone.run(()=>{this.savePipeline()})}))})}static#l=this.\u0275fac=function(n){return new(n||o)(t.KVO(Tt.UG),t.KVO(R.bZ),t.KVO(t.c1b),t.KVO(t.SKi),t.KVO(t.gRc))};static#c=this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac})}return o})();const W={App:{Name:"App",Label:"App DataSources",Icon:"star",UiHint:"DataSources from the current App"},Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function It(o,r){const e={};for(const n of o){let i;const s=r.find(c=>c.PartAssemblyAndType===n.PartAssemblyAndType);s&&(i={...s.PrimaryType?W[s.PrimaryType]:W.Unknown},null!=s.Icon&&(i.Icon=s.Icon),null!=s.DynamicIn&&(i.DynamicIn=s.DynamicIn),null!=s.DynamicOut&&(i.DynamicOut=s.DynamicOut),null!=s.HelpLink&&(i.HelpLink=s.HelpLink),null!=s.EnableConfig&&(i.EnableConfig=s.EnableConfig),null!=s.UiHint&&(i.UiHint=s.UiHint)),i||(i={...W.Unknown}),e[n.EntityGuid]=i}return e}var A=a(4456),V=a(8827),Ft=a(3037),Ot=a(1817),tt=a(5060),et=a(5175),nt=a(7984),H=a(5944),kt=a(3758),jt=a(9333);const it=o=>({active:o});function $t(o,r){1&o&&(t.j41(0,"app-field-hint"),t.EFF(1," You will get suggestions for out-streams after you run query "),t.k0s())}function At(o,r){1&o&&(t.j41(0,"app-field-hint",12),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function wt(o,r){if(1&o&&(t.j41(0,"mat-form-field",10)(1,"mat-label"),t.EFF(2,"Label"),t.k0s(),t.nrm(3,"input",11),t.k0s(),t.DNE(4,$t,2,0,"app-field-hint")(5,At,2,1,"app-field-hint",12)),2&o){const e=t.XpG();t.R7$(4),t.vxM(4,e.isSource&&!e.pipelineResultExists?4:-1),t.R7$(),t.vxM(5,e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?5:-1)}}function Ut(o,r){if(1&o&&(t.j41(0,"mat-option",19),t.EFF(1),t.k0s()),2&o){const e=r.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",e.name," ")}}function Gt(o,r){if(1&o&&(t.j41(0,"mat-form-field",10)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",18),t.Z7z(4,Ut,2,2,"mat-option",19,t.fX1),t.k0s()(),t.j41(6,"app-field-hint"),t.EFF(7," The scope should almost never be changed - "),t.j41(8,"a",20),t.EFF(9,"see help"),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(3),t.Y8G("placeholder",e.scopeOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.scopeOptions)}}function Lt(o,r){if(1&o&&(t.j41(0,"mat-option",19),t.EFF(1),t.k0s()),2&o){const e=r.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function Nt(o,r){if(1&o&&(t.j41(0,"mat-select",13),t.Z7z(1,Lt,2,2,"mat-option",19,t.fX1),t.k0s()),2&o){const e=t.XpG(2);t.Y8G("placeholder",e.labelOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.labelOptions)}}function Bt(o,r){1&o&&t.nrm(0,"input",11)}function Qt(o,r){1&o&&(t.j41(0,"app-field-hint",12),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}function Vt(o,r){if(1&o){const e=t.RV6();t.DNE(0,Gt,10,1),t.j41(1,"mat-form-field",10)(2,"mat-label"),t.EFF(3,"Label"),t.k0s(),t.DNE(4,Nt,3,1,"mat-select",13)(5,Bt,1,0,"input",11),t.j41(6,"div",14)(7,"button",15),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleGuidedLabel(!0))}),t.j41(8,"mat-icon",16),t.EFF(9,"search"),t.k0s()(),t.j41(10,"button",17),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleGuidedLabel(!1))}),t.j41(11,"mat-icon",16),t.EFF(12,"text_fields"),t.k0s()()()(),t.DNE(13,Qt,2,1,"app-field-hint",12)}if(2&o){const e=t.XpG();t.vxM(0,e.advancedMode&&e.guidedLabel?0:-1),t.R7$(4),t.vxM(4,e.guidedLabel?4:-1),t.R7$(),t.vxM(5,e.guidedLabel?-1:5),t.R7$(2),t.Y8G("ngClass",t.eq3(6,it,e.guidedLabel)),t.R7$(3),t.Y8G("ngClass",t.eq3(8,it,!e.guidedLabel)),t.R7$(3),t.vxM(13,e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?13:-1)}}function Xt(o,r){if(1&o){const e=t.RV6();t.j41(0,"mat-slide-toggle",21),t.bIt("change",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.toggleAdvancedMode(i))}),t.EFF(1),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("checked",e.advancedMode),t.R7$(),t.SpI(" ",e.advancedMode?"Advanced":"Simple"," ")}}let Kt=(()=>{class o extends u.${constructor(e,n,i,s){super(),this.dialogData=e,this.dialogRef=n,this.visualQueryService=i,this.changeDetectorRef=s,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.pipelineResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1,this.contentTypesService=(0,N.d)(C.gs)}ngOnInit(){this.buildForm()}ngOnDestroy(){super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}toggleGuidedLabel(e){this.guidedLabel=e}toggleAdvancedMode(e){this.advancedMode=e.checked}rename(){const e=this.form.getRawValue();this.closeDialog(e.label)}buildForm(){this.form=new A.J3({label:new A.hs(this.dialogData.label,A.k0.required),scope:new A.hs(p.YX.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscriptions.add(this.controls.scope.valueChanges.pipe((0,Ft.Z)(this.controls.scope.value),(0,Ot.F)()).subscribe(e=>{this.labelOptions=Object.values(this.visualQueryService.pipelineResult.Sources).find(n=>n.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(n=>n.Scope===e).map(n=>n.Name),!this.labelOptions.includes(this.controls.label.value)&&null!=this.controls.label.value&&this.controls.label.patchValue(null)})),this.contentTypesService.getScopes().subscribe(e=>{const n=Object.values(this.visualQueryService.pipelineResult.Sources).find(s=>s.Guid===this.dialogData.pipelineDataSourceGuid).Out,i=e.filter(s=>n.some(c=>c.Scope===s.value));this.scopeOptions=i,this.changeDetectorRef.markForCheck()}))}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(R.Vh),t.rXU(R.CP),t.rXU(Q),t.rXU(t.gRc))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(n,i){2&n&&t.Mr5("className",i.hostClass)},standalone:!0,features:[t.Vt3,t.aNF],decls:19,vars:5,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"formGroup"],[1,"eav-dialog-actions"],["color","accent",3,"checked"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","formControlName","label","required",""],[3,"isError"],["formControlName","label","required","",3,"placeholder"],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"click","ngClass"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"click","ngClass"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["color","accent",3,"change","checked"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Rename stream"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return i.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"form",5),t.DNE(9,wt,6,2)(10,Vt,14,10),t.k0s()(),t.j41(11,"mat-dialog-actions",6)(12,"div"),t.DNE(13,Xt,2,2,"mat-slide-toggle",7),t.k0s(),t.j41(14,"div")(15,"button",8),t.bIt("click",function(){return i.closeDialog()}),t.EFF(16,"Cancel"),t.k0s(),t.j41(17,"button",9),t.bIt("click",function(){return i.rename()}),t.EFF(18," Rename "),t.k0s()()()()),2&n&&(t.R7$(8),t.Y8G("formGroup",i.form),t.R7$(),t.vxM(9,i.isSource&&i.pipelineResultExists?-1:9),t.R7$(),t.vxM(10,i.isSource&&i.pipelineResultExists?10:-1),t.R7$(3),t.vxM(13,i.isSource&&i.pipelineResultExists?13:-1),t.R7$(4),t.Y8G("disabled",!i.form.valid))},dependencies:[U.Hl,U.$z,U.iY,k.m_,k.An,A.YN,A.qT,A.me,A.BC,A.cb,A.YS,A.X1,A.j4,A.JD,H.RG,H.rl,H.nJ,H.yw,nt.fS,nt.fg,et.Ve,et.VO,tt.wT,tt.Sy,O.YU,R.E7,V.mV,V.sG,kt.F,jt.c]})}return o})();var ot=a(5506);const T="dataSource_";class Yt{constructor(r,e,n,i,s,c,d,x,D){this.jsPlumbRoot=r,this.pipelineModel=e,this.dataSources=n,this.onConnectionsChanged=i,this.onDragend=s,this.onDebugStream=c,this.dialog=d,this.viewContainerRef=x,this.changeDetectorRef=D,this.log=new ot.B("Plumber",!1),this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(()=>{this.initDomDataSources(),this.initWirings(),this.bindEvents()}),this.instance.repaintEverything()}destroy(){this.dialogRef?.close(),this.instance.reset(),this.instance.unbindContainer()}removeEndpointsOnDataSource(r){const e=T+r;this.bulkDelete=!0,this.instance.batch(()=>{this.instance.selectEndpoints({element:e}).delete()}),this.bulkDelete=!1}getAllConnections(){return this.instance.getAllConnections().map(e=>({From:e.sourceId.replace(T,""),Out:e.endpoints[0].getOverlay("endpointLabel").label,To:e.targetId.replace(T,""),In:e.endpoints[1].getOverlay("endpointLabel").label}))}getStreamsOut(){const r=[];return this.instance.selectEndpoints({target:T+"Out"}).each(n=>{r.push(n.getOverlay("endpointLabel").label)}),r.join(",")}putEntityCountOnConnections(r){r.Streams?.forEach(e=>{const n=T+e.Source,s=["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(e.Target)?T+"Out":T+e.Target,c=n+"_out_"+e.SourceOut,d=s+"_in_"+e.TargetIn;this.instance.getEndpoint(c)?.connections?.filter(D=>D.endpoints[1].getUuid()===d)?.forEach(D=>{const E=e.Error?"":e.Count.toString();D.setLabel({label:E,cssClass:"streamEntitiesCount "+(e.Error?"streamEntitiesError":""),events:{click:G=>{this.pipelineModel.Pipeline.AllowEdit&&this.onDebugStream(e)}}})})})}nextLinePaintStyle(r){return this.uuidColorMap[r]||(this.uuidColorMap[r]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))}getInstanceDefaults(r){return{Container:r,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}initDomDataSources(){const r=this.log.fnCond(!1,"initDomDataSources");for(const e of this.pipelineModel.DataSources){const n=this.jsPlumbRoot.querySelector("#"+T+e.EntityGuid);if(!n)continue;const i=this.dataSources.find(d=>d.PartAssemblyAndType===e.PartAssemblyAndType);if(!i)continue;this.pipelineModel.Pipeline.AllowEdit&&this.instance.draggable(n,{grid:[20,20],stop:d=>{const D=d.el.id.replace(T,""),E={Top:d.finalPos[1],Left:d.finalPos[0]};setTimeout(()=>{this.onDragend(D,E)})}});const s=i.Out?.length??0;r.a("dataSource.Out",{outCount:s,out:i.Out}),i.Out?.forEach(d=>{this.addEndpoint(n,d,!1,e,s)});const c=i.In?.length??0;if(r.a("dataSource.In",{inCount:c,in:i.In}),i.In?.forEach(d=>{this.addEndpoint(n,d,!0,e,c)}),i.In){const d=this.buildTargetEndpoint(e.EntityGuid);d.maxConnections=-1,this.instance.makeTarget(n,d)}i.DynamicOut&&this.instance.makeSource(n,this.buildSourceEndpoint(e.EntityGuid),{filter:".add-endpoint"})}r.end()}initWirings(){const r=this.log.fn("initWirings"),e=this.pipelineModel.Pipeline.StreamWiring;if(!e)return r.end("no wirings");const n=st(e,s=>s.To),i=st(e,s=>s.From);r.values({inGroups:n,outGroups:i}),e.forEach(s=>{const c=T+s.From,d=c+"_out_"+s.Out,x=T+s.To,D=x+"_in_"+s.In;if(!this.instance.getEndpoint(d)){const E=this.jsPlumbRoot.querySelector("#"+c);if(!E)return;const j=E.id.replace(T,""),G=this.pipelineModel.DataSources.find(L=>L.EntityGuid===j);this.addEndpoint(E,s.Out,!1,G,i[s.From].length)}if(!this.instance.getEndpoint(D)){const E=this.jsPlumbRoot.querySelector("#"+x);if(!E)return;const j=E.id.replace(T,""),G=this.pipelineModel.DataSources.find(L=>L.EntityGuid===j);this.addEndpoint(E,s.In,!0,G,n[s.To].length)}try{this.instance.connect({uuids:[d,D],paintStyle:this.nextLinePaintStyle(d)})}catch{console.error({message:"Connection failed",from:d,to:D})}}),r.end()}addEndpoint(r,e,n,i,s=0){const c=this.log.fnCond(!1,"addEndpoint",{endpointName:e,isIn:n,pipelineDataSource:i}),d=this.dataSources.find(z=>z.PartAssemblyAndType===i.PartAssemblyAndType),x=n?d.In:d.Out,D=x?.some(z=>this.getEndpointInfo(z,!1)),E=this.getEndpointInfo(e,D);let j;c.a(`endpointInfo ${s}`,{dataSource:d,connectionList:x,isDynamic:D,count:s,endpointInfo:E}),j=D?"dynamic":E.required?this.pipelineModel.Pipeline.StreamWiring?.some(lt=>T+lt.To===r.id&&lt.In===E.name)?"":"required":"";const G=r.id+(n?"_in_":"_out_")+E.name,L=s>3,we=n?this.buildTargetEndpoint(i.EntityGuid,j):this.buildSourceEndpoint(i.EntityGuid,j),Z=this.instance.addEndpoint(r,we,{uuid:G,enabled:this.pipelineModel.Pipeline.AllowEdit||i.EntityGuid===p.YX.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel");Z.setLabel(E.name),L&&Z.addClass("angled"),c.end("end",{count:s,angled:L,overlay:Z})}buildSourceEndpoint(r,e){return{paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint "+e,maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(!0),events:{click:s=>{this.onChangeLabel(s,!0,r)}}}}buildTargetEndpoint(r,e){return{paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint "+(e??" "),maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:s=>{this.onChangeLabel(s,!1,r)}}}}getEndpointOverlays(r){return[["Label",{id:"endpointLabel",location:[.5,r?0:1],label:"Default",cssClass:r?"endpointSourceLabel":"endpointTargetLabel"}]]}onChangeLabel(r,e,n){if(!this.pipelineModel.Pipeline.AllowEdit)return;const i=r.getOverlay?r.getOverlay("endpointLabel"):r;this.dialogRef=this.dialog.open(Kt,{autoFocus:!1,data:{pipelineDataSourceGuid:n,isSource:e,label:i.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.dialogRef.afterClosed().subscribe(c=>{c&&(i.setLabel(c),setTimeout(()=>{this.onConnectionsChanged()}))}),this.changeDetectorRef.markForCheck()}bindEvents(){this.instance.bind("connectionDetached",r=>{if(this.bulkDelete)return;const e=r.target,n=this.pipelineModel.DataSources.find(d=>d.EntityGuid===e.id.replace(T,"")),i=this.dataSources.find(d=>d.PartAssemblyAndType===n.PartAssemblyAndType),s=r.targetEndpoint.getOverlay("endpointLabel").label;i.In.some(d=>this.getEndpointInfo(d,!1).name===s)||this.instance.deleteEndpoint(r.targetEndpoint),setTimeout(()=>{this.onConnectionsChanged()})}),this.instance.bind("connection",r=>{if(r.sourceId===r.targetId)return void setTimeout(()=>{this.instance.deleteConnection(r.connection,{fireEvent:!1}),setTimeout(()=>{this.onConnectionsChanged()})});const e=r.targetEndpoint.getOverlay("endpointLabel"),n=e.getLabel();this.instance.getEndpoints(r.target.id).some(c=>c.getOverlay("endpointLabel").getLabel()===n&&r.targetEndpoint.id!==c.id&&c.canvas.classList.contains("targetEndpoint"))&&e.setLabel(`PleaseRename${Math.floor(99999*Math.random())}`),setTimeout(()=>{this.onConnectionsChanged()})})}getEndpointInfo(r,e){let n,i;if(e)n=r,i=!1;else{const c=r.trim();i=c.endsWith("*"),n=i?c.substring(0,c.length-1):c}return{name:n,required:i}}}const st=(o,r)=>o.reduce((e,n)=>((e[r(n)]||=[]).push(n),e),{});var Jt=a(1459),Zt=a(8021);const qt=["domRoot"],te=["domDataSource"],ee=(o,r,e)=>({top:o,left:r,"min-width":e}),ne=o=>({"show-details":o});function ie(o,r){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",16),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,s=t.XpG(3);return t.Njj(s.configureDataSource(i))}),t.EFF(1," settings "),t.k0s()}}function oe(o,r){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",17),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,s=t.XpG(2),c=t.XpG();return t.Njj(c.openHelp(s.typeInfos[i.EntityGuid].HelpLink))}),t.EFF(1," help_outline "),t.k0s()}}function se(o,r){if(1&o){const e=t.RV6();t.j41(0,"mat-icon",18),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,s=t.XpG(3);return t.Njj(s.remove(i))}),t.EFF(1," delete "),t.k0s()}}function ae(o,r){if(1&o&&(t.j41(0,"tr",21)(1,"td",22),t.EFF(2),t.k0s(),t.j41(3,"td",23),t.EFF(4),t.k0s()()),2&o){const e=r.$implicit;t.R7$(),t.Y8G("title",e.name),t.R7$(),t.JRh(e.name),t.R7$(),t.Y8G("title",e.value),t.R7$(),t.JRh(e.value)}}function re(o,r){if(1&o&&(t.nrm(0,"hr",19),t.j41(1,"table",20),t.Z7z(2,ae,5,4,"tr",21,t.fX1),t.k0s()),2&o){const e=t.XpG().$implicit,n=t.XpG(2);t.R7$(2),t.Dyx(n.dataSourceConfigs[e.EntityId])}}function le(o,r){1&o&&t.nrm(0,"div",14)}function ce(o,r){1&o&&t.nrm(0,"div",15)}function pe(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",3,1)(2,"div",4)(3,"mat-icon",5),t.EFF(4),t.k0s(),t.DNE(5,ie,2,0,"mat-icon",6)(6,oe,2,0,"mat-icon",7),t.k0s(),t.j41(7,"div",8),t.DNE(8,se,2,0,"mat-icon",9),t.k0s(),t.j41(9,"div",10),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2),c=t.XpG();return t.Njj(s.allowEdit&&c.editName(i))}),t.j41(10,"span"),t.EFF(11),t.k0s(),t.j41(12,"mat-icon",11),t.EFF(13,"edit"),t.k0s()(),t.nrm(14,"br"),t.j41(15,"div",12),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2),c=t.XpG();return t.Njj(s.allowEdit&&c.editDescription(i))}),t.j41(16,"span"),t.EFF(17),t.k0s(),t.j41(18,"mat-icon",11),t.EFF(19,"edit"),t.k0s()(),t.nrm(20,"br"),t.DNE(21,re,4,0),t.j41(22,"div",13),t.EFF(23),t.k0s(),t.DNE(24,le,1,0,"div",14)(25,ce,1,0,"div",15),t.k0s()}if(2&o){const e=r.$implicit,n=t.XpG(2),i=t.XpG();t.Y8G("id",i.dataSrcIdPrefix+e.EntityGuid)("ngStyle",t.sMw(15,ee,e.VisualDesignerData.Top+"px",e.VisualDesignerData.Left+"px",e.VisualDesignerData.Width?e.VisualDesignerData.Width+"px":null))("ngClass",t.eq3(19,ne,n.showDataSourceDetails&&(null==n.dataSourceConfigs[e.EntityId]?null:n.dataSourceConfigs[e.EntityId].length))),t.R7$(3),t.Y8G("title",n.typeInfos[e.EntityGuid].UiHint),t.R7$(),t.SpI(" ",n.typeInfos[e.EntityGuid].Icon," "),t.R7$(),t.vxM(5,n.allowEdit&&n.typeInfos[e.EntityGuid].EnableConfig?5:-1),t.R7$(),t.vxM(6,n.typeInfos[e.EntityGuid].HelpLink?6:-1),t.R7$(2),t.vxM(8,n.allowEdit&&!i.isOutDataSource(e)?8:-1),t.R7$(3),t.JRh(e.Name||"(no name)"),t.R7$(6),t.JRh(e.Description),t.R7$(4),t.vxM(21,n.showDataSourceDetails&&null!=n.dataSourceConfigs[e.EntityId]&&n.dataSourceConfigs[e.EntityId].length?21:-1),t.R7$(),t.Y8G("title",e.PartAssemblyAndType),t.R7$(),t.SpI(" Type: ",i.getTypeName(e.PartAssemblyAndType)," "),t.R7$(),t.vxM(24,n.allowEdit&&n.typeInfos[e.EntityGuid].DynamicOut?24:-1),t.R7$(),t.vxM(25,n.allowEdit&&n.typeInfos[e.EntityGuid].DynamicIn?25:-1)}}function de(o,r){if(1&o&&t.Z7z(0,pe,26,21,"div",3,t.fX1),2&o){const e=t.XpG();t.Dyx(e.pipelineDataSources)}}function ue(o,r){if(1&o&&(t.j41(0,"div",2,0),t.DNE(2,de,2,0),t.k0s()),2&o){const e=t.XpG();t.R7$(2),t.vxM(2,e.hardReset?-1:2)}}const me={enabled:!1,name:"PlumbEditorComponent"};let at=(()=>{class o extends u.${constructor(e,n,i,s){super(),this.visualQueryService=e,this.changeDetectorRef=n,this.dialog=i,this.viewContainerRef=s,this.dataSrcIdPrefix=T,this.hardReset=!1,this.scriptLoaded$=new l.t(!1),this.queryDefinitionService=(0,N.d)(f),this.log=new ot.B(me)}ngOnInit(){(0,P.P)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],()=>{this.scriptLoaded$.next(!0)}),this.subscriptions.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(n=>{this.plumber.putEntityCountOnConnections(n)}));const e=this.visualQueryService.pipelineModel$.pipe((0,_.T)(n=>J.i.tryParse(n?.Pipeline.VisualDesignerData)??{}),(0,Zt.A)(n=>n));this.viewModel$=(0,m.z)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$,e,this.visualQueryService.dataSourceConfigs$]).pipe((0,_.T)(([n,i,s,c])=>null==n||null==i?void 0:(this.hardReset=!0,this.changeDetectorRef.detectChanges(),this.hardReset=!1,{pipelineDataSources:n.DataSources,typeInfos:It(n.DataSources,i),allowEdit:n.Pipeline.AllowEdit,showDataSourceDetails:s.ShowDataSourceDetails??!1,dataSourceConfigs:c})))}ngAfterViewInit(){const e=this.log.fn("ngAfterViewInit"),n=this.domDataSourcesRef.changes.pipe((0,_.T)(()=>!0));this.subscriptions.add((0,m.z)([this.scriptLoaded$,n]).subscribe(([i,s])=>{!i||!s||(this.log.a("scriptLoaded and domDataSourcesLoaded",{scriptLoaded:i,domDataSourcesLoaded:s}),this.plumber?.destroy(),this.plumber=new Yt(this.domRootRef.nativeElement,this.visualQueryService.pipelineModel$.value,this.visualQueryService.dataSources$.value,this.onConnectionsChanged.bind(this),this.onDragend.bind(this),this.onDebugStream.bind(this),this.dialog,this.viewContainerRef,this.changeDetectorRef))})),e.end()}ngOnDestroy(){this.plumber?.destroy(),this.scriptLoaded$.complete(),super.ngOnDestroy()}onConnectionsChanged(){const e=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(e,n)}onDragend(e,n){this.visualQueryService.changeDataSourcePosition(e,n)}onDebugStream(e){this.visualQueryService.debugStream(e)}configureDataSource(e){e.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(e)}getTypeName(e){const n=this.visualQueryService.dataSources$.value.find(i=>i.PartAssemblyAndType===e);return this.queryDefinitionService.typeNameFilter(n?.TypeNameForUi||e,"className")}isOutDataSource(e){return e.PartAssemblyAndType===p.YX.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(e){if(!confirm(`Delete ${e.Name} data source?`))return;this.plumber.removeEndpointsOnDataSource(e.EntityGuid);const n=this.plumber.getAllConnections(),i=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(e.EntityGuid,n,i)}openHelp(e){window.open(e,"_blank")}editName(e){const n=prompt("Rename data source",e.Name)?.trim();null==n||""===n||this.visualQueryService.renameDataSource(e.EntityGuid,n)}editDescription(e){const n=prompt("Edit description",e.Description)?.trim();null!=n&&this.visualQueryService.changeDataSourceDescription(e.EntityGuid,n)}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(Q),t.rXU(t.gRc),t.rXU(R.bZ),t.rXU(t.c1b))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-plumb-editor"]],viewQuery:function(n,i){if(1&n&&(t.GBs(qt,5),t.GBs(te,5)),2&n){let s;t.mGM(s=t.lsd())&&(i.domRootRef=s.first),t.mGM(s=t.lsd())&&(i.domDataSourcesRef=s)}},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["domRoot",""],["domDataSource",""],["id","pipeline-root"],[1,"dataSource",3,"id","ngStyle","ngClass"],[1,"actions","left"],[1,"type-info",3,"title"],["title","Configure data source","appMousedownStopPropagation","",1,"configure"],["title","Help for this data source","appMousedownStopPropagation","",1,"help"],[1,"actions","right"],["title","Delete","appMousedownStopPropagation","",1,"delete"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"]],template:function(n,i){if(1&n&&(t.DNE(0,ue,3,1,"div",2),t.nI1(1,"async")),2&n){let s;t.vxM(0,(s=t.bMT(1,1,i.viewModel$))?0:-1,s)}},dependencies:[O.B3,O.YU,k.m_,k.An,O.Jj,Jt.z],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}\n\n/*# sourceMappingURL=https://sources.2sxc.org/18.00.02/dist/ng-edit/C:/Projects/2sxc/eav-ui/projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.component.ts-angular-inline--1.css.map*/"]})}return o})();var ge=a(4981),fe=a(7896);function ve(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",7),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(4);return t.Njj(s.addDataSource(i))}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()}if(2&o){const e=r.$implicit,n=t.XpG(4);t.Y8G("tippy",e.UiHint||e.Name),t.R7$(2),t.JRh(e.Icon||n.guiTypes.Unknown.Icon),t.R7$(2),t.JRh(e.Name)}}function ye(o,r){if(1&o&&(t.j41(0,"div",5),t.Z7z(1,ve,5,3,"div",6,t.BUC().trackDataSources,!0),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.Dyx(e.value)}}function Ce(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",4),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.toggleItem(i.key))}),t.j41(1,"mat-icon"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()(),t.DNE(5,ye,3,0,"div",5)}if(2&o){let e;const n=r.$implicit,i=t.XpG(2);t.Y8G("tippy",i.guiTypes[n.key].UiHint||n.key),t.R7$(2),t.JRh(i.guiTypes[n.key].Icon||i.guiTypes.Unknown.Icon),t.R7$(2),t.JRh(null!==(e=null!==(e=i.guiTypes[n.key].Label)&&void 0!==e?e:i.guiTypes[n.key].Name)&&void 0!==e?e:n.key),t.R7$(),t.vxM(5,i.toggledItems.includes(n.key)?5:-1)}}function Ee(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"span",2),t.EFF(3,"Show Advanced"),t.k0s(),t.j41(4,"mat-slide-toggle",3),t.bIt("change",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.toggleDifficulty(i))}),t.k0s()(),t.Z7z(5,Ce,6,4,null,null,t.BUC().trackGroups,!0),t.nI1(7,"keyvalue"),t.k0s()}2&o&&(t.R7$(5),t.Dyx(t.bMT(7,0,r.sorted)))}let De=(()=>{class o{constructor(e){this.visualQueryService=e,this.toggledItems=[],this.guiTypes=W,this.difficulties=p.YX.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new l.t(this.difficulties.default)}ngOnInit(){this.viewModel$=(0,m.z)([(0,m.z)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,_.T)(([e,n])=>function _e(o,r){if(!o)return;const n=(0,y.A)(o).filter(s=>s.Difficulty<=r&&s.PartAssemblyAndType!==p.YX.pipelineDesigner.outDataSource.PartAssemblyAndType);n.sort((s,c)=>s.Name.toLocaleLowerCase().localeCompare(c.Name.toLocaleLowerCase()));const i={};for(const s of n){const c=s.PrimaryType;i[c]?i[c].push(s):i[c]=[s]}return i}(e,n)))]).pipe((0,_.T)(([e])=>({sorted:e})))}ngOnDestroy(){this.difficulty$.complete()}toggleDifficulty(e){this.difficulty$.next(e.checked?this.difficulties.advanced:this.difficulties.default)}addDataSource(e){this.visualQueryService.addDataSource(e)}toggleItem(e){ge.f.toggleInArray(e,this.toggledItems)}trackGroups(e,n){return n.key}trackDataSources(e,n){return n.PartAssemblyAndType}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-add-explorer"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"eav-show-advanced"],[1,"eav-slide-toggle-label"],["color","primary",3,"change"],["tippyShowDelay","750",1,"collapsible",3,"click","tippy"],[1,"list"],["tippyShowDelay","750",1,"list-item",3,"tippy"],["tippyShowDelay","750",1,"list-item",3,"click","tippy"]],template:function(n,i){if(1&n&&(t.DNE(0,Ee,8,2,"div",0),t.nI1(1,"async")),2&n){let s;t.vxM(0,(s=t.bMT(1,1,i.viewModel$))?0:-1,s)}},dependencies:[V.mV,V.sG,k.m_,k.An,O.Jj,O.lG,fe.e],styles:[".mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}.eav-show-advanced[_ngcontent-%COMP%]{margin-left:8px}"]})}return o})();var Se=a(4079);function xe(o,r){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=r.$implicit;t.R7$(),t.SpI(" ",e," ")}}function Pe(o,r){if(1&o&&(t.j41(0,"ul",9),t.Z7z(1,xe,2,1,"li",null,t.fX1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Dyx(null==e.Pipeline.Params?null:e.Pipeline.Params.split("\n"))}}function Re(o,r){if(1&o&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&o){const e=r.$implicit;t.R7$(),t.SpI(" ",e," ")}}function Me(o,r){if(1&o&&(t.j41(0,"ul",9),t.Z7z(1,Re,2,1,"li",null,t.fX1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Dyx(null==e.Pipeline.TestParameters?null:e.Pipeline.TestParameters.split("\n"))}}function Te(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",5)(1,"span",12),t.EFF(2,"Show DataSource Params"),t.k0s(),t.j41(3,"mat-slide-toggle",13),t.bIt("change",function(i){t.eBV(e);const s=t.XpG(2);return t.Njj(s.showDataSourceDetails(i))}),t.k0s()()}2&o&&(t.R7$(3),t.Y8G("checked",r.ShowDataSourceDetails))}function Ie(o,r){1&o&&t.nrm(0,"li",16),2&o&&t.Y8G("innerHTML",r.$implicit,t.npT)}function Fe(o,r){if(1&o&&(t.j41(0,"div",14)(1,"div",6)(2,"span"),t.EFF(3,"Warnings"),t.k0s(),t.j41(4,"mat-icon",15),t.EFF(5,"warning"),t.k0s()(),t.j41(6,"ol",9),t.Z7z(7,Ie,1,1,"li",16,t.fX1),t.k0s()()),2&o){const e=t.XpG();t.R7$(7),t.Dyx(e)}}function Oe(o,r){1&o&&t.DNE(0,Fe,9,0,"div",14),2&o&&t.vxM(0,r.length?0:-1)}function ke(o,r){if(1&o&&(t.j41(0,"div",10)(1,"div",6),t.EFF(2,"Query Description"),t.k0s(),t.j41(3,"div"),t.EFF(4),t.k0s()()),2&o){const e=t.XpG();t.R7$(4),t.JRh(e.Pipeline.Description)}}function je(o,r){if(1&o){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.saveAndRunQuery(!0,!0))}),t.EFF(4," Save and run "),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.saveAndRunQuery(!1,!0))}),t.EFF(6," Run "),t.k0s(),t.j41(7,"button",4),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.saveAndRunQuery(!0,!1))}),t.EFF(8," Save "),t.k0s()(),t.j41(9,"div",5)(10,"div",6)(11,"div"),t.EFF(12,"Query Parameters"),t.k0s(),t.j41(13,"div")(14,"button",7),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.editPipeline())}),t.j41(15,"mat-icon"),t.EFF(16,"edit"),t.k0s()(),t.j41(17,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.openParamsHelp())}),t.j41(18,"mat-icon"),t.EFF(19,"info"),t.k0s()()()(),t.DNE(20,Pe,3,0,"ul",9),t.k0s(),t.j41(21,"div",5)(22,"div",6),t.EFF(23,"Test Parameters"),t.k0s(),t.DNE(24,Me,3,0,"ul",9),t.k0s(),t.DNE(25,Te,4,1,"div",5),t.nI1(26,"async"),t.DNE(27,Oe,1,1),t.nI1(28,"async"),t.DNE(29,ke,5,1,"div",10),t.j41(30,"div",11)(31,"button",4),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.openRestApi())}),t.j41(32,"span"),t.EFF(33,"Use in JSON / REST API"),t.k0s(),t.j41(34,"mat-icon"),t.EFF(35,"code_curly"),t.k0s()()()()()}if(2&o){let e,n;const i=r,s=t.XpG();t.R7$(20),t.vxM(20,null!=i.Pipeline.Params&&i.Pipeline.Params.length?20:-1),t.R7$(4),t.vxM(24,null!=i.Pipeline.TestParameters&&i.Pipeline.TestParameters.length?24:-1),t.R7$(),t.vxM(25,(e=t.bMT(26,5,s.visualDesignerData$))?25:-1,e),t.R7$(2),t.vxM(27,(n=t.bMT(28,7,s.warnings$))?27:-1,n),t.R7$(2),t.vxM(29,i.Pipeline.Description?29:-1)}}let $e=(()=>{class o{#t=(0,N.d)(q.c);constructor(e,n){this.context=e,this.visualQueryService=n}ngOnInit(){this.pipelineModel$=this.visualQueryService.pipelineModel$.asObservable(),this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,_.T)(e=>function be(o,r){const e=[];try{const n=o.Pipeline.Params?.split(/\r?\n/)||[],i=o.Pipeline.TestParameters?.split(/\r?\n/)||[];n.forEach(s=>{s=s?.trim(),s&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(s)||e.push(`\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        `))}),i.forEach(s=>{if(s=s?.trim(),!s)return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(s)||e.push(`\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        `);const D=/^\[module:id\]=([0-9]*)$/gim.exec(s);if(D){const G=D[1],L=r.moduleId?.toString();G!==L&&e.push(`\n            Your test ModuleId (${G}) is different from the current ModuleId (${L}).<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          `)}/^\[module:moduleid\]=([0-9]*)$/gim.exec(s)&&e.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")})}catch(n){console.error("Something went wrong in calculateWarnings for params",n)}return e}(e,this.context))),this.visualDesignerData$=this.visualQueryService.pipelineModel$.pipe((0,_.T)(e=>J.i.tryParse(e.Pipeline.VisualDesignerData)??{}))}editPipeline(){this.visualQueryService.editPipelineEntity()}openParamsHelp(){window.open("https://go.2sxc.org/QueryParams","_blank")}saveAndRunQuery(e,n){this.visualQueryService.saveAndRun(e,n)}showDataSourceDetails(e){this.visualQueryService.showDataSourceDetails(e.checked)}openRestApi(){this.#t.navRelative([Se.N5.getUrlQueryDialog(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)])}static#e=this.\u0275fac=function(n){return new(n||o)(t.rXU(h.o),t.rXU(Q))};static#n=this.\u0275cmp=t.VBU({type:o,selectors:[["app-run-explorer"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],[1,"values"],[1,"description"],[1,"footer-actions"],[1,"eav-slide-toggle-label"],["color","primary",3,"change","checked"],[1,"warnings"],[2,"color","red"],[3,"innerHTML"]],template:function(n,i){if(1&n&&(t.DNE(0,je,36,9,"div",0),t.nI1(1,"async")),2&n){let s;t.vxM(0,(s=t.bMT(1,1,i.pipelineModel$))?0:-1,s)}},dependencies:[U.Hl,U.$z,U.iY,k.m_,k.An,V.mV,V.sG,O.Jj],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}.eav-slide-toggle-label[_ngcontent-%COMP%]{margin-right:4px;font-size:14px}"]})}return o})();const rt=o=>({active:o});let Ae=(()=>{class o{constructor(e,n,i){this.context=e,this.route=n,this.visualQueryService=i,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(e){this.activeExplorer=this.activeExplorer===e?null:e}openHelp(){window.open("https://go.2sxc.org/visual-query","_blank")}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(h.o),t.rXU(g.nX),t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-visual-query"]],viewQuery:function(n,i){if(1&n&&t.GBs(at,5),2&n){let s;t.mGM(s=t.lsd())&&(i.plumbEditor=s.first)}},standalone:!0,features:[t.Jv_([Q]),t.aNF],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"click","ngClass"],["tippy","Add",1,"button",3,"click","ngClass"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(n,i){1&n&&(t.nrm(0,"router-outlet"),t.j41(1,"div",0)(2,"div",1)(3,"div",2),t.bIt("click",function(){return i.toggleExplorer(i.explorer.run)}),t.j41(4,"mat-icon"),t.EFF(5,"play_arrow"),t.k0s()(),t.j41(6,"div",3),t.bIt("click",function(){return i.toggleExplorer(i.explorer.add)}),t.j41(7,"mat-icon"),t.EFF(8,"add"),t.k0s()(),t.nrm(9,"div",4),t.j41(10,"div",5),t.bIt("click",function(){return i.openHelp()}),t.j41(11,"mat-icon"),t.EFF(12,"help_outline"),t.k0s()()(),t.nrm(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),t.k0s()),2&n&&(t.R7$(3),t.Y8G("ngClass",t.eq3(4,rt,i.activeExplorer===i.explorer.run)),t.R7$(3),t.Y8G("ngClass",t.eq3(6,rt,i.activeExplorer===i.explorer.add)),t.R7$(7),t.Y8G("hidden",i.activeExplorer!==i.explorer.run),t.R7$(),t.Y8G("hidden",i.activeExplorer!==i.explorer.add))},dependencies:[g.n3,O.YU,k.m_,k.An,$e,De,at],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}return o})()},5839:(M,v,a)=>{a.d(v,{A:()=>h});const h=function g(l,_){for(var m=-1,u=null==l?0:l.length;++m<u&&!1!==_(l[m],m,l););return l}},9934:(M,v,a)=>{a.d(v,{A:()=>_});var g=a(3151),h=Object.create;const _=function(){function m(){}return function(u){if(!(0,g.A)(u))return{};if(h)return h(u);m.prototype=u;var p=new m;return m.prototype=void 0,p}}()},2549:(M,v,a)=>{a.d(v,{A:()=>l});const l=(0,a(9093).A)(Object.getPrototypeOf,Object)}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.02/dist/ng-edit/projects_eav-ui_src_app_visual-query_visual-query_component_ts-node_modules_lodash-es__arrayE-ac6327.d29ad19afed6837c.js.map