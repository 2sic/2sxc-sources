{"version":3,"file":"projects_eav-ui_src_app_apps-management_create-inherited-app_create-inherited-app_component_ts.17b56d664315a7bf.js","mappings":"oVAIQA,MAAA,4BADFA,MAAA,cACEA,MAAA,EAAAC,EAAA,sBACFD,uCADiBA,cAAA,mBAAAE,yBAKfF,MAAA,4BADFA,MAAA,eACEA,MAAA,EAAAG,EAAA,sBACFH,uCADiBA,cAAA,mBAAAE,yBAOrBF,MAAA,GCFK,IAAMI,EAAkB,MAAzB,MAAOA,EAIXC,cAHAC,KAAAC,WAAUC,QAAe,GACzBF,KAAAG,SAAU,CAEM,CAEhBC,gBACEJ,KAAKG,SAAWH,KAAKG,OACvB,CAACE,SAAAL,KAAA,mBAAAM,iBARUR,EAAkB,EAAAO,SAAAL,KAAA,UAAAO,EAAAC,IAAA,MAAlBV,EAAkBW,UAAA,qBAAAC,OAAA,CAAAT,QAAA,eAAAU,mBAAAC,EAAAC,MAAA,EAAAC,KAAA,EAAAC,OAAA,2EAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,yBDd/BvB,MAAA,WAAsBA,MAAA,mBAAAA,aAAAyB,GAAAzB,MAASwB,EAAAd,gBAAe,GAO1CV,MALA,EAAA0B,EAAA,eAKA1B,CALe,EAAA2B,EAAA,iBAWnB3B,QAEAA,MAAA,EAAA4B,EAAA,yBAAA5B,qBAfgDA,MAAA,UAAAA,MAAA,EAAA6B,EAAAL,EAAAf,UAC9CT,eAAA,KAAA8B,EAAAN,EAAAjB,WAAK,GAAL,IAAKuB,EAAD,sBCQEC,IAAkBC,QAClBC,KACAC,MAAgBC,OAAA,+cAGX/B,CAAkB,+RCYrBJ,MAAA,kBACEA,MAAA,GACFA,kCAFYA,MAAA,QAAAoC,EAAAC,IACVrC,cAAA,IAAAoC,EAAAE,KAAA,4BAMNtC,MAAA,sBACEA,MAAA,gBACFA,cAFgBA,MAAA,cCHf,IAAMuC,EAA2B,MAAlC,MAAOA,EAOXlC,YACUmC,EACAC,GADAnC,KAAAkC,SACAlC,KAAAmC,WARgBnC,KAAAoC,UAAY,mBAI9BpC,KAAAqC,mBAAkBC,KAAUC,KASpCvC,KAAAwC,WAAUC,QAAgB,GAC1BzC,KAAA0C,gBAAkB1C,KAAKqC,gBAAgBM,iBAAiBC,MAJtD5C,KAAK6C,KAAO7C,KAAK8C,WACnB,CAKAC,cACE/C,KAAKkC,OAAOc,OACd,CAEAC,SACEjD,KAAK6C,KAAKK,UACVlD,KAAKwC,QAAQW,KAAI,GACjB,MAAMC,EAAYpD,KAAK6C,KAAKQ,SAASD,UAAUR,MAGzCU,EAAOtD,KAAK0C,kBAAkBa,KAAKC,GAAOA,EAAIzB,KAAOqB,GAAWpB,KACtEhC,KAAKmC,SAASsB,KAAK,6BACnBzD,KAAKqC,gBAAgBY,OAAOK,EAAMF,GAAWM,UAAU,CACrDC,MAAOA,KACL3D,KAAK6C,KAAKe,SACV5D,KAAKwC,QAAQW,KAAI,GAEjBnD,KAAKmC,SAASsB,KAAK,iFAA6EI,EAAW,CAAEC,SAAU,KAAM,EAE/HC,KAAMA,KACJ/D,KAAK6C,KAAKe,SACV5D,KAAKmC,SAASsB,KAAK,6BAAyBI,EAAW,CAAEC,SAAU,MACnE9D,KAAK+C,aAAW,GAGtB,CAEQD,YAIN,OAHa,IAAIkB,KAAiB,CAChCZ,UAAW,IAAIa,KAAmB,KAAM,CAACC,KAAWC,YAGxD,CAAC9D,SAAAL,KAAA,mBAAAM,iBAjDU2B,GAA2BvC,MAAAgC,KAAAhC,MAAA0E,MAAA,EAAA/D,SAAAL,KAAA,UAAAqE,EAAA7D,IAAA,MAA3ByB,EAA2BxB,UAAA,+BAAA6D,SAAA,EAAAC,aAAA,SAAAtD,EAAAC,GAAA,EAAAD,GAA3BvB,MAAA,YAAAwB,EAAAkB,8cD5BT1C,MAFJ,UAEIA,CAFoB,UAEpBA,CAD6B,WACSA,MAAA,0BAAoBA,QAC1DA,MAAA,cAIEA,MAAA,0BAASwB,EAAA6B,aAAa,GAEtBrD,MAAA,cAAUA,MAAA,WAEdA,YACAA,MAAA,WACEA,MAAA,mBACAA,MAAA,OACEA,MAAA,4RAIFA,QAGIA,MAFJ,YAEIA,CAFqB,sBAErBA,CADwD,gBAC7CA,MAAA,kBAAWA,QACtBA,MAAA,mBAEEA,MAAA,GAAA8E,EAAA,mBAAA9E,OAMJA,UACAA,MAAA,GAAA+E,EAAA,wBAMJ/E,UAEEA,MADF,2BACEA,CAD8B,gBAIUA,MAAA,0BAASwB,EAAA+B,QAAQ,GAEvDvD,MAAA,eAGNA,mBA1CMA,MAAA,GAAAA,MAAA,WAAAwB,EAAAsB,WAcI9C,MAAA,GAAAA,MAAA,YAAAwB,EAAA2B,MAIAnD,MAAA,GAAAA,MAAA,mBAAAmE,IAAA3C,EAAAwB,kBAAA,oBAAAxB,EAAAwB,mBAAA,IAAAxB,EAAAwB,kBAAAgC,OAAA,gCACAhF,cAAAwB,EAAAwB,mBAOJhD,MAAA,GAAAA,MAAAwB,EAAA2B,KAAAQ,SAAAD,UAAAuB,SAAA,MAAAzD,EAAA2B,KAAAQ,SAAAD,UAAAwB,QAAA1D,EAAA2B,KAAAQ,SAAAD,UAAAwB,OAAAT,SAAA,OAWAzE,MAAA,GAAAA,MAAA,WAAAwB,EAAAsB,YAAAtB,EAAA2B,KAAAgC,uBCzBFC,KACAC,KAAWC,eACXC,KAAmBD,UACnBvD,IAAkByD,QAClBC,IAAeC,QACfC,IACAC,IACAC,KAAeC,SACfC,KAAaC,KACb5F,KAAkB6F,cAAA,WAGT1D,CAA2B,kGCxBxC,MAGM2D,EAAmB,gBAKlB,IAAMrD,EAAgB,MAAvB,MAAOA,UAAwBsD,IAGnCC,WAAWC,GACT,SAAOC,MAAoB,KACzBD,IACQ,CACNE,IAAKjG,KAAKkG,OAfQ,kBAgBlBC,OAAQ,CAAEC,OAAQpG,KAAKoG,UAG7B,CAEAzD,iBACE,SAAOqD,MAAoB,MACzBC,IAAKjG,KAAKkG,OAtBqB,6BAuB/BC,OAAQ,CAAEC,OAAQpG,KAAKoG,UAE3B,CAEAC,iBACE,SAAOL,MAA2B,MAChCC,IAAKjG,KAAKkG,OA5BiB,4BA6B3BC,OAAQ,CAAEC,OAAQpG,KAAKoG,UAE3B,CAEAnD,OAAOK,EAAcgD,EAAuBC,GAC1C,OAAOvG,KAAKwG,KAAKC,KAAWzG,KAAKkG,OAAON,GAAmB,GAAI,CAC7DO,OAAQ,CACNC,OAAQpG,KAAKoG,OACb9C,UACoB,MAAhBgD,GAAwB,CAAEA,mBACZ,MAAdC,GAAsB,CAAEA,gBAGlC,CAEAG,eAAeT,EAAaU,GAC1B,MAAMC,EAAcC,mBAAmBF,GACvC,OAAwB3G,KAAKwG,KAAKC,KAAK,wCAAwCR,aAAeW,IAAe,GAC/G,CAEAE,mBAAmBC,GACjB,OAAO/G,KAAKwG,KAAKC,KAAWzG,KAAKkG,OAhDG,gCAgDsCa,EAAa,CACrFZ,OAAQ,CACNC,OAAQpG,KAAKoG,SAGnB,CAEAY,OAAOC,GACL,OAAOjH,KAAKwG,KAAKQ,OAAahH,KAAKkG,OAAON,GAAmB,CAC3DO,OAAQ,CAAEC,OAAQpG,KAAKoG,OAAQa,MAAOA,EAAMC,aAEhD,CAEMC,WAAWF,GAAa,IAAAG,EAAApH,KAAA,SAAAqH,KAAA,YAC5B,OAAOD,EAAKE,iBA7DgB,uBA6D0B,CACpDnB,OAAQ,CAAEC,OAAQgB,EAAKhB,OAAQa,MAAOA,EAAMC,aAC3C,EAHyB,EAI9B,CAAC7G,SAAAL,KAAA,4DA7DUuC,KAAejC,GAAfiC,EAAe,GA6DzB,GA7DyBlC,SAAAL,KAAA,WAAAuH,EAAAC,IAAA,OAAfjF,EAAekF,QAAflF,EAAemF,mBAAfnF,CAAgB","names":["i0","FieldHintComponent_Case_1_ng_container_1_Template","content_r2","FieldHintComponent_Case_2_ng_container_1_Template","FieldHintComponent","constructor","this","isError","input","isShort","toggleIsShort","static","__ngFactoryType__","_angular_core__WEBPACK_IMPORTED_MODULE_0__","VBU","selectors","inputs","ngContentSelectors","_c0","decls","vars","consts","template","rf","ctx","_r1","FieldHintComponent_Case_1_Template","FieldHintComponent_Case_2_Template","FieldHintComponent_ng_template_3_Template","_c1","tmp_2_0","MatFormFieldModule","i1","NgClass","NgTemplateOutlet","styles","app_r1","Id","Name","CreateInheritedAppComponent","dialog","snackBar","hostClass","appsListService","transient","AppsListService","loading","signal","inheritableApps","getInheritable","value","form","buildForm","closeDialog","close","create","disable","set","inheritId","controls","name","find","app","open","subscribe","error","enable","undefined","duration","next","UntypedFormGroup","UntypedFormControl","Validators","required","i2","_angular_core__WEBPACK_IMPORTED_MODULE_1__","hostVars","hostBindings","CreateInheritedAppComponent_For_17_Template","CreateInheritedAppComponent_Conditional_18_Template","length","touched","errors","valid","RouterOutlet","FormsModule","i3","ReactiveFormsModule","i4","MatSelectModule","i5","MatOptionModule","MatDialogActions","MatButtonModule","i6","MatIconModule","i7","encapsulation","webApiAppRootApp","HttpServiceBaseSignal","getAllLive","refresh","httpResource","url","apiUrl","params","zoneId","getPendingApps","inheritAppId","templateId","http","post","createTemplate","newName","encodedName","encodeURIComponent","installPendingApps","pendingApps","delete","appId","toString","flushCache","_this","_asyncToGenerator","getStatusPromise","_angular_core__WEBPACK_IMPORTED_MODULE_4__","jDH","factory","Éµfac"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/shared/components/field-hint/field-hint.component.html","./projects/eav-ui/src/app/shared/components/field-hint/field-hint.component.ts","./projects/eav-ui/src/app/apps-management/create-inherited-app/create-inherited-app.component.html","./projects/eav-ui/src/app/apps-management/create-inherited-app/create-inherited-app.component.ts","./projects/eav-ui/src/app/apps-management/services/apps-list.service.ts"],"sourcesContent":["<div class=\"hint-box\" (click)=\"toggleIsShort()\" [ngClass]=\"{ 'hint-box__short': isShort }\">\r\n  @switch (isError()) {\r\n    @case (false) {\r\n      <mat-hint>\r\n        <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n      </mat-hint>\r\n    }\r\n    @case (true) {\r\n      <mat-error>\r\n        <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n      </mat-error>\r\n    }\r\n  }\r\n</div>\r\n\r\n<ng-template #content>\r\n  <ng-content></ng-content>\r\n</ng-template>\r\n","import { NgClass, NgTemplateOutlet } from '@angular/common';\r\nimport { Component, input } from '@angular/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\n\r\n@Component({\r\n    selector: 'app-field-hint',\r\n    templateUrl: './field-hint.component.html',\r\n    styleUrls: ['./field-hint.component.scss'],\r\n    imports: [\r\n        MatFormFieldModule,\r\n        NgClass,\r\n        NgTemplateOutlet\r\n    ]\r\n})\r\nexport class FieldHintComponent {\r\n  isError = input<boolean>(false);\r\n  isShort = true;\r\n\r\n  constructor() { }\r\n\r\n  toggleIsShort() {\r\n    this.isShort = !this.isShort;\r\n  }\r\n}\r\n","<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">Create inherited App</div>\r\n    <button\r\n      mat-icon-button\r\n      tippy=\"Close dialog\"\r\n      [disabled]=\"loading()\"\r\n      (click)=\"closeDialog()\"\r\n    >\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n  <div class=\"eav-dialog-content\">\r\n    <router-outlet></router-outlet>\r\n    <p>\r\n      Create an App which inherits everything (data, views, queries) from a global App. Only Apps which were\r\n      specifically\r\n      marked for this will be listed here, and these apps must already have been loaded into Cache. If you don't see the\r\n      App you expect, make sure that has happened.\r\n    </p>\r\n    <form [formGroup]=\"form\">\r\n      <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n        <mat-label>Inherit App</mat-label>\r\n        <mat-select formControlName=\"inheritId\"\r\n          [placeholder]=\"inheritableApps() === undefined ? 'Loading...' : inheritableApps() === null || inheritableApps().length === 0 ? 'No inheritable apps found' : ''\">\r\n          @for (app of inheritableApps(); track app) {\r\n          <mat-option [value]=\"app.Id\">\r\n            {{ app.Name }}\r\n          </mat-option>\r\n          }\r\n        </mat-select>\r\n      </mat-form-field>\r\n      @if (form.controls.inheritId.touched && form.controls.inheritId.errors?.required) {\r\n      <app-field-hint [isError]=\"true\">\r\n        Required\r\n      </app-field-hint>\r\n      }\r\n    </form>\r\n  </div>\r\n  <mat-dialog-actions align=\"end\">\r\n    <button type=\"button\"\r\n      mat-raised-button\r\n      class=\"eav-action-button\"\r\n      [disabled]=\"loading() || !form.valid\" (click)=\"create()\"\r\n    >\r\n      Create\r\n    </button>\r\n  </mat-dialog-actions>\r\n</div>\r\n","import { Component, HostBinding, signal } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule, UntypedFormControl, UntypedFormGroup, Validators } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDialogActions, MatDialogRef } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { RouterOutlet } from '@angular/router';\r\nimport { transient } from '../../../../../core';\r\nimport { FieldHintComponent } from '../../shared/components/field-hint/field-hint.component';\r\nimport { AppsListService } from '../services/apps-list.service';\r\n\r\n@Component({\r\n  selector: 'app-create-inherited-app',\r\n  templateUrl: './create-inherited-app.component.html',\r\n  imports: [\r\n    RouterOutlet,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatDialogActions,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    FieldHintComponent\r\n  ]\r\n})\r\nexport class CreateInheritedAppComponent {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  form: UntypedFormGroup;\r\n\r\n  private appsListService = transient(AppsListService);\r\n\r\n  constructor(\r\n    private dialog: MatDialogRef<CreateInheritedAppComponent>,\r\n    private snackBar: MatSnackBar,\r\n  ) {\r\n    this.form = this.buildForm();\r\n  }\r\n\r\n  loading = signal<boolean>(false);\r\n  inheritableApps = this.appsListService.getInheritable().value;\r\n\r\n  closeDialog(): void {\r\n    this.dialog.close();\r\n  }\r\n\r\n  create(): void {\r\n    this.form.disable();\r\n    this.loading.set(true);\r\n    const inheritId = this.form.controls.inheritId.value;\r\n    // TODO:: remove after test\r\n    // const name = this.inheritableApps$.value.find(app => app.Id === inheritId).Name;\r\n    const name = this.inheritableApps().find(app => app.Id === inheritId).Name;\r\n    this.snackBar.open('Creating inherited app...');\r\n    this.appsListService.create(name, inheritId).subscribe({\r\n      error: () => {\r\n        this.form.enable();\r\n        this.loading.set(false);\r\n\r\n        this.snackBar.open('Failed to create inherited app. Please check console for more information', undefined, { duration: 3000 });\r\n      },\r\n      next: () => {\r\n        this.form.enable();\r\n        this.snackBar.open('Created inherited app', undefined, { duration: 2000 });\r\n        this.closeDialog();\r\n      },\r\n    });\r\n  }\r\n\r\n  private buildForm(): UntypedFormGroup {\r\n    const form = new UntypedFormGroup({\r\n      inheritId: new UntypedFormControl(null, [Validators.required]),\r\n    });\r\n    return form;\r\n  }\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { App, PendingApp } from '../models/app.model';\r\n\r\nconst webApiAppRootList = 'admin/app/list';\r\nconst webApiAppRootInheritableApps = 'admin/app/InheritableApps';\r\nconst webApiAppRootPendingApps = 'admin/app/GetPendingApps';\r\nconst webApiAppRootApp = 'admin/app/app';\r\nconst webApiAppRootInstallPendingApps = 'admin/app/InstallPendingApps';\r\nconst webApiAppRootFlushcache = 'admin/app/flushcache';\r\n\r\n@Injectable()\r\nexport class AppsListService extends HttpServiceBaseSignal {\r\n\r\n  // clean way to create a new resource every time if refresh change\r\n  getAllLive(refresh: Signal<unknown>) {\r\n    return httpResource<App[]>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiAppRootList),\r\n        params: { zoneId: this.zoneId }\r\n      });\r\n    });\r\n  }\r\n\r\n  getInheritable() {\r\n    return httpResource<App[]>(() => ({\r\n      url: this.apiUrl(webApiAppRootInheritableApps),\r\n      params: { zoneId: this.zoneId }\r\n    }));\r\n  }\r\n\r\n  getPendingApps() {\r\n    return httpResource<PendingApp[]>(() => ({\r\n      url: this.apiUrl(webApiAppRootPendingApps),\r\n      params: { zoneId: this.zoneId },\r\n    }));\r\n  }\r\n\r\n  create(name: string, inheritAppId?: number, templateId?: number) {\r\n    return this.http.post<null>(this.apiUrl(webApiAppRootApp), {}, {\r\n      params: {\r\n        zoneId: this.zoneId,\r\n        name,\r\n        ...(inheritAppId != null && { inheritAppId }),\r\n        ...(templateId != null && { templateId }),\r\n      },\r\n    });\r\n  }\r\n\r\n  createTemplate(url: string, newName: string) {\r\n    const encodedName = encodeURIComponent(newName);\r\n    return <Observable<any>>this.http.post(`sys/install/RemotePackage?packageUrl=${url}&newName=${encodedName}`, {});\r\n  }\r\n\r\n  installPendingApps(pendingApps: PendingApp[]) {\r\n    return this.http.post<null>(this.apiUrl(webApiAppRootInstallPendingApps), pendingApps, {\r\n      params: {\r\n        zoneId: this.zoneId,\r\n      },\r\n    });\r\n  }\r\n\r\n  delete(appId: number) {\r\n    return this.http.delete<null>(this.apiUrl(webApiAppRootApp), {\r\n      params: { zoneId: this.zoneId, appId: appId.toString() },\r\n    });\r\n  }\r\n\r\n  async flushCache(appId: number): Promise<number> {\r\n    return this.getStatusPromise(webApiAppRootFlushcache, {\r\n      params: { zoneId: this.zoneId, appId: appId.toString() },\r\n    });\r\n  }\r\n\r\n}\r\n"],"x_google_ignoreList":[]}