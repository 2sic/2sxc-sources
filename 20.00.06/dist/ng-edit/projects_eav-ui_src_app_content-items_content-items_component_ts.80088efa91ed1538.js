"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-items_content-items_component_ts"],{336:(R,T,i)=>{i.d(T,{F:()=>$});var r=i(46443),t=i(14600),u=i(36647),l=i(70271),v=i(78742),h=i(70693),g=i(34435),C=i(9234),P=i(24467),f=i(99293),E=i(44444);const I={getAll:!0,getAllLive:!0,getAllOnce:!0};let $=(()=>{class D extends P.B{constructor(){super(...arguments),this.log=(0,g.Tq)({ContentItemsService:D},I)}getAllPromise(_){return this.log.fnIf("getAll",{contentTypeStaticName:_}),this.fetchPromise(C.Gg,{params:{appId:this.appId,contentType:_}})}getAllOnce(_){return this.log.fnIf("getAllOnce",{contentTypeStaticName:_}),(0,r.fx)(()=>({url:this.apiUrl(C.Gg),params:{appId:this.appId,contentType:_}}))}getAllLive(_,M){return this.log.fnIf("getAllLive",{contentTypeStaticName:_,refresh:M}),(0,r.fx)(()=>(M(),{url:this.apiUrl(C.Gg),params:{appId:this.appId,contentType:_}}))}getColumnsPromise(_){return this.fetchPromise(v.z,{params:{appId:this.appId,staticName:_}})}importItem(_){return(0,t.H)((0,h.n)(_)).pipe((0,u.n)(M=>this.http.post(this.apiUrl(C.gb+"upload"),{AppId:this.appId,ContentBase64:M})),(0,l.T)(M=>({Success:M,Messages:[]})))}static#t=this.\u0275fac=(()=>{let _;return function(k){return(_||(_=f.xGo(D)))(k||D)}})();static#e=this.\u0275prov=E.jDH({token:D,factory:D.\u0275fac})}return D})()},5858:(R,T,i)=>{i.d(T,{O:()=>r});const r="DROPDOWN_INSERT_VALUE"},21183:(R,T,i)=>{i.d(T,{f:()=>r});class r{static cellLink(u,l,v){return`<a class="default-link fill-cell ${v}" href="${u}">${l}</a>`}}},39333:(R,T,i)=>{i.d(T,{c:()=>u});var r=i(34435),t=i(99293);let u=(()=>{class l{constructor(){this.log=(0,r.Tq)({ClickStopPropagationDirective:l}),this.log.a("constructor")}onClick(h){this.log.a("onClick",{event:h}),h.stopPropagation()}static#t=this.\u0275fac=function(g){return new(g||l)};static#e=this.\u0275dir=t.FsC({type:l,selectors:[["","appClickStopPropagation",""]],hostBindings:function(g,C){1&g&&t.bIt("click",function(f){return C.onClick(f)})}})}return l})()},43758:(R,T,i)=>{i.d(T,{F:()=>D});var r=i(87945),t=i(37580),u=i(31016),l=i(99293),v=i(44444),h=i(87698);const g=["*"],C=y=>({"hint-box__short":y});function P(y,_){1&y&&l.eu8(0)}function f(y,_){if(1&y&&(l.j41(0,"mat-hint"),l.DNE(1,P,1,0,"ng-container",2),l.k0s()),2&y){l.XpG();const M=l.sdS(4);l.R7$(),l.Y8G("ngTemplateOutlet",M)}}function E(y,_){1&y&&l.eu8(0)}function I(y,_){if(1&y&&(l.j41(0,"mat-error"),l.DNE(1,E,1,0,"ng-container",2),l.k0s()),2&y){l.XpG();const M=l.sdS(4);l.R7$(),l.Y8G("ngTemplateOutlet",M)}}function $(y,_){1&y&&l.SdG(0)}let D=(()=>{class y{constructor(){this.isError=(0,t.hFB)(!1),this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(k){return new(k||y)};static#e=this.\u0275cmp=l.VBU({type:y,selectors:[["app-field-hint"]],inputs:{isError:[1,"isError"]},ngContentSelectors:g,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(k,m){if(1&k){const x=l.RV6();l.NAR(),l.j41(0,"div",1),l.bIt("click",function(){return v.eBV(x),v.Njj(m.toggleIsShort())}),l.nVh(1,f,2,1,"mat-hint")(2,I,2,1,"mat-error"),l.k0s(),l.DNE(3,$,1,0,"ng-template",null,0,l.C5r)}if(2&k){let x;l.Y8G("ngClass",l.eq3(2,C,m.isShort)),l.R7$(),l.vxM(!1===(x=m.isError())?1:!0===x?2:-1)}},dependencies:[u.M,h.c,h.b,r.YU,r.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return y})()},77730:(R,T,i)=>{i.r(T),i.d(T,{ContentItemsComponent:()=>je});var r=i(44444),t=i(99293),u=i(37580),l=i(64173),v=i(84175),h=i(81863),g=i(93840),C=i(3347),P=i(29658),f=i(12938),E=i(17693),I=i(6663),$=i(56360),D=i(93454),y=i(21183),_=i(11828),M=i(68163),k=i(91960),m=i(34456),x=i(53804),L=i(31016),Y=i(59791),G=i(87698);const lt=["valueInput"];let w=(()=>{class a{constructor(){this.filter="",this.idFilterString="",this.idFilter=[]}agInit(e){this.filterParams=e}isFilterActive(){return""!==this.filter||this.idFilter.length>0}doesFilterPass(e){if(""!==this.filter){const o=this.filterParams.valueGetter({api:this.filterParams.api,colDef:this.filterParams.colDef,column:this.filterParams.column,columnApi:this.filterParams.columnApi,context:this.filterParams.context,data:e.node.data,getValue:s=>e.node.data[s],node:e.node});if(null==o||!o.some(s=>!!s&&s.includes(this.filter)))return!1}if(this.idFilter.length>0){const n=e.data[this.filterParams.colDef.headerName];if(null==n||!this.idFilter.some(o=>n.some(s=>s.Id===o)))return!1}return!0}getModel(){return this.isFilterActive()?{filterType:"entity",filter:this.filter,idFilter:this.idFilter}:void 0}setModel(e){this.filter=e?.filter??"",this.idFilter=e?.idFilter??[],this.idFilterString=e?.idFilter?.join(",")??""}afterGuiAttached(e){this.valueInputRef.nativeElement.focus()}updateIdFilter(){this.idFilter=this.idFilterString.split(",").map(e=>parseInt(e,10)).filter(e=>!isNaN(e))}filterChanged(){this.filterParams.filterChangedCallback()}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-entity-filter"]],viewQuery:function(n,o){if(1&n&&t.GBs(lt,5),2&n){let s;t.mGM(s=t.lsd())&&(o.valueInputRef=s.first)}},decls:9,vars:2,consts:[["valueInput",""],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text",3,"ngModelChange","ngModel"]],template:function(n,o){if(1&n){const s=t.RV6();t.j41(0,"mat-form-field",1)(1,"mat-label"),t.EFF(2,"Value"),t.k0s(),t.j41(3,"input",2,0),t.mxI("ngModelChange",function(c){return r.eBV(s),t.DH7(o.filter,c)||(o.filter=c),r.Njj(c)}),t.bIt("ngModelChange",function(){return r.eBV(s),r.Njj(o.filterChanged())}),t.k0s()(),t.j41(5,"mat-form-field",1)(6,"mat-label"),t.EFF(7,"IDs (comma separated)"),t.k0s(),t.j41(8,"input",2),t.mxI("ngModelChange",function(c){return r.eBV(s),t.DH7(o.idFilterString,c)||(o.idFilterString=c),r.Njj(c)}),t.bIt("ngModelChange",function(){return r.eBV(s),o.updateIdFilter(),r.Njj(o.filterChanged())}),t.k0s()()}2&n&&(t.R7$(3),t.R50("ngModel",o.filter),t.R7$(5),t.R50("ngModel",o.idFilterString))},dependencies:[m.YN,m.me,m.BC,m.vS,x.Wk,L.M,G.j,G.M,Y.fS,Y.fg],styles:["[_nghost-%COMP%]{display:block;padding:16px 12px 2px}.mat-mdc-form-field[_ngcontent-%COMP%]{display:block;width:175px}"]})}return a})();var rt=i(60251),dt=i(38172),ct=i(34575),V=i(34601),pt=i(95699),N=i(1726),B=i(43216),mt=i(34435),j=i(70334),ut=i(67037),ht=i(69914),gt=i(60852),ft=i(96817),_t=i(39431),Ct=i(67993),z=i(89061),S=i(31034),Z=i(29968);function yt(a,d){if(1&a){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){r.eBV(e);const o=t.XpG();return r.Njj(o.do("delete"))}),t.j41(1,"mat-icon"),t.EFF(2,"delete"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Delete"),t.k0s()()}if(2&a){const e=t.XpG();t.Y8G("disabled",e.item._EditInfo.DisableDelete)}}let vt=(()=>{class a{agInit(e){this.params=e,this.item=e.data}refresh(e){return!0}do(e){this.params.do(e,this.item)}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-data-bundle-actions"]],decls:13,vars:2,consts:[["menu","matMenu"],[1,"actions-component"],["matRipple","","tippy","Clone",1,"eav-grid-action-button","default-link","highlight",3,"href"],["matRipple","","tippy","Export",1,"eav-grid-action-button","highlight",3,"click"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["matMenuContent",""],["mat-menu-item","",3,"click","disabled"]],template:function(n,o){if(1&n){const s=t.RV6();t.j41(0,"div",1)(1,"a",2)(2,"mat-icon"),t.EFF(3,"file_copy"),t.k0s()(),t.j41(4,"div",3),t.bIt("click",function(){return r.eBV(s),r.Njj(o.do("export"))}),t.j41(5,"mat-icon"),t.EFF(6,"cloud_download"),t.k0s()(),t.j41(7,"div",4)(8,"mat-icon"),t.EFF(9,"more_horiz"),t.k0s()()(),t.j41(10,"mat-menu",5,0),t.DNE(12,yt,5,1,"ng-template",6),t.k0s()}if(2&n){const s=t.sdS(11);t.R7$(),t.Y8G("href",o.params.urlTo("clone",o.item),t.B4B),t.R7$(6),t.Y8G("matMenuTriggerFor",s)}},dependencies:[z.M,Z.M,g.m_,g.An,S.Cn,S.kk,S.fb,S.z8,S.Cp,V.e],encapsulation:2})}return a})();function Tt(a,d){if(1&a&&(t.j41(0,"span",1),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.R7$(),t.JRh(e.entities)}}let Ft=(()=>{class a{agInit(e){Array.isArray(e.value)&&(this.encodedValue=this.htmlEncode(e.value.join(", ")),e.colDef.allowMultiValue&&(this.entities=e.value.length))}refresh(e){return!0}htmlEncode(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-content-items-entity"]],decls:3,vars:3,consts:[[3,"tippy"],[1,"more-entities"]],template:function(n,o){1&n&&(t.j41(0,"div",0),t.nVh(1,Tt,2,1,"span",1),t.EFF(2),t.k0s()),2&n&&(t.Y8G("tippy",o.encodedValue),t.R7$(),t.vxM(o.entities?1:-1),t.R7$(),t.SpI(" ",o.encodedValue,"\n"))},dependencies:[V.e],styles:[".more-entities[_ngcontent-%COMP%]{padding:0 8px;border-radius:10px;border:1px solid rgba(29,39,61,.44);-webkit-user-select:none;user-select:none}"]})}return a})();var X=i(87945),J=i(16256);const Mt=a=>({"hide-until-row-hover":a});function bt(a,d){if(1&a&&(t.j41(0,"a",2)(1,"mat-icon",4),t.EFF(2),t.k0s()()),2&a){const e=t.XpG();t.Y8G("tippy",e.metadataTooltip)("href",e.params.urlTo("openMetadata",e.item),t.B4B)("ngClass",t.eq3(6,Mt,!e.metadataCount&&!e.value.metadata)),t.R7$(),t.Y8G("matBadge",e.metadataCount)("matBadgeHidden",!e.metadataCount),t.R7$(),t.SpI("",e.value.metadata?"loyalty":"local_offer"," ")}}function Et(a,d){if(1&a&&(t.j41(0,"div",3)(1,"mat-icon",5),t.EFF(2),t.k0s()()),2&a){const e=t.XpG();t.R7$(),t.Y8G("matBadge",e.metadataCount)("matBadgeHidden",!e.metadataCount),t.R7$(),t.SpI("",e.value.metadata?"loyalty":"local_offer"," ")}}let It=(()=>{class a{agInit(e){this.params=e,this.value=e.value,this.item=e.data,this.disableMetadata=this.item._EditInfo.DisableMetadata,this.metadataCount=this.item.Metadata?.length??0;const n=this.item.For;this.metadataTooltip=n?`This item is metadata for:\nTarget: ${n.Target}\nTargetType: ${n.TargetType}`+(n.KeyNumber?`\nNumber: ${n.KeyNumber}`:"")+(n.KeyString?`\nString: ${n.KeyString}`:"")+(n.KeyGuid?`\nGuid: ${n.KeyGuid}`:"")+(n.Title?`\nTitle: ${n.Title}`:""):"This item is not metadata.",this.metadataTooltip+=`\n\nThis item has ${this.metadataCount>0?this.metadataCount:"no"} other metadata ${1===this.metadataCount?"item":"items"} attached to it.`}refresh(e){return!0}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-content-items-status"]],decls:6,vars:3,consts:[[1,"actions-component"],[1,"eav-grid-action-button","icon",3,"tippy"],["matRipple","",1,"eav-grid-action-button","default-link","highlight",3,"tippy","href","ngClass"],[1,"eav-grid-action-button","disabled"],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"],["matBadgeColor","accent","matBadgeSize","small","matBadgeDisabled","true","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"mat-icon"),t.EFF(3),t.k0s()(),t.nVh(4,bt,3,8,"a",2)(5,Et,3,3,"div",3),t.k0s()),2&n&&(t.R7$(),t.Y8G("tippy",o.value.published?"Published":"Not published"),t.R7$(2),t.JRh(o.value.published?"visibility":"visibility_off"),t.R7$(),t.vxM(o.disableMetadata?o.disableMetadata&&(o.metadataCount||o.value.metadata)?5:-1:4))},dependencies:[g.m_,g.An,z.M,Z.M,X.YU,J.Y,J.k,V.e],styles:[".hide-until-row-hover[_ngcontent-%COMP%]{visibility:hidden}  .ag-row-hover .hide-until-row-hover{visibility:visible}"]})}return a})();var Dt=i(4038),xt=i(31403),Q=i(64043),q=i(8827),O=i(75797),W=i(63037),K=i(91817),Rt=i(63617),tt=i(70271),U=i(19999),Pt=i(75445),jt=i(32760),et=i(88857),Ot=i(43176),$t=i(43758),nt=i(5858),b=i(50052),Gt=i(39333),Vt=i(99277),Bt=i(48021),St=i(93826),At=i(68873),at=i(336),Yt=i(49417);function Nt(a){return d=>{if(!d.value)return null;const e=a.controls.keyType.value,n=d.value.toString();switch(e){case b.YX.keyTypes.number:return/^[0-9]+$/.test(n)?null:{patternWholeNumber:!0};case b.YX.keyTypes.guid:const s=["{","}"].some(F=>n.includes(F)),p=n.substring(s?1:0,s?n.length-1:n.length);return(0,Yt.L)().test(p)?null:{patternGuid:!0};default:return null}}}var Xt=i(23731),ot=i(88622);const it=a=>({active:a});function Kt(a,d){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e.targetType),t.R7$(),t.SpI(" ",e.label," ")}}function Ut(a,d){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=t.XpG(2);t.Y8G("value",e.formValues.targetType),t.R7$(),t.SpI(" ",e.formValues.targetType," ")}}function Lt(a,d){if(1&a&&(t.j41(0,"mat-select",9),t.Z7z(1,Kt,2,2,"mat-option",13,t.fX1),t.nVh(3,Ut,2,2,"mat-option",13),t.k0s()),2&a){const e=t.XpG(),n=t.XpG();t.R7$(),t.Dyx(n.targetTypeOptions),t.R7$(2),t.vxM(e.unknownTargetType?3:-1)}}function Wt(a,d){1&a&&t.nrm(0,"input",10)}function Ht(a,d){1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1," Warning: you entered an unknown target type. This may work or may not. Please be sure you know what you're doing "),t.k0s()),2&a&&t.Y8G("isError",!1)}function wt(a,d){if(1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.Y8G("isError",!1),t.R7$(),t.JRh(e.targetTypeHint)}}function zt(a,d){1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function Zt(a,d){1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1," Must be a whole number "),t.k0s()),2&a&&t.Y8G("isError",!0)}function Jt(a,d){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function Qt(a,d){1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function qt(a,d){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e.NameId),t.R7$(),t.SpI(" ",e.Label," ")}}function te(a,d){if(1&a&&(t.j41(0,"mat-form-field",8)(1,"mat-label"),t.EFF(2,"Content Type"),t.k0s(),t.j41(3,"mat-select",19),t.Z7z(4,qt,2,2,"mat-option",13,t.fX1),t.k0s()()),2&a){const e=t.XpG();t.R7$(3),t.Y8G("placeholder",e.contentTypes.length?"":"No items found"),t.R7$(),t.Dyx(e.contentTypes)}}function ee(a,d){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",e.name," ")}}function ne(a,d){if(1&a&&(t.j41(0,"mat-form-field",8)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",20),t.Z7z(4,ee,2,2,"mat-option",13,t.fX1),t.j41(6,"mat-option",13),t.EFF(7,"Other..."),t.k0s()()()),2&a){const e=t.XpG(),n=t.XpG();t.R7$(3),t.Y8G("placeholder",e.scopeOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.scopeOptions),t.R7$(2),t.Y8G("value",n.dropdownInsertValue)}}function ae(a,d){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e.Guid),t.R7$(),t.Lme(" ",e.Title," (",e.Id,") ")}}function oe(a,d){if(1&a&&(t.j41(0,"mat-select",21),t.Z7z(1,ae,2,3,"mat-option",13,t.fX1),t.k0s()),2&a){const e=t.XpG(3);t.Y8G("placeholder",e.contentItems.length?"":"No items found"),t.R7$(),t.Dyx(e.contentItems)}}function ie(a,d){1&a&&t.nrm(0,"input",22)}function se(a,d){if(1&a&&t.nVh(0,oe,3,1,"mat-select",21)(1,ie,1,0,"input",22),2&a){const e=t.XpG(2);t.vxM(e.guidedKey?0:1)}}function le(a,d){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e.NameId),t.R7$(),t.SpI(" ",e.Label," ")}}function re(a,d){if(1&a&&(t.j41(0,"mat-select",21),t.Z7z(1,le,2,2,"mat-option",13,t.fX1),t.k0s()),2&a){const e=t.XpG(3);t.Y8G("placeholder",e.contentTypes.length?"":"No items found"),t.R7$(),t.Dyx(e.contentTypes)}}function de(a,d){1&a&&t.nrm(0,"input",22)}function ce(a,d){if(1&a&&t.nVh(0,re,3,1,"mat-select",21)(1,de,1,0,"input",22),2&a){const e=t.XpG(2);t.vxM(e.guidedKey?0:1)}}function pe(a,d){1&a&&t.eu8(0)}function me(a,d){if(1&a&&t.DNE(0,pe,1,0,"ng-container",23),2&a){t.XpG(2);const e=t.sdS(44);t.Y8G("ngTemplateOutlet",e)}}function ue(a,d){if(1&a&&t.nVh(0,se,2,1)(1,ce,2,1)(2,me,1,1,"ng-container"),2&a){let e;const n=t.XpG(),o=t.XpG();t.vxM((e=n.formValues.targetType)===o.eavConstants.metadata.entity.targetType?0:e===o.eavConstants.metadata.contentType.targetType?1:2)}}function he(a,d){1&a&&t.nrm(0,"input",22)}function ge(a,d){1&a&&t.nrm(0,"input",24)}function fe(a,d){if(1&a&&(t.nVh(0,he,1,0,"input",22),t.nVh(1,ge,1,0,"input",24)),2&a){const e=t.XpG(),n=t.XpG();t.vxM(e.formValues.keyType!==n.eavConstants.keyTypes.number?0:-1),t.R7$(),t.vxM(e.formValues.keyType===n.eavConstants.keyTypes.number?1:-1)}}function _e(a,d){1&a&&t.nrm(0,"input",22)}function Ce(a,d){1&a&&t.nrm(0,"input",24)}function ye(a,d){if(1&a&&(t.nVh(0,_e,1,0,"input",22),t.nVh(1,Ce,1,0,"input",24)),2&a){const e=t.XpG(),n=t.XpG();t.vxM(e.formValues.keyType!==n.eavConstants.keyTypes.number?0:-1),t.R7$(),t.vxM(e.formValues.keyType===n.eavConstants.keyTypes.number?1:-1)}}function ve(a,d){if(1&a){const e=t.RV6();t.j41(0,"div",16)(1,"button",25),t.bIt("click",function(){r.eBV(e);const o=t.XpG(2);return r.Njj(o.toggleGuidedKey(!0))}),t.j41(2,"mat-icon",26),t.EFF(3,"search"),t.k0s()(),t.j41(4,"button",27),t.bIt("click",function(){r.eBV(e);const o=t.XpG(2);return r.Njj(o.toggleGuidedKey(!1))}),t.j41(5,"mat-icon",26),t.EFF(6,"text_fields"),t.k0s()()()}if(2&a){const e=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(2,it,e.guidedKey)),t.R7$(3),t.Y8G("ngClass",t.eq3(4,it,!e.guidedKey))}}function Te(a,d){1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function Fe(a,d){1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1," Must be a whole number "),t.k0s()),2&a&&t.Y8G("isError",!0)}function Me(a,d){1&a&&(t.j41(0,"app-field-hint",11),t.EFF(1," Must be a valid GUID "),t.k0s()),2&a&&t.Y8G("isError",!0)}function be(a,d){if(1&a){const e=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3),t.EFF(3," Create Metadata "),t.k0s(),t.j41(4,"button",4),t.bIt("click",function(){r.eBV(e);const o=t.XpG();return r.Njj(o.closeDialog())}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",5)(8,"p"),t.EFF(9," This is a special operation to add an item which is metadata for another item, see "),t.j41(10,"a",6),t.EFF(11,"docs"),t.k0s(),t.EFF(12,". "),t.k0s(),t.j41(13,"form",7)(14,"mat-form-field",8)(15,"mat-label"),t.EFF(16,"Target"),t.k0s(),t.nVh(17,Lt,4,1,"mat-select",9),t.nVh(18,Wt,1,0,"input",10),t.k0s(),t.nVh(19,Ht,2,1,"app-field-hint",11),t.nVh(20,wt,2,2,"app-field-hint",11),t.nVh(21,zt,2,1,"app-field-hint",11),t.nVh(22,Zt,2,1,"app-field-hint",11),t.j41(23,"mat-form-field",8)(24,"mat-label"),t.EFF(25,"Key type"),t.k0s(),t.j41(26,"mat-select",12),t.Z7z(27,Jt,2,2,"mat-option",13,t.fX1),t.k0s()(),t.nVh(29,Qt,2,1,"app-field-hint",11),t.j41(30,"mat-slide-toggle",14),t.bIt("change",function(o){r.eBV(e);const s=t.XpG();return r.Njj(s.toggleGuidedMode(o))}),t.EFF(31),t.k0s(),t.nVh(32,te,6,1,"mat-form-field",8),t.nVh(33,ne,8,2,"mat-form-field",8),t.j41(34,"app-field-hint"),t.EFF(35," The scope should almost never be changed - "),t.j41(36,"a",15),t.EFF(37,"see help"),t.k0s()(),t.j41(38,"mat-form-field",8)(39,"mat-label"),t.EFF(40,"Key"),t.k0s(),t.nVh(41,ue,3,1)(42,fe,2,2),t.DNE(43,ye,2,2,"ng-template",null,0,t.C5r),t.nVh(45,ve,7,6,"div",16),t.k0s(),t.nVh(46,Te,2,1,"app-field-hint",11),t.nVh(47,Fe,2,1,"app-field-hint",11),t.nVh(48,Me,2,1,"app-field-hint",11),t.k0s()(),t.j41(49,"mat-dialog-actions",17)(50,"app-save-close-button-fab",18),t.bIt("action",function(){r.eBV(e);const o=t.XpG();return r.Njj(o.saveAndClose())}),t.k0s()()()}if(2&a){const e=d,n=t.XpG();t.R7$(13),t.Y8G("formGroup",n.ngForm),t.R7$(4),t.vxM(e.guidedMode?17:-1),t.R7$(),t.vxM(e.guidedMode?-1:18),t.R7$(),t.vxM(n.ngForm.controls.targetType.touched&&!n.ngForm.controls.targetType.invalid&&e.unknownTargetType?19:-1),t.R7$(),t.vxM(e.targetTypeHint?20:-1),t.R7$(),t.vxM(n.ngForm.controls.targetType.touched&&null!=n.ngForm.controls.targetType.errors&&n.ngForm.controls.targetType.errors.required?21:-1),t.R7$(),t.vxM(n.ngForm.controls.targetType.touched&&null!=n.ngForm.controls.targetType.errors&&n.ngForm.controls.targetType.errors.pattern?22:-1),t.R7$(5),t.Dyx(e.keyTypeOptions),t.R7$(2),t.vxM(n.ngForm.controls.keyType.touched&&null!=n.ngForm.controls.keyType.errors&&n.ngForm.controls.keyType.errors.required?29:-1),t.R7$(),t.Y8G("tippy",e.guidedMode?"Guided mode helps you select options that work":"Manual mode is for advanced uses and allows you to insert any values")("checked",e.guidedMode),t.R7$(),t.SpI(" ",e.guidedMode?"Guided":"Manual"," "),t.R7$(),t.vxM(e.guidedMode&&e.formValues.targetType===n.eavConstants.metadata.entity.targetType?32:-1),t.R7$(),t.vxM(!e.guidedMode||e.formValues.targetType!==n.eavConstants.metadata.entity.targetType&&e.formValues.targetType!==n.eavConstants.metadata.contentType.targetType?-1:33),t.R7$(8),t.vxM(e.guidedMode?41:42),t.R7$(4),t.vxM(e.guidedMode&&e.guidedKeyExists?45:-1),t.R7$(),t.vxM(n.ngForm.controls.key.touched&&null!=n.ngForm.controls.key.errors&&n.ngForm.controls.key.errors.required?46:-1),t.R7$(),t.vxM(n.ngForm.controls.key.touched&&null!=n.ngForm.controls.key.errors&&n.ngForm.controls.key.errors.patternWholeNumber?47:-1),t.R7$(),t.vxM(n.ngForm.controls.key.touched&&null!=n.ngForm.controls.key.errors&&n.ngForm.controls.key.errors.patternGuid?48:-1),t.R7$(2),t.Y8G("ngClass",n.canSave()?"":"disabled")("disabled",!n.canSave())}}let Ee=(()=>{class a extends Ot.${constructor(e,n){super(),this.dialog=e,this.context=n,this.hostClass="dialog-component",this.eavConstants=b.YX,this.dropdownInsertValue=nt.O,this.formValid=(0,r.vPA)(!1),this.canSave=(0,l.EW)(()=>this.formValid()),this.contentItemsService=(0,f.d)(at.F),this.contentTypesService=(0,f.d)(Pt.gs)}ngOnInit(){this.#t(),this.targetTypeOptions=Object.values(b.YX.metadata).map(n=>({...n})),this.keyTypeOptions=Object.values(b.YX.keyTypes),this.keyTypeOptions$=new O.t([]),this.scopeOptions$=new O.t([]),this.guidedMode$=new O.t(!0),this.contentItems$=new O.t([]),this.contentTypes$=new O.t([]),this.guidedKey$=new O.t(!0),this.fetchScopes(),this.ngForm=new m.J3({}),this.ngForm.addControl("targetType",new m.hs(b.YX.metadata.entity.targetType,[m.k0.required,m.k0.pattern(/^[0-9]+$/)])),this.ngForm.addControl("keyType",new m.hs(b.YX.metadata.entity.keyType,[m.k0.required])),this.ngForm.addControl("contentTypeForContentItems",new m.hs(null)),this.ngForm.addControl("scopeForContentTypes",new m.hs(b.YX.scopes.default.value)),this.ngForm.addControl("key",new m.hs(null,[m.k0.required,Nt(this.ngForm)])),this.subscriptions.add(this.ngForm.controls.scopeForContentTypes.valueChanges.pipe((0,W.Z)(this.ngForm.controls.scopeForContentTypes.value),(0,K.F)()).subscribe(n=>{null!=this.ngForm.controls.contentTypeForContentItems.value&&this.ngForm.controls.contentTypeForContentItems.patchValue(null),n===nt.O?(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||b.YX.scopes.default.value,this.scopeOptions$.value.some(o=>o.value===n)||this.scopeOptions$.next([{name:n,value:n},...this.scopeOptions$.value]),this.ngForm.controls.scopeForContentTypes.patchValue(n)):this.fetchContentTypes(n)})),this.subscriptions.add((0,Rt.h)(this.ngForm.controls.targetType.valueChanges.pipe((0,K.F)()),this.ngForm.controls.keyType.valueChanges.pipe((0,K.F)())).subscribe(()=>{this.guidedKey$.next(!0),null!=this.ngForm.getRawValue().key&&this.ngForm.patchValue({key:null})})),this.subscriptions.add(this.ngForm.controls.contentTypeForContentItems.valueChanges.pipe((0,W.Z)(this.ngForm.controls.contentTypeForContentItems.value),(0,K.F)()).subscribe(n=>{const o=this.ngForm.getRawValue();o.targetType===b.YX.metadata.entity.targetType&&null!=o.key&&this.ngForm.patchValue({key:null}),this.contentItemsService.getAllPromise(n).then(s=>{this.contentItems$.next(s)})}));const e=this.ngForm.valueChanges.pipe((0,W.Z)(this.ngForm.getRawValue()),(0,tt.T)(()=>this.ngForm.getRawValue()),(0,Bt.A)(n=>n));this.subscriptions.add((0,U.z)([e,this.guidedMode$]).subscribe(([n,o])=>{const s=this.targetTypeOptions.find(st=>st.targetType===n.targetType),p=o&&s?[s.keyType]:[...this.keyTypeOptions];St.a.arraysEqual(p,this.keyTypeOptions$.value)||this.keyTypeOptions$.next(p);const c={};this.keyTypeOptions$.value.includes(n.keyType)||(c.keyType=this.keyTypeOptions$.value[0]);const F=o&&n.targetType===b.YX.metadata.app.targetType;F&&n.key!==this.context.appId&&(c.key=this.context.appId),Object.keys(c).length&&this.ngForm.patchValue(c),et.a.disable(this.ngForm.controls.keyType,o&&this.keyTypeOptions$.value.length<=1),et.a.disable(this.ngForm.controls.key,F)})),this.viewModel$=(0,U.z)([(0,U.z)([this.guidedMode$,this.keyTypeOptions$,this.scopeOptions$,this.contentItems$,this.contentTypes$]),(0,U.z)([e,this.guidedKey$])]).pipe((0,tt.T)(([[n,o,s,p,c],[F,A]])=>({guidedMode:n,unknownTargetType:!this.targetTypeOptions.some(H=>H.targetType===F.targetType),targetTypeHint:n&&this.targetTypeOptions.find(H=>H.targetType===F.targetType)?.hint,keyTypeOptions:o,scopeOptions:s,guidedKey:A,guidedKeyExists:[b.YX.metadata.entity.targetType,b.YX.metadata.contentType.targetType].includes(F.targetType),formValues:F,contentItems:p,contentTypes:c})))}ngAfterViewInit(){this.ngForm?.statusChanges.subscribe(()=>{this.formValid.set(this.ngForm?.valid??!1)})}ngOnDestroy(){this.guidedMode$.complete(),this.keyTypeOptions$.complete(),this.contentItems$.complete(),this.contentTypes$.complete(),this.guidedKey$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialog.close(e)}toggleGuidedKey(e){this.guidedKey$.next(e)}toggleGuidedMode(e){this.guidedMode$.next(e.checked)}saveAndClose(){const e=this.ngForm.getRawValue(),n={target:this.targetTypeOptions.find(o=>o.targetType===e.targetType)?.target,targetType:e.targetType,keyType:e.keyType,key:e.keyType===b.YX.keyTypes.guid?e.key.replace(/{|}/g,""):e.key.toString()};this.closeDialog(n)}#t(){this.dialog.keydownEvents().subscribe(e=>{(0,jt.YU)(e)&&this.canSave()&&(e.preventDefault(),this.saveAndClose())})}fetchContentTypes(e){this.contentTypesService.retrieveContentTypesPromise(e).then(n=>{this.contentTypes$.next(n)})}fetchScopes(){this.contentTypesService.getScopesPromise().then(e=>{this.scopeOptions$.next(e)})}static#e=this.\u0275fac=function(n){return new(n||a)(t.rXU(h.k),t.rXU(At.o))};static#s=this.\u0275cmp=t.VBU({type:a,selectors:[["app-create-metadata-dialog"]],hostVars:1,hostBindings:function(n,o){2&n&&t.Avn("className",o.hostClass)},features:[t.Vt3],decls:2,vars:3,consts:[["defaultKeyInput",""],[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",2,"width","100%","margin-bottom","8px"],["formControlName","targetType","required",""],["matInput","","type","number","min","0","formControlName","targetType","required",""],[3,"isError"],["formControlName","keyType","required",""],[3,"value"],["color","accent",3,"change","tippy","checked"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["matTextSuffix","",1,"eav-selection-suffix"],["align","end"],[3,"action","ngClass","disabled"],["formControlName","contentTypeForContentItems",3,"placeholder"],["formControlName","scopeForContentTypes",3,"placeholder"],["formControlName","key","required","",3,"placeholder"],["matInput","","type","text","formControlName","key","required",""],[4,"ngTemplateOutlet"],["matInput","","type","number","formControlName","key","required",""],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"click","ngClass"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"click","ngClass"]],template:function(n,o){if(1&n&&(t.nVh(0,be,51,20,"div",1),t.nI1(1,"async")),2&n){let s;t.vxM((s=t.bMT(1,1,o.viewModel$))?0:-1,s)}},dependencies:[m.YN,m.qT,m.me,m.Q0,m.BC,m.cb,m.YS,m.VZ,m.X1,m.j4,m.JD,L.M,G.j,G.M,G.g,Q.M,Q.g,Xt.M,xt.M,Y.fS,Y.fg,X.T3,v.Hl,ot.M,X.YU,g.m_,g.An,h.M,q.mV,q.sG,X.Jj,$t.F,Gt.c,V.e,Vt.i],styles:["mat-slide-toggle[_ngcontent-%COMP%]{margin:16px 0}"]})}return a})(),Ie=(()=>{class a{constructor(){this.published="",this.metadata="",this.hasMetadata=""}agInit(e){this.filterParams=e}isFilterActive(){return""!==this.published||""!==this.metadata||""!==this.hasMetadata}doesFilterPass(e){let n=!1,o=!1,s=!1;const c=this.filterParams.valueGetter({api:this.filterParams.api,colDef:this.filterParams.colDef,column:this.filterParams.column,columnApi:this.filterParams.columnApi,context:this.filterParams.context,data:e.node.data,getValue:F=>e.node.data[F],node:e.node});return n=""===this.published||null!=c.published&&c.published.toString()===this.published,o=""===this.metadata||null!=c.metadata&&c.metadata.toString()===this.metadata,s=""===this.hasMetadata||null!=c.hasMetadata&&c.hasMetadata.toString()===this.hasMetadata,n&&o&&s}getModel(){return this.isFilterActive()?{filterType:"pub-meta",published:this.published,metadata:this.metadata,hasMetadata:this.hasMetadata}:void 0}setModel(e){this.published=e?e.published:"",this.metadata=e?e.metadata:"",this.hasMetadata=e?e.hasMetadata:""}afterGuiAttached(e){}filterChanged(){this.filterParams.filterChangedCallback()}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-pub-meta-filter"]],decls:27,vars:3,consts:[[1,"title"],[3,"ngModelChange","ngModel"],["value",""],["value","true"],["value","false"]],template:function(n,o){1&n&&(t.j41(0,"div",0),t.EFF(1,"Published"),t.k0s(),t.j41(2,"mat-radio-group",1),t.mxI("ngModelChange",function(p){return t.DH7(o.published,p)||(o.published=p),p}),t.bIt("ngModelChange",function(){return o.filterChanged()}),t.j41(3,"mat-radio-button",2),t.EFF(4,"All"),t.k0s(),t.j41(5,"mat-radio-button",3),t.EFF(6,"Published"),t.k0s(),t.j41(7,"mat-radio-button",4),t.EFF(8,"Not published"),t.k0s()(),t.j41(9,"div",0),t.EFF(10,"Is Metadata"),t.k0s(),t.j41(11,"mat-radio-group",1),t.mxI("ngModelChange",function(p){return t.DH7(o.metadata,p)||(o.metadata=p),p}),t.bIt("ngModelChange",function(){return o.filterChanged()}),t.j41(12,"mat-radio-button",2),t.EFF(13,"All"),t.k0s(),t.j41(14,"mat-radio-button",3),t.EFF(15,"Is metadata"),t.k0s(),t.j41(16,"mat-radio-button",4),t.EFF(17,"Is not metadata"),t.k0s()(),t.j41(18,"div",0),t.EFF(19,"Has Metadata"),t.k0s(),t.j41(20,"mat-radio-group",1),t.mxI("ngModelChange",function(p){return t.DH7(o.hasMetadata,p)||(o.hasMetadata=p),p}),t.bIt("ngModelChange",function(){return o.filterChanged()}),t.j41(21,"mat-radio-button",2),t.EFF(22,"All"),t.k0s(),t.j41(23,"mat-radio-button",3),t.EFF(24,"Has metadata"),t.k0s(),t.j41(25,"mat-radio-button",4),t.EFF(26,"Has no metadata"),t.k0s()()),2&n&&(t.R7$(2),t.R50("ngModel",o.published),t.R7$(9),t.R50("ngModel",o.metadata),t.R7$(9),t.R50("ngModel",o.hasMetadata))},dependencies:[x.Wk,x.VT,x._g,m.YN,m.BC,m.vS],styles:[".title[_ngcontent-%COMP%]{padding:12px 12px 0}.mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;overflow:hidden;padding:12px;width:160px;height:104px}"]})}return a})();var De=i(29841);function ke(a,d){1&a&&(t.nrm(0,"div",6),t.nI1(1,"safeHtml")),2&a&&t.Y8G("innerHTML",t.bMT(1,1,d),t.npT)}function xe(a,d){if(1&a){const e=t.RV6();t.j41(0,"ag-grid-angular",17),t.bIt("gridReady",function(o){r.eBV(e);const s=t.XpG();return r.Njj(s.onGridReady(o))})("filesDropped",function(o){r.eBV(e);const s=t.XpG();return r.Njj(s.filesDropped(o))}),t.k0s()}if(2&a){const e=t.XpG();t.Y8G("rowData",e.items())("gridOptions",e.gridOptions)("allowedFileTypes","xml,json")}}function Re(a,d){if(1&a){const e=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){r.eBV(e);const o=t.XpG();return r.Njj(o.debugFilter())}),t.j41(1,"mat-icon",11),t.EFF(2,"filter_list"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Filter"),t.k0s()()}}const Pe={all:!1,items:!0};let je=(()=>{class a{#t;#e;#s;#c;#p;#m;#u;#l;#h;#a;constructor(){this.log=(0,mt.Tq)({ContentItemsComponent:a},Pe),this.isDebug=(0,r.WQX)(_t.B).isDebug,this.#t=(0,r.WQX)(C.UG),this.#e=(0,r.WQX)(h.h),this.#s=(0,r.WQX)(t.c1b),this.#c=(0,r.WQX)(u.gRc),this.#p=(0,r.WQX)(h.k),this.#m=(0,f.d)(ft.R),this.#u=(0,f.d)($.D),this.#l=(0,f.d)(at.F),this.#h=(0,f.d)(E.g),this.#a=(0,f.d)(gt.c),this.gridOptions={...rt.C,onFilterChanged:e=>this.#r.update(n=>n+1)},this.#r=(0,r.vPA)(0),this.refresh=(0,r.vPA)(0),this.#d={empty:{description:"<p><b>This is where you manage data items</b></p>",hint:"<p>Click the (+) in the bottom right corner to create your first item (think: record / entity).</p>"},content:{description:"<p><b>Each row shows a data item</b> <br>They contain the data, similar to a database row.</p>",hint:"<p>Click on the title to edit. <br>You can also do much more - best hover over the row and icons to discover the possibilities. <br><br>You can also do data import/export (one or many), copy items, and do advanced stuff like assigning metadata.</p>"}},this.uxHelpText=(0,l.EW)(()=>0===this.items()?.length?this.#d.empty:this.#d.content),this.#o=(0,r.vPA)(null),this.#n=this.#a.getParam("contentTypeStaticName"),this.contentType=this.#h.getType(this.#n).value,this.#g=this.#l.getAllLive(this.#n,this.refresh).value,this.items=(0,l.EW)(()=>{const e=this.#g();return this.log.aIf("items",{data:e}),e}),this.urlToExportContent=(0,Ct.bo)("urlToExportContent",()=>{const e=this.#o();if(!e)return"";this.#r();const n=Object.keys(e.getFilterModel()).length>0,o=[];return n&&e.forEachNodeAfterFilterAndSort(s=>o.push(s.data.Id)),this.#i(`export/${this.#n}${o.length>0?`/${o.join(",")}`:""}`)})}#r;#d;#o;#n;#g;ngOnInit(){this.urlToExportContent(),this.#a.doOnDialogClosed(()=>this.fetchItems())}closeDialog(){this.#p.close()}onGridReady(e){this.#o.set(e.api),this.fetchColumns(),this.urlToExportContent()}fetchItems(){this.refresh.update(e=>++e)}fetchColumns(){this.#l.getColumnsPromise(this.#n).then(e=>{const n=e.filter(p=>!p.IsEphemeral),o=this.#y(n),s=function kt(a,d){if(!a)return;let e;"="===a.charAt(a.length-1)&&(a=atob(a));try{e=JSON.parse(a)}catch{console.error("Can't parse JSON with filters from url:",a)}if(!e)return;const n={};return(e.IsPublished||e.IsMetadata)&&(n.Status={filterType:"pub-meta",published:e.IsPublished??"",metadata:e.IsMetadata??"",hasMetadata:""}),Object.entries(e).filter(([o,s])=>"IsPublished"!==o&&"IsMetadata"!==o).forEach(([o,s])=>{if(d.find(c=>c.headerName===o)?.filter!==w){if("string"==typeof s)n[o]={filterType:"text",type:"equals",filter:s};else if("number"==typeof s)n[o]={filterType:"number",type:"equals",filter:s,filterTo:null};else if("boolean"==typeof s){const c={filterType:"boolean",filter:s.toString()};n[o]=c}}else{const c={filterType:"entity",filter:"string"==typeof(s=Dt.i.tryParse(s)??s)?s:void 0,idFilter:"number"==typeof s?[s]:Array.isArray(s)?s.filter(F=>"number"==typeof F):void 0};n[o]=c}}),n}(sessionStorage.getItem(dt.bo),o);this.#o()&&this.setColumnDefs(o,s)})}setColumnDefs(e,n){this.#o().setColumnDefs(e),n&&(this.log.a("Will try to apply filter:",n),this.#o().setFilterModel(n))}#i(e){return"#"+this.#a.urlSubRoute(e)}#_(e){return this.#a.urlSubRoute(D.H.getUrlEntity(e.Guid,`Metadata for Entity: ${e._Title} (${e.Id})`,this.#n))}editItem(e){const n={items:[null==e?j.c.newFromType(this.#n):j.c.editId(e.Id)]},o=(0,B.s)(n);this.#a.navRelative([`edit/${o}`])}#C(e){return this.#i(`edit/${(0,B.s)({items:[null==e?j.c.newFromType(this.#n):j.c.editId(e.Id)]})}`)}urlToNewItem(e){return this.#i(`edit/${(0,B.s)({items:[null==e?j.c.newFromType(this.#n):j.c.editId(e.Id)]})}`)}filesDropped(e){const n=e[0];switch(n.name.substring(n.name.lastIndexOf(".")+1).toLocaleLowerCase()){case"xml":this.urlToImportContent(e);break;case"json":this.importItem(e)}}urlToImportContent(e){return this.#i(`${this.#n}${e?`/${e.map(n=>n.name).join(",")}`:""}/import`)}importItem(e){this.#a.navRelative(["import"],{state:{files:e}})}urlToImportItem(){return this.#i("import")}createMetadata(){this.#e.open(Ee,{autoFocus:!1,viewContainerRef:this.#s,width:"650px"}).afterClosed().subscribe(n=>{if(null==n)return;const o={items:[j.c.newMetadataFromInfo(this.#n,n)]},s=(0,B.s)(o);this.#a.navRelative([`edit/${s}`]),this.#c.markForCheck()})}debugFilter(){console.warn("Current filter:",this.#o().getFilterModel()),this.#t.open("Check console for filter information",void 0,{duration:3e3})}#y(e){const n=[{..._.r.IdWithDefaultRenderer,cellClass:o=>("id-action no-padding no-outline "+(o.data._EditInfo.ReadOnly?"disabled":"")).split(" "),cellRendererParams:_.r.idFieldParamsTooltipGetter()},{field:"Status",width:82,headerClass:"dense",cellClass:"secondary-action no-padding".split(" "),filter:Ie,valueGetter:o=>{const s=o.data;return{published:s.IsPublished,metadata:!!s.For,hasMetadata:!!s.Metadata&&s.Metadata.length>0}},cellRenderer:It,cellRendererParams:{urlTo:(o,s)=>"#"+this.#_(s)}},{..._.r.TextWidePrimary,headerName:"Item (Entity)",field:"_Title",flex:2,cellRenderer:o=>y.f.cellLink(this.#C(o.data),o.data._Title)},{headerName:"Stats",headerTooltip:"Used by others / uses others",field:"_Used",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:o=>`${o.data._Used} / ${o.data._Uses}`},{..._.r.ActionsPinnedRight3,cellRenderer:vt,cellRendererParams:{urlTo:(s,p)=>"#"+this.#v(p),do:(s,p)=>{switch(s){case"export":this.#T(p);break;case"delete":this.#F(p)}}}}];for(const o of e){const s={headerName:o.StaticName,field:o.StaticName,flex:2,minWidth:250,cellClass:"no-outline",sortable:!0};switch(o.Type){case N.O.Entity:s.allowMultiValue=o.Metadata?.Entity?.AllowMultiValue??!0,s.cellRenderer=Ft,s.valueGetter=this.valueGetterEntityField,s.filter=w;break;case N.O.DateTime:s.useTimePicker=o.Metadata?.DateTime?.UseTimePicker??!1,s.valueGetter=this.valueGetterDateTime,s.filter="agTextColumnFilter";break;case N.O.Boolean:s.valueGetter=this.valueGetterBoolean,s.filter=k.y;break;case N.O.Number:s.filter="agNumberColumnFilter";break;default:s.filter="agTextColumnFilter"}n.push(s)}return n}#v(e){return this.#a.urlSubRoute(`edit/${(0,B.s)({items:[j.c.copy(this.#n,e.Id)]})}`)}#T(e){this.#u.exportEntity(e.Id,this.#n,!0)}#F(e){this.#t.open("Deleting..."),this.#f(e,"Delete Item?",!1)}#f(e,n,o,s,p){this.#e.open(I.F,{autoFocus:!1,data:{entityId:e._RepositoryId,entityTitle:e._Title,message:n,title:s,confirmTranslateKey:p,hasDeleteSnackbar:!0},viewContainerRef:this.#s,width:"400px"}).afterClosed().subscribe(F=>{F&&this.#m.delete(this.#n,e._RepositoryId,o).subscribe({next:()=>{this.#t.open("Deleted",null,{duration:2e3}),this.fetchItems()},error:A=>{o||(this.#t.dismiss(),this.#f(e,`${A.error.ExceptionMessage} \n\nDo you want to force delete`,!0,"Force Delete","Force"))}})})}valueGetterEntityField(e){const n=e.data[e.colDef.field];return 0===n.length?null:n.map(o=>o.Title)}valueGetterDateTime(e){const n=e.data[e.colDef.field];return n?e.colDef.useTimePicker?n.replace("T"," ").replace("Z",""):n.split("T")[0]:null}valueGetterBoolean(e){const n=e.data[e.colDef.field];return"boolean"!=typeof n?null:n.toString()}static#M=this.\u0275fac=function(n){return new(n||a)};static#b=this.\u0275cmp=t.VBU({type:a,selectors:[["app-content-items"]],decls:38,vars:11,consts:[["appToggleDebug","",1,"eav-dialog","nav-component-wrapper"],[2,"height","100%",3,"helpText","refresh","rowLength"],["eav-dialog-header","",1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],["eav-dialog-content","",1,"eav-dialog-content"],[3,"innerHTML"],["appDragAndDrop","",1,"ag-theme-material","eav-dialog-content",3,"rowData","gridOptions","allowedFileTypes"],[1,"eav-dialog-actions"],[1,"eav-dialog-actions-div"],["mat-button","","tippy","Export xml list","tippyPlacement","top",1,"eav-button__with-icon",3,"href"],[1,"eav-icon"],["mat-button","","tippy","Import xml list","tippyPlacement","top",1,"eav-button__with-icon",3,"href"],["mat-button","","tippy","Import single json item","tippyPlacement","top",1,"eav-button__with-icon",3,"href"],["mat-button","","tippy","Create metadata","tippyPlacement","top",1,"eav-button__with-icon",3,"click"],["mat-button","","color","accent","tippy","Print filter to console","tippyPlacement","top",1,"eav-button__with-icon"],["mat-fab","","mat-elevation-z24","","tippy","Add item",1,"grid-fab",3,"href"],["appDragAndDrop","",1,"ag-theme-material","eav-dialog-content",3,"gridReady","filesDropped","rowData","gridOptions","allowedFileTypes"],["mat-button","","color","accent","tippy","Print filter to console","tippyPlacement","top",1,"eav-button__with-icon",3,"click"]],template:function(n,o){if(1&n&&(t.j41(0,"div",0)(1,"app-grid-with-help",1)(2,"div",2)(3,"div",3),t.EFF(4),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){return o.closeDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",5),t.nVh(9,ke,2,3,"div",6),t.k0s(),t.nVh(10,xe,1,3,"ag-grid-angular",7),t.j41(11,"mat-dialog-actions",8)(12,"div",9)(13,"a",10)(14,"mat-icon",11),t.EFF(15,"cloud_download"),t.k0s(),t.j41(16,"span"),t.EFF(17,"Data"),t.k0s()(),t.j41(18,"a",12)(19,"mat-icon",11),t.EFF(20,"cloud_upload"),t.k0s(),t.j41(21,"span"),t.EFF(22,"Data"),t.k0s()(),t.j41(23,"a",13)(24,"mat-icon",11),t.EFF(25,"cloud_upload"),t.k0s(),t.j41(26,"span"),t.EFF(27,"Item"),t.k0s()(),t.j41(28,"button",14),t.bIt("click",function(){return o.createMetadata()}),t.j41(29,"mat-icon",11),t.EFF(30,"local_offer"),t.k0s(),t.j41(31,"span"),t.EFF(32,"Create Metadata"),t.k0s()(),t.nVh(33,Re,5,0,"button",15),t.k0s(),t.j41(34,"a",16)(35,"mat-icon"),t.EFF(36,"add"),t.k0s()()()()(),t.nrm(37,"router-outlet")),2&n){let s,p,c,F;t.R7$(),t.Y8G("helpText",o.uxHelpText())("refresh",o.refresh())("rowLength",null==(s=o.items())?null:s.length),t.R7$(3),t.SpI("",(null==(p=o.contentType())?null:p.Label)||(null==(p=o.contentType())?null:p.Name)," Data"),t.R7$(5),t.vxM((c=null==(c=o.contentType())||null==c.Properties?null:c.Properties.ListInstructions)?9:-1,c),t.R7$(),t.vxM((null==(F=o.items())?null:F.length)>0?10:-1),t.R7$(3),t.Y8G("href",o.urlToExportContent(),t.B4B),t.R7$(5),t.Y8G("href",o.urlToImportContent(),t.B4B),t.R7$(5),t.Y8G("href",o.urlToImportItem(),t.B4B),t.R7$(10),t.vxM(o.isDebug()?33:-1),t.R7$(),t.Y8G("href",o.urlToNewItem(),t.B4B)}},dependencies:[v.Hl,v.$z,ot.M,v.Sr,g.m_,g.An,P.n3,h.M,ht.$,ct.S,pt.V,ut.p,De.xs,V.e,M.v],styles:["[_nghost-%COMP%]     .ag-row-hover .ag-cell a, [_nghost-%COMP%]     .ag-row-hover .ag-cell .id-box *, [_nghost-%COMP%]     .ag-row-hover .ag-cell .eav-grid-action-button, .eav-button__with-icon[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:#85283b!important}"]})}return a})()},93826:(R,T,i)=>{i.d(T,{a:()=>r});class r{static boolEquals(u,l){return u===l}static stringEquals(u,l){return u===l}static valueEquals(u,l){return u===l}static objectsEqual(u,l){if(null==u||null==l)return u===l;const v=u,h=l,g=Object.keys(v),C=Object.keys(h);return g.length===C.length&&g.every(f=>!!h.hasOwnProperty(f)&&v[f]===h[f])}static arraysEqual(u,l){return null==u||null==l?u===l:u.length===l.length&&u.every((h,g)=>u[g]===l[g])}static distinct(u,l,v){return v.indexOf(u)===l}}},95699:(R,T,i)=>{i.d(T,{V:()=>u});var r=i(99293),t=i(39431);let u=(()=>{class l{constructor(h){this.globalConfigService=h}onClick(h){(navigator.platform.match("Mac")?h.metaKey:h.ctrlKey)&&h.shiftKey&&h.altKey&&(this.globalConfigService.toggleDebugEnabled(),window.getSelection().removeAllRanges())}static#t=this.\u0275fac=function(g){return new(g||l)(r.rXU(t.B))};static#e=this.\u0275dir=r.FsC({type:l,selectors:[["","appToggleDebug",""]],hostBindings:function(g,C){1&g&&r.bIt("click",function(f){return C.onClick(f)})}})}return l})()},96817:(R,T,i)=>{i.d(T,{R:()=>g});var r=i(47215),t=i(85837),u=i(9234),l=i(24467),v=i(99293),h=i(44444);let g=(()=>{class C extends l.B{create(f,E){return this.http.post(`app/auto/data/${f}`,E,{params:{appId:this.appId,zoneId:this.zoneId}})}update(f,E,I){return this.http.post(`app/auto/data/${f}/${E}`,I,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(f,E,I){return this.http.delete(this.apiUrl(u.gb+"delete"),{params:{contentType:f,id:E.toString(),appId:this.appId,force:I.toString()},context:(new r._y).set(t.g,[400])})}static#t=this.\u0275fac=(()=>{let f;return function(I){return(f||(f=v.xGo(C)))(I||C)}})();static#e=this.\u0275prov=h.jDH({token:C,factory:C.\u0275fac})}return C})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.06/dist/ng-edit/projects_eav-ui_src_app_content-items_content-items_component_ts.80088efa91ed1538.js.map