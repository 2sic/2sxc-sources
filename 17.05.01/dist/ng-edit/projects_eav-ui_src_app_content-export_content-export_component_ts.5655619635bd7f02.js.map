{"version":3,"file":"projects_eav-ui_src_app_content-export_content-export_component_ts.5655619635bd7f02.js","mappings":"sRAiBO,IAAMA,EAAuB,MAA9B,MAAOA,UAA+BC,IAC1CC,YACUC,EACAC,EAEAC,EACRC,GAEAC,MAAM,IAAIC,IAAU,0BAdR,IAQJC,KAAAN,OACAM,KAAAL,UAEAK,KAAAJ,sBAaFI,KAAAC,gBAA8D,GATpED,KAAKE,IAAIC,IAAI,kBAAmBH,KAAKL,QAAQO,IAAIE,OACjDP,EAAgBQ,gBAAgBL,KAClC,CAEAM,cACER,MAAMS,SAER,CAIAC,cACE,MAAMC,EAAQT,KAAKL,QAAQc,MAC3B,OAAAT,KAAKE,IAAIC,IAAI,cAAe,QAASM,GAC9BT,KAAKU,WAAWD,EACzB,CAGEE,qBACE,OAAOX,KAAKQ,cAAcI,QAAKC,KAAIC,GAAMA,GAAIC,QAAQC,KAAKC,YAC5D,CAEAC,uBACE,OAAOlB,KAAKQ,cAAcI,QAAKC,KAAIC,GAAMA,GAAIC,QAAQI,OAAOF,YAC9D,CAGFP,WAAWD,GACT,OAAAT,KAAKE,IAAIC,IAAI,aAAc,QAASM,GAEpCT,KAAKC,gBAAgBQ,KAAWT,KAAKoB,kBAAkBX,EAAO,cAAcG,QAAKS,KAAY,CAAEC,UAAU,KAClGtB,KAAKC,gBAAgBQ,EAC9B,CAEAW,kBAAkBX,EAAgBc,GAChC,OAAAvB,KAAKE,IAAIC,IAAI,oBAAqB,QAASM,EAAO,QAASc,GACpDvB,KAAKN,KAAK8B,IAjDE,wBAiDkC,CACnDC,OAAQ,CAAEhB,MAAOA,GAAST,KAAKL,QAAQc,MAAMiB,cAC5Cd,QACDC,KAAIc,IACFA,EAAYZ,QAAQa,SAASC,KAAOF,EAAYZ,QAAQa,SAASC,KAAKC,OAAOC,GAAYA,EAASC,WAC3FL,KACR,EACDM,KAAIN,IACF3B,KAAKJ,oBAAoBsC,WAAWP,EAAYZ,QAAQoB,OAAOC,UAAS,GAG9E,CAACC,SAAArC,KAAA,mBAAAsC,iBAxDU/C,GAAsBgD,MAAAC,MAAAD,MAAAE,KAAAF,MAAAG,MAAAH,MAAAI,KAAA,EAAAN,SAAArC,KAAA,WAAA4C,EAAAC,IAAA,OAAtBtD,EAAsBuD,QAAtBvD,EAAsBwD,mBAAtBxD,CAAuB,iPCElBgD,MAAA,mBAAkCA,MAAA,GAAiBA,kCAAvCA,MAAA,QAAAS,EAAAC,QAAsBV,MAAA,GAAAA,MAAAS,EAAAC,kCAYpCV,MAAA,yBACEA,MAAA,GACFA,+BADEA,MAAA,GAAAA,MAAA,oBAAAW,EAAAC,QAAAC,OAAA,oDA3Bdb,MAAA,gBAAAA,CAAuB,UAAvBA,CAAuB,OAGjBA,MAAA,0LAEAA,MAAA,SAAgDA,MAAA,2BAAqBA,QAAKA,MAAA,8BAC5EA,QACAA,MAAA,UAAAA,CAAuD,QAAvDA,CAAuD,sBAAvDA,CAAuD,gBAGtCA,MAAA,gBAASA,QACpBA,MAAA,mBAAYA,MAAA,yBAAAc,GAAAd,MAAAe,GAAA,MAAAC,EAAAhB,QAAA,OAAaA,MAAAgB,EAAAC,WAAAzB,SAAAsB,EAA2B,GAClDd,MAAA,mBAAqBA,MAAA,UAAGA,QACxBA,MAAA,GAAAkB,EAAA,oBAAAlB,OAGFA,YAGJA,MAAA,SAAAA,CAAK,WAC8BA,MAAA,kBAAWA,QAC5CA,MAAA,yBAAiBA,MAAA,yBAAAc,GAAAd,MAAAe,GAAA,MAAAI,EAAAnB,QAAA,OAAaA,MAAAmB,EAAAF,WAAAG,aAAAN,EAA+B,GAC3Dd,MAAA,0BAAgCA,MAAA,+DAChCA,QACAA,MAAA,0BAA8BA,MAAA,oCAA6BA,QAC3DA,MAAA,GAAAqB,EAAA,2BAKFrB,UAEFA,MAAA,SAAAA,CAAK,WAC8BA,MAAA,0CAAmCA,QACpEA,MAAA,yBAAiBA,MAAA,yBAAAc,GAAAd,MAAAe,GAAA,MAAAO,EAAAtB,QAAA,OAAaA,MAAAsB,EAAAL,WAAAM,mBAAAT,EAAqC,GAEjEd,MAAA,0BAA+BA,MAAA,0DAC/BA,QACAA,MAAA,0BAAkCA,MAAA,qCAA8BA,YAGpEA,MAAA,SAAAA,CAAK,WAC8BA,MAAA,6BAAsBA,QACvDA,MAAA,yBAAiBA,MAAA,yBAAAc,GAAAd,MAAAe,GAAA,MAAAS,EAAAxB,QAAA,OAAaA,MAAAwB,EAAAP,WAAAQ,oBAAAX,EAAsC,GAElEd,MAAA,0BAA+BA,MAAA,8DAC/BA,QACAA,MAAA,0BAAkCA,MAAA,qEAElCA,gBAKRA,MAAA,2BAAAA,CAAgC,gBACJA,MAAA,mBAAAA,MAAAe,GAAA,MAAAW,EAAA1B,QAAA,OAASA,MAAA0B,EAAAC,cAAa,GAAE3B,MAAA,aAAMA,QACxDA,MAAA,gBAAyEA,MAAA,mBAAAA,MAAAe,GAAA,MAAAa,EAAA5B,QAAA,OAASA,MAAA4B,EAAAC,gBAAe,GAC/F7B,MAAA,oBACFA,+CA/CkBA,MAAA,IAAAA,MAAA,UAAA8B,EAAAb,WAAAzB,UAEVQ,MAAA,GAAAA,MAAA8B,EAAAC,WAQa/B,MAAA,GAAAA,MAAA,UAAA8B,EAAAb,WAAAG,cAIfpB,MAAA,GAAAA,MAAA,GAAA8B,EAAAE,UAAA,OASehC,MAAA,GAAAA,MAAA,UAAA8B,EAAAb,WAAAM,mBAAAvB,CAA2C,qBAAA8B,EAAAb,WAAAG,cAS3CpB,MAAA,GAAAA,MAAA,UAAA8B,EAAAb,WAAAQ,oBAAAzB,CAA4C,qBAAA8B,EAAAb,WAAAG,cAaxBpB,MAAA,GAAAA,MAAA,YAAAiC,EAAAC,KAAAC,QCtB1C,IAAMC,EAAsB,MAA7B,MAAOA,EAYXlF,YACUmF,EACAC,EACAC,EACAC,EACAC,GAJAhF,KAAA4E,YACA5E,KAAA6E,QACA7E,KAAA8E,uBACA9E,KAAA+E,yBACA/E,KAAAgF,sBAhBgBhF,KAAAiF,UAAY,mBAKtCjF,KAAAuE,WAAY,EACZvE,KAAAkF,SAAW,IAAIC,KAAgB,GAC/BnF,KAAAoF,aAAe,IAAID,IAA6B,MAExCnF,KAAAqF,sBAAwBrF,KAAK6E,MAAMS,SAASC,SAAS/D,IAAI,yBAS/D,MAAMgE,EAAcxF,KAAK6E,MAAMS,SAASC,SAAS/D,IAAI,eACrDxB,KAAKuE,YAAciB,EACfxF,KAAKuE,YACPvE,KAAKmD,QAAUqC,EAAYC,MAAM,KAAK5E,IAAI6E,GAAMC,SAASD,EAAI,KAEjE,CAEAE,WACE5F,KAAKkF,SAASW,MAAK,GACnB,MAAMT,EAAepF,KAAKgF,oBAAoBc,oBAAoB9F,KAAKqF,uBACjEpF,EAAkBD,KAAK+E,uBAAuBvE,eACpDuF,OAAS,CAACX,EAAcnF,IAAkB+F,UAAU,EAAEC,EAAaC,MACjElG,KAAKoF,aAAaS,KAAKI,GACvBjG,KAAKsE,UAAY4B,EAAenF,QAAQa,SAASC,KAEjD7B,KAAKwD,WAAa,CAChB2C,gBAAiBD,EAAenF,QAAQa,SAASwE,QACjDf,sBAAuBrF,KAAKqF,sBAC5BtD,SAAU,GACV4B,aAAc3D,KAAKuE,UAAY,YAAc,MAC7CT,mBAAoB,OACpBE,oBAAqB,QAEvBhE,KAAKkF,SAASW,MAAK,EAAK,EAE5B,CAEAvF,cACEN,KAAKoF,aAAaiB,WAClBrG,KAAKkF,SAASmB,UAChB,CAEAnC,cACElE,KAAK4E,UAAU0B,OACjB,CAEAlC,gBACEpE,KAAK8E,qBAAqBV,cAAcpE,KAAKwD,WAC3CxD,KAAKuE,WAA8C,cAAjCvE,KAAKwD,WAAWG,aAA+B3D,KAAKmD,QAAU,KACpF,CAACd,SAAArC,KAAA,mBAAAsC,iBA1DUqC,GAAsBpC,MAAAC,MAAAD,MAAAE,MAAAF,MAAAG,KAAAH,MAAAI,KAAAJ,MAAAgE,KAAA,EAAAlE,SAAArC,KAAA,UAAAwG,EAAAC,IAAA,MAAtB9B,EAAsB+B,UAAA,yBAAAC,SAAA,EAAAC,aAAA,SAAAC,EAAAC,GAAA,EAAAD,iEANpB,CACPE,IACAC,IACAzH,MACHgD,OAAA0E,MAAA,EAAAC,KAAA,EAAAC,OAAA,+yBAAAC,SAAA,SAAAP,EAAAC,MAAA,EAAAD,IDrCLtE,MAAA,UAAAA,CAAwB,UAAxBA,CAAwB,WAEkBA,MAAA,oBAAyCA,UAEjFA,MAAA,EAAA8E,EAAA,8BA+DF9E,oBAjE0CA,MAAA,GAAAA,MAAA,iBAAA+E,EAAA/E,MAAA,IAAAuE,EAAA1B,eAAA,KAAAkC,EAAAC,KAAA,IAExChF,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAAuE,EAAA5B,UAAA,sBCoBMsC,IAAWC,wBACXC,KAAkBC,UAClBC,KAAeC,KAAAC,KACfC,KACAC,KAAcC,UACdC,KACAC,KAAeC,KACfC,KAASC,OAAA,2KAQJ3D,CAAsB","names":["AppDialogConfigService","ServiceBase","constructor","http","context","globalConfigService","featuresService","super","EavLogger","this","dialogSettings$","log","add","svcId","loadFromService","ngOnDestroy","destroy","getCurrent$","appId","getShared$","getSitePrimaryApp$","pipe","map","dc","Context","Site","PrimaryApp","getGlobalPrimaryApp$","System","getDialogSettings","shareReplay","refCount","reqBy","get","params","toString","dlgSettings","Language","List","filter","language","IsEnabled","tap","allowDebug","Enable","DebugMode","static","t","i0","i1","i2","i3","i4","_angular_core__WEBPACK_IMPORTED_MODULE_8__","wxM","factory","Éµfac","lang_r4","NameId","ctx_r3","itemIds","length","$event","_r10","ctx_r9","formValues","ContentExportComponent_Conditional_5_For_17_Template","ctx_r11","recordExport","ContentExportComponent_Conditional_5_Conditional_26_Template","ctx_r12","languageReferences","ctx_r13","resourcesReferences","ctx_r14","closeDialog","ctx_r15","exportContent","ctx_r0","languages","hasIdList","_r1","form","valid","ContentExportComponent","dialogRef","route","contentExportService","appDialogConfigService","contentTypesService","hostClass","loading$","BehaviorSubject","contentType$","contentTypeStaticName","snapshot","paramMap","selectedIds","split","id","parseInt","ngOnInit","next","retrieveContentType","forkJoin","subscribe","contentType","dialogSettings","defaultLanguage","Primary","complete","close","i5","_angular_core__WEBPACK_IMPORTED_MODULE_3__","In1","selectors","hostVars","hostBindings","rf","ctx","ContentExportService","ContentTypesService","decls","vars","consts","template","ContentExportComponent_Conditional_5_Template","tmp_0_0","Name","FormsModule","i6","MatFormFieldModule","i7","MatSelectModule","i8","i9","MatOptionModule","MatRadioModule","i10","MatDialogActions","MatButtonModule","i11","AsyncPipe","styles"],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/services/app-dialog-config.service.ts","./projects/eav-ui/src/app/content-export/content-export.component.html","./projects/eav-ui/src/app/content-export/content-export.component.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable, OnDestroy } from '@angular/core';\r\nimport { map, Observable, shareReplay, tap } from 'rxjs';\r\nimport { GlobalConfigService } from '../../edit/shared/store/ngrx-data';\r\nimport { DialogSettings } from '../../shared/models/dialog-settings.model';\r\nimport { Context } from '../../shared/services/context';\r\nimport { FeaturesService } from '../../shared/services/features.service';\r\nimport { ServiceBase } from '../../shared/services/service-base';\r\nimport { EavLogger } from '../../shared/logging/eav-logger';\r\nimport { DialogContextSiteApp } from '../../shared/models/dialog-context.models';\r\n\r\nconst logThis = false;\r\n\r\nconst webApiSettings = 'admin/dialog/settings';\r\n\r\n\r\n@Injectable()\r\nexport class AppDialogConfigService extends ServiceBase implements OnDestroy {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private context: Context,\r\n    // private dnnContext: DnnContext,\r\n    private globalConfigService: GlobalConfigService,\r\n    featuresService: FeaturesService,\r\n  ) {\r\n    super(new EavLogger('AppDialogConfigService', logThis));\r\n    this.log.add('using context #', this.context.log.svcId);\r\n    featuresService.loadFromService(this);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    super.destroy();\r\n    // TODO: probably should add an onDestroy and ensure all subscriptions in dialogSettings$ are killed\r\n  }\r\n\r\n  private dialogSettings$: Record<number, Observable<DialogSettings>> = {};\r\n\r\n  getCurrent$(): Observable<DialogSettings> {\r\n    const appId = this.context.appId;\r\n    this.log.add('getCurrent$', 'appId', appId);\r\n    return this.getShared$(appId);\r\n  }\r\n\r\n    // new 2dg\r\n    getSitePrimaryApp$(): Observable<DialogContextSiteApp> {\r\n      return this.getCurrent$().pipe(map(dc => dc?.Context.Site.PrimaryApp));\r\n    }\r\n  \r\n    getGlobalPrimaryApp$(): Observable<DialogContextSiteApp> {\r\n      return this.getCurrent$().pipe(map(dc => dc?.Context.System.PrimaryApp));\r\n    }\r\n  \r\n\r\n  getShared$(appId: number): Observable<DialogSettings> {\r\n    this.log.add('getShared$', 'appId', appId);\r\n    // if (!this.dialogSettings$[appIdToUse])\r\n    this.dialogSettings$[appId] ??= this.getDialogSettings(appId, 'getShared$').pipe(shareReplay({ refCount: false }));\r\n    return this.dialogSettings$[appId];\r\n  }\r\n\r\n  getDialogSettings(appId?: number, reqBy?: string): Observable<DialogSettings> {\r\n    this.log.add('getDialogSettings', 'appId', appId, 'reqBy', reqBy);\r\n    return this.http.get<DialogSettings>(webApiSettings, {\r\n      params: { appId: appId ?? this.context.appId.toString() },\r\n    }).pipe(\r\n      map(dlgSettings => {\r\n        dlgSettings.Context.Language.List = dlgSettings.Context.Language.List.filter(language => language.IsEnabled);\r\n        return dlgSettings;\r\n      }),\r\n      tap(dlgSettings => {\r\n        this.globalConfigService.allowDebug(dlgSettings.Context.Enable.DebugMode);\r\n      }),\r\n    );\r\n  }\r\n}\r\n","<div class=\"eav-dialog\">\r\n  <div class=\"eav-dialog-header\">\r\n    <div class=\"eav-dialog-header__title\">Export {{ (contentType$ | async)?.Name }}</div>\r\n  </div>\r\n  @if ((loading$ | async) === false) {\r\n    <form #ngForm=\"ngForm\">\r\n      <div class=\"eav-dialog-content\">\r\n        <p>\r\n          This will generate an XML file which you can edit in Excel. If you just want to import new data, use this to\r\n          export the schema that you can then fill in using Excel. Please visit\r\n          <a href=\"https://2sxc.org/help\" target=\"_blank\">https://2sxc.org/help</a> for more instructions.\r\n        </p>\r\n        <div class=\"dialog-form-content fancy-scrollbar-light\">\r\n          <div>\r\n            <mat-form-field color=\"accent\" style=\"width: 100%;\">\r\n              <mat-label>Languages</mat-label>\r\n              <mat-select [(ngModel)]=\"formValues.language\" name=\"Language\">\r\n                <mat-option value=\"\">All</mat-option>\r\n                @for (lang of languages; track lang) {\r\n                  <mat-option [value]=\"lang.NameId\">{{ lang.NameId }}</mat-option>\r\n                }\r\n              </mat-select>\r\n            </mat-form-field>\r\n          </div>\r\n          <div>\r\n            <p class=\"eav-radio-group-label\">Export data</p>\r\n            <mat-radio-group [(ngModel)]=\"formValues.recordExport\" name=\"RecordExport\" class=\"eav-radio-group\">\r\n              <mat-radio-button value=\"Blank\">No, just export blank data schema (for new data import)\r\n              </mat-radio-button>\r\n              <mat-radio-button value=\"All\">Yes, export all content-items</mat-radio-button>\r\n              @if (hasIdList) {\r\n                <mat-radio-button value=\"Selection\">\r\n                  Export selected {{ itemIds.length }} items\r\n                </mat-radio-button>\r\n              }\r\n            </mat-radio-group>\r\n          </div>\r\n          <div>\r\n            <p class=\"eav-radio-group-label\">Value references to other languages</p>\r\n            <mat-radio-group [(ngModel)]=\"formValues.languageReferences\" name=\"LanguageReferences\"\r\n              [disabled]=\"formValues.recordExport === 'Blank'\" class=\"eav-radio-group\">\r\n              <mat-radio-button value=\"Link\">Keep references to other languages (for re-import)\r\n              </mat-radio-button>\r\n              <mat-radio-button value=\"Resolve\">Replace references with values</mat-radio-button>\r\n            </mat-radio-group>\r\n          </div>\r\n          <div>\r\n            <p class=\"eav-radio-group-label\">File / page references</p>\r\n            <mat-radio-group [(ngModel)]=\"formValues.resourcesReferences\" name=\"ResourcesReferences\"\r\n              [disabled]=\"formValues.recordExport === 'Blank'\" class=\"eav-radio-group\">\r\n              <mat-radio-button value=\"Link\">Keep references (for re-import, for example Page:4711)\r\n              </mat-radio-button>\r\n              <mat-radio-button value=\"Resolve\">Replace references with real URLs (for example\r\n                /Portals/0...)\r\n              </mat-radio-button>\r\n            </mat-radio-group>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <mat-dialog-actions align=\"end\">\r\n        <button mat-raised-button (click)=\"closeDialog()\">Cancel</button>\r\n        <button mat-raised-button color=\"accent\" [disabled]=\"!ngForm.form.valid\" (click)=\"exportContent()\">\r\n          Export Data\r\n        </button>\r\n      </mat-dialog-actions>\r\n    </form>\r\n  }\r\n</div>\r\n","import { Component, HostBinding, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MatDialogActions } from '@angular/material/dialog';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { BehaviorSubject, forkJoin } from 'rxjs';\r\nimport { ContentType } from '../app-administration/models/content-type.model';\r\nimport { AppDialogConfigService } from '../app-administration/services/app-dialog-config.service';\r\nimport { ContentTypesService } from '../app-administration/services/content-types.service';\r\nimport { Language } from '../edit/shared/models';\r\nimport { ContentExport } from './models/content-export.model';\r\nimport { ContentExportService } from './services/content-export.service';\r\nimport { AsyncPipe } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatRadioModule } from '@angular/material/radio';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\n@Component({\r\n    selector: 'app-content-export',\r\n    templateUrl: './content-export.component.html',\r\n    styleUrls: ['./content-export.component.scss'],\r\n    standalone: true,\r\n    imports: [\r\n        FormsModule,\r\n        MatFormFieldModule,\r\n        MatSelectModule,\r\n        MatOptionModule,\r\n        MatRadioModule,\r\n        MatDialogActions,\r\n        MatButtonModule,\r\n        AsyncPipe,\r\n    ],\r\n    providers: [\r\n        ContentExportService,\r\n        ContentTypesService,\r\n        AppDialogConfigService,\r\n    ],\r\n})\r\nexport class ContentExportComponent implements OnInit, OnDestroy {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  formValues: ContentExport;\r\n  languages: Language[];\r\n  itemIds: number[];\r\n  hasIdList = false;\r\n  loading$ = new BehaviorSubject(false);\r\n  contentType$ = new BehaviorSubject<ContentType>(null);\r\n\r\n  private contentTypeStaticName = this.route.snapshot.paramMap.get('contentTypeStaticName');\r\n\r\n  constructor(\r\n    private dialogRef: MatDialogRef<ContentExportComponent>,\r\n    private route: ActivatedRoute,\r\n    private contentExportService: ContentExportService,\r\n    private appDialogConfigService: AppDialogConfigService,\r\n    private contentTypesService: ContentTypesService,\r\n  ) {\r\n    const selectedIds = this.route.snapshot.paramMap.get('selectedIds');\r\n    this.hasIdList = !!selectedIds;\r\n    if (this.hasIdList) {\r\n      this.itemIds = selectedIds.split(',').map(id => parseInt(id, 10));\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.loading$.next(true);\r\n    const contentType$ = this.contentTypesService.retrieveContentType(this.contentTypeStaticName);\r\n    const dialogSettings$ = this.appDialogConfigService.getCurrent$();\r\n    forkJoin([contentType$, dialogSettings$]).subscribe(([contentType, dialogSettings]) => {\r\n      this.contentType$.next(contentType);\r\n      this.languages = dialogSettings.Context.Language.List;\r\n\r\n      this.formValues = {\r\n        defaultLanguage: dialogSettings.Context.Language.Primary,\r\n        contentTypeStaticName: this.contentTypeStaticName,\r\n        language: '',\r\n        recordExport: this.hasIdList ? 'Selection' : 'All',\r\n        languageReferences: 'Link',\r\n        resourcesReferences: 'Link',\r\n      };\r\n      this.loading$.next(false);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.contentType$.complete();\r\n    this.loading$.complete();\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  exportContent() {\r\n    this.contentExportService.exportContent(this.formValues,\r\n      this.hasIdList && this.formValues.recordExport === 'Selection' ? this.itemIds : null);\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}