(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_ng-dialogs_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fi-2daed6"],{3726:function(e,t,n){"use strict";n.r(t),n.d(t,{EditContentTypeFieldsComponent:function(){return K}});var i=n(4762),o=n(1041),r=n(8512),a=n(7570),s=n(3148),p=n(878),l=n(2023),c=n(4991),u=n(7768),d=n(6541);function f(e,t,n){return 0===n?[t]:(e.push(t),e)}var g=n(1055),h=n(3982),m=n(9996),y=n(3835),v=n(436),T=n(7727),Z=/^[A-Za-z][A-Za-z0-9]+$/,b=n(3667),x=n(2542),N=n(3269),A={Boolean:{label:"Boolean (yes/no)",description:"Yes/no or true/false values"},Custom:{label:"Custom - ui-tools or custom types",description:"Use for things like gps-pickers (which writes into multiple fields) or for custom-data which serializes something exotic into the db like an array, a custom json or anything"},DateTime:{label:"Date and/or time",description:"For date, time or combined values"},Empty:{label:"Empty - for form-titles etc.",description:"Use to structure your form"},Entity:{label:"Entity (other content-items)",description:"One or more other content-items"},Hyperlink:{label:"Link / file reference",description:"Hyperlink or reference to a picture / file"},Number:{label:"Number",description:"Any kind of number"},String:{label:"Text / string",description:"Any kind of text"}},I=n(1785),M=n(2935),q=n(1282),w=n(2832),C=n(7093),O=n(3589),S=n(1116),F=n(4369),_=n(3070),k=n(9550),J=function(){function e(){this.reservedNames={}}return e.prototype.validate=function(e){if(!e.value)return null;var t=e.value.toLocaleLowerCase(),n=Object.keys(this.reservedNames).find(function(e){return e.toLocaleLowerCase()===t});return n?{reservedNames:this.reservedNames[n]}:null},e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=I.lG2({type:e,selectors:[["","appReservedNames",""]],inputs:{reservedNames:["appReservedNames","reservedNames"]},features:[I._Bn([{provide:o.Cf,useExisting:e,multi:!0}])]}),e}(),Q=n(3841),U=n(7307),Y=n(7110),$=n(7064),H=["ngForm"];function E(e,t){1&e&&(I.ynx(0),I._uU(1,"Fields"),I.BQk())}function L(e,t){1&e&&(I.ynx(0),I._uU(1,"Add Fields"),I.BQk())}function R(e,t){1&e&&(I.ynx(0),I._uU(1,"Edit Field"),I.BQk())}function B(e,t){if(1&e&&(I.TgZ(0,"app-field-hint",20),I._uU(1),I.qZA()),2&e){var n=I.oxw(4);I.Q6J("isError",!0),I.xp6(1),I.Oqu(n.fieldNameError)}}function D(e,t){if(1&e&&(I.TgZ(0,"app-field-hint",20),I._uU(1),I.qZA()),2&e){I.oxw(2);var n=I.MAs(6);I.Q6J("isError",!0),I.xp6(1),I.hij(" ",n.errors.reservedNames," ")}}function z(e,t){if(1&e&&(I.ynx(0),I.YNc(1,B,2,2,"app-field-hint",19),I.YNc(2,D,2,2,"app-field-hint",19),I.BQk()),2&e){I.oxw();var n=I.MAs(6);I.xp6(1),I.Q6J("ngIf",n.errors.pattern),I.xp6(1),I.Q6J("ngIf",n.errors.reservedNames)}}function j(e,t){if(1&e&&(I.TgZ(0,"mat-option",21),I.TgZ(1,"mat-icon"),I._uU(2),I.qZA(),I.TgZ(3,"span"),I._uU(4),I.qZA(),I.qZA()),2&e){var n=t.$implicit;I.Q6J("value",n.name),I.xp6(2),I.Oqu(n.icon),I.xp6(2),I.Oqu(n.label)}}function P(e,t){if(1&e&&(I.TgZ(0,"mat-option",21),I._uU(1),I.qZA()),2&e){var n=t.$implicit;I.Q6J("value",n.inputType),I.xp6(1),I.hij(" ",n.label,"")}}function X(e,t){if(1&e){var n=I.EpF();I.TgZ(0,"div",11),I.TgZ(1,"div",12),I.TgZ(2,"mat-form-field",13),I.TgZ(3,"mat-label"),I._uU(4,"Name"),I.qZA(),I.TgZ(5,"input",14,15),I.NdJ("ngModelChange",function(e){return t.$implicit.StaticName=e}),I.qZA(),I.qZA(),I.YNc(7,z,3,2,"ng-container",2),I.qZA(),I.TgZ(8,"div",12),I.TgZ(9,"mat-form-field",13),I.TgZ(10,"mat-label"),I._uU(11,"Data Type"),I.qZA(),I.TgZ(12,"mat-select",16),I.NdJ("selectionChange",function(){var e=I.CHM(n).index,t=I.oxw(2);return t.calculateInputTypeOptions(e),t.resetInputType(e),t.calculateHints(e)})("ngModelChange",function(e){return t.$implicit.Type=e}),I.TgZ(13,"mat-select-trigger"),I.TgZ(14,"mat-icon",17),I._uU(15),I.qZA(),I.TgZ(16,"span"),I._uU(17),I.qZA(),I.qZA(),I.YNc(18,j,5,3,"mat-option",18),I.qZA(),I.qZA(),I.TgZ(19,"app-field-hint"),I._uU(20),I.qZA(),I.qZA(),I.TgZ(21,"div",12),I.TgZ(22,"mat-form-field",13),I.TgZ(23,"mat-label"),I._uU(24,"Input Type"),I.qZA(),I.TgZ(25,"mat-select",16),I.NdJ("selectionChange",function(){var e=I.CHM(n).index;return I.oxw(2).calculateHints(e)})("ngModelChange",function(e){return t.$implicit.InputType=e}),I.YNc(26,P,2,2,"mat-option",18),I.qZA(),I.qZA(),I.TgZ(27,"app-field-hint"),I._uU(28),I.qZA(),I.qZA(),I.qZA()}if(2&e){var i=t.$implicit,o=t.index,r=I.MAs(6),a=I.oxw(2);I.xp6(5),I.Q6J("pattern",a.fieldNamePattern)("appReservedNames",a.reservedNames)("ngModel",i.StaticName)("name","StaticName"+o)("disabled","inputType"===a.editMode),I.xp6(2),I.Q6J("ngIf",r.touched&&r.errors),I.xp6(5),I.Q6J("ngModel",i.Type)("name","Type"+o)("disabled",null!=a.editMode),I.xp6(3),I.Oqu(a.findIcon(i.Type)),I.xp6(2),I.Oqu(i.Type),I.xp6(1),I.Q6J("ngForOf",a.dataTypes),I.xp6(2),I.Oqu(a.dataTypeHints[o]),I.xp6(5),I.Q6J("ngModel",i.InputType)("name","InputType"+o)("disabled","name"===a.editMode),I.xp6(1),I.Q6J("ngForOf",a.filteredInputTypeOptions[o]),I.xp6(2),I.Oqu(a.inputTypeHints[o])}}function G(e,t){if(1&e){var n=I.EpF();I.TgZ(0,"form",4,5),I.NdJ("ngSubmit",function(){return I.CHM(n),I.oxw().save()}),I.TgZ(2,"div",6),I.YNc(3,X,29,18,"div",7),I.qZA(),I.TgZ(4,"div",8),I.TgZ(5,"button",9),I.NdJ("click",function(){return I.CHM(n),I.oxw().closeDialog()}),I._uU(6,"Cancel"),I.qZA(),I.TgZ(7,"button",10),I.ALo(8,"async"),I._uU(9," Save "),I.qZA(),I.qZA(),I.qZA()}if(2&e){var i=I.MAs(1),o=I.oxw();I.xp6(3),I.Q6J("ngForOf",o.fields),I.xp6(4),I.Q6J("disabled",!i.form.valid||I.lcZ(8,2,o.saving$))}}var K=function(){function e(e,t,n,i,o){var s=this;this.dialogRef=e,this.route=t,this.contentTypesService=n,this.contentTypesFieldsService=i,this.snackBar=o,this.hostClass="dialog-component",this.fields=[],this.filteredInputTypeOptions=[],this.dataTypeHints=[],this.inputTypeHints=[],this.fieldNamePattern=Z,this.fieldNameError="Standard letters and numbers are allowed. Must start with a letter.",this.findIcon=N.x,this.loading$=new r.X(!0),this.saving$=new r.X(!1),this.subscription=new a.w,this.dialogRef.disableClose=!0,this.subscription.add(this.dialogRef.backdropClick().subscribe(function(e){s.form.dirty&&!confirm("You have unsaved changes. Are you sure you want to close this dialog?")||s.closeDialog()}))}return e.prototype.ngOnInit=function(){var e=this;this.editMode=this.route.snapshot.paramMap.get("editMode");var t=this.route.snapshot.paramMap.get("contentTypeStaticName"),n=this.contentTypesService.retrieveContentType(t).pipe((0,g.B)()),o=n.pipe((0,h.zg)(function(t){return e.contentTypesFieldsService.getFields(t)})),r=this.contentTypesFieldsService.typeListRetrieve().pipe((0,m.U)(function(e){return function(e){var t,n,o=[];try{for(var r=(0,i.XA)(e),a=r.next();!a.done;a=r.next()){var s=a.value;o.push({name:s,label:A[s].label,icon:(0,N.x)(s),description:A[s].description})}}catch(p){t={error:p}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return o}(e)})),a=this.contentTypesFieldsService.getInputTypesList(),p=this.contentTypesFieldsService.getReservedNames();(0,s.D)([n,o,r,a,p]).subscribe(function(t){var n=(0,i.CR)(t,5),o=n[1],r=n[2],a=n[3],s=n[4];e.contentType=n[0],e.dataTypes=r,e.inputTypeOptions=a;var p={};if(o.forEach(function(e){p[e.StaticName]="Field with this name already exists"}),e.reservedNames=(0,i.pi)((0,i.pi)({},s),p),null!=e.editMode){var l=e.route.snapshot.paramMap.get("id")?parseInt(e.route.snapshot.paramMap.get("id"),10):null,c=o.find(function(e){return e.Id===l});"name"===e.editMode&&delete e.reservedNames[c.StaticName],e.fields.push(c)}else for(var u=1;u<=8;u++)e.fields.push({Id:0,Type:b.Q.String,InputType:x.v.StringDefault,StaticName:"",IsTitle:0===o.length,SortOrder:o.length+u});for(u=0;u<e.fields.length;u++)e.calculateInputTypeOptions(u),e.calculateHints(u);e.loading$.next(!1)})},e.prototype.ngOnDestroy=function(){this.loading$.complete(),this.saving$.complete(),this.subscription.unsubscribe()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.calculateInputTypeOptions=function(e){var t=this;this.filteredInputTypeOptions[e]=this.inputTypeOptions.filter(function(n){return n.dataType===t.fields[e].Type.toLocaleLowerCase()})},e.prototype.resetInputType=function(e){var t=this.fields[e].Type.toLocaleLowerCase()+x.v.DefaultSuffix;this.filteredInputTypeOptions[e].some(function(e){return e.inputType===t})||(t=this.filteredInputTypeOptions[e][0].inputType),this.fields[e].InputType=t},e.prototype.calculateHints=function(e){var t,n,i=this,o=this.dataTypes.find(function(t){return t.name===i.fields[e].Type}),r=this.inputTypeOptions.find(function(t){return t.inputType===i.fields[e].InputType});this.dataTypeHints[e]=null!==(t=null==o?void 0:o.description)&&void 0!==t?t:"",this.inputTypeHints[e]=null!==(n=null==r?void 0:r.description)&&void 0!==n?n:""},e.prototype.save=function(){var e=this;if(this.saving$.next(!0),this.snackBar.open("Saving..."),null!=this.editMode){var t=this.fields[0];"name"===this.editMode?this.contentTypesFieldsService.rename(t.Id,this.contentType.Id,t.StaticName).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()}):"inputType"===this.editMode&&this.contentTypesFieldsService.updateInputType(t.Id,t.StaticName,t.InputType).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})}else p.of.apply(void 0,(0,i.ev)([],(0,i.CR)(this.fields))).pipe((0,y.h)(function(e){return!!e.StaticName}),(0,v.b)(function(t){return e.contentTypesFieldsService.add(t,e.contentType.Id).pipe((0,T.K)(function(e){return(0,p.of)(null)}))}),function(e,t){return arguments.length>=2?function(n){return(0,d.z)((0,l.R)(e,t),(0,c.h)(1),(0,u.d)(t))(n)}:function(t){return(0,d.z)((0,l.R)(function(t,n,i){return e(t,n,i+1)}),(0,c.h)(1))(t)}}(f,[])).subscribe(function(t){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})},e.\u0275fac=function(t){return new(t||e)(I.Y36(M.so),I.Y36(q.gz),I.Y36(w.s),I.Y36(C.Mr),I.Y36(O.ux))},e.\u0275cmp=I.Xpm({type:e,selectors:[["app-edit-content-type-fields"]],viewQuery:function(e,t){var n;1&e&&I.Gf(H,5,o.F),2&e&&I.iGM(n=I.CRH())&&(t.form=n.first)},hostVars:1,hostBindings:function(e,t){2&e&&I.Ikx("className",t.hostClass)},decls:7,vars:6,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["class","dialog-form",3,"ngSubmit",4,"ngIf"],[1,"dialog-form",3,"ngSubmit"],["ngForm","ngForm"],[1,"dialog-form-content","fancy-scrollbar-light"],["class","row-container",4,"ngFor","ngForOf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","submit","color","accent",3,"disabled"],[1,"row-container"],[1,"edit-input"],["appearance","standard","color","accent"],["matInput","",3,"pattern","appReservedNames","ngModel","name","disabled","ngModelChange"],["staticName","ngModel"],[3,"ngModel","name","disabled","selectionChange","ngModelChange"],[1,"type-icon"],[3,"value",4,"ngFor","ngForOf"],[3,"isError",4,"ngIf"],[3,"isError"],[3,"value"]],template:function(e,t){1&e&&(I.TgZ(0,"div",0),I.TgZ(1,"div",1),I.YNc(2,E,2,0,"ng-container",2),I.YNc(3,L,2,0,"ng-container",2),I.YNc(4,R,2,0,"ng-container",2),I.qZA(),I.qZA(),I.YNc(5,G,10,4,"form",3),I.ALo(6,"async")),2&e&&(I.xp6(2),I.Q6J("ngIf",void 0===t.editMode),I.xp6(1),I.Q6J("ngIf",null===t.editMode),I.xp6(1),I.Q6J("ngIf",null!=t.editMode),I.xp6(1),I.Q6J("ngIf",!1===I.lcZ(6,4,t.loading$)))},directives:[M.uh,S.O5,o._Y,o.JL,o.F,S.sg,F.lW,_.KE,_.hX,k.Nt,o.Fj,o.c5,J,o.JJ,o.On,Q.gD,Q.$L,U.Hw,Y.Y,$.ey],pipes:[S.Ov],styles:[".row-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.edit-input[_ngcontent-%COMP%]{padding-bottom:8px;width:30%}.type-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;margin-right:8px;font-size:inherit;vertical-align:top;line-height:inherit}"]}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/12.06.00/ng-edit/projects_ng-dialogs_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fi-2daed6.06ce57ff3402e980cd30.js.map