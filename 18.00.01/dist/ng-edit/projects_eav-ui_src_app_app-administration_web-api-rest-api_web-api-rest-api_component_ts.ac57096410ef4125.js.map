{"version":3,"file":"projects_eav-ui_src_app_app-administration_web-api-rest-api_web-api-rest-api_component_ts.ac57096410ef4125.js","mappings":"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","names":["i0","endpoint_r1","path","name","WebApiRestApiComponent_Conditional_5_For_1_Template","ctx","sort","WebApiRestApiComponent","constructor","fb","router","route","this","sourceService","transient","SourceService","webApis$","BehaviorSubject","undefined","ngOnInit","fetchWebApis","webApiTypeForm","group","webApiType","getWebApis","subscribe","webApis","next","urlSegments","url","split","encodedUrlPath","length","replace","selectedContentType","find","webApi","get","setValue","openRestApi","apiRoute","navigate","encodeURIComponent","relativeTo","parent","firstChild","static","t","i1","i2","_angular_core__WEBPACK_IMPORTED_MODULE_2__","VBU","selectors","standalone","features","decls","vars","consts","template","rf","$event","WebApiRestApiComponent_Conditional_5_Template","tmp_1_0","MatSelectModule","i3","i4","i5","MatButtonModule","MatCardModule","MatIconModule","ReactiveFormsModule","AsyncPipe","RouterOutlet","SxcGridModule","appFilesAsset","http","context","dnnContext","viewKey","global","urlItems","$2sxc","apiUrl","params","appId","templateIdOrPath","pipe","map","view","Type","toLocaleLowerCase","Extension","save","post","getAll","mask","Files","forEach","file","Shared","files","isShared","isCompiled","splitIndex","lastIndexOf","fileExtIndex","folder","substring","endpointPath","edition","getWebApiDetails","apiPath","zoneId","getPredefinedTemplates","purpose","type","getPreview","templateKey","create","test","i","EntityId","toString","IsShared","Path","templateId","jDH","factory","Éµfac"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/web-api-rest-api/web-api-rest-api.component.html","./projects/eav-ui/src/app/app-administration/web-api-rest-api/web-api-rest-api.component.ts","./projects/eav-ui/src/app/code-editor/services/source.service.ts"],"sourcesContent":["<form [formGroup]=\"webApiTypeForm\">\r\n  <mat-form-field color=\"accent\" class=\"eav-mat-form-field\">\r\n    <mat-label>Endpoint</mat-label>\r\n    <mat-select formControlName=\"webApiType\" (valueChange)=\"openRestApi($event)\">\r\n      @if (webApis$ | async; as endpoints) {\r\n        @for (endpoint of endpoints.sort() ; track endpoint) {\r\n        <mat-option [value]=\"endpoint.path\">\r\n          {{ endpoint.name }}\r\n        </mat-option>\r\n        }\r\n      }\r\n    </mat-select>\r\n  </mat-form-field>\r\n</form>\r\n\r\n<router-outlet></router-outlet>\r\n","import { AsyncPipe } from '@angular/common';\r\nimport { Component } from '@angular/core';\r\nimport { FormBuilder, FormGroup, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCardModule } from '@angular/material/card';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { DevRestQueryComponent } from '../../dev-rest/query/query.component';\r\nimport { WebApi } from '../models';\r\nimport { ActivatedRoute, Router, RouterOutlet } from '@angular/router';\r\nimport { SourceService } from '../../code-editor/services/source.service';\r\nimport { SxcGridModule } from '../../shared/modules/sxc-grid-module/sxc-grid.module';\r\nimport { transient } from '../../core';\r\n\r\n@Component({\r\n  selector: 'app-web-api-rest-api',\r\n  standalone: true,\r\n  imports: [\r\n    MatSelectModule,\r\n    MatButtonModule,\r\n    MatCardModule,\r\n    MatIconModule,\r\n    ReactiveFormsModule,\r\n    AsyncPipe,\r\n    DevRestQueryComponent,\r\n    RouterOutlet,\r\n    SxcGridModule,\r\n  ],\r\n  templateUrl: './web-api-rest-api.component.html',\r\n  styleUrl: './web-api-rest-api.component.scss'\r\n})\r\nexport class WebApiRestApiComponent {\r\n  private sourceService = transient(SourceService);\r\n  webApis$ = new BehaviorSubject<WebApi[]>(undefined);\r\n  webApiTypeForm: FormGroup;\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.fetchWebApis();\r\n    this.webApiTypeForm = this.fb.group({\r\n      webApiType: ['']\r\n    });\r\n  }\r\n\r\n  fetchWebApis() {\r\n    this.sourceService.getWebApis().subscribe((webApis: WebApi[]) => {\r\n      this.webApis$.next(webApis);\r\n      // When Route are reload and have some Guid in the Route\r\n      const urlSegments = this.router.url.split('/');\r\n      const urlPath = urlSegments[urlSegments.length - 1]\r\n      var encodedUrlPath = urlPath.replace(\"%252F\", \"/\");\r\n\r\n      const selectedContentType = webApis.find(webApi => webApi.path === encodedUrlPath);\r\n\r\n      if (selectedContentType)\r\n        this.webApiTypeForm.get('webApiType').setValue(selectedContentType.path);\r\n    });\r\n  }\r\n\r\n  openRestApi(apiRoute: string): void {\r\n    if (!apiRoute) return;\r\n    this.router.navigate([encodeURIComponent(apiRoute)], { relativeTo: this.route.parent.firstChild });\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { map, Observable } from 'rxjs';\r\nimport { WebApi, WebApiDetails } from '../../app-administration/models';\r\nimport { ViewOrFileIdentifier } from '../../shared/models/edit-form.model';\r\nimport { Context } from '../../shared/services/context';\r\nimport { FileAsset } from '../models/file-asset.model';\r\nimport { PredefinedTemplatesResponse } from '../models/predefined-template.model';\r\nimport { Preview } from '../models/preview.models';\r\nimport { SourceView } from '../models/source-view.model';\r\n\r\nconst appFilesAll = 'admin/AppFiles/AppFiles';\r\nconst appFilesAsset = 'admin/AppFiles/asset';\r\nconst appFilesCreate = 'admin/AppFiles/create';\r\nconst apiExplorerInspect = 'admin/ApiExplorer/inspect';\r\nconst apiExplorerAppApiFiles = 'admin/ApiExplorer/AppApiFiles';\r\nconst appFilesPredefinedTemplates = 'admin/AppFiles/GetTemplates';\r\nconst appFilesPreview = 'admin/AppFiles/preview';\r\n\r\n@Injectable()\r\nexport class SourceService {\r\n\r\n  constructor(private http: HttpClient, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  /** ViewKey is templateId or path */\r\n  get(viewKey: string, global: boolean, urlItems: ViewOrFileIdentifier[]): Observable<SourceView> {\r\n    return this.http.get<SourceView>(this.dnnContext.$2sxc.http.apiUrl(appFilesAsset), {\r\n      params: {\r\n        appId: this.context.appId,\r\n        global,\r\n        ...this.templateIdOrPath(viewKey, global, urlItems),\r\n      },\r\n    }).pipe(\r\n      map(view => {\r\n        if (view.Type.toLocaleLowerCase() === 'auto') {\r\n          switch (view.Extension.toLocaleLowerCase()) {\r\n            case '.cs':\r\n            case '.cshtml':\r\n              view.Type = 'Razor';\r\n              break;\r\n            case '.html':\r\n            case '.css':\r\n            case '.js':\r\n              view.Type = 'Token';\r\n              break;\r\n          }\r\n        }\r\n        return view;\r\n      })\r\n    );\r\n  }\r\n\r\n  /** ViewKey is templateId or path */\r\n  save(viewKey: string, global: boolean, view: SourceView, urlItems: ViewOrFileIdentifier[]): Observable<boolean> {\r\n    return this.http.post<boolean>(this.dnnContext.$2sxc.http.apiUrl(appFilesAsset), view, {\r\n      params: {\r\n        appId: this.context.appId,\r\n        global,\r\n        ...this.templateIdOrPath(viewKey, global, urlItems),\r\n      },\r\n    });\r\n  }\r\n\r\n  getAll(mask?: string): Observable<FileAsset[]> {\r\n    return this.http.get<{ Files: FileAsset[] }>(this.dnnContext.$2sxc.http.apiUrl(appFilesAll), {\r\n      params: {\r\n        appId: this.context.appId,\r\n        ...(mask && { mask }),\r\n      },\r\n    }).pipe(\r\n      map(({ Files }) => {\r\n        Files.forEach(file => {\r\n          file.Shared ??= false;\r\n        });\r\n        return Files;\r\n      }),\r\n    );\r\n  }\r\n\r\n  getWebApis(): Observable<WebApi[]> {\r\n    return this.http.get<{ files: WebApi[] }>(this.dnnContext.$2sxc.http.apiUrl(apiExplorerAppApiFiles), {\r\n      params: {\r\n        appId: this.context.appId,\r\n      },\r\n    }).pipe(\r\n      map(({ files }) => {\r\n        files.forEach(file => {\r\n          file.isShared ??= false;\r\n          file.isCompiled ??= false;\r\n        });\r\n        return files;\r\n      }),\r\n    ).pipe(\r\n      map(files => {\r\n        const webApis: WebApi[] = files.map(file => {\r\n          const splitIndex = file.path.lastIndexOf('/');\r\n          const fileExtIndex = file.path.lastIndexOf('.');\r\n          const folder = file.path.substring(0, splitIndex);\r\n          const name = file.path.substring(splitIndex + 1, fileExtIndex);\r\n          const webApi: WebApi = { path: file.path, folder, name, isShared: file.isShared, endpointPath: file.endpointPath, isCompiled: file.isCompiled, edition: file.edition };\r\n          return webApi;\r\n        });\r\n        return webApis;\r\n      }),\r\n    );\r\n  }\r\n\r\n  getWebApiDetails(apiPath: string): Observable<WebApiDetails> {\r\n    return this.http.get<WebApiDetails>(this.dnnContext.$2sxc.http.apiUrl(apiExplorerInspect), {\r\n      params: { appId: this.context.appId, zoneId: this.context.zoneId, path: apiPath },\r\n    });\r\n  }\r\n\r\n  getPredefinedTemplates(purpose?: 'Template' | 'Search' | 'Api', type?: 'Token' | 'Razor'): Observable<PredefinedTemplatesResponse> {\r\n    return this.http.get<PredefinedTemplatesResponse>(this.dnnContext.$2sxc.http.apiUrl(appFilesPredefinedTemplates), {\r\n      params: {\r\n        ...(purpose && { purpose }),\r\n        ...(type && { type }),\r\n      },\r\n    });\r\n  }\r\n\r\n  getPreview(path: string, global: boolean, templateKey: string): Observable<Preview> {\r\n    return this.http.get<Preview>(this.dnnContext.$2sxc.http.apiUrl(appFilesPreview), {\r\n      params: {\r\n        appId: this.context.appId,\r\n        path,\r\n        templateKey,\r\n        global,\r\n      },\r\n    });\r\n  }\r\n\r\n  create(path: string, global: boolean, templateKey: string): Observable<boolean> {\r\n    return this.http.post<boolean>(this.dnnContext.$2sxc.http.apiUrl(appFilesCreate), {}, {\r\n      params: {\r\n        appId: this.context.appId,\r\n        global,\r\n        purpose: 'auto',\r\n        path,\r\n        templateKey,\r\n      },\r\n    });\r\n  }\r\n\r\n  private templateIdOrPath(viewKey: string, global: boolean, urlItems: ViewOrFileIdentifier[]) {\r\n    if (/^[0-9]*$/g.test(viewKey)) {\r\n      const path = urlItems.find(i => i.EntityId?.toString() === viewKey && i.IsShared === global)?.Path;\r\n      return {\r\n        templateId: viewKey,\r\n        ...(path != null && { path }),\r\n      };\r\n    } else {\r\n      return { path: viewKey };\r\n    }\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}