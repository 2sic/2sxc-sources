"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_visual-query_visual-query_component_ts"],{1459:(q,I,c)=>{c.d(I,{z:()=>$});var D=c(8559);let $=(()=>{class b{onMousedown(F){F.stopPropagation()}static#e=this.\u0275fac=function(T){return new(T||b)};static#t=this.\u0275dir=D.FsC({type:b,selectors:[["","appMousedownStopPropagation",""]],hostBindings:function(T,m){1&T&&D.bIt("mousedown",function(x){return m.onMousedown(x)})},standalone:!0})}return b})()},2897:(q,I,c)=>{c.r(I),c.d(I,{VisualQueryComponent:()=>jt});var D=c(9184),$=c(8873),b=c(5797),S=c(271),F=c(9999),T=c(3176),m=c(52),U=c(3518),x=c(5445),e=c(8559),ee=c(6443);let N=(()=>{class o{constructor(t,n){this.http=t,this.context=n}fetchPipeline(t,n){return this.http.get(x.JL,{params:{appId:this.context.appId.toString(),id:t.toString()}}).pipe((0,S.T)(i=>(i.DataSources.length||this.buildDefaultModel(i,n),this.fixPipelineDataSources(i.DataSources),i)))}buildDefaultModel(t,n){const i=m.YX.pipelineDesigner.defaultPipeline.dataSources;for(const s of i){const r=n.find(p=>p.PartAssemblyAndType===s.PartAssemblyAndType);t.DataSources.push({Description:"",EntityGuid:s.EntityGuid,EntityId:void 0,Name:r.Name,PartAssemblyAndType:s.PartAssemblyAndType,VisualDesignerData:s.VisualDesignerData})}t.Pipeline.StreamWiring=m.YX.pipelineDesigner.defaultPipeline.streamWiring}fixPipelineDataSources(t){if(!t.some(i=>i.EntityGuid===m.YX.pipelineDesigner.outDataSource.EntityGuid)){const i=m.YX.pipelineDesigner.outDataSource;t.push({Description:i.Description,EntityGuid:i.EntityGuid,EntityId:void 0,Name:i.Name,PartAssemblyAndType:i.PartAssemblyAndType,VisualDesignerData:i.VisualDesignerData})}for(const i of t)i.VisualDesignerData??={Top:50,Left:50}}fetchDataSources(){return this.http.get(x.vN,{params:{appid:this.context.appId,zoneId:this.context.zoneId}}).pipe((0,S.T)(t=>{const n=m.YX.pipelineDesigner.outDataSource;return t.push({ContentType:void 0,Difficulty:m.YX.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:n.In,Name:n.Name,Out:void 0,PartAssemblyAndType:n.PartAssemblyAndType,PrimaryType:n.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),t}))}typeNameFilter(t,n){const i=t.split(", ");switch(n){case"classFullName":return i[0];case"className":const r=i[0].split(".");return r[r.length-1];default:return t}}savePipeline(t){const n=t.Pipeline;return this.http.post(x.Cu,{pipeline:n,dataSources:t.DataSources},{params:{appId:this.context.appId.toString(),Id:n.EntityId.toString()}}).pipe((0,S.T)(s=>(this.fixPipelineDataSources(s.DataSources),s)))}runPipeline(t,n){return this.http.get(x.Mk,{params:{appId:this.context.appId.toString(),id:t.toString(),top:n.toString()}})}debugStream(t,n,i,s){return this.http.get(x.ei,{params:{appId:this.context.appId.toString(),id:t.toString(),from:n,out:i,top:s.toString()}})}static#e=this.\u0275fac=function(n){return new(n||o)(e.KVO(ee.Qq),e.KVO($.o))};static#t=this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}return o})();var R=c(803),te=c(4205),ne=c(8537),V=c(1567),ie=c(7693),oe=c(401),se=c(1735),A=c(3216),E=c(7941),v=c(316),j=c(8223),g=c(3840),y=c(4175);function ae(o,a){if(1&o&&e.EFF(0),2&o){const t=e.XpG();e.Lme(' for Stream: "',t.debugStream.name,'" on Source: "',t.debugStream.sourceName,'" ')}}function re(o,a){1&o&&(e.j41(0,"div",11)(1,"span"),e.EFF(2,"Results"),e.k0s()())}function le(o,a){1&o&&e.EFF(0," Showing All results ")}function ce(o,a){if(1&o&&e.EFF(0),2&o){const t=e.XpG();e.SpI(" Showing top ",t.top," results ")}}function ue(o,a){1&o&&e.EFF(0," All ")}function de(o,a){if(1&o&&e.EFF(0),2&o){const t=e.XpG().$implicit;e.SpI(" ",t," ")}}function pe(o,a){if(1&o){const t=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.show(i))}),e.EFF(1," Show "),e.DNE(2,ue,1,0)(3,de,1,1),e.k0s()}if(2&o){const t=a.$implicit;e.R7$(2),e.vxM(2,0===t?2:-1),e.R7$(),e.vxM(3,0!==t?3:-1)}}function me(o,a){1&o&&(e.j41(0,"div",14)(1,"span"),e.EFF(2,"Parameters"),e.k0s()())}function he(o,a){if(1&o&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.R7$(),e.JRh(t)}}function fe(o,a){if(1&o&&(e.j41(0,"mat-tab"),e.DNE(1,me,3,0,"div",13),e.nrm(2,"br"),e.j41(3,"ul"),e.Z7z(4,he,2,1,"li",null,e.fX1),e.k0s()()),2&o){const t=e.XpG();e.R7$(4),e.Dyx(t.parameters)}}function ge(o,a){1&o&&(e.j41(0,"div",15)(1,"span"),e.EFF(2,"Sources"),e.k0s()())}function _e(o,a){if(1&o&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(),e.JRh(null==t.value.Definition?null:t.value.Definition.Name)}}function ye(o,a){if(1&o&&(e.j41(0,"li")(1,"b"),e.EFF(2),e.k0s(),e.EFF(3,"="),e.j41(4,"em"),e.EFF(5),e.k0s()()),2&o){const t=a.$implicit;e.R7$(2),e.JRh(t.key),e.R7$(3),e.JRh(t.value)}}function ve(o,a){if(1&o&&(e.j41(0,"tr")(1,"td"),e.DNE(2,_e,2,1,"div"),e.j41(3,"pre"),e.EFF(4),e.k0s()(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td")(8,"ol"),e.Z7z(9,ye,6,2,"li",null,e.fX1),e.nI1(11,"keyvalue"),e.k0s()(),e.j41(12,"td"),e.EFF(13),e.k0s()()),2&o){const t=a.$implicit;e.R7$(2),e.vxM(2,null!=t.value.Definition&&t.value.Definition.Name?2:-1),e.R7$(2),e.JRh(t.value.Guid),e.R7$(2),e.JRh(t.value.Type),e.R7$(3),e.Dyx(e.bMT(11,4,t.value.Configuration)),e.R7$(4),e.JRh(t.value.Error)}}function Ce(o,a){1&o&&(e.j41(0,"div",16)(1,"span"),e.EFF(2,"Streams"),e.k0s()())}function be(o,a){if(1&o&&(e.j41(0,"tr")(1,"td")(2,"pre"),e.EFF(3),e.k0s()(),e.j41(4,"td")(5,"pre"),e.EFF(6),e.k0s()(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s()()),2&o){const t=a.$implicit;e.R7$(3),e.JRh(t.Source+":"+t.SourceOut),e.R7$(3),e.JRh(t.Target+":"+t.TargetIn),e.R7$(2),e.JRh(t.Count),e.R7$(2),e.JRh(t.Error)}}let Se=(()=>{class o{constructor(t,n,i){this.dialogData=t,this.dialogRef=n,this.visualQueryService=i}ngOnInit(){const t=this.visualQueryService.pipelineModel$.value.Pipeline,n=(t.Params?.split("\n")??[]).filter(s=>!!s),i=(t.TestParameters?.split("\n")??[]).filter(s=>!!s);this.parameters=[].concat(n,i),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialogRef.close()}show(t){t!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,t):this.visualQueryService.runPipeline(t),this.closeDialog())}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(E.Vh),e.rXU(E.CP),e.rXU(P))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-query-result"]],standalone:!0,features:[e.aNF],decls:54,vars:11,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["dynamicHeight","","color","accent",1,"eav-tab-group"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"eav-tab-description"],["mat-button",""],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3," Query Results "),e.DNE(4,ae,1,2),e.k0s(),e.j41(5,"button",3),e.bIt("click",function(){return i.closeDialog()}),e.j41(6,"mat-icon"),e.EFF(7,"close"),e.k0s()()(),e.j41(8,"div",4)(9,"p"),e.EFF(10),e.k0s(),e.j41(11,"mat-tab-group",5)(12,"mat-tab"),e.DNE(13,re,3,0,"div",6),e.j41(14,"p",7),e.DNE(15,le,1,0)(16,ce,1,1),e.Z7z(17,pe,4,2,"button",8,e.fX1),e.k0s(),e.j41(19,"pre"),e.EFF(20),e.nI1(21,"json"),e.k0s()(),e.DNE(22,fe,6,0,"mat-tab"),e.j41(23,"mat-tab"),e.DNE(24,ge,3,0,"div",9),e.nrm(25,"br"),e.j41(26,"table")(27,"tr")(28,"th"),e.EFF(29,"Name and Guid"),e.k0s(),e.j41(30,"th"),e.EFF(31,"Type"),e.k0s(),e.j41(32,"th"),e.EFF(33,"Configuration"),e.k0s(),e.j41(34,"th"),e.EFF(35,"Error"),e.k0s()(),e.Z7z(36,ve,14,6,"tr",null,e.fX1),e.nI1(38,"keyvalue"),e.k0s()(),e.j41(39,"mat-tab"),e.DNE(40,Ce,3,0,"div",10),e.nrm(41,"br"),e.j41(42,"table")(43,"tr")(44,"th"),e.EFF(45,"Source"),e.k0s(),e.j41(46,"th"),e.EFF(47,"Target"),e.k0s(),e.j41(48,"th"),e.EFF(49,"Items"),e.k0s(),e.j41(50,"th"),e.EFF(51,"Error"),e.k0s()(),e.Z7z(52,be,11,4,"tr",null,e.fX1),e.k0s()()()()()),2&n&&(e.R7$(4),e.vxM(4,i.debugStream?4:-1),e.R7$(6),e.Lme(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",i.timeUsed,"ms (",i.ticksUsed," ticks) "),e.R7$(5),e.vxM(15,0===i.top?15:-1),e.R7$(),e.vxM(16,0!==i.top?16:-1),e.R7$(),e.Dyx(i.optionsForTop),e.R7$(3),e.JRh(e.bMT(21,7,i.result)),e.R7$(2),e.vxM(22,null!=i.parameters&&i.parameters.length?22:-1),e.R7$(14),e.Dyx(e.bMT(38,9,i.sources)),e.R7$(16),e.Dyx(i.streams))},dependencies:[y.Hl,y.$z,y.iY,g.m_,g.An,j.RI,j.ES,j.mq,j.T8,v.TG,v.lG],styles:[".eav-tab-group[_ngcontent-%COMP%]{padding:0}.eav-tab-description[_ngcontent-%COMP%]{display:flex;align-items:baseline}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]})}return o})(),Ee=(()=>{class o{constructor(t,n){this.dialogData=t,this.dialogRef=n}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialogRef.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api-query"),"_blank")}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(E.Vh),e.rXU(E.CP))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-stream-error-result"]],standalone:!0,features:[e.aNF],decls:17,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["align","end"],["mat-button","","tippy","Open 2sxc Insights",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3,"Stream Error Results"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return i.closeDialog()}),e.j41(5,"mat-icon"),e.EFF(6,"close"),e.k0s()()(),e.j41(7,"div",4)(8,"pre"),e.EFF(9),e.nI1(10,"json"),e.k0s()(),e.j41(11,"mat-dialog-actions",5)(12,"button",6),e.bIt("click",function(){return i.openInsights()}),e.j41(13,"mat-icon",7),e.EFF(14,"speed"),e.k0s(),e.j41(15,"span"),e.EFF(16,"Insights"),e.k0s()()()()),2&n&&(e.R7$(9),e.JRh(e.bMT(10,1,i.errorData)))},dependencies:[y.Hl,y.$z,y.iY,g.m_,g.An,E.E7,v.TG],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]})}return o})();var X=c(4038),De=c(436),xe=c(3347);let P=(()=>{class o extends se.V{constructor(t,n,i,s,r,l,p,d,u,f,C){super(t,n),this.router=t,this.route=n,this.queryDefinitionService=i,this.titleService=s,this.snackBar=r,this.dialog=l,this.viewContainerRef=p,this.zone=d,this.metadataService=u,this.contentTypesService=f,this.changeDetectorRef=C,this.pipelineModel$=new b.t(null),this.dataSources$=new b.t(null),this.putEntityCountOnConnections$=new te.B,this.dataSourceConfigs$=new b.t({}),this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1}ngOnDestroy(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),super.ngOnDestroy()}init(){this.fetchDataSources(()=>this.fetchPipeline(!0,!0,!1)),this.attachKeyboardSave(),this.subscriptions.add(this.childDialogClosed$().subscribe(()=>{(this.refreshPipeline||this.refreshDataSourceConfigs)&&this.fetchPipeline(this.refreshPipeline,this.refreshDataSourceConfigs,this.refreshPipeline),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1}))}editPipelineEntity(){this.savePipeline(()=>{const n=(0,A.s)({items:[{EntityId:this.pipelineModel$.value.Pipeline.EntityId}]});this.router.navigate([`edit/${n}`],{relativeTo:this.route}),this.refreshPipeline=!0})}saveAndRun(t,n){t&&n?this.savePipeline(()=>{this.runPipeline()}):t?this.savePipeline():n&&this.runPipeline()}showDataSourceDetails(t){const n=(0,R.A)(this.pipelineModel$.value),i=X.i.tryParse(n.Pipeline.VisualDesignerData)??{};i.ShowDataSourceDetails=t,n.Pipeline.VisualDesignerData=JSON.stringify(i),this.pipelineModel$.next(n)}addDataSource(t){const n=(0,R.A)(this.pipelineModel$.value);n.DataSources.push({Description:"",EntityGuid:"unsaved"+(n.DataSources.length+1),EntityId:void 0,Name:t.Name,PartAssemblyAndType:t.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(n),this.savePipeline()}removeDataSource(t,n,i){const s=(0,R.A)(this.pipelineModel$.value);s.DataSources=s.DataSources.filter(r=>r.EntityGuid!==t),s.Pipeline.StreamWiring=n,s.Pipeline.StreamsOut=i,this.pipelineModel$.next(s)}renameDataSource(t,n){const i=(0,R.A)(this.pipelineModel$.value);i.DataSources.find(r=>r.EntityGuid===t).Name=n,this.pipelineModel$.next(i)}changeDataSourceDescription(t,n){const i=(0,R.A)(this.pipelineModel$.value);i.DataSources.find(r=>r.EntityGuid===t).Description=n,this.pipelineModel$.next(i)}changeConnections(t,n){const i=(0,R.A)(this.pipelineModel$.value);i.Pipeline.StreamWiring=t,i.Pipeline.StreamsOut=n,this.pipelineModel$.next(i)}changeDataSourcePosition(t,n){const i=(0,R.A)(this.pipelineModel$.value),s=i.DataSources.find(r=>r.EntityGuid===t);s&&(s.VisualDesignerData={...s.VisualDesignerData,...n},this.pipelineModel$.next(i))}calculateDataSourceConfigs(t){const n={};t.forEach(i=>{null!=i.EntityId&&(n[i.EntityId]=[],i.Metadata?.forEach(s=>{Object.entries(s).forEach(([r,l])=>{null==l||""===l||["Created","Guid","Id","Modified","Title","_Type"].includes(r)||(Array.isArray(l)&&null!=l[0]?.Title&&null!=l[0]?.Id&&(l=`${l[0].Title} (${l[0].Id})`),n[i.EntityId].push({name:r,value:l}))})}))}),this.dataSourceConfigs$.next(n)}editDataSource(t){const i=this.dataSources$.value.find(p=>p.PartAssemblyAndType===t.PartAssemblyAndType).ContentType,l=t.EntityGuid;this.metadataService.getMetadata(m.YX.metadata.entity.targetType,m.YX.metadata.entity.keyType,l,i).subscribe(p=>{if(p.Items.length){const u=(0,A.s)({items:[{EntityId:p.Items[0].Id}]});return this.router.navigate([`edit/${u}`],{relativeTo:this.route}),void(this.refreshDataSourceConfigs=!0)}this.contentTypesService.retrieveContentType(i).subscribe({next:d=>{if(null==d)return void this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});const f=(0,A.s)({items:[{ContentTypeName:i,For:{Target:m.YX.metadata.entity.target,TargetType:m.YX.metadata.entity.targetType,Guid:l}}]});this.router.navigate([`edit/${f}`],{relativeTo:this.route}),this.refreshDataSourceConfigs=!0},error:d=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}savePipeline(t){this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:n=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel$.next(n),t?.()},error:n=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(t=25){this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,t).subscribe({next:n=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.pipelineResult=n,this.showQueryResult(n,t),console.warn(n),this.pipelineModel$.next((0,R.A)(this.pipelineModel$.value)),setTimeout(()=>{this.putEntityCountOnConnections$.next(n)})},error:n=>{this.snackBar.open("Query failed",null,{duration:2e3})}})}debugStream(t,n=25){t.Error?this.showStreamErrorResult(t):0!==t.Count&&(this.snackBar.open("Running stream..."),this.queryDefinitionService.debugStream(this.pipelineModel$.value.Pipeline.EntityId,t.Source,t.SourceOut,n).subscribe({next:s=>{this.snackBar.open("Stream worked",null,{duration:2e3});const r=this.pipelineModel$.value.DataSources.find(p=>p.EntityGuid===t.Source);this.showQueryResult(s,n,{name:t.SourceOut,source:t.Source,sourceName:r.Name,original:t}),console.warn(s)},error:s=>{this.snackBar.open("Stream failed",null,{duration:2e3})}}))}fetchPipeline(t,n,i){i&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId,this.dataSources$.value).subscribe(s=>{i&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.titleService.setTitle(`${s.Pipeline.Name} - Visual Query`),t&&this.pipelineModel$.next(s),n&&this.calculateDataSourceConfigs(s.DataSources)})}showQueryResult(t,n,i){this.dialog.open(Se,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:t,debugStream:i,top:n},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}showStreamErrorResult(t){this.dialog.open(Ee,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:t.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}fetchDataSources(t){this.queryDefinitionService.fetchDataSources().subscribe(n=>{this.dataSources$.next(n),t()})}attachKeyboardSave(){this.zone.runOutsideAngular(()=>{this.subscriptions.add((0,ne.R)(window,"keydown").pipe((0,V.p)(()=>!this.route.snapshot.firstChild),(0,V.p)(t=>(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83===t.keyCode)).subscribe(t=>{t.preventDefault(),this.zone.run(()=>{this.savePipeline()})}))})}static#e=this.\u0275fac=function(n){return new(n||o)(e.KVO(D.Ix),e.KVO(D.nX),e.KVO(N),e.KVO(De.hE),e.KVO(xe.UG),e.KVO(E.bZ),e.KVO(e.c1b),e.KVO(e.SKi),e.KVO(oe.T),e.KVO(ie.g),e.KVO(e.gRc))};static#t=this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}return o})();const O={App:{Name:"App",Label:"App DataSources",Icon:"star",UiHint:"DataSources from the current App"},Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function Re(o,a){const t={};for(const n of o){let i;const s=a.find(r=>r.PartAssemblyAndType===n.PartAssemblyAndType);s&&(i={...s.PrimaryType?O[s.PrimaryType]:O.Unknown},null!=s.Icon&&(i.Icon=s.Icon),null!=s.DynamicIn&&(i.DynamicIn=s.DynamicIn),null!=s.DynamicOut&&(i.DynamicOut=s.DynamicOut),null!=s.HelpLink&&(i.HelpLink=s.HelpLink),null!=s.EnableConfig&&(i.EnableConfig=s.EnableConfig),null!=s.UiHint&&(i.UiHint=s.UiHint)),i||(i={...O.Unknown}),t[n.EntityGuid]=i}return t}var _=c(4456),M=c(8827),ke=c(3037),Fe=c(1817),L=c(5060),B=c(5175),H=c(7984),w=c(5944),Pe=c(3758),Te=c(9333);const Y=o=>({active:o});function Me(o,a){1&o&&(e.j41(0,"app-field-hint"),e.EFF(1," You will get suggestions for out-streams after you run query "),e.k0s())}function $e(o,a){1&o&&(e.j41(0,"app-field-hint",12),e.EFF(1," This field is required "),e.k0s()),2&o&&e.Y8G("isError",!0)}function Ie(o,a){if(1&o&&(e.j41(0,"mat-form-field",10)(1,"mat-label"),e.EFF(2,"Label"),e.k0s(),e.nrm(3,"input",11),e.k0s(),e.DNE(4,Me,2,0,"app-field-hint")(5,$e,2,1,"app-field-hint",12)),2&o){const t=e.XpG();e.R7$(4),e.vxM(4,t.isSource&&!t.pipelineResultExists?4:-1),e.R7$(),e.vxM(5,t.controls.label.touched&&null!=t.controls.label.errors&&t.controls.label.errors.required?5:-1)}}function je(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.SpI(" ",t.name," ")}}function Oe(o,a){if(1&o&&(e.j41(0,"mat-form-field",10)(1,"mat-label"),e.EFF(2,"Scope"),e.k0s(),e.j41(3,"mat-select",18),e.Z7z(4,je,2,2,"mat-option",19,e.fX1),e.k0s()(),e.j41(6,"app-field-hint"),e.EFF(7," The scope should almost never be changed - "),e.j41(8,"a",20),e.EFF(9,"see help"),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(3),e.Y8G("placeholder",t.scopeOptions.length?"":"No items found"),e.R7$(),e.Dyx(t.scopeOptions)}}function we(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function Ge(o,a){if(1&o&&(e.j41(0,"mat-select",13),e.Z7z(1,we,2,2,"mat-option",19,e.fX1),e.k0s()),2&o){const t=e.XpG(2);e.Y8G("placeholder",t.labelOptions.length?"":"No items found"),e.R7$(),e.Dyx(t.labelOptions)}}function Ne(o,a){1&o&&e.nrm(0,"input",11)}function Ae(o,a){1&o&&(e.j41(0,"app-field-hint",12),e.EFF(1," This field is required "),e.k0s()),2&o&&e.Y8G("isError",!0)}function Xe(o,a){if(1&o){const t=e.RV6();e.DNE(0,Oe,10,1),e.j41(1,"mat-form-field",10)(2,"mat-label"),e.EFF(3,"Label"),e.k0s(),e.DNE(4,Ge,3,1,"mat-select",13)(5,Ne,1,0,"input",11),e.j41(6,"div",14)(7,"button",15),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleGuidedLabel(!0))}),e.j41(8,"mat-icon",16),e.EFF(9,"search"),e.k0s()(),e.j41(10,"button",17),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleGuidedLabel(!1))}),e.j41(11,"mat-icon",16),e.EFF(12,"text_fields"),e.k0s()()()(),e.DNE(13,Ae,2,1,"app-field-hint",12)}if(2&o){const t=e.XpG();e.vxM(0,t.advancedMode&&t.guidedLabel?0:-1),e.R7$(4),e.vxM(4,t.guidedLabel?4:-1),e.R7$(),e.vxM(5,t.guidedLabel?-1:5),e.R7$(2),e.Y8G("ngClass",e.eq3(6,Y,t.guidedLabel)),e.R7$(3),e.Y8G("ngClass",e.eq3(8,Y,!t.guidedLabel)),e.R7$(3),e.vxM(13,t.controls.label.touched&&null!=t.controls.label.errors&&t.controls.label.errors.required?13:-1)}}function Qe(o,a){if(1&o){const t=e.RV6();e.j41(0,"mat-slide-toggle",21),e.bIt("change",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.toggleAdvancedMode(i))}),e.EFF(1),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("checked",t.advancedMode),e.R7$(),e.SpI(" ",t.advancedMode?"Advanced":"Simple"," ")}}let Ue=(()=>{class o extends T.${constructor(t,n,i,s,r){super(),this.dialogData=t,this.dialogRef=n,this.visualQueryService=i,this.contentTypesService=s,this.changeDetectorRef=r,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.pipelineResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1}ngOnInit(){this.buildForm()}ngOnDestroy(){super.ngOnDestroy()}closeDialog(t){this.dialogRef.close(t)}toggleGuidedLabel(t){this.guidedLabel=t}toggleAdvancedMode(t){this.advancedMode=t.checked}rename(){const t=this.form.getRawValue();this.closeDialog(t.label)}buildForm(){this.form=new _.J3({label:new _.hs(this.dialogData.label,_.k0.required),scope:new _.hs(m.YX.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscriptions.add(this.controls.scope.valueChanges.pipe((0,ke.Z)(this.controls.scope.value),(0,Fe.F)()).subscribe(t=>{this.labelOptions=Object.values(this.visualQueryService.pipelineResult.Sources).find(n=>n.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(n=>n.Scope===t).map(n=>n.Name),!this.labelOptions.includes(this.controls.label.value)&&null!=this.controls.label.value&&this.controls.label.patchValue(null)})),this.contentTypesService.getScopes().subscribe(t=>{const n=Object.values(this.visualQueryService.pipelineResult.Sources).find(s=>s.Guid===this.dialogData.pipelineDataSourceGuid).Out,i=t.filter(s=>n.some(r=>r.Scope===s.value));this.scopeOptions=i,this.changeDetectorRef.markForCheck()}))}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(E.Vh),e.rXU(E.CP),e.rXU(P),e.rXU(x.gs),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(n,i){2&n&&e.Mr5("className",i.hostClass)},standalone:!0,features:[e.Vt3,e.aNF],decls:19,vars:5,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"formGroup"],[1,"eav-dialog-actions"],["color","accent",3,"checked"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],["color","accent",1,"eav-mat-form-field"],["matInput","","type","text","formControlName","label","required",""],[3,"isError"],["formControlName","label","required","",3,"placeholder"],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"click","ngClass"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"click","ngClass"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["color","accent",3,"change","checked"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3,"Rename stream"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return i.closeDialog()}),e.j41(5,"mat-icon"),e.EFF(6,"close"),e.k0s()()(),e.j41(7,"div",4)(8,"form",5),e.DNE(9,Ie,6,2)(10,Xe,14,10),e.k0s()(),e.j41(11,"mat-dialog-actions",6)(12,"div"),e.DNE(13,Qe,2,2,"mat-slide-toggle",7),e.k0s(),e.j41(14,"div")(15,"button",8),e.bIt("click",function(){return i.closeDialog()}),e.EFF(16,"Cancel"),e.k0s(),e.j41(17,"button",9),e.bIt("click",function(){return i.rename()}),e.EFF(18," Rename "),e.k0s()()()()),2&n&&(e.R7$(8),e.Y8G("formGroup",i.form),e.R7$(),e.vxM(9,i.isSource&&i.pipelineResultExists?-1:9),e.R7$(),e.vxM(10,i.isSource&&i.pipelineResultExists?10:-1),e.R7$(3),e.vxM(13,i.isSource&&i.pipelineResultExists?13:-1),e.R7$(4),e.Y8G("disabled",!i.form.valid))},dependencies:[y.Hl,y.$z,y.iY,g.m_,g.An,_.YN,_.qT,_.me,_.BC,_.cb,_.YS,_.X1,_.j4,_.JD,w.RG,w.rl,w.nJ,w.yw,H.fS,H.fg,B.Ve,B.VO,L.wT,L.Sy,v.YU,E.E7,M.mV,M.sG,Pe.F,Te.c]})}return o})();var z=c(3472);const h="dataSource_";class He{constructor(a,t,n,i,s,r,l,p,d){this.jsPlumbRoot=a,this.pipelineModel=t,this.dataSources=n,this.onConnectionsChanged=i,this.onDragend=s,this.onDebugStream=r,this.dialog=l,this.viewContainerRef=p,this.changeDetectorRef=d,this.log=new z.B("Plumber",!1),this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(()=>{this.initDomDataSources(),this.initWirings(),this.bindEvents()}),this.instance.repaintEverything()}destroy(){this.dialogRef?.close(),this.instance.reset(),this.instance.unbindContainer()}removeEndpointsOnDataSource(a){const t=h+a;this.bulkDelete=!0,this.instance.batch(()=>{this.instance.selectEndpoints({element:t}).delete()}),this.bulkDelete=!1}getAllConnections(){return this.instance.getAllConnections().map(t=>({From:t.sourceId.replace(h,""),Out:t.endpoints[0].getOverlay("endpointLabel").label,To:t.targetId.replace(h,""),In:t.endpoints[1].getOverlay("endpointLabel").label}))}getStreamsOut(){const a=[];return this.instance.selectEndpoints({target:h+"Out"}).each(n=>{a.push(n.getOverlay("endpointLabel").label)}),a.join(",")}putEntityCountOnConnections(a){a.Streams?.forEach(t=>{const n=h+t.Source,s=["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(t.Target)?h+"Out":h+t.Target,r=n+"_out_"+t.SourceOut,l=s+"_in_"+t.TargetIn;this.instance.getEndpoint(r)?.connections?.filter(d=>d.endpoints[1].getUuid()===l)?.forEach(d=>{const u=t.Error?"":t.Count.toString();d.setLabel({label:u,cssClass:"streamEntitiesCount "+(t.Error?"streamEntitiesError":""),events:{click:C=>{this.pipelineModel.Pipeline.AllowEdit&&this.onDebugStream(t)}}})})})}nextLinePaintStyle(a){return this.uuidColorMap[a]||(this.uuidColorMap[a]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))}getInstanceDefaults(a){return{Container:a,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}initDomDataSources(){const a=this.log.fnCond(!1,"initDomDataSources");for(const t of this.pipelineModel.DataSources){const n=this.jsPlumbRoot.querySelector("#"+h+t.EntityGuid);if(!n)continue;const i=this.dataSources.find(l=>l.PartAssemblyAndType===t.PartAssemblyAndType);if(!i)continue;this.pipelineModel.Pipeline.AllowEdit&&this.instance.draggable(n,{grid:[20,20],stop:l=>{const d=l.el.id.replace(h,""),u={Top:l.finalPos[1],Left:l.finalPos[0]};setTimeout(()=>{this.onDragend(d,u)})}});const s=i.Out?.length??0;a.a("dataSource.Out",{outCount:s,out:i.Out}),i.Out?.forEach(l=>{this.addEndpoint(n,l,!1,t,s)});const r=i.In?.length??0;if(a.a("dataSource.In",{inCount:r,in:i.In}),i.In?.forEach(l=>{this.addEndpoint(n,l,!0,t,r)}),i.In){const l=this.buildTargetEndpoint(t.EntityGuid);l.maxConnections=-1,this.instance.makeTarget(n,l)}i.DynamicOut&&this.instance.makeSource(n,this.buildSourceEndpoint(t.EntityGuid),{filter:".add-endpoint"})}a.end()}initWirings(){const a=this.log.fn("initWirings"),t=this.pipelineModel.Pipeline.StreamWiring;if(!t)return a.end(null,"no wirings");const n=J(t,s=>s.To),i=J(t,s=>s.From);a.values({inGroups:n,outGroups:i}),t.forEach(s=>{const r=h+s.From,l=r+"_out_"+s.Out,p=h+s.To,d=p+"_in_"+s.In;if(!this.instance.getEndpoint(l)){const u=this.jsPlumbRoot.querySelector("#"+r);if(!u)return;const f=u.id.replace(h,""),C=this.pipelineModel.DataSources.find(k=>k.EntityGuid===f);this.addEndpoint(u,s.Out,!1,C,i[s.From].length)}if(!this.instance.getEndpoint(d)){const u=this.jsPlumbRoot.querySelector("#"+p);if(!u)return;const f=u.id.replace(h,""),C=this.pipelineModel.DataSources.find(k=>k.EntityGuid===f);this.addEndpoint(u,s.In,!0,C,n[s.To].length)}try{this.instance.connect({uuids:[l,d],paintStyle:this.nextLinePaintStyle(l)})}catch{console.error({message:"Connection failed",from:l,to:d})}}),a.end()}addEndpoint(a,t,n,i,s=0){const r=this.log.fnCond(!1,"addEndpoint",{endpointName:t,isIn:n,pipelineDataSource:i}),l=this.dataSources.find(G=>G.PartAssemblyAndType===i.PartAssemblyAndType),p=n?l.In:l.Out,d=p?.some(G=>this.getEndpointInfo(G,!1)),u=this.getEndpointInfo(t,d);let f;r.a(`endpointInfo ${s}`,{dataSource:l,connectionList:p,isDynamic:d,count:s,endpointInfo:u}),f=d?"dynamic":u.required?this.pipelineModel.Pipeline.StreamWiring?.some(K=>h+K.To===a.id&&K.In===u.name)?"":"required":"";const C=a.id+(n?"_in_":"_out_")+u.name,k=s>3,Ot=n?this.buildTargetEndpoint(i.EntityGuid,f):this.buildSourceEndpoint(i.EntityGuid,f),Q=this.instance.addEndpoint(a,Ot,{uuid:C,enabled:this.pipelineModel.Pipeline.AllowEdit||i.EntityGuid===m.YX.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel");Q.setLabel(u.name),k&&Q.addClass("angled"),r.end({count:s,angled:k,overlay:Q},"end")}buildSourceEndpoint(a,t){return{paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint "+t,maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(!0),events:{click:s=>{this.onChangeLabel(s,!0,a)}}}}buildTargetEndpoint(a,t){return{paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint "+(t??" "),maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:s=>{this.onChangeLabel(s,!1,a)}}}}getEndpointOverlays(a){return[["Label",{id:"endpointLabel",location:[.5,a?0:1],label:"Default",cssClass:a?"endpointSourceLabel":"endpointTargetLabel"}]]}onChangeLabel(a,t,n){if(!this.pipelineModel.Pipeline.AllowEdit)return;const i=a.getOverlay?a.getOverlay("endpointLabel"):a;this.dialogRef=this.dialog.open(Ue,{autoFocus:!1,data:{pipelineDataSourceGuid:n,isSource:t,label:i.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.dialogRef.afterClosed().subscribe(r=>{r&&(i.setLabel(r),setTimeout(()=>{this.onConnectionsChanged()}))}),this.changeDetectorRef.markForCheck()}bindEvents(){this.instance.bind("connectionDetached",a=>{if(this.bulkDelete)return;const t=a.target,n=this.pipelineModel.DataSources.find(l=>l.EntityGuid===t.id.replace(h,"")),i=this.dataSources.find(l=>l.PartAssemblyAndType===n.PartAssemblyAndType),s=a.targetEndpoint.getOverlay("endpointLabel").label;i.In.some(l=>this.getEndpointInfo(l,!1).name===s)||this.instance.deleteEndpoint(a.targetEndpoint),setTimeout(()=>{this.onConnectionsChanged()})}),this.instance.bind("connection",a=>{if(a.sourceId===a.targetId)return void setTimeout(()=>{this.instance.deleteConnection(a.connection,{fireEvent:!1}),setTimeout(()=>{this.onConnectionsChanged()})});const t=a.targetEndpoint.getOverlay("endpointLabel"),n=t.getLabel();this.instance.getEndpoints(a.target.id).some(r=>r.getOverlay("endpointLabel").getLabel()===n&&a.targetEndpoint.id!==r.id&&r.canvas.classList.contains("targetEndpoint"))&&t.setLabel(`PleaseRename${Math.floor(99999*Math.random())}`),setTimeout(()=>{this.onConnectionsChanged()})})}getEndpointInfo(a,t){let n,i;if(t)n=a,i=!1;else{const r=a.trim();i=r.endsWith("*"),n=i?r.substring(0,r.length-1):r}return{name:n,required:i}}}const J=(o,a)=>o.reduce((t,n)=>((t[a(n)]||=[]).push(n),t),{});var Ye=c(1459),ze=c(402);const Je=["domRoot"],We=["domDataSource"],Ze=(o,a,t)=>({top:o,left:a,"min-width":t}),Ke=o=>({"show-details":o});function qe(o,a){if(1&o){const t=e.RV6();e.j41(0,"mat-icon",16),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,s=e.XpG(3);return e.Njj(s.configureDataSource(i))}),e.EFF(1," settings "),e.k0s()}}function et(o,a){if(1&o){const t=e.RV6();e.j41(0,"mat-icon",17),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,s=e.XpG(2),r=e.XpG();return e.Njj(r.openHelp(s.typeInfos[i.EntityGuid].HelpLink))}),e.EFF(1," help_outline "),e.k0s()}}function tt(o,a){if(1&o){const t=e.RV6();e.j41(0,"mat-icon",18),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,s=e.XpG(3);return e.Njj(s.remove(i))}),e.EFF(1," delete "),e.k0s()}}function nt(o,a){if(1&o&&(e.j41(0,"tr",21)(1,"td",22),e.EFF(2),e.k0s(),e.j41(3,"td",23),e.EFF(4),e.k0s()()),2&o){const t=a.$implicit;e.R7$(),e.Y8G("title",t.name),e.R7$(),e.JRh(t.name),e.R7$(),e.Y8G("title",t.value),e.R7$(),e.JRh(t.value)}}function it(o,a){if(1&o&&(e.nrm(0,"hr",19),e.j41(1,"table",20),e.Z7z(2,nt,5,4,"tr",21,e.fX1),e.k0s()),2&o){const t=e.XpG().$implicit,n=e.XpG(2);e.R7$(2),e.Dyx(n.dataSourceConfigs[t.EntityId])}}function ot(o,a){1&o&&e.nrm(0,"div",14)}function st(o,a){1&o&&e.nrm(0,"div",15)}function at(o,a){if(1&o){const t=e.RV6();e.j41(0,"div",3,1)(2,"div",4)(3,"mat-icon",5),e.EFF(4),e.k0s(),e.DNE(5,qe,2,0,"mat-icon",6)(6,et,2,0,"mat-icon",7),e.k0s(),e.j41(7,"div",8),e.DNE(8,tt,2,0,"mat-icon",9),e.k0s(),e.j41(9,"div",10),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2),r=e.XpG();return e.Njj(s.allowEdit&&r.editName(i))}),e.j41(10,"span"),e.EFF(11),e.k0s(),e.j41(12,"mat-icon",11),e.EFF(13,"edit"),e.k0s()(),e.nrm(14,"br"),e.j41(15,"div",12),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2),r=e.XpG();return e.Njj(s.allowEdit&&r.editDescription(i))}),e.j41(16,"span"),e.EFF(17),e.k0s(),e.j41(18,"mat-icon",11),e.EFF(19,"edit"),e.k0s()(),e.nrm(20,"br"),e.DNE(21,it,4,0),e.j41(22,"div",13),e.EFF(23),e.k0s(),e.DNE(24,ot,1,0,"div",14)(25,st,1,0,"div",15),e.k0s()}if(2&o){const t=a.$implicit,n=e.XpG(2),i=e.XpG();e.Y8G("id",i.dataSrcIdPrefix+t.EntityGuid)("ngStyle",e.sMw(15,Ze,t.VisualDesignerData.Top+"px",t.VisualDesignerData.Left+"px",t.VisualDesignerData.Width?t.VisualDesignerData.Width+"px":null))("ngClass",e.eq3(19,Ke,n.showDataSourceDetails&&(null==n.dataSourceConfigs[t.EntityId]?null:n.dataSourceConfigs[t.EntityId].length))),e.R7$(3),e.Y8G("title",n.typeInfos[t.EntityGuid].UiHint),e.R7$(),e.SpI(" ",n.typeInfos[t.EntityGuid].Icon," "),e.R7$(),e.vxM(5,n.allowEdit&&n.typeInfos[t.EntityGuid].EnableConfig?5:-1),e.R7$(),e.vxM(6,n.typeInfos[t.EntityGuid].HelpLink?6:-1),e.R7$(2),e.vxM(8,n.allowEdit&&!i.isOutDataSource(t)?8:-1),e.R7$(3),e.JRh(t.Name||"(no name)"),e.R7$(6),e.JRh(t.Description),e.R7$(4),e.vxM(21,n.showDataSourceDetails&&null!=n.dataSourceConfigs[t.EntityId]&&n.dataSourceConfigs[t.EntityId].length?21:-1),e.R7$(),e.Y8G("title",t.PartAssemblyAndType),e.R7$(),e.SpI(" Type: ",i.getTypeName(t.PartAssemblyAndType)," "),e.R7$(),e.vxM(24,n.allowEdit&&n.typeInfos[t.EntityGuid].DynamicOut?24:-1),e.R7$(),e.vxM(25,n.allowEdit&&n.typeInfos[t.EntityGuid].DynamicIn?25:-1)}}function rt(o,a){if(1&o&&e.Z7z(0,at,26,21,"div",3,e.fX1),2&o){const t=e.XpG();e.Dyx(t.pipelineDataSources)}}function lt(o,a){if(1&o&&(e.j41(0,"div",2,0),e.DNE(2,rt,2,0),e.k0s()),2&o){const t=e.XpG();e.R7$(2),e.vxM(2,t.hardReset?-1:2)}}let W=(()=>{class o extends T.${constructor(t,n,i,s,r){super(new z.B("PlumbEditorComponent",!1)),this.visualQueryService=t,this.queryDefinitionService=n,this.changeDetectorRef=i,this.dialog=s,this.viewContainerRef=r,this.dataSrcIdPrefix=h,this.hardReset=!1,this.scriptLoaded$=new b.t(!1)}ngOnInit(){(0,U.P)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],()=>{this.scriptLoaded$.next(!0)}),this.subscriptions.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(n=>{this.plumber.putEntityCountOnConnections(n)}));const t=this.visualQueryService.pipelineModel$.pipe((0,S.T)(n=>X.i.tryParse(n?.Pipeline.VisualDesignerData)??{}),(0,ze.A)(n=>n));this.viewModel$=(0,F.z)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$,t,this.visualQueryService.dataSourceConfigs$]).pipe((0,S.T)(([n,i,s,r])=>null==n||null==i?void 0:(this.hardReset=!0,this.changeDetectorRef.detectChanges(),this.hardReset=!1,{pipelineDataSources:n.DataSources,typeInfos:Re(n.DataSources,i),allowEdit:n.Pipeline.AllowEdit,showDataSourceDetails:s.ShowDataSourceDetails??!1,dataSourceConfigs:r})))}ngAfterViewInit(){const t=this.log.fn("ngAfterViewInit"),n=this.domDataSourcesRef.changes.pipe((0,S.T)(()=>!0));this.subscriptions.add((0,F.z)([this.scriptLoaded$,n]).subscribe(([i,s])=>{!i||!s||(this.log.a("scriptLoaded and domDataSourcesLoaded",{scriptLoaded:i,domDataSourcesLoaded:s}),this.plumber?.destroy(),this.plumber=new He(this.domRootRef.nativeElement,this.visualQueryService.pipelineModel$.value,this.visualQueryService.dataSources$.value,this.onConnectionsChanged.bind(this),this.onDragend.bind(this),this.onDebugStream.bind(this),this.dialog,this.viewContainerRef,this.changeDetectorRef))})),t.end()}ngOnDestroy(){this.plumber?.destroy(),this.scriptLoaded$.complete(),super.ngOnDestroy()}onConnectionsChanged(){const t=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(t,n)}onDragend(t,n){this.visualQueryService.changeDataSourcePosition(t,n)}onDebugStream(t){this.visualQueryService.debugStream(t)}configureDataSource(t){t.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(t)}getTypeName(t){const n=this.visualQueryService.dataSources$.value.find(i=>i.PartAssemblyAndType===t);return this.queryDefinitionService.typeNameFilter(n?.TypeNameForUi||t,"className")}isOutDataSource(t){return t.PartAssemblyAndType===m.YX.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(t){if(!confirm(`Delete ${t.Name} data source?`))return;this.plumber.removeEndpointsOnDataSource(t.EntityGuid);const n=this.plumber.getAllConnections(),i=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(t.EntityGuid,n,i)}openHelp(t){window.open(t,"_blank")}editName(t){const n=prompt("Rename data source",t.Name)?.trim();null==n||""===n||this.visualQueryService.renameDataSource(t.EntityGuid,n)}editDescription(t){const n=prompt("Edit description",t.Description)?.trim();null!=n&&this.visualQueryService.changeDataSourceDescription(t.EntityGuid,n)}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(P),e.rXU(N),e.rXU(e.gRc),e.rXU(E.bZ),e.rXU(e.c1b))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-plumb-editor"]],viewQuery:function(n,i){if(1&n&&(e.GBs(Je,5),e.GBs(We,5)),2&n){let s;e.mGM(s=e.lsd())&&(i.domRootRef=s.first),e.mGM(s=e.lsd())&&(i.domDataSourcesRef=s)}},standalone:!0,features:[e.Vt3,e.aNF],decls:2,vars:3,consts:[["domRoot",""],["domDataSource",""],["id","pipeline-root"],[1,"dataSource",3,"id","ngStyle","ngClass"],[1,"actions","left"],[1,"type-info",3,"title"],["title","Configure data source","appMousedownStopPropagation","",1,"configure"],["title","Help for this data source","appMousedownStopPropagation","",1,"help"],[1,"actions","right"],["title","Delete","appMousedownStopPropagation","",1,"delete"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"]],template:function(n,i){if(1&n&&(e.DNE(0,lt,3,1,"div",2),e.nI1(1,"async")),2&n){let s;e.vxM(0,(s=e.bMT(1,1,i.viewModel$))?0:-1,s)}},dependencies:[v.B3,v.YU,g.m_,g.An,v.Jj,Ye.z],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}\n\n/*# sourceMappingURL=https://sources.2sxc.org/18.00.01/dist/ng-edit/C:/Projects/2sxc/eav-ui/projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.component.ts-angular-inline--1.css.map*/"]})}return o})();var mt=c(4981),ht=c(4601);function ft(o,a){if(1&o){const t=e.RV6();e.j41(0,"div",7),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(4);return e.Njj(s.addDataSource(i))}),e.j41(1,"mat-icon"),e.EFF(2),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s()()}if(2&o){const t=a.$implicit,n=e.XpG(4);e.Y8G("tippy",t.UiHint||t.Name),e.R7$(2),e.JRh(t.Icon||n.guiTypes.Unknown.Icon),e.R7$(2),e.JRh(t.Name)}}function gt(o,a){if(1&o&&(e.j41(0,"div",5),e.Z7z(1,ft,5,3,"div",6,e.BUC().trackDataSources,!0),e.k0s()),2&o){const t=e.XpG().$implicit;e.R7$(),e.Dyx(t.value)}}function _t(o,a){if(1&o){const t=e.RV6();e.j41(0,"div",4),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.toggleItem(i.key))}),e.j41(1,"mat-icon"),e.EFF(2),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s()(),e.DNE(5,gt,3,0,"div",5)}if(2&o){let t;const n=a.$implicit,i=e.XpG(2);e.Y8G("tippy",i.guiTypes[n.key].UiHint||n.key),e.R7$(2),e.JRh(i.guiTypes[n.key].Icon||i.guiTypes.Unknown.Icon),e.R7$(2),e.JRh(null!==(t=null!==(t=i.guiTypes[n.key].Label)&&void 0!==t?t:i.guiTypes[n.key].Name)&&void 0!==t?t:n.key),e.R7$(),e.vxM(5,i.toggledItems.includes(n.key)?5:-1)}}function yt(o,a){if(1&o){const t=e.RV6();e.j41(0,"div",0)(1,"div",1)(2,"span",2),e.EFF(3,"Show Advanced"),e.k0s(),e.j41(4,"mat-slide-toggle",3),e.bIt("change",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.toggleDifficulty(i))}),e.k0s()(),e.Z7z(5,_t,6,4,null,null,e.BUC().trackGroups,!0),e.nI1(7,"keyvalue"),e.k0s()}2&o&&(e.R7$(5),e.Dyx(e.bMT(7,0,a.sorted)))}let vt=(()=>{class o{constructor(t){this.visualQueryService=t,this.toggledItems=[],this.guiTypes=O,this.difficulties=m.YX.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new b.t(this.difficulties.default)}ngOnInit(){this.viewModel$=(0,F.z)([(0,F.z)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,S.T)(([t,n])=>function pt(o,a){if(!o)return;const n=(0,R.A)(o).filter(s=>s.Difficulty<=a&&s.PartAssemblyAndType!==m.YX.pipelineDesigner.outDataSource.PartAssemblyAndType);n.sort((s,r)=>s.Name.toLocaleLowerCase().localeCompare(r.Name.toLocaleLowerCase()));const i={};for(const s of n){const r=s.PrimaryType;i[r]?i[r].push(s):i[r]=[s]}return i}(t,n)))]).pipe((0,S.T)(([t])=>({sorted:t})))}ngOnDestroy(){this.difficulty$.complete()}toggleDifficulty(t){this.difficulty$.next(t.checked?this.difficulties.advanced:this.difficulties.default)}addDataSource(t){this.visualQueryService.addDataSource(t)}toggleItem(t){mt.f.toggleInArray(t,this.toggledItems)}trackGroups(t,n){return n.key}trackDataSources(t,n){return n.PartAssemblyAndType}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(P))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-add-explorer"]],standalone:!0,features:[e.aNF],decls:2,vars:3,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"eav-show-advanced"],[1,"eav-slide-toggle-label"],["color","primary",3,"change"],["tippyShowDelay","750",1,"collapsible",3,"click","tippy"],[1,"list"],["tippyShowDelay","750",1,"list-item",3,"tippy"],["tippyShowDelay","750",1,"list-item",3,"click","tippy"]],template:function(n,i){if(1&n&&(e.DNE(0,yt,8,2,"div",0),e.nI1(1,"async")),2&n){let s;e.vxM(0,(s=e.bMT(1,1,i.viewModel$))?0:-1,s)}},dependencies:[M.mV,M.sG,g.m_,g.An,v.Jj,v.lG,ht.e],styles:[".mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}.eav-show-advanced[_ngcontent-%COMP%]{margin-left:8px}"]})}return o})();var Ct=c(1961);function St(o,a){if(1&o&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.R7$(),e.SpI(" ",t," ")}}function Et(o,a){if(1&o&&(e.j41(0,"ul",9),e.Z7z(1,St,2,1,"li",null,e.fX1),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Dyx(null==t.Pipeline.Params?null:t.Pipeline.Params.split("\n"))}}function Dt(o,a){if(1&o&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.R7$(),e.SpI(" ",t," ")}}function xt(o,a){if(1&o&&(e.j41(0,"ul",9),e.Z7z(1,Dt,2,1,"li",null,e.fX1),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Dyx(null==t.Pipeline.TestParameters?null:t.Pipeline.TestParameters.split("\n"))}}function Rt(o,a){if(1&o){const t=e.RV6();e.j41(0,"div",5)(1,"span",12),e.EFF(2,"Show DataSource Params"),e.k0s(),e.j41(3,"mat-slide-toggle",13),e.bIt("change",function(i){e.eBV(t);const s=e.XpG(2);return e.Njj(s.showDataSourceDetails(i))}),e.k0s()()}2&o&&(e.R7$(3),e.Y8G("checked",a.ShowDataSourceDetails))}function kt(o,a){1&o&&e.nrm(0,"li",16),2&o&&e.Y8G("innerHTML",a.$implicit,e.npT)}function Ft(o,a){if(1&o&&(e.j41(0,"div",14)(1,"div",6)(2,"span"),e.EFF(3,"Warnings"),e.k0s(),e.j41(4,"mat-icon",15),e.EFF(5,"warning"),e.k0s()(),e.j41(6,"ol",9),e.Z7z(7,kt,1,1,"li",16,e.fX1),e.k0s()()),2&o){const t=e.XpG();e.R7$(7),e.Dyx(t)}}function Pt(o,a){1&o&&e.DNE(0,Ft,9,0,"div",14),2&o&&e.vxM(0,a.length?0:-1)}function Tt(o,a){if(1&o&&(e.j41(0,"div",10)(1,"div",6),e.EFF(2,"Query Description"),e.k0s(),e.j41(3,"div"),e.EFF(4),e.k0s()()),2&o){const t=e.XpG();e.R7$(4),e.JRh(t.Pipeline.Description)}}function Mt(o,a){if(1&o){const t=e.RV6();e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.saveAndRunQuery(!0,!0))}),e.EFF(4," Save and run "),e.k0s(),e.j41(5,"button",4),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.saveAndRunQuery(!1,!0))}),e.EFF(6," Run "),e.k0s(),e.j41(7,"button",4),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.saveAndRunQuery(!0,!1))}),e.EFF(8," Save "),e.k0s()(),e.j41(9,"div",5)(10,"div",6)(11,"div"),e.EFF(12,"Query Parameters"),e.k0s(),e.j41(13,"div")(14,"button",7),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.editPipeline())}),e.j41(15,"mat-icon"),e.EFF(16,"edit"),e.k0s()(),e.j41(17,"button",8),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openParamsHelp())}),e.j41(18,"mat-icon"),e.EFF(19,"info"),e.k0s()()()(),e.DNE(20,Et,3,0,"ul",9),e.k0s(),e.j41(21,"div",5)(22,"div",6),e.EFF(23,"Test Parameters"),e.k0s(),e.DNE(24,xt,3,0,"ul",9),e.k0s(),e.DNE(25,Rt,4,1,"div",5),e.nI1(26,"async"),e.DNE(27,Pt,1,1),e.nI1(28,"async"),e.DNE(29,Tt,5,1,"div",10),e.j41(30,"div",11)(31,"button",4),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openRestApi())}),e.j41(32,"span"),e.EFF(33,"Use in JSON / REST API"),e.k0s(),e.j41(34,"mat-icon"),e.EFF(35,"code_curly"),e.k0s()()()()()}if(2&o){let t,n;const i=a,s=e.XpG();e.R7$(20),e.vxM(20,null!=i.Pipeline.Params&&i.Pipeline.Params.length?20:-1),e.R7$(4),e.vxM(24,null!=i.Pipeline.TestParameters&&i.Pipeline.TestParameters.length?24:-1),e.R7$(),e.vxM(25,(t=e.bMT(26,5,s.visualDesignerData$))?25:-1,t),e.R7$(2),e.vxM(27,(n=e.bMT(28,7,s.warnings$))?27:-1,n),e.R7$(2),e.vxM(29,i.Pipeline.Description?29:-1)}}let $t=(()=>{class o{constructor(t,n,i,s){this.router=t,this.route=n,this.context=i,this.visualQueryService=s}ngOnInit(){this.pipelineModel$=this.visualQueryService.pipelineModel$.asObservable(),this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,S.T)(t=>function bt(o,a){const t=[];try{const n=o.Pipeline.Params?.split(/\r?\n/)||[],i=o.Pipeline.TestParameters?.split(/\r?\n/)||[];n.forEach(s=>{s=s?.trim(),s&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(s)||t.push(`\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        `))}),i.forEach(s=>{if(s=s?.trim(),!s)return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(s)||t.push(`\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>${s}</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        `);const d=/^\[module:id\]=([0-9]*)$/gim.exec(s);if(d){const C=d[1],k=a.moduleId?.toString();C!==k&&t.push(`\n            Your test ModuleId (${C}) is different from the current ModuleId (${k}).<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          `)}/^\[module:moduleid\]=([0-9]*)$/gim.exec(s)&&t.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")})}catch(n){console.error("Something went wrong in calculateWarnings for params",n)}return t}(t,this.context))),this.visualDesignerData$=this.visualQueryService.pipelineModel$.pipe((0,S.T)(t=>X.i.tryParse(t.Pipeline.VisualDesignerData)??{}))}editPipeline(){this.visualQueryService.editPipelineEntity()}openParamsHelp(){window.open("https://go.2sxc.org/QueryParams","_blank")}saveAndRunQuery(t,n){this.visualQueryService.saveAndRun(t,n)}showDataSourceDetails(t){this.visualQueryService.showDataSourceDetails(t.checked)}openRestApi(){this.router.navigate([Ct.N5.getUrlQueryDialog(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)],{relativeTo:this.route})}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(D.Ix),e.rXU(D.nX),e.rXU($.o),e.rXU(P))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-run-explorer"]],standalone:!0,features:[e.aNF],decls:2,vars:3,consts:[[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],[1,"values"],[1,"description"],[1,"footer-actions"],[1,"eav-slide-toggle-label"],["color","primary",3,"change","checked"],[1,"warnings"],[2,"color","red"],[3,"innerHTML"]],template:function(n,i){if(1&n&&(e.DNE(0,Mt,36,9,"div",0),e.nI1(1,"async")),2&n){let s;e.vxM(0,(s=e.bMT(1,1,i.pipelineModel$))?0:-1,s)}},dependencies:[y.Hl,y.$z,y.iY,g.m_,g.An,M.mV,M.sG,v.Jj],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}.eav-slide-toggle-label[_ngcontent-%COMP%]{margin-right:4px;font-size:14px}"]})}return o})();var It=c(4096);const Z=o=>({active:o});let jt=(()=>{class o{constructor(t,n,i){this.context=t,this.route=n,this.visualQueryService=i,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(t){this.activeExplorer=this.activeExplorer===t?null:t}openHelp(){window.open("https://go.2sxc.org/visual-query","_blank")}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU($.o),e.rXU(D.nX),e.rXU(P))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-visual-query"]],viewQuery:function(n,i){if(1&n&&e.GBs(W,5),2&n){let s;e.mGM(s=e.lsd())&&(i.plumbEditor=s.first)}},standalone:!0,features:[e.Jv_([P,N,It.TI,x.gs]),e.aNF],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"click","ngClass"],["tippy","Add",1,"button",3,"click","ngClass"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(n,i){1&n&&(e.nrm(0,"router-outlet"),e.j41(1,"div",0)(2,"div",1)(3,"div",2),e.bIt("click",function(){return i.toggleExplorer(i.explorer.run)}),e.j41(4,"mat-icon"),e.EFF(5,"play_arrow"),e.k0s()(),e.j41(6,"div",3),e.bIt("click",function(){return i.toggleExplorer(i.explorer.add)}),e.j41(7,"mat-icon"),e.EFF(8,"add"),e.k0s()(),e.nrm(9,"div",4),e.j41(10,"div",5),e.bIt("click",function(){return i.openHelp()}),e.j41(11,"mat-icon"),e.EFF(12,"help_outline"),e.k0s()()(),e.nrm(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),e.k0s()),2&n&&(e.R7$(3),e.Y8G("ngClass",e.eq3(4,Z,i.activeExplorer===i.explorer.run)),e.R7$(3),e.Y8G("ngClass",e.eq3(6,Z,i.activeExplorer===i.explorer.add)),e.R7$(7),e.Y8G("hidden",i.activeExplorer!==i.explorer.run),e.R7$(),e.Y8G("hidden",i.activeExplorer!==i.explorer.add))},dependencies:[D.n3,v.YU,g.m_,g.An,$t,vt,W],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.01/dist/ng-edit/projects_eav-ui_src_app_visual-query_visual-query_component_ts.8efe06c21e2318f3.js.map