"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-type-fields_services_content-types-fields_service_ts-projects-7da183","projects_eav-ui_src_app_permissions_go-to-permissions_ts","projects_eav-ui_src_app_permissions_permissions_routing_ts"],{3051:(E,v,n)=>{n.d(v,{h6:()=>S,zZ:()=>F});var d=n(271),C=n(7693),s=n(8873),f=n(8559),u=n(6443),T=n(4821);const g="admin/field/",F="admin/field/all",b="admin/field/GetSharedFields";let S=(()=>{class I{constructor(r,c,l){this.http=r,this.context=c,this.dnnContext=l}apiUrl(r){return this.dnnContext.$2sxc.http.apiUrl(r)}typeListRetrieve(){return this.http.get(this.apiUrl(g+"DataTypes"),{params:{appid:this.context.appId.toString()}})}getInputTypesList(){return this.http.get(this.apiUrl(g+"InputTypes"),{params:{appid:this.context.appId.toString()}}).pipe((0,d.T)(r=>r.map(l=>({dataType:l.Type.substring(0,l.Type.indexOf("-")),inputType:l.Type,label:l.Label,description:l.Description,isDefault:l.IsDefault,isObsolete:l.IsObsolete,isRecommended:l.IsRecommended,obsoleteMessage:l.ObsoleteMessage,icon:l.IsDefault?"star":l.IsRecommended?"star_outline":null}))))}getReservedNames(){return this.http.get(this.apiUrl(g+"ReservedNames"))}getFields(r){return this.http.get(this.apiUrl(F),{params:{appid:this.context.appId.toString(),staticName:r}}).pipe((0,d.T)(c=>{if(c)for(const l of c){if(!l.Metadata)continue;const p=l.Metadata;p.merged={...p.All,...p[l.Type],...p[l.InputType]}}return c}))}getShareableFields(){return this.http.get(this.apiUrl(b),{params:{appid:this.context.appId.toString()}})}getShareableFieldsFor(r){return this.http.get(this.apiUrl(b),{params:{appid:this.context.appId.toString(),attributeId:r.toString()}})}addInheritedField(r,c,l,p){return this.http.post(this.apiUrl(g+"AddInheritedField"),null,{params:{AppId:this.context.appId.toString(),ContentTypeId:r.toString(),SourceType:c,SourceField:l,name:p}})}share(r,c=!0){return this.http.post(this.apiUrl(g+"Share"),null,{params:{appid:this.context.appId.toString(),attributeId:r.toString(),share:c}})}inherit(r,c){return this.http.post(this.apiUrl(g+"Inherit"),null,{params:{appid:this.context.appId.toString(),attributeId:r.toString(),inheritMetadataOf:c}})}reOrder(r,c){return this.http.post(this.apiUrl(g+"Sort"),null,{params:{appid:this.context.appId.toString(),contentTypeId:c.Id.toString(),order:JSON.stringify(r)}})}setTitle(r,c){return this.http.post(this.apiUrl(C.X+"SetTitle"),null,{params:{appid:this.context.appId.toString(),contentTypeId:c.Id.toString(),attributeId:r.Id.toString()}})}rename(r,c,l){return this.http.post(this.apiUrl(g+"Rename"),null,{params:{appid:this.context.appId.toString(),contentTypeId:c.toString(),attributeId:r.toString(),newName:l}})}delete(r,c){if(r.IsTitle)throw new Error("Can't delete Title");return this.http.delete(this.apiUrl(g+"Delete"),{params:{appid:this.context.appId.toString(),contentTypeId:c.Id.toString(),attributeId:r.Id.toString()}})}add(r,c){return this.http.post(this.apiUrl(g+"Add"),null,{params:{AppId:this.context.appId.toString(),ContentTypeId:c.toString(),Id:r.Id.toString(),Type:r.Type,InputType:r.InputType,StaticName:r.StaticName,IsTitle:r.IsTitle.toString(),Index:r.SortOrder.toString()}})}updateInputType(r,c,l){return this.http.post(this.apiUrl(g+"InputType"),null,{params:{appId:this.context.appId.toString(),attributeId:r.toString(),field:c,inputType:l}})}static#t=this.\u0275fac=function(c){return new(c||I)(f.KVO(u.Qq),f.KVO(s.o),f.KVO(T.ob))};static#e=this.\u0275prov=f.jDH({token:I,factory:I.\u0275fac})}return I})()},4305:(E,v,n)=>{n.r(v),n.d(v,{MetadataComponent:()=>bt});var d=n(7941),C=n(9184),s=n(5797),f=n(271),u=n(9999),T=n(4334),g=n(336),F=n(7319),b=n(4096),S=n(1735),I=n(6378),_=n(251),r=n(52),c=n(3216),l=n(4175),p=n(3777),D=n(9914),t=n(8559);function G(a,h){if(1&a&&(t.nrm(0,"mat-card-subtitle",0),t.nI1(1,"safeHtml")),2&a){const e=t.XpG();t.Y8G("innerHtml",t.bMT(1,1,e.dialogData.message),t.npT)}}let L=(()=>{class a{constructor(e,o){this.dialogData=e,this.dialogRef=o,this.hostClass="dialog-component"}closeDialog(e){this.dialogRef.close(e)}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU(d.Vh),t.rXU(d.CP))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-confirm-delete-dialog"]],hostVars:1,hostBindings:function(o,i){2&o&&t.Mr5("className",i.hostClass)},standalone:!0,features:[t.aNF],decls:10,vars:3,consts:[[3,"innerHtml"],["align","end"],["mat-raised-button","",1,"eav-card-action-button",3,"click"]],template:function(o,i){1&o&&(t.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3),t.k0s(),t.DNE(4,G,2,3,"mat-card-subtitle",0),t.k0s(),t.j41(5,"mat-card-actions",1)(6,"button",2),t.bIt("click",function(){return i.closeDialog()}),t.EFF(7,"Cancel"),t.k0s(),t.j41(8,"button",2),t.bIt("click",function(){return i.closeDialog(!0)}),t.EFF(9,"Delete"),t.k0s()()()),2&o&&(t.R7$(3),t.Lme("Delete ",i.dialogData.entityTitle," (",i.dialogData.entityId,")?"),t.R7$(),t.vxM(4,i.dialogData.message?4:-1))},dependencies:[p.Hu,p.RN,p.YY,p.MM,p.Lc,p.dh,l.Hl,l.$z,D.$],styles:[".eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}return a})();var R=n(3840),x=n(5060);let H=(()=>{class a{agInit(e){this.params=e}refresh(e){return!0}deleteMetadata(){this.params.onDelete(this.params.data)}static#t=this.\u0275fac=function(o){return new(o||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-actions"]],standalone:!0,features:[t.aNF],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(o,i){1&o&&(t.j41(0,"div",0)(1,"div",1),t.bIt("click",function(){return i.deleteMetadata()}),t.j41(2,"mat-icon"),t.EFF(3,"delete"),t.k0s()()())},dependencies:[x.pZ,x.r6,R.m_,R.An]})}return a})();var W=n(4601);let z=(()=>{class a{agInit(e){this.value=e.value,this.metadata=e.data}refresh(e){return!0}static#t=this.\u0275fac=function(o){return new(o||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-content-type"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[1,"container",3,"tippy","tippyDisabled"]],template:function(o,i){1&o&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&o&&(t.Y8G("tippy",i.metadata._Type.Description)("tippyDisabled",!i.metadata._Type.Description),t.R7$(),t.SpI(" ",i.value,"\n"))},dependencies:[W.e],styles:[".container[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}"]})}return a})();var y=n(4456),B=n(8827),J=n(3037),Z=n(1817),Q=n(5445),X=n(5858),$=n(316),A=n(7984),Y=n(5175),j=n(5944),w=n(3758),q=n(9333),P=n(5437);const V=a=>({active:a});function tt(a,h){if(1&a&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&a){const e=h.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",e.name," ")}}function et(a,h){if(1&a&&(t.j41(0,"mat-form-field",2)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",13),t.Z7z(4,tt,2,2,"mat-option",14,t.fX1),t.j41(6,"mat-option",14),t.EFF(7,"Other..."),t.k0s()()(),t.j41(8,"app-field-hint"),t.EFF(9," The scope should almost never be changed - "),t.j41(10,"a",15),t.EFF(11,"see help"),t.k0s()()),2&a){const e=t.XpG(),o=t.XpG();t.R7$(3),t.Y8G("placeholder",e.scopeOptions.length?"":"No items found"),t.R7$(),t.Dyx(e.scopeOptions),t.R7$(2),t.Y8G("value",o.dropdownInsertValue)}}function nt(a,h){if(1&a&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&a){const e=h.$implicit;t.Y8G("value",e.StaticName),t.R7$(),t.SpI(" ",e.Label," ")}}function at(a,h){if(1&a&&(t.j41(0,"mat-select",3),t.Z7z(1,nt,2,2,"mat-option",14,t.fX1),t.k0s()),2&a){const e=t.XpG();t.Y8G("placeholder",e.contentTypes.length?"":"No items found"),t.R7$(),t.Dyx(e.contentTypes)}}function ot(a,h){1&a&&t.nrm(0,"input",4)}function it(a,h){1&a&&(t.j41(0,"app-field-hint",8),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}function st(a,h){if(1&a){const e=t.RV6();t.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3,"Create Metadata"),t.k0s(),t.j41(4,"mat-card-subtitle"),t.EFF(5," This is a special operation to add an item which is metadata for another item, see "),t.j41(6,"a",0),t.EFF(7,"docs"),t.k0s(),t.EFF(8,". "),t.k0s()(),t.j41(9,"mat-card-content")(10,"form",1),t.DNE(11,et,12,2),t.j41(12,"mat-form-field",2)(13,"mat-label"),t.EFF(14,"Content Type"),t.k0s(),t.DNE(15,at,3,1,"mat-select",3)(16,ot,1,0,"input",4),t.j41(17,"div",5)(18,"button",6),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleGuidedContentType(!0))}),t.j41(19,"mat-icon"),t.EFF(20,"search"),t.k0s()(),t.j41(21,"button",7),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleGuidedContentType(!1))}),t.j41(22,"mat-icon"),t.EFF(23,"text_fields"),t.k0s()()()(),t.DNE(24,it,2,1,"app-field-hint",8),t.k0s()(),t.j41(25,"mat-card-actions",9)(26,"mat-slide-toggle",10),t.bIt("change",function(i){t.eBV(e);const m=t.XpG();return t.Njj(m.toggleAdvancedMode(i))}),t.EFF(27),t.k0s(),t.j41(28,"div")(29,"button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.closeDialog())}),t.EFF(30,"Cancel"),t.k0s(),t.j41(31,"button",12),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.confirm())}),t.EFF(32," Confirm "),t.k0s()()()()}if(2&a){const e=t.XpG();t.R7$(10),t.Y8G("formGroup",e.form),t.R7$(),t.vxM(11,e.advancedMode&&e.guidedContentType?11:-1),t.R7$(4),t.vxM(15,e.guidedContentType?15:-1),t.R7$(),t.vxM(16,e.guidedContentType?-1:16),t.R7$(2),t.Y8G("ngClass",t.eq3(10,V,e.guidedContentType)),t.R7$(3),t.Y8G("ngClass",t.eq3(12,V,!e.guidedContentType)),t.R7$(3),t.vxM(24,e.form.controls.contentType.touched&&null!=e.form.controls.contentType.errors&&e.form.controls.contentType.errors.required?24:-1),t.R7$(2),t.Y8G("checked",e.advancedMode),t.R7$(),t.SpI(" ",e.advancedMode?"Advanced":"Simple"," "),t.R7$(4),t.Y8G("disabled",!e.form.valid)}}let rt=(()=>{class a{constructor(e){this.dialogRef=e,this.hostClass="dialog-component",this.dropdownInsertValue=X.O,this.guidedContentType=!0,this.advancedMode=!1,this.contentTypesService=(0,P.d)(Q.gs)}ngOnInit(){this.contentTypes$=new s.t([]),this.scopeOptions$=new s.t([]),this.buildForm(),this.fetchScopes(),this.viewModel$=(0,u.z)([this.contentTypes$,this.scopeOptions$]).pipe((0,f.T)(([e,o])=>({contentTypes:e,scopeOptions:o})))}ngOnDestroy(){this.contentTypes$.complete(),this.scopeOptions$.complete()}closeDialog(e){this.dialogRef.close(e)}toggleGuidedContentType(e){this.guidedContentType=e}toggleAdvancedMode(e){this.advancedMode=e.checked}confirm(){const e=this.form.getRawValue();this.closeDialog(e.contentType)}buildForm(){this.form=new y.J3({}),this.form.addControl("contentType",new y.hs(null,[y.k0.required])),this.form.addControl("scope",new y.hs(r.YX.scopes.default.value)),this.form.controls.scope.valueChanges.pipe((0,J.Z)(this.form.controls.scope.value),(0,Z.F)()).subscribe(e=>{null!=this.form.controls.contentType.value&&this.form.controls.contentType.patchValue(null),e===X.O?(e=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||r.YX.scopes.default.value,this.scopeOptions$.value.some(o=>o.value===e)||this.scopeOptions$.next([{name:e,value:e},...this.scopeOptions$.value]),this.form.controls.scope.patchValue(e)):this.fetchContentTypes(e)})}fetchContentTypes(e){this.contentTypesService.retrieveContentTypes(e).subscribe(o=>{this.contentTypes$.next(o)})}fetchScopes(){this.contentTypesService.getScopes().subscribe(e=>{this.scopeOptions$.next(e)})}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU(d.CP))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-save-dialog"]],hostVars:1,hostBindings:function(o,i){2&o&&t.Mr5("className",i.hostClass)},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",1,"eav-mat-form-field"],["formControlName","contentType","required","",3,"placeholder"],["matInput","","type","text","formControlName","contentType","required",""],["matTextSuffix",""],["mat-icon-button","","type","button","tippy","Pick existing value",3,"click","ngClass"],["mat-icon-button","","type","button","tippy","Manual entry",3,"click","ngClass"],[3,"isError"],[1,"eav-card-actions"],["color","accent",3,"change","checked"],["mat-raised-button","",1,"eav-card-action-button",3,"click"],["mat-raised-button","","color","accent",1,"eav-card-action-button",3,"click","disabled"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""]],template:function(o,i){if(1&o&&(t.DNE(0,st,33,14,"mat-card"),t.nI1(1,"async")),2&o){let m;t.vxM(0,(m=t.bMT(1,1,i.viewModel$))?0:-1,m)}},dependencies:[p.Hu,p.RN,p.YY,p.m2,p.MM,p.Lc,p.dh,y.YN,y.qT,y.me,y.BC,y.cb,y.YS,y.X1,y.j4,y.JD,j.RG,j.rl,j.nJ,j.yw,Y.Ve,Y.VO,x.wT,x.Sy,A.fS,A.fg,l.Hl,l.$z,l.iY,$.YU,R.m_,R.An,B.mV,B.sG,$.Jj,w.F,q.c],styles:[".eav-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}return a})();var lt=n(6838),K=n(6256),k=n(3183),ct=n(7037),dt=n(3472),U=n(1828),pt=n(3347),mt=n(9841);const ht=a=>({"fab-opened":a});function ut(a,h){1&a&&t.EFF(0," This item is not metadata for anything else. ")}function gt(a,h){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Key Number: ",e.itemFor.KeyNumber," ")}}function ft(a,h){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Key Guid: ",e.itemFor.KeyGuid," ")}}function _t(a,h){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Key String: ",e.itemFor.KeyString," ")}}function Ct(a,h){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const e=t.XpG(2);t.R7$(),t.SpI("Title: ",e.itemFor.Title," ")}}function vt(a,h){if(1&a&&(t.EFF(0," This item is metadata for: "),t.nrm(1,"br"),t.EFF(2),t.nrm(3,"br"),t.EFF(4),t.DNE(5,gt,2,1)(6,ft,2,1)(7,_t,2,1)(8,Ct,2,1)),2&a){const e=t.XpG();t.R7$(2),t.SpI("Target: ",e.itemFor.Target," "),t.R7$(2),t.SpI("TargetType: ",e.itemFor.TargetType," "),t.R7$(),t.vxM(5,e.itemFor.KeyNumber?5:-1),t.R7$(),t.vxM(6,e.itemFor.KeyGuid?6:-1),t.R7$(),t.vxM(7,e.itemFor.KeyString?7:-1),t.R7$(),t.vxM(8,e.itemFor.Title?8:-1)}}function Tt(a,h){if(1&a){const e=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.createMetadata())}),t.j41(1,"mat-icon"),t.EFF(2,"add"),t.k0s()()}}function yt(a,h){if(1&a&&(t.nrm(0,"div",19),t.nI1(1,"safeHtml")),2&a){const e=t.XpG().$implicit;t.Y8G("innerHTML",t.bMT(1,2,e.Icon),t.npT)("matBadgeHidden",e.Enabled)}}function Mt(a,h){1&a&&(t.j41(0,"mat-icon"),t.EFF(1,"add"),t.k0s())}function It(a,h){if(1&a){const e=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){const i=t.eBV(e).$implicit,m=t.XpG(3);return t.Njj(m.createMetadata(i))}),t.DNE(1,yt,2,4,"div",19)(2,Mt,2,0),t.k0s()}if(2&a){const e=h.$implicit;t.BMQ("label",e.Title),t.R7$(),t.vxM(1,e.Icon?1:2)}}function Dt(a,h){if(1&a){const e=t.RV6();t.j41(0,"eco-fab-speed-dial",11),t.bIt("openChange",function(i){t.eBV(e);const m=t.XpG(2);return t.Njj(m.openChange(i))}),t.j41(1,"eco-fab-speed-dial-trigger",12)(2,"button",13)(3,"mat-icon",14),t.EFF(4),t.k0s()()(),t.j41(5,"eco-fab-speed-dial-actions",15)(6,"button",16),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.createMetadata())}),t.j41(7,"mat-icon"),t.EFF(8,"search"),t.k0s()(),t.Z7z(9,It,3,2,"button",17,t.fX1),t.k0s()()}if(2&a){const e=t.XpG();t.Y8G("ngClass",t.eq3(3,ht,e.fabOpen)),t.R7$(),t.Y8G("spin",!0),t.R7$(3),t.JRh(e.fabOpen?"close":"add"),t.R7$(5),t.Dyx(e.recommendations)}}function Ft(a,h){if(1&a){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.closeDialog())}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"p"),t.DNE(9,ut,1,0)(10,vt,9,6),t.k0s(),t.nrm(11,"router-outlet"),t.j41(12,"div",5),t.nrm(13,"ag-grid-angular",6),t.k0s()(),t.j41(14,"mat-dialog-actions",7),t.DNE(15,Tt,3,0,"button",8)(16,Dt,11,5,"eco-fab-speed-dial",9),t.k0s()()}if(2&a){const e=h,o=t.XpG();t.R7$(3),t.SpI(" ",o.title||"Metadata"," "),t.R7$(6),t.vxM(9,e.itemFor?10:9),t.R7$(4),t.Y8G("rowData",e.metadata)("gridOptions",o.gridOptions),t.R7$(2),t.vxM(15,0===e.recommendations.length?15:-1),t.R7$(),t.vxM(16,e.recommendations.length>0?16:-1)}}let bt=(()=>{class a extends S.V{constructor(e,o,i,m,M,O,N){super(e,o,new dt.B("MetadataComponent",!1)),this.router=e,this.route=o,this.dialogRef=i,this.snackBar=m,this.dialog=M,this.viewContainerRef=O,this.changeDetectorRef=N,this.gridOptions=this.buildGridOptions(),this.entitiesService=(0,P.d)(F.T),this.metadataService=(0,P.d)(b.TI),this.contentItemsService=(0,P.d)(g.F),this.metadataSet$=new s.t({Items:[],Recommendations:[]}),this.itemFor$=new s.t(void 0),this.fabOpen$=new s.t(!1),this.targetType=parseInt(this.route.snapshot.paramMap.get("targetType"),10),this.keyType=this.route.snapshot.paramMap.get("keyType"),this.key=this.route.snapshot.paramMap.get("key"),this.title=decodeURIComponent(this.route.snapshot.paramMap.get("title")??""),this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName")}ngOnInit(){this.fetchFor(),this.fetchMetadata(),this.subscriptions.add(this.childDialogClosed$().subscribe(()=>{this.fetchMetadata()}));const e=this.log.rxTap("filteredRecs$");this.metadataSet$.subscribe(m=>{this.log.a("test 2dm",{set:m})});const o=this.metadataSet$.pipe(e.pipe(),(0,f.T)(m=>m.Recommendations.filter(M=>m.Items.filter(O=>O._Type.Id===M.Id).length<M.Count)),e.map()),i=this.log.rxTap("viewModel$");this.viewModel$=(0,u.z)([this.metadataSet$,o,this.itemFor$,this.fabOpen$]).pipe(i.pipe(),(0,f.T)(([m,M,O,N])=>({metadata:m.Items,recommendations:M,itemFor:O,fabOpen:N})),i.map())}ngOnDestroy(){this.log.a("destroying"),this.metadataSet$.complete(),this.itemFor$.complete(),this.fabOpen$.complete(),super.ngOnDestroy()}closeDialog(){this.dialogRef.close()}openChange(e){this.fabOpen$.next(e)}createMetadata(e){if(e)return e.Enabled?void(e.CreateEmpty?(this.snackBar.open(`Creating ${e.Name}...`),this.entitiesService.create(e.Id,{For:this.calculateItemFor()}).subscribe({error:()=>{this.snackBar.open(`Creating ${e.Name} failed. Please check console for more info`,void 0,{duration:3e3}),this.fetchMetadata()},next:()=>{this.snackBar.open(`Created ${e.Name}`,void 0,{duration:3e3}),this.fetchMetadata()}})):this.createMetadataForm(e.Id)):void(0,lt.jr)(this.dialog,e.MissingFeature,this.viewContainerRef,this.changeDetectorRef);this.dialog.open(rt,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(i=>{null!=i&&this.createMetadataForm(i)})}createMetadataForm(e){const o={items:[{ContentTypeName:e,For:this.calculateItemFor()}]},i=(0,c.s)(o);this.router.navigate([`edit/${i}`],{relativeTo:this.route}),this.changeDetectorRef.markForCheck()}calculateItemFor(){return{Target:Object.values(r.YX.metadata).find(o=>o.targetType===this.targetType)?.target??this.targetType.toString(),TargetType:this.targetType,...this.keyType===r.YX.keyTypes.guid&&{Guid:this.key},...this.keyType===r.YX.keyTypes.number&&{Number:parseInt(this.key,10)},...this.keyType===r.YX.keyTypes.string&&{String:this.key}}}fetchFor(){this.contentTypeStaticName&&this.contentItemsService.getAll(this.contentTypeStaticName).subscribe(e=>{const o=e.find(i=>i.Guid===this.key);o?.For&&this.itemFor$.next(o.For)})}fetchMetadata(){const e=this.log.rxTap("getMetadata");this.metadataService.getMetadata(this.targetType,this.keyType,this.key).pipe(e.pipe(),(0,T.s)(1),(0,f.T)(o=>(o.Recommendations.forEach(i=>{i.Icon?.startsWith("base64:")&&(i.Icon=i.Icon.replace("base64:",""),i.Icon=window.atob(i.Icon),i.Icon=i.Icon.replace('fill="#000000"','fill="#ffffff"'))}),o)),e.map()).subscribe(o=>this.metadataSet$.next(o))}editMetadata(e){const i=(0,c.s)({items:[{EntityId:e.Id}]});this.router.navigate([`edit/${i}`],{relativeTo:this.route})}deleteMetadata(e,o=!1){if(o)this.snackBar.open("Deleting..."),this.entitiesService.delete(e._Type.Id,e.Id,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchMetadata()},error:()=>{this.snackBar.open("Delete failed. Please check console for more information",null,{duration:3e3})}});else{const i={entityId:e.Id,entityTitle:e.Title,message:this.metadataSet$.value.Recommendations.find(M=>M.Id===e._Type.Id)?.DeleteWarning};this.dialog.open(L,{autoFocus:!1,data:i,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(M=>{M&&this.deleteMetadata(e,!0)})}}buildGridOptions(){return{..._.C,columnDefs:[{...U.r.Id,cellRenderer:I.L,cellRendererParams:{tooltipGetter:i=>`ID: ${i.Id}\nGUID: ${i.Guid}`}},{...U.r.TextWide,field:"Title",onCellClicked:o=>{this.editMetadata(o.data)}},{...U.r.TextWide,headerName:"Content Type",field:"ContentType",valueGetter:o=>{const i=o.data;return`${i._Type.Name}${i._Type.Title!==i._Type.Name?` (${i._Type.Title})`:""}`},cellRenderer:z},{...U.r.ActionsPinnedRight1,cellRenderer:H,cellRendererParams:{onDelete:i=>this.deleteMetadata(i)}}]}}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU(C.Ix),t.rXU(C.nX),t.rXU(d.CP),t.rXU(pt.UG),t.rXU(d.bZ),t.rXU(t.c1b),t.rXU(t.gRc))};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab"],[1,"eav-eco-fab-speed-dial",3,"ngClass"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab",3,"click"],[1,"eav-eco-fab-speed-dial",3,"openChange","ngClass"],[3,"spin"],["mat-fab",""],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Other Content Type",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadge","\u{1f48e}","matBadgePosition","below after","aria-hidden","false",2,"color","white","fill","white",3,"innerHTML","matBadgeHidden"]],template:function(o,i){if(1&o&&(t.DNE(0,Ft,17,6,"div",0),t.nI1(1,"async")),2&o){let m;t.vxM(0,(m=t.bMT(1,1,i.viewModel$))?0:-1,m)}},dependencies:[l.Hl,l.iY,l.$0,l.Sr,R.m_,R.An,C.n3,ct.p,mt.xs,d.E7,k.TE,$.YU,k.p1,k.yf,K.Y,K.k,$.Jj,D.$],styles:["[_nghost-%COMP%]     .mat-button-wrapper div svg *:not([fill]){fill:#fff}"]})}return a})()},2437:(E,v,n)=>{n.d(v,{k:()=>C});var d=n(52);let C=(()=>{class s{static#t=this.route={path:"permissions/:targetType/:keyType/:key",loadChildren:()=>n.e("projects_eav-ui_src_app_permissions_permissions_routing_ts").then(n.bind(n,3516)).then(u=>u.permissionRoutes),data:{title:"Permissions"}};static getUrl(u,T,g){return`permissions/${u}/${T}/${g}`}static getUrlApp(u){return this.getUrl(d.YX.metadata.app.targetType,d.YX.metadata.app.keyType,u.toString())}static getUrlAttribute(u){return this.getUrl(d.YX.metadata.attribute.targetType,d.YX.metadata.attribute.keyType,u.toString())}static getUrlContentType(u){return this.getUrlEntity(u)}static getUrlEntity(u){return this.getUrl(d.YX.metadata.entity.targetType,d.YX.metadata.entity.keyType,u)}static getUrlLanguage(u){return this.getUrl(d.YX.metadata.language.targetType,d.YX.metadata.language.keyType,u)}}return s})()},4096:(E,v,n)=>{n.d(v,{Kn:()=>T.K,TI:()=>u.T,k4:()=>d.k});var d=n(2437),u=(n(2365),n(3516),n(2458),n(401)),T=n(4900)},2365:(E,v,n)=>{n.d(v,{v:()=>C});var d=n(9204);const C={name:"SET_PERMISSIONS_DIALOG",initContext:!0,panelSize:"large",panelClass:null,getComponent:()=>(0,d.A)(function*(){const{PermissionsComponent:s}=yield Promise.all([n.e("default-node_modules_angular_material_fesm2022_snack-bar_mjs"),n.e("default-node_modules_angular_material_fesm2022_radio_mjs"),n.e("default-projects_eav-ui_src_app_shared_constants_default-grid-options_constants_ts-projects_e-814394"),n.e("default-projects_eav-ui_src_app_permissions_permissions_component_ts"),n.e("projects_eav-ui_src_app_shared_components_base-with-child-dialog_component_ts-projects_eav-ui-105347")]).then(n.bind(n,2458));return s})()}},3516:(E,v,n)=>{n.r(v),n.d(v,{permissionRoutes:()=>f});var d=n(5544),C=n(2365),s=n(2134);const f=[{path:"",component:d.U,data:{dialog:C.v},children:s.H3}]},3758:(E,v,n)=>{n.d(v,{F:()=>I});var d=n(316),C=n(5944),s=n(8559);const f=["*"],u=_=>({"hint-box__short":_});function T(_,r){1&_&&s.eu8(0)}function g(_,r){if(1&_&&(s.j41(0,"mat-hint"),s.DNE(1,T,1,0,"ng-container",2),s.k0s()),2&_){s.XpG();const c=s.sdS(4);s.R7$(),s.Y8G("ngTemplateOutlet",c)}}function F(_,r){1&_&&s.eu8(0)}function b(_,r){if(1&_&&(s.j41(0,"mat-error"),s.DNE(1,F,1,0,"ng-container",2),s.k0s()),2&_){s.XpG();const c=s.sdS(4);s.R7$(),s.Y8G("ngTemplateOutlet",c)}}function S(_,r){1&_&&s.SdG(0)}let I=(()=>{class _{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(l){return new(l||_)};static#e=this.\u0275cmp=s.VBU({type:_,selectors:[["app-field-hint"]],inputs:{isError:"isError"},standalone:!0,features:[s.aNF],ngContentSelectors:f,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(l,p){if(1&l){const D=s.RV6();s.NAR(),s.j41(0,"div",1),s.bIt("click",function(){return s.eBV(D),s.Njj(p.toggleIsShort())}),s.DNE(1,g,2,1)(2,b,2,1),s.k0s(),s.DNE(3,S,1,0,"ng-template",null,0,s.C5r)}if(2&l){let D;s.Y8G("ngClass",s.eq3(2,u,p.isShort)),s.R7$(),s.vxM(1,!1===(D=p.isError)?1:!0===D?2:-1)}},dependencies:[C.RG,C.MV,C.TL,d.YU,d.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return _})()},9333:(E,v,n)=>{n.d(v,{c:()=>s});var d=n(8559);let s=(()=>{class f{constructor(){}onClick(T){T.stopPropagation()}static#t=this.\u0275fac=function(g){return new(g||f)};static#e=this.\u0275dir=d.FsC({type:f,selectors:[["","appClickStopPropagation",""]],hostBindings:function(g,F){1&g&&d.bIt("click",function(S){return F.onClick(S)})},standalone:!0})}return f})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.01/dist/ng-edit/projects_eav-ui_src_app_content-type-fields_services_content-types-fields_service_ts-projects-7da183.5066139cafaf1cb7.js.map