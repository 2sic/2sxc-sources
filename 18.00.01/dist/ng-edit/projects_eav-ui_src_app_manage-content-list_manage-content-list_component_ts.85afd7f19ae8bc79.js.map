{"version":3,"file":"projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts.85afd7f19ae8bc79.js","mappings":"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","names":["i0","_r2","ctx_r2","editHeader","vm_r4","header","Title","ManageContentListComponent_Conditional_0_Conditional_8_Conditional_4_Template","ManageContentListComponent_Conditional_0_Conditional_8_Conditional_5_Template","Type","item_r6","_r5","$implicit","addFromExisting","Index","addBelow","remove","editItem","Id","reordered","ManageContentListComponent_Conditional_0_Conditional_8_Template","ManageContentListComponent_Conditional_0_Conditional_9_Template","ManageContentListComponent_Conditional_0_Conditional_10_Template","$event","_r1","drop","ManageContentListComponent_Conditional_0_For_13_Template","trackByFn","closeDialog","saveList","saveAndCloseList","items","length","ManageContentListComponent","BaseWithChildDialogComponent","constructor","router","route","dialogRef","snackBar","translate","super","this","hostClass","items$","BehaviorSubject","header$","viewModel$","combineLatest","pipe","map","contentGroup","id","guid","snapshot","paramMap","get","part","index","parseInt","contentGroupService","transient","ContentGroupService","appDialogConfigService","AppDialogConfigService","ngOnInit","fetchList","fetchHeader","fetchDialogSettings","subscriptions","add","childDialogClosed$","subscribe","ngOnDestroy","complete","getCurrent$","dialogSettings","setDefaultLang","Context","Language","Primary","split","use","Current","close","open","value","duration","formUrl","convertFormToUrl","Add","Parent","Field","navigate","relativeTo","EntityId","queryParams","item","confirm","instant","removeItem","event","moveItemInArray","previousIndex","currentIndex","next","keepOrder","getList","oldIds","some","includes","sortOrder","sort","a","b","aIndex","indexOf","bIndex","getHeader","static","t","i1","i2","i3","i4","_angular_core__WEBPACK_IMPORTED_MODULE_5__","VBU","selectors","hostVars","hostBindings","rf","ctx","FormConfigService","decls","vars","consts","template","ManageContentListComponent_Conditional_0_Template","tmp_0_0","RouterOutlet","CdkScrollable","MatButtonModule","i5","MatIconModule","i6","CdkDropList","CdkDrag","MatDialogActions","AsyncPipe","TranslateModule","MatDialogModule","TippyDirective","MousedownStopPropagationDirective","styles"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/manage-content-list/manage-content-list.component.html","./projects/eav-ui/src/app/manage-content-list/manage-content-list.component.ts"],"sourcesContent":["@if (viewModel$ | async; as vm) {\r\n  <div class=\"eav-dialog eav-no-scrollbar\">\r\n    <div class=\"eav-dialog-header\">\r\n      <div class=\"eav-dialog-header__title\">{{'ManageContentList.Title' | translate}}</div>\r\n    </div>\r\n    <div class=\"eav-dialog-content\">\r\n      <router-outlet></router-outlet>\r\n      <div class=\"dialog-component-content fancy-scrollbar-light\" cdkScrollable>\r\n        @if (vm.header) {\r\n          <p>\r\n            {{'ManageContentList.Description' | translate}}\r\n          </p>\r\n          <p>\r\n            @if (vm.header.Type) {\r\n              <span>{{ vm.header.Title }}</span>\r\n              <button mat-icon-button tippy=\"Edit header\" (click)=\"editHeader()\">\r\n                <mat-icon>edit</mat-icon>\r\n              </button>\r\n            }\r\n            @if (!vm.header.Type) {\r\n              {{'ManageContentList.NoHeader' | translate}}\r\n            }\r\n          </p>\r\n        }\r\n        @if (vm.items && vm.items?.length < 25 ) {\r\n          <p class=\"eav-sort-title\">\r\n            {{'ManageContentList.SortItems' | translate}}\r\n          </p>\r\n        }\r\n        @if (vm.items?.length >= 25 ) {\r\n          <p class=\"eav-sort-title\">\r\n            {{'ManageContentList.SortLotsOfItems' | translate}}\r\n          </p>\r\n        }\r\n        <div class=\"eav-dnd-list\" cdkDropList (cdkDropListDropped)=\"drop($event)\">\r\n          @for (item of vm.items; track trackByFn($index, item)) {\r\n            <div class=\"eav-dnd-item\" cdkDrag>\r\n              <div class=\"eav-dnd-item__title\">\r\n                <mat-icon class=\"eav-dnd-item__title-icon\" tippy=\"Drag to reorder the list\">drag_handle</mat-icon>\r\n                <span class=\"eav-dnd-item__title-text\" tippy=\"{{ item.Title }} ({{ item.Id }})\">\r\n                  {{ item.Title }} ({{ item.Id }})\r\n                </span>\r\n              </div>\r\n              <div>\r\n                <!-- most buttons should only exist if it has a real ID, except for remove - which should also remove null-entries -->\r\n                <button mat-icon-button [tippy]=\"'Fields.Picker.AddExistingItem' | translate\" appMousedownStopPropagation\r\n                  [disabled]=\"item.Id === 0\" (click)=\"addFromExisting(item.Index)\">\r\n                  <mat-icon>playlist_add</mat-icon>\r\n                </button>\r\n                <button mat-icon-button [tippy]=\"'Fields.Picker.AddItemBelow' | translate\" appMousedownStopPropagation\r\n                  [disabled]=\"item.Id === 0 || reordered\" (click)=\"addBelow(item.Index)\">\r\n                  <mat-icon>add</mat-icon>\r\n                </button>\r\n                <button mat-icon-button [tippy]=\"'Fields.Picker.Remove' | translate\" appMousedownStopPropagation\r\n                  [disabled]=\"reordered\" (click)=\"remove(item)\">\r\n                  <mat-icon>remove</mat-icon>\r\n                </button>\r\n                <button mat-icon-button [tippy]=\"'Fields.Picker.Edit' | translate\" appMousedownStopPropagation\r\n                  [disabled]=\"item.Id === 0\" (click)=\"editItem(item.Id)\">\r\n                  <mat-icon>edit</mat-icon>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <mat-dialog-actions align=\"end\">\r\n      <button mat-raised-button (click)=\"closeDialog()\">{{'General.Buttons.Cancel' | translate}}</button>\r\n      <button mat-raised-button color=\"accent\" (click)=\"saveList()\">{{'General.Buttons.Save' | translate}}</button>\r\n      <button mat-raised-button color=\"accent\" (click)=\"saveAndCloseList()\" [tippy]=\"'Form.Buttons.SaveAndClose' | translate\">\r\n        <mat-icon class=\"eav-raised-button-icon\">done</mat-icon>\r\n      </button>\r\n    </mat-dialog-actions>\r\n  </div>\r\n}\r\n","import { CdkDragDrop, moveItemInArray, CdkDropList, CdkDrag } from '@angular/cdk/drag-drop';\r\nimport { Component, HostBinding, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MatDialogActions, MatDialogModule } from '@angular/material/dialog';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { ActivatedRoute, Router, RouterOutlet } from '@angular/router';\r\nimport { BehaviorSubject, combineLatest, map, tap } from 'rxjs';\r\nimport { convertFormToUrl } from '../shared/helpers/url-prep.helper';\r\nimport { EditForm } from '../shared/models/edit-form.model';\r\nimport { ContentGroup } from './models/content-group.model';\r\nimport { GroupHeader } from './models/group-header.model';\r\nimport { ContentGroupService } from './services/content-group.service';\r\nimport { AppDialogConfigService } from '../app-administration/services';\r\nimport { TranslateService, TranslateModule } from '@ngx-translate/core';\r\nimport { BaseWithChildDialogComponent } from '../shared/components/base-with-child-dialog.component';\r\nimport { AsyncPipe } from '@angular/common';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { CdkScrollable } from '@angular/cdk/scrolling';\r\nimport { TippyDirective } from '../shared/directives/tippy.directive';\r\nimport { MousedownStopPropagationDirective } from '../shared/directives/mousedown-stop-propagation.directive';\r\nimport { transient } from '../core';\r\nimport { FormConfigService } from '../edit/state/form-config.service';\r\n\r\n@Component({\r\n  selector: 'app-manage-content-list',\r\n  templateUrl: './manage-content-list.component.html',\r\n  styleUrls: ['./manage-content-list.component.scss'],\r\n  standalone: true,\r\n  imports: [\r\n    RouterOutlet,\r\n    CdkScrollable,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    CdkDropList,\r\n    CdkDrag,\r\n    MatDialogActions,\r\n    AsyncPipe,\r\n    TranslateModule,\r\n    MatDialogModule,\r\n    TippyDirective,\r\n    MousedownStopPropagationDirective,\r\n  ],\r\n  providers: [\r\n    FormConfigService,\r\n  ],\r\n})\r\nexport class ManageContentListComponent extends BaseWithChildDialogComponent implements OnInit, OnDestroy {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n\r\n  private items$ = new BehaviorSubject<GroupHeader[]>(null);\r\n  private header$ = new BehaviorSubject<GroupHeader>(null);\r\n  viewModel$ = combineLatest([this.items$, this.header$]).pipe(\r\n    map(([items, header]) => ({ items, header })),\r\n  );\r\n\r\n  private contentGroup: ContentGroup = {\r\n    id: null,\r\n    guid: this.route.snapshot.paramMap.get('guid'),\r\n    part: this.route.snapshot.paramMap.get('part'),\r\n    index: parseInt(this.route.snapshot.paramMap.get('index'), 10),\r\n  };\r\n  reordered = false;\r\n\r\n  private contentGroupService = transient(ContentGroupService);\r\n  private appDialogConfigService = transient(AppDialogConfigService);\r\n\r\n  constructor(\r\n    protected router: Router,\r\n    protected route: ActivatedRoute,\r\n    private dialogRef: MatDialogRef<ManageContentListComponent>,\r\n    private snackBar: MatSnackBar,\r\n    private translate: TranslateService,\r\n  ) {\r\n    super(router, route);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.fetchList();\r\n    this.fetchHeader();\r\n    this.fetchDialogSettings();\r\n    this.subscriptions.add(this.childDialogClosed$().subscribe(() => {\r\n      this.fetchList(true);\r\n      this.fetchHeader();\r\n    }));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.items$.complete();\r\n    this.header$.complete();\r\n    super.ngOnDestroy();\r\n  }\r\n\r\n  private fetchDialogSettings() {\r\n    this.appDialogConfigService.getCurrent$().subscribe(dialogSettings => {\r\n      this.translate.setDefaultLang(dialogSettings.Context.Language.Primary.split('-')[0]);\r\n      this.translate.use(dialogSettings.Context.Language.Current.split('-')[0]);\r\n    });\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  saveList() {\r\n    this.snackBar.open('Saving...');\r\n    this.contentGroupService.saveList(this.contentGroup, this.items$.value).subscribe(() => {\r\n      this.snackBar.open('Saved', null, { duration: 2000 });\r\n      this.fetchList();\r\n      this.fetchHeader();\r\n    });\r\n  }\r\n\r\n  saveAndCloseList() {\r\n    this.snackBar.open('Saving...');\r\n    this.contentGroupService.saveList(this.contentGroup, this.items$.value).subscribe(() => {\r\n      this.snackBar.open('Saved', null, { duration: 2000 });\r\n      this.closeDialog();\r\n    });\r\n  }\r\n\r\n  editHeader() {\r\n    const form: EditForm = {\r\n      items: [\r\n        {\r\n          Add: this.header$.value.Id === 0,\r\n          Index: 0,\r\n          Parent: this.contentGroup.guid,\r\n          Field: 'listcontent',\r\n        },\r\n        {\r\n          Add: this.header$.value.Id === 0,\r\n          Index: 0,\r\n          Parent: this.contentGroup.guid,\r\n          Field: 'listpresentation',\r\n        },\r\n      ],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  editItem(id: number) {\r\n    const form: EditForm = {\r\n      items: [{ EntityId: id }],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  addFromExisting(index: number) {\r\n    const queryParams = { add: true };\r\n    this.router.navigate([`${this.contentGroup.guid}/${this.contentGroup.part}/${index + 1}/replace`], { relativeTo: this.route, queryParams });\r\n  }\r\n\r\n  addBelow(index: number) {\r\n    const form: EditForm = {\r\n      items: [{ Add: true, Index: index + 1, Parent: this.contentGroup.guid, Field: this.contentGroup.part }],\r\n    };\r\n    const formUrl = convertFormToUrl(form);\r\n    this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n  }\r\n\r\n  remove(item: GroupHeader) {\r\n    if (!confirm(this.translate.instant('ManageContentList.ConfirmRemove'))) { return; }\r\n    this.snackBar.open('Removing...');\r\n    this.contentGroupService.removeItem(this.contentGroup, item.Index).subscribe(() => {\r\n      this.snackBar.open('Removed', null, { duration: 2000 });\r\n      this.fetchList();\r\n    });\r\n  }\r\n\r\n  drop(event: CdkDragDrop<GroupHeader[]>) {\r\n    const items = [...this.items$.value];\r\n    moveItemInArray(items, event.previousIndex, event.currentIndex);\r\n    this.items$.next(items);\r\n    this.reordered = true;\r\n  }\r\n\r\n  trackByFn(index: number, item: GroupHeader) {\r\n    // we use both Index and Id because all demo items have Id=0\r\n    return `${item.Index}+${item.Id}`;\r\n  }\r\n\r\n  private fetchList(keepOrder = false) {\r\n    this.contentGroupService.getList(this.contentGroup).subscribe(items => {\r\n      if (this.reordered) {\r\n        const oldIds = this.items$.value.map(item => item.Id);\r\n        const idsChanged = this.items$.value.length !== items.length || items.some(item => !oldIds.includes(item.Id));\r\n        // for usecase where list is fetched on child closed and wasn't changed in the meantime keeps the order before child was opened\r\n        if (!idsChanged && keepOrder) {\r\n          const sortOrder = this.items$.value.map(item => item.Index);\r\n          items.sort((a, b) => {\r\n            const aIndex = sortOrder.indexOf(a.Index);\r\n            const bIndex = sortOrder.indexOf(b.Index);\r\n            if (aIndex === -1 || bIndex === -1) { return 0; }\r\n            return aIndex - bIndex;\r\n          });\r\n        } else if (keepOrder) {\r\n          this.snackBar.open('List was changed from somewhere else. Order of items is reset', null, { duration: 5000 });\r\n        }\r\n      }\r\n      this.items$.next(items);\r\n      this.reordered = false;\r\n    });\r\n  }\r\n\r\n  private fetchHeader() {\r\n    this.contentGroupService.getHeader(this.contentGroup).subscribe(header => {\r\n      this.header$.next(header);\r\n    });\r\n  }\r\n}\r\n"],"x_google_ignoreList":[]}