"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-import_content-import_component_ts"],{533:(S,I,o)=>{o.d(I,{m:()=>t});var d=o(604),m=o(7488),E=o(8600),y=o(6698),D=o(6028),g=o(9244),T=o(316),s=o(2376),c=o(4896),C=o(1332);let t=(()=>{class f extends T.o{constructor(l,v,_,R){super(new s.W("AppDialogConfigService",!1)),this.http=l,this.context=v,this.globalConfigService=_,this.dialogSettings$={},this.log.add("using context #",this.context.log.svcId),R.loadFromService(this)}ngOnDestroy(){super.destroy()}getCurrent$(){const l=this.context.appId;return this.log.add("getCurrent$","appId",l),this.getShared$(l)}getSitePrimaryApp$(){return this.getCurrent$().pipe((0,d.k)(l=>l?.Context.Site.PrimaryApp))}getGlobalPrimaryApp$(){return this.getCurrent$().pipe((0,d.k)(l=>l?.Context.System.PrimaryApp))}getShared$(l){return this.log.add("getShared$","appId",l),this.dialogSettings$[l]??=this.getDialogSettings(l,"getShared$").pipe((0,m.C)({refCount:!1})),this.dialogSettings$[l]}getDialogSettings(l,v){return this.log.add("getDialogSettings","appId",l,"reqBy",v),this.http.get("admin/dialog/settings",{params:{appId:l??this.context.appId.toString()}}).pipe((0,d.k)(_=>(_.Context.Language.List=_.Context.Language.List.filter(R=>R.IsEnabled),_)),(0,E.y)(_=>{this.globalConfigService.allowDebug(_.Context.Enable.DebugMode)}))}static#t=this.\u0275fac=function(v){return new(v||f)(c.CoB(C.KK),c.CoB(D.e),c.CoB(y.Sq),c.CoB(g.E))};static#e=this.\u0275prov=c.wxM({token:f,factory:f.\u0275fac})}return f})()},2688:(S,I,o)=>{o.r(I),o.d(I,{ContentImportComponent:()=>X});var d=o(600),m=o(4844),E=o(5876),y=o(604),D=o(4816),g=o(533),T=o(692),s=o(9616),c=o(9432),C=o(4172),h=o(616),u=o(6028),t=o(4896),f=o(1332),x=o(3392);let l=(()=>{class n{constructor(e,i,a){this.http=e,this.context=i,this.dnnContext=a}evaluateContent(e){return(0,s.Q)((0,h.S)(e.file)).pipe((0,c.G)(i=>{const a={AppId:this.context.appId.toString(),DefaultLanguage:e.defaultLanguage,ContentType:e.contentType,ContentBase64:i,ResourcesReferences:e.resourcesReferences,ClearEntities:e.clearEntities};return this.http.post(this.dnnContext.$2sxc.http.apiUrl(C.ue+"XmlPreview"),a).pipe((0,y.k)(r=>(r.Success||(r.Errors=r.Detail,delete r.Detail),r)))}))}importContent(e){return(0,s.Q)((0,h.S)(e.file)).pipe((0,c.G)(i=>{const a={AppId:this.context.appId.toString(),DefaultLanguage:e.defaultLanguage,ContentType:e.contentType,ContentBase64:i,ResourcesReferences:e.resourcesReferences,ClearEntities:e.clearEntities};return this.http.post(this.dnnContext.$2sxc.http.apiUrl(C.ue+"XmlUpload"),a)}))}static#t=this.\u0275fac=function(i){return new(i||n)(t.CoB(f.KK),t.CoB(u.e),t.CoB(x.es))};static#e=this.\u0275prov=t.wxM({token:n,factory:n.\u0275fac})}return n})();var v=o(5056),_=o(1232),R=o(4672),O=o(1904),$=o(988),G=o(5204),Y=o(3884),M=o(8200);function k(n,p){if(1&n){const e=t.KQA();t.I0R(0,"form",null,6)(2,"div",7)(3,"div")(4,"button",8),t.qCj("click",function(){t.usT(e);const a=t.Gew(8);return t.CGJ(a.click())}),t.I0R(5,"span"),t.OEk(6),t.C$Y()(),t.I0R(7,"input",9,10),t.qCj("change",function(a){t.usT(e);const r=t.GaO(3);return t.CGJ(r.fileChange(a))}),t.C$Y()(),t.I0R(9,"div")(10,"p",11),t.OEk(11,"References to pages / files"),t.C$Y(),t.I0R(12,"mat-radio-group",12),t.qCj("ngModelChange",function(a){t.usT(e);const r=t.GaO(3);return t.CGJ(r.formValues.resourcesReferences=a)}),t.I0R(13,"mat-radio-button",13),t.OEk(14," Import links as written in the file (for example /Portals/...) "),t.C$Y(),t.I0R(15,"mat-radio-button",14),t.OEk(16," Try to resolve paths to references "),t.C$Y()()(),t.I0R(17,"div")(18,"p",11),t.OEk(19,"Clear all other entities"),t.C$Y(),t.I0R(20,"mat-radio-group",15),t.qCj("ngModelChange",function(a){t.usT(e);const r=t.GaO(3);return t.CGJ(r.formValues.clearEntities=a)}),t.I0R(21,"mat-radio-button",16),t.OEk(22," Keep all entities not found in import "),t.C$Y(),t.I0R(23,"mat-radio-button",17),t.OEk(24," Remove all entities not found in import "),t.C$Y()()(),t.I0R(25,"p",18),t.OEk(26,"Remember to backup your DNN first!"),t.C$Y()(),t.I0R(27,"mat-dialog-actions",19)(28,"button",20),t.qCj("click",function(){t.usT(e);const a=t.GaO(3);return t.CGJ(a.closeDialog())}),t.OEk(29,"Cancel"),t.C$Y(),t.I0R(30,"button",21),t.qCj("click",function(){t.usT(e);const a=t.GaO(3);return t.CGJ(a.evaluateContent())}),t.OEk(31," Preview Import "),t.C$Y()()()}if(2&n){const e=t.GaO(3);t.yG2(6),t.cNF(e.formValues.file?e.formValues.file.name:"Select or drop file"),t.yG2(6),t.E7m("ngModel",e.formValues.resourcesReferences),t.yG2(8),t.E7m("ngModel",e.formValues.clearEntities),t.yG2(10),t.E7m("disabled",!e.formValues.file||!e.formValues.file.name)}}function P(n,p){1&n&&(t.I0R(0,"div",7)(1,"p"),t.OEk(2,"Please wait while processing..."),t.C$Y()())}function A(n,p){if(1&n&&(t.I0R(0,"div",7)(1,"p",23),t.OEk(2),t.C$Y(),t.I0R(3,"p",23),t.OEk(4,"File contains:"),t.C$Y(),t.I0R(5,"ul",24)(6,"li"),t.OEk(7),t.C$Y(),t.I0R(8,"li"),t.OEk(9),t.C$Y(),t.I0R(10,"li"),t.OEk(11),t.C$Y()(),t.I0R(12,"p",23),t.OEk(13,"If you press Import, it will:"),t.C$Y(),t.I0R(14,"ul",24)(15,"li"),t.OEk(16),t.C$Y(),t.I0R(17,"li"),t.OEk(18),t.C$Y(),t.I0R(19,"li"),t.OEk(20),t.C$Y(),t.I0R(21,"li"),t.OEk(22),t.C$Y()(),t.I0R(23,"p",18),t.OEk(24,"Note: The import validates much data and may take several minutes."),t.C$Y()()),2&n){const e=t.GaO(4),i=t.GaO();t.yG2(2),t.oRS("Try to import file '",i.formValues.file.name,"'"),t.yG2(5),t.oRS("",e.evaluationResult.Detail.DocumentElementsCount," content-items (records/entities)"),t.yG2(2),t.oRS("",e.evaluationResult.Detail.LanguagesInDocumentCount," languages"),t.yG2(2),t.CAO("",e.evaluationResult.Detail.AttributeNamesInDocument.length," columns: ",e.evaluationResult.Detail.AttributeNamesInDocument.join(", "),""),t.yG2(5),t.oRS("Create ",e.evaluationResult.Detail.AmountOfEntitiesCreated," content-items"),t.yG2(2),t.oRS("Update ",e.evaluationResult.Detail.AmountOfEntitiesUpdated," content-items"),t.yG2(2),t.oRS("Delete ",e.evaluationResult.Detail.AmountOfEntitiesDeleted," content-items"),t.yG2(2),t.CAO("Ignore ",e.evaluationResult.Detail.AttributeNamesNotImported.length," columns: ",e.evaluationResult.Detail.AttributeNamesNotImported.join(", "),"")}}function L(n,p){if(1&n&&(t.I0R(0,"div")(1,"i"),t.OEk(2),t.C$Y()()),2&n){const e=t.GaO().$implicit;t.yG2(2),t.oRS("Details: ",e.ErrorDetail,"")}}function b(n,p){if(1&n&&(t.I0R(0,"div")(1,"i"),t.OEk(2),t.C$Y()()),2&n){const e=t.GaO().$implicit;t.yG2(2),t.oRS("Line-no: ",e.LineNumber,"")}}function w(n,p){if(1&n&&(t.I0R(0,"div")(1,"i"),t.OEk(2),t.C$Y()()),2&n){const e=t.GaO().$implicit;t.yG2(2),t.oRS("Line-details: ",e.LineDetail,"")}}function B(n,p){if(1&n&&(t.I0R(0,"li")(1,"div"),t.OEk(2),t.C$Y(),t.yuY(3,L,3,1,"div")(4,b,3,1,"div")(5,w,3,1,"div"),t.C$Y()),2&n){const e=p.$implicit,i=t.GaO(6);t.yG2(2),t.cNF(i.errors[e.ErrorCode]),t.yG2(1),t.C0Y(3,e.ErrorDetail?3:-1),t.yG2(1),t.C0Y(4,e.LineNumber?4:-1),t.yG2(1),t.C0Y(5,e.LineDetail?5:-1)}}function K(n,p){if(1&n&&(t.I0R(0,"div",7)(1,"p",23),t.OEk(2),t.C$Y(),t.I0R(3,"ul",24),t.c53(4,B,6,4,"li",null,t.oxv),t.C$Y()()),2&n){const e=t.GaO(4),i=t.GaO();t.yG2(2),t.oRS("Try to import file '",i.formValues.file.name,"'"),t.yG2(2),t.oho(e.evaluationResult.Errors)}}function F(n,p){if(1&n){const e=t.KQA();t.yuY(0,A,25,10,"div",22)(1,K,6,1,"div",22),t.I0R(2,"mat-dialog-actions",19)(3,"button",20),t.qCj("click",function(){t.usT(e);const a=t.GaO(4);return t.CGJ(a.back())}),t.OEk(4,"Back"),t.C$Y(),t.I0R(5,"button",21),t.qCj("click",function(){t.usT(e);const a=t.GaO(4);return t.CGJ(a.importContent())}),t.OEk(6," Import "),t.C$Y()()}if(2&n){const e=t.GaO(3);t.C0Y(0,e.evaluationResult.Success?0:-1),t.yG2(1),t.C0Y(1,e.evaluationResult.Success?-1:1),t.yG2(4),t.E7m("disabled",!e.evaluationResult.Success)}}function N(n,p){if(1&n&&t.yuY(0,F,7,3,"mat-dialog-actions",19),2&n){const e=t.GaO(2);t.C0Y(0,e.evaluationResult?0:-1)}}function U(n,p){1&n&&(t.I0R(0,"p"),t.OEk(1,"Import done."),t.C$Y())}function j(n,p){1&n&&(t.I0R(0,"p"),t.OEk(1,"Import failed."),t.C$Y())}function W(n,p){if(1&n&&(t.I0R(0,"div",7),t.yuY(1,U,2,0,"p")(2,j,2,0,"p"),t.C$Y()),2&n){const e=t.GaO(3);t.yG2(1),t.C0Y(1,e.importResult.Success?1:-1),t.yG2(1),t.C0Y(2,e.importResult.Success?-1:2)}}function J(n,p){if(1&n){const e=t.KQA();t.yuY(0,W,3,2,"div",22),t.I0R(1,"mat-dialog-actions",19)(2,"button",25),t.qCj("click",function(){t.usT(e);const a=t.GaO(3);return t.CGJ(a.closeDialog())}),t.OEk(3,"Close"),t.C$Y()()}if(2&n){const e=t.GaO(2);t.C0Y(0,e.importResult?0:-1)}}function V(n,p){if(1&n&&t.yuY(0,k,32,4)(1,P,3,0)(2,N,1,1)(3,J,4,1),2&n){const e=t.GaO();let i;t.C0Y(0,1===(i=e.viewStateSelected)?0:0===i?1:2===i?2:3===i?3:-1)}}function Q(n,p){if(1&n){const e=t.KQA();t.I0R(0,"div",1),t.qCj("filesDropped",function(a){t.usT(e);const r=t.GaO();return t.CGJ(r.filesDropped(a))}),t.I0R(1,"div",2)(2,"div",3),t.OEk(3),t.C$Y()(),t.I0R(4,"div",4)(5,"p"),t.OEk(6," This will import content-items into 2sxc. It requires that you already defined the content-type before you try importing, and that you created the import-file using the template provided by the Export. Please visit "),t.I0R(7,"a",5),t.OEk(8,"https://2sxc.org/help"),t.C$Y(),t.OEk(9," for more instructions. "),t.C$Y()(),t.yuY(10,V,4,1),t.C$Y()}if(2&n){const e=t.GaO();t.E7m("allowedFileTypes","xml"),t.yG2(3),t.oRS("",null==p.contentType?null:p.contentType.Name," Import Data"),t.yG2(7),t.C0Y(10,null!=e.formValues?10:-1)}}let X=(()=>{class n{constructor(e,i,a,r,z,H){this.dialogData=e,this.dialogRef=i,this.route=a,this.contentImportService=r,this.appDialogConfigService=z,this.contentTypesService=H,this.hostClass="dialog-component",this.contentType$=new m.g(null),this.loading$=new m.g(!1),this.viewStates={waiting:0,default:1,evaluated:2,imported:3},this.viewStateSelected$=new m.g(this.viewStates.default),this.evaluationResult$=new m.g(null),this.importResult$=new m.g(null),this.viewModel$=(0,E.E)([this.contentType$,this.loading$,this.viewStateSelected$,this.evaluationResult$,this.importResult$]).pipe((0,y.k)(([Z,q,tt,et,nt])=>({contentType:Z,loading:q,viewStateSelected:tt,evaluationResult:et,importResult:nt}))),this.errors={0:"Unknown error occured.",1:"Selected content-type does not exist.",2:"Document is not a valid XML file.",3:"Selected content-type does not match the content-type in the XML file.",4:"The language is not supported.",5:"The document does not specify all languages for all entities.",6:"Language reference cannot be parsed, the language is not supported.",7:"Language reference cannot be parsed, the read-write protection is not supported.",8:"Value cannot be read, because of it has an invalid format."},this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName")}ngOnInit(){this.loading$.next(!0);const e=this.contentTypesService.retrieveContentType(this.contentTypeStaticName),i=this.appDialogConfigService.getCurrent$();(0,D.y)([e,i]).subscribe(([a,r])=>{this.contentType$.next(a),this.formValues={defaultLanguage:r.Context.Language.Primary,contentType:this.contentTypeStaticName,file:null!=this.dialogData.files?this.dialogData.files[0]:null,resourcesReferences:"Keep",clearEntities:"None"},this.loading$.next(!1)})}ngOnDestroy(){this.contentType$.complete(),this.loading$.complete(),this.viewStateSelected$.complete(),this.evaluationResult$.complete(),this.importResult$.complete()}closeDialog(){this.dialogRef.close()}evaluateContent(){this.viewStateSelected$.next(this.viewStates.waiting),this.contentImportService.evaluateContent(this.formValues).subscribe(e=>{this.evaluationResult$.next(e),this.viewStateSelected$.next(this.viewStates.evaluated)})}importContent(){this.viewStateSelected$.next(this.viewStates.waiting),this.contentImportService.importContent(this.formValues).subscribe(e=>{this.importResult$.next(e),this.viewStateSelected$.next(this.viewStates.imported)})}back(){this.viewStateSelected$.next(this.viewStates.default),this.evaluationResult$.next(null)}fileChange(e){this.formValues.file=e.target.files[0]}filesDropped(e){this.formValues.file=e[0]}static#t=this.\u0275fac=function(i){return new(i||n)(t.GI1(d.sR),t.GI1(d.yI),t.GI1(G.gV),t.GI1(l),t.GI1(g.m),t.GI1(T.X))};static#e=this.\u0275cmp=t.In1({type:n,selectors:[["app-content-import"]],hostVars:1,hostBindings:function(i,a){2&i&&t.SoX("className",a.hostClass)},standalone:!0,features:[t.M5G([l,T.X,g.m]),t.UHJ],decls:2,vars:3,consts:[["class","eav-dialog","appDragAndDrop","",3,"allowedFileTypes"],["appDragAndDrop","",1,"eav-dialog",3,"allowedFileTypes","filesDropped"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-description"],["href","https://2sxc.org/help","target","_blank"],["ngForm","ngForm"],[1,"eav-dialog-content"],["mat-raised-button","","tippy","Open file browser",3,"click"],["type","file",1,"hide",3,"change"],["fileInput",""],[1,"eav-radio-group-label"],["name","ResourcesReferences",1,"eav-radio-group",3,"ngModel","ngModelChange"],["value","Keep"],["value","Resolve"],["name","ClearEntities",1,"eav-radio-group",3,"ngModel","ngModelChange"],["value","None"],["value","All"],[1,"eav-hint"],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"disabled","click"],["class","eav-dialog-content"],[1,"eav-evaluation__title"],[1,"eav-evaluation__content"],["mat-raised-button","","color","accent",3,"click"]],template:function(i,a){if(1&i&&(t.yuY(0,Q,11,3,"div",0),t.wVc(1,"async")),2&i){let r;t.C0Y(0,(r=t.kDX(1,1,a.viewModel$))?0:-1,r)}},dependencies:[$.q,Y.Q,M.Y,O.y,O.sz,O.ue,O.u,O._G,O.SC,R.oJ,R.Gw,_.yk,_.cv,_.cT,d.Yp,v.a],styles:[".eav-radio-group-label[_ngcontent-%COMP%]{font-size:18px;margin:24px 0 0}.eav-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:8px 0}.eav-hint[_ngcontent-%COMP%]{font-size:18px;margin-top:24px;margin-bottom:16px}.eav-evaluation__title[_ngcontent-%COMP%]{font-size:18px;margin:24px 0 0;font-weight:700}.eav-evaluation__content[_ngcontent-%COMP%]{font-size:14px}.eav-evaluation__content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:2px 0}"]})}return n})()},3884:(S,I,o)=>{o.d(I,{Q:()=>D});var d=o(4896),m=o(3244),E=o(6884),y=o(4648);let D=(()=>{class g extends E.C{constructor(s,c,C){super(),this.zone=c,this.snackBar=C,this.markStyle="outline",this.allowedFileTypes="",this.filesDropped=new d._w7,this.dropAreaClass="eav-droparea",this.dragClass="eav-dragover",this.timeouts=[],this.element=s.nativeElement}ngOnInit(){this.markStyleClass=`eav-droparea-${this.markStyle}`,this.element.classList.add(this.dropAreaClass,this.markStyleClass),this.zone.runOutsideAngular(()=>{this.subscription.add((0,m.w)(this.element,"dragover").subscribe(s=>{s.preventDefault(),s.stopPropagation(),this.clearTimeouts(),this.element.classList.add(this.dragClass)})),this.subscription.add((0,m.w)(this.element,"dragleave").subscribe(s=>{s.preventDefault(),s.stopPropagation(),this.timeouts.push(window.setTimeout(()=>{this.element.classList.remove(this.dragClass)},50))}))})}ngOnDestroy(){this.clearTimeouts(),this.element.classList.remove(this.dropAreaClass,this.markStyleClass,this.dragClass),super.ngOnDestroy()}onDrop(s){s.preventDefault(),s.stopPropagation(),this.clearTimeouts(),this.element.classList.remove(this.dragClass);let C=Array.from(s.dataTransfer.files);C=this.filterTypes(C,this.allowedFileTypes),C.length>0&&this.filesDropped.emit(C)}clearTimeouts(){for(const s of this.timeouts)clearTimeout(s);this.timeouts=[]}filterTypes(s,c){if(""===c)return s;const C=c.split(",").map(u=>u.toLocaleLowerCase()),h=s.filter(u=>{const t=u.name.lastIndexOf(".");if(t<=0)return!1;const f=u.name.substring(t+1).toLocaleLowerCase();return C.includes(f)});if(s.length!==h.length){const u=this.allowedFileTypes.replace(/\,/g,", ");this.snackBar.open(h.length?"Some files were filtered out. This drop location only accepts file types: "+u:"This drop location only accepts file types: "+u,null,{duration:5e3})}return h}static#t=this.\u0275fac=function(c){return new(c||g)(d.GI1(d.GMv),d.GI1(d.WW2),d.GI1(y.yS))};static#e=this.\u0275dir=d.Sc5({type:g,selectors:[["","appDragAndDrop",""]],hostBindings:function(c,C){1&c&&d.qCj("drop",function(u){return C.onDrop(u)})},inputs:{markStyle:"markStyle",allowedFileTypes:"allowedFileTypes"},outputs:{filesDropped:"filesDropped"},features:[d.eg9]})}return g})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.06.04/dist/ng-edit/projects_eav-ui_src_app_content-import_content-import_component_ts.50ee28981449a9fa.js.map