"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_metadata_metadata_component_ts-projects_eav-ui_src_app_shared_service-802177","projects_eav-ui_src_app_permissions_permissions_routing_ts"],{3620:(I,u,e)=>{function i(c,r){return r(c)}function t(c,r){return r(c)}e.d(u,{C:()=>i,z:()=>t})},336:(I,u,e)=>{e.d(u,{F:()=>E});var i=e(4600),t=e(6647),c=e(271),r=e(8742),l=e(693),h=e(4435),p=e(9234),m=e(6474),C=e(7580);const T={getAll:!0,getAllSig:!0};let E=(()=>{class d extends m.D{constructor(){super(...arguments),this.log=(0,h.Tq)({ContentItemsService:d},T)}getAll(f){return this.log.fnIf("getAll",{contentTypeStaticName:f}),this.getHttpApiUrl(p.Gg,{params:{appId:this.appId,contentType:f}})}getAllSig(f,D){return this.log.fnIf("getAllSig",{contentTypeStaticName:f,initial:D}),this.getSignal(p.Gg,{params:{appId:this.appId,contentType:f}},D)}getColumns(f){return this.getHttpApiUrl(r.z,{params:{appId:this.appId,staticName:f}})}importItem(f){return(0,i.H)((0,l.n)(f)).pipe((0,t.n)(D=>this.http.post(this.apiUrl(p.gb+"upload"),{AppId:this.appId,ContentBase64:D})),(0,c.T)(D=>({Success:D,Messages:[]})))}static{this.\u0275fac=(()=>{let f;return function(F){return(f||(f=C.xGo(d)))(F||d)}})()}static{this.\u0275prov=C.jDH({token:d,factory:d.\u0275fac})}}return d})()},6686:(I,u,e)=>{e.r(u),e.d(u,{MetadataComponent:()=>Et});var i=e(316),t=e(7580),c=e(6256),r=e(4175),l=e(7941),h=e(3840),p=e(2159),m=e(3183),C=e(4334),T=e(271),E=e(2938),d=e(3620),j=e(336),f=e(9006),D=e(4096),F=e(1828),b=e(251),U=e(3216),x=e(4435),B=e(334),W=e(7037),R=e(9914),z=e(8471),v=e(6817),g=e(3777);function y(a,_){if(1&a&&(t.nrm(0,"mat-card-subtitle",0),t.nI1(1,"safeHtml")),2&a){const n=t.XpG();t.Y8G("innerHtml",t.bMT(1,1,n.dialogData.message),t.npT)}}let A=(()=>{class a{constructor(n,s){this.dialogData=n,this.dialog=s,this.hostClass="dialog-component"}closeDialog(n){this.dialog.close(n)}static{this.\u0275fac=function(s){return new(s||a)(t.rXU(l.Vh),t.rXU(l.CP))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-confirm-delete-dialog"]],hostVars:1,hostBindings:function(s,o){2&s&&t.Mr5("className",o.hostClass)},decls:10,vars:3,consts:[[3,"innerHtml"],["align","end"],["mat-raised-button","",1,"eav-card-action-button",3,"click"]],template:function(s,o){1&s&&(t.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3),t.k0s(),t.DNE(4,y,2,3,"mat-card-subtitle",0),t.k0s(),t.j41(5,"mat-card-actions",1)(6,"button",2),t.bIt("click",function(){return o.closeDialog()}),t.EFF(7,"Cancel"),t.k0s(),t.j41(8,"button",2),t.bIt("click",function(){return o.closeDialog(!0)}),t.EFF(9,"Delete"),t.k0s()()()),2&s&&(t.R7$(3),t.Lme("Delete ",o.dialogData.entityTitle," (",o.dialogData.entityId,")?"),t.R7$(),t.vxM(o.dialogData.message?4:-1))},dependencies:[g.Hu,g.RN,g.YY,g.MM,g.Lc,g.dh,r.Hl,r.$z,R.$],styles:[".eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}}return a})();var G=e(4646),Y=e(4601);let Z=(()=>{class a{agInit(n){this.params=n}refresh(n){return!0}deleteMetadata(){this.params.onDelete(this.params.data)}static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(s,o){1&s&&(t.j41(0,"div",0)(1,"div",1),t.bIt("click",function(){return o.deleteMetadata()}),t.j41(2,"mat-icon"),t.EFF(3,"delete"),t.k0s()()())},dependencies:[G.pZ,G.r6,h.m_,h.An,Y.e],encapsulation:2})}}return a})(),J=(()=>{class a{agInit(n){this.value=n.value,this.metadata=n.data}refresh(n){return!0}static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-content-type"]],decls:2,vars:2,consts:[[1,"container",3,"tippy"]],template:function(s,o){1&s&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&s&&(t.Y8G("tippy",o.metadata._Type.Description),t.R7$(),t.SpI(" ",o.value,"\n"))},dependencies:[Y.e],styles:[".container[_ngcontent-%COMP%]{width:fit-content}"]})}}return a})();var P=e(4456),$=e(4950),L=e(7984),N=e(5175),X=e(8827),Q=e(3037),w=e(1817),q=e(5445),tt=e(3758),H=e(5858),K=e(52),et=e(9333);const V=a=>({active:a});function nt(a,_){if(1&a&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&a){const n=_.$implicit;t.Y8G("value",n.value),t.R7$(),t.SpI(" ",n.name," ")}}function at(a,_){if(1&a&&(t.j41(0,"mat-form-field",2)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",13),t.Z7z(4,nt,2,2,"mat-option",14,t.fX1),t.j41(6,"mat-option",14),t.EFF(7,"Other..."),t.k0s()()(),t.j41(8,"app-field-hint"),t.EFF(9," The scope should almost never be changed - "),t.j41(10,"a",15),t.EFF(11,"see help"),t.k0s()()),2&a){const n=t.XpG();t.R7$(3),t.Y8G("placeholder",n.scopeOptions().length?"":"No items found"),t.R7$(),t.Dyx(n.scopeOptions()),t.R7$(2),t.Y8G("value",n.dropdownInsertValue)}}function ot(a,_){if(1&a&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&a){const n=_.$implicit;t.Y8G("value",n.NameId),t.R7$(),t.SpI(" ",n.Label," ")}}function it(a,_){if(1&a&&(t.j41(0,"mat-select",3),t.Z7z(1,ot,2,2,"mat-option",14,t.fX1),t.k0s()),2&a){let n;const s=t.XpG();t.Y8G("placeholder",null!=(n=s.contentTypes()())&&n.length?"":"No items found"),t.R7$(),t.Dyx(s.contentTypes()())}}function st(a,_){1&a&&t.nrm(0,"input",4)}function rt(a,_){1&a&&(t.j41(0,"app-field-hint",8),t.EFF(1," This field is required "),t.k0s()),2&a&&t.Y8G("isError",!0)}let lt=(()=>{class a{#n;constructor(n){this.dialog=n,this.hostClass="dialog-component",this.dropdownInsertValue=H.O,this.guidedContentType=!0,this.advancedMode=!1,this.#n=(0,E.d)(q.gs),this.scope=(0,t.vPA)(K.YX.scopes.default.value),this.scopeOptions=this.#n.getScopesSig(void 0),this.contentTypes=(0,t.EWP)(()=>{const s=this.scope();return this.#n.retrieveContentTypesSig(s,void 0)})}ngOnInit(){this.buildForm()}closeDialog(n){this.dialog.close(n)}toggleGuidedContentType(n){this.guidedContentType=n}toggleAdvancedMode(n){this.advancedMode=n.checked}confirm(){const n=this.form.getRawValue();this.closeDialog(n.contentType)}buildForm(){this.form=new P.J3({}),this.form.addControl("contentType",new P.hs(null,[P.k0.required])),this.form.addControl("scope",new P.hs(K.YX.scopes.default.value)),this.form.controls.scope.valueChanges.pipe((0,Q.Z)(this.form.controls.scope.value),(0,w.F)()).subscribe(n=>{null!=this.form.controls.contentType.value&&this.form.controls.contentType.patchValue(null),n===H.O?(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||K.YX.scopes.default.value,this.scopeOptions().some(s=>s.value===n)||this.scopeOptions.set([{name:n,value:n},...this.scopeOptions()]),this.form.controls.scope.patchValue(n)):this.scope.set(n)})}static{this.\u0275fac=function(s){return new(s||a)(t.rXU(l.CP))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata-save-dialog"]],hostVars:1,hostBindings:function(s,o){2&s&&t.Mr5("className",o.hostClass)},decls:33,vars:14,consts:[["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",1,"eav-mat-form-field"],["formControlName","contentType","required","",3,"placeholder"],["matInput","","type","text","formControlName","contentType","required",""],["matTextSuffix",""],["mat-icon-button","","type","button","tippy","Pick existing value",3,"click","ngClass"],["mat-icon-button","","type","button","tippy","Manual entry",3,"click","ngClass"],[3,"isError"],[1,"eav-card-actions"],["color","accent",3,"change","checked"],["mat-raised-button","",1,"eav-card-action-button",3,"click"],["mat-raised-button","","color","accent",1,"eav-card-action-button",3,"click","disabled"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""]],template:function(s,o){1&s&&(t.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3,"Create Metadata"),t.k0s(),t.j41(4,"mat-card-subtitle"),t.EFF(5," This is a special operation to add an item which is metadata for another item, see "),t.j41(6,"a",0),t.EFF(7,"docs"),t.k0s(),t.EFF(8,". "),t.k0s()(),t.j41(9,"mat-card-content")(10,"form",1),t.DNE(11,at,12,2),t.j41(12,"mat-form-field",2)(13,"mat-label"),t.EFF(14,"Content Type"),t.k0s(),t.DNE(15,it,3,1,"mat-select",3)(16,st,1,0,"input",4),t.j41(17,"div",5)(18,"button",6),t.bIt("click",function(){return o.toggleGuidedContentType(!0)}),t.j41(19,"mat-icon"),t.EFF(20,"search"),t.k0s()(),t.j41(21,"button",7),t.bIt("click",function(){return o.toggleGuidedContentType(!1)}),t.j41(22,"mat-icon"),t.EFF(23,"text_fields"),t.k0s()()()(),t.DNE(24,rt,2,1,"app-field-hint",8),t.k0s()(),t.j41(25,"mat-card-actions",9)(26,"mat-slide-toggle",10),t.bIt("change",function(S){return o.toggleAdvancedMode(S)}),t.EFF(27),t.k0s(),t.j41(28,"div")(29,"button",11),t.bIt("click",function(){return o.closeDialog()}),t.EFF(30,"Cancel"),t.k0s(),t.j41(31,"button",12),t.bIt("click",function(){return o.confirm()}),t.EFF(32," Confirm "),t.k0s()()()()),2&s&&(t.R7$(10),t.Y8G("formGroup",o.form),t.R7$(),t.vxM(o.advancedMode&&o.guidedContentType?11:-1),t.R7$(4),t.vxM(o.guidedContentType?15:-1),t.R7$(),t.vxM(o.guidedContentType?-1:16),t.R7$(2),t.Y8G("ngClass",t.eq3(10,V,o.guidedContentType)),t.R7$(3),t.Y8G("ngClass",t.eq3(12,V,!o.guidedContentType)),t.R7$(3),t.vxM(o.form.controls.contentType.touched&&null!=o.form.controls.contentType.errors&&o.form.controls.contentType.errors.required?24:-1),t.R7$(2),t.Y8G("checked",o.advancedMode),t.R7$(),t.SpI(" ",o.advancedMode?"Advanced":"Simple"," "),t.R7$(4),t.Y8G("disabled",!o.form.valid))},dependencies:[g.Hu,g.RN,g.YY,g.m2,g.MM,g.Lc,g.dh,P.YN,P.qT,P.me,P.BC,P.cb,P.YS,P.X1,P.j4,P.JD,$.RG,$.rl,$.nJ,$.yw,N.Ve,N.VO,G.wT,G.Sy,L.fS,L.fg,r.Hl,r.$z,r.iY,i.YU,h.m_,h.An,X.mV,X.sG,tt.F,et.c],styles:[".eav-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.eav-card-action-button[_ngcontent-%COMP%]{margin-left:8px}"]})}}return a})();var ct=e(3347),dt=e(9841);const pt=a=>({"fab-opened":a});function mt(a,_){1&a&&t.EFF(0," This item is not metadata for anything else. ")}function ut(a,_){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Key Number: ",n.itemFor().KeyNumber," ")}}function gt(a,_){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Key Guid: ",n.itemFor().KeyGuid," ")}}function ht(a,_){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Key String: ",n.itemFor().KeyString," ")}}function ft(a,_){if(1&a&&(t.nrm(0,"br"),t.EFF(1)),2&a){const n=t.XpG(2);t.R7$(),t.SpI("Title: ",n.itemFor().Title," ")}}function vt(a,_){if(1&a&&(t.EFF(0," This item is metadata for: "),t.nrm(1,"br"),t.EFF(2),t.nrm(3,"br"),t.EFF(4),t.DNE(5,ut,2,1)(6,gt,2,1)(7,ht,2,1)(8,ft,2,1)),2&a){const n=t.XpG();t.R7$(2),t.SpI("Target: ",n.itemFor().Target," "),t.R7$(2),t.SpI("TargetType: ",n.itemFor().TargetType," "),t.R7$(),t.vxM(n.itemFor().KeyNumber?5:-1),t.R7$(),t.vxM(n.itemFor().KeyGuid?6:-1),t.R7$(),t.vxM(n.itemFor().KeyString?7:-1),t.R7$(),t.vxM(n.itemFor().Title?8:-1)}}function _t(a,_){if(1&a){const n=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.createMetadata())}),t.j41(1,"mat-icon"),t.EFF(2,"add"),t.k0s()()}}function Ct(a,_){if(1&a&&(t.nrm(0,"div",19),t.nI1(1,"safeHtml")),2&a){const n=t.XpG().$implicit;t.Y8G("innerHTML",t.bMT(1,2,n.Icon),t.npT)("matBadgeHidden",n.Enabled)}}function Tt(a,_){1&a&&(t.j41(0,"mat-icon"),t.EFF(1,"add"),t.k0s())}function yt(a,_){if(1&a){const n=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){const o=t.eBV(n).$implicit,M=t.XpG(2);return t.Njj(M.createMetadata(o))}),t.DNE(1,Ct,2,4,"div",19)(2,Tt,2,0,"mat-icon"),t.k0s()}if(2&a){const n=_.$implicit;t.BMQ("label",n.Title),t.R7$(),t.vxM(n.Icon?1:2)}}function Dt(a,_){if(1&a){const n=t.RV6();t.j41(0,"eco-fab-speed-dial",11),t.bIt("openChange",function(o){t.eBV(n);const M=t.XpG();return t.Njj(M.openChange(o))}),t.j41(1,"eco-fab-speed-dial-trigger",12)(2,"button",13)(3,"mat-icon",14),t.EFF(4),t.k0s()()(),t.j41(5,"eco-fab-speed-dial-actions",15)(6,"button",16),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.createMetadata())}),t.j41(7,"mat-icon"),t.EFF(8,"search"),t.k0s()(),t.Z7z(9,yt,3,2,"button",17,t.fX1),t.k0s()()}if(2&a){const n=t.XpG();t.Y8G("ngClass",t.eq3(3,pt,n.fabOpen())),t.R7$(),t.Y8G("spin",!0),t.R7$(3),t.JRh(n.fabOpen()?"close":"add"),t.R7$(5),t.Dyx(n.recommendations())}}let Et=(()=>{class a{#n;#o;#e;#a;constructor(n,s,o,M,S){this.dialog=n,this.snackBar=s,this.matDialog=o,this.viewContainerRef=M,this.changeDetectorRef=S,this.log=(0,x.Tq)({MetadataComponent:a}),this.#n=(0,E.d)(v.R),this.#o=(0,E.d)(D.TI),this.#e=(0,E.d)(j.F),this.#a=(0,E.d)(z.c),this.gridOptions=this.#c(),this.fabOpen=(0,t.vPA)(!1),this.#t=(0,d.C)(this.#a.getParams(["targetType","keyType","key","title","contentTypeStaticName"]),O=>({targetType:parseInt(O.targetType,10),keyType:O.keyType,key:O.key,contentTypeStaticName:O.contentTypeStaticName})),this.#s=this.#e.getAllSig(this.#t.contentTypeStaticName,null),this.itemFor=(0,t.EWP)(()=>{const O=this.#s()?.find(k=>k.Guid===this.#t.key);return O?.For?O.For:void 0}),this.metadataSet=(0,t.vPA)({Items:[],Recommendations:[]}),this.recommendations=(0,t.EWP)(()=>{const O=this.metadataSet();return O.Recommendations.filter(k=>O.Items.filter(Mt=>Mt._Type.Id===k.Id).length<k.Count)}),this.title=(()=>{try{return decodeURIComponent(this.#a.getParam("title")??"")}catch{return console.error("Couldn't properly decode title"),this.#a.getParam("title")??""}})()}#t;#s;ngOnInit(){this.#i(),this.#a.doOnDialogClosed(()=>this.#i())}closeDialog(){this.dialog.close()}openChange(n){this.fabOpen.set(n)}createMetadata(n){if(n)return n.Enabled?void(n.CreateEmpty?(this.snackBar.open(`Creating ${n.Name}...`),this.#n.create(n.Id,{For:this.calculateItemFor("dummy").For}).subscribe({error:()=>{this.snackBar.open(`Creating ${n.Name} failed. Please check console for more info`,void 0,{duration:3e3}),this.#i()},next:()=>{this.snackBar.open(`Created ${n.Name}`,void 0,{duration:3e3}),this.#i()}})):this.createMetadataForm(n.Id)):void(0,f.j)(this.matDialog,n.MissingFeature,this.viewContainerRef,this.changeDetectorRef);this.matDialog.open(lt,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(o=>{null!=o&&this.createMetadataForm(o)})}createMetadataForm(n){const s={items:[this.calculateItemFor(n)]},o=(0,U.s)(s);this.#a.navRelative([`edit/${o}`]),this.changeDetectorRef.markForCheck()}calculateItemFor(n){const s=B.c.constructMetadataInfo(this.#t.targetType,this.#t.keyType,this.#t.key);return B.c.newMetadataFromInfo(n,s)}#i(){const n=this.log.rxTap("getMetadata");this.#o.getMetadata(this.#t.targetType,this.#t.keyType,this.#t.key).pipe(n.pipe(),(0,C.s)(1),(0,T.T)(s=>(s.Recommendations.forEach(o=>{o.Icon?.startsWith("base64:")&&(o.Icon=o.Icon.replace("base64:",""),o.Icon=window.atob(o.Icon),o.Icon=o.Icon.replace('fill="#000000"','fill="#ffffff"'))}),s)),n.map()).subscribe(s=>{this.metadataSet.set(s)})}#l(n){const s={items:[B.c.editId(n.Id)]},o=(0,U.s)(s);this.#a.navRelative([`edit/${o}`])}#r(n,s=!1){if(s)this.snackBar.open("Deleting..."),this.#n.delete(n._Type.Id,n.Id,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#i()},error:()=>{this.snackBar.open("Delete failed. Please check console for more information",null,{duration:3e3})}});else{const o={entityId:n.Id,entityTitle:n.Title,message:this.metadataSet().Recommendations.find(S=>S.Id===n._Type.Id)?.DeleteWarning};this.matDialog.open(A,{autoFocus:!1,data:o,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(S=>{S&&this.#r(n,!0)})}}#c(){return{...b.C,columnDefs:[{...F.r.IdWithDefaultRenderer,cellRendererParams:F.r.idFieldParamsTooltipGetter()},{...F.r.TextWide,field:"Title",onCellClicked:s=>this.#l(s.data)},{...F.r.TextWide,headerName:"Content Type",field:"ContentType",valueGetter:s=>`${s.data._Type.Name}${s.data._Type.Title!==s.data._Type.Name?` (${s.data._Type.Title})`:""}`,cellRenderer:J},{...F.r.ActionsPinnedRight1,cellRenderer:Z,cellRendererParams:{onDelete:s=>this.#r(s)}}]}}static{this.\u0275fac=function(s){return new(s||a)(t.rXU(l.CP),t.rXU(ct.UG),t.rXU(l.bZ),t.rXU(t.c1b),t.rXU(t.gRc))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-metadata"]],decls:17,vars:6,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab"],[1,"eav-eco-fab-speed-dial",3,"ngClass"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab",3,"click"],[1,"eav-eco-fab-speed-dial",3,"openChange","ngClass"],[3,"spin"],["mat-fab",""],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Other Content Type",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadge","\u{1f48e}","matBadgePosition","below after","aria-hidden","false",2,"color","white","fill","white",3,"innerHTML","matBadgeHidden"]],template:function(s,o){1&s&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return o.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"p"),t.DNE(9,mt,1,0)(10,vt,9,6),t.k0s(),t.nrm(11,"router-outlet"),t.j41(12,"div",5),t.nrm(13,"ag-grid-angular",6),t.k0s()(),t.j41(14,"mat-dialog-actions",7),t.DNE(15,_t,3,0,"button",8)(16,Dt,11,5,"eco-fab-speed-dial",9),t.k0s()()),2&s&&(t.R7$(3),t.SpI(" ",o.title||"Metadata"," "),t.R7$(6),t.vxM(o.itemFor()?10:9),t.R7$(4),t.Y8G("rowData",o.metadataSet().Items)("gridOptions",o.gridOptions),t.R7$(2),t.vxM(0===o.recommendations().length?15:-1),t.R7$(),t.vxM(o.recommendations().length>0?16:-1))},dependencies:[r.Hl,r.iY,r.$0,r.Sr,h.m_,h.An,p.n3,W.p,dt.xs,l.E7,m.TE,i.YU,m.p1,m.yf,c.Y,c.k,R.$],styles:["[_nghost-%COMP%]     .mat-button-wrapper div svg *:not([fill]){fill:#fff}"]})}}return a})()},2437:(I,u,e)=>{e.d(u,{k:()=>t});var i=e(52);let t=(()=>{class c{static{this.route={path:"permissions/:targetType/:keyType/:key",loadChildren:()=>e.e("projects_eav-ui_src_app_permissions_permissions_routing_ts").then(e.bind(e,3516)).then(l=>l.permissionRoutes),data:{title:"Permissions"}}}static getUrl(l,h,p){return`permissions/${l}/${h}/${p}`}static getUrlApp(l){return this.getUrl(i.YX.metadata.app.targetType,i.YX.metadata.app.keyType,l.toString())}static getUrlAttribute(l){return this.getUrl(i.YX.metadata.attribute.targetType,i.YX.metadata.attribute.keyType,l.toString())}static getUrlContentType(l){return this.getUrlEntity(l)}static getUrlEntity(l){return this.getUrl(i.YX.metadata.entity.targetType,i.YX.metadata.entity.keyType,l)}static getUrlLanguage(l){return this.getUrl(i.YX.metadata.language.targetType,i.YX.metadata.language.keyType,l)}}return c})()},4096:(I,u,e)=>{e.d(u,{Kn:()=>h.K,TI:()=>l.T,k4:()=>i.k});var i=e(2437),l=(e(2365),e(3516),e(2458),e(401)),h=e(4900)},2365:(I,u,e)=>{e.d(u,{v:()=>t});var i=e(9204);const t={name:"SET_PERMISSIONS_DIALOG",initContext:!0,panelSize:"large",panelClass:null,getComponent:()=>(0,i.A)(function*(){const{PermissionsComponent:c}=yield Promise.all([e.e("default-node_modules_angular_forms_fesm2022_forms_mjs"),e.e("default-projects_eav-ui_src_app_shared_directives_tippy_directive_ts"),e.e("default-node_modules_angular_material_fesm2022_radio_mjs"),e.e("default-projects_eav-ui_src_app_shared_ag-grid_column-definitions_ts-projects_eav-ui_src_app_-3cb379"),e.e("projects_eav-ui_src_app_permissions_permissions_component_ts")]).then(e.bind(e,2458));return c})()}},2458:(I,u,e)=>{e.r(u),e.d(u,{PermissionsComponent:()=>W});var i=e(7580),t=e(4175),c=e(7941),r=e(3840),l=e(2159),h=e(2938),p=e(3620),m=e(1828),C=e(251),T=e(52),E=e(3216),d=e(334),j=e(7037),f=e(8471),D=e(4646),F=e(4601);let b=(()=>{class R{agInit(v){this.params=v}refresh(v){return!0}deletePermission(){this.params.onDelete(this.params.data)}static{this.\u0275fac=function(g){return new(g||R)}}static{this.\u0275cmp=i.VBU({type:R,selectors:[["app-permissions-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(g,y){1&g&&(i.j41(0,"div",0)(1,"div",1),i.bIt("click",function(){return y.deletePermission()}),i.j41(2,"mat-icon"),i.EFF(3,"delete"),i.k0s()()())},dependencies:[D.pZ,D.r6,r.m_,r.An,F.e],encapsulation:2})}}return R})();var U=e(4900),x=e(3347),B=e(9841);let W=(()=>{class R{#n;#o;#e;#a;constructor(v,g){this.dialog=v,this.snackBar=g,this.gridOptions=this.buildGridOptions(),this.permissions=(0,i.vPA)([]),this.#n=(0,h.d)(U.K),this.#o=(0,h.d)(f.c),this.#e=(0,p.C)(this.#o.getParams(["targetType","keyType","key"]),y=>({targetType:parseInt(y.targetType,10),keyType:y.keyType,key:y.key})),this.#a={[T.YX.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.#t(),this.#o.doOnDialogClosed(()=>this.#t())}closeDialog(){this.dialog.close()}#t(){this.#n.getAll(this.#e.targetType,this.#e.keyType,this.#e.key).subscribe(v=>{this.permissions.set(v)})}editPermission(v){let g;g=null==v?{items:[{...d.c.newMetadataFromInfo(T.YX.contentTypes.permissions,d.c.constructMetadataInfo(this.#e.targetType,this.#e.keyType,this.#e.key)),...this.#a[this.#e.targetType]&&{Prefill:this.#a[this.#e.targetType]}}]}:{items:[d.c.editId(v.Id)]};const y=(0,E.s)(g);this.#o.navRelative([`edit/${y}`])}deletePermission(v){confirm(`Delete '${v.Title}' (${v.Id})?`)&&(this.snackBar.open("Deleting..."),this.#n.delete(v.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#t()}))}buildGridOptions(){return{...C.C,columnDefs:[{...m.r.Id,cellRendererParams:m.r.idFieldParamsTooltipGetter()},{...m.r.TextWide,headerName:"Name",field:"Title",sort:"asc",onCellClicked:g=>{this.editPermission(g.data)}},{...m.r.TextWide,field:"Identity"},{...m.r.TextWide,field:"Condition"},{...m.r.Character,field:"Grant"},{...m.r.ActionsPinnedRight1,cellRenderer:b,cellRendererParams:{onDelete:y=>this.deletePermission(y)}}]}}static{this.\u0275fac=function(g){return new(g||R)(i.rXU(c.CP),i.rXU(x.UG))}}static{this.\u0275cmp=i.VBU({type:R,selectors:[["app-permissions"]],decls:15,vars:2,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(g,y){1&g&&(i.j41(0,"div",0)(1,"div",1)(2,"div",2),i.EFF(3,"Permissions"),i.k0s(),i.j41(4,"button",3),i.bIt("click",function(){return y.closeDialog()}),i.j41(5,"mat-icon"),i.EFF(6,"close"),i.k0s()()(),i.j41(7,"div",4),i.nrm(8,"router-outlet"),i.j41(9,"div",5),i.nrm(10,"ag-grid-angular",6),i.k0s(),i.j41(11,"mat-dialog-actions",7)(12,"button",8),i.bIt("click",function(){return y.editPermission(null)}),i.j41(13,"mat-icon"),i.EFF(14,"add"),i.k0s()()()()()),2&g&&(i.R7$(10),i.Y8G("rowData",y.permissions())("gridOptions",y.gridOptions))},dependencies:[t.Hl,t.iY,t.Sr,r.m_,r.An,l.n3,c.E7,j.p,B.xs],encapsulation:2})}}return R})()},3516:(I,u,e)=>{e.r(u),e.d(u,{permissionRoutes:()=>r});var i=e(5544),t=e(2365),c=e(1195);const r=[{path:"",component:i.DialogEntryComponent,data:{dialog:t.v},children:c.RD}]},401:(I,u,e)=>{e.d(u,{T:()=>r});var i=e(6474),t=e(7580);let r=(()=>{class l extends i.D{getMetadata(p,m,C,T){return this.getHttp("admin/metadata/get",{params:{appId:this.appId,targetType:p.toString(),keyType:m,key:C.toString(),...T&&{contentType:T}}})}static{this.\u0275fac=(()=>{let p;return function(C){return(p||(p=t.xGo(l)))(C||l)}})()}static{this.\u0275prov=t.jDH({token:l,factory:l.\u0275fac})}}return l})()},4900:(I,u,e)=>{e.d(u,{K:()=>p});var i=e(271),t=e(2938),c=e(52),r=e(6817),l=e(401),h=e(7580);let p=(()=>{class m{constructor(){this.metadataService=(0,t.d)(l.T),this.entitiesService=(0,t.d)(r.R)}getAll(T,E,d){return this.metadataService.getMetadata(T,E,d,c.YX.contentTypes.permissions).pipe((0,i.T)(j=>j.Items))}delete(T){return this.entitiesService.delete(c.YX.contentTypes.permissions,T,!1)}static{this.\u0275fac=function(E){return new(E||m)}}static{this.\u0275prov=h.jDH({token:m,factory:m.\u0275fac})}}return m})()},3758:(I,u,e)=>{e.d(u,{F:()=>E});var i=e(316),t=e(7580),c=e(4950);const r=["*"],l=d=>({"hint-box__short":d});function h(d,j){1&d&&t.eu8(0)}function p(d,j){if(1&d&&(t.j41(0,"mat-hint"),t.DNE(1,h,1,0,"ng-container",2),t.k0s()),2&d){t.XpG();const f=t.sdS(4);t.R7$(),t.Y8G("ngTemplateOutlet",f)}}function m(d,j){1&d&&t.eu8(0)}function C(d,j){if(1&d&&(t.j41(0,"mat-error"),t.DNE(1,m,1,0,"ng-container",2),t.k0s()),2&d){t.XpG();const f=t.sdS(4);t.R7$(),t.Y8G("ngTemplateOutlet",f)}}function T(d,j){1&d&&t.SdG(0)}let E=(()=>{class d{constructor(){this.isError=(0,t.hFB)(!1),this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static{this.\u0275fac=function(D){return new(D||d)}}static{this.\u0275cmp=t.VBU({type:d,selectors:[["app-field-hint"]],inputs:{isError:[1,"isError"]},ngContentSelectors:r,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(D,F){if(1&D){const b=t.RV6();t.NAR(),t.j41(0,"div",1),t.bIt("click",function(){return t.eBV(b),t.Njj(F.toggleIsShort())}),t.DNE(1,p,2,1,"mat-hint")(2,C,2,1,"mat-error"),t.k0s(),t.DNE(3,T,1,0,"ng-template",null,0,t.C5r)}if(2&D){let b;t.Y8G("ngClass",t.eq3(2,l,F.isShort)),t.R7$(),t.vxM(!1===(b=F.isError())?1:!0===b?2:-1)}},dependencies:[c.RG,c.MV,c.TL,i.YU,i.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}}return d})()},5858:(I,u,e)=>{e.d(u,{O:()=>i});const i="DROPDOWN_INSERT_VALUE"},9333:(I,u,e)=>{e.d(u,{c:()=>c});var i=e(4435),t=e(7580);let c=(()=>{class r{constructor(){this.log=(0,i.Tq)({ClickStopPropagationDirective:r}),this.log.a("constructor")}onClick(h){this.log.a("onClick",{event:h}),h.stopPropagation()}static{this.\u0275fac=function(p){return new(p||r)}}static{this.\u0275dir=t.FsC({type:r,selectors:[["","appClickStopPropagation",""]],hostBindings:function(p,m){1&p&&t.bIt("click",function(T){return m.onClick(T)})}})}}return r})()},6817:(I,u,e)=>{e.d(u,{R:()=>r});var i=e(9234),t=e(6474),c=e(7580);let r=(()=>{class l extends t.D{create(p,m){return this.http.post(`app/auto/data/${p}`,m,{params:{appId:this.appId,zoneId:this.zoneId}})}update(p,m,C){return this.http.post(`app/auto/data/${p}/${m}`,C,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(p,m,C){return this.http.delete(this.apiUrl(i.gb+"delete"),{params:{contentType:p,id:m.toString(),appId:this.appId,force:C.toString()}})}static{this.\u0275fac=(()=>{let p;return function(C){return(p||(p=c.xGo(l)))(C||l)}})()}static{this.\u0275prov=c.jDH({token:l,factory:l.\u0275fac})}}return l})()},4979:(I,u,e)=>{e.d(u,{V:()=>c});var i=e(7092),t=e(7580);let c=(()=>{class r{constructor(){this.subscriptions=new i.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(p){return new(p||r)}}static{this.\u0275prov=t.jDH({token:r,factory:r.\u0275fac})}}return r})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/19.03.01/dist/ng-edit/projects_eav-ui_src_app_metadata_metadata_component_ts-projects_eav-ui_src_app_shared_service-802177.3cf1df465b1204a3.js.map