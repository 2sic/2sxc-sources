(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{Pjf9:function(e,t,n){"use strict";n.r(t),n.d(t,"ContentTypeFieldsComponent",function(){return Q});var i=n("mrSG"),o=n("DR3G"),a=n("tyNb"),r=n("2Vo4"),s=n("quSY"),c=n("cp0P"),l=n("w1tV"),p=n("5+tZ"),d=n("pLZG"),u=n("JX91"),f=n("lJxs"),h=n("Zy1z"),m=n("OAPY"),b=n("Tgur"),g=n("1HxE"),y=n("qb9A"),v=n("X9FW"),T=n("bv8H"),w=n("3btq"),D=n("fXoL"),C=n("ofXK"),I=n("FKr1"),F=n("Qu3c"),S=n("STbY"),V=n("NFeN"),U=n("TU8p");function k(e,t){if(1&e&&(D.Vb(0,"mat-icon",11),D.Mc(1," person "),D.Ub()),2&e){var n=D.hc(2);D.nc("matBadge",n.field.Permissions.Count)}}function N(e,t){1&e&&(D.Vb(0,"mat-icon"),D.Mc(1,"person"),D.Ub())}function R(e,t){if(1&e){var n=D.Wb();D.Vb(0,"div",8),D.dc("click",function(){return D.Ac(n),D.hc().openPermissions()}),D.Kc(1,k,2,1,"mat-icon",9),D.Kc(2,N,2,0,"mat-icon",10),D.Ub()}if(2&e){var i=D.hc();D.Db(1),D.nc("ngIf",i.field.Permissions.Count),D.Db(1),D.nc("ngIf",!i.field.Permissions.Count)}}function M(e,t){1&e&&(D.Vb(0,"div",12),D.Vb(1,"mat-icon"),D.Mc(2,"person"),D.Ub(),D.Ub())}var O=function(){function e(){}return e.prototype.agInit=function(e){this.params=e,this.field=this.params.data,this.enablePermissions=this.field.InputType===w.a.StringWysiwyg||this.field.Type===T.a.Hyperlink},e.prototype.refresh=function(e){return!0},e.prototype.rename=function(){this.params.onRename(this.field)},e.prototype.openPermissions=function(){this.params.onOpenPermissions(this.field)},e.prototype.deleteField=function(){this.params.onDelete(this.field)},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=D.Jb({type:e,selectors:[["app-content-type-fields-actions"]],decls:18,vars:4,consts:[[1,"actions-component"],["class","like-button highlight","matRipple","","matTooltip","Permissions",3,"click",4,"ngIf"],["class","like-button disabled",4,"ngIf"],["matRipple","","matTooltip","More",1,"like-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["menu","matMenu"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"disabled","click"],["matRipple","","matTooltip","Permissions",1,"like-button","highlight",3,"click"],["matBadgePosition","after","matBadgeColor","accent","matBadgeSize","small",3,"matBadge",4,"ngIf"],[4,"ngIf"],["matBadgePosition","after","matBadgeColor","accent","matBadgeSize","small",3,"matBadge"],[1,"like-button","disabled"]],template:function(e,t){if(1&e&&(D.Vb(0,"div",0),D.Kc(1,R,3,2,"div",1),D.Kc(2,M,3,0,"div",2),D.Vb(3,"div",3),D.Vb(4,"mat-icon"),D.Mc(5,"more_horiz"),D.Ub(),D.Ub(),D.Ub(),D.Vb(6,"mat-menu",4,5),D.Vb(8,"button",6),D.dc("click",function(){return t.rename()}),D.Vb(9,"mat-icon"),D.Mc(10,"text_fields"),D.Ub(),D.Vb(11,"span"),D.Mc(12,"Rename"),D.Ub(),D.Ub(),D.Vb(13,"button",7),D.dc("click",function(){return t.deleteField()}),D.Vb(14,"mat-icon"),D.Mc(15,"delete"),D.Ub(),D.Vb(16,"span"),D.Mc(17,"Delete"),D.Ub(),D.Ub(),D.Ub()),2&e){var n=D.yc(7);D.Db(1),D.nc("ngIf",t.enablePermissions),D.Db(1),D.nc("ngIf",!t.enablePermissions),D.Db(1),D.nc("matMenuTriggerFor",n),D.Db(10),D.nc("disabled",t.field.IsTitle)}},directives:[C.n,I.p,F.a,S.d,V.a,S.a,S.b,U.a],styles:[""],changeDetection:0}),e}(),A=function(){function e(){}return e.prototype.agInit=function(e){this.value=e.value},e.prototype.refresh=function(e){return!0},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=D.Jb({type:e,selectors:[["app-content-type-fields-input-type"]],decls:6,vars:1,consts:[["matRipple","",1,"input-component","highlight"],[1,"text"],[1,"like-button"]],template:function(e,t){1&e&&(D.Vb(0,"div",0),D.Vb(1,"div",1),D.Mc(2),D.Ub(),D.Vb(3,"div",2),D.Vb(4,"mat-icon"),D.Mc(5,"arrow_drop_down"),D.Ub(),D.Ub(),D.Ub()),2&e&&(D.Db(2),D.Nc(t.value))},directives:[I.p,V.a],styles:[""],changeDetection:0}),e}();function P(e,t){1&e&&(D.Vb(0,"mat-icon",3),D.Mc(1,"functions"),D.Ub())}function x(e,t){1&e&&(D.Vb(0,"mat-icon",4),D.Mc(1,"mobiledata_off"),D.Ub())}var E=function(){function e(){}return e.prototype.agInit=function(e){var t=e.data;this.hasFormulas=t.HasFormulas,this.isEphemeral=t.IsEphemeral},e.prototype.refresh=function(e){return!0},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=D.Jb({type:e,selectors:[["app-content-type-fields-special"]],decls:3,vars:2,consts:[[1,"icon-container"],["matTooltip","Has Formulas",4,"ngIf"],["matTooltip","Ephemeral / Temporary, won't save",4,"ngIf"],["matTooltip","Has Formulas"],["matTooltip","Ephemeral / Temporary, won't save"]],template:function(e,t){1&e&&(D.Vb(0,"div",0),D.Kc(1,P,2,0,"mat-icon",1),D.Kc(2,x,2,0,"mat-icon",2),D.Ub()),2&e&&(D.Db(1),D.nc("ngIf",t.hasFormulas),D.Db(1),D.nc("ngIf",t.isEphemeral))},directives:[C.n,V.a,F.a],styles:[""],changeDetection:0}),e}();function j(e,t){1&e&&D.Qb(0,"mat-icon",4)}function $(e,t){1&e&&(D.Vb(0,"mat-icon"),D.Mc(1,"star_outline"),D.Ub())}var B=function(){function e(){}return e.prototype.agInit=function(e){this.isTitle=e.value},e.prototype.refresh=function(e){return!0},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=D.Jb({type:e,selectors:[["app-content-type-fields-title"]],decls:4,vars:2,consts:[[1,"actions-component"],["matRipple","","matTooltip","Use as title field",1,"like-button","highlight"],["svgIcon","star",4,"ngIf"],[4,"ngIf"],["svgIcon","star"]],template:function(e,t){1&e&&(D.Vb(0,"div",0),D.Vb(1,"div",1),D.Kc(2,j,1,0,"mat-icon",2),D.Kc(3,$,2,0,"mat-icon",3),D.Ub(),D.Ub()),2&e&&(D.Db(2),D.nc("ngIf",t.isTitle),D.Db(1),D.nc("ngIf",!t.isTitle))},directives:[I.p,F.a,C.n,V.a],styles:[""],changeDetection:0}),e}(),K=n("8gzK"),J=function(){function e(){}return e.prototype.agInit=function(e){this.value=e.value,this.icon=Object(K.a)(this.value)},e.prototype.refresh=function(e){return!0},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=D.Jb({type:e,selectors:[["app-content-type-fields-type"]],decls:3,vars:2,consts:[[1,"icon-container",3,"matTooltip"]],template:function(e,t){1&e&&(D.Vb(0,"div",0),D.Vb(1,"mat-icon"),D.Mc(2),D.Ub(),D.Ub()),2&e&&(D.nc("matTooltip",t.value),D.Db(2),D.Nc(t.icon))},directives:[F.a,V.a],styles:[""],changeDetection:0}),e}(),G=n("0IaG"),W=n("uwFg"),z=n("spPA"),H=n("dNgK"),_=n("bTqV"),q=n("gwh1"),Q=function(){function e(e,t,n,a,c,l){this.dialogRef=e,this.route=t,this.router=n,this.contentTypesService=a,this.contentTypesFieldsService=c,this.snackBar=l,this.contentType$=new r.a(null),this.fields$=new r.a(null),this.modules=o.a,this.gridOptions=Object(i.a)(Object(i.a)({},g.a),{getRowClass:function(e){var t=e.data;return t.InputType===w.a.EmptyDefault?"group-start-row":t.InputType===w.a.EmptyEnd?"group-end-row":""},frameworkComponents:{contentTypeFieldsTitleComponent:B,contentTypeFieldsTypeComponent:J,contentTypeFieldsInputTypeComponent:A,contentTypeFieldsSpecialComponent:E,contentTypeFieldsActionsComponent:O},columnDefs:[{rowDrag:!0,width:18,cellClass:"no-select no-padding no-outline"},{headerName:"Title",field:"IsTitle",width:42,cellClass:"secondary-action no-padding no-outline",cellRenderer:"contentTypeFieldsTitleComponent",onCellClicked:this.setTitle.bind(this)},{headerName:"Name",field:"StaticName",flex:2,minWidth:250,cellClass:"primary-action highlight",sortable:!0,filter:"agTextColumnFilter",onCellClicked:this.editFieldMetadata.bind(this)},{headerName:"Type",field:"Type",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",cellRenderer:"contentTypeFieldsTypeComponent"},{headerName:"Input",field:"InputType",width:160,cellClass:"secondary-action no-padding",sortable:!0,filter:"agTextColumnFilter",cellRenderer:"contentTypeFieldsInputTypeComponent",onCellClicked:this.changeInputType.bind(this),valueGetter:this.inputTypeValueGetter},{headerName:"Label",field:"Metadata.All.Name",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter"},{headerName:"Special",width:66,headerClass:"dense",cellClass:"no-outline",cellRenderer:"contentTypeFieldsSpecialComponent"},{headerName:"Notes",field:"Metadata.All.Notes",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter"},{width:80,cellClass:"secondary-action no-padding",cellRenderer:"contentTypeFieldsActionsComponent",pinned:"right",cellRendererParams:{onRename:this.rename.bind(this),onDelete:this.delete.bind(this),onOpenPermissions:this.openPermissions.bind(this)}}]}),this.sortApplied=!1,this.filterApplied=!1,this.rowDragSuppressed=!1,this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName"),this.subscription=new s.a}return e.prototype.ngOnInit=function(){this.fetchFields(),this.refreshOnChildClosed()},e.prototype.ngOnDestroy=function(){this.contentType$.complete(),this.fields$.complete(),this.subscription.unsubscribe()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.onGridReady=function(e){this.gridApi=e.api},e.prototype.onRowDragEnter=function(e){this.gridApi.setEnableCellTextSelection(!1)},e.prototype.onRowDragEnd=function(e){var t=this;this.gridApi.setSuppressRowDrag(!0);var n=this.fields$.value.map(function(e){return e.Id});this.contentTypesFieldsService.reOrder(n,this.contentType$.value).subscribe(function(e){t.fetchFields(function(){t.gridApi.setEnableCellTextSelection(!0),t.gridApi.setSuppressRowDrag(!1)})})},e.prototype.onRowDragMove=function(e){var t=e.node,n=e.overNode;if(n&&t!==n){var o=t.data,a=n.data,r=Object(i.h)(this.fields$.value),s=r.indexOf(o),c=r.indexOf(a);this.moveInArray(r,s,c),this.fields$.next(r),this.gridApi.clearFocusedCell()}},e.prototype.moveInArray=function(e,t,n){var i=e[t];e.splice(t,1),e.splice(n,0,i)},e.prototype.onSortChanged=function(e){var t=this.gridApi.getSortModel();this.sortApplied=t.length>0,this.suppressRowDrag()},e.prototype.onFilterChanged=function(e){var t=this.gridApi.getFilterModel(),n=Object.keys(t);this.filterApplied=n.length>0,this.suppressRowDrag()},e.prototype.suppressRowDrag=function(){var e=this.sortApplied||this.filterApplied;e&&!this.rowDragSuppressed?(this.rowDragSuppressed=!0,this.gridApi.setSuppressRowDrag(!0)):!e&&this.rowDragSuppressed&&(this.rowDragSuppressed=!1,this.gridApi.setSuppressRowDrag(!1))},e.prototype.add=function(){this.router.navigate(["add/"+this.contentTypeStaticName],{relativeTo:this.route})},e.prototype.inputTypeValueGetter=function(e){var t=e.data;return t.InputType.substring(t.InputType.indexOf("-")+1)},e.prototype.fetchFields=function(e){var t=this;if(null==this.contentType$.value){var n=this.contentTypesService.retrieveContentType(this.contentTypeStaticName).pipe(Object(l.a)()),o=n.pipe(Object(p.a)(function(e){return t.contentTypesFieldsService.getFields(e)}));Object(c.a)([n,o]).subscribe(function(n){var o=Object(i.g)(n,2),a=o[1];t.contentType$.next(o[0]),t.fields$.next(a),null!=e&&e()})}else this.contentTypesFieldsService.getFields(this.contentType$.value).subscribe(function(n){t.fields$.next(n),null!=e&&e()})},e.prototype.editFieldMetadata=function(e){var t=e.data,n={items:[this.createItemDefinition(t,"All"),this.createItemDefinition(t,t.Type),this.createItemDefinition(t,t.InputType)]},i=Object(v.a)(n);this.router.navigate(["edit/"+i],{relativeTo:this.route})},e.prototype.createItemDefinition=function(e,t){return null!=e.Metadata[t]?{EntityId:e.Metadata[t].Id}:{ContentTypeName:"@"+t,For:{Target:y.a.metadata.attribute.target,Number:e.Id},Prefill:{Name:e.StaticName}}},e.prototype.setTitle=function(e){var t=this,n=e.data;this.snackBar.open("Setting title..."),this.contentTypesFieldsService.setTitle(n,this.contentType$.value).subscribe(function(){t.snackBar.open("Title set",null,{duration:2e3}),t.fetchFields()})},e.prototype.changeInputType=function(e){this.router.navigate(["update/"+this.contentTypeStaticName+"/"+e.data.Id],{relativeTo:this.route})},e.prototype.rename=function(e){var t=this,n=prompt("What new name would you like for '"+e.StaticName+"' ("+e.Id+")?",e.StaticName);if(null!==n&&(n=n.trim().replace(/\s\s+/g," "))!==e.StaticName){for(;!n.match(m.b);){if(null===(n=prompt("What new name would you like for '"+e.StaticName+"' ("+e.Id+")?\n"+m.a,n)))return;if((n=n.trim().replace(/\s\s+/g," "))===e.StaticName)return}this.snackBar.open("Saving..."),this.contentTypesFieldsService.rename(e,this.contentType$.value,n).subscribe(function(){t.snackBar.open("Saved",null,{duration:2e3}),t.fetchFields()})}},e.prototype.delete=function(e){var t=this;confirm("Are you sure you want to delete '"+e.StaticName+"' ("+e.Id+")?")&&(this.snackBar.open("Deleting..."),this.contentTypesFieldsService.delete(e,this.contentType$.value).subscribe(function(e){t.snackBar.open("Deleted",null,{duration:2e3}),t.fetchFields()}))},e.prototype.openPermissions=function(e){this.router.navigate([b.a.goAttribute(e.Id)],{relativeTo:this.route})},e.prototype.refreshOnChildClosed=function(){var e=this;this.subscription.add(this.router.events.pipe(Object(d.a)(function(e){return e instanceof a.b}),Object(u.a)(!!this.route.snapshot.firstChild),Object(f.a)(function(){return!!e.route.snapshot.firstChild}),Object(h.a)(),Object(d.a)(function(e){var t=Object(i.g)(e,2);return t[0]&&!t[1]})).subscribe(function(){e.fetchFields()}))},e.\u0275fac=function(t){return new(t||e)(D.Pb(G.f),D.Pb(a.a),D.Pb(a.c),D.Pb(W.a),D.Pb(z.a),D.Pb(H.b))},e.\u0275cmp=D.Jb({type:e,selectors:[["app-content-type-fields"]],decls:17,vars:8,consts:[[1,"nav-component-wrapper"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","matTooltip","Close dialog",3,"click"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","modules","gridOptions","rowDragEnter","rowDragEnd","rowDragMove","gridReady","sortChanged","filterChanged"],[1,"grid-more-actions-box"],["mat-fab","","mat-elevation-z24","","matTooltip","Add fields",1,"grid-fab",3,"click"]],template:function(e,t){var n;1&e&&(D.Vb(0,"div",0),D.Vb(1,"div",1),D.Vb(2,"div",2),D.Vb(3,"div"),D.Mc(4),D.ic(5,"async"),D.Ub(),D.Vb(6,"button",3),D.dc("click",function(){return t.closeDialog()}),D.Vb(7,"mat-icon"),D.Mc(8,"close"),D.Ub(),D.Ub(),D.Ub(),D.Ub(),D.Qb(9,"router-outlet"),D.Vb(10,"div",4),D.Vb(11,"ag-grid-angular",5),D.dc("rowDragEnter",function(e){return t.onRowDragEnter(e)})("rowDragEnd",function(e){return t.onRowDragEnd(e)})("rowDragMove",function(e){return t.onRowDragMove(e)})("gridReady",function(e){return t.onGridReady(e)})("sortChanged",function(e){return t.onSortChanged(e)})("filterChanged",function(e){return t.onFilterChanged(e)}),D.ic(12,"async"),D.Ub(),D.Qb(13,"div",6),D.Vb(14,"button",7),D.dc("click",function(){return t.add()}),D.Vb(15,"mat-icon"),D.Mc(16,"add"),D.Ub(),D.Ub(),D.Ub(),D.Ub()),2&e&&(D.Db(4),D.Oc("",null==(n=D.jc(5,4,t.contentType$))?null:n.Name," Fields"),D.Db(7),D.nc("rowData",D.jc(12,6,t.fields$))("modules",t.modules)("gridOptions",t.gridOptions))},directives:[G.g,_.a,F.a,V.a,a.e,q.a],pipes:[C.b],styles:[""],changeDetection:0}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/12.02.00/ng-edit/content-type-fields-component.b6632629bc3424a65528.js.map