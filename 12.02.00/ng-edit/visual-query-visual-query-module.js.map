{"version":3,"sources":["./projects/ng-dialogs/src/app/visual-query/query-result/query-result.component.ts","./projects/ng-dialogs/src/app/visual-query/run-explorer/run-explorer.component.ts","./projects/ng-dialogs/src/app/visual-query/add-explorer/add-explorer.component.html","./projects/ng-dialogs/src/app/visual-query/add-explorer/add-explorer.helpers.ts","./projects/ng-dialogs/src/app/visual-query/stream-error-result/stream-error-result.component.html","./projects/ng-dialogs/src/app/visual-query/visual-query-routing.module.ts","./projects/ng-dialogs/src/app/visual-query/plumb-editor/plumb-editor.component.html","./projects/ng-dialogs/src/app/visual-query/run-explorer/run-explorer.helpers.ts","./projects/ng-dialogs/src/app/visual-query/visual-query.component.ts","./projects/ng-dialogs/src/app/visual-query/run-explorer/run-explorer.component.scss","./projects/ng-dialogs/src/app/visual-query/add-explorer/add-explorer.component.scss","./projects/ng-dialogs/src/app/visual-query/visual-query.component.scss","./projects/ng-dialogs/src/app/visual-query/query-result/query-result.component.html","./projects/ng-dialogs/src/app/visual-query/query-result/query-result.component.scss","./projects/ng-dialogs/src/app/visual-query/run-explorer/run-explorer.component.html","./projects/ng-dialogs/src/app/visual-query/visual-query.component.html","./projects/ng-dialogs/src/app/visual-query/plumb-editor/plumber.helper.ts","./projects/ng-dialogs/src/app/visual-query/services/visual-query.service.ts","./projects/ng-dialogs/src/app/visual-query/stream-error-result/stream-error-result.component.scss","./projects/ng-dialogs/src/app/visual-query/plumb-editor/plumb-editor.helpers.ts","./projects/ng-dialogs/src/app/visual-query/plumb-editor/plumb-editor.component.scss","./projects/ng-dialogs/src/app/visual-query/visual-query.module.ts","./projects/ng-dialogs/src/app/visual-query/services/query-definition.service.ts","./projects/ng-dialogs/src/app/visual-query/add-explorer/add-explorer.component.ts","./projects/ng-dialogs/src/app/app-administration/services/content-types.service.ts","./projects/ng-dialogs/src/app/visual-query/stream-error-result/stream-error-result.component.ts","./projects/ng-dialogs/src/app/visual-query/plumb-editor/plumb-editor.component.ts"],"names":[],"mappings":"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","file":"visual-query-visual-query-module.js","sourcesContent":["import { ChangeDetectionStrategy, Component, Inject, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { DebugStreamInfo, PipelineResultQuery, PipelineResultSources, PipelineResultStream } from '../models';\r\nimport { VisualQueryService } from '../services/visual-query.service';\r\nimport { QueryResultDialogData } from './query-result.models';\r\n\r\n@Component({\r\n  selector: 'app-query-result',\r\n  templateUrl: './query-result.component.html',\r\n  styleUrls: ['./query-result.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class QueryResultComponent implements OnInit {\r\n  parameters: string[];\r\n  timeUsed: number;\r\n  ticksUsed: number;\r\n  top: number;\r\n  optionsForTop: number[];\r\n  result: PipelineResultQuery;\r\n  debugStream: DebugStreamInfo;\r\n  sources: PipelineResultSources;\r\n  streams: PipelineResultStream[];\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) private dialogData: QueryResultDialogData,\r\n    private dialogRef: MatDialogRef<QueryResultComponent>,\r\n    private visualQueryService: VisualQueryService,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    const pipeline = this.visualQueryService.pipelineModel$.value.Pipeline;\r\n    const params = (pipeline.Params?.split('\\n') ?? []).filter(el => !!el);\r\n    const testParams = (pipeline.TestParameters?.split('\\n') ?? []).filter(el => !!el);\r\n    this.parameters = [].concat(params, testParams);\r\n    this.timeUsed = this.dialogData.result.QueryTimer.Milliseconds;\r\n    this.ticksUsed = this.dialogData.result.QueryTimer.Ticks;\r\n    this.top = this.dialogData.top;\r\n    this.optionsForTop = [25, 100, 1000, 0];\r\n    this.result = this.dialogData.result.Query;\r\n    this.debugStream = this.dialogData.debugStream;\r\n    this.sources = this.dialogData.result.Sources;\r\n    this.streams = this.dialogData.result.Streams;\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  show(top: number) {\r\n    if (top === this.top) { return; }\r\n\r\n    if (this.debugStream) {\r\n      this.visualQueryService.debugStream(this.debugStream.original, top);\r\n    } else {\r\n      this.visualQueryService.runPipeline(top);\r\n    }\r\n\r\n    this.closeDialog();\r\n  }\r\n}\r\n","import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { GoToDevRest } from '../../dev-rest';\r\nimport { Context } from '../../shared/services/context';\r\nimport { PipelineModel } from '../models';\r\nimport { VisualQueryService } from '../services/visual-query.service';\r\nimport { calculateWarnings } from './run-explorer.helpers';\r\n\r\n@Component({\r\n  selector: 'app-run-explorer',\r\n  templateUrl: './run-explorer.component.html',\r\n  styleUrls: ['./run-explorer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class RunExplorerComponent implements OnInit {\r\n  pipelineModel$: Observable<PipelineModel>;\r\n  warnings$: Observable<string[]>;\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private context: Context,\r\n    private visualQueryService: VisualQueryService,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.pipelineModel$ = this.visualQueryService.pipelineModel$;\r\n    this.warnings$ = this.visualQueryService.pipelineModel$.pipe(\r\n      map(pipelineModel => calculateWarnings(pipelineModel, this.context)),\r\n    );\r\n  }\r\n\r\n  editPipeline() {\r\n    this.visualQueryService.editPipelineEntity();\r\n  }\r\n\r\n  openParamsHelp() {\r\n    window.open('https://r.2sxc.org/QueryParams', '_blank');\r\n  }\r\n\r\n  saveAndRunQuery(save: boolean, run: boolean) {\r\n    this.visualQueryService.saveAndRun(save, run);\r\n  }\r\n\r\n  openRestApi() {\r\n    const queryGuid = this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid;\r\n    this.router.navigate([GoToDevRest.goToQuery(queryGuid)], { relativeTo: this.route });\r\n  }\r\n}\r\n","export default \"<div class=\\\"editor-active-explorer fancy-scrollbar-dark\\\" *ngIf=\\\"sorted$ | async as sorted\\\">\\r\\n\\r\\n  <mat-slide-toggle labelPosition=\\\"before\\\" (change)=\\\"toggleDifficulty($event)\\\">\\r\\n    Show Advanced\\r\\n  </mat-slide-toggle>\\r\\n\\r\\n  <ng-container *ngFor=\\\"let group of sorted | keyvalue; trackBy: trackGroups\\\">\\r\\n    <div class=\\\"collapsible\\\" [matTooltip]=\\\"guiTypes[group.key].UiHint || group.key\\\" matTooltipShowDelay=\\\"750\\\"\\r\\n      (click)=\\\"toggleItem(group.key)\\\">\\r\\n      <mat-icon>{{ guiTypes[group.key].Icon || guiTypes.Unknown.Icon }}</mat-icon>\\r\\n      <span>{{ group.key }}</span>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"list\\\" *ngIf=\\\"toggledItems.includes(group.key)\\\">\\r\\n      <div class=\\\"list-item\\\" *ngFor=\\\"let dataSource of group.value; trackBy: trackDataSources\\\"\\r\\n        [matTooltip]=\\\"dataSource.UiHint || dataSource.Name\\\" matTooltipShowDelay=\\\"750\\\"\\r\\n        (click)=\\\"addDataSource(dataSource)\\\">\\r\\n        <mat-icon>{{ dataSource.Icon || guiTypes.Unknown.Icon }}</mat-icon>\\r\\n        <span>{{ dataSource.Name }}</span>\\r\\n      </div>\\r\\n    </div>\\r\\n  </ng-container>\\r\\n</div>\\r\\n\";","import cloneDeep from 'lodash-es/cloneDeep';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { DataSource, SortedDataSources } from '../models';\r\n\r\nexport function filterAndSortDataSources(dataSources: DataSource[], maxDifficulty: number) {\r\n  if (!dataSources) { return; }\r\n\r\n  const cloned = cloneDeep(dataSources);\r\n\r\n  const filtered = cloned.filter(dataSource =>\r\n    dataSource.Difficulty <= maxDifficulty\r\n    && dataSource.PartAssemblyAndType !== eavConstants.pipelineDesigner.outDataSource.PartAssemblyAndType\r\n  );\r\n\r\n  filtered.sort((a, b) => a.Name.toLocaleLowerCase().localeCompare(b.Name.toLocaleLowerCase()));\r\n\r\n  const sorted: SortedDataSources = {};\r\n  for (const dataSource of filtered) {\r\n    const type = dataSource.PrimaryType;\r\n    if (sorted[type]) {\r\n      sorted[type].push(dataSource);\r\n    } else {\r\n      sorted[type] = [dataSource];\r\n    }\r\n  }\r\n\r\n  return sorted;\r\n}\r\n","export default \"<div mat-dialog-title>\\r\\n  <div class=\\\"dialog-title-box\\\">\\r\\n    <div>Stream Error Results</div>\\r\\n    <button mat-icon-button matTooltip=\\\"Close dialog\\\" (click)=\\\"closeDialog()\\\">\\r\\n      <mat-icon>close</mat-icon>\\r\\n    </button>\\r\\n  </div>\\r\\n</div>\\r\\n\\r\\n<br />\\r\\n\\r\\n<pre>{{ errorData | json }}</pre>\\r\\n\\r\\n<div>\\r\\n  <button mat-button matTooltip=\\\"Open 2sxc Insights\\\" (click)=\\\"openInsights()\\\">\\r\\n    <mat-icon>speed</mat-icon>\\r\\n    <span>Insights</span>\\r\\n  </button>\\r\\n</div>\\r\\n\";","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { edit } from '../../../../edit/edit.matcher';\r\nimport { GoToDevRest } from '../dev-rest';\r\nimport { VisualQueryComponent } from './visual-query.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '', component: VisualQueryComponent, children: [\r\n      GoToDevRest.route,\r\n      {\r\n        matcher: edit,\r\n        loadChildren: () => import('../../../../edit/edit.module').then(m => m.EditModule),\r\n        data: { history: false },\r\n      },\r\n    ]\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class VisualQueryRoutingModule { }\r\n","export default \"<div #domRoot id=\\\"pipeline-root\\\" *ngIf=\\\"(templateModel$ | async) as templateModel\\\">\\r\\n  <!-- do not use trackBy, jsPlumb drag stops working properly after delete -->\\r\\n  <ng-container *ngIf=\\\"!hardReset\\\">\\r\\n    <div #domDataSource *ngFor=\\\"let dataSource of templateModel.pipelineDataSources\\\"\\r\\n      [id]=\\\"dataSrcIdPrefix + dataSource.EntityGuid\\\" class=\\\"dataSource\\\" [ngStyle]=\\\"{\\r\\n        'top': dataSource.VisualDesignerData.Top + 'px',\\r\\n        'left': dataSource.VisualDesignerData.Left + 'px',\\r\\n        'min-width': dataSource.VisualDesignerData.Width ? dataSource.VisualDesignerData.Width + 'px' : null\\r\\n      }\\\">\\r\\n\\r\\n      <div class=\\\"actions left\\\">\\r\\n        <mat-icon class=\\\"type-info\\\" [title]=\\\"templateModel.typeInfos[dataSource.EntityGuid].UiHint\\\">\\r\\n          {{ templateModel.typeInfos[dataSource.EntityGuid].Icon }}\\r\\n        </mat-icon>\\r\\n\\r\\n        <mat-icon class=\\\"configure\\\" title=\\\"Configure data source\\\" appMousedownStopPropagation\\r\\n          *ngIf=\\\"templateModel.allowEdit && templateModel.typeInfos[dataSource.EntityGuid].EnableConfig\\\"\\r\\n          (click)=\\\"configureDataSource(dataSource)\\\">\\r\\n          settings\\r\\n        </mat-icon>\\r\\n\\r\\n        <mat-icon class=\\\"help\\\" title=\\\"Help for this data source\\\" appMousedownStopPropagation\\r\\n          *ngIf=\\\"templateModel.typeInfos[dataSource.EntityGuid].HelpLink\\\"\\r\\n          (click)=\\\"openHelp(templateModel.typeInfos[dataSource.EntityGuid].HelpLink)\\\">\\r\\n          help_outline\\r\\n        </mat-icon>\\r\\n      </div>\\r\\n\\r\\n      <div class=\\\"actions right\\\">\\r\\n        <mat-icon class=\\\"delete\\\" title=\\\"Delete\\\" appMousedownStopPropagation\\r\\n          *ngIf=\\\"templateModel.allowEdit && !isOutDataSource(dataSource)\\\" (click)=\\\"remove(dataSource)\\\">\\r\\n          delete\\r\\n        </mat-icon>\\r\\n      </div>\\r\\n\\r\\n      <div class=\\\"name\\\" title=\\\"Click to edit name\\\" appMousedownStopPropagation\\r\\n        (click)=\\\"templateModel.allowEdit && editName(dataSource)\\\">\\r\\n        <span>{{ dataSource.Name || '(no name)' }}</span>\\r\\n        <mat-icon class=\\\"show-hover-inline\\\">edit</mat-icon>\\r\\n      </div>\\r\\n      <br />\\r\\n\\r\\n      <div class=\\\"description\\\" title=\\\"Click to edit description\\\" appMousedownStopPropagation\\r\\n        (click)=\\\"templateModel.allowEdit && editDescription(dataSource)\\\">\\r\\n        <span>{{ dataSource.Description }}</span>\\r\\n        <mat-icon class=\\\"show-hover-inline\\\">edit</mat-icon>\\r\\n      </div>\\r\\n      <br />\\r\\n\\r\\n      <div class=\\\"typename\\\" [title]=\\\"dataSource.PartAssemblyAndType\\\">\\r\\n        Type: {{ getTypeName(dataSource.PartAssemblyAndType) }}\\r\\n      </div>\\r\\n\\r\\n      <mat-icon class=\\\"add-endpoint\\\" title=\\\"Drag a new Out-Connection\\\"\\r\\n        *ngIf=\\\"templateModel.allowEdit && templateModel.typeInfos[dataSource.EntityGuid].DynamicOut\\\">\\r\\n        arrow_drop_up\\r\\n      </mat-icon>\\r\\n\\r\\n      <mat-icon class=\\\"many-in\\\" title=\\\"This data source supports multiple In-Connections\\\"\\r\\n        *ngIf=\\\"templateModel.allowEdit && templateModel.typeInfos[dataSource.EntityGuid].DynamicIn\\\">\\r\\n        arrow_drop_up\\r\\n      </mat-icon>\\r\\n    </div>\\r\\n  </ng-container>\\r\\n</div>\\r\\n\";","import { Context } from '../../shared/services/context';\r\nimport { PipelineModel } from '../models';\r\n\r\n/**\r\n * Check if there are special warnings the developer should know.\r\n * Typically when the test ModuleId is different from the one we're currently working on\r\n */\r\nexport function calculateWarnings(pipelineModel: PipelineModel, context: Context) {\r\n  const warnings: string[] = [];\r\n\r\n  try {\r\n    const queryParams = pipelineModel.Pipeline.Params?.split(/\\r?\\n/) || [];\r\n    const testParams = pipelineModel.Pipeline.TestParameters?.split(/\\r?\\n/) || [];\r\n\r\n    queryParams.forEach(param => {\r\n      param = param?.trim();\r\n      if (!param) { return; }\r\n\r\n      // Check if the syntax on Query Parameters is off.\r\n      // It should contain [...]=...\r\n      // But it's easy to forget the [ and ] brackets\r\n      const paramSyntax = /^[a-zA-Z0-9]+=(.*)$/gmi;\r\n      const matched = paramSyntax.test(param);\r\n      if (!matched) {\r\n        warnings.push(`\r\n          A <em>Query Parameter</em> seems wrong: <br>\r\n          <code>${param}</code> <br>\r\n          It should use the syntax: <br>\r\n          <code>key=value</code> <br>\r\n          or resolve to a token like: <br>\r\n          <code>key=[source:key]</code>\r\n        `);\r\n      }\r\n    });\r\n\r\n    testParams.forEach(param => {\r\n      param = param?.trim();\r\n      if (!param) { return; }\r\n\r\n      // Check if the syntax on Test Parameters is off.\r\n      // It should contain [...]=...\r\n      // But it's easy to forget the [ and ] brackets\r\n      const testParamSyntax = /^\\[[a-zA-Z]+:[a-zA-Z0-9]+\\]=(.*)$/gmi;\r\n      const matched = testParamSyntax.test(param);\r\n      if (!matched) {\r\n        warnings.push(`\r\n          A <em>Test Parameter</em> seems wrong: <br>\r\n          <code>${param}</code> <br>\r\n          It should use the syntax: <br>\r\n          <code>[source:key]=value</code>\r\n        `);\r\n      }\r\n\r\n      // Check if we should show the warning about the test ModuleId.\r\n      // This is because in the old days, the ModuleId wasn't auto-filled, so people had to add it as a test value.\r\n      // Now it's not necessary any more\r\n      const midRegex = /^\\[module:moduleid\\]=([0-9]*)$/gmi;\r\n      const midMatch = midRegex.exec(param); // capture the ModuleId\r\n      if (midMatch) {\r\n        const testMid = midMatch[1];\r\n        const urlMid = context.moduleId.toString();\r\n        if (testMid !== urlMid) {\r\n          warnings.push(`\r\n            Your test ModuleId (${testMid}) is different from the current ModuleId (${urlMid}).\r\n            Note that 2sxc 9.33 automatically provides the ModuleId - so you usually do not need to set it any more.\r\n          `);\r\n        }\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Something went wrong in calculateWarnings for params', error);\r\n  }\r\n\r\n  return warnings;\r\n}\r\n","import { ChangeDetectionStrategy, Component, OnInit, ViewChild } from '@angular/core';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { Context } from '../shared/services/context';\r\nimport { PlumbEditorComponent } from './plumb-editor/plumb-editor.component';\r\nimport { VisualQueryService } from './services/visual-query.service';\r\n\r\n@Component({\r\n  selector: 'app-visual-query',\r\n  templateUrl: './visual-query.component.html',\r\n  styleUrls: ['./visual-query.component.scss'],\r\n  providers: [VisualQueryService],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class VisualQueryComponent implements OnInit {\r\n  @ViewChild(PlumbEditorComponent) plumbEditor: PlumbEditorComponent;\r\n\r\n  explorer = {\r\n    run: 'run',\r\n    add: 'add'\r\n  };\r\n  activeExplorer = this.explorer.run;\r\n\r\n  constructor(private context: Context, private route: ActivatedRoute, private visualQueryService: VisualQueryService) {\r\n    this.context.init(this.route);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.visualQueryService.init();\r\n  }\r\n\r\n  toggleExplorer(explorer: string) {\r\n    this.activeExplorer = (this.activeExplorer === explorer) ? null : explorer;\r\n  }\r\n\r\n  openHelp() {\r\n    window.open('https://r.2sxc.org/visual-query', '_blank');\r\n  }\r\n\r\n}\r\n","export default \".wrapper {\\n  padding: 24px;\\n}\\n\\n.actions,\\n.footer-actions {\\n  display: flex;\\n  flex-direction: column;\\n  padding-bottom: 32px;\\n}\\n\\n.actions .action:not(:last-of-type),\\n.footer-actions .action:not(:last-of-type) {\\n  margin-bottom: 8px;\\n}\\n\\n.parameters,\\n.warnings,\\n.description {\\n  margin: 16px 0;\\n}\\n\\n.parameters .title,\\n.warnings .title,\\n.description .title {\\n  height: 40px;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  font-size: 14px;\\n}\\n\\n.parameters .title .mat-icon,\\n.warnings .title .mat-icon,\\n.description .title .mat-icon {\\n  -webkit-user-select: none;\\n     -moz-user-select: none;\\n          user-select: none;\\n}\\n\\n.parameters .values,\\n.warnings .values {\\n  margin: 0;\\n  padding-left: 16px;\\n}\\n\\n.parameters .values li,\\n.warnings .values li {\\n  padding: 1px 0;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uXFwuLlxcLi5cXC4uXFwuLlxcLi5cXHJ1bi1leHBsb3Jlci5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGFBQUE7QUFDRjs7QUFFQTs7RUFFRSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSxvQkFBQTtBQUNGOztBQUNFOztFQUNFLGtCQUFBO0FBRUo7O0FBRUE7OztFQUdFLGNBQUE7QUFDRjs7QUFDRTs7O0VBQ0UsWUFBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtFQUNBLDhCQUFBO0VBQ0EsZUFBQTtBQUdKOztBQURJOzs7RUFDRSx5QkFBQTtLQUFBLHNCQUFBO1VBQUEsaUJBQUE7QUFLTjs7QUFFRTs7RUFDRSxTQUFBO0VBQ0Esa0JBQUE7QUFFSjs7QUFBSTs7RUFDRSxjQUFBO0FBR04iLCJmaWxlIjoicnVuLWV4cGxvcmVyLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLndyYXBwZXIge1xyXG4gIHBhZGRpbmc6IDI0cHg7XHJcbn1cclxuXHJcbi5hY3Rpb25zLFxyXG4uZm9vdGVyLWFjdGlvbnMge1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcclxuICBwYWRkaW5nLWJvdHRvbTogMzJweDtcclxuXHJcbiAgLmFjdGlvbjpub3QoOmxhc3Qtb2YtdHlwZSkge1xyXG4gICAgbWFyZ2luLWJvdHRvbTogOHB4O1xyXG4gIH1cclxufVxyXG5cclxuLnBhcmFtZXRlcnMsXHJcbi53YXJuaW5ncyxcclxuLmRlc2NyaXB0aW9uIHtcclxuICBtYXJnaW46IDE2cHggMDtcclxuXHJcbiAgLnRpdGxlIHtcclxuICAgIGhlaWdodDogNDBweDtcclxuICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xyXG4gICAgZm9udC1zaXplOiAxNHB4O1xyXG5cclxuICAgIC5tYXQtaWNvbiB7XHJcbiAgICAgIHVzZXItc2VsZWN0OiBub25lO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLnBhcmFtZXRlcnMsXHJcbi53YXJuaW5ncyB7XHJcbiAgLnZhbHVlcyB7XHJcbiAgICBtYXJnaW46IDA7XHJcbiAgICBwYWRkaW5nLWxlZnQ6IDE2cHg7XHJcblxyXG4gICAgbGkge1xyXG4gICAgICBwYWRkaW5nOiAxcHggMDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIC5mb290ZXItYWN0aW9ucyB7XHJcbi8vICAgZGlzcGxheTogZmxleDtcclxuLy8gICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kO1xyXG4vLyB9XHJcbiJdfQ== */\";","export default \".mat-slide-toggle {\\n  margin: 6px;\\n  -webkit-user-select: none;\\n     -moz-user-select: none;\\n          user-select: none;\\n}\\n\\n.collapsible {\\n  display: flex;\\n  align-items: center;\\n  cursor: pointer;\\n  overflow: hidden;\\n  white-space: nowrap;\\n  -webkit-user-select: none;\\n     -moz-user-select: none;\\n          user-select: none;\\n  padding: 3px 0;\\n}\\n\\n.collapsible:hover {\\n  background-color: #2a2d2e;\\n}\\n\\n.collapsible .mat-icon {\\n  width: 18px;\\n  height: 18px;\\n  font-size: 18px;\\n  margin-left: 8px;\\n  margin-right: 4px;\\n}\\n\\n.list .list-item {\\n  display: flex;\\n  align-items: center;\\n  cursor: pointer;\\n  padding: 4px 0 4px 24px;\\n  overflow: hidden;\\n  white-space: nowrap;\\n  text-overflow: ellipsis;\\n  -webkit-user-select: none;\\n     -moz-user-select: none;\\n          user-select: none;\\n}\\n\\n.list .list-item:hover {\\n  background-color: #2a2d2e;\\n}\\n\\n.list .list-item .mat-icon {\\n  width: 18px;\\n  height: 18px;\\n  font-size: 18px;\\n  margin-left: 6px;\\n  margin-right: 4px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uXFwuLlxcLi5cXC4uXFwuLlxcLi5cXGFkZC1leHBsb3Jlci5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFdBQUE7RUFDQSx5QkFBQTtLQUFBLHNCQUFBO1VBQUEsaUJBQUE7QUFDRjs7QUFFQTtFQUNFLGFBQUE7RUFDQSxtQkFBQTtFQUNBLGVBQUE7RUFDQSxnQkFBQTtFQUNBLG1CQUFBO0VBQ0EseUJBQUE7S0FBQSxzQkFBQTtVQUFBLGlCQUFBO0VBQ0EsY0FBQTtBQUNGOztBQUNFO0VBQ0UseUJBQUE7QUFDSjs7QUFFRTtFQUNFLFdBQUE7RUFDQSxZQUFBO0VBQ0EsZUFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7QUFBSjs7QUFJQTtFQUNFLGFBQUE7RUFDQSxtQkFBQTtFQUNBLGVBQUE7RUFDQSx1QkFBQTtFQUNBLGdCQUFBO0VBQ0EsbUJBQUE7RUFDQSx1QkFBQTtFQUNBLHlCQUFBO0tBQUEsc0JBQUE7VUFBQSxpQkFBQTtBQURGOztBQUdFO0VBQ0UseUJBQUE7QUFESjs7QUFJRTtFQUNFLFdBQUE7RUFDQSxZQUFBO0VBQ0EsZUFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7QUFGSiIsImZpbGUiOiJhZGQtZXhwbG9yZXIuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIubWF0LXNsaWRlLXRvZ2dsZSB7XHJcbiAgbWFyZ2luOiA2cHg7XHJcbiAgdXNlci1zZWxlY3Q6IG5vbmU7XHJcbn1cclxuXHJcbi5jb2xsYXBzaWJsZSB7XHJcbiAgZGlzcGxheTogZmxleDtcclxuICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gIGN1cnNvcjogcG9pbnRlcjtcclxuICBvdmVyZmxvdzogaGlkZGVuO1xyXG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XHJcbiAgdXNlci1zZWxlY3Q6IG5vbmU7XHJcbiAgcGFkZGluZzogM3B4IDA7XHJcblxyXG4gICY6aG92ZXIge1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDQyLCA0NSwgNDYpO1xyXG4gIH1cclxuXHJcbiAgLm1hdC1pY29uIHtcclxuICAgIHdpZHRoOiAxOHB4O1xyXG4gICAgaGVpZ2h0OiAxOHB4O1xyXG4gICAgZm9udC1zaXplOiAxOHB4O1xyXG4gICAgbWFyZ2luLWxlZnQ6IDhweDtcclxuICAgIG1hcmdpbi1yaWdodDogNHB4O1xyXG4gIH1cclxufVxyXG5cclxuLmxpc3QgLmxpc3QtaXRlbSB7XHJcbiAgZGlzcGxheTogZmxleDtcclxuICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gIGN1cnNvcjogcG9pbnRlcjtcclxuICBwYWRkaW5nOiA0cHggMCA0cHggMjRweDtcclxuICBvdmVyZmxvdzogaGlkZGVuO1xyXG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XHJcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XHJcbiAgdXNlci1zZWxlY3Q6IG5vbmU7XHJcblxyXG4gICY6aG92ZXIge1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDQyLCA0NSwgNDYpO1xyXG4gIH1cclxuXHJcbiAgLm1hdC1pY29uIHtcclxuICAgIHdpZHRoOiAxOHB4O1xyXG4gICAgaGVpZ2h0OiAxOHB4O1xyXG4gICAgZm9udC1zaXplOiAxOHB4O1xyXG4gICAgbWFyZ2luLWxlZnQ6IDZweDtcclxuICAgIG1hcmdpbi1yaWdodDogNHB4O1xyXG4gIH1cclxufVxyXG4iXX0= */\";","export default \".editor-side-toolbar {\\n  display: flex;\\n  flex-direction: column;\\n}\\n.editor-side-toolbar .spacer {\\n  flex-grow: 1;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uXFwuLlxcLi5cXC4uXFwuLlxcdmlzdWFsLXF1ZXJ5LmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsYUFBQTtFQUNBLHNCQUFBO0FBQ0Y7QUFDRTtFQUNFLFlBQUE7QUFDSiIsImZpbGUiOiJ2aXN1YWwtcXVlcnkuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuZWRpdG9yLXNpZGUtdG9vbGJhciB7XHJcbiAgZGlzcGxheTogZmxleDtcclxuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xyXG5cclxuICAuc3BhY2VyIHtcclxuICAgIGZsZXgtZ3JvdzogMTtcclxuICB9XHJcbn1cclxuIl19 */\";","export default \"<div mat-dialog-title>\\r\\n  <div class=\\\"dialog-title-box\\\">\\r\\n    <div>\\r\\n      Query Results\\r\\n      <ng-container *ngIf=\\\"debugStream\\\">\\r\\n        for Stream: \\\"{{ debugStream.name }}\\\" on Source: \\\"{{ debugStream.sourceName }}\\\"\\r\\n      </ng-container>\\r\\n    </div>\\r\\n    <button mat-icon-button matTooltip=\\\"Close dialog\\\" (click)=\\\"closeDialog()\\\">\\r\\n      <mat-icon>close</mat-icon>\\r\\n    </button>\\r\\n  </div>\\r\\n</div>\\r\\n\\r\\n<p class=\\\"dialog-description\\\">\\r\\n  The Full result was logged to the Browser Console. Further down you'll find more debug-infos.\\r\\n  Executed in {{ timeUsed }}ms ({{ ticksUsed }} ticks)\\r\\n</p>\\r\\n\\r\\n<mat-tab-group dynamicHeight color=\\\"accent\\\">\\r\\n  <mat-tab>\\r\\n    <div *matTabLabel class=\\\"mat-tab-label-box\\\" matTooltip=\\\"Results\\\">\\r\\n      <span>Results</span>\\r\\n    </div>\\r\\n\\r\\n    <p class=\\\"description\\\">\\r\\n      <ng-container *ngIf=\\\"top === 0\\\">Showing All results</ng-container>\\r\\n      <ng-container *ngIf=\\\"top !== 0\\\">Showing top {{ top }} results</ng-container>\\r\\n      <button mat-button *ngFor=\\\"let option of optionsForTop\\\" (click)=\\\"show(option)\\\">\\r\\n        Show\\r\\n        <ng-container *ngIf=\\\"option === 0\\\">All</ng-container>\\r\\n        <ng-container *ngIf=\\\"option !== 0\\\">{{ option }}</ng-container>\\r\\n      </button>\\r\\n    </p>\\r\\n    <pre>{{ result | json }}</pre>\\r\\n  </mat-tab>\\r\\n\\r\\n  <mat-tab *ngIf=\\\"parameters?.length\\\">\\r\\n    <div *matTabLabel class=\\\"mat-tab-label-box\\\" matTooltip=\\\"Parameters\\\">\\r\\n      <span>Parameters</span>\\r\\n    </div>\\r\\n\\r\\n    <br />\\r\\n    <ul class=\\\"description\\\">\\r\\n      <li *ngFor=\\\"let param of parameters\\\">{{ param }}</li>\\r\\n    </ul>\\r\\n  </mat-tab>\\r\\n\\r\\n  <mat-tab>\\r\\n    <div *matTabLabel class=\\\"mat-tab-label-box\\\" matTooltip=\\\"Sources\\\">\\r\\n      <span>Sources</span>\\r\\n    </div>\\r\\n\\r\\n    <br />\\r\\n    <table class=\\\"description\\\">\\r\\n      <tr>\\r\\n        <th>Guid</th>\\r\\n        <th>Type</th>\\r\\n        <th>Configuration</th>\\r\\n        <th>Error</th>\\r\\n      </tr>\\r\\n      <tr *ngFor=\\\"let source of sources | keyvalue\\\">\\r\\n        <td>\\r\\n          <pre>{{ source.value.Guid }}</pre>\\r\\n        </td>\\r\\n        <td>{{ source.value.Type }}</td>\\r\\n        <td>\\r\\n          <ol>\\r\\n            <li *ngFor=\\\"let config of source.value.Configuration | keyvalue\\\">\\r\\n              <b>{{ config.key }}</b>=<em>{{ config.value }}</em>\\r\\n            </li>\\r\\n          </ol>\\r\\n        </td>\\r\\n        <td>{{ source.value.Error }}</td>\\r\\n      </tr>\\r\\n    </table>\\r\\n  </mat-tab>\\r\\n\\r\\n  <mat-tab>\\r\\n    <div *matTabLabel class=\\\"mat-tab-label-box\\\" matTooltip=\\\"Streams\\\">\\r\\n      <span>Streams</span>\\r\\n    </div>\\r\\n\\r\\n    <br />\\r\\n    <table class=\\\"description\\\">\\r\\n      <tr>\\r\\n        <th>Source</th>\\r\\n        <th>Target</th>\\r\\n        <th>Items</th>\\r\\n        <th>Error</th>\\r\\n      </tr>\\r\\n      <tr *ngFor=\\\"let stream of streams\\\">\\r\\n        <td>\\r\\n          <pre>{{ stream.Source + \\\":\\\" + stream.SourceOut }}</pre>\\r\\n        </td>\\r\\n        <td>\\r\\n          <pre>{{ stream.Target + \\\":\\\" + stream.TargetIn }}</pre>\\r\\n        </td>\\r\\n        <td>{{ stream.Count }}</td>\\r\\n        <td>{{ stream.Error }}</td>\\r\\n      </tr>\\r\\n    </table>\\r\\n  </mat-tab>\\r\\n</mat-tab-group>\\r\\n\";","export default \".description {\\n  font-size: 14px;\\n}\\n\\npre {\\n  display: block;\\n  padding: 9.5px;\\n  margin: 0 0 10px;\\n  font-size: 13px;\\n  line-height: 1.42857143;\\n  color: #333;\\n  word-break: break-all;\\n  word-wrap: break-word;\\n  background-color: #f5f5f5;\\n  border: 1px solid #ccc;\\n  border-radius: 4px;\\n  overflow-x: auto;\\n}\\n\\nth {\\n  text-align: left;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uXFwuLlxcLi5cXC4uXFwuLlxcLi5cXHF1ZXJ5LXJlc3VsdC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGVBQUE7QUFDRjs7QUFFQTtFQUNFLGNBQUE7RUFDQSxjQUFBO0VBQ0EsZ0JBQUE7RUFDQSxlQUFBO0VBQ0EsdUJBQUE7RUFDQSxXQUFBO0VBQ0EscUJBQUE7RUFDQSxxQkFBQTtFQUNBLHlCQUFBO0VBQ0Esc0JBQUE7RUFDQSxrQkFBQTtFQUNBLGdCQUFBO0FBQ0Y7O0FBRUE7RUFDRSxnQkFBQTtBQUNGIiwiZmlsZSI6InF1ZXJ5LXJlc3VsdC5jb21wb25lbnQuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi5kZXNjcmlwdGlvbiB7XHJcbiAgZm9udC1zaXplOiAxNHB4O1xyXG59XHJcblxyXG5wcmUge1xyXG4gIGRpc3BsYXk6IGJsb2NrO1xyXG4gIHBhZGRpbmc6IDkuNXB4O1xyXG4gIG1hcmdpbjogMCAwIDEwcHg7XHJcbiAgZm9udC1zaXplOiAxM3B4O1xyXG4gIGxpbmUtaGVpZ2h0OiAxLjQyODU3MTQzO1xyXG4gIGNvbG9yOiAjMzMzO1xyXG4gIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDtcclxuICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTtcclxuICBib3JkZXI6IDFweCBzb2xpZCAjY2NjO1xyXG4gIGJvcmRlci1yYWRpdXM6IDRweDtcclxuICBvdmVyZmxvdy14OiBhdXRvO1xyXG59XHJcblxyXG50aCB7XHJcbiAgdGV4dC1hbGlnbjogbGVmdDtcclxufVxyXG4iXX0= */\";","export default \"<div class=\\\"editor-active-explorer fancy-scrollbar-dark\\\" *ngIf=\\\"(pipelineModel$ | async) as pipelineModel\\\">\\r\\n\\r\\n  <div class=\\\"wrapper\\\">\\r\\n    <div class=\\\"actions\\\">\\r\\n      <button mat-raised-button class=\\\"action\\\" color=\\\"accent\\\" (click)=\\\"saveAndRunQuery(true, true)\\\">\\r\\n        Save and run\\r\\n      </button>\\r\\n      <button mat-raised-button class=\\\"action\\\" (click)=\\\"saveAndRunQuery(false, true)\\\">\\r\\n        Run\\r\\n      </button>\\r\\n      <button mat-raised-button class=\\\"action\\\" (click)=\\\"saveAndRunQuery(true, false)\\\">\\r\\n        Save\\r\\n      </button>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"parameters\\\">\\r\\n      <div class=\\\"title\\\">\\r\\n        <div>Query Parameters</div>\\r\\n        <div>\\r\\n          <button mat-icon-button matTooltip=\\\"Edit parameters\\\" (click)=\\\"editPipeline()\\\">\\r\\n            <mat-icon>edit</mat-icon>\\r\\n          </button>\\r\\n          <button mat-icon-button matTooltip=\\\"Query Params Docs\\\" (click)=\\\"openParamsHelp()\\\">\\r\\n            <mat-icon>info</mat-icon>\\r\\n          </button>\\r\\n        </div>\\r\\n      </div>\\r\\n      <ul class=\\\"values\\\" *ngIf=\\\"pipelineModel.Pipeline.Params?.length\\\">\\r\\n        <li *ngFor=\\\"let param of pipelineModel.Pipeline.Params?.split('\\\\n')\\\">\\r\\n          {{ param }}\\r\\n        </li>\\r\\n      </ul>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"parameters\\\">\\r\\n      <div class=\\\"title\\\">Test Parameters</div>\\r\\n      <ul class=\\\"values\\\" *ngIf=\\\"pipelineModel.Pipeline.TestParameters?.length\\\">\\r\\n        <li *ngFor=\\\"let param of pipelineModel.Pipeline.TestParameters?.split('\\\\n')\\\">\\r\\n          {{ param }}\\r\\n        </li>\\r\\n      </ul>\\r\\n    </div>\\r\\n\\r\\n    <ng-container *ngIf=\\\"(warnings$ | async) as warnings\\\">\\r\\n      <div class=\\\"warnings\\\" *ngIf=\\\"warnings.length\\\">\\r\\n        <div class=\\\"title\\\">\\r\\n          <span>Warnings</span>\\r\\n          <mat-icon style=\\\"color: red\\\">warning</mat-icon>\\r\\n        </div>\\r\\n        <ol class=\\\"values\\\">\\r\\n          <li *ngFor=\\\"let warning of warnings\\\" [innerHTML]=\\\"warning\\\">\\r\\n          </li>\\r\\n        </ol>\\r\\n      </div>\\r\\n    </ng-container>\\r\\n\\r\\n    <div class=\\\"description\\\" *ngIf=\\\"pipelineModel.Pipeline.Description\\\">\\r\\n      <div class=\\\"title\\\">Query Description</div>\\r\\n      <div>{{ pipelineModel.Pipeline.Description }}</div>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"footer-actions\\\">\\r\\n      <button mat-raised-button class=\\\"action\\\" (click)=\\\"openRestApi()\\\">\\r\\n        Use in JSON / REST API\\r\\n        <mat-icon svgIcon=\\\"code-curly\\\"></mat-icon>\\r\\n      </button>\\r\\n    </div>\\r\\n\\r\\n  </div>\\r\\n</div>\\r\\n\";","export default \"<router-outlet></router-outlet>\\r\\n\\r\\n<div class=\\\"editor-root\\\">\\r\\n  <div class=\\\"editor-side-toolbar\\\">\\r\\n    <div class=\\\"button\\\" matTooltip=\\\"Run\\\" [ngClass]=\\\"{ 'active': activeExplorer === explorer.run }\\\"\\r\\n      (click)=\\\"toggleExplorer(explorer.run)\\\">\\r\\n      <mat-icon>play_arrow</mat-icon>\\r\\n    </div>\\r\\n    <div class=\\\"button\\\" matTooltip=\\\"Add\\\" [ngClass]=\\\"{ 'active': activeExplorer === explorer.add }\\\"\\r\\n      (click)=\\\"toggleExplorer(explorer.add)\\\">\\r\\n      <mat-icon>add</mat-icon>\\r\\n    </div>\\r\\n    <div class=\\\"spacer\\\"></div>\\r\\n    <div class=\\\"button\\\" matTooltip=\\\"Help\\\" (click)=\\\"openHelp()\\\">\\r\\n      <mat-icon>help_outline</mat-icon>\\r\\n    </div>\\r\\n  </div>\\r\\n\\r\\n  <app-run-explorer [hidden]=\\\"activeExplorer !== explorer.run\\\"></app-run-explorer>\\r\\n\\r\\n  <app-add-explorer [hidden]=\\\"activeExplorer !== explorer.add\\\"></app-add-explorer>\\r\\n\\r\\n  <app-plumb-editor></app-plumb-editor>\\r\\n</div>\\r\\n\";","import { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { Dictionary } from '../../shared/models/dictionary.model';\r\nimport { EavWindow } from '../../shared/models/eav-window.model';\r\nimport { DataSource, PipelineDataSource, PipelineModel, PipelineResult, PipelineResultStream, StreamWire, VisualDesignerData } from '../models';\r\nimport { EndpointInfo, PlumbType } from './plumb-editor.models';\r\n\r\ndeclare const window: EavWindow;\r\n\r\nexport const dataSrcIdPrefix = 'dataSource_';\r\n\r\nexport class Plumber {\r\n  private instance: PlumbType;\r\n  private lineCount = 0;\r\n  private linePaintDefault = {\r\n    stroke: '#61B7CF',\r\n    strokeWidth: 4,\r\n    outlineStroke: 'white',\r\n    outlineWidth: 2,\r\n  };\r\n  private lineColors = [\r\n    '#009688', '#00bcd4', '#3f51b5', '#9c27b0', '#e91e63',\r\n    '#db4437', '#ff9800', '#60a917', '#60a917', '#008a00',\r\n    '#00aba9', '#1ba1e2', '#0050ef', '#6a00ff', '#aa00ff',\r\n    '#f472d0', '#d80073', '#a20025', '#e51400', '#fa6800',\r\n    '#f0a30a', '#e3c800', '#825a2c', '#6d8764', '#647687',\r\n    '#76608a', '#a0522d',\r\n  ];\r\n  private maxCols = this.lineColors.length - 1;\r\n  private uuidColorMap: Dictionary = {};\r\n  private bulkDelete = false;\r\n\r\n  constructor(\r\n    private jsPlumbRoot: HTMLElement,\r\n    private pipelineModel: PipelineModel,\r\n    private dataSources: DataSource[],\r\n    private onConnectionsChanged: () => void,\r\n    private onDragend: (pipelineDataSourceGuid: string, position: VisualDesignerData) => void,\r\n    private onDebugStream: (stream: PipelineResultStream) => void,\r\n  ) {\r\n    this.instance = window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot));\r\n    this.instance.batch(() => {\r\n      this.initDomDataSources();\r\n      this.initWirings();\r\n      this.bindEvents();\r\n    });\r\n    // spm NOTE: repaint after initial paint fixes:\r\n    // Error: <svg> attribute width: Expected length, \"-Infinity\".\r\n    this.instance.repaintEverything();\r\n  }\r\n\r\n  destroy() {\r\n    this.instance.reset();\r\n    this.instance.unbindContainer();\r\n  }\r\n\r\n  removeEndpointsOnDataSource(pipelineDataSourceGuid: string) {\r\n    const elementId = dataSrcIdPrefix + pipelineDataSourceGuid;\r\n    this.bulkDelete = true;\r\n    this.instance.batch(() => {\r\n      this.instance.selectEndpoints({ element: elementId }).delete();\r\n    });\r\n    this.bulkDelete = false;\r\n  }\r\n\r\n  getAllConnections() {\r\n    const connectionInfos: StreamWire[] = this.instance.getAllConnections().map((connection: PlumbType) => {\r\n      const wire: StreamWire = {\r\n        From: connection.sourceId.replace(dataSrcIdPrefix, ''),\r\n        Out: connection.endpoints[0].getOverlay('endpointLabel').label,\r\n        To: connection.targetId.replace(dataSrcIdPrefix, ''),\r\n        In: connection.endpoints[1].getOverlay('endpointLabel').label,\r\n      };\r\n      return wire;\r\n    });\r\n    return connectionInfos;\r\n  }\r\n\r\n  getStreamsOut() {\r\n    const streamsOut: string[] = [];\r\n    this.instance.selectEndpoints({ target: dataSrcIdPrefix + 'Out' }).each((endpoint: PlumbType) => {\r\n      streamsOut.push(endpoint.getOverlay('endpointLabel').label);\r\n    });\r\n    const streamsOutStr = streamsOut.join(',');\r\n    return streamsOutStr;\r\n  }\r\n\r\n  putEntityCountOnConnections(result: PipelineResult) {\r\n    result.Streams?.forEach(stream => {\r\n      const sourceElementId = dataSrcIdPrefix + stream.Source;\r\n      const outTargets = ['00000000-0000-0000-0000-000000000000', this.pipelineModel.Pipeline.EntityGuid];\r\n      const targetElementId = outTargets.includes(stream.Target) ? dataSrcIdPrefix + 'Out' : dataSrcIdPrefix + stream.Target;\r\n\r\n      const fromUuid = sourceElementId + '_out_' + stream.SourceOut;\r\n      const toUuid = targetElementId + '_in_' + stream.TargetIn;\r\n\r\n      const sEndp: PlumbType = this.instance.getEndpoint(fromUuid);\r\n      sEndp?.connections\r\n        ?.filter((connection: PlumbType) => connection.endpoints[1].getUuid() === toUuid)\r\n        ?.forEach((connection: PlumbType) => {\r\n          const label = !stream.Error ? stream.Count.toString() : '';\r\n          const cssClass = 'streamEntitiesCount ' + (!stream.Error ? '' : 'streamEntitiesError');\r\n          connection.setLabel({\r\n            label,\r\n            cssClass,\r\n            events: {\r\n              click: (labelOverlay: PlumbType) => {\r\n                if (!this.pipelineModel.Pipeline.AllowEdit) { return; }\r\n                this.onDebugStream(stream);\r\n              },\r\n            },\r\n          });\r\n        });\r\n    });\r\n  }\r\n\r\n  private nextLinePaintStyle(uuid: string) {\r\n    return (\r\n      this.uuidColorMap[uuid] ||\r\n      (this.uuidColorMap[uuid] = Object.assign({}, this.linePaintDefault, { stroke: this.lineColors[this.lineCount++ % this.maxCols] }))\r\n    );\r\n  }\r\n\r\n  private getInstanceDefaults(container: HTMLElement) {\r\n    const defaults = {\r\n      Container: container,\r\n      Connector: ['Bezier', { curviness: 70 }],\r\n      PaintStyle: this.nextLinePaintStyle('dummy'),\r\n      HoverPaintStyle: {\r\n        stroke: '#216477',\r\n        strokeWidth: 4,\r\n        outlineStroke: 'white',\r\n        outlineWidth: 2,\r\n      },\r\n    };\r\n    return defaults;\r\n  }\r\n\r\n  /** Create sources, targets and endpoints */\r\n  private initDomDataSources() {\r\n    for (const pipelineDataSource of this.pipelineModel.DataSources) {\r\n      const domDataSource = this.jsPlumbRoot.querySelector<HTMLElement>('#' + dataSrcIdPrefix + pipelineDataSource.EntityGuid);\r\n      if (!domDataSource) { continue; }\r\n      const dataSource = this.dataSources.find(ds => ds.PartAssemblyAndType === pipelineDataSource.PartAssemblyAndType);\r\n      if (!dataSource) { continue; }\r\n\r\n      if (this.pipelineModel.Pipeline.AllowEdit) {\r\n        // WARNING! Must happen before instance.makeSource()\r\n        this.instance.draggable(domDataSource, {\r\n          grid: [20, 20], stop: (event: PlumbType) => {\r\n            const element: HTMLElement = event.el;\r\n            const pipelineDataSourceGuid: string = element.id.replace(dataSrcIdPrefix, '');\r\n            const position: VisualDesignerData = {\r\n              Top: event.finalPos[1],\r\n              Left: event.finalPos[0],\r\n            };\r\n            setTimeout(() => { this.onDragend(pipelineDataSourceGuid, position); });\r\n          }\r\n        });\r\n      }\r\n\r\n      // Add Out-Endpoints from Definition\r\n      dataSource.Out?.forEach(name => {\r\n        this.addEndpoint(domDataSource, name, false, pipelineDataSource);\r\n      });\r\n\r\n      // Add In-Endpoints from Definition\r\n      dataSource.In?.forEach(name => {\r\n        this.addEndpoint(domDataSource, name, true, pipelineDataSource);\r\n      });\r\n\r\n      // Make DataSource a Target for new Endpoints (if .In is an Array)\r\n      if (dataSource.In) {\r\n        const targetEndpointUnlimited = this.buildTargetEndpoint();\r\n        targetEndpointUnlimited.maxConnections = -1;\r\n        this.instance.makeTarget(domDataSource, targetEndpointUnlimited);\r\n      }\r\n\r\n      if (dataSource.DynamicOut) {\r\n        this.instance.makeSource(domDataSource, this.buildSourceEndpoint(), { filter: '.add-endpoint' });\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Create wires */\r\n  private initWirings() {\r\n    this.pipelineModel.Pipeline.StreamWiring?.forEach(wire => {\r\n      // read connections from Pipeline\r\n      const sourceElementId = dataSrcIdPrefix + wire.From;\r\n      const fromUuid = sourceElementId + '_out_' + wire.Out;\r\n      const targetElementId = dataSrcIdPrefix + wire.To;\r\n      const toUuid = targetElementId + '_in_' + wire.In;\r\n\r\n      // Ensure In-Endpoint exist\r\n      if (!this.instance.getEndpoint(fromUuid)) {\r\n        const domDataSource = this.jsPlumbRoot.querySelector<HTMLElement>('#' + sourceElementId);\r\n        if (!domDataSource) { return; }\r\n\r\n        const guid: string = domDataSource.id.replace(dataSrcIdPrefix, '');\r\n        const pipelineDataSource = this.pipelineModel.DataSources.find(pipeDataSource => pipeDataSource.EntityGuid === guid);\r\n        this.addEndpoint(domDataSource, wire.Out, false, pipelineDataSource);\r\n      }\r\n\r\n      // Ensure Out-Endpoint exist\r\n      if (!this.instance.getEndpoint(toUuid)) {\r\n        const domDataSource = this.jsPlumbRoot.querySelector<HTMLElement>('#' + targetElementId);\r\n        if (!domDataSource) { return; }\r\n\r\n        const guid: string = domDataSource.id.replace(dataSrcIdPrefix, '');\r\n        const pipelineDataSource = this.pipelineModel.DataSources.find(pipeDataSource => pipeDataSource.EntityGuid === guid);\r\n        this.addEndpoint(domDataSource, wire.In, true, pipelineDataSource);\r\n      }\r\n\r\n      try {\r\n        this.instance.connect({\r\n          uuids: [fromUuid, toUuid],\r\n          paintStyle: this.nextLinePaintStyle(fromUuid),\r\n        });\r\n      } catch (e) {\r\n        console.error({ message: 'Connection failed', from: fromUuid, to: toUuid });\r\n      }\r\n    });\r\n  }\r\n\r\n  private addEndpoint(domDataSource: HTMLElement, endpointName: string, isIn: boolean, pipelineDataSource: PipelineDataSource) {\r\n    const dataSource = this.dataSources.find(d => d.PartAssemblyAndType === pipelineDataSource.PartAssemblyAndType);\r\n    const isDynamic = isIn\r\n      ? !dataSource.In?.some(name => this.getEndpointInfo(name, false))\r\n      : !dataSource.Out?.some(name => this.getEndpointInfo(name, false));\r\n    const endpointInfo = this.getEndpointInfo(endpointName, isDynamic);\r\n\r\n    let style: string;\r\n    if (isDynamic) {\r\n      style = 'dynamic';\r\n    } else if (!endpointInfo.required) {\r\n      style = '';\r\n    } else {\r\n      const wireExists = this.pipelineModel.Pipeline.StreamWiring?.some(wire => {\r\n        const targetElementId = dataSrcIdPrefix + wire.To;\r\n        const targetEndpointName = wire.In;\r\n\r\n        return targetElementId === domDataSource.id && targetEndpointName === endpointInfo.name;\r\n      });\r\n      style = wireExists ? '' : 'required';\r\n    }\r\n\r\n    const uuid = domDataSource.id + (isIn ? '_in_' : '_out_') + endpointInfo.name;\r\n    const model = isIn ? this.buildTargetEndpoint(style) : this.buildSourceEndpoint(style);\r\n    // Endpoints on Out-DataSource must be always enabled\r\n    const params = {\r\n      uuid,\r\n      enabled: this.pipelineModel.Pipeline.AllowEdit\r\n        || pipelineDataSource.EntityGuid === eavConstants.pipelineDesigner.outDataSource.EntityGuid\r\n    };\r\n\r\n    const endPoint: PlumbType = this.instance.addEndpoint(domDataSource, model, params);\r\n    endPoint.getOverlay('endpointLabel').setLabel(endpointInfo.name);\r\n  }\r\n\r\n  private buildSourceEndpoint(style?: string) {\r\n    const sourceEndpoint = {\r\n      paintStyle: { fill: 'transparent', radius: 10 },\r\n      cssClass: 'sourceEndpoint ' + style ?? '',\r\n      maxConnections: -1,\r\n      isSource: true,\r\n      anchor: ['Continuous', { faces: ['top'] }],\r\n      overlays: this.getEndpointOverlays(true)\r\n    };\r\n    return sourceEndpoint;\r\n  }\r\n\r\n  private buildTargetEndpoint(style?: string) {\r\n    const targetEndpoint = {\r\n      paintStyle: { fill: 'transparent', radius: 10 },\r\n      cssClass: 'targetEndpoint ' + style ?? '',\r\n      maxConnections: 1,\r\n      isTarget: true,\r\n      anchor: ['Continuous', { faces: ['bottom'] }],\r\n      overlays: this.getEndpointOverlays(false),\r\n      dropOptions: { hoverClass: 'hover', activeClass: 'active' }\r\n    };\r\n    return targetEndpoint;\r\n  }\r\n\r\n  private getEndpointOverlays(isSource: boolean) {\r\n    return [\r\n      [\r\n        'Label', {\r\n          id: 'endpointLabel',\r\n          location: [0.5, isSource ? 0 : 1],\r\n          label: 'Default',\r\n          cssClass: isSource ? 'endpointSourceLabel' : 'endpointTargetLabel',\r\n          events: {\r\n            click: (labelOverlay: PlumbType) => {\r\n              if (!this.pipelineModel.Pipeline.AllowEdit) { return; }\r\n\r\n              const newLabel = prompt('Rename stream', labelOverlay.label);\r\n              if (!newLabel) { return; }\r\n              labelOverlay.setLabel(newLabel);\r\n              setTimeout(() => { this.onConnectionsChanged(); });\r\n            },\r\n          },\r\n        }\r\n      ]\r\n    ];\r\n  }\r\n\r\n  private bindEvents() {\r\n    this.instance.bind('connectionDetached', (info: PlumbType) => {\r\n      if (this.bulkDelete) { return; }\r\n      const domDataSource: HTMLElement = info.target;\r\n      const pipelineDataSource = this.pipelineModel.DataSources.find(\r\n        pipelineDS => pipelineDS.EntityGuid === domDataSource.id.replace(dataSrcIdPrefix, '')\r\n      );\r\n      const dataSource = this.dataSources.find(ds => ds.PartAssemblyAndType === pipelineDataSource.PartAssemblyAndType);\r\n      const label: string = info.targetEndpoint.getOverlay('endpointLabel').label;\r\n      const isDynamic = !dataSource.In.some(name => this.getEndpointInfo(name, false).name === label);\r\n      if (isDynamic) {\r\n        this.instance.deleteEndpoint(info.targetEndpoint);\r\n        setTimeout(() => { this.onConnectionsChanged(); });\r\n      } else {\r\n        setTimeout(() => { this.onConnectionsChanged(); });\r\n      }\r\n    });\r\n\r\n    this.instance.bind('connection', (info: PlumbType) => {\r\n      if (info.sourceId === info.targetId) {\r\n        setTimeout(() => {\r\n          this.instance.deleteConnection(info.connection, { fireEvent: false });\r\n          setTimeout(() => { this.onConnectionsChanged(); });\r\n        });\r\n        return;\r\n      }\r\n      const endpointLabel: PlumbType = info.targetEndpoint.getOverlay('endpointLabel');\r\n      const labelPrompt: string = endpointLabel.getLabel();\r\n      const endpoints: PlumbType[] = this.instance.getEndpoints(info.target.id);\r\n      const targetEndpointHasSameLabel = endpoints.some(endpoint => {\r\n        const label: string = endpoint.getOverlay('endpointLabel').getLabel();\r\n        return label === labelPrompt &&\r\n          info.targetEndpoint.id !== endpoint.id &&\r\n          (endpoint.canvas as HTMLCanvasElement).classList.contains('targetEndpoint');\r\n      });\r\n      if (targetEndpointHasSameLabel) {\r\n        endpointLabel.setLabel(`PleaseRename${Math.floor(Math.random() * 99999)}`);\r\n      }\r\n      setTimeout(() => { this.onConnectionsChanged(); });\r\n    });\r\n  }\r\n\r\n  private getEndpointInfo(endpointName: string, isDynamic: boolean): EndpointInfo {\r\n    let name: string;\r\n    let required: boolean;\r\n\r\n    if (isDynamic) {\r\n      name = endpointName;\r\n      required = false;\r\n    } else {\r\n      const trimmed = endpointName.trim();\r\n      required = trimmed.endsWith('*');\r\n      name = !required ? trimmed : trimmed.substring(0, trimmed.length - 1);\r\n    }\r\n\r\n    const endpointInfo: EndpointInfo = {\r\n      name,\r\n      required,\r\n    };\r\n    return endpointInfo;\r\n  }\r\n}\r\n","import { HttpErrorResponse } from '@angular/common/http';\r\nimport { ChangeDetectorRef, Injectable, NgZone, OnDestroy, ViewContainerRef } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { Title } from '@angular/platform-browser';\r\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\r\nimport cloneDeep from 'lodash-es/cloneDeep';\r\nimport { BehaviorSubject, fromEvent, Subject, Subscription } from 'rxjs';\r\nimport { filter, map, pairwise, startWith } from 'rxjs/operators';\r\nimport { ContentTypesService } from '../../app-administration/services/content-types.service';\r\nimport { MetadataService } from '../../permissions/services/metadata.service';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { convertFormToUrl } from '../../shared/helpers/url-prep.helper';\r\nimport { EditForm } from '../../shared/models/edit-form.model';\r\n// tslint:disable-next-line:max-line-length\r\nimport { DataSource, DataSourceMetadata, DebugStreamInfo, PipelineDataSource, PipelineModel, PipelineResult, PipelineResultStream, StreamWire, VisualDesignerData } from '../models';\r\nimport { QueryResultComponent } from '../query-result/query-result.component';\r\nimport { QueryResultDialogData } from '../query-result/query-result.models';\r\nimport { StreamErrorResultComponent } from '../stream-error-result/stream-error-result.component';\r\nimport { StreamErrorResultDialogData } from '../stream-error-result/stream-error-result.models';\r\nimport { QueryDefinitionService } from './query-definition.service';\r\n\r\n@Injectable()\r\nexport class VisualQueryService implements OnDestroy {\r\n  pipelineModel$ = new BehaviorSubject<PipelineModel>(null);\r\n  dataSources$ = new BehaviorSubject<DataSource[]>(null);\r\n  putEntityCountOnConnections$ = new Subject<PipelineResult>();\r\n\r\n  private pipelineId = parseInt(this.route.snapshot.paramMap.get('pipelineId'), 10);\r\n  private doRefresh = false;\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private queryDefinitionService: QueryDefinitionService,\r\n    private titleService: Title,\r\n    private snackBar: MatSnackBar,\r\n    private dialog: MatDialog,\r\n    private viewContainerRef: ViewContainerRef,\r\n    private zone: NgZone,\r\n    private metadataService: MetadataService,\r\n    private contentTypesService: ContentTypesService,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n  ) { }\r\n\r\n  ngOnDestroy() {\r\n    this.pipelineModel$.complete();\r\n    this.dataSources$.complete();\r\n    this.putEntityCountOnConnections$.complete();\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  init() {\r\n    this.fetchDataSources(() => this.fetchPipeline());\r\n    this.attachKeyboardSave();\r\n    this.refreshOnChildClosed();\r\n  }\r\n\r\n  editPipelineEntity() {\r\n    // save Pipeline, then open Edit Dialog\r\n    this.savePipeline(() => {\r\n      const form: EditForm = {\r\n        items: [{ EntityId: this.pipelineModel$.value.Pipeline.EntityId }],\r\n      };\r\n      const formUrl = convertFormToUrl(form);\r\n      this.doRefresh = true;\r\n      this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n    });\r\n  }\r\n\r\n  saveAndRun(save: boolean, run: boolean) {\r\n    if (save && run) {\r\n      this.savePipeline(() => { this.runPipeline(); });\r\n    } else if (save) {\r\n      this.savePipeline();\r\n    } else if (run) {\r\n      this.runPipeline();\r\n    }\r\n  }\r\n\r\n  addDataSource(dataSource: DataSource) {\r\n    const pipelineModel = cloneDeep(this.pipelineModel$.value);\r\n    const newPipelineDataSource: PipelineDataSource = {\r\n      Description: '',\r\n      EntityGuid: 'unsaved' + (pipelineModel.DataSources.length + 1),\r\n      EntityId: undefined,\r\n      Name: dataSource.Name,\r\n      PartAssemblyAndType: dataSource.PartAssemblyAndType,\r\n      VisualDesignerData: { Top: 100, Left: 100 },\r\n    };\r\n    pipelineModel.DataSources.push(newPipelineDataSource);\r\n    this.pipelineModel$.next(pipelineModel);\r\n    this.savePipeline();\r\n  }\r\n\r\n  removeDataSource(pipelineDataSourceGuid: string, connections: StreamWire[], streamsOut: string) {\r\n    const pipelineModel = cloneDeep(this.pipelineModel$.value);\r\n    pipelineModel.DataSources = pipelineModel.DataSources.filter(pipelineDS => pipelineDS.EntityGuid !== pipelineDataSourceGuid);\r\n    pipelineModel.Pipeline.StreamWiring = connections;\r\n    pipelineModel.Pipeline.StreamsOut = streamsOut;\r\n    this.pipelineModel$.next(pipelineModel);\r\n  }\r\n\r\n  renameDataSource(pipelineDataSourceGuid: string, name: string) {\r\n    const pipelineModel = cloneDeep(this.pipelineModel$.value);\r\n    const pipelineDataSource = pipelineModel.DataSources.find(pipelineDS => pipelineDS.EntityGuid === pipelineDataSourceGuid);\r\n    pipelineDataSource.Name = name;\r\n    this.pipelineModel$.next(pipelineModel);\r\n  }\r\n\r\n  changeDataSourceDescription(pipelineDataSourceGuid: string, description: string) {\r\n    const pipelineModel = cloneDeep(this.pipelineModel$.value);\r\n    const pipelineDataSource = pipelineModel.DataSources.find(pipelineDS => pipelineDS.EntityGuid === pipelineDataSourceGuid);\r\n    pipelineDataSource.Description = description;\r\n    this.pipelineModel$.next(pipelineModel);\r\n  }\r\n\r\n  changeConnections(connections: StreamWire[], streamsOut: string) {\r\n    const pipelineModel = cloneDeep(this.pipelineModel$.value);\r\n    pipelineModel.Pipeline.StreamWiring = connections;\r\n    pipelineModel.Pipeline.StreamsOut = streamsOut;\r\n    this.pipelineModel$.next(pipelineModel);\r\n  }\r\n\r\n  changeDataSourcePosition(pipelineDataSourceGuid: string, position: VisualDesignerData) {\r\n    const pipelineModel = cloneDeep(this.pipelineModel$.value);\r\n    const pipelineDataSource = pipelineModel.DataSources.find(pipelineDS => pipelineDS.EntityGuid === pipelineDataSourceGuid);\r\n    if (!pipelineDataSource) {\r\n      // spm NOTE: fixes problem where dataSource position can't be updated if dataSource with guid unsavedXX gets saved while dragging.\r\n      // Can happen if dataSource is just added and user drags it and save happens.\r\n      return;\r\n    }\r\n    pipelineDataSource.VisualDesignerData = { ...pipelineDataSource.VisualDesignerData, ...position };\r\n    this.pipelineModel$.next(pipelineModel);\r\n  }\r\n\r\n  editDataSource(pipelineDataSource: PipelineDataSource) {\r\n    const dataSource = this.dataSources$.value.find(ds => ds.PartAssemblyAndType === pipelineDataSource.PartAssemblyAndType);\r\n\r\n    // const contentTypeName = dataSource?.ContentType\r\n    //   ?? '|Config ' + this.queryDefinitionService.typeNameFilter(pipelineDataSource.PartAssemblyAndType, 'classFullName');\r\n    const contentTypeName = dataSource.ContentType;\r\n    const typeId = eavConstants.metadata.entity.type;\r\n    const keyType = eavConstants.keyTypes.guid;\r\n    const key = pipelineDataSource.EntityGuid;\r\n\r\n    // query for existing Entity\r\n    this.metadataService.getMetadata<DataSourceMetadata[]>(typeId, keyType, key, contentTypeName).subscribe(metadata => {\r\n      // edit existing Entity\r\n      if (metadata.length) {\r\n        const form: EditForm = {\r\n          items: [{ EntityId: metadata[0].Id }],\r\n        };\r\n        const formUrl = convertFormToUrl(form);\r\n        this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n        return;\r\n      }\r\n\r\n      // Check if the type exists, and if yes, create new Entity\r\n      this.contentTypesService.retrieveContentType(contentTypeName /*, { ignoreErrors: 'true' } */).subscribe({\r\n        next: contentType => {\r\n          const form: EditForm = {\r\n            items: [{\r\n              ContentTypeName: contentTypeName,\r\n              For: {\r\n                Target: eavConstants.metadata.entity.target,\r\n                Guid: key,\r\n              }\r\n            }],\r\n          };\r\n          const formUrl = convertFormToUrl(form);\r\n          this.router.navigate([`edit/${formUrl}`], { relativeTo: this.route });\r\n        },\r\n        error: (error: HttpErrorResponse) => {\r\n          alert('Server reports error - this usually means that this data-source doesn\\'t have any configuration');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private savePipeline(callback?: () => void) {\r\n    this.snackBar.open('Saving...');\r\n    this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({\r\n      next: pipelineModel => {\r\n        this.snackBar.open('Saved', null, { duration: 2000 });\r\n        this.pipelineModel$.next(pipelineModel);\r\n        if (callback != null) { callback(); }\r\n      },\r\n      error: (error: HttpErrorResponse) => {\r\n        this.snackBar.open('Save Pipeline failed', null, { duration: 2000 });\r\n      }\r\n    });\r\n  }\r\n\r\n  runPipeline(top = 25) {\r\n    this.snackBar.open('Running query...');\r\n    this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId, top).subscribe({\r\n      next: pipelineResult => {\r\n        this.snackBar.open('Query worked', null, { duration: 2000 });\r\n        this.showQueryResult(pipelineResult, top);\r\n        console.warn(pipelineResult);\r\n        // push cloned pipelineModel to reset jsPlumb\r\n        this.pipelineModel$.next(cloneDeep(this.pipelineModel$.value));\r\n        setTimeout(() => { this.putEntityCountOnConnections$.next(pipelineResult); });\r\n      },\r\n      error: (error: HttpErrorResponse) => {\r\n        this.snackBar.open('Query failed', null, { duration: 2000 });\r\n      }\r\n    });\r\n  }\r\n\r\n  debugStream(stream: PipelineResultStream, top = 25) {\r\n    if (stream.Error) {\r\n      this.showStreamErrorResult(stream);\r\n      return;\r\n    }\r\n\r\n    if (stream.Count === 0) { return; }\r\n\r\n    this.snackBar.open('Running stream...');\r\n    const pipelineId = this.pipelineModel$.value.Pipeline.EntityId;\r\n    this.queryDefinitionService.debugStream(pipelineId, stream.Source, stream.SourceOut, top).subscribe({\r\n      next: streamResult => {\r\n        this.snackBar.open('Stream worked', null, { duration: 2000 });\r\n        const pipelineDataSource = this.pipelineModel$.value.DataSources.find(ds => ds.EntityGuid === stream.Source);\r\n        const debugStream: DebugStreamInfo = {\r\n          name: stream.SourceOut,\r\n          source: stream.Source,\r\n          sourceName: pipelineDataSource.Name,\r\n          original: stream,\r\n        };\r\n        this.showQueryResult(streamResult, top, debugStream);\r\n        console.warn(streamResult);\r\n      },\r\n      error: (error: HttpErrorResponse) => {\r\n        this.snackBar.open('Stream failed', null, { duration: 2000 });\r\n      },\r\n    });\r\n  }\r\n\r\n  private fetchPipeline(reloadingSnackBar = false) {\r\n    if (reloadingSnackBar) {\r\n      this.snackBar.open('Reloading query, please wait...');\r\n    }\r\n    this.queryDefinitionService.fetchPipeline(this.pipelineId, this.dataSources$.value).subscribe(pipelineModel => {\r\n      if (reloadingSnackBar) {\r\n        this.snackBar.open('Query reloaded', null, { duration: 2000 });\r\n      }\r\n      this.pipelineModel$.next(pipelineModel);\r\n      this.titleService.setTitle(`${pipelineModel.Pipeline.Name} - Visual Query`);\r\n    });\r\n  }\r\n\r\n  private showQueryResult(result: PipelineResult, top: number, debugStream?: DebugStreamInfo) {\r\n    const dialogData: QueryResultDialogData = {\r\n      result,\r\n      debugStream,\r\n      top,\r\n    };\r\n    this.dialog.open(QueryResultComponent, {\r\n      autoFocus: false,\r\n      backdropClass: 'dialog-backdrop',\r\n      closeOnNavigation: false,\r\n      data: dialogData,\r\n      panelClass: ['dialog-panel', `dialog-panel-medium`, 'no-scrollbar'],\r\n      // spm NOTE: position used to force align-items: flex-start; on cdk-global-overlay-wrapper.\r\n      // Real top margin is overwritten in css e.g. dialog-panel-large\r\n      position: { top: '0' },\r\n      viewContainerRef: this.viewContainerRef,\r\n    });\r\n    this.changeDetectorRef.markForCheck();\r\n  }\r\n\r\n  private showStreamErrorResult(stream: PipelineResultStream) {\r\n    const dialogData: StreamErrorResultDialogData = {\r\n      errorData: stream.ErrorData,\r\n    };\r\n    this.dialog.open(StreamErrorResultComponent, {\r\n      autoFocus: false,\r\n      backdropClass: 'dialog-backdrop',\r\n      closeOnNavigation: false,\r\n      data: dialogData,\r\n      panelClass: ['dialog-panel', `dialog-panel-medium`, 'no-scrollbar'],\r\n      // spm NOTE: position used to force align-items: flex-start; on cdk-global-overlay-wrapper.\r\n      // Real top margin is overwritten in css e.g. dialog-panel-large\r\n      position: { top: '0' },\r\n      viewContainerRef: this.viewContainerRef,\r\n    });\r\n    this.changeDetectorRef.markForCheck();\r\n  }\r\n\r\n  private fetchDataSources(callback?: () => void) {\r\n    this.queryDefinitionService.fetchDataSources().subscribe(dataSources => {\r\n      this.dataSources$.next(dataSources);\r\n      callback();\r\n    });\r\n  }\r\n\r\n  private attachKeyboardSave() {\r\n    this.zone.runOutsideAngular(() => {\r\n      this.subscription.add(\r\n        fromEvent(window, 'keydown').pipe(\r\n          filter(() => !this.route.snapshot.firstChild),\r\n          filter((event: KeyboardEvent) => {\r\n            const CTRL_S = (navigator.platform.match('Mac') ? event.metaKey : event.ctrlKey) && event.keyCode === 83;\r\n            return CTRL_S;\r\n          }),\r\n        ).subscribe(event => {\r\n          event.preventDefault();\r\n          this.zone.run(() => { this.savePipeline(); });\r\n        })\r\n      );\r\n    });\r\n  }\r\n\r\n  private refreshOnChildClosed() {\r\n    this.subscription.add(\r\n      this.router.events.pipe(\r\n        filter(event => event instanceof NavigationEnd),\r\n        startWith(!!this.route.snapshot.firstChild),\r\n        map(() => !!this.route.snapshot.firstChild),\r\n        pairwise(),\r\n        filter(([hadChild, hasChild]) => hadChild && !hasChild),\r\n        filter(() => {\r\n          const refresh = this.doRefresh;\r\n          this.doRefresh = false;\r\n          return refresh;\r\n        }),\r\n      ).subscribe(() => {\r\n        this.fetchPipeline(true);\r\n      })\r\n    );\r\n  }\r\n\r\n}\r\n","export default \".description {\\n  font-size: 14px;\\n}\\n\\npre {\\n  display: block;\\n  padding: 9.5px;\\n  margin: 0 0 10px;\\n  font-size: 13px;\\n  line-height: 1.42857143;\\n  color: #333;\\n  word-break: break-all;\\n  word-wrap: break-word;\\n  background-color: #f5f5f5;\\n  border: 1px solid #ccc;\\n  border-radius: 4px;\\n  overflow-x: auto;\\n}\\n\\n.mat-icon {\\n  margin-right: 4px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uXFwuLlxcLi5cXC4uXFwuLlxcLi5cXHN0cmVhbS1lcnJvci1yZXN1bHQuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxlQUFBO0FBQ0Y7O0FBRUE7RUFDRSxjQUFBO0VBQ0EsY0FBQTtFQUNBLGdCQUFBO0VBQ0EsZUFBQTtFQUNBLHVCQUFBO0VBQ0EsV0FBQTtFQUNBLHFCQUFBO0VBQ0EscUJBQUE7RUFDQSx5QkFBQTtFQUNBLHNCQUFBO0VBQ0Esa0JBQUE7RUFDQSxnQkFBQTtBQUNGOztBQUVBO0VBQ0UsaUJBQUE7QUFDRiIsImZpbGUiOiJzdHJlYW0tZXJyb3ItcmVzdWx0LmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmRlc2NyaXB0aW9uIHtcclxuICBmb250LXNpemU6IDE0cHg7XHJcbn1cclxuXHJcbnByZSB7XHJcbiAgZGlzcGxheTogYmxvY2s7XHJcbiAgcGFkZGluZzogOS41cHg7XHJcbiAgbWFyZ2luOiAwIDAgMTBweDtcclxuICBmb250LXNpemU6IDEzcHg7XHJcbiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7XHJcbiAgY29sb3I6ICMzMzM7XHJcbiAgd29yZC1icmVhazogYnJlYWstYWxsO1xyXG4gIHdvcmQtd3JhcDogYnJlYWstd29yZDtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1O1xyXG4gIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7XHJcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xyXG4gIG92ZXJmbG93LXg6IGF1dG87XHJcbn1cclxuXHJcbi5tYXQtaWNvbiB7XHJcbiAgbWFyZ2luLXJpZ2h0OiA0cHg7XHJcbn1cclxuIl19 */\";","import { DataSource, PipelineDataSource } from '../models';\r\nimport { GuiTypes, TypeInfo, TypeInfos } from './plumb-editor.models';\r\n\r\nexport const guiTypes: GuiTypes = {\r\n  Cache: { Name: 'Cache', Icon: 'history', UiHint: 'Caching of data' },\r\n  Filter: { Name: 'Filter', Icon: 'filter_list', UiHint: 'Filter data - usually returning less items than came in' },\r\n  Logic: { Name: 'Logic', Icon: 'share', UiHint: 'Logic operations - usually choosing between different streams' },\r\n  Lookup: { Name: 'Lookup', Icon: 'search', UiHint: 'Lookup operation - usually looking for other data based on a criteria' },\r\n  Modify: { Name: 'Modify', Icon: 'edit_attributes', UiHint: 'Modify data - usually changing, adding or removing values' },\r\n  Security: { Name: 'Security', Icon: 'account_circle', UiHint: 'Security - usually limit what the user sees based on his identity' },\r\n  Sort: { Name: 'Sort', Icon: 'sort', UiHint: 'Sort the items' },\r\n  Source: { Name: 'Source', Icon: 'cloud_upload', UiHint: 'Source of new data - usually SQL, CSV or similar' },\r\n  Target: { Name: 'Target', Icon: 'adjust', UiHint: 'Target - usually just a destination of data' },\r\n  Unknown: { Name: 'Unknown', Icon: 'fiber_manual_record', UiHint: 'Unknown type' },\r\n  Debug: { Name: 'Debug', Icon: 'bug_report', UiHint: 'Debugging Tools'},\r\n  System: { Name: 'System', Icon: 'military_tech', UiHint: 'System Data' },\r\n};\r\n\r\nexport function calculateTypeInfos(pipelineDataSources: PipelineDataSource[], dataSources: DataSource[]) {\r\n  const typeInfos: TypeInfos = {};\r\n\r\n  for (const pipelineDataSource of pipelineDataSources) {\r\n    let typeInfo: TypeInfo;\r\n    const dataSource = dataSources.find(ds => ds.PartAssemblyAndType === pipelineDataSource.PartAssemblyAndType);\r\n    if (dataSource) {\r\n      typeInfo = { ...(dataSource.PrimaryType ? guiTypes[dataSource.PrimaryType] : guiTypes.Unknown) };\r\n      if (dataSource.Icon != null) { typeInfo.Icon = dataSource.Icon; }\r\n      if (dataSource.DynamicIn != null) { typeInfo.DynamicIn = dataSource.DynamicIn; }\r\n      if (dataSource.DynamicOut != null) { typeInfo.DynamicOut = dataSource.DynamicOut; }\r\n      if (dataSource.HelpLink != null) { typeInfo.HelpLink = dataSource.HelpLink; }\r\n      if (dataSource.EnableConfig != null) { typeInfo.EnableConfig = dataSource.EnableConfig; }\r\n      if (dataSource.UiHint != null) { typeInfo.UiHint = dataSource.UiHint; }\r\n    }\r\n    if (!typeInfo) { typeInfo = { ...guiTypes.Unknown }; }\r\n    typeInfos[pipelineDataSource.EntityGuid] = typeInfo;\r\n  }\r\n\r\n  return typeInfos;\r\n}\r\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwbHVtYi1lZGl0b3IuY29tcG9uZW50LnNjc3MifQ== */\";","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { ContentTypesService } from '../app-administration/services/content-types.service';\r\nimport { MetadataService } from '../permissions/services/metadata.service';\r\nimport { Context } from '../shared/services/context';\r\nimport { SharedComponentsModule } from '../shared/shared-components.module';\r\nimport { AddExplorerComponent } from './add-explorer/add-explorer.component';\r\nimport { PlumbEditorComponent } from './plumb-editor/plumb-editor.component';\r\nimport { QueryResultComponent } from './query-result/query-result.component';\r\nimport { RunExplorerComponent } from './run-explorer/run-explorer.component';\r\nimport { QueryDefinitionService } from './services/query-definition.service';\r\nimport { StreamErrorResultComponent } from './stream-error-result/stream-error-result.component';\r\nimport { VisualQueryRoutingModule } from './visual-query-routing.module';\r\nimport { VisualQueryComponent } from './visual-query.component';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    VisualQueryComponent,\r\n    RunExplorerComponent,\r\n    AddExplorerComponent,\r\n    PlumbEditorComponent,\r\n    QueryResultComponent,\r\n    StreamErrorResultComponent,\r\n  ],\r\n  entryComponents: [\r\n    VisualQueryComponent,\r\n    RunExplorerComponent,\r\n    AddExplorerComponent,\r\n    PlumbEditorComponent,\r\n    QueryResultComponent,\r\n    StreamErrorResultComponent,\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    SharedComponentsModule,\r\n    VisualQueryRoutingModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatButtonModule,\r\n    MatSlideToggleModule,\r\n    MatSnackBarModule,\r\n    MatDialogModule,\r\n    MatTabsModule,\r\n  ],\r\n  providers: [\r\n    Context,\r\n    QueryDefinitionService,\r\n    MetadataService,\r\n    ContentTypesService,\r\n  ],\r\n})\r\nexport class VisualQueryModule { }\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { map } from 'rxjs/operators';\r\nimport { webApiQueryDataSources, webApiQueryDebugStream, webApiQueryGet, webApiQueryRun, webApiQuerySave } from '../../app-administration/services';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { Context } from '../../shared/services/context';\r\nimport { DataSource, PipelineDataSource, PipelineModel, PipelineResult } from '../models';\r\n\r\n@Injectable()\r\nexport class QueryDefinitionService {\r\n  constructor(private http: HttpClient, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  fetchPipeline(pipelineEntityId: number, dataSources: DataSource[]) {\r\n    return this.http.get<PipelineModel>(this.dnnContext.$2sxc.http.apiUrl(webApiQueryGet), {\r\n      params: { appId: this.context.appId.toString(), id: pipelineEntityId.toString() }\r\n    }).pipe(\r\n      map(pipelineModel => {\r\n        // if pipeline is new, populate it with default model\r\n        if (!pipelineModel.DataSources.length) {\r\n          this.buildDefaultModel(pipelineModel, dataSources);\r\n        }\r\n        this.fixPipelineDataSources(pipelineModel.DataSources);\r\n        return pipelineModel;\r\n      }),\r\n    );\r\n  }\r\n\r\n  private buildDefaultModel(pipelineModel: PipelineModel, dataSources: DataSource[]) {\r\n    const templateDataSources = eavConstants.pipelineDesigner.defaultPipeline.dataSources;\r\n    for (const templateDS of templateDataSources) {\r\n      const dataSource = dataSources.find(ds => ds.PartAssemblyAndType === templateDS.PartAssemblyAndType);\r\n      const pipelineDataSource: PipelineDataSource = {\r\n        Description: '',\r\n        EntityGuid: templateDS.EntityGuid,\r\n        EntityId: undefined,\r\n        Name: dataSource.Name,\r\n        PartAssemblyAndType: templateDS.PartAssemblyAndType,\r\n        VisualDesignerData: templateDS.VisualDesignerData,\r\n      };\r\n      pipelineModel.DataSources.push(pipelineDataSource);\r\n    }\r\n\r\n    pipelineModel.Pipeline.StreamWiring = eavConstants.pipelineDesigner.defaultPipeline.streamWiring;\r\n  }\r\n\r\n  private fixPipelineDataSources(pipelineDataSources: PipelineDataSource[]) {\r\n    const outDataSourceExists = pipelineDataSources.some(\r\n      pipelineDS => pipelineDS.EntityGuid === eavConstants.pipelineDesigner.outDataSource.EntityGuid\r\n    );\r\n    if (!outDataSourceExists) {\r\n      const outDs = eavConstants.pipelineDesigner.outDataSource;\r\n      const outDsConst: PipelineDataSource = {\r\n        Description: outDs.Description,\r\n        EntityGuid: outDs.EntityGuid,\r\n        EntityId: undefined,\r\n        Name: outDs.Name,\r\n        PartAssemblyAndType: outDs.PartAssemblyAndType,\r\n        VisualDesignerData: outDs.VisualDesignerData,\r\n      };\r\n      pipelineDataSources.push(outDsConst);\r\n    }\r\n\r\n    for (const pipelineDataSource of pipelineDataSources) {\r\n      pipelineDataSource.VisualDesignerData ??= { Top: 50, Left: 50 };\r\n    }\r\n  }\r\n\r\n  fetchDataSources() {\r\n    return this.http.get<DataSource[]>(this.dnnContext.$2sxc.http.apiUrl(webApiQueryDataSources)).pipe(\r\n      map(dataSources => {\r\n        const outDs = eavConstants.pipelineDesigner.outDataSource;\r\n        const outDsConst: DataSource = {\r\n          ContentType: undefined,\r\n          Difficulty: eavConstants.pipelineDesigner.dataSourceDifficulties.default,\r\n          DynamicIn: true,\r\n          DynamicOut: false,\r\n          EnableConfig: undefined,\r\n          HelpLink: undefined,\r\n          Icon: undefined,\r\n          In: outDs.In,\r\n          Name: outDs.Name,\r\n          Out: undefined,\r\n          PartAssemblyAndType: outDs.PartAssemblyAndType,\r\n          PrimaryType: outDs.PrimaryType,\r\n          UiHint: undefined,\r\n        };\r\n        dataSources.push(outDsConst);\r\n        return dataSources;\r\n      }),\r\n    );\r\n  }\r\n\r\n  typeNameFilter(input: string, format: 'className' | 'classFullName') {\r\n    const globalParts = input.split(', ');\r\n\r\n    switch (format) {\r\n      case 'classFullName':\r\n        const classFullName = globalParts[0];\r\n        return classFullName;\r\n      case 'className':\r\n        const classFullNameParts = globalParts[0].split('.');\r\n        const className = classFullNameParts[classFullNameParts.length - 1];\r\n        return className;\r\n      default:\r\n        return input;\r\n    }\r\n  }\r\n\r\n  /** Save the current query and reload entire definition as returned from server */\r\n  savePipeline(pipelineModel: PipelineModel) {\r\n    const pipeline = pipelineModel.Pipeline;\r\n    const dataSources = pipelineModel.DataSources;\r\n\r\n    return this.http.post<PipelineModel>(\r\n      this.dnnContext.$2sxc.http.apiUrl(webApiQuerySave),\r\n      { pipeline, dataSources },\r\n      { params: { appId: this.context.appId.toString(), Id: pipeline.EntityId.toString() } }\r\n    ).pipe(\r\n      map(newPipelineModel => {\r\n        this.fixPipelineDataSources(newPipelineModel.DataSources);\r\n        return newPipelineModel;\r\n      }),\r\n    );\r\n  }\r\n\r\n  /** `top` - fetch first X items */\r\n  runPipeline(id: number, top: number) {\r\n    return this.http.get<PipelineResult>(this.dnnContext.$2sxc.http.apiUrl(webApiQueryRun), {\r\n      params: { appId: this.context.appId.toString(), id: id.toString(), top: top.toString() }\r\n    });\r\n  }\r\n\r\n  /** `top` - fetch first X items */\r\n  debugStream(id: number, source: string, sourceOut: string, top: number) {\r\n    return this.http.get<PipelineResult>(this.dnnContext.$2sxc.http.apiUrl(webApiQueryDebugStream), {\r\n      params: { appId: this.context.appId.toString(), id: id.toString(), from: source, out: sourceOut, top: top.toString() }\r\n    });\r\n  }\r\n}\r\n","import { KeyValue } from '@angular/common';\r\nimport { ChangeDetectionStrategy, Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\r\nimport { BehaviorSubject, combineLatest, Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { GeneralHelpers } from '../../../../../edit/shared/helpers';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { DataSource, SortedDataSources } from '../models';\r\nimport { guiTypes } from '../plumb-editor/plumb-editor.helpers';\r\nimport { VisualQueryService } from '../services/visual-query.service';\r\nimport { filterAndSortDataSources } from './add-explorer.helpers';\r\n\r\n@Component({\r\n  selector: 'app-add-explorer',\r\n  templateUrl: './add-explorer.component.html',\r\n  styleUrls: ['./add-explorer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class AddExplorerComponent implements OnInit, OnDestroy {\r\n  sorted$: Observable<SortedDataSources>;\r\n  toggledItems: string[] = [];\r\n  guiTypes = guiTypes;\r\n\r\n  private difficulties = eavConstants.pipelineDesigner.dataSourceDifficulties;\r\n  private difficulty$ = new BehaviorSubject(this.difficulties.default);\r\n\r\n  constructor(private visualQueryService: VisualQueryService) { }\r\n\r\n  ngOnInit() {\r\n    this.sorted$ = combineLatest([this.visualQueryService.dataSources$, this.difficulty$]).pipe(\r\n      map(([dataSources, difficulty]) => filterAndSortDataSources(dataSources, difficulty)),\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.difficulty$.complete();\r\n  }\r\n\r\n  toggleDifficulty(event: MatSlideToggleChange) {\r\n    const difficulty = event.checked ? this.difficulties.advanced : this.difficulties.default;\r\n    this.difficulty$.next(difficulty);\r\n  }\r\n\r\n  addDataSource(dataSource: DataSource) {\r\n    this.visualQueryService.addDataSource(dataSource);\r\n  }\r\n\r\n  toggleItem(item: string) {\r\n    GeneralHelpers.toggleInArray(item, this.toggledItems);\r\n  }\r\n\r\n  trackGroups(index: number, type: KeyValue<string, DataSource[]>) {\r\n    return type.key;\r\n  }\r\n\r\n  trackDataSources(index: number, dataSource: DataSource) {\r\n    return dataSource.PartAssemblyAndType;\r\n  }\r\n}\r\n","import { Context as DnnContext } from '@2sic.com/dnn-sxc-angular';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { map } from 'rxjs/operators';\r\nimport { ImportAppResult } from '../../import-app/models/import-app-result.model';\r\nimport { EavScopeOption } from '../../shared/constants/eav.constants';\r\nimport { Dictionary } from '../../shared/models/dictionary.model';\r\nimport { Context } from '../../shared/services/context';\r\nimport { ContentType, ContentTypeEdit } from '../models/content-type.model';\r\n\r\nexport const webApiTypeRoot = 'admin/type/';\r\n\r\n@Injectable()\r\nexport class ContentTypesService {\r\n  constructor(private http: HttpClient, private context: Context, private dnnContext: DnnContext) { }\r\n\r\n  private apiUrl(name: string) {\r\n    return this.dnnContext.$2sxc.http.apiUrl(name);\r\n  }\r\n\r\n  retrieveContentType(staticName: string) {\r\n    return this.http.get<ContentType>(this.apiUrl(webApiTypeRoot + 'get'), {\r\n      params: { appId: this.context.appId.toString(), contentTypeId: staticName }\r\n    });\r\n  }\r\n\r\n  retrieveContentTypes(scope: string) {\r\n    return this.http.get<ContentType[]>(this.apiUrl(webApiTypeRoot + 'list'), {\r\n      params: { appId: this.context.appId.toString(), scope }\r\n    });\r\n  }\r\n\r\n  getScopes() {\r\n    return this.http.get<Dictionary<string>>(this.apiUrl(webApiTypeRoot + 'scopes'), {\r\n      params: { appId: this.context.appId.toString() }\r\n    }).pipe(\r\n      map(scopes => {\r\n        const scopeOptions: EavScopeOption[] = Object.keys(scopes).map(key => ({ name: scopes[key], value: key }));\r\n        return scopeOptions;\r\n      }),\r\n    );\r\n  }\r\n\r\n  save(contentType: ContentTypeEdit) {\r\n    return this.http.post<boolean>(this.apiUrl(webApiTypeRoot + 'save'), contentType, {\r\n      params: { appid: this.context.appId.toString() },\r\n    });\r\n  }\r\n\r\n  delete(contentType: ContentType) {\r\n    return this.http.delete<boolean>(this.apiUrl(webApiTypeRoot + 'delete'), {\r\n      params: { appid: this.context.appId.toString(), staticName: contentType.StaticName },\r\n    });\r\n  }\r\n\r\n  import(files: File[]) {\r\n    const formData = new FormData();\r\n    for (const file of files) {\r\n      formData.append('File', file);\r\n    }\r\n    return this.http.post<ImportAppResult>(this.apiUrl(webApiTypeRoot + 'import'), formData, {\r\n      params: { appId: this.context.appId.toString(), zoneId: this.context.zoneId.toString() }\r\n    });\r\n  }\r\n\r\n  createGhost(sourceStaticName: string) {\r\n    return this.http.post<boolean>(this.apiUrl(webApiTypeRoot + 'addghost'), null, {\r\n      params: { appid: this.context.appId.toString(), sourceStaticName },\r\n    });\r\n  }\r\n}\r\n","import { ChangeDetectionStrategy, Component, Inject, OnInit } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { EavWindow } from '../../shared/models/eav-window.model';\r\nimport { StreamErrorData } from '../models';\r\nimport { StreamErrorResultDialogData } from './stream-error-result.models';\r\n\r\ndeclare const window: EavWindow;\r\n\r\n@Component({\r\n  selector: 'app-stream-error-result',\r\n  templateUrl: './stream-error-result.component.html',\r\n  styleUrls: ['./stream-error-result.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class StreamErrorResultComponent implements OnInit {\r\n  errorData: StreamErrorData;\r\n\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) private dialogData: StreamErrorResultDialogData,\r\n    private dialogRef: MatDialogRef<StreamErrorResultComponent>,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.errorData = this.dialogData.errorData;\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  openInsights() {\r\n    window.open(window.$2sxc.http.apiUrl('sys/insights/logs?key=web-api'), '_blank');\r\n  }\r\n}\r\n","// tslint:disable-next-line:max-line-length\r\nimport { AfterViewInit, ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, OnDestroy, OnInit, QueryList, ViewChild, ViewChildren } from '@angular/core';\r\nimport { BehaviorSubject, combineLatest, Observable, Subscription } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { eavConstants } from '../../shared/constants/eav.constants';\r\nimport { loadScripts } from '../../shared/helpers/load-scripts.helper';\r\nimport { PipelineDataSource, PipelineResultStream, VisualDesignerData } from '../models';\r\nimport { QueryDefinitionService } from '../services/query-definition.service';\r\nimport { VisualQueryService } from '../services/visual-query.service';\r\nimport { calculateTypeInfos } from './plumb-editor.helpers';\r\nimport { PlumbEditorTemplateModel } from './plumb-editor.models';\r\nimport { dataSrcIdPrefix, Plumber } from './plumber.helper';\r\n\r\nconst jsPlumbUrl = 'https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js';\r\n\r\n@Component({\r\n  selector: 'app-plumb-editor',\r\n  templateUrl: './plumb-editor.component.html',\r\n  styles: [':host { display: block; width: 100%; height: 100%; }'],\r\n  styleUrls: ['./plumb-editor.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class PlumbEditorComponent implements OnInit, AfterViewInit, OnDestroy {\r\n  @ViewChild('domRoot') private domRootRef: ElementRef<HTMLDivElement>;\r\n  @ViewChildren('domDataSource') private domDataSourcesRef: QueryList<ElementRef<HTMLDivElement>>;\r\n\r\n  dataSrcIdPrefix = dataSrcIdPrefix;\r\n  templateModel$: Observable<PlumbEditorTemplateModel>;\r\n  hardReset = false;\r\n\r\n  private plumber: Plumber;\r\n  private scriptLoaded$ = new BehaviorSubject(false);\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private visualQueryService: VisualQueryService,\r\n    private queryDefinitionService: QueryDefinitionService,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    loadScripts([{ test: 'jsPlumb', src: jsPlumbUrl }], () => {\r\n      this.scriptLoaded$.next(true);\r\n    });\r\n\r\n    this.subscription.add(\r\n      this.visualQueryService.putEntityCountOnConnections$.subscribe(result => {\r\n        this.plumber.putEntityCountOnConnections(result);\r\n      })\r\n    );\r\n\r\n    this.templateModel$ = combineLatest([this.visualQueryService.pipelineModel$, this.visualQueryService.dataSources$]).pipe(\r\n      map(([pipelineModel, dataSources]) => {\r\n        if (pipelineModel == null || dataSources == null) { return; }\r\n\r\n        // workaround for jsPlumb not working with dom elements which it initialized on previously.\r\n        // This wipes dom entirely and gives us new elements\r\n        this.hardReset = true;\r\n        this.changeDetectorRef.detectChanges();\r\n        this.hardReset = false;\r\n        const templateModel: PlumbEditorTemplateModel = {\r\n          pipelineDataSources: pipelineModel.DataSources,\r\n          typeInfos: calculateTypeInfos(pipelineModel.DataSources, dataSources),\r\n          allowEdit: pipelineModel.Pipeline.AllowEdit,\r\n        };\r\n        return templateModel;\r\n      }),\r\n    );\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    // https://stackoverflow.com/questions/37087864/execute-a-function-when-ngfor-finished-in-angular-2/37088348#37088348\r\n    const domDataSourcesLoaded$ = this.domDataSourcesRef.changes.pipe(map(() => true));\r\n\r\n    this.subscription.add(\r\n      combineLatest([this.scriptLoaded$, domDataSourcesLoaded$]).subscribe(([scriptLoaded, domDataSourcesLoaded]) => {\r\n        if (!scriptLoaded || !domDataSourcesLoaded) { return; }\r\n\r\n        this.plumber?.destroy();\r\n        this.plumber = new Plumber(\r\n          this.domRootRef.nativeElement,\r\n          this.visualQueryService.pipelineModel$.value,\r\n          this.visualQueryService.dataSources$.value,\r\n          this.onConnectionsChanged.bind(this),\r\n          this.onDragend.bind(this),\r\n          this.onDebugStream.bind(this),\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.plumber?.destroy();\r\n    this.scriptLoaded$.complete();\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  onConnectionsChanged() {\r\n    const connections = this.plumber.getAllConnections();\r\n    const streamsOut = this.plumber.getStreamsOut();\r\n    this.visualQueryService.changeConnections(connections, streamsOut);\r\n  }\r\n\r\n  onDragend(pipelineDataSourceGuid: string, position: VisualDesignerData) {\r\n    this.visualQueryService.changeDataSourcePosition(pipelineDataSourceGuid, position);\r\n  }\r\n\r\n  onDebugStream(stream: PipelineResultStream) {\r\n    this.visualQueryService.debugStream(stream);\r\n  }\r\n\r\n  configureDataSource(dataSource: PipelineDataSource) {\r\n    // ensure dataSource entity is saved\r\n    if (dataSource.EntityGuid.includes('unsaved')) {\r\n      this.visualQueryService.saveAndRun(true, false);\r\n    } else {\r\n      this.visualQueryService.editDataSource(dataSource);\r\n    }\r\n  }\r\n\r\n  getTypeName(partAssemblyAndType: string) {\r\n    if (partAssemblyAndType.length === 36 && (partAssemblyAndType.split('-').length - 1) === 4) {\r\n      // partAssemblyAndType is guid\r\n      return partAssemblyAndType.substring(0, 10) + '';\r\n    }\r\n    return this.queryDefinitionService.typeNameFilter(partAssemblyAndType, 'className');\r\n  }\r\n\r\n  isOutDataSource(pipelineDataSource: PipelineDataSource) {\r\n    return pipelineDataSource.PartAssemblyAndType === eavConstants.pipelineDesigner.outDataSource.PartAssemblyAndType;\r\n  }\r\n\r\n  remove(pipelineDataSource: PipelineDataSource) {\r\n    if (!confirm(`Delete ${pipelineDataSource.Name} data source?`)) { return; }\r\n\r\n    this.plumber.removeEndpointsOnDataSource(pipelineDataSource.EntityGuid);\r\n    const connections = this.plumber.getAllConnections();\r\n    const streamsOut = this.plumber.getStreamsOut();\r\n    this.visualQueryService.removeDataSource(pipelineDataSource.EntityGuid, connections, streamsOut);\r\n  }\r\n\r\n  openHelp(url: string) {\r\n    window.open(url, '_blank');\r\n  }\r\n\r\n  editName(dataSource: PipelineDataSource) {\r\n    const newName = prompt('Rename data source', dataSource.Name)?.trim();\r\n    if (newName == null || newName === '') { return; }\r\n\r\n    this.visualQueryService.renameDataSource(dataSource.EntityGuid, newName);\r\n  }\r\n\r\n  editDescription(dataSource: PipelineDataSource) {\r\n    const newDescription = prompt('Edit description', dataSource.Description)?.trim();\r\n    if (newDescription == null) { return; }\r\n\r\n    this.visualQueryService.changeDataSourceDescription(dataSource.EntityGuid, newDescription);\r\n  }\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}