"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts"],{1403:(G,g,i)=>{i.r(g),i.d(g,{ManageContentListComponent:()=>S});var p=i(9540),u=i(4844),I=i(5876),M=i(604),m=i(5396),f=i(4660),v=i(8112),C=i(2816),t=i(4896),c=i(5204),P=i(600),l=i(4648),_=i(8752),D=i(5952),R=i(8200),L=i(4672),T=i(2328),y=i(8766),k=i(5056);function $(o,d){if(1&o){const e=t.KQA();t.I0R(0,"span"),t.OEk(1),t.C$Y(),t.I0R(2,"button",13),t.qCj("click",function(){t.usT(e);const s=t.GaO(3);return t.CGJ(s.editHeader())}),t.I0R(3,"mat-icon"),t.OEk(4,"edit"),t.C$Y()()}if(2&o){const e=t.GaO(2);t.yG2(1),t.cNF(e.header.Title)}}function b(o,d){1&o&&(t.OEk(0),t.wVc(1,"translate")),2&o&&t.oRS(" ",t.kDX(1,1,"ManageContentList.NoHeader")," ")}function B(o,d){if(1&o&&(t.I0R(0,"p"),t.OEk(1),t.wVc(2,"translate"),t.C$Y(),t.I0R(3,"p"),t.yuY(4,$,5,1)(5,b,2,3),t.C$Y()),2&o){const e=t.GaO();t.yG2(1),t.oRS(" ",t.kDX(2,3,"ManageContentList.Description")," "),t.yG2(3),t.C0Y(4,e.header.Type?4:-1),t.yG2(1),t.C0Y(5,e.header.Type?-1:5)}}function A(o,d){1&o&&(t.I0R(0,"p",14),t.OEk(1),t.wVc(2,"translate"),t.C$Y()),2&o&&(t.yG2(1),t.oRS(" ",t.kDX(2,1,"ManageContentList.SortItems")," "))}function K(o,d){1&o&&(t.I0R(0,"p",14),t.OEk(1),t.wVc(2,"translate"),t.C$Y()),2&o&&(t.yG2(1),t.oRS(" ",t.kDX(2,1,"ManageContentList.SortLotsOfItems")," "))}function U(o,d){if(1&o){const e=t.KQA();t.I0R(0,"div",15)(1,"div",16)(2,"mat-icon",17),t.OEk(3,"drag_handle"),t.C$Y(),t.I0R(4,"span",18),t.OEk(5),t.C$Y()(),t.I0R(6,"div")(7,"button",19),t.qCj("click",function(){const r=t.usT(e).$implicit,a=t.GaO(2);return t.CGJ(a.addFromExisting(r.Index))}),t.wVc(8,"translate"),t.I0R(9,"mat-icon"),t.OEk(10,"playlist_add"),t.C$Y()(),t.I0R(11,"button",19),t.qCj("click",function(){const r=t.usT(e).$implicit,a=t.GaO(2);return t.CGJ(a.addBelow(r.Index))}),t.wVc(12,"translate"),t.I0R(13,"mat-icon"),t.OEk(14,"add"),t.C$Y()(),t.I0R(15,"button",19),t.qCj("click",function(){const r=t.usT(e).$implicit,a=t.GaO(2);return t.CGJ(a.remove(r))}),t.wVc(16,"translate"),t.I0R(17,"mat-icon"),t.OEk(18,"remove"),t.C$Y()(),t.I0R(19,"button",19),t.qCj("click",function(){const r=t.usT(e).$implicit,a=t.GaO(2);return t.CGJ(a.editItem(r.Id))}),t.wVc(20,"translate"),t.I0R(21,"mat-icon"),t.OEk(22,"edit"),t.C$Y()()()()}if(2&o){const e=d.$implicit,n=t.GaO(2);t.yG2(4),t.u6R("tippy","",e.Title," (",e.Id,")"),t.yG2(1),t.CAO(" ",e.Title," (",e.Id,") "),t.yG2(2),t.E7m("tippy",t.kDX(8,12,"Fields.Picker.AddExistingItem"))("disabled",0===e.Id),t.yG2(4),t.E7m("tippy",t.kDX(12,14,"Fields.Picker.AddItemBelow"))("disabled",0===e.Id||n.reordered),t.yG2(4),t.E7m("tippy",t.kDX(16,16,"Fields.Picker.Remove"))("disabled",n.reordered),t.yG2(4),t.E7m("tippy",t.kDX(20,18,"Fields.Picker.Edit"))("disabled",0===e.Id)}}function W(o,d){if(1&o){const e=t.KQA();t.I0R(0,"div",1)(1,"div",2)(2,"div",3),t.OEk(3),t.wVc(4,"translate"),t.C$Y()(),t.I0R(5,"div",4),t.wR5(6,"router-outlet"),t.I0R(7,"div",5),t.yuY(8,B,6,5)(9,A,3,3,"p",6)(10,K,3,3,"p",6),t.I0R(11,"div",7),t.qCj("cdkDropListDropped",function(s){t.usT(e);const r=t.GaO();return t.CGJ(r.drop(s))}),t.c53(12,U,23,20,"div",20,t.mgi().trackByFn),t.C$Y()()(),t.I0R(14,"mat-dialog-actions",8)(15,"button",9),t.qCj("click",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.closeDialog())}),t.OEk(16),t.wVc(17,"translate"),t.C$Y(),t.I0R(18,"button",10),t.qCj("click",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.saveList())}),t.OEk(19),t.wVc(20,"translate"),t.C$Y(),t.I0R(21,"button",11),t.qCj("click",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.saveAndCloseList())}),t.wVc(22,"translate"),t.I0R(23,"mat-icon",12),t.OEk(24,"done"),t.C$Y()()()()}2&o&&(t.yG2(3),t.cNF(t.kDX(4,7,"ManageContentList.Title")),t.yG2(5),t.C0Y(8,d.header?8:-1),t.yG2(1),t.C0Y(9,d.items&&(null==d.items?null:d.items.length)<25?9:-1),t.yG2(1),t.C0Y(10,(null==d.items?null:d.items.length)>=25?10:-1),t.yG2(2),t.oho(d.items),t.yG2(4),t.cNF(t.kDX(17,9,"General.Buttons.Cancel")),t.yG2(3),t.cNF(t.kDX(20,11,"General.Buttons.Save")),t.yG2(2),t.E7m("tippy",t.kDX(22,13,"Form.Buttons.SaveAndClose")))}let S=(()=>{class o extends C.K{constructor(e,n,s,r,a,h,x){super(e,n),this.router=e,this.route=n,this.dialogRef=s,this.contentGroupService=r,this.snackBar=a,this.translate=h,this.appDialogConfigService=x,this.hostClass="dialog-component",this.items$=new u.g(null),this.header$=new u.g(null),this.viewModel$=(0,I.E)([this.items$,this.header$]).pipe((0,M.k)(([E,O])=>({items:E,header:O}))),this.contentGroup={id:null,guid:this.route.snapshot.paramMap.get("guid"),part:this.route.snapshot.paramMap.get("part"),index:parseInt(this.route.snapshot.paramMap.get("index"),10)},this.reordered=!1}ngOnInit(){this.fetchList(),this.fetchHeader(),this.fetchDialogSettings(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{this.fetchList(!0),this.fetchHeader()}))}ngOnDestroy(){this.items$.complete(),this.header$.complete(),super.ngOnDestroy()}fetchDialogSettings(){this.appDialogConfigService.getCurrent$().subscribe(e=>{this.translate.setDefaultLang(e.Context.Language.Primary.split("-")[0]),this.translate.use(e.Context.Language.Current.split("-")[0])})}closeDialog(){this.dialogRef.close()}saveList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.fetchList(),this.fetchHeader()})}saveAndCloseList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(()=>{this.snackBar.open("Saved",null,{duration:2e3}),this.closeDialog()})}editHeader(){const n=(0,m.K)({items:[{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listcontent"},{Add:0===this.header$.value.Id,Index:0,Parent:this.contentGroup.guid,Field:"listpresentation"}]});this.router.navigate([`edit/${n}`],{relativeTo:this.route})}editItem(e){const s=(0,m.K)({items:[{EntityId:e}]});this.router.navigate([`edit/${s}`],{relativeTo:this.route})}addFromExisting(e){this.router.navigate([`${this.contentGroup.guid}/${this.contentGroup.part}/${e+1}/replace`],{relativeTo:this.route,queryParams:{add:!0}})}addBelow(e){const s=(0,m.K)({items:[{Add:!0,Index:e+1,Parent:this.contentGroup.guid,Field:this.contentGroup.part}]});this.router.navigate([`edit/${s}`],{relativeTo:this.route})}remove(e){confirm(this.translate.instant("ManageContentList.ConfirmRemove"))&&(this.snackBar.open("Removing..."),this.contentGroupService.removeItem(this.contentGroup,e.Index).subscribe(()=>{this.snackBar.open("Removed",null,{duration:2e3}),this.fetchList()}))}drop(e){const n=[...this.items$.value];(0,p.qv)(n,e.previousIndex,e.currentIndex),this.items$.next(n),this.reordered=!0}trackByFn(e,n){return`${n.Index}+${n.Id}`}fetchList(e=!1){this.contentGroupService.getList(this.contentGroup).subscribe(n=>{if(this.reordered){const s=this.items$.value.map(a=>a.Id);if(this.items$.value.length===n.length&&!n.some(a=>!s.includes(a.Id))&&e){const a=this.items$.value.map(h=>h.Index);n.sort((h,x)=>{const E=a.indexOf(h.Index),O=a.indexOf(x.Index);return-1===E||-1===O?0:E-O})}else e&&this.snackBar.open("List was changed from somewhere else. Order of items is reset",null,{duration:5e3})}this.items$.next(n),this.reordered=!1})}fetchHeader(){this.contentGroupService.getHeader(this.contentGroup).subscribe(e=>{this.header$.next(e)})}static#t=this.\u0275fac=function(n){return new(n||o)(t.GI1(c.E5),t.GI1(c.gV),t.GI1(P.yI),t.GI1(f.e),t.GI1(l.yS),t.GI1(_.qS),t.GI1(v.mK))};static#e=this.\u0275cmp=t.In1({type:o,selectors:[["app-manage-content-list"]],hostVars:1,hostBindings:function(n,s){2&n&&t.SoX("className",s.hostClass)},features:[t.eg9],decls:2,vars:3,consts:[["class","eav-dialog eav-no-scrollbar"],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-content"],["cdkScrollable","",1,"dialog-component-content","fancy-scrollbar-light"],["class","eav-sort-title"],["cdkDropList","",1,"eav-dnd-list",3,"cdkDropListDropped"],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","accent",3,"tippy","click"],[1,"eav-raised-button-icon"],["mat-icon-button","","tippy","Edit header",3,"click"],[1,"eav-sort-title"],["cdkDrag","",1,"eav-dnd-item"],[1,"eav-dnd-item__title"],["tippy","Drag to reorder the list",1,"eav-dnd-item__title-icon"],[1,"eav-dnd-item__title-text",3,"tippy"],["mat-icon-button","","appMousedownStopPropagation","",3,"tippy","disabled","click"],["class","eav-dnd-item","cdkDrag",""]],template:function(n,s){if(1&n&&(t.yuY(0,W,25,15,"div",0),t.wVc(1,"async")),2&n){let r;t.C0Y(0,(r=t.kDX(1,1,s.viewModel$))?0:-1,r)}},dependencies:[c.cP,D.E,R.Y,P.Yp,L.Gw,L.um,T.qL,y.Ci,p.Cm,p.w5,k.a,_.sD],styles:[".eav-sort-title[_ngcontent-%COMP%]{padding-top:16px}.eav-dnd-list[_ngcontent-%COMP%]{margin:16px 0;border:1px solid #ccc;border-radius:4px;overflow:hidden}.eav-dnd-item[_ngcontent-%COMP%]{cursor:move;height:40px;border-bottom:1px solid #ccc;padding:0 8px;display:flex;align-items:center;justify-content:space-between;background:#fff;box-sizing:border-box;font-size:14px}.eav-dnd-item[_ngcontent-%COMP%]:last-child{border:none}.eav-dnd-item__title[_ngcontent-%COMP%]{display:flex;align-items:center;overflow:hidden;max-width:80%}.eav-dnd-item__title-icon[_ngcontent-%COMP%]{margin-right:8px;opacity:.4}.eav-dnd-item__title-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dnd-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dnd-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return o})()},2816:(G,g,i)=>{i.d(g,{K:()=>t});var p=i(5204),u=i(6560),I=i(1792),M=i(604),m=i(6536),f=i(6884),v=i(2376),C=i(4896);let t=(()=>{class c extends f.C{constructor(l,_,D){super(),this.router=l,this.route=_,this.log=D,this.log??=new v.W("BaseComponent",!1)}ngOnDestroy(){super.ngOnDestroy()}refreshOnChildClosedShallow(){return this.router.events.pipe((0,u.I)(l=>l instanceof p.cf),(0,I.W)(!!this.route.snapshot.firstChild),(0,M.k)(()=>!!this.route.snapshot.firstChild),(0,m.c)(),(0,u.I)(([l,_])=>l&&!_))}static#t=this.\u0275fac=function(_){return new(_||c)(C.GI1(p.E5),C.GI1(p.gV),C.GI1(v.W))};static#e=this.\u0275dir=C.Sc5({type:c,features:[C.eg9]})}return c})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.09.00/dist/ng-edit/projects_eav-ui_src_app_manage-content-list_manage-content-list_component_ts.82304713f39eafc3.js.map