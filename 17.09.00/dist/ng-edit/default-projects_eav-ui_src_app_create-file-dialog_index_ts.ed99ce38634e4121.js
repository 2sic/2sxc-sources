"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_index_ts"],{1048:(z,A,a)=>{a.d(A,{M:()=>K});var m=a(604),D=a(6028),I=a(4896),E=a(1332),g=a(3392);const y="admin/AppFiles/asset";let K=(()=>{class x{constructor(i,l,r){this.http=i,this.context=l,this.dnnContext=r}get(i,l,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y),{params:{appId:this.context.appId,global:l,...this.templateIdOrPath(i,l,r)}}).pipe((0,m.k)(h=>{if("auto"===h.Type.toLocaleLowerCase())switch(h.Extension.toLocaleLowerCase()){case".cs":case".cshtml":h.Type="Razor";break;case".html":case".css":case".js":h.Type="Token"}return h}))}save(i,l,r,h){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(y),r,{params:{appId:this.context.appId,global:l,...this.templateIdOrPath(i,l,h)}})}getAll(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.context.appId,...i&&{mask:i}}}).pipe((0,m.k)(({Files:l})=>(l.forEach(r=>{r.Shared??=!1}),l)))}getWebApis(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/AppApiFiles"),{params:{appId:this.context.appId}}).pipe((0,m.k)(({files:i})=>(i.forEach(l=>{l.isShared??=!1,l.isCompiled??=!1}),i))).pipe((0,m.k)(i=>i.map(r=>{const h=r.path.lastIndexOf("/"),O=r.path.lastIndexOf("."),k=r.path.substring(0,h),t=r.path.substring(h+1,O);return{path:r.path,folder:k,name:t,isShared:r.isShared,endpointPath:r.endpointPath,isCompiled:r.isCompiled,edition:r.edition}})))}getWebApiDetails(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:i}})}getPredefinedTemplates(i,l){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:{...i&&{purpose:i},...l&&{type:l}}})}getPreview(i,l,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:i,templateKey:r,global:l}})}create(i,l,r){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:l,purpose:"auto",path:i,templateKey:r}})}templateIdOrPath(i,l,r){if(/^[0-9]*$/g.test(i)){const h=r.find(O=>O.EntityId?.toString()===i&&O.IsShared===l)?.Path;return{templateId:i,...null!=h&&{path:h}}}return{path:i}}static#t=this.\u0275fac=function(l){return new(l||x)(I.CoB(E.KK),I.CoB(D.e),I.CoB(g.es))};static#e=this.\u0275prov=I.wxM({token:x,factory:x.\u0275fac})}return x})()},5544:(z,A,a)=>{a.d(A,{cE:()=>nt,GW:()=>rt});var m=a(1904),D=a(600),I=a(4844),E=a(5876),g=a(1792),C=a(1484),y=a(604),M=a(8600),b=a(9256),Y=a(5976),F=a(3192),S=a(7456),x=a(3451);var i=a(9432),l=a(8916),r=a(4816),h=a(1048),O=a(8928),k=a(6884),t=a(4896),w=a(5056),J=a(9084),V=a(2536);let Q=(()=>{class o{constructor(e,n){this.matInput=e,this.elementRef=n,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const n=e.toLocaleLowerCase();return"true"===n||"false"!==n&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(n){return new(n||o)(t.GI1(V.yi),t.GI1(t.GMv))};static#e=this.\u0275dir=t.Sc5({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}})}return o})();var W=a(4672),R=a(244),N=a(7872),X=a(6176),U=a(4204);function H(o,p){if(1&o&&(t.I0R(0,"mat-option",21),t.OEk(1),t.C$Y()),2&o){const e=p.$implicit;t.E7m("value",e),t.yG2(1),t.oRS(" ",e," ")}}function Z(o,p){if(1&o&&(t.I0R(0,"mat-option",21),t.OEk(1),t.C$Y()),2&o){const e=p.$implicit;t.E7m("value",e),t.yG2(1),t.oRS(" ",e," ")}}function _(o,p){if(1&o&&(t.I0R(0,"mat-option",21),t.OEk(1),t.C$Y()),2&o){const e=p.$implicit;t.E7m("value",e.Key),t.yG2(1),t.oRS(" ",e.Name," ")}}function q(o,p){1&o&&(t.I0R(0,"app-field-hint",16),t.OEk(1," This field is required "),t.C$Y()),2&o&&t.E7m("isError",!0)}function tt(o,p){1&o&&t.wR5(0,"mat-spinner",22)(1,"div",23)}const B=o=>({disabled:o});function et(o,p){if(1&o&&(t.I0R(0,"div",24)(1,"label",25),t.OEk(2,"Preview"),t.C$Y()(),t.I0R(3,"pre",26),t.OEk(4),t.C$Y()),2&o){const e=t.GaO();t.yG2(1),t.E7m("ngClass",t.S45(3,B,e.loadingPreview)),t.yG2(2),t.E7m("ngClass",t.S45(5,B,e.loadingPreview)),t.yG2(1),t.cNF(e.preview)}}function ot(o,p){if(1&o&&(t.I0R(0,"div",27),t.OEk(1),t.C$Y()),2&o){const e=t.GaO();t.yG2(1),t.oRS(" ",e.previewError," ")}}function at(o,p){if(1&o){const e=t.KQA();t.I0R(0,"div",1)(1,"div",2)(2,"div",3)(3,"span"),t.OEk(4,"Create"),t.C$Y(),t.I0R(5,"span",4),t.OEk(6),t.C$Y()()(),t.I0R(7,"div",5)(8,"form",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"mat-form-field",10)(13,"mat-label"),t.OEk(14,"Platform"),t.C$Y(),t.I0R(15,"mat-select",11),t.c53(16,H,2,2,"mat-option",21,t.oxv),t.C$Y()()(),t.I0R(18,"div",9)(19,"mat-form-field",10)(20,"mat-label"),t.OEk(21,"Purpose"),t.C$Y(),t.I0R(22,"mat-select",12),t.c53(23,Z,2,2,"mat-option",21,t.oxv),t.C$Y()()()(),t.I0R(25,"div",13)(26,"mat-form-field",10)(27,"mat-label"),t.OEk(28,"Template"),t.C$Y(),t.I0R(29,"mat-select",14),t.c53(30,_,2,2,"mat-option",21,t.oxv),t.C$Y()()(),t.I0R(32,"div",13)(33,"mat-form-field",10)(34,"mat-label"),t.OEk(35,"Name"),t.C$Y(),t.wR5(36,"input",15),t.C$Y(),t.yuY(37,q,2,1,"app-field-hint",16),t.C$Y()(),t.I0R(38,"div",17),t.yuY(39,tt,2,0),t.I0R(40,"button",18),t.qCj("click",function(){t.usT(e);const u=t.GaO();return t.CGJ(u.closeDialog())}),t.OEk(41,"Cancel"),t.C$Y(),t.I0R(42,"button",19),t.qCj("click",function(){t.usT(e);const u=t.GaO();return t.CGJ(u.confirm())}),t.OEk(43," Create "),t.C$Y()(),t.yuY(44,et,5,7)(45,ot,2,1,"div",20),t.C$Y()()()}if(2&o){const e=t.GaO();t.yG2(6),t.cNF(e.controls.finalName.value||(e.controls.folder.value?e.controls.folder.value.trim()+"/":"")),t.yG2(2),t.E7m("formGroup",e.form),t.yG2(8),t.oho(p.platforms),t.yG2(7),t.oho(p.purposes),t.yG2(7),t.oho(p.templates),t.yG2(7),t.C0Y(37,e.controls.name.touched&&null!=e.controls.name.errors&&e.controls.name.errors.required?37:-1),t.yG2(2),t.C0Y(39,p.loadingPreview?39:-1),t.yG2(3),t.E7m("disabled",!e.form.valid||p.loadingPreview||!p.previewValid),t.yG2(2),t.C0Y(44,p.preview?44:-1),t.yG2(1),t.C0Y(45,!p.loadingPreview&&p.previewError?45:-1)}}let nt=(()=>{class o extends k.C{constructor(e,n,u){super(),this.dialogData=e,this.dialogRef=n,this.sourceService=u,this.hostClass="dialog-component",this.all="All"}ngOnInit(){this.templates$=new I.g([]),this.loadingPreview$=new I.g(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new m.k1({platform:new m.yM(this.all),purpose:new m.yM({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new m.yM(null,m.AQ.required),name:new m.yM(this.dialogData.name??null,m.AQ.required),finalName:new m.yM({value:null,disabled:!0}),folder:new m.yM({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,E.E)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.W)(this.controls.templateKey.value),(0,C.a)())]).subscribe(([e,n])=>{const u=e.find(c=>c.Key===n),f=this.dialogData.name?this.controls.name.value||this.dialogData.name:u?.SuggestedFileName??null;this.controls.name.value!==f&&this.controls.name.patchValue(f)})),this.subscription.add((0,E.E)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.W)(this.controls.templateKey.value),(0,C.a)()),this.controls.name.valueChanges.pipe((0,g.W)(this.controls.name.value),(0,C.a)()),this.controls.folder.valueChanges.pipe((0,g.W)(this.controls.folder.value),(0,C.a)())]).subscribe(([e,n,u,f])=>{const c=e.find(d=>d.Key===n);let s=null;u&&(f=f.trim(),u=O.YH.sanitizePath(u.trim()),s=`${f?`${f}/`:""}${u=`${c?.Prefix??""}${u}${c?.Suffix??""}${c?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==s&&this.controls.finalName.patchValue(s)}))}buildViewModel(){const e=this.templates$.pipe((0,y.k)(c=>{const s={[this.all]:this.all};return c.forEach(d=>{d.Platforms?.forEach(v=>{s[v]=v})}),Object.keys(s)})),n=this.templates$.pipe((0,y.k)(c=>{const s={[this.all]:this.all};return c.forEach(d=>{s[d.Purpose]=d.Purpose}),Object.keys(s)})),u=(0,E.E)([this.templates$,this.controls.platform.valueChanges.pipe((0,g.W)(this.controls.platform.value),(0,C.a)()),this.controls.purpose.valueChanges.pipe((0,g.W)(this.controls.purpose.value),(0,C.a)())]).pipe((0,y.k)(([c,s,d])=>c.filter($=>(s===this.all||($.Platforms?.includes(s)??!1))&&(d===this.all||$.Purpose===d))),(0,M.y)(c=>{if(!c.some(s=>s.Key===this.controls.templateKey.value)){const s=c[0]?.Key??null;this.controls.templateKey.value!==s&&this.controls.templateKey.patchValue(s)}})),f=(0,E.E)([this.controls.finalName.valueChanges.pipe((0,g.W)(this.controls.finalName.value),(0,C.a)()),this.controls.templateKey.valueChanges.pipe((0,g.W)(this.controls.templateKey.value),(0,C.a)())]).pipe(function j(o,p=b.M,e){const n=(0,x.k)(o,p);return function K(o,p){return(0,Y.i)((e,n)=>{const{leading:u=!0,trailing:f=!1}=p??{};let c=!1,s=null,d=null,v=!1;const $=()=>{d?.unsubscribe(),d=null,f&&(L(),v&&n.complete())},T=()=>{d=null,v&&n.complete()},G=P=>d=(0,S.Uv)(o(P)).subscribe((0,F.e)(n,$,T)),L=()=>{if(c){c=!1;const P=s;s=null,n.next(P),!v&&G(P)}};e.subscribe((0,F.e)(n,P=>{c=!0,s=P,(!d||d.closed)&&(u?L():G(P))},()=>{v=!0,(!(f&&c&&d)||d.closed)&&n.complete()}))})}(()=>n,e)}(100,b.M,{leading:!0,trailing:!0}),(0,M.y)(()=>{this.loadingPreview$.next(!0)}),(0,i.G)(([c,s])=>c&&s?(0,r.y)([this.sourceService.getPreview(c,this.dialogData.global,s),(0,x.k)(500)]).pipe((0,y.k)(([d])=>d)):(0,l.of)(void 0)),(0,M.y)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,E.E)([e,n,u,f,this.loadingPreview$]).pipe((0,y.k)(([c,s,d,v,$])=>({platforms:c,purposes:s,templates:d,loadingPreview:$,preview:v?.Preview,previewValid:v?.IsValid??!1,previewError:v?.Error})))}static#t=this.\u0275fac=function(n){return new(n||o)(t.GI1(D.sR),t.GI1(D.yI),t.GI1(h.M))};static#e=this.\u0275cmp=t.In1({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(n,u){2&n&&t.SoX("className",u.hostClass)},features:[t.eg9],decls:2,vars:3,consts:[["class","eav-dialog eav-no-scrollbar"],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-form-field"],["formControlName","platform"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","eav-preview-error"],[3,"value"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"eav-preview-error"]],template:function(n,u){if(1&n&&(t.yuY(0,at,46,7,"div",0),t.wVc(1,"async")),2&n){let f;t.C0Y(0,(f=t.kDX(1,1,u.viewModel$))?0:-1,f)}},dependencies:[w.QF,J.o,Q,W.Gw,R.Up,R.w5,N.kX,X.I5,m.sz,m.ot,m.ue,m.u,m.eJ,m.uW,m.Wo,V.yi,U.cm,w.a],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}return o})();var it=a(6028),lt=a(988),st=a(8512);let rt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.a4G({type:o});static#o=this.\u0275inj=t.s3X({providers:[it.e,h.M,{provide:R.uY,useValue:{subscriptSizing:"dynamic"}},{provide:N.kF,useValue:{hideSingleSelectionIndicator:!0}}],imports:[w.MD,lt.q,W.oJ,N.d5,m.sl,R.wb,V.cN,U.kB,st.NR]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.09.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_index_ts.ed99ce38634e4121.js.map