(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_ng-dialogs_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fi-2daed6"],{3726:function(e,t,n){"use strict";n.r(t),n.d(t,{EditContentTypeFieldsComponent:function(){return V}});var i=n(4762),o=n(1041),r=n(8512),a=n(7570),s=n(3148),p=n(878),l=n(2023),c=n(4991),u=n(7768),d=n(6541);function f(e,t,n){return 0===n?[t]:(e.push(t),e)}var g=n(1055),h=n(3982),m=n(9996),y=n(3835),v=n(436),T=n(7727),Z=/^[A-Za-z][A-Za-z0-9]+$/,b=n(3667),x=n(2542),I=n(3269),N={Boolean:{label:"Boolean (yes/no)",description:"Yes/no or true/false values"},Custom:{label:"Custom - ui-tools or custom types",description:"Use for things like gps-pickers (which writes into multiple fields) or for custom-data which serializes something exotic into the db like an array, a custom json or anything"},DateTime:{label:"Date and/or time",description:"For date, time or combined values"},Empty:{label:"Empty - for form-titles etc.",description:"Use to structure your form"},Entity:{label:"Entity (other content-items)",description:"One or more other content-items"},Hyperlink:{label:"Link / file reference",description:"Hyperlink or reference to a picture / file"},Number:{label:"Number",description:"Any kind of number"},String:{label:"Text / string",description:"Any kind of text"}},A=n(1785),O=n(2935),M=n(1282),q=n(2832),w=n(7093),C=n(3589),_=n(1116),S=n(4369),F=n(3070),k=n(9550),J=function(){function e(){this.reservedNames={}}return e.prototype.validate=function(e){if(!e.value)return null;var t=e.value.toLocaleLowerCase(),n=Object.keys(this.reservedNames).find(function(e){return e.toLocaleLowerCase()===t});return n?{reservedNames:this.reservedNames[n]}:null},e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=A.lG2({type:e,selectors:[["","appReservedNames",""]],inputs:{reservedNames:["appReservedNames","reservedNames"]},features:[A._Bn([{provide:o.Cf,useExisting:e,multi:!0}])]}),e}(),Q=n(3841),U=n(7307),Y=n(7110),$=n(7064),E=["ngForm"];function H(e,t){1&e&&(A.ynx(0),A._uU(1,"Fields"),A.BQk())}function L(e,t){1&e&&(A.ynx(0),A._uU(1,"Add Fields"),A.BQk())}function B(e,t){1&e&&(A.ynx(0),A._uU(1,"Edit Field"),A.BQk())}function R(e,t){if(1&e&&(A.TgZ(0,"app-field-hint",22),A._uU(1),A.qZA()),2&e){var n=A.oxw(4);A.Q6J("isError",!0),A.xp6(1),A.Oqu(n.fieldNameError)}}function D(e,t){if(1&e&&(A.TgZ(0,"app-field-hint",22),A._uU(1),A.qZA()),2&e){A.oxw(2);var n=A.MAs(6);A.Q6J("isError",!0),A.xp6(1),A.hij(" ",n.errors.reservedNames," ")}}function P(e,t){if(1&e&&(A.ynx(0),A.YNc(1,R,2,2,"app-field-hint",21),A.YNc(2,D,2,2,"app-field-hint",21),A.BQk()),2&e){A.oxw();var n=A.MAs(6);A.xp6(1),A.Q6J("ngIf",n.errors.pattern),A.xp6(1),A.Q6J("ngIf",n.errors.reservedNames)}}function z(e,t){if(1&e&&(A.TgZ(0,"mat-option",23),A.TgZ(1,"mat-icon"),A._uU(2),A.qZA(),A.TgZ(3,"span"),A._uU(4),A.qZA(),A.qZA()),2&e){var n=t.$implicit;A.Q6J("value",n.name),A.xp6(2),A.Oqu(n.icon),A.xp6(2),A.Oqu(n.label)}}function j(e,t){if(1&e&&(A.TgZ(0,"mat-icon",19),A._uU(1),A.qZA()),2&e){var n=A.oxw().$implicit;A.xp6(1),A.Oqu(n.Icon)}}function X(e,t){if(1&e&&(A.TgZ(0,"mat-option",23),A._uU(1),A.YNc(2,j,2,1,"mat-icon",24),A.qZA()),2&e){var n=t.$implicit;A.Tol(n.IsObsolete?"input-obsolete":""),A.Q6J("value",n.inputType),A.xp6(1),A.hij(" ",n.label," "),A.xp6(1),A.Q6J("ngIf",n.Icon)}}function G(e,t){if(1&e){var n=A.EpF();A.TgZ(0,"div",11),A.TgZ(1,"div",12),A.TgZ(2,"mat-form-field",13),A.TgZ(3,"mat-label"),A._uU(4,"Name"),A.qZA(),A.TgZ(5,"input",14,15),A.NdJ("ngModelChange",function(e){return t.$implicit.StaticName=e}),A.qZA(),A.qZA(),A.YNc(7,P,3,2,"ng-container",2),A.qZA(),A.TgZ(8,"div",12),A.TgZ(9,"mat-form-field",13),A.TgZ(10,"mat-label"),A._uU(11,"Data Type"),A.qZA(),A.TgZ(12,"mat-select",16),A.NdJ("selectionChange",function(){var e=A.CHM(n).index,t=A.oxw(2);return t.calculateInputTypeOptions(e),t.resetInputType(e),t.calculateHints(e)})("ngModelChange",function(e){return t.$implicit.Type=e}),A.TgZ(13,"mat-select-trigger"),A.TgZ(14,"mat-icon",17),A._uU(15),A.qZA(),A.TgZ(16,"span"),A._uU(17),A.qZA(),A.qZA(),A.YNc(18,z,5,3,"mat-option",18),A.qZA(),A.qZA(),A.TgZ(19,"app-field-hint"),A._uU(20),A.qZA(),A.qZA(),A.TgZ(21,"div",12),A.TgZ(22,"mat-form-field",13),A.TgZ(23,"mat-label"),A._uU(24,"Input Type"),A.qZA(),A.TgZ(25,"mat-select",16),A.NdJ("selectionChange",function(){var e=A.CHM(n).index;return A.oxw(2).calculateHints(e)})("ngModelChange",function(e){return t.$implicit.InputType=e}),A.TgZ(26,"mat-select-trigger"),A.TgZ(27,"span"),A._uU(28),A.qZA(),A.TgZ(29,"mat-icon",19),A._uU(30),A.qZA(),A.qZA(),A.YNc(31,X,3,6,"mat-option",20),A.qZA(),A.qZA(),A.TgZ(32,"app-field-hint"),A._uU(33),A.qZA(),A.qZA(),A.qZA()}if(2&e){var i=t.$implicit,o=t.index,r=A.MAs(6),a=A.oxw(2);A.xp6(5),A.Q6J("pattern",a.fieldNamePattern)("appReservedNames",a.reservedNames)("ngModel",i.StaticName)("name","StaticName"+o)("disabled","inputType"===a.editMode),A.xp6(2),A.Q6J("ngIf",r.touched&&r.errors),A.xp6(5),A.Q6J("ngModel",i.Type)("name","Type"+o)("disabled",null!=a.editMode),A.xp6(3),A.Oqu(a.findIcon(i.Type)),A.xp6(2),A.Oqu(i.Type),A.xp6(1),A.Q6J("ngForOf",a.dataTypes),A.xp6(2),A.Oqu(a.dataTypeHints[o]),A.xp6(5),A.Q6J("ngModel",i.InputType)("name","InputType"+o)("disabled","name"===a.editMode),A.xp6(3),A.Oqu(a.getInputType(i.InputType).label),A.xp6(2),A.Oqu(a.getInputType(i.InputType).Icon),A.xp6(1),A.Q6J("ngForOf",a.filteredInputTypeOptions[o]),A.xp6(2),A.Oqu(a.inputTypeHints[o])}}function K(e,t){if(1&e){var n=A.EpF();A.TgZ(0,"form",4,5),A.NdJ("ngSubmit",function(){return A.CHM(n),A.oxw().save()}),A.TgZ(2,"div",6),A.YNc(3,G,34,20,"div",7),A.qZA(),A.TgZ(4,"div",8),A.TgZ(5,"button",9),A.NdJ("click",function(){return A.CHM(n),A.oxw().closeDialog()}),A._uU(6,"Cancel"),A.qZA(),A.TgZ(7,"button",10),A.ALo(8,"async"),A._uU(9," Save "),A.qZA(),A.qZA(),A.qZA()}if(2&e){var i=A.MAs(1),o=A.oxw();A.xp6(3),A.Q6J("ngForOf",o.fields),A.xp6(4),A.Q6J("disabled",!i.form.valid||A.lcZ(8,2,o.saving$))}}var V=function(){function e(e,t,n,i,o){var s=this;this.dialogRef=e,this.route=t,this.contentTypesService=n,this.contentTypesFieldsService=i,this.snackBar=o,this.hostClass="dialog-component",this.fields=[],this.filteredInputTypeOptions=[],this.dataTypeHints=[],this.inputTypeHints=[],this.fieldNamePattern=Z,this.fieldNameError="Standard letters and numbers are allowed. Must start with a letter.",this.findIcon=I.x,this.loading$=new r.X(!0),this.saving$=new r.X(!1),this.subscription=new a.w,this.dialogRef.disableClose=!0,this.subscription.add(this.dialogRef.backdropClick().subscribe(function(e){s.form.dirty&&!confirm("You have unsaved changes. Are you sure you want to close this dialog?")||s.closeDialog()}))}return e.prototype.ngOnInit=function(){var e=this;this.editMode=this.route.snapshot.paramMap.get("editMode");var t=this.route.snapshot.paramMap.get("contentTypeStaticName"),n=this.contentTypesService.retrieveContentType(t).pipe((0,g.B)()),o=n.pipe((0,h.zg)(function(t){return e.contentTypesFieldsService.getFields(t)})),r=this.contentTypesFieldsService.typeListRetrieve().pipe((0,m.U)(function(e){return function(e){var t,n,o=[];try{for(var r=(0,i.XA)(e),a=r.next();!a.done;a=r.next()){var s=a.value;o.push({name:s,label:N[s].label,icon:(0,I.x)(s),description:N[s].description})}}catch(p){t={error:p}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return o}(e)})),a=this.contentTypesFieldsService.getInputTypesList(),p=this.contentTypesFieldsService.getReservedNames();(0,s.D)([n,o,r,a,p]).subscribe(function(t){var n=(0,i.CR)(t,5),o=n[1],r=n[2],a=n[3],s=n[4];e.contentType=n[0],e.dataTypes=r,e.inputTypeOptions=a;var p={};if(o.forEach(function(e){p[e.StaticName]="Field with this name already exists"}),e.reservedNames=(0,i.pi)((0,i.pi)({},s),p),null!=e.editMode){var l=e.route.snapshot.paramMap.get("id")?parseInt(e.route.snapshot.paramMap.get("id"),10):null,c=o.find(function(e){return e.Id===l});"name"===e.editMode&&delete e.reservedNames[c.StaticName],e.fields.push(c)}else for(var u=1;u<=8;u++)e.fields.push({Id:0,Type:b.Q.String,InputType:x.v.StringDefault,StaticName:"",IsTitle:0===o.length,SortOrder:o.length+u});for(u=0;u<e.fields.length;u++)e.calculateInputTypeOptions(u),e.calculateHints(u);e.loading$.next(!1)})},e.prototype.ngOnDestroy=function(){this.loading$.complete(),this.saving$.complete(),this.subscription.unsubscribe()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.calculateInputTypeOptions=function(e){var t=this;this.filteredInputTypeOptions[e]=this.inputTypeOptions.filter(function(n){return n.dataType===t.fields[e].Type.toLocaleLowerCase()})},e.prototype.resetInputType=function(e){var t=this.fields[e].Type.toLocaleLowerCase()+x.v.DefaultSuffix;this.filteredInputTypeOptions[e].some(function(e){return e.inputType===t})||(t=this.filteredInputTypeOptions[e][0].inputType),this.fields[e].InputType=t},e.prototype.calculateHints=function(e){var t,n,i=this,o=this.dataTypes.find(function(t){return t.name===i.fields[e].Type}),r=this.inputTypeOptions.find(function(t){return t.inputType===i.fields[e].InputType});this.dataTypeHints[e]=null!==(t=null==o?void 0:o.description)&&void 0!==t?t:"",this.inputTypeHints[e]=r.IsObsolete?"OBSOLETE - "+r.ObsoleteMessage:null!==(n=""+(null==r?void 0:r.description))&&void 0!==n?n:""},e.prototype.getInputType=function(e){return this.inputTypeOptions.find(function(t){return t.inputType===e})},e.prototype.save=function(){var e=this;if(this.saving$.next(!0),this.snackBar.open("Saving..."),null!=this.editMode){var t=this.fields[0];"name"===this.editMode?this.contentTypesFieldsService.rename(t.Id,this.contentType.Id,t.StaticName).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()}):"inputType"===this.editMode&&this.contentTypesFieldsService.updateInputType(t.Id,t.StaticName,t.InputType).subscribe(function(){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})}else p.of.apply(void 0,(0,i.ev)([],(0,i.CR)(this.fields))).pipe((0,y.h)(function(e){return!!e.StaticName}),(0,v.b)(function(t){return e.contentTypesFieldsService.add(t,e.contentType.Id).pipe((0,T.K)(function(e){return(0,p.of)(null)}))}),function(e,t){return arguments.length>=2?function(n){return(0,d.z)((0,l.R)(e,t),(0,c.h)(1),(0,u.d)(t))(n)}:function(t){return(0,d.z)((0,l.R)(function(t,n,i){return e(t,n,i+1)}),(0,c.h)(1))(t)}}(f,[])).subscribe(function(t){e.saving$.next(!1),e.snackBar.open("Saved",null,{duration:2e3}),e.closeDialog()})},e.\u0275fac=function(t){return new(t||e)(A.Y36(O.so),A.Y36(M.gz),A.Y36(q.s),A.Y36(w.Mr),A.Y36(C.ux))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-edit-content-type-fields"]],viewQuery:function(e,t){var n;1&e&&A.Gf(E,5,o.F),2&e&&A.iGM(n=A.CRH())&&(t.form=n.first)},hostVars:1,hostBindings:function(e,t){2&e&&A.Ikx("className",t.hostClass)},decls:7,vars:6,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["class","dialog-form",3,"ngSubmit",4,"ngIf"],[1,"dialog-form",3,"ngSubmit"],["ngForm","ngForm"],[1,"dialog-form-content","fancy-scrollbar-light"],["class","row-container",4,"ngFor","ngForOf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","submit","color","accent",3,"disabled"],[1,"row-container"],[1,"edit-input"],["appearance","standard","color","accent"],["matInput","",3,"pattern","appReservedNames","ngModel","name","disabled","ngModelChange"],["staticName","ngModel"],[3,"ngModel","name","disabled","selectionChange","ngModelChange"],[1,"type-icon"],[3,"value",4,"ngFor","ngForOf"],[1,"input-icon"],[3,"value","class",4,"ngFor","ngForOf"],[3,"isError",4,"ngIf"],[3,"isError"],[3,"value"],["class","input-icon",4,"ngIf"]],template:function(e,t){1&e&&(A.TgZ(0,"div",0),A.TgZ(1,"div",1),A.YNc(2,H,2,0,"ng-container",2),A.YNc(3,L,2,0,"ng-container",2),A.YNc(4,B,2,0,"ng-container",2),A.qZA(),A.qZA(),A.YNc(5,K,10,4,"form",3),A.ALo(6,"async")),2&e&&(A.xp6(2),A.Q6J("ngIf",void 0===t.editMode),A.xp6(1),A.Q6J("ngIf",null===t.editMode),A.xp6(1),A.Q6J("ngIf",null!=t.editMode),A.xp6(1),A.Q6J("ngIf",!1===A.lcZ(6,4,t.loading$)))},directives:[O.uh,_.O5,o._Y,o.JL,o.F,_.sg,S.lW,F.KE,F.hX,k.Nt,o.Fj,o.c5,J,o.JJ,o.On,Q.gD,Q.$L,U.Hw,Y.Y,$.ey],pipes:[_.Ov],styles:[".row-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.edit-input[_ngcontent-%COMP%]{padding-bottom:8px;width:30%}.type-icon[_ngcontent-%COMP%]{margin-right:8px}.input-icon[_ngcontent-%COMP%], .type-icon[_ngcontent-%COMP%]{width:inherit;height:inherit;font-size:inherit;vertical-align:top;line-height:inherit}.input-icon[_ngcontent-%COMP%]{margin-left:8px}.input-obsolete[_ngcontent-%COMP%]{-webkit-text-decoration:#000 line-through;text-decoration:#000 line-through;color:dimgray}"]}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/12.07.00/ng-edit/projects_ng-dialogs_src_app_content-type-fields_edit-content-type-fields_edit-content-type-fi-2daed6.d46dc044619f377d5717.js.map