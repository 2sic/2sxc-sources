"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_edit_dialog_footer_edit-dialog-footer_component_ts"],{7319:(it,$,r)=>{r.d($,{T:()=>j});var t=r(4522),U=r(8873),m=r(8559),h=r(6443),S=r(4821);let j=(()=>{class g{constructor(x,C,O){this.http=x,this.context=C,this.dnnContext=O}create(x,C){return this.http.post(`app/auto/data/${x}`,C,{params:{appId:this.context.appId,zoneId:this.context.zoneId}})}update(x,C,O){return this.http.post(`app/auto/data/${x}/${C}`,O,{params:{appId:this.context.appId,zoneId:this.context.zoneId}})}delete(x,C,O){return this.http.delete(this.dnnContext.$2sxc.http.apiUrl(t.gb+"delete"),{params:{contentType:x,id:C.toString(),appId:this.context.appId.toString(),force:O.toString()}})}static#t=this.\u0275fac=function(C){return new(C||g)(m.KVO(h.Qq),m.KVO(U.o),m.KVO(S.ob))};static#e=this.\u0275prov=m.jDH({token:g,factory:g.\u0275fac})}return g})()},5955:(it,$,r)=>{r.r($),r.d($,{EditDialogFooterComponent:()=>Ut});var t=r(8559);const U={Data:"data",Formulas:"formulas",Logs:"logs"};var m=r(9999),h=r(271),S=r(1199),j=r(4522),g=r(2913),F=r(316);const x=(o,s)=>({"log-error":o,"log-warn":s});function C(o,s){1&o&&(t.j41(0,"div"),t.EFF(1,"Logs are empty"),t.k0s())}function O(o,s){if(1&o){const e=t.RV6();t.j41(0,"div",1)(1,"span",2),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.j41(4,"span",3),t.EFF(5),t.k0s(),t.j41(6,"span",4),t.bIt("click",function(){const i=t.eBV(e).$implicit,l=t.XpG(2);return t.Njj(l.logToConsole(i))}),t.EFF(7," console "),t.k0s()()}if(2&o){const e=s.$implicit,n=t.XpG(2);t.Y8G("ngClass",t.l_i(6,x,e.severity===n.LogSeverities.Error,e.severity===n.LogSeverities.Warn)),t.R7$(2),t.SpI("",t.i5U(3,3,e.time,"HH:mm:ss"),":"),t.R7$(3),t.JRh(e.label)}}function at(o,s){if(1&o&&(t.j41(0,"div",0),t.DNE(1,C,2,0,"div"),t.Z7z(2,O,8,9,"div",1,t.fX1),t.k0s()),2&o){const e=s;t.R7$(),t.vxM(1,0===e.logs.length?1:-1),t.R7$(),t.Dyx(e.logs)}}let lt=(()=>{class o{constructor(e){this.loggingService=e,this.LogSeverities=S.EU}ngOnInit(){const e=this.loggingService.getLogs$();this.viewModel$=(0,m.z)([e]).pipe((0,h.T)(([n])=>({logs:n})))}logToConsole(e){switch(e.severity){case S.EU.Log:console.log(e.label,e.error);break;case S.EU.Warn:console.warn(e.label,e.error);break;case S.EU.Error:console.error(e.label,e.error)}}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(j.J6))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-logs-dump"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[1,"logs-box","fancy-scrollbar-light"],[1,"log-entry",3,"ngClass"],[1,"log-entry-part","log-entry-time"],[1,"log-entry-part","log-entry-label"],["tippy","Log to console",1,"log-entry-part","log-entry-show",3,"click"]],template:function(n,i){if(1&n&&(t.DNE(0,at,4,1,"div",0),t.nI1(1,"async")),2&n){let l;t.vxM(0,(l=t.bMT(1,1,i.viewModel$))?0:-1,l)}},dependencies:[F.YU,g.Cc,g.PW,F.Jj,F.vh],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex}.logs-box[_ngcontent-%COMP%]{flex:1 1 auto;overflow:auto;font-size:14px}.log-entry[_ngcontent-%COMP%]{display:flex;align-items:center;box-sizing:border-box;border-bottom:1px solid rgb(240,240,240);padding-top:2px;padding-bottom:2px}.log-entry[_ngcontent-%COMP%]   .log-entry-part[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.log-error[_ngcontent-%COMP%]{color:red;border-color:#ffd6d6;background-color:#fff0f0}.log-warn[_ngcontent-%COMP%]{color:#5c3c00;border-color:#fff5c2;background-color:#fffbe5}.log-entry-time[_ngcontent-%COMP%]{flex:0 0 auto}.log-entry-label[_ngcontent-%COMP%]{flex:1 1 auto}.log-entry-show[_ngcontent-%COMP%]{flex:0 0 auto;color:#06599a;font-size:12px;text-decoration:underline;cursor:pointer}"]})}return o})();var Z=r(5797),L=r(6647),rt=r(1817),Q=r(7319),I=r(8170),Y=r(52),st=r(519),dt=r(8705),N=r(59),A=r(8131),T=r(6231),q=r(2454),W=r(4902);const R={Entity:"entityGuid",Field:"fieldValue",Target:"formulaTarget"};var ct=r(2895);let ut=(()=>{class o{constructor(){this.maxLength=24}transform(e){return e.length<=this.maxLength?e:`\u2026${e.substring(e.length-this.maxLength)}`}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275pipe=t.EJ8({name:"snippetLabelSize",type:o,pure:!0,standalone:!0})}return o})();var B=r(1034),mt=r(8801),z=r(3840),X=r(4175),tt=r(7984),et=r(5060),w=r(4456),nt=r(5175),J=r(5944),pt=r(4601),gt=r(3347),ft=r(852);const _t=(o,s)=>({disabled:o,focused:s}),Ct=o=>({disabled:o}),H=o=>({"has-formula":o});function bt(o,s){if(1&o&&(t.j41(0,"mat-option",4)(1,"span",27),t.EFF(2),t.k0s()()),2&o){const e=s.$implicit;t.Y8G("value",e.entityGuid),t.R7$(),t.Y8G("ngClass",t.eq3(3,H,e.hasFormula)),t.R7$(),t.SpI(" ",e.label," ")}}function ht(o,s){if(1&o&&(t.j41(0,"mat-option",4)(1,"span",27),t.EFF(2),t.k0s()()),2&o){const e=s.$implicit;t.Y8G("value",e.fieldName),t.R7$(),t.Y8G("ngClass",t.eq3(3,H,e.hasFormula)),t.R7$(),t.SpI(" ",e.fieldName," ")}}function xt(o,s){if(1&o&&(t.j41(0,"mat-option",4)(1,"span",27),t.EFF(2),t.k0s()()),2&o){const e=s.$implicit;t.Y8G("value",e.target),t.R7$(),t.Y8G("ngClass",t.eq3(3,H,e.hasFormula)),t.R7$(),t.SpI(" ",e.label," ")}}function vt(o,s){if(1&o){const e=t.RV6();t.j41(0,"mat-select",5),t.bIt("ngModelChange",function(i){t.eBV(e);const l=t.XpG(3);return t.Njj(l.selectedChanged(l.SelectTargets.Target,i))}),t.Z7z(1,xt,3,5,"mat-option",4,t.fX1),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("ngModel",e.designer.target)("disabled",null==e.designer.entityGuid||null==e.designer.fieldName),t.R7$(),t.Dyx(e.targetOptions)}}function yt(o,s){if(1&o){const e=t.RV6();t.j41(0,"input",28),t.bIt("ngModelChange",function(i){t.eBV(e);const l=t.XpG(3);return t.Njj(l.selectedChanged(l.SelectTargets.Target,i))}),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("ngModel",e.designer.target)("disabled",null==e.designer.entityGuid||null==e.designer.fieldName)}}function Ft(o,s){if(1&o){const e=t.RV6();t.j41(0,"div",29),t.bIt("click",function(){const i=t.eBV(e).$implicit,l=t.XpG(3);return t.Njj(l.copyToClipboard(i.code))}),t.EFF(1),t.nI1(2,"snippetLabelSize"),t.k0s()}if(2&o){const e=s.$implicit;t.Y8G("title",e.code),t.R7$(),t.SpI(" ",t.bMT(2,2,e.label)," ")}}function Dt(o,s){1&o&&t.nrm(0,"div",17)}function Mt(o,s){if(1&o){const e=t.RV6();t.j41(0,"div",29),t.bIt("click",function(){const i=t.eBV(e).$implicit,l=t.XpG(3);return t.Njj(l.copyToClipboard(i.code))}),t.EFF(1),t.nI1(2,"snippetLabelSize"),t.k0s()}if(2&o){const e=s.$implicit;t.Y8G("title",e.code),t.R7$(),t.SpI(" ",t.bMT(2,2,e.label)," ")}}function Ot(o,s){1&o&&(t.j41(0,"span",31),t.EFF(1,"undefined"),t.k0s())}function Tt(o,s){1&o&&(t.j41(0,"span"),t.EFF(1,"promise(\u{1f91e}\u{1f3fd})"),t.k0s())}function St(o,s){if(1&o&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"json"),t.k0s()),2&o){const e=t.XpG(3);t.R7$(),t.JRh(t.bMT(2,1,e.result))}}function Pt(o,s){if(1&o&&t.DNE(0,Ot,2,0,"span",31)(1,Tt,2,0,"span")(2,St,3,3,"span"),2&o){const e=t.XpG(2);t.vxM(0,void 0!==e.result||e.resultIsOnlyPromise?-1:0),t.R7$(),t.vxM(1,void 0===e.result&&e.resultIsOnlyPromise?1:-1),t.R7$(),t.vxM(2,void 0!==e.result?2:-1)}}function Gt(o,s){1&o&&(t.j41(0,"span",30),t.EFF(1," Calculation failed. Please check logs for more info "),t.k0s())}function Et(o,s){if(1&o&&t.DNE(0,Pt,3,3)(1,Gt,2,0,"span",30),2&o){const e=t.XpG();t.vxM(0,e.resultIsError?-1:0),t.R7$(),t.vxM(1,e.resultIsError?1:-1)}}function jt(o,s){if(1&o){const e=t.RV6();t.j41(0,"button",32),t.bIt("click",function(){t.eBV(e);const i=t.XpG(3);return t.Njj(i.save())}),t.j41(1,"mat-icon"),t.EFF(2,"save"),t.k0s()()}if(2&o){const e=t.XpG();t.Y8G("tippyDisabled",!e.designer.editMode||!(null!=e.formula&&e.formula.source))("disabled",!e.designer.editMode||!(null!=e.formula&&e.formula.source)||e.saving)}}function It(o,s){if(1&o){const e=t.RV6();t.j41(0,"div",1)(1,"mat-form-field",2)(2,"mat-label"),t.EFF(3,"Entity"),t.k0s(),t.j41(4,"mat-select",3),t.bIt("ngModelChange",function(i){t.eBV(e);const l=t.XpG(2);return t.Njj(l.selectedChanged(l.SelectTargets.Entity,i))}),t.Z7z(5,bt,3,5,"mat-option",4,t.BUC().trackEntityOptions,!0),t.k0s()(),t.j41(7,"mat-form-field",2)(8,"mat-label"),t.EFF(9,"Attribute"),t.k0s(),t.j41(10,"mat-select",5),t.bIt("ngModelChange",function(i){t.eBV(e);const l=t.XpG(2);return t.Njj(l.selectedChanged(l.SelectTargets.Field,i))}),t.Z7z(11,ht,3,5,"mat-option",4,t.BUC().trackFieldOptions,!0),t.k0s()(),t.j41(13,"mat-form-field",2)(14,"mat-label"),t.EFF(15,"Target"),t.k0s(),t.DNE(16,vt,3,2,"mat-select",6)(17,yt,1,2,"input",7),t.k0s(),t.j41(18,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.toggleFreeText())}),t.j41(19,"mat-icon"),t.EFF(20,"text_fields"),t.k0s()(),t.nrm(21,"div",9),t.j41(22,"button",10),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.openFormulasHelp())}),t.j41(23,"mat-icon"),t.EFF(24,"help"),t.k0s()()(),t.j41(25,"div",11)(26,"div",12)(27,"mat-label",13),t.EFF(28,"Function"),t.k0s(),t.j41(29,"app-monaco-editor",14),t.bIt("valueChanged",function(i){t.eBV(e);const l=t.XpG(2);return t.Njj(l.formulaChanged(i))})("focused",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.onFocused())})("blurred",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.onBlurred())}),t.k0s()(),t.j41(30,"div",15),t.Z7z(31,Ft,3,4,"div",16,t.BUC().trackSnippets,!0),t.DNE(33,Dt,1,0,"div",17),t.Z7z(34,Mt,3,4,"div",16,t.BUC().trackSnippets,!0),t.k0s()(),t.j41(36,"div",18)(37,"div",19)(38,"span",13),t.EFF(39,"Result:\xa0"),t.k0s(),t.DNE(40,Et,2,2),t.k0s(),t.j41(41,"div",20)(42,"button",21),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.toggleEdit())}),t.j41(43,"mat-icon"),t.EFF(44,"edit"),t.k0s()(),t.j41(45,"button",22)(46,"mat-icon"),t.EFF(47,"more_vert"),t.k0s()(),t.j41(48,"mat-menu",null,0)(50,"button",23),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.deleteFormula())}),t.j41(51,"mat-icon"),t.EFF(52,"delete"),t.k0s(),t.j41(53,"span"),t.EFF(54,"Delete"),t.k0s()(),t.j41(55,"button",24),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.reset())}),t.j41(56,"mat-icon"),t.EFF(57,"history"),t.k0s(),t.j41(58,"span"),t.EFF(59,"Reset"),t.k0s()()(),t.DNE(60,jt,3,2,"button",25),t.j41(61,"button",26),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.run())}),t.j41(62,"mat-icon"),t.EFF(63,"play_arrow"),t.k0s()()()()}if(2&o){let e;const n=s,i=t.sdS(49),l=t.XpG(2);t.R7$(4),t.Y8G("ngModel",n.designer.entityGuid),t.R7$(),t.Dyx(n.entityOptions),t.R7$(5),t.Y8G("ngModel",n.designer.fieldName)("disabled",null==n.designer.entityGuid),t.R7$(),t.Dyx(n.fieldOptions),t.R7$(5),t.vxM(16,l.freeTextTarget?-1:16),t.R7$(),t.vxM(17,l.freeTextTarget?17:-1),t.R7$(),t.Y8G("disabled",null==n.designer.entityGuid||null==n.designer.fieldName),t.R7$(8),t.Y8G("ngClass",t.l_i(18,_t,!n.designer.editMode||null==n.designer.entityGuid||null==n.designer.fieldName||null==n.designer.target,l.focused)),t.R7$(3),t.Y8G("filename",l.filename)("value",null!==(e=null==n.formula?null:n.formula.source)&&void 0!==e?e:n.template)("jsTypings",n.typings)("options",l.monacoOptions),t.R7$(),t.Y8G("ngClass",t.eq3(21,Ct,!n.designer.editMode)),t.R7$(),t.Dyx(n.dataSnippets),t.R7$(2),t.vxM(33,null!=n.dataSnippets&&n.dataSnippets.length&&null!=n.contextSnippets&&n.contextSnippets.length?33:-1),t.R7$(),t.Dyx(n.contextSnippets),t.R7$(6),t.vxM(40,n.resultExists?40:-1),t.R7$(5),t.Y8G("matMenuTriggerFor",i),t.R7$(5),t.Y8G("disabled",!(null!=n.formula&&n.formula.sourceId)),t.R7$(10),t.vxM(60,l.allowSaveFormula?60:-1),t.R7$(),t.Y8G("disabled",!n.designer.editMode||!(null!=n.formula&&n.formula.source))}}function kt(o,s){if(1&o&&(t.DNE(0,It,64,23),t.nI1(1,"async")),2&o){let e;const n=t.XpG();t.vxM(0,(e=t.bMT(1,1,n.viewModel$))?0:-1,e)}}let $t=(()=>{class o{constructor(e,n,i,l,D,k,P){this.formulaDesignerService=e,this.snackBar=n,this.formConfig=i,this.entitiesService=l,this.itemService=D,this.contentTypeService=k,this.translate=P,this.SelectTargets=R,this.loadError=!1,this.freeTextTarget=!1,this.allowSaveFormula=this.formConfig.config.enableFormulaSave,this.isDeleted$=new Z.t(!1),this.saving$=new Z.t(!1),this.monacoOptions={minimap:{enabled:!1},lineHeight:19,lineNumbers:"off",lineDecorationsWidth:0,folding:!1,scrollBeyondLastLine:!1,tabSize:2,fixedOverflowWidgets:!0},this.filename=`formula${this.formConfig.config.formId}.js`,this.focused=!1}ngOnInit(){this.loadError=!1,null!=this.formBuilderRefs?(this.formulaDesignerService.setDesignerOpen(!0),this.buildViewModel()):this.loadError=!0}ngOnDestroy(){this.formulaDesignerService.setDesignerOpen(!1),this.saving$.complete()}trackEntityOptions(e,n){return n.entityGuid}trackFieldOptions(e,n){return n.fieldName}trackSnippets(e,n){return n.code}selectedChanged(e,n){const i={...this.formulaDesignerService.getDesignerState(),editMode:!1};switch(e){case R.Entity:i.entityGuid=n;const l=this.formBuilderRefs.find(D=>D.entityGuid===i.entityGuid);i.fieldName=Object.keys(l.fieldsSettingsService.getFieldsProps())[0];break;case R.Field:i.fieldName=n;break;case R.Target:i.target=n}this.formulaDesignerService.setDesignerState(i)}toggleFreeText(){this.freeTextTarget=!this.freeTextTarget}formulaChanged(e){const n=this.formulaDesignerService.getDesignerState();this.formulaDesignerService.updateFormulaFromEditor(n.entityGuid,n.fieldName,n.target,e,!1)}onFocused(){this.focused=!0}onBlurred(){this.focused=!1}copyToClipboard(e){(0,st.l)(e),this.snackBar.open("Copied to clipboard",null,{duration:2e3})}toggleEdit(){const e=this.formulaDesignerService.getDesignerState(),n={...e,editMode:!e.editMode};this.formulaDesignerService.setDesignerState(n),n.editMode&&null==this.formulaDesignerService.getFormula(n.entityGuid,n.fieldName,n.target,!0)&&this.formulaDesignerService.updateFormulaFromEditor(n.entityGuid,n.fieldName,n.target,Object.values(T.UZ).includes(n.target)?N.Ix:N.Gm,!1)}reset(){const e={...this.formulaDesignerService.getDesignerState(),editMode:!1};this.formulaDesignerService.setDesignerState(e),this.formulaDesignerService.resetFormula(e.entityGuid,e.fieldName,e.target),this.formBuilderRefs.find(n=>n.entityGuid===e.entityGuid).fieldsSettingsService.retriggerFormulas()}run(){const e=this.formulaDesignerService.getDesignerState(),n=this.formulaDesignerService.getFormula(e.entityGuid,e.fieldName,e.target,!0);this.formulaDesignerService.updateFormulaFromEditor(e.entityGuid,e.fieldName,e.target,n.source,!0),this.formBuilderRefs.find(i=>i.entityGuid===e.entityGuid).fieldsSettingsService.retriggerFormulas(),this.isDeleted$.next(!1)}save(){this.saving$.next(!0);const e=this.formulaDesignerService.getDesignerState(),n=this.formulaDesignerService.getFormula(e.entityGuid,e.fieldName,e.target,!0);if(null==n.sourceId){const i=this.itemService.getItem(n.entityGuid),l=q.yP.getContentTypeId(i),P=this.contentTypeService.getContentType(l).Attributes.find(M=>M.Name===n.fieldName).Metadata.find(M=>"@All"===M.Type.Id);return P?void this.entitiesService.create(Y.YX.contentTypes.formulas,{Title:n.target,Target:n.target,Formula:n.source,Enabled:!0,ParentRelationship:{Add:null,EntityId:null,Field:"Formulas",Index:0,Parent:P.Guid}}).subscribe(M=>{this.formulaDesignerService.updateSaved(n.entityGuid,n.fieldName,n.target,n.source,M.Guid,M.Id),this.snackBar.open("Formula saved",null,{duration:2e3}),this.saving$.next(!1)}):(this.snackBar.open("Field configuration is missing. Please create formula in Administration",void 0,{duration:3e3}),void this.saving$.next(!1))}this.entitiesService.update(Y.YX.contentTypes.formulas,n.sourceId,{Formula:n.source}).subscribe(()=>{this.formulaDesignerService.updateSaved(n.entityGuid,n.fieldName,n.target,n.source,n.sourceGuid,n.sourceId),this.snackBar.open("Formula saved",null,{duration:2e3}),this.saving$.next(!1)})}deleteFormula(){const e=this.formulaDesignerService.getDesignerState(),n=this.formulaDesignerService.getFormula(e.entityGuid,e.fieldName,e.target,!0);confirm(this.translate.instant("Data.Delete.Question",{title:n.fieldName+" - "+n.target,id:n.sourceId}))&&this.entitiesService.delete(Y.YX.contentTypes.formulas,n.sourceId,!0).subscribe({next:()=>{this.formulaDesignerService.delete(n.entityGuid,n.fieldName,n.target),this.snackBar.open(this.translate.instant("Message.Deleted"),null,{duration:2e3}),this.isDeleted$.next(!0),e.editMode&&this.toggleEdit()},error:k=>{this.snackBar.open(this.translate.instant("Message.DeleteError"),null,{duration:2e3})}})}openFormulasHelp(){window.open("https://go.2sxc.org/formulas","_blank")}buildViewModel(){const e=this.formulaDesignerService.getDesignerState();if(null==e.entityGuid&&null==e.fieldName&&null==e.target){const a=this.formBuilderRefs.first.entityGuid,c=this.formBuilderRefs.first.fieldsSettingsService.getFieldsProps(),f=Object.keys(c)[0],G=null!=f?T.tC.Value:null,p={...e,entityGuid:a,fieldName:f,target:G};this.formulaDesignerService.setDesignerState(p)}const n=this.formulaDesignerService.getDesignerState$(),i=(0,m.z)([n,this.formulaDesignerService.getFormulas$()]).pipe((0,h.T)(([a,c])=>{const f=this.formBuilderRefs.map(b=>({entityGuid:b.entityGuid,hasFormula:c.some(v=>v.entityGuid===b.entityGuid),label:b.fieldsSettingsService.getContentTypeSettings()._itemTitle})),G=[];if(null!=a.entityGuid){const E=this.formBuilderRefs.find(v=>v.entityGuid===a.entityGuid).fieldsSettingsService.getFieldsProps();for(const v of Object.keys(E)){const V={fieldName:v,hasFormula:c.some(y=>y.entityGuid===a.entityGuid&&y.fieldName===v),label:v};G.push(V)}}const p=[];if(null!=a.entityGuid&&null!=a.fieldName){for(const d of Object.values(T.a2)){const _={hasFormula:c.some(u=>u.entityGuid===a.entityGuid&&u.fieldName===a.fieldName&&u.target===d),label:d.substring(d.lastIndexOf(".")+1),target:d};p.push(_)}const b=this.itemService.getItem(a.entityGuid),E=q.yP.getContentTypeId(b),y=this.contentTypeService.getContentType(E).Attributes.find(d=>d.Name===a.fieldName).InputType;if(ct.r.isGroupStart(y))for(const d of[T.j5.Collapsed]){const _={hasFormula:c.some(u=>u.entityGuid===a.entityGuid&&u.fieldName===a.fieldName&&u.target===d),label:d.substring(d.lastIndexOf(".")+1),target:d};p.push(_)}if(y===I.I.StringDropdown||y===I.I.NumberDropdown)for(const d of[T.j5.DropdownValues]){const _={hasFormula:c.some(u=>u.entityGuid===a.entityGuid&&u.fieldName===a.fieldName&&u.target===d),label:d.substring(d.lastIndexOf(".")+1),target:d};p.push(_)}if(y===I.I.EntityPicker||y===I.I.StringPicker||y===I.I.NumberPicker)for(const d of Object.values(T.UZ)){const _={hasFormula:c.some(u=>u.entityGuid===a.entityGuid&&u.fieldName===a.fieldName&&u.target===d),label:"List Item "+d.substring(d.lastIndexOf(".")+1),target:d};p.push(_)}const Yt=c.filter(d=>d.entityGuid===a.entityGuid&&d.fieldName===a.fieldName);for(const d of Yt){if(p.some(At=>At.target===d.target))continue;const u={hasFormula:!0,label:d.target.substring(d.target.lastIndexOf(".")+1),target:d.target};p.push(u)}if(!p.some(d=>d.target===a.target)){const d={hasFormula:c.some(_=>_.entityGuid===a.entityGuid&&_.fieldName===a.fieldName&&_.target===a.target),label:a.target.substring(a.target.lastIndexOf(".")+1),target:a.target};p.push(d)}}return{entityOptions:f,fieldOptions:G,targetOptions:p}})),l=n.pipe((0,L.n)(a=>this.formulaDesignerService.getFormula$(a.entityGuid,a.fieldName,a.target,!0))),D=n.pipe((0,h.T)(a=>a.entityGuid),(0,rt.F)(),(0,L.n)(a=>this.itemService.getItemHeader$(a))),k=(0,m.z)([i,l,D]).pipe((0,h.T)(([a,c,f])=>null!=c&&null!=f?A.u.buildDesignerSnippetsData(c,a.fieldOptions,f.Prefill):[])),P=(0,m.z)([l]).pipe((0,h.T)(([a])=>null!=a?A.u.buildDesignerSnippetsContext(a):[])),M=(0,m.z)([i,l,D]).pipe((0,h.T)(([a,c,f])=>null!=c&&null!=f?A.u.buildFormulaTypings(c,a.fieldOptions,f.Prefill):"")),Lt=n.pipe((0,L.n)(a=>this.formulaDesignerService.getFormulaResult$(a.entityGuid,a.fieldName,a.target)));this.viewModel$=(0,m.z)([(0,m.z)([i,l,k,P,M,n]),(0,m.z)([Lt,this.saving$,this.isDeleted$])]).pipe((0,h.T)(([[a,c,f,G,p,K],[b,E,v]])=>{const V=Object.values(T.UZ).includes(K.target)?N.Ix:N.Gm;return{entityOptions:a.entityOptions,fieldOptions:a.fieldOptions,targetOptions:a.targetOptions,formula:c,designer:K,dataSnippets:f,contextSnippets:G,typings:p,template:V,result:b?.value,resultExists:null!=b&&!v,resultIsError:b?.isError??!1,resultIsOnlyPromise:b?.isOnlyPromise??!1,saving:E}}))}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(dt.f),t.rXU(gt.UG),t.rXU(j.Sy),t.rXU(Q.T),t.rXU(W.bX),t.rXU(W.n9),t.rXU(ft.c$))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-formula-designer"]],inputs:{formBuilderRefs:"formBuilderRefs"},standalone:!0,features:[t.Jv_([Q.T]),t.aNF],decls:1,vars:1,consts:[["menu","matMenu"],[1,"formula-context-box"],["color","accent",1,"eav-mat-form-field"],[3,"ngModelChange","ngModel"],[3,"value"],[3,"ngModelChange","ngModel","disabled"],[3,"ngModel","disabled"],["matInput","",3,"ngModel","disabled"],["mat-icon-button","","tippy","FreeText Target",1,"eav-formula-button",3,"click","disabled"],[1,"spacer"],["mat-icon-button","","tippy","Help",1,"eav-formula-button",3,"click"],[1,"formula-box"],[1,"formula-field",3,"ngClass"],[1,"label"],[1,"editor",3,"valueChanged","focused","blurred","filename","value","jsTypings","options"],[1,"formula-snippets","fancy-scrollbar-light",3,"ngClass"],[1,"snippet",3,"title"],[1,"separator"],[1,"formula-footer-box"],[1,"formula-result-box","hide-scrollbar"],[1,"formula-actions-box"],["mat-icon-button","","tippy","Edit",1,"eav-formula-action-button",3,"click"],["mat-icon-button","","tippy","Menu",1,"eav-formula-action-button",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"click"],["mat-icon-button","","tippy","Save",1,"eav-formula-action-button",3,"tippyDisabled","disabled"],["mat-icon-button","","tippy","Run",1,"eav-formula-action-button",3,"click","disabled"],[3,"ngClass"],["matInput","",3,"ngModelChange","ngModel","disabled"],[1,"snippet",3,"click","title"],[1,"result-error"],[1,"result-undefined"],["mat-icon-button","","tippy","Save",1,"eav-formula-action-button",3,"click","tippyDisabled","disabled"]],template:function(n,i){1&n&&t.DNE(0,kt,2,3),2&n&&t.vxM(0,i.loadError?-1:0)},dependencies:[J.RG,J.rl,J.nJ,nt.Ve,nt.VO,et.wT,w.YN,w.me,w.BC,w.vS,et.Sy,F.YU,g.Cc,g.PW,tt.fS,tt.fg,X.Hl,X.iY,z.m_,z.An,mt.K,B.Cn,B.kk,B.fb,B.Cp,F.Jj,F.TG,ut,pt.e],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;box-sizing:border-box;overflow:hidden;border-top:1px solid lightgray;padding-top:8px}.formula-context-box[_ngcontent-%COMP%]{display:flex;align-items:center}.formula-context-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px}.formula-context-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.has-formula[_ngcontent-%COMP%]{font-weight:700}.formula-box[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;overflow:hidden}.formula-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{flex:0 1 auto;font-size:14px;width:100%}.formula-box[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-family:monospace}.formula-box[_ngcontent-%COMP%]   .formula-field[_ngcontent-%COMP%]{flex:0 1 auto;width:100%;overflow:hidden;margin-bottom:6px}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]{flex:0 0 auto;max-width:200px;max-height:194px;overflow:hidden auto;padding-left:2px}.formula-box[_ngcontent-%COMP%]   .formula-snippets.disabled[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]{pointer-events:none;color:#1d273d70}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;white-space:nowrap;padding-top:1px;padding-bottom:1px}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]:first-of-type{padding-top:0}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]:last-of-type{padding-bottom:0}.formula-box[_ngcontent-%COMP%]   .formula-snippets[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin-top:.5em;margin-bottom:.5em;border-bottom:1px solid rgba(29,39,61,.44)}.formula-footer-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;overflow:hidden;height:min-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;height:-moz-fit-content;height:fit-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}.formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .result-undefined[_ngcontent-%COMP%], .formula-footer-box[_ngcontent-%COMP%]   .formula-result-box[_ngcontent-%COMP%]   .result-error[_ngcontent-%COMP%]{color:red}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;height:-moz-fit-content;height:fit-content}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]   .mdc-icon-button[_ngcontent-%COMP%]{margin-left:0;width:30px;height:30px;line-height:30px;padding:0;flex-shrink:0}.formula-footer-box[_ngcontent-%COMP%]   .formula-actions-box[_ngcontent-%COMP%]   .mdc-icon-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-top:5px;font-size:20px;width:20px;height:20px;line-height:20px!important}.formula-field[_ngcontent-%COMP%]{padding-top:28px;border-bottom:1px solid rgba(0,0,0,.2);padding-bottom:12px;position:relative}.formula-field[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;color:#0009;cursor:default;font-size:12px;transition:none;position:absolute;left:0;top:0;-webkit-user-select:none;user-select:none}.formula-field[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]     .monaco-editor .scroll-decoration{display:none}.formula-field[_ngcontent-%COMP%]:hover{border-bottom:2px solid rgba(0,0,0,.4);padding-bottom:11px}.formula-field.focused[_ngcontent-%COMP%]{border-bottom:2px solid #002753;padding-bottom:11px}.formula-field.focused[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#002753}.formula-field.error[_ngcontent-%COMP%]{border-bottom:2px solid #b00030;padding-bottom:11px}.formula-field.error[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#b00030}.formula-field.disabled[_ngcontent-%COMP%]{border-bottom:none;padding-bottom:13px;background-image:linear-gradient(to right,rgba(0,0,0,.2) 0%,rgba(0,0,0,.2) 33%,transparent 0%);background-position:bottom;background-size:4px 1px;background-repeat:repeat-x}.formula-field.disabled[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]{pointer-events:none}.formula-field.disabled[_ngcontent-%COMP%]   .editor[_ngcontent-%COMP%]     *{color:#00000061}"]})}return o})();function Nt(o,s){1&o&&(t.j41(0,"textarea",0),t.EFF(1),t.nI1(2,"json"),t.k0s()),2&o&&(t.R7$(),t.JRh(t.bMT(2,1,s.items)))}let Rt=(()=>{class o{constructor(e,n){this.itemService=e,this.formConfig=n}ngOnInit(){const e=this.itemService.getItems$(this.formConfig.config.itemGuids);this.viewModel$=(0,m.z)([e]).pipe((0,h.T)(([n])=>({items:n})))}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(W.bX),t.rXU(j.Sy))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-data-dump"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["readonly","",1,"fancy-scrollbar-light"]],template:function(n,i){if(1&n&&(t.DNE(0,Nt,3,3,"textarea",0),t.nI1(1,"async")),2&n){let l;t.vxM(0,(l=t.bMT(1,1,i.viewModel$))?0:-1,l)}},dependencies:[F.Jj,F.TG],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex}textarea[_ngcontent-%COMP%]{flex:1 1 auto;margin:0;padding:10px 0 10px 10px;border:0px;box-sizing:border-box;resize:none;outline:none;background-color:#1d273d0a}"]})}return o})();var ot=r(3777);const Bt=o=>({"debug-enabled":o});function zt(o,s){1&o&&t.nrm(0,"app-data-dump")}function Xt(o,s){if(1&o&&t.nrm(0,"app-formula-designer",8),2&o){const e=t.XpG(2);t.Y8G("formBuilderRefs",e.formBuilderRefs)}}function wt(o,s){1&o&&t.nrm(0,"app-logs-dump")}function Vt(o,s){if(1&o&&(t.j41(0,"div",7),t.DNE(1,zt,1,0,"app-data-dump")(2,Xt,1,1,"app-formula-designer",8)(3,wt,1,0,"app-logs-dump"),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.vxM(1,e.activeDebug===e.DebugTypes.Data?1:-1),t.R7$(),t.vxM(2,e.activeDebug===e.DebugTypes.Formulas?2:-1),t.R7$(),t.vxM(3,e.activeDebug===e.DebugTypes.Logs?3:-1)}}let Ut=(()=>{class o{constructor(){this.debugInfoOpened=new t.bkB,this.DebugTypes=U,this.sxcVer=window.sxcVersion.substring(0,window.sxcVersion.lastIndexOf("."))}ngOnInit(){}toggleDebugType(e){this.activeDebug=e!==this.activeDebug?e:null,this.debugInfoOpened.emit(null!=this.activeDebug)}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-edit-dialog-footer"]],inputs:{formBuilderRefs:"formBuilderRefs"},outputs:{debugInfoOpened:"debugInfoOpened"},standalone:!0,features:[t.aNF],decls:21,vars:5,consts:[["appearance","raised",1,"mat-elevation-z4",3,"ngClass"],[1,"debug-buttons-container"],["mat-button","","tippy","Show Data JSON",3,"click"],["mat-button","","tippy","Show Formula Designer",3,"click"],["mat-button","","tippy","Show Logs",3,"click"],[1,"spacer"],[1,"sxc-version"],[1,"debug-info-container"],[3,"formBuilderRefs"]],template:function(n,i){1&n&&(t.j41(0,"mat-card",0)(1,"div",1)(2,"button",2),t.bIt("click",function(){return i.toggleDebugType(i.DebugTypes.Data)}),t.j41(3,"mat-icon"),t.EFF(4,"offline_bolt"),t.k0s(),t.j41(5,"span"),t.EFF(6,"Data"),t.k0s()(),t.j41(7,"button",3),t.bIt("click",function(){return i.toggleDebugType(i.DebugTypes.Formulas)}),t.j41(8,"mat-icon"),t.EFF(9,"functions"),t.k0s(),t.j41(10,"span"),t.EFF(11,"Formulas"),t.k0s()(),t.j41(12,"button",4),t.bIt("click",function(){return i.toggleDebugType(i.DebugTypes.Logs)}),t.j41(13,"mat-icon"),t.EFF(14,"speed"),t.k0s(),t.j41(15,"span"),t.EFF(16,"Logs"),t.k0s()(),t.nrm(17,"div",5),t.j41(18,"div",6),t.EFF(19),t.k0s()(),t.DNE(20,Vt,4,3,"div",7),t.k0s()),2&n&&(t.Y8G("ngClass",t.eq3(3,Bt,null!=i.activeDebug)),t.R7$(19),t.SpI("2sxc ",i.sxcVer,""),t.R7$(),t.vxM(20,null!=i.activeDebug?20:-1))},dependencies:[ot.Hu,ot.RN,F.YU,g.Cc,g.PW,X.Hl,X.$z,z.m_,z.An,Rt,$t,lt],styles:[".mat-mdc-card[_ngcontent-%COMP%]{padding:0;margin:0;border-top-left-radius:0;border-top-right-radius:0;height:52px;z-index:1;width:100%;display:flex;flex-direction:column;box-sizing:border-box}@media (max-width: 600px){.mat-mdc-card[_ngcontent-%COMP%]{border-radius:0}}.mat-mdc-card.debug-enabled[_ngcontent-%COMP%]{height:auto}.debug-buttons-container[_ngcontent-%COMP%]{padding:17px 16px 15px;height:52px;width:100%;display:flex;box-sizing:border-box;align-items:center}.debug-buttons-container[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{margin-left:0}.debug-buttons-container[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:4px}.debug-buttons-container[_ngcontent-%COMP%]   .sxc-version[_ngcontent-%COMP%]{cursor:default}.mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;line-height:20px!important}.debug-info-container[_ngcontent-%COMP%]{margin:0 16px 16px!important;width:calc(100% - 32px);height:300px;box-sizing:border-box;position:relative;overflow:auto}"]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.99.00/dist/ng-edit/projects_eav-ui_src_app_edit_dialog_footer_edit-dialog-footer_component_ts.a9e7da24a1e4dd7c.js.map