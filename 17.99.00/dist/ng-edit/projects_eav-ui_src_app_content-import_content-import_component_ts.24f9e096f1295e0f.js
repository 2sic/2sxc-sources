"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-import_content-import_component_ts"],{2743:(F,D,o)=>{o.d(D,{b:()=>t});var l=o(271),g=o(6301),v=o(8764),m=o(4902),x=o(8873),p=o(4858),E=o(4979),r=o(3472),c=o(8559),h=o(6443);let t=(()=>{class T extends E.V{constructor(u,a,_,y){super(new r.B("AppDialogConfigService",!1)),this.http=u,this.context=a,this.globalConfigService=_,this.dialogSettings$={},this.log.a(`using context #${this.context.log.svcId}`),y.loadFromService(this)}ngOnDestroy(){super.destroy()}getCurrent$(){const u=this.context.appId;return this.log.a(`getCurrent$ - appId:${u}`),this.getShared$(u)}getSitePrimaryApp$(){return this.getCurrent$().pipe((0,l.T)(u=>u?.Context.Site.PrimaryApp))}getGlobalPrimaryApp$(){return this.getCurrent$().pipe((0,l.T)(u=>u?.Context.System.PrimaryApp))}getShared$(u){return this.log.a("getShared$ appId: "+u),this.dialogSettings$[u]??=this.getDialogSettings(u,"getShared$").pipe((0,g.t)({refCount:!1})),this.dialogSettings$[u]}getDialogSettings(u,a){return this.log.a("getDialogSettings",{appId:u,reqBy:a}),this.http.get("admin/dialog/settings",{params:{appId:u??this.context.appId.toString()}}).pipe((0,l.T)(_=>(_.Context.Language.List=_.Context.Language.List.filter(y=>y.IsEnabled),_)),(0,v.M)(_=>{this.globalConfigService.allowDebug(_.Context.Enable.DebugMode)}))}static#t=this.\u0275fac=function(a){return new(a||T)(c.KVO(h.Qq),c.KVO(x.o),c.KVO(m.Bj),c.KVO(p.D))};static#e=this.\u0275prov=c.jDH({token:T,factory:T.\u0275fac})}return T})()},7693:(F,D,o)=>{o.d(D,{X:()=>p,g:()=>T});var l=o(271),g=o(8873),v=o(8559),m=o(6443),x=o(4821);const p="admin/type/",c="admin/type/scopes";let T=(()=>{class S{constructor(a,_,y){this.http=a,this.context=_,this.dnnContext=y}apiUrl(a){return this.dnnContext.$2sxc.http.apiUrl(a)}retrieveContentType(a){return this.http.get(this.apiUrl("admin/type/get"),{params:{appId:this.context.appId.toString(),contentTypeId:a}})}retrieveContentTypes(a){return this.http.get(this.apiUrl("admin/type/list"),{params:{appId:this.context.appId.toString(),scope:a}})}getScopes(){return this.http.get(this.apiUrl(c),{params:{appId:this.context.appId.toString()}}).pipe((0,l.T)(a=>{const _=a.old;return Object.keys(_).map(R=>({name:_[R],value:R}))}))}getScopesV2(){return this.http.get(this.apiUrl(c),{params:{appId:this.context.appId.toString()}}).pipe((0,l.T)(a=>a.scopes))}save(a){return this.http.post(this.apiUrl("admin/type/save"),a,{params:{appid:this.context.appId.toString()}})}delete(a){return this.http.delete(this.apiUrl("admin/type/delete"),{params:{appid:this.context.appId.toString(),staticName:a.StaticName}})}import(a){const _=new FormData;for(const y of a)_.append("File",y);return this.http.post(this.apiUrl("admin/type/import"),_,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}createGhost(a){return this.http.post(this.apiUrl("admin/type/addghost"),null,{params:{appid:this.context.appId.toString(),sourceStaticName:a}})}static#t=this.\u0275fac=function(_){return new(_||S)(v.KVO(m.Qq),v.KVO(g.o),v.KVO(x.ob))};static#e=this.\u0275prov=v.jDH({token:S,factory:S.\u0275fac})}return S})()},2795:(F,D,o)=>{o.r(D),o.d(D,{ContentImportComponent:()=>H});var l=o(7941),g=o(5797),v=o(9999),m=o(271),x=o(1873),p=o(2743),E=o(7693),r=o(9835),c=o(6647),h=o(4522),I=o(693),f=o(8873),t=o(8559),T=o(6443),S=o(4821);let u=(()=>{class n{constructor(e,i,s){this.http=e,this.context=i,this.dnnContext=s}evaluateContent(e){return(0,r.H)((0,I.n)(e.file)).pipe((0,c.n)(i=>{const s={AppId:this.context.appId.toString(),DefaultLanguage:e.defaultLanguage,ContentType:e.contentType,ContentBase64:i,ResourcesReferences:e.resourcesReferences,ClearEntities:e.clearEntities};return this.http.post(this.dnnContext.$2sxc.http.apiUrl(h.gb+"XmlPreview"),s).pipe((0,m.T)(d=>(d.Success||(d.Errors=d.Detail,delete d.Detail),d)))}))}importContent(e){return(0,r.H)((0,I.n)(e.file)).pipe((0,c.n)(i=>{const s={AppId:this.context.appId.toString(),DefaultLanguage:e.defaultLanguage,ContentType:e.contentType,ContentBase64:i,ResourcesReferences:e.resourcesReferences,ClearEntities:e.clearEntities};return this.http.post(this.dnnContext.$2sxc.http.apiUrl(h.gb+"XmlUpload"),s)}))}static#t=this.\u0275fac=function(i){return new(i||n)(t.KVO(T.Qq),t.KVO(f.o),t.KVO(S.ob))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac})}return n})();var a=o(316),_=o(3804),y=o(4175),R=o(4456),M=o(4575),j=o(9184);function $(n,C){if(1&n){const e=t.RV6();t.j41(0,"form",null,0)(2,"div",8)(3,"div")(4,"button",9),t.bIt("click",function(){t.eBV(e);const s=t.sdS(8);return t.Njj(s.click())}),t.j41(5,"span"),t.EFF(6),t.k0s()(),t.j41(7,"input",10,1),t.bIt("change",function(s){t.eBV(e);const d=t.XpG(3);return t.Njj(d.fileChange(s))}),t.k0s()(),t.j41(9,"div")(10,"p",11),t.EFF(11,"References to pages / files"),t.k0s(),t.j41(12,"mat-radio-group",12),t.mxI("ngModelChange",function(s){t.eBV(e);const d=t.XpG(3);return t.DH7(d.formValues.resourcesReferences,s)||(d.formValues.resourcesReferences=s),t.Njj(s)}),t.j41(13,"mat-radio-button",13),t.EFF(14," Import links as written in the file (for example /Portals/...) "),t.k0s(),t.j41(15,"mat-radio-button",14),t.EFF(16," Try to resolve paths to references "),t.k0s()()(),t.j41(17,"div")(18,"p",11),t.EFF(19,"Clear all other entities"),t.k0s(),t.j41(20,"mat-radio-group",15),t.mxI("ngModelChange",function(s){t.eBV(e);const d=t.XpG(3);return t.DH7(d.formValues.clearEntities,s)||(d.formValues.clearEntities=s),t.Njj(s)}),t.j41(21,"mat-radio-button",16),t.EFF(22," Keep all entities not found in import "),t.k0s(),t.j41(23,"mat-radio-button",17),t.EFF(24," Remove all entities not found in import "),t.k0s()()(),t.j41(25,"p",18),t.EFF(26,"Remember to backup your DNN first!"),t.k0s()(),t.j41(27,"mat-dialog-actions",19)(28,"button",20),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.closeDialog())}),t.EFF(29,"Cancel"),t.k0s(),t.j41(30,"button",21),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.evaluateContent())}),t.EFF(31," Preview Import "),t.k0s()()()}if(2&n){const e=t.XpG(3);t.R7$(6),t.JRh(e.formValues.file?e.formValues.file.name:"Select or drop file"),t.R7$(6),t.R50("ngModel",e.formValues.resourcesReferences),t.R7$(8),t.R50("ngModel",e.formValues.clearEntities),t.R7$(10),t.Y8G("disabled",!e.formValues.file||!e.formValues.file.name)}}function O(n,C){1&n&&(t.j41(0,"div",8)(1,"p"),t.EFF(2,"Please wait while processing..."),t.k0s()())}function b(n,C){if(1&n&&(t.j41(0,"div",8)(1,"p",22),t.EFF(2),t.k0s(),t.j41(3,"p",22),t.EFF(4,"File contains:"),t.k0s(),t.j41(5,"ul",23)(6,"li"),t.EFF(7),t.k0s(),t.j41(8,"li"),t.EFF(9),t.k0s(),t.j41(10,"li"),t.EFF(11),t.k0s()(),t.j41(12,"p",22),t.EFF(13,"If you press Import, it will:"),t.k0s(),t.j41(14,"ul",23)(15,"li"),t.EFF(16),t.k0s(),t.j41(17,"li"),t.EFF(18),t.k0s(),t.j41(19,"li"),t.EFF(20),t.k0s(),t.j41(21,"li"),t.EFF(22),t.k0s()(),t.j41(23,"p",18),t.EFF(24,"Note: The import validates much data and may take several minutes."),t.k0s()()),2&n){const e=t.XpG(4),i=t.XpG();t.R7$(2),t.SpI("Try to import file '",i.formValues.file.name,"'"),t.R7$(5),t.SpI("",e.evaluationResult.Detail.DocumentElementsCount," content-items (records/entities)"),t.R7$(2),t.SpI("",e.evaluationResult.Detail.LanguagesInDocumentCount," languages"),t.R7$(2),t.Lme("",e.evaluationResult.Detail.AttributeNamesInDocument.length," columns: ",e.evaluationResult.Detail.AttributeNamesInDocument.join(", "),""),t.R7$(5),t.SpI("Create ",e.evaluationResult.Detail.AmountOfEntitiesCreated," content-items"),t.R7$(2),t.SpI("Update ",e.evaluationResult.Detail.AmountOfEntitiesUpdated," content-items"),t.R7$(2),t.SpI("Delete ",e.evaluationResult.Detail.AmountOfEntitiesDeleted," content-items"),t.R7$(2),t.Lme("Ignore ",e.evaluationResult.Detail.AttributeNamesNotImported.length," columns: ",e.evaluationResult.Detail.AttributeNamesNotImported.join(", "),"")}}function P(n,C){if(1&n&&(t.j41(0,"div")(1,"i"),t.EFF(2),t.k0s()()),2&n){const e=t.XpG().$implicit;t.R7$(2),t.SpI("Details: ",e.ErrorDetail,"")}}function A(n,C){if(1&n&&(t.j41(0,"div")(1,"i"),t.EFF(2),t.k0s()()),2&n){const e=t.XpG().$implicit;t.R7$(2),t.SpI("Line-no: ",e.LineNumber,"")}}function L(n,C){if(1&n&&(t.j41(0,"div")(1,"i"),t.EFF(2),t.k0s()()),2&n){const e=t.XpG().$implicit;t.R7$(2),t.SpI("Line-details: ",e.LineDetail,"")}}function U(n,C){if(1&n&&(t.j41(0,"li")(1,"div"),t.EFF(2),t.k0s(),t.DNE(3,P,3,1,"div")(4,A,3,1,"div")(5,L,3,1,"div"),t.k0s()),2&n){const e=C.$implicit,i=t.XpG(6);t.R7$(2),t.JRh(i.errors[e.ErrorCode]),t.R7$(),t.vxM(3,e.ErrorDetail?3:-1),t.R7$(),t.vxM(4,e.LineNumber?4:-1),t.R7$(),t.vxM(5,e.LineDetail?5:-1)}}function B(n,C){if(1&n&&(t.j41(0,"div",8)(1,"p",22),t.EFF(2),t.k0s(),t.j41(3,"ul",23),t.Z7z(4,U,6,4,"li",null,t.fX1),t.k0s()()),2&n){const e=t.XpG(4),i=t.XpG();t.R7$(2),t.SpI("Try to import file '",i.formValues.file.name,"'"),t.R7$(2),t.Dyx(e.evaluationResult.Errors)}}function k(n,C){if(1&n){const e=t.RV6();t.DNE(0,b,25,10,"div",8)(1,B,6,1,"div",8),t.j41(2,"mat-dialog-actions",19)(3,"button",20),t.bIt("click",function(){t.eBV(e);const s=t.XpG(4);return t.Njj(s.back())}),t.EFF(4,"Back"),t.k0s(),t.j41(5,"button",21),t.bIt("click",function(){t.eBV(e);const s=t.XpG(4);return t.Njj(s.importContent())}),t.EFF(6," Import "),t.k0s()()}if(2&n){const e=t.XpG(3);t.vxM(0,e.evaluationResult.Success?0:-1),t.R7$(),t.vxM(1,e.evaluationResult.Success?-1:1),t.R7$(4),t.Y8G("disabled",!e.evaluationResult.Success)}}function V(n,C){if(1&n&&t.DNE(0,k,7,3,"mat-dialog-actions",19),2&n){const e=t.XpG(2);t.vxM(0,e.evaluationResult?0:-1)}}function w(n,C){1&n&&(t.j41(0,"p"),t.EFF(1,"Import done."),t.k0s())}function N(n,C){1&n&&(t.j41(0,"p"),t.EFF(1,"Import failed."),t.k0s())}function X(n,C){if(1&n&&(t.j41(0,"div",8),t.DNE(1,w,2,0,"p")(2,N,2,0,"p"),t.k0s()),2&n){const e=t.XpG(3);t.R7$(),t.vxM(1,e.importResult.Success?1:-1),t.R7$(),t.vxM(2,e.importResult.Success?-1:2)}}function K(n,C){if(1&n){const e=t.RV6();t.DNE(0,X,3,2,"div",8),t.j41(1,"mat-dialog-actions",19)(2,"button",24),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.closeDialog())}),t.EFF(3,"Close"),t.k0s()()}if(2&n){const e=t.XpG(2);t.vxM(0,e.importResult?0:-1)}}function G(n,C){if(1&n&&t.DNE(0,$,32,4)(1,O,3,0)(2,V,1,1)(3,K,4,1),2&n){let e;const i=t.XpG();t.vxM(0,1===(e=i.viewStateSelected)?0:0===e?1:2===e?2:3===e?3:-1)}}function W(n,C){if(1&n){const e=t.RV6();t.j41(0,"div",3),t.bIt("filesDropped",function(s){t.eBV(e);const d=t.XpG();return t.Njj(d.filesDropped(s))}),t.j41(1,"div",4)(2,"div",5),t.EFF(3),t.k0s()(),t.j41(4,"div",6)(5,"p"),t.EFF(6," This will import content-items into 2sxc. It requires that you already defined the content-type before you try importing, and that you created the import-file using the template provided by the Export. Please visit "),t.j41(7,"a",7),t.EFF(8,"https://2sxc.org/help"),t.k0s(),t.EFF(9," for more instructions. "),t.k0s()(),t.DNE(10,G,4,1),t.k0s()}if(2&n){const e=C,i=t.XpG();t.Y8G("allowedFileTypes","xml"),t.R7$(3),t.SpI("",null==e.contentType?null:e.contentType.Name," Import Data"),t.R7$(7),t.vxM(10,null!=i.formValues?10:-1)}}let H=(()=>{class n{constructor(e,i,s,d,z,J){this.dialogData=e,this.dialogRef=i,this.route=s,this.contentImportService=d,this.appDialogConfigService=z,this.contentTypesService=J,this.hostClass="dialog-component",this.contentType$=new g.t(null),this.loading$=new g.t(!1),this.viewStates={waiting:0,default:1,evaluated:2,imported:3},this.viewStateSelected$=new g.t(this.viewStates.default),this.evaluationResult$=new g.t(null),this.importResult$=new g.t(null),this.viewModel$=(0,v.z)([this.contentType$,this.loading$,this.viewStateSelected$,this.evaluationResult$,this.importResult$]).pipe((0,m.T)(([Y,Q,Z,q,tt])=>({contentType:Y,loading:Q,viewStateSelected:Z,evaluationResult:q,importResult:tt}))),this.errors={0:"Unknown error occured.",1:"Selected content-type does not exist.",2:"Document is not a valid XML file.",3:"Selected content-type does not match the content-type in the XML file.",4:"The language is not supported.",5:"The document does not specify all languages for all entities.",6:"Language reference cannot be parsed, the language is not supported.",7:"Language reference cannot be parsed, the read-write protection is not supported.",8:"Value cannot be read, because of it has an invalid format."},this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName")}ngOnInit(){this.loading$.next(!0);const e=this.contentTypesService.retrieveContentType(this.contentTypeStaticName),i=this.appDialogConfigService.getCurrent$();(0,x.p)([e,i]).subscribe(([s,d])=>{this.contentType$.next(s),this.formValues={defaultLanguage:d.Context.Language.Primary,contentType:this.contentTypeStaticName,file:null!=this.dialogData.files?this.dialogData.files[0]:null,resourcesReferences:"Keep",clearEntities:"None"},this.loading$.next(!1)})}ngOnDestroy(){this.contentType$.complete(),this.loading$.complete(),this.viewStateSelected$.complete(),this.evaluationResult$.complete(),this.importResult$.complete()}closeDialog(){this.dialogRef.close()}evaluateContent(){this.viewStateSelected$.next(this.viewStates.waiting),this.contentImportService.evaluateContent(this.formValues).subscribe(e=>{this.evaluationResult$.next(e),this.viewStateSelected$.next(this.viewStates.evaluated)})}importContent(){this.viewStateSelected$.next(this.viewStates.waiting),this.contentImportService.importContent(this.formValues).subscribe(e=>{this.importResult$.next(e),this.viewStateSelected$.next(this.viewStates.imported)})}back(){this.viewStateSelected$.next(this.viewStates.default),this.evaluationResult$.next(null)}fileChange(e){this.formValues.file=e.target.files[0]}filesDropped(e){this.formValues.file=e[0]}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(l.Vh),t.rXU(l.CP),t.rXU(j.nX),t.rXU(u),t.rXU(p.b),t.rXU(E.g))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-content-import"]],hostVars:1,hostBindings:function(i,s){2&i&&t.Mr5("className",s.hostClass)},standalone:!0,features:[t.Jv_([u,E.g,p.b]),t.aNF],decls:2,vars:3,consts:[["ngForm","ngForm"],["fileInput",""],["appDragAndDrop","",1,"eav-dialog",3,"allowedFileTypes"],["appDragAndDrop","",1,"eav-dialog",3,"filesDropped","allowedFileTypes"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-description"],["href","https://2sxc.org/help","target","_blank"],[1,"eav-dialog-content"],["mat-raised-button","","tippy","Open file browser",3,"click"],["type","file",1,"hide",3,"change"],[1,"eav-radio-group-label"],["name","ResourcesReferences",1,"eav-radio-group",3,"ngModelChange","ngModel"],["value","Keep"],["value","Resolve"],["name","ClearEntities",1,"eav-radio-group",3,"ngModelChange","ngModel"],["value","None"],["value","All"],[1,"eav-hint"],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click","disabled"],[1,"eav-evaluation__title"],[1,"eav-evaluation__content"],["mat-raised-button","","color","accent",3,"click"]],template:function(i,s){if(1&i&&(t.DNE(0,W,11,3,"div",2),t.nI1(1,"async")),2&i){let d;t.vxM(0,(d=t.bMT(1,1,s.viewModel$))?0:-1,d)}},dependencies:[R.YN,R.qT,R.BC,R.cb,R.vS,R.cV,y.Hl,y.$z,_.Wk,_.VT,_._g,l.E7,a.Jj,M.S],styles:[".eav-radio-group-label[_ngcontent-%COMP%]{font-size:18px;margin:24px 0 0}.eav-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:8px 0}.eav-hint[_ngcontent-%COMP%]{font-size:18px;margin-top:24px;margin-bottom:16px}.eav-evaluation__title[_ngcontent-%COMP%]{font-size:18px;margin:24px 0 0;font-weight:700}.eav-evaluation__content[_ngcontent-%COMP%]{font-size:14px}.eav-evaluation__content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:2px 0}"]})}return n})()},3140:(F,D,o)=>{o.d(D,{J:()=>v});var l=o(7092),g=o(8559);let v=(()=>{class m{constructor(){this.subscriptions=new l.yU}ngOnDestroy(){this.subscriptions.unsubscribe()}static#t=this.\u0275fac=function(E){return new(E||m)};static#e=this.\u0275dir=g.FsC({type:m})}return m})()},4575:(F,D,o)=>{o.d(D,{S:()=>x});var l=o(8559),g=o(8537),v=o(3140),m=o(3347);let x=(()=>{class p extends v.J{constructor(r,c,h){super(),this.zone=c,this.snackBar=h,this.markStyle="outline",this.allowedFileTypes="",this.filesDropped=new l.bkB,this.dropAreaClass="eav-droparea",this.dragClass="eav-dragover",this.timeouts=[],this.element=r.nativeElement}ngOnInit(){this.markStyleClass=`eav-droparea-${this.markStyle}`,this.element.classList.add(this.dropAreaClass,this.markStyleClass),this.zone.runOutsideAngular(()=>{this.subscriptions.add((0,g.R)(this.element,"dragover").subscribe(r=>{r.preventDefault(),r.stopPropagation(),this.clearTimeouts(),this.element.classList.add(this.dragClass)})),this.subscriptions.add((0,g.R)(this.element,"dragleave").subscribe(r=>{r.preventDefault(),r.stopPropagation(),this.timeouts.push(window.setTimeout(()=>{this.element.classList.remove(this.dragClass)},50))}))})}ngOnDestroy(){this.clearTimeouts(),this.element.classList.remove(this.dropAreaClass,this.markStyleClass,this.dragClass),super.ngOnDestroy()}onDrop(r){r.preventDefault(),r.stopPropagation(),this.clearTimeouts(),this.element.classList.remove(this.dragClass);let h=Array.from(r.dataTransfer.files);h=this.filterTypes(h,this.allowedFileTypes),h.length>0&&this.filesDropped.emit(h)}clearTimeouts(){for(const r of this.timeouts)clearTimeout(r);this.timeouts=[]}filterTypes(r,c){if(""===c)return r;const h=c.split(",").map(f=>f.toLocaleLowerCase()),I=r.filter(f=>{const t=f.name.lastIndexOf(".");if(t<=0)return!1;const T=f.name.substring(t+1).toLocaleLowerCase();return h.includes(T)});if(r.length!==I.length){const f=this.allowedFileTypes.replace(/\,/g,", ");this.snackBar.open(I.length?"Some files were filtered out. This drop location only accepts file types: "+f:"This drop location only accepts file types: "+f,null,{duration:5e3})}return I}static#t=this.\u0275fac=function(c){return new(c||p)(l.rXU(l.aKT),l.rXU(l.SKi),l.rXU(m.UG))};static#e=this.\u0275dir=l.FsC({type:p,selectors:[["","appDragAndDrop",""]],hostBindings:function(c,h){1&c&&l.bIt("drop",function(f){return h.onDrop(f)})},inputs:{markStyle:"markStyle",allowedFileTypes:"allowedFileTypes"},outputs:{filesDropped:"filesDropped"},standalone:!0,features:[l.Vt3]})}return p})()},693:(F,D,o)=>{function l(v){return new Promise((m,x)=>{const p=new FileReader;p.readAsDataURL(v),p.onload=()=>{m(p.result.split(",")[1])},p.onerror=E=>{x(E)}})}function g(v){return new Promise((m,x)=>{const p=new FileReader;p.readAsText(v),p.onload=()=>{m(p.result)},p.onerror=E=>{x(E)}})}o.d(D,{d:()=>g,n:()=>l})}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.99.00/dist/ng-edit/projects_eav-ui_src_app_content-import_content-import_component_ts.24f9e096f1295e0f.js.map