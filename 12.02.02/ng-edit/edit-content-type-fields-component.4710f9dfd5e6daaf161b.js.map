{"version":3,"sources":["./node_modules/rxjs/_esm2015/internal/operators/toArray.js","./projects/ng-dialogs/src/app/app-administration/constants/field-name.patterns.ts","./projects/ng-dialogs/src/app/content-type-fields/edit-content-type-fields/edit-content-type-fields.helpers.ts","./projects/ng-dialogs/src/app/content-type-fields/edit-content-type-fields/reserved-names.directive.ts","./projects/ng-dialogs/src/app/content-type-fields/edit-content-type-fields/edit-content-type-fields.component.html","./projects/ng-dialogs/src/app/content-type-fields/edit-content-type-fields/edit-content-type-fields.component.ts","./node_modules/rxjs/_esm2015/internal/operators/reduce.js"],"names":["toArrayReducer","arr","item","index","push","fieldNamePattern","dataTypeLabels","Boolean","label","description","Custom","DateTime","Empty","Entity","Hyperlink","Number","String","reservedNames","validate","control","Object","entries","this","errorMessage","toLocaleLowerCase","value","ReservedNamesValidatorDirective","provide","useExisting","multi","dialogRef","route","contentTypesService","contentTypesFieldsService","snackBar","hostClass","fields","filteredInputTypeOptions","dataTypeHints","inputTypeHints","fieldNameError","findIcon","loading$","BehaviorSubject","saving$","subscription","Subscription","disableClose","add","backdropClick","subscribe","event","form","dirty","confirm","closeDialog","ngOnInit","editMode","snapshot","paramMap","get","contentTypeStaticName","contentType$","retrieveContentType","pipe","share","fields$","mergeMap","contentType","getFields","dataTypes$","typeListRetrieve","map","rawDataTypes","dataTypes","rawDataType","name","icon","calculateDataTypes","inputTypes$","getInputTypesList","reservedNames$","getReservedNames","forkJoin","inputTypes","inputTypeOptions","existingFields","forEach","field","StaticName","parseInt","editField","find","Id","i","Type","InputType","StringDefault","IsTitle","length","SortOrder","calculateInputTypeOptions","calculateHints","next","ngOnDestroy","complete","unsubscribe","close","filter","option","dataType","resetInputType","defaultInputType","DefaultSuffix","some","inputType","selectedDataType","selectedInputType","inputTypeOption","save","open","rename","duration","updateInputType","of","concatMap","catchError","error","accumulator","seed","arguments","source","scan","takeLast","defaultIfEmpty","acc","reduce","responses","EditContentTypeFieldsComponent"],"mappings":"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","file":"edit-content-type-fields-component.4710f9dfd5e6daaf161b.js","sourcesContent":["import { reduce } from './reduce';\nfunction toArrayReducer(arr, item, index) {\n    if (index === 0) {\n        return [item];\n    }\n    arr.push(item);\n    return arr;\n}\nexport function toArray() {\n    return reduce(toArrayReducer, []);\n}\n//# sourceMappingURL=toArray.js.map","export const fieldNamePattern = /^[A-Za-z][A-Za-z0-9]+$/;\r\nexport const fieldNameError = 'Standard letters and numbers are allowed. Must start with a letter.';\r\n","import { calculateTypeIcon } from '../content-type-fields.helpers';\r\n\r\nconst dataTypeLabels: Record<string, { label: string, description: string }> = {\r\n  Boolean: { label: 'Boolean (yes/no)', description: 'Yes/no or true/false values' },\r\n  Custom: { label: 'Custom - ui-tools or custom types', description: 'Use for things like gps-pickers (which writes into multiple fields) or for custom-data which serializes something exotic into the db like an array, a custom json or anything' },\r\n  DateTime: { label: 'Date and/or time', description: 'For date, time or combined values' },\r\n  Empty: { label: 'Empty - for form-titles etc.', description: 'Use to structure your form' },\r\n  Entity: { label: 'Entity (other content-items)', description: 'One or more other content-items' },\r\n  Hyperlink: { label: 'Link / file reference', description: 'Hyperlink or reference to a picture / file' },\r\n  Number: { label: 'Number', description: 'Any kind of number' },\r\n  String: { label: 'Text / string', description: 'Any kind of text' },\r\n};\r\n\r\nexport interface DataType {\r\n  name: string;\r\n  label: string;\r\n  icon: string;\r\n  description: string;\r\n}\r\n\r\nexport function calculateDataTypes(rawDataTypes: string[]): DataType[] {\r\n  const dataTypes: DataType[] = [];\r\n  for (const rawDataType of rawDataTypes) {\r\n    dataTypes.push({\r\n      name: rawDataType,\r\n      label: dataTypeLabels[rawDataType].label,\r\n      icon: calculateTypeIcon(rawDataType),\r\n      description: dataTypeLabels[rawDataType].description,\r\n    });\r\n  }\r\n  return dataTypes;\r\n}\r\n","import { Directive, Input } from '@angular/core';\r\nimport { AbstractControl, NG_VALIDATORS, ValidationErrors, Validator } from '@angular/forms';\r\nimport { ReservedNames } from '../models/reserved-names.model';\r\n\r\n@Directive({\r\n  selector: '[appReservedNames]',\r\n  providers: [{ provide: NG_VALIDATORS, useExisting: ReservedNamesValidatorDirective, multi: true }],\r\n})\r\nexport class ReservedNamesValidatorDirective implements Validator {\r\n  @Input('appReservedNames') private reservedNames: ReservedNames = {};\r\n\r\n  validate(control: AbstractControl): ValidationErrors | null {\r\n    for (const [reservedName, errorMessage] of Object.entries(this.reservedNames)) {\r\n      if (reservedName.toLocaleLowerCase() !== control.value?.toLocaleLowerCase()) { continue; }\r\n\r\n      return { reservedNames: errorMessage };\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","<div mat-dialog-title>\r\n  <div class=\"dialog-title-box\">\r\n    <ng-container *ngIf=\"editMode === undefined\">Fields</ng-container>\r\n    <ng-container *ngIf=\"editMode === null\">Add Fields</ng-container>\r\n    <ng-container *ngIf=\"editMode != null\">Edit Field</ng-container>\r\n  </div>\r\n</div>\r\n\r\n<form #ngForm=\"ngForm\" class=\"dialog-form\" *ngIf=\"(loading$ | async) === false\" (ngSubmit)=\"save()\">\r\n  <div class=\"dialog-form-content fancy-scrollbar-light\">\r\n    <div class=\"row-container\" *ngFor=\"let field of fields; index as i\">\r\n      <div class=\"edit-input\">\r\n        <mat-form-field appearance=\"standard\" color=\"accent\">\r\n          <mat-label>Name</mat-label>\r\n          <input matInput [pattern]=\"fieldNamePattern\" [appReservedNames]=\"reservedNames\" [(ngModel)]=\"field.StaticName\"\r\n            [name]=\"'StaticName' + i\" #staticName=\"ngModel\" [disabled]=\"editMode === 'inputType'\">\r\n        </mat-form-field>\r\n        <ng-container *ngIf=\"staticName.touched && staticName.errors\">\r\n          <app-field-hint *ngIf=\"staticName.errors.pattern\" [isError]=\"true\">{{ fieldNameError }}</app-field-hint>\r\n          <app-field-hint *ngIf=\"staticName.errors.reservedNames\" [isError]=\"true\">\r\n            {{ staticName.errors.reservedNames }}\r\n          </app-field-hint>\r\n        </ng-container>\r\n      </div>\r\n\r\n      <div class=\"edit-input\">\r\n        <mat-form-field appearance=\"standard\" color=\"accent\">\r\n          <mat-label>Data Type</mat-label>\r\n          <mat-select (selectionChange)=\"calculateInputTypeOptions(i); resetInputType(i); calculateHints(i)\"\r\n            [(ngModel)]=\"field.Type\" [name]=\"'Type' + i\" [disabled]=\"editMode != null\">\r\n            <mat-select-trigger>\r\n              <mat-icon class=\"type-icon\">{{ findIcon(field.Type) }}</mat-icon>\r\n              <span>{{ field.Type }}</span>\r\n            </mat-select-trigger>\r\n            <mat-option *ngFor=\"let dataType of dataTypes\" [value]=\"dataType.name\">\r\n              <mat-icon>{{ dataType.icon }}</mat-icon>\r\n              <span>{{ dataType.label }}</span>\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n        <app-field-hint>{{ dataTypeHints[i] }}</app-field-hint>\r\n      </div>\r\n\r\n      <div class=\"edit-input\">\r\n        <mat-form-field appearance=\"standard\" color=\"accent\">\r\n          <mat-label>Input Type</mat-label>\r\n          <mat-select (selectionChange)=\"calculateHints(i)\" [(ngModel)]=\"field.InputType\" [name]=\"'InputType' + i\"\r\n            [disabled]=\"editMode === 'name'\">\r\n            <mat-option *ngFor=\"let option of filteredInputTypeOptions[i]\" [value]=\"option.inputType\">\r\n              {{ option.label }}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n        <app-field-hint>{{ inputTypeHints[i] }}</app-field-hint>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"dialog-form-actions\">\r\n    <button mat-raised-button type=\"button\" (click)=\"closeDialog()\">Cancel</button>\r\n    <button mat-raised-button type=\"submit\" color=\"accent\" [disabled]=\"!ngForm.form.valid || (saving$ | async)\">\r\n      Save\r\n    </button>\r\n  </div>\r\n</form>\r\n","import { Component, HostBinding, OnDestroy, OnInit, ViewChild } from '@angular/core';\r\nimport { NgForm } from '@angular/forms';\r\nimport { MatDialogRef } from '@angular/material/dialog';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { BehaviorSubject, forkJoin, of, Subscription } from 'rxjs';\r\nimport { catchError, concatMap, filter, map, mergeMap, share, toArray } from 'rxjs/operators';\r\nimport { fieldNameError, fieldNamePattern } from '../../app-administration/constants/field-name.patterns';\r\nimport { ContentType } from '../../app-administration/models/content-type.model';\r\nimport { ContentTypesService } from '../../app-administration/services/content-types.service';\r\nimport { DataTypeConstants } from '../constants/data-type.constants';\r\nimport { InputTypeConstants } from '../constants/input-type.constants';\r\nimport { calculateTypeIcon } from '../content-type-fields.helpers';\r\nimport { Field, FieldInputTypeOption } from '../models/field.model';\r\nimport { ReservedNames } from '../models/reserved-names.model';\r\nimport { ContentTypesFieldsService } from '../services/content-types-fields.service';\r\nimport { calculateDataTypes, DataType } from './edit-content-type-fields.helpers';\r\n\r\n@Component({\r\n  selector: 'app-edit-content-type-fields',\r\n  templateUrl: './edit-content-type-fields.component.html',\r\n  styleUrls: ['./edit-content-type-fields.component.scss'],\r\n})\r\nexport class EditContentTypeFieldsComponent implements OnInit, OnDestroy {\r\n  @HostBinding('className') hostClass = 'dialog-component';\r\n  @ViewChild('ngForm', { read: NgForm }) private form: NgForm;\r\n\r\n  fields: Partial<Field>[] = [];\r\n  reservedNames: ReservedNames;\r\n  editMode: 'name' | 'inputType';\r\n  dataTypes: DataType[];\r\n  filteredInputTypeOptions: FieldInputTypeOption[][] = [];\r\n  dataTypeHints: string[] = [];\r\n  inputTypeHints: string[] = [];\r\n  fieldNamePattern = fieldNamePattern;\r\n  fieldNameError = fieldNameError;\r\n  findIcon = calculateTypeIcon;\r\n  loading$ = new BehaviorSubject(true);\r\n  saving$ = new BehaviorSubject(false);\r\n\r\n  private contentType: ContentType;\r\n  private inputTypeOptions: FieldInputTypeOption[];\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private dialogRef: MatDialogRef<EditContentTypeFieldsComponent>,\r\n    private route: ActivatedRoute,\r\n    private contentTypesService: ContentTypesService,\r\n    private contentTypesFieldsService: ContentTypesFieldsService,\r\n    private snackBar: MatSnackBar,\r\n  ) {\r\n    this.dialogRef.disableClose = true;\r\n    this.subscription.add(\r\n      this.dialogRef.backdropClick().subscribe(event => {\r\n        if (this.form.dirty) {\r\n          const confirmed = confirm('You have unsaved changes. Are you sure you want to close this dialog?');\r\n          if (!confirmed) { return; }\r\n        }\r\n        this.closeDialog();\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.editMode = this.route.snapshot.paramMap.get('editMode') as 'name' | 'inputType';\r\n\r\n    const contentTypeStaticName = this.route.snapshot.paramMap.get('contentTypeStaticName');\r\n    const contentType$ = this.contentTypesService.retrieveContentType(contentTypeStaticName).pipe(share());\r\n    const fields$ = contentType$.pipe(mergeMap(contentType => this.contentTypesFieldsService.getFields(contentType)));\r\n    const dataTypes$ = this.contentTypesFieldsService.typeListRetrieve().pipe(map(rawDataTypes => calculateDataTypes(rawDataTypes)));\r\n    const inputTypes$ = this.contentTypesFieldsService.getInputTypesList();\r\n    const reservedNames$ = this.contentTypesFieldsService.getReservedNames();\r\n\r\n    forkJoin([contentType$, fields$, dataTypes$, inputTypes$, reservedNames$]).subscribe(\r\n      ([contentType, fields, dataTypes, inputTypes, reservedNames]) => {\r\n        this.contentType = contentType;\r\n        this.dataTypes = dataTypes;\r\n        this.inputTypeOptions = inputTypes;\r\n\r\n        const existingFields: ReservedNames = {};\r\n        fields.forEach(field => {\r\n          existingFields[field.StaticName] = 'Field with this name already exists';\r\n        });\r\n        this.reservedNames = {\r\n          ...reservedNames,\r\n          ...existingFields,\r\n        };\r\n\r\n        if (this.editMode != null) {\r\n          const editFieldId = this.route.snapshot.paramMap.get('id') ? parseInt(this.route.snapshot.paramMap.get('id'), 10) : null;\r\n          const editField = fields.find(field => field.Id === editFieldId);\r\n          if (this.editMode === 'name') {\r\n            delete this.reservedNames[editField.StaticName];\r\n          }\r\n          this.fields.push(editField);\r\n        } else {\r\n          for (let i = 1; i <= 8; i++) {\r\n            this.fields.push({\r\n              Id: 0,\r\n              Type: DataTypeConstants.String,\r\n              InputType: InputTypeConstants.StringDefault,\r\n              StaticName: '',\r\n              IsTitle: fields.length === 0,\r\n              SortOrder: fields.length + i,\r\n            });\r\n          }\r\n        }\r\n\r\n        for (let i = 0; i < this.fields.length; i++) {\r\n          this.calculateInputTypeOptions(i);\r\n          this.calculateHints(i);\r\n        }\r\n        this.loading$.next(false);\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.loading$.complete();\r\n    this.saving$.complete();\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  closeDialog() {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n  calculateInputTypeOptions(index: number) {\r\n    this.filteredInputTypeOptions[index] = this.inputTypeOptions\r\n      .filter(option => option.dataType === this.fields[index].Type.toLocaleLowerCase());\r\n  }\r\n\r\n  resetInputType(index: number) {\r\n    let defaultInputType = this.fields[index].Type.toLocaleLowerCase() + InputTypeConstants.DefaultSuffix;\r\n    const defaultExists = this.filteredInputTypeOptions[index].some(option => option.inputType === defaultInputType);\r\n    if (!defaultExists) {\r\n      defaultInputType = this.filteredInputTypeOptions[index][0].inputType;\r\n    }\r\n    this.fields[index].InputType = defaultInputType;\r\n  }\r\n\r\n  calculateHints(index: number) {\r\n    const selectedDataType = this.dataTypes.find(dataType => dataType.name === this.fields[index].Type);\r\n    const selectedInputType = this.inputTypeOptions.find(inputTypeOption => inputTypeOption.inputType === this.fields[index].InputType);\r\n    this.dataTypeHints[index] = selectedDataType?.description ?? '';\r\n    this.inputTypeHints[index] = selectedInputType?.description ?? '';\r\n  }\r\n\r\n  save() {\r\n    this.saving$.next(true);\r\n    this.snackBar.open('Saving...');\r\n    if (this.editMode != null) {\r\n      const field = this.fields[0];\r\n      if (this.editMode === 'name') {\r\n        this.contentTypesFieldsService.rename(field.Id, this.contentType.Id, field.StaticName).subscribe(() => {\r\n          this.saving$.next(false);\r\n          this.snackBar.open('Saved', null, { duration: 2000 });\r\n          this.closeDialog();\r\n        });\r\n      } else if (this.editMode === 'inputType') {\r\n        this.contentTypesFieldsService.updateInputType(field.Id, field.StaticName, field.InputType).subscribe(() => {\r\n          this.saving$.next(false);\r\n          this.snackBar.open('Saved', null, { duration: 2000 });\r\n          this.closeDialog();\r\n        });\r\n      }\r\n    } else {\r\n      of(...this.fields).pipe(\r\n        filter(field => !!field.StaticName),\r\n        concatMap(field =>\r\n          this.contentTypesFieldsService.add(field, this.contentType.Id).pipe(catchError(error => of(null)))\r\n        ),\r\n        toArray(),\r\n      ).subscribe(responses => {\r\n        this.saving$.next(false);\r\n        this.snackBar.open('Saved', null, { duration: 2000 });\r\n        this.closeDialog();\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { scan } from './scan';\nimport { takeLast } from './takeLast';\nimport { defaultIfEmpty } from './defaultIfEmpty';\nimport { pipe } from '../util/pipe';\nexport function reduce(accumulator, seed) {\n    if (arguments.length >= 2) {\n        return function reduceOperatorFunctionWithSeed(source) {\n            return pipe(scan(accumulator, seed), takeLast(1), defaultIfEmpty(seed))(source);\n        };\n    }\n    return function reduceOperatorFunction(source) {\n        return pipe(scan((acc, value, index) => accumulator(acc, value, index + 1)), takeLast(1))(source);\n    };\n}\n//# sourceMappingURL=reduce.js.map"],"sourceRoot":"webpack:///"}