"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_permissions_permissions_component_ts-projects_eav-ui_src_app_shared_c-582bad"],{4979:(y,p,t)=>{t.d(p,{V:()=>o});var m=t(27092),u=t(44444);let o=(()=>{class s{constructor(){this.subscriptions=new m.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static#e=this.\u0275fac=function(d){return new(d||s)};static#t=this.\u0275prov=u.jDH({token:s,factory:s.\u0275fac})}return s})()},9234:(y,p,t)=>{t.d(p,{Gg:()=>v,Tr:()=>D,gb:()=>l});var m=t(51567),u=t(36647),o=t(86301),s=t(70271),f=t(12938),r=t(34435),d=t(24467),c=t(54839),i=t(99293),a=t(44444);const n={all:!1,getEntities:!1,getAvailableEntities:!1,delete:!1},l="admin/entity/",v="admin/entity/list";let D=(()=>{class P extends d.B{constructor(){super(...arguments),this.log=(0,r.Tq)({EntityService:P},n),this.queryService=(0,f.d)(c.c)}getEntities$(E){return this.log.fnIf("getEntities"),E.pipe((0,m.p)(e=>null!=e),(0,u.n)(e=>this.getAvailableEntities(e.contentTypeName).pipe((0,o.t)(1))))}getAvailableEntities(E,e){return this.log.fnIf("getAvailableEntities"),this.queryService.getEntities({contentTypes:[E],itemIds:e,fields:"Id,Guid,Title",log:"getAvailableEntities"}).pipe((0,s.T)(T=>T.Default))}delete(E,e,M,T,I,R){return this.log.fnIf("delete",{appId:E,contentType:e,entityId:M,force:T,parentId:I,parent}),this.http.delete(this.apiUrl(l+"delete"),{params:{contentType:e,id:M.toString(),appId:E,force:T.toString(),...I&&{parentId:I.toString()},...I&&R&&{parentField:R}}})}static#e=this.\u0275fac=(()=>{let E;return function(M){return(E||(E=i.xGo(P)))(M||P)}})();static#t=this.\u0275prov=a.jDH({token:P,factory:P.\u0275fac})}return P})()},12458:(y,p,t)=>{t.r(p),t.d(p,{PermissionsComponent:()=>W});var m=t(44444),u=t(84175),o=t(81863),s=t(93840),f=t(29658),r=t(12938),d=t(13620),c=t(6663),i=t(11828),a=t(60251),n=t(50052),l=t(43216),v=t(70334),D=t(67037),P=t(60852),U=t(89061),E=t(34601),e=t(99293),M=t(29968);let T=(()=>{class O{agInit(h){this.params=h}refresh(h){return!0}deletePermission(){this.params.onDelete(this.params.data)}static#e=this.\u0275fac=function(g){return new(g||O)};static#t=this.\u0275cmp=e.VBU({type:O,selectors:[["app-permissions-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(g,_){1&g&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(){return _.deletePermission()}),e.j41(2,"mat-icon"),e.EFF(3,"delete"),e.k0s()()())},dependencies:[U.M,M.M,s.m_,s.An,E.e],encapsulation:2})}return O})();var I=t(44900),R=t(3347),B=t(88622),L=t(29841);let W=(()=>{class O{#e;#t;#s;#a;#n;constructor(h,g,_,C){this.dialog=h,this.snackBar=g,this.viewContainerRef=_,this.matDialog=C,this.gridOptions=this.buildGridOptions(),this.#e=(0,r.d)(I.K),this.#t=(0,r.d)(P.c),this.#s=(0,d.C)(this.#t.getParams(["targetType","keyType","key"]),A=>({targetType:parseInt(A.targetType,10),keyType:A.keyType,key:A.key})),this.#a=(0,m.vPA)(0),this.permissions=this.#e.getAllLive(this.#s.targetType,this.#s.keyType,this.#s.key,this.#a),this.#n={[n.YX.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.#t.doOnDialogClosed(()=>this.#a.update(h=>h+1))}closeDialog(){this.dialog.close()}editPermission(h){let g;g=null==h?{items:[{...v.c.newMetadataFromInfo(n.YX.contentTypes.permissions,v.c.constructMetadataInfo(this.#s.targetType,this.#s.keyType,this.#s.key)),...this.#n[this.#s.targetType]&&{Prefill:this.#n[this.#s.targetType]}}]}:{items:[v.c.editId(h.Id)]};const _=(0,l.s)(g);this.#t.navRelative([`edit/${_}`])}#i(h){this.matDialog.open(c.F,{autoFocus:!1,data:{entityId:h.Id,entityTitle:h.Title,message:"Delete this permission?",hasDeleteSnackbar:!0},viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(C=>{C&&this.#e.delete(h.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#a.update(A=>A+1)})})}buildGridOptions(){return{...a.C,columnDefs:[{...i.r.Id,cellRendererParams:i.r.idFieldParamsTooltipGetter()},{...i.r.TextWide,headerName:"Name",field:"Title",sort:"asc",onCellClicked:g=>{this.editPermission(g.data)}},{...i.r.TextWide,field:"Identity"},{...i.r.TextWide,field:"Condition"},{...i.r.Character,field:"Grant"},{...i.r.ActionsPinnedRight1,cellRenderer:T,cellRendererParams:{onDelete:_=>this.#i(_)}}]}}static#o=this.\u0275fac=function(g){return new(g||O)(e.rXU(o.k),e.rXU(R.UG),e.rXU(e.c1b),e.rXU(o.h))};static#r=this.\u0275cmp=e.VBU({type:O,selectors:[["app-permissions"]],decls:15,vars:2,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(g,_){1&g&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3,"Permissions"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return _.closeDialog()}),e.j41(5,"mat-icon"),e.EFF(6,"close"),e.k0s()()(),e.j41(7,"div",4),e.nrm(8,"router-outlet"),e.j41(9,"div",5),e.nrm(10,"ag-grid-angular",6),e.k0s(),e.j41(11,"mat-dialog-actions",7)(12,"button",8),e.bIt("click",function(){return _.editPermission(null)}),e.j41(13,"mat-icon"),e.EFF(14,"add"),e.k0s()()()()()),2&g&&(e.R7$(10),e.Y8G("rowData",_.permissions())("gridOptions",_.gridOptions))},dependencies:[u.Hl,B.M,u.Sr,s.m_,s.An,f.n3,o.M,D.p,L.xs],encapsulation:2})}return O})()},13620:(y,p,t)=>{function m(o,s){return s(o)}function u(o,s){return s(o)}t.d(p,{C:()=>m,z:()=>u})},43176:(y,p,t)=>{t.d(p,{$:()=>o});var m=t(27092),u=t(99293);let o=(()=>{class s{constructor(){this.subscriptions=new m.yU}ngOnDestroy(){this.subscriptions.unsubscribe()}static#e=this.\u0275fac=function(d){return new(d||s)};static#t=this.\u0275cmp=u.VBU({type:s,selectors:[["app-base-component"]],decls:0,vars:0,template:function(d,c){},encapsulation:2})}return s})()},44900:(y,p,t)=>{t.d(p,{K:()=>c});var m=t(64173),u=t(70271),o=t(12938),s=t(50052),f=t(96817),r=t(80401),d=t(44444);let c=(()=>{class i{constructor(){this.metadataService=(0,o.d)(r.T),this.entitiesService=(0,o.d)(f.R)}getAll(n,l,v){return this.metadataService.getMetadata(n,l,v,s.YX.contentTypes.permissions).pipe((0,u.T)(D=>D.Items))}getAllLive(n,l,v,D){const P=this.metadataService.getMetadataLive(D,n,l,v,s.YX.contentTypes.permissions).value;return(0,m.EW)(()=>P()?.Items??[])}delete(n){return this.entitiesService.delete(s.YX.contentTypes.permissions,n,!1)}static#e=this.\u0275fac=function(l){return new(l||i)};static#t=this.\u0275prov=d.jDH({token:i,factory:i.\u0275fac})}return i})()},54839:(y,p,t)=>{t.d(p,{c:()=>r});var m=t(34435),u=t(68873),o=t(44444),s=t(47215);const f={all:!1,getAvailableEntities:!1,getEntities:!1};let r=(()=>{class d{constructor(i,a){this.http=i,this.context=a,this.log=(0,m.Tq)({QueryService:d},f)}getFromQuery(i,a,n,l){this.log.fnIf("getAvailableEntities",{queryUrl:i,params:a,fields:n,entitiesFilter:l});const v=!!a,E=(((a?.toLocaleLowerCase()??"").includes("appid=")?"":`&appId=${this.context.appId}`)+(v?`&${a}`:"")+"&$select="+(n??"")).substring(1);return this.http.post(`app/auto/query/${i}?${E}`,{Guids:l})}getEntities({contentTypes:i,itemIds:a,fields:n,log:l}){this.log.fnIf("getEntities",{log:l,contentTypes:i,itemIds:a,fields:n});const D=("&typeNames="+(i?.join(",")??"")+`&appId=${this.context.appId}&$select=`+(n??"")).substring(1);return this.http.post(`app/auto/query/System.EntityPicker/Default?${D}`,{Guids:a})}static#e=this.\u0275fac=function(a){return new(a||d)(o.KVO(s.Qq),o.KVO(u.o))};static#t=this.\u0275prov=o.jDH({token:d,factory:d.\u0275fac})}return d})()},69914:(y,p,t)=>{t.d(p,{$:()=>o});var m=t(99293),u=t(80436);let o=(()=>{class s{constructor(r){this.sanitizer=r}transform(r){return this.sanitizer.bypassSecurityTrustHtml(r)}static#e=this.\u0275fac=function(d){return new(d||s)(m.rXU(u.up,16))};static#t=this.\u0275pipe=m.EJ8({name:"safeHtml",type:s,pure:!0})}return s})()},80401:(y,p,t)=>{t.d(p,{T:()=>f});var m=t(96474),u=t(99293),o=t(44444);const s="admin/metadata/get";let f=(()=>{class r extends m.D{getMetadata(c,i,a,n){return this.getHttpApiUrl(s,{params:{appId:this.appId,targetType:c.toString(),keyType:i,key:a.toString(),...n&&{contentType:n}}})}getMetadataLive(c,i,a,n,l){return this.newHttpResource(()=>(c(),{url:this.apiUrl(s),params:{appId:this.appId,targetType:i.toString(),keyType:a,key:n.toString(),...l&&{contentType:l}}}))}getMetadataPromise(c,i,a,n){return this.fetchPromise(s,{params:{appId:this.appId,targetType:c.toString(),keyType:i,key:a.toString(),...n&&{contentType:n}}})}static#e=this.\u0275fac=(()=>{let c;return function(a){return(c||(c=u.xGo(r)))(a||r)}})();static#t=this.\u0275prov=o.jDH({token:r,factory:r.\u0275fac})}return r})()},96817:(y,p,t)=>{t.d(p,{R:()=>d});var m=t(47215),u=t(85837),o=t(9234),s=t(24467),f=t(99293),r=t(44444);let d=(()=>{class c extends s.B{create(a,n){return this.http.post(`app/auto/data/${a}`,n,{params:{appId:this.appId,zoneId:this.zoneId}})}update(a,n,l){return this.http.post(`app/auto/data/${a}/${n}`,l,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(a,n,l){return this.http.delete(this.apiUrl(o.gb+"delete"),{params:{contentType:a,id:n.toString(),appId:this.appId,force:l.toString()},context:(new m._y).set(u.g,[400])})}static#e=this.\u0275fac=(()=>{let a;return function(l){return(a||(a=f.xGo(c)))(l||c)}})();static#t=this.\u0275prov=r.jDH({token:c,factory:c.\u0275fac})}return c})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.05/dist/ng-edit/projects_eav-ui_src_app_permissions_permissions_component_ts-projects_eav-ui_src_app_shared_c-582bad.b8f2d2aa63afb51f.js.map