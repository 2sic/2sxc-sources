"use strict";(self.webpackChunkng_dialogs=self.webpackChunkng_dialogs||[]).push([["projects_ng-dialogs_src_app_content-type-fields_content-type-fields_component_ts"],{5114:(me,v,l)=>{l.r(v),l.d(v,{ContentTypeFieldsComponent:()=>ce});var Z=l(1276),T=l(2977),F=l(6317),x=l(7714),w=l(745),R=l(1640),_=l(116),b=l(4874),S=l(635),N=l(679),D=l(5005),O=l(9230),E=l(7297),$=l(9119),I=l(1825),M=l(5137),J=l(9702),m=l(1226),e=l(3184),u=l(6362),h=l(1130),f=l(785),g=l(5590),U=l(178),y=l(2796);function k(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().openMetadata()}),e.TgZ(1,"mat-icon",9),e._uU(2," local_offer "),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.metadataCount)("matBadgeHidden",!t.metadataCount)}}function Q(i,s){if(1&i&&(e.TgZ(0,"div",10)(1,"mat-icon",11),e._uU(2," local_offer "),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.metadataCount)("matBadgeHidden",!t.metadataCount)}}function B(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",12),e.NdJ("click",function(){return e.CHM(t),e.oxw().openPermissions()}),e.TgZ(1,"mat-icon",9),e._uU(2," person "),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.field.Permissions.Count)("matBadgeHidden",!t.field.Permissions.Count)}}function Y(i,s){if(1&i&&(e.TgZ(0,"div",10)(1,"mat-icon",11),e._uU(2," person "),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("matBadge",t.field.Permissions.Count)("matBadgeHidden",!t.field.Permissions.Count)}}let H=(()=>{class i{constructor(){}agInit(t){this.params=t,this.field=this.params.data,this.metadataCount=this.field.Metadata?Object.keys(this.field.Metadata).filter(n=>"merged"!==n).length:0,this.enablePermissions=this.field.InputType===m.v.StringWysiwyg||this.field.Type===J.Q.Hyperlink}refresh(t){return!0}openMetadata(){this.params.onOpenMetadata(this.field)}rename(){this.params.onRename(this.field)}openPermissions(){this.params.onOpenPermissions(this.field)}deleteField(){this.params.onDelete(this.field)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-actions"]],decls:20,vars:7,consts:[[1,"actions-component"],["class","like-button highlight","matRipple","","tippy","Metadata",3,"click",4,"ngIf"],["class","like-button disabled",4,"ngIf"],["class","like-button highlight","matRipple","","tippy","Permissions",3,"click",4,"ngIf"],["matRipple","","tippy","More",1,"like-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["menu","matMenu"],["mat-menu-item","",3,"disabled","click"],["matRipple","","tippy","Metadata",1,"like-button","highlight",3,"click"],["matBadgeColor","accent","matBadgeSize","small",3,"matBadge","matBadgeHidden"],[1,"like-button","disabled"],["matBadgeColor","accent","matBadgeSize","small","matBadgeDisabled","true",3,"matBadge","matBadgeHidden"],["matRipple","","tippy","Permissions",1,"like-button","highlight",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,k,3,2,"div",1),e.YNc(2,Q,3,2,"div",2),e.YNc(3,B,3,2,"div",3),e.YNc(4,Y,3,2,"div",2),e.TgZ(5,"div",4)(6,"mat-icon"),e._uU(7,"more_horiz"),e.qZA()()(),e.TgZ(8,"mat-menu",5,6)(10,"button",7),e.NdJ("click",function(){return n.rename()}),e.TgZ(11,"mat-icon"),e._uU(12,"text_fields"),e.qZA(),e.TgZ(13,"span"),e._uU(14,"Rename"),e.qZA()(),e.TgZ(15,"button",7),e.NdJ("click",function(){return n.deleteField()}),e.TgZ(16,"mat-icon"),e._uU(17,"delete"),e.qZA(),e.TgZ(18,"span"),e._uU(19,"Delete"),e.qZA()()()),2&t){const a=e.MAs(9);e.xp6(1),e.Q6J("ngIf",!n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",!n.field.EditInfo.ReadOnly&&n.enablePermissions),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly||!n.enablePermissions),e.xp6(1),e.Q6J("matMenuTriggerFor",a),e.xp6(5),e.Q6J("disabled",n.field.EditInfo.ReadOnly),e.xp6(5),e.Q6J("disabled",n.field.EditInfo.ReadOnly||n.field.IsTitle)}},directives:[u.O5,h.wG,f.$,g.Hw,U.k,y.p6,y.VK,y.OP],styles:[""]}),i})();function P(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().changeInputType()}),e.TgZ(1,"div",3),e._uU(2),e.qZA(),e.TgZ(3,"div",4)(4,"mat-icon"),e._uU(5,"arrow_drop_down"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.value)}}function G(i,s){if(1&i&&(e.TgZ(0,"div",5)(1,"div",6),e._uU(2),e.qZA(),e.TgZ(3,"div",7)(4,"mat-icon"),e._uU(5,"arrow_drop_down"),e.qZA()()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.value)}}let j=(()=>{class i{agInit(t){this.params=t,this.value=t.value,this.field=t.data}refresh(t){return!0}changeInputType(){this.params.onChangeInputType(this.field)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-input-type"]],decls:2,vars:2,consts:[["matRipple","","class","input-component highlight",3,"click",4,"ngIf"],["class","input-component disabled",4,"ngIf"],["matRipple","",1,"input-component","highlight",3,"click"],[1,"text"],[1,"like-button"],[1,"input-component","disabled"],[1,"text","disabled"],[1,"like-button","disabled"]],template:function(t,n){1&t&&(e.YNc(0,P,6,1,"div",0),e.YNc(1,G,6,1,"div",1)),2&t&&(e.Q6J("ngIf",!n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly))},directives:[u.O5,h.wG,g.Hw],styles:[""]}),i})();function X(i,s){1&i&&(e.TgZ(0,"mat-icon",3),e._uU(1,"functions"),e.qZA())}function L(i,s){1&i&&(e.TgZ(0,"mat-icon",4),e._uU(1,"mobiledata_off"),e.qZA())}let W=(()=>{class i{agInit(t){const n=t.data;this.hasFormulas=n.HasFormulas,this.isEphemeral=n.IsEphemeral}refresh(t){return!0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-special"]],decls:3,vars:2,consts:[[1,"icon-container"],["tippy","Has Formulas",4,"ngIf"],["tippy","Ephemeral / Temporary, won't save",4,"ngIf"],["tippy","Has Formulas"],["tippy","Ephemeral / Temporary, won't save"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,X,2,0,"mat-icon",1),e.YNc(2,L,2,0,"mat-icon",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.hasFormulas),e.xp6(1),e.Q6J("ngIf",n.isEphemeral))},directives:[u.O5,g.Hw,f.$],styles:[""]}),i})();function z(i,s){1&i&&e._UZ(0,"mat-icon",6)}function V(i,s){1&i&&(e.TgZ(0,"mat-icon"),e._uU(1,"star_outline"),e.qZA())}function K(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",3),e.NdJ("click",function(){return e.CHM(t),e.oxw().setTitle()}),e.YNc(1,z,1,0,"mat-icon",4),e.YNc(2,V,2,0,"mat-icon",5),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isTitle),e.xp6(1),e.Q6J("ngIf",!t.isTitle)}}function q(i,s){1&i&&e._UZ(0,"mat-icon",6)}function ee(i,s){1&i&&(e.TgZ(0,"mat-icon"),e._uU(1,"star_outline"),e.qZA())}function te(i,s){if(1&i&&(e.TgZ(0,"div",7),e.YNc(1,q,1,0,"mat-icon",4),e.YNc(2,ee,2,0,"mat-icon",5),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isTitle),e.xp6(1),e.Q6J("ngIf",!t.isTitle)}}let ne=(()=>{class i{agInit(t){this.params=t,this.isTitle=t.value,this.field=t.data}refresh(t){return!0}setTitle(){this.params.onSetTitle(this.field)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-title"]],decls:3,vars:2,consts:[[1,"actions-component"],["class","like-button highlight","matRipple","","tippy","Use as title field",3,"click",4,"ngIf"],["class","like-button disabled",4,"ngIf"],["matRipple","","tippy","Use as title field",1,"like-button","highlight",3,"click"],["svgIcon","star",4,"ngIf"],[4,"ngIf"],["svgIcon","star"],[1,"like-button","disabled"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,K,3,2,"div",1),e.YNc(2,te,3,2,"div",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",!n.field.EditInfo.ReadOnly),e.xp6(1),e.Q6J("ngIf",n.field.EditInfo.ReadOnly))},directives:[u.O5,h.wG,f.$,g.Hw],styles:[""]}),i})();var ie=l(6565);let oe=(()=>{class i{agInit(t){this.value=t.value,this.icon=(0,ie.x)(this.value)}refresh(t){return!0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields-type"]],decls:3,vars:2,consts:[[1,"icon-container",3,"tippy"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"mat-icon"),e._uU(2),e.qZA()()),2&t&&(e.Q6J("tippy",n.value),e.xp6(2),e.Oqu(n.icon))},directives:[f.$,g.Hw],styles:[""]}),i})();var se=l(4722),A=l(5758),ae=l(2528),le=l(7317),pe=l(1350);function re(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=s.ngIf;e.xp6(1),e.hij(" ",t.Label||t.Name," ")}}const de=function(i,s){return{"grid-sorted":i,"grid-filtered":s}};let ce=(()=>{class i{constructor(t,n,a,p,c,C){this.dialogRef=t,this.route=n,this.router=a,this.contentTypesService=p,this.contentTypesFieldsService=c,this.snackBar=C,this.contentType$=new F.X(null),this.fields$=new F.X(null),this.modules=Z.F$,this.gridOptions=Object.assign(Object.assign({},$.f),{getRowClass(o){const d=o.data,r=[];return d.EditInfo.ReadOnly&&r.push("disable-row-drag"),d.InputType===m.v.EmptyDefault&&r.push("group-start-row"),d.InputType===m.v.EmptyEnd&&r.push("group-end-row"),r.join(" ")},frameworkComponents:{contentTypeFieldsTitleComponent:ne,contentTypeFieldsTypeComponent:oe,contentTypeFieldsInputTypeComponent:j,contentTypeFieldsSpecialComponent:W,contentTypeFieldsActionsComponent:H},columnDefs:[{rowDrag:!0,width:18,cellClass:"no-select no-padding no-outline"},{field:"Title",width:42,cellClass:"secondary-action no-padding no-outline",cellRenderer:"contentTypeFieldsTitleComponent",valueGetter:o=>o.data.IsTitle,cellRendererParams:{onSetTitle:o=>this.setTitle(o)}},{field:"Name",flex:2,minWidth:250,cellClass:"primary-action highlight",sortable:!0,filter:"agTextColumnFilter",onCellClicked:o=>this.editFieldMetadata(o.data),cellRenderer:o=>this.nameCellRenderer(o),valueGetter:o=>o.data.StaticName},{field:"Type",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",cellRenderer:"contentTypeFieldsTypeComponent",valueGetter:o=>o.data.Type},{headerName:"Input",field:"InputType",width:160,cellClass:o=>o.data.EditInfo.ReadOnly?"no-outline no-padding":"secondary-action no-padding",sortable:!0,filter:"agTextColumnFilter",cellRenderer:"contentTypeFieldsInputTypeComponent",valueGetter:o=>this.inputTypeValueGetter(o.data),cellRendererParams:{onChangeInputType:o=>this.changeInputType(o)}},{field:"Label",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:o=>{var d,r;return null===(r=null===(d=o.data.Metadata)||void 0===d?void 0:d.All)||void 0===r?void 0:r.Name}},{field:"Special",width:66,headerClass:"dense",cellClass:"no-outline",cellRenderer:"contentTypeFieldsSpecialComponent"},{field:"Notes",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:o=>{var d,r;return null===(r=null===(d=o.data.Metadata)||void 0===d?void 0:d.All)||void 0===r?void 0:r.Notes}},{width:122,cellClass:"secondary-action no-padding",cellRenderer:"contentTypeFieldsActionsComponent",pinned:"right",cellRendererParams:{onRename:o=>this.rename(o),onDelete:o=>this.delete(o),onOpenPermissions:o=>this.openPermissions(o),onOpenMetadata:o=>this.openMetadata(o)}}]}),this.sortApplied=!1,this.filterApplied=!1,this.rowDragSuppressed=!1,this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName"),this.subscription=new x.w0}ngOnInit(){this.fetchFields(),this.refreshOnChildClosed()}ngOnDestroy(){this.contentType$.complete(),this.fields$.complete(),this.subscription.unsubscribe()}closeDialog(){this.dialogRef.close()}onGridReady(t){this.gridApi=t.api,this.columnApi=t.columnApi}onRowDragEnter(t){this.gridApi.setEnableCellTextSelection(!1)}onRowDragEnd(t){this.gridApi.setSuppressRowDrag(!0);const n=this.fields$.value.map(a=>a.Id);this.contentTypesFieldsService.reOrder(n,this.contentType$.value).subscribe(a=>{this.fetchFields(()=>{this.gridApi.setEnableCellTextSelection(!0),this.gridApi.setSuppressRowDrag(!1)})})}onRowDragMove(t){const n=t.node,a=t.overNode;if(a&&n!==a){const C=a.data,o=[...this.fields$.value],d=o.indexOf(n.data),r=o.indexOf(C);this.moveInArray(o,d,r),this.fields$.next(o),this.gridApi.clearFocusedCell()}}moveInArray(t,n,a){const p=t[n];t.splice(n,1),t.splice(a,0,p)}onSortChanged(t){const n=this.columnApi.getColumnState();this.sortApplied=n.some(a=>null!=a.sort),this.suppressRowDrag()}onFilterChanged(t){const n=this.gridApi.getFilterModel(),a=Object.keys(n);this.filterApplied=a.length>0,this.suppressRowDrag()}suppressRowDrag(){const t=this.sortApplied||this.filterApplied;t&&!this.rowDragSuppressed?(this.rowDragSuppressed=!0,this.gridApi.setSuppressRowDrag(!0)):!t&&this.rowDragSuppressed&&(this.rowDragSuppressed=!1,this.gridApi.setSuppressRowDrag(!1))}add(){this.router.navigate([`add/${this.contentTypeStaticName}`],{relativeTo:this.route})}nameCellRenderer(t){const n=t.data;if([m.v.EmptyDefault,m.v.EmptyEnd].includes(n.InputType))return t.value;let p=!1;for(const c of this.fields$.value)if(c.InputType!==m.v.EmptyDefault)if(c.InputType!==m.v.EmptyEnd){if(c.StaticName===n.StaticName)break}else p=!1;else p=!0;return p?`<span class="is-in-group">${t.value}</span>`:t.value}inputTypeValueGetter(t){return t.InputType.substring(t.InputType.indexOf("-")+1)}fetchFields(t){const n=null==this.contentType$.value?this.contentTypesService.retrieveContentType(this.contentTypeStaticName):(0,w.of)(this.contentType$.value),a=this.contentTypesFieldsService.getFields(this.contentTypeStaticName);(0,R.D)([n,a]).subscribe(([p,c])=>{this.contentType$.next(p),this.fields$.next(c),null!=t&&t()})}editFieldMetadata(t){const n={items:[this.createItemDefinition(t,"All"),this.createItemDefinition(t,t.Type),this.createItemDefinition(t,t.InputType)]},a=(0,M.f)(n);this.router.navigate([`edit/${a}`],{relativeTo:this.route})}createItemDefinition(t,n){return null!=t.Metadata[n]?{EntityId:t.Metadata[n].Id}:{ContentTypeName:"@"+n,For:{Target:I.Z.metadata.attribute.target,TargetType:I.Z.metadata.attribute.targetType,Number:t.Id},Prefill:{Name:t.StaticName}}}setTitle(t){this.snackBar.open("Setting title..."),this.contentTypesFieldsService.setTitle(t,this.contentType$.value).subscribe(()=>{this.snackBar.open("Title set",null,{duration:2e3}),this.fetchFields()})}changeInputType(t){this.router.navigate([`update/${this.contentTypeStaticName}/${t.Id}/inputType`],{relativeTo:this.route})}rename(t){this.router.navigate([`update/${this.contentTypeStaticName}/${t.Id}/name`],{relativeTo:this.route})}delete(t){!confirm(`Are you sure you want to delete '${t.StaticName}' (${t.Id})?`)||(this.snackBar.open("Deleting..."),this.contentTypesFieldsService.delete(t,this.contentType$.value).subscribe(n=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchFields()}))}openPermissions(t){this.router.navigate([E.i.getUrlAttribute(t.Id)],{relativeTo:this.route})}openMetadata(t){const n=O.U.getUrlAttribute(t.Id,`Metadata for Field: ${t.StaticName} (${t.Id})`);this.router.navigate([n],{relativeTo:this.route})}refreshOnChildClosed(){this.subscription.add(this.router.events.pipe((0,_.h)(t=>t instanceof T.m2),(0,b.O)(!!this.route.snapshot.firstChild),(0,S.U)(()=>!!this.route.snapshot.firstChild),(0,N.G)(),(0,_.h)(([t,n])=>t&&!n)).subscribe(()=>{this.fetchFields()}))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A.so),e.Y36(T.gz),e.Y36(T.F0),e.Y36(D.s),e.Y36(se.Mr),e.Y36(ae.ux))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-content-type-fields"]],decls:20,vars:17,consts:[[1,"nav-component-wrapper"],["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","modules","gridOptions","ngClass","rowDragEnter","rowDragEnd","rowDragMove","gridReady","sortChanged","filterChanged"],[1,"grid-more-actions-box"],["mat-fab","","mat-elevation-z24","","tippy","Add fields",1,"grid-fab",3,"disabled","click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),e.YNc(4,re,2,1,"ng-container",3),e.ALo(5,"async"),e._uU(6," Fields "),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return n.closeDialog()}),e.TgZ(8,"mat-icon"),e._uU(9,"close"),e.qZA()()()(),e._UZ(10,"router-outlet"),e.TgZ(11,"div",5)(12,"ag-grid-angular",6),e.NdJ("rowDragEnter",function(p){return n.onRowDragEnter(p)})("rowDragEnd",function(p){return n.onRowDragEnd(p)})("rowDragMove",function(p){return n.onRowDragMove(p)})("gridReady",function(p){return n.onGridReady(p)})("sortChanged",function(p){return n.onSortChanged(p)})("filterChanged",function(p){return n.onFilterChanged(p)}),e.ALo(13,"async"),e.qZA(),e._UZ(14,"div",7),e.TgZ(15,"button",8),e.NdJ("click",function(){return n.add()}),e.ALo(16,"async"),e.ALo(17,"async"),e.TgZ(18,"mat-icon"),e._uU(19,"add"),e.qZA()()()()),2&t&&(e.xp6(4),e.Q6J("ngIf",e.lcZ(5,6,n.contentType$)),e.xp6(8),e.Q6J("rowData",e.lcZ(13,8,n.fields$))("modules",n.modules)("gridOptions",n.gridOptions)("ngClass",e.WLB(14,de,n.sortApplied,n.filterApplied)),e.xp6(3),e.Q6J("disabled",null==e.lcZ(16,10,n.contentType$)||e.lcZ(17,12,n.contentType$).EditInfo.ReadOnly))},directives:[A.uh,u.O5,le.lW,f.$,g.Hw,T.lC,pe.N8,u.mk],pipes:[u.Ov],styles:[""]}),i})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.04.00/ng-edit/projects_ng-dialogs_src_app_content-type-fields_content-type-fields_component_ts.11fdfd36e1cabc3a.js.map