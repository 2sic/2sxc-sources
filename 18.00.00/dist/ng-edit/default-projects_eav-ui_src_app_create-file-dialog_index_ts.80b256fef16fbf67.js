"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_index_ts"],{9996:(k,w,o)=>{o.d(w,{F:()=>O});var r=o(271),M=o(8873),a=o(8559),_=o(6443),x=o(4821);const E="admin/AppFiles/asset";let O=(()=>{class C{constructor(l,s,p){this.http=l,this.context=s,this.dnnContext=p}get(l,s,p){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(E),{params:{appId:this.context.appId,global:s,...this.templateIdOrPath(l,s,p)}}).pipe((0,r.T)(v=>{if("auto"===v.Type.toLocaleLowerCase())switch(v.Extension.toLocaleLowerCase()){case".cs":case".cshtml":v.Type="Razor";break;case".html":case".css":case".js":v.Type="Token"}return v}))}save(l,s,p,v){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(E),p,{params:{appId:this.context.appId,global:s,...this.templateIdOrPath(l,s,v)}})}getAll(l){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.context.appId,...l&&{mask:l}}}).pipe((0,r.T)(({Files:s})=>(s.forEach(p=>{p.Shared??=!1}),s)))}getWebApis(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/AppApiFiles"),{params:{appId:this.context.appId}}).pipe((0,r.T)(({files:l})=>(l.forEach(s=>{s.isShared??=!1,s.isCompiled??=!1}),l))).pipe((0,r.T)(l=>l.map(p=>{const v=p.path.lastIndexOf("/"),y=p.path.lastIndexOf("."),N=p.path.substring(0,v),S=p.path.substring(v+1,y);return{path:p.path,folder:N,name:S,isShared:p.isShared,endpointPath:p.endpointPath,isCompiled:p.isCompiled,edition:p.edition}})))}getWebApiDetails(l){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:l}})}getPredefinedTemplates(l,s){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:{...l&&{purpose:l},...s&&{type:s}}})}getPreview(l,s,p){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:l,templateKey:p,global:s}})}create(l,s,p){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:s,purpose:"auto",path:l,templateKey:p}})}templateIdOrPath(l,s,p){if(/^[0-9]*$/g.test(l)){const v=p.find(y=>y.EntityId?.toString()===l&&y.IsShared===s)?.Path;return{templateId:l,...null!=v&&{path:v}}}return{path:l}}static#t=this.\u0275fac=function(s){return new(s||C)(a.KVO(_.Qq),a.KVO(M.o),a.KVO(x.ob))};static#e=this.\u0275prov=a.jDH({token:C,factory:C.\u0275fac})}return C})()},3556:(k,w,o)=>{o.d(w,{g:()=>at});var r=o(4456),M=o(7941),a=o(5797),_=o(9999),x=o(3037),F=o(1817),E=o(271),T=o(8764),$=o(8473),j=o(819),b=o(1687),h=o(2645),C=o(4876);var l=o(6647),s=o(9452),p=o(1873),v=o(9996),y=o(2454),N=o(3176),S=o(316),K=o(4175),B=o(1134),U=o(7984),z=o(5060),L=o(5175),G=o(5944),H=o(3758),t=o(8559);let W=(()=>{class i{constructor(e,n){this.matInput=e,this.elementRef=n,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const n=e.toLocaleLowerCase();return"true"===n||"false"!==n&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(n){return new(n||i)(t.rXU(U.fg),t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:i,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"},standalone:!0})}return i})();const X=i=>({disabled:i});function Z(i,f){if(1&i&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&i){const e=f.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function J(i,f){if(1&i&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&i){const e=f.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}function Q(i,f){if(1&i&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&i){const e=f.$implicit;t.Y8G("value",e.Key),t.R7$(),t.SpI(" ",e.Name," ")}}function q(i,f){1&i&&(t.j41(0,"app-field-hint",16),t.EFF(1," This field is required "),t.k0s()),2&i&&t.Y8G("isError",!0)}function tt(i,f){1&i&&t.nrm(0,"mat-spinner",21)(1,"div",22)}function et(i,f){if(1&i&&(t.j41(0,"div",23)(1,"label",24),t.EFF(2,"Preview"),t.k0s()(),t.j41(3,"pre",25),t.EFF(4),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(3,X,e.loadingPreview)),t.R7$(2),t.Y8G("ngClass",t.eq3(5,X,e.loadingPreview)),t.R7$(),t.JRh(e.preview)}}function nt(i,f){if(1&i&&(t.j41(0,"div",20),t.EFF(1),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.SpI(" ",e.previewError," ")}}function ot(i,f){if(1&i){const e=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),t.EFF(4,"Create"),t.k0s(),t.j41(5,"span",3),t.EFF(6),t.k0s()()(),t.j41(7,"div",4)(8,"form",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"mat-form-field",9)(13,"mat-label"),t.EFF(14,"Platform"),t.k0s(),t.j41(15,"mat-select",10),t.Z7z(16,Z,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),t.EFF(21,"Purpose"),t.k0s(),t.j41(22,"mat-select",12),t.Z7z(23,J,2,2,"mat-option",11,t.fX1),t.k0s()()()(),t.j41(25,"div",13)(26,"mat-form-field",9)(27,"mat-label"),t.EFF(28,"Template"),t.k0s(),t.j41(29,"mat-select",14),t.Z7z(30,Q,2,2,"mat-option",11,t.fX1),t.k0s()()(),t.j41(32,"div",13)(33,"mat-form-field",9)(34,"mat-label"),t.EFF(35,"Name"),t.k0s(),t.nrm(36,"input",15),t.k0s(),t.DNE(37,q,2,1,"app-field-hint",16),t.k0s()(),t.j41(38,"div",17),t.DNE(39,tt,2,0),t.j41(40,"button",18),t.bIt("click",function(){t.eBV(e);const u=t.XpG();return t.Njj(u.closeDialog())}),t.EFF(41,"Cancel"),t.k0s(),t.j41(42,"button",19),t.bIt("click",function(){t.eBV(e);const u=t.XpG();return t.Njj(u.confirm())}),t.EFF(43," Create "),t.k0s()(),t.DNE(44,et,5,7)(45,nt,2,1,"div",20),t.k0s()()()}if(2&i){const e=f,n=t.XpG();t.R7$(6),t.JRh(n.controls.finalName.value||(n.controls.folder.value?n.controls.folder.value.trim()+"/":"")),t.R7$(2),t.Y8G("formGroup",n.form),t.R7$(8),t.Dyx(e.platforms),t.R7$(7),t.Dyx(e.purposes),t.R7$(7),t.Dyx(e.templates),t.R7$(7),t.vxM(37,n.controls.name.touched&&null!=n.controls.name.errors&&n.controls.name.errors.required?37:-1),t.R7$(2),t.vxM(39,e.loadingPreview?39:-1),t.R7$(3),t.Y8G("disabled",!n.form.valid||e.loadingPreview||!e.previewValid),t.R7$(2),t.vxM(44,e.preview?44:-1),t.R7$(),t.vxM(45,!e.loadingPreview&&e.previewError?45:-1)}}let at=(()=>{class i extends N.${constructor(e,n,u){super(),this.dialogData=e,this.dialogRef=n,this.sourceService=u,this.hostClass="dialog-component",this.all="All"}ngOnInit(){this.templates$=new a.t([]),this.loadingPreview$=new a.t(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new r.J3({platform:new r.hs(this.all),purpose:new r.hs({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new r.hs(null,r.k0.required),name:new r.hs(this.dialogData.name??null,r.k0.required),finalName:new r.hs({value:null,disabled:!0}),folder:new r.hs({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscriptions.add((0,_.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,x.Z)(this.controls.templateKey.value),(0,F.F)())]).subscribe(([e,n])=>{const u=e.find(d=>d.Key===n),g=this.dialogData.name?this.controls.name.value||this.dialogData.name:u?.SuggestedFileName??null;this.controls.name.value!==g&&this.controls.name.patchValue(g)})),this.subscriptions.add((0,_.z)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,x.Z)(this.controls.templateKey.value),(0,F.F)()),this.controls.name.valueChanges.pipe((0,x.Z)(this.controls.name.value),(0,F.F)()),this.controls.folder.valueChanges.pipe((0,x.Z)(this.controls.folder.value),(0,F.F)())]).subscribe(([e,n,u,g])=>{const d=e.find(m=>m.Key===n);let c=null;u&&(g=g.trim(),u=y.SX.sanitizePath(u.trim()),c=`${g?`${g}/`:""}${u=`${d?.Prefix??""}${u}${d?.Suffix??""}${d?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==c&&this.controls.finalName.patchValue(c)}))}buildViewModel(){const e=this.templates$.pipe((0,E.T)(d=>{const c={[this.all]:this.all};return d.forEach(m=>{m.Platforms?.forEach(P=>{c[P]=P})}),Object.keys(c)})),n=this.templates$.pipe((0,E.T)(d=>{const c={[this.all]:this.all};return d.forEach(m=>{c[m.Purpose]=m.Purpose}),Object.keys(c)})),u=(0,_.z)([this.templates$,this.controls.platform.valueChanges.pipe((0,x.Z)(this.controls.platform.value),(0,F.F)()),this.controls.purpose.valueChanges.pipe((0,x.Z)(this.controls.purpose.value),(0,F.F)())]).pipe((0,E.T)(([d,c,m])=>d.filter(R=>(c===this.all||(R.Platforms?.includes(c)??!1))&&(m===this.all||R.Purpose===m))),(0,T.M)(d=>{if(!d.some(c=>c.Key===this.controls.templateKey.value)){const c=d[0]?.Key??null;this.controls.templateKey.value!==c&&this.controls.templateKey.patchValue(c)}})),g=(0,_.z)([this.controls.finalName.valueChanges.pipe((0,x.Z)(this.controls.finalName.value),(0,F.F)()),this.controls.templateKey.valueChanges.pipe((0,x.Z)(this.controls.templateKey.value),(0,F.F)())]).pipe(function I(i,f=$.E,e){const n=(0,C.O)(i,f);return function O(i,f){return(0,j.N)((e,n)=>{const{leading:u=!0,trailing:g=!1}=f??{};let d=!1,c=null,m=null,P=!1;const R=()=>{m?.unsubscribe(),m=null,g&&(Y(),P&&n.complete())},A=()=>{m=null,P&&n.complete()},V=D=>m=(0,h.Tg)(i(D)).subscribe((0,b._)(n,R,A)),Y=()=>{if(d){d=!1;const D=c;c=null,n.next(D),!P&&V(D)}};e.subscribe((0,b._)(n,D=>{d=!0,c=D,(!m||m.closed)&&(u?Y():V(D))},()=>{P=!0,(!(g&&d&&m)||m.closed)&&n.complete()}))})}(()=>n,e)}(100,$.E,{leading:!0,trailing:!0}),(0,T.M)(()=>{this.loadingPreview$.next(!0)}),(0,l.n)(([d,c])=>d&&c?(0,p.p)([this.sourceService.getPreview(d,this.dialogData.global,c),(0,C.O)(500)]).pipe((0,E.T)(([m])=>m)):(0,s.of)(void 0)),(0,T.M)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,_.z)([e,n,u,g,this.loadingPreview$]).pipe((0,E.T)(([d,c,m,P,R])=>({platforms:d,purposes:c,templates:m,loadingPreview:R,preview:P?.Preview,previewValid:P?.IsValid??!1,previewError:P?.Error})))}static#t=this.\u0275fac=function(n){return new(n||i)(t.rXU(M.Vh),t.rXU(M.CP),t.rXU(v.F))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(n,u){2&n&&t.Mr5("className",u.hostClass)},standalone:!0,features:[t.Jv_([v.F]),t.Vt3,t.aNF],decls:2,vars:3,consts:[[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-mat-form-field"],["formControlName","platform"],[3,"value"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click","disabled"],[1,"eav-preview-error"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"]],template:function(n,u){if(1&n&&(t.DNE(0,ot,46,7,"div",0),t.nI1(1,"async")),2&n){let g;t.vxM(0,(g=t.bMT(1,1,u.viewModel$))?0:-1,g)}},dependencies:[r.YN,r.qT,r.me,r.BC,r.cb,r.YS,r.X1,r.j4,r.JD,G.RG,G.rl,G.nJ,L.Ve,L.VO,z.wT,z.Sy,U.fS,U.fg,B.D6,B.LG,K.Hl,K.$z,S.YU,S.Jj,H.F,W],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}return i})()},3758:(k,w,o)=>{o.d(w,{F:()=>b});var r=o(316),M=o(5944),a=o(8559);const _=["*"],x=h=>({"hint-box__short":h});function F(h,O){1&h&&a.eu8(0)}function E(h,O){if(1&h&&(a.j41(0,"mat-hint"),a.DNE(1,F,1,0,"ng-container",2),a.k0s()),2&h){a.XpG();const C=a.sdS(4);a.R7$(),a.Y8G("ngTemplateOutlet",C)}}function T(h,O){1&h&&a.eu8(0)}function $(h,O){if(1&h&&(a.j41(0,"mat-error"),a.DNE(1,T,1,0,"ng-container",2),a.k0s()),2&h){a.XpG();const C=a.sdS(4);a.R7$(),a.Y8G("ngTemplateOutlet",C)}}function j(h,O){1&h&&a.SdG(0)}let b=(()=>{class h{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(I){return new(I||h)};static#e=this.\u0275cmp=a.VBU({type:h,selectors:[["app-field-hint"]],inputs:{isError:"isError"},standalone:!0,features:[a.aNF],ngContentSelectors:_,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(I,l){if(1&I){const s=a.RV6();a.NAR(),a.j41(0,"div",1),a.bIt("click",function(){return a.eBV(s),a.Njj(l.toggleIsShort())}),a.DNE(1,E,2,1)(2,$,2,1),a.k0s(),a.DNE(3,j,1,0,"ng-template",null,0,a.C5r)}if(2&I){let s;a.Y8G("ngClass",a.eq3(2,x,l.isShort)),a.R7$(),a.vxM(1,!1===(s=l.isError)?1:!0===s?2:-1)}},dependencies:[M.RG,M.MV,M.TL,r.YU,r.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return h})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/18.00.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_index_ts.80b256fef16fbf67.js.map