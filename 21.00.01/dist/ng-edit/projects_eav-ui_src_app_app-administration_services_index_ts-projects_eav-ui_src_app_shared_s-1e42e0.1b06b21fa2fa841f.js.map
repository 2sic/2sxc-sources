{"version":3,"file":"projects_eav-ui_src_app_app-administration_services_index_ts-projects_eav-ui_src_app_shared_s-1e42e0.1b06b21fa2fa841f.js","mappings":"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","names":["ExportAppService","HttpServiceBaseSignal","getAppInfo","httpResource","url","this","apiUrl","params","appid","appId","zoneId","exportAppUrl","webApiAppRoot","exportForVersionControl","_x","_this","_asyncToGenerator","includeContentGroups","resetAppGuid","withFiles","getStatusPromise","toString","withPortalFiles","apply","arguments","__ngFactoryType__","factory","Éµfac","webApiViews","ViewsService","getAllOnce","getAllLive","refresh","delete","id","Id","import","file","formData","FormData","append","http","post","export","window","open","getPolymorphismLive","getUsage","guid","newHttpResource","FocusKeyManager","ListKeyManager","_origin","setFocusOrigin","origin","setActiveItem","item","super","activeItem","focus","webApiTypeRoot","webApiTypeGet","webApiTypes","webApiTypeScopes","ContentTypesService","HttpServiceBase","retrieveContentType","nameId","getHttpApiUrl","contentTypeId","getType","getTypes","scope","defaultValue","retrieveContentTypesPromise","fetchPromise","getScopesPromise","then","scopesData","scopes","old","Object","keys","map","key","name","value","getScopesSig","scopesSignal","computed","getScopesV2Promise","save","contentType","staticName","NameId","files","createGhost","sourceNameId","ClipboardService","constructor","snackBar","copyToClipboard","text","duration","i0","i1","providedIn","webApiAppPartsRoot","ImportAppPartsService","importAppParts","resetApp","toBase64","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","split","onerror","error","readAsText","ExportAppPartsService","getContentInfoLiveParam","exportParts","contentTypeIds","entityIds","templateIds","join","ImportAppService","importApp","changedName","retryOnDuplicate","pipe","switchMap","Messages","MessageType","FileUploadMessageTypes","Warning","folderName","prompt","Text","of","logSpecs","all","getAll","getAllSig","getAllRes","importQuery","clonePipeline","update","webApiQueryRun","webApiQueryDebugStream","webApiQuerySave","webApiQueryGet","webApiQueryDataSources","PipelinesService","log","classLog","fnIf","r","webApiEntityList","initial","l","res","obs","from","fileBase64","AppId","ContentBase64","success","Success","clonePipelinePromise"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./projects/eav-ui/src/app/app-administration/services/export-app.service.ts","./projects/eav-ui/src/app/app-administration/services/views.service.ts","./node_modules/@angular/cdk/fesm2022/_focus-key-manager-chunk.mjs","./projects/eav-ui/src/app/app-administration/services/content-types.service.ts","./projects/eav-ui/src/app/shared/services/clipboard.service.ts","./projects/eav-ui/src/app/app-administration/services/import-app-parts.service.ts","./projects/eav-ui/src/app/shared/helpers/file-to-base64.helper.ts","./projects/eav-ui/src/app/app-administration/services/export-app-parts.service.ts","./projects/eav-ui/src/app/import-app/services/import-app.service.ts","./projects/eav-ui/src/app/app-administration/services/pipelines.service.ts"],"sourcesContent":["import { httpResource } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { webApiAppRoot } from '../../import-app/services/import-app.service';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { AppInfo } from '../models/app-info.model';\r\n\r\nconst webApiAppRootStatistics = 'admin/app/Statistics';\r\nconst webApiAppRootSaveData = 'admin/app/SaveData';\r\n\r\n\r\n@Injectable()\r\nexport class ExportAppService extends HttpServiceBaseSignal {\r\n\r\n  getAppInfo() {\r\n    return httpResource<AppInfo>(() => ({\r\n      url: this.apiUrl(webApiAppRootStatistics),\r\n      params: { appid: this.appId, zoneId: this.zoneId },\r\n    }));\r\n  }\r\n\r\n  /** Generate the export app path. It can be extended with additional parameters */\r\n  exportAppUrl() {\r\n    return `${this.apiUrl(`${webApiAppRoot}Export`)}?appId=${this.appId}&zoneId=${this.zoneId}`;\r\n  }\r\n  async exportForVersionControl({ includeContentGroups, resetAppGuid, withFiles }:\r\n    { includeContentGroups: boolean; resetAppGuid: boolean; withFiles: boolean; }): Promise<number> {\r\n    return this.getStatusPromise(webApiAppRootSaveData, {\r\n      params: {\r\n        appid: this.appId,\r\n        zoneId: this.zoneId,\r\n        includeContentGroups: includeContentGroups.toString(),\r\n        resetAppGuid: resetAppGuid.toString(),\r\n        withPortalFiles: withFiles.toString(),\r\n      },\r\n    });\r\n  }\r\n\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { Polymorphism } from '../models/polymorphism.model';\r\nimport { ViewUsage } from '../models/view-usage.model';\r\nimport { View } from '../models/view.model';\r\n\r\nconst webApiViews = 'admin/view/all';\r\nconst webApiViewDelete = 'admin/view/delete';\r\nconst webApiViewImport = 'admin/view/import';\r\nconst webApiViewPolymorph = 'admin/view/polymorphism';\r\nconst webApiViewUsage = 'admin/view/usage';\r\nconst webApiJson = 'admin/view/json';\r\n\r\n@Injectable()\r\nexport class ViewsService extends HttpServiceBaseSignal {\r\n\r\n  getAllOnce() {\r\n    return httpResource<View[]>(() => {\r\n      return ({\r\n        url: this.apiUrl(webApiViews),\r\n        params: { appId: this.appId }\r\n      });\r\n    });\r\n  }\r\n\r\n  getAllLive(refresh: Signal<unknown>) {\r\n    return httpResource<View[]>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiViews),\r\n        params: { appId: this.appId }\r\n      });\r\n    });\r\n  }\r\n\r\n  async delete(id: number): Promise<number> {\r\n    return this.getStatusPromise(webApiViewDelete, {\r\n      params: { appId: this.appId, Id: id.toString() },\r\n    });\r\n  }\r\n\r\n  import(file: File) {\r\n    const formData = new FormData();\r\n    formData.append('File', file);\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiViewImport), formData, {\r\n      params: { appId: this.appId, zoneId: this.zoneId }\r\n    });\r\n  }\r\n\r\n  export(id: number) {\r\n    const url = this.apiUrl(webApiJson)\r\n      + '?appId=' + this.appId\r\n      + '&viewId=' + id;\r\n    window.open(url, '_blank', '');\r\n  }\r\n\r\n  getPolymorphismLive(refresh: Signal<unknown>) {\r\n    return httpResource<Polymorphism>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiViewPolymorph),\r\n        params: { appId: this.appId }\r\n      });\r\n    });\r\n  }\r\n  getUsage(guid: string) {\r\n    return this.newHttpResource<ViewUsage[]>(() => ({\r\n      url: this.apiUrl(webApiViewUsage),\r\n      params: { appId: this.appId, guid: guid }\r\n    }));\r\n  }\r\n}\r\n","import { ListKeyManager } from './_list-key-manager-chunk.mjs';\n\nclass FocusKeyManager extends ListKeyManager {\n  _origin = 'program';\n  setFocusOrigin(origin) {\n    this._origin = origin;\n    return this;\n  }\n  setActiveItem(item) {\n    super.setActiveItem(item);\n    if (this.activeItem) {\n      this.activeItem.focus(this._origin);\n    }\n  }\n}\n\nexport { FocusKeyManager };\n","import { httpResource } from '@angular/common/http';\r\nimport { computed, Injectable, Signal } from '@angular/core';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { ScopeOption } from '../../shared/constants/eav.constants';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { ContentType, ContentTypeEdit } from '../models/content-type.model';\r\nimport { ScopeDetailsDto } from '../models/scopedetails.dto';\r\n\r\n// We should list all the \"full\" paths here, so it's easier to find when searching for API calls\r\nexport const webApiTypeRoot = 'admin/type/';\r\nconst webApiTypeGet = 'admin/type/get';\r\nconst webApiTypes = 'admin/type/list';\r\nconst webApiTypeScopes = 'admin/type/scopes';\r\nconst webApiTypeSave = 'admin/type/save';\r\nconst webApiTypeDelete = 'admin/type/delete';\r\nconst webApiTypeImport = 'admin/type/import';\r\nconst webApiTypeAddGhost = 'admin/type/addghost';\r\n@Injectable()\r\nexport class ContentTypesService extends HttpServiceBase {\r\n\r\n  // TODO: @2dg, ask 2dm \r\n  // content-export.component.ts\r\n  // content-import.component.ts\r\n  // data.component.ts\r\n  retrieveContentType(nameId: string) {\r\n    return this.getHttpApiUrl<ContentType>(webApiTypeGet, {\r\n      params: { appId: this.appId, contentTypeId: nameId }\r\n    });\r\n  }\r\n\r\n  getType(nameId: string) {\r\n    return httpResource<ContentType>(() => ({\r\n      url: this.apiUrl(webApiTypeGet),\r\n      params: { appId: this.appId, contentTypeId: nameId }\r\n    }));\r\n  }\r\n\r\n  getTypes(scope: Signal<string>) {\r\n    return httpResource<ContentType[]>(() => ({\r\n      url: this.apiUrl(webApiTypes),\r\n      params: { appId: this.appId, scope: scope() }\r\n    }), {defaultValue: []});\r\n  }\r\n\r\n  retrieveContentTypesPromise(scope: string): Promise<ContentType[]> {\r\n    return this.fetchPromise<ContentType[]>(webApiTypes, {\r\n      params: { appId: this.appId, scope }\r\n    });\r\n  }\r\n\r\n  getScopesPromise(): Promise<ScopeOption[]> {\r\n    return this.fetchPromise<{ old: Record<string, string>, scopes: ScopeDetailsDto[] }>(webApiTypeScopes, {\r\n      params: { appId: this.appId }\r\n    }).then(scopesData => {\r\n      const scopes = scopesData.old;\r\n      const scopeOptions: ScopeOption[] = Object.keys(scopes).map(key => ({\r\n        name: scopes[key],\r\n        value: key,\r\n      }));\r\n      return scopeOptions;\r\n    });\r\n  }\r\n\r\n  getScopesSig() {\r\n    const scopesSignal = httpResource<{ old: Record<string, string>, scopes: ScopeDetailsDto[] }>(() => ({\r\n      url: this.apiUrl(webApiTypeScopes),\r\n      params: { appid: this.appId },\r\n    }));\r\n\r\n    const scopeOptionsSignal = computed(() => {\r\n      // Access the value property directly without calling scopesSignal as a function\r\n      const value = scopesSignal.value;\r\n      const scopesData = value();\r\n\r\n      // Add null/undefined check here\r\n      if (!scopesData || !scopesData.old) {\r\n        return []; // Return an empty array or handle this case as appropriate\r\n      }\r\n\r\n      const scopes = scopesData.old;\r\n      return Object.keys(scopes).map(key => ({ name: scopes[key], value: key }));\r\n    });\r\n\r\n    return scopeOptionsSignal;\r\n  }\r\n\r\n  getScopesV2Promise(): Promise<ScopeDetailsDto[]> {\r\n    return this.fetchPromise<{ old: Record<string, string>, scopes: ScopeDetailsDto[] }>(webApiTypeScopes, {\r\n      params: { appId: this.appId }\r\n    }).then(scopesData => scopesData.scopes);\r\n  }\r\n\r\n  save(contentType: ContentTypeEdit) {\r\n    return this.http.post<boolean>(this.apiUrl(webApiTypeSave), contentType, {\r\n      params: { appid: this.appId },\r\n    });\r\n  }\r\n\r\n  delete(contentType: ContentType) {\r\n    return this.http.delete<boolean>(this.apiUrl(webApiTypeDelete), {\r\n      params: { appid: this.appId, staticName: contentType.NameId }, // TODO: @2pp - replace staticName with NameId\r\n    });\r\n  }\r\n\r\n  import(files: File[]) {\r\n    const formData = new FormData();\r\n    for (const file of files) {\r\n      formData.append('File', file);\r\n    }\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiTypeImport), formData, {\r\n      params: { appId: this.appId, zoneId: this.zoneId },\r\n    });\r\n  }\r\n\r\n  createGhost(sourceNameId: string) {\r\n    return this.http.post<boolean>(this.apiUrl(webApiTypeAddGhost), null, {\r\n      params: { appid: this.appId, sourceNameId },\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { copyToClipboard } from '../helpers/copy-to-clipboard.helper';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ClipboardService {\r\n\r\n  constructor(private snackBar: MatSnackBar) { }\r\n\r\n  copyToClipboard(text: string): void {\r\n    copyToClipboard(text);\r\n    this.snackBar.open('Copied to clipboard', null, { duration: 2000 });\r\n  }\r\n}","import { Injectable } from '@angular/core';\r\nimport { webApiAppRoot } from '../../import-app/services/import-app.service';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\n\r\nexport const webApiAppPartsRoot = 'admin/appParts/';\r\n\r\n@Injectable()\r\nexport class ImportAppPartsService extends HttpServiceBaseSignal {\r\n\r\n  importAppParts(file: File) {\r\n    const formData = new FormData();\r\n    formData.append('File', file);\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiAppPartsRoot + 'Import'), formData, {\r\n      params: { appId: this.appId, zoneId: this.zoneId }\r\n    });\r\n  }\r\n\r\n  /** Reset the App back to the state it was in the last xml export */\r\n  resetApp(withFiles: boolean) {\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiAppRoot + 'Reset'), {}, {\r\n      params: {\r\n        appId: this.appId,\r\n        zoneId: this.zoneId,\r\n        withPortalFiles: withFiles.toString(),\r\n      }\r\n    });\r\n  }\r\n}\r\n","export function toBase64(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => {\r\n      resolve((reader.result as string).split(',')[1]);\r\n    };\r\n    reader.onerror = error => {\r\n      reject(error);\r\n    };\r\n  });\r\n}\r\n\r\nexport function toString(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsText(file);\r\n    reader.onload = () => {\r\n      resolve(reader.result as string);\r\n    };\r\n    reader.onerror = error => {\r\n      reject(error);\r\n    };\r\n  });\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\nimport { ContentInfo } from '../models/content-info.model';\r\nimport { webApiAppPartsRoot } from './import-app-parts.service';\r\n\r\nconst webApiAppPartsGet = 'admin/appParts/get';\r\n@Injectable()\r\nexport class ExportAppPartsService extends HttpServiceBaseSignal {\r\n\r\n  getContentInfoLiveParam(scope: Signal<string>) {\r\n    return httpResource<ContentInfo>(() => {\r\n      return {\r\n        url: this.apiUrl(webApiAppPartsGet),\r\n        params: {\r\n          appid: this.appId,\r\n          zoneId: this.zoneId,\r\n          scope: scope()\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  exportParts(contentTypeIds: number[], entityIds: number[], templateIds: number[]) {\r\n    const url = this.apiUrl(webApiAppPartsRoot + 'Export')\r\n      + '?appId=' + this.appId\r\n      + '&zoneId=' + this.zoneId\r\n      + '&contentTypeIdsString=' + contentTypeIds.join(';')\r\n      + '&entityIdsString=' + entityIds.join(';')\r\n      + '&templateIdsString=' + templateIds.join(';');\r\n\r\n    window.open(url, '_blank', '');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, switchMap } from 'rxjs';\r\nimport { FileUploadMessageTypes, FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { HttpServiceBaseSignal } from '../../shared/services/http-service-base-signal';\r\n\r\nexport const webApiAppRoot = 'admin/app/';\r\n\r\n@Injectable()\r\nexport class ImportAppService extends HttpServiceBaseSignal {\r\n\r\n  importApp(file: File, changedName: string, retryOnDuplicate = false): Observable<FileUploadResult> {\r\n    const formData = new FormData();\r\n    formData.append('File', file);\r\n    formData.append('Name', changedName ?? '');\r\n    return this.http.post<FileUploadResult>(this.apiUrl(webApiAppRoot + 'Import'), formData, {\r\n      params: { zoneId: this.zoneId }\r\n    }).pipe(\r\n      switchMap(result => {\r\n        if (retryOnDuplicate && result.Messages[0]?.MessageType === FileUploadMessageTypes.Warning) {\r\n          const folderName = prompt(result.Messages[0].Text + ' Would you like to install it using another folder name?');\r\n          if (folderName) {\r\n            return this.importApp(file, folderName, true);\r\n          }\r\n        }\r\n        return of(result);\r\n      }),\r\n    );\r\n  }\r\n}\r\n","import { httpResource } from '@angular/common/http';\r\nimport { Injectable, Signal } from '@angular/core';\r\nimport { from, map, switchMap } from 'rxjs';\r\nimport { FileUploadResult } from '../../shared/components/file-upload-dialog';\r\nimport { toBase64 } from '../../shared/helpers/file-to-base64.helper';\r\nimport { classLog } from '../../shared/logging';\r\nimport { webApiEntityList } from '../../shared/services/entity.service';\r\nimport { HttpServiceBase } from '../../shared/services/http-service-base';\r\nimport { Query } from '../models/query.model';\r\n\r\nconst logSpecs = {\r\n  all: true,\r\n  getAll: false,\r\n  getAllSig: true,\r\n  getAllLive: false,\r\n  getAllRes: true,\r\n  importQuery: false,\r\n  clonePipeline: false,\r\n  delete: false,\r\n  update: false,\r\n};\r\n\r\nconst webApiQueryImport = 'admin/query/import';\r\nconst webApiQueryClone = 'admin/query/Clone';\r\nconst webApiQueryDelete = 'admin/query/Delete';\r\nexport const webApiQueryRun = 'admin/query/Run';\r\nexport const webApiQueryDebugStream = 'admin/query/DebugStream';\r\nexport const webApiQuerySave = 'admin/query/Save';\r\nexport const webApiQueryGet = 'admin/query/Get';\r\nexport const webApiQueryDataSources = 'admin/query/DataSources';\r\n\r\n@Injectable()\r\nexport class PipelinesService extends HttpServiceBase {\r\n\r\n  log = classLog({ PipelinesService }, logSpecs);\r\n  // TODO: @2dg, ask 2dm \r\n  getAll(contentType: string) {\r\n    const l = this.log.fnIf('getAll');\r\n    return l.r(this.getHttpApiUrl<Query[]>(webApiEntityList, {\r\n      params: { appId: this.appId, contentType }\r\n    }));\r\n  }\r\n\r\n  // Full Code, repated x times\r\n  getAllLive(contentType: string, refresh: Signal<unknown>) {\r\n    this.log.fnIf('getAllLive', { contentType, refresh });\r\n    return httpResource<Query[]>(() => {\r\n      refresh();\r\n      return ({\r\n        url: this.apiUrl(webApiEntityList),\r\n        params: { appId: this.appId, contentType: contentType }\r\n      });\r\n    });\r\n  }\r\n\r\n  /** Experimental httpResource use! */\r\n  getAllRes(contentType: string, initial?: Query[]) {\r\n    const l = this.log.fnIf('getAllRes');\r\n    const res = httpResource<Query[]>(() => ({\r\n      url: webApiEntityList,\r\n      params: { appId: this.appId, contentType },\r\n    }), { defaultValue: initial });\r\n    return l.r(res);\r\n  }\r\n\r\n  importQuery(file: File) {\r\n    const l = this.log.fnIf('importQuery');\r\n    const obs = from(toBase64(file)).pipe(\r\n      switchMap(fileBase64 => {\r\n        return this.http.post<boolean>(this.apiUrl(webApiQueryImport), {\r\n          AppId: this.appId,\r\n          ContentBase64: fileBase64,\r\n        });\r\n      }),\r\n      map(success => {\r\n        const result: FileUploadResult = {\r\n          Success: success,\r\n          Messages: [],\r\n        };\r\n        return result;\r\n      }),\r\n    );\r\n    return l.r(obs);\r\n  }\r\n\r\n  clonePipelinePromise(id: number): Promise<null> {\r\n    const l = this.log.fnIf('clonePipeline');\r\n    const obs = this.fetchPromise<null>(webApiQueryClone, {\r\n      params: { Id: id.toString(), appId: this.appId }\r\n    });\r\n    return l.r(obs);\r\n  }\r\n\r\n  delete(id: number) {\r\n    const l = this.log.fnIf('delete');\r\n    const obs = this.http.delete<boolean>(this.apiUrl(webApiQueryDelete), {\r\n      params: { appId: this.appId, Id: id.toString() },\r\n    });\r\n    return l.r(obs);\r\n  }\r\n}\r\n"],"x_google_ignoreList":[2]}