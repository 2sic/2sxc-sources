{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/loc-i18next/index.js","webpack:///./node_modules/loc-i18next/dist/commonjs/main.js","webpack:///./src/dnn/dnn-workarounds/dnn-08.00.04.ts","webpack:///./node_modules/shake.js/shake.js","webpack:///../core/logging/log-entry-options.ts","webpack:///./src/commands/command.ts","webpack:///../core/constants/index.ts","webpack:///../core/logging/has-log.ts","webpack:///../core/logging/Log.ts","webpack:///../core/logging/log-call.ts","webpack:///../core/plumbing/obj.ts","webpack:///../core/plumbing/url.ts","webpack:///../core/plumbing/no-jquery.ts","webpack:///./src/constants/dialog-paths.ts","webpack:///../core/logging/entry.ts","webpack:///../core/logging/insights.ts","webpack:///./src/commands/commands.ts","webpack:///./src/commands/command/shared-logic.ts","webpack:///./src/constants/content-block.ts","webpack:///./src/constants/ids.ts","webpack:///./src/constants/index.ts","webpack:///./src/constants/attributes.ts","webpack:///./src/constants/toolbar.ts","webpack:///./src/constants/debug.ts","webpack:///../$2sxc/src/tools/url-param-manager.ts","webpack:///../$2sxc/src/tools/total-popup.ts","webpack:///../$2sxc/src/constants/index.ts","webpack:///../$2sxc/src/environment/env-loader-dnn-sf.ts","webpack:///../$2sxc/src/environment/env-loader-dynamic.ts","webpack:///../$2sxc/src/environment/env-loader-meta.ts","webpack:///../$2sxc/src/environment/root-environment.ts","webpack:///../$2sxc/src/sxc-instance/web-api/ajax-promise.ts","webpack:///../$2sxc/src/http/sxc-http.ts","webpack:///../$2sxc/src/sxc-instance/web-api/sxc-web-api.ts","webpack:///../$2sxc/src/sxc-instance/sxc-instance.ts","webpack:///../$2sxc/src/sxc-instance/sxc-instance-with-internals.ts","webpack:///../$2sxc/src/sxc-instance/deprecated/sxc-instance-data.ts","webpack:///../$2sxc/src/sxc-root/debug.ts","webpack:///./src/quick-edit/quick-e-overlays.ts","webpack:///./src/quick-edit/quick-e-configuration.ts","webpack:///./src/interfaces/sxc-instance-editable.ts","webpack:///./src/html/dom-tools.ts","webpack:///./src/interfaces/window-in-page.ts","webpack:///./src/quick-edit/selection.ts","webpack:///./src/quick-edit/modifier-base.ts","webpack:///./src/quick-edit/context-for-lists.ts","webpack:///./src/workflow/workflow-helper.ts","webpack:///./src/toolbar/config/toolbar-settings.ts","webpack:///./src/workflow/workflow-manager.ts","webpack:///./src/workflow/workflow-arguments.ts","webpack:///./src/workflow/workflow-phases.ts","webpack:///./src/workflow/workflow.ts","webpack:///./src/toolbar/toolbar-lifecycle.ts","webpack:///./src/toolbar/tag-toolbars/tag-toolbar.ts","webpack:///./src/toolbar/tag-toolbars/tag-toolbar-manager.ts","webpack:///./src/toolbar/config/button-command.ts","webpack:///./src/toolbar/config/button.ts","webpack:///./src/toolbar/config/button-safe.ts","webpack:///./src/plumbing/TypeTbD.ts","webpack:///./src/toolbar/config/button-group.ts","webpack:///./src/toolbar/config/toolbar.ts","webpack:///./src/toolbar/render/render-part-base.ts","webpack:///./src/toolbar/render/render-button.ts","webpack:///./src/toolbar/render/render-groups.ts","webpack:///./src/toolbar/render/toolbar-renderer.ts","webpack:///./src/toolbar/initialize/toolbar-init-config.ts","webpack:///./src/context/parts/context-app.ts","webpack:///./src/context/parts/context-content-block.ts","webpack:///./src/context/parts/context-instance.ts","webpack:///./src/context/parts/context-item.ts","webpack:///./src/interfaces/sxc-controller-in-page.ts","webpack:///./src/context/parts/context-page.ts","webpack:///./src/context/parts/context-system.ts","webpack:///./src/context/parts/context-tenant.ts","webpack:///./src/context/parts/context-ui.ts","webpack:///./src/context/parts/context-user.ts","webpack:///./src/context/bundles/context-bundle-instance.ts","webpack:///./src/context/html-attribute/parts/content-block.ts","webpack:///./src/context/bundles/context-bundle-content.ts","webpack:///./src/context/bundles/context-bundle-toolbar.ts","webpack:///./src/context/bundles/context-bundle-button.ts","webpack:///./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack:///./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack:///./node_modules/@babel/runtime/helpers/esm/objectSpread.js","webpack:///./node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack:///./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack:///./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","webpack:///./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","webpack:///./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack:///./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack:///./node_modules/@babel/runtime/helpers/esm/inherits.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack:///./node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack:///./node_modules/@babel/runtime/helpers/esm/slicedToArray.js","webpack:///./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack:///./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","webpack:///./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack:///./node_modules/i18next/dist/esm/i18next.js","webpack:///./node_modules/i18next-xhr-backend/dist/esm/i18nextXHRBackend.js","webpack:///./src/i18n/2sxc.translate.ts","webpack:///./src/i18n/index.ts","webpack:///./src/i18n/translator.ts","webpack:///./src/toolbar/initialize/toolbar-finder-and-initializer.ts","webpack:///./src/toolbar/config-loaders/config-formats/in-page-button.ts","webpack:///./src/toolbar/config-loaders/config-formats/in-page-command.ts","webpack:///./src/toolbar/config-loaders/button-config-loader.ts","webpack:///./src/toolbar/rules/operators.ts","webpack:///./src/toolbar/rules/build-steps.ts","webpack:///./src/toolbar/config-loaders/command-config-loader.ts","webpack:///./src/toolbar/templates/constants.ts","webpack:///./src/toolbar/config-loaders/group-config-loader.ts","webpack:///./src/toolbar/templates/template-empty.ts","webpack:///./src/toolbar/templates/template-default.ts","webpack:///./src/toolbar/templates/template-sublist.ts","webpack:///./src/toolbar/templates/toolbar-template-manager.ts","webpack:///./src/toolbar/templates/toolbar-template.ts","webpack:///./src/toolbar/templates/toolbar-template-group.ts","webpack:///./src/toolbar/templates/template-editor.ts","webpack:///./src/toolbar/config-loaders/toolbar-config-loader-v09.ts","webpack:///./src/toolbar/rules/rule-constants.ts","webpack:///./src/toolbar/rules/rule-params-helper.ts","webpack:///./src/toolbar/rules/rule.ts","webpack:///./src/toolbar/rules/rule-manager.ts","webpack:///./src/toolbar/config-loaders/toolbar-config-loader-v10.ts","webpack:///./src/toolbar/config-loaders/toolbar-config-loader.ts","webpack:///./src/toolbar/toolbar-manager.ts","webpack:///./src/quick-edit/modifier-content-block-internal.ts","webpack:///./src/quick-edit/modifier-content-block.ts","webpack:///./src/quick-edit/position-coordinates.ts","webpack:///./src/quick-edit/modifier-dnn-module.ts","webpack:///./src/quick-edit/modifier-dnn-module-internal.ts","webpack:///./src/quick-edit/positioning.ts","webpack:///./src/quick-edit/quick-e-clipboard.ts","webpack:///./src/quick-edit/selectors-instance.ts","webpack:///./src/quick-edit/index.ts","webpack:///./src/quick-edit/quick-e.ts","webpack:///./src/contentBlock/content-block-editor.ts","webpack:///./src/contentBlock/render.ts","webpack:///./src/commands/command/content-list-actions.ts","webpack:///./src/commands/command/add.ts","webpack:///./src/commands/command/add-existing.ts","webpack:///./src/commands/command/app-import.ts","webpack:///./src/commands/command/edit.ts","webpack:///./src/commands/command/app-resources.ts","webpack:///./src/commands/command/app-settings.ts","webpack:///./src/commands/command/app.ts","webpack:///./src/commands/command/content-items.ts","webpack:///./src/commands/command/content-type.ts","webpack:///./src/commands/command/custom.ts","webpack:///./src/entity-manipulation/item-commands.ts","webpack:///./src/commands/command/delete.ts","webpack:///./src/commands/command/insights-server.ts","webpack:///./src/commands/command/instance-list.ts","webpack:///./src/commands/command/new.ts","webpack:///./src/commands/command/metadata.ts","webpack:///./src/commands/command/more.ts","webpack:///./src/commands/command/movedown.ts","webpack:///./src/commands/command/moveup.ts","webpack:///./src/commands/command/publish.ts","webpack:///./src/commands/command/remove.ts","webpack:///./src/commands/command/replace.ts","webpack:///./src/commands/command/template-develop.ts","webpack:///./src/commands/command/template-query.ts","webpack:///./src/commands/command/template-settings.ts","webpack:///./src/commands/command/zone.ts","webpack:///./src/commands/command/special-commands.ts","webpack:///./src/quick-dialog/quick-dialog-config.ts","webpack:///./src/quick-dialog/iframe-bridge.ts","webpack:///./src/manage/session-state-handler.ts","webpack:///./src/quick-dialog/state.ts","webpack:///./src/quick-dialog/index.ts","webpack:///./src/quick-dialog/quick-dialog-container.ts","webpack:///./src/quick-dialog/quick-dialog.ts","webpack:///./src/manage/ng-dialog-params.ts","webpack:///./src/commands/command-link-generator.ts","webpack:///./src/commands/engine/run-parameters.ts","webpack:///./src/commands/engine/cms-engine.ts","webpack:///./src/cms/Cms.ts","webpack:///./src/commands/engine/run-params.ts","webpack:///./src/commands/engine/sxc-instance-engine.ts","webpack:///./src/commands/command/layout.ts","webpack:///./src/bootstrap/bootstrap.ts","webpack:///./src/dnn/dnn-menu-helper/dnn-inpage-edit.ts","webpack:///./src/dnn/index.ts","webpack:///./src/manage/edit-manager.ts","webpack:///./src/manage/manage.ts","webpack:///./src/system/2sxc.system.ts","webpack:///./src/toolbar/toolbar-global-enable-shake.ts","webpack:///./src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","default","_extends","assign","target","arguments","length","source","defaults","selectorAttr","targetAttr","optionsAttr","useOptionsAttr","parseDefaultValueFromContent","document","init","i18next","options","undefined","extendDefault","val","defaultValue","parse","elem","opts","attr","indexOf","parts","split","substr","innerHTML","textContent","startIdx","endIdx","substring","slice","join","_startIdx","_endIdx","dataAttr","translated","getAttribute","setAttribute","relaxedJsonParse","badJSON","JSON","replace","match","p1","_loc","targetSelector","querySelector","keys","ix","l_ix","clone","lng","stringify","handle","selector","elems","querySelectorAll","childs","j","window","$","fn","apply","this","search","global","Shake","hasDeviceMotion","threshold","timeout","lastTime","Date","lastX","lastY","lastZ","CustomEvent","event","bubbles","cancelable","createEvent","initEvent","reset","start","addEventListener","stop","removeEventListener","devicemotion","e","deltaX","deltaY","deltaZ","current","accelerationIncludingGravity","x","y","z","Math","abs","getTime","dispatchEvent","handleEvent","type","factory","LogEntryOptions","merge","icon","translateKey","uiOnly","partOfPage","more","buttonDefaults","_","title","uiActionOnly","build","commandDefinition","Command","HeaderNames","ApiUrlRoots","logName","parentLog","initialMessage","initLog","initLogInternal","log","rename","linkLog","add","keepData","location","parent","entries","Array","depth","callDepths","maxEntries","liveDump","_parentHasLiveDump","_parentHasKeepData","fullIdentifier","identifier","scope","id","idCache","randomString","startTime","dot","min","rest","message","data","_prepareMessage","_addEntry","_prepareEntry","entry","addData","logData","msg","time","Function","toString","callParams","_callDepthAdd","push","_callDepthRemove","last","pop","console","warn","dump","one","separator","dumpOne","dumpList","index","forEach","result","line","repeat","stringLength","chars","randomstring","rnum","floor","random","initialEntry","behavior","lastMessage","processExtraBehavior","onlyAddIfNew","done","return","error","throw","TypeSafeAssign","args","reduce","DeepClone","original","ignoreCircular","str","getCircularReplacer","seen","WeakSet","has","urlClean","DialogPaths","ready","callback","readyState","once","param","obj","map","k","v","encodeURIComponent","domFromString","string","dummyParent","createElement","insertAdjacentHTML","from","brokenScript","workingScript","attributes","attribute","nodeName","nodeValue","NoJQ","replaceWith","elements","children","element","removeChild","offset","clientRect","getBoundingClientRect","top","scrollY","left","scrollX","width","computedStyle","getComputedStyle","offsetWidth","parseInt","getPropertyValue","height","offsetHeight","outerWidth","empty","childNodes","toBeReplaced","newElement","runScripts","parentElement","scripts","restores","script","replaceChild","restore","AssetsLoader","append","newElements","tagName","toLocaleLowerCase","restoreType","appendChild","others","copy","src","listener","onload","onerror","head","setTimeout","_data","Obj","history","setName","InsightsLogSet","logs","show","partName","part","logSet","autoLimit","logNames","Insights","$2sxc","_insights","InsightsSingleton","commandList","list","singleton","_singleton","Commands","cmd","addDef","def","isPartOfBlockList","context","contentBlock","isList","button","command","params","useModuleList","sortOrder","isBlockReference","isFieldList","fields","isReferencedItem","cViewWithoutContent","UseExistingTemplate","IDs","cls","scMenu","toolbar","toolbarData","settings","settingsData","publishAllowed","sel","tagScMenu","C","ContentBlock","Attributes","InstanceId","Context","ContentBlockId","Toolbar","attrToMarkInitalized","full","hover","disable","classes","oldHover","selectors","ofOldHover","eventNames","onInit","Cb","ofName","Debug","cms","autoDump","run","frame","open","url","wrapper","body","ifrm","className","close","frm","parentNode","closeThis","totalPopup","strResult","results","RegExp","exec","hash","matches","pathname","reverse","decodeURIComponent","require","found","alert","debug","DnnUiRoot","helpAutoDetect","env","dnnSfFallback","cl","dnnSfLoadWhenDocumentReady","sf","ServicesFramework","dnnSf","apiRoot","getServiceRoot","sfJsInfo","page","getTabId","root","api","appApi","rvtHeader","rvt","getAntiForgeryValue","uiRoot","platform","load","mainLoader","startMetaTagObserver","observer","MutationObserver","mutationsList","mut","attributeName","updateEnv","getMetaContent","observe","getJsApiMetaTag","childList","subtree","startInputRvtObserver","inputRvtObserver","loadRvtFromHiddenInput","hiddenField","input","updateRvt","retries","dynamicPageHelper","loadMetaFromHeader","forceFallback","meta","newJsInfo","ourMeta","metaLoader","_jsApi","addSlash","endsWith","header","replacedRvt","newRvt","ensureReadyOrThrow","partRequested","headers","cbid","fHeaders","pageId","endpointName","appApiRoot","apiUrl","baseUrl","startsWith","sxc","makePromise","Error","promise","ajax","async","dataType","contentType","method","getActionUrl","beforeSend","xhr","setRequestHeader","preventAutoFail","fail","showDetailedHttpError","controller","action","http","endpoint","settingsOrUrl","request","post","delete","put","controllerAction","controllerName","actionName","fetch","fetchJson","then","response","json","toLocaleUpperCase","urlAndParams","urlParts","filter","ctx","manage","webApi","_manage","initInstance","_translateInit","app","currentLanguage","resolveServiceUrl","virtualPath","toLowerCase","status","config","infoText","srvResp","responseText","Message","msgDet","MessageDetail","ExceptionMessage","isEditMode","_isEditMode","cacheKey","isLoaded","lastRefresh","SxcInstanceDataDeprecated","recreate","resetCache","_controllers","List","sourceUrl","origSuccess","success","dataSetName","in","Default","_triggerLoaded","statusText","reload","on","trigger","UrlParamManager","urlDebugState","uncache","urlState","QuickEditOverlay","QuickEditConfig","is","thing","getEditContext","htmlElement","editContextTag","SxcEdit","getContainerTag","getTag","getEditContextOfTag","htmlTag","closest","sxci","tag","isDisabled","getFirstAttribute","name1","name2","HtmlTools","tryGetAttrText","item1","getNamedItem","addClasses","classessArray","classList","windowInPage","setButtonActivationClasses","buttons","linkTags","remove","DefaultButtons","btn","i18N","invisible","unavailable","selectedOverlay","toggleOverlay","coords","yh","positionAndAlign","style","display","addApp","addContent","select","paste","move","getNewDefaultConfig","enable","innerBlocks","dummyWorkflowManager","getFromDom","QeSelectors","blocks","cb","appList","apps","trim","autoAddMore","follow","class","color","dropEmptyProperties","toolbarSettings","partialSettings","getDefaults","ToolbarSettings","getForEmpty","ToolbarWhenNoToolbarProvided","getWorkflow","node","WorkflowHelper","getDummyManager","parentCount","cmdWf","commandWorkflow","isCancelled","currentArgs","cancel","_isCancelled","isDummy","steps","isArray","addOne","step","initDefaults","phase","errorMsg","wfArgs","emptyWorkflow","stepsForCommand","SpecialCommands","all","WorkflowPhases","code","sort","priority","Promise","resolve","reject","promiseChain","stepCount","nextStep","resultingArgs","runNextPromiseIfNotCancelled","finalArgs","catch","attach","prevArgs","nextFactory","before","raiseToolbarInitEvent","toolbarElement","anchoredElement","detail","workflow","hoverTag","translator","initialized","alwaysShow","watcherActive","updateFn","updatePosition","addMouseEvents","showPermanently","initializeIfNecessary","relatedTarget","contains","hide","nextFreeId","getNextToolbarId","toolbarId","instance","contentBlockReference","generate","TagToolbarForAttr","TagToolbarAttr","toolbarStyle","position","transition","autoTranslateMenus","initial","right","viewportOffset","bodyOffset","getBodyScrollOffset","tagScrollOffset","tagOffset","tagWidth","mousePos","mousePosition","win","documentElement","clientWidth","padding","tagToolbarPadding","toolbarHeight","tagToolbarPaddingRight","disableScrollWatcher","activateScrollWatcher","TagToolbarManager","lastMenuId","posNoJq","CleanupOrphanedToolbars","clientX","clientY","mergeAdditionalParams","additionalParams","inlineWindow","Button","splitName","isPropGen","dialog","getVal","disabled","dynamicClasses","fullScreen","newWindow","addParamsToLink","showCondition","propOrGen","fallback","groups","createIdentifier","render","groupIndex","ButtonSafe","rule","_rules","find","group","groupName","btnLink","generateRunJs","ui","setTitle","divTag","iconTag","processColorRules","callLog","uiTitle","i18nTitle","backgroundColor","correctColorCodes","symbol","RenderPart","tags","btnGroups","concat","generateGroup","groupNumber","btns","h","btnContext","forButton","item","RenderButtonGroups","outerHTML","tlbTag","g","loadFromTag","newConfigFormat","at","err","editCtx","isContent","settingsId","resourcesId","supportsAjax","AppId","IsContent","AppResourcesId","AppSettingsId","appPath","AppUrl","hasContent","HasContent","SupportsAjax","zoneId","ZoneId","appId","Language","Current","primaryLanguage","Primary","allLanguages","All","isCreated","IsCreated","IsList","queryId","QueryId","templateId","TemplateId","templatePath","TemplatePath","edition","Edition","contentTypeId","ContentTypeName","contentGroupId","Guid","isEditable","allowPublish","sxcVersion","parameters","sxcRootUrl","Environment","IsEditable","SxcVersion","SxcRootUrl","publishingMode","$2sxcInPage","PageId","Ui","autoToolbar","AutoToolbar","Form","form","User","canDesign","CanDesign","canDevelop","CanDevelop","fromContext","user","ContextOfUser","_isContext","ContextOfApp","system","ContextOfSystem","tenant","ContextOfTenant","ContextOfUi","maybeButton","parentGuid","parentField","parentIndex","ContextOfItem","ContextOfContentBlock","findContext","tagOrSxc","containerTag","contextOfButton","ContextComplete","getContextInstance","contextCopy","htmlElementOrId","copyOfContext","ContextBundleToolbar","_typeof","iterator","constructor","_defineProperty","configurable","writable","_objectSpread","ownKeys","getOwnPropertySymbols","sym","getOwnPropertyDescriptor","_classCallCheck","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","_getPrototypeOf","setPrototypeOf","getPrototypeOf","__proto__","_setPrototypeOf","_inherits","subClass","superClass","_arrayLikeToArray","arr","len","arr2","_unsupportedIterableToArray","minLen","test","_toConsumableArray","iter","_slicedToArray","_arr","_n","_d","_e","_s","_i","next","consoleLogger","output","_console","baseLogger","Logger","concreteLogger","prefix","logger","bool","_len","_key","forward","_len2","_key2","_len3","_key3","_len4","_key4","lvl","debugOnly","moduleName","EventEmitter","observers","events","_this","cloned","_cloned","defer","res","rej","makeString","a","getLastOfPath","path","Empty","cleanKey","canNotTraverseDeeper","stack","shift","setPath","newValue","_getLastOfPath","getPath","_getLastOfPath3","getPathWithDefaults","defaultData","deepExtend","overwrite","prop","String","regexEscape","_entityMap","_EventEmitter","ResourceStore","defaultNS","keySeparator","splice","silent","addNamespaces","emit","resources","addResource","deep","pack","hasResourceBundle","removeNamespaces","getResource","compatibilityAPI","postProcessor","processors","addPostProcessor","processor","process","checkedLoadedFor","Translator","services","language","interpolation","resolved","nsSeparator","namespaces","_this2","overloadTranslationOptionHandler","_this$extractFromKey","extractFromKey","namespace","appendNamespaceToCIMode","resUsedKey","usedKey","resExactUsedKey","exactUsedKey","resType","noObject","joinArrays","handleAsObjectInI18nFormat","i18nFormat","handleAsObject","returnObjects","returnedObjectHandler","resTypeIsArray","copy$$1","newKeyToUse","deepKey","translate","extendTranslation","usedDefault","isValidLookup","count","suffix","pluralResolver","getSuffix","updateMissing","lngs","fallbackLngs","languageUtils","getFallbackCodes","fallbackLng","saveMissingTo","toResolveHierarchy","send","missingKeyHandler","backendConnector","saveMissing","needsPluralHandling","saveMissingPlurals","getPluralFormsOfKey","appendNamespaceToMissingKey","parseMissingKeyHandler","_this3","usedLng","usedNS","skipInterpolation","interpolator","defaultVariables","interpolate","nest","postProcess","postProcessorNames","applyPostProcessor","postProcessPassResolved","i18nResolved","_this4","extracted","fallbackNS","needsContextHandling","codes","utils","hasLoadedNamespace","pluralSuffix","possibleKey","finalKey","finalKeys","addLookupKeys","contextSeparator","returnNull","returnEmptyString","resourceStore","capitalize","charAt","toUpperCase","LanguageUtil","whitelist","formatLanguageCode","specialCases","lowerCaseLng","cleanCode","nonExplicitWhitelist","getLanguagePartFromCode","fallbacks","getScriptPartFromCode","fallbackCode","fallbackCodes","addCode","isWhitelisted","fc","sets","nr","_rulesPluralsTypes","1","Number","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","createRules","rules","set","numbers","plurals","PluralResolver","getRule","ret","idx","noAbs","simplifyPluralSuffix","returnSuffix","prepend","compatibilityJSON","Interpolator","format","escapeValue","iOpts","escape","useRawValueToEscape","prefixEscaped","suffixEscaped","formatSeparator","unescapePrefix","unescapeSuffix","nestingPrefix","nestingPrefixEscaped","nestingSuffix","nestingSuffixEscaped","nestingOptionsSeparator","maxReplaces","alwaysFormat","resetRegExp","regexpStr","regexp","regexpUnescapeStr","regexpUnescape","nestingRegexpStr","nestingRegexp","replaces","regexSafe","handleFormat","f","missingInterpolationHandler","temp","lastIndex","_temp","clonedOptions","handleHasOptions","inheritedOptions","sep","optionsString","Connector","backend","store","state","queue","languages","toLoad","pending","toLoadLanguages","toLoadNamespaces","hasAllNamespaces","loaded","errors","_name$split2","addResourceBundle","q","_getLastOfPath2","what","fcName","tried","wait","read","queueLoad","loadOne","prepareLoading","_this5","_name$split3","_name$split4","fallbackValue","isUpdate","initImmediate","preload","pluralSeparator","partialBundledLanguages","tDescription","_format","transformOptions","noop","I18n","external","isInitialized","isClone","createClassOnDemand","ClassOrObject","lu","languageDetector","detection","storeApi","_this2$store","deferred","changeLanguage","usedCallback","isLanguageChangingTo","setLng","cacheUserLanguage","loadResources","detect","fixedT","_this$translator","_this$translator2","exists","_this6","lastLng","loadNotPending","loadState","_this7","preloaded","newLngs","_this8","mergedOptions","membersToCopy","each","addQueryString","queryString","paramName","cache","queryStringParams","XMLHttpRequest","ActiveXObject","crossDomain","withCredentials","overrideMimeType","customHeaders","onreadystatechange","loadPath","addPath","allowMultiLoading","parsePayload","Backend","loadUrl","payload","localize","translations","locReady","i18n","initManager","_context","tryToFindAContext","realRootPath","use","initLoc","editContext","menus","quickEButtons","toolbarSelector","tlbManager","buildDnnModule","parentTag","toolbars","findChildTagsWithConfig","contentTag","addDefaultToolbarConfigToTag","loadConfigAndInitialize","onlyDirectDescendents","convertConfigToToolbars","err2","loadConfig","tagToolbar","addHoverAttributeToTag","hoverParent","hasAttribute","InPageButtonJson","toButton","oldFormat","evalPropOrFun","propOrFunction","hasActions","hasModify","modify","noAction","normalize","asBtnConfig","_expanded","btnConfigStructure","InPageCommandJson","removeDisableButtons","wrapLog","removeUnfitButtons","CmdMore","addDefaultBtnSettings","groupDefaults","tlbDefaults","actions","btnProperties","fallbackBtnSetting","removals","toolbarV10","overrideShow","toolbarDefaults","propName","Operations","BuildSteps","updateToV9","actDef","entity","_2sxcEditInformation","editInfo","EntityId","entityId","TemplateConstants","expandButtonGroups","fullToolbar","expandButtonList","buttonConfigs","b","convertToButton","dropMoreIfOnlyOneGroup","sharedParams","sharedDefaults","btnCommand","realParams","newButtonConfig","buttonsWip","newButtons","actionNames","expandButtonAndAddToList","addMoreButton","names","commandPart","addMore","moreButton","unshift","findIndex","ToolbarTemplateEmpty","_isToolbarTemplate","ToolbarTemplateDefault","ToolbarTemplateSublist","configTemplateList","ToolbarTemplateManager","findOrShowError","template","hasGroups","ensureGroups","findGroup","addButton","pos","fromStart","findGroupOrDefault","addGroup","buttonId","posStartEnd","correctPosStartEnd","posInsert","findInsertPosition","_insertCursor","alreadyExists","newGroup","removeGroup","loadV9","draftToolbar","getTemplateIfNoButtonsSpecified","buildFullDefinition","raw","ToolbarTemplate","defToolbarname","templates","toolbarContext","unstructuredConfig","configWip","ensureDefinitionTree","buildTreeAndModifyAccordingToRules","newToolbar","findGroups","probablyTemplate","RuleConstants","None","processParams","prefill","RuleParamsHelper","processSubMultiKeys","filters","metadata","for","processMetadata","mdFor","targetType","isNaN","keyType","prefixLen","convertGuidListToArrayOrKeepOriginal","probablyArray","guidCount","ruleString","operator","loadHeader","loadParamsAndPrefill","loadHash","splitParamsArray","knownOperatorFound","values","includes","knowStepFound","loadHeaderParts","dicToArray","splitParamsDic","keyValues","ruleManagerId","getSettings","getSystemRule","getToolbar","getParams","getAdd","br","getRemoveGroups","rawList","criteria","loadV10","settingRule","toolbarRule","toolbarTemplateName","rg","templateEditor","_owner","setLoggingAndCreateHelpers","debugLog","toolbarV09","CommandConfigLoader","tlbConfig","toolbarFinder","ToolbarManager","buildModule","getLoader","instanceName","loader","sxcInstance","parentId","fieldName","appName","container","newGuid","cblockList","field","guid","newTag","after","indexFrom","indexTo","toIndex","confirm","getInstanceModifier","clip","findClipListIndex","listIndex","appOrContent","oldClip","newClip","to","isRealMove","findListIndex","onCbButtonClick","blockTag","main","activeContentBlock","findClosestList","listItems","actionConfig","domIndex","cbAction","do","modCb","ModifierBase","modInternal","modId","getModuleId","pane","getPaneName","showSendToPane","quickE","mod","activeModule","pl","selected","getMoveButtons","onModuleButtonClick","dnnMod","modManage","modDnn","dnnSF","tabId","sendDnnAjax","paneName","desktopModules","moduleToFind","ModuleName","postData","Module","Page","Pane","Position","Sort","Visibility","AddExistingModule","CopyModule","createMod","ModuleID","order","dataVar","TabId","ModuleId","ModuleOrder","pns","cachedPanes","targets","pName","clipboard","newPane","req","dnnHeaders","fakeXhr","setModuleHeaders","URLSearchParams","text","resText","resData","lastCall","w","eitherCbOrMod","getBodyPosition","bodyPos","PositionCoordinates","refresh","newDate","lists","findAllLists","singleItem","contentBlocks","panes","refreshDomObjects","currentCoords","nearestCb","findNearest","nearestMod","modActions","toggle","cbActions","oldParent","_parentNode","alignTo","parentPane","parentCbList","parentContainer","listSettings","showContent","showApps","provideCorrectAddButtons","nearestItem","nearestDistance","posX","posY","distance","Selection","mods","initializeSecondaryButtons","QuickEClipboard","qem","createSpecs","mark","clearUi","newData","removeSelectionMarker","selectedItem","previousElementSibling","setSecondaryActionsState","btnConfig","currentItem","contextInfo","contentBlockAndModuleSelectors","el","QuickE","loadPageConfig","initWatchMouse","logConfig","confJ","configs","finalConfig","confO","defConfig","detectWhichMenusToActivate","conf","innerCBs","hasInnerCBs","prepareToolbarInDom","initPanes","refreshTimeout","requestAnimationFrame","ContentBlockEditor","prepareToAddContent","updateTemplate","updateTemplateFromDia","wasShowingPreview","renderer","reloadAndReInitialize","getPreviewWithTemplate","lang","originalparameters","forceCreate","saveTemplate","forceCreateContentGroup","newTemplateChooserState","showMessage","newContent","forceAjax","preview","WorkflowArguments","ajaxLoad","dnn_tabVersioningEnabled","dnn","ContentEditorManager","triggerChangeOnPageContentEvent","alternateTemplateId","justPreview","replaceContentBlock","newContentObj","newHeadHtml","Resources","resource","Type","Url","newHead","newDom","Html","asset","Actions","addItem","doAndReload","removeFromList","changeOrder","publish","publishId","verb","SharedLogic","configureLinkGenerator","linkGenerator","items","Group","Part","Index","Add","topItem","enc","btoa","urlParams","errNoCode","actPar","customCode","contentItems","itemId","itemGuid","itemTitle","msgJs","entityGuid","entityTitle","openDialog","itm","Title","Metadata","fullMenu2","oldState2","newState2","preventDefault","scElement","opacity","screenX","screenY","max","isPublished","Path","pipelineId","linkGen","QuickDialogConfig","isInnerContent","changed","uncachedSxc","instanceSxc","getContext","getAdditionalDashboardConfig","setVisible","scrollToTarget","tagModule","reloadAndReInit","setTemplate","templateName","final","setup","dialogName","sxcCacheKey","isConfiguredFor","instanceId","sessionStorage","setItem","removeItem","getItem","getItemValue","cancelled","quickDialog","isFullscreen","resizeWatcher","getOrCreate","buildContainerAndIFrame","extendedIFrame","iFrame","iFrameExtended","bridge","convertIFrameToQuickDialog","watchForResize","getIFrame","setSize","minHeight","setInterval","contentDocument","previousHeight","QuickDialog","isVisible","cont","rememberDialogState","showOrToggleFromToolbar","togglePromise","dialogUrl","setUrlToQuickDialog","contentWindow","reboot","promiseRestart","resolvePromise","iframe","cbId","ng8","changePathToLocalhostForDev","devMode","localStorage","tid","mid","publishing","approot","fa","rvth","rootUrl","getDialogUrl","debugUrlParam","buildItemsList","addContentGroupItems","addItemInList","getLink","urlItems","Prefill","ngDialogParams","ct","attributeSetName","findTranslationKey","findPartName","withPresentation","isAdd","groupId","addContentGroupItem","Field","Parent","content","getParamsFromNameOrParams","nameOrSettings","nameIsString","expandParamsWithDefaults","runParamsHelper","detectParamsAndRun","nameOrParams","eventOrParams","cmdParams","thirdParamIsEvent","altKey","wipParamsWithWorkflow","origEvent","wf","workflows","finalPromise","wrapperPromise","commandPromise","CmsEngine","promiseWithAfterEffects","link","completePromise","isChanged","shiftKey","resetLog","eventOrSettings","innerCall","typed","cmsEngine","cntx","attrSel","listSpecs","specs","initializedInstances","openedTemplatePickerOnce","diagCancelStateOnStart","initialize","initAllInstances","watchDomChanges","isFirstRun","tryShowTemplatePicker","stats","processed","addedNodes","openDialogId","uninitializedModules","wasEmpty","showGlassesButtonIfUninitialized","cg","_editContext","changeLayoutOrContent","edit","adminApp","adminZone","develop","userInfo","cmdEngine","_reloadWithAjax","_commands","_user","getButton","tbConfig","moreSettings","toolbarConfig","_updateContentGroupGuid","errType","cbTag","errWrapper","handleErrors","_toolbarManager","myContext","editManager","finishUpgrade","domElement","$quickE","$2sxcActionMenuMapper"],"mappings":"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","file":"inpage.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","module.exports = require('./dist/commonjs/main.js').default;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar defaults = {\n    selectorAttr: 'data-i18n',\n    targetAttr: 'i18n-target',\n    optionsAttr: 'i18n-options',\n    useOptionsAttr: false,\n    parseDefaultValueFromContent: true,\n    document: document\n};\n\nfunction init(i18next) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    options = _extends({}, defaults, options);\n    var extendDefault = function extendDefault(o, val) {\n        return options.parseDefaultValueFromContent ? _extends({}, o, { defaultValue: val }) : o;\n    };\n    function parse(elem, key, opts) {\n        var attr = 'text';\n\n        if (key.indexOf('[') == 0) {\n            var parts = key.split(']');\n            key = parts[1];\n            attr = parts[0].substr(1, parts[0].length - 1);\n        }\n\n        key = key.indexOf(';') == key.length - 1 ? key.substr(0, key.length - 2) : key;\n\n        if (attr === 'html') {\n            elem.innerHTML = i18next.t(key, extendDefault(opts, elem.innerHTML));\n        } else if (attr === 'text') {\n            elem.textContent = i18next.t(key, extendDefault(opts, elem.textContent));\n        } else if (attr === 'prepend') {\n            var startIdx = elem.innerHTML.indexOf('<loc-i18n>');\n            var endIdx = elem.innerHTML.indexOf('</loc-i18n>') + 11;\n            if (startIdx > -1 && endIdx > 6) {\n                elem.innerHTML = [elem.innerHTML.substring(0, startIdx), elem.innerHTML.slice(endIdx)].join('');\n            }\n            elem.innerHTML = ['<loc-i18n>', i18next.t(key, extendDefault(opts, elem.innerHTML)), '</loc-i18n>', elem.innerHTML].join('');\n        } else if (attr === 'append') {\n            var _startIdx = elem.innerHTML.indexOf('<loc-i18n>');\n            var _endIdx = elem.innerHTML.indexOf('</loc-i18n>') + 11;\n            if (_startIdx > -1 && _endIdx > 6) {\n                elem.innerHTML = [elem.innerHTML.substring(0, _startIdx), elem.innerHTML.slice(_endIdx)].join('');\n            }\n            elem.innerHTML = [elem.innerHTML, '<loc-i18n>', i18next.t(key, extendDefault(opts, elem.innerHTML), '</loc-i18n>')].join('');\n        } else if (attr.indexOf('data-') === 0) {\n            var dataAttr = attr.substr('data-'.length);\n            var translated = i18next.t(key, extendDefault(opts, elem.getAttribute(dataAttr)));\n            // we change into the data cache\n            elem.setAttribute(dataAttr, translated);\n            // we change into the dom\n            elem.setAttribute(attr, translated);\n        } else {\n            elem.setAttribute(attr, i18next.t(key, extendDefault(opts, elem.getAttribute(attr))));\n        }\n    };\n\n    function relaxedJsonParse(badJSON) {\n        return JSON.parse(badJSON.replace(/:\\s*\"([^\"]*)\"/g, function (match, p1) {\n            return ': \"' + p1.replace(/:/g, '@colon@') + '\"';\n        }).replace(/:\\s*'([^']*)'/g, function (match, p1) {\n            return ': \"' + p1.replace(/:/g, '@colon@') + '\"';\n        }).replace(/(['\"])?([a-z0-9A-Z_]+)(['\"])?\\s*:/g, '\"$2\": ').replace(/@colon@/g, ':'));\n    }\n\n    function _loc(elem, opts) {\n        var key = elem.getAttribute(options.selectorAttr);\n        //        if (!key && typeof key !== 'undefined' && key !== false)\n        //            key = elem.textContent || elem.innerHTML;\n        if (!key) return;\n\n        var target = elem,\n            targetSelector = elem.getAttribute(options.targetAttr);\n\n        if (targetSelector != null) target = elem.querySelector(targetSelector) || elem;\n\n        if (!opts && options.useOptionsAttr === true) opts = relaxedJsonParse(elem.getAttribute(options.optionsAttr) || '{}');\n\n        opts = opts || {};\n\n        if (key.indexOf(';') >= 0) {\n            var keys = key.split(';');\n            for (var ix = 0, l_ix = keys.length; ix < l_ix; ix++) {\n                if (keys[ix] != '') parse(target, keys[ix], opts);\n            }\n        } else {\n            parse(target, key, opts);\n        }\n\n        if (options.useOptionsAttr === true) {\n            var clone = {};\n            clone = _extends({ clone: clone }, opts);\n            delete clone.lng;\n            elem.setAttribute(options.optionsAttr, JSON.stringify(clone));\n        }\n    }\n\n    function handle(selector, opts) {\n        var elems = options.document.querySelectorAll(selector);\n        for (var i = 0; i < elems.length; i++) {\n            var elem = elems[i];\n            var childs = elem.querySelectorAll('[' + options.selectorAttr + ']');\n            for (var j = childs.length - 1; j > -1; j--) {\n                _loc(childs[j], opts);\n            }\n            _loc(elem, opts);\n        }\n    };\n    return handle;\n}\n\nexports.default = {\n    init: init\n};","// The following script fixes a bug in DNN 08.00.04\r\n// the bug tries to detect a module-ID based on classes in a tag,\r\n// but uses a bad regex and captures the number 2 on all 2sxc-modules\r\n// instead of the real id\r\n// this patch changes the order of the className of 2sxc modules when\r\n// they are accessed through '$.fn.attr'\r\n// 'DnnModule-2sxc DnnModule-xxx' -> DNN thinks the mod id is 2 (false)\r\n// 'DnnModule-xxx DnnModule-2sxc' -> DNN thinks the mod id is xxx (correct)\r\n// documented here https://github.com/2sic/2sxc/issues/986\r\n\r\n/**\r\n * Fix drag-drop functionality in dnn 08.00.04 - it has an incorrect regex\r\n */\r\n'use strict';\r\n\r\n(() => {\r\n  if (window.$ == null) return;\r\n\r\n  const fn = $.fn.attr;\r\n  $.fn.attr = function() {\r\n    const val = fn.apply(this, arguments);\r\n    if (arguments[0] !== 'class' || typeof val !== 'string' || val.search('DnnModule-2sxc ') === -1) return val;\r\n    return val.replace('DnnModule-2sxc ', '') + ' DnnModule-2sxc';\r\n  };\r\n})();\r\n","/*\r\n * Author: Alex Gibson\r\n * https://github.com/alexgibson/shake.js\r\n * License: MIT license\r\n */\r\n\r\n(function(global, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        define(function() {\r\n            return factory(global, global.document);\r\n        });\r\n    } else if (typeof module !== 'undefined' && module.exports) {\r\n        module.exports = factory(global, global.document);\r\n    } else {\r\n        global.Shake = factory(global, global.document);\r\n    }\r\n} (typeof window !== 'undefined' ? window : this, function (window, document) {\r\n\r\n    'use strict';\r\n\r\n    function Shake(options) {\r\n        //feature detect\r\n        this.hasDeviceMotion = 'ondevicemotion' in window;\r\n\r\n        this.options = {\r\n            threshold: 15, //default velocity threshold for shake to register\r\n            timeout: 1000 //default interval between events\r\n        };\r\n\r\n        if (typeof options === 'object') {\r\n            for (var i in options) {\r\n                if (options.hasOwnProperty(i)) {\r\n                    this.options[i] = options[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        //use date to prevent multiple shakes firing\r\n        this.lastTime = new Date();\r\n\r\n        //accelerometer values\r\n        this.lastX = null;\r\n        this.lastY = null;\r\n        this.lastZ = null;\r\n\r\n        //create custom event\r\n        if (typeof document.CustomEvent === 'function') {\r\n            this.event = new document.CustomEvent('shake', {\r\n                bubbles: true,\r\n                cancelable: true\r\n            });\r\n        } else if (typeof document.createEvent === 'function') {\r\n            this.event = document.createEvent('Event');\r\n            this.event.initEvent('shake', true, true);\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    //reset timer values\r\n    Shake.prototype.reset = function () {\r\n        this.lastTime = new Date();\r\n        this.lastX = null;\r\n        this.lastY = null;\r\n        this.lastZ = null;\r\n    };\r\n\r\n    //start listening for devicemotion\r\n    Shake.prototype.start = function () {\r\n        this.reset();\r\n        if (this.hasDeviceMotion) {\r\n            window.addEventListener('devicemotion', this, false);\r\n        }\r\n    };\r\n\r\n    //stop listening for devicemotion\r\n    Shake.prototype.stop = function () {\r\n        if (this.hasDeviceMotion) {\r\n            window.removeEventListener('devicemotion', this, false);\r\n        }\r\n        this.reset();\r\n    };\r\n\r\n    //calculates if shake did occur\r\n    Shake.prototype.devicemotion = function (e) {\r\n        var current = e.accelerationIncludingGravity;\r\n        var currentTime;\r\n        var timeDifference;\r\n        var deltaX = 0;\r\n        var deltaY = 0;\r\n        var deltaZ = 0;\r\n\r\n        if ((this.lastX === null) && (this.lastY === null) && (this.lastZ === null)) {\r\n            this.lastX = current.x;\r\n            this.lastY = current.y;\r\n            this.lastZ = current.z;\r\n            return;\r\n        }\r\n\r\n        deltaX = Math.abs(this.lastX - current.x);\r\n        deltaY = Math.abs(this.lastY - current.y);\r\n        deltaZ = Math.abs(this.lastZ - current.z);\r\n\r\n        if (((deltaX > this.options.threshold) && (deltaY > this.options.threshold)) || ((deltaX > this.options.threshold) && (deltaZ > this.options.threshold)) || ((deltaY > this.options.threshold) && (deltaZ > this.options.threshold))) {\r\n            //calculate time in milliseconds since last shake registered\r\n            currentTime = new Date();\r\n            timeDifference = currentTime.getTime() - this.lastTime.getTime();\r\n\r\n            if (timeDifference > this.options.timeout) {\r\n                window.dispatchEvent(this.event);\r\n                this.lastTime = new Date();\r\n            }\r\n        }\r\n\r\n        this.lastX = current.x;\r\n        this.lastY = current.y;\r\n        this.lastZ = current.z;\r\n\r\n    };\r\n\r\n    //event handler\r\n    Shake.prototype.handleEvent = function (e) {\r\n        if (typeof (this[e.type]) === 'function') {\r\n            return this[e.type](e);\r\n        }\r\n    };\r\n\r\n    return Shake;\r\n}));\r\n","\r\nexport enum LogEntryOptions {\r\n    log = 'log',\r\n    warn = 'warn',\r\n    error = 'error',\r\n    throw = 'throw',\r\n}","import { Button } from '../toolbar/config/button';\r\n\r\nexport class Command {\r\n    constructor(public name: string) {\r\n    }\r\n\r\n    /** the defaults are important for new buttons that just know this command */\r\n    buttonDefaults: Partial<Button>;\r\n\r\n    protected merge(icon: string, translateKey: string, uiOnly: boolean, partOfPage: boolean, more: Partial<Button>): void {\r\n        this.buttonDefaults = {\r\n            icon: (_) => `icon-sxc-${icon}`,\r\n            title: (_) => `Toolbar.${translateKey}`,\r\n            uiActionOnly: (_) => uiOnly,\r\n            partOfPage: (_) => partOfPage,\r\n            ...more,\r\n        };\r\n    }\r\n\r\n    static build(name: string,\r\n                 translateKey: string,\r\n                 icon: string,\r\n                 uiOnly: boolean,\r\n                 partOfPage: boolean,\r\n                 more: Partial<Button>,\r\n                 ): Command {\r\n\r\n        if (typeof (partOfPage) !== 'boolean')\r\n            throw 'partOfPage in commands not provided, order will be wrong!';\r\n\r\n        const commandDefinition = new Command(name);\r\n\r\n        // Toolbar API v2\r\n        commandDefinition.merge(icon, translateKey, uiOnly, partOfPage, more);\r\n\r\n        return commandDefinition;\r\n    }\r\n}\r\n","/**\r\n * Special version which is filled in during compile by the definePlugin\r\n * The real version comes from the main package.json file in this repo\r\n * The sub-projects also use this version\r\n */\r\ndeclare const ROOTVERSION: string;\r\n\r\nexport const ToSxcName = \"2sxc\";\r\n\r\nexport const SxcVersion = ROOTVERSION;\r\n\r\nexport const SxcApiUrlRoot = 'desktopmodules/2sxc/api/';\r\n\r\nexport const HeaderNames = {\r\n    // 2sxc specific header\r\n    ContentBlockId: \"ContentBlockId\",\r\n\r\n    // headers as defined by DNN\r\n    ModuleId: \"ModuleId\",\r\n    TabId: \"TabId\",\r\n\r\n    // Header which should replace \"TabId\" in the long run\r\n    PageId: \"PageId\",\r\n};\r\n\r\nexport const ApiUrlRoots = ['app', 'app-sys', 'app-api', 'app-query', 'app-content', 'eav', 'view', 'dnn'];\r\nexport const AppApiMarker = 'app';\r\n\r\n// TODO: this should later lead to remapping of old url calls, but it's not in use yet\r\n// note that these were always 'auto' so `app-content` would need to be come `app/auto/content`\r\nexport const AppApiMap = {\r\n    'app-api': 'app/[name]/api',\r\n    'app-query': 'app/[name]/query',\r\n    'app-content': 'app/[name]/content'\r\n};\r\n\r\n// These are Not-Defined-IDs.\r\n// Because\r\n\r\n/**\r\n * This is a marker for an ID which is not defined\r\n * This is for situations where a 0 or even a negative number\r\n * could be real numbers, so this number is so big, it should never be a real ID\r\n */\r\nexport const NumberNotDefinedHuge = 274200000000;\r\n","import { Log } from '.';\r\nimport { HasLog as IHasLog } from '../../sxc-typings/index';\r\nexport abstract class HasLog  implements Omit<IHasLog, 'log'> {\r\n  log: Log;\r\n\r\n  /**\r\n   * initialize the logger\r\n   * ideally it has a parent-logger to attach to\r\n   * @param logName name to show in the logger\r\n   * @param parentLog parent-logger to attach to\r\n   * @param initialMessage optional start-message to log\r\n   */\r\n  constructor(logName: string, private parentLog?: Log, initialMessage?: string) {\r\n    this.initLogInternal(logName, parentLog, initialMessage);\r\n  }\r\n\r\n  public initLog = (name: string, parentLog?: Log, initialMessage?: string)\r\n    : void => this.initLogInternal(name, parentLog, initialMessage)\r\n\r\n  private initLogInternal(name: string, parentLog?: Log, initialMessage?: string): void {\r\n    if (this.log == null)\r\n        // standard & most common case: just create log\r\n        this.log = new Log(name, parentLog, initialMessage);\r\n    else {\r\n    // late-init case, where the log was already created - just reconfig keeping what was in it\r\n      this.log.rename(name);\r\n      this.log.linkLog(parentLog);\r\n      if (initialMessage != null)\r\n        this.log.add(initialMessage);\r\n    }\r\n  }\r\n\r\n}\r\n","import { Entry, LogCall } from '.';\r\nimport { Log as ILog } from '../../sxc-typings/index';\r\n\r\nconst keepData = location.search.indexOf(\"debug=true\") !== -1;\r\n\r\nconst maxScopeLen = 3;\r\nconst maxNameLen = 6;\r\nconst liveDump = false;\r\nconst maxEntriesReached = 'Maximum amount of entries added to log, will stop adding more';\r\n\r\nexport class Log implements ILog {\r\n\r\n    /**\r\n     * all log-entries on this logger\r\n     */\r\n    entries = new Array<Entry>();\r\n    private depth = 0;\r\n    private callDepths: string[] = [];\r\n    startTime: number;\r\n\r\n    /**\r\n     * Maximum amount of entries to add - to prevent memory hoging\r\n     */\r\n    maxEntries = 1000;\r\n\r\n    /**\r\n     * Create a logger and optionally attach it to a parent logger\r\n     * @param string name this logger should use\r\n     * @param Log optional parrent logger to attach to\r\n     * @param string optional initial message to log\r\n     */\r\n    constructor(name: string, parent?: Log, initialMessage?: string) {\r\n        this.rename(name);\r\n        this.linkLog(parent);\r\n        this.startTime = new Date().getTime();\r\n        if (initialMessage != null) this.add(initialMessage);\r\n    }\r\n\r\n    /* if we should live-dump, can be selectively activated */\r\n    liveDump: boolean = liveDump;\r\n    _parentHasLiveDump: boolean = false;\r\n    keepData: boolean = keepData; //Debug.urlState; // C.Debug.urlState;\r\n    _parentHasKeepData: boolean = false;\r\n\r\n    /**\r\n     * Full identifier of this log-object, with full hierarchy\r\n     */\r\n    fullIdentifier = (): string =>\r\n        `${(this.parent ? this.parent.fullIdentifier() : '')}${this.identifier()}`\r\n\r\n    /**\r\n     * give this logger a new name\r\n     * usually happens in constructor, but in rare cases\r\n     * it's called manually\r\n     * @param name\r\n     */\r\n    rename(name: string): void {\r\n        try {\r\n            const dot = name.indexOf('.');\r\n            this.scope = dot > 0 ? name.substr(0, Math.min(dot, maxScopeLen)) + '.' : '';\r\n            const rest = dot > 0 ? name.substr(dot + 1) : name;\r\n            this.name = rest.substr(0, Math.min(rest.length, maxNameLen));\r\n            this.name = this.name.substr(0, Math.min(this.name.length, maxNameLen));\r\n        } catch (e) {\r\n            /* ignore */\r\n        }\r\n    }\r\n\r\n    /**\r\n     * link this log to a parent\r\n     * usually happens in constructor, but in rare cases\r\n     * this must be called manually\r\n     */\r\n    linkLog = (parent: Log): void => {\r\n        this.parent = parent || this.parent; // if new parent isn't defined, don't replace\r\n        if (this.parent) {\r\n            this._parentHasLiveDump = this.parent.liveDump || this.parent._parentHasLiveDump;\r\n            this._parentHasKeepData = this.parent.keepData || this.parent._parentHasKeepData;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add a message to the log-list\r\n     * @param message\r\n     *\r\n     * preferred usage is with string parameter:\r\n     * log.add(`description ${ parameter }`);\r\n     *\r\n     * in case that we experience error with normal string parameter, we can use arrow function to enclose parameter like this () => parameter\r\n     * but use it very rarely, because there is certainly a performance implication!\r\n     * log.add(`description ${() => parameter}`);\r\n     */\r\n    add(message: (() => string) | string, data?: unknown): string {\r\n        // check if the log is already too big\r\n        if(this.entries.length > this.maxEntries) \r\n            return this._prepareMessage(message);\r\n\r\n        // if we just reached the max, add special message\r\n        if(this.entries.length === this.maxEntries) \r\n            this._addEntry(this._prepareEntry(maxEntriesReached));\r\n\r\n        const entry = this._prepareEntry(message, data);\r\n        this._addEntry(entry);\r\n        return entry.message;\r\n    }\r\n\r\n    addData(message: (() => string) | string, data: unknown): void {\r\n        if (this.logData()) this.add(message, data);\r\n    }\r\n\r\n    logData(): boolean {\r\n        return this.keepData || this._parentHasKeepData;\r\n    }\r\n\r\n    _prepareEntry(message: (() => string) | string, data?: unknown): Entry {\r\n        const msg = this._prepareMessage(message);\r\n        const time = new Date().getTime() - this.startTime;\r\n        const entry = new Entry(this, msg, this.depth, time, data);\r\n        return entry;\r\n    }\r\n\r\n    private _prepareMessage(message: (() => string) | string): string {\r\n        if (message instanceof Function) {\r\n            try {\r\n                return ((message as () => string)());\r\n            } catch (e) {\r\n                return 'err: message undefined';\r\n            }\r\n        }\r\n        return message.toString();\r\n    }\r\n\r\n\r\n    call(name: string, callParams?: string, message?: string, data?: {[key:string]: unknown }): LogCall {\r\n        return new LogCall(this, name, callParams, message, data);\r\n    }\r\n\r\n    _callDepthAdd(name: string): void {\r\n        this.depth++;\r\n        this.callDepths.push(name);\r\n    }\r\n\r\n    _callDepthRemove(name: string): void {\r\n        this.depth--;\r\n        const last = this.callDepths.pop();\r\n        if (last !== name) {\r\n            console.warn(`log: call depth reduced by '${name}' but last was '${last}'`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * helper to create a text-output of the log info\r\n     * @param separator\r\n     * @param start\r\n     * @param end\r\n     */\r\n    dump(one: Entry = null, separator = ' - '): void {\r\n        if (one) this.dumpOne(0, one, separator);\r\n        else this.dumpList();\r\n    }\r\n\r\n    dumpList(start: number = 0, length?: number) {\r\n        let index = start;\r\n        this.entries\r\n            .slice(start, length ? start + length : undefined           )\r\n            .forEach((e) => this.dumpOne(index++, e));\r\n    }\r\n\r\n    private dumpOne(index: number, e: Entry, separator = ' - '): void {\r\n        const result = (e.result) ? ' =' + e.result : '';\r\n        const line = ('0000' + index).slice(-4) + ' ' + e.source() + separator + '..'.repeat(e.depth) + e.message + result;\r\n        if (e.data) console.log(line, e.data);\r\n        else console.log(line);\r\n    }\r\n\r\n\r\n    /**\r\n     * add an entry-object to this logger\r\n     * this is often called by sub-loggers to add to parent\r\n     * @param entry\r\n     */\r\n    _addEntry(entry: Entry): void {\r\n        if (this.liveDump) this.dump(entry);\r\n        this.entries.push(entry);\r\n        if (this.parent) this.parent._addEntry(entry);\r\n    }\r\n\r\n    /**\r\n     * helper to generate a random 2-char ID\r\n     * @param stringLength\r\n     */\r\n    private randomString(stringLength: number): string {\r\n        const chars = '0123456789abcdefghiklmnopqrstuvwxyz';\r\n        let randomstring = '';\r\n        for (let i = 0; i < stringLength; i++) {\r\n            const rnum = Math.floor(Math.random() * chars.length);\r\n            randomstring += chars.substring(rnum, rnum + 1);\r\n        }\r\n        return randomstring;\r\n    }\r\n\r\n    /**\r\n     * parent logger - important if loggers are chained\r\n     */\r\n    private parent: Log;\r\n\r\n    /**\r\n     * scope of this logger - to easily see which ones\r\n     * are about the same topic\r\n     */\r\n    private scope = 'tdo';\r\n\r\n    /**\r\n     * name of this logger\r\n     */\r\n    public name = 'unknwn';\r\n\r\n\r\n    /**\r\n     * Unique 2-character ID of this specific log object\r\n     */\r\n    private id = (): string => this.idCache || (this.idCache = this.randomString(2));\r\n    private idCache: string;\r\n\r\n    /**\r\n     * Unique identifier of this log object, with name and ID\r\n     */\r\n    private identifier = (): string => `${this.scope}${this.name}(${this.id()})`;\r\n\r\n}\r\n","import { Entry, Log, LogEntryOptions as LEO } from '.';\r\n\r\nexport class LogCall {\r\n    /** The initial entry created - important for later attaching the final result of the call */\r\n    public initialEntry: Entry;\r\n\r\n    constructor(public log: Log, public name: string, callParams?: string, message?: string, data?: {[key:string]: unknown }) {\r\n        this.initialEntry = this.log._prepareEntry(name + '(' + (callParams || '') + ')');\r\n        this.log._callDepthAdd(name);\r\n        this.log._addEntry(this.initialEntry);\r\n        if (typeof message === 'string') this.add(message);\r\n        if (data) for (let key in data) this.data('initial:' + key, data[key]);\r\n    }\r\n\r\n    private lastMessage: string;\r\n\r\n    add(message: string, data?: unknown, behavior?: LEO) {\r\n        this.lastMessage = message;\r\n        this.log.add(message, data);\r\n        if (behavior) this.processExtraBehavior(behavior, message, data);\r\n    }\r\n\r\n    onlyAddIfNew(message: string, behavior?: LEO) {\r\n        if (this.lastMessage !== message)\r\n        this.add(message);\r\n        if (behavior) this.processExtraBehavior(behavior, message, undefined);\r\n    }\r\n\r\n    /** Add data - but only if data logging is enabled */\r\n    data(message: string, data: unknown) {\r\n        this.log.addData(message, data);\r\n    }\r\n\r\n    done(message?: string, behavior?: LEO): void {\r\n        this.return(null, message || '👍', behavior);\r\n    }\r\n\r\n    return<T>(result: T, message?: string, behavior?: LEO) {\r\n        message = message || '👍';\r\n        this.initialEntry.result = message;\r\n        this.log._callDepthRemove(this.name);\r\n\r\n        // if we're in keep-data / debug mode, keep that\r\n        this.initialEntry.data = result;\r\n\r\n        // if we're in live-dump mode, then the entry was already dumped, show again\r\n        if (this.log.liveDump || this.log._parentHasLiveDump)\r\n            this.add(this.name + ' = ' + message, result);\r\n\r\n        if (behavior) this.processExtraBehavior<T>(behavior, message, result);\r\n        return result;\r\n    }\r\n\r\n    /* \r\n     * treat all extra output or errors\r\n     * to allow setting a debug stop point when needed\r\n     * then you can trace the stack-call to see where the error originated\r\n     */\r\n    private processExtraBehavior<T>(behavior: LEO, message: string, data: T) {\r\n        if (behavior === LEO.log) console.log(message, data);\r\n        if (behavior === LEO.warn) console.warn(message, data);\r\n        if (behavior === LEO.error || behavior === LEO.throw) console.error(message, data);\r\n        if (behavior === LEO.throw) throw message;\r\n    }\r\n}\r\n","\r\n/**\r\n * Object manipulator helpers\r\n */\r\nexport class Obj {\r\n    /**\r\n     * This is the same as Object.assign, but type-safe.\r\n     * Use it as a replacetment for Object.Assign(this, ... ) in constructors\r\n     */\r\n    static TypeSafeAssign <T, K extends keyof T>(...args: T[]) {\r\n        args.reduce( (result, current) =>\r\n            (Object.keys(current) as K[]).reduce((target, key) => {\r\n                target[key] = current[key];\r\n                return target;\r\n            }, result)\r\n        , args[0]);\r\n    }\r\n\r\n    static DeepClone<T>(original: T, ignoreCircular = false): T {\r\n        if(original === undefined || original === null)\r\n            return original;\r\n        const str = ignoreCircular ? JSON.stringify(original, getCircularReplacer) : JSON.stringify(original);\r\n        if(str === undefined || str === null)\r\n            return original;\r\n        return JSON.parse(str) as T;\r\n    }\r\n}\r\n\r\n\r\nconst getCircularReplacer = () => {\r\n    const seen = new WeakSet();\r\n    return (_:any, value: any) => {\r\n      if (typeof value === \"object\" && value !== null) {\r\n        if (seen.has(value)) {\r\n          return;\r\n        }\r\n        seen.add(value);\r\n      }\r\n      return value;\r\n    };\r\n  };","\r\n\r\nexport function urlClean(original: string): string {\r\n  return original.replace(/(\\/+)/g, '/');\r\n}","export class NoJQ {\r\n\r\n    /** https://api.jquery.com/ready/ */\r\n    static ready(callback: () => void): void {\r\n        if (document.readyState === 'complete') {\r\n            callback();\r\n        } else {\r\n            document.addEventListener('DOMContentLoaded', () => callback(), { once: true });\r\n        }\r\n    }\r\n\r\n    /** https://api.jquery.com/jquery.param/ */\r\n    static param(obj: any): string {\r\n        const param = Object.entries(obj)\r\n            .map(([k, v]) => `${encodeURIComponent(k)}=${v == null ? '' : typeof v === 'string' ? encodeURIComponent(v) : encodeURIComponent(JSON.stringify(v))}`)\r\n            .join('&');\r\n        return param;\r\n    }\r\n\r\n    /** Build DOM elements from string */\r\n    static domFromString(string: string): HTMLElement[] {\r\n        // build elements from string into dummy parent\r\n        const dummyParent = document.createElement('div');\r\n        dummyParent.insertAdjacentHTML('afterbegin', string);\r\n\r\n        // scripts created from string are not executable and have to recreated manually to be executable\r\n        Array.from(dummyParent.querySelectorAll('script')).forEach((brokenScript) => {\r\n            const workingScript = document.createElement('script');\r\n            // copy attributes\r\n            Array.from(brokenScript.attributes).forEach((attribute) => {\r\n                workingScript.setAttribute(attribute.nodeName, attribute.nodeValue);\r\n            });\r\n            // copy inline part\r\n            workingScript.textContent = brokenScript.textContent;\r\n            // replace a non executable script with executable one\r\n            NoJQ.replaceWith(brokenScript, workingScript, false);\r\n        });\r\n\r\n        // remove created elements from dummy parent so it can be garbage collected\r\n        const elements = Array.from(dummyParent.children) as HTMLElement[];\r\n        elements.forEach((element) => {\r\n            dummyParent.removeChild(element);\r\n        });\r\n        return elements;\r\n    }\r\n\r\n    /** https://api.jquery.com/offset/ */\r\n    static offset(element: HTMLElement): { left: number; top: number; } {\r\n        const clientRect = element.getBoundingClientRect();\r\n        const offset: { left: number; top: number; } = {\r\n            top: clientRect.top + window.scrollY,\r\n            left: clientRect.left + window.scrollX,\r\n        };\r\n        return offset;\r\n    }\r\n\r\n    /** https://api.jquery.com/width/ */\r\n    static width(element: HTMLElement): number {\r\n        // jquery width === offsetWidth - borders - padding\r\n        const computedStyle = getComputedStyle(element);\r\n        const width = element.offsetWidth === 0\r\n            ? 0\r\n            : element.offsetWidth\r\n            - (parseInt(computedStyle.getPropertyValue('border-left-width'), 10) + parseInt(computedStyle.getPropertyValue('border-right-width'), 10))\r\n            - (parseInt(computedStyle.getPropertyValue('padding-left'), 10) + parseInt(computedStyle.getPropertyValue('padding-right'), 10));\r\n        return width;\r\n    }\r\n\r\n    /** https://api.jquery.com/height/ */\r\n    static height(element: HTMLElement): number {\r\n        // jquery height === offsetHeight - borders - padding\r\n        const computedStyle = getComputedStyle(element);\r\n        const height = element.offsetHeight === 0\r\n            ? 0\r\n            : element.offsetHeight\r\n            - (parseInt(computedStyle.getPropertyValue('border-top-width'), 10) + parseInt(computedStyle.getPropertyValue('border-bottom-width'), 10))\r\n            - (parseInt(computedStyle.getPropertyValue('padding-top'), 10) + parseInt(computedStyle.getPropertyValue('padding-bottom'), 10));\r\n        return height;\r\n    }\r\n\r\n    /** https://api.jquery.com/outerWidth/ */\r\n    static outerWidth(element: HTMLElement): number {\r\n        const outerWidth = element.offsetWidth;\r\n        return outerWidth;\r\n    }\r\n\r\n    /** https://api.jquery.com/empty/ */\r\n    static empty(element: HTMLElement): void {\r\n        Array.from(element.childNodes).forEach((n) => {\r\n            element.removeChild(n);\r\n        });\r\n    }\r\n\r\n    /** https://api.jquery.com/replacewith/ */\r\n    static replaceWith(toBeReplaced: HTMLElement, newElement: HTMLElement, runScripts: boolean): void {\r\n        const parent = toBeReplaced.parentElement;\r\n\r\n        // disable scripts before replacing dom\r\n        const scripts = Array.from(newElement.querySelectorAll('script'));\r\n        const restores: ScriptTypeRestore[] = [];\r\n        scripts.forEach((script) => {\r\n            restores.push({ script, type: script.type });\r\n            script.type = null;\r\n        });\r\n\r\n        // replace dom\r\n        parent.replaceChild(newElement, toBeReplaced);\r\n\r\n        // enable scripts\r\n        restores.forEach((restore) => {\r\n            restore.script.type = restore.type;\r\n        });\r\n\r\n        if (runScripts) {\r\n            // run scripts manually to ensure proper timing\r\n            AssetsLoader.runScripts(scripts, undefined);\r\n        }\r\n    }\r\n\r\n    /** https://api.jquery.com/append/ */\r\n    static append(parent: HTMLElement, newElements: HTMLElement[], runScripts: boolean): void {\r\n        const scripts: HTMLScriptElement[] = [];\r\n\r\n        newElements.forEach((element) => {\r\n            if (element.tagName.toLocaleLowerCase() === 'script') {\r\n                const script = element as HTMLScriptElement;\r\n                // disable script before inserting to the dom\r\n                const restoreType = script.type;\r\n                script.type = null;\r\n                // insert to dom\r\n                parent.appendChild(script);\r\n                // enable script\r\n                script.type = restoreType;\r\n                scripts.push(script);\r\n            } else {\r\n                parent.appendChild(element);\r\n            }\r\n        });\r\n\r\n        if (runScripts && scripts.length > 0) {\r\n            // run scripts manually to ensure proper timing\r\n            AssetsLoader.runScripts(scripts, undefined);\r\n        }\r\n    }\r\n}\r\n\r\nexport class AssetsLoader {\r\n\r\n    /** Asynchronously runs external and inline scripts in series */\r\n    static runScripts(scripts: HTMLScriptElement[], callback: () => void): void {\r\n        const script = scripts[0];\r\n        const others = scripts.slice(1);\r\n        if (script == null) {\r\n            callback?.();\r\n            return;\r\n        }\r\n\r\n        // create copy\r\n        const copy = document.createElement('script');\r\n        // attributes\r\n        Array.from(script.attributes).forEach((attribute) => {\r\n            copy.setAttribute(attribute.nodeName, attribute.nodeValue);\r\n        });\r\n        // inline part\r\n        copy.textContent = script.textContent;\r\n\r\n        // if src then insert in head, wait for onload or onerror, remove from head and move to next one\r\n        if (copy.type && copy.src) {\r\n            const listener = () => {\r\n                copy.onload = null;\r\n                copy.onerror = null;\r\n                document.head.removeChild(copy);\r\n                this.runScripts(others, callback);\r\n            };\r\n            copy.onload = listener;\r\n            copy.onerror = listener;\r\n            document.head.appendChild(copy);\r\n            return;\r\n        }\r\n\r\n        // if no src then inline, insert to head and remove instantly and move to next one\r\n        setTimeout(() => {\r\n            document.head.appendChild(copy);\r\n            document.head.removeChild(copy);\r\n            this.runScripts(others, callback);\r\n        });\r\n    }\r\n}\r\n\r\ninterface ScriptTypeRestore {\r\n    script: HTMLScriptElement;\r\n    type: string;\r\n}\r\n","export enum DialogPaths {\r\n    quickDialog = 'dist/ng/ui.html', // quick-dialog\r\n    ng8 = 'dist/ng-edit/index.html', // Angular\r\n}\r\n","import { Obj } from '../plumbing';\r\nimport { Log } from '.';\r\n\r\nexport class Entry {\r\n\r\n    /** The result of an operation - treated differently in the output */\r\n    public result: string;\r\n\r\n\r\n    /** Data which is logged - if data-logging is enabled */\r\n    get data(): unknown {\r\n        return this._data;\r\n    }\r\n    set data(data: unknown) {\r\n        if (data === undefined) return;\r\n        if (this.log.logData())\r\n            this._data = Obj.DeepClone(data, true);\r\n    }\r\n    private _data?: unknown;\r\n\r\n    public source = (): string => this.log.fullIdentifier();\r\n\r\n    constructor(\r\n        private log: Log,\r\n        public message: string,\r\n        public depth: number,\r\n        /** A timestamp for this entry to better see sequences of things happening */\r\n        public time: number,\r\n        data?: unknown,\r\n        ) {\r\n            if (data) {\r\n                // #2492 - jQuery isn't used any more in 2sxc\r\n                // if (data instanceof jQuery) {\r\n                //     const jq = data as JQuery;\r\n                //     this.data = {\r\n                //         isJQuery: true,\r\n                //         original: jq,\r\n                //         html: jq.length && jq[0].outerHTML,\r\n                //     };\r\n                // } \r\n                // else\r\n                    this.data = data;\r\n            }\r\n    }\r\n\r\n}\r\n","import { HasLog, Log } from '.';\r\n\r\ntype LogList = Array<{ key: string, log: Log}>;\r\n\r\nconst msgIntro = 'This is the $2sxc JS Insights - see https://r.2sxc.org/insights \\n'\r\n    + 'Add ?debug=true to the url to log more data. \\n'\r\n    + 'Copy/paste code lines below to see details. \\n'\r\n    + '----------------------------------------------------------------------\\n';\r\n\r\nclass InsightsSingleton extends HasLog {\r\n\r\n    constructor() {\r\n        super('Sys.Insght');\r\n        this.add('system', 'insights', this.log);\r\n        this.log.add(`this log is usually empty, as it's just a helper tool`)\r\n    }\r\n\r\n    history: { [key: string]: InsightsLogSet } = {};\r\n\r\n    add(setName: string, logName: string, log: Log ) {\r\n        if (!(setName in this.history))\r\n            this.history[setName] = new InsightsLogSet(setName);\r\n        this.history[setName].logs.push({key: logName, log: log});\r\n    }\r\n\r\n    show(partName: string, index?: number, start?: number, length?: number): void {\r\n        // if nothing specified, list what to do to see inner parts\r\n        if (!partName) {\r\n            const keys = Object.keys(this.history);\r\n            console.log(`${msgIntro}${keys.length} insights-sections found: \\n` + keys.map((p) => `$2sxc.insights('${p}');`).join('\\n'));\r\n            return;\r\n        }\r\n\r\n        // partName found, check if it exists\r\n        const part = this.history[partName];\r\n        if (!part) {\r\n            console.error(`part '${partName}' not found`);\r\n            return;\r\n        }\r\n\r\n        // We have a partName, but no index - show list and how to get details\r\n        if (index === undefined) {\r\n            let count = 0;\r\n            const logNames = part.logs\r\n                .map((s) => `$2sxc.insights('${partName}', ${count++}); - will show for '${s.key}'`)\r\n                .join('\\n');\r\n            console.log(`'${partName}' contains ${part.logs.length} entries. Copy/paste the code to to see the logs: \\n` + logNames);\r\n            return;\r\n        }\r\n\r\n        // verify the entry exists\r\n        const logSet = part.logs.length >= index && part.logs[index];\r\n        if (!logSet) {\r\n            console.error(`index ${index} not found in part '${partName}'`);\r\n            return;\r\n        }\r\n\r\n        if (!logSet.log) {\r\n            console.error(`found index ${index} on part '${partName}' but it has no logs`);\r\n            return;\r\n        }\r\n\r\n        console.log(`Will dump the log for ${partName}[${index}] '${logSet.key}'`);\r\n        let autoLimit = false;\r\n        if (start === undefined) {\r\n            autoLimit = true;\r\n            start = 0;\r\n            length = 25;\r\n        }\r\n        logSet.log.dumpList(start || 0, length);\r\n        if (autoLimit && logSet.log.entries.length > length)\r\n            console.warn(`Only showing ${length} of ${logSet.log.entries.length} logs. To show all, add start param '..., 0)' or start/length '..., 0, 100)'`)\r\n}\r\n}\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nclass InsightsLogSet {\r\n    logs: LogList = [];\r\n    constructor(public name: string) {}\r\n}\r\n\r\n// ensure it's only created once\r\n// this is important, because the inpage code also uses this class\r\n// and would otherwise create the object separately\r\nconst singleton: InsightsSingleton = \r\n    window.$2sxc && window.$2sxc._insights   // try to load existing\r\n    || new InsightsSingleton();             // otherwise create new\r\n\r\nexport const Insights = singleton;\r\n","import { HasLog, Insights } from '../logging';\r\nimport { Button } from '../toolbar/config';\r\nimport { Command } from './command';\r\n\r\n/** Singleton Catalog of all commands */\r\nexport class Commands extends HasLog {\r\n\r\n  /** Singleton */\r\n  public static singleton(): Commands {\r\n    return this._singleton ?? (this._singleton = new Commands());\r\n  }\r\n  private static _singleton: Commands;\r\n\r\n  public static add(name: string, translateKey: string, icon: string, uiOnly: boolean, partOfPage: boolean, more: Partial<Button>): Command {\r\n    return this.singleton().add(name, translateKey, icon, uiOnly, partOfPage, more);\r\n  }\r\n\r\n\r\n\r\n  private commandList: Command[] = [];\r\n  list: HashTable<Command> = {}; // hash - table of action definitions, to be used a list()[\"action - name\"]\r\n\r\n  private constructor() {\r\n      super('Cmd.Catlog');\r\n      Insights.add('system', 'command-catalog', this.log);\r\n  }\r\n\r\n  get = (name: string) => this.list[name]; // a specific action definition\r\n\r\n  add(name: string, translateKey: string, icon: string, uiOnly: boolean, partOfPage: boolean,\r\n      more: Partial<Button>): Command {\r\n      const cmd = this.addDef(Command.build(name, translateKey, icon, uiOnly, partOfPage, more));\r\n      this.log.add(`add command '${name}'`, cmd);\r\n      return cmd;\r\n  }\r\n\r\n  private addDef(def: Command): Command {\r\n    if (!this.list[def.name]) {\r\n      // add\r\n      this.commandList.push(def);\r\n      this.list[def.name] = def;\r\n    } else if (this.list[def.name] !== def) {\r\n      // update\r\n      this.list[def.name] = def;\r\n    }\r\n    return def;\r\n  }\r\n\r\n}\r\n","import { ContextComplete } from '../../context';\r\n\r\n/**\r\n * Shared logic like for deciding if we show list buttons\r\n * here\r\n */\r\nexport class SharedLogic {\r\n    static isPartOfBlockList(context: ContextComplete) {\r\n        return !!(context.contentBlock.isList &&\r\n            context.button.command.params.useModuleList &&\r\n            context.button.command.params.sortOrder !== -1);    // -1 is the header item\r\n    }\r\n\r\n    /**\r\n     * This will tell us, if the item is being referenced (like in a list)\r\n     * It's similar to isBlockList, but will return true even if it's\r\n     * a non-list (single item only)\r\n     */\r\n    static isBlockReference(context: ContextComplete) {\r\n        return !!context.button.command.params.useModuleList;    // -1 is the header item\r\n    }\r\n\r\n    static isFieldList(context: ContextComplete) {\r\n        const params = context.button?.command.params;\r\n        return !!(params?.fields && params?.parent);\r\n    }\r\n\r\n    static isList(context: ContextComplete) {\r\n        return this.isPartOfBlockList(context) || this.isFieldList(context);\r\n    }\r\n\r\n    static isReferencedItem(context: ContextComplete) {\r\n        return this.isBlockReference(context) || this.isFieldList(context);\r\n    }\r\n}\r\n","    /*\r\n    * This just holds some constants, but it looks like _LayoutElement is unused - but I think it should be!\r\n    */\r\n    export class ContentBlock {\r\n    // constants\r\n    static cViewWithoutContent: string = '_LayoutElement'; // needed to differentiate the \"select item\" from the \"empty-is-selected\" which are both empty\r\n    static UseExistingTemplate = -1;\r\n    }\r\n\r\n\r\n    /** ContentBlock constants  */\r\n    export const ContentBlockIds = {\r\n        classes: {\r\n        name: 'sc-content-block',\r\n        },\r\n        selectors: {\r\n        ofName: '.sc-content-block',\r\n        },\r\n    };\r\n","\r\nexport const IDs = {\r\n  // classes\r\n  cls: {\r\n    scMenu: 'sc-menu',\r\n  },\r\n  attr: {\r\n    toolbar: 'toolbar',\r\n    toolbarData: 'data-toolbar',\r\n    settings: 'settings',\r\n    settingsData: 'data-settings',\r\n  },\r\n  publishAllowed: 'DraftOptional',\r\n  sel: {\r\n    scMenu: '.sc-menu',\r\n    tagScMenu: 'ul.sc-menu',\r\n  },\r\n};\r\n","import { Attributes } from './attributes';\r\nimport { ContentBlock, ContentBlockIds } from './content-block';\r\nimport { Debug } from './debug';\r\nimport { DialogPaths } from './dialog-paths';\r\nimport { IDs } from './ids';\r\nimport { ToolbarConstants } from './toolbar';\r\n\r\n\r\nexport const C = {\r\n    ContentBlock: ContentBlock,\r\n    DialogPaths: DialogPaths,\r\n    IDs: IDs,\r\n    Attributes: Attributes,\r\n    Toolbar: ToolbarConstants,\r\n    Cb: ContentBlockIds,\r\n    Debug: Debug,\r\n};\r\n","// namespace Constants {\r\n    export const Attributes = {\r\n        InstanceId: 'data-cb-instance',\r\n        Context: 'data-edit-context',\r\n        ContentBlockId: 'data-cb-id',\r\n    };\r\n// }\r\n","\r\n// The parts themselves must also be constants\r\n\r\nexport const ToolbarConstants = {\r\n  attrToMarkInitalized: '2sxc-tagtoolbar',\r\n  attr: {\r\n    full: 'sxc-toolbar',\r\n    hover: 'sxc-toolbar-hover',\r\n    disable: 'data-disable-toolbar',\r\n  },\r\n  classes: {\r\n    oldHover: 'sc-element',\r\n  },\r\n  selectors: {\r\n    ofOldHover: '.sc-element',\r\n  },\r\n  eventNames: {\r\n    onInit: 'toolbar-init',\r\n  },\r\n};\r\n","export const Debug = {\r\n    cms: {\r\n        autoDump: false,\r\n        run: true,\r\n    },\r\n};\r\n","\r\nexport class UrlParamManager {\r\n    get(name: string) {\r\n        // warning: this method is duplicated in 2 places - keep them in sync.\r\n        // locations are eav and 2sxc4ng\r\n        name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\r\n        const searchRx = new RegExp('[\\\\?&]' + name + '=([^&#]*)', 'i');\r\n        let results = searchRx.exec(location.search);\r\n        let strResult: string;\r\n\r\n        if (results === null) {\r\n            const hashRx = new RegExp('[#&]' + name + '=([^&#]*)', 'i');\r\n            results = hashRx.exec(location.hash);\r\n        }\r\n\r\n        // if nothing found, try normal URL because DNN places parameters in /key/value notation\r\n        if (results === null) {\r\n            // Otherwise try parts of the URL\r\n            const matches = window.location.pathname.match(new RegExp('/' + name + '/([^/]+)', 'i'));\r\n\r\n            // Check if we found anything, if we do find it, we must reverse the\r\n            // results so we get the \"last\" one in case there are multiple hits\r\n            if (matches && matches.length > 1)\r\n                strResult = matches.reverse()[0];\r\n        } else\r\n            strResult = results[1];\r\n\r\n        return strResult === null || strResult === undefined\r\n            ? ''\r\n            : decodeURIComponent(strResult.replace(/\\+/g, ' '));\r\n    }\r\n\r\n    require(name: string) {\r\n        const found = this.get(name);\r\n        if (found === '') {\r\n            const message = `Required parameter (${name}) missing from url - cannot continue`;\r\n            alert(message);\r\n            throw message;\r\n        }\r\n        return found;\r\n    }\r\n\r\n    debug(): boolean {\r\n        return this.get('debug') === 'true'\r\n    }\r\n}\r\n","\r\nexport class TotalPopup {\r\n    frame: any = undefined;\r\n    callback: any = undefined;\r\n\r\n    open(url: string, callback: () => void): void {\r\n        // count parents to see how high the z-index needs to be\r\n        let z = 10000010; // Needs at least 10000000 to be on top of the DNN9 bar\r\n        let p = window as Window;\r\n        while (p !== window.top && z < 10000100) {\r\n            z++;\r\n            p = p.parent;\r\n        }\r\n\r\n        const wrapper = document.createElement('div');\r\n        wrapper.setAttribute('style', ' top: 0;left: 0;width: 100%;height: 100%; position:fixed; z-index:' + z);\r\n        document.body.appendChild(wrapper);\r\n\r\n        const ifrm = document.createElement('iframe');\r\n        ifrm.setAttribute('allowtransparency', 'true');\r\n        ifrm.setAttribute('style', 'top: 0;left: 0;width: 100%;height: 100%;');\r\n        ifrm.setAttribute('src', url);\r\n        wrapper.appendChild(ifrm);\r\n        document.body.className += ' sxc-popup-open';\r\n        this.frame = ifrm;\r\n        this.callback = callback;\r\n    }\r\n\r\n    close(): void {\r\n        if (this.frame) {\r\n            document.body.className = document.body.className.replace('sxc-popup-open', '');\r\n            const frm = this.frame;\r\n            frm.parentNode.parentNode.removeChild(frm.parentNode);\r\n            this.callback();\r\n        }\r\n    }\r\n\r\n    closeThis(): void {\r\n        (window.parent as any).$2sxc.totalPopup.close();\r\n    }\r\n\r\n}\r\n","\r\n/** This is a placeholder in the settings, which must be replaced with \"2sxc\" or another term for other dnn extensions */\r\nexport const ApiExtensionPlaceholder = 'e.x.t';\r\n\r\n/** The special header meta tag containing settings for 2sxc */\r\nexport const MetaHeaderJsApi = '_jsApi';\r\n\r\n/** The fallback path to the UI */\r\nexport const DnnUiRoot = '/desktopmodules/tosic_sexycontent/';\r\n\r\nexport const PlatformOqtane = 'oqtane';\r\nexport const PlatformDnn = 'dnn';\r\n\r\n/** The fallback AntiForgery token header name (as in Dnn) */\r\nexport const AntiForgeryTokenHeaderNameDnn = 'RequestVerificationToken';\r\n","import { Environment } from '.';\r\nimport { HasLog, NoJQ, Window } from '..';\r\nimport { JsInfo } from '../../../sxc-typings';\r\nimport { AntiForgeryTokenHeaderNameDnn, DnnUiRoot, PlatformDnn } from '../constants/index';\r\n\r\nconst helpAutoDetect = 'You must either include jQuery on the page or inject the jsApi parameters to prevent auto-detection.';\r\ndeclare const window: Window;\r\n\r\n/**\r\n * This helps load environment information from DNN ServicesFramework - it's a fallback in case the other mechanisms fail\r\n */\r\nexport class EnvironmentDnnSfLoader extends HasLog {\r\n    constructor(public env: Environment) {\r\n        super('Env.DnnLdr', env.log);\r\n    }\r\n\r\n\r\n    /**\r\n     * This will assume the new parameter injection failed and it will attempt to fallback\r\n     * it's for backward compatibility, in case something is using $2sxc and doesn't provide the new\r\n     * implementation\r\n     */\r\n    dnnSfFallback(): void {\r\n        const cl = this.log.call('dnnSfFallback');\r\n        // await page-ready to then initialize the stuff\r\n        NoJQ.ready(() => this.dnnSfLoadWhenDocumentReady());\r\n        cl.done('started dom-ready watcher')\r\n    }\r\n\r\n    private dnnSfLoadWhenDocumentReady(): void {\r\n        const cl = this.log.call('dnnSfLoadWhenDocumentReady');\r\n        if (typeof window.$ === 'undefined') {\r\n            cl.done('error');\r\n            throw `Can't load pageid, moduleid, etc. and $ is not available. \\n ${helpAutoDetect}`;\r\n        }\r\n\r\n        const sf = window.$.ServicesFramework;\r\n        if (typeof sf === 'undefined') {\r\n            cl.done('error');\r\n            throw `Can't load pageid, moduleid etc. and DNN SF is not available. \\n ${helpAutoDetect}`;\r\n        }\r\n        const dnnSf = sf(0);\r\n        var apiRoot = dnnSf.getServiceRoot('2sxc');\r\n        var sfJsInfo: JsInfo = {\r\n            page: dnnSf.getTabId(),\r\n            root: 'unknown',\r\n            api: apiRoot,\r\n            appApi: apiRoot,\r\n            rvtHeader: AntiForgeryTokenHeaderNameDnn,\r\n            rvt: dnnSf.getAntiForgeryValue(),\r\n            uiRoot: DnnUiRoot,\r\n            platform: PlatformDnn,\r\n        };\r\n        this.env.load(sfJsInfo, 'dnn SF');\r\n        cl.done();\r\n    }\r\n}\r\n","import * as Public from '../../../sxc-typings/index';\r\nimport { Log } from '..';\r\nimport { EnvironmentMetaLoader } from './env-loader-meta';\r\n\r\nconst InputValue = 'value';\r\n\r\nconst SelectorInputRvt = `input[name=__RequestVerificationToken]`;\r\n\r\n/**\r\n * Special loader for dynamic pages like Oqtane, where content can change at runtime\r\n */\r\nexport class EnvironmentLoaderDynamic {\r\n\r\n  public log: Log;\r\n\r\n  constructor(\r\n      private mainLoader: EnvironmentMetaLoader\r\n  ) {\r\n    this.log = new Log('ldr.dynmic', mainLoader.log);\r\n  }\r\n\r\n  /**\r\n   * Watch for changes in our special meta header, to update the variables.\r\n   * Important for Oqtane, which changes the page on the fly without reloading.\r\n   */\r\n  public startMetaTagObserver(attribute: string): void {\r\n    if (!!this.observer) return;\r\n    this.observer = new MutationObserver((mutationsList: MutationRecord[]) => {\r\n      for(const mut of mutationsList)\r\n        if (mut.type === 'attributes' && mut.attributeName === attribute)\r\n          this.mainLoader.updateEnv(JSON.parse(this.mainLoader.getMetaContent()) as Public.JsInfo)\r\n    });\r\n    this.log.add('start observing meta tag');\r\n    this.observer.observe(this.mainLoader.getJsApiMetaTag(), { attributes: true, childList: false, subtree: false });\r\n  }\r\n  private observer: MutationObserver;\r\n\r\n  /**\r\n   * Load RequestVerificationToken from the hidden form-field in Oqtane\r\n   */\r\n  public startInputRvtObserver(): void {\r\n    if (!!this.inputRvtObserver) return;\r\n    this.inputRvtObserver = new MutationObserver((mutationsList: MutationRecord[]) => {\r\n      for(const mut of mutationsList)\r\n        if (mut.type === 'attributes' && mut.attributeName === InputValue)\r\n          this.loadRvtFromHiddenInput(mut.target as HTMLInputElement);\r\n    });\r\n    this.log.add('start observing Rvt Input');\r\n    const hiddenField = document.querySelector(SelectorInputRvt);\r\n    this.loadRvtFromHiddenInput(hiddenField as HTMLInputElement);\r\n    this.inputRvtObserver.observe(hiddenField, { attributes: true, childList: false, subtree: false });\r\n  }\r\n  private inputRvtObserver: MutationObserver;\r\n\r\n  private loadRvtFromHiddenInput(input: HTMLInputElement){\r\n    this.log.add('Input Rvt updated');\r\n    if(input && input.value)\r\n      this.mainLoader.env.updateRvt(input.value);\r\n  }\r\n}\r\n","import * as Public from '../../../sxc-typings/index';\r\nimport { Environment } from '.';\r\nimport { EnvironmentDnnSfLoader } from './env-loader-dnn-sf';\r\nimport { MetaHeaderJsApi, PlatformOqtane } from '../constants';\r\nimport * as Log from '..';\r\nimport { EnvironmentLoaderDynamic } from './env-loader-dynamic';\r\n\r\n// temp: usually 10, but because Oqtane has some delays, we'll temporarily increase to 100 till we're safe\r\nconst maxRetries = 100;\r\nconst retryMs = 10;\r\n\r\nconst MetaSourceId = 'meta header';\r\n\r\nconst MetaProperty = 'content';\r\n\r\n\r\nfunction logTest(): boolean\r\n{\r\n    console.log('test');\r\n    return true;\r\n}\r\n/**\r\n * This loads environment information from the meta-header tag.\r\n * Because of timing issues, it will try multiple times\r\n */\r\nexport class EnvironmentMetaLoader extends Log.HasLog {\r\n    public retries = 0;\r\n\r\n    public log: Log.Log;\r\n\r\n    private dynamicPageHelper: EnvironmentLoaderDynamic;\r\n\r\n    constructor(public env: Environment) {\r\n        super('Env.MetaLd', logTest ? env.log : env.log);\r\n        this.dynamicPageHelper = new EnvironmentLoaderDynamic(this);\r\n    }\r\n\r\n    public loadMetaFromHeader(forceFallback = false): void {\r\n        const cl = this.log.call('loadMetaFromHeader', `${forceFallback}`);\r\n        // avoid duplicate execution\r\n        if(this.env.ready) return cl.done('loadMeta - ready');\r\n\r\n        this.log.add('loadMetaFromHeader: start, retry:' + this.retries + ', force fallback: ' + forceFallback);\r\n        const meta = this.getMetaContent();\r\n        if(!meta) {\r\n            this.retries++;\r\n            if(forceFallback || this.retries >= maxRetries) {\r\n                new EnvironmentDnnSfLoader(this.env).dnnSfFallback();\r\n                return cl.done()\r\n            }\r\n            setTimeout(() => { this.loadMetaFromHeader(); }, retryMs);\r\n            return cl.done('will retry');\r\n        }\r\n        // Load the settings\r\n        this.updateEnv(JSON.parse(meta) as Public.JsInfo);\r\n\r\n        // monitor setting changes - important for Oqtane\r\n        this.dynamicPageHelper.startMetaTagObserver(MetaProperty);\r\n        cl.done();\r\n    }\r\n\r\n    public updateEnv(newJsInfo: Public.JsInfo) {\r\n        this.log.add('meta env info updated');\r\n        this.env.load(newJsInfo, MetaSourceId);\r\n        if(newJsInfo.platform === PlatformOqtane)\r\n            this.dynamicPageHelper.startInputRvtObserver();\r\n    }\r\n\r\n    public getMetaContent(): string {\r\n        const ourMeta = this.getJsApiMetaTag();\r\n        if (!ourMeta) return null;\r\n        return ourMeta.getAttribute(MetaProperty)\r\n    }\r\n\r\n    public getJsApiMetaTag() {\r\n        return document.querySelector(`meta[name=${MetaHeaderJsApi}]`);\r\n    }\r\n\r\n\r\n    /**\r\n     * Watch for changes in our special meta header, to update the variables.\r\n     * Important for Oqtane, which changes the page on the fly without reloading.\r\n     */\r\n    public startMetaTagObserver(): void {\r\n      if (!!this.observer) return;\r\n      this.observer = new MutationObserver((mutationsList: MutationRecord[]) => {\r\n        for(const mut of mutationsList)\r\n          if (mut.type === 'attributes' && mut.attributeName === MetaProperty)\r\n            this.updateEnv(JSON.parse(this.getMetaContent()) as Public.JsInfo)\r\n      });\r\n      this.log.add('start observing meta tag');\r\n      this.observer.observe(this.getJsApiMetaTag(), { attributes: true, childList: false, subtree: false });\r\n    }\r\n    private observer: MutationObserver;\r\n\r\n}\r\n","import * as Public from '../../../sxc-typings/index';\r\nimport { EnvironmentMetaLoader } from './env-loader-meta';\r\nimport { HasLog, Insights, SxcApiUrlRoot } from '..';\r\nimport { AntiForgeryTokenHeaderNameDnn, DnnUiRoot, PlatformDnn } from '../constants';\r\n\r\ndeclare const _jsApi: Public.JsInfo;\r\n\r\n/**\r\n * Provides environment information to $2sxc - usually page-id, api-root and stuff like that\r\n */\r\nexport class Environment extends HasLog implements Public.Environment {\r\n    private header: Public.JsInfo;\r\n    public ready = false;\r\n    public source = '';\r\n\r\n    public metaLoader: EnvironmentMetaLoader;\r\n\r\n    constructor() {\r\n        super('Environment', null, 'starting');\r\n        this.log.keepData = true;   // always keep here for clarity\r\n        Insights.add('system', 'environment', this.log);\r\n        this.metaLoader = new EnvironmentMetaLoader(this);\r\n\r\n        // check if a global variable was already set which we should use\r\n        if(typeof _jsApi !== typeof undefined) {\r\n            this.log.add('found _jsApi, will use');\r\n            this.load(_jsApi, 'global variable _jsApi');\r\n        } else {\r\n            this.log.add('will start initializing');\r\n            this.metaLoader.loadMetaFromHeader();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load a new jsInfo - must be public, as it's used in iframes where jquery is missing\r\n     * @param newJsInfo new info to load\r\n     */\r\n    public load(newJsInfo: Public.JsInfo, source?: string) {\r\n        const cl = this.log.call('load');\r\n        if(newJsInfo.root && !newJsInfo.api) {\r\n            cl.add('root provided, api missing, will auto-complete');\r\n            const addSlash = (newJsInfo.root.endsWith('/') ? '' : '/');\r\n            newJsInfo.api = `${newJsInfo.root}${addSlash}${SxcApiUrlRoot}`;\r\n        }\r\n        this.header = newJsInfo;\r\n\r\n        // in some cases the UpdateRvt may already have been called before\r\n        // in which case it's probably more relevant\r\n        // so we should set it again\r\n        if(this.replacedRvt) this.header.rvt = this.replacedRvt;\r\n\r\n        this.ready = true;\r\n        this.source = source || 'external/unknown' + (this.replacedRvt ? '+rvt': '');\r\n        cl.return(newJsInfo, 'loaded from ' + this.source);\r\n    }\r\n\r\n    private replacedRvt: string;\r\n    public updateRvt(newRvt: string) {\r\n        if(!newRvt) return;\r\n        this.replacedRvt = newRvt;\r\n        this.header.rvt = newRvt;\r\n    }\r\n\r\n    public api(): string {\r\n        this.ensureReadyOrThrow('api');\r\n        return this.header.api;\r\n    }\r\n\r\n    // WIP - may return undefined\r\n    public appApi(): string {\r\n        // WIP - must get it to work without 'appApi' but only 'api' to ensure ...\r\n        this.ensureReadyOrThrow('appApi');\r\n        return this.header.appApi;\r\n    }\r\n\r\n    public page(): number {\r\n        this.ensureReadyOrThrow('page');\r\n        return this.header.page;\r\n    }\r\n\r\n    public rvtHeader(): string {\r\n        this.ensureReadyOrThrow('rvtHeader');\r\n        return this.header.rvtHeader || AntiForgeryTokenHeaderNameDnn;\r\n    }\r\n\r\n    public rvt(): string {\r\n        this.ensureReadyOrThrow('rvt');\r\n        return this.header.rvt;\r\n    }\r\n\r\n    public uiRoot(): string {\r\n        this.ensureReadyOrThrow('uiRoot');\r\n        return this.header.uiRoot || DnnUiRoot;\r\n    }\r\n\r\n    public platform(): string {\r\n        this.ensureReadyOrThrow('platform');\r\n        return this.header.platform || PlatformDnn;\r\n    }\r\n\r\n    private ensureReadyOrThrow(partRequested: string): void {\r\n        if(this.ready) return;\r\n\r\n        // try one last time - usually it should really be ready by now\r\n        this.log.add('ensureReady - force last attempt to load MetaHeader for ' + partRequested)\r\n        this.metaLoader.loadMetaFromHeader(true);\r\n\r\n        // if still not ready, throw exception to console log\r\n        if(this.ready) return;\r\n        throw `Can't find ${partRequested} - something went wrong, pls contact 2sxc.org`;\r\n    }\r\n\r\n}\r\n\r\n","import { SxcInstance, SxcWebApi } from '..';\r\nimport { NoJQ, Window } from '../..';\r\nimport { AjaxSettings } from './ajax-settings';\r\n\r\ndeclare const window: Window;\r\n\r\nexport class AjaxPromise {\r\n  constructor(private api: SxcWebApi, private sxc: SxcInstance) {\r\n  }\r\n\r\n  /**\r\n   * Make a jQuery style promise request\r\n   * @param {AjaxSettings} settings\r\n   * @returns {JQueryPromise<any>}\r\n   * @memberof AjaxPromise\r\n   */\r\n  public makePromise(settings: AjaxSettings): JQueryPromise<any> {\r\n    var headers = this.api.headers();\r\n    // debugger;\r\n    if (window.$ == null) {\r\n      throw new Error('JQuery is now removed from 2sxc installation. Please use newer api like fetch or include JQuery in your project');\r\n    }\r\n    const promise = window.$.ajax({\r\n      async: true,\r\n      dataType: settings.dataType || 'json', // default is json if not specified\r\n      data: JSON.stringify(settings.data),\r\n      contentType: 'application/json',\r\n      type: settings.method,\r\n      url: this.getActionUrl(settings),\r\n      beforeSend(xhr: JQueryXHR) {\r\n        for (var key in headers)\r\n          if (headers.hasOwnProperty(key))\r\n            xhr.setRequestHeader(key, headers[key]);\r\n      },\r\n    }) as JQueryPromise<any>;\r\n\r\n    if (!settings.preventAutoFail)\r\n      promise.fail(this.sxc.showDetailedHttpError);\r\n\r\n    return promise;\r\n  }\r\n\r\n\r\n  /**\r\n   * Generate the correct WebApi url\r\n   * @param settings the settings as they would be in jQuery\r\n   */\r\n  private getActionUrl(settings: AjaxSettings): string {\r\n    var url = settings.url || 'app/auto/api/' + settings.controller + '/' + settings.action;\r\n    // 2020-03-13 stop adding 2sxc endpoint-name, it's already happening in apiUrl so with this it happens 2x\r\n    // var endpoint = settings.endpoint || ToSxcName;\r\n    var base = this.sxc.root.http.apiUrl(url, settings.endpoint);\r\n    // let base = (settings.url)\r\n    //   ? this.sxc.root.http.apiUrl(settings.url) // this.sxc.resolveServiceUrl(settings.url)  // use url -> TODO: change this to use the new root.http.apiUrl\r\n    //   : env.apiRoot('2sxc')               // use controller/action\r\n    //     + 'app/auto/api/' + settings.controller + '/' + settings.action;\r\n\r\n    // if(settings.endpoint)\r\n    //     base = base.replace(env.apiRoot('2sxc'), \r\n    //         env.apiRoot(settings.endpoint));\r\n\r\n    return base + (!settings.params ? '' : ('?' + NoJQ.param(settings.params)));\r\n  }\r\n}\r\n","import * as Public from '../../../sxc-typings';\r\nimport { ApiExtensionPlaceholder, PlatformDnn, PlatformOqtane } from '../constants';\r\nimport { AppApiMarker, HeaderNames, ToSxcName } from '..';\r\nimport { Environment, HasLog } from '..';\r\n\r\nexport class SxcHttp extends HasLog implements Omit<Public.Http, 'log'> {\r\n    constructor(private env: Environment) {\r\n        super('Sxc.Http');\r\n    }\r\n\r\n    /**\r\n     * All the headers which are needed in an ajax call for this to work reliably.\r\n     * Use this if you need to get a list of headers in another system\r\n     */\r\n    headers(id?: number, cbid?: number): Public.Dictionary<string> {\r\n        const cl = this.log.call('headers', `${id}, ${cbid}`);\r\n        const fHeaders : Public.Dictionary<string> = {}; // as any;\r\n        const pageId = this.env.page().toString();\r\n        if(id) fHeaders[HeaderNames.ModuleId] = id.toString();\r\n        if(cbid) fHeaders[HeaderNames.ContentBlockId] = cbid.toString();\r\n        fHeaders[HeaderNames.TabId] = pageId;\r\n        fHeaders[HeaderNames.PageId] = pageId;\r\n        fHeaders[this.env.rvtHeader()] = this.env.rvt();\r\n        return cl.return(fHeaders, `headers(id:${id}, cbid:${cbid})`);\r\n    }\r\n\r\n    /**\r\n     * Get the API-Root path for a specific extension/endpoint\r\n     * @param {string} endpointName\r\n     * @returns {string}\r\n     * @memberof SxcHttp\r\n     */\r\n    apiRoot(endpointName: string): string {\r\n        const cl = this.log.call('apiRoot');\r\n        var result = this.env.api().replace(ApiExtensionPlaceholder, endpointName);\r\n        return cl.return(result, `apiRoot('${endpointName}')`);\r\n    }\r\n\r\n    /**\r\n     * Get the API-Root path for Apps\r\n     * new in v12\r\n     * @param {string} endpointName\r\n     * @returns {string}\r\n     * @memberof SxcHttp\r\n     */\r\n     appApiRoot(): string {\r\n        const cl = this.log.call('appApiRoot');\r\n        // try to get it, or fall back to the previous / old convention\r\n        var result = this.env.appApi() ?? this.apiRoot(ToSxcName);\r\n        return cl.return(result, `appApiRoot()`);\r\n    }\r\n\r\n    /**\r\n     * Get the URL for a specific web API endpoint\r\n     * Will ignore urls which clearly already are the full url.\r\n     * @param {string} url\r\n     * @param {string} [endpointName]\r\n     * @returns\r\n     * @memberof SxcHttp\r\n     */\r\n    apiUrl(url: string, endpointName?: string)\r\n    {\r\n        const cl = this.log.call('apiUrl');\r\n        this.log.add(`apiUrl(url:'${url}', endpointName:'${endpointName}')`);\r\n\r\n        // null/undefined check\r\n        if(url == null) return url;\r\n\r\n        // if starts with http: or https: then ignore\r\n        if(!url || url.indexOf('http:') == 0 || url.indexOf('https:') == 0 || url.indexOf('//') == 0)\r\n            return cl.return(url);\r\n\r\n        // if no endpoint specified, then also skip absolute and relative urls\r\n        if(!endpointName && (url.indexOf('/') == 0 || url.indexOf('.') == 0))\r\n            return cl.return(url);\r\n\r\n        var baseUrl = url.toLocaleLowerCase().startsWith(AppApiMarker)\r\n            ? this.appApiRoot()\r\n            : this.apiRoot(endpointName || ToSxcName);\r\n\r\n\r\n        // ensure base ends with slash\r\n        if(baseUrl[baseUrl.length-1] != '/') baseUrl += '/';\r\n        // ensure url doesn't start with slash\r\n        if(url[0] == '/') url = url.slice(1);\r\n        return cl.return(baseUrl + url);\r\n    }\r\n}\r\n","import * as Public from '../../../../sxc-typings/index';\r\nimport { SxcInstance } from '../sxc-instance';\r\nimport { AjaxPromise } from './ajax-promise';\r\nimport { Environment } from '../../environment';\r\nimport { AjaxSettings } from './ajax-settings';\r\nimport { NoJQ } from '../..';\r\n\r\n/**\r\n * helper API to run ajax / REST calls to the server\r\n * it will ensure that the headers etc. are set correctly\r\n * and that urls are rewritten\r\n */\r\nexport class SxcWebApi implements Public.SxcWebApi {\r\n    public readonly env: Environment;\r\n    constructor(\r\n        private readonly sxc: SxcInstance,\r\n        // private readonly id: number,\r\n        // private readonly cbid: number,\r\n        // public readonly env: Environment\r\n    ) {\r\n        this.env = sxc.root.env;\r\n    }\r\n    /**\r\n     * returns an http-get promise\r\n     * @param settingsOrUrl the url to get\r\n     * @param params jQuery style ajax parameters\r\n     * @param data jQuery style data for post/put requests\r\n     * @param preventAutoFail\r\n     * @returns {Promise} jQuery ajax promise object\r\n     */\r\n    get(settingsOrUrl: string | AjaxSettings, params?: any, data?: any, preventAutoFail?: boolean): JQueryPromise<any> {\r\n        return this.request(settingsOrUrl, params, data, preventAutoFail, 'GET');\r\n    }\r\n\r\n    /**\r\n     * returns an http-get promise\r\n     * @param settingsOrUrl the url to get\r\n     * @param params jQuery style ajax parameters\r\n     * @param data jQuery style data for post/put requests\r\n     * @param preventAutoFail\r\n     * @returns {Promise} jQuery ajax promise object\r\n     */\r\n    post(settingsOrUrl: string | AjaxSettings, params?: any, data?: any, preventAutoFail?: boolean): JQueryPromise<any> {\r\n        return this.request(settingsOrUrl, params, data, preventAutoFail, 'POST');\r\n    }\r\n\r\n    /**\r\n     * returns an http-get promise\r\n     * @param settingsOrUrl the url to get\r\n     * @param params jQuery style ajax parameters\r\n     * @param data jQuery style data for post/put requests\r\n     * @param preventAutoFail\r\n     * @returns {Promise} jQuery ajax promise object\r\n     */\r\n    delete(settingsOrUrl: string | AjaxSettings, params?: any, data?: any, preventAutoFail?: boolean): JQueryPromise<any> {\r\n        return this.request(settingsOrUrl, params, data, preventAutoFail, 'DELETE');\r\n    }\r\n\r\n    /**\r\n     * returns an http-get promise\r\n     * @param settingsOrUrl the url to get\r\n     * @param params jQuery style ajax parameters\r\n     * @param data jQuery style data for post/put requests\r\n     * @param preventAutoFail\r\n     * @returns {Promise} jQuery ajax promise object\r\n     */\r\n    put(settingsOrUrl: string | AjaxSettings, params?: any, data?: any, preventAutoFail?: boolean): JQueryPromise<any> {\r\n        return this.request(settingsOrUrl, params, data, preventAutoFail, 'PUT');\r\n    }\r\n\r\n    /**\r\n     * Generic http request\r\n     * @param settingsOrUrl the url to get\r\n     * @param params jQuery style ajax parameters\r\n     * @param data jQuery style data for post/put requests\r\n     * @param preventAutoFail\r\n     * @param method the http verb name\r\n     * @returns {Promise} jQuery ajax promise object\r\n     */\r\n    request(settings: string | AjaxSettings, params: any, data: any, preventAutoFail: boolean, method: string): JQueryPromise<any> {\r\n\r\n        // url parameter: auto convert a single value (instead of object of values) to an id=... parameter\r\n        // tslint:disable-next-line:curly\r\n        if (typeof params !== 'object' && typeof params !== 'undefined')\r\n            params = { id: params };\r\n\r\n        // if the first parameter is a string, resolve settings\r\n        if (typeof settings === 'string') {\r\n            const controllerAction = settings.split('/');\r\n            const controllerName = controllerAction[0];\r\n            const actionName = controllerAction[1];\r\n\r\n            if (controllerName === '' || actionName === '')\r\n                console.warn('Error: controller or action not defined. Will continue with likely errors.');\r\n\r\n            settings = {\r\n                controller: controllerName,\r\n                action: actionName,\r\n                params,\r\n                data,\r\n                url: controllerAction.length > 2 ? settings : null,\r\n                preventAutoFail,\r\n            };\r\n        }\r\n\r\n        const defaults = {\r\n            method: method === null ? 'POST' : method,\r\n            params: null as any,\r\n            preventAutoFail: false,\r\n        };\r\n        // new 10.25\r\n        var http = new AjaxPromise(this, this.sxc);\r\n\r\n        settings = Object.assign({}, defaults, settings);\r\n\r\n        const promise = http.makePromise(settings as AjaxSettings);\r\n\r\n        return promise;\r\n    }\r\n\r\n    /**\r\n     * Will retrieve data from the backend using a standard fetch. \r\n     * @param url a full url or short-hand like `controller/method?params` `app/auto/api/controller/method?params`. Note that params would also be specified on the url. \r\n     * @param data optional POST data\r\n     * @param method optional method, defaults to `GET` unless it has data, in which case it defaults to `POST`\r\n     * @returns a Promise containing a Response object, just like a normal fetch would. \r\n     * example: webApi.fetch('Rss/Feed');\r\n     * example: webApi.fetch(webApi.url('Rss/Feed', { id: 47 })); // url params\r\n     * example: webApi.fetch('Rss/Feed', { id: 47 }); // post params\r\n     * example: webApi.fetch(webApi.url('Rss/Feed', { id: 47 }), { something: 'this is a test' }); // url & post params\r\n     * maybe: webApi.fetch({url: 'Rss/Feed', params: { id: 47 }})\r\n     * maybe: webApi.fetch({url: ..., params: { ...}, body: { ...}, method: 'GET' })\r\n     */\r\n    fetch(url: string, data?: string | Record<string, any>, method?: string): Promise<Response> {\r\n        url = this.url(url);\r\n        method = method || (data ? 'POST' : 'GET');\r\n        const headers = this.headers(method);\r\n\r\n        if (data) {\r\n            // test if data is a json. If it's not, convert it to json\r\n            try {\r\n                JSON.parse(data as string);\r\n            } catch {\r\n                data = JSON.stringify(data);\r\n            }\r\n        }\r\n\r\n        return fetch(url, {\r\n            headers,\r\n            method,\r\n            ...(data && { body: data as string }),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Will retrieve data from the backend using a standard fetch and give you an object. \r\n     * @param url a full url or short-hand like `controller/method?params` `app/auto/api/controller/method?params`. Note that params would also be specified on the url. \r\n     * @param data optional POST data\r\n     * @param method optional method, defaults to `GET` unless it has data, in which case it defaults to `POST`\r\n     * @returns a Promise containing any object.\r\n     */\r\n    fetchJson<T = any>(url: string, data?: string | Record<string, any>, method?: string): Promise<T> {\r\n        return this.fetch(url, data, method).then(response => response.json());\r\n    }\r\n\r\n    // data<T = any>(typeName: string, ids?: string, params?: string | Record<string, any>): Promise<T> {\r\n    //     if (typeName == null) throw 'typeName is empty';\r\n    //     if (typeName.indexOf('/') != -1 || typeName.indexOf('\\\\') != -1) throw 'typeName has slashes - not allowed';\r\n    //     let path = 'app/auto/content/' + typeName;\r\n    //     if (ids && typeof(ids) === 'string') path += '/' + ids;\r\n    //     return this.fetch(this.url(path, params)).then(response => response.json());\r\n    // }\r\n\r\n    // // TODO: must standardize how to handle url params\r\n    // // option 1: part of the query name\r\n    // // - great because it would be the same signature as fetch/fetchjson\r\n    // // - bad because the the first param isn't clearly just the name\r\n    // // - bad because the user must treat all edge cases like special characters\r\n    // // option 2: second parameter\r\n    // // discuss merits of each solution\r\n    // query<T = any>(query: string, params?: string | Record<string, any> /*, data?: string | Record<string, any> */): Promise<T> {\r\n    //     // Do initial checks to ensure query is really just the name\r\n    //     // Could have ? - that's fine, and after ? it could have /, but never before the ?\r\n    //     return this.fetch(this.url(query, params)/*, data*/).then(response => response.json());\r\n    // }\r\n\r\n    /**\r\n     * All the headers which are needed in an ajax call for this to work reliably.\r\n     * Use this if you need to get a list of headers in another system\r\n     * @param method Optional. If set, will add Accept or Content-Type headers\r\n     * @returns a Record / Dictionary of headers\r\n     */\r\n    headers(method?: string): Record<string, string> {\r\n        const headers = this.sxc.root.http.headers(this.sxc.id, this.sxc.cbid);\r\n        if (!method) {\r\n            return headers;\r\n        }\r\n\r\n        switch (method.toLocaleUpperCase()) {\r\n            case 'GET':\r\n                headers['Accept'] = 'application/json';\r\n                break;\r\n            default:\r\n                headers['Accept'] = 'application/json';\r\n                headers['Content-Type'] = 'application/json';\r\n        }\r\n        return headers;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param url A short, medium or long url. \r\n     * Short like `controller/method`, \r\n     * medium like `app/auto/api/controller/method`\r\n     * long like `https://xyz.\r\n     * In all cases it can also have ?params etc.\r\n     * @param params Optional parameters as string or object, will be added to url-params. \r\n     * @returns In the cases of a short/medium url, \r\n     * it will auto-expand to have the full url as needed for an API call. \r\n     */\r\n    url(url: string, params?: string | Record<string, any>): string {\r\n        if (url == null) return url;\r\n\r\n        const urlAndParams = url.split('#')[0].split('?');\r\n\r\n        // url fixes\r\n        url = urlAndParams[0];\r\n        const urlParts = url.split('/');\r\n        if (urlParts.length === 2 && urlParts[0] && urlParts[1]) {\r\n            const controller = urlParts[0];\r\n            const action = urlParts[1];\r\n            url = `app/auto/api/${controller}/${action}`;\r\n        }\r\n        url = this.sxc.root.http.apiUrl(url);\r\n\r\n        // params fixes\r\n        params = `${urlAndParams[1] || ''}&${params ? typeof params === 'string' ? params : NoJQ.param(params) : ''}`\r\n            .split('&')\r\n            .filter(p => !!p)\r\n            .join('&');\r\n\r\n        // result\r\n        url = [url, params].filter(p => !!p).join('?');\r\n        return url;\r\n    }\r\n}\r\n","import { ContextIdentifier } from './../sxc-root/context-identifier';\r\nimport * as Public from '../../../sxc-typings/index';\r\nimport { SxcWebApi } from './web-api/sxc-web-api';\r\nimport { ApiUrlRoots, ToSxcName } from '..';\r\nimport { SxcRoot } from '../sxc-root/sxc-root';\r\nimport { HasLog } from '..';\r\nimport { SxcRootInternals } from '../sxc-root/sxc-root-internals';\r\nimport { SxcInstanceManage } from './sxc-instance-manage';\r\n\r\n// const serviceScopes = ['app', 'app-sys', 'app-api', 'app-query', 'app-content', 'eav', 'view', 'dnn'];\r\n\r\n/**\r\n * The typical sxc-instance object for a specific DNN module or content-block\r\n */\r\nexport class SxcInstance extends HasLog implements Public.SxcInstance {\r\n    /**\r\n     * helpers for ajax calls\r\n     */\r\n    webApi: SxcWebApi;\r\n\r\n    /**\r\n     * The manage controller for edit/cms actions\r\n     *\r\n     * @type {*}\r\n     * @memberof SxcInstance\r\n     */\r\n    manage: SxcInstanceManage = null; // initialize correctly later on\r\n\r\n    constructor(\r\n        /** the sxc-instance ID, which is usually the DNN Module Id */\r\n        public id: number,\r\n        /** \r\n         * content-block ID, which is either the module ID, or the content-block definitiion entity ID\r\n         * this is an advanced concept you usually don't care about, otherwise you should research it \r\n         */\r\n        public cbid: number,\r\n        /** The environment information, important for http-calls */\r\n        public readonly root: SxcRoot & SxcRootInternals,\r\n        /**\r\n         * Custom context information provided by the constructor - will replace auto-context detection\r\n         */\r\n        public ctx?: ContextIdentifier,\r\n    ) {\r\n        super('SxcInstance', null, 'Generating for ' + id + ':' + cbid);\r\n        this.webApi = new SxcWebApi(this);\r\n\r\n        // add manage property, but not within initializer, because inside the manage-initializer it may reference 2sxc again\r\n        try { // sometimes the manage can't be built, like before installing\r\n            if (root._manage) root._manage.initInstance(this);\r\n        } catch (e) {\r\n            console.error('error in 2sxc - will only log but not throw', e);\r\n        }\r\n\r\n        // this only works when manage exists (not installing) and translator exists too\r\n        if (root._translateInit && this.manage)\r\n            // ensure that we really have a manage context, otherwise we can't initialize i18n and it doesn't make sense\r\n            if (this.manage.context && this.manage.context.app && this.manage.context.app.currentLanguage)\r\n                root._translateInit(this.manage);    // init translate, not really nice, but ok for now\r\n\r\n    }\r\n\r\n    /**\r\n     * converts a short api-call path like \"/app/Blog/query/xyz\" to the DNN full path\r\n     * which varies from installation to installation like \"/desktopmodules/api/2sxc/app/...\"\r\n     * @deprecated use http.apiUrl instead\r\n     * @param virtualPath\r\n     * @returns mapped path\r\n     */\r\n    resolveServiceUrl(virtualPath: string) {\r\n        const scope = virtualPath.split('/')[0].toLowerCase();\r\n\r\n        // stop if it's not one of our special paths\r\n        if (ApiUrlRoots.indexOf(scope) === -1)\r\n            return virtualPath;\r\n\r\n        return this.root.http.apiRoot(ToSxcName) + scope + '/' + virtualPath.substring(virtualPath.indexOf('/') + 1);\r\n    }\r\n\r\n\r\n    // Show a nice error with more infos around 2sxc\r\n    showDetailedHttpError(result: any): any {\r\n        if (window.console)\r\n            console.log(result);\r\n\r\n        // check if the error was just because a language file couldn't be loaded - then don't show a message\r\n        if (result.status === 404 &&\r\n            result.config &&\r\n            result.config.url &&\r\n            result.config.url.indexOf('/dist/i18n/') > -1) {\r\n            if (window.console)\r\n                console.log('just fyi: failed to load language resource; will have to use default');\r\n            return result;\r\n        }\r\n\r\n        // if it's an unspecified 0-error, it's probably not an error but a cancelled request,\r\n        // (happens when closing popups containing angularJS)\r\n        if (result.status === 0 || result.status === -1)\r\n            return result;\r\n\r\n        // let's try to show good messages in most cases\r\n        let infoText = 'Had an error talking to the server (status ' + result.status + ').';\r\n        const srvResp = result.responseText\r\n            ? JSON.parse(result.responseText) // for jquery ajax errors\r\n            : result.data; // for angular $http\r\n        if (srvResp) {\r\n            const msg = srvResp.Message;\r\n            if (msg) infoText += '\\nMessage: ' + msg;\r\n            const msgDet = srvResp.MessageDetail || srvResp.ExceptionMessage;\r\n            if (msgDet) infoText += '\\nDetail: ' + msgDet;\r\n\r\n\r\n            if (msgDet && msgDet.indexOf('No action was found') === 0)\r\n                if (msgDet.indexOf('that matches the name') > 0)\r\n                    infoText += '\\n\\nTip from 2sxc: you probably got the action-name wrong in your JS.';\r\n                else if (msgDet.indexOf('that matches the request.') > 0)\r\n                    infoText += '\\n\\nTip from 2sxc: Seems like the parameters are the wrong amount or type.';\r\n\r\n            if (msg && msg.indexOf('Controller') === 0 && msg.indexOf('not found') > 0)\r\n                infoText +=\r\n                    // tslint:disable-next-line:max-line-length\r\n                    \"\\n\\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word 'controller' from the call in JS. To call a controller called 'DemoController' only use 'Demo'.\";\r\n\r\n        }\r\n        // tslint:disable-next-line:max-line-length\r\n        infoText += '\\n\\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug';\r\n        alert(infoText);\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * checks if we're currently in edit mode\r\n     * @returns {boolean}\r\n     */\r\n    isEditMode(): boolean {\r\n        return (this.manage && this.manage._isEditMode()) === true;\r\n    }\r\n}\r\n","import { SxcRootInternals } from '../sxc-root/sxc-root-internals';\r\nimport { SxcRoot } from '../sxc-root/sxc-root';\r\nimport { SxcInstance, SxcInstanceDataDeprecated } from '.';\r\nimport { ContextIdentifier } from '../sxc-root/context-identifier';\r\n\r\nexport class SxcInstanceWithInternals extends SxcInstance {\r\n    data: SxcInstanceDataDeprecated;\r\n    source: any = null;\r\n    isLoaded = false;\r\n    lastRefresh: Date = null;\r\n\r\n    constructor(\r\n        public id: number,\r\n        public cbid: number,\r\n        public cacheKey: string,\r\n        protected $2sxc: SxcRoot & SxcRootInternals,\r\n        ctx?: ContextIdentifier\r\n    ) {\r\n        super(id, cbid, $2sxc, ctx);\r\n        this.data = new SxcInstanceDataDeprecated(this);\r\n    }\r\n\r\n    recreate(resetCache: boolean): SxcInstanceWithInternals {\r\n        if (resetCache) delete this.$2sxc._controllers[this.cacheKey]; // clear cache\r\n        return this.$2sxc(this.id, this.cbid) as any as SxcInstanceWithInternals; // generate new\r\n    }\r\n}\r\n","import { SxcInstanceWithInternals } from '..';\r\nimport { Window } from '../..';\r\n\r\ndeclare const window: Window;\r\n\r\n/**\r\n * This is a old 2sxc concept from 2sxc ca. V3\r\n * The idea was that each module could have it's own data and access it.\r\n * It would hide the internals of WebApis and just provide data. \r\n * This model isn't promoted or much in use any more, but included for compatibility\r\n */\r\nexport class SxcInstanceDataDeprecated {\r\n    source: any = undefined;\r\n\r\n    // in-streams\r\n    \"in\": any = {};\r\n\r\n    // will hold the default stream ([\"in\"][\"Default\"].List\r\n    List: any = [];\r\n\r\n    constructor(\r\n        private controller: SxcInstanceWithInternals,\r\n    ) {\r\n\r\n    }\r\n\r\n    // source path defaulting to current page + optional params\r\n    sourceUrl(params?: string): string {\r\n        let url = this.controller.root.http.apiUrl('app/auto/InstanceData');\r\n        if (typeof params === 'string') // text like 'id=7'\r\n            url += '&' + params;\r\n        return url;\r\n    }\r\n\r\n\r\n    // load data via ajax\r\n    load(source?: any) {\r\n        // if source is already the data, set it\r\n        if (source && source.List) {\r\n            return this.controller.data;\r\n        } else {\r\n            if (!source)\r\n                source = {};\r\n            if (!source.url)\r\n                source.url = this.controller.data.sourceUrl();\r\n            source.origSuccess = source.success;\r\n            source.success = (data: any) => {\r\n\r\n                for (const dataSetName in data) {\r\n                    if (data.hasOwnProperty(dataSetName))\r\n                        if (data[dataSetName].List !== null) {\r\n                            this.controller.data.in[dataSetName] = data[dataSetName];\r\n                            this.controller.data.in[dataSetName].name = dataSetName;\r\n                        }\r\n                }\r\n\r\n                if (this.controller.data.in.Default)\r\n                    this.List = this.in.Default.List;\r\n\r\n                if (source.origSuccess)\r\n                    source.origSuccess(this);\r\n\r\n                this.controller.isLoaded = true;\r\n                this.controller.lastRefresh = new Date();\r\n                this._triggerLoaded();\r\n            };\r\n            source.error = (request: any) => { alert(request.statusText); };\r\n            source.preventAutoFail = true; // use our fail message\r\n            this.source = source;\r\n            return this.reload();\r\n        }\r\n    }\r\n\r\n    reload(): SxcInstanceDataDeprecated {\r\n        // debugger; // this part of the code probably never runs and has other stuff here that depends on jquery\r\n        this.controller.webApi.get(this.source)\r\n            .then(this.source.success, this.source.error);\r\n        return this;\r\n    }\r\n\r\n    on(event: string, callback: () => void): SxcInstanceDataDeprecated {\r\n        // debugger;\r\n        // this is a hack to attach 2scLoad event listener to SxcInstanceDataDeprecated (not HTMLElement)\r\n        // and run callback when SxcInstanceDataDeprecated.load() runs\r\n        // dates since beginning of time:\r\n        // https://github.com/2sic/2sxc-ui/blob/e98383f8cf06cd973cf28fa37dc6332af80e9a51/Js/2sxc.api.js\r\n        return (window.$(this).on('2scLoad', callback)[0] as unknown as SxcInstanceDataDeprecated)._triggerLoaded();\r\n    }\r\n\r\n    // ReSharper disable once InconsistentNaming\r\n    _triggerLoaded(): SxcInstanceDataDeprecated {\r\n        // debugger;\r\n        // this is a hack to trigger 2scLoad event on SxcInstanceDataDeprecated (not HTMLElement)\r\n        // when SxcInstanceDataDeprecated.load() runs\r\n        // dates since beginning of time:\r\n        // https://github.com/2sic/2sxc-ui/blob/e98383f8cf06cd973cf28fa37dc6332af80e9a51/Js/2sxc.api.js\r\n        return this.controller.isLoaded\r\n            ? window.$(this).trigger('2scLoad', [this])[0] as unknown as SxcInstanceDataDeprecated\r\n            : this;\r\n    }\r\n\r\n    one(event: string, callback: (x: any, y: any) => void): SxcInstanceDataDeprecated {\r\n        // debugger;\r\n        // this basically just runs callback if controller is loaded. Really complicated looking line below doesn't do anything.\r\n        // It probably attached 2scLoad event listener with .on, not .one, a long time ago, but oldest github version is from 2014 and it was already broken there:\r\n        // https://github.com/2sic/2sxc-ui/blob/e98383f8cf06cd973cf28fa37dc6332af80e9a51/Js/2sxc.api.js\r\n        if (!this.controller.isLoaded)\r\n            return (window.$(this) as JQuery & { one: (event: string, callback: (x: any, y: any) => void) => JQuery }).one('2scLoad', callback)[0] as unknown as SxcInstanceDataDeprecated;\r\n        callback({}, this);\r\n        return this;\r\n    }\r\n}\r\n","import { UrlParamManager } from '..';\r\n\r\nconst urlManager = new UrlParamManager();\r\nconst urlDebugState = urlManager.get('debug') === 'true';\r\n\r\nexport class Debug {\r\n    /**\r\n     * The load-debug state (provided by the url with debug=true)\r\n     */\r\n    load: boolean;\r\n\r\n    /**\r\n     * Cache breaker string, contans the version number of 2sxc if one is provided with sxcver=...\r\n     */\r\n    uncache: string;\r\n\r\n    constructor() {\r\n        this.load = urlDebugState;\r\n        this.uncache = urlManager.get('sxcver');\r\n    }\r\n\r\n    static urlState = urlDebugState;\r\n}","import { Positioning, QuickEditConfig } from '.';\r\nimport { NoJQ } from '../plumbing';\r\n\r\nexport namespace QuickEditOverlay {\r\n  export interface Selection extends HTMLElement {\r\n    toggleOverlay(target: boolean | HTMLElement, buttons?: QuickEditConfig.Buttons): void;\r\n    target: HTMLElement;\r\n  }\r\n\r\n  export interface Main extends HTMLElement {\r\n    activeContentBlock: HTMLElement;\r\n    activeModule: HTMLElement;\r\n    _parentNode: HTMLElement;\r\n  }\r\n\r\n  export function setButtonActivationClasses(buttons: QuickEditConfig.Buttons, linkTags: HTMLElement[]) {\r\n    // remove any previously set classes for these\r\n    for (const [k, v] of Object.entries(QuickEditConfig.DefaultButtons))\r\n      linkTags.forEach((l) => {\r\n        l.classList.remove(`enable-${k}`, `disable-${k}`);\r\n      });\r\n\r\n    // set classes from config\r\n    for (const [k, v] of Object.entries(buttons))\r\n      linkTags.forEach((l) => {\r\n        l.classList.add(`${(v ? 'enable' : 'disable')}-${k}`);\r\n      });\r\n  }\r\n\r\n  export function btn(action: string, icon: string, i18N: string, invisible?: boolean, unavailable?: boolean, classes?: string): string {\r\n    return `<a class='sc-content-block-menu-btn sc-cb-action icon-sxc-${icon} ${invisible ? ' sc-invisible ' : ''}${unavailable ? ' sc-unavailable ' : ''}${classes}' data-action='${action}' data-i18n='[title]QuickInsertMenu.${i18N}'></a>`;\r\n  }\r\n\r\n  export const selectedOverlay = NoJQ.domFromString('<div class=\"sc-content-block-menu sc-content-block-selected-menu sc-i18n\"></div>').map((o) => {\r\n    o.append(\r\n      NoJQ.domFromString(QuickEditOverlay.btn('delete', 'trash-empty', 'Delete'))[0],\r\n      NoJQ.domFromString(QuickEditOverlay.btn('sendToPane', 'move', 'Move', null, null, 'sc-cb-mod-only'))[0],\r\n      NoJQ.domFromString('<div id=\"paneList\"></div>')[0],\r\n    );\r\n    return o;\r\n  })[0] as QuickEditOverlay.Selection;\r\n}\r\n\r\n\r\n/** Expand the selectedOverlay with the necessary toggle function */\r\nQuickEditOverlay.selectedOverlay.toggleOverlay = (target: boolean | HTMLElement, buttons?: QuickEditConfig.Buttons) => {\r\n  if (!target) {\r\n    QuickEditOverlay.selectedOverlay.style.display = 'none';\r\n  } else {\r\n    // 1. set overlay at the right coordinates\r\n    const coords = Positioning.get(target as HTMLElement);\r\n    coords.yh = coords.y + 20;\r\n    Positioning.positionAndAlign(QuickEditOverlay.selectedOverlay, coords);\r\n    QuickEditOverlay.selectedOverlay.target = target as HTMLElement;\r\n\r\n    // 2. Activate / deactivate correct buttons\r\n    QuickEditOverlay.setButtonActivationClasses(buttons, Array.from(QuickEditOverlay.selectedOverlay.querySelectorAll<HTMLElement>('a')));\r\n  }\r\n};\r\n","/**\r\n * Configuration of QuickE\r\n * see also https://docs.2sxc.org/specs/js/quicke.html\r\n */\r\nexport namespace QuickEditConfig {\r\n\r\n  /** Buttons on a quick-edit toolbar */\r\n  export interface Buttons {\r\n    addContent: boolean;\r\n    addApp: boolean;\r\n    select: boolean;\r\n    paste: boolean;\r\n    delete: boolean;\r\n    move: boolean;\r\n  }\r\n\r\n  export const DefaultButtons: Buttons = {\r\n    addApp: true,\r\n    addContent: true,\r\n    select: true,\r\n    paste: true,\r\n    delete: true,\r\n    move: true,\r\n  };\r\n\r\n  export function getNewDefaultConfig() {\r\n    return {\r\n      enable: true,\r\n      buttons: QuickEditConfig.DefaultButtons,\r\n      innerBlocks: {\r\n        enable: null, // default: auto-detect\r\n      },\r\n      modules: {\r\n        enable: null, // default: auto-detect\r\n      },\r\n    } as QuickEditConfig.FullConfig;\r\n  }\r\n  \r\n\r\n  /** Configuration set used in the root and in each sub-node (innerblocks/modules) */\r\n  interface ConfigSet {\r\n    enable: boolean | string | null;\r\n    buttons?: Buttons;\r\n  }\r\n\r\n  /** Full configuration set */\r\n  export interface FullConfig extends ConfigSet {\r\n    innerBlocks: ConfigSet;\r\n    modules: ConfigSet;\r\n  }\r\n}\r\n","import { SxcInstanceWithInternals } from '../../../$2sxc/src';\r\nimport { AttrJsonEditContext } from '../context/html-attribute';\r\nimport { EditManager } from '../manage/edit-manager';\r\nimport { TypeTbD } from '../plumbing';\r\n\r\n\r\nexport class SxcEdit extends SxcInstanceWithInternals {\r\n    manage: EditManager;\r\n\r\n    static is(thing: TypeTbD): thing is SxcEdit {\r\n        return (thing as SxcEdit).showDetailedHttpError !== undefined;\r\n    }\r\n\r\n    static get(module: number | HTMLElement, cbid?: number): SxcEdit {\r\n        // 2021-09-17 spm assume this function doesn't use jquery\r\n        const sxc = window.$2sxc(module, cbid) as unknown as SxcEdit;\r\n        return sxc;\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * get edit-context info of html element or sxc-object\r\n     * @param {SxcEdit} sxc\r\n     * @param {HTMLElement} htmlElement\r\n     * @return {AttrJsonEditContext} edit context info\r\n     */\r\n    static getEditContext(sxc: SxcEdit, htmlElement?: HTMLElement): AttrJsonEditContext {\r\n        let editContextTag: HTMLElement;\r\n        if (htmlElement) {\r\n            editContextTag = SxcEdit.getContainerTag(htmlElement);\r\n        } else {\r\n            editContextTag = SxcEdit.getTag(sxc);\r\n        }\r\n        return SxcEdit.getEditContextOfTag(editContextTag);\r\n    }\r\n\r\n    /**\r\n     * get the edit-context object (a json object) of the current tag/sxc-instance\r\n     * @return {AttrJsonEditContext} edit-context object\r\n     */\r\n    static getEditContextOfTag(htmlTag: HTMLElement): AttrJsonEditContext {\r\n        const attr = htmlTag?.getAttribute('data-edit-context');\r\n        return JSON.parse(attr || '{ }') as AttrJsonEditContext;\r\n    }\r\n\r\n\r\n    /**\r\n     * get nearest html tag of the sxc instance with data-edit-context\r\n     * @param htmlTag\r\n     */\r\n    static getContainerTag(htmlTag: HTMLElement): HTMLElement {\r\n        return htmlTag.closest<HTMLElement>('div[data-edit-context]');\r\n    }\r\n\r\n    /**\r\n     * get a html tag of the sxc instance\r\n     * @param {SxcEdit} sxci\r\n     * @return {HTMLElement} - resulting html\r\n     */\r\n    static getTag(sxci: SxcEdit): HTMLElement {\r\n        return document.querySelector<HTMLElement>(`div[data-cb-id='${sxci.cbid}']`);\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n","import { C } from '../constants';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\n\r\nexport class HtmlTools {\r\n\r\n    static disable(tag: HTMLElement): void {\r\n        tag.setAttribute(C.Toolbar.attr.disable, 'true');\r\n    }\r\n\r\n    static isDisabled(sxc: SxcEdit): boolean {\r\n        const tag = SxcEdit.getTag(sxc);\r\n        return !!tag.getAttribute(C.Toolbar.attr.disable);\r\n    }\r\n\r\n    /**\r\n     * Find the text of one or more attributes in fallback order, till we found one\r\n     */\r\n    static getFirstAttribute(toolbar: HTMLElement, name1: string, name2: string): string {\r\n        return HtmlTools.tryGetAttrText(toolbar, name1) || HtmlTools.tryGetAttrText(toolbar, name2) || '{}';\r\n    }\r\n\r\n    /**\r\n     * Get text-content of an attribute (or return null)\r\n     */\r\n    static tryGetAttrText(tag: HTMLElement, name: string): string {\r\n        const item1 = tag.attributes.getNamedItem(name);\r\n        return item1 && item1.textContent;\r\n    }\r\n\r\n    /**\r\n     * Add html classes to a DOM element\r\n     */\r\n    static addClasses(element: HTMLElement, classes: string) {\r\n        if (!classes) return;\r\n        if (classes.indexOf(','))\r\n            classes = classes.replace(',', ' ');\r\n        const classessArray = classes.split(' ');\r\n        for (let c = 0; c < classessArray.length; c++)\r\n            if (classessArray[c])\r\n                element.classList.add(classessArray[c]);\r\n    }\r\n}\r\n","import { Window as sxcWindow } from '../../../$2sxc/src/index';\r\nimport { DnnActionMenu } from '../dnn/dnn-menu-helper/dnn-inpage-edit';\r\nimport { TypeWeDontCare } from '../plumbing';\r\nimport { QuickE } from '../quick-edit/quick-e';\r\nimport { SxcRoot } from './sxc-controller-in-page';\r\n\r\n// ReSharper disable InconsistentNaming\r\nexport interface WindowInPage extends Window, sxcWindow {\r\n  $2sxc: SxcRoot;\r\n  // event: Event;\r\n  dnn_tabVersioningEnabled: boolean;\r\n  dnn: TypeWeDontCare;\r\n  $quickE: QuickE ;\r\n  $2sxcActionMenuMapper: (moduleId: number) => DnnActionMenu;\r\n}\r\n// ReSharper restore InconsistentNaming\r\n\r\nexport const windowInPage: WindowInPage = window as unknown as WindowInPage;\r\n","export class Selection {\r\n    /** The parent is either \"dnn\" or a module information */\r\n    parent: string | number;\r\n\r\n    // new in 11.06 - inner content now always uses guid\r\n    parentGuid: string;\r\n\r\n    /** The field inside the parent used for this content */\r\n    field: string;\r\n\r\n    list: HTMLElement;\r\n    item: HTMLElement;\r\n    index: number;\r\n    type: 'mod' | 'cb';\r\n}\r\n","import { Selection } from '.';\r\nimport { HasLog } from '../logging';\r\n\r\n/**\r\n * Base class for module / content-block editors\r\n */\r\nexport abstract class ModifierBase extends HasLog {\r\n    constructor(name: string) {\r\n        super(name);\r\n    }\r\n\r\n    abstract delete(clip: Selection): Promise<void>;\r\n\r\n    abstract isRealMove(oldClip: Selection, newClip: Selection): boolean;\r\n\r\n    abstract move(oldClip: Selection, newClip: Selection): void;\r\n}\r\n","import { QeSelectors } from '.';\r\n\r\nexport class ContextForLists {\r\n    parent: string | number;\r\n\r\n    // new in 11.06 - all list-operations now use the parentGuid for inner-content\r\n    parentGuid: string;\r\n\r\n    field: string;\r\n    type?: string;\r\n    guid?: string;\r\n    apps?: string;\r\n    max?: number;\r\n\r\n    appList?: string[];\r\n\r\n    static getFromDom(tag: HTMLElement): ContextForLists {\r\n        const result: ContextForLists = JSON.parse(tag.getAttribute(QeSelectors.blocks.cb.context) || null) || {};\r\n        result.appList = []; // empty by default\r\n        if (result != null && typeof (result.apps) === 'string' && result.apps.length > 1)\r\n            result.appList = result.apps\r\n                .split(',')\r\n                .map((s) => s.trim())   // trim\r\n                .filter((s) => !!s);    // drop empty ones\r\n        return result;\r\n    }\r\n}\r\n","import { ToolbarWithWorkflow, WorkflowArguments, WorkflowManager } from '.';\r\n\r\nlet dummyWorkflowManager: WorkflowManager;\r\nconst debug = false;\r\n\r\n/**\r\n * Various helpers to get a workflow or determine result state\r\n *\r\n * @export\r\n * @class WorkflowHelper\r\n */\r\nexport class WorkflowHelper {\r\n\r\n    /**\r\n     * Find the command workflow on a toolbar (or return null).\r\n     * Will go upwards in the DOM to find the toolbar node which has the configuration stored\r\n     */\r\n    static getWorkflow(node: HTMLElement): WorkflowManager {\r\n        if (!node) return WorkflowHelper.getDummyManager();\r\n\r\n        if (debug) console.log('try to find command workflow on ', node);\r\n        const maxParents = 100;\r\n        let parentCount = 0;\r\n        let current = node;\r\n        while (current && parentCount++ < maxParents) {\r\n            const cmdWf = (current as ToolbarWithWorkflow).commandWorkflow;\r\n            if (cmdWf) return cmdWf;\r\n            current = current.parentElement;\r\n        }\r\n        if (debug) console.log('not found, will return dummy');\r\n        return WorkflowHelper.getDummyManager();\r\n    }\r\n\r\n    /**\r\n     * Get a dummy workflow manager\r\n     *\r\n     * @static\r\n     * @returns {WorkflowManager}\r\n     * @memberof WorkflowHelper\r\n     */\r\n    static getDummyManager(): WorkflowManager {\r\n        if (!dummyWorkflowManager) dummyWorkflowManager = new WorkflowManager(null, true);\r\n        return dummyWorkflowManager;\r\n    }\r\n\r\n    /**\r\n     * Determine if a workflow has been cancelled\r\n     *\r\n     * @static\r\n     * @param {(WorkflowArguments | boolean)} currentArgs\r\n     * @returns {boolean}\r\n     * @memberof WorkflowHelper\r\n     */\r\n    static isCancelled(currentArgs: WorkflowArguments | boolean): boolean {\r\n        const cancel = this._isCancelled(currentArgs);\r\n        if (debug) console.log('is cancelled: ' + cancel, currentArgs);\r\n        return cancel;\r\n    }\r\n\r\n    private static _isCancelled(currentArgs: WorkflowArguments | boolean): boolean {\r\n        // promise forgot to return anything, no cancel\r\n        if (currentArgs == null) return false;\r\n\r\n        // promise returned simple false, cancel\r\n        if (currentArgs === false) return true;\r\n\r\n        // determine cancel based on either a boolean result or a real WorkflowArguments with cancel.\r\n        return (currentArgs as WorkflowArguments).cancel === true;\r\n    }\r\n\r\n}\r\n","import { ToolbarInitConfig } from '../initialize/toolbar-init-config';\r\nimport { RuleManager } from '../rules/rule-manager';\r\nimport { ToolbarTemplate } from '../templates';\r\n\r\nconst autoAddMoreDefault = 'end';\r\ntype TypeAutoAddMore = null | 'start' | 'end' | true; //  [true: used to be right/start]\r\nconst hoverDefault = 'right';\r\ntype TypeHover = 'left' | 'right' | 'none';\r\n\r\nexport const TOOLBAR_SHOW_ALWAYS = 'always';\r\nexport const TOOLBAR_SHOW_HOVER = 'hover';\r\ntype TypeShow = typeof TOOLBAR_SHOW_ALWAYS | typeof TOOLBAR_SHOW_HOVER;\r\n\r\nconst followDefault = 'default';\r\nexport const TOOLBAR_FOLLOW_INITIAL = 'initial';\r\nexport const TOOLBAR_FOLLOW_ALWAYS = 'always';\r\nexport const TOOLBAR_FOLLOW_SCROLL = 'scroll';\r\n\r\nexport type TypeFollow = 'default' | 'none' | typeof TOOLBAR_FOLLOW_INITIAL | typeof TOOLBAR_FOLLOW_ALWAYS | typeof TOOLBAR_FOLLOW_SCROLL;\r\n\r\n\r\n\r\n/**\r\n * Toolbar behavior settings like float, etc.\r\n */\r\nexport class ToolbarSettings {\r\n    /** Automatically add the '...' more button to the toolbar */\r\n    autoAddMore: TypeAutoAddMore = autoAddMoreDefault;\r\n\r\n    /** Hover placement of the toolbar */\r\n    hover: TypeHover = hoverDefault;\r\n\r\n    /** Show behavior (always, hover, ...) */\r\n    show: TypeShow = TOOLBAR_SHOW_HOVER;\r\n\r\n    /** Follow behavior - if the toolbar should scroll with the page or remain where it was hovered */\r\n    follow: TypeFollow = followDefault;\r\n\r\n    /**\r\n     * Old term, keep for compatibility. Please use `.class` instead\r\n     * @obsolete\r\n     */\r\n    classes: string = '';\r\n\r\n    /**\r\n     * Term for the class for simplicity and consistency with button styling\r\n     * New 10.27\r\n     */\r\n    class: string = '';\r\n\r\n    /**\r\n     * color configuration which applies to all buttons\r\n     * use \"colorname\", \"#xxyyzz\" or \"color1,color2\" to specify the colors\r\n     * New in 10.27\r\n     */\r\n    color?: string = '';\r\n\r\n    /**\r\n     * modifiers for the buttons\r\n     * Should never be set from the page, but the toolbar initializer will set this\r\n     * New in 10.27\r\n     */\r\n    _rules?: RuleManager;\r\n\r\n    constructor(defaults: Partial<ToolbarSettings>) { // } { autoAddMore?: TypeAutoAddMore, hover?: TypeHover, show?: TypeShow, follow?: TypeFollow }) {\r\n        if (defaults != null) {\r\n            if (defaults.autoAddMore) this.autoAddMore = defaults.autoAddMore;\r\n            if (defaults.hover) this.hover = defaults.hover;\r\n            if (defaults.show)  this.show = defaults.show;\r\n            if (defaults.follow) this.follow = defaults.follow;\r\n        }\r\n        // Swap the real follow-default to be \"none\"\r\n        if (this.follow === followDefault) this.follow = 'none';\r\n    }\r\n\r\n\r\n    /**\r\n     * removes autoAddMore and classes if are null or empty, to keep same behaviour like in v1\r\n     *\r\n     * Note 2dm: not sure why we're doing this, but it seems like we only need this to merge\r\n     * various objects, so we probably want to make sure the in-html-toolbar doesn't accidentally\r\n     * contain null-items we don't want passed on\r\n     * @param toolbarSettings\r\n     */\r\n    static dropEmptyProperties(toolbarSettings: ToolbarSettings): Partial<ToolbarSettings> {\r\n        const partialSettings = {...toolbarSettings};\r\n        if (!partialSettings.autoAddMore) delete partialSettings.autoAddMore;\r\n        if (!partialSettings.classes) delete partialSettings.classes;\r\n        return partialSettings;\r\n    }\r\n\r\n    static getDefaults = () => new ToolbarSettings({ autoAddMore: 'end', hover: 'right', show: 'hover', follow: 'default' });\r\n\r\n    /** Setup for situations where an empty toolbar is needed, without any data or configuration */\r\n    static getForEmpty = () => new ToolbarSettings({ autoAddMore: 'start', hover: 'left', show: 'hover', follow: 'default' });\r\n}\r\n\r\n\r\n// TODO: this is in the wrong place, shouldn't be in settings\r\nexport const ToolbarWhenNoToolbarProvided = {\r\n  toolbar: {} as ToolbarTemplate,\r\n  settings: ToolbarSettings.getForEmpty(),\r\n} as ToolbarInitConfig;\r\n","import { Workflow, WorkflowPhases, WorkflowArguments, WorkflowStepHelper } from '.';\r\nimport { SpecialCommands } from '../commands';\r\nimport { ContextComplete } from '../context';\r\nimport { HasLog, Insights, Log } from '../logging';\r\nimport { ToolbarWithWorkflow } from './toolbar-with-workflow';\r\nimport { WorkflowCode } from './workflow';\r\nimport { WorkflowHelper } from './workflow-helper';\r\n\r\n/**\r\n * A workflow manager which will run stuff before / after commands.\r\n * As of now, it must be attached to a toolbar to take effect.\r\n * Normally the toolbar with raise a `toolbar-init` event where you can then add steps\r\n */\r\nexport class WorkflowManager extends HasLog {\r\n\r\n    /** The workflow steps registered here */\r\n    steps: Workflow[] = [];\r\n\r\n    constructor(parentLog: Log, private isDummy = false) {\r\n        super('Cmd.Wrkflw', parentLog, 'constructor');\r\n    }\r\n\r\n    /**\r\n     * Add one or many steps to the workflow\r\n     */\r\n    // @publicApi(\"Used publicly on the Workflow-object in toolbar-init\")\r\n    add(steps: Workflow | Workflow[]) {\r\n        if (!steps) return;\r\n        if (Array.isArray(steps)) {\r\n            steps.forEach((s) => this.addOne(s));\r\n        } else\r\n            this.addOne(steps);\r\n    }\r\n\r\n    /**\r\n     * Add a single workflow step to this manager\r\n     */\r\n    private addOne(step: Workflow) {\r\n        step = WorkflowStepHelper.initDefaults(step);\r\n        const cl = this.log.call('add', `'${step.name}' for '${step.command}'-'${step.phase}'`);\r\n        if (!step) {\r\n            const errorMsg = \"Trying to add workflow step but didn't get anything\";\r\n            cl.add(errorMsg);\r\n            throw errorMsg;\r\n        }\r\n        this.steps.push(step);\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * Run a workflow.\r\n     * @returns {Promise<WorkflowArguments>} This will let you chain what happens. The arguments contain a status if it should be cancelled.\r\n     */\r\n    run(wfArgs: WorkflowArguments): Promise<WorkflowArguments> {\r\n        const cl = this.log.call('run', `'${wfArgs.command}' for '${wfArgs.phase}'`);\r\n\r\n        // if this is just a temporary / dummy workflow manager, just return a success-promise\r\n        if (this.isDummy) {\r\n            cl.done('Dummy workflow, nothing to run, will return a resolved promise');\r\n            return emptyWorkflow(wfArgs);\r\n        }\r\n\r\n        // Find all steps to run\r\n        const stepsForCommand = this.steps\r\n            // only those of this command or all\r\n            .filter((s) => s.command === wfArgs.command || s.command === SpecialCommands.all)\r\n            .filter((s) => s.phase === wfArgs.phase || s.phase === WorkflowPhases.all)\r\n            // only those having real code\r\n            .filter((s) => s.code)\r\n            .sort((s) => s.priority);\r\n\r\n        if (stepsForCommand.length === 0) {\r\n            cl.done('no steps found for this command / phase, will return a resolved promise');\r\n            return emptyWorkflow(wfArgs);\r\n        }\r\n\r\n        // run in sequence but cancel at any time if necessary\r\n        const promise = new Promise<WorkflowArguments>((resolve, reject) => {\r\n            let promiseChain = Promise.resolve(wfArgs);\r\n            // let previousArgs = wfArgs;\r\n            // let interruptChain = false;\r\n            for (let stepCount = 0; stepCount < stepsForCommand.length; stepCount++) {\r\n                const nextStep = stepsForCommand[stepCount];\r\n                promiseChain = promiseChain.then((resultingArgs) => {\r\n                    return this.runNextPromiseIfNotCancelled(resultingArgs, wfArgs, nextStep.code);\r\n                });\r\n            }\r\n\r\n            promiseChain.then((finalArgs) => { resolve(finalArgs); });\r\n            promiseChain.catch(reject);\r\n        });\r\n        return promise;\r\n    }\r\n\r\n    /** Attach a workflow to a toolbar */\r\n    attach(node: HTMLElement, context: ContextComplete) {\r\n        const cl = this.log.call('attach');\r\n        if (!node) return;\r\n        (node as ToolbarWithWorkflow).commandWorkflow = this;\r\n        Insights.add('workflow', context.toolbar?.identifier, this.log);\r\n        cl.done();\r\n    }\r\n\r\n    private runNextPromiseIfNotCancelled(currentArgs: WorkflowArguments | boolean, prevArgs: WorkflowArguments, nextFactory: WorkflowCode) {\r\n        // determine cancel based on either a boolean result or a real WorkflowArguments with cancel.\r\n        const cancel = WorkflowHelper.isCancelled(currentArgs);\r\n        // make sure we have real arguments no matter what came in - assuming we have prevArgs\r\n        currentArgs = (currentArgs && typeof(currentArgs) !== 'boolean') ? currentArgs : { ...prevArgs };\r\n        // in case the cancel came as boolean, we must now set it on the currentArgs\r\n        currentArgs.cancel = cancel;\r\n        return cancel ? emptyWorkflow(currentArgs) : nextFactory(currentArgs);\r\n    }\r\n\r\n}\r\n\r\nfunction emptyWorkflow(wfArgs: WorkflowArguments) {\r\n    return Promise.resolve<WorkflowArguments>(wfArgs);\r\n}\r\n","import { WorkflowPhases } from '.';\r\nimport { ContextComplete } from '../context';\r\n\r\n\r\n/**\r\n * Arguments for a workflow. Used when starting it and to determine result / cancelled.\r\n *\r\n * @export\r\n * @class WorkflowArguments\r\n */\r\nexport class WorkflowArguments {\r\n    constructor(\r\n        /** Name this workflow is running for */\r\n        public command: string,\r\n\r\n        /** The phase it's in (before, after, etc.) */\r\n        public phase: WorkflowPhases,\r\n\r\n        /** Context of the current command / step being run */\r\n        public context: ContextComplete,\r\n\r\n        /**\r\n         * Result in after-phases of the workflow\r\n         * BETA - never really tested this\r\n         */\r\n        public result: unknown = null,\r\n        ) {\r\n\r\n    }\r\n\r\n    /** If the workflow should be cancelled. Can be set by any workflow step. */\r\n    cancel: boolean = false;\r\n}\r\n","/**\r\n * Phases / events of a specific workflow.\r\n * @export\r\n * @enum {number}\r\n */\r\nexport enum WorkflowPhases {\r\n    all = 'all',\r\n    before = 'before',\r\n    after = 'after',\r\n}\r\n","import { WorkflowPhases, WorkflowArguments } from '.';\r\nimport { SpecialCommands } from '../commands';\r\n\r\nexport type PromiseFactory<T> = (args: T) => Promise<T>;\r\n\r\nexport type WorkflowPromiseFactory = PromiseFactory<WorkflowArguments>;\r\n\r\nexport type WorkflowCode = (args: WorkflowArguments) => WorkflowArguments;\r\n\r\n/**\r\n * A workflow (code-sequence) to run before/after specific events.\r\n *\r\n * @export\r\n * @interface Workflow\r\n */\r\nexport interface Workflow {\r\n    /**\r\n     * The name of this step, in case it needs to be replaced or somehow controlled\r\n     * Will be empty by default\r\n     */\r\n    name?: string;\r\n\r\n    /**\r\n     * The action this step is for, can be 'any', 'edit', etc.\r\n     * Will be 'all' by default\r\n     */\r\n    command: string;\r\n\r\n    /**\r\n     * Action-phase being run, like 'init', 'before', 'after', 'cancel'\r\n     * will be 'before' by default\r\n     */\r\n    phase?: WorkflowPhases;\r\n\r\n    /**\r\n     * Execution priority, higher comes first\r\n     * Will be 1 by default.\r\n     */\r\n    priority?: number;\r\n\r\n    /**\r\n     * The code which is run, must be a promise-factory.\r\n     * So it's a function that will return a promise.\r\n     * Required.\r\n     */\r\n    code: WorkflowCode;\r\n}\r\n\r\nexport class WorkflowStepHelper {\r\n    static initDefaults(step: Workflow) {\r\n        step.name = step.name ?? '';\r\n        step.command = step.command ?? SpecialCommands.all;\r\n        step.phase = step.phase ?? WorkflowPhases.before;\r\n        step.priority = step.priority ?? 1;\r\n        if (!step.code || typeof(step.code) !== 'function') throw `Tried preparing a workflow step, but the promise either doesn't exist or is not a promise factory`;\r\n        return step;\r\n    }\r\n}\r\n","import { ToolbarEventArguments } from '.';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context';\r\nimport { WorkflowManager } from '../workflow';\r\n\r\nexport class ToolbarLifecycle {\r\n\r\n    /**\r\n     * This will be triggered when a hover toolbar has been built,\r\n     * so that on-page JS can register workflows for this toolbar.\r\n     * @static\r\n     * @param {HTMLElement} toolbarElement The toolbar HTML DOM passed into the event\r\n     * @param {HTMLElement} anchoredElement The DOM element which had the @Edit.TagToolbar(...) - on which the event will be raised\r\n     * @param {ContextComplete} context The toolbar context\r\n     * @memberof ToolbarLifecycle\r\n     */\r\n    static raiseToolbarInitEvent(toolbarElement: HTMLElement, anchoredElement: HTMLElement, context: ContextComplete) {\r\n        const commandWorkflow = new WorkflowManager(null);\r\n        commandWorkflow.attach(toolbarElement, context);\r\n\r\n        const event = new CustomEvent(C.Toolbar.eventNames.onInit, {\r\n            bubbles: true,  // Important so it can be handled by a parent tag\r\n            detail: {\r\n                // type: ToolbarTypes.tag,\r\n                element: toolbarElement,\r\n                identifier: context.toolbar?.identifier,\r\n                workflow: commandWorkflow,\r\n            } as ToolbarEventArguments,\r\n        });\r\n        anchoredElement?.dispatchEvent(event);\r\n    }\r\n}\r\n","import { TagToolbarManager, ToolbarRenderer } from '..';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { Translator } from '../../i18n';\r\nimport { NoJQ } from '../../plumbing';\r\nimport { TOOLBAR_FOLLOW_ALWAYS, TOOLBAR_FOLLOW_INITIAL, TOOLBAR_FOLLOW_SCROLL, TOOLBAR_SHOW_ALWAYS, TypeFollow } from '../config/toolbar-settings';\r\nimport { ToolbarLifecycle } from '../toolbar-lifecycle';\r\n\r\n/**\r\n * This is the modern toolbar which is attached to a tag from whic it hovers.\r\n * Internally the toolbar Dom-Elements are hidden at the bottom of the page.\r\n * This object is responsible for creating them,\r\n * and making sure that hover-events etc. cause the right toolbar to show up.\r\n */\r\nexport class TagToolbar {\r\n    private toolbarElement = null as HTMLElement;\r\n    private initialized = false;\r\n    private follow: TypeFollow;\r\n    private alwaysShow = false;\r\n\r\n    /**\r\n     * A Tag-Toolbar which is outside of the module DOM and floating freely\r\n     * @param {HTMLElement} hoverTag\r\n     * @param {ContextComplete} context\r\n     * @param {typeof Translator} [translator] special translator, only included because otherwise WebPack causes circular references\r\n     * @memberof TagToolbar\r\n     */\r\n    constructor(private readonly hoverTag: HTMLElement, private readonly context: ContextComplete, private translator?: typeof Translator) {\r\n        this.follow = context.toolbar.settings.follow;\r\n        this.alwaysShow = context.toolbar.settings.show === TOOLBAR_SHOW_ALWAYS;\r\n        // Ensure toolbar gets visible when hovering\r\n        this.addMouseEvents(hoverTag);\r\n        if (this.alwaysShow) this.showPermanently();\r\n    }\r\n\r\n    /**\r\n     * Attach Mouse-Enter and Mouse-Leave events to ensure show/hide of the toolbar\r\n     */\r\n    private addMouseEvents(hoverTag: HTMLElement) {\r\n        hoverTag.addEventListener('mouseenter', () => { this.show(); });\r\n        if (!this.alwaysShow)\r\n            hoverTag.addEventListener('mouseleave', (e) => {\r\n                this.initializeIfNecessary();\r\n                // if we hover the menu itself now, don't hide it\r\n                const relatedTarget = e.relatedTarget as HTMLElement;\r\n                if (!this.toolbarElement.contains(relatedTarget) && this.toolbarElement !== relatedTarget)\r\n                    this.hide();\r\n            });\r\n    }\r\n\r\n\r\n    private initializeIfNecessary() {\r\n        if (this.initialized) return;\r\n\r\n        const nextFreeId = TagToolbarManager.getNextToolbarId();\r\n        const toolbarId = `${this.context.instance.id}-${this.context.contentBlockReference.id}-${nextFreeId}`;\r\n\r\n        // render toolbar and append tag to body\r\n        this.toolbarElement = new ToolbarRenderer(this.context).generate();\r\n\r\n        // 2021-11-15 2dm disabled this, seems like a duplicate to the attach-mouse-enter which always runs\r\n        if (!this.alwaysShow)\r\n            this.toolbarElement.addEventListener('mouseleave', (e) => {\r\n                // if we do not hover the tag now, hide it\r\n                const relatedTarget = e.relatedTarget as HTMLElement;\r\n                if (!this.hoverTag.contains(relatedTarget) && this.hoverTag !== relatedTarget)\r\n                    this.hide();\r\n            });\r\n\r\n        document.body.append(this.toolbarElement);\r\n\r\n        this.toolbarElement.setAttribute(TagToolbarManager.TagToolbarForAttr, toolbarId);\r\n        this.hoverTag.setAttribute(TagToolbarManager.TagToolbarAttr, toolbarId);\r\n\r\n        const toolbarStyle = this.toolbarElement.style;\r\n        toolbarStyle.position = 'absolute';\r\n        // Do the following things on toolbars which are invisible (show != always)\r\n        if (!this.alwaysShow) {\r\n            toolbarStyle.display = 'none';\r\n            toolbarStyle.transition = 'top 0.5s ease-out';\r\n        }\r\n\r\n        // ensure it's translated\r\n        this.translator?.autoTranslateMenus();\r\n        this.initialized = true;\r\n\r\n        // new in v11.12 - toolbar Workflow\r\n        ToolbarLifecycle.raiseToolbarInitEvent(this.toolbarElement, this.hoverTag, this.context);\r\n    }\r\n\r\n    private updatePosition(initial: boolean) {\r\n        const position = {\r\n            top: 'auto' as 'auto' | number,\r\n            left: 'auto' as 'auto' | number,\r\n            right: 'auto' as 'auto' | number,\r\n            viewportOffset: this.hoverTag.getBoundingClientRect().top,\r\n            bodyOffset: TagToolbarManager.getBodyScrollOffset(),\r\n            tagScrollOffset: 0,\r\n            tagOffset: NoJQ.offset(this.hoverTag),\r\n            tagWidth: NoJQ.outerWidth(this.hoverTag),\r\n            mousePos: TagToolbarManager.mousePosition,\r\n            win: {\r\n                scrollY: window.scrollY,\r\n                width: document.documentElement.clientWidth,\r\n            },\r\n            padding: tagToolbarPadding,\r\n        };\r\n\r\n        // If we scrolled down, the toolbar might not be visible - calculate offset\r\n        position.tagScrollOffset = Math.min(position.viewportOffset - position.bodyOffset.top, 0);\r\n\r\n        // Update top coordinates\r\n        // new: only do this on initial=true && follow != 'none' or not-initial\r\n        // start by setting default-top\r\n        position.top = position.tagOffset.top + tagToolbarPadding - position.bodyOffset.top;\r\n        const trackMouse = (this.follow === TOOLBAR_FOLLOW_ALWAYS)\r\n            || (this.follow === TOOLBAR_FOLLOW_INITIAL && initial)\r\n            || (this.follow === TOOLBAR_FOLLOW_SCROLL && position.tagScrollOffset !== 0);\r\n        if (trackMouse)\r\n            position.top = position.mousePos.y + position.win.scrollY - position.bodyOffset.top - toolbarHeight / 2;\r\n\r\n        // Update left / right coordinates\r\n        if (this.toolbarElement.classList.contains('sc-tb-hover-right'))\r\n            position.right = position.win.width - position.tagOffset.left - position.tagWidth + tagToolbarPaddingRight - position.bodyOffset.left;\r\n        else\r\n            position.left = position.tagOffset.left + tagToolbarPadding + position.bodyOffset.left;\r\n\r\n        this.toolbarElement.style.top = typeof position.top === 'number' ? `${position.top}px` : position.top;\r\n        this.toolbarElement.style.left = typeof position.left === 'number' ? `${position.left}px` : position.left;\r\n        this.toolbarElement.style.right = typeof position.right === 'number' ? `${position.right}px` : position.right;\r\n    }\r\n\r\n\r\n    /**\r\n     * Hide the toolbar and detach scrolling-watcher\r\n     */\r\n    private hide() {\r\n        if (this.alwaysShow) return;\r\n        this.toolbarElement.style.display = 'none';\r\n        this.disableScrollWatcher();\r\n    }\r\n\r\n\r\n    /**\r\n     * Show the toolbar\r\n     */\r\n    private show() {\r\n        console.log('show');\r\n        this.initializeIfNecessary();\r\n        this.toolbarElement.style.display = 'block';\r\n        this.updatePosition(true);\r\n        this.activateScrollWatcher();\r\n    }\r\n\r\n    /**\r\n     * Always show the toolbar.\r\n     */\r\n    private showPermanently() {\r\n        console.log('show permanently');\r\n        this.show();\r\n        // after a moment, adjust position because often initial position is a bit off\r\n        window.addEventListener('load', this.updateFn);\r\n        document.addEventListener('readystatechange', this.updateFn);\r\n        // Also watch resizing, as the position would be wrong otherwise\r\n        window.addEventListener('resize', this.updateFn);\r\n    }\r\n\r\n    /** Remember if scrollwatcher has been enabled */\r\n    private watcherActive = false;\r\n    /** The update function as a prebuild function, so it can be reused in on/off */\r\n    private updateFn = () => this.updatePosition(false);\r\n    /** Enable scroll watcher & remember */\r\n    private activateScrollWatcher() {\r\n        if (this.watcherActive) return;\r\n        const trackOngoing = this.follow === TOOLBAR_FOLLOW_SCROLL || this.follow === TOOLBAR_FOLLOW_ALWAYS;\r\n        if (!trackOngoing) return;\r\n        window.addEventListener('scroll', this.updateFn);\r\n        if (this.follow === TOOLBAR_FOLLOW_ALWAYS) window.addEventListener('mousemove', this.updateFn);\r\n        this.watcherActive = true;\r\n    }\r\n\r\n    /** Disable scroll watcher - if it is active */\r\n    private disableScrollWatcher() {\r\n        if (!this.watcherActive) return;\r\n        window.removeEventListener('scroll', this.updateFn);\r\n        window.removeEventListener('mousemove', this.updateFn);\r\n        this.watcherActive = false;\r\n    }\r\n\r\n\r\n}\r\n\r\nconst tagToolbarPadding = 4;\r\nconst tagToolbarPaddingRight = 0;\r\nconst toolbarHeight = 20;\r\n","import { NoJQ } from '../../plumbing';\r\n\r\n/**\r\n * The global Tag Toolbar Manager is responsible for the new TagToolbars\r\n * These have certain shared aspects, like:\r\n * - a numbering scheme to keep them apart\r\n * - a mouse tracker to keep track of the position as the toolbar follows the scroll\r\n */\r\nexport class TagToolbarManager {\r\n    /** Mark Dom-Notes with the ID which Tag-Toolbar they want on mouse-over */\r\n    static TagToolbarAttr = 'data-tagtoolbar';\r\n\r\n    /** Mark TagToolbar Html-Nodes with the ID of the Dom-Tag they belong to */\r\n    static TagToolbarForAttr = 'data-tagtoolbar-for';\r\n\r\n    /** The current mouseposition, always updated when the mouse changes */\r\n    static mousePosition = {\r\n        x: 0,\r\n        y: 0,\r\n    };\r\n\r\n    /** The next free ID to mark a TagToolbar */\r\n    static getNextToolbarId() {\r\n        return TagToolbarManager.lastMenuId++;\r\n    }\r\n    private static lastMenuId = 0;\r\n\r\n    /**\r\n     * Returns the body offset if positioning is relative or absolute\r\n     */\r\n    static getBodyScrollOffset() {\r\n        const posNoJq = document.body.style.position;\r\n        const body = document.body;\r\n        const bodyPos = posNoJq; // body.css('position');\r\n        if (bodyPos === 'relative' || bodyPos === 'absolute') {\r\n            const offset = NoJQ.offset(body);\r\n            return {\r\n                top: offset.top,\r\n                left: offset.left,\r\n            };\r\n        }\r\n        return {\r\n            top: 0,\r\n            left: 0,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Remove orphan tag-toolbars from DOM\r\n     * This can be necessary if the module was replaced by ajax,\r\n     * leaving behind un-attached TagToolbars.\r\n     */\r\n    static CleanupOrphanedToolbars() {\r\n        const tagToolbars = document.querySelectorAll<HTMLElement>(`[${TagToolbarManager.TagToolbarForAttr}]`);\r\n        tagToolbars.forEach((e) => {\r\n            const id = e.getAttribute(TagToolbarManager.TagToolbarForAttr);\r\n            if (!document.querySelectorAll<HTMLElement>(`[${TagToolbarManager.TagToolbarAttr}=\"${id}\"]`).length) {\r\n                e.remove();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * Keep the mouse-position update for future use\r\n */\r\nwindow.addEventListener('mousemove', (e) => {\r\n    TagToolbarManager.mousePosition.x = e.clientX;\r\n    TagToolbarManager.mousePosition.y = e.clientY;\r\n});\r\n","import { Command } from '../../commands/command';\r\nimport { CommandParams } from '../../commands/command-params';\r\nimport { Commands } from '../../commands/commands';\r\nimport { DictionaryValue } from '../../plumbing';\r\n\r\nexport class ButtonCommand {\r\n    readonly command: Command; // reference to action to be run\r\n\r\n    // customCode: string;\r\n\r\n    constructor(public name: string, contentType?: string, public params?: CommandParams) {\r\n        if (!params) this.params = {};\r\n        if (contentType) this.params.contentType = contentType;\r\n        this.command = Commands.singleton().get(name); // activate command for this\r\n    }\r\n\r\n    /** make static, as many ButtonCommand signatures are actually not objects */\r\n    static mergeAdditionalParams(command: ButtonCommand, additionalParams: DictionaryValue): CommandParams {\r\n        let params: CommandParams = {};\r\n        if (command) {\r\n            if (command.name) params.action = command.name;\r\n            if (command.params) params = {...params, ...command.params, ...additionalParams};\r\n        }\r\n        command.params = params;\r\n        return params;\r\n    }\r\n}\r\n","import { ButtonCommand } from '.';\r\nimport { CommandCode } from '../../commands/command-code';\r\nimport { CommandLinkGenerator } from '../../commands/command-link-generator';\r\nimport { CommandParams } from '../../commands/command-params';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { Obj, TypeTbD } from '../../plumbing';\r\nimport { BuildRule } from '../rules';\r\n\r\n/** This is the most common call signature on most ButtonConfig properties */\r\nexport type ButtonPropGen<T> = (context: ContextComplete) => T;\r\n\r\ntype ButtonGenOrProp<T> = ButtonPropGen<T> | T;\r\n\r\n/**\r\n * The real button configuration as it's used at runtime\r\n */\r\nexport class Button {\r\n    /** The ID is important for tracking this button and applying modifiers */\r\n    id: string;\r\n\r\n    /** The underlying command which will be run */\r\n    command: ButtonCommand;\r\n\r\n    /** classes which will be applied to this button */\r\n    classes: string = '';\r\n\r\n    constructor(command: ButtonCommand, name: string) {\r\n        this.command = command;\r\n        // if the name is an identifier, split it\r\n        const parts = Button.splitName(name);\r\n        this.id = parts.id;\r\n        // this.name = parts.name;\r\n        // get defaults from action commandDefinition\r\n        if (command?.command?.buttonDefaults)\r\n            Obj.TypeSafeAssign(this, command.command.buttonDefaults);\r\n    }\r\n\r\n    static splitName(identifier: string): { id: string, name: string} {\r\n        const parts = identifier.split('=');\r\n        return { id: parts[0], name: parts[1] || identifier};\r\n    }\r\n\r\n    /** Configure the link generator before it creates the link */\r\n    configureLinkGenerator: (context: ContextComplete, linkGenerator: CommandLinkGenerator) => void;\r\n\r\n    /** The dialog name */\r\n    dialog?: ButtonGenOrProp<string>;\r\n\r\n    /** Check if full-screen, always a function */\r\n    fullScreen?: ButtonPropGen<boolean>;\r\n\r\n    /** Determines if the button should be disabled */\r\n    disabled?: ButtonGenOrProp<boolean>;\r\n\r\n    /** Dynamicaly determine classes - must always be a function */\r\n    dynamicClasses: ButtonPropGen<string>;\r\n\r\n    /** The icon to show in the button */\r\n    icon?: ButtonGenOrProp<string>;\r\n\r\n    /** Determine if it should use the inline window, always a function */\r\n    inlineWindow?: ButtonPropGen<boolean> = () => false;\r\n\r\n    /** Check if we should open a new window, always an FN */\r\n    newWindow?: ButtonPropGen<boolean>;\r\n\r\n    /** Method which determines if it should be shown or not */\r\n    showCondition?: ButtonPropGen<boolean>;\r\n\r\n    /** The title of this button which will usually be i18n keys */\r\n    title?: ButtonPropGen<string>;\r\n\r\n    /** Determines if this button runs in the page - affecting publishing */\r\n    partOfPage?: ButtonPropGen<boolean>;\r\n\r\n    /** The code to run for this button - if empty, will default to open a dialog */\r\n    code?: CommandCode;\r\n\r\n    /**\r\n     * Additional parameters which are used to RUN the command.\r\n     * So it's not used when preparing a toolbar button, but only when executing\r\n     */\r\n    addParamsToLink?: ButtonPropGen<CommandParams>;\r\n\r\n    /** this is just a UI interaction, won't create data so won't need pre-flight */\r\n    uiActionOnly: ButtonPropGen<boolean>;\r\n\r\n\r\n\r\n    /** Detect if this is a Button */\r\n    static is(thing: TypeTbD): thing is Button {\r\n        return (thing as Button).command !== undefined;\r\n    }\r\n\r\n    static isArray(thing: TypeTbD): thing is Button[] {\r\n        return thing.length && Button.is(thing[0]);\r\n    }\r\n\r\n    static isPropGen<T>(thing: ButtonGenOrProp<T>): thing is ButtonPropGen<T> {\r\n        return typeof thing === 'function';\r\n    }\r\n}\r\n\r\n","import { Button, ButtonPropGen } from '.';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { isNothing } from '../../plumbing';\r\n\r\n/**\r\n * Special helper to read a button configuration\r\n * and make sure that all properties have the correct fallback values\r\n */\r\nexport class ButtonSafe {\r\n    constructor(private button: Button, private context: ContextComplete) {\r\n    }\r\n\r\n    action = () => this.button.command;\r\n\r\n    classes = () => this.button.classes || '';\r\n\r\n    /** The dialog name - should default to the name */\r\n    dialog = () => getVal (this.button.dialog, this.context, this.button.command.name);\r\n\r\n    /** Determines if the button should be disabled */\r\n    disabled = () => getVal (this.button.disabled, this.context, false);\r\n\r\n    /** Dynamicaly determine classes - must always be a function */\r\n    dynamicClasses = () => getVal (this.button.dynamicClasses, this.context, '');\r\n\r\n    /** Check if full-screen, always a function */\r\n    fullScreen = () => getVal (this.button.fullScreen, this.context, false);\r\n\r\n    /** The icon to show in the button */\r\n    icon = () => getVal (this.button.icon, this.context, '');\r\n\r\n    /** Determine if it should use the inline window, always a function */\r\n    inlineWindow = () => getVal (this.button.inlineWindow, this.context, false);\r\n\r\n    /** Check if we should open a new window, always an FN */\r\n    newWindow = () => getVal (this.button.newWindow, this.context, false);\r\n\r\n    /** The parameters which are used to run the command */\r\n    addParamsToLink = () => getVal (this.button.addParamsToLink, this.context, {});\r\n\r\n\r\n    /** Determines if this button runs in the page - affecting publishing */\r\n    partOfPage = () => getVal (this.button.partOfPage, this.context, false);\r\n\r\n\r\n    /** Method which determines if it should be shown or not */\r\n    showCondition = () => getVal (this.button.showCondition, this.context, true);\r\n\r\n\r\n    /** The title of this button which will usually be i18n keys */\r\n    title = () => getVal (this.button.title, this.context, 'unknown-title');\r\n\r\n    /** this is just a UI interaction, won't create data so won't need pre-flight */\r\n    uiActionOnly = () => getVal (this.button.uiActionOnly, this.context, true);\r\n\r\n}\r\n\r\n\r\n/** Evaluate a property or generator and return the property */\r\nfunction getVal<T>(propOrGen: ButtonPropGen<T> | T, ctx: ContextComplete, fallback: T): T {\r\n    if (isNothing(propOrGen)) return fallback;\r\n    const result = (Button.isPropGen(propOrGen) ? propOrGen(ctx) : propOrGen);\r\n    return result === undefined ? fallback : result;\r\n}\r\n","// These types here are alias-types used for conversions and casting\r\n// We created aliases, so we can specifically see where/why we are doing this\r\n\r\n/** TypeTbd is a replacement for the any-type, in places where we explicitly want to check the type */\r\nexport type TypeTbD = any;\r\n\r\n/** TypeUnsafe is used in code where we explicitly want to cast to any and then to something else */\r\nexport type TypeUnsafe = any;\r\n\r\n/** TypeWeDontCare is used in places where we really want to cast something to any */\r\nexport type TypeWeDontCare = any;\r\n\r\nexport function isNothing(thing: TypeTbD) {\r\n    return thing === undefined || thing === null;\r\n}\r\n","import { Button } from '.';\r\nimport { DictionaryValue, TypeTbD } from '../../plumbing';\r\n\r\nexport class ButtonGroup {\r\n    /**\r\n     * Group name - for identification\r\n     * It's automatically set if using toolbar templates, otherwise it'll probably be undefined\r\n     */\r\n    name?: string;\r\n\r\n    defaults: DictionaryValue = {};\r\n\r\n    constructor(public buttons: Button[]) {\r\n        // adds these to the items\r\n        this.buttons = buttons || [];\r\n    }\r\n\r\n    /** Detect if this is a ButtonGroup */\r\n    static is(thing: TypeTbD): thing is ButtonGroup {\r\n        return (thing as ButtonGroup).buttons !== undefined;\r\n    }\r\n\r\n    /** Detect if this is a ButtonGroup */\r\n    static isArray(thing: TypeTbD[]): thing is ButtonGroup[] {\r\n        return thing.length && (thing[0] as ButtonGroup).buttons !== undefined;\r\n    }\r\n}\r\n","import { ButtonGroup, ToolbarSettings } from '.';\r\nimport { DictionaryValue } from '../../plumbing';\r\n\r\n/**\r\n * Runtime configuration of the toolbar.\r\n * contains a toolbar config + settings + mny groups\r\n */\r\nexport class Toolbar {\r\n    /** Toolbar ID to better identify which toolbar we're looking at - has special long name to never confuse with other IDs */\r\n    identifier: string;\r\n\r\n    /** The groups of buttons in this toolbar */\r\n    groups: ButtonGroup[] = [];\r\n\r\n    /** Setttings like floating of toolbar, etc. */\r\n    settings: ToolbarSettings;\r\n\r\n    /** Params for the commands, like EntityId, Content - Type - Name */\r\n    params: DictionaryValue;\r\n\r\n    /** show more debug info */\r\n    debug?: boolean = false;\r\n\r\n    /**  the button defaults like icon, etc. */\r\n    defaults: DictionaryValue;\r\n\r\n    constructor() {\r\n        this.identifier = Toolbar.createIdentifier();\r\n    }\r\n\r\n    static createIdentifier() {\r\n        return 'Toolbar' + Math.floor(Math.random() * 99999);\r\n    }\r\n}\r\n","import { HasLog } from '../../logging';\r\nimport { ToolbarRenderer } from './toolbar-renderer';\r\n\r\n/**\r\n * Base class for inner part renderers.\r\n * The goal is that we have the code in own objects, but that these can only be used\r\n * from the primary parent object of the type ToolbarRenderer\r\n *\r\n * @export\r\n * @class RenderPart\r\n */\r\nexport class RenderPart extends HasLog {\r\n    constructor(protected parent: ToolbarRenderer, logName: string) {\r\n        super(logName, parent.log);\r\n    }\r\n\r\n}\r\n","import { CommandParams } from '../../commands';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { HtmlTools } from '../../html/dom-tools';\r\nimport { ButtonCommand, ButtonSafe } from '../config';\r\nimport { BuildRule } from '../rules/rule';\r\nimport { RenderPart } from './render-part-base';\r\nimport { ToolbarRenderer } from './toolbar-renderer';\r\n\r\n\r\nexport class RenderButton extends RenderPart {\r\n    constructor(parent: ToolbarRenderer) {\r\n        super(parent, 'Rnd.Button');\r\n    }\r\n\r\n    render(ctx: ContextComplete, groupIndex: number): HTMLElement {\r\n        const cl = this.log.call('render', `contex: obj, group: ${groupIndex}, btn: ${ctx.button.id}/${ctx.button.command?.name}`);\r\n        const btn = new ButtonSafe(ctx.button, ctx);\r\n\r\n        // check if we have rules and merge params into the button\r\n        const rule = ctx.toolbar?.settings?._rules?.find(ctx.button.id);\r\n        if (rule) cl.data('rule found, will try to merge params', rule);\r\n        const params = ButtonCommand.mergeAdditionalParams(btn.action(), rule?.params);\r\n\r\n\r\n        const group = ctx.toolbar?.groups?.[groupIndex];\r\n        const groupName = group?.name;\r\n\r\n        const btnLink = document.createElement('a');\r\n\r\n        const disabled = btn.disabled();\r\n\r\n        // put call as plain JavaScript to preserve even if DOM is serialized\r\n        if (!disabled) btnLink.setAttribute('onclick', this.generateRunJs(ctx , params));\r\n\r\n        // Add various classes\r\n        const classes = (disabled ? ' disabled' : '')\r\n            + (btn.action() ? ` sc-${btn.action().name}` : '')\r\n            + ` in-group-${groupIndex}`\r\n            + (groupName ? ` in-group-${groupName}` : '')\r\n            + ' ' + rule?.ui.class\r\n            + ' ' + btn.classes()\r\n            + ' ' + btn.dynamicClasses();\r\n        cl.add('classes: ' + classes);\r\n        HtmlTools.addClasses(btnLink, classes);\r\n\r\n        // set title for button, optionally with i18n\r\n        this.setTitle(rule, btnLink, btn);\r\n\r\n        const divTag = document.createElement('div');\r\n        divTag.appendChild(this.iconTag(btn, rule));\r\n        btnLink.appendChild(divTag);\r\n\r\n        // set color - new in 10.27\r\n        this.processColorRules(rule, ctx, divTag);\r\n\r\n        return cl.return(btnLink);\r\n    }\r\n\r\n\r\n\r\n    private setTitle(rule: BuildRule, btnLink: HTMLAnchorElement, btn: ButtonSafe) {\r\n        const callLog = this.log.call('setTitles');\r\n        const uiTitle = rule?.ui?.title;\r\n        if (uiTitle) {\r\n            callLog.add(`uiTitle: ${uiTitle}`);\r\n            btnLink.setAttribute('title', uiTitle);\r\n        } else {\r\n            const i18nTitle = btn.title();\r\n            callLog.add(`i18nTitle: ${i18nTitle}`);\r\n            if (i18nTitle) btnLink.setAttribute('data-i18n', `[title]${i18nTitle}`);\r\n        }\r\n        callLog.done();\r\n    }\r\n\r\n    private processColorRules(rule: BuildRule, ctx: ContextComplete, divTag: HTMLDivElement) {\r\n        const callLog = this.log.call('processColorRules');\r\n        let color = rule?.ui?.color || ctx.toolbar.settings.color;\r\n\r\n        // catch edge case where the color is something like 808080 - which is treated as a number\r\n        if (color && typeof color === 'number') color = (color as number).toString();\r\n        if (color && typeof color === 'string') {\r\n            const parts = color.split(',');\r\n            if (parts[0]) divTag.style.backgroundColor = correctColorCodes(parts[0]);\r\n            if (parts[1]) divTag.style.color = correctColorCodes(parts[1]);\r\n        }\r\n\r\n        return callLog.done(color ?? 'no color');\r\n    }\r\n\r\n    private generateRunJs(ctx: ContextComplete, params: CommandParams) {\r\n        return `$2sxc(${ctx.instance.id}, ${ctx.contentBlockReference.id}).manage.run(${JSON.stringify(params)}, event);`;\r\n    }\r\n\r\n    private iconTag(btn: ButtonSafe, rule: BuildRule) {\r\n        const callLog = this.log.call('iconTag');\r\n        const symbol = document.createElement('i');\r\n        const icon = rule?.ui?.icon || btn.icon();\r\n        HtmlTools.addClasses(symbol, icon);\r\n        symbol.setAttribute('aria-hidden', 'true');\r\n        return callLog.return(symbol, icon);\r\n    }\r\n}\r\n\r\n// detect Hex-colors 6-digits or 8 in case transparent\r\nconst colorDetect = '^([A-Fa-f0-9]{6,8})$';\r\n\r\nfunction correctColorCodes(color: string) {\r\n    if (color && color.match(colorDetect)) return '#' + color;\r\n    return color;\r\n}\r\n","import { ContextBundleToolbar } from '../../context/bundles/context-bundle-toolbar';\r\nimport { ButtonGroup } from '../config';\r\nimport { RenderPart } from './render-part-base';\r\nimport { ToolbarRenderer } from './toolbar-renderer';\r\n\r\nexport class RenderButtonGroups extends RenderPart {\r\n    constructor(parent: ToolbarRenderer) {\r\n        super(parent, 'Rnd.Groups');\r\n    }\r\n\r\n    generate(context: ContextBundleToolbar): HTMLElement[] {\r\n        const cl = this.log.call('generate');\r\n        let tags: HTMLElement[] = []; // temporary storage for detached HTML DOM objects\r\n        const btnGroups = context.toolbar.groups;\r\n\r\n        for (let i = 0; i < btnGroups.length; i++)\r\n            tags = tags.concat(this.generateGroup(btnGroups[i], context, i));\r\n\r\n        return cl.return(tags, `total tags: ${tags.length}`);\r\n    }\r\n\r\n    private generateGroup(group: ButtonGroup, context: ContextBundleToolbar, groupNumber: number): HTMLElement[] {\r\n        const cl = this.log.call('generateGroup', `group #${groupNumber}`);\r\n        const tags: HTMLElement[] = []; // temporary storage for detached HTML DOM objects\r\n        const btns = group.buttons;\r\n        for (let h = 0; h < btns.length; h++) {\r\n            const btnContext = context.forButton(btns[h]);\r\n            const tag = this.parent.button.render(btnContext, groupNumber);\r\n            // add button to group of buttons\r\n            const item = document.createElement('li');\r\n            item.appendChild(tag);\r\n            tags.push(item);\r\n        }\r\n        return cl.return(tags, `tags: ${tags.length}`);\r\n    }\r\n}\r\n","import { C } from '../../constants';\r\nimport { ContextBundleToolbar } from '../../context/bundles/context-bundle-toolbar';\r\nimport { HtmlTools } from '../../html/dom-tools';\r\nimport { HasLog, Insights } from '../../logging';\r\nimport { RenderButton } from './render-button';\r\nimport { RenderButtonGroups } from './render-groups';\r\nimport { IDs } from '../../constants/ids';\r\n\r\nconst attrIdentifier = 'toolbar-identifier';\r\n\r\nexport class ToolbarRenderer extends HasLog {\r\n    private readonly groups: RenderButtonGroups;\r\n    public readonly button: RenderButton;\r\n\r\n    constructor(private context: ContextBundleToolbar) {\r\n        super('Rnd.Toolbr');\r\n        Insights.add('toolbar-render', context.toolbar?.identifier || '', this.log);\r\n        this.groups = new RenderButtonGroups(this);\r\n        this.button = new RenderButton(this);\r\n    }\r\n\r\n    /**\r\n     * Convert a generated Toolbar into an HTML-string.\r\n     * AFAIK it's only used in external scripts through older APIs, and never called directly.\r\n     */\r\n    render(): string {\r\n        const cl = this.log.call('generate');\r\n        return cl.return(this.generate().outerHTML);\r\n    }\r\n\r\n    /**\r\n     * Generate an HTML toolbar tag for adding to the page\r\n     */\r\n    generate(): HTMLUListElement {\r\n        const cl = this.log.call('generate');\r\n        // render groups of buttons\r\n        const context = this.context;\r\n        cl.data('toolbar config', context.toolbar);\r\n        const groups = this.groups.generate(context);\r\n\r\n        // render toolbar\r\n        const tlbTag = document.createElement('ul');\r\n        tlbTag.setAttribute(attrIdentifier, context.toolbar?.identifier);\r\n        tlbTag.classList.add(IDs.cls.scMenu);\r\n        tlbTag.classList.add('group-0'); // IE11 fix, add each class separately\r\n\r\n        // add behaviour classes\r\n        const settings = context.toolbar.settings;\r\n        tlbTag.classList.add(`sc-tb-hover-${settings.hover}`);\r\n        tlbTag.classList.add(`sc-tb-show-${settings.show}`);\r\n        if (context.toolbar.params.sortOrder === -1)\r\n            tlbTag.classList.add('listContent');\r\n        if (context.toolbar.params.fields)\r\n            tlbTag.classList.add('sc-sublist');\r\n\r\n        HtmlTools.addClasses(tlbTag, settings.class || settings.classes);\r\n\r\n        // add button groups to toolbar\r\n        tlbTag.setAttribute('group-count', context.toolbar.groups.length.toString());\r\n        for (let g = 0; g < groups.length; g++)\r\n            tlbTag.appendChild(groups[g]);\r\n\r\n        return cl.return(tlbTag, 'done');\r\n    }\r\n}\r\n","import { C } from '../../constants';\r\nimport { HtmlTools } from '../../html/dom-tools';\r\nimport { InPageButtonJson, InPageCommandJson, ToolbarWip } from '../config-loaders';\r\nimport * as Toolbarsettings from '../config/toolbar-settings';\r\nimport ToolbarSettings = Toolbarsettings.ToolbarSettings;\r\nimport { ToolbarTemplate } from '../templates';\r\n\r\n/**\r\n * take various common input format and convert it to a full toolbar-structure definition\r\n * can handle the following input formats (the param unstructuredConfig):\r\n * complete tree (detected by \"groups): { groups: [ {}, {}], name: ..., defaults: {...} }\r\n * group of buttons (detected by \"buttons): { buttons: \"...\" | [], name: ..., ... }\r\n * list of buttons (detected by IsArray with action): [ { action: \"...\" | []}, { action: \"\"|[]} ]\r\n * button (detected by \"command\"): { command: \"\"|[], icon: \"..\", ... }\r\n * just a command (detected by \"action\"): { entityId: 17, action: \"edit\" }\r\n * array of commands: [{entityId: 17, action: \"edit\"}, {contentType: \"blog\", action: \"new\"}]\r\n */\r\nexport type InPageToolbarConfigVariations =\r\n    ToolbarWip\r\n    | InPageButtonJson\r\n    | InPageCommandJson\r\n    | ToolbarTemplate;\r\n\r\n/**\r\n * The configuration / settings of a toolbar as loaded from the DOM\r\n */\r\nexport class ToolbarInitConfig {\r\n    toolbar: InPageToolbarConfigVariations | string[];\r\n    settings: ToolbarSettings;\r\n\r\n    /**\r\n     * Load the toolbar configuration from the sxc-toolbar attribute OR the old schema\r\n     * @param tag\r\n     * @return a configuration object or null in case of an error\r\n     */\r\n    static loadFromTag(tag: HTMLElement): ToolbarInitConfig {\r\n        try {\r\n            const newConfigFormat = HtmlTools.tryGetAttrText(tag, C.Toolbar.attr.full);\r\n            if (newConfigFormat) {\r\n                const result = JSON.parse(newConfigFormat);\r\n                // check for new V10.27 format, which is just an array!\r\n                if (Array.isArray(result))\r\n                    return { toolbar: result } as ToolbarInitConfig;\r\n                return result as ToolbarInitConfig;\r\n            } else {\r\n                const at = C.IDs.attr;\r\n                const data = HtmlTools.getFirstAttribute(tag, at.toolbar, at.toolbarData);\r\n                const settings = HtmlTools.getFirstAttribute(tag, at.settings, at.settingsData);\r\n                return {\r\n                    toolbar: JSON.parse(data),\r\n                    settings: JSON.parse(settings) as ToolbarSettings,\r\n                } as ToolbarInitConfig;\r\n            }\r\n        } catch (err) {\r\n        console.error(\r\n            'error in settings JSON - probably invalid - make sure you quote properties like \"name\": ...', tag, err);\r\n        return null;\r\n        }\r\n    }\r\n}\r\n","import { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * this will be about the current app, settings of the app, app - paths, etc.\r\n */\r\nexport class ContextOfApp {\r\n    // ContentGroup\r\n    /**\r\n     * IsContent is used for 2 things\r\n     * 1. Determine if certain buttons should be enabled in the toolbar\r\n     * 2. To forward to the quick-dialog, which changes behavior based on this\r\n     * Should default to true, because that's the more basic/restricted mode\r\n     */\r\n    isContent: boolean = true;\r\n    settingsId: number = null;\r\n    resourcesId: number = null;\r\n    appPath: string;\r\n    hasContent: boolean;\r\n    supportsAjax: boolean = false;\r\n    zoneId: number;\r\n    id: number; // appId\r\n    // languages\r\n    currentLanguage: string;\r\n    primaryLanguage: string;\r\n    allLanguages: string[] | null;\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc: SxcEdit) {\r\n        // Initialize Content-Group App information\r\n        if (editCtx.contentBlock) {\r\n            this.id = editCtx.contentBlock.AppId;\r\n            this.isContent = editCtx.contentBlock.IsContent ?? true;\r\n            this.resourcesId = editCtx.contentBlock.AppResourcesId ?? null;\r\n            this.settingsId = editCtx.contentBlock.AppSettingsId ?? null;\r\n            this.appPath = editCtx.contentBlock.AppUrl; // this is the only value which doesn't have a slash by default. note that the app-root doesn't exist when opening \"manage-app\"\r\n            this.hasContent = editCtx.contentBlock.HasContent;\r\n            this.supportsAjax = editCtx.contentBlock.SupportsAjax ?? false;\r\n            this.zoneId = editCtx.contentBlock.ZoneId;\r\n        }\r\n\r\n        // if we have more context information, use this to provide possibly missing data\r\n        if (sxc && sxc.ctx) {\r\n            this.id = this.id ?? sxc.ctx.appId;\r\n            this.zoneId = this.id ?? sxc.ctx.zoneId;\r\n        }\r\n\r\n        // Initialize language information\r\n        if (editCtx.Language) {\r\n            this.currentLanguage = editCtx.Language.Current;\r\n            this.primaryLanguage = editCtx.Language.Primary;\r\n            this.allLanguages = editCtx.Language.All;\r\n        }\r\n    }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * information related to the current contentBlock, incl\r\n */\r\nexport class ContextOfContentBlock {\r\n  // ContentGroup\r\n  isCreated: boolean;\r\n  isList: boolean;\r\n  queryId: number;\r\n  templateId: number;\r\n  contentTypeId: string;\r\n  contentGroupId: string;\r\n\r\n  // TemplateEdition for better editing\r\n  // New in 12.11\r\n  templatePath?: string;\r\n\r\n  // New in 12.11\r\n  edition?: string;\r\n\r\n  constructor(editCtx: AttrJsonEditContext) {\r\n    // Initialize Content-Group Values\r\n    const cb = editCtx.contentBlock;\r\n    if (!cb) return;\r\n    this.isCreated = cb.IsCreated;\r\n    this.isList = cb.IsList;\r\n    this.queryId = cb.QueryId;\r\n    this.templateId = cb.TemplateId;\r\n    this.templatePath = cb.TemplatePath;\r\n    this.edition = cb.Edition;\r\n    this.contentTypeId = cb.ContentTypeName;\r\n    this.contentGroupId = cb.Guid;\r\n  }\r\n\r\n}\r\n","import { SxcVersion } from '../../../../core';\r\nimport { C } from '../../constants';\r\nimport { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { AttrJsonEntity } from '../html-attribute/parts/parameters-entity';\r\n\r\n/**\r\n * information related to the current DNN module, incl.instanceId,\r\n */\r\nexport class ContextOfInstance {\r\n    id: number; // instance id (aka moduleId)\r\n    isEditable: boolean = false;\r\n    allowPublish: boolean = true;\r\n    // sxc\r\n    sxcVersion: string = SxcVersion;\r\n    parameters: AttrJsonEntity[] | null = null;\r\n    sxcRootUrl: string = '';\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc: SxcEdit) {\r\n        if (editCtx.Environment) {\r\n            this.id = editCtx.Environment.InstanceId;\r\n            this.isEditable = editCtx.Environment.IsEditable ?? false;\r\n            // sxc\r\n            this.sxcVersion = editCtx.Environment.SxcVersion ?? SxcVersion;\r\n            this.parameters = editCtx.Environment.parameters;\r\n            this.sxcRootUrl = editCtx.Environment.SxcRootUrl ?? '';\r\n        }\r\n\r\n        if (!this.id && sxc?.ctx?.moduleId)\r\n            this.id = sxc.ctx.moduleId;\r\n\r\n        if (editCtx.contentBlockReference)\r\n            this.allowPublish = editCtx.contentBlockReference.publishingMode === C.IDs.publishAllowed;\r\n    }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * information about the current item\r\n * ATM empty, not sure if it serves a purpose...\r\n */\r\nexport class ContextOfItem {\r\n    // tslint:disable-next-line: no-empty\r\n    constructor(editCtx: AttrJsonEditContext) {}\r\n}\r\n","import { SxcRootWithInternals } from '../../../$2sxc/src/index';\r\nimport { Cms } from '../cms/Cms';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { Manage } from '../manage/manage';\r\nimport { SystemUpgrader } from '../system/2sxc.system';\r\nimport { SxcEdit } from './sxc-instance-editable';\r\nimport { windowInPage as window } from './window-in-page';\r\n\r\n\r\n/**\r\n * $2sxc interface declaration merging for in-page\r\n */\r\n// ReSharper disable InconsistentNaming\r\nexport interface SxcRoot extends SxcRootWithInternals {\r\n  /**\r\n   * Get's an SxcInstance\r\n   * @param id number | HTMLElement\r\n   * @param cbid number\r\n   * @returns SxcInstance\r\n   */\r\n  // 2021-09-17 spm assume this function doesn't use jquery\r\n  (id: number | HTMLElement, cbid?: number): SxcEdit;\r\n  // insights: typeof Insights;\r\n  _manage: Manage;\r\n  system: SystemUpgrader;\r\n  translate(key: string): string;\r\n  context: typeof ContextComplete.findContext;\r\n  cms: Cms;\r\n}\r\n// ReSharper restore InconsistentNaming\r\n\r\nexport const $2sxcInPage: SxcRoot = window.$2sxc;\r\n","import { $2sxcInPage } from '../../interfaces/sxc-controller-in-page';\r\nimport { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * this will be information related to the current page\r\n */\r\nexport class ContextOfPage {\r\n    id: number;\r\n    // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n    // url: string;\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc: SxcEdit) {\r\n        if (editCtx.Environment) {\r\n            this.id = editCtx.Environment.PageId;\r\n            // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n            // this.url = editCtx.Environment.PageUrl;\r\n        }\r\n\r\n        // catch cases where it wasn't provided\r\n        this.id = this.id ?? sxc?.ctx?.pageId ?? $2sxcInPage.env.page();\r\n    }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * this will be everything about the current system, like system / api -paths etc.\r\n */\r\nexport class ContextOfSystem {\r\n    error: string;\r\n\r\n    constructor(editCtx: AttrJsonEditContext) {\r\n        if (editCtx.error) {\r\n            this.error = editCtx.error.type;\r\n        }\r\n    }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * this will be something about the current tenant(the dnn portal)\r\n */\r\nexport class ContextOfTenant {\r\n    // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n    // id: number;\r\n    // url: string;\r\n\r\n    constructor(editCtx: AttrJsonEditContext) {\r\n        if (editCtx.Environment) {\r\n            // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n            // this.id = editCtx.Environment.WebsiteId;\r\n            // this.url = editCtx.Environment.WebsiteUrl;\r\n        }\r\n    }\r\n}\r\n","import { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * ensure that the UI will load the correct assets to enable editing\r\n */\r\nexport class ContextOfUi {\r\n    autoToolbar?: boolean; // toolbar auto-show\r\n    form: string; // decide which dialog opens, eg ng10\r\n\r\n    constructor(editCtx: AttrJsonEditContext) {\r\n        if (editCtx.Ui) {\r\n            this.autoToolbar = editCtx.Ui.AutoToolbar; // toolbar auto-show\r\n            if (editCtx.Ui.Form) this.form = editCtx.Ui.Form; // decide which dialog opens, eg ng8\r\n        }\r\n    }\r\n}\r\n","import { ContextComplete } from '..';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\n\r\n/**\r\n * things about the user\r\n * note that the properties are also used in url-params and ajax calls, so don't rename\r\n */\r\nexport class ContextOfUser {\r\n    canDesign: boolean;\r\n    canDevelop: boolean;\r\n\r\n    constructor(editCtx?: AttrJsonEditContext) {\r\n        if (!editCtx || !editCtx.User) return;\r\n        this.canDesign = editCtx.User.CanDesign;\r\n        this.canDevelop = editCtx.User.CanDevelop;\r\n    }\r\n\r\n    static fromContext(context: ContextComplete): ContextOfUser {\r\n        const user = new ContextOfUser();\r\n        user.canDesign = context.user.canDesign;\r\n        user.canDevelop = context.user.canDevelop;\r\n        return user;\r\n    }\r\n}\r\n","import { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { TypeTbD } from '../../plumbing';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { ContextOfInstance, ContextOfPage, ContextOfSystem, ContextOfTenant, ContextOfUser } from '../parts';\r\nimport { ContextOfApp } from '../parts/context-app';\r\nimport { ContextOfUi } from '../parts/context-ui';\r\n\r\n\r\nexport class ContextBundleInstance {\r\n    sxc: SxcEdit; // instance of sxc object\r\n    instance: ContextOfInstance; // information related to the current DNN module, incl.instanceId, etc.\r\n    app: ContextOfApp; // this will be about the current app, settings of the app, app - paths, etc.\r\n    ui: ContextOfUi; // ensure that the UI will load the correct assets to enable editing\r\n    page: ContextOfPage; // this will be information related to the current page\r\n    system: ContextOfSystem; // this will be everything about the current system, like system / api -paths etc.\r\n    tenant: ContextOfTenant; // this will be something about the current tenant(the dnn portal)\r\n    user: ContextOfUser; // things about the user\r\n\r\n    _isContext = true;\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc: SxcEdit) {\r\n        // this will be about the current app, settings of the app, app - paths, etc.\r\n        this.app = new ContextOfApp(editCtx, sxc);\r\n\r\n        // information related to the current DNN module, incl.instanceId, etc.\r\n        this.instance = new ContextOfInstance(editCtx, sxc);\r\n\r\n        // things about the user\r\n        this.user = new ContextOfUser(editCtx);\r\n\r\n        // this will be information related to the current page\r\n        this.page = new ContextOfPage(editCtx, sxc);\r\n\r\n        // this will be everything about the current system, like system / api -paths etc.\r\n        this.system = new ContextOfSystem(editCtx);\r\n\r\n        // this will be something about the current tenant(the dnn portal)\r\n        this.tenant = new ContextOfTenant(editCtx);\r\n\r\n        // ensure that the UI will load the correct assets to enable editing\r\n        this.ui = new ContextOfUi(editCtx);\r\n\r\n    }\r\n\r\n    static is(thing: TypeTbD): thing is ContextBundleInstance {\r\n        const maybeButton = thing as ContextBundleInstance;\r\n        return maybeButton.sxc !== undefined && maybeButton.instance !== undefined;\r\n    }\r\n}\r\n","import { NumberNotDefinedHuge } from '../../../../../core';\r\nimport { IDs } from '../../../constants/ids';\r\n\r\n/**\r\n * This contains a pointer to a content-block. The data is always provided by the server,\r\n * so this class is never really instantiated.\r\n */\r\nexport class ContentBlockReference {\r\n  /** How changes are published - draft required/optional */\r\n  public publishingMode: string = IDs.publishAllowed;\r\n\r\n  /** ID of the reference item - very rarely used */\r\n  public id: number = NumberNotDefinedHuge;\r\n\r\n  /** GUID of the parent item referencing this Content Block */\r\n  public parentGuid: string = null;\r\n\r\n  /** Field in which this content block is references */\r\n  public parentField: string = null;\r\n\r\n  /** Index of the reference - what position it's in in the list of that field */\r\n  public parentIndex: number = 0;\r\n\r\n  /** If this content is part of the page */\r\n  public partOfPage: boolean = false;\r\n\r\n  constructor(original: Partial<ContentBlockReference>) {\r\n      Object.assign(this, original);\r\n  }\r\n}\r\n","import { ContextBundleInstance, ContextOfContentBlock, ContextOfItem } from '..';\r\nimport { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { ContentBlockReference } from '../html-attribute/parts/content-block';\r\n\r\nexport class ContextBundleContent extends ContextBundleInstance {\r\n  /** information about the current item */\r\n  item: ContextOfItem;\r\n\r\n  /** Reference to a Content-Block */\r\n  contentBlockReference: ContentBlockReference;\r\n\r\n  /** The content-block itself with specs like is-app, etc. */\r\n  contentBlock: ContextOfContentBlock;\r\n\r\n  constructor(editCtx: AttrJsonEditContext, sxc: SxcEdit) {\r\n    super(editCtx, sxc);\r\n\r\n    // information about the current item\r\n    this.item = new ContextOfItem(editCtx);\r\n\r\n    this.contentBlockReference = new ContentBlockReference(editCtx.contentBlockReference);\r\n\r\n    // information related to the current contentBlock\r\n    this.contentBlock = new ContextOfContentBlock(editCtx);\r\n  }\r\n}\r\n","import { ContextBundleContent, ContextComplete } from '.';\r\nimport { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { Button } from '../../toolbar/config/button';\r\nimport { Toolbar } from '../../toolbar/config/toolbar';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\n\r\nexport class ContextBundleToolbar extends ContextBundleContent {\r\n    toolbar: Toolbar;\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc: SxcEdit) {\r\n        super(editCtx, sxc);\r\n        // note that the toolbar will not be filled here, as it will be filled somewhere else\r\n    }\r\n\r\n    forButton(button: Button): ContextComplete {\r\n        // the ContextBundleButton is the same as toolbar, just with .button\r\n        const clone = {...this} as unknown as ContextComplete;\r\n        clone.button = button;\r\n        return clone;\r\n    }\r\n}\r\n","import { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { Obj } from '../../plumbing';\r\nimport { Button } from '../../toolbar/config/button';\r\nimport { WorkflowManager } from '../../workflow';\r\nimport { AttrJsonEditContext } from '../html-attribute';\r\nimport { ContextBundleToolbar } from './context-bundle-toolbar';\r\n\r\nexport class ContextComplete extends ContextBundleToolbar {\r\n    button?: Button;\r\n\r\n    commandWorkflow?: WorkflowManager;\r\n\r\n    constructor(editCtx: AttrJsonEditContext, sxc?: SxcEdit) {\r\n        super(editCtx, sxc);\r\n        // note that the button will not be filled here, as it will be filled somewhere else\r\n    }\r\n\r\n    /**\r\n     * Primary API to get the context (context is cached)\r\n     * @param htmlElement or Id (moduleId)\r\n     * @param cbid\r\n     */\r\n    static findContext(tagOrSxc: SxcEdit | HTMLElement | number, cbid?: number): ContextComplete {\r\n        // 2021-09-17 spm assume this function doesn't use jquery\r\n        let sxc: SxcEdit;\r\n        let containerTag: HTMLElement = null;\r\n\r\n        if (SxcEdit.is(tagOrSxc)) { // it is SxcInstance\r\n            sxc = tagOrSxc;\r\n        } else if (typeof tagOrSxc === 'number') { // it is number\r\n            sxc = SxcEdit.get(tagOrSxc, cbid);\r\n        } else { // it is HTMLElement\r\n            sxc = SxcEdit.get(tagOrSxc);\r\n            containerTag = SxcEdit.getContainerTag(tagOrSxc);\r\n        }\r\n\r\n        const contextOfButton = ContextComplete.getContextInstance(sxc, containerTag);\r\n        contextOfButton.sxc = sxc;\r\n        return contextOfButton;\r\n    }\r\n\r\n    /**\r\n     * Create copy of context, so it can be modified before use\r\n     * @param htmlElement or Id (moduleId)\r\n     * @param cbid\r\n     */\r\n    static contextCopy(htmlElementOrId: HTMLElement | number, cbid?: number): ContextComplete {\r\n        const contextOfButton = ContextComplete.findContext(htmlElementOrId, cbid);\r\n        // set sxc to null because of cyclic reference, so we can serialize it\r\n        contextOfButton.sxc = null;\r\n        // make a copy\r\n        const copyOfContext = Obj.DeepClone(contextOfButton); // JSON.parse(JSON.stringify(contextOfButton));\r\n        // bring sxc back to context\r\n        contextOfButton.sxc = SxcEdit.get(htmlElementOrId) as SxcEdit;\r\n        return copyOfContext;\r\n    }\r\n\r\n    /**\r\n     * Create new context\r\n     * @param sxc\r\n     * @param htmlElement\r\n     */\r\n    static getContextInstance(sxc: SxcEdit, htmlElement?: HTMLElement): ContextComplete {\r\n        const editContext = SxcEdit.getEditContext(sxc, htmlElement);\r\n        return new ContextComplete(editContext, sxc);\r\n    }\r\n\r\n}\r\n","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty\";\nexport default function _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? Object(arguments[i]) : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","import _typeof from \"../../helpers/esm/typeof\";\nimport assertThisInitialized from \"./assertThisInitialized\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(n);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithHoles from \"./arrayWithHoles\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableRest from \"./nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import _typeof from '@babel/runtime/helpers/esm/typeof';\nimport _objectSpread from '@babel/runtime/helpers/esm/objectSpread';\nimport _classCallCheck from '@babel/runtime/helpers/esm/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/esm/createClass';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/esm/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/esm/getPrototypeOf';\nimport _assertThisInitialized from '@babel/runtime/helpers/esm/assertThisInitialized';\nimport _inherits from '@babel/runtime/helpers/esm/inherits';\nimport _toConsumableArray from '@babel/runtime/helpers/esm/toConsumableArray';\nimport _slicedToArray from '@babel/runtime/helpers/esm/slicedToArray';\n\nvar consoleLogger = {\n  type: 'logger',\n  log: function log(args) {\n    this.output('log', args);\n  },\n  warn: function warn(args) {\n    this.output('warn', args);\n  },\n  error: function error(args) {\n    this.output('error', args);\n  },\n  output: function output(type, args) {\n    var _console;\n\n    /* eslint no-console: 0 */\n    if (console && console[type]) (_console = console)[type].apply(_console, _toConsumableArray(args));\n  }\n};\n\nvar Logger =\n/*#__PURE__*/\nfunction () {\n  function Logger(concreteLogger) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Logger);\n\n    this.init(concreteLogger, options);\n  }\n\n  _createClass(Logger, [{\n    key: \"init\",\n    value: function init(concreteLogger) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      this.prefix = options.prefix || 'i18next:';\n      this.logger = concreteLogger || consoleLogger;\n      this.options = options;\n      this.debug = options.debug;\n    }\n  }, {\n    key: \"setDebug\",\n    value: function setDebug(bool) {\n      this.debug = bool;\n    }\n  }, {\n    key: \"log\",\n    value: function log() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return this.forward(args, 'log', '', true);\n    }\n  }, {\n    key: \"warn\",\n    value: function warn() {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      return this.forward(args, 'warn', '', true);\n    }\n  }, {\n    key: \"error\",\n    value: function error() {\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      return this.forward(args, 'error', '');\n    }\n  }, {\n    key: \"deprecate\",\n    value: function deprecate() {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      return this.forward(args, 'warn', 'WARNING DEPRECATED: ', true);\n    }\n  }, {\n    key: \"forward\",\n    value: function forward(args, lvl, prefix, debugOnly) {\n      if (debugOnly && !this.debug) return null;\n      if (typeof args[0] === 'string') args[0] = \"\".concat(prefix).concat(this.prefix, \" \").concat(args[0]);\n      return this.logger[lvl](args);\n    }\n  }, {\n    key: \"create\",\n    value: function create(moduleName) {\n      return new Logger(this.logger, _objectSpread({}, {\n        prefix: \"\".concat(this.prefix, \":\").concat(moduleName, \":\")\n      }, this.options));\n    }\n  }]);\n\n  return Logger;\n}();\n\nvar baseLogger = new Logger();\n\nvar EventEmitter =\n/*#__PURE__*/\nfunction () {\n  function EventEmitter() {\n    _classCallCheck(this, EventEmitter);\n\n    this.observers = {};\n  }\n\n  _createClass(EventEmitter, [{\n    key: \"on\",\n    value: function on(events, listener) {\n      var _this = this;\n\n      events.split(' ').forEach(function (event) {\n        _this.observers[event] = _this.observers[event] || [];\n\n        _this.observers[event].push(listener);\n      });\n      return this;\n    }\n  }, {\n    key: \"off\",\n    value: function off(event, listener) {\n      if (!this.observers[event]) return;\n\n      if (!listener) {\n        delete this.observers[event];\n        return;\n      }\n\n      this.observers[event] = this.observers[event].filter(function (l) {\n        return l !== listener;\n      });\n    }\n  }, {\n    key: \"emit\",\n    value: function emit(event) {\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      if (this.observers[event]) {\n        var cloned = [].concat(this.observers[event]);\n        cloned.forEach(function (observer) {\n          observer.apply(void 0, args);\n        });\n      }\n\n      if (this.observers['*']) {\n        var _cloned = [].concat(this.observers['*']);\n\n        _cloned.forEach(function (observer) {\n          observer.apply(observer, [event].concat(args));\n        });\n      }\n    }\n  }]);\n\n  return EventEmitter;\n}();\n\n// http://lea.verou.me/2016/12/resolve-promises-externally-with-this-one-weird-trick/\nfunction defer() {\n  var res;\n  var rej;\n  var promise = new Promise(function (resolve, reject) {\n    res = resolve;\n    rej = reject;\n  });\n  promise.resolve = res;\n  promise.reject = rej;\n  return promise;\n}\nfunction makeString(object) {\n  if (object == null) return '';\n  /* eslint prefer-template: 0 */\n\n  return '' + object;\n}\nfunction copy(a, s, t) {\n  a.forEach(function (m) {\n    if (s[m]) t[m] = s[m];\n  });\n}\n\nfunction getLastOfPath(object, path, Empty) {\n  function cleanKey(key) {\n    return key && key.indexOf('###') > -1 ? key.replace(/###/g, '.') : key;\n  }\n\n  function canNotTraverseDeeper() {\n    return !object || typeof object === 'string';\n  }\n\n  var stack = typeof path !== 'string' ? [].concat(path) : path.split('.');\n\n  while (stack.length > 1) {\n    if (canNotTraverseDeeper()) return {};\n    var key = cleanKey(stack.shift());\n    if (!object[key] && Empty) object[key] = new Empty();\n    object = object[key];\n  }\n\n  if (canNotTraverseDeeper()) return {};\n  return {\n    obj: object,\n    k: cleanKey(stack.shift())\n  };\n}\n\nfunction setPath(object, path, newValue) {\n  var _getLastOfPath = getLastOfPath(object, path, Object),\n      obj = _getLastOfPath.obj,\n      k = _getLastOfPath.k;\n\n  obj[k] = newValue;\n}\nfunction pushPath(object, path, newValue, concat) {\n  var _getLastOfPath2 = getLastOfPath(object, path, Object),\n      obj = _getLastOfPath2.obj,\n      k = _getLastOfPath2.k;\n\n  obj[k] = obj[k] || [];\n  if (concat) obj[k] = obj[k].concat(newValue);\n  if (!concat) obj[k].push(newValue);\n}\nfunction getPath(object, path) {\n  var _getLastOfPath3 = getLastOfPath(object, path),\n      obj = _getLastOfPath3.obj,\n      k = _getLastOfPath3.k;\n\n  if (!obj) return undefined;\n  return obj[k];\n}\nfunction getPathWithDefaults(data, defaultData, key) {\n  var value = getPath(data, key);\n\n  if (value !== undefined) {\n    return value;\n  } // Fallback to default values\n\n\n  return getPath(defaultData, key);\n}\nfunction deepExtend(target, source, overwrite) {\n  /* eslint no-restricted-syntax: 0 */\n  for (var prop in source) {\n    if (prop in target) {\n      // If we reached a leaf string in target or source then replace with source or skip depending on the 'overwrite' switch\n      if (typeof target[prop] === 'string' || target[prop] instanceof String || typeof source[prop] === 'string' || source[prop] instanceof String) {\n        if (overwrite) target[prop] = source[prop];\n      } else {\n        deepExtend(target[prop], source[prop], overwrite);\n      }\n    } else {\n      target[prop] = source[prop];\n    }\n  }\n\n  return target;\n}\nfunction regexEscape(str) {\n  /* eslint no-useless-escape: 0 */\n  return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n}\n/* eslint-disable */\n\nvar _entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;'\n};\n/* eslint-enable */\n\nfunction escape(data) {\n  if (typeof data === 'string') {\n    return data.replace(/[&<>\"'\\/]/g, function (s) {\n      return _entityMap[s];\n    });\n  }\n\n  return data;\n}\n\nvar ResourceStore =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(ResourceStore, _EventEmitter);\n\n  function ResourceStore(data) {\n    var _this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      ns: ['translation'],\n      defaultNS: 'translation'\n    };\n\n    _classCallCheck(this, ResourceStore);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ResourceStore).call(this));\n    EventEmitter.call(_assertThisInitialized(_this)); // <=IE10 fix (unable to call parent constructor)\n\n    _this.data = data || {};\n    _this.options = options;\n\n    if (_this.options.keySeparator === undefined) {\n      _this.options.keySeparator = '.';\n    }\n\n    return _this;\n  }\n\n  _createClass(ResourceStore, [{\n    key: \"addNamespaces\",\n    value: function addNamespaces(ns) {\n      if (this.options.ns.indexOf(ns) < 0) {\n        this.options.ns.push(ns);\n      }\n    }\n  }, {\n    key: \"removeNamespaces\",\n    value: function removeNamespaces(ns) {\n      var index = this.options.ns.indexOf(ns);\n\n      if (index > -1) {\n        this.options.ns.splice(index, 1);\n      }\n    }\n  }, {\n    key: \"getResource\",\n    value: function getResource(lng, ns, key) {\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n      var path = [lng, ns];\n      if (key && typeof key !== 'string') path = path.concat(key);\n      if (key && typeof key === 'string') path = path.concat(keySeparator ? key.split(keySeparator) : key);\n\n      if (lng.indexOf('.') > -1) {\n        path = lng.split('.');\n      }\n\n      return getPath(this.data, path);\n    }\n  }, {\n    key: \"addResource\",\n    value: function addResource(lng, ns, key, value) {\n      var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {\n        silent: false\n      };\n      var keySeparator = this.options.keySeparator;\n      if (keySeparator === undefined) keySeparator = '.';\n      var path = [lng, ns];\n      if (key) path = path.concat(keySeparator ? key.split(keySeparator) : key);\n\n      if (lng.indexOf('.') > -1) {\n        path = lng.split('.');\n        value = ns;\n        ns = path[1];\n      }\n\n      this.addNamespaces(ns);\n      setPath(this.data, path, value);\n      if (!options.silent) this.emit('added', lng, ns, key, value);\n    }\n  }, {\n    key: \"addResources\",\n    value: function addResources(lng, ns, resources) {\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n        silent: false\n      };\n\n      /* eslint no-restricted-syntax: 0 */\n      for (var m in resources) {\n        if (typeof resources[m] === 'string' || Object.prototype.toString.apply(resources[m]) === '[object Array]') this.addResource(lng, ns, m, resources[m], {\n          silent: true\n        });\n      }\n\n      if (!options.silent) this.emit('added', lng, ns, resources);\n    }\n  }, {\n    key: \"addResourceBundle\",\n    value: function addResourceBundle(lng, ns, resources, deep, overwrite) {\n      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {\n        silent: false\n      };\n      var path = [lng, ns];\n\n      if (lng.indexOf('.') > -1) {\n        path = lng.split('.');\n        deep = resources;\n        resources = ns;\n        ns = path[1];\n      }\n\n      this.addNamespaces(ns);\n      var pack = getPath(this.data, path) || {};\n\n      if (deep) {\n        deepExtend(pack, resources, overwrite);\n      } else {\n        pack = _objectSpread({}, pack, resources);\n      }\n\n      setPath(this.data, path, pack);\n      if (!options.silent) this.emit('added', lng, ns, resources);\n    }\n  }, {\n    key: \"removeResourceBundle\",\n    value: function removeResourceBundle(lng, ns) {\n      if (this.hasResourceBundle(lng, ns)) {\n        delete this.data[lng][ns];\n      }\n\n      this.removeNamespaces(ns);\n      this.emit('removed', lng, ns);\n    }\n  }, {\n    key: \"hasResourceBundle\",\n    value: function hasResourceBundle(lng, ns) {\n      return this.getResource(lng, ns) !== undefined;\n    }\n  }, {\n    key: \"getResourceBundle\",\n    value: function getResourceBundle(lng, ns) {\n      if (!ns) ns = this.options.defaultNS; // COMPATIBILITY: remove extend in v2.1.0\n\n      if (this.options.compatibilityAPI === 'v1') return _objectSpread({}, {}, this.getResource(lng, ns));\n      return this.getResource(lng, ns);\n    }\n  }, {\n    key: \"getDataByLanguage\",\n    value: function getDataByLanguage(lng) {\n      return this.data[lng];\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.data;\n    }\n  }]);\n\n  return ResourceStore;\n}(EventEmitter);\n\nvar postProcessor = {\n  processors: {},\n  addPostProcessor: function addPostProcessor(module) {\n    this.processors[module.name] = module;\n  },\n  handle: function handle(processors, value, key, options, translator) {\n    var _this = this;\n\n    processors.forEach(function (processor) {\n      if (_this.processors[processor]) value = _this.processors[processor].process(value, key, options, translator);\n    });\n    return value;\n  }\n};\n\nvar checkedLoadedFor = {};\n\nvar Translator =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(Translator, _EventEmitter);\n\n  function Translator(services) {\n    var _this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Translator);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Translator).call(this));\n    EventEmitter.call(_assertThisInitialized(_this)); // <=IE10 fix (unable to call parent constructor)\n\n    copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector', 'i18nFormat', 'utils'], services, _assertThisInitialized(_this));\n    _this.options = options;\n\n    if (_this.options.keySeparator === undefined) {\n      _this.options.keySeparator = '.';\n    }\n\n    _this.logger = baseLogger.create('translator');\n    return _this;\n  }\n\n  _createClass(Translator, [{\n    key: \"changeLanguage\",\n    value: function changeLanguage(lng) {\n      if (lng) this.language = lng;\n    }\n  }, {\n    key: \"exists\",\n    value: function exists(key) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        interpolation: {}\n      };\n      var resolved = this.resolve(key, options);\n      return resolved && resolved.res !== undefined;\n    }\n  }, {\n    key: \"extractFromKey\",\n    value: function extractFromKey(key, options) {\n      var nsSeparator = options.nsSeparator || this.options.nsSeparator;\n      if (nsSeparator === undefined) nsSeparator = ':';\n      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n      var namespaces = options.ns || this.options.defaultNS;\n\n      if (nsSeparator && key.indexOf(nsSeparator) > -1) {\n        var parts = key.split(nsSeparator);\n        if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();\n        key = parts.join(keySeparator);\n      }\n\n      if (typeof namespaces === 'string') namespaces = [namespaces];\n      return {\n        key: key,\n        namespaces: namespaces\n      };\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(keys, options) {\n      var _this2 = this;\n\n      if (_typeof(options) !== 'object' && this.options.overloadTranslationOptionHandler) {\n        /* eslint prefer-rest-params: 0 */\n        options = this.options.overloadTranslationOptionHandler(arguments);\n      }\n\n      if (!options) options = {}; // non valid keys handling\n\n      if (keys === undefined || keys === null\n      /* || keys === ''*/\n      ) return '';\n      if (!Array.isArray(keys)) keys = [String(keys)]; // separators\n\n      var keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator; // get namespace(s)\n\n      var _this$extractFromKey = this.extractFromKey(keys[keys.length - 1], options),\n          key = _this$extractFromKey.key,\n          namespaces = _this$extractFromKey.namespaces;\n\n      var namespace = namespaces[namespaces.length - 1]; // return key on CIMode\n\n      var lng = options.lng || this.language;\n      var appendNamespaceToCIMode = options.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;\n\n      if (lng && lng.toLowerCase() === 'cimode') {\n        if (appendNamespaceToCIMode) {\n          var nsSeparator = options.nsSeparator || this.options.nsSeparator;\n          return namespace + nsSeparator + key;\n        }\n\n        return key;\n      } // resolve from store\n\n\n      var resolved = this.resolve(keys, options);\n      var res = resolved && resolved.res;\n      var resUsedKey = resolved && resolved.usedKey || key;\n      var resExactUsedKey = resolved && resolved.exactUsedKey || key;\n      var resType = Object.prototype.toString.apply(res);\n      var noObject = ['[object Number]', '[object Function]', '[object RegExp]'];\n      var joinArrays = options.joinArrays !== undefined ? options.joinArrays : this.options.joinArrays; // object\n\n      var handleAsObjectInI18nFormat = !this.i18nFormat || this.i18nFormat.handleAsObject;\n      var handleAsObject = typeof res !== 'string' && typeof res !== 'boolean' && typeof res !== 'number';\n\n      if (handleAsObjectInI18nFormat && res && handleAsObject && noObject.indexOf(resType) < 0 && !(typeof joinArrays === 'string' && resType === '[object Array]')) {\n        if (!options.returnObjects && !this.options.returnObjects) {\n          this.logger.warn('accessing an object - but returnObjects options is not enabled!');\n          return this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, res, options) : \"key '\".concat(key, \" (\").concat(this.language, \")' returned an object instead of string.\");\n        } // if we got a separator we loop over children - else we just return object as is\n        // as having it set to false means no hierarchy so no lookup for nested values\n\n\n        if (keySeparator) {\n          var resTypeIsArray = resType === '[object Array]';\n          var copy$$1 = resTypeIsArray ? [] : {}; // apply child translation on a copy\n\n          /* eslint no-restricted-syntax: 0 */\n\n          var newKeyToUse = resTypeIsArray ? resExactUsedKey : resUsedKey;\n\n          for (var m in res) {\n            if (Object.prototype.hasOwnProperty.call(res, m)) {\n              var deepKey = \"\".concat(newKeyToUse).concat(keySeparator).concat(m);\n              copy$$1[m] = this.translate(deepKey, _objectSpread({}, options, {\n                joinArrays: false,\n                ns: namespaces\n              }));\n              if (copy$$1[m] === deepKey) copy$$1[m] = res[m]; // if nothing found use orginal value as fallback\n            }\n          }\n\n          res = copy$$1;\n        }\n      } else if (handleAsObjectInI18nFormat && typeof joinArrays === 'string' && resType === '[object Array]') {\n        // array special treatment\n        res = res.join(joinArrays);\n        if (res) res = this.extendTranslation(res, keys, options);\n      } else {\n        // string, empty or null\n        var usedDefault = false;\n        var usedKey = false; // fallback value\n\n        if (!this.isValidLookup(res) && options.defaultValue !== undefined) {\n          usedDefault = true;\n\n          if (options.count !== undefined) {\n            var suffix = this.pluralResolver.getSuffix(lng, options.count);\n            res = options[\"defaultValue\".concat(suffix)];\n          }\n\n          if (!res) res = options.defaultValue;\n        }\n\n        if (!this.isValidLookup(res)) {\n          usedKey = true;\n          res = key;\n        } // save missing\n\n\n        var updateMissing = options.defaultValue && options.defaultValue !== res && this.options.updateMissing;\n\n        if (usedKey || usedDefault || updateMissing) {\n          this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? options.defaultValue : res);\n          var lngs = [];\n          var fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, options.lng || this.language);\n\n          if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {\n            for (var i = 0; i < fallbackLngs.length; i++) {\n              lngs.push(fallbackLngs[i]);\n            }\n          } else if (this.options.saveMissingTo === 'all') {\n            lngs = this.languageUtils.toResolveHierarchy(options.lng || this.language);\n          } else {\n            lngs.push(options.lng || this.language);\n          }\n\n          var send = function send(l, k) {\n            if (_this2.options.missingKeyHandler) {\n              _this2.options.missingKeyHandler(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);\n            } else if (_this2.backendConnector && _this2.backendConnector.saveMissing) {\n              _this2.backendConnector.saveMissing(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);\n            }\n\n            _this2.emit('missingKey', l, namespace, k, res);\n          };\n\n          if (this.options.saveMissing) {\n            var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';\n\n            if (this.options.saveMissingPlurals && needsPluralHandling) {\n              lngs.forEach(function (l) {\n                var plurals = _this2.pluralResolver.getPluralFormsOfKey(l, key);\n\n                plurals.forEach(function (p) {\n                  return send([l], p);\n                });\n              });\n            } else {\n              send(lngs, key);\n            }\n          }\n        } // extend\n\n\n        res = this.extendTranslation(res, keys, options, resolved); // append namespace if still key\n\n        if (usedKey && res === key && this.options.appendNamespaceToMissingKey) res = \"\".concat(namespace, \":\").concat(key); // parseMissingKeyHandler\n\n        if (usedKey && this.options.parseMissingKeyHandler) res = this.options.parseMissingKeyHandler(res);\n      } // return\n\n\n      return res;\n    }\n  }, {\n    key: \"extendTranslation\",\n    value: function extendTranslation(res, key, options, resolved) {\n      var _this3 = this;\n\n      if (this.i18nFormat && this.i18nFormat.parse) {\n        res = this.i18nFormat.parse(res, options, resolved.usedLng, resolved.usedNS, resolved.usedKey, {\n          resolved: resolved\n        });\n      } else if (!options.skipInterpolation) {\n        // i18next.parsing\n        if (options.interpolation) this.interpolator.init(_objectSpread({}, options, {\n          interpolation: _objectSpread({}, this.options.interpolation, options.interpolation)\n        })); // interpolate\n\n        var data = options.replace && typeof options.replace !== 'string' ? options.replace : options;\n        if (this.options.interpolation.defaultVariables) data = _objectSpread({}, this.options.interpolation.defaultVariables, data);\n        res = this.interpolator.interpolate(res, data, options.lng || this.language, options); // nesting\n\n        if (options.nest !== false) res = this.interpolator.nest(res, function () {\n          return _this3.translate.apply(_this3, arguments);\n        }, options);\n        if (options.interpolation) this.interpolator.reset();\n      } // post process\n\n\n      var postProcess = options.postProcess || this.options.postProcess;\n      var postProcessorNames = typeof postProcess === 'string' ? [postProcess] : postProcess;\n\n      if (res !== undefined && res !== null && postProcessorNames && postProcessorNames.length && options.applyPostProcessor !== false) {\n        res = postProcessor.handle(postProcessorNames, res, key, this.options && this.options.postProcessPassResolved ? _objectSpread({\n          i18nResolved: resolved\n        }, options) : options, this);\n      }\n\n      return res;\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(keys) {\n      var _this4 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var found;\n      var usedKey; // plain key\n\n      var exactUsedKey; // key with context / plural\n\n      var usedLng;\n      var usedNS;\n      if (typeof keys === 'string') keys = [keys]; // forEach possible key\n\n      keys.forEach(function (k) {\n        if (_this4.isValidLookup(found)) return;\n\n        var extracted = _this4.extractFromKey(k, options);\n\n        var key = extracted.key;\n        usedKey = key;\n        var namespaces = extracted.namespaces;\n        if (_this4.options.fallbackNS) namespaces = namespaces.concat(_this4.options.fallbackNS);\n        var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';\n        var needsContextHandling = options.context !== undefined && typeof options.context === 'string' && options.context !== '';\n        var codes = options.lngs ? options.lngs : _this4.languageUtils.toResolveHierarchy(options.lng || _this4.language, options.fallbackLng);\n        namespaces.forEach(function (ns) {\n          if (_this4.isValidLookup(found)) return;\n          usedNS = ns;\n\n          if (!checkedLoadedFor[\"\".concat(codes[0], \"-\").concat(ns)] && _this4.utils && _this4.utils.hasLoadedNamespace && !_this4.utils.hasLoadedNamespace(usedNS)) {\n            checkedLoadedFor[\"\".concat(codes[0], \"-\").concat(ns)] = true;\n\n            _this4.logger.warn(\"key \\\"\".concat(usedKey, \"\\\" for namespace \\\"\").concat(usedNS, \"\\\" for languages \\\"\").concat(codes.join(', '), \"\\\" won't get resolved as namespace was not yet loaded\"), 'This means something IS WRONG in your application setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n          }\n\n          codes.forEach(function (code) {\n            if (_this4.isValidLookup(found)) return;\n            usedLng = code;\n            var finalKey = key;\n            var finalKeys = [finalKey];\n\n            if (_this4.i18nFormat && _this4.i18nFormat.addLookupKeys) {\n              _this4.i18nFormat.addLookupKeys(finalKeys, key, code, ns, options);\n            } else {\n              var pluralSuffix;\n              if (needsPluralHandling) pluralSuffix = _this4.pluralResolver.getSuffix(code, options.count); // fallback for plural if context not found\n\n              if (needsPluralHandling && needsContextHandling) finalKeys.push(finalKey + pluralSuffix); // get key for context if needed\n\n              if (needsContextHandling) finalKeys.push(finalKey += \"\".concat(_this4.options.contextSeparator).concat(options.context)); // get key for plural if needed\n\n              if (needsPluralHandling) finalKeys.push(finalKey += pluralSuffix);\n            } // iterate over finalKeys starting with most specific pluralkey (-> contextkey only) -> singularkey only\n\n\n            var possibleKey;\n            /* eslint no-cond-assign: 0 */\n\n            while (possibleKey = finalKeys.pop()) {\n              if (!_this4.isValidLookup(found)) {\n                exactUsedKey = possibleKey;\n                found = _this4.getResource(code, ns, possibleKey, options);\n              }\n            }\n          });\n        });\n      });\n      return {\n        res: found,\n        usedKey: usedKey,\n        exactUsedKey: exactUsedKey,\n        usedLng: usedLng,\n        usedNS: usedNS\n      };\n    }\n  }, {\n    key: \"isValidLookup\",\n    value: function isValidLookup(res) {\n      return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');\n    }\n  }, {\n    key: \"getResource\",\n    value: function getResource(code, ns, key) {\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      if (this.i18nFormat && this.i18nFormat.getResource) return this.i18nFormat.getResource(code, ns, key, options);\n      return this.resourceStore.getResource(code, ns, key, options);\n    }\n  }]);\n\n  return Translator;\n}(EventEmitter);\n\nfunction capitalize(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nvar LanguageUtil =\n/*#__PURE__*/\nfunction () {\n  function LanguageUtil(options) {\n    _classCallCheck(this, LanguageUtil);\n\n    this.options = options;\n    this.whitelist = this.options.whitelist || false;\n    this.logger = baseLogger.create('languageUtils');\n  }\n\n  _createClass(LanguageUtil, [{\n    key: \"getScriptPartFromCode\",\n    value: function getScriptPartFromCode(code) {\n      if (!code || code.indexOf('-') < 0) return null;\n      var p = code.split('-');\n      if (p.length === 2) return null;\n      p.pop();\n      return this.formatLanguageCode(p.join('-'));\n    }\n  }, {\n    key: \"getLanguagePartFromCode\",\n    value: function getLanguagePartFromCode(code) {\n      if (!code || code.indexOf('-') < 0) return code;\n      var p = code.split('-');\n      return this.formatLanguageCode(p[0]);\n    }\n  }, {\n    key: \"formatLanguageCode\",\n    value: function formatLanguageCode(code) {\n      // http://www.iana.org/assignments/language-tags/language-tags.xhtml\n      if (typeof code === 'string' && code.indexOf('-') > -1) {\n        var specialCases = ['hans', 'hant', 'latn', 'cyrl', 'cans', 'mong', 'arab'];\n        var p = code.split('-');\n\n        if (this.options.lowerCaseLng) {\n          p = p.map(function (part) {\n            return part.toLowerCase();\n          });\n        } else if (p.length === 2) {\n          p[0] = p[0].toLowerCase();\n          p[1] = p[1].toUpperCase();\n          if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());\n        } else if (p.length === 3) {\n          p[0] = p[0].toLowerCase(); // if lenght 2 guess it's a country\n\n          if (p[1].length === 2) p[1] = p[1].toUpperCase();\n          if (p[0] !== 'sgn' && p[2].length === 2) p[2] = p[2].toUpperCase();\n          if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());\n          if (specialCases.indexOf(p[2].toLowerCase()) > -1) p[2] = capitalize(p[2].toLowerCase());\n        }\n\n        return p.join('-');\n      }\n\n      return this.options.cleanCode || this.options.lowerCaseLng ? code.toLowerCase() : code;\n    }\n  }, {\n    key: \"isWhitelisted\",\n    value: function isWhitelisted(code) {\n      if (this.options.load === 'languageOnly' || this.options.nonExplicitWhitelist) {\n        code = this.getLanguagePartFromCode(code);\n      }\n\n      return !this.whitelist || !this.whitelist.length || this.whitelist.indexOf(code) > -1;\n    }\n  }, {\n    key: \"getFallbackCodes\",\n    value: function getFallbackCodes(fallbacks, code) {\n      if (!fallbacks) return [];\n      if (typeof fallbacks === 'string') fallbacks = [fallbacks];\n      if (Object.prototype.toString.apply(fallbacks) === '[object Array]') return fallbacks;\n      if (!code) return fallbacks[\"default\"] || []; // asume we have an object defining fallbacks\n\n      var found = fallbacks[code];\n      if (!found) found = fallbacks[this.getScriptPartFromCode(code)];\n      if (!found) found = fallbacks[this.formatLanguageCode(code)];\n      if (!found) found = fallbacks[\"default\"];\n      return found || [];\n    }\n  }, {\n    key: \"toResolveHierarchy\",\n    value: function toResolveHierarchy(code, fallbackCode) {\n      var _this = this;\n\n      var fallbackCodes = this.getFallbackCodes(fallbackCode || this.options.fallbackLng || [], code);\n      var codes = [];\n\n      var addCode = function addCode(c) {\n        if (!c) return;\n\n        if (_this.isWhitelisted(c)) {\n          codes.push(c);\n        } else {\n          _this.logger.warn(\"rejecting non-whitelisted language code: \".concat(c));\n        }\n      };\n\n      if (typeof code === 'string' && code.indexOf('-') > -1) {\n        if (this.options.load !== 'languageOnly') addCode(this.formatLanguageCode(code));\n        if (this.options.load !== 'languageOnly' && this.options.load !== 'currentOnly') addCode(this.getScriptPartFromCode(code));\n        if (this.options.load !== 'currentOnly') addCode(this.getLanguagePartFromCode(code));\n      } else if (typeof code === 'string') {\n        addCode(this.formatLanguageCode(code));\n      }\n\n      fallbackCodes.forEach(function (fc) {\n        if (codes.indexOf(fc) < 0) addCode(_this.formatLanguageCode(fc));\n      });\n      return codes;\n    }\n  }]);\n\n  return LanguageUtil;\n}();\n\n/* eslint-disable */\n\nvar sets = [{\n  lngs: ['ach', 'ak', 'am', 'arn', 'br', 'fil', 'gun', 'ln', 'mfe', 'mg', 'mi', 'oc', 'pt', 'pt-BR', 'tg', 'ti', 'tr', 'uz', 'wa'],\n  nr: [1, 2],\n  fc: 1\n}, {\n  lngs: ['af', 'an', 'ast', 'az', 'bg', 'bn', 'ca', 'da', 'de', 'dev', 'el', 'en', 'eo', 'es', 'et', 'eu', 'fi', 'fo', 'fur', 'fy', 'gl', 'gu', 'ha', 'hi', 'hu', 'hy', 'ia', 'it', 'kn', 'ku', 'lb', 'mai', 'ml', 'mn', 'mr', 'nah', 'nap', 'nb', 'ne', 'nl', 'nn', 'no', 'nso', 'pa', 'pap', 'pms', 'ps', 'pt-PT', 'rm', 'sco', 'se', 'si', 'so', 'son', 'sq', 'sv', 'sw', 'ta', 'te', 'tk', 'ur', 'yo'],\n  nr: [1, 2],\n  fc: 2\n}, {\n  lngs: ['ay', 'bo', 'cgg', 'fa', 'id', 'ja', 'jbo', 'ka', 'kk', 'km', 'ko', 'ky', 'lo', 'ms', 'sah', 'su', 'th', 'tt', 'ug', 'vi', 'wo', 'zh'],\n  nr: [1],\n  fc: 3\n}, {\n  lngs: ['be', 'bs', 'cnr', 'dz', 'hr', 'ru', 'sr', 'uk'],\n  nr: [1, 2, 5],\n  fc: 4\n}, {\n  lngs: ['ar'],\n  nr: [0, 1, 2, 3, 11, 100],\n  fc: 5\n}, {\n  lngs: ['cs', 'sk'],\n  nr: [1, 2, 5],\n  fc: 6\n}, {\n  lngs: ['csb', 'pl'],\n  nr: [1, 2, 5],\n  fc: 7\n}, {\n  lngs: ['cy'],\n  nr: [1, 2, 3, 8],\n  fc: 8\n}, {\n  lngs: ['fr'],\n  nr: [1, 2],\n  fc: 9\n}, {\n  lngs: ['ga'],\n  nr: [1, 2, 3, 7, 11],\n  fc: 10\n}, {\n  lngs: ['gd'],\n  nr: [1, 2, 3, 20],\n  fc: 11\n}, {\n  lngs: ['is'],\n  nr: [1, 2],\n  fc: 12\n}, {\n  lngs: ['jv'],\n  nr: [0, 1],\n  fc: 13\n}, {\n  lngs: ['kw'],\n  nr: [1, 2, 3, 4],\n  fc: 14\n}, {\n  lngs: ['lt'],\n  nr: [1, 2, 10],\n  fc: 15\n}, {\n  lngs: ['lv'],\n  nr: [1, 2, 0],\n  fc: 16\n}, {\n  lngs: ['mk'],\n  nr: [1, 2],\n  fc: 17\n}, {\n  lngs: ['mnk'],\n  nr: [0, 1, 2],\n  fc: 18\n}, {\n  lngs: ['mt'],\n  nr: [1, 2, 11, 20],\n  fc: 19\n}, {\n  lngs: ['or'],\n  nr: [2, 1],\n  fc: 2\n}, {\n  lngs: ['ro'],\n  nr: [1, 2, 20],\n  fc: 20\n}, {\n  lngs: ['sl'],\n  nr: [5, 1, 2, 3],\n  fc: 21\n}, {\n  lngs: ['he'],\n  nr: [1, 2, 20, 21],\n  fc: 22\n}];\nvar _rulesPluralsTypes = {\n  1: function _(n) {\n    return Number(n > 1);\n  },\n  2: function _(n) {\n    return Number(n != 1);\n  },\n  3: function _(n) {\n    return 0;\n  },\n  4: function _(n) {\n    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);\n  },\n  5: function _(n) {\n    return Number(n === 0 ? 0 : n == 1 ? 1 : n == 2 ? 2 : n % 100 >= 3 && n % 100 <= 10 ? 3 : n % 100 >= 11 ? 4 : 5);\n  },\n  6: function _(n) {\n    return Number(n == 1 ? 0 : n >= 2 && n <= 4 ? 1 : 2);\n  },\n  7: function _(n) {\n    return Number(n == 1 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);\n  },\n  8: function _(n) {\n    return Number(n == 1 ? 0 : n == 2 ? 1 : n != 8 && n != 11 ? 2 : 3);\n  },\n  9: function _(n) {\n    return Number(n >= 2);\n  },\n  10: function _(n) {\n    return Number(n == 1 ? 0 : n == 2 ? 1 : n < 7 ? 2 : n < 11 ? 3 : 4);\n  },\n  11: function _(n) {\n    return Number(n == 1 || n == 11 ? 0 : n == 2 || n == 12 ? 1 : n > 2 && n < 20 ? 2 : 3);\n  },\n  12: function _(n) {\n    return Number(n % 10 != 1 || n % 100 == 11);\n  },\n  13: function _(n) {\n    return Number(n !== 0);\n  },\n  14: function _(n) {\n    return Number(n == 1 ? 0 : n == 2 ? 1 : n == 3 ? 2 : 3);\n  },\n  15: function _(n) {\n    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2);\n  },\n  16: function _(n) {\n    return Number(n % 10 == 1 && n % 100 != 11 ? 0 : n !== 0 ? 1 : 2);\n  },\n  17: function _(n) {\n    return Number(n == 1 || n % 10 == 1 ? 0 : 1);\n  },\n  18: function _(n) {\n    return Number(n == 0 ? 0 : n == 1 ? 1 : 2);\n  },\n  19: function _(n) {\n    return Number(n == 1 ? 0 : n === 0 || n % 100 > 1 && n % 100 < 11 ? 1 : n % 100 > 10 && n % 100 < 20 ? 2 : 3);\n  },\n  20: function _(n) {\n    return Number(n == 1 ? 0 : n === 0 || n % 100 > 0 && n % 100 < 20 ? 1 : 2);\n  },\n  21: function _(n) {\n    return Number(n % 100 == 1 ? 1 : n % 100 == 2 ? 2 : n % 100 == 3 || n % 100 == 4 ? 3 : 0);\n  },\n  22: function _(n) {\n    return Number(n === 1 ? 0 : n === 2 ? 1 : (n < 0 || n > 10) && n % 10 == 0 ? 2 : 3);\n  }\n};\n/* eslint-enable */\n\nfunction createRules() {\n  var rules = {};\n  sets.forEach(function (set) {\n    set.lngs.forEach(function (l) {\n      rules[l] = {\n        numbers: set.nr,\n        plurals: _rulesPluralsTypes[set.fc]\n      };\n    });\n  });\n  return rules;\n}\n\nvar PluralResolver =\n/*#__PURE__*/\nfunction () {\n  function PluralResolver(languageUtils) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, PluralResolver);\n\n    this.languageUtils = languageUtils;\n    this.options = options;\n    this.logger = baseLogger.create('pluralResolver');\n    this.rules = createRules();\n  }\n\n  _createClass(PluralResolver, [{\n    key: \"addRule\",\n    value: function addRule(lng, obj) {\n      this.rules[lng] = obj;\n    }\n  }, {\n    key: \"getRule\",\n    value: function getRule(code) {\n      return this.rules[code] || this.rules[this.languageUtils.getLanguagePartFromCode(code)];\n    }\n  }, {\n    key: \"needsPlural\",\n    value: function needsPlural(code) {\n      var rule = this.getRule(code);\n      return rule && rule.numbers.length > 1;\n    }\n  }, {\n    key: \"getPluralFormsOfKey\",\n    value: function getPluralFormsOfKey(code, key) {\n      var _this = this;\n\n      var ret = [];\n      var rule = this.getRule(code);\n      if (!rule) return ret;\n      rule.numbers.forEach(function (n) {\n        var suffix = _this.getSuffix(code, n);\n\n        ret.push(\"\".concat(key).concat(suffix));\n      });\n      return ret;\n    }\n  }, {\n    key: \"getSuffix\",\n    value: function getSuffix(code, count) {\n      var _this2 = this;\n\n      var rule = this.getRule(code);\n\n      if (rule) {\n        // if (rule.numbers.length === 1) return ''; // only singular\n        var idx = rule.noAbs ? rule.plurals(count) : rule.plurals(Math.abs(count));\n        var suffix = rule.numbers[idx]; // special treatment for lngs only having singular and plural\n\n        if (this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {\n          if (suffix === 2) {\n            suffix = 'plural';\n          } else if (suffix === 1) {\n            suffix = '';\n          }\n        }\n\n        var returnSuffix = function returnSuffix() {\n          return _this2.options.prepend && suffix.toString() ? _this2.options.prepend + suffix.toString() : suffix.toString();\n        }; // COMPATIBILITY JSON\n        // v1\n\n\n        if (this.options.compatibilityJSON === 'v1') {\n          if (suffix === 1) return '';\n          if (typeof suffix === 'number') return \"_plural_\".concat(suffix.toString());\n          return returnSuffix();\n        } else if (\n        /* v2 */\n        this.options.compatibilityJSON === 'v2') {\n          return returnSuffix();\n        } else if (\n        /* v3 - gettext index */\n        this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {\n          return returnSuffix();\n        }\n\n        return this.options.prepend && idx.toString() ? this.options.prepend + idx.toString() : idx.toString();\n      }\n\n      this.logger.warn(\"no plural rule found for: \".concat(code));\n      return '';\n    }\n  }]);\n\n  return PluralResolver;\n}();\n\nvar Interpolator =\n/*#__PURE__*/\nfunction () {\n  function Interpolator() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Interpolator);\n\n    this.logger = baseLogger.create('interpolator');\n    this.options = options;\n\n    this.format = options.interpolation && options.interpolation.format || function (value) {\n      return value;\n    };\n\n    this.init(options);\n  }\n  /* eslint no-param-reassign: 0 */\n\n\n  _createClass(Interpolator, [{\n    key: \"init\",\n    value: function init() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (!options.interpolation) options.interpolation = {\n        escapeValue: true\n      };\n      var iOpts = options.interpolation;\n      this.escape = iOpts.escape !== undefined ? iOpts.escape : escape;\n      this.escapeValue = iOpts.escapeValue !== undefined ? iOpts.escapeValue : true;\n      this.useRawValueToEscape = iOpts.useRawValueToEscape !== undefined ? iOpts.useRawValueToEscape : false;\n      this.prefix = iOpts.prefix ? regexEscape(iOpts.prefix) : iOpts.prefixEscaped || '{{';\n      this.suffix = iOpts.suffix ? regexEscape(iOpts.suffix) : iOpts.suffixEscaped || '}}';\n      this.formatSeparator = iOpts.formatSeparator ? iOpts.formatSeparator : iOpts.formatSeparator || ',';\n      this.unescapePrefix = iOpts.unescapeSuffix ? '' : iOpts.unescapePrefix || '-';\n      this.unescapeSuffix = this.unescapePrefix ? '' : iOpts.unescapeSuffix || '';\n      this.nestingPrefix = iOpts.nestingPrefix ? regexEscape(iOpts.nestingPrefix) : iOpts.nestingPrefixEscaped || regexEscape('$t(');\n      this.nestingSuffix = iOpts.nestingSuffix ? regexEscape(iOpts.nestingSuffix) : iOpts.nestingSuffixEscaped || regexEscape(')');\n      this.nestingOptionsSeparator = iOpts.nestingOptionsSeparator ? iOpts.nestingOptionsSeparator : iOpts.nestingOptionsSeparator || ',';\n      this.maxReplaces = iOpts.maxReplaces ? iOpts.maxReplaces : 1000;\n      this.alwaysFormat = iOpts.alwaysFormat !== undefined ? iOpts.alwaysFormat : false; // the regexp\n\n      this.resetRegExp();\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      if (this.options) this.init(this.options);\n    }\n  }, {\n    key: \"resetRegExp\",\n    value: function resetRegExp() {\n      // the regexp\n      var regexpStr = \"\".concat(this.prefix, \"(.+?)\").concat(this.suffix);\n      this.regexp = new RegExp(regexpStr, 'g');\n      var regexpUnescapeStr = \"\".concat(this.prefix).concat(this.unescapePrefix, \"(.+?)\").concat(this.unescapeSuffix).concat(this.suffix);\n      this.regexpUnescape = new RegExp(regexpUnescapeStr, 'g');\n      var nestingRegexpStr = \"\".concat(this.nestingPrefix, \"(.+?)\").concat(this.nestingSuffix);\n      this.nestingRegexp = new RegExp(nestingRegexpStr, 'g');\n    }\n  }, {\n    key: \"interpolate\",\n    value: function interpolate(str, data, lng, options) {\n      var _this = this;\n\n      var match;\n      var value;\n      var replaces;\n      var defaultData = this.options && this.options.interpolation && this.options.interpolation.defaultVariables || {};\n\n      function regexSafe(val) {\n        return val.replace(/\\$/g, '$$$$');\n      }\n\n      var handleFormat = function handleFormat(key) {\n        if (key.indexOf(_this.formatSeparator) < 0) {\n          var path = getPathWithDefaults(data, defaultData, key);\n          return _this.alwaysFormat ? _this.format(path, undefined, lng) : path;\n        }\n\n        var p = key.split(_this.formatSeparator);\n        var k = p.shift().trim();\n        var f = p.join(_this.formatSeparator).trim();\n        return _this.format(getPathWithDefaults(data, defaultData, k), f, lng, options);\n      };\n\n      this.resetRegExp();\n      var missingInterpolationHandler = options && options.missingInterpolationHandler || this.options.missingInterpolationHandler;\n      replaces = 0; // unescape if has unescapePrefix/Suffix\n\n      /* eslint no-cond-assign: 0 */\n\n      while (match = this.regexpUnescape.exec(str)) {\n        value = handleFormat(match[1].trim());\n\n        if (value === undefined) {\n          if (typeof missingInterpolationHandler === 'function') {\n            var temp = missingInterpolationHandler(str, match, options);\n            value = typeof temp === 'string' ? temp : '';\n          } else {\n            this.logger.warn(\"missed to pass in variable \".concat(match[1], \" for interpolating \").concat(str));\n            value = '';\n          }\n        } else if (typeof value !== 'string' && !this.useRawValueToEscape) {\n          value = makeString(value);\n        }\n\n        str = str.replace(match[0], regexSafe(value));\n        this.regexpUnescape.lastIndex = 0;\n        replaces++;\n\n        if (replaces >= this.maxReplaces) {\n          break;\n        }\n      }\n\n      replaces = 0; // regular escape on demand\n\n      while (match = this.regexp.exec(str)) {\n        value = handleFormat(match[1].trim());\n\n        if (value === undefined) {\n          if (typeof missingInterpolationHandler === 'function') {\n            var _temp = missingInterpolationHandler(str, match, options);\n\n            value = typeof _temp === 'string' ? _temp : '';\n          } else {\n            this.logger.warn(\"missed to pass in variable \".concat(match[1], \" for interpolating \").concat(str));\n            value = '';\n          }\n        } else if (typeof value !== 'string' && !this.useRawValueToEscape) {\n          value = makeString(value);\n        }\n\n        value = this.escapeValue ? regexSafe(this.escape(value)) : regexSafe(value);\n        str = str.replace(match[0], value);\n        this.regexp.lastIndex = 0;\n        replaces++;\n\n        if (replaces >= this.maxReplaces) {\n          break;\n        }\n      }\n\n      return str;\n    }\n  }, {\n    key: \"nest\",\n    value: function nest(str, fc) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var match;\n      var value;\n\n      var clonedOptions = _objectSpread({}, options);\n\n      clonedOptions.applyPostProcessor = false; // avoid post processing on nested lookup\n\n      delete clonedOptions.defaultValue; // assert we do not get a endless loop on interpolating defaultValue again and again\n      // if value is something like \"myKey\": \"lorem $(anotherKey, { \"count\": {{aValueInOptions}} })\"\n\n      function handleHasOptions(key, inheritedOptions) {\n        var sep = this.nestingOptionsSeparator;\n        if (key.indexOf(sep) < 0) return key;\n        var c = key.split(new RegExp(\"\".concat(sep, \"[ ]*{\")));\n        var optionsString = \"{\".concat(c[1]);\n        key = c[0];\n        optionsString = this.interpolate(optionsString, clonedOptions);\n        optionsString = optionsString.replace(/'/g, '\"');\n\n        try {\n          clonedOptions = JSON.parse(optionsString);\n          if (inheritedOptions) clonedOptions = _objectSpread({}, inheritedOptions, clonedOptions);\n        } catch (e) {\n          this.logger.warn(\"failed parsing options string in nesting for key \".concat(key), e);\n          return \"\".concat(key).concat(sep).concat(optionsString);\n        } // assert we do not get a endless loop on interpolating defaultValue again and again\n\n\n        delete clonedOptions.defaultValue;\n        return key;\n      } // regular escape on demand\n\n\n      while (match = this.nestingRegexp.exec(str)) {\n        value = fc(handleHasOptions.call(this, match[1].trim(), clonedOptions), clonedOptions); // is only the nesting key (key1 = '$(key2)') return the value without stringify\n\n        if (value && match[0] === str && typeof value !== 'string') return value; // no string to include or empty\n\n        if (typeof value !== 'string') value = makeString(value);\n\n        if (!value) {\n          this.logger.warn(\"missed to resolve \".concat(match[1], \" for nesting \").concat(str));\n          value = '';\n        } // Nested keys should not be escaped by default #854\n        // value = this.escapeValue ? regexSafe(utils.escape(value)) : regexSafe(value);\n\n\n        str = str.replace(match[0], value);\n        this.regexp.lastIndex = 0;\n      }\n\n      return str;\n    }\n  }]);\n\n  return Interpolator;\n}();\n\nfunction remove(arr, what) {\n  var found = arr.indexOf(what);\n\n  while (found !== -1) {\n    arr.splice(found, 1);\n    found = arr.indexOf(what);\n  }\n}\n\nvar Connector =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(Connector, _EventEmitter);\n\n  function Connector(backend, store, services) {\n    var _this;\n\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Connector);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Connector).call(this));\n    EventEmitter.call(_assertThisInitialized(_this)); // <=IE10 fix (unable to call parent constructor)\n\n    _this.backend = backend;\n    _this.store = store;\n    _this.services = services;\n    _this.languageUtils = services.languageUtils;\n    _this.options = options;\n    _this.logger = baseLogger.create('backendConnector');\n    _this.state = {};\n    _this.queue = [];\n\n    if (_this.backend && _this.backend.init) {\n      _this.backend.init(services, options.backend, options);\n    }\n\n    return _this;\n  }\n\n  _createClass(Connector, [{\n    key: \"queueLoad\",\n    value: function queueLoad(languages, namespaces, options, callback) {\n      var _this2 = this;\n\n      // find what needs to be loaded\n      var toLoad = [];\n      var pending = [];\n      var toLoadLanguages = [];\n      var toLoadNamespaces = [];\n      languages.forEach(function (lng) {\n        var hasAllNamespaces = true;\n        namespaces.forEach(function (ns) {\n          var name = \"\".concat(lng, \"|\").concat(ns);\n\n          if (!options.reload && _this2.store.hasResourceBundle(lng, ns)) {\n            _this2.state[name] = 2; // loaded\n          } else if (_this2.state[name] < 0) ; else if (_this2.state[name] === 1) {\n            if (pending.indexOf(name) < 0) pending.push(name);\n          } else {\n            _this2.state[name] = 1; // pending\n\n            hasAllNamespaces = false;\n            if (pending.indexOf(name) < 0) pending.push(name);\n            if (toLoad.indexOf(name) < 0) toLoad.push(name);\n            if (toLoadNamespaces.indexOf(ns) < 0) toLoadNamespaces.push(ns);\n          }\n        });\n        if (!hasAllNamespaces) toLoadLanguages.push(lng);\n      });\n\n      if (toLoad.length || pending.length) {\n        this.queue.push({\n          pending: pending,\n          loaded: {},\n          errors: [],\n          callback: callback\n        });\n      }\n\n      return {\n        toLoad: toLoad,\n        pending: pending,\n        toLoadLanguages: toLoadLanguages,\n        toLoadNamespaces: toLoadNamespaces\n      };\n    }\n  }, {\n    key: \"loaded\",\n    value: function loaded(name, err, data) {\n      var _name$split = name.split('|'),\n          _name$split2 = _slicedToArray(_name$split, 2),\n          lng = _name$split2[0],\n          ns = _name$split2[1];\n\n      if (err) this.emit('failedLoading', lng, ns, err);\n\n      if (data) {\n        this.store.addResourceBundle(lng, ns, data);\n      } // set loaded\n\n\n      this.state[name] = err ? -1 : 2; // consolidated loading done in this run - only emit once for a loaded namespace\n\n      var loaded = {}; // callback if ready\n\n      this.queue.forEach(function (q) {\n        pushPath(q.loaded, [lng], ns);\n        remove(q.pending, name);\n        if (err) q.errors.push(err);\n\n        if (q.pending.length === 0 && !q.done) {\n          // only do once per loaded -> this.emit('loaded', q.loaded);\n          Object.keys(q.loaded).forEach(function (l) {\n            if (!loaded[l]) loaded[l] = [];\n\n            if (q.loaded[l].length) {\n              q.loaded[l].forEach(function (ns) {\n                if (loaded[l].indexOf(ns) < 0) loaded[l].push(ns);\n              });\n            }\n          });\n          /* eslint no-param-reassign: 0 */\n\n          q.done = true;\n\n          if (q.errors.length) {\n            q.callback(q.errors);\n          } else {\n            q.callback();\n          }\n        }\n      }); // emit consolidated loaded event\n\n      this.emit('loaded', loaded); // remove done load requests\n\n      this.queue = this.queue.filter(function (q) {\n        return !q.done;\n      });\n    }\n  }, {\n    key: \"read\",\n    value: function read(lng, ns, fcName) {\n      var _this3 = this;\n\n      var tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 350;\n      var callback = arguments.length > 5 ? arguments[5] : undefined;\n      if (!lng.length) return callback(null, {}); // noting to load\n\n      return this.backend[fcName](lng, ns, function (err, data) {\n        if (err && data\n        /* = retryFlag */\n        && tried < 5) {\n          setTimeout(function () {\n            _this3.read.call(_this3, lng, ns, fcName, tried + 1, wait * 2, callback);\n          }, wait);\n          return;\n        }\n\n        callback(err, data);\n      });\n    }\n    /* eslint consistent-return: 0 */\n\n  }, {\n    key: \"prepareLoading\",\n    value: function prepareLoading(languages, namespaces) {\n      var _this4 = this;\n\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var callback = arguments.length > 3 ? arguments[3] : undefined;\n\n      if (!this.backend) {\n        this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n        return callback && callback();\n      }\n\n      if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n      if (typeof namespaces === 'string') namespaces = [namespaces];\n      var toLoad = this.queueLoad(languages, namespaces, options, callback);\n\n      if (!toLoad.toLoad.length) {\n        if (!toLoad.pending.length) callback(); // nothing to load and no pendings...callback now\n\n        return null; // pendings will trigger callback\n      }\n\n      toLoad.toLoad.forEach(function (name) {\n        _this4.loadOne(name);\n      });\n    }\n  }, {\n    key: \"load\",\n    value: function load(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {}, callback);\n    }\n  }, {\n    key: \"reload\",\n    value: function reload(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {\n        reload: true\n      }, callback);\n    }\n  }, {\n    key: \"loadOne\",\n    value: function loadOne(name) {\n      var _this5 = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n      var _name$split3 = name.split('|'),\n          _name$split4 = _slicedToArray(_name$split3, 2),\n          lng = _name$split4[0],\n          ns = _name$split4[1];\n\n      this.read(lng, ns, 'read', undefined, undefined, function (err, data) {\n        if (err) _this5.logger.warn(\"\".concat(prefix, \"loading namespace \").concat(ns, \" for language \").concat(lng, \" failed\"), err);\n        if (!err && data) _this5.logger.log(\"\".concat(prefix, \"loaded namespace \").concat(ns, \" for language \").concat(lng), data);\n\n        _this5.loaded(name, err, data);\n      });\n    }\n  }, {\n    key: \"saveMissing\",\n    value: function saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n      if (this.services.utils && this.services.utils.hasLoadedNamespace && !this.services.utils.hasLoadedNamespace(namespace)) {\n        this.logger.warn(\"did not save key \\\"\".concat(key, \"\\\" for namespace \\\"\").concat(namespace, \"\\\" as the namespace was not yet loaded\"), 'This means something IS WRONG in your application setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n        return;\n      } // ignore non valid keys\n\n\n      if (key === undefined || key === null || key === '') return;\n\n      if (this.backend && this.backend.create) {\n        this.backend.create(languages, namespace, key, fallbackValue, null\n        /* unused callback */\n        , _objectSpread({}, options, {\n          isUpdate: isUpdate\n        }));\n      } // write to store to avoid resending\n\n\n      if (!languages || !languages[0]) return;\n      this.store.addResource(languages[0], namespace, key, fallbackValue);\n    }\n  }]);\n\n  return Connector;\n}(EventEmitter);\n\nfunction get() {\n  return {\n    debug: false,\n    initImmediate: true,\n    ns: ['translation'],\n    defaultNS: ['translation'],\n    fallbackLng: ['dev'],\n    fallbackNS: false,\n    // string or array of namespaces\n    whitelist: false,\n    // array with whitelisted languages\n    nonExplicitWhitelist: false,\n    load: 'all',\n    // | currentOnly | languageOnly\n    preload: false,\n    // array with preload languages\n    simplifyPluralSuffix: true,\n    keySeparator: '.',\n    nsSeparator: ':',\n    pluralSeparator: '_',\n    contextSeparator: '_',\n    partialBundledLanguages: false,\n    // allow bundling certain languages that are not remotely fetched\n    saveMissing: false,\n    // enable to send missing values\n    updateMissing: false,\n    // enable to update default values if different from translated value (only useful on initial development, or when keeping code as source of truth)\n    saveMissingTo: 'fallback',\n    // 'current' || 'all'\n    saveMissingPlurals: true,\n    // will save all forms not only singular key\n    missingKeyHandler: false,\n    // function(lng, ns, key, fallbackValue) -> override if prefer on handling\n    missingInterpolationHandler: false,\n    // function(str, match)\n    postProcess: false,\n    // string or array of postProcessor names\n    postProcessPassResolved: false,\n    // pass resolved object into 'options.i18nResolved' for postprocessor\n    returnNull: true,\n    // allows null value as valid translation\n    returnEmptyString: true,\n    // allows empty string value as valid translation\n    returnObjects: false,\n    joinArrays: false,\n    // or string to join array\n    returnedObjectHandler: false,\n    // function(key, value, options) triggered if key returns object but returnObjects is set to false\n    parseMissingKeyHandler: false,\n    // function(key) parsed a key that was not found in t() before returning\n    appendNamespaceToMissingKey: false,\n    appendNamespaceToCIMode: false,\n    overloadTranslationOptionHandler: function handle(args) {\n      var ret = {};\n      if (_typeof(args[1]) === 'object') ret = args[1];\n      if (typeof args[1] === 'string') ret.defaultValue = args[1];\n      if (typeof args[2] === 'string') ret.tDescription = args[2];\n\n      if (_typeof(args[2]) === 'object' || _typeof(args[3]) === 'object') {\n        var options = args[3] || args[2];\n        Object.keys(options).forEach(function (key) {\n          ret[key] = options[key];\n        });\n      }\n\n      return ret;\n    },\n    interpolation: {\n      escapeValue: true,\n      format: function format(value, _format, lng, options) {\n        return value;\n      },\n      prefix: '{{',\n      suffix: '}}',\n      formatSeparator: ',',\n      // prefixEscaped: '{{',\n      // suffixEscaped: '}}',\n      // unescapeSuffix: '',\n      unescapePrefix: '-',\n      nestingPrefix: '$t(',\n      nestingSuffix: ')',\n      nestingOptionsSeparator: ',',\n      // nestingPrefixEscaped: '$t(',\n      // nestingSuffixEscaped: ')',\n      // defaultVariables: undefined // object that can have values to interpolate on - extends passed in interpolation data\n      maxReplaces: 1000 // max replaces to prevent endless loop\n\n    }\n  };\n}\n/* eslint no-param-reassign: 0 */\n\nfunction transformOptions(options) {\n  // create namespace object if namespace is passed in as string\n  if (typeof options.ns === 'string') options.ns = [options.ns];\n  if (typeof options.fallbackLng === 'string') options.fallbackLng = [options.fallbackLng];\n  if (typeof options.fallbackNS === 'string') options.fallbackNS = [options.fallbackNS]; // extend whitelist with cimode\n\n  if (options.whitelist && options.whitelist.indexOf('cimode') < 0) {\n    options.whitelist = options.whitelist.concat(['cimode']);\n  }\n\n  return options;\n}\n\nfunction noop() {}\n\nvar I18n =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(I18n, _EventEmitter);\n\n  function I18n() {\n    var _this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var callback = arguments.length > 1 ? arguments[1] : undefined;\n\n    _classCallCheck(this, I18n);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(I18n).call(this));\n    EventEmitter.call(_assertThisInitialized(_this)); // <=IE10 fix (unable to call parent constructor)\n\n    _this.options = transformOptions(options);\n    _this.services = {};\n    _this.logger = baseLogger;\n    _this.modules = {\n      external: []\n    };\n\n    if (callback && !_this.isInitialized && !options.isClone) {\n      // https://github.com/i18next/i18next/issues/879\n      if (!_this.options.initImmediate) {\n        _this.init(options, callback);\n\n        return _possibleConstructorReturn(_this, _assertThisInitialized(_this));\n      }\n\n      setTimeout(function () {\n        _this.init(options, callback);\n      }, 0);\n    }\n\n    return _this;\n  }\n\n  _createClass(I18n, [{\n    key: \"init\",\n    value: function init() {\n      var _this2 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var callback = arguments.length > 1 ? arguments[1] : undefined;\n\n      if (typeof options === 'function') {\n        callback = options;\n        options = {};\n      }\n\n      this.options = _objectSpread({}, get(), this.options, transformOptions(options));\n      this.format = this.options.interpolation.format;\n      if (!callback) callback = noop;\n\n      function createClassOnDemand(ClassOrObject) {\n        if (!ClassOrObject) return null;\n        if (typeof ClassOrObject === 'function') return new ClassOrObject();\n        return ClassOrObject;\n      } // init services\n\n\n      if (!this.options.isClone) {\n        if (this.modules.logger) {\n          baseLogger.init(createClassOnDemand(this.modules.logger), this.options);\n        } else {\n          baseLogger.init(null, this.options);\n        }\n\n        var lu = new LanguageUtil(this.options);\n        this.store = new ResourceStore(this.options.resources, this.options);\n        var s = this.services;\n        s.logger = baseLogger;\n        s.resourceStore = this.store;\n        s.languageUtils = lu;\n        s.pluralResolver = new PluralResolver(lu, {\n          prepend: this.options.pluralSeparator,\n          compatibilityJSON: this.options.compatibilityJSON,\n          simplifyPluralSuffix: this.options.simplifyPluralSuffix\n        });\n        s.interpolator = new Interpolator(this.options);\n        s.utils = {\n          hasLoadedNamespace: this.hasLoadedNamespace.bind(this)\n        };\n        s.backendConnector = new Connector(createClassOnDemand(this.modules.backend), s.resourceStore, s, this.options); // pipe events from backendConnector\n\n        s.backendConnector.on('*', function (event) {\n          for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n            args[_key - 1] = arguments[_key];\n          }\n\n          _this2.emit.apply(_this2, [event].concat(args));\n        });\n\n        if (this.modules.languageDetector) {\n          s.languageDetector = createClassOnDemand(this.modules.languageDetector);\n          s.languageDetector.init(s, this.options.detection, this.options);\n        }\n\n        if (this.modules.i18nFormat) {\n          s.i18nFormat = createClassOnDemand(this.modules.i18nFormat);\n          if (s.i18nFormat.init) s.i18nFormat.init(this);\n        }\n\n        this.translator = new Translator(this.services, this.options); // pipe events from translator\n\n        this.translator.on('*', function (event) {\n          for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n            args[_key2 - 1] = arguments[_key2];\n          }\n\n          _this2.emit.apply(_this2, [event].concat(args));\n        });\n        this.modules.external.forEach(function (m) {\n          if (m.init) m.init(_this2);\n        });\n      }\n\n      if (!this.modules.languageDetector && !this.options.lng) {\n        this.logger.warn('init: no languageDetector is used and no lng is defined');\n      } // append api\n\n\n      var storeApi = ['getResource', 'addResource', 'addResources', 'addResourceBundle', 'removeResourceBundle', 'hasResourceBundle', 'getResourceBundle', 'getDataByLanguage'];\n      storeApi.forEach(function (fcName) {\n        _this2[fcName] = function () {\n          var _this2$store;\n\n          return (_this2$store = _this2.store)[fcName].apply(_this2$store, arguments);\n        };\n      });\n      var deferred = defer();\n\n      var load = function load() {\n        _this2.changeLanguage(_this2.options.lng, function (err, t) {\n          _this2.isInitialized = true;\n\n          _this2.logger.log('initialized', _this2.options);\n\n          _this2.emit('initialized', _this2.options);\n\n          deferred.resolve(t); // not rejecting on err (as err is only a loading translation failed warning)\n\n          callback(err, t);\n        });\n      };\n\n      if (this.options.resources || !this.options.initImmediate) {\n        load();\n      } else {\n        setTimeout(load, 0);\n      }\n\n      return deferred;\n    }\n    /* eslint consistent-return: 0 */\n\n  }, {\n    key: \"loadResources\",\n    value: function loadResources(language) {\n      var _this3 = this;\n\n      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n      var usedCallback = callback;\n      var usedLng = typeof language === 'string' ? language : this.language;\n      if (typeof language === 'function') usedCallback = language;\n\n      if (!this.options.resources || this.options.partialBundledLanguages) {\n        if (usedLng && usedLng.toLowerCase() === 'cimode') return usedCallback(); // avoid loading resources for cimode\n\n        var toLoad = [];\n\n        var append = function append(lng) {\n          if (!lng) return;\n\n          var lngs = _this3.services.languageUtils.toResolveHierarchy(lng);\n\n          lngs.forEach(function (l) {\n            if (toLoad.indexOf(l) < 0) toLoad.push(l);\n          });\n        };\n\n        if (!usedLng) {\n          // at least load fallbacks in this case\n          var fallbacks = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);\n          fallbacks.forEach(function (l) {\n            return append(l);\n          });\n        } else {\n          append(usedLng);\n        }\n\n        if (this.options.preload) {\n          this.options.preload.forEach(function (l) {\n            return append(l);\n          });\n        }\n\n        this.services.backendConnector.load(toLoad, this.options.ns, usedCallback);\n      } else {\n        usedCallback(null);\n      }\n    }\n  }, {\n    key: \"reloadResources\",\n    value: function reloadResources(lngs, ns, callback) {\n      var deferred = defer();\n      if (!lngs) lngs = this.languages;\n      if (!ns) ns = this.options.ns;\n      if (!callback) callback = noop;\n      this.services.backendConnector.reload(lngs, ns, function (err) {\n        deferred.resolve(); // not rejecting on err (as err is only a loading translation failed warning)\n\n        callback(err);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"use\",\n    value: function use(module) {\n      if (module.type === 'backend') {\n        this.modules.backend = module;\n      }\n\n      if (module.type === 'logger' || module.log && module.warn && module.error) {\n        this.modules.logger = module;\n      }\n\n      if (module.type === 'languageDetector') {\n        this.modules.languageDetector = module;\n      }\n\n      if (module.type === 'i18nFormat') {\n        this.modules.i18nFormat = module;\n      }\n\n      if (module.type === 'postProcessor') {\n        postProcessor.addPostProcessor(module);\n      }\n\n      if (module.type === '3rdParty') {\n        this.modules.external.push(module);\n      }\n\n      return this;\n    }\n  }, {\n    key: \"changeLanguage\",\n    value: function changeLanguage(lng, callback) {\n      var _this4 = this;\n\n      this.isLanguageChangingTo = lng;\n      var deferred = defer();\n      this.emit('languageChanging', lng);\n\n      var done = function done(err, l) {\n        if (l) {\n          _this4.language = l;\n          _this4.languages = _this4.services.languageUtils.toResolveHierarchy(l);\n\n          _this4.translator.changeLanguage(l);\n\n          _this4.isLanguageChangingTo = undefined;\n\n          _this4.emit('languageChanged', l);\n\n          _this4.logger.log('languageChanged', l);\n        } else {\n          _this4.isLanguageChangingTo = undefined;\n        }\n\n        deferred.resolve(function () {\n          return _this4.t.apply(_this4, arguments);\n        });\n        if (callback) callback(err, function () {\n          return _this4.t.apply(_this4, arguments);\n        });\n      };\n\n      var setLng = function setLng(l) {\n        if (l) {\n          if (!_this4.language) {\n            _this4.language = l;\n            _this4.languages = _this4.services.languageUtils.toResolveHierarchy(l);\n          }\n\n          if (!_this4.translator.language) _this4.translator.changeLanguage(l);\n          if (_this4.services.languageDetector) _this4.services.languageDetector.cacheUserLanguage(l);\n        }\n\n        _this4.loadResources(l, function (err) {\n          done(err, l);\n        });\n      };\n\n      if (!lng && this.services.languageDetector && !this.services.languageDetector.async) {\n        setLng(this.services.languageDetector.detect());\n      } else if (!lng && this.services.languageDetector && this.services.languageDetector.async) {\n        this.services.languageDetector.detect(setLng);\n      } else {\n        setLng(lng);\n      }\n\n      return deferred;\n    }\n  }, {\n    key: \"getFixedT\",\n    value: function getFixedT(lng, ns) {\n      var _this5 = this;\n\n      var fixedT = function fixedT(key, opts) {\n        var options;\n\n        if (_typeof(opts) !== 'object') {\n          for (var _len3 = arguments.length, rest = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n            rest[_key3 - 2] = arguments[_key3];\n          }\n\n          options = _this5.options.overloadTranslationOptionHandler([key, opts].concat(rest));\n        } else {\n          options = _objectSpread({}, opts);\n        }\n\n        options.lng = options.lng || fixedT.lng;\n        options.lngs = options.lngs || fixedT.lngs;\n        options.ns = options.ns || fixedT.ns;\n        return _this5.t(key, options);\n      };\n\n      if (typeof lng === 'string') {\n        fixedT.lng = lng;\n      } else {\n        fixedT.lngs = lng;\n      }\n\n      fixedT.ns = ns;\n      return fixedT;\n    }\n  }, {\n    key: \"t\",\n    value: function t() {\n      var _this$translator;\n\n      return this.translator && (_this$translator = this.translator).translate.apply(_this$translator, arguments);\n    }\n  }, {\n    key: \"exists\",\n    value: function exists() {\n      var _this$translator2;\n\n      return this.translator && (_this$translator2 = this.translator).exists.apply(_this$translator2, arguments);\n    }\n  }, {\n    key: \"setDefaultNamespace\",\n    value: function setDefaultNamespace(ns) {\n      this.options.defaultNS = ns;\n    }\n  }, {\n    key: \"hasLoadedNamespace\",\n    value: function hasLoadedNamespace(ns) {\n      var _this6 = this;\n\n      if (!this.isInitialized) {\n        this.logger.warn('hasLoadedNamespace: i18next was not initialized', this.languages);\n        return false;\n      }\n\n      if (!this.languages || !this.languages.length) {\n        this.logger.warn('hasLoadedNamespace: i18n.languages were undefined or empty', this.languages);\n        return false;\n      }\n\n      var lng = this.languages[0];\n      var fallbackLng = this.options ? this.options.fallbackLng : false;\n      var lastLng = this.languages[this.languages.length - 1]; // we're in cimode so this shall pass\n\n      if (lng.toLowerCase() === 'cimode') return true;\n\n      var loadNotPending = function loadNotPending(l, n) {\n        var loadState = _this6.services.backendConnector.state[\"\".concat(l, \"|\").concat(n)];\n\n        return loadState === -1 || loadState === 2;\n      }; // loaded -> SUCCESS\n\n\n      if (this.hasResourceBundle(lng, ns)) return true; // were not loading at all -> SEMI SUCCESS\n\n      if (!this.services.backendConnector.backend) return true; // failed loading ns - but at least fallback is not pending -> SEMI SUCCESS\n\n      if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;\n      return false;\n    }\n  }, {\n    key: \"loadNamespaces\",\n    value: function loadNamespaces(ns, callback) {\n      var _this7 = this;\n\n      var deferred = defer();\n\n      if (!this.options.ns) {\n        callback && callback();\n        return Promise.resolve();\n      }\n\n      if (typeof ns === 'string') ns = [ns];\n      ns.forEach(function (n) {\n        if (_this7.options.ns.indexOf(n) < 0) _this7.options.ns.push(n);\n      });\n      this.loadResources(function (err) {\n        deferred.resolve();\n        if (callback) callback(err);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"loadLanguages\",\n    value: function loadLanguages(lngs, callback) {\n      var deferred = defer();\n      if (typeof lngs === 'string') lngs = [lngs];\n      var preloaded = this.options.preload || [];\n      var newLngs = lngs.filter(function (lng) {\n        return preloaded.indexOf(lng) < 0;\n      }); // Exit early if all given languages are already preloaded\n\n      if (!newLngs.length) {\n        if (callback) callback();\n        return Promise.resolve();\n      }\n\n      this.options.preload = preloaded.concat(newLngs);\n      this.loadResources(function (err) {\n        deferred.resolve();\n        if (callback) callback(err);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"dir\",\n    value: function dir(lng) {\n      if (!lng) lng = this.languages && this.languages.length > 0 ? this.languages[0] : this.language;\n      if (!lng) return 'rtl';\n      var rtlLngs = ['ar', 'shu', 'sqr', 'ssh', 'xaa', 'yhd', 'yud', 'aao', 'abh', 'abv', 'acm', 'acq', 'acw', 'acx', 'acy', 'adf', 'ads', 'aeb', 'aec', 'afb', 'ajp', 'apc', 'apd', 'arb', 'arq', 'ars', 'ary', 'arz', 'auz', 'avl', 'ayh', 'ayl', 'ayn', 'ayp', 'bbz', 'pga', 'he', 'iw', 'ps', 'pbt', 'pbu', 'pst', 'prp', 'prd', 'ur', 'ydd', 'yds', 'yih', 'ji', 'yi', 'hbo', 'men', 'xmn', 'fa', 'jpr', 'peo', 'pes', 'prs', 'dv', 'sam'];\n      return rtlLngs.indexOf(this.services.languageUtils.getLanguagePartFromCode(lng)) >= 0 ? 'rtl' : 'ltr';\n    }\n    /* eslint class-methods-use-this: 0 */\n\n  }, {\n    key: \"createInstance\",\n    value: function createInstance() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var callback = arguments.length > 1 ? arguments[1] : undefined;\n      return new I18n(options, callback);\n    }\n  }, {\n    key: \"cloneInstance\",\n    value: function cloneInstance() {\n      var _this8 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n\n      var mergedOptions = _objectSpread({}, this.options, options, {\n        isClone: true\n      });\n\n      var clone = new I18n(mergedOptions);\n      var membersToCopy = ['store', 'services', 'language'];\n      membersToCopy.forEach(function (m) {\n        clone[m] = _this8[m];\n      });\n      clone.services = _objectSpread({}, this.services);\n      clone.services.utils = {\n        hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n      };\n      clone.translator = new Translator(clone.services, clone.options);\n      clone.translator.on('*', function (event) {\n        for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n          args[_key4 - 1] = arguments[_key4];\n        }\n\n        clone.emit.apply(clone, [event].concat(args));\n      });\n      clone.init(mergedOptions, callback);\n      clone.translator.options = clone.options; // sync options\n\n      clone.translator.backendConnector.services.utils = {\n        hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n      };\n      return clone;\n    }\n  }]);\n\n  return I18n;\n}(EventEmitter);\n\nvar i18next = new I18n();\n\nexport default i18next;\n","import _classCallCheck from '@babel/runtime/helpers/esm/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/esm/createClass';\nimport _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport _typeof from '@babel/runtime/helpers/esm/typeof';\n\nvar arr = [];\nvar each = arr.forEach;\nvar slice = arr.slice;\nfunction defaults(obj) {\n  each.call(slice.call(arguments, 1), function (source) {\n    if (source) {\n      for (var prop in source) {\n        if (obj[prop] === undefined) obj[prop] = source[prop];\n      }\n    }\n  });\n  return obj;\n}\n\nfunction addQueryString(url, params) {\n  if (params && _typeof(params) === 'object') {\n    var queryString = '',\n        e = encodeURIComponent; // Must encode data\n\n    for (var paramName in params) {\n      queryString += '&' + e(paramName) + '=' + e(params[paramName]);\n    }\n\n    if (!queryString) {\n      return url;\n    }\n\n    url = url + (url.indexOf('?') !== -1 ? '&' : '?') + queryString.slice(1);\n  }\n\n  return url;\n} // https://gist.github.com/Xeoncross/7663273\n\n\nfunction ajax(url, options, callback, data, cache) {\n  if (data && _typeof(data) === 'object') {\n    if (!cache) {\n      data['_t'] = new Date();\n    } // URL encoded form data must be in querystring format\n\n\n    data = addQueryString('', data).slice(1);\n  }\n\n  if (options.queryStringParams) {\n    url = addQueryString(url, options.queryStringParams);\n  }\n\n  try {\n    var x;\n\n    if (XMLHttpRequest) {\n      x = new XMLHttpRequest();\n    } else {\n      x = new ActiveXObject('MSXML2.XMLHTTP.3.0');\n    }\n\n    x.open(data ? 'POST' : 'GET', url, 1);\n\n    if (!options.crossDomain) {\n      x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n    }\n\n    x.withCredentials = !!options.withCredentials;\n\n    if (data) {\n      x.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n    }\n\n    if (x.overrideMimeType) {\n      x.overrideMimeType(\"application/json\");\n    }\n\n    var h = options.customHeaders;\n    h = typeof h === 'function' ? h() : h;\n\n    if (h) {\n      for (var i in h) {\n        x.setRequestHeader(i, h[i]);\n      }\n    }\n\n    x.onreadystatechange = function () {\n      x.readyState > 3 && callback && callback(x.responseText, x);\n    };\n\n    x.send(data);\n  } catch (e) {\n    console && console.log(e);\n  }\n}\n\nfunction getDefaults() {\n  return {\n    loadPath: '/locales/{{lng}}/{{ns}}.json',\n    addPath: '/locales/add/{{lng}}/{{ns}}',\n    allowMultiLoading: false,\n    parse: JSON.parse,\n    parsePayload: function parsePayload(namespace, key, fallbackValue) {\n      return _defineProperty({}, key, fallbackValue || '');\n    },\n    crossDomain: false,\n    ajax: ajax\n  };\n}\n\nvar Backend =\n/*#__PURE__*/\nfunction () {\n  function Backend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Backend);\n\n    this.init(services, options);\n    this.type = 'backend';\n  }\n\n  _createClass(Backend, [{\n    key: \"init\",\n    value: function init(services) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      this.services = services;\n      this.options = defaults(options, this.options || {}, getDefaults());\n    }\n  }, {\n    key: \"readMulti\",\n    value: function readMulti(languages, namespaces, callback) {\n      var loadPath = this.options.loadPath;\n\n      if (typeof this.options.loadPath === 'function') {\n        loadPath = this.options.loadPath(languages, namespaces);\n      }\n\n      var url = this.services.interpolator.interpolate(loadPath, {\n        lng: languages.join('+'),\n        ns: namespaces.join('+')\n      });\n      this.loadUrl(url, callback);\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var loadPath = this.options.loadPath;\n\n      if (typeof this.options.loadPath === 'function') {\n        loadPath = this.options.loadPath([language], [namespace]);\n      }\n\n      var url = this.services.interpolator.interpolate(loadPath, {\n        lng: language,\n        ns: namespace\n      });\n      this.loadUrl(url, callback);\n    }\n  }, {\n    key: \"loadUrl\",\n    value: function loadUrl(url, callback) {\n      var _this = this;\n\n      this.options.ajax(url, this.options, function (data, xhr) {\n        if (xhr.status >= 500 && xhr.status < 600) return callback('failed loading ' + url, true\n        /* retry */\n        );\n        if (xhr.status >= 400 && xhr.status < 500) return callback('failed loading ' + url, false\n        /* no retry */\n        );\n        var ret, err;\n\n        try {\n          ret = _this.options.parse(data, url);\n        } catch (e) {\n          err = 'failed parsing ' + url + ' to json';\n        }\n\n        if (err) return callback(err, false);\n        callback(null, ret);\n      });\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue) {\n      var _this2 = this;\n\n      if (typeof languages === 'string') languages = [languages];\n      var payload = this.options.parsePayload(namespace, key, fallbackValue);\n      languages.forEach(function (lng) {\n        var url = _this2.services.interpolator.interpolate(_this2.options.addPath, {\n          lng: lng,\n          ns: namespace\n        });\n\n        _this2.options.ajax(url, _this2.options, function (data, xhr) {//const statusCode = xhr.status.toString();\n          // TODO: if statusCode === 4xx do log\n        }, payload);\n      });\n    }\n  }]);\n\n  return Backend;\n}();\n\nBackend.type = 'backend';\n\nexport default Backend;\n","import { Translator } from '.';\r\n\r\n/**\r\n * provide an official translate API for 2sxc\r\n * @param key\r\n */\r\nexport function translate(key: string): string { return Translator.translate(key); }\r\n","\r\nexport const primaryLanguage = 'en';\r\nexport const translations = ['en', 'de', 'fr', 'it', 'uk', 'nl'];\r\nexport const translationsPath = 'dist/inpage/i18n/{{lng}}.js';\r\n\r\nexport * from './translator';\r\nexport * from './2sxc.translate';\r\n","import i18next, { i18n } from 'i18next';\r\nimport XHR from 'i18next-xhr-backend';\r\n// @ts-ignore\r\nimport locI18next from 'loc-i18next';\r\nimport { primaryLanguage, translations, translationsPath } from '.';\r\nimport { IDs } from '../constants/ids';\r\nimport { ContextComplete } from '../context/bundles';\r\nimport { $2sxcInPage } from '../interfaces/sxc-controller-in-page';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { HasLog, Insights, urlClean } from '../logging';\r\nimport { EditManager } from '../manage/edit-manager';\r\n\r\nlet localize: any;\r\n// let initialized: boolean = false;\r\n\r\nclass TranslatorGlobal extends HasLog {\r\n    i18n: i18n;\r\n\r\n    private locReady = false;\r\n    private initialized = false;\r\n\r\n    constructor() {\r\n        super('Sys.Trnslt');\r\n        Insights.add('system', 'translator', this.log);\r\n        this.i18n = i18next;\r\n    }\r\n\r\n    translate(key: string): string {\r\n        if (!this.initialized) return key;\r\n        if (!this.i18n.isInitialized) return key;\r\n        return this.i18n.t(key) || key;\r\n    }\r\n\r\n    /**\r\n     * Initialize a manager-object on a 2sxc-instance\r\n     */\r\n    initManager(manage: EditManager): void {\r\n        const cl = this.log.call('initManager');\r\n        if (this.initialized) return cl.done('already initialized');\r\n\r\n        const context = manage._context || this.tryToFindAContext();\r\n\r\n        cl.add('will initialize');\r\n        const realRootPath = $2sxcInPage.env.uiRoot();\r\n        this.i18n\r\n            .use(XHR)\r\n            .init({\r\n                lng: context.app.currentLanguage.substr(0, 2),\r\n                fallbackLng: primaryLanguage,\r\n                whitelist: translations,\r\n                preload: [primaryLanguage],\r\n                backend: {\r\n                    loadPath: urlClean(realRootPath + translationsPath),\r\n                },\r\n            }, () => this.initLoc());\r\n        this.initialized = true;\r\n        cl.done();\r\n    }\r\n\r\n    tryToFindAContext(): ContextComplete {\r\n        const cl = this.log.call('tryToFindAContext');\r\n        cl.add('no context found, will seek');\r\n        // trying to get context...\r\n        const htmlElementOrId = document.querySelector<HTMLElement>('div[data-cb-id]');\r\n        this.initialized = true; // the next SxcEdit.get will call _translate so we must set true to prevent loops\r\n        const sxc = SxcEdit.get(htmlElementOrId);\r\n        this.initialized = false; // for real, it is not initialized...\r\n        const editContext = SxcEdit.getEditContext(sxc);\r\n        const context = new ContextComplete(editContext, sxc);\r\n        context.sxc = sxc;\r\n        return cl.return(context);\r\n    }\r\n\r\n    /**\r\n     * Initialize loc and auto-translate menu nodes in the DOM\r\n     * This is called when the initialize-promise resolves\r\n     */\r\n    initLoc() {\r\n        const cl = this.log.call('initLoc');\r\n        // for options see https://github.com/mthh/loc-i18next#initialize-the-plugin\r\n        localize = locI18next.init(i18next);\r\n        this.locReady = true;\r\n        this.autoTranslateMenus();\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * Tell loc to translate all the translatable menu nodes\r\n     * Do this on initial load, and every time dynamic content gets re-created\r\n     */\r\n    autoTranslateMenus() {\r\n        const cl = this.log.call('autoTranslateMenus');\r\n        if (!this.locReady) return cl.done('loc not ready');\r\n        // start localizing, details: https://github.com/mthh/loc-i18next#usage-of-selector-function\r\n        const menus = document.querySelectorAll<HTMLElement>(IDs.sel.tagScMenu);\r\n        localize(IDs.sel.tagScMenu); // inline toolbars\r\n        const quickEButtons = document.querySelectorAll<HTMLElement>('.sc-i18n');\r\n        localize('.sc-i18n'); // quick-insert menus\r\n        cl.add(`found ${menus.length} menus and ${quickEButtons.length} buttons`);\r\n        cl.done();\r\n    }\r\n}\r\n\r\nexport const Translator = new TranslatorGlobal();\r\n","import { C } from '../../constants/index';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { Translator } from '../../i18n/translator';\r\nimport { HasLog } from '../../logging';\r\nimport { ToolbarWhenNoToolbarProvided } from '../config';\r\nimport { ToolbarRenderer } from '../render/toolbar-renderer';\r\nimport { TagToolbar } from '../tag-toolbars/tag-toolbar';\r\nimport { ToolbarLifecycle } from '../toolbar-lifecycle';\r\nimport { ToolbarManager } from '../toolbar-manager';\r\nimport { ToolbarInitConfig } from './toolbar-init-config';\r\n\r\n// quick debug - set to false if not needed for production\r\nconst dbg = false;\r\nconst toolbarSelector = `.sc-menu[toolbar],.sc-menu[data-toolbar],[${C.Toolbar.attr.full}]`;\r\n\r\n/**\r\n * This class is responsible for finding toolbar configurations in the doom\r\n * and then initializing them.\r\n */\r\nexport class ToolbarConfigFinderAndInitializer extends HasLog {\r\n\r\n    /**\r\n     * Special constructor which only allows this builder to be instatiated from the TagManager\r\n     * This is to simplify program control flow\r\n     */\r\n    constructor(private tlbManager: ToolbarManager) {\r\n        super('Tlb.Buildr', tlbManager.log);\r\n    }\r\n\r\n    /**\r\n     * Generate toolbars inside a MODULE tag (usually a div with class sc-edit-context)\r\n     * @param parentTag\r\n     * @param optionalId\r\n     */\r\n    buildDnnModule(parentTag: HTMLElement/*, optionalId?: number*/): void {\r\n        const cl = this.log.call('buildDnnModule');\r\n        // 2021-09-17 optionalId is probably never used\r\n        // parentTag = parentTag ?? document.querySelector<HTMLElement>('.DnnModule-' + optionalId);\r\n\r\n        // if something says the toolbars are disabled, then skip\r\n        if (parentTag.getAttribute(C.Toolbar.attr.disable)) return cl.done('disabled');\r\n\r\n        let toolbars = this.findChildTagsWithConfig(parentTag);\r\n\r\n        // no toolbars found, must help a bit because otherwise editing is hard\r\n        if (toolbars.length === 0) {\r\n            toolbars = addDefaultToolbarConfigToTag(parentTag);\r\n            if (toolbars == null) return cl.done('toolbars=null');\r\n        }\r\n\r\n        toolbars.forEach((e) => this.loadConfigAndInitialize(e));\r\n\r\n        // ensure translations are rebuilt\r\n        Translator.autoTranslateMenus();\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * Build toolbar, but allow an html node as target\r\n     * Will automatically find a wrapping sc-edit-context and all containing toolbars\r\n     * @param node\r\n     */\r\n    build(node: HTMLElement): void {\r\n        // go up the DOM to find the parent which has context-information\r\n        // if we have no contextNode (a parent content block), we can\r\n        // assume the node is outside of a 2sxc module so not interesting\r\n        const contextNode = node.closest<HTMLElement>(C.Cb.selectors.ofName);\r\n        if (contextNode == null) return;\r\n\r\n        // check if the current node needs a toolbar\r\n        if (node.matches(toolbarSelector)) this.loadConfigAndInitialize(node);\r\n\r\n        // activate all child-nodes with toolbars\r\n        const toolbars = node.querySelectorAll<HTMLElement>(toolbarSelector);\r\n        toolbars.forEach((e) => this.loadConfigAndInitialize(e));\r\n    }\r\n\r\n\r\n    //////////////////////////////// Private Functions ////////////////////////////////////\r\n\r\n    /**\r\n     * find current toolbars inside this wrapper-tag\r\n     */\r\n    private findChildTagsWithConfig(parentTag: HTMLElement): HTMLElement[] {\r\n        const allInner = Array.from(parentTag.querySelectorAll<HTMLElement>(toolbarSelector));\r\n\r\n        // return only those, which don't belong to a sub-item\r\n        const onlyDirectDescendents = allInner.filter((e) => e.closest(C.Cb.selectors.ofName) === parentTag);\r\n        if (dbg)\r\n            console.log('found toolbars for parent', parentTag, onlyDirectDescendents);\r\n        return onlyDirectDescendents;\r\n    }\r\n\r\n\r\n    /**\r\n     * Setup a toolbar for a specific tag/node by loading its self-contained configuration\r\n     * and replacing / preparing the toolbar as needed.\r\n     * @param node\r\n     */\r\n    private loadConfigAndInitialize(tag: HTMLElement): void {\r\n        const cl = this.log.call('loadConfigAndInitialize');\r\n\r\n        // Do not process tag if a toolbar has already been attached\r\n        if (tag.getAttribute(`data-${C.Toolbar.attrToMarkInitalized}`))\r\n            return cl.done('already initialized');\r\n\r\n        const config = ToolbarInitConfig.loadFromTag(tag);\r\n\r\n        if (config != null) {  // is null if load failed\r\n            // catch errors, as this is very common - make sure the others are still rendered\r\n            try {\r\n                this.convertConfigToToolbars(tag, config);\r\n            } catch (err2) {\r\n                console.error('error creating toolbar - will skip this one', err2);\r\n            }\r\n        }\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * Take a configuration and convert into a toolbar-menu; also attach the hover-attribute\r\n     * @param tag\r\n     * @param config\r\n     */\r\n    private convertConfigToToolbars(tag: HTMLElement, config: ToolbarInitConfig): void {\r\n        const cl = this.log.call('convertConfigToToolbars');\r\n        cl.data('tag', tag);\r\n        cl.data('config', config);\r\n        const context = ContextComplete.findContext(tag);\r\n        context.toolbar = this.tlbManager.loadConfig(context, config);\r\n\r\n        // V2 where the full toolbar is included in one setting\r\n        if (tag.getAttribute(C.Toolbar.attr.full)) {\r\n            cl.add('V2 TagToolbar detected');\r\n            const tagToolbar = new TagToolbar(tag, context, Translator);\r\n            tag.setAttribute(`data-${C.Toolbar.attrToMarkInitalized}`, `${tagToolbar != null}`);\r\n            this.addHoverAttributeToTag(tag);\r\n            return cl.done();\r\n        }\r\n\r\n        // default case, tag is the old <ul> tag, so find the sc-element parent before replacing\r\n        const toolbar = new ToolbarRenderer(context).generate();\r\n        const hoverParent = tag.closest<HTMLElement>(C.Toolbar.selectors.ofOldHover);\r\n        cl.data('parentTag', hoverParent);\r\n        tag.replaceWith(toolbar);\r\n\r\n        if (hoverParent) {\r\n            cl.add('V1 hover-toolbar and parents found - will add attribute');\r\n            this.addHoverAttributeToTag(hoverParent);\r\n        }\r\n\r\n        // Also run toolbar-init on the new toolbar.\r\n        // Must use var 'toolbar' and not 'tag', as that is kind of reset/not existing at this\r\n        // So the event would get lost\r\n        // Added in 12.10\r\n        ToolbarLifecycle.raiseToolbarInitEvent(toolbar, toolbar, context);\r\n\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * add hover-attribute to tag which is responsible for the menu to appear/disappear\r\n     */\r\n    private addHoverAttributeToTag(tag: HTMLElement): void {\r\n        const cl = this.log.call('addHoverAttributeToTag');\r\n        if (!tag) return cl.done('no tag found'); // skip in case nothing was given\r\n        if (!tag.hasAttribute(C.Toolbar.attr.hover)) {\r\n            cl.add('will add attribute ' + C.Toolbar.attr.hover);\r\n            tag.setAttribute(C.Toolbar.attr.hover, '');\r\n        }\r\n        cl.done();\r\n    }\r\n}\r\n\r\n\r\n//////////////////////////////// Private Functions ////////////////////////////////////\r\n\r\n\r\n\r\n\r\n/**\r\n * Create a default/fallback toolbar and return it\r\n */\r\nfunction addDefaultToolbarConfigToTag(parentTag: HTMLElement): HTMLElement[] {\r\n    if (dbg) console.log(\"didn't find toolbar, so will auto-create\", parentTag);\r\n\r\n    const outsideCb = !parentTag.classList.contains(C.Cb.classes.name);\r\n    const contentTag = outsideCb ? parentTag.querySelector<HTMLElement>(`div${C.Cb.selectors.ofName}`) : parentTag;\r\n\r\n    // auto toolbar\r\n    const ctx = ContextComplete.findContext(contentTag);\r\n    if (ctx.ui.autoToolbar === false)\r\n        return null;\r\n\r\n    contentTag.setAttribute(C.Toolbar.attr.full, JSON.stringify(ToolbarWhenNoToolbarProvided));\r\n\r\n    return [contentTag];\r\n}\r\n","import { InPageCommandJson } from '..';\r\nimport { CommandParams } from '../../../commands/command-params';\r\nimport { TypeTbD, TypeUnsafe } from '../../../plumbing';\r\nimport { Button } from '../../config';\r\n\r\n/**\r\n * Button Definition v1. from old API\r\n * it is publicly used out of inpage, so take a care to preserve its signature\r\n */\r\nexport class InPageButtonJson {\r\n\r\n    /** the internal command which will be called, should contain both the name and the parameters like { action: \"new\", contentType: \"BlogPost\"} */\r\n    command?: InPageCommandJson;\r\n\r\n    /** text which is shown on mouse-over. Note that 2sxc will try to run it through the translator, so you can also use placeholders like Toolbar.Metadata */\r\n    title?: string;\r\n\r\n    /** a css class giving the button the icon. It can be one of the icons 2sxc provides, or it can be your own - just be sure to include a CSS & font which resolves the icon */\r\n    icon?: string;\r\n\r\n    // classes comma separated list of class-names like makeRed,glowHover\r\n    classes?: string;\r\n\r\n    /** disabled would disable the click on the button */\r\n    disabled?: boolean;\r\n\r\n    /**\r\n     * partOfPage (new in 2sxc 9.5)\r\n     * determines if resulting changes should effect the Evoq/DNN Page Publishing\r\n     * note that it only effects the page-lifecyle, if the resulting dialogs and APIs respect this setting\r\n     */\r\n    partOfPage?: boolean;\r\n\r\n    /** if this is just something visual; otherwise a webservice will ensure that a content-group exists (for editing etc.) */\r\n    uiActionOnly?: boolean;\r\n\r\n    /** the code executed on click, if it's not the default action */\r\n    code?<T>(settings: CommandParams): Promise<void | T>;\r\n\r\n    dialog?: string;\r\n    newWindow?: boolean;\r\n    inlineWindow?: boolean;\r\n    fullScreen?: boolean;\r\n\r\n    _expanded?: boolean; // marker to determine that the configuration has already been initialized\r\n\r\n    // check two common signatures - command and action\r\n    static is(thing: TypeTbD): thing is InPageButtonJson {\r\n        return thing.command !== undefined || thing.action !== undefined;\r\n    }\r\n\r\n    static isArray(thing: TypeTbD[]): thing is InPageButtonJson[] {\r\n        return thing.length > 0 && InPageButtonJson.is(thing[0]);\r\n    }\r\n\r\n    static toButton(oldFormat: InPageButtonJson): Partial<Button> {\r\n        const config: Partial<Button> = {};\r\n\r\n        // simple value properties\r\n        if (oldFormat.classes) config.classes = oldFormat.classes;\r\n        if (oldFormat.dialog) config.dialog = oldFormat.dialog;\r\n        if (oldFormat.disabled) config.disabled = oldFormat.disabled;\r\n        if (oldFormat.icon) config.icon = oldFormat.icon;\r\n\r\n        // Method Properties\r\n        if (oldFormat.fullScreen) config.fullScreen = evalPropOrFun(oldFormat.fullScreen);\r\n        if (oldFormat.icon) config.icon = evalPropOrFun(oldFormat.icon);\r\n        if (oldFormat.inlineWindow) config.inlineWindow = evalPropOrFun(oldFormat.inlineWindow);\r\n        if (oldFormat.newWindow) config.newWindow = evalPropOrFun(oldFormat.newWindow);\r\n        if (oldFormat.partOfPage) config.partOfPage = evalPropOrFun(oldFormat.partOfPage);\r\n        if (oldFormat.title) config.title = evalPropOrFun(oldFormat.title);\r\n        // if (oldFormat.dynamicClasses) config.dynamicClasses = evalPropOrFun(oldFormat.dynamicClasses);\r\n        // if (oldFormat.showCondition) config.showCondition = evalPropOrFun(oldFormat.showCondition);\r\n\r\n        return config;\r\n    }\r\n\r\n    //#region these are properties 2dm found but think they are never used. Keeping them till ca. May 2020\r\n\r\n    // dynamicClasses(settings) can be used to dynamically build classes depending on the situation\r\n    // 2020-03-27 2dm disabled this - doesn't make much sense in the in-page configuration\r\n    // dynamicClasses?(settings: CommandParams): string;\r\n\r\n    // showCondition - used to dynamically choose if this button should be shown or not\r\n    // 2020-03-27 2dm disabled this - doesn't make much sense in the in-page configuration\r\n    // showCondition?(settings: CommandParams): boolean;\r\n\r\n    // 2020-03-27 2dm disabled, seems very unused\r\n    // name?: string;\r\n\r\n    // entity support (vertical compatibility for pre 2sxc v9.x)\r\n    // entity?: number;\r\n    // useModuleList?: boolean;\r\n    // entityId?: number;\r\n    // sortOrder?: number;\r\n\r\n    // params?: CommandParams;\r\n    //#endregion\r\n}\r\n\r\n\r\nfunction evalPropOrFun(propOrFunction: TypeTbD): TypeUnsafe {\r\n    if (propOrFunction === undefined || propOrFunction === null) return false;\r\n    if (typeof (propOrFunction) === 'function') return propOrFunction;\r\n    return () => propOrFunction;\r\n}\r\n","import { TypeTbD } from '../../../plumbing/TypeTbD';\r\n\r\nexport interface InPageCommandJsonWithTooMuchInfo extends InPageCommandJson {\r\n    entity?: {\r\n        EntityId: number,\r\n        _2sxcEditInformation: {\r\n            sortOrder?: number,\r\n        },\r\n    };\r\n}\r\n\r\nexport class InPageCommandJson  {\r\n    /** List of buttons to show */\r\n    action?: string;\r\n\r\n    /** The entity id to edit */\r\n    entityId?: number;\r\n\r\n    /** the content-type for new items */\r\n    contentType?: string;\r\n\r\n    /** determines that we should use a module list */\r\n    useModuleList?: boolean;\r\n\r\n    /** index in the list */\r\n    sortOrder?: number;\r\n\r\n    /** Experimental in 10.27 */\r\n    modify?: string;\r\n\r\n    /** Experimental for 10.30 */\r\n    parent?: string;\r\n    /** Experimental for 10.30 */\r\n    fields?: string;\r\n\r\n    static hasActions(thing: TypeTbD): thing is InPageCommandJson {\r\n        // check two common signatures - command and action\r\n        return typeof(thing as InPageCommandJson).action === 'string';\r\n    }\r\n\r\n    static hasModify(thing: TypeTbD): thing is InPageCommandJson {\r\n        // check two common signatures - command and action\r\n        return !!(thing as InPageCommandJson).modify;\r\n    }\r\n\r\n    /** Important for object merging - because otherwise action will be preserved */\r\n    static noAction(thing: InPageCommandJson) {\r\n        // some clean-up\r\n        delete thing.action; // remove the action property\r\n        return thing;\r\n    }\r\n\r\n\r\n}\r\n","import { InPageCommandJson } from '.';\r\nimport { InPageButtonJson } from '.';\r\nimport { ToolbarConfigLoader } from '.';\r\nimport { CmdMore, Commands } from '../../commands';\r\nimport { ContextComplete } from '../../context/bundles';\r\nimport { HasLog } from '../../logging';\r\n// import { InstanceConfig } from '../../manage/instance-config';\r\nimport { DictionaryValue } from '../../plumbing';\r\nimport { Button, Toolbar } from '../config';\r\nimport { ButtonSafe } from '../config/button-safe';\r\n\r\n/**\r\n * This is a system to build button configurations\r\n */\r\nexport class ButtonConfigLoader extends HasLog {\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.BtCfBl', toolbar.log);\r\n    }\r\n\r\n    /**\r\n     * takes an object like \"actionname\" or { action: \"actionname\", ... }\r\n     * and changes it to a { command: { action: \"actionname\" }, ... }\r\n     */\r\n    normalize(original: InPageButtonJson | InPageCommandJson | string): InPageButtonJson {\r\n        const cl = this.log.call('normalize');\r\n        cl.data('initial', original);\r\n\r\n        // prevent multiple inits\r\n        const asBtnConfig = original as InPageButtonJson;\r\n        if (asBtnConfig._expanded || asBtnConfig.command)\r\n            return cl.return(asBtnConfig, \"already expanded, won't modify\");\r\n\r\n        // if just a name, turn into a command\r\n        // use the deep version with command.action, because of more clean-up later on\r\n        if (typeof original === 'string')\r\n            return cl.return(this.btnConfigStructure(original, {}), 'found name, use that');\r\n\r\n        // if it's a command w/action, wrap into command + trim\r\n        if (InPageCommandJson.hasActions(original)) {\r\n            cl.add('action found, will move down to .command', original);\r\n            if (original.action) original.action = original.action.trim();\r\n            return cl.return({\r\n                command: original,\r\n                _expanded: true,\r\n            }, 'had actions, convert to commands');\r\n        }\r\n\r\n        throw 'can\\'t expand InPageButtonConfiguration - unexpected type signature encountered';\r\n    }\r\n\r\n    btnConfigStructure(name: string, params: {}): InPageButtonJson {\r\n        const wrapLog = this.log.call('getFromName', name);\r\n        return wrapLog.return({\r\n            command: {\r\n                action: name.trim(),\r\n                params: params,\r\n            },\r\n            _expanded: true,\r\n        }, `name \"${name}\" found, will re-map to .command.action`);\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * remove buttons which are not valid based on add condition\r\n     * @param {ContextComplete} context\r\n     * @param {Toolbar} full\r\n     * @param {InstanceConfig} config\r\n     * @memberof ButtonConfigurationBuilder\r\n     */\r\n    removeDisableButtons(context: ContextComplete, full: Toolbar,\r\n        // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June\r\n        // config: InstanceConfig\r\n    ): void {\r\n        const wrapLog = this.log.call('removeDisableButtons', `length of groups: ${full.groups.length}`);\r\n        const btnGroups = full.groups;\r\n        for (let g = 0; g < btnGroups.length; g++) {\r\n            const btns = btnGroups[g].buttons;\r\n            // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June\r\n            // const config = InstanceConfig.fromContext(context);\r\n            this.removeUnfitButtons(context, /* full,*/ btns /* config, */);\r\n\r\n            wrapLog.add('will disable appropriate buttons');\r\n            // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June\r\n            // disableButtons(context, btns/*, config */);\r\n\r\n            // remove the group, if no buttons left, or only \"more\"\r\n            if (btns.length === 0 || (btns.length === 1 && btns[0].command.name === CmdMore)) {\r\n                wrapLog.add('found no more buttons except for the \"more\" - will remove that group');\r\n                btnGroups.splice(g--, 1); // remove, and decrement counter\r\n            }\r\n        }\r\n        wrapLog.return(null);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * enhance button-object with default icons, etc.\r\n     * @param btn\r\n     * @param group\r\n     * @param fullToolbarConfig\r\n     * @param actions\r\n     */\r\n    addDefaultBtnSettings(btn: Button,\r\n                          groupDefaults: DictionaryValue | null,\r\n                          tlbDefaults: DictionaryValue | null | undefined,\r\n                          actions: Commands) {\r\n        const cl = this.log.call('addDefaultBtnSettings', '', `for ${() => btn.command.name}`);\r\n        for (let d = 0; d < btnProperties.length; d++)\r\n            fallbackBtnSetting(btn, groupDefaults, tlbDefaults, actions, btnProperties[d]);\r\n        cl.return(null);\r\n    }\r\n\r\n\r\n\r\n    private removeUnfitButtons(context: ContextComplete, btns: Button[]): void {\r\n        // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June\r\n        // config: InstanceConfig,\r\n        const cl = this.log.call('removeUnfitButtons');\r\n        let removals = '';\r\n        for (let i = 0; i < btns.length; i++) {\r\n            const btn = btns[i];\r\n            if (btn.command) {\r\n                context.button = btn; // add to context for calls\r\n                const rule = this.toolbar.toolbarV10.rules.find(btn.id || btn.command.name);\r\n                let show: boolean = rule?.overrideShow();\r\n                if (show === undefined) {\r\n                    show = new ButtonSafe(btn, context).showCondition();\r\n                }\r\n                if (show === false) {\r\n                    removals += `#${i} \"${btn.command.name}\"; `;\r\n                    btns.splice(i--, 1);\r\n                }\r\n                cl.add(`btn '${btn.command.name}' show ${show}`);\r\n            }\r\n        }\r\n        if (removals)\r\n            cl.add(`removed buttons: ${removals}`);\r\n        cl.return(null);\r\n    }\r\n\r\n}\r\n\r\nconst btnProperties = [\r\n  'classes',\r\n  'icon',\r\n  'title',\r\n  'dynamicClasses',\r\n  'showCondition',\r\n  'disabled',\r\n];\r\n\r\n\r\n/**\r\n * configure missing button properties with various fallback options\r\n * @param btn\r\n * @param group\r\n * @param fullToolbarConfig\r\n * @param actions\r\n * @param propName\r\n */\r\nfunction fallbackBtnSetting(btn: Button,\r\n                            groupDefaults: DictionaryValue | null,\r\n                            toolbarDefaults: DictionaryValue | null | undefined,\r\n                            actions: Commands,\r\n                            propName: string) {\r\n    const target = btn as unknown as DictionaryValue;\r\n\r\n    // skip it property is already set\r\n    if (target[propName])\r\n        return;\r\n\r\n    if (groupDefaults && groupDefaults[propName])\r\n        return target[propName] = groupDefaults[propName];\r\n\r\n    // if the toolbar has defaults, try use that property\r\n    if (toolbarDefaults && toolbarDefaults[propName])\r\n        return target[propName] = toolbarDefaults[propName];\r\n\r\n    // if there is an action, try to use that property name\r\n    if (btn.command && btn.command.name) {\r\n        const a = actions.get(btn.command.name);\r\n        if (a && a.buttonDefaults) {\r\n            const c = a.buttonDefaults as DictionaryValue;\r\n            if (c[propName])\r\n                return target[propName] = c[propName];\r\n        }\r\n    }\r\n}\r\n","\r\nexport enum Operations {\r\n    add = '+',\r\n    remove = '-',\r\n    system = '$', // for $params, $settings?\r\n    modify = '%',\r\n    comment = '/',\r\n}\r\n","\r\nexport enum BuildSteps {\r\n    toolbar = 'toolbar',\r\n    group = 'group',\r\n    button = 'button',\r\n    params = 'params',\r\n    settings = 'settings',\r\n}\r\n","import { ToolbarConfigLoader } from '.';\r\nimport { InPageCommandJson, InPageCommandJsonWithTooMuchInfo } from '.';\r\nimport { HasLog } from '../../logging';\r\n\r\nexport class CommandConfigLoader extends HasLog {\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.CmdLdr', toolbar.log);\r\n    }\r\n    /**\r\n     * entity support (compatibility for pre 2sxc v9.x)\r\n     * does some clean-up work on a button-definition object\r\n     * because the target item could be specified directly, or in a complex internal object called entity\r\n     * @param actDef\r\n     */\r\n    updateToV9(actDef: InPageCommandJsonWithTooMuchInfo): InPageCommandJson {\r\n\r\n        // doesn't have the pre-V9 properties, so we're fine\r\n        if (!actDef.entity || !actDef.entity._2sxcEditInformation)\r\n            return actDef as InPageCommandJson;\r\n\r\n        const editInfo = actDef.entity._2sxcEditInformation;\r\n\r\n        // move up sortOrder property and set useModuleList\r\n        actDef.useModuleList = (editInfo.sortOrder !== undefined); // has sort-order, so use list\r\n        if (editInfo.sortOrder !== undefined)  actDef.sortOrder = editInfo.sortOrder;\r\n\r\n        // move up entityId and clean-up the old 'entity' property\r\n        if (actDef.entity.EntityId !== undefined) actDef.entityId = actDef.entity.EntityId;\r\n        delete actDef.entity;\r\n\r\n        return actDef;\r\n    }\r\n\r\n}\r\n\r\n","\r\nexport const TemplateConstants = {\r\n    NameDefault: 'default',\r\n    NameEmpty: 'empty',\r\n    GroupDefault: 'default',\r\n    GroupList: 'list',\r\n    GroupEditAdvanced: 'edit-advanced',\r\n    GroupView: 'view',\r\n    GroupApp: 'app',\r\n    GroupUnknown: 'unknown',\r\n    ButtonSeparator: ',',\r\n};\r\n","import { ToolbarWip } from '.';\r\nimport { InPageButtonJson, InPageCommandJson } from '.';\r\nimport { ButtonGroupWip } from '.';\r\nimport { CmdMore, CommandParams, Commands } from '../../commands';\r\nimport { HasLog } from '../../logging';\r\nimport { DictionaryValue } from '../../plumbing';\r\nimport { Button, ButtonCommand, Toolbar, ToolbarSettings } from '../config';\r\nimport { ButtonGroup } from '../config';\r\nimport { TemplateConstants as TC } from '../templates/constants';\r\nimport { ToolbarConfigLoader } from './toolbar-config-loader';\r\n\r\nexport class ButtonGroupConfigLoader extends HasLog {\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.GrpCnf', toolbar.log);\r\n    }\r\n\r\n    /**\r\n     * this will traverse a groups-tree and expand each group\r\n     * so if groups were just strings like \"edit,new\" or compact buttons, they will be expanded afterwards\r\n     * @param fullToolbar\r\n     */\r\n    expandButtonGroups(fullToolbar: ToolbarWip): Toolbar {\r\n        const cl = this.log.call('expandButtonGroups');\r\n\r\n        // by now we should have a structure, let's check/fix the buttons\r\n        cl.add(`will expand groups - found ${fullToolbar.groups.length} items`);\r\n        for (let g = 0; g < fullToolbar.groups.length; g++) {\r\n            // expand a verb-list like \"edit,new\" into objects like [{ action: \"edit\" }, {action: \"new\"}]\r\n            const group = fullToolbar.groups[g];\r\n            const groupDefaults = (group as ButtonGroup).defaults;\r\n            const btns = this.expandButtonList(group, fullToolbar.settings);\r\n            const buttonConfigs: Button[] = [];\r\n\r\n            if (Array.isArray(btns)) {\r\n                cl.add(`will process ${btns.length} buttons`);\r\n                for (let b = 0; b < btns.length; b++)\r\n                    buttonConfigs.push(this.convertToButton(btns[b], fullToolbar.params, fullToolbar.defaults, groupDefaults));\r\n            } else\r\n                cl.add(\"no button array found, won't do a.nything\");\r\n\r\n            // Toolbar API v2 overwrite V1\r\n            group.buttons = buttonConfigs;\r\n        }\r\n        const toolbar = fullToolbar as Toolbar;\r\n        this.dropMoreIfOnlyOneGroup(toolbar);\r\n        return cl.return(toolbar);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Converts the InPageButtonJson to a Button\r\n     * WARNING: Note that this does the same task as convertToButton in the ButtonConfigLoader - but very differently\r\n     *          I'm not sure why though.\r\n     */\r\n    convertToButton(btn: InPageButtonJson,\r\n                    sharedParams: CommandParams | DictionaryValue,\r\n                    sharedDefaults: DictionaryValue,\r\n                    // fullToolbar: ToolbarWip,\r\n                    // group: ButtonGroupWip\r\n                    groupDefaults: DictionaryValue,\r\n                    ): Button {\r\n        let btnCommand = (btn as unknown as { command: CommandParams; }).command;\r\n        const identifier = btnCommand.action;\r\n        const name = Button.splitName(identifier).name;\r\n\r\n        if (!(Commands.singleton().get(name))) {\r\n            this.log.add(`couldn't find action ${name} - show warning`);\r\n            console.warn('warning: toolbar-button with unknown action-name:', name);\r\n        }\r\n\r\n        // first check if we already got params in the object - then we will use those, otherwise the main object\r\n        const realParams = (btnCommand as ButtonCommand).params\r\n            || InPageCommandJson.noAction(btnCommand);\r\n\r\n        const contentType = realParams.contentType;\r\n\r\n        // if the button belongs to a content-item, move the specs up to the item into the settings-object\r\n        btnCommand = this.toolbar.command.updateToV9(btnCommand);\r\n\r\n        // parameters adapter from v1 to v2\r\n        const params = { ...realParams, ...sharedParams };\r\n        // Toolbar API v2\r\n        const command = new ButtonCommand(name, contentType, params);\r\n        let newButtonConfig = new Button(command, identifier);\r\n\r\n        // settings adapter from v1 to v2\r\n        newButtonConfig = { ...newButtonConfig, ...InPageButtonJson.toButton(btn) };\r\n\r\n        // ensure all buttons have either own settings, or the fallback\r\n        this.toolbar.button.addDefaultBtnSettings(newButtonConfig, groupDefaults, sharedDefaults, Commands.singleton());\r\n        return newButtonConfig;\r\n    }\r\n\r\n    /**\r\n     * take a list of buttons (objects OR strings)\r\n     * and convert to proper array of buttons with actions\r\n     * on the in is a object with buttons, which are either:\r\n     * - a string like \"edit\" or multi-value \"layout,more\"\r\n     * - an array of such strings incl. optional complex objects which are\r\n     */\r\n    private expandButtonList(root: ButtonGroupWip, settings: ToolbarSettings): InPageButtonJson[] {\r\n        const wrapLog = this.log.call('expandButtonList'); // new Log('Tlb.ExpBts', this.log, 'start');\r\n        wrapLog.add('initial', root);\r\n        const buttonsWip = root.buttons;\r\n\r\n        let newButtons: InPageButtonJson[] = [];\r\n\r\n        // convert compact buttons (with multi-verb action objects) into own button-objects\r\n        // important because an older syntax allowed {action: \"new,edit\", entityId: 17}\r\n        if (Array.isArray(buttonsWip)) {\r\n            wrapLog.add(`detected array of btns (${buttonsWip.length}), will ensure it's an object`);\r\n            for (let b = 0; b < buttonsWip.length; b++) {\r\n                const btn = buttonsWip[b] as InPageButtonJson;\r\n                const actionNames = (btn as InPageCommandJson).action;\r\n                wrapLog.add(`will process actions: '${actionNames}' for `, btn);\r\n                if (typeof actionNames === 'string' && actionNames.indexOf(',') > -1) {\r\n                    wrapLog.add(`actionNames has mult values: '${actionNames}'`);\r\n                    this.expandButtonAndAddToList(newButtons, btn, actionNames);\r\n                } else {\r\n                    wrapLog.add('actionNames has 1 value', btn);\r\n                    newButtons.push(btn);\r\n                }\r\n            }\r\n        } else if (typeof buttonsWip === 'string') {\r\n            wrapLog.add(`detected that it is a string \"${buttonsWip}\", will split by \",\" and ...`);\r\n            this.expandButtonAndAddToList(newButtons, {}, buttonsWip);\r\n        } else {\r\n            wrapLog.add('no special case detected, will use the buttons-object as is');\r\n            newButtons = buttonsWip;\r\n        }\r\n        wrapLog.add(`after check, found ${newButtons.length} buttons`, newButtons);\r\n\r\n        // optionally add a more-button in each group\r\n        this.addMoreButton(settings, newButtons);\r\n\r\n        const result = newButtons.map((x) => this.toolbar.button.normalize(x)); // ensure the internal def is also an array now\r\n        return wrapLog.return(result, 'done');\r\n    }\r\n\r\n\r\n    private expandButtonAndAddToList(list: InPageButtonJson[], btn: InPageButtonJson, names: string): void {\r\n        const cl = this.log.call('expandButtonAndAddToList', `..., ..., '${names}'`, `button def \"${btn} is string of mult names, will expand into array with action-properties\"`);\r\n        const actions = names.length ? names.split(TC.ButtonSeparator) : [];\r\n        const params = {...btn} as InPageCommandJson;\r\n        delete params.action;\r\n        for (let a = 0; a < actions.length; a++) {\r\n            const commandPart = this.toolbar.button.btnConfigStructure(actions[a], params);\r\n            cl.data('commandPart', commandPart);\r\n            list.push(commandPart); // {...btn, ...commandPart });\r\n        }\r\n        cl.return(list);\r\n    }\r\n\r\n    /** Add the \"more\" button at the end or beginning */\r\n    private addMoreButton(settings: ToolbarSettings, list: InPageButtonJson[]): void {\r\n        const cl = this.log.call('addMoreButtons');\r\n        const addMore = settings.autoAddMore;\r\n        if (addMore) {\r\n            const moreButton = this.toolbar.button.btnConfigStructure(CmdMore, {});\r\n            if ((addMore === 'end') || (addMore.toString() === 'right')) { // fallback for older v1 setting\r\n                this.log.add('will add a more \"...\" button to end');\r\n                list.push(moreButton);\r\n            } else {\r\n                this.log.add('will add a more \"...\" button to start');\r\n                list.unshift(moreButton);\r\n            }\r\n        } else this.log.add('will not add more \"...\" button');\r\n        cl.return(list);\r\n    }\r\n\r\n    /**\r\n     * If there is only one group, then remove the More button.\r\n     * Note that this has to happen almost at the end, because groups will be removed if empty\r\n     */\r\n    private dropMoreIfOnlyOneGroup(toolbar: Toolbar): void {\r\n        const cl = this.log.call('dropMoreIfOnlyOneGroup');\r\n        if (toolbar.groups.length !== 1) return cl.done('not just 1 group');\r\n        cl.add('exactly one group found, will remove more');\r\n        const buttons = toolbar.groups[0].buttons;\r\n        const index = buttons.findIndex((b) => b.command?.name === CmdMore);\r\n        if (index === -1) return cl.done(\"no 'more' button found\");\r\n        buttons.splice(index, 1);\r\n        cl.done('more removed');\r\n    }\r\n\r\n}\r\n","import { TemplateConstants as TC, ToolbarTemplate } from '.';\r\n\r\n// the default / initial buttons in a standard toolbar\r\nexport const ToolbarTemplateEmpty: ToolbarTemplate = {\r\n  name: TC.NameEmpty,\r\n  groups: [\r\n    {\r\n      name: TC.GroupDefault,\r\n      buttons: '',\r\n    },\r\n  ],\r\n  defaults: {},\r\n  params: {},\r\n  settings: {\r\n    autoAddMore: 'end',\r\n  },\r\n  _isToolbarTemplate: true,\r\n};\r\n","import { TemplateConstants as TC, ToolbarTemplate } from '.';\r\n\r\n// the default / initial buttons in a standard toolbar\r\nexport const ToolbarTemplateDefault: ToolbarTemplate = {\r\n  name: TC.NameDefault,\r\n  groups: [\r\n    {\r\n      name: TC.GroupDefault,\r\n      buttons: 'edit,new,metadata,publish,layout',\r\n    }, {\r\n      name: TC.GroupList,\r\n      buttons: 'add,add-existing,replace,remove,moveup,movedown,instance-list',\r\n    }, {\r\n      name: TC.GroupEditAdvanced,\r\n      buttons: 'delete',\r\n    }, {\r\n      name: TC.GroupView,\r\n      buttons: 'template-develop,template-settings,contentitems,template-query,contenttype',\r\n      defaults: {\r\n        classes: 'group-pro',\r\n      },\r\n    }, {\r\n      name: TC.GroupApp,\r\n      buttons: 'app,app-settings,app-resources,zone,insights-server',\r\n      defaults: {\r\n        classes: 'group-pro',\r\n      },\r\n    },\r\n  ],\r\n  defaults: {},\r\n  params: {},\r\n  settings: {\r\n    autoAddMore: 'end',\r\n    // these are defaults, don't set again\r\n    // hover: \"right\",\r\n  },\r\n  _isToolbarTemplate: true,\r\n};\r\n","import { TemplateConstants as TC, ToolbarTemplate } from '.';\r\n\r\n// the default / initial buttons in a standard toolbar\r\nexport const ToolbarTemplateSublist: ToolbarTemplate = {\r\n  name: 'sublist',\r\n  groups: [\r\n    {\r\n      name: TC.GroupDefault,\r\n      buttons: 'edit,new,publish',\r\n      defaults: {\r\n        classes: 'group-inlist',\r\n      },\r\n    }, {\r\n      name: TC.GroupList,\r\n      buttons: 'add-existing,replace,remove,moveup,movedown,instance-list',\r\n      defaults: {\r\n        classes: 'group-inlist',\r\n      },\r\n    }, {\r\n      name: TC.GroupEditAdvanced,\r\n      buttons: 'delete',\r\n      defaults: {\r\n        classes: 'group-inlist',\r\n      },\r\n    },\r\n  ],\r\n  defaults: {},\r\n  params: {},\r\n  settings: {\r\n    autoAddMore: 'end',\r\n  },\r\n  _isToolbarTemplate: true,\r\n};\r\n","import { ToolbarTemplate, ToolbarTemplateDefault, ToolbarTemplateEmpty, ToolbarTemplateSublist } from '.';\r\nimport { HasLog, Insights } from '../../logging';\r\nimport { Obj } from '../../plumbing';\r\n\r\n/**\r\n * The template manager provides toolbar templates to the entire system.\r\n * It basically keeps a list of predefined templates, and returns the ones needed\r\n */\r\nexport class ToolbarTemplateManager extends HasLog {\r\n    /** Singleton */\r\n    public static singleton(): ToolbarTemplateManager {\r\n        return this._singleton ?? (this._singleton = new ToolbarTemplateManager());\r\n    }\r\n    private static _singleton: ToolbarTemplateManager;\r\n\r\n    configTemplateList: ToolbarTemplate[] = [];\r\n\r\n    /** hash - table of templates, to be used a list()['template - name'] */\r\n    list: HashTable<ToolbarTemplate> = {};\r\n\r\n    constructor() {\r\n        super('Tlb.TmpMan', null, 'build');\r\n        Insights.add('system', 'toolbar-template-manager', this.log);\r\n        this.add(ToolbarTemplateEmpty);\r\n        this.add(ToolbarTemplateDefault);\r\n        // CodeChange #2020-03-20#TemplateToolbarLeftUnused - if no side-effects, delete in June\r\n        // this.add('left', ToolbarTemplateLeft);\r\n        this.add(ToolbarTemplateSublist);\r\n    }\r\n\r\n    /**\r\n     * Deep copy toolbar template, so it can be modified without changing the next use\r\n     */\r\n    copy(name: string): ToolbarTemplate {\r\n        return Obj.DeepClone(this.findOrShowError(name));\r\n    }\r\n    private findOrShowError(name: string): ToolbarTemplate {\r\n        const found = this.list[name];\r\n        if (found) return found;\r\n        throw `try to find toolbar template '${name}' but not found`;\r\n    }\r\n\r\n    /**\r\n     * adds a template to the list, if it doesn't exist\r\n     */\r\n    private add(template: ToolbarTemplate) {\r\n        this.list[template.name] = template;\r\n    }\r\n}\r\n","import { ListWithCursor, ToolbarTemplateGroup } from '.';\r\nimport { DictionaryValue, TypeTbD } from '../../plumbing';\r\nimport { ToolbarSettings } from '../config/toolbar-settings';\r\n\r\n/**\r\n * This describes a template configuration of a toolbar\r\n * It's meant to provide type-save templates for what buttons are used where\r\n */\r\nexport class ToolbarTemplate implements ListWithCursor {\r\n    name: string;\r\n    groups: ToolbarTemplateGroup[] = [];\r\n    defaults?: DictionaryValue = {};\r\n    params?: DictionaryValue = {};\r\n    settings?: Partial<ToolbarSettings> = {};\r\n    debug?: boolean;\r\n    _isToolbarTemplate: true;\r\n    _insertCursor?: 0;\r\n\r\n    static is(thing: TypeTbD): thing is ToolbarTemplate {\r\n        return (thing as ToolbarTemplate)._isToolbarTemplate;\r\n    }\r\n\r\n    static hasGroups(thing: TypeTbD): thing is ToolbarTemplate {\r\n        return Array.isArray((thing as ToolbarTemplate).groups);\r\n    }\r\n\r\n}\r\n","import { ListWithCursor, TemplateConstants } from '.';\r\nimport { TypeTbD } from '../../plumbing';\r\n\r\n/**\r\n * This describes a button group in a toolbar template.\r\n * It should only be used for that\r\n */\r\nexport class ToolbarTemplateGroup implements ListWithCursor {\r\n    name: string = TemplateConstants.GroupUnknown;\r\n    buttons: string = '';\r\n    defaults?: HashTable<string> = {};\r\n    _insertCursor?: 0;\r\n\r\n    static is(thing: TypeTbD): thing is ToolbarTemplateGroup {\r\n        return (thing as ToolbarTemplateGroup).buttons !== undefined;\r\n    }\r\n}\r\n","import { ListWithCursor, ToolbarTemplate, ToolbarTemplateGroup } from '.';\r\nimport { HasLog } from '../../logging';\r\nimport { ToolbarConfigLoader } from '../config-loaders';\r\nimport { TemplateConstants as TC } from './constants';\r\n\r\n/**\r\n * This object is used to change the structure of a toolbar template.\r\n * It's only purpose is to assist in the new V10 format for quickly making toolbars.\r\n */\r\nexport class TemplateEditor extends HasLog {\r\n    constructor(public toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.TplEdt', toolbar.log);\r\n    }\r\n\r\n    addButton(template: ToolbarTemplate, groupName: string, id: string, name: string, pos: number): void {\r\n        // fromStart\r\n        const fromStart = !(Object.is(pos, -0) || pos < 0);\r\n        pos = Math.abs(pos);\r\n        // console.log('addbutton - pos', `${fromStart ? '+' : '-'}${pos}`);\r\n        const cl = this.log.call('addButton', `..., ${groupName}, ${id}, ${name}, ${fromStart ? '+' : '-'}${pos}, ${fromStart}`);\r\n        if (!template) return cl.done('no template');\r\n        let group = this.findGroupOrDefault(template, groupName);\r\n        if (!group) group = this.addGroup(template, groupName, 1000); // create group at end\r\n        const buttons = group.buttons?.split(TC.ButtonSeparator) ?? [];\r\n        const buttonId = id === name ? name : `${id}=${name}`;\r\n        const posStartEnd = this.correctPosStartEnd(buttons, pos, fromStart);\r\n        const posInsert = fromStart ? this.findInsertPosition(group, posStartEnd) : posStartEnd;\r\n        cl.add(`pos: ${pos}, startEnd: ${posStartEnd}, insert:${posInsert}`);\r\n        buttons.splice(posInsert, 0, buttonId);\r\n        group.buttons = buttons\r\n            .filter((b) => b.length) // drop empty items\r\n            .join(TC.ButtonSeparator);\r\n        cl.done();\r\n    }\r\n\r\n\r\n    private findInsertPosition(group: ListWithCursor, pos: number): number {\r\n        group._insertCursor = group._insertCursor || 0;\r\n        if (pos === 0) pos = group._insertCursor++;\r\n        return pos;\r\n    }\r\n\r\n    private correctPosStartEnd(target: Array<unknown>, pos: number, fromStart: boolean) {\r\n        if (fromStart) return pos;\r\n        pos = target.length - pos;\r\n        return pos >= 0 ? pos : target.length;\r\n    }\r\n\r\n    addGroup(template: ToolbarTemplate, groupName: string, pos: number): ToolbarTemplateGroup {\r\n        const fromStart = !(Object.is(pos, -0) || pos < 0);\r\n        pos = Math.abs(pos);\r\n        const cl = this.log.call('addGroup', `..., ${groupName}, ${fromStart ? '+' : '-'}${pos}`);\r\n        this.ensureGroups(template);\r\n        const alreadyExists = this.findGroup(template, groupName);\r\n        if (alreadyExists) return cl.return(alreadyExists, 'already exists');\r\n        const newGroup = new ToolbarTemplateGroup();\r\n        newGroup.name = groupName;\r\n        const posStartEnd = this.correctPosStartEnd(template.groups, pos, fromStart);\r\n        const posInsert = fromStart ? this.findInsertPosition(template, posStartEnd) : posStartEnd;\r\n        template.groups.splice(posInsert, 0, newGroup);\r\n        return cl.return(newGroup, 'created');\r\n    }\r\n\r\n    removeGroup(template: ToolbarTemplate, groupName: string): void {\r\n        const group = this.findGroup(template, groupName);\r\n        if (!group) return;\r\n        const index = template.groups.indexOf(group);\r\n        if (index < 0) return;\r\n        template.groups.splice(index, 1);\r\n    }\r\n\r\n    private ensureGroups = (template: ToolbarTemplate): void => { if (!template.groups) template.groups = []; };\r\n    private findGroup = (template: ToolbarTemplate, name: string): ToolbarTemplateGroup =>\r\n        template.groups.find((t) => t.name === name)\r\n\r\n    private findGroupOrDefault(template: ToolbarTemplate, name: string): ToolbarTemplateGroup {\r\n        const cl = this.log.call('findGroup', name);\r\n        this.ensureGroups(template);\r\n        if (template.groups.length === 0) return cl.return(null, 'no groups');\r\n        const found = this.findGroup(template, name);\r\n        if (found) return cl.return(found, 'found');\r\n        return cl.return(template.groups[0], 'not found, return first)');\r\n    }\r\n}\r\n","import { InPageButtonGroupJson, InPageButtonJson, InPageCommandJson, ToolbarConfigLoader, ToolbarWip } from '.';\r\nimport { InPageToolbarConfigVariations, ToolbarInitConfig } from '..';\r\nimport { ContextComplete } from '../../context';\r\nimport { HasLog } from '../../logging';\r\nimport { Button, Toolbar, ToolbarSettings } from '../config';\r\nimport { ToolbarTemplate, ToolbarTemplateDefault, ToolbarTemplateGroup, ToolbarTemplateSublist } from '../templates';\r\n\r\n\r\nexport class ToolbarConfigLoaderV09 extends HasLog {\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.TlbV09', toolbar.log);\r\n    }\r\n\r\n\r\n\r\n    public loadV9(context: ContextComplete, config: ToolbarInitConfig): Toolbar {\r\n        const cl = this.log.call('loadV9');\r\n        let toolbarSettings = config.settings;\r\n\r\n        // Default to empty toolbar settings if we don't have a toolbar or settings\r\n        // important: the checks look a bit strange, but there are cases where {} settings are handed in\r\n        // and we can't count the keys because that would result in other checks\r\n        if (Object.keys(config.toolbar).length > 0 && toolbarSettings === ({} as ToolbarSettings)) {\r\n            cl.add('no data or settings, will use default settings for empty');\r\n            toolbarSettings = ToolbarSettings.getForEmpty();\r\n        }\r\n\r\n        // if it has an action or is an array, keep that. Otherwise get standard buttons\r\n        const draftToolbar = this.getTemplateIfNoButtonsSpecified(config.toolbar as InPageToolbarConfigVariations);\r\n        cl.data('after template check', draftToolbar);\r\n\r\n        const toolbar = this.buildFullDefinition(context, draftToolbar, toolbarSettings);\r\n        return cl.return(toolbar, 'ok');\r\n    }\r\n\r\n\r\n    /**\r\n     * If the raw data has specs for what buttons, use that\r\n     * Otherwise load the button list from the template\r\n     */\r\n    public getTemplateIfNoButtonsSpecified(raw: InPageToolbarConfigVariations): InPageToolbarConfigVariations {\r\n        const cl = this.log.call('getTemplateIfNoButtonsSpecified');\r\n        cl.add('initial', raw);\r\n\r\n        if (InPageCommandJson.hasActions(raw)) return cl.return(raw, 'has actions, keep raw');\r\n        if (ToolbarTemplate.hasGroups(raw)) return cl.return(raw, 'has groups, keep raw');\r\n        if (ToolbarTemplateGroup.is(raw)) return cl.return(raw, 'is group, keep raw');\r\n        if (Array.isArray(raw)) return cl.return(raw, 'is array, keep raw');\r\n\r\n        // final: nothing defined, use template\r\n        cl.add('no toolbar structure specified, will use standard toolbar template');\r\n        // If it's a sub-list toolbar, use the special template for it\r\n        const defToolbarname = (raw as InPageCommandJson).fields ? ToolbarTemplateSublist.name : ToolbarTemplateDefault.name;\r\n        const template = this.toolbar.templates.copy(defToolbarname);\r\n        template.params = (Array.isArray(raw) && raw[0]) || raw; // attach parameters\r\n        return cl.return(template, 'use template');\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * take various common input format and convert it to a full toolbar-structure definition\r\n     * can handle the following input formats (the param unstructuredConfig):\r\n     * complete tree (detected by \"groups): { groups: [ {}, {}], name: ..., defaults: {...} }\r\n     * group of buttons (detected by \"buttons): { buttons: \"...\" | [], name: ..., ... }\r\n     * list of buttons (detected by IsArray with action): [ { action: \"...\" | []}, { action: \"\"|[]} ]\r\n     * button (detected by \"command\"): { command: \"\"|[], icon: \"..\", ... }\r\n     * just a command (detected by \"action\"): { entityId: 17, action: \"edit\" }\r\n     * array of commands: [{entityId: 17, action: \"edit\"}, {contentType: \"blog\", action: \"new\"}]\r\n     */\r\n    public buildFullDefinition(\r\n        toolbarContext: ContextComplete,\r\n        unstructuredConfig: InPageToolbarConfigVariations,\r\n        // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June\r\n        // instanceConfig: InstanceConfig,\r\n        toolbarSettings: ToolbarSettings,\r\n    ): Toolbar {\r\n    const cl = this.log.call('buildFullDefinition');\r\n\r\n    const configWip = this.ensureDefinitionTree(unstructuredConfig, toolbarSettings); // as unknown as Toolbar;\r\n\r\n    if (ToolbarTemplate.is(unstructuredConfig) && unstructuredConfig.debug)\r\n        console.log('toolbar: detailed debug on; start build full Def');\r\n\r\n    const result = this.toolbar.buildTreeAndModifyAccordingToRules(toolbarContext, configWip);\r\n    return cl.return(result);\r\n}\r\n\r\n\r\n\r\n    //#region build initial toolbar object\r\n    /**\r\n     * this will take an input which could already be a tree, but it could also be a\r\n     * button-definition, or just a string, and make sure that afterwards it's a tree with groups\r\n     * the groups could still be in compact form, or already expanded, depending on the input\r\n     * output is object with:\r\n     * - groups containing buttons[], but buttons could still be very flat\r\n     * - defaults, already officially formatted\r\n     * - params, officially formatted\r\n     * @param unstructuredConfig\r\n     * @param toolbarSettings\r\n     */\r\n    private ensureDefinitionTree(unstructuredConfig: InPageToolbarConfigVariations, toolbarSettings: ToolbarSettings): ToolbarWip {\r\n        const wrapLog = this.log.call('ensureDefinitionTree');\r\n        // original is null/undefined, just return empty set\r\n        if (!unstructuredConfig) throw (`preparing toolbar, with nothing to work on: ${unstructuredConfig}`);\r\n\r\n        const newToolbar: ToolbarWip = new Toolbar();\r\n        newToolbar.groups = this.findGroups(unstructuredConfig);\r\n\r\n        const probablyTemplate = unstructuredConfig as ToolbarTemplate;\r\n        newToolbar.params = probablyTemplate.params || {}; // these are the default command parameters\r\n        newToolbar.settings = { ...ToolbarSettings.getDefaults(), ...probablyTemplate.settings, ...ToolbarSettings.dropEmptyProperties(toolbarSettings)};\r\n\r\n        newToolbar.debug = probablyTemplate.debug || false; // show more debug info\r\n        newToolbar.defaults = probablyTemplate.defaults || {}; // the button defaults like icon, etc.\r\n\r\n        return wrapLog.return(newToolbar);\r\n    }\r\n\r\n\r\n\r\n    private findGroups(unstructuredConfig: InPageToolbarConfigVariations): InPageButtonGroupJson[] { // ButtonGroupsWip {\r\n        const cl = this.log.call('findGroups');\r\n        cl.data('initial', unstructuredConfig);\r\n\r\n        // case 0: nothing in the config\r\n        if (!unstructuredConfig || unstructuredConfig === {})\r\n            return cl.return([], 'case 0: empty object, use []');\r\n\r\n        const arrGroups: InPageButtonGroupJson[] = []; // Array<InPageButtonJson | ButtonGroup>;\r\n\r\n        // ensure that the groups are all correct\r\n        cl.add('will detect what initial structure was given');\r\n\r\n        // Case 2: Array\r\n        if (Array.isArray(unstructuredConfig)) {\r\n            cl.add('Case 2: is array');\r\n            if (unstructuredConfig.length === 0)\r\n                return cl.return([], '2a: empty array');\r\n            if (Button.isArray(unstructuredConfig))\r\n                return cl.return([{ buttons: unstructuredConfig }], '2b: array of groups');\r\n            if (InPageButtonJson.is(unstructuredConfig[0]))\r\n                return cl.return([{ buttons: unstructuredConfig as InPageButtonJson[]}], // Array<InPageButtonJson | ButtonGroup>;\r\n                    '2b: is list of buttons, return 1 group');\r\n            console.warn('error detecting groups in this toolbar');\r\n            return cl.return([], \"2x: error, it's array but can't detect type, use []\");\r\n        }\r\n\r\n        // Case 3: not an array\r\n        cl.add('Case 3: not array');\r\n        if (InPageButtonJson.is(unstructuredConfig)) {\r\n            return cl.return([ { buttons: [unstructuredConfig] }], \r\n                'Case 3a: not array, but has action/buttons properties, will wrap config into array');\r\n        }\r\n\r\n        cl.add('Case 3: not array and no \"action\", will return it or blank');\r\n        // we either have groups already, or we'll return blank\r\n        if (ToolbarTemplate.hasGroups(unstructuredConfig))\r\n            return cl.return(unstructuredConfig.groups, '4: found groups');\r\n        // else\r\n        //     return cl.return([], 'no groups, return []');\r\n\r\n        // ensure that arrays of actions or buttons are re-mapped to the right structure node\r\n        // if (!arrGroups || !(arrGroups as any).length) {\r\n        //     return cl.return([], 'not array or has no items, return empty array');\r\n        // } else\r\n        //     cl.add('its an object or array, use that');\r\n\r\n        // if (ButtonGroup.isArray(arrGroups)) {\r\n        //     return cl.return(arrGroups, 'detected buttons on first item, assume button-group, moving into .groups');\r\n        // } else if (InPageButtonJson.isArray(arrGroups)) {\r\n        //     return cl.return([{ buttons:  arrGroups } as InPageButtonGroupJson],\r\n        //         'detected command or action on first item, assume buttons, move into .groups[buttons] ');\r\n        // }\r\n\r\n        cl.add('can\\'t detect what this is - show warning');\r\n        console.warn(\"toolbar tried to build toolbar but couldn't detect type of this:\", arrGroups);\r\n        return cl.return([], 'warning');\r\n    }\r\n}\r\n","\r\nexport const RuleConstants = {\r\n    Keys: {\r\n        None: 'none',\r\n    },\r\n};\r\n","import { RuleParams } from '.';\r\nimport { MetadataFor } from '../../commands';\r\nimport { Log, LogEntryOptions as LEO } from '../../logging';\r\nimport { DictionaryValue } from '../../plumbing';\r\n\r\nconst prefillPrefix = 'prefill:';\r\nconst filterPrefix = 'filter:';\r\n\r\nexport class RuleParamsHelper {\r\n\r\n    static processParams(params: RuleParams, log: Log): RuleParams {\r\n        const cl = log.call('processParams');\r\n        const prefill = RuleParamsHelper.processSubMultiKeys(params, prefillPrefix, log);\r\n        if (prefill) params.prefill = prefill;\r\n\r\n        const filters = RuleParamsHelper.processSubMultiKeys(params, filterPrefix, log);\r\n        if (filters) params.filters = filters;\r\n\r\n        // catch a very common mistake in metadata\r\n        if (params.metadata) {\r\n            delete params.metadata;\r\n            cl.add('params had additional metadata - invalid, will remove', null, LEO.error);\r\n        }\r\n\r\n        // process metadata\r\n        if (params.for) params.metadata = RuleParamsHelper.processMetadata(params, log);\r\n        return cl.return(params);\r\n    }\r\n\r\n    private static processMetadata(params: RuleParams, log: Log): MetadataFor {\r\n        const cl = log.call('processMetadata');\r\n\r\n        // get the for-target and if exists, delete from params\r\n        const mdFor = params.for;\r\n        if (!mdFor) return cl.return(undefined, 'no metadata');\r\n        delete params.for;\r\n\r\n        // just one part, use it as key\r\n        if (mdFor.indexOf(',') === -1) return cl.return({ key: mdFor }, 'only has key');\r\n        const parts = mdFor.split(',').map((p) => p.trim());\r\n        if (parts.length !== 3)\r\n            return cl.return(undefined, `error: metadata-for parts count expected 3: ${parts.length}`, LEO.error);\r\n\r\n        // part 1 must be a number\r\n        const targetType = +parts[0];\r\n        if (isNaN(targetType))\r\n            return cl.return(undefined, `error: first key part is not number - got ${targetType}`, LEO.error);\r\n\r\n        // part 2 must be a string with 'string', 'guid' or 'number'\r\n        const keyType = parts[1];\r\n        if (keyType !== 'string' && keyType !== 'guid' && keyType !== 'number')\r\n            return cl.return(undefined, `error: key is not known type, should be string, guid or number, but got ${keyType}`, LEO.error);\r\n\r\n        // part 3 is the key\r\n        const key = parts[2];\r\n        if (key === null || key === undefined || key === '')\r\n            return cl.return(undefined, `error: key strange value: '${key}'`, LEO.error);\r\n\r\n        // todo: warn if no metadata or id!\r\n        if (!params.contentType || params.entityId == null)\r\n            return cl.return(undefined, 'error: contentType and entityId missing', LEO.error);\r\n\r\n        return cl.return({\r\n            key: key,\r\n            targetType: targetType,\r\n            keyType: keyType,\r\n        });\r\n    }\r\n\r\n\r\n    /** Do special processing on all prefill:Field=Value rules */\r\n    private static processSubMultiKeys(params: RuleParams, prefix: string, log: Log): DictionaryValue {\r\n        const cl = log.call('processSubMultiKeys');\r\n\r\n        // only load special prefills if we don't already have a prefill\r\n        if (!params) return cl.return(undefined, 'no params');\r\n\r\n        const keys = Object.keys(params).filter((k) => k.indexOf(prefix) === 0);\r\n        if (!keys || keys.length === 0) return cl.return(undefined, `no speciall '${prefix}' keys`);\r\n\r\n        const prefixLen = prefix.length;\r\n        const list: DictionaryValue = {};\r\n        keys.forEach((k) => {\r\n            let value: any = params[k];\r\n            // 2020-04-02 prefill is a bit flaky - this should fix the common issues\r\n            // fix boolean true must be \"true\"\r\n            if (value === true || value === false) value = value.toString();\r\n            else {\r\n                // try to detect list of guids\r\n                if (prefix === prefillPrefix)\r\n                    value = RuleParamsHelper.convertGuidListToArrayOrKeepOriginal(value);\r\n            }\r\n            list[k.substring(prefixLen)] = value;\r\n            delete params[k];\r\n        });\r\n        return cl.return(list, 'got list of multi-keys');\r\n    }\r\n\r\n    private static convertGuidListToArrayOrKeepOriginal(value: string): string | string[] {\r\n        // must be string\r\n        if (!value || typeof value !== 'string') return value;\r\n        // must have a comma to become an array\r\n        if (value.indexOf(',') === -1) return value;\r\n        // shouldn't have any quotes\r\n        if (value.indexOf('\"') >= 0 || value.indexOf(\"'\") >= 0) return value;\r\n        const probablyArray = value.split(',').map((g) => g.trim());\r\n        // guid check regex from https://stackoverflow.com/questions/7905929/how-to-test-valid-uuid-guid\r\n        const guidCount = probablyArray\r\n            .filter((g) => g.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i) !== null);\r\n            // .filter((m) => m === true);\r\n        if (guidCount && guidCount.length === probablyArray.length) return probablyArray;\r\n        return value;\r\n    }\r\n}\r\n","import { Operations as Operators, RuleConstants as RC, RuleParams, RuleParamsHelper } from '.';\r\nimport { HasLog, Log } from '../../logging';\r\nimport { Dictionary, DictionaryValue, TypeValue } from '../../plumbing';\r\nimport { TemplateConstants } from '../templates';\r\nimport { BuildSteps } from './build-steps';\r\n\r\n/**\r\n * Contains a rule how to add/modify a toolbar.\r\n */\r\nexport class BuildRule extends HasLog {\r\n    //#region Rule parts\r\n    /** The ID for this rule - often the same as the name */\r\n    id: string;\r\n\r\n    /** Name of the thing being added - often a command name or can be the group name */\r\n    name: string;\r\n\r\n\r\n    /** The build command to run */\r\n    step: BuildSteps | string;\r\n\r\n    /** what this rule should do */\r\n    operator: Operators;\r\n\r\n\r\n    /** Group name - when adding more buttons */\r\n    group: string = TemplateConstants.NameDefault;\r\n\r\n    /**\r\n     * position where something is added - the group or the button\r\n     * Note that JS preserves -0\r\n     */\r\n    pos: number = 0;\r\n\r\n    //#endregion\r\n\r\n    //#region command parts\r\n\r\n    params?: RuleParams = {};\r\n\r\n    /**\r\n     * Button Rules - determines what a button should do / not do\r\n     */\r\n    ui: {\r\n        icon?: string,\r\n        class?: string,\r\n        color?: string,\r\n        show?: boolean,\r\n        code?: string,\r\n        title?: string,\r\n        [key: string]: TypeValue,\r\n    } = {};\r\n\r\n    /** ATM unused url-part after the hash - will probably be needed in future */\r\n    private hash: Dictionary<string> = {};\r\n\r\n    //#endregion\r\n\r\n    constructor(public ruleString: string, parentLog: Log) {\r\n        super('Tlb.BdRule', parentLog);\r\n        if (!ruleString) {\r\n            this.log.add('rule is empty');\r\n            return;\r\n        }\r\n        this.load();\r\n    }\r\n\r\n    /** Tells if this rule will override the show settings  */\r\n    overrideShow(): boolean | undefined {\r\n        if (this.operator === Operators.remove) return false;\r\n        if (this.operator === Operators.add) return true;\r\n        if (this.operator === Operators.modify && this?.ui?.show !== undefined)\r\n            return this.ui.show;\r\n        return undefined;\r\n    }\r\n\r\n\r\n    private load() {\r\n        const cl = this.log.call('load', this.ruleString);\r\n        const parts = splitUrlSections(this.ruleString);\r\n        if (!parts.key) return cl.done(\"no key, won't load\");\r\n\r\n        this.loadHeader(parts.key);\r\n        if (parts.params)  this.loadParamsAndPrefill(parts.params);\r\n        if (parts.button) this.loadHash(parts.button);\r\n        return cl.done();\r\n    }\r\n\r\n\r\n\r\n    private loadHeader(rule: string): void {\r\n        const cl = this.log.call('loadHeader', rule);\r\n        const parts = this.splitParamsArray(rule);\r\n        let key = parts?.[0]?.[0] || RC.Keys.None;\r\n\r\n        // Pick up the operation from header, but if it's not a known operator, auto-detect\r\n        let operator = key[0];\r\n        const knownOperatorFound = Object.values(Operators).includes(operator as Operators);\r\n        if (!knownOperatorFound)\r\n            operator = (key === BuildSteps.params || key === BuildSteps.settings || key === BuildSteps.toolbar)\r\n                ? Operators.system\r\n                : Operators.add;\r\n        this.operator = operator as Operators;\r\n        cl.add(`name part '${key}', firstChar '${operator}'`);\r\n        // remember the primary keyword because this determines what we're doing\r\n        // but truncate the first char if it had an operator\r\n        key = knownOperatorFound ? key.substring(1) : key;\r\n\r\n        const knowStepFound = Object.values(BuildSteps).includes(key as BuildSteps);\r\n        this.step = knowStepFound ? key : BuildSteps.button;\r\n\r\n        // for system and %-change operations the id should be the name of the standard button\r\n        // ...but if it's an add-operation, we must keep the IDs appart because various\r\n        // properties are set at a much later time\r\n        this.id = (this.operator === Operators.add)\r\n            ? 'rndId' + Math.floor(Math.random() * 99999)\r\n            : key;\r\n\r\n        // command name defaults to name, can be reset by load-headers\r\n        // assumes key is something like \"group=myGroup\" or just \"edit\"\r\n        this.name = parts?.[0]?.[1] || key;\r\n        if (parts.length > 1) this.loadHeaderParts(parts.slice(1));\r\n\r\n        return cl.done();\r\n    }\r\n\r\n    private loadHeaderParts(rest: string[][]) {\r\n        const cl = this.log.call('loadHeaderParts');\r\n        if (!rest.length) return cl.done('nothing to load');\r\n        const parts = this.dicToArray(rest);\r\n        // #1 pick up id & name\r\n        if (parts.id) this.id = parts.id as string;\r\n        if (parts.name) this.name = parts.name as string;\r\n        // #2 pick up group\r\n        if (typeof parts.group === 'string') {\r\n            this.group = parts.group;\r\n            delete parts.group;\r\n        }\r\n        // #3 position can be number or -number to indicate from other side\r\n        // Note that JS preserves -0, which is kind of unique\r\n        if (parts.pos != null) this.pos = Number(parts.pos);\r\n\r\n        // #4 icon is automatically kept\r\n        // #5 show override\r\n        if (typeof parts.show === 'string')\r\n            (parts as DictionaryValue).show = parts.show === 'true';\r\n        this.ui = parts;\r\n        return cl.return(this.ui, 'button rules');\r\n    }\r\n\r\n    private loadParamsAndPrefill(rule: string) {\r\n        const cl = this.log.call('loadParams', rule);\r\n        this.params = this.splitParamsDic(rule);\r\n        cl.data('params', this.params);\r\n        this.params = RuleParamsHelper.processParams(this.params, this.log);\r\n        return cl.done();\r\n    }\r\n\r\n    private loadHash(rule: string) {\r\n        const cl = this.log.call('loadButton', rule);\r\n        this.hash = this.splitParamsDic(rule);\r\n        cl.data('button', this.hash);\r\n        return cl.done();\r\n    }\r\n\r\n    //#region string manipulation helpers\r\n\r\n    private dicToArray(original: string[][]): Dictionary<string> {\r\n        return original.reduce((map, obj) => {\r\n            map[obj[0]] = obj[1];\r\n            return map;\r\n        }, {} as Dictionary<string>);\r\n    }\r\n\r\n    private splitParamsDic(original: string): Dictionary<string> {\r\n        return this.dicToArray(this.splitParamsArray(original));\r\n    }\r\n\r\n    private splitParamsArray(original: string): string[][] {\r\n        if (!original) return [];\r\n        const split1 = original.split('&');\r\n        const split2 = split1.map((p) => {\r\n            const keyValues = p.split('=');\r\n            const key = keyValues[0];\r\n            let val: any = keyValues[1];\r\n            // disabled, don't see a use case for this\r\n            // check if the value had '=' - then re-join\r\n            // if (keyValues.length > 1)\r\n            //     val = keyValues.slice(1).join('=');\r\n\r\n            // fix url encoding\r\n            if (val?.indexOf('%') > -1) val = decodeURIComponent(val);\r\n            // fix C# typed true/false or string representations\r\n            if (val === 'True' || val === 'true') return [key, true]; // val = true;\r\n            if (val === 'False' || val === 'false') return [key, false]; // val = false;\r\n\r\n            // cast numbers to numbers\r\n            val = isNaN(+val) ? val : Number(val);\r\n            return [key, val];\r\n        });\r\n        return split2;\r\n    }\r\n\r\n\r\n    //#endregion\r\n}\r\n\r\n\r\n\r\n\r\nfunction splitUrlSections(str: string): { key: string, params: string, button: string } | undefined {\r\n    // dev link: https://regex101.com/r/vK4rV7/519\r\n    // inpsired by https://stackoverflow.com/questions/27745/getting-parts-of-a-url-regex\r\n\r\n    const regex = /^([^\\/?#]*)?([^?#]*)(\\?([^#]*))?(#(.*))?/i;\r\n    // const str = `+edit&something=other&els=ok?aoeuaoeu=5&aoeuaou=aoeu#but=thi&aouoaeu`;\r\n    const m = regex.exec(str);\r\n\r\n    if (m && m !== null)\r\n        return { key: m[1], params: m[4], button: m[6]};\r\n    return undefined;\r\n}\r\n","import { Operations as OP } from '.';\r\nimport { BuildRule } from '.';\r\nimport { HasLog } from '../../logging';\r\nimport { ToolbarConfigLoader } from '../config-loaders';\r\nimport { BuildSteps } from './build-steps';\r\n\r\nconst throwOnError = true;\r\n\r\nexport class RuleManager extends HasLog {\r\n    /** List of rules which were picked up and will be applied */\r\n    rules: BuildRule[] = [];\r\n\r\n    ruleManagerId = Math.floor(Math.random() * 99999);\r\n\r\n    /** Basic constructor, must be called from a ToolbarConfigLoader */\r\n    constructor(parent: ToolbarConfigLoader) {\r\n        super('Tlb.RlMngr', parent.log, 'constructor');\r\n        this.log.add('tempId:' + this.ruleManagerId);\r\n    }\r\n\r\n    /** Load/initialize the rules which were found */\r\n    load(rawList: string[]): BuildRule[] {\r\n        const cl = this.log.call('load', `${() => rawList.length}`);\r\n        if (!Array.isArray(rawList))\r\n            return cl.return([], 'raw is empty');\r\n\r\n        rawList.forEach((raw) => {\r\n            if (typeof raw === 'string') {\r\n                try {\r\n                    this.rules.push(new BuildRule(raw, this.log));\r\n                } catch (e) {\r\n                    if (throwOnError) throw e;\r\n                    cl.add(`error adding string-rule '${raw}'`, e);\r\n                }\r\n            } else {\r\n                console.error('tried to parse a toolbar rule and expected a string, but got something else');\r\n            }\r\n        });\r\n\r\n\r\n\r\n        return cl.return(this.rules, 'final rules');\r\n    }\r\n\r\n    /** Find a single rule matching an ID */\r\n    find(id: string): BuildRule | undefined { return this.rules.find((r) => r.id === id); }\r\n\r\n    /** find all rules matching a criteria */\r\n    filter(criteria: (x: BuildRule) => boolean): BuildRule[] { return this.rules.filter(criteria); }\r\n\r\n\r\n    /** the settings are usually retrieved on settings, but you can also put them behind the toolbar */\r\n    getSettings = () => this.getSystemRule(BuildSteps.settings) || this.getToolbar();\r\n\r\n    /** the params for the command - if not found, will use the toolbar params */\r\n    getParams = () => this.getSystemRule(BuildSteps.params) || this.getToolbar();\r\n\r\n    getToolbar = () => this.getSystemRule(BuildSteps.toolbar);\r\n    getAdd = () => this.filter((br) => br.operator === OP.add);\r\n    getRemoveGroups = () => this.filter((br) => br.operator === OP.remove && br.step === BuildSteps.group);\r\n\r\n    /** Find a system rule (marked with '$') */\r\n    private getSystemRule(name: BuildSteps): BuildRule | undefined {\r\n        return this.rules.find((r) => r.operator === OP.system && r.step === name);\r\n    }\r\n\r\n}\r\n","import { ToolbarConfigLoader, InPageCommandJson } from '.';\r\nimport { ToolbarInitConfig } from '..';\r\nimport { ContextComplete } from '../../context';\r\nimport { HasLog } from '../../logging';\r\nimport { Toolbar, ToolbarSettings } from '../config';\r\nimport { BuildSteps, RuleManager } from '../rules';\r\nimport { ToolbarTemplate, ToolbarTemplateDefault, ToolbarTemplateSublist } from '../templates';\r\nimport { ToolbarWip } from './config-formats/toolbar-wip';\r\n\r\n\r\nexport class ToolbarConfigLoaderV10 extends HasLog {\r\n\r\n    public rules: RuleManager;\r\n\r\n    constructor(private toolbar: ToolbarConfigLoader) {\r\n        super('Tlb.TlbV10', toolbar.log, 'constructor');\r\n        this.rules = new RuleManager(toolbar);\r\n    }\r\n\r\n\r\n    public loadV10(context: ContextComplete, config: ToolbarInitConfig, raw: string[]): Toolbar {\r\n        const cl = this.log.call('loadV10');\r\n\r\n        this.rules.load(raw);\r\n\r\n        let template: ToolbarTemplate;\r\n        // #1 prepare settings - get rules and mix with defaults\r\n        const settingRule = this.rules.getSettings();\r\n        const settings = new ToolbarSettings(settingRule?.params as Partial<ToolbarSettings>);\r\n\r\n        // #2 load either the default toolbar or the one specified\r\n        const toolbarRule = this.rules.getToolbar();\r\n\r\n        // #3 find params\r\n        const params = this.rules.getParams();\r\n\r\n        // If it's a sub-list toolbar, use the special template for it\r\n        const isSublist = (config.toolbar as InPageCommandJson).fields || params?.params?.fields;\r\n        const defToolbarname = isSublist ? ToolbarTemplateSublist.name : ToolbarTemplateDefault.name;\r\n        const toolbarTemplateName = toolbarRule\r\n            ? toolbarRule.name\r\n            : defToolbarname;\r\n        template = this.toolbar.templates.copy(toolbarTemplateName);\r\n        template.settings = settings;\r\n        if (params) template.params = params.params;\r\n\r\n        // #4 Remove unwanted groups\r\n        const removeGroups = this.rules.getRemoveGroups();\r\n        removeGroups.forEach((rg) => this.toolbar.templateEditor.removeGroup(template, rg.name));\r\n\r\n        // Add additional buttons\r\n        const add = this.rules.getAdd();\r\n        add.forEach((a) => {\r\n            if (a.step === BuildSteps.group) this.toolbar.templateEditor.addGroup(template, a.name, a.pos);\r\n            else this.toolbar.templateEditor.addButton(template, a.group, a.id, a.name, a.pos);\r\n        });\r\n\r\n        const toolbar = this.toolbar.buildTreeAndModifyAccordingToRules(context, template as ToolbarWip);\r\n        if (!toolbar.identifier) toolbar.identifier = Toolbar.createIdentifier();\r\n        toolbar.settings._rules = this.rules;\r\n        // process the rules one by one\r\n        return cl.return(toolbar, 'ok');\r\n    }\r\n}\r\n","import { ButtonConfigLoader, ButtonGroupConfigLoader, CommandConfigLoader, ToolbarConfigLoaderV09, ToolbarConfigLoaderV10, ToolbarWip } from '.';\r\nimport { ToolbarManager } from '..';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { Entry, HasLog } from '../../logging';\r\nimport { Toolbar } from '../config';\r\nimport { InPageToolbarConfigVariations, ToolbarInitConfig } from '../initialize/toolbar-init-config';\r\nimport { TemplateEditor, ToolbarTemplate, ToolbarTemplateManager } from '../templates';\r\n\r\n// Enable when debugging toolbar creation - will dump all logs to the console\r\nconst liveDumpThis = false;\r\n\r\nexport class ToolbarConfigLoader extends HasLog {\r\n\r\n    public toolbarV09: ToolbarConfigLoaderV09;\r\n    public toolbarV10: ToolbarConfigLoaderV10;\r\n    public groups: ButtonGroupConfigLoader;\r\n    public button: ButtonConfigLoader;\r\n    public command: CommandConfigLoader;\r\n    public templates = ToolbarTemplateManager.singleton();\r\n    public templateEditor: TemplateEditor;\r\n\r\n    public logs: Array<{ key: string, entries: Entry[]}>;\r\n\r\n    /** Special constructor that can only be called from the ToolbarManager */\r\n    constructor(_owner: ToolbarManager) {\r\n        // important: always create a new log as it will be stored in insights\r\n        super('Tlb.TlbCnf');\r\n    }\r\n\r\n    private setLoggingAndCreateHelpers(toolbarData: InPageToolbarConfigVariations): void {\r\n        // note: could be true, false or 'live'\r\n        let debugLog = toolbarData && (toolbarData as ToolbarTemplate).debug;\r\n        if (debugLog === undefined && Array.isArray(toolbarData) && toolbarData.length)\r\n            debugLog = (toolbarData[0] as ToolbarTemplate).debug;\r\n\r\n        debugLog = debugLog || false;\r\n\r\n        if (liveDumpThis || debugLog) {\r\n            this.log.keepData = true;\r\n            if (liveDumpThis || debugLog.toString() === 'live')\r\n                this.log.liveDump = true;\r\n            this.log.add(`found debug=${debugLog}, will enable intense logging`);\r\n        }\r\n        this.toolbarV09 = new ToolbarConfigLoaderV09(this);\r\n        this.toolbarV10 = new ToolbarConfigLoaderV10(this);\r\n        this.groups = new ButtonGroupConfigLoader(this);\r\n        this.button = new ButtonConfigLoader(this);\r\n        this.command = new CommandConfigLoader(this);\r\n        this.templateEditor = new TemplateEditor(this);\r\n    }\r\n\r\n\r\n\r\n    load(context: ContextComplete, config: ToolbarInitConfig): Toolbar {\r\n        const cl = this.log.call('load', '', 'expand start', { context: context, config: config });\r\n        // cl.data('initial context', context);\r\n        // cl.data('initial config', config);\r\n        // if null/undefined, use empty object\r\n        const raw = config.toolbar = config.toolbar || {};\r\n        this.setLoggingAndCreateHelpers(raw as InPageToolbarConfigVariations);\r\n\r\n        // check if it's a V10 tolbar\r\n        if (Array.isArray(raw) && raw.length >= 0 && typeof raw[0] === 'string')\r\n            return cl.return(this.toolbarV10.loadV10(context, config, raw), 'v10 done');\r\n\r\n        // do standard V3 procedures\r\n        return cl.return(this.toolbarV09.loadV9(context, config), 'V9 done');\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    public buildTreeAndModifyAccordingToRules(toolbarContext: ContextComplete, configWip: ToolbarWip) {\r\n        const wrapLog = this.log.call('buildFullDefinition');\r\n        const tlbConfig = this.groups.expandButtonGroups(configWip);\r\n        // #CodeChange#2020-03-22#InstanceConfig - believe this is completely unused; remove in June\r\n        this.button.removeDisableButtons(toolbarContext, tlbConfig /*, instanceConfig */);\r\n        return wrapLog.return(tlbConfig);\r\n    }\r\n\r\n\r\n  //#endregion initial toolbar object\r\n\r\n}\r\n","import { ToolbarConfigFinderAndInitializer } from '.';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HasLog, Insights } from '../logging';\r\nimport { ToolbarConfigLoader } from './config-loaders/toolbar-config-loader';\r\nimport { Toolbar } from './config/toolbar';\r\nimport { ToolbarInitConfig } from './initialize/toolbar-init-config';\r\n\r\n/**\r\n * Toolbar manager for the whole page - basically a set of APIs\r\n * the toolbar manager is an internal helper taking care of toolbars, buttons etc.\r\n */\r\nexport class ToolbarManager extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): ToolbarManager {\r\n        return this._singleton ?? (this._singleton = new ToolbarManager());\r\n    }\r\n    private static _singleton: ToolbarManager;\r\n\r\n    private readonly toolbarFinder: ToolbarConfigFinderAndInitializer;\r\n\r\n    private constructor() {\r\n        super('Tlb.Mngr', null, 'init');\r\n        Insights.add('system', 'toolbar-manager', this.log);\r\n        this.toolbarFinder = new ToolbarConfigFinderAndInitializer(this);\r\n    }\r\n\r\n    buildModule(parentTag: HTMLElement) {\r\n        this.toolbarFinder.buildDnnModule(parentTag);\r\n    }\r\n\r\n    build(node: HTMLElement) {\r\n        this.toolbarFinder.build(node);\r\n    }\r\n\r\n    loadConfig(context: ContextComplete, config: ToolbarInitConfig): Toolbar {\r\n        const loader = this.getLoader(JSON.stringify(config.toolbar || ''));\r\n        return loader.load(context, config);\r\n    }\r\n\r\n    /** Generate a single-use loader. It must be single use so the logs work */\r\n    getLoader(instanceName: string) {\r\n        const loader = new ToolbarConfigLoader(this);\r\n        Insights.add('toolbar', instanceName, loader.log);\r\n        return loader;\r\n    }\r\n}\r\n\r\n// export const ToolbarManager = new ToolbarManagerGlobal();\r\n","import { ModifierContentBlock } from '.';\r\nimport { ContentListActionParams } from '../commands';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { HasLog, NoJQ } from '../logging';\r\nimport { ToolbarManager } from '../toolbar/toolbar-manager';\r\n// note: this import must be at the end of the list, for reasons unknown\r\n// otherwise you get an error at runtime, something about constructors\r\n// Object prototype may only be an Object or null: undefined\r\n// not sure why though\r\n// tslint:disable-next-line: ordered-imports\r\nimport { translate } from '../i18n';\r\n\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiNew = 'cms/block/block';\r\nconst webApiMove = 'cms/list/move';\r\nconst webApiRemove = 'cms/list/Delete';\r\n//#endregion\r\n\r\n/** contains commands to create/move/delete a content-block in an inner-content */\r\nexport class ModifierContentBlockInstance extends HasLog {\r\n\r\n    constructor(parent: ModifierContentBlock, private sxcInstance: SxcEdit) {\r\n        super('QE.MdCbIn', parent.log);\r\n    }\r\n\r\n    /**\r\n     * create content block\r\n     * @param parentId\r\n     * @param fieldName\r\n     * @param index\r\n     * @param appName\r\n     * @param container\r\n     * @param newGuid\r\n     */\r\n    create(\r\n        parentId: number,\r\n        fieldName: string,\r\n        index: number,\r\n        appName: string,\r\n        container: HTMLElement,\r\n        newGuid: string,\r\n    ): Promise<void> {\r\n        // the wrapper, into which this will be placed and the list of pre-existing blocks\r\n        if (!container) {\r\n            alert('can\\'t add content-block as we couldn\\'t find the list');\r\n            return Promise.resolve();\r\n        }\r\n        const cblockList = container.querySelectorAll<HTMLElement>('div.sc-content-block');\r\n        if (index > cblockList.length) index = cblockList.length; // make sure index is never greater than the amount of items\r\n\r\n        const params = {\r\n            parentId: parentId,\r\n            field: fieldName,\r\n            sortOrder: index,\r\n            app: appName,\r\n            guid: newGuid,\r\n        };\r\n\r\n        const promise = this.sxcInstance.webApi\r\n            .fetchJson(this.sxcInstance.webApi.url(webApiNew, params), undefined, 'POST')\r\n            .then((result) => {\r\n                const newTag = NoJQ.domFromString(result)[0]; // prepare tag for inserting\r\n\r\n                // should I add it to a specific position...\r\n                if (cblockList.length > 0 && index > 0)\r\n                    cblockList[cblockList.length > index - 1 ? index - 1 : cblockList.length - 1].after(newTag);\r\n                else // ...or just at the beginning?\r\n                    container.prepend(newTag);\r\n\r\n                // ReSharper disable once UnusedLocals\r\n                const sxcNew = SxcEdit.get(newTag);\r\n                ToolbarManager.singleton().buildModule(newTag);\r\n            });\r\n        return Promise.resolve(promise);\r\n    }\r\n\r\n    /**\r\n     * move content block\r\n     * @param parentId\r\n     * @param field\r\n     * @param indexFrom\r\n     * @param indexTo\r\n     */\r\n    move(parent: string, field: string, indexFrom: number, indexTo: number): Promise<void> {\r\n\r\n        const params: ContentListActionParams = {\r\n            parent: parent,\r\n            fields: field,\r\n            index: indexFrom,\r\n            toIndex: indexTo,\r\n        };\r\n\r\n        const promise = this.sxcInstance.webApi\r\n            .fetch(this.sxcInstance.webApi.url(webApiMove, params), undefined, 'POST')\r\n            .then(() => {\r\n                console.log('done moving!');\r\n                window.location.reload();\r\n            });\r\n        return Promise.resolve(promise);\r\n    }\r\n\r\n\r\n    /**\r\n     * delete a content-block inside a list of content-blocks\r\n     * @param parent\r\n     * @param field\r\n     * @param index\r\n     */\r\n    delete(parent: string, field: string, index: number): Promise<void> {\r\n\r\n        if (!confirm(translate('QuickInsertMenu.ConfirmDelete'))) return null;\r\n        const params: ContentListActionParams = {\r\n            parent: parent,\r\n            fields: field,\r\n            index: index,\r\n        };\r\n\r\n        const promise = this.sxcInstance.webApi\r\n            .fetch(this.sxcInstance.webApi.url(webApiRemove, params), undefined, 'DELETE')\r\n            .then(() => {\r\n                console.log('done deleting!');\r\n                window.location.reload();\r\n            });\r\n        return Promise.resolve(promise);\r\n    }\r\n}\r\n","import { ModifierBase, QeSelectors, QuickE, QuickEClipboard, Selection } from '.';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { ContextForLists } from './context-for-lists';\r\nimport { ModifierContentBlockInstance } from './modifier-content-block-internal';\r\n\r\n/**\r\n * extend the quick edit with the core commands\r\n */\r\nexport class ModifierContentBlock extends ModifierBase {\r\n\r\n    constructor() {\r\n        super('QE.CntBlk');\r\n    }\r\n\r\n    getInstanceModifier(tag: HTMLElement) {\r\n        const sxc = SxcEdit.get(tag);\r\n        return new ModifierContentBlockInstance(this, sxc);\r\n    }\r\n\r\n    delete(clip: Selection): Promise<void> {\r\n        return this.getInstanceModifier(clip.list).delete(clip.parentGuid, clip.field, this.findClipListIndex(clip));\r\n    }\r\n\r\n    create(parent: number, field: string, listIndex: number, appOrContent: string, list: HTMLElement, newGuid: string): Promise<void> {\r\n        return this.getInstanceModifier(list).create(parent, field, listIndex, appOrContent, list, newGuid);\r\n    }\r\n\r\n    move(oldClip: Selection, newClip: Selection) {\r\n        const from = this.findClipListIndex(oldClip);\r\n        const to = this.findClipListIndex(newClip);\r\n        this.getInstanceModifier(oldClip.list).move(newClip.parentGuid, newClip.field, from, to);\r\n    }\r\n\r\n    // cb-numbering is a bit different, because the selector is at the bottom\r\n    // only there we should also skip on +1;\r\n    isRealMove(oldClip: Selection, newClip: Selection): boolean {\r\n        return this.findClipListIndex(oldClip) + 1 !== this.findClipListIndex(newClip);\r\n    }\r\n\r\n    /**\r\n     * find the real index of this block in the list - may not match the DOM index\r\n     */\r\n    findClipListIndex(clip: Selection): number {\r\n        return this.findListIndex(clip.item, clip.index);\r\n    }\r\n\r\n    /**\r\n     * find the real index of a block tag as it may not match the DOM index\r\n     */\r\n    findListIndex(tag: HTMLElement, fallback: number): number {\r\n        const editContext = SxcEdit.getEditContextOfTag(tag);\r\n        const listIndex = editContext?.contentBlockReference?.parentIndex ?? fallback;\r\n        return listIndex;\r\n    }\r\n\r\n    /**\r\n     * The button click handler. Must be static, as it will be attached to the buttons\r\n     * So the 'this' is not a ContentBlockModifier, but the html-tag which was clicked\r\n     */\r\n    static onCbButtonClick() {\r\n        const blockTag = QuickE.singleton().main.activeContentBlock;\r\n        const button = this as unknown as HTMLElement;\r\n        const list = QeSelectors.blocks.cb.findClosestList(blockTag);\r\n        const listItems = list.querySelectorAll<HTMLElement>(QeSelectors.blocks.cb.selector);\r\n        const actionConfig = ContextForLists.getFromDom(list);\r\n        const newGuid: string | null = actionConfig.guid || null;\r\n\r\n        // if the target is a content-block, then the list already has items\r\n        // so the domIndex must be based on that. Otherwise use 0\r\n        const domIndex = blockTag.classList.contains(QeSelectors.blocks.cb.class)\r\n            ? Array.from(listItems).indexOf(blockTag) + 1\r\n            : 0;\r\n\r\n        // Check if it's a cut/paste action\r\n        const cbAction = button.getAttribute('data-action');\r\n        if (cbAction)\r\n            return QuickEClipboard.singleton().do(cbAction, list, domIndex, QeSelectors.blocks.cb.id);\r\n\r\n        // this is a create-additional block action\r\n        // in this case the clipboard doesn't exist\r\n        // so we'll have to find the dom object and get the list index\r\n        const listIndex = QuickEClipboard.singleton().modCb.findListIndex(blockTag, domIndex - 1) + 1;\r\n\r\n        const appOrContent = button.getAttribute('data-type');\r\n        return QuickEClipboard.singleton().modCb.create(actionConfig.parent as number, actionConfig.field, listIndex, appOrContent, list, newGuid);\r\n    }\r\n\r\n}\r\n","\r\nexport class PositionCoordinates {\r\n    public w?: number;\r\n    public yh?: number;\r\n    public element?: HTMLElement;\r\n\r\n    constructor(public x: number, public y: number) { }\r\n\r\n}\r\n","import { ModifierBase, ModifierDnnModuleInternal, QeSelectors, QuickE, QuickEClipboard, Selection } from '.';\r\nimport { NoJQ } from '../plumbing';\r\n\r\nexport class ModifierDnnModule extends ModifierBase {\r\n\r\n    private modInternal: ModifierDnnModuleInternal;\r\n\r\n    constructor() {\r\n        super('QE.DnnMod');\r\n        this.modInternal = new ModifierDnnModuleInternal(this);\r\n    }\r\n\r\n    delete(clip: Selection): Promise<void> {\r\n        if (!confirm('are you sure?')) return;\r\n        const modId = this.modInternal.getModuleId(clip.item.className);\r\n        this.modInternal.delete(modId);\r\n    }\r\n\r\n    // todo: unsure if this is a good place for this bit of code...\r\n    move(oldClip: Selection, newClip: Selection /*, from: number, to: number*/): void {\r\n        const from = oldClip.index;\r\n        const to = newClip.index;\r\n        const modId = this.modInternal.getModuleId(oldClip.item.className);\r\n        const pane: string = this.modInternal.getPaneName(newClip.list);\r\n        this.modInternal.move(modId, pane, to);\r\n    }\r\n\r\n    isRealMove(oldClip: Selection, newClip: Selection): boolean {\r\n        const oldPane = this.modInternal.getPaneName(oldClip.list);\r\n        const newPane = this.modInternal.getPaneName(newClip.list);\r\n        return oldPane !== newPane || oldClip.index !== newClip.index;\r\n    }\r\n\r\n\r\n    showSendToPane(): void {\r\n        // debugger; // there is a bug where pane options are not updated when user clicks send to pane once, until that button is clicked again\r\n        // to reproduce: select module in header pane, click sendToPane. Now select module in content pane and notice panes list is showing panes for previous module\r\n        const quickE = QuickE.singleton();\r\n        const pane = QeSelectors.blocks.mod.findClosestList(quickE.main.activeModule);\r\n        // debugger; // breaks in inner content buttons, like Accordion App. Check if I can hide this button in inner content\r\n        if (!pane) return;\r\n\r\n        // show the pane-options\r\n        const pl = quickE.selected.querySelector<HTMLElement>('#paneList');\r\n        if (!pl.matches(':empty')) NoJQ.empty(pl);\r\n        pl.append(this.modInternal.getMoveButtons(this.modInternal.getPaneName(pane)));\r\n    }\r\n\r\n    static onModuleButtonClick() {\r\n        const _this = this as unknown as HTMLElement;\r\n        const type = _this.getAttribute('data-type');\r\n        const dnnMod = QuickE.singleton().main.activeModule;\r\n        const pane = QeSelectors.blocks.mod.findClosestList(dnnMod);\r\n        let index = 0;\r\n\r\n        if (dnnMod.classList.contains('DnnModule'))\r\n            index = Array.from(pane.querySelectorAll<HTMLElement>('.DnnModule')).indexOf(dnnMod) + 1;\r\n\r\n        const cbAction = _this.getAttribute('data-action');\r\n        if (cbAction)\r\n            return QuickEClipboard.singleton().do(cbAction, pane, index, QeSelectors.blocks.mod.id); // copy/paste\r\n        const modManage = QuickEClipboard.singleton().modDnn.modInternal;\r\n        return modManage.create(modManage.getPaneName(pane), index, type);\r\n    }\r\n}\r\n","import { ModifierDnnModule, QuickE, QuickEClipboard } from '.';\r\nimport { HasLog, NoJQ } from '../logging';\r\n\r\n// Important - for DNN it still uses #jquery\r\nconst dnnSF = (id?: number) => $.dnnSF(id);\r\n\r\n/**\r\n * module specific stuff\r\n */\r\nexport class ModifierDnnModuleInternal extends HasLog {\r\n\r\n    constructor(parent: ModifierDnnModule) {\r\n        super('QE.ModMng', parent.log);\r\n    }\r\n\r\n    /**\r\n     * Delete a module\r\n     */\r\n    delete(modId: number): Promise<any> {\r\n        const service = dnnSF(modId);\r\n        const tabId: number = service.getTabId();\r\n        return sendDnnAjax({\r\n            modId,\r\n            url: dnnSF().getServiceRoot('2sxc') + 'dnn/module/delete',\r\n            method: 'GET',\r\n            data: {\r\n                tabId: tabId,\r\n                modId: modId,\r\n            },\r\n            // ReSharper disable once UnusedParameter\r\n            success: () => window.location.reload(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new module\r\n     */\r\n    create(paneName: string, index: number, type: string): Promise<any> {\r\n        return sendDnnAjax({\r\n            modId: null,\r\n            url: dnnSF().getServiceRoot('internalservices') + 'controlbar/GetPortalDesktopModules',\r\n            method: 'GET',\r\n            data: 'category=All&loadingStartIndex=0&loadingPageSize=100&searchTerm=',\r\n            success: (desktopModules: ModuleInfo[]) => {\r\n                const moduleToFind: string = type === 'Default' ? ' Content' : ' App';\r\n                let module: ModuleInfo = null;\r\n\r\n                // ReSharper disable once UnusedParameter\r\n                desktopModules.forEach((e, i: number) => {\r\n                    if (e.ModuleName === moduleToFind)\r\n                        module = e;\r\n                });\r\n\r\n                return (!module)\r\n                    ? alert(moduleToFind + ' module not found.')\r\n                    : createMod(paneName, index, module.ModuleID);\r\n            },\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Move a DNN Module\r\n     */\r\n    move(modId: number, pane: string, order: number): void {\r\n        const service = dnnSF(modId);\r\n        const tabId = service.getTabId();\r\n        const dataVar = {\r\n            TabId: tabId,\r\n            ModuleId: modId,\r\n            Pane: pane,\r\n            ModuleOrder: (2 * order + 0),\r\n            // strange formula, copied from DNN https://github.com/dnnsoftware/Dnn.Platform/blob/fd225b8de07042837f7473cd49fba13de42a3cc0/Website/admin/Menus/ModuleActions/ModuleActions.js#L70\r\n            // stv: changed formula from: (2 * order + 4)\r\n            // ...to: (2 * order + 0)\r\n        };\r\n\r\n        sendDnnAjax({\r\n            modId,\r\n            url: dnnSF(modId).getServiceRoot('internalservices') + 'ModuleService/MoveModule',\r\n            method: 'POST',\r\n            data: dataVar,\r\n            success: () => window.location.reload(),\r\n        });\r\n    }\r\n\r\n    getPaneName(pane: HTMLElement): string {\r\n        return pane.getAttribute('id').replace('dnn_', '');\r\n    }\r\n\r\n    /**\r\n     * find the correct module id from a list of classes - used on the module-wrapper\r\n     */\r\n    getModuleId(classes: string): number | null {\r\n        const result = classes.match(/DnnModule-([0-9]+)(?:\\W|$)/);\r\n        return (result && result.length === 2) ? Number(result[1]) : null;\r\n    }\r\n\r\n    getMoveButtons(current: string): HTMLElement {\r\n        const pns = QuickE.singleton().cachedPanes;\r\n        // generate list of panes as links\r\n        const targets = NoJQ.domFromString('<div></div>')[0];\r\n        for (let p = 0; p < pns.length; p++) {\r\n            const pName: string = this.getPaneName(pns[p]);\r\n            const selected: string = (current === pName) ? ' selected ' : '';\r\n            if (selected === '') {\r\n                const target = NoJQ.domFromString(`<a data='${pName}'>${pName}</a>`)[0];\r\n                targets.append(target);\r\n            }\r\n        }\r\n\r\n        // attach click event...\r\n        const _this = this;\r\n        targets.querySelectorAll<HTMLElement>('a').forEach((e) => {\r\n            e.addEventListener('click', function () {\r\n                const link = this;\r\n                const clip = QuickEClipboard.singleton().clipboard;\r\n                const modId = _this.getModuleId(clip.item.className);\r\n                const newPane = link.getAttribute('data');\r\n                _this.move(modId, newPane, 0);\r\n            });\r\n        });\r\n\r\n        return targets;\r\n    }\r\n}\r\n\r\n// call an api on dnn\r\nfunction sendDnnAjax(req: DnnHttpRequest): Promise<any> {\r\n    // set DNN headers\r\n    const dnnHeaders: Record<string, string> = {};\r\n    const fakeXhr = {\r\n        setRequestHeader(name: string, value: string) {\r\n            dnnHeaders[name] = value;\r\n        },\r\n    } as JQueryXHR;\r\n    dnnSF(req.modId).setModuleHeaders(fakeXhr);\r\n\r\n    const settings: RequestInit = {\r\n        headers: {\r\n            'X-Requested-With': 'XMLHttpRequest',\r\n            ...dnnHeaders,\r\n        },\r\n        method: req.method,\r\n    };\r\n    let url = req.url;\r\n    if (req.data) {\r\n        switch (req.method) {\r\n            case 'GET':\r\n                url += typeof req.data === 'string' ? `?${req.data}` : `?${NoJQ.param(req.data)}`;\r\n                break;\r\n            case 'POST':\r\n                settings.body = new URLSearchParams(NoJQ.param(req.data));\r\n                (settings.headers as Record<string, string>)['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';\r\n                break;\r\n        }\r\n    }\r\n\r\n    const success = req.success;\r\n    return fetch(url, settings)\r\n        .then((response) => {\r\n            if (response.status >= 200 && response.status < 300) {\r\n                return response.text();\r\n            }\r\n            throw new Error(response.statusText);\r\n        })\r\n        .then((resText) => {\r\n            let resData: any;\r\n            try {\r\n                resData = JSON.parse(resText);\r\n            } catch {\r\n                resData = resText;\r\n            }\r\n            success?.(resData);\r\n            return resData;\r\n        })\r\n        .catch((err: Error) => {\r\n            alert(`Error while talking to server: ${err.message}`);\r\n            return undefined;\r\n        });\r\n}\r\n\r\n// create / insert a new module\r\nfunction createMod(paneName: string, position: number, modId: number): Promise<any> {\r\n    const postData = {\r\n        Module: modId,\r\n        Page: '',\r\n        Pane: paneName,\r\n        Position: -1,\r\n        Sort: position,\r\n        Visibility: 0,\r\n        AddExistingModule: false,\r\n        CopyModule: false,\r\n    };\r\n    return sendDnnAjax({\r\n        modId: null,\r\n        url: dnnSF().getServiceRoot('internalservices') + 'controlbar/AddModule',\r\n        method: 'POST',\r\n        data: postData,\r\n        success: () => window.location.reload(),\r\n    });\r\n}\r\n\r\ninterface ModuleInfo {\r\n    ModuleName: string;\r\n    ModuleID: number;\r\n}\r\n\r\ninterface DnnHttpRequest {\r\n    modId: number;\r\n    url: string;\r\n    method: 'GET' | 'POST';\r\n    data?: Record<string, any> | string;\r\n    success?: (data: any) => void;\r\n}\r\n","import { PositionCoordinates, QeSelectors, QuickE } from '.';\r\nimport { NoJQ } from '../plumbing';\r\nimport { ContextForLists } from './context-for-lists';\r\n\r\n/**\r\n * Module with everything related to positioning the quick-edit in-page editing\r\n */\r\nexport class Positioning {\r\n    static positionAndAlign = positionAndAlign;\r\n    static refresh = refresh;\r\n\r\n    /**\r\n     * Find the position of an element\r\n     */\r\n    static get(element: HTMLElement): PositionCoordinates {\r\n        const coords: PositionCoordinates = {\r\n            element: element,\r\n            x: NoJQ.offset(element).left,\r\n            w: NoJQ.width(element),\r\n            y: NoJQ.offset(element).top,\r\n            // For content-block ITEMS, the menu must be visible at the end\r\n            // For content-block-LISTS, the menu must be at top\r\n            yh: NoJQ.offset(element).top + (element.matches(QeSelectors.eitherCbOrMod) ? NoJQ.height(element) : 0),\r\n        };\r\n\r\n        return coords;\r\n    }\r\n\r\n    /**\r\n     * Prepare offset calculation based on body positioning\r\n     */\r\n    static getBodyPosition(): PositionCoordinates {\r\n        const posNoJq = document.body.style.position;\r\n        const bodyPos = posNoJq; // QuickE.body.css('position');\r\n        const quickE = QuickE.singleton();\r\n        return bodyPos === 'relative' || bodyPos === 'absolute'\r\n            ? new PositionCoordinates(NoJQ.offset(quickE.body).left, NoJQ.offset(quickE.body).top)\r\n            : new PositionCoordinates(0, 0);\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * Refresh content block and modules elements\r\n */\r\nfunction refreshDomObjects(): void {\r\n    // must update this, as sometimes after finishing page load the position changes, like when dnn adds the toolbar\r\n    const quickE = QuickE.singleton();\r\n    quickE.bodyOffset = Positioning.getBodyPosition();\r\n\r\n    if (quickE.config.innerBlocks.enable) {\r\n        // get all content-block lists which are empty, or which allow multiple child-items\r\n        const lists = QeSelectors.blocks.cb.findAllLists().filter((e) => e.matches(`:not(.${QeSelectors.blocks.cb.singleItem}), :empty`));\r\n        const children: HTMLElement[] = [];\r\n        lists.forEach((l) => {\r\n            children.push(...Array.from(l.querySelectorAll<HTMLElement>(QeSelectors.blocks.cb.selector)));\r\n        });\r\n        quickE.contentBlocks = [...lists, ...children];\r\n    }\r\n\r\n    if (quickE.config.modules.enable) {\r\n        const panes = quickE.cachedPanes;\r\n        const children: HTMLElement[] = [];\r\n        panes.forEach((p) => {\r\n            children.push(...Array.from(p.querySelectorAll<HTMLElement>(QeSelectors.blocks.mod.selector)));\r\n        });\r\n        quickE.modules = [...panes, ...children];\r\n    }\r\n}\r\n\r\n/**\r\n * Last time when contentblock and modules are refreshed.\r\n * Helps to skip unnecessary calls to refresh(e).\r\n */\r\nlet lastCall: Date;\r\n\r\n/**\r\n * position, align and show a menu linked to another item\r\n */\r\nfunction positionAndAlign(element: HTMLElement, coords: PositionCoordinates) {\r\n    const quickE = QuickE.singleton();\r\n    element.style.left = `${coords.x - quickE.bodyOffset.x}px`;\r\n    element.style.top = `${coords.yh - quickE.bodyOffset.y}px`;\r\n    element.style.width = `${NoJQ.width(coords.element)}px`;\r\n    element.style.display = 'block';\r\n    return element;\r\n}\r\n\r\n/**\r\n * Refresh positioning / visibility of the quick-insert bar\r\n * @param e\r\n */\r\nfunction refresh(e: MouseEvent) {\r\n    const highlightClass: string = 'sc-cb-highlight-for-insert';\r\n    const newDate = new Date();\r\n    if ((!lastCall) || (newDate.getTime() - lastCall.getTime() > 1000)) {\r\n        // console.log('refreshed contentblock and modules');\r\n        lastCall = newDate;\r\n        refreshDomObjects();\r\n    }\r\n\r\n    // find the closest content-blocks and modules\r\n    const currentCoords = new PositionCoordinates(e.clientX, e.clientY);\r\n    const quickE = QuickE.singleton();\r\n    if (quickE.config.innerBlocks.enable && quickE.contentBlocks)\r\n        quickE.nearestCb = findNearest(quickE.contentBlocks, currentCoords);\r\n    if (quickE.config.modules.enable && quickE.modules)\r\n        quickE.nearestMod = findNearest(quickE.modules, currentCoords);\r\n\r\n    // hide the buttons for content-block or module, if they are not affected\r\n    quickE.modActions.forEach((a) => {\r\n        a.classList.toggle('sc-invisible', quickE.nearestMod === null);\r\n    });\r\n    quickE.cbActions.forEach((a) => {\r\n        a.classList.toggle('sc-invisible', quickE.nearestCb === null);\r\n    });\r\n\r\n    const oldParent = quickE.main._parentNode;\r\n\r\n    if (quickE.nearestCb !== null || quickE.nearestMod !== null) {\r\n        const alignTo = quickE.nearestCb || quickE.nearestMod;\r\n\r\n        // find parent pane to highlight\r\n        const parentPane = QeSelectors.blocks.mod.findClosestList(alignTo.element);\r\n        const parentCbList = QeSelectors.blocks.cb.findClosestList(alignTo.element);\r\n        const parentContainer = parentCbList ?? parentPane;\r\n        provideCorrectAddButtons(parentContainer);\r\n        // put part of the pane-name into the button-labels\r\n        if (parentPane) {\r\n            let paneName: string = parentPane.getAttribute('id') || '';\r\n            if (paneName.length > 4) paneName = paneName.substr(4);\r\n            quickE.modActions.filter((a) => a.matches('[titleTemplate]')).forEach((a) => {\r\n                a.setAttribute('title', a.getAttribute('titleTemplate').replace('{0}', paneName));\r\n            });\r\n        }\r\n\r\n        positionAndAlign(quickE.main, alignTo);\r\n\r\n        // Keep current block as current on menu\r\n        quickE.main.activeContentBlock = quickE.nearestCb ? quickE.nearestCb.element : null;\r\n        quickE.main.activeModule = quickE.nearestMod ? quickE.nearestMod.element : null;\r\n        quickE.main._parentNode = parentContainer;\r\n        parentContainer.classList.add(highlightClass);\r\n    } else {\r\n        quickE.main._parentNode = null;\r\n        quickE.main.style.display = 'none';\r\n    }\r\n\r\n    // if previously a parent-pane was highlighted, un-highlight it now\r\n    if (oldParent && oldParent !== quickE.main._parentNode)\r\n        oldParent.classList.remove(highlightClass);\r\n}\r\n\r\nfunction provideCorrectAddButtons(tag: HTMLElement) {\r\n    const listSettings = ContextForLists.getFromDom(tag);\r\n    let showContent = true;\r\n    let showApps = true;\r\n    if (listSettings.appList.length > 0) {\r\n        showContent = listSettings.appList.indexOf('Content') > -1;\r\n        // only show apps if the list is longer than 'Content' if it contains that\r\n        showApps = listSettings.appList.length - (showContent ? 1 : 0) > 0;\r\n    }\r\n    QuickE.singleton().cbActions.forEach((a) => {\r\n        a.classList.toggle('hide-content', !showContent);\r\n        a.classList.toggle('hide-app', !showApps);\r\n    });\r\n}\r\n\r\n/**\r\n * Return the nearest element to the mouse cursor from elements\r\n * @param elements\r\n * @param position\r\n */\r\nfunction findNearest(elements: HTMLElement[], position: PositionCoordinates): PositionCoordinates {\r\n    const maxDistance: number = 30; // Defines the maximal distance of the cursor when the menu is displayed\r\n\r\n    let nearestItem: PositionCoordinates = null;\r\n    let nearestDistance = maxDistance;\r\n\r\n    const posX: number = position.x + window.scrollX;\r\n    const posY: number = position.y + window.scrollY;\r\n\r\n    // Find nearest element\r\n    elements.forEach((element) => {\r\n        const e = Positioning.get(element);\r\n\r\n        // First check x coordinates - must be within container\r\n        if (posX < e.x || posX > e.x + e.w)\r\n            return;\r\n\r\n        // Check if y coordinates are within boundaries\r\n        const distance = Math.abs(posY - e.yh);\r\n\r\n        if (distance < maxDistance && distance < nearestDistance) {\r\n            nearestItem = e;\r\n            nearestDistance = distance;\r\n        }\r\n    });\r\n\r\n    return nearestItem;\r\n}\r\n","import { ModifierBase, ModifierDnnModule, QeSelectors, QuickE, Selection } from '.';\r\nimport { HasLog, Insights, NoJQ } from '../logging';\r\nimport { ContextForLists } from './context-for-lists';\r\nimport { ModifierContentBlock } from './modifier-content-block';\r\n\r\n/**\r\n * add a clipboard to the quick edit\r\n */\r\nexport class QuickEClipboard extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): QuickEClipboard {\r\n        return this._singleton ?? (this._singleton = new QuickEClipboard());\r\n    }\r\n    private static _singleton: QuickEClipboard;\r\n\r\n    /**\r\n     * clipboard object - remembers what module (or content-block) was previously copied / needs to be pasted\r\n     */\r\n    clipboard = new Selection();\r\n\r\n    mods: { [key: string]: ModifierBase } = {};\r\n    modDnn: ModifierDnnModule;\r\n    modCb: ModifierContentBlock;\r\n\r\n    private constructor() {\r\n        super('Q-E.Clpbrd');\r\n        Insights.add('Q-E', 'clipboard', this.log);\r\n        this.mods.cb = this.modCb = new ModifierContentBlock();\r\n        this.mods.mod = this.modDnn = new ModifierDnnModule();\r\n\r\n        // initialize once the DOM is ready\r\n        NoJQ.ready(() => this.initializeSecondaryButtons());\r\n    }\r\n\r\n    /**\r\n     * bind clipboard actions to DOM buttons\r\n     */\r\n    initializeSecondaryButtons() {\r\n        const cl = this.log.call('initializeSecondaryButtons');\r\n        const qem = this;\r\n        QuickE.singleton().selected.querySelectorAll<HTMLElement>('a').forEach((e) => {\r\n            e.addEventListener('click', function () {\r\n                const action = this.getAttribute('data-action');\r\n                switch (action) {\r\n                    case 'delete': return qem.mods[qem.clipboard.type].delete(qem.clipboard);\r\n                    case 'sendToPane': return qem.modDnn.showSendToPane();\r\n                    default: throw new Error(`unexpected action: ${action}`);\r\n                }\r\n            });\r\n        });\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * perform copy and paste commands - needs the clipboard\r\n     * @param cbAction\r\n     * @param list\r\n     * @param domIndex\r\n     * @param type\r\n     */\r\n    do(cbAction: string, list: HTMLElement, domIndex: number, type: string): void {\r\n        const cl = this.log.call('do', `${cbAction}, ..., ${domIndex}`);\r\n        const newClip = this.createSpecs(type, list, domIndex);\r\n\r\n        // action!\r\n        switch (cbAction) {\r\n            case 'select':\r\n                this.mark(newClip);\r\n                break;\r\n\r\n            case 'paste':\r\n                const from = this.clipboard.index;\r\n                const to = newClip.index;\r\n                // check that we only move block-to-block or module to module\r\n                if (this.clipboard.type !== newClip.type)\r\n                    return alert(\"can't move module-to-block; move only works from module-to-module or block-to-block\");\r\n\r\n                if (isNaN(from) || isNaN(to)) return this.clearUi(); // skip, nothing real\r\n\r\n                const operator = newClip.type === QeSelectors.blocks.cb.id ? this.modCb : this.modDnn;\r\n\r\n                if (!operator.isRealMove(this.clipboard, newClip)) return this.clearUi(); // skip, no change\r\n                operator.move(this.clipboard, newClip);\r\n\r\n                this.clearUi();\r\n                break;\r\n            default:\r\n        }\r\n        return cl.return(null);\r\n    }\r\n\r\n\r\n    private mark(newData: Selection): void {\r\n        const cl = this.log.call('mark');\r\n        cl.data('specs', newData);\r\n\r\n        if (newData) {\r\n            // if it was already selected with the same thing, then release it\r\n            if (this.clipboard && this.clipboard.item === newData.item)\r\n                return cl.return(this.clearUi());\r\n            this.clipboard = newData;\r\n        }\r\n\r\n        this.removeSelectionMarker(); // clear previous markings\r\n\r\n        // sometimes missing data.item\r\n        if (!this.clipboard.item) return cl.done();\r\n\r\n        const selectedItem = this.clipboard.item;\r\n        selectedItem.classList.add(QeSelectors.selected);\r\n        if (selectedItem.previousElementSibling?.matches('iframe'))\r\n            selectedItem.previousElementSibling.classList.add(QeSelectors.selected);\r\n        this.setSecondaryActionsState(true);\r\n        const quickE = QuickE.singleton();\r\n        const btnConfig = this.clipboard?.type === QeSelectors.blocks.cb.id\r\n            ? quickE.config.innerBlocks.buttons\r\n            : quickE.config.modules.buttons;\r\n        quickE.selected.toggleOverlay(selectedItem, btnConfig);\r\n        cl.done();\r\n    }\r\n\r\n    /** Clear the UI so nothing is selected any more */\r\n    private clearUi(): void {\r\n        const cl = this.log.call('clearUi');\r\n        this.removeSelectionMarker();\r\n        this.clipboard = null;\r\n        this.setSecondaryActionsState(false);\r\n        QuickE.singleton().selected.toggleOverlay(false);\r\n        cl.done();\r\n    }\r\n\r\n\r\n    private removeSelectionMarker() {\r\n        document.querySelectorAll<HTMLElement>(`.${QeSelectors.selected}`).forEach((s) => s.classList.remove(QeSelectors.selected));\r\n    }\r\n\r\n    private setSecondaryActionsState(state: boolean): void {\r\n        const cl = this.log.call('setSecondaryActionsState');\r\n        let btns = Array.from(document.querySelectorAll<HTMLElement>('a.sc-content-block-menu-btn'));\r\n        btns = btns.filter((btn) => btn.classList.contains('icon-sxc-paste'));\r\n        btns.forEach((btn) => btn.classList.toggle('sc-unavailable', !state));\r\n        cl.done();\r\n    }\r\n\r\n\r\n    private createSpecs(type: string, list: HTMLElement, domIndex: number): Selection {\r\n        const cl = this.log.call('createSpecs', `${type}, ..., ${domIndex}`);\r\n        const listItems = list.querySelectorAll<HTMLElement>(QeSelectors.blocks[type].selector);\r\n        // when paste module below the last module in pane\r\n        // index is 1 larger than the length, then select last\r\n        const currentItem: HTMLElement = (domIndex >= listItems.length)\r\n            ? listItems[listItems.length - 1]\r\n            : listItems[domIndex];\r\n\r\n        // get info what item/block is being edited\r\n        const contextInfo = ContextForLists.getFromDom(list) || {\r\n            parent: 'dnn',\r\n            field: list.id,\r\n            parentGuid: null as string,\r\n        };\r\n        return cl.return({\r\n            parent: contextInfo.parent,\r\n            parentGuid: contextInfo.parentGuid,\r\n            field: contextInfo.field,\r\n            list: list,\r\n            item: currentItem,\r\n            index: domIndex,\r\n            type: type,\r\n        } as Selection);\r\n    }\r\n\r\n}\r\n","/**\r\n * selectors used all over the in-page-editing, centralized to ensure consistency\r\n */\r\n\r\nconst contentBlockAndModuleSelectors: { [key: string]: CbOrMod } = {\r\n    cb: {\r\n        id: 'cb',\r\n        class: 'sc-content-block',\r\n        selector: '.sc-content-block',\r\n        findAllLists: () => Array.from(document.querySelectorAll<HTMLElement>('.sc-content-block-list')),\r\n        findClosestList: (element: HTMLElement) => element.closest<HTMLElement>('.sc-content-block-list'),\r\n        context: 'data-list-context',\r\n        singleItem: 'single-item',\r\n    },\r\n    mod: {\r\n        id: 'mod',\r\n        class: 'DnnModule',\r\n        selector: '.DnnModule',\r\n        // Found no better way to get all panes - the hidden variable does not exist when not in edit page mode\r\n        findAllLists: () => {\r\n            // jquery :has selector (https://api.jquery.com/has-selector/) is not a compatible with css selector\r\n            // and doesn't work without jquery (https://developer.mozilla.org/en-US/docs/Web/CSS/:has)\r\n            // and has absolutely terrible performance (380-560 ms)\r\n            // $('.DNNEmptyPane, .dnnDropEmptyPanes, :has(>.DnnModule)')\r\n\r\n            // compact javascript solution is still very slow (10-15 ms)\r\n            // Array.from(document.querySelectorAll('*')).filter((e) => e.matches('.DNNEmptyPane, .dnnDropEmptyPanes') || Array.from(e.children).some((c) => c.matches('.DnnModule')))\r\n\r\n            // as fast as can be (3-5 ms)\r\n            const found: HTMLElement[] = [];\r\n            const all = document.querySelectorAll<HTMLElement>('*');\r\n            for (let i = 0; i < all.length; i++) {\r\n                const el = all[i];\r\n                if (el.matches('.DNNEmptyPane, .dnnDropEmptyPanes')) {\r\n                    found.push(el);\r\n                    continue;\r\n                }\r\n                const children = el.children;\r\n                for (let j = 0; j < children.length; j++) {\r\n                    const child = children[j];\r\n                    if (child.matches('.DnnModule')) {\r\n                        found.push(el);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return found;\r\n        },\r\n        findClosestList: (element: HTMLElement) => {\r\n            if (!element) return null;\r\n            if (element.matches('.DNNEmptyPane, .dnnDropEmptyPanes')) {\r\n                return element;\r\n            }\r\n            for (let i = 0; i < element.children.length; i++) {\r\n                const child = element.children[i];\r\n                if (child.matches('.DnnModule')) {\r\n                    return element;\r\n                }\r\n            }\r\n            return contentBlockAndModuleSelectors.mod.findClosestList(element.parentElement);\r\n        },\r\n        context: null,\r\n    },\r\n};\r\n\r\nexport const QeSelectors = {\r\n    blocks: contentBlockAndModuleSelectors,\r\n    eitherCbOrMod: '.DnnModule, .sc-content-block',\r\n    selected: 'sc-cb-is-selected',\r\n};\r\n\r\n\r\n/**\r\n * Structure for constants in the selectors, to guarantee we got everything\r\n */\r\ninterface CbOrMod {\r\n    id: string;\r\n    class: string;\r\n    selector: string;\r\n    findAllLists: () => HTMLElement[];\r\n    findClosestList: (element: HTMLElement) => HTMLElement;\r\n    context: string;\r\n    singleItem?: string;\r\n}\r\n","// must come first because we're still relying on build order\r\nexport * from './selection';\r\nexport * from './modifier-base';\r\n\r\nexport * from './quick-e-overlays';\r\nexport * from './quick-e-configuration';\r\n\r\nexport * from './modifier-content-block';\r\nexport * from './position-coordinates';\r\nexport * from './modifier-dnn-module';\r\nexport * from './modifier-dnn-module-internal';\r\nexport * from './positioning';\r\nexport * from './quick-e';\r\nexport * from './quick-e-clipboard';\r\nexport * from './selectors-instance';\r\n\r\nconst css = require('./quickE.css');","import { ModifierContentBlock, ModifierDnnModule, PositionCoordinates, Positioning, QeSelectors, QuickEditConfig, QuickEditOverlay } from '.';\r\nimport { HasLog, Insights, NoJQ } from '../logging';\r\n\r\nconst configAttr: string = 'quick-edit-config';\r\nconst classForAddContent = 'sc-content-block-menu-addcontent';\r\nconst classForAddApp = 'sc-content-block-menu-addapp';\r\n\r\n/**\r\n * the quick-edit object\r\n * the quick-insert object\r\n */\r\nexport class QuickE extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): QuickE {\r\n        return this._singleton ?? (this._singleton = new QuickE());\r\n    }\r\n    private static _singleton: QuickE;\r\n\r\n\r\n    body = document.body;\r\n    main = NoJQ.domFromString('<div class=\"sc-content-block-menu sc-content-block-quick-insert sc-i18n\"></div>')[0] as QuickEditOverlay.Main;\r\n    template =\r\n        `<a class='${classForAddContent} sc-invisible' data-type='Default' data-i18n='[titleTemplate]QuickInsertMenu.AddBlockContent'>&nbsp;</a>`\r\n        + `<a class='${classForAddApp} sc-invisible' data-type='' data-i18n='[titleTemplate]QuickInsertMenu.AddBlockApp'>&nbsp;</a>`\r\n        + `${QuickEditOverlay.btn('select', 'ok', 'Select', true)}${QuickEditOverlay.btn('paste', 'paste', 'Paste', true, true)}`;\r\n    selected = QuickEditOverlay.selectedOverlay;\r\n    // will be populated later in the module section\r\n    contentBlocks: HTMLElement[] = null;\r\n    cachedPanes: HTMLElement[] = null;\r\n    modules: HTMLElement[] = null;\r\n    nearestCb: PositionCoordinates = null;\r\n    nearestMod: PositionCoordinates = null;\r\n    // add stuff which depends on other values to create\r\n    cbActions = NoJQ.domFromString(this.template);\r\n    modActions = NoJQ.domFromString(this.template.replace(/QuickInsertMenu.AddBlock/g, 'QuickInsertMenu.AddModule')).map((a) => {\r\n        a.setAttribute('data-context', 'module');\r\n        a.classList.add('sc-content-block-menu-module');\r\n        return a;\r\n    });\r\n\r\n    //\r\n    config = QuickEditConfig.getNewDefaultConfig();\r\n\r\n    bodyOffset: PositionCoordinates;\r\n\r\n    private constructor() {\r\n        super('Q-E.Main');\r\n        Insights.add('Q-E', 'manager', this.log);\r\n        this.modActions.forEach((a) => {\r\n            a.addEventListener('click', ModifierDnnModule.onModuleButtonClick);\r\n        });\r\n        this.cbActions.forEach((a) => {\r\n            a.addEventListener('click', ModifierContentBlock.onCbButtonClick);\r\n        });\r\n    }\r\n\r\n    start(): void {\r\n        try {\r\n            this.loadPageConfig();\r\n            if (this.config.enable) {\r\n                // initialize first body-offset\r\n                this.bodyOffset = Positioning.getBodyPosition();\r\n                this.enable();\r\n                this.initWatchMouse();\r\n            }\r\n        } catch (e) {\r\n            console.error(\"couldn't start quick-edit\", e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * reset the quick-edit\r\n     * for example after ajax-loading a content-block, which may cause changed configurations\r\n     */\r\n    reset(): void {\r\n        const cl = this.log.call('reset');\r\n        this.loadPageConfig();\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * This checks if the page has any alternate configuration\r\n     * Note that it's also used after ajax refreshes, which can change the config\r\n     * So if it does reconfigure itself, it will start with the default config again\r\n     */\r\n    loadPageConfig() {\r\n        const cl = this.log.call('loadPageConfig', null, null, { config: this.config });\r\n        this.logConfig();\r\n        const configs = document.querySelectorAll<HTMLElement>(`[${configAttr}]`);\r\n        let confJ: string;\r\n\r\n        if (configs.length > 0) {\r\n            cl.add('found configs', configs);\r\n            // go through reverse list, as the last is the most important...\r\n            let finalConfig = {} as QuickEditConfig.FullConfig;\r\n            for (let c = configs.length; c >= 0; c--) {\r\n                // 2021-09-17 spm either the loop is wrong and we should only get configs[0] or we should be gettings configs[c]\r\n                confJ = configs[0].getAttribute(configAttr);\r\n                try {\r\n                    const confO = JSON.parse(confJ) as Partial<QuickEditConfig.FullConfig>;\r\n                    cl.data('additional config', confO);\r\n                    finalConfig = { ...finalConfig, ...confO };\r\n                    cl.data('merged config', finalConfig);\r\n                } catch (e) {\r\n                    cl.add('had trouble with json');\r\n                    console.warn('had trouble with json', e);\r\n                }\r\n            }\r\n            const defConfig = QuickEditConfig.getNewDefaultConfig();\r\n            this.config = { ...defConfig, ...finalConfig, buttons: { ...defConfig.buttons, ...finalConfig.buttons } };\r\n        } else\r\n            cl.add('no configs found, will use exiting');\r\n\r\n        // expand/merge configs on the sub-nodes module/block\r\n        this.config.innerBlocks.buttons = { ...this.config?.buttons, ...this.config?.innerBlocks?.buttons };\r\n        this.config.modules.buttons = { ...this.config?.buttons, ...this.config?.modules?.buttons };\r\n\r\n        this.logConfig();\r\n\r\n        this.detectWhichMenusToActivate();\r\n\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * existing inner blocks found? Will affect if modules can be quick-inserted...\r\n     */\r\n    private detectWhichMenusToActivate() {\r\n        const conf = this.config;\r\n        const cl = this.log.call('detectWhichMenusToActivate');\r\n        const innerCBs = QeSelectors.blocks.cb.findAllLists();\r\n        const hasInnerCBs = (innerCBs.length > 0);\r\n        cl.add(`has Content Blocks: ${hasInnerCBs}`, innerCBs);\r\n        // if it has inner-content, then it's probably a details page, where quickly adding modules would be a problem, so for now, disable modules in this case\r\n        if (conf.modules.enable === null || conf.modules.enable === 'auto')\r\n            conf.modules.enable = !hasInnerCBs;\r\n        // for now, ContentBlocks are only enabled if they exist on the page\r\n        if (conf.innerBlocks.enable === null || conf.innerBlocks.enable === 'auto')\r\n            conf.innerBlocks.enable = hasInnerCBs;\r\n        cl.add(`module.enable: ${conf.modules.enable}`);\r\n        cl.add(`innerBlocks.enable: ${conf.innerBlocks.enable}`);\r\n        cl.done();\r\n    }\r\n\r\n    private enable(): void {\r\n        const cl = this.log.call('enable');\r\n        // build all toolbar html-elements\r\n        this.prepareToolbarInDom();\r\n\r\n        // Cache the panes (because panes can't change dynamically)\r\n        this.initPanes();\r\n        cl.done();\r\n    }\r\n\r\n    prepareToolbarInDom(): void {\r\n        const cl = this.log.call('prepareToolbarInDom');\r\n        this.body.append(this.main);\r\n        this.body.append(this.selected);\r\n        this.cbActions.forEach((a) => this.main.append(a));\r\n        this.modActions.forEach((a) => this.main.append(a));\r\n\r\n        // use config to enable/disable some buttons\r\n        QuickEditOverlay.setButtonActivationClasses(this.config.innerBlocks.buttons, this.cbActions);\r\n        QuickEditOverlay.setButtonActivationClasses(this.config.modules.buttons, this.modActions);\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * cache the panes which can contain modules\r\n     */\r\n    private initPanes(): void {\r\n        const cl = this.log.call('initPanes');\r\n        this.cachedPanes = QeSelectors.blocks.mod.findAllLists();\r\n        this.cachedPanes.forEach((pane) => {\r\n            pane.classList.add('sc-cb-pane-glow');\r\n        });\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * start watching for mouse-move\r\n     */\r\n    private initWatchMouse() {\r\n        const cl = this.log.call('initWatchMouse');\r\n        let refreshTimeout: number = null;\r\n        document.body.addEventListener('mousemove', (e) => {\r\n            if (refreshTimeout === null)\r\n                refreshTimeout = window.setTimeout(() => {\r\n                    requestAnimationFrame(() => {\r\n                        Positioning.refresh(e);\r\n                        refreshTimeout = null;\r\n                    });\r\n                },\r\n                    20);\r\n        });\r\n        cl.done();\r\n    }\r\n\r\n    private logConfig() {\r\n        this.log.add(`config enabled: ${this.config.enable}, mod: ${this.config.modules.enable}, cb: ${this.config.innerBlocks.enable}. ${JSON.stringify(this.config)})`);\r\n    }\r\n\r\n}\r\n","import { C } from '../constants/index';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HtmlTools } from '../html/dom-tools';\r\nimport { HasLog, Insights } from '../logging';\r\nimport { renderer } from './render';\r\n\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiRender = 'cms/block/render';\r\nconst webApiSave = 'cms/block/template';\r\n//#endregion\r\n\r\nexport class ContentBlockEditor extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): ContentBlockEditor {\r\n        return this._singleton ?? (this._singleton = new ContentBlockEditor());\r\n    }\r\n    private static _singleton: ContentBlockEditor;\r\n\r\n\r\n    private constructor() {\r\n        super('Sys.CbEdit');\r\n        Insights.add('system', 'cb-editor-api', this.log);\r\n    }\r\n\r\n\r\n    /**\r\n     * prepare the instance so content can be added\r\n     * this ensure the content-group has been created, which is required to add content\r\n     * @param {ContextComplete} context\r\n     */\r\n    prepareToAddContent(context: ContextComplete, useModuleList: boolean): Promise<string | void> {\r\n        const cl = this.log.call('prepareToAddContent');\r\n        const isCreated: boolean = context.contentBlock.isCreated;\r\n        if (isCreated || !useModuleList)\r\n            return cl.return(Promise.resolve());\r\n\r\n        // persist the template\r\n        const promise = this.updateTemplate(context, context.contentBlock.templateId, true);\r\n        return cl.return(promise, 'ok');\r\n    }\r\n\r\n\r\n    /**\r\n     * Update the template and adjust UI accordingly.\r\n     * @param {ContextComplete} context\r\n     * @param {number} templateId\r\n     * @param {boolean} forceCreate\r\n     */\r\n    updateTemplateFromDia(context: ContextComplete, templateId: number): Promise<void> {\r\n        const cl = this.log.call('updateTemplateFromDia', `..., ${templateId}`);\r\n        const wasShowingPreview = HtmlTools.isDisabled(context.sxc);\r\n        cl.add(`wasShowingPreview: ${wasShowingPreview}`);\r\n        const promise = this.updateTemplate(context, templateId, false)\r\n            .then(() => {\r\n                // only reload on ajax, not on app as that was already re-loaded on the preview\r\n                // necessary to show the original template again\r\n                if (wasShowingPreview) renderer.reloadAndReInitialize(context);\r\n            });\r\n        return cl.return(promise);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Retrieve the preview from the web-api\r\n     * @param {ContextComplete} context\r\n     * @param {number} templateId\r\n     * @returns {promise} promise with the html in the result\r\n     */\r\n    getPreviewWithTemplate(context: ContextComplete, templateId: number): Promise<string> {\r\n        const cl = this.log.call('getPreviewWithTemplate', `..., ${templateId}`);\r\n        templateId = templateId || C.ContentBlock.UseExistingTemplate; // fallback, meaning use saved ID\r\n        const params: WebApiParams = {\r\n            templateId: templateId,\r\n            lang: context.app.currentLanguage,\r\n            cbid: context.contentBlockReference.id,\r\n            originalparameters: JSON.stringify(context.instance.parameters),\r\n        };\r\n        cl.data('params', params);\r\n        const promise = context.sxc.webApi.fetch(context.sxc.webApi.url(webApiRender, params))\r\n            .then((response) => response.text());\r\n        return cl.return(promise);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Update the template.\r\n     */\r\n    private updateTemplate(context: ContextComplete, templateId: number, forceCreate: boolean): Promise<string | void> {\r\n        const cl = this.log.call('updateTemplate');\r\n        const promise = this.saveTemplate(context, templateId, forceCreate)\r\n            .then((data) => {\r\n                if (!data) return null;\r\n\r\n                // fixes a special case where the guid is given with quotes (depends on version of angularjs) issue #532\r\n                const newGuid = data.replace(/[\\\",\\']/g, '');\r\n\r\n                if (console)\r\n                    console.log(`created content group {${newGuid}}`);\r\n\r\n                return context.contentBlock.contentGroupId = newGuid;\r\n            }).catch(() => {\r\n                // error handling\r\n                return alert('error - result not ok, was not able to create ContentGroup');\r\n            });\r\n        return cl.return(promise);\r\n    }\r\n\r\n\r\n    /**\r\n     * Save the template configuration for this instance\r\n     * @param {ContextComplete} context\r\n     * @param {number} templateId\r\n     * @param {boolean} [forceCreateContentGroup]\r\n     * @returns {promise}\r\n     */\r\n    private saveTemplate(context: ContextComplete, templateId: number, forceCreateContentGroup: boolean): Promise<string> {\r\n        const cl = this.log.call('saveTemplate');\r\n        const params: WebApiParams = {\r\n            templateId: templateId,\r\n            forceCreateContentGroup: forceCreateContentGroup,\r\n            newTemplateChooserState: false,\r\n        };\r\n        cl.data('params', params);\r\n        const promise = context.sxc.webApi.fetchJson(context.sxc.webApi.url(webApiSave, params), undefined, 'POST');\r\n        return cl.return(promise);\r\n    }\r\n\r\n}\r\n\r\n\r\ninterface WebApiParams {\r\n    templateId?: number;\r\n    lang?: string;\r\n    cbisentity?: boolean;\r\n    cbid?: number;\r\n    originalparameters?: string;\r\n    forceCreateContentGroup?: boolean;\r\n    newTemplateChooserState?: boolean;\r\n    zoneId?: number;\r\n    appId?: number;\r\n    v2?: boolean;\r\n}\r\n","import { SpecialCommands } from '../commands';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { HtmlTools } from '../html/dom-tools';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { windowInPage as window } from '../interfaces/window-in-page';\r\nimport { AssetsLoader, HasLog, Insights, NoJQ } from '../logging';\r\nimport { QuickE } from '../quick-edit/quick-e';\r\nimport { WorkflowArguments, WorkflowHelper, WorkflowPhases } from '../workflow';\r\nimport { ContentBlockEditor } from './content-block-editor';\r\n\r\n/**\r\n * This is the rendering compontent, responsible to update the page when something changes.\r\n * Depending on the feature-set it will use ajax or not\r\n */\r\nclass RendererGlobal extends HasLog {\r\n\r\n    constructor() {\r\n        super('Rnd.Rndrer');\r\n        Insights.add('system', 'renderer', this.log);\r\n    }\r\n\r\n    /**\r\n     * Show a message where the content of a module should be - usually as placeholder till something else happens\r\n     * @param {ContextComplete} context\r\n     * @param {string} newContent\r\n     * @returns {} nothing\r\n     */\r\n    showMessage(context: ContextComplete, newContent: string): void {\r\n        SxcEdit.getTag(context.sxc).innerHTML = newContent;\r\n    }\r\n\r\n\r\n    /**\r\n     * this one assumes a replace / change has already happened, but now must be finalized...\r\n     * @param {ContextComplete} context\r\n     * @param {boolean} forceAjax\r\n     * @param {boolean} preview\r\n     */\r\n    reloadAndReInitialize(context: ContextComplete, forceAjax?: boolean, preview?: boolean): Promise<void> {\r\n        const cl = this.log.call('reloadAndReInitialize', `..., forceAjax: ${forceAjax}, preview: ${preview}`, null, { context: context });\r\n\r\n        // get workflow engine or a dummy engine\r\n        const wf = context.commandWorkflow ?? WorkflowHelper.getDummyManager();\r\n        const promiseChain = wf.run(new WorkflowArguments(SpecialCommands.refresh, WorkflowPhases.before, context));\r\n\r\n        // 2021-02-21 2dm New in 11.12 enable toolbar to not reload in a SPA scenario\r\n        const finalPromise = promiseChain.then((wfArgs) => {\r\n            if (WorkflowHelper.isCancelled(wfArgs)) {\r\n                cl.add('Workflow return false, will cancel and not refresh.');\r\n                return Promise.resolve();\r\n            }\r\n\r\n            // if ajax is not supported, we must reload the whole page\r\n            if (!forceAjax && !context.app.supportsAjax) {\r\n                cl.done('not ajax - reloading page');\r\n                window.location.reload();\r\n                return Promise.resolve();\r\n            }\r\n\r\n            cl.add('is ajax, calling ajaxReload');\r\n            return this.ajaxLoad(context, C.ContentBlock.UseExistingTemplate, preview)\r\n                .then((result) => {\r\n                    // If Evoq, tell Evoq that page has changed if it has changed (Ajax call)\r\n                    if (window.dnn_tabVersioningEnabled) { // this only exists in evoq or on new DNNs with tabVersioning\r\n                        cl.add('system is using tabVersioning - will inform DNN');\r\n                        try {\r\n                            window.dnn.ContentEditorManager.triggerChangeOnPageContentEvent();\r\n                        } catch (e) { /* ignore */ }\r\n                    }\r\n                    return cl.return(result);\r\n                })\r\n                .catch((error) => console.log('Error in reloadAndReInitialize', error));\r\n        });\r\n\r\n        return finalPromise;\r\n    }\r\n\r\n    /**\r\n     * ajax-call, then replace\r\n     * @param {ContextComplete} context\r\n     * @param {number} alternateTemplateId\r\n     * @param {boolean} justPreview\r\n     */\r\n    ajaxLoad(context: ContextComplete, alternateTemplateId: number, justPreview: boolean): Promise<void> {\r\n        const cl = this.log.call('ajaxLoad');\r\n        cl.add('starting promise chain');\r\n        return ContentBlockEditor.singleton().getPreviewWithTemplate(context, alternateTemplateId)\r\n            .then((result: string) => {\r\n                cl.add(\"get preview done, let's replace the content\");\r\n                this.replaceContentBlock(context, result, justPreview);\r\n            })\r\n            .then(() => {\r\n                cl.add('replace done, resetting quickE');\r\n                QuickE.singleton().reset(); // reset quick-edit, because the config could have changed\r\n                cl.done();\r\n            });\r\n    }\r\n\r\n\r\n    /**\r\n     * ajax update/replace the content of the content-block\r\n     * optionally also initialize the toolbar (if not just preview)\r\n     * @param {ContextComplete} context\r\n     * @param {string} newContent\r\n     * @param {boolean} justPreview\r\n     */\r\n    private replaceContentBlock(context: ContextComplete, newContent: string, justPreview: boolean): void {\r\n        const cl = this.log.call('replaceContentBlock');\r\n        try {\r\n            try {\r\n                const newContentObj = JSON.parse(newContent) as ContentBlockReplacement;\r\n                const newHeadHtml = newContentObj.Resources\r\n                    .map((resource) => {\r\n                        if (resource.Type === 'js') {\r\n                            return `<script type=\"text/javascript\" src=\"${resource.Url}\"></script>`;\r\n                        }\r\n                        if (resource.Type === 'css') {\r\n                            return `<link rel=\"stylesheet\" href=\"${resource.Url}\">`;\r\n                        }\r\n                    })\r\n                    .filter((resource) => resource != null)\r\n                    .join('\\n');\r\n                const newHead = NoJQ.domFromString(newHeadHtml);\r\n                const newDom = NoJQ.domFromString(newContentObj.Html)[0];\r\n\r\n                NoJQ.append(document.head, newHead, false);\r\n                // Must disable toolbar before we attach to DOM\r\n                if (justPreview) HtmlTools.disable(newDom);\r\n                NoJQ.replaceWith(SxcEdit.getTag(context.sxc), newDom, false);\r\n\r\n                // run scripts manually to ensure proper timing\r\n                const scripts = [\r\n                    ...newHead.filter((asset) => asset.tagName.toLocaleLowerCase() === 'script'),\r\n                    ...Array.from(newDom.querySelectorAll('script')),\r\n                ] as HTMLScriptElement[];\r\n                AssetsLoader.runScripts(scripts, undefined);\r\n            } catch {\r\n                const newDom = NoJQ.domFromString(newContent)[0];\r\n\r\n                // Must disable toolbar before we attach to DOM\r\n                if (justPreview) HtmlTools.disable(newDom);\r\n                NoJQ.replaceWith(SxcEdit.getTag(context.sxc), newDom, true);\r\n            }\r\n\r\n            // reset the cache, so the sxc-object is refreshed\r\n            context.sxc.recreate(true);\r\n        } catch (e) {\r\n            console.log('Error while rendering template:', e);\r\n        }\r\n        cl.done();\r\n    }\r\n}\r\n\r\n\r\n\r\nexport const renderer = new RendererGlobal();\r\n\r\ninterface ContentBlockReplacement {\r\n    Html: string;\r\n    Resources: ContentBlockResource[];\r\n}\r\n\r\ninterface ContentBlockResource {\r\n    Contents: null;\r\n    Id: null;\r\n    Type: 'js' | 'css';\r\n    Url: string;\r\n}\r\n","import { renderer } from '../../contentBlock/render';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { TypeUnsafe } from '../../plumbing/TypeTbD';\r\nimport { ContentListActionParams } from './content-list-action-params';\r\n\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiAdd = 'cms/block/item';\r\nconst webApiRemoveFromList = 'cms/list/delete';\r\nconst webApiReorder = 'cms/list/move';\r\nconst webApiItemPublish = 'cms/item/publish';\r\nconst webApiBlockPublish = 'cms/block/publish';\r\n//#endregion\r\n\r\n/**\r\n * These actions make changes to a content-block - like adding, removing or publishing items in the block\r\n * @class ActionsCatalog\r\n */\r\nclass ContentListActions {\r\n    /**\r\n     * add an item to the list at this position\r\n     * @param {ContextComplete} context\r\n     * @param {number} index\r\n     */\r\n    addItem<T>(context: ContextComplete, index: number) {\r\n        return doAndReload<T>(context, webApiAdd, { index }, 'post');\r\n    }\r\n\r\n    /**\r\n     * remove an item from a list, then reload\r\n     * @param {ContextComplete} context\r\n     * @param {number} sortOrder\r\n     */\r\n    removeFromList(context: ContextComplete) {\r\n        const params = context.button.command.params;\r\n        return doAndReload<void>(context, webApiRemoveFromList, {\r\n            index: params.sortOrder,\r\n            parent: params.parent,\r\n            fields: params.fields,\r\n        }, 'delete');\r\n    }\r\n\r\n    /**\r\n     * change the order of an item in a list, then reload\r\n     * @param {ContextComplete} context\r\n     * @param {number} index\r\n     * @param {number} toIndex\r\n     */\r\n    changeOrder(context: ContextComplete, index: number, toIndex: number) {\r\n        const params = context.button.command.params;\r\n        return doAndReload<void>(context, webApiReorder, {\r\n            parent: params.parent,\r\n            fields: params.fields,\r\n            index,\r\n            toIndex,\r\n        }, 'post');\r\n    }\r\n\r\n    /**\r\n     * set a content-item in this block to published, then reload\r\n     * @param {ContextComplete} context\r\n     * @param {string} part\r\n     * @param {number} index\r\n     */\r\n    publish(context: ContextComplete, part: string, index: number) {\r\n        return doAndReload<void>(context, webApiBlockPublish, {\r\n            part,\r\n            index,\r\n        }, 'post');\r\n    }\r\n\r\n    /**\r\n     * publish an item using it's ID\r\n     * @param {ContextComplete} context\r\n     * @param {number} entityId\r\n     */\r\n    publishId(context: ContextComplete, entityId: number) {\r\n        return doAndReload<void>(context, webApiItemPublish,\r\n            { id: entityId },\r\n            'post');\r\n    }\r\n}\r\n\r\nexport const Actions = new ContentListActions();\r\n\r\n/*\r\n * this is a content block in the browser\r\n *\r\n * A Content Block is a stand alone unit of content, with it's own definition of\r\n * 1. content items\r\n * 2. template\r\n * + some other stuff\r\n *\r\n * it should be able to render itself\r\n */\r\n\r\n/**\r\n * internal helper, to do something and reload the content block\r\n * @param {ContextComplete} context\r\n * @param {string} url\r\n * @param {ContentListActionParams} params\r\n * @returns {void | T}\r\n */\r\nfunction doAndReload<T>(\r\n    context: ContextComplete,\r\n    url: string,\r\n    params: ContentListActionParams,\r\n    verb: 'get' | 'post' | 'delete' = 'get',\r\n    postData: TypeUnsafe = {},\r\n): Promise<void | T> {\r\n    return (verb === 'post'\r\n        ? context.sxc.webApi.fetch(context.sxc.webApi.url(url, params), postData, 'POST')\r\n        : verb === 'delete'\r\n            ? context.sxc.webApi.fetch(context.sxc.webApi.url(url, params), undefined, 'DELETE')\r\n            : context.sxc.webApi.fetchJson(context.sxc.webApi.url(url, params)))\r\n        .then(() => {\r\n            renderer.reloadAndReInitialize(context);\r\n        });\r\n}\r\n","import { Commands } from '..';\r\nimport { Actions } from './content-list-actions';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\nexport const CmdAdd = 'add';\r\n/**\r\n * add brings no dialog, just add an empty item\r\n *\r\n * import this module to commands.ts\r\n */\r\nCommands.add(\r\n    CmdAdd,\r\n    'AddDemo',\r\n    'plus-circled',\r\n    false,\r\n    true,\r\n    {\r\n        showCondition: (context) => SharedLogic.isList(context),\r\n        code(context) {\r\n            return Actions.addItem(context, context.button.command.params.sortOrder + 1);\r\n        },\r\n    },\r\n);\r\n","import { Commands } from '..';\r\nimport { ItemIdentifierGroup } from '../../interfaces/item-identifiers';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\nexport const CmdAddExisting = 'add-existing';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdAddExisting, 'AddExisting', 'add-existing', false, true, {\r\n    dialog: (_) => 'replace',\r\n\r\n    showCondition(context) {\r\n        return SharedLogic.isList(context);\r\n    },\r\n\r\n    configureLinkGenerator: (context, linkGenerator) => {\r\n        if (SharedLogic.isFieldList(context)) {\r\n            const params = context.button.command.params;\r\n            linkGenerator.items = [{ Group: {\r\n                Guid: params.parent,\r\n                Part: params.fields,\r\n                Index: params.sortOrder + 1,\r\n                Add: true,\r\n            }}];\r\n        } else if (SharedLogic.isPartOfBlockList(context)) {\r\n            const topItem = linkGenerator.items[0] as ItemIdentifierGroup;\r\n            topItem.Group.Add = true;\r\n            topItem.Group.Index++;\r\n            linkGenerator.items = [topItem];\r\n        }\r\n    },\r\n});\r\n","import { Commands } from '..';\r\n\r\nexport const CmdAppImport = 'app-import';\r\n/**\r\n * open the import dialog\r\n *\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdAppImport, 'Dashboard', '', true, false, {});\r\n","import { Commands, SharedLogic } from '..';\r\n\r\nexport const CmdEdit = 'edit';\r\nexport const CmdEditDialog = 'edit';\r\n\r\n/**\r\n * open an edit-item dialog\r\n *\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdEdit, 'Edit', 'pencil', false, true, {\r\n    addParamsToLink: (ctx) => ({ mode: 'edit' }),\r\n    showCondition(ctx) {\r\n        // need ID or a \"slot\", otherwise edit won't work\r\n        const result =\r\n            !!ctx.button.command.params.entityId ||\r\n            !!ctx.button.command.params.useModuleList;\r\n        return result;\r\n    },\r\n});\r\n","import { Commands } from '..';\r\nimport { CmdEditDialog } from './edit';\r\n\r\nexport const CmdAppResources = 'app-resources';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdAppResources, 'AppResources', 'translate', true, false, {\r\n    dialog: (_) => CmdEditDialog,\r\n\r\n    disabled: (context) => context.app.resourcesId === null,\r\n\r\n    title: (context) => `Toolbar.AppResources${context.app.resourcesId === null ? 'Disabled' : ''}`,\r\n\r\n    // only if resources exist or are 0 (to be created)...\r\n    showCondition: (context) => !!context.user.canDesign && !context.app.isContent,\r\n\r\n    configureLinkGenerator: (context, linkGenerator) => {\r\n        linkGenerator.items = [{ EntityId: context.app.resourcesId }];\r\n    },\r\n\r\n    // if it doesn't have a query, make the button faded\r\n    dynamicClasses: (context) => context.app.resourcesId !== null ? '' : 'empty',\r\n});\r\n","import { Commands } from '..';\r\nimport { CmdEditDialog } from './edit';\r\n\r\nexport const CmdAppSettings = 'app-settings';\r\n\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdAppSettings, 'AppSettings', 'sliders', true, false, {\r\n\r\n    dialog: () => CmdEditDialog,\r\n\r\n    disabled: (context) => context.app.settingsId === null,\r\n\r\n    title: (context) =>\r\n        `Toolbar.AppSettings${\r\n            context.app.settingsId === null ? 'Disabled' : ''\r\n    }`,\r\n\r\n    // only if settings exist, or are 0 (to be created)\r\n    showCondition: (context) => context.user.canDesign && !context.app.isContent,\r\n\r\n    configureLinkGenerator: (context, linkGenerator) => {\r\n        linkGenerator.items = [{ EntityId: context.app.settingsId }];\r\n    },\r\n\r\n    // if it doesn't have a settings, make it less strong\r\n    dynamicClasses: (context) => context.app.settingsId !== null ? '' : 'empty',\r\n});\r\n","import { Commands } from '..';\r\n\r\nexport const CmdApp = 'app';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdApp, 'App', 'settings', true, false, {\r\n    showCondition: (context) => {\r\n        return context.user.canDesign;\r\n    },\r\n});\r\n","import { Commands } from '..';\r\n\r\nexport const CmdContentItems = 'contentitems';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdContentItems, 'ContentItems', 'table', true, false, {\r\n    addParamsToLink: (context) => {\r\n        const typeName = context.button.command.params.contentType\r\n            || context.contentBlock.contentTypeId;\r\n        return {\r\n            // old name for the previous UI\r\n            // 2021-11-29 2dm - believe this is obsolete, will turn off and see if everything works\r\n            // #cleanUp EOY 2021\r\n            // contentTypeName: typeName,\r\n\r\n            // new name for the new UI\r\n            contentType: typeName,\r\n        };\r\n    },\r\n\r\n    // only show to admin-users and in cases where we know the content-type\r\n    showCondition: (context) => {\r\n        return !!context.user.canDesign &&\r\n            (!!context.button.command.params.contentType ||\r\n                !!context.contentBlock.contentTypeId);\r\n    },\r\n\r\n    configureLinkGenerator: (context, linkGenerator) => {\r\n        if (context.button.command.params.filters) {\r\n            let enc = JSON.stringify(context.button.command.params.filters);\r\n\r\n            // special case - if it contains a \"+\" character, this won't survive\r\n            // encoding through the hash as it's always replaced with a space, even if it would be pre converted to %2b\r\n            // so we're base64 encoding it - see https://github.com/2sic/2sxc/issues/1061\r\n            if (enc.indexOf('+') > -1) enc = btoa(enc);\r\n            linkGenerator.urlParams.filters = enc;\r\n        }\r\n    },\r\n});\r\n","import { Commands } from '..';\r\n\r\nexport const CmdContentType = 'contenttype';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdContentType, 'ContentType', 'fields', true, false, {\r\n    addParamsToLink: (context) => ({\r\n        // added in 10.27 to help with the new edit ui\r\n        contentType: context.button.command.params.contentType\r\n            || context.contentBlock.contentTypeId,\r\n    }),\r\n\r\n    // only show to admin-users and in cases where we know the content-type\r\n    showCondition: (context) => {\r\n        return !!context.user.canDesign &&\r\n            (!!context.button.command.params.contentType ||\r\n                !!context.contentBlock.contentTypeId);\r\n    },\r\n});\r\n","import { Commands } from '../commands';\r\n\r\nexport const CmdCustom = 'custom';\r\nconst ctxName = 'context';\r\nconst evtName = 'event';\r\n\r\nconst errNoCode = \"Trying to run Custom-Code action, but no 'customCode' (v9) or 'call' (v10) found to run - see console for debug info.\";\r\n\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdCustom, 'Custom', 'bomb', true, false, {\r\n    code(context, event) {\r\n        return new Promise((resolve, reject) => {\r\n            const actPar = context.button.command.params;\r\n            // the old V9 name\r\n            let code = actPar.customCode;\r\n            // also try the V10 edition\r\n            if (!code) {\r\n                code = actPar.call;\r\n                if (typeof code === 'string' && code.indexOf(' ') === -1 && code.indexOf('(') === -1)\r\n                    code += `(${ctxName}, ${evtName})`;\r\n            }\r\n            if (!code) {\r\n                console.warn(errNoCode, actPar);\r\n                alert(errNoCode);\r\n                resolve();\r\n            }\r\n            try {\r\n                const fn = new Function(ctxName, evtName, code);\r\n                resolve(fn(context, event));\r\n            } catch (err) {\r\n                console.error('error in custom button-code: ', actPar);\r\n                reject(err);\r\n            }\r\n        });\r\n    },\r\n});\r\n","import { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { translate } from '../i18n';\r\n\r\n/**\r\n * this enhances the $2sxc client controller with stuff only needed when logged in\r\n */\r\n\r\n// #region contentItem Commands\r\nexport let contentItems = {\r\n  // delete command - try to really delete a content-item\r\n  delete: (context: ContextComplete, itemId: number, itemGuid: string, itemTitle: string): Promise<void> => {\r\n    // first show main warning / get ok\r\n    const ok = confirm(translate('Delete.Confirm')\r\n      .replace('{id}', String(itemId))\r\n      .replace('{title}', itemTitle));\r\n\r\n    if (!ok) return Promise.resolve();\r\n\r\n    /**\r\n     * ZoneId and AppId are sent becase of rare, special case that is not default\r\n     * (default is that 2sxc is finding ZoneId and AppId on server side from ModuleId)\r\n     * when we need to delete entity from other app or zone, than current one.\r\n     * TODO: send this params, only when is necesary (value change detection for ZoneId, AppId)\r\n     */\r\n    const params = {\r\n      zoneId: context.app.zoneId,\r\n      appId: context.app.id,\r\n    };\r\n\r\n    return context.sxc.webApi.fetch(context.sxc.webApi.url(`app/auto/content/any/${itemGuid}`, params), undefined, 'DELETE')\r\n      .then((response) => {\r\n        if (response.status >= 200 && response.status < 300) {\r\n          location.reload();\r\n        } else if (response.status >= 400 && response.status < 500) {\r\n          // check if it's a permission config problem\r\n          const msgJs = translate('Delete.ErrCheckConsole');\r\n          if (response.status === 401) alert(translate('Delete.ErrPermission') + msgJs);\r\n          if (response.status === 400) alert(translate('Delete.ErrInUse') + msgJs);\r\n        }\r\n      }).catch((error) => {\r\n        console.log(error);\r\n      });\r\n  },\r\n};\r\n\r\n","import { Commands } from '..';\r\nimport { contentItems } from '../../entity-manipulation/item-commands';\r\n\r\nexport const CmdDelete = 'delete';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdDelete, 'Delete', 'cancel', true, false, {\r\n    // disabled: true,\r\n    showCondition(context) {\r\n        const p = context.button.command.params;\r\n        // can never be used for a modulelist item, as it is always in use somewhere\r\n        if (p.useModuleList) return false;\r\n\r\n        // check if all data exists required for deleting\r\n        // before 10.27, it was entityId, entityGuid and entityTitle\r\n        // since 10.27, there will always be a guid (if it has an ID)\r\n        // and enabling it requires an action-modifier \"+delete\",\r\n        // so the automatic detection only applies\r\n        // to the pre-10.27 custom toolbars case\r\n        return (!!p.entityId && !!p.entityGuid && !!p.entityTitle);\r\n    },\r\n\r\n\r\n    code(context) {\r\n        const p = context.button.command.params;\r\n        const title = p.title || p.entityTitle; // prefer new title, and fallback to old for pre 10.27 configs\r\n        return contentItems.delete(context, p.entityId, p.entityGuid, title);\r\n    },\r\n});\r\n","import { Commands } from '..';\r\nimport { $2sxcInPage } from '../../interfaces/sxc-controller-in-page';\r\n\r\nexport const CmdInsightsServer = 'insights-server';\r\n\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdInsightsServer, 'Insights', 'speed', true, false, {\r\n    showCondition: (context) => context.user.canDesign,\r\n    code(context, event) {\r\n        return new Promise((resolve, reject) => {\r\n            console.log('context', context);\r\n            const path = $2sxcInPage.http.apiUrl('sys/insights/logs');\r\n            window.open(path, '_blank');\r\n            return resolve();\r\n        });\r\n    },\r\n});\r\n","import { Commands, SharedLogic } from '..';\r\n\r\nexport const CmdInstanceList = 'instance-list';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdInstanceList, 'Sort', 'list-numbered', false, true, {\r\n    showCondition: (context) => SharedLogic.isList(context),\r\n\r\n    configureLinkGenerator: (context, linkGenerator) => {\r\n        if (!SharedLogic.isFieldList(context)) return;\r\n\r\n        const params = context.button.command.params;\r\n        linkGenerator.items = [{ Group: {\r\n            Guid: params.parent,\r\n            Part: params.fields,\r\n            Index: params.sortOrder,\r\n            Add: false,\r\n        }}];\r\n    },\r\n});\r\n","import { CmdEditDialog, CmsEngine, Commands } from '..';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\nexport const CmdNew = 'new';\r\nexport const CmdNewMode = 'new';\r\n\r\n/**\r\n * 'new' is a dialog to add something, and will not add if cancelled\r\n * new can also be used for mini-toolbars which just add an entity not attached to a module\r\n * in that case it's essential to add a contentType like\r\n * <ul class=\"sc-menu\" data-toolbar='{\"action\":\"new\", \"contentType\": \"Category\"}'></ul>\r\n *\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdNew, 'New', 'plus', false, true, {\r\n    addParamsToLink: (_) => ({ mode: CmdNewMode }),\r\n\r\n    dialog: (_) => CmdEditDialog, // don't use \"new\" (default) but use \"edit\"\r\n\r\n    showCondition(context) {\r\n        // don't provide new if type unknown or on the header-item\r\n        return  !!context.button.command.params.contentType || SharedLogic.isList(context);\r\n    },\r\n\r\n    code(context, event) {\r\n        const params = context.button.command.params;\r\n        // todo - should refactor this to be a toolbarManager.contentBlock command\r\n        params.sortOrder = params.sortOrder + 1;\r\n\r\n        // if we have an EntityId, this means that it picked up id/guid from the current item,\r\n        // so we must reset both EntityId and EntityGuid\r\n        // note that we don't reset this if entityId = 0, because that usually means the guid was preset on purpose\r\n        if (params.entityId && params.entityId !== 0) {\r\n            delete params.entityId;\r\n            delete params.entityGuid;\r\n        }\r\n\r\n        // if we have useModuleList AND contentType then something is inconsistent\r\n        // since useModuleList doesn't need to specify the contentType\r\n        // this means that it's a custom new button, and useModuleList is wrong.\r\n        if (params.useModuleList && params.contentType)\r\n            delete params.useModuleList;\r\n\r\n        // done\r\n        return CmsEngine.openDialog(context, event);\r\n    },\r\n});\r\n","import { Commands } from '..';\r\nimport { ItemIdentifierSimple } from '../../interfaces/item-identifiers';\r\nimport { CmdEditDialog } from './edit';\r\nimport { CmdNewMode } from './new';\r\n\r\nexport const CmdMetadata = 'metadata';\r\nconst MetadataDefaultKeyType = 'string';\r\nconst MetadataDefaultTargetType = 10; // cms-item\r\n/**\r\n * create a metadata toolbar\r\n *\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdMetadata, 'Metadata', 'tag', false, false, {\r\n\r\n    addParamsToLink: (_) => ({ mode: CmdNewMode }),\r\n\r\n    dialog: (_) => CmdEditDialog, // don't use \"new\" (default) but use \"edit\"\r\n\r\n    // if it doesn't have data yet, make it less strong\r\n    dynamicClasses: (ctx) => ctx.button.command.params.entityId ? '' : 'empty',\r\n\r\n    // only add a metadata-button if it has metadata-infos\r\n    showCondition: (ctx) => !!ctx.button.command.params.metadata,\r\n\r\n    configureLinkGenerator(_, linkGenerator) {\r\n        const itm: Partial<ItemIdentifierSimple> = {\r\n            Title: 'EditFormTitle.Metadata',\r\n            Metadata: {\r\n                ...{ keyType: MetadataDefaultKeyType, targetType: MetadataDefaultTargetType },\r\n                ...linkGenerator.context.button.command.params.metadata },\r\n        };\r\n        linkGenerator.items[0] = {...linkGenerator.items[0], ...itm };\r\n    },\r\n});\r\n","import { C } from '../../constants';\r\nimport { IDs } from '../../constants/ids';\r\nimport { Commands } from '../commands';\r\n\r\nexport const CmdMore = 'more';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdMore, 'MoreActions', 'options btn-mode', true, false, {\r\n    code(context, event) {\r\n        return new Promise((resolve, reject) => {\r\n            const btn2 = event.target as HTMLElement;\r\n            const fullMenu2 = btn2.closest(IDs.sel.tagScMenu) as HTMLElement;\r\n            const oldState2 = Number(fullMenu2.getAttribute('data-state') || 0);\r\n            const max2 = Number(fullMenu2.getAttribute('group-count'));\r\n            const newState2 = (oldState2 + 1) % max2;\r\n\r\n            fullMenu2.classList.remove(`group-${oldState2}`);\r\n            fullMenu2.classList.add(`group-${newState2}`);\r\n            fullMenu2.setAttribute('data-state', String(newState2));\r\n\r\n            event.preventDefault();\r\n\r\n            function mouseenterHandler(e: MouseEvent) {\r\n                fullMenu2.style.opacity = '1';\r\n            }\r\n\r\n            function mouseleaveHandler(e: MouseEvent) {\r\n                if (e.screenX !== 0 && e.screenY !== 0) {\r\n                    // hide toolbar on mouseleave\r\n                    fullMenu2.style.opacity = '0';\r\n                } else {\r\n                    // this is fix for Chrome issue\r\n                    // ensure to show toolbar because X=0 and Y=0\r\n                    fullMenu2.style.opacity = '1';\r\n                    console.warn(\r\n                        'workaround for toolbar hide onmouseleave issue',\r\n                        e.screenX,\r\n                        e.screenY,\r\n                        e.target,\r\n                    );\r\n                }\r\n            }\r\n\r\n            // because of issue in Chrome we need to override CSS rules in edit.css for toolbar toggle on mouse hover\r\n            const scElement = fullMenu2.closest(\r\n                '.' + C.Toolbar.classes.oldHover,\r\n            );\r\n            // add mouseenter and mouseleave events to parent sc-element if not already added\r\n            if (scElement && fullMenu2.getAttribute('listener') !== 'true') {\r\n                scElement.addEventListener('mouseenter', mouseenterHandler);\r\n                scElement.addEventListener('mouseleave', mouseleaveHandler);\r\n                fullMenu2.setAttribute('listener', 'true'); // flag that events are added\r\n            }\r\n\r\n            resolve();\r\n        });\r\n    },\r\n});\r\n","import { Commands, SharedLogic } from '..';\r\nimport { Actions } from './content-list-actions';\r\n\r\nexport const CmdMoveDown = 'movedown';\r\n\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdMoveDown, 'MoveDown', 'move-down', false, true, {\r\n    // TODO: do not display if is last item in list\r\n    showCondition: (context) => SharedLogic.isList(context),\r\n    code(context) {\r\n        // TODO: make sure index is never greater than the amount of items\r\n        return Actions.changeOrder(\r\n            context,\r\n            context.button.command.params.sortOrder,\r\n            context.button.command.params.sortOrder + 1,\r\n        );\r\n    },\r\n});\r\n","import { Commands } from '../commands';\r\nimport { Actions } from './content-list-actions';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\nexport const CmdMoveUp = 'moveup';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdMoveUp, 'MoveUp', 'move-up', false, true, {\r\n    showCondition(context) {\r\n        return !!(SharedLogic.isList(context) &&\r\n            context.button.command.params.sortOrder !== 0\r\n        );\r\n    },\r\n    code(context) {\r\n        return Actions.changeOrder(\r\n            context,\r\n            context.button.command.params.sortOrder,\r\n            Math.max(context.button.command.params.sortOrder - 1, 0),\r\n        );\r\n    },\r\n});\r\n","import { Commands } from '..';\r\nimport { translate } from '../../i18n';\r\nimport { Actions } from './content-list-actions';\r\n\r\nexport const CmdPublish = 'publish';\r\n\r\n/**\r\n * todo: shouldn't be available if changes are not allowed\r\n *\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdPublish, 'Unpublished', 'eye-off', false, false, {\r\n    showCondition(context) {\r\n        return context.button.command.params.isPublished === false;\r\n    },\r\n    disabled(context) {\r\n        return !context.instance.allowPublish;\r\n    },\r\n    code(context, event): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            if (context.button.command.params.isPublished) {\r\n                alert(translate('Toolbar.AlreadyPublished'));\r\n                return resolve();\r\n            }\r\n\r\n            // if we have an entity-id, publish based on that\r\n            if (context.button.command.params.entityId) {\r\n                return Actions.publishId(\r\n                    context,\r\n                    context.button.command.params.entityId,\r\n                );\r\n            }\r\n\r\n            const part: string =\r\n                context.button.command.params.sortOrder === -1\r\n                    ? 'listcontent'\r\n                    : 'content';\r\n            const index =\r\n                context.button.command.params.sortOrder === -1\r\n                    ? 0\r\n                    : context.button.command.params.sortOrder;\r\n            return Actions.publish(context, part, index);\r\n        });\r\n    },\r\n});\r\n","import { Commands, SharedLogic } from '..';\r\nimport { translate } from '../../i18n';\r\nimport { Actions } from './content-list-actions';\r\n\r\nexport const CmdRemove = 'remove';\r\n/**\r\n * remove an item from the placeholder (usually for lists)\r\n *\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdRemove, 'Remove', 'minus-circled', false, true, {\r\n    showCondition: (context) => SharedLogic.isList(context),\r\n    code(context) {\r\n        return new Promise((resolve, reject) => {\r\n            if (confirm(translate('Toolbar.ConfirmRemove')))\r\n                return Actions.removeFromList(context);\r\n            return resolve();\r\n        });\r\n    },\r\n});\r\n","import { Commands } from '..';\r\nimport { SharedLogic } from './shared-logic';\r\n\r\nexport const CmdReplace = 'replace';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdReplace, 'Replace', 'replace', false, true, {\r\n\r\n    showCondition(context) {\r\n        return SharedLogic.isReferencedItem(context);\r\n    },\r\n\r\n    configureLinkGenerator: (context, linkGenerator) => {\r\n        // default case is ContentBlock - in which case it doesn't need to redefine the items\r\n        if (!SharedLogic.isFieldList(context)) return;\r\n\r\n        // fieldList - redefine the items\r\n        const params = context.button.command.params;\r\n        linkGenerator.items = [{ Group: {\r\n            Guid: params.parent,\r\n            Part: params.fields,\r\n            Index: params.sortOrder,\r\n            Add: false,\r\n        }}];\r\n    },\r\n});\r\n","import { Commands } from '..';\r\nimport { TemplateIdentifier } from '../../interfaces/item-identifiers';\r\n\r\nexport const CmdTemplateDevelop = 'template-develop';\r\n\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdTemplateDevelop, 'Develop', 'code', true, false, {\r\n  newWindow: (_) => true,\r\n  dialog: (_) => 'develop',\r\n\r\n  showCondition: (context) => !!context.user.canDesign,\r\n\r\n  configureLinkGenerator: (context, linkGenerator) => {\r\n    const cb = context.contentBlock;\r\n    const identifier: TemplateIdentifier = { EntityId: cb.templateId };\r\n    if (cb.templatePath) identifier.Path = cb.templatePath;\r\n    if (cb.edition) identifier.Edition = cb.edition;\r\n    linkGenerator.items = [identifier];\r\n  },\r\n});\r\n","import { Commands } from '..';\r\n\r\nexport const CmdTemplateQuery = 'template-query';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdTemplateQuery, 'QueryEdit', 'filter', true, false, {\r\n    dialog: (_) => 'pipeline-designer',\r\n\r\n    addParamsToLink: (ctx) => ({ pipelineId: ctx.contentBlock.queryId }),\r\n\r\n    newWindow: (_) => true,\r\n\r\n    disabled: (ctx) => ctx.app.settingsId === null || !ctx.contentBlock.queryId,\r\n\r\n    title: (ctx) => `Toolbar.QueryEdit${ctx.contentBlock.queryId === null ? 'Disabled' : ''}`,\r\n\r\n    showCondition: (ctx) => !!ctx.user.canDesign && !ctx.app.isContent,\r\n\r\n    // if it doesn't have a query, make it less strong\r\n    dynamicClasses: (ctx) => ctx.contentBlock.queryId ? '' : 'empty',\r\n});\r\n","import { Commands } from '..';\r\n\r\nexport const CmdTemplateSettings = 'template-settings';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdTemplateSettings, 'TemplateSettings', 'sliders', true, false, {\r\n    dialog: (_) => 'edit',\r\n\r\n    showCondition: (ctx) => !!ctx.user.canDesign && !ctx.app.isContent,\r\n\r\n    configureLinkGenerator: (ctx, linkGen) => {\r\n        linkGen.items = [{ EntityId: ctx.contentBlock.templateId }];\r\n    },\r\n});\r\n","import { Commands } from '..';\r\n\r\nexport const CmdZone = 'zone';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdZone, 'Zone', 'manage', true, false, {\r\n    showCondition: (context) => {\r\n        return !!context.user.canDesign;\r\n    },\r\n});\r\n","\r\nexport const SpecialCommands = {\r\n    /** Special command: 'all' is a catch-all for workflows that should run on every command */\r\n    all: 'all',\r\n\r\n    /** Special Command: 'refresh' is usually run inside other commands after execution */\r\n    refresh: 'refresh',\r\n\r\n};\r\n","import { IQuickDialogConfig } from '../../../connect-parts/inpage-quick-dialog';\r\nimport { ContextComplete } from '../context';\r\n\r\nexport class QuickDialogConfig implements IQuickDialogConfig {\r\n    appId: number;\r\n    /**\r\n     * This will cause the quick-dialog to start in a different mode\r\n     * True means it starts with Content-Type picker and then view\r\n     * False means it starts with App-Picker and then View\r\n     */\r\n    isContent: boolean;\r\n    isInnerContent: boolean;\r\n    hasContent: boolean;\r\n    isList: boolean;\r\n    templateId: number;\r\n    contentTypeId: string;\r\n    // user: ContextOfUser;\r\n    supportsAjax: boolean;\r\n    debug: boolean;\r\n\r\n    static fromContext(context: ContextComplete): QuickDialogConfig {\r\n        const config = new QuickDialogConfig();\r\n        config.appId = context.app.id;\r\n        config.isContent = context.app.isContent;\r\n        config.isInnerContent = context.instance.id !== context.contentBlockReference.id; // if it differs, it's inner\r\n        config.hasContent = context.app.hasContent;\r\n        config.isList = context.contentBlock.isList;\r\n        config.templateId = context.contentBlock.templateId;\r\n        config.contentTypeId = context.contentBlock.contentTypeId;\r\n        // config.user = ContextOfUser.fromContext(context);\r\n        config.supportsAjax = context.app.supportsAjax;\r\n        config.debug = window.$2sxc.debug.load;\r\n        return config;\r\n    }\r\n}\r\n","import { QuickDialogContainer } from '.';\r\nimport { IIFrameBridge } from '../../../connect-parts/inpage-quick-dialog';\r\nimport { IQuickDialogConfig } from '../../../connect-parts/inpage-quick-dialog';\r\nimport { ContentBlockEditor } from '../contentBlock/content-block-editor';\r\nimport { renderer } from '../contentBlock/render';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { HasLog, NoJQ } from '../logging';\r\nimport { TypeUnsafe } from '../plumbing/TypeTbD';\r\nimport { QuickDialog } from './quick-dialog';\r\nimport { QuickDialogConfig } from './quick-dialog-config';\r\n\r\nconst scrollTopOffset: number = 80;\r\nconst animationTime: number = 400;\r\n\r\n/**\r\n *\r\n */\r\n// ReSharper disable once InconsistentNaming\r\nexport class IFrameBridge extends HasLog implements IIFrameBridge {\r\n\r\n    constructor(parent: QuickDialogContainer) {\r\n        super('QDl.IfBrig', parent.log);\r\n    }\r\n\r\n    private sxcCacheKey: string;\r\n    private dialogName: string;\r\n\r\n    /** internal object to keep track of the sxc-instance */\r\n    private instanceSxc: SxcEdit;\r\n\r\n    /** The html-tag of the current module */\r\n    private tagModule: HTMLElement;\r\n\r\n    /**\r\n     * get the sxc-object of this iframe\r\n     */\r\n    private uncachedSxc(): SxcEdit {\r\n        if (!this.instanceSxc) throw \"can't find sxc-instance of IFrame, probably it wasn't initialized yet\";\r\n        return this.instanceSxc.recreate(true) as TypeUnsafe as SxcEdit;\r\n    }\r\n\r\n    getContext(): ContextComplete {\r\n        const cl = this.log.call('getContext');\r\n        return cl.return(ContextComplete.findContext(this.uncachedSxc()));\r\n    }\r\n\r\n    getAdditionalDashboardConfig() {\r\n        const cl = this.log.call('getAdditionalDashboardConfig');\r\n        return cl.return(QuickDialogConfig.fromContext(this.getContext()));\r\n    }\r\n\r\n    hide(): void {\r\n        QuickDialog.singleton().setVisible(false);\r\n    }\r\n\r\n    run(verb: string) {\r\n        this.uncachedSxc().manage.run(verb);\r\n    }\r\n\r\n    cancel(): void { QuickDialog.singleton().cancel(this); }\r\n\r\n    showMessage(message: string) {\r\n        const cl = this.log.call('showMessage');\r\n        renderer.showMessage(this.getContext(), `<p class=\"no-live-preview-available\">${message}</p>`);\r\n        this.scrollToTarget(this.tagModule);\r\n        cl.done();\r\n    }\r\n\r\n    reloadAndReInit(): Promise<IQuickDialogConfig> {\r\n        this.changed = false;\r\n        return renderer.reloadAndReInitialize(this.getContext(), true, true)\r\n            .then(() => this.scrollToTarget(this.tagModule))\r\n            .then(() => Promise.resolve(this.getAdditionalDashboardConfig()));\r\n    }\r\n\r\n    setTemplate(templateId: number, templateName: string, final: boolean): Promise<boolean> {\r\n        const cl = this.log.call('setTemplate', `tid: ${templateId}, tname: ${templateName}, final: ${final}`);\r\n        this.changed = true;\r\n        const config = this.getAdditionalDashboardConfig();\r\n        const context = this.getContext();\r\n        const ajax = config.isContent || config.supportsAjax;\r\n\r\n        // add msg on full-reload, as it takes longer\r\n        // don't add this on ajax, as it will have side-effects because sometimes\r\n        // in ajax the content won't be replaced\r\n        if (!ajax)\r\n            this.showMessage(`refreshing <b>${templateName}</b>...`);\r\n\r\n        const reallySave = final || !ajax;\r\n        let promise = reallySave\r\n            ? ContentBlockEditor.singleton().updateTemplateFromDia(context, templateId)\r\n            : renderer.ajaxLoad(context, templateId, true);\r\n\r\n        if (final)\r\n            promise = promise.then(() => QuickDialog.singleton().setVisible(false));\r\n\r\n        promise = ajax\r\n            ? promise.then(() => this.scrollToTarget(this.tagModule))\r\n            : promise.then(() => window.parent.location.reload());\r\n\r\n        // return true if ajax, so upstream can update UIs\r\n        return cl.return(promise.then(() => ajax));\r\n    }\r\n\r\n    changed = false;\r\n\r\n    /**\r\n     * prepare the bridge with the info of the current instance\r\n     */\r\n    setup(sxc: SxcEdit, dialogName: string): void {\r\n        const cl = this.log.call('setup');\r\n        cl.data('rewire with sxc: ', sxc);\r\n\r\n        this.changed = false;\r\n        this.instanceSxc = sxc;\r\n        this.tagModule = SxcEdit.getTag(sxc).parentElement;\r\n        this.sxcCacheKey = sxc.cacheKey;\r\n        if (dialogName) this.dialogName = dialogName;\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * check if the dialog is showing for the current sxc-instance\r\n     * @param {string} dialogName - name of dialog\r\n     * @returns {boolean} true if it's currently showing for this sxc-instance\r\n     */\r\n    isConfiguredFor(instanceId: string, dialogName: string): boolean {\r\n        const cl = this.log.call('isConfiguredFor', `id:${instanceId}, dialog:${dialogName}`);\r\n        const result = this.sxcCacheKey === instanceId // the iframe is showing for the current sxc\r\n            && this.dialogName === dialogName; // the view is the same as previously\r\n        return cl.return(result);\r\n    }\r\n\r\n    private scrollToTarget(target: HTMLElement): void {\r\n        const cl = this.log.call('scrollToTarget');\r\n        const specs: ScrollToOptions = {\r\n            top: NoJQ.offset(target).top - scrollTopOffset,\r\n            left: 0,\r\n            behavior: 'smooth',\r\n        };\r\n        // debugger; // scrolls to wrong location. Target is wrong\r\n        // window.scrollTo(specs);\r\n        cl.done();\r\n    }\r\n}\r\n\r\n\r\n","import { HasLog, Insights } from '../logging';\r\n\r\n/**\r\n * This object helps persist / load / reset\r\n * a setting in the session-state\r\n */\r\n\r\n// General notes\r\n// - must always use try-catch because in certain environments like iFrame prohibit access to sessionStorage\r\nexport class SessionStateHandler<T> extends HasLog {\r\n  constructor(private readonly key: string) {\r\n    super('Ses.State');\r\n    Insights.add('system', 'session-state ' + key, this.log);\r\n  }\r\n\r\n  set(value: string): void {\r\n    this.log.add(`state '${this.key}' set(${value})`);\r\n    try {\r\n      sessionStorage.setItem(this.key, value);\r\n    } catch { /* ignore */ }\r\n  }\r\n\r\n  remove(): void {\r\n    this.log.add(`state '${this.key}' remove()`);\r\n    try {\r\n      sessionStorage.removeItem(this.key);\r\n    } catch { /* ignore */ }\r\n  }\r\n\r\n  get(): T {\r\n    const result = getItemValue<T>(this.key);\r\n    this.log.add(`state '${this.key}' get() = '${result}'`);\r\n    try {\r\n      return result;\r\n    } catch { /* ignore */ }\r\n  }\r\n}\r\n\r\n\r\nfunction getItemValue<T>(key: string): T {\r\n  try {\r\n    const value = sessionStorage.getItem(key);\r\n    return JSON.parse(value) as T;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n","import { SessionStateHandler } from '../manage/session-state-handler';\r\n\r\n\r\nexport let cbId = new SessionStateHandler<number>('dia-cbid');\r\nexport let cancelled = new SessionStateHandler<boolean>('cancelled-dialog');\r\n","\r\nexport * from '../../../connect-parts/inpage-quick-dialog';\r\nexport * from './iframe-bridge';\r\nexport * from './quick-dialog';\r\nexport * from './quick-dialog-config';\r\nexport * from './quick-dialog-container';\r\nexport * from './state';\r\n\r\nconst css = require('./quick-dialog.css');","import { IDialogFrameElement, IFrameBridge } from '.';\r\nimport { HasLog, NoJQ } from '../logging/';\r\nimport { QuickDialog } from './quick-dialog';\r\n\r\n/**\r\n * this is a dialog manager which is in charge of all quick-dialoges\r\n * it always has a reference to the latest dialog created by a.ny module instance\r\n */\r\n\r\nconst containerClass = 'inpage-frame-wrapper';\r\nconst iframeClass = 'inpage-frame';\r\nconst iframeTag = 'iframe';\r\nconst containerTemplate = `<div class=\"${containerClass}\"><div class=\"${iframeClass}\"></div></div>`;\r\nconst resizeInterval = 200;\r\n\r\n\r\nexport class QuickDialogContainer extends HasLog {\r\n\r\n    constructor(quickDialog: QuickDialog) {\r\n        super('QDl.Contnr', quickDialog.log);\r\n    }\r\n\r\n    private isFullscreen: boolean = false;\r\n    private resizeWatcher: number = null;\r\n    /**\r\n     * get the current container\r\n     * @returns {element} html element of the div\r\n     */\r\n    getOrCreate(): HTMLElement {\r\n        const container = document.querySelector<HTMLElement>(`.${containerClass}`);\r\n        return container ?? this.buildContainerAndIFrame();\r\n    }\r\n\r\n    /**\r\n     * build the container in the dom w/iframe for re-use\r\n     * @return {HTMLElement} dom-object\r\n     */\r\n    private buildContainerAndIFrame(): HTMLElement {\r\n        const callLog = this.log.call('buildContainerAndIFrame');\r\n        const container = NoJQ.domFromString(containerTemplate)[0];\r\n        if (document.querySelectorAll<HTMLElement>('#personaBar-iframe').length > 0)\r\n            container.classList.add('persona-bar-visible');\r\n        const newIFrame = document.createElement(iframeTag);\r\n        const extendedIFrame = convertIFrameToQuickDialog(newIFrame, this);\r\n        container.querySelector<HTMLElement>(`.${iframeClass}`).append(extendedIFrame);\r\n        document.body.append(container);\r\n        this.watchForResize(container);\r\n        return callLog.return(container, 'ok');\r\n    }\r\n\r\n    /**\r\n     * find the iframe which hosts the dialog\r\n     * @param {html} [container] - html-container\r\n     * @returns {html} iframe object\r\n     */\r\n    getIFrame(container?: HTMLElement): IDialogFrameElement {\r\n        if (!container) container = this.getOrCreate();\r\n        return container.querySelector<IDialogFrameElement>(iframeTag);\r\n    }\r\n\r\n    /**\r\n     * set container css for size\r\n     * @param {boolean} fullScreen\r\n     */\r\n    setSize(fullScreen: boolean): void {\r\n        const cl = this.log.call('setSize');\r\n        const container = this.getOrCreate();\r\n        // set container height\r\n        container.style.minHeight = fullScreen ? '100%' : '225px';\r\n        this.isFullscreen = fullScreen;\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * create watcher which monitors the iframe size and adjusts the container as needed\r\n     */\r\n    private watchForResize(container: HTMLElement): void {\r\n        // only add a timer if not already running\r\n        if (this.resizeWatcher) return;\r\n        const callLog = this.log.call('watchForResize');\r\n        // if (!resizeWatcher)\r\n        this.resizeWatcher = window.setInterval(() => {\r\n            try {\r\n                const frm = this.getIFrame(container);\r\n                if (!frm) {\r\n                    callLog.onlyAddIfNew('no iframe');\r\n                    return;\r\n                }\r\n\r\n                const height: number = frm.contentDocument.body.offsetHeight;\r\n                if (frm.previousHeight === height) {\r\n                    callLog.onlyAddIfNew('no height change');\r\n                    return;\r\n                }\r\n                frm.style.minHeight = container.style.minHeight;\r\n                frm.style.height = height + 'px';\r\n                frm.previousHeight = height;\r\n                if (this.isFullscreen) {\r\n                    frm.style.height = '100%';\r\n                    frm.style.position = 'absolute';\r\n                }\r\n                callLog.onlyAddIfNew('changed to ' + height);\r\n            } catch (e) {\r\n                callLog.add('error', e);\r\n            }\r\n        }, resizeInterval);\r\n        callLog.return(null, 'watcher added');\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nfunction convertIFrameToQuickDialog(iFrame: HTMLIFrameElement, parent: QuickDialogContainer): IDialogFrameElement {\r\n    const callLog = parent.log.call('build');\r\n    callLog.data('prototype', IFrameBridge.prototype);\r\n    const iFrameExtended = iFrame as IDialogFrameElement;\r\n    iFrameExtended.bridge = new IFrameBridge(parent);\r\n    callLog.data('extensions', iFrameExtended.bridge);\r\n    return callLog.return(iFrameExtended);\r\n}\r\n","import { IDialogFrameElement, IIFrameBridge } from '.';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { $2sxcInPage } from '../interfaces/sxc-controller-in-page';\r\nimport { HasLog, Insights } from '../logging';\r\nimport { IFrameBridge } from './iframe-bridge';\r\nimport { QuickDialogContainer } from './quick-dialog-container';\r\nimport * as QuickEditState from './state';\r\n\r\nconst diagShowClass: string = 'dia-select';\r\n\r\n/** dialog manager - the currently active dialog object */\r\nlet current: IDialogFrameElement = null;\r\n\r\ninterface IFrameWindow extends Window {\r\n    reboot(): void;\r\n}\r\n\r\n/**\r\n * this is a dialog manager which is in charge of all quick-dialogues\r\n * it always has a reference to the latest dialog created by a.ny module instance\r\n */\r\nexport class QuickDialog extends HasLog {\r\n\r\n    /** Singleton */\r\n    public static singleton(): QuickDialog {\r\n        return this._singleton ?? (this._singleton = new QuickDialog());\r\n    }\r\n    private static _singleton: QuickDialog;\r\n\r\n\r\n    private container: QuickDialogContainer;\r\n    private constructor() {\r\n        super('Qdl.Managr');\r\n        Insights.add('quick-dialog', 'manager', this.log);\r\n        this.container = new QuickDialogContainer(this);\r\n    }\r\n\r\n    /**\r\n     * Determines if a.ny dialog is currently showing\r\n     */\r\n    isVisible() {\r\n        return current != null;\r\n    }\r\n\r\n    /**\r\n     * toggle visibility\r\n     * @param {boolean} [show] true/false optional\r\n     */\r\n    setVisible(show: boolean): void {\r\n        const cl = this.log.call('setVisible');\r\n        const cont = this.container.getOrCreate();\r\n        cont.classList.toggle(diagShowClass, show);\r\n        this.rememberDialogState(this.container.getIFrame(cont), show);\r\n        current = show ? this.container.getIFrame() : null;\r\n        cl.done();\r\n    }\r\n\r\n    /**\r\n     * show / reset the current iframe to use new url and callback\r\n     * @param {ContextComplete} context object\r\n     * @param {string} url - url to show\r\n     * @param {function()} closeCallback - callback event\r\n     * @param {boolean} isFullscreen - if it should open full screen\r\n     * @param {string} [dialogName] - optional name of dialog, to check if it's already open\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    showOrToggleFromToolbar(\r\n        context: ContextComplete,\r\n        url: string,\r\n        isFullscreen: boolean,\r\n        dialogName: string,\r\n    ): Promise<boolean> {\r\n        const cl = this.log.call('showOrToggleFromToolbar', `ctx, url: '${url}', isFullScreen:${isFullscreen}, name:'${dialogName}'`);\r\n        this.container.setSize(isFullscreen);\r\n        const iFrame = this.container.getIFrame();\r\n\r\n        // in case it's a toggle\r\n        if (this.isVisible()) {\r\n            cl.add('is already visible');\r\n            // check if we're just toggling the current, or will show a new one afterwards\r\n            const isForSame = dialogName && current\r\n                && (current.bridge as IFrameBridge).isConfiguredFor(context.sxc.cacheKey, dialogName);\r\n            const togglePromise = isForSame ? this.promise : null;\r\n            this.cancel(current.bridge);\r\n            // just a hide this, return the old promise\r\n            if (togglePromise) return cl.return(togglePromise, 'just toggle off');\r\n        }\r\n\r\n        const dialogUrl = this.setUrlToQuickDialog(url);\r\n        (iFrame.bridge as IFrameBridge).setup(context.sxc, dialogName);\r\n        iFrame.setAttribute('src', dialogUrl);\r\n        // if the window had already been loaded, re-init\r\n        if (iFrame.contentWindow && (iFrame.contentWindow as IFrameWindow).reboot)\r\n            (iFrame.contentWindow as IFrameWindow).reboot();\r\n\r\n        // make sure it's visible'\r\n        this.setVisible(true);\r\n        return cl.return(this.promiseRestart(), 'restart');\r\n    }\r\n\r\n    cancel(bridge: IIFrameBridge) {\r\n        const callLog = this.log.call('cancel');\r\n        this.setVisible(false);\r\n        QuickEditState.cancelled.set('true');\r\n        this.resolvePromise(bridge.changed);\r\n        callLog.done();\r\n    }\r\n\r\n    private rememberDialogState(\r\n        iframe: IDialogFrameElement,\r\n        state: boolean,\r\n    ): void {\r\n        const callLog = this.log.call('rememberDialogState');\r\n        callLog.add(`qDialog persistDia(..., ${state})`);\r\n        if (state) {\r\n            const cbId = (iframe.bridge as IFrameBridge)\r\n                .getContext()\r\n                .contentBlockReference.id.toString();\r\n            callLog.add(`contentBlockId: ${cbId})`);\r\n            return callLog.return(QuickEditState.cbId.set(cbId));\r\n        }\r\n        return callLog.return(QuickEditState.cbId.remove(), 'remove');\r\n    }\r\n\r\n    //#region promise handling\r\n    private promise: Promise<boolean>;\r\n    private resolvePromise: (value?: boolean) => void;\r\n    private promiseRestart(): Promise<boolean> {\r\n        this.promise = new Promise<boolean>(\r\n            (resolve) => (this.resolvePromise = resolve),\r\n        );\r\n        return this.promise;\r\n    }\r\n    //#endregion\r\n\r\n    /**\r\n     * rewrite the url to fit the quick-dialog situation\r\n     * optionally with a live-compiled version from ng-serve\r\n     * @param {string} url - original url pointing to the default dialog\r\n     * @returns {string} new url pointing to quick dialog\r\n     */\r\n    private setUrlToQuickDialog(url: string): string {\r\n        const cl = this.log.call('setUrlToQuickDialog', url);\r\n        // change default url-schema from the primary angular-app to the quick-dialog\r\n        url = url\r\n            .replace(C.DialogPaths.ng8, C.DialogPaths.quickDialog);\r\n        url = this.changePathToLocalhostForDev(url);\r\n        return cl.return(url);\r\n    }\r\n\r\n\r\n    /**\r\n     * special debug-code when running on local ng-serve\r\n     * this is only activated if the developer manually sets a value in the localStorage\r\n     * @param url\r\n     */\r\n    private changePathToLocalhostForDev(url: string): string {\r\n        const cl = this.log.call('changePathToLocalhostForDev', url);\r\n        try {\r\n            const devMode = localStorage.getItem('devMode');\r\n            if (devMode && !!devMode)\r\n                return url.replace($2sxcInPage.env.uiRoot() + 'dist/ng/ui.html', 'http://localhost:4200');\r\n        } catch (e) {\r\n            // ignore\r\n        }\r\n        return cl.return(url);\r\n    }\r\n}\r\n","import { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { $2sxcInPage as $2sxc } from '../interfaces/sxc-controller-in-page';\r\n/**\r\n * This is for building/serializing the main url params when opening a dialog.\r\n * It does not contain the \"params\" / \"items\" part\r\n * @export\r\n * @class NgUrlValuesWithoutParams\r\n */\r\nexport class NgUrlValuesWithoutParams {\r\n  readonly zoneId: number;\r\n  readonly appId: number;\r\n  readonly tid: number;\r\n  readonly mid: number;\r\n  readonly cbid: number;\r\n\r\n  // 2021-01-19\r\n  // readonly lang: string;\r\n  // readonly langpri: string;\r\n  // readonly langs: string;\r\n  // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n  // readonly portalroot: string;\r\n  // 2020-12-11 #cleanup11.11 2dm - doesn't seem used, disabled\r\n  // readonly websiteroot: string;\r\n  readonly partOfPage?: boolean;\r\n  readonly publishing?: string;\r\n  // 2021-01-19\r\n  // readonly user: ContextOfUser;\r\n  readonly approot: string | null;\r\n\r\n  /** The api root for all 2sxc API calls - will vary by platform */\r\n  readonly api: string;\r\n\r\n  /** The root path to the UIs (scripts, css etc.) */\r\n  // 2021-01-19\r\n  // readonly uiRoot: string;\r\n\r\n  /** new in 10.27 */\r\n  readonly apps?: string;\r\n\r\n  /** features of App - this is to tell the UI it can show advanced features of an app like permissions, API, REST etc. */\r\n  readonly fa: boolean;\r\n\r\n  /** request verification token header name */\r\n  readonly rvth: string;\r\n\r\n  /** request verification token value */\r\n  readonly rvt: string;\r\n\r\n  constructor(context: ContextComplete, partOfPage: boolean) {\r\n    this.zoneId = context.app.zoneId;\r\n    this.appId = context.app.id;\r\n    this.tid = context.page.id;\r\n    this.mid = context.instance.id;\r\n    this.cbid = context.contentBlockReference.id;\r\n\r\n    // 2021-01-19\r\n    // this.lang = context.app.currentLanguage;\r\n    // this.langpri = context.app.primaryLanguage;\r\n    // this.langs = JSON.stringify(context.app.allLanguages);\r\n\r\n    // 2020-11-28 #cleanup11.11 2dm - not used, disabled - keep till Jan 2021, then remove from backend-json and drop these comments\r\n    // this.portalroot = context.tenant.url;\r\n    // 2020-12-11 #cleanup11.11 2dm - doesn't seem used, disabled\r\n    // this.websiteroot = context.instance.sxcRootUrl;\r\n\r\n    // New in 11.05.01\r\n    this.api = $2sxc.env.api();\r\n    // 2021-01-19\r\n    // this.uiRoot = $2sxc.env.uiRoot();\r\n\r\n    this.partOfPage = partOfPage;\r\n    if (partOfPage) this.publishing = context.contentBlockReference.publishingMode;\r\n    // todo= probably move the user into the dashboard info\r\n    // 2021-01-19 2dm - should now not be used any more\r\n    // this.user = ContextOfUser.fromContext(context);\r\n    this.approot = context.app.appPath || null; // this is the only value which doesn't have a slash by default. note that the app-root doesn't exist when opening \"manage-app\"\r\n    if (context?.button?.command?.params?.apps)\r\n        this.apps = context.button.command.params.apps;\r\n    this.fa = !context.app.isContent;\r\n    this.rvth = $2sxc.env.rvtHeader();\r\n    this.rvt = $2sxc.env.rvt();\r\n  }\r\n}\r\n","import { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { translate } from '../i18n';\r\nimport { ItemIdentifierGroup, ItemIdentifierSimple, ItemInField, TemplateIdentifier } from '../interfaces/item-identifiers';\r\nimport { $2sxcInPage } from '../interfaces/sxc-controller-in-page';\r\nimport { HasLog, Log } from '../logging';\r\nimport { NgUrlValuesWithoutParams } from '../manage/ng-dialog-params';\r\nimport { DictionaryValue, NoJQ, TypeUnsafe, urlClean } from '../plumbing';\r\nimport { ButtonSafe } from '../toolbar/config';\r\n\r\n/**\r\n * This is responsible for taking a context with command and everything\r\n * then building the link for opening the correct dialogs\r\n */\r\nexport class CommandLinkGenerator extends HasLog {\r\n    public items: Array<ItemIdentifierSimple | ItemIdentifierGroup | TemplateIdentifier>;\r\n    public readonly urlParams: UrlItemParams;\r\n    private readonly rootUrl: string;\r\n    private readonly debugUrlParam: string;\r\n\r\n    constructor(public readonly context: ContextComplete, parentLog: Log) {\r\n        super('Cmd.LnkGen', parentLog);\r\n        const cl = this.log.call('constructor');\r\n        const button = new ButtonSafe(context.button, context);\r\n        const command = button.action();\r\n        // Initialize Items - use predefined or create empty array\r\n        this.items = command.params.items || [];\r\n        cl.data('items', this.items);\r\n\r\n        // initialize params\r\n        this.urlParams = button.addParamsToLink() as unknown;\r\n        const dialog = button.dialog();\r\n        // note: this corrects how the variable to name the dialog changed in the history of 2sxc from action to dialog\r\n        this.urlParams = { ...{ dialog: dialog || command.name }, ...this.urlParams };\r\n        cl.data('urlParmas', this.urlParams);\r\n\r\n        // initialize root url to dialog\r\n        this.rootUrl = this.getDialogUrl(dialog);\r\n\r\n        // get isDebug url Parameter\r\n        this.debugUrlParam = window.$2sxc.urlParams.get('debug') ? '&debug=true' : '';\r\n\r\n        this.buildItemsList(button);\r\n\r\n        // if the command has own configuration stuff, do that now\r\n        if (context.button.configureLinkGenerator)\r\n            context.button.configureLinkGenerator(context, this);\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * Generate items for editing/changing or simple item depending on the scenario.\r\n     */\r\n    private buildItemsList(button: ButtonSafe) {\r\n        if (button.action().params.useModuleList)\r\n            this.addContentGroupItems(true);\r\n        else if (button.action().params.parent)\r\n            this.addItemInList();\r\n        else\r\n            this.addItem();\r\n    }\r\n\r\n    /**\r\n     * build the link, combining specific params with global ones and put all in the url\r\n     */\r\n    getLink() {\r\n        const context = this.context;\r\n        const button = new ButtonSafe(context.button, context);\r\n        const params = button.action().params;\r\n        const urlItems = this.urlParams as unknown as UrlItemParams;\r\n\r\n        // steps for all actions: prefill, serialize, open-dialog\r\n        // when doing new, there may be a prefill in the link to initialize the new item\r\n        if (params.prefill)\r\n            for (let i = 0; i < this.items.length; i++)\r\n                this.items[i].Prefill = params.prefill;\r\n\r\n        delete urlItems.prefill; // added 2020-03-11, seemed strange that it's not removed\r\n        urlItems.items = JSON.stringify(this.items); // Serialize/json-ify the complex items-list\r\n\r\n        // clone the params and adjust parts based on partOfPage settings...\r\n        const partOfPage = button.partOfPage();\r\n        const ngDialogParams = new NgUrlValuesWithoutParams(context, partOfPage);\r\n\r\n        return `${this.rootUrl}#${NoJQ.param(ngDialogParams).replace(/%2F/g, '/')}&${NoJQ.param(urlItems)}${this.debugUrlParam}`;\r\n    }\r\n\r\n    /**\r\n     * Determine the url to open a dialog, based on the settings which UI version to use\r\n     */\r\n    private getDialogUrl(dialogName: string): string {\r\n        const context = this.context;\r\n        // const path = (context.ui.form === 'ng8') // v11 applies to all forms, not just edit: //  && dialogName === 'edit')\r\n        //     ? C.DialogPaths.ng8\r\n        //     : C.DialogPaths.ng1;\r\n        return urlClean(`${$2sxcInPage.env.uiRoot()}${C.DialogPaths.ng8}`) + `?sxcver=${context.instance.sxcVersion}`;\r\n        // old till 11.11.02 return urlClean(`${context.instance.sxcRootUrl}${$2sxcInPage.env.uiRoot()}${C.DialogPaths.ng8}`) + `?sxcver=${context.instance.sxcVersion}`;\r\n    }\r\n\r\n    private addItem() {\r\n        const item = {} as ItemIdentifierSimple;\r\n        const params = this.context.button.command.params;\r\n\r\n        // two ways to name the content-type-name this, v 7.2+ and older\r\n        const ct = params.contentType || (params as TypeUnsafe).attributeSetName;\r\n        if (params.entityId) item.EntityId = params.entityId;\r\n        if (ct) item.ContentTypeName = ct;\r\n\r\n        // v12.11 - also support cases where the template includes an edition\r\n        if (params )\r\n\r\n        // only add if there was stuff to add\r\n        if (item.EntityId || item.ContentTypeName) {\r\n            console.warn('used the simple item header - test if dialog still works!');\r\n            // this.items.push(item);\r\n            this.items.push({ ...item, Title: translate(this.findTranslationKey(this.findPartName(true))) });\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * this will tell the command to edit a item from the sorted list in the group,\r\n     * optionally together with the presentation item\r\n     */\r\n    private addContentGroupItems(withPresentation: boolean) {\r\n        const cl = this.log.call('addContentGroupItems', `${withPresentation}`);\r\n        const params = this.context.button.command.params;\r\n        const isContentAndNotHeader = (params.sortOrder !== -1);\r\n        const index = isContentAndNotHeader ? params.sortOrder : 0;\r\n        const isAdd = this.context.button.command.name === 'new';\r\n        const groupId = this.context.contentBlock.contentGroupId;\r\n\r\n        const fields: string[] = [this.findPartName(true)];\r\n        if (withPresentation) fields.push(this.findPartName(false));\r\n        fields.map((f) => this.addContentGroupItem(groupId, index, f, isAdd));\r\n        cl.done();\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * this adds an item of the content-group, based on the group GUID and the sequence number\r\n     */\r\n    private addContentGroupItem(guid: string, index: number, part: string, isAdd: boolean) {\r\n        const cl = this.log.call('addContentGroupItem', `${guid}, ${index}, ${part}, ${isAdd}`);\r\n        this.items.push({\r\n            Group: {\r\n                Guid: guid,\r\n                Index: index,\r\n                Part: part.toLocaleLowerCase(),\r\n                Add: isAdd,\r\n            },\r\n            Title: translate(this.findTranslationKey(part)),\r\n        });\r\n        cl.done();\r\n    }\r\n\r\n\r\n    /**\r\n     * EXPERIMENTAL in 10.27, if a parent is specified, use that\r\n     * this will tell the command to edit a item which also belongs to a list\r\n     * this is relevant when adding new items\r\n     */\r\n    private addItemInList() {\r\n        const params = this.context.button.command.params;\r\n        const index = params.sortOrder;\r\n        const isAdd = this.context.button.command.name === 'new';\r\n        const groupId = params.parent;\r\n\r\n\r\n        // New in 10.27 - if params has a field, use that\r\n        if (params.fields)\r\n            params.fields.split(',').map((f) => this.items.push({\r\n                EntityId: isAdd ? 0 : params.entityId,\r\n                Field: f,\r\n                Parent: groupId,\r\n                Add: isAdd,\r\n                Index: index,\r\n            } as ItemInField));\r\n    }\r\n\r\n    /**\r\n     * find the part name for both the API to give the right item (when using groups) and for i18n\r\n     */\r\n    private findPartName(content: boolean): string {\r\n        const isContentAndNotHeader = (this.context.button.command.params.sortOrder !== -1);\r\n        return (isContentAndNotHeader ? '' : 'List') + (content ? 'Content' : 'Presentation');\r\n    }\r\n\r\n    /**\r\n     * find the correct i18n key for this part\r\n     */\r\n    private findTranslationKey(partName: string): string {\r\n        return `EditFormTitle.${partName}`;\r\n    }\r\n\r\n}\r\n\r\ninterface UrlItemParams {\r\n    prefill?: DictionaryValue;\r\n    items?: string;\r\n    contentTypeName?: string;\r\n    filters?: string;\r\n}\r\n","import { CommandParams, Commands } from '..';\r\nimport { HasLog, Log } from '../../logging';\r\n\r\n/**\r\n * Helper class to process parameters given to the Cms.Run statement\r\n * Important because certain params may sometimes be full objects, and sometimes just a name.\r\n * In addition, even if we have more than the name, we must ensure that defaults are also included\r\n *\r\n * @export\r\n * @class RunParameters\r\n */\r\nexport class RunParametersHelper extends HasLog {\r\n    constructor(parentLog?: Log) {\r\n        super('Cmd.RunPrm', parentLog, 'start');\r\n    }\r\n\r\n    /**\r\n     * name or settings adapter to settings\r\n     * @param nameOrSettings\r\n     * @returns settings\r\n     */\r\n    public getParamsFromNameOrParams(nameOrSettings: string | CommandParams): CommandParams {\r\n        const cl = this.log.call('getParamsFromNameOrParams', `${nameOrSettings}`);\r\n        // check if nameOrString is name (string) or object (settings)\r\n        const nameIsString = typeof nameOrSettings === 'string';\r\n        cl.add(`adapting settings; name string: ${nameIsString}; name = ${nameOrSettings}`);\r\n        const result = (nameIsString\r\n            ? { action: nameOrSettings }\r\n            : nameOrSettings) as CommandParams;\r\n        return cl.return(result);\r\n    }\r\n\r\n    /**\r\n     * Take a settings-name or partial settings object,\r\n     * and return a full settings object with all defaults from\r\n     * the command definition\r\n     * @param params\r\n     */\r\n    public expandParamsWithDefaults(params: CommandParams): CommandParams {\r\n        const cl = this.log.call('expandParamsWithDefaults');\r\n        const name = params.action;\r\n        cl.add(`will add defaults for ${name} from buttonConfig`);\r\n        const defaults = Commands.singleton().get(name).buttonDefaults;\r\n        cl.data('defaults to merge', defaults);\r\n        // TODO: 2dm - suspicious cast\r\n        // merge conf & settings, but...?\r\n        return cl.return({...defaults, ...params} as CommandParams);\r\n    }\r\n\r\n}\r\n","import { ContentBlockEditor } from '../../contentBlock/content-block-editor';\r\nimport { renderer } from '../../contentBlock/render';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { ContextBundleInstance } from '../../context/bundles/context-bundle-instance';\r\nimport { $2sxcInPage as $2sxc } from '../../interfaces/sxc-controller-in-page';\r\nimport { HasLog, Insights, Log } from '../../logging';\r\nimport { QuickDialog } from '../../quick-dialog/quick-dialog';\r\nimport { Button, ButtonSafe } from '../../toolbar/config';\r\nimport { ButtonCommand } from '../../toolbar/config';\r\nimport { InPageButtonJson } from '../../toolbar/config-loaders/config-formats/in-page-button';\r\nimport { WorkflowHelper, WorkflowPhases, WorkflowArguments } from '../../workflow';\r\nimport { CommandLinkGenerator } from '../command-link-generator';\r\nimport { CommandParams } from '../command-params';\r\nimport { RunParametersHelper } from './run-parameters';\r\nimport { RunParams } from './run-params';\r\nimport { WorkflowManager } from '../../workflow/workflow-manager';\r\n\r\ntype CommandPromise<T> = Promise<T|void>;\r\n\r\n/**\r\n * The CMS engine is global, and needs the context to work.\r\n */\r\nexport class CmsEngine extends HasLog {\r\n\r\n    private runParamsHelper: RunParametersHelper;\r\n\r\n    constructor(parentLog?: Log) {\r\n        super('Cmd.Exec', parentLog, 'start');\r\n        this.runParamsHelper = new RunParametersHelper(this.log);\r\n    }\r\n\r\n    detectParamsAndRun<T>(\r\n        context: ContextBundleInstance,\r\n        nameOrParams: string | CommandParams,\r\n        eventOrParams: CommandParams | MouseEvent,\r\n        event?: MouseEvent,\r\n    ): Promise<void | T> {\r\n        const cl = this.log.call('detectParamsAndRun', `${arguments.length} params`);\r\n        let cmdParams: CommandParams;\r\n\r\n        const thirdParamIsEvent = !event && eventOrParams && typeof (eventOrParams as MouseEvent).altKey !== 'undefined';\r\n        cl.add(`might cycle parameters. third is event=${thirdParamIsEvent}`);\r\n\r\n        if (thirdParamIsEvent) {\r\n            // no event param, but settings contains the event-object\r\n            cl.add('cycling params; event missing & eventOrSettings seems to be an event; settings assumed empty');\r\n            event = eventOrParams as MouseEvent; // move it to the correct variable\r\n            cmdParams = this.runParamsHelper.getParamsFromNameOrParams(nameOrParams);\r\n        } else {\r\n            cmdParams = {\r\n                ...(eventOrParams || {}),\r\n                ...this.runParamsHelper.getParamsFromNameOrParams(nameOrParams),\r\n            };\r\n        }\r\n\r\n        // ensure we have the right event despite browser differences\r\n        event = event || (window.event as MouseEvent);\r\n\r\n        const result: CommandPromise<T> = this.run(context as ContextComplete, cmdParams, event);\r\n        return cl.return(result);\r\n    }\r\n\r\n    /**\r\n     * run a command\r\n     * this method expects a clear order of parameters\r\n     * @param context\r\n     * @param settings\r\n     * @param event\r\n     */\r\n    run<T>(context: ContextComplete, nameOrParams: string | CommandParams, event: MouseEvent, wipParamsWithWorkflow?: RunParams): CommandPromise<T> {\r\n        const cl = this.log.call('run<T>');\r\n        let cmdParams = this.runParamsHelper.getParamsFromNameOrParams(nameOrParams);\r\n        cmdParams = this.runParamsHelper.expandParamsWithDefaults(cmdParams);\r\n\r\n        const origEvent = event;\r\n        const name = cmdParams.action;\r\n        const contentType = cmdParams.contentType;\r\n        cl.add(`run command '${name}' for type ${contentType}`);\r\n\r\n        // Toolbar API v2\r\n        const command = new ButtonCommand(name, contentType, cmdParams);\r\n        const newButtonConfig = new Button(command, command.name);\r\n\r\n        // merge conf & settings, but settings has higher priority\r\n        const button: Button = {\r\n            ...newButtonConfig,\r\n            ...InPageButtonJson.toButton(cmdParams as unknown),\r\n        };\r\n\r\n        // attach to context for inner calls which might access it\r\n        context.button = button;\r\n        cl.data('button', context.button);\r\n\r\n        // New in 11.12 - find commandWorkflow of toolbar or use a dummy so the remaining code will always work\r\n        // note: in cases where the click comes from elsewhere (like from the quick-dialog) there is no event\r\n\r\n        // New in 12.10 - Workflow can be provided by run-call\r\n        let wf: WorkflowManager;\r\n        if (wipParamsWithWorkflow && wipParamsWithWorkflow.workflows) {\r\n            wf = new WorkflowManager(this.log);\r\n            wf.add(wipParamsWithWorkflow.workflows);\r\n        } else\r\n            wf = WorkflowHelper.getWorkflow(origEvent?.target as HTMLElement);\r\n\r\n        // Attach to context, so it's available after running the command\r\n        context.commandWorkflow = wf;\r\n        const wrapperPromise = wf.run(new WorkflowArguments(name, WorkflowPhases.before, context));\r\n\r\n        // In case we don't have special code, use generic code\r\n        let commandPromise = button.code;\r\n        if (!commandPromise) {\r\n            cl.add('button, no code - generating code to open standard dialog');\r\n            commandPromise = CmsEngine.openDialog;\r\n        }\r\n\r\n        // get button configuration to detect if it's only a UI action (like the more-button)\r\n        let finalPromise: CommandPromise<T>;\r\n        if (new ButtonSafe(button, context).uiActionOnly()) {\r\n            cl.add('UI command, no pre-flight to ensure content-block');\r\n            finalPromise = wrapperPromise.then((wfArgs) => WorkflowHelper.isCancelled(wfArgs)\r\n                ? Promise.resolve<T>(null)\r\n                : commandPromise(context, origEvent));\r\n        } else {\r\n            // if more than just a UI-action, then it needs to be sure the content-group is created first\r\n            cl.add('command might change data, wrap in pre-flight to ensure content-block');\r\n            finalPromise = wrapperPromise.then(\r\n                (wfArgs) => WorkflowHelper.isCancelled(wfArgs)\r\n                    ? Promise.resolve<T>(null)\r\n                    : ContentBlockEditor.singleton()\r\n                        .prepareToAddContent(context, cmdParams.useModuleList)\r\n                        .then(() => commandPromise(context, origEvent)));\r\n        }\r\n\r\n        // Attach post-command workflow\r\n        const promiseWithAfterEffects = finalPromise.then((result) => {\r\n            return wf.run(new WorkflowArguments(name, WorkflowPhases.after, null, result))\r\n                .then(() => result);\r\n        });\r\n\r\n        return cl.return(promiseWithAfterEffects);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Open a new dialog of the angular-ui\r\n     */\r\n    static openDialog<T>(context: ContextComplete, event: MouseEvent): CommandPromise<T> {\r\n        const log = new Log('Cms.OpnDlg');\r\n        Insights.add('cms', 'open-dialog', log);\r\n        // the link contains everything to open a full dialog (lots of params added)\r\n        const link = new CommandLinkGenerator(context, log).getLink();\r\n        const btn = new ButtonSafe(context.button, context);\r\n\r\n        const origEvent = event || (window.event as MouseEvent);\r\n\r\n        return new Promise<T>((resolve) => {\r\n            // prepare promise for callback when the dialog closes\r\n            // to reload the in-page view w/ajax or page reload\r\n            const completePromise = () => {\r\n                // call the normal promise-resolve so the `.then` will be continued\r\n                resolve(context as unknown as T);\r\n                // reload the UI as specified\r\n                renderer.reloadAndReInitialize(context);\r\n            };\r\n\r\n            // check if inline window (quick-dialog)\r\n            if (btn.inlineWindow()) {\r\n                // test if it should be full screen (value or resolve-function)\r\n                QuickDialog.singleton()\r\n                    .showOrToggleFromToolbar(context, link, btn.fullScreen(), btn.dialog())\r\n                    .then((isChanged) => { if (isChanged) completePromise(); });\r\n            } else {\r\n                // else it's a normal pop-up dialog\r\n                const isNewWindow = btn.newWindow();\r\n                // check if new-window\r\n                if (isNewWindow || (origEvent?.shiftKey)) {\r\n                    // resolve promise, as the window won't report when closed\r\n                    resolve(context as unknown as T);\r\n                    window.open(link);\r\n                } else {\r\n                    $2sxc.totalPopup.open(link, completePromise);\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { CmsEngine } from '../commands/';\r\nimport { CommandParams } from '../commands/command-params';\r\nimport { C } from '../constants';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { ContextBundleInstance } from '../context/bundles/context-bundle-instance';\r\nimport { HasLog, Insights, Log } from '../logging';\r\nimport { isRunParams, RunParams } from '../commands/engine/run-params';\r\n\r\nconst logId = 'Cms.Api';\r\n\r\nexport class Cms extends HasLog {\r\n    /**\r\n     * if true (default) will reset the log everytime something is done\r\n     * if false, will preserve the log over multiple calls\r\n     */\r\n    // autoReset = true;\r\n    autoDump = C.Debug.cms.autoDump;\r\n\r\n    constructor() {\r\n        super(logId, null);\r\n    }\r\n\r\n    /**\r\n     * reset / clear the log\r\n     */\r\n    resetLog() {\r\n        this.log = new Log(logId, null, 'log was reset');\r\n        Insights.add('cms', 'run', this.log);\r\n    }\r\n\r\n    run<T>(\r\n        context: ContextBundleInstance | HTMLElement | RunParams,\r\n        nameOrSettings: string | CommandParams,\r\n        eventOrSettings?: CommandParams | MouseEvent,\r\n        event?: MouseEvent,\r\n    ): Promise<void | T> {\r\n        const cl = this.log.call('run<T>');\r\n\r\n        const cmsEngine = new CmsEngine(this.log);\r\n\r\n        // Figure out inner-call based on if context is new RunParams or not (in that case it should be a tag or a full context)\r\n        let innerCall: () => Promise<void>;\r\n        if (isRunParams(context)) {\r\n            // todo\r\n            const realCtx = ContextComplete.findContext(context.tag);\r\n            context.params = { action: context.action, ...context.params };\r\n            innerCall = () => cmsEngine.run(realCtx, context.params, context.event, context);\r\n        } else {\r\n            const realCtx = ContextBundleInstance.is(context)\r\n                ? context\r\n                : ContextComplete.findContext(context);\r\n\r\n            innerCall = () => cmsEngine.detectParamsAndRun(realCtx, nameOrSettings, eventOrSettings, event);\r\n        }\r\n\r\n        const result: Promise<void | T> = this.do(innerCall);\r\n        return cl.return(result, 'ok');\r\n    }\r\n\r\n    /**\r\n     * reset/clear the log if alwaysResetLog is true\r\n     */\r\n    private do<T>(innerCall: () => Promise<T>): Promise<T> {\r\n        const cl = this.log.call('do');\r\n        this.resetLog();\r\n        const result = innerCall();\r\n        if (this.autoDump) this.log.dump();\r\n        return cl.return(result);\r\n    }\r\n}\r\n","import { Workflow } from '../../workflow/workflow';\r\nimport { CommandParams } from '../command-params';\r\n\r\n/**\r\n * Parameters for the cms.run(...) command.\r\n * New in 12.10\r\n * @export\r\n * @interface RunParams\r\n * @extends {CommandParams}\r\n */\r\nexport interface RunParams {\r\n\r\n    /** The tag on which the run was triggered - it's used to give the command a context to start from */\r\n    tag: HTMLElement;\r\n\r\n    /** The action to perform. Required if you don't have params which themselves have the action */\r\n    action?: string;\r\n\r\n    /** The command params, like contentType, entityId etc. */\r\n    params?: CommandParams;\r\n\r\n    /** The event which triggered this command - sometimes useful internally further use */\r\n    event?: MouseEvent;\r\n\r\n    /** Workflows work the same way as with a toolbar, except that they are added here and not registered on init */\r\n    workflows?: Workflow | Workflow[];\r\n}\r\n\r\nexport function isRunParams(maybeRunParams: unknown): maybeRunParams is RunParams {\r\n    const typed = maybeRunParams as RunParams;\r\n    return typed.tag != null && (typed.action != null || typed.params != null);\r\n}\r\n","import { Cms } from '../../cms/Cms';\r\nimport { ContextComplete } from '../../context/bundles/context-bundle-button';\r\nimport { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { CommandParams } from '../command-params';\r\n\r\n/**\r\n * This is an engine on the sxc object.\r\n * It provides a .run(...) for when the sxc is already known.\r\n */\r\nexport class SxcInstanceEngine {\r\n  constructor(private sxc: SxcEdit) {}\r\n\r\n  run<T>(\r\n    nameOrSettings: string | CommandParams,\r\n    eventOrSettings?: CommandParams | MouseEvent,\r\n    event?: MouseEvent,\r\n  ): Promise<void | T> {\r\n    const cntx = ContextComplete.findContext(this.sxc);\r\n    return new Cms().run(cntx, nameOrSettings, eventOrSettings, event);\r\n  }\r\n}\r\n","import { CmsEngine } from '..';\r\nimport { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { QeSelectors } from '../../quick-edit';\r\nimport { ContextForLists } from '../../quick-edit/context-for-lists';\r\nimport { Commands } from '../commands';\r\n\r\nexport const CmdLayout = 'layout';\r\n/**\r\n * import this module to commands.ts\r\n */\r\nCommands.add(CmdLayout, 'ChangeLayout', 'glasses', true, true, {\r\n\r\n    inlineWindow: (_) => true,\r\n\r\n    code(context, event) {\r\n        // console.log('layout');\r\n        // Try to find the closest tag based on the click\r\n        // if this fails, try to find it based on the sxc-instance\r\n        const attrSel = '[' + QeSelectors.blocks.cb.context + ']';\r\n        // note: sometimes when the page loads, this can be auto-triggered and not have an event\r\n        const listSpecs = SxcEdit.getTag(context.sxc).closest<HTMLElement>(attrSel);\r\n\r\n        // Now check if we have apps-parameters to pass on\r\n        if (listSpecs) {\r\n            const specs = ContextForLists.getFromDom(listSpecs);\r\n            context.button.command.params.apps = specs.apps;\r\n        }\r\n        return CmsEngine.openDialog(context, event);\r\n    },\r\n});\r\n","import { CmdLayout } from '../commands/command/layout';\r\nimport { C } from '../constants';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { windowInPage as window } from '../interfaces/window-in-page';\r\nimport { HasLog, Insights, Log } from '../logging';\r\nimport { NoJQ, TypeUnsafe } from '../plumbing';\r\nimport { QuickDialog } from '../quick-dialog';\r\nimport * as QuickEditState from '../quick-dialog/state';\r\nimport { TagToolbarManager } from '../toolbar/tag-toolbars/tag-toolbar-manager';\r\nimport { ToolbarManager } from '../toolbar/toolbar-manager';\r\nimport { IDs } from '../constants/ids';\r\n\r\n/**\r\n * This contains everything necessary to bootstrap the edit mode.\r\n * It must be initialized and started at the end in the x-bootstrap code,\r\n * to ensure everything is already ready and loaded\r\n */\r\nexport class BootstrapInPage extends HasLog {\r\n    constructor() {\r\n        super('Sys.Bootst', null, 'Building Bootstrapper');\r\n        Insights.add('system', 'bootstrap', this.log);\r\n    }\r\n\r\n    private initializedInstances: HTMLElement[] = [];\r\n    private openedTemplatePickerOnce: boolean = false;\r\n    private diagCancelStateOnStart: boolean = QuickEditState.cancelled.get();\r\n\r\n    initialize() {\r\n        const callLog = this.log.call('initialize');\r\n        // reset cancelled state after one reload\r\n        if (this.diagCancelStateOnStart) QuickEditState.cancelled.remove();\r\n\r\n        // initialize all modules\r\n        this.initAllInstances(true);\r\n\r\n        // start observing the body for configured mutations\r\n        this.watchDomChanges();\r\n        callLog.return('done');\r\n    }\r\n\r\n\r\n    /**\r\n     * Scan all instances and initialize them\r\n     * @param isFirstRun should be true only on the very initial call\r\n     */\r\n    private initAllInstances(isFirstRun: boolean): void {\r\n        const callLog = this.log.call('initAllInstances');\r\n        document.querySelectorAll<HTMLElement>('div[data-edit-context]').forEach((e) => {\r\n            this.initInstance(e, isFirstRun);\r\n        });\r\n        if (isFirstRun) this.tryShowTemplatePicker();\r\n        callLog.return('initAllInstances done');\r\n    }\r\n\r\n    /**\r\n     * create an observer instance and start observing\r\n     */\r\n    private watchDomChanges() {\r\n        const callLog = this.log.call('watchDomChanges');\r\n        const observer = new MutationObserver((m) => {\r\n            // Watch statistics how changes were processed\r\n            window.$2sxc.stats.watchDomChanges++;\r\n            let processed = 0;\r\n\r\n            // Loop through each changed item, check if it's something we want to initialize\r\n            m.forEach((v) => {\r\n                v.addedNodes.forEach((n) => {\r\n                    // remove #comment and text nodes\r\n                    if ((n as HTMLElement).matches == null) return;\r\n                    const node = n as HTMLElement;\r\n\r\n                    // Menus which appear also cause DOM changes, but we want to ignore these for performance reasons\r\n                    if (node.matches(IDs.cls.scMenu)) return;\r\n\r\n                    processed++;\r\n\r\n                    // If the added node is a [data-edit-context], it is either a module or a content block which was replaced\r\n                    // re-initialize the module\r\n                    if (node.matches('div[data-edit-context]')) {\r\n                        this.initInstance(node, false);\r\n                        // in case it has inner content, try to open the picker-dialog\r\n                        if (!QuickDialog.singleton().isVisible()) this.tryShowTemplatePicker();\r\n                    }\r\n                    // If the added node contains [data-edit-context] nodes, it is likely the DNN module drag manager which added\r\n                    // the node. To prevent multiple initialization while dragging modules, we additionally check for the\r\n                    // .active-module class which seems to be applied while dragging the module.\r\n                    else if (node.matches(':not(.active-module)') && node.querySelectorAll<HTMLElement>('div[data-edit-context]').length > 0) {\r\n                        node.querySelectorAll<HTMLElement>('div[data-edit-context]').forEach((e) => {\r\n                            this.initInstance(e, false);\r\n                        });\r\n                    } else\r\n                        ToolbarManager.singleton().build(node);\r\n                });\r\n            });\r\n\r\n            // Clean up orphan tags if nodes have been added\r\n            if (processed) TagToolbarManager.CleanupOrphanedToolbars();\r\n        });\r\n\r\n        observer.observe(document.body, {\r\n            attributes: false,\r\n            childList: true,\r\n            subtree: true,\r\n        });\r\n        callLog.return('watchDomChanges done');\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Show the template picker if\r\n     * - template picker has not yet been opened\r\n     * - dialog has not been cancelled\r\n     * - only one uninitialized module on page\r\n     * @returns\r\n     */\r\n    private tryShowTemplatePicker(): boolean {\r\n        const cl = this.log.call('tryShowTemplatePicker');\r\n        let sxc: SxcEdit;\r\n        // first check if we should show one according to the state-settings\r\n        const openDialogId = QuickEditState.cbId.get();\r\n        if (openDialogId) {\r\n            // must check if it's on this page, as it could be from another page\r\n            const found = document.querySelectorAll<HTMLElement>(`[data-cb-id=\"${openDialogId}\"]`);\r\n            if (found.length) {\r\n                // since the CB-ID could also be an inner content (marked as a negative \"-\" number)\r\n                // we must be sure that we use the right id a.nyhow\r\n                if (openDialogId < 0) {\r\n                    const instanceId = Number(found[0].attributes.getNamedItem(C.Attributes.InstanceId).value);\r\n                    sxc = SxcEdit.get(instanceId, openDialogId);\r\n                } else sxc = SxcEdit.get(openDialogId);\r\n            }\r\n        }\r\n\r\n        if (!sxc) {\r\n            const uninitializedModules = document.querySelectorAll<HTMLElement>('.sc-uninitialized');\r\n\r\n            if (this.diagCancelStateOnStart || this.openedTemplatePickerOnce)\r\n                return cl.return(false, 'cancelled');\r\n\r\n            // already showing a dialog\r\n            if (QuickDialog.singleton().isVisible())\r\n                return cl.return(false, 'should be invisible');\r\n\r\n            // not exactly one uninitialized module\r\n            if (uninitializedModules.length !== 1)\r\n                return cl.return(false, 'has un-init modules');\r\n\r\n            // show the template picker of this module\r\n            const module = Array.from(uninitializedModules).find((e) => e.parentElement.matches('div[data-edit-context]'))?.parentElement;\r\n            sxc = SxcEdit.get(module);\r\n        }\r\n\r\n        if (sxc) {\r\n            sxc.manage.run(CmdLayout);\r\n            this.openedTemplatePickerOnce = true;\r\n        }\r\n        return cl.return(true, 'tryShowTemplatePicker() done');\r\n    }\r\n\r\n\r\n    private initInstance(module: HTMLElement, isFirstRun: boolean): void {\r\n        const cl = this.log.call('initInstance', `module: obj, isFirstRun: ${isFirstRun}) initialized: ${this.initializedInstances}`);\r\n\r\n        // if instance is already in the list of initialized modules, skip\r\n        // otherwise add for next time to prevent recursions\r\n        if (this.initializedInstances.find((m) => m === module)) return;\r\n        this.initializedInstances.push(module);\r\n\r\n        let sxc = SxcEdit.get(module);\r\n\r\n        // check if the sxc must be re-created. This is necessary when modules are dynamically changed\r\n        // because the configuration may change, and that is cached otherwise, resulting in toolbars with wrong config\r\n        if (!isFirstRun) sxc = sxc.recreate(true) as SxcEdit;\r\n\r\n        // check if we must show the glasses\r\n        // this must always run because it can be added ajax-style\r\n        const wasEmpty = this.showGlassesButtonIfUninitialized(sxc);\r\n\r\n        if (isFirstRun || !wasEmpty) {\r\n            // use a logger for each iteration\r\n            const log = new Log('Bts.Module');\r\n\r\n            ToolbarManager.singleton().buildModule(module);\r\n        }\r\n        cl.done();\r\n    }\r\n\r\n\r\n    private showGlassesButtonIfUninitialized(sxci: SxcEdit): boolean {\r\n        const callLog = this.log.call('showGlassesButtonIfUninitialized');\r\n        // already initialized\r\n        if (this.isInitialized(sxci))\r\n            return callLog.return(false, 'is initialized');\r\n\r\n        // already has a glasses button\r\n        const tag = SxcEdit.getTag(sxci);\r\n        if (tag.querySelectorAll<HTMLElement>('.sc-uninitialized').length !== 0)\r\n            return callLog.return(false, 'already has button');\r\n\r\n        // note: title is added on mouseover, as the translation isn't ready at page-load\r\n        const btn = NoJQ.domFromString(\r\n            '<div class=\"sc-uninitialized\" onmouseover=\"this.title = $2sxc.translate(this.title)\" title=\"InPage.NewElement\">' +\r\n            '<div class=\"icon-sxc-glasses\"></div>' +\r\n            '</div>',\r\n        )[0];\r\n\r\n        btn.addEventListener('click', () => sxci.manage.run(CmdLayout));\r\n\r\n        tag.append(btn);\r\n        return callLog.return(true, 'ok');\r\n    }\r\n\r\n\r\n    isInitialized(sxci: SxcEdit): boolean {\r\n        const cg =\r\n            sxci &&\r\n            sxci.manage &&\r\n            sxci.manage._editContext &&\r\n            sxci.manage._editContext.contentBlock;\r\n        return cg && cg.TemplateId !== 0;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { SxcInstanceEngine } from '../../commands';\r\nimport { CmdLayout } from '../../commands/command/layout';\r\nimport { SxcEdit } from '../../interfaces/sxc-instance-editable';\r\nimport { HasLog, Insights } from '../../logging';\r\n\r\n\r\n/**\r\n * Maps actions of the module menu to JS actions - needed because onclick event can't be set (actually, a bug in DNN)\r\n */\r\nexport class DnnActionMenu extends HasLog {\r\n    private run: typeof SxcInstanceEngine.prototype.run;\r\n    private sxc: SxcEdit;\r\n\r\n    constructor(moduleId: number) {\r\n        super('Dnn.Menu', null, `modId: ${moduleId}`);\r\n        Insights.add('dnn-menu', `mod: ${moduleId}`, this.log);\r\n        this.sxc = SxcEdit.get(moduleId);\r\n        this.run = this.sxc.manage.run;\r\n    }\r\n\r\n    changeLayoutOrContent = () => { this.run(CmdLayout); };\r\n\r\n    // 2020-04-21 2dm disabled this, as it doesn't make sense to have this in the DNN menu - since add can be used in each position\r\n    // addItem = () => { this.run('new', { useModuleList: true, sortOrder: 0 }); };\r\n\r\n    edit = () => { this.run('edit', { useModuleList: true, sortOrder: 0 }); };\r\n\r\n    adminApp = () => { this.run('app'); };\r\n\r\n    adminZone = () => { this.run('zone'); };\r\n\r\n    develop = () => { this.run('template-develop'); };\r\n}\r\n\r\n","export * from './dnn-menu-helper/dnn-inpage-edit';\r\n// tslint:disable-next-line: no-var-requires\r\nconst autorun = require('./dnn-workarounds/dnn-08.00.04');","import { NoJQ, SxcInstanceManage } from '../../../$2sxc/src';\r\nimport { SxcInstanceEngine } from '../commands';\r\nimport { ContextComplete } from '../context/bundles/context-bundle-button';\r\nimport { AttrJsonEditContext } from '../context/html-attribute/edit-context-root';\r\nimport { ContextOfUser } from '../context/parts/context-user';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { TypeUnsafe } from '../plumbing';\r\nimport { ToolbarManager } from '../toolbar';\r\nimport { ToolbarSettings } from '../toolbar/config';\r\nimport { InPageButtonJson } from '../toolbar/config-loaders';\r\nimport { ToolbarRenderer } from '../toolbar/render/toolbar-renderer';\r\n\r\n/**\r\n * Instance specific edit manager\r\n */\r\nexport class EditManager implements SxcInstanceManage {\r\n\r\n    constructor(\r\n        private sxc: SxcEdit,\r\n        private editContext: AttrJsonEditContext,\r\n        private userInfo: ContextOfUser,\r\n        private cmdEngine: SxcInstanceEngine,\r\n        public context: ContextComplete,\r\n    ) {\r\n    }\r\n\r\n    //#region Official, public properties and commands, which are stable for use from the outside\r\n\r\n    /**\r\n     * run a command - command used in toolbars and custom buttons\r\n     * it is publicly used out of inpage, so take a care to preserve function signature\r\n     */\r\n    run = this.cmdEngine.run;\r\n\r\n    /**\r\n     * Generate a button (an <a>-tag) for one specific toolbar-action.\r\n     * @param {InPageButtonJson} actDef - settings, an object containing the spec for the expected button\r\n     * @param {int} groupIndex - number what button-group it's in'\r\n     * @returns {string} html of a button\r\n     * it is publicly used out of inpage, so take a care to preserve function signature\r\n     */\r\n    getButton(actDef: InPageButtonJson, groupIndex: number): string {\r\n        this.context.button = ToolbarManager.singleton().getLoader('getButton')\r\n            .groups.convertToButton(actDef, {}, {}, {});\r\n        const button = new ToolbarRenderer(this.context).button.render(this.context, groupIndex);\r\n        return button.outerHTML;\r\n    }\r\n\r\n    /**\r\n     * Builds the toolbar and returns it as HTML\r\n     * @param {Object} tbConfig - general toolbar config\r\n     * @param {ToolbarSettings} moreSettings - additional / override settings\r\n     * @returns {string} html of the current toolbar\r\n     *\r\n     * it is publicly used in Razor scripts of inpage, so take a care to preserve function signature\r\n     */\r\n    getToolbar(tbConfig: TypeUnsafe, moreSettings: ToolbarSettings): string {\r\n        // if toolbar is an array, use as-is, otherwise assume properties are params\r\n        const toolbar = Array.isArray(tbConfig) ? tbConfig : { ...tbConfig };\r\n        tbConfig = { settings: { ...tbConfig.settings, ...moreSettings }, toolbar: toolbar };\r\n        const toolbarConfig = ToolbarManager.singleton().loadConfig(this.context, tbConfig);\r\n        this.context.toolbar = toolbarConfig;\r\n        return new ToolbarRenderer(this.context).render();\r\n    }\r\n\r\n    //#endregion official, public properties - everything below this can change\r\n\r\n    _context = this.context;\r\n\r\n    /**\r\n     * internal method to find out if it's in edit-mode\r\n     */\r\n    _isEditMode = () => this.editContext.Environment.IsEditable ?? false;\r\n\r\n    /**\r\n     * used for various dialogues\r\n     */\r\n    _reloadWithAjax = this.context.app.supportsAjax;\r\n\r\n    /** metadata necessary to know what/how to edit */\r\n    _editContext = this.editContext;\r\n\r\n    /** used to handle the commands for this content-block */\r\n    _commands = this.cmdEngine;\r\n\r\n    _user = this.userInfo;\r\n\r\n\r\n\r\n    /**\r\n     * change config by replacing the guid, and refreshing dependent sub-objects\r\n     */\r\n    _updateContentGroupGuid(context: ContextComplete, newGuid: string) {\r\n        context.contentBlock.contentGroupId = newGuid;\r\n        this.editContext.contentBlock.Guid = newGuid;\r\n    }\r\n\r\n    /**\r\n     * init this object\r\n     */\r\n    init(): void {\r\n        const tag = SxcEdit.getTag(this.sxc);\r\n        // enhance UI in case there are known errors / issues\r\n        const isErrorState = this.editContext && this.editContext.error && this.editContext.error.type;\r\n        if (isErrorState)\r\n            handleErrors(this.editContext.error.type, tag);\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n/**\r\n * private: show error when the app-data hasn't been installed yet for this imported-module\r\n */\r\nfunction handleErrors(errType: string, cbTag: HTMLElement): void {\r\n    const errWrapper = NoJQ.domFromString('<div class=\"dnnFormMessage dnnFormWarning sc-element\"></div>')[0];\r\n    let msg = '';\r\n    const toolbar = NoJQ.domFromString('<ul class=\"sc-menu\"></ul>')[0];\r\n    if (errType === 'DataIsMissing') {\r\n        msg =\r\n            'Error: System.Exception: Data is missing - usually when a site is copied but the content / apps have not been imported yet - check 2sxc.org/help?tag=export-import';\r\n        toolbar.setAttribute('data-toolbar', '[{\\\"action\\\": \\\"zone\\\"}, {\\\"action\\\": \\\"more\\\"}]');\r\n    }\r\n    errWrapper.append(msg);\r\n    errWrapper.append(toolbar);\r\n    cbTag.append(errWrapper);\r\n}\r\n","import { SxcInstanceEngine } from '../commands';\r\nimport { ContextComplete } from '../context';\r\nimport { ContextOfUser } from '../context';\r\nimport { SxcEdit } from '../interfaces/sxc-instance-editable';\r\nimport { ToolbarManager } from '../toolbar';\r\nimport { EditManager } from './edit-manager';\r\n\r\n/**\r\n * A helper-controller in charge of opening edit-dialogues + creating the toolbars for it\r\n * all in-page toolbars etc.\r\n * if loaded, it's found under the $2sxc(module).manage\r\n * it has commands to\r\n * - getButton\r\n * - getToolbar\r\n * - run(...)\r\n * - isEditMode\r\n */\r\nexport class Manage {\r\n    /**\r\n     * Init the manager object\r\n     * we must keep signature of initInstance in sync with the 2sxc.api.js\r\n     * @param sxc\r\n     */\r\n    initInstance(sxc: SxcEdit) {\r\n        try {\r\n            const myContext = ContextComplete.findContext(sxc);\r\n            const editContext = SxcEdit.getEditContext(myContext.sxc);\r\n\r\n            const userInfo = ContextOfUser.fromContext(myContext);\r\n            const cmdEngine = new SxcInstanceEngine(myContext.sxc);\r\n\r\n            const editManager = new EditManager(myContext.sxc, editContext, userInfo, cmdEngine, myContext);\r\n            sxc.manage = editManager;\r\n            editManager.init();\r\n            return editManager;\r\n        } catch (e) {\r\n          console.error('error in 2sxc - will log but not throw', e);\r\n        }\r\n    }\r\n\r\n    /** Internal - ATM only used in dnn-sxc-angular to enable toolbar initialization */\r\n    _toolbarManager = ToolbarManager.singleton();\r\n}\r\n","import { SxcEdit } from '../interfaces/sxc-instance-editable';\r\n\r\n//#region WebApi Endpoints used: 2sxc\r\nconst webApiInstallComplete = 'sys/install/resume';\r\n//#endregion\r\n\r\nexport class SystemUpgrader {\r\n    // upgrade command - started when an error contains a link to start this\r\n    finishUpgrade(domElement: HTMLElement): void {\r\n        const mc = SxcEdit.get(domElement);\r\n        mc.webApi.fetch(webApiInstallComplete)\r\n            .then(() => {\r\n                alert('Upgrade ok, restarting the CMS and reloading...');\r\n                location.reload();\r\n            });\r\n        alert('starting upgrade. This could take a few minutes. You\\'ll see an \\'ok\\' when it\\'s done. Please wait...');\r\n    }\r\n}\r\n","import { NoJQ } from '../plumbing';\r\n\r\n// tslint:disable-next-line: no-var-requires\r\nconst Shake = require('shake.js');\r\n// ReSharper disable once InconsistentNaming\r\n// enable shake detection on all toolbars\r\nNoJQ.ready(() => {\r\n  // this will add a css-class to auto-show all toolbars (or remove it again)\r\n  function toggleAllToolbars() {\r\n    document.body.classList.toggle('sc-tb-show-all');\r\n  }\r\n\r\n  // debugger; // shake is not working, neither on ios nor android. Might be because of http and might work with https\r\n  const shake = new Shake({ callback: toggleAllToolbars });\r\n  // start shake-event monitoring, which will then generate a window-event\r\n  shake.start();\r\n});\r\n","import { BootstrapInPage } from './bootstrap/bootstrap';\r\nimport { Cms } from './cms/Cms';\r\nimport { ContextComplete } from './context/bundles/context-bundle-button';\r\nimport { DnnActionMenu } from './dnn';\r\nimport { translate, Translator } from './i18n';\r\nimport { $2sxcInPage as $2sxc } from './interfaces/sxc-controller-in-page';\r\nimport { windowInPage as window } from './interfaces/window-in-page';\r\nimport { EditManager } from './manage/edit-manager';\r\nimport { Manage } from './manage/manage';\r\nimport { NoJQ } from './plumbing';\r\nimport { QuickE } from './quick-edit/quick-e';\r\nimport { SystemUpgrader } from './system';\r\nimport './toolbar/toolbar-global-enable-shake';\r\n\r\n// #1 Note that $2sxc must always exist, the server ensures the load order\r\n\r\n// #2 Now attach initialization helpers and global objects, so that $2sxc always has these\r\n$2sxc.context = ContextComplete.findContext; // primary API to get the context\r\n$2sxc._translateInit = (manage: EditManager) => Translator.initManager(manage); // reference in ./2sxc-api/js/ToSic.Sxc.Instance.ts\r\n$2sxc.translate = translate;    // provide an official translate API for 2sxc\r\n$2sxc._manage = new Manage();   // used out of this project in ToSic.Sxc.Instance and 2sxc.api.js\r\nwindow.$quickE = QuickE.singleton();        // note: not sure if this is needed as a global object...\r\n$2sxc.cms = new Cms();\r\n\r\n// #3 Initialize all objects as needed\r\nfunction loadInpage() {\r\n    // check if already initialized - just in case these scripts were loaded multiple times\r\n    const bootstrapper = new BootstrapInPage();\r\n    bootstrapper.initialize();\r\n    QuickE.singleton().start();\r\n\r\n    /** this enhances the $2sxc client controller with stuff only needed when logged in */\r\n    if (!window.$2sxc.system) window.$2sxc.system = new SystemUpgrader();\r\n\r\n    /** Connect DNN action mapper to this module instance */\r\n    window.$2sxcActionMenuMapper = (moduleId: number) => {\r\n        return new DnnActionMenu(moduleId);\r\n    };\r\n}\r\n\r\nNoJQ.ready(loadInpage);\r\n\r\n// Tell Webpack to load CSS\r\nconst cssEdit = require('./inpage.css');\r\nconst cssIcons = require('../icons/inpage-icons-codes.css');\r\n\r\n"],"sourceRoot":""}